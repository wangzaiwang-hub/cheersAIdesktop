(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,766293,337132,e=>{"use strict";var t,r=e.i(563199),a=e.i(824627),n=e.i(268255),s=e.i(295978),o=e.i(289751),l=e.i(219830),i=function(e,t){var r=t.manual,s=t.ready,o=void 0===s||s,i=t.defaultParams,c=void 0===i?[]:i,d=t.refreshDeps,u=t.refreshDepsAction,m=(0,n.useRef)(!1);return m.current=!1,(0,l.default)(function(){!r&&o&&(m.current=!0,e.run.apply(e,(0,a.__spreadArray)([],(0,a.__read)(c),!1)))},[o]),(0,l.default)(function(){!m.current&&(r||(m.current=!0,u?u():e.refresh()))},(0,a.__spreadArray)([],(0,a.__read)(void 0===d?[]:d),!1)),{onBefore:function(){if(!o)return{stopNow:!0}}}};i.onInit=function(e){var t=e.ready;return{loading:!e.manual&&(void 0===t||t)}};var c=e.i(104411);let d=function(e,t){var r=(0,n.useRef)({deps:t,obj:void 0,initialized:!1}).current;return!1!==r.initialized&&(0,c.default)(r.deps,t)||(r.deps=t,r.obj=e(),r.initialized=!0),r.obj};var u=e.i(685888),m=new Map,p=function(e,t,r){var n=m.get(e);(null==n?void 0:n.timer)&&clearTimeout(n.timer);var s=void 0;t>-1&&(s=setTimeout(function(){m.delete(e)},t)),m.set(e,(0,a.__assign)((0,a.__assign)({},r),{timer:s}))},x=new Map,f=function(e,t){x.set(e,t),t.then(function(t){return x.delete(e),t}).catch(function(){x.delete(e)})},h={},v=function(e,t){h[e]&&h[e].forEach(function(e){return e(t)})},g=function(e,t){return h[e]||(h[e]=[]),h[e].push(t),function(){var r=h[e].indexOf(t);h[e].splice(r,1)}};let y=function(e,t){var r=t.cacheKey,s=t.cacheTime,o=void 0===s?3e5:s,l=t.staleTime,i=void 0===l?0:l,c=t.setCache,h=t.getCache,y=(0,n.useRef)(void 0),b=(0,n.useRef)(void 0),w=function(e,t){c?c(t):p(e,o,t),v(e,t.data)},j=function(e,t){return(void 0===t&&(t=[]),h)?h(t):m.get(e)};return(d(function(){if(r){var t=j(r);t&&Object.hasOwnProperty.call(t,"data")&&(e.state.data=t.data,e.state.params=t.params,(-1===i||Date.now()-t.time<=i)&&(e.state.loading=!1)),y.current=g(r,function(t){e.setState({data:t})})}},[]),(0,u.default)(function(){var e;null==(e=y.current)||e.call(y)}),r)?{onBefore:function(e){var t=j(r,e);return t&&Object.hasOwnProperty.call(t,"data")?-1===i||Date.now()-t.time<=i?{loading:!1,data:null==t?void 0:t.data,error:void 0,returnNow:!0}:{data:null==t?void 0:t.data,error:void 0}:{}},onRequest:function(e,t){var n=x.get(r);return n&&n!==b.current||(b.current=n=e.apply(void 0,(0,a.__spreadArray)([],(0,a.__read)(t),!1)),f(r,n)),{servicePromise:n}},onSuccess:function(t,a){var n;r&&(null==(n=y.current)||n.call(y),w(r,{data:t,params:a,time:Date.now()}),y.current=g(r,function(t){e.setState({data:t})}))},onMutate:function(t){var a;r&&(null==(a=y.current)||a.call(y),w(r,{data:t,params:e.state.params,time:Date.now()}),y.current=g(r,function(t){e.setState({data:t})}))}}:{}};var b=e.i(476293);let w=function(e,t){var r=t.debounceWait,s=t.debounceLeading,o=t.debounceTrailing,l=t.debounceMaxWait,i=(0,n.useRef)(void 0),c=(0,n.useMemo)(function(){var e={};return void 0!==s&&(e.leading=s),void 0!==o&&(e.trailing=o),void 0!==l&&(e.maxWait=l),e},[s,o,l]);return((0,n.useEffect)(function(){if(r){var t=e.runAsync.bind(e);return i.current=(0,b.default)(function(e){e()},r,c),e.runAsync=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return new Promise(function(r,n){var s;null==(s=i.current)||s.call(i,function(){t.apply(void 0,(0,a.__spreadArray)([],(0,a.__read)(e),!1)).then(r).catch(n)})})},function(){var r;null==(r=i.current)||r.cancel(),e.runAsync=t}}},[r,c]),r)?{onCancel:function(){var e;null==(e=i.current)||e.cancel()}}:{}},j=function(e,t){var r=t.loadingDelay,a=t.ready,s=(0,n.useRef)(void 0);if(!r)return{};var o=function(){s.current&&clearTimeout(s.current)};return{onBefore:function(){return o(),!1!==a&&(s.current=setTimeout(function(){e.setState({loading:!0})},r)),{loading:!1}},onFinally:function(){o()},onCancel:function(){o()}}};var _=e.i(354440);function N(){return!_.default||"hidden"!==document.visibilityState}var k=new Set;_.default&&window.addEventListener("visibilitychange",function(){N()&&k.forEach(function(e){return e()})},!1);let T=function(e,t){var r=t.pollingInterval,a=t.pollingWhenHidden,s=void 0===a||a,o=t.pollingErrorRetryCount,i=void 0===o?-1:o,c=(0,n.useRef)(void 0),d=(0,n.useRef)(void 0),u=(0,n.useRef)(0),m=function(){var e;c.current&&clearTimeout(c.current),null==(e=d.current)||e.call(d)};return((0,l.default)(function(){r||m()},[r]),r)?{onBefore:function(){m()},onError:function(){u.current+=1},onSuccess:function(){u.current=0},onFinally:function(){-1===i||-1!==i&&u.current<=i?c.current=setTimeout(function(){if(s||N())e.refresh();else{var t;t=function(){e.refresh()},k.add(t),d.current=function(){k.has(t)&&k.delete(t)}}},r):u.current=0},onCancel:function(){m()}}:{}};var C=new Set;if(_.default){var A=function(){N()&&(!_.default||void 0===navigator.onLine||navigator.onLine)&&C.forEach(function(e){return e()})};window.addEventListener("visibilitychange",A,!1),window.addEventListener("focus",A,!1)}let S=function(e,t){var r=t.refreshOnWindowFocus,s=t.focusTimespan,o=void 0===s?5e3:s,l=(0,n.useRef)(void 0),i=function(){var e;null==(e=l.current)||e.call(l)};return(0,n.useEffect)(function(){if(r){var t,n,s,c=(t=e.refresh.bind(e),n=!1,function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];n||(n=!0,t.apply(void 0,(0,a.__spreadArray)([],(0,a.__read)(e),!1)),setTimeout(function(){n=!1},o))});s=function(){c()},C.add(s),l.current=function(){C.has(s)&&C.delete(s)}}return function(){i()}},[r,o]),(0,u.default)(function(){i()}),{}},P=function(e,t){var r=t.retryInterval,a=t.retryCount,s=(0,n.useRef)(void 0),o=(0,n.useRef)(0),l=(0,n.useRef)(!1);return a?{onBefore:function(){l.current||(o.current=0),l.current=!1,s.current&&clearTimeout(s.current)},onSuccess:function(){o.current=0},onError:function(){o.current+=1,-1===a||o.current<=a?s.current=setTimeout(function(){l.current=!0,e.refresh()},null!=r?r:Math.min(1e3*Math.pow(2,o.current),3e4)):o.current=0},onCancel:function(){o.current=0,s.current&&clearTimeout(s.current)}}:{}};var E=e.i(668707);let M=function(e,t){var r=t.throttleWait,s=t.throttleLeading,o=t.throttleTrailing,l=(0,n.useRef)(void 0),i={};return(void 0!==s&&(i.leading=s),void 0!==o&&(i.trailing=o),(0,n.useEffect)(function(){if(r){var t=e.runAsync.bind(e);return l.current=(0,E.default)(function(e){e()},r,i),e.runAsync=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return new Promise(function(r,n){var s;null==(s=l.current)||s.call(l,function(){t.apply(void 0,(0,a.__spreadArray)([],(0,a.__read)(e),!1)).then(r).catch(n)})})},function(){var r;e.runAsync=t,null==(r=l.current)||r.cancel()}}},[r,s,o]),r)?{onCancel:function(){var e;null==(e=l.current)||e.cancel()}}:{}};var R=e.i(393689),I=e.i(841054);let D=function(){var e=(0,a.__read)((0,n.useState)({}),2)[1];return(0,n.useCallback)(function(){return e({})},[])};var L=e.i(703440),F=e.i(773923),O=function(){function e(e,t,r,n){void 0===n&&(n={}),this.serviceRef=e,this.options=t,this.subscribe=r,this.initState=n,this.count=0,this.state={loading:!1,params:void 0,data:void 0,error:void 0},this.state=(0,a.__assign)((0,a.__assign)((0,a.__assign)({},this.state),{loading:!t.manual}),n)}return e.prototype.setState=function(e){void 0===e&&(e={}),this.state=(0,a.__assign)((0,a.__assign)({},this.state),e),this.subscribe()},e.prototype.runPluginHandler=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=this.pluginImpls.map(function(r){var n;return null==(n=r[e])?void 0:n.call.apply(n,(0,a.__spreadArray)([r],(0,a.__read)(t),!1))}).filter(Boolean);return Object.assign.apply(Object,(0,a.__spreadArray)([{}],(0,a.__read)(n),!1))},e.prototype.runAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0,a.__awaiter)(this,void 0,void 0,function(){var t,r,n,s,o,l,i,c,d,u,m,p,x,f,h,v,g,y,b,w,j;return(0,a.__generator)(this,function(_){switch(_.label){case 0:if(this.count+=1,t=this.count,s=void 0!==(n=(r=this.runPluginHandler("onBefore",e)).stopNow)&&n,l=void 0!==(o=r.returnNow)&&o,i=(0,a.__rest)(r,["stopNow","returnNow"]),s)return[2,new Promise(function(){})];if(this.setState((0,a.__assign)({loading:!0,params:e},i)),l)return[2,Promise.resolve(i.data)];null==(x=(p=this.options).onBefore)||x.call(p,e),_.label=1;case 1:return _.trys.push([1,3,,4]),(c=this.runPluginHandler("onRequest",this.serviceRef.current,e).servicePromise)||(c=(m=this.serviceRef).current.apply(m,(0,a.__spreadArray)([],(0,a.__read)(e),!1))),[4,c];case 2:if(d=_.sent(),t!==this.count)return[2,new Promise(function(){})];return this.setState({data:d,error:void 0,loading:!1}),null==(h=(f=this.options).onSuccess)||h.call(f,d,e),this.runPluginHandler("onSuccess",d,e),null==(g=(v=this.options).onFinally)||g.call(v,e,d,void 0),t===this.count&&this.runPluginHandler("onFinally",e,d,void 0),[2,d];case 3:if(u=_.sent(),t!==this.count)return[2,new Promise(function(){})];throw this.setState({error:u,loading:!1}),null==(b=(y=this.options).onError)||b.call(y,u,e),this.runPluginHandler("onError",u,e),null==(j=(w=this.options).onFinally)||j.call(w,e,void 0,u),t===this.count&&this.runPluginHandler("onFinally",e,void 0,u),u;case 4:return[2]}})})},e.prototype.run=function(){for(var e=this,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];this.runAsync.apply(this,(0,a.__spreadArray)([],(0,a.__read)(t),!1)).catch(function(t){e.options.onError||console.error(t)})},e.prototype.cancel=function(){this.count+=1,this.setState({loading:!1}),this.runPluginHandler("onCancel")},e.prototype.refresh=function(){this.run.apply(this,(0,a.__spreadArray)([],(0,a.__read)(this.state.params||[]),!1))},e.prototype.refreshAsync=function(){return this.runAsync.apply(this,(0,a.__spreadArray)([],(0,a.__read)(this.state.params||[]),!1))},e.prototype.mutate=function(e){var t=(0,F.isFunction)(e)?e(this.state.data):e;this.runPluginHandler("onMutate",t),this.setState({data:t})},e}();let B=function(e,t,r){void 0===t&&(t={}),void 0===r&&(r=[]);var n=t.manual,s=void 0!==n&&n,l=t.ready,i=void 0===l||l,c=(0,a.__rest)(t,["manual","ready"]);L.default&&t.defaultParams&&!Array.isArray(t.defaultParams)&&console.warn("expected defaultParams is array, got ".concat(typeof t.defaultParams));var m=(0,a.__assign)({manual:s,ready:i},c),p=(0,R.default)(e),x=D(),f=d(function(){var e=r.map(function(e){var t;return null==(t=null==e?void 0:e.onInit)?void 0:t.call(e,m)}).filter(Boolean);return new O(p,m,x,Object.assign.apply(Object,(0,a.__spreadArray)([{}],(0,a.__read)(e),!1)))},[]);return f.options=m,f.pluginImpls=r.map(function(e){return e(f,m)}),(0,I.default)(function(){if(!s&&i){var e=f.state.params||t.defaultParams||[];f.run.apply(f,(0,a.__spreadArray)([],(0,a.__read)(e),!1))}}),(0,u.default)(function(){f.cancel()}),{loading:f.state.loading,data:f.state.data,error:f.state.error,params:f.state.params||[],cancel:(0,o.default)(f.cancel.bind(f)),refresh:(0,o.default)(f.refresh.bind(f)),refreshAsync:(0,o.default)(f.refreshAsync.bind(f)),run:(0,o.default)(f.run.bind(f)),runAsync:(0,o.default)(f.runAsync.bind(f)),mutate:(0,o.default)(f.mutate.bind(f))}};var H=e.i(220431),W=function(e){return e.scrollHeight||Math.max(document.documentElement.scrollHeight,document.body.scrollHeight)};let q=function(e,t){void 0===t&&(t={});var r=t.target,c=t.isNoMore,d=t.threshold,u=void 0===d?100:d,m=t.direction,p=t.reloadDeps,x=t.manual,f=t.onBefore,h=t.onSuccess,v=t.onError,g=t.onFinally,b=(0,a.__read)((0,n.useState)(),2),_=b[0],N=b[1],k=(0,a.__read)((0,n.useState)(!1),2),C=k[0],A=k[1],E="top"===(void 0===m?"bottom":m),R=(0,n.useRef)(void 0),I=(0,n.useRef)(0),D=(0,n.useMemo)(function(){return!!c&&c(_)},[_]),L=B(function(t){return(0,a.__awaiter)(void 0,void 0,void 0,function(){return(0,a.__generator)(this,function(r){switch(r.label){case 0:return[4,e(t)];case 1:return[2,{currentData:r.sent(),lastData:t}]}})})},{manual:x,onFinally:function(e,t,r){A(!1),null==g||g(null==t?void 0:t.currentData,r)},onBefore:function(){return null==f?void 0:f()},onSuccess:function(e){var t,n,s;e.lastData?N((0,a.__assign)((0,a.__assign)({},e.currentData),{list:E?(0,a.__spreadArray)((0,a.__spreadArray)([],(0,a.__read)(e.currentData.list),!1),(0,a.__read)(null!=(n=e.lastData.list)?n:[]),!1):(0,a.__spreadArray)((0,a.__spreadArray)([],(0,a.__read)(null!=(s=e.lastData.list)?s:[]),!1),(0,a.__read)(e.currentData.list),!1)})):N((0,a.__assign)((0,a.__assign)({},e.currentData),{list:(0,a.__spreadArray)([],(0,a.__read)(null!=(t=e.currentData.list)?t:[]),!1)})),setTimeout(function(){if(E){var e=(0,H.getTargetElement)(r);if(e=e===document?document.documentElement:e){var t=W(e);e.scrollTo(0,t-I.current)}}else V()}),null==h||h(e.currentData)},onError:function(e){return null==v?void 0:v(e)}},(0,a.__spreadArray)((0,a.__spreadArray)([],(0,a.__read)([]),!1),[w,j,T,S,M,i,y,P],!1)),F=L.loading,O=L.error,q=L.run,$=L.runAsync,U=L.cancel,z=(0,o.default)(function(){D||(A(!0),q(_))}),K=function(e){return(0,a.__awaiter)(void 0,void 0,void 0,function(){return(0,a.__generator)(this,function(t){switch(t.label){case 0:return[4,$(e)];case 1:return[2,t.sent().currentData]}})})},G=(0,o.default)(function(){return D?Promise.reject():(A(!0),K(_))}),V=function(){var e=(0,H.getTargetElement)(r);if(e){var t=e===document?document.documentElement:e,a=t===document||t===document.documentElement||t===document.body?Math.max(window.pageYOffset,document.documentElement.scrollTop,document.body.scrollTop):t.scrollTop,n=W(t),s=t.clientHeight||Math.max(document.documentElement.clientHeight,document.body.clientHeight);E?(void 0!==R.current&&R.current>a&&a<=u&&z(),R.current=a,I.current=n-a):n-a<=s+u&&z()}};return(0,s.default)("scroll",function(){F||C||V()},{target:r}),(0,l.default)(function(){q()},(0,a.__spreadArray)([],(0,a.__read)(void 0===p?[]:p),!1)),{data:_,loading:!C&&F,error:O,loadingMore:C,noMore:D,loadMore:z,loadMoreAsync:G,reload:(0,o.default)(function(){return A(!1),q()}),reloadAsync:(0,o.default)(function(){return A(!1),K()}),mutate:N,cancel:U}};var $=e.i(554327);e.i(152567);var U=e.i(408767),z=e.i(257899),K=e.i(83278),G=e.i(151094),V=e.i(449980),Y=e.i(21151),X=e.i(739255),Z=e.i(500841),J=e.i(216425),Q=e.i(225244),ee=e.i(935139);let et=n.memo(e=>{let{isShow:t,onClose:a,selectedIds:s,onSelect:o}=e,{t:l}=(0,U.useTranslation)(),[i,c]=(0,n.useState)([]),{formatIndexingTechniqueAndMethod:d}=(0,J.useKnowledge)(),{data:u,isLoading:m,isFetchingNextPage:p,fetchNextPage:x,hasNextPage:f}=(0,Q.useInfiniteDatasets)({page:1},{enabled:t,staleTime:0,refetchOnMount:"always"}),h=u?.pages||[],v=(0,n.useMemo)(()=>h.flatMap(e=>e.data.filter(e=>e.indexing_technique||"external"===e.provider)),[h]),g=!m&&0===v.length,y=(0,n.useRef)(null),b=!1===f;q(async()=>(!f||p||await x(),{list:[]}),{target:y,isNoMore:()=>b,reloadDeps:[b,p]});let w=(0,n.useRef)([]),j=(0,n.useRef)(!1);return(0,n.useEffect)(()=>{t&&(j.current=!1)},[t]),(0,n.useEffect)(()=>{let e=w.current,t=s.length!==e.length||s.some((t,r)=>t!==e[r]);if(!s.length&&(!j.current||t)){c([]),w.current=s,j.current=!1;return}(t||!j.current)&&(c(e=>{let t=new Map(e.map(e=>[e.id,e]));return s.map(e=>v.find(t=>t.id===e)||t.get(e)).filter(Boolean)}),w.current=s,j.current=!1)},[v,s]),(0,r.jsxs)(Y.default,{isShow:t,onClose:a,className:"w-[400px]",title:l("feature.dataSet.selectTitle",{ns:"appDebug"}),children:[m&&0===v.length&&(0,r.jsx)("div",{className:"flex h-[200px]",children:(0,r.jsx)(V.default,{type:"area"})}),g&&(0,r.jsxs)("div",{className:"mt-6 flex h-[128px] items-center justify-center space-x-1  rounded-lg border text-[13px]",style:{background:"rgba(0, 0, 0, 0.02)",borderColor:"rgba(0, 0, 0, 0.02"},children:[(0,r.jsx)("span",{className:"text-text-tertiary",children:l("feature.dataSet.noDataSet",{ns:"appDebug"})}),(0,r.jsx)($.default,{href:"/datasets/create",className:"font-normal text-text-accent",children:l("feature.dataSet.toCreate",{ns:"appDebug"})})]}),v.length>0&&(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{ref:y,className:"mt-7 max-h-[286px] space-y-1 overflow-y-auto",children:[v.map(e=>(0,r.jsxs)("div",{className:(0,ee.cn)("flex h-10 cursor-pointer items-center rounded-lg border-[0.5px] border-components-panel-border-subtle bg-components-panel-on-panel-item-bg px-2 shadow-xs hover:border-components-panel-border hover:bg-components-panel-on-panel-item-bg-hover hover:shadow-sm",i.some(t=>t.id===e.id)&&"border-[1.5px] border-components-option-card-option-selected-border bg-state-accent-hover shadow-xs hover:border-components-option-card-option-selected-border hover:bg-state-accent-hover hover:shadow-xs",!e.embedding_available&&"hover:border-components-panel-border-subtle hover:bg-components-panel-on-panel-item-bg hover:shadow-xs"),onClick:()=>{e.embedding_available&&(j.current=!0,i.some(t=>t.id===e.id)?c(i.filter(t=>t.id!==e.id)):c([...i,e]))},children:[(0,r.jsxs)("div",{className:"mr-1 flex grow items-center overflow-hidden",children:[(0,r.jsx)("div",{className:(0,ee.cn)("mr-2",!e.embedding_available&&"opacity-30"),children:(0,r.jsx)(z.default,{size:"tiny",iconType:e.icon_info.icon_type,icon:e.icon_info.icon,background:"image"===e.icon_info.icon_type?void 0:e.icon_info.icon_background,imageUrl:"image"===e.icon_info.icon_type?e.icon_info.icon_url:void 0})}),(0,r.jsx)("div",{className:(0,ee.cn)("max-w-[200px] truncate text-[13px] font-medium text-text-secondary",!e.embedding_available&&"!max-w-[120px] opacity-30"),children:e.name}),!e.embedding_available&&(0,r.jsx)("span",{className:"ml-1 shrink-0 rounded-md border border-divider-deep px-1 text-xs font-normal leading-[18px] text-text-tertiary",children:l("unavailable",{ns:"dataset"})})]}),e.is_multimodal&&(0,r.jsx)("div",{className:"mr-1 shrink-0",children:(0,r.jsx)(Z.default,{feature:X.ModelFeatureEnum.vision})}),!!e.indexing_technique&&(0,r.jsx)(K.default,{className:"shrink-0",text:d(e.indexing_technique,e.retrieval_model_dict?.search_method)}),"external"===e.provider&&(0,r.jsx)(K.default,{className:"shrink-0",text:l("externalTag",{ns:"dataset"})})]},e.id)),p&&(0,r.jsx)(V.default,{})]})}),!m&&(0,r.jsxs)("div",{className:"mt-8 flex items-center justify-between",children:[(0,r.jsx)("div",{className:"text-sm  font-medium text-text-secondary",children:i.length>0&&`${i.length} ${l("feature.dataSet.selected",{ns:"appDebug"})}`}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)(G.default,{onClick:a,children:l("operation.cancel",{ns:"common"})}),(0,r.jsx)(G.default,{variant:"primary",onClick:()=>{o(i)},disabled:g,children:l("operation.add",{ns:"common"})})]})]})]})});e.s(["default",0,et],766293);var er=e.i(944911),ea=e.i(664826),en=e.i(70486);let es="installModal";(t={}).fromLocal="fromLocal",t.fromMarketplace="fromMarketplace",t.fromDSL="fromDSL";let eo=n.memo(e=>{let{installType:t="fromMarketplace",fromDSLPayload:a,onClose:s}=e,{t:o}=(0,U.useTranslation)(),[l,i]=(0,n.useState)("fromMarketplace"===t?er.InstallStep.readyToInstall:er.InstallStep.uploading),{modalClassName:c,foldAnimInto:d,setIsInstalling:u,handleStartToInstall:m}=(0,ea.default)(s),p=(0,n.useCallback)(()=>l===er.InstallStep.uploadFailed?o(`${es}.uploadFailed`,{ns:"plugin"}):l===er.InstallStep.installed?o(`${es}.installComplete`,{ns:"plugin"}):o(`${es}.installPlugin`,{ns:"plugin"}),[l,o]);return(0,r.jsxs)(Y.default,{isShow:!0,onClose:d,className:(0,ee.cn)(c,"shadows-shadow-xl flex min-w-[560px] flex-col items-start rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg p-0"),closable:!0,children:[(0,r.jsx)("div",{className:"flex items-start gap-2 self-stretch pb-3 pl-6 pr-14 pt-6",children:(0,r.jsx)("div",{className:"title-2xl-semi-bold self-stretch text-text-primary",children:p()})}),(0,r.jsx)(en.default,{step:l,onStepChange:i,onStartToInstall:m,setIsInstalling:u,allPlugins:a,onClose:s})]})});var el=e.i(239427);e.s(["default",0,()=>{let e=(0,el.useStore)(e=>e.dependencies),t=(0,n.useCallback)(()=>{let{setDependencies:e}=el.useStore.getState();e([])},[]);return e.length?(0,r.jsx)(eo,{fromDSLPayload:e,onClose:t}):null}],337132)},762366,e=>{"use strict";var t=e.i(563199),r=e.i(837699),a=e.i(105845),n=e.i(268255);e.i(152567);var s=e.i(408767),o=e.i(257899),l=e.i(151094),i=e.i(592366),c=e.i(561518),d=e.i(291631),u=e.i(873517),m=e.i(137667),p=e.i(421001),x=e.i(32032),f=e.i(124836);e.i(793622);var h=e.i(259509),v=e.i(21151),g=e.i(935139);let y=e=>{let{show:a,onConfirm:n,onClose:o}=e,{t:i}=(0,s.useTranslation)();return(0,t.jsxs)(v.default,{className:(0,g.cn)("w-[600px] max-w-[600px] p-8"),isShow:a,onClose:f.noop,children:[(0,t.jsx)("div",{className:"absolute right-4 top-4 cursor-pointer p-2",onClick:o,children:(0,t.jsx)(r.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})}),(0,t.jsx)("div",{className:"h-12 w-12 rounded-xl border-[0.5px] border-divider-regular bg-background-section p-3 shadow-xl",children:(0,t.jsx)(h.AlertTriangle,{className:"h-6 w-6 text-[rgb(247,144,9)]"})}),(0,t.jsx)("div",{className:"relative mt-3 text-xl font-semibold leading-[30px] text-text-primary",children:i("createTool.confirmTitle",{ns:"tools"})}),(0,t.jsx)("div",{className:"my-1 text-sm leading-5 text-text-tertiary",children:i("createTool.confirmTip",{ns:"tools"})}),(0,t.jsx)("div",{className:"flex items-center justify-end pt-6",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(l.default,{className:"mr-2",onClick:o,children:i("operation.cancel",{ns:"common"})}),(0,t.jsx)(l.default,{variant:"warning",onClick:n,children:i("operation.confirm",{ns:"common"})})]})})]})};e.i(47690);var b=e.i(490774),w=e.i(391185);let j=e=>{let{value:a,onChange:o}=e,{t:l}=(0,s.useTranslation)(),[i,c]=(0,n.useState)(!1);return(0,t.jsx)(w.PortalToFollowElem,{open:i,onOpenChange:c,placement:"bottom-start",offset:4,children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(w.PortalToFollowElemTrigger,{onClick:()=>c(e=>!e),className:"block",children:(0,t.jsxs)("div",{className:(0,g.cn)("flex h-9 min-h-[56px] cursor-pointer items-center gap-1 bg-transparent px-3 py-2 hover:bg-background-section-burn",i&&"!bg-background-section-burn hover:bg-background-section-burn"),children:[(0,t.jsx)("div",{className:(0,g.cn)("grow truncate text-[13px] leading-[18px] text-text-secondary"),children:l("llm"===a?"createTool.toolInput.methodParameter":"createTool.toolInput.methodSetting",{ns:"tools"})}),(0,t.jsx)("div",{className:"ml-1 shrink-0 text-text-secondary opacity-60",children:(0,t.jsx)(r.RiArrowDownSLine,{className:"h-4 w-4"})})]})}),(0,t.jsx)(w.PortalToFollowElemContent,{className:"z-[1040]",children:(0,t.jsx)("div",{className:"relative w-[320px] rounded-lg border-[0.5px] border-components-panel-border bg-components-panel-bg-blur shadow-lg  backdrop-blur-sm",children:(0,t.jsxs)("div",{className:"p-1",children:[(0,t.jsxs)("div",{className:"cursor-pointer rounded-lg py-2.5 pl-3 pr-2 hover:bg-components-panel-on-panel-item-bg-hover",onClick:()=>o("llm"),children:[(0,t.jsxs)("div",{className:"item-center flex gap-1",children:[(0,t.jsx)("div",{className:"h-4 w-4 shrink-0",children:"llm"===a&&(0,t.jsx)(b.Check,{className:"h-4 w-4 shrink-0 text-text-accent"})}),(0,t.jsx)("div",{className:"text-[13px] font-medium leading-[18px] text-text-secondary",children:l("createTool.toolInput.methodParameter",{ns:"tools"})})]}),(0,t.jsx)("div",{className:"pl-5 text-[13px] leading-[18px] text-text-tertiary",children:l("createTool.toolInput.methodParameterTip",{ns:"tools"})})]}),(0,t.jsxs)("div",{className:"cursor-pointer rounded-lg py-2.5 pl-3 pr-2 hover:bg-components-panel-on-panel-item-bg-hover",onClick:()=>o("form"),children:[(0,t.jsxs)("div",{className:"item-center flex gap-1",children:[(0,t.jsx)("div",{className:"h-4 w-4 shrink-0",children:"form"===a&&(0,t.jsx)(b.Check,{className:"h-4 w-4 shrink-0 text-text-accent"})}),(0,t.jsx)("div",{className:"text-[13px] font-medium leading-[18px] text-text-secondary",children:l("createTool.toolInput.methodSetting",{ns:"tools"})})]}),(0,t.jsx)("div",{className:"pl-5 text-[13px] leading-[18px] text-text-tertiary",children:l("createTool.toolInput.methodSettingTip",{ns:"tools"})})]})]})})})]})})};var _=e.i(390622);let N=new Set(Object.values(_.VarType)),k=n.memo(e=>{let{isAdd:f,payload:h,onHide:v,onRemove:b,onSave:w,onCreate:k}=e,{t:T}=(0,s.useTranslation)(),[C,A]=(0,n.useState)(!1),[S,P]=(0,n.useState)(h.icon),[E,M]=(0,n.useState)(h.label),[R,I]=(0,n.useState)(h.name),[D,L]=(0,n.useState)(h.description),[F,O]=(0,n.useState)(h.parameters),B=h.outputParameters,H=h.tool?.output_schema,W=(0,n.useMemo)(()=>Array.isArray(B)?B:H?.properties?Object.entries(H.properties).map(e=>{let[t,r]=e;return{name:t,description:r.description,type:(e=>{if(e)return N.has(e)?e:void 0})(r.type)}}):[],[B,H]),q=[{name:"text",description:T("nodes.tool.outputVars.text",{ns:"workflow"}),type:_.VarType.string,reserved:!0},{name:"files",description:T("nodes.tool.outputVars.files.title",{ns:"workflow"}),type:_.VarType.arrayFile,reserved:!0},{name:"json",description:T("nodes.tool.outputVars.json",{ns:"workflow"}),type:_.VarType.arrayObject,reserved:!0}],$=(e,t,r)=>{O((0,a.produce)(F,a=>{"description"===e?a[r].description=t:a[r].form=t}))},[U,z]=(0,n.useState)(h.labels),[K,G]=(0,n.useState)(h.privacy_policy),[V,Y]=(0,n.useState)(!1),X=e=>""===e||/^\w+$/.test(e),Z=()=>{let e="";if(E||(e=T("errorMsg.fieldRequired",{ns:"common",field:T("createTool.name",{ns:"tools"})})),R||(e=T("errorMsg.fieldRequired",{ns:"common",field:T("createTool.nameForToolCall",{ns:"tools"})})),X(R)||(e=T("createTool.nameForToolCall",{ns:"tools"})+T("createTool.nameForToolCallTip",{ns:"tools"})),e)return void m.default.notify({type:"error",message:e});let t={name:R,description:D,icon:S,label:E,parameters:F.map(e=>({name:e.name,description:e.description,form:e.form})),labels:U,privacy_policy:K};f?k?.({...t,workflow_app_id:h.workflow_app_id}):w?.({...t,workflow_tool_id:h.workflow_tool_id})};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.default,{isShow:!0,onHide:v,title:T("common.workflowAsTool",{ns:"workflow"}),panelClassName:"mt-2 !w-[640px]",maxWidthClassName:"!max-w-[640px]",height:"calc(100vh - 16px)",headerClassName:"!border-b-divider",body:(0,t.jsxs)("div",{className:"flex h-full flex-col",children:[(0,t.jsxs)("div",{className:"h-0 grow space-y-4 overflow-y-auto px-6 py-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"system-sm-medium py-2 text-text-primary",children:[T("createTool.name",{ns:"tools"})," ",(0,t.jsx)("span",{className:"ml-1 text-red-500",children:"*"})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,t.jsx)(o.default,{size:"large",onClick:()=>{A(!0)},className:"cursor-pointer",iconType:"emoji",icon:S.content,background:S.background}),(0,t.jsx)(d.default,{className:"h-10 grow",placeholder:T("createTool.toolNamePlaceHolder",{ns:"tools"}),value:E,onChange:e=>M(e.target.value)})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"system-sm-medium flex items-center py-2 text-text-primary",children:[T("createTool.nameForToolCall",{ns:"tools"})," ",(0,t.jsx)("span",{className:"ml-1 text-red-500",children:"*"}),(0,t.jsx)(p.default,{popupContent:(0,t.jsx)("div",{className:"w-[180px]",children:T("createTool.nameForToolCallPlaceHolder",{ns:"tools"})})})]}),(0,t.jsx)(d.default,{className:"h-10",placeholder:T("createTool.nameForToolCallPlaceHolder",{ns:"tools"}),value:R,onChange:e=>I(e.target.value)}),!X(R)&&(0,t.jsx)("div",{className:"text-xs leading-[18px] text-red-500",children:T("createTool.nameForToolCallTip",{ns:"tools"})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"system-sm-medium py-2 text-text-primary",children:T("createTool.description",{ns:"tools"})}),(0,t.jsx)(u.default,{placeholder:T("createTool.descriptionPlaceholder",{ns:"tools"})||"",value:D,onChange:e=>L(e.target.value)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"system-sm-medium py-2 text-text-primary",children:T("createTool.toolInput.title",{ns:"tools"})}),(0,t.jsx)("div",{className:"w-full overflow-x-auto rounded-lg border border-divider-regular",children:(0,t.jsxs)("table",{className:"w-full text-xs font-normal leading-[18px] text-text-secondary",children:[(0,t.jsx)("thead",{className:"uppercase text-text-tertiary",children:(0,t.jsxs)("tr",{className:"border-b border-divider-regular",children:[(0,t.jsx)("th",{className:"w-[156px] p-2 pl-3 font-medium",children:T("createTool.toolInput.name",{ns:"tools"})}),(0,t.jsx)("th",{className:"w-[102px] p-2 pl-3 font-medium",children:T("createTool.toolInput.method",{ns:"tools"})}),(0,t.jsx)("th",{className:"p-2 pl-3 font-medium",children:T("createTool.toolInput.description",{ns:"tools"})})]})}),(0,t.jsx)("tbody",{children:F.map((e,r)=>(0,t.jsxs)("tr",{className:"border-b border-divider-regular last:border-0",children:[(0,t.jsx)("td",{className:"max-w-[156px] p-2 pl-3",children:(0,t.jsxs)("div",{className:"text-[13px] leading-[18px]",children:[(0,t.jsxs)("div",{title:e.name,className:"flex",children:[(0,t.jsx)("span",{className:"truncate font-medium text-text-primary",children:e.name}),(0,t.jsx)("span",{className:"shrink-0 pl-1 text-xs leading-[18px] text-[#ec4a0a]",children:e.required?T("createTool.toolInput.required",{ns:"tools"}):""})]}),(0,t.jsx)("div",{className:"text-text-tertiary",children:e.type})]})}),(0,t.jsxs)("td",{children:["__image"===e.name&&(0,t.jsx)("div",{className:(0,g.cn)("flex h-9 min-h-[56px] cursor-default items-center gap-1 bg-transparent px-3 py-2"),children:(0,t.jsx)("div",{className:(0,g.cn)("grow truncate text-[13px] leading-[18px] text-text-secondary"),children:T("createTool.toolInput.methodParameter",{ns:"tools"})})}),"__image"!==e.name&&(0,t.jsx)(j,{value:e.form,onChange:e=>$("form",e,r)})]}),(0,t.jsx)("td",{className:"w-[236px] p-2 pl-3 text-text-tertiary",children:(0,t.jsx)("input",{type:"text",className:"w-full appearance-none bg-transparent text-[13px] font-normal leading-[18px] text-text-secondary caret-primary-600 outline-none placeholder:text-text-quaternary",placeholder:T("createTool.toolInput.descriptionPlaceholder",{ns:"tools"}),value:e.description,onChange:e=>$("description",e.target.value,r)})})]},r))})]})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"system-sm-medium py-2 text-text-primary",children:T("createTool.toolOutput.title",{ns:"tools"})}),(0,t.jsx)("div",{className:"w-full overflow-x-auto rounded-lg border border-divider-regular",children:(0,t.jsxs)("table",{className:"w-full text-xs font-normal leading-[18px] text-text-secondary",children:[(0,t.jsx)("thead",{className:"uppercase text-text-tertiary",children:(0,t.jsxs)("tr",{className:"border-b border-divider-regular",children:[(0,t.jsx)("th",{className:"w-[156px] p-2 pl-3 font-medium",children:T("createTool.name",{ns:"tools"})}),(0,t.jsx)("th",{className:"p-2 pl-3 font-medium",children:T("createTool.toolOutput.description",{ns:"tools"})})]})}),(0,t.jsx)("tbody",{children:[...q,...W].map((e,a)=>{let n;return(0,t.jsxs)("tr",{className:"border-b border-divider-regular last:border-0",children:[(0,t.jsx)("td",{className:"max-w-[156px] p-2 pl-3",children:(0,t.jsxs)("div",{className:"text-[13px] leading-[18px]",children:[(0,t.jsxs)("div",{title:e.name,className:"flex items-center",children:[(0,t.jsx)("span",{className:"truncate font-medium text-text-primary",children:e.name}),(0,t.jsx)("span",{className:"shrink-0 pl-1 text-xs leading-[18px] text-[#ec4a0a]",children:e.reserved?T("createTool.toolOutput.reserved",{ns:"tools"}):""}),!e.reserved&&(n=e.name,q.find(e=>e.name===n))?(0,t.jsx)(p.default,{popupContent:(0,t.jsx)("div",{className:"w-[180px]",children:T("createTool.toolOutput.reservedParameterDuplicateTip",{ns:"tools"})}),children:(0,t.jsx)(r.RiErrorWarningLine,{className:"h-3 w-3 text-text-warning-secondary"})}):null]}),(0,t.jsx)("div",{className:"text-text-tertiary",children:e.type})]})}),(0,t.jsx)("td",{className:"w-[236px] p-2 pl-3 text-text-tertiary",children:(0,t.jsx)("span",{className:"text-[13px] font-normal leading-[18px] text-text-secondary",children:e.description})})]},a)})})]})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"system-sm-medium py-2 text-text-primary",children:T("createTool.toolInput.label",{ns:"tools"})}),(0,t.jsx)(x.default,{value:U,onChange:e=>{z(e)}})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"system-sm-medium py-2 text-text-primary",children:T("createTool.privacyPolicy",{ns:"tools"})}),(0,t.jsx)(d.default,{className:"h-10",value:K,onChange:e=>G(e.target.value),placeholder:T("createTool.privacyPolicyPlaceholder",{ns:"tools"})||""})]})]}),(0,t.jsxs)("div",{className:(0,g.cn)(!f&&b?"justify-between":"justify-end","mt-2 flex shrink-0 rounded-b-[10px] border-t border-divider-regular bg-background-section-burn px-6 py-4"),children:[!f&&b&&(0,t.jsx)(l.default,{variant:"warning",onClick:b,children:T("operation.delete",{ns:"common"})}),(0,t.jsxs)("div",{className:"flex space-x-2 ",children:[(0,t.jsx)(l.default,{onClick:v,children:T("operation.cancel",{ns:"common"})}),(0,t.jsx)(l.default,{variant:"primary",onClick:()=>{f?Z():Y(!0)},children:T("operation.save",{ns:"common"})})]})]})]}),isShowMask:!0,clickOutsideNotOpen:!0}),C&&(0,t.jsx)(c.default,{onSelect:(e,t)=>{P({content:e,background:t}),A(!1)},onClose:()=>{A(!1)}}),V&&(0,t.jsx)(y,{show:V,onClose:()=>Y(!1),onConfirm:Z})]})});e.s(["default",0,k],762366)},990835,e=>{"use strict";var t=e.i(563199),r=e.i(837699),a=e.i(250755),n=e.i(268255);e.i(152567);var s=e.i(408767),o=e.i(434571),l=e.i(189299);e.i(201987);var i=e.i(207331),c=e.i(151094);e.i(14479);var d=e.i(888736),d=d,u=e.i(391185),m=e.i(84366),p=e.i(326531),x=e.i(449980),f=e.i(137667),h=e.i(836340),v=e.i(762366),g=e.i(711536),y=e.i(344600),b=e.i(154033),w=e.i(935139),j=e.i(757198);let _=e=>{let{disabled:a,published:o,detailNeedUpdate:l,workflowAppId:i,icon:d,name:u,description:m,inputs:_,outputs:N,handlePublish:k,onRefreshData:T,disabledReason:C}=e,{t:A}=(0,s.useTranslation)(),S=(0,p.useRouter)(),[P,E]=(0,n.useState)(!1),[M,R]=(0,n.useState)(!1),[I,D]=(0,n.useState)(),{isCurrentWorkspaceManager:L}=(0,g.useAppContext)(),F=(0,b.useInvalidateAllWorkflowTools)(),O=(0,n.useMemo)(()=>{if(!I)return!1;if(I.tool.parameters.length!==_?.length)return!0;for(let e of _||[]){let t=I.tool.parameters.find(t=>t.name===e.variable);if(!t||t.required!==e.required||"paragraph"===e.type&&"string"!==t.type||"text-input"===e.type&&"string"!==t.type)return!0}return!1},[I,_]),B=(0,n.useMemo)(()=>{let e=[],t=[];return o?I&&I.tool&&(e=(_||[]).map(e=>({name:e.variable,required:e.required,type:"paragraph"===e.type?"string":e.type,description:I.tool.parameters.find(t=>t.name===e.variable)?.llm_description||"",form:I.tool.parameters.find(t=>t.name===e.variable)?.form||"llm"})),t=(N||[]).map(e=>{let t=I.tool.output_schema?.properties?.[e.variable];return{name:e.variable,description:t?t.description:"",type:e.value_type}})):(e=(_||[]).map(e=>({name:e.variable,description:"",form:"llm",required:e.required,type:e.type})),t=(N||[]).map(e=>({name:e.variable,description:"",type:e.value_type}))),{icon:I?.icon||d,label:I?.label||u,name:I?.name||"",description:I?.description||m,parameters:e,outputParameters:t,labels:I?.tool?.labels||[],privacy_policy:I?.privacy_policy||"",...o?{workflow_tool_id:I?.workflow_tool_id}:{workflow_app_id:i}}},[I,o,i,d,u,m,_]),H=(0,n.useCallback)(async e=>{R(!0),D(await (0,y.fetchWorkflowToolDetailByAppID)(e)),R(!1)},[]);(0,n.useEffect)(()=>{o&&H(i)},[H,o,i]),(0,n.useEffect)(()=>{l&&H(i)},[l,H,i]);let W=async e=>{try{await (0,y.createWorkflowToolProvider)(e),F(),T?.(),H(i),f.default.notify({type:"success",message:A("api.actionSuccess",{ns:"common"})}),E(!1)}catch(e){f.default.notify({type:"error",message:e.message})}},q=async e=>{try{await k(),await (0,y.saveWorkflowToolProvider)(e),T?.(),F(),H(i),f.default.notify({type:"success",message:A("api.actionSuccess",{ns:"common"})}),E(!1)}catch(e){f.default.notify({type:"error",message:e.message})}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(j.default,{type:"horizontal",className:"h-px bg-divider-subtle"}),(!o||!M)&&(0,t.jsxs)("div",{className:(0,w.cn)("group rounded-lg bg-background-section-burn transition-colors",a||!L?"cursor-not-allowed opacity-60 shadow-xs":"cursor-pointer",!a&&!o&&L&&"hover:bg-state-accent-hover"),children:[L?(0,t.jsxs)("div",{className:"flex items-center justify-start gap-2 p-2 pl-2.5",onClick:()=>!a&&!o&&E(!0),children:[(0,t.jsx)(r.RiHammerLine,{className:(0,w.cn)("relative h-4 w-4 text-text-secondary",!a&&!o&&"group-hover:text-text-accent")}),(0,t.jsx)("div",{title:A("common.workflowAsTool",{ns:"workflow"})||"",className:(0,w.cn)("system-sm-medium shrink grow basis-0 truncate text-text-secondary",!a&&!o&&"group-hover:text-text-accent"),children:A("common.workflowAsTool",{ns:"workflow"})}),!o&&(0,t.jsx)("span",{className:"system-2xs-medium-uppercase shrink-0 rounded-[5px] border border-divider-deep bg-components-badge-bg-dimm px-1 py-0.5 text-text-tertiary",children:A("common.configureRequired",{ns:"workflow"})})]}):(0,t.jsxs)("div",{className:"flex items-center justify-start gap-2 p-2 pl-2.5",children:[(0,t.jsx)(r.RiHammerLine,{className:"h-4 w-4 text-text-tertiary"}),(0,t.jsx)("div",{title:A("common.workflowAsTool",{ns:"workflow"})||"",className:"system-sm-medium shrink grow basis-0 truncate text-text-tertiary",children:A("common.workflowAsTool",{ns:"workflow"})})]}),C&&(0,t.jsx)("div",{className:"mt-1 px-2.5 pb-2 text-xs leading-[18px] text-text-tertiary",children:C}),o&&(0,t.jsxs)("div",{className:"border-t-[0.5px] border-divider-regular px-2.5 py-2",children:[(0,t.jsxs)("div",{className:"flex justify-between gap-x-2",children:[(0,t.jsxs)(c.default,{size:"small",className:"w-[140px]",onClick:()=>E(!0),disabled:!L||a,children:[A("common.configure",{ns:"workflow"}),O&&(0,t.jsx)(h.default,{className:"ml-1",color:"yellow"})]}),(0,t.jsxs)(c.default,{size:"small",className:"w-[140px]",onClick:()=>S.push("/tools?category=workflow"),disabled:a,children:[A("common.manageInTools",{ns:"workflow"}),(0,t.jsx)(r.RiArrowRightUpLine,{className:"ml-1 h-4 w-4"})]})]}),O&&(0,t.jsx)("div",{className:"mt-1 text-xs leading-[18px] text-text-warning",children:A("common.workflowAsToolTip",{ns:"workflow"})})]})]}),o&&M&&(0,t.jsx)("div",{className:"pt-2",children:(0,t.jsx)(x.default,{type:"app"})}),P&&(0,t.jsx)(v.default,{isAdd:!o,payload:B,onHide:()=>E(!1),onCreate:W,onSave:q})]})};var N=e.i(925521),k=e.i(494268),T=e.i(142410),C=e.i(363372),A=e.i(752901),S=e.i(927897),P=e.i(972282),E=e.i(595009),M=e.i(648404),R=e.i(168014),I=e.i(421001),D=e.i(194902);e.i(905691);var L=e.i(706416),F=e.i(203742),O=e.i(225162),B=e.i(56971),H=e.i(722591);let W=e=>{let{multipleModelConfigs:a,onSelect:o}=e,{t:l}=(0,s.useTranslation)(),i=(0,O.useLanguage)(),{textGenerationModelList:d}=(0,B.useProviderContext)(),[m,p]=(0,n.useState)(!1),x=[];return a.forEach(e=>{let t=d.find(t=>t.provider===e.provider);if(t){let r=t.models.find(t=>t.model===e.model);r&&x.push({id:e.id,model:e.model,provider:e.provider,modelItem:r,providerItem:t,parameters:e.parameters})}}),(0,t.jsxs)(u.PortalToFollowElem,{open:m,onOpenChange:p,placement:"bottom-end",children:[(0,t.jsx)(u.PortalToFollowElemTrigger,{className:"w-full",onClick:()=>{x.length&&p(e=>!e)},children:(0,t.jsxs)(c.default,{variant:"primary",disabled:!x.length,className:"mt-3 w-full",children:[l("operation.applyConfig",{ns:"appDebug"}),(0,t.jsx)(r.RiArrowDownSLine,{className:"ml-0.5 h-3 w-3"})]})}),(0,t.jsx)(u.PortalToFollowElemContent,{className:"z-50 mt-1 w-[288px]",children:(0,t.jsxs)("div",{className:"rounded-lg border-[0.5px] border-components-panel-border bg-components-panel-bg p-1 shadow-lg",children:[(0,t.jsx)("div",{className:"flex h-[22px] items-center px-3 text-xs font-medium text-text-tertiary",children:l("publishAs",{ns:"appDebug"})}),x.map((e,r)=>(0,t.jsxs)("div",{className:"flex h-8 cursor-pointer items-center rounded-lg px-3 text-sm text-text-tertiary hover:bg-state-base-hover",onClick:()=>{o(e),p(!1)},children:[(0,t.jsxs)("span",{className:"min-w-[18px] italic",children:["#",r+1]}),(0,t.jsx)(H.default,{modelName:e.model,provider:e.providerItem,className:"ml-2"}),(0,t.jsx)("div",{className:"ml-1 truncate text-text-secondary",title:e.modelItem.label[i],children:e.modelItem.label[i]})]},e.id))]})})]})},q=e=>{let{icon:a,link:n,disabled:s,children:o,className:l,onClick:i,...c}=e;return(0,t.jsxs)("a",{href:s?void 0:n,target:"_blank",rel:"noreferrer",className:(0,w.cn)("flex items-center justify-start gap-2 rounded-lg bg-background-section-burn px-2.5 py-2 text-text-secondary transition-colors [&:not(:first-child)]:mt-1",s?"cursor-not-allowed opacity-30 shadow-xs":"cursor-pointer text-text-secondary hover:bg-state-accent-hover hover:text-text-accent",l),onClick:e=>{s||i?.(e)},...c,children:[(0,t.jsx)("div",{className:"relative h-4 w-4",children:a}),(0,t.jsx)("div",{className:"system-sm-medium shrink grow basis-0",children:o}),(0,t.jsx)(r.RiArrowRightUpLine,{className:"h-3.5 w-3.5"})]})},$={[A.AccessMode.ORGANIZATION]:{label:"organization",icon:r.RiBuildingLine},[A.AccessMode.SPECIFIC_GROUPS_MEMBERS]:{label:"specific",icon:r.RiLockLine},[A.AccessMode.PUBLIC]:{label:"anyone",icon:r.RiGlobalLine},[A.AccessMode.EXTERNAL_MEMBERS]:{label:"external",icon:r.RiVerifiedBadgeLine}},U=e=>{let{mode:r}=e,{t:a}=(0,s.useTranslation)();if(!r||!$[r])return null;let{icon:n,label:o}=$[r];return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n,{className:"h-4 w-4 shrink-0 text-text-secondary"}),(0,t.jsx)("div",{className:"grow truncate",children:(0,t.jsx)("span",{className:"system-sm-medium text-text-secondary",children:a(`accessControlDialog.accessItems.${o}`,{ns:"app"})})})]})},z=["ctrl","â‡§","P"],K=(0,n.memo)(e=>{let{disabled:p=!1,publishDisabled:h=!1,publishedAt:v,draftUpdatedAt:g,debugWithMultipleModel:y=!1,multipleModelConfigs:b=[],onPublish:w,onRestore:O,onToggle:B,crossAxisOffset:H=0,toolPublished:$,inputs:K,outputs:G,onRefreshData:V,workflowToolAvailable:Y=!0,missingStartNode:X=!1,hasTriggerNode:Z=!1,startNodeLimitExceeded:J=!1}=e,{t:Q}=(0,s.useTranslation)(),[ee,et]=(0,n.useState)(!1),[er,ea]=(0,n.useState)(!1),[en,es]=(0,n.useState)(!1),[eo,el]=(0,n.useState)(!0),[ei,ec]=(0,n.useState)(!1),ed=(0,l.useStore)(e=>e.appDetail),eu=(0,l.useStore)(e=>e.setAppDetail),em=(0,k.useGlobalPublicStore)(e=>e.systemFeatures),{formatTimeFromNow:ep}=(0,C.useFormatTimeFromNow)(),{app_base_url:ex="",access_token:ef=""}=ed?.site??{},eh=ed?.mode!==M.AppModeEnum.COMPLETION&&ed?.mode!==M.AppModeEnum.WORKFLOW?M.AppModeEnum.CHAT:ed.mode,ev=`${ex}${R.basePath}/${eh}/${ef}`,eg=[M.AppModeEnum.CHAT,M.AppModeEnum.AGENT_CHAT,M.AppModeEnum.COMPLETION].includes(ed?.mode||M.AppModeEnum.CHAT),{data:ey,isLoading:eb,refetch:ew}=(0,S.useGetUserCanAccessApp)({appId:ed?.id,enabled:!1}),{data:ej,isLoading:e_}=(0,S.useAppWhiteListSubjects)(ed?.id,er&&em.webapp_auth.enabled&&ed?.access_mode===A.AccessMode.SPECIFIC_GROUPS_MEMBERS),eN=(0,T.useAsyncWindowOpen)(),ek=(0,n.useMemo)(()=>em.webapp_auth.enabled&&ed&&ed.access_mode!==A.AccessMode.EXTERNAL_MEMBERS&&!ey?.result,[em,ed,ey]),eT=(0,n.useMemo)(()=>!v||X||ek,[v,X,ek]),eC=(0,n.useMemo)(()=>v?X?Q("noUserInputNode",{ns:"app"}):ek?Q("noAccessPermission",{ns:"app"}):void 0:Q("notPublishedYet",{ns:"app"}),[X,ek,v]);(0,n.useEffect)(()=>{em.webapp_auth.enabled&&er&&ed&&ew()},[er,ed,ew,em]),(0,n.useEffect)(()=>{ed&&ej&&ed.access_mode===A.AccessMode.SPECIFIC_GROUPS_MEMBERS&&ej.groups?.length===0&&ej.members?.length===0?el(!1):el(!0)},[ej,ed]);let eA=(0,n.useCallback)(async e=>{try{await w?.(e),et(!0),(0,i.trackEvent)("app_published_time",{action_mode:"app",app_id:ed?.id,app_name:ed?.name})}catch{et(!1)}},[ed,w]),eS=(0,n.useCallback)(async()=>{try{await O?.(),ea(!1)}catch{}},[O]),eP=(0,n.useCallback)(()=>{let e=!er;p?ea(!1):(B?.(e),ea(e),e&&et(!1))},[p,B,er]),eE=(0,n.useCallback)(async()=>{await eN(async()=>{if(!ed?.id)throw Error("App not found");let{installed_apps:e}=await (0,E.fetchInstalledAppList)(ed?.id)||{};if(e?.length>0)return`${R.basePath}/explore/installed/${e[0].id}`;throw Error("No app found in Explore")},{onError:e=>{f.default.notify({type:"error",message:`${e.message||e}`})}})},[ed?.id,eN]),eM=(0,n.useCallback)(async()=>{if(ed)try{let e=await (0,P.fetchAppDetailDirect)({url:"/apps",id:ed.id});eu(e)}finally{es(!1)}},[ed,eu]);(0,a.useKeyPress)(`${(0,L.getKeyboardKeyCodeBySystem)("ctrl")}.shift.p`,e=>{e.preventDefault(),h||ee||eA()},{exactMatch:!0,useCapture:!0});let eR=!v||!Y,eI=eR?Q("common.workflowAsToolDisabledHint",{ns:"workflow"}):void 0,eD=(0,n.useMemo)(()=>({background:"linear-gradient(97deg, var(--components-input-border-active-prompt-1, rgba(11, 165, 236, 0.95)) -3.64%, var(--components-input-border-active-prompt-2, rgba(21, 90, 239, 0.95)) 45.14%)",WebkitBackgroundClip:"text",backgroundClip:"text",WebkitTextFillColor:"transparent"}),[]);return(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(u.PortalToFollowElem,{open:er,onOpenChange:ea,placement:"bottom-end",offset:{mainAxis:4,crossAxis:H},children:[(0,t.jsx)(u.PortalToFollowElemTrigger,{onClick:eP,children:(0,t.jsxs)(c.default,{variant:"primary",className:"py-2 pl-3 pr-2",disabled:p,children:[Q("common.publish",{ns:"workflow"}),(0,t.jsx)(r.RiArrowDownSLine,{className:"h-4 w-4 text-components-button-primary-text"})]})}),(0,t.jsx)(u.PortalToFollowElemContent,{className:"z-[11]",children:(0,t.jsxs)("div",{className:"w-[320px] rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-xl shadow-shadow-shadow-5",children:[(0,t.jsxs)("div",{className:"p-4 pt-3",children:[(0,t.jsx)("div",{className:"system-xs-medium-uppercase flex h-6 items-center text-text-tertiary",children:v?Q("common.latestPublished",{ns:"workflow"}):Q("common.currentDraftUnpublished",{ns:"workflow"})}),v?(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"system-sm-medium flex items-center text-text-secondary",children:[Q("common.publishedAt",{ns:"workflow"})," ",ep(v)]}),eg&&(0,t.jsx)(c.default,{variant:"secondary-accent",size:"small",onClick:eS,disabled:ee,children:Q("common.restore",{ns:"workflow"})})]}):(0,t.jsxs)("div",{className:"system-sm-medium flex items-center text-text-secondary",children:[Q("common.autoSaved",{ns:"workflow"})," ","Â·",!!g&&ep(g)]}),y?(0,t.jsx)(W,{multipleModelConfigs:b,onSelect:e=>eA(e)}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.default,{variant:"primary",className:"mt-3 w-full",onClick:()=>eA(),disabled:h||ee,children:ee?Q("common.published",{ns:"workflow"}):(0,t.jsxs)("div",{className:"flex gap-1",children:[(0,t.jsx)("span",{children:Q("common.publishUpdate",{ns:"workflow"})}),(0,t.jsx)(D.default,{keys:z,bgColor:"white"})]})}),!!J&&(0,t.jsxs)("div",{className:"mt-3 flex flex-col items-stretch",children:[(0,t.jsxs)("p",{className:"text-sm font-semibold leading-5 text-transparent",style:eD,children:[(0,t.jsx)("span",{className:"block",children:Q("publishLimit.startNodeTitlePrefix",{ns:"workflow"})}),(0,t.jsx)("span",{className:"block",children:Q("publishLimit.startNodeTitleSuffix",{ns:"workflow"})})]}),(0,t.jsx)("p",{className:"mt-1 text-xs leading-4 text-text-secondary",children:Q("publishLimit.startNodeDesc",{ns:"workflow"})}),(0,t.jsx)(m.default,{isShort:!0,className:"mb-[12px] mt-[9px] h-[32px] w-[93px] self-start"})]})]})]}),em.webapp_auth.enabled&&(eb||e_)?(0,t.jsx)("div",{className:"py-2",children:(0,t.jsx)(x.default,{})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(j.default,{className:"my-0"}),em.webapp_auth.enabled&&(0,t.jsxs)("div",{className:"p-4 pt-3",children:[(0,t.jsx)("div",{className:"flex h-6 items-center",children:(0,t.jsx)("p",{className:"system-xs-medium text-text-tertiary",children:Q("publishApp.title",{ns:"app"})})}),(0,t.jsxs)("div",{className:"flex h-8 cursor-pointer items-center gap-x-0.5  rounded-lg bg-components-input-bg-normal py-1 pl-2.5 pr-2 hover:bg-primary-50 hover:text-text-accent",onClick:()=>{es(!0)},children:[(0,t.jsx)("div",{className:"flex grow items-center gap-x-1.5 overflow-hidden pr-1",children:(0,t.jsx)(U,{mode:ed?.access_mode})}),!eo&&(0,t.jsx)("p",{className:"system-xs-regular shrink-0 text-text-tertiary",children:Q("publishApp.notSet",{ns:"app"})}),(0,t.jsx)("div",{className:"flex h-4 w-4 shrink-0 items-center justify-center",children:(0,t.jsx)(r.RiArrowRightSLine,{className:"h-4 w-4 text-text-quaternary"})})]}),!eo&&(0,t.jsx)("p",{className:"system-xs-regular mt-1 text-text-warning",children:Q("publishApp.notSetDesc",{ns:"app"})})]}),!Z&&(0,t.jsxs)("div",{className:"flex flex-col gap-y-1 border-t-[0.5px] border-t-divider-regular p-4 pt-3",children:[(0,t.jsx)(I.default,{triggerClassName:"flex",disabled:!eT,popupContent:eC,asChild:!1,children:(0,t.jsx)(q,{className:"flex-1",disabled:eT,link:ev,icon:(0,t.jsx)(r.RiPlayCircleLine,{className:"h-4 w-4"}),children:Q("common.runApp",{ns:"workflow"})})}),ed?.mode===M.AppModeEnum.WORKFLOW||ed?.mode===M.AppModeEnum.COMPLETION?(0,t.jsx)(I.default,{triggerClassName:"flex",disabled:!eT,popupContent:eC,asChild:!1,children:(0,t.jsx)(q,{className:"flex-1",disabled:eT,link:`${ev}${ev.includes("?")?"&":"?"}mode=batch`,icon:(0,t.jsx)(r.RiPlayList2Line,{className:"h-4 w-4"}),children:Q("common.batchRunApp",{ns:"workflow"})})}):(0,t.jsx)(q,{onClick:()=>{ec(!0),eP()},disabled:!v,icon:(0,t.jsx)(d.default,{className:"h-4 w-4"}),children:Q("common.embedIntoSite",{ns:"workflow"})}),(0,t.jsx)(I.default,{triggerClassName:"flex",disabled:!eT,popupContent:eC,asChild:!1,children:(0,t.jsx)(q,{className:"flex-1",onClick:()=>{v&&eE()},disabled:eT,icon:(0,t.jsx)(r.RiPlanetLine,{className:"h-4 w-4"}),children:Q("common.openInExplore",{ns:"workflow"})})}),(0,t.jsx)(I.default,{triggerClassName:"flex",disabled:!!v&&!X,popupContent:v?Q("noUserInputNode",{ns:"app"}):Q("notPublishedYet",{ns:"app"}),asChild:!1,children:(0,t.jsx)(q,{className:"flex-1",disabled:!v||X,link:"./develop",icon:(0,t.jsx)(r.RiTerminalBoxLine,{className:"h-4 w-4"}),children:Q("common.accessAPIReference",{ns:"workflow"})})}),ed?.mode===M.AppModeEnum.WORKFLOW&&(0,t.jsx)(_,{disabled:eR,published:!!$,detailNeedUpdate:!!$&&ee,workflowAppId:ed?.id,icon:{content:("image"===ed.icon_type?"ðŸ¤–":ed?.icon)||"ðŸ¤–",background:("image"===ed.icon_type?N.appDefaultIconBackground:ed?.icon_background)||N.appDefaultIconBackground},name:ed?.name,description:ed?.description,inputs:K,outputs:G,handlePublish:eA,onRefreshData:V,disabledReason:eI})]})]})]})}),(0,t.jsx)(o.default,{siteInfo:ed?.site,isShow:ei,onClose:()=>ec(!1),appBaseUrl:ex,accessToken:ef}),en&&(0,t.jsx)(F.default,{app:ed,onConfirm:eM,onClose:()=>{es(!1)}})]})})});e.s(["default",0,K],990835)}]);
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,243792,e=>{"use strict";var t=e.i(563199),s=e.i(837699),a=e.i(268255);e.i(152567);var r=e.i(408767),n=e.i(654313),l=e.i(151094),i=e.i(547105),c=e.i(391185),o=e.i(137667),d=e.i(421001),x=e.i(211857),m=e.i(291631),p=e.i(683257),u=e.i(935139);let f=a.memo(e=>{let{className:a,itemClassName:n,fieldLabelClassName:l,value:i,onChange:c,formSchemas:o,inputClassName:d}=e,{t:x,i18n:f}=(0,r.useTranslation)(),h=(0,p.useDocLink)();return(0,t.jsx)("form",{className:(0,u.cn)("flex flex-col items-start justify-center gap-4 self-stretch",a),children:o.map(e=>(e=>{let{variable:a,type:r,label:o,required:p}=e,y="name"===a?i[a]:i.settings[a]||"";return(0,t.jsxs)("div",{className:(0,u.cn)(n,"flex flex-col items-start gap-1 self-stretch"),children:[(0,t.jsxs)("div",{className:"flex w-full items-center justify-between",children:[(0,t.jsxs)("label",{className:(0,u.cn)(l,"system-sm-semibold text-text-secondary"),htmlFor:a,children:[o[f.language]||o.en_US,p&&(0,t.jsx)("span",{className:"ml-1 text-red-500",children:"*"})]}),"endpoint"===a&&(0,t.jsxs)("a",{href:h("/use-dify/knowledge/external-knowledge-api")||"/",target:"_blank",rel:"noopener noreferrer",className:"body-xs-regular flex items-center text-text-accent",children:[(0,t.jsx)(s.RiBookOpenLine,{className:"mr-1 h-3 w-3 text-text-accent"}),x("externalAPIPanelDocumentation",{ns:"dataset"})]})]}),(0,t.jsx)(m.default,{type:"secret"===r?"password":"text",id:a,name:a,value:y,onChange:e=>{var t;return t=e.target.value,void("name"===a?c({...i,[a]:t}):c({...i,settings:{...i.settings,[a]:t}}))},required:p,className:(0,u.cn)(d)})]},a)})(e))})});f.displayName="Form";let h=[{variable:"name",type:"text",label:{en_US:"Name"},required:!0},{variable:"endpoint",type:"text",label:{en_US:"API Endpoint"},required:!0},{variable:"api_key",type:"secret",label:{en_US:"API Key"},required:!0}],y=(0,a.memo)(e=>{let{data:m,onSave:p,onCancel:u,datasetBindings:y,isEditMode:g,onEdit:j}=e,{t:b}=(0,r.useTranslation)(),{notify:v}=(0,o.useToastContext)(),[N,P]=(0,a.useState)(!1),[w,A]=(0,a.useState)(!1),[k,I]=(0,a.useState)({name:"",settings:{endpoint:"",api_key:""}});(0,a.useEffect)(()=>{g&&m&&I(m)},[g,m]);let C=Object.values(k).some(e=>"string"==typeof e?""===e.trim():Object.values(e).some(e=>""===e.trim())),E=async()=>{if(k&&k.settings.api_key&&k.settings.api_key?.length<5){v({type:"error",message:b("apiBasedExtension.modal.apiKey.lengthError",{ns:"common"})}),P(!1);return}try{if(P(!0),g&&j)await j({...k,settings:{...k.settings,api_key:k.settings.api_key?"[__HIDDEN__]":k.settings.api_key}}),v({type:"success",message:"External API updated successfully"});else{let e=await (0,x.createExternalAPI)({body:k});e&&e.id&&(v({type:"success",message:"External API saved successfully"}),p(e))}u()}catch(e){console.error("Error saving/updating external API:",e),v({type:"error",message:"Failed to save/update External API"})}finally{P(!1)}};return(0,t.jsx)(c.PortalToFollowElem,{open:!0,children:(0,t.jsx)(c.PortalToFollowElemContent,{className:"z-[60] h-full w-full",children:(0,t.jsxs)("div",{className:"fixed inset-0 flex items-center justify-center bg-black/[.25]",children:[(0,t.jsxs)("div",{className:"shadows-shadow-xl relative flex w-[480px] flex-col items-start rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg",children:[(0,t.jsxs)("div",{className:"flex flex-col items-start gap-2 self-stretch pb-3 pl-6 pr-14 pt-6",children:[(0,t.jsx)("div",{className:"title-2xl-semi-bold grow self-stretch text-text-primary",children:g?b("editExternalAPIFormTitle",{ns:"dataset"}):b("createExternalAPI",{ns:"dataset"})}),g&&(y?.length??0)>0&&(0,t.jsxs)("div",{className:"system-xs-regular flex items-center text-text-tertiary",children:[b("editExternalAPIFormWarning.front",{ns:"dataset"}),(0,t.jsxs)("span",{className:"flex cursor-pointer items-center text-text-accent",children:[" ",y?.length," ",b("editExternalAPIFormWarning.end",{ns:"dataset"})," ",(0,t.jsx)(d.default,{popupClassName:"flex items-center self-stretch w-[320px]",popupContent:(0,t.jsxs)("div",{className:"p-1",children:[(0,t.jsx)("div",{className:"flex items-start self-stretch pb-0.5 pl-2 pr-3 pt-1",children:(0,t.jsx)("div",{className:"system-xs-medium-uppercase text-text-tertiary",children:`${y?.length} ${b("editExternalAPITooltipTitle",{ns:"dataset"})}`})}),y?.map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-1 self-stretch px-2 py-1",children:[(0,t.jsx)(s.RiBook2Line,{className:"h-4 w-4 text-text-secondary"}),(0,t.jsx)("div",{className:"system-sm-medium text-text-secondary",children:e.name})]},e.id))]}),asChild:!1,position:"bottom",children:(0,t.jsx)(s.RiInformation2Line,{className:"h-3.5 w-3.5"})})]})]})]}),(0,t.jsx)(n.default,{className:"absolute right-5 top-5",onClick:u,children:(0,t.jsx)(s.RiCloseLine,{className:"h-[18px] w-[18px] shrink-0 text-text-tertiary"})}),(0,t.jsx)(f,{value:k,onChange:e=>{I(e)},formSchemas:h,className:"flex flex-col items-start justify-center gap-4 self-stretch px-6 py-3"}),(0,t.jsxs)("div",{className:"flex items-center justify-end gap-2 self-stretch p-6 pt-5",children:[(0,t.jsx)(l.default,{type:"button",variant:"secondary",onClick:u,children:b("externalAPIForm.cancel",{ns:"dataset"})}),(0,t.jsx)(l.default,{type:"submit",variant:"primary",onClick:()=>{g&&(y?.length??0)>0?A(!0):g&&j?j(k):E()},disabled:C||N,children:b("externalAPIForm.save",{ns:"dataset"})})]}),(0,t.jsxs)("div",{className:"system-xs-regular flex items-center justify-center gap-1 self-stretch rounded-b-2xl border-t-[0.5px] border-divider-subtle bg-background-soft px-2 py-3 text-text-tertiary",children:[(0,t.jsx)(s.RiLock2Fill,{className:"h-3 w-3 text-text-quaternary"}),b("externalAPIForm.encrypted.front",{ns:"dataset"}),(0,t.jsx)("a",{className:"text-text-accent",target:"_blank",rel:"noopener noreferrer",href:"https://pycryptodome.readthedocs.io/en/latest/src/cipher/oaep.html",children:"PKCS1_OAEP"}),b("externalAPIForm.encrypted.end",{ns:"dataset"})]})]}),w&&(y?.length??0)>0&&(0,t.jsx)(i.default,{isShow:w,type:"warning",title:"Warning",content:`${b("editExternalAPIConfirmWarningContent.front",{ns:"dataset"})} ${y?.length} ${b("editExternalAPIConfirmWarningContent.end",{ns:"dataset"})}`,onCancel:()=>A(!1),onConfirm:E})]})})})});e.s(["default",0,y],243792)},955852,e=>{e.n(e.i(243792))}]);
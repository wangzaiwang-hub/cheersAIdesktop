(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,112262,e=>{"use strict";var a=e.i(563199),s=e.i(837699),t=e.i(268255);e.i(152567);var l=e.i(408767),i=e.i(192447),r=e.i(151094),n=e.i(757198),d=e.i(421001);e.i(160186);var c=e.i(621830);e.i(845780);var o=e.i(604208);e.i(275225);var u=e.i(705405),p=e.i(390622),x=e.i(935139),m=e.i(654313),h=e.i(370869),b=e.i(346563),f=e.i(858871),g=e.i(726371),j=e.i(83278);e.i(661734);var y=e.i(505816),N=e.i(111378);let v=t.memo(e=>{let{readonly:i,payload:r,index:n,onClickEdit:d,onRemove:c}=e,{t:o}=(0,l.useTranslation)(),u=(0,t.useRef)(null),p=(0,g.useHover)(u),h=(0,t.useCallback)(e=>{e.stopPropagation(),i||d(r.variable)},[d,r.variable,i]),b=(0,t.useCallback)(e=>{e.stopPropagation(),i||c(n)},[n,c,i]);return(0,a.jsxs)("div",{ref:u,className:(0,x.cn)("handle flex h-8 cursor-pointer items-center justify-between gap-x-1 rounded-lg border border-components-panel-border-subtle bg-components-panel-on-panel-item-bg py-1 pl-2 shadow-xs hover:shadow-sm",p&&!i?"cursor-all-scroll pr-1":"pr-2.5",i&&"cursor-default"),children:[(0,a.jsxs)("div",{className:"flex grow basis-0 items-center gap-x-1 overflow-hidden",children:[p&&!i?(0,a.jsx)(s.RiDraggable,{className:"size-4 shrink-0 text-text-quaternary"}):(0,a.jsx)(y.InputField,{className:"size-4 shrink-0 text-text-accent"}),(0,a.jsx)("div",{title:r.variable,className:"system-sm-medium max-w-[130px] shrink-0 truncate text-text-secondary",children:r.variable}),r.label&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"system-xs-regular shrink-0 text-text-quaternary",children:"Â·"}),(0,a.jsx)("div",{title:r.label,className:"system-xs-medium grow truncate text-text-tertiary",children:r.label})]})]}),p&&!i?(0,a.jsxs)("div",{className:"flex shrink-0 items-center gap-x-1",children:[(0,a.jsx)(m.default,{className:"mr-1",onClick:h,children:(0,a.jsx)(s.RiEditLine,{className:"size-4 text-text-tertiary"})}),(0,a.jsx)(m.default,{onClick:b,children:(0,a.jsx)(s.RiDeleteBinLine,{className:"size-4 text-text-tertiary group-hover:text-text-destructive"})})]}):(0,a.jsxs)("div",{className:"flex shrink-0 items-center gap-x-2",children:[r.required&&(0,a.jsx)(j.default,{children:o("nodes.start.required",{ns:"workflow"})}),(0,a.jsx)(N.default,{type:r.type,className:"h-3 w-3 text-text-tertiary"})]})]})}),C=(0,t.memo)(e=>{let{className:s,inputFields:l,onListSortChange:i,onRemoveField:r,onEditField:n,readonly:d}=e,c=(0,t.useMemo)(()=>l.map(e=>({id:e.variable,chosen:!1,selected:!1,...e})),[l]),o=(0,t.useCallback)(e=>{(0,b.isEqual)(e,c)||i(e)},[c,i]);return(0,a.jsx)(f.ReactSortable,{className:(0,x.cn)(s),list:c,setList:o,handle:".handle",ghostClass:"opacity-50",animation:150,disabled:d,children:l?.map((e,s)=>(0,a.jsx)(v,{index:s,readonly:d,payload:e,onRemove:r,onClickEdit:n},s))})});var k=e.i(417944),w=e.i(105845),P=e.i(137667),F=e.i(276925),R=e.i(963855);let S=t.memo(e=>{let{nodeId:r,LabelRightContent:n,inputFields:d,handleInputFieldsChange:o,readonly:u,labelClassName:b,allVariableNames:f}=e,{inputFields:g,handleListSortChange:j,handleRemoveField:y,handleOpenInputFieldEditor:N,isShowRemoveVarConfirm:v,hideRemoveVarConfirm:S,onRemoveVarConfirm:I}=(e=>{let a,s,r,n,{initialInputFields:d,onInputFieldsChange:o,nodeId:u,allVariableNames:x}=e,{t:m}=(0,l.useTranslation)(),{toggleInputFieldEditPanel:h}=(0,c.useInputFieldPanel)(),[b,f]=(0,t.useState)(d),g=(0,t.useRef)(b),[j,y]=(0,t.useState)([]),[N,v]=(0,t.useState)(0),{handleInputVarRename:C,isVarUsedInNodes:S,removeUsedVarInNodes:I}=(a=(0,i.useStoreApi)(),s=(0,t.useCallback)(()=>{let{getNodes:e}=a.getState();return e().filter(e=>e.data.type===p.BlockEnum.DataSource)},[a]),r=(0,t.useCallback)(e=>{let{getNodes:t,edges:l}=a.getState(),r=t(),n=[],d=(e,a)=>{if(e){let s=(0,i.getOutgoers)(e,r,l);s.length&&s.forEach(e=>{a(e),d(e,a)})}};if("shared"===e){let e=s();if(0===e.length)return[];n.push(...e),e.forEach(e=>{d(e,e=>{n.push(e)})})}else{let a=r.find(a=>a.id===e);if(!a)return[];n.push(a),d(a,e=>{n.push(e)})}return(0,F.uniqBy)(n,"id")},[s,a]),n=(0,t.useCallback)(e=>{let a=r(e[1]);return(0,R.findUsedVarNodes)(e,a).length>0},[r]),{handleInputVarRename:(0,t.useCallback)((e,s,t)=>{let{getNodes:l,setNodes:i}=a.getState(),n=r(e),d=(0,R.findUsedVarNodes)(s,n);d.length>0&&i(l().map(e=>d.find(a=>a.id===e.id)?(0,R.updateNodeVars)(e,s,t):e))},[r,a]),isVarUsedInNodes:n,removeUsedVarInNodes:(0,t.useCallback)(e=>{let s=e[1],{getNodes:t,setNodes:l}=a.getState(),i=r(s),n=(0,R.findUsedVarNodes)(e,i);n.length>0&&l(t().map(a=>n.find(e=>e.id===a.id)?(0,R.updateNodeVars)(a,e,[]):a))},[r,a])}),[E,{setTrue:D,setFalse:V}]=(0,k.useBoolean)(!1),z=(0,t.useCallback)(e=>{f(e),g.current=e,o(e)},[o]),T=(0,t.useCallback)(e=>{z(e.map(e=>{let{id:a,chosen:s,selected:t,...l}=e;return l}))},[z]),L=(0,t.useRef)(-1),q=(0,t.useCallback)(()=>{h?.(null),L.current=-1},[h]),_=(0,t.useCallback)(e=>{let a=g.current[e];if(S(["rag",u,a.variable||""])){D(),y(["rag",u,a.variable||""]),v(e);return}z(g.current.filter((a,s)=>s!==e))},[z,S,u,D]),B=(0,t.useCallback)(()=>{z(g.current.filter((e,a)=>a!==N)),I(j),V()},[N,z,I,j,V]),O=(0,t.useCallback)((e,a)=>{x.some(a=>a===e.variable&&a!==g.current[L.current]?.variable)?P.default.notify({type:"error",message:m("inputFieldPanel.error.variableDuplicate",{ns:"datasetPipeline"})}):(z((0,w.produce)(g.current,a=>{let s=L.current;-1===s?a.push(e):a[s]=e})),a?.type===p.ChangeType.changeVarName&&C(u,["rag",u,a.payload?.beforeKey||""],["rag",u,a.payload?.afterKey||""]),q())},[x,q,z,C,u,m]);return{inputFields:b,handleListSortChange:T,handleRemoveField:_,handleOpenInputFieldEditor:(0,t.useCallback)(e=>{let a=g.current.findIndex(a=>a.variable===e);L.current=a,h?.({onClose:q,onSubmit:O,initialData:g.current[a]})},[]),isShowRemoveVarConfirm:E,hideRemoveVarConfirm:V,onRemoveVarConfirm:B}})({initialInputFields:d,onInputFieldsChange:(0,t.useCallback)(e=>{o(r,e)},[o,r]),nodeId:r,allVariableNames:f});return(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("div",{className:(0,x.cn)("flex items-center gap-x-2 px-4",b),children:[(0,a.jsx)("div",{className:"grow",children:n}),(0,a.jsx)(m.default,{"data-testid":"field-list-add-btn",onClick:()=>N(),disabled:u,className:(0,x.cn)(u&&"cursor-not-allowed"),children:(0,a.jsx)(s.RiAddLine,{className:"h-4 w-4 text-text-tertiary"})})]}),(0,a.jsx)(C,{className:"flex flex-col gap-y-1 px-4 pb-1",inputFields:g,onEditField:N,onRemoveField:y,onListSortChange:j,readonly:u}),(0,a.jsx)(h.default,{isShow:v,onCancel:S,onConfirm:I})]})}),I=t.memo(()=>(0,a.jsxs)("div",{className:"flex shrink-0 items-center justify-center gap-x-2 py-4 text-text-quaternary",children:[(0,a.jsx)(s.RiDragDropLine,{className:"size-4"}),(0,a.jsx)("span",{className:"system-xs-regular",children:"Drag to adjust grouping"})]}));var E=e.i(120219),D=e.i(95131);let V=t.memo(e=>{let{nodeData:s}=e,t=(0,D.useToolIcon)(s);return(0,a.jsxs)("div",{className:"flex items-center gap-x-1.5",children:[(0,a.jsx)("div",{className:"flex size-5 items-center justify-center rounded-md border-[0.5px] border-components-panel-border-subtle bg-background-default",children:(0,a.jsx)(E.default,{className:"size-3.5",type:p.BlockEnum.DataSource,toolIcon:t})}),(0,a.jsx)("span",{className:"system-sm-medium text-text-secondary",children:s.title})]})}),z=t.memo(()=>{let{t:e}=(0,l.useTranslation)();return(0,a.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,a.jsx)("span",{className:"system-sm-semibold-uppercase text-text-secondary",children:e("inputFieldPanel.globalInputs.title",{ns:"datasetPipeline"})}),(0,a.jsx)(d.default,{popupContent:e("inputFieldPanel.globalInputs.tooltip",{ns:"datasetPipeline"}),popupClassName:"w-[240px]"})]})}),T=(0,t.memo)(()=>{let e,{t:m}=(0,l.useTranslation)(),h=(0,i.useNodes)(),{closeAllInputFieldPanels:b,toggleInputFieldPreviewPanel:f,isPreviewing:g,isEditing:j}=(0,c.useInputFieldPanel)(),y=(0,u.useStore)(e=>e.ragPipelineVariables),N=(0,u.useStore)(e=>e.setRagPipelineVariables),v=(0,t.useRef)((e={},y?.forEach(a=>{let{belong_to_node_id:s,...t}=a;e[s]?e[s].push(t):e[s]=[t]}),e)),{handleSyncWorkflowDraft:C}=(0,o.useNodesSyncDraft)(),k=(0,t.useMemo)(()=>{let e={};return h.filter(e=>e.data.type===p.BlockEnum.DataSource).forEach(a=>{let{id:s,data:t}=a;e[s]=t}),e},[h]),w=(0,t.useCallback)(async(e,a)=>{v.current[e]=a;let s=[],t=[];Object.keys(v.current).forEach(e=>{v.current[e].forEach(a=>{"shared"===e?t.push({...a,belong_to_node_id:e}):s.push({...a,belong_to_node_id:e})})});let l=[...s,...t];N?.(l),C()},[N,C]),P=(0,t.useCallback)(()=>{b()},[b]),F=(0,t.useCallback)(()=>{f()},[f]),R=(0,t.useMemo)(()=>y?.map(e=>e.variable)||[],[y]);return(0,a.jsxs)("div",{className:"mr-1 flex h-full w-[400px] flex-col rounded-2xl border-y-[0.5px] border-l-[0.5px] border-components-panel-border bg-components-panel-bg-alt shadow-xl shadow-shadow-shadow-5",children:[(0,a.jsxs)("div",{className:"flex shrink-0 items-center p-4 pb-0",children:[(0,a.jsx)("div",{className:"system-xl-semibold grow text-text-primary",children:m("inputFieldPanel.title",{ns:"datasetPipeline"})}),(0,a.jsxs)(r.default,{variant:"ghost",size:"small",className:(0,x.cn)("shrink-0 gap-x-px px-1.5",g&&"bg-state-accent-active text-text-accent"),onClick:F,disabled:j,children:[(0,a.jsx)(s.RiEyeLine,{className:"size-3.5"}),(0,a.jsx)("span",{className:"px-[3px]",children:m("operations.preview",{ns:"datasetPipeline"})})]}),(0,a.jsx)(n.default,{type:"vertical",className:"mx-1 h-3"}),(0,a.jsx)("button",{type:"button",className:"flex size-6 shrink-0 items-center justify-center p-0.5",onClick:P,children:(0,a.jsx)(s.RiCloseLine,{className:"size-4 text-text-tertiary"})})]}),(0,a.jsx)("div",{className:"system-sm-regular shrink-0 px-4 pb-2 pt-1 text-text-tertiary",children:m("inputFieldPanel.description",{ns:"datasetPipeline"})}),(0,a.jsxs)("div",{className:"flex grow flex-col overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex h-6 items-center gap-x-0.5 px-4 pt-2",children:[(0,a.jsx)("span",{className:"system-sm-semibold-uppercase text-text-secondary",children:m("inputFieldPanel.uniqueInputs.title",{ns:"datasetPipeline"})}),(0,a.jsx)(d.default,{popupContent:m("inputFieldPanel.uniqueInputs.tooltip",{ns:"datasetPipeline"}),popupClassName:"max-w-[240px]"})]}),(0,a.jsx)("div",{className:"flex flex-col gap-y-1 py-1",children:Object.keys(k).map(e=>{let s=v.current[e]||[];return(0,a.jsx)(S,{nodeId:e,LabelRightContent:(0,a.jsx)(V,{nodeData:k[e]}),inputFields:s,readonly:g||j,labelClassName:"pt-1 pb-1",handleInputFieldsChange:w,allVariableNames:R},e)})}),(0,a.jsx)(S,{nodeId:"shared",LabelRightContent:(0,a.jsx)(z,{}),inputFields:v.current.shared||[],readonly:g||j,labelClassName:"pt-2 pb-1",handleInputFieldsChange:w,allVariableNames:R})]}),(0,a.jsx)(I,{})]})});e.s(["default",0,T],112262)},283916,e=>{e.n(e.i(112262))}]);
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,329103,e=>{"use strict";var t=e.i(563199),s=e.i(417944),a=e.i(268255);e.i(152567);var l=e.i(408767),n=e.i(339548),i=e.i(521632),r=e.i(423571),o=e.i(449980),d=e.i(888972),c=e.i(607519),x=e.i(413159),m=e.i(271743),u=e.i(225244),p=e.i(875037);e.i(562572);var h=e.i(367916);e.i(722384);let g="hit-testing";var b=e.i(935139),f=e.i(948105),j=e.i(837699);let v=a.memo(()=>{let{t:e}=(0,l.useTranslation)();return(0,t.jsxs)("div",{className:"rounded-2xl bg-workflow-process-bg p-5",children:[(0,t.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-[10px] border-[0.5px] border-components-card-border bg-components-card-bg p-1 shadow-lg shadow-shadow-shadow-5 backdrop-blur-[5px]",children:(0,t.jsx)(j.RiHistoryLine,{className:"h-5 w-5 text-text-tertiary"})}),(0,t.jsx)("div",{className:"my-2 text-[13px] font-medium leading-4 text-text-tertiary",children:e("noRecentTip",{ns:"datasetHitTesting"})})]})});var y=e.i(658547),N=e.i(503144),w=e.i(151094),k=e.i(317522),_=e.i(759246),T=e.i(179356),C=e.i(421001),S=e.i(951403);let E=a.memo(()=>{let{t:e}=(0,l.useTranslation)(),s=(0,T.useFileStoreWithSelector)(e=>e.files),{fileUploadConfig:a,uploaderRef:n,fileChangeHandle:i,selectHandle:r}=(0,_.useUpload)();return(0,t.jsxs)("div",{children:[(0,t.jsx)("input",{ref:n,id:"fileUploader",className:"hidden",type:"file",multiple:!0,accept:S.ACCEPT_TYPES.map(e=>`.${e}`).join(","),onChange:i}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:(0,t.jsx)(C.default,{popupContent:e("imageUploader.tooltip",{ns:"datasetHitTesting",size:a.imageFileSizeLimit,batchCount:a.imageFileBatchLimit}),popupClassName:"system-xs-medium p-1.5 rounded-lg text-text-secondary",position:"top",offset:4,disabled:0===s.length,children:(0,t.jsxs)("div",{className:"group flex cursor-pointer items-center gap-x-2",onClick:r,children:[(0,t.jsx)("div",{className:"flex size-8 items-center justify-center rounded-lg border-[1px] border-dashed border-components-dropzone-border bg-components-button-tertiary-bg group-hover:bg-components-button-tertiary-bg-hover",children:(0,t.jsx)(j.RiImageAddLine,{className:"size-4 text-text-tertiary"})}),0===s.length&&(0,t.jsx)("span",{className:"system-sm-regular text-text-quaternary group-hover:text-text-tertiary",children:e("imageUploader.tip",{ns:"datasetHitTesting",size:a.imageFileSizeLimit,batchCount:a.imageFileBatchLimit})})]})})})]})});var z=e.i(357e3);e.i(36860);var R=e.i(47481),M=e.i(584186),H=e.i(94163);let I=(0,a.memo)(e=>{let{file:s,showDeleteAction:l,onRemove:n,onReUpload:i,onPreview:r}=e,{id:o,progress:d,base64Url:c,sourceUrl:x}=s,m=(0,a.useCallback)(e=>{e.stopPropagation(),e.preventDefault(),r?.(o)},[r,o]),u=(0,a.useCallback)(e=>{e.stopPropagation(),e.preventDefault(),n?.(o)},[n,o]),p=(0,a.useCallback)(e=>{e.stopPropagation(),e.preventDefault(),i?.(o)},[i,o]);return(0,t.jsxs)("div",{className:"group/file-image relative cursor-pointer",onClick:m,children:[l&&(0,t.jsx)(w.default,{className:"absolute -right-1.5 -top-1.5 z-[11] hidden h-5 w-5 rounded-full p-0 group-hover/file-image:flex",onClick:u,children:(0,t.jsx)(j.RiCloseLine,{className:"h-4 w-4 text-components-button-secondary-text"})}),(0,t.jsx)(z.default,{className:"size-20 shadow-md",imageUrl:c||x||""}),d>=0&&!(0,H.fileIsUploaded)(s)&&(0,t.jsx)("div",{className:"absolute inset-0 z-10 flex items-center justify-center border-[2px] border-effects-image-frame bg-background-overlay-alt",children:(0,t.jsx)(M.default,{percentage:d,size:12,circleStrokeColor:"stroke-components-progress-white-border",circleFillColor:"fill-transparent",sectorFillColor:"fill-components-progress-white-progress"})}),-1===d&&(0,t.jsx)("div",{className:"absolute inset-0 z-10 flex items-center justify-center border-[2px] border-state-destructive-border bg-background-overlay-destructive",onClick:p,children:(0,t.jsx)(R.ReplayLine,{className:"size-5 text-text-primary-on-surface"})})]})}),D=e=>{let{textArea:s,actionButton:n,showUploader:i=!0,className:r,actionAreaClassName:o}=e,{t:d}=(0,l.useTranslation)(),c=(0,T.useFileStoreWithSelector)(e=>e.files),[x,m]=(0,a.useState)(0),[u,p]=(0,a.useState)([]),{dragging:h,dragRef:g,dropRef:f,handleRemoveFile:j,handleReUploadFile:v}=(0,_.useUpload)(),y=(0,a.useCallback)(e=>{let t=c.findIndex(t=>t.id===e);-1!==t&&(m(t),p(c.map(e=>({url:e.base64Url||e.sourceUrl||"",name:e.name,size:e.size}))))},[c]),N=(0,a.useCallback)(()=>{p([])},[]);return(0,t.jsxs)("div",{ref:f,className:(0,b.cn)("relative flex w-full flex-col",r),children:[h&&(0,t.jsxs)("div",{className:"absolute inset-0.5 z-10 flex items-center justify-center rounded-lg border-[1.5px] border-dashed border-components-dropzone-border-accent bg-components-dropzone-bg-accent",children:[(0,t.jsx)("div",{children:d("imageUploader.dropZoneTip",{ns:"datasetHitTesting"})}),(0,t.jsx)("div",{ref:g,className:"absolute inset-0"})]}),s,i&&!!c.length&&(0,t.jsx)("div",{className:"flex flex-wrap gap-1 bg-background-default px-4 py-2",children:c.map(e=>(0,t.jsx)(I,{file:e,showDeleteAction:!0,onRemove:j,onReUpload:v,onPreview:y},e.id))}),(0,t.jsxs)("div",{className:(0,b.cn)("flex",i?"justify-between":"justify-end",o),children:[i&&(0,t.jsx)(E,{}),n]}),u.length>0&&(0,t.jsx)(k.default,{images:u,initialIndex:x,onClose:N})]})},L=e=>{let{value:s,onChange:a,...l}=e;return(0,t.jsx)(T.FileContextProvider,{value:s,onChange:a,children:(0,t.jsx)(D,{...l})})};e.i(958948);var q=e.i(648404),F=e.i(871182),U=e.i(654313),P=e.i(777582);let A=e=>{let{onClose:s,onSave:n,initialTopK:i,initialScoreThreshold:r,initialScoreThresholdEnabled:o}=e,{t:d}=(0,l.useTranslation)(),[c,x]=(0,a.useState)(i),[m,u]=(0,a.useState)(r),[p,h]=(0,a.useState)(o);return(0,t.jsxs)("div",{className:"shadows-shadow-2xl absolute right-[14px] top-[36px] z-10 flex w-[320px] flex-col items-start rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between self-stretch p-4 pb-2",children:[(0,t.jsx)("div",{className:"system-xl-semibold grow text-text-primary",children:d("settingTitle",{ns:"datasetHitTesting"})}),(0,t.jsx)(U.default,{className:"ml-auto",onClick:s,children:(0,t.jsx)(j.RiCloseLine,{className:"h-4 w-4 shrink-0"})})]}),(0,t.jsx)("div",{className:"flex flex-col items-start justify-center gap-4 self-stretch p-4 pt-2",children:(0,t.jsx)(P.default,{topK:c,scoreThreshold:m,scoreThresholdEnabled:p,onChange:e=>{void 0!==e.top_k&&x(e.top_k),void 0!==e.score_threshold&&u(e.score_threshold),void 0!==e.score_threshold_enabled&&h(e.score_threshold_enabled)},isInHitTesting:!0})}),(0,t.jsxs)("div",{className:"flex w-full items-end justify-end gap-1 p-4 pt-2",children:[(0,t.jsx)(w.default,{className:"min-w-[72px] shrink-0",onClick:s,children:d("operation.cancel",{ns:"common"})}),(0,t.jsx)(w.default,{variant:"primary",className:"min-w-[72px] shrink-0",onClick:()=>{n({top_k:c,score_threshold:m,score_threshold_enabled:p}),s()},children:d("operation.save",{ns:"common"})})]})]})};e.i(738590);var B=e.i(597976);let O=a.memo(e=>{let{text:s,handleTextChange:a}=e,{t:n}=(0,l.useTranslation)();return(0,t.jsxs)("div",{className:(0,b.cn)("relative flex-1 overflow-hidden rounded-t-[10px] border-t-[0.5px] border-components-panel-border-subtle bg-background-default px-4 pb-0 pt-3",s.length>200&&"border-state-destructive-active"),children:[(0,t.jsx)("textarea",{className:"system-md-regular h-full w-full resize-none border-none bg-transparent text-text-secondary caret-[#295EFF] placeholder:text-components-input-text-placeholder focus-visible:outline-none",value:s,onChange:a,placeholder:n("input.placeholder",{ns:"datasetHitTesting"})}),(0,t.jsxs)("div",{className:"absolute right-0 top-0 flex items-center",children:[(0,t.jsx)(B.Corner,{className:(0,b.cn)("text-background-section-burn",s.length>200&&"text-util-colors-red-red-100")}),s.length>200?(0,t.jsx)(C.default,{popupContent:n("input.countWarning",{ns:"datasetHitTesting"}),children:(0,t.jsx)("div",{className:(0,b.cn)("system-2xs-medium-uppercase bg-util-colors-red-red-100 py-1 pr-2 text-util-colors-red-red-600"),children:`${s.length}/200`})}):(0,t.jsx)("div",{className:(0,b.cn)("system-2xs-medium-uppercase bg-background-section-burn py-1 pr-2 text-text-tertiary"),children:`${s.length}/200`})]})]})}),$=e=>{let s,{onUpdateList:n,setHitResult:i,setExternalHitResult:r,loading:o,queries:d,setQueries:c,isExternal:m=!1,onClickRetrievalMethod:u,retrievalConfig:p,isEconomy:h,onSubmit:g,hitTestingMutation:f,externalKnowledgeBaseHitTestingMutation:v}=e,{t:k}=(0,l.useTranslation)(),_=(0,x.useDatasetDetailContextWithSelector)(e=>!!e.dataset?.is_multimodal),[T,C]=(0,a.useState)(!1),[S,E]=(0,a.useState)({top_k:4,score_threshold:.5,score_threshold_enabled:!1}),z=(0,a.useMemo)(()=>d.find(e=>"text_query"===e.content_type)?.content??"",[d]),R=(0,a.useMemo)(()=>d.filter(e=>"image_query"===e.content_type).map(e=>e.file_info).filter(Boolean).map(e=>({id:(0,N.v4)(),name:e.name,size:e.size,mimeType:e.mime_type,extension:e.extension,sourceUrl:e.source_url,uploadedId:e.id,progress:100}))||[],[d]),M=(0,a.useMemo)(()=>R.every(e=>!!e.uploadedId),[R]),H=(0,a.useCallback)(e=>{E(e),C(!1)},[]),I=(0,a.useCallback)(e=>{let t=[...d],s=t.find(e=>"text_query"===e.content_type);s?s.content=e.target.value:t.push({content:e.target.value,content_type:"text_query",file_info:null}),c(t)},[d,c]),D=(0,a.useCallback)(e=>{let t=[...d];t=t.filter(e=>"image_query"!==e.content_type),e.forEach(e=>{t.push({content:e.sourceUrl||"",content_type:"image_query",file_info:{id:e.uploadedId||"",mime_type:e.mimeType,source_url:e.sourceUrl||"",name:e.name,size:e.size,extension:e.extension}})}),c(t)},[d,c]),U=(0,a.useCallback)(async()=>{await f({query:z,attachment_ids:R.map(e=>e.uploadedId),retrieval_model:{...p,search_method:h?q.RETRIEVE_METHOD.keywordSearch:p.search_method}},{onSuccess:e=>{i(e),n?.(),g&&g()}})},[z,p,h,f,n,g,R,i]),P=(0,a.useCallback)(async()=>{await v({query:z,external_retrieval_model:{top_k:S.top_k,score_threshold:S.score_threshold,score_threshold_enabled:S.score_threshold_enabled}},{onSuccess:e=>{r(e),n?.()}})},[z,S,v,n,r]),B=h?q.RETRIEVE_METHOD.keywordSearch:p.search_method,$=(0,t.jsx)(y.default,{className:"size-3.5 text-util-colors-purple-purple-600",src:(s=B,({[q.RETRIEVE_METHOD.semantic]:F.retrievalIcon.vector,[q.RETRIEVE_METHOD.fullText]:F.retrievalIcon.fullText,[q.RETRIEVE_METHOD.hybrid]:F.retrievalIcon.hybrid,[q.RETRIEVE_METHOD.invertedIndex]:F.retrievalIcon.vector,[q.RETRIEVE_METHOD.keywordSearch]:F.retrievalIcon.vector})[s]||F.retrievalIcon.vector),alt:""}),K=(0,a.useMemo)(()=>(0,t.jsx)(O,{text:z,handleTextChange:I}),[z,I]),V=(0,a.useMemo)(()=>(0,t.jsxs)(w.default,{onClick:m?P:U,variant:"primary",loading:o,disabled:0===z.length&&0===R.length||z.length>200||R.length>0&&!M,className:"w-[88px]",children:[(0,t.jsx)(j.RiPlayCircleLine,{className:"mr-1 size-4"}),k("input.testing",{ns:"datasetHitTesting"})]}),[m,P,U,z,o,k,R,M]);return(0,t.jsx)("div",{className:(0,b.cn)("relative flex h-80 shrink-0 flex-col overflow-hidden rounded-xl bg-gradient-to-r from-components-input-border-active-prompt-1 to-components-input-border-active-prompt-2 p-0.5 shadow-xs"),children:(0,t.jsxs)("div",{className:"flex h-full flex-col overflow-hidden rounded-[10px] bg-background-section-burn",children:[(0,t.jsxs)("div",{className:"relative flex shrink-0 items-center justify-between p-1.5 pb-1 pl-3",children:[(0,t.jsx)("span",{className:"system-sm-semibold-uppercase text-text-secondary",children:k("input.title",{ns:"datasetHitTesting"})}),m?(0,t.jsxs)(w.default,{variant:"secondary",size:"small",onClick:()=>C(!T),children:[(0,t.jsx)(j.RiEqualizer2Line,{className:"h-3.5 w-3.5 text-components-button-secondary-text"}),(0,t.jsx)("div",{className:"flex items-center justify-center gap-1 px-[3px]",children:(0,t.jsx)("span",{className:"system-xs-medium text-components-button-secondary-text",children:k("settingTitle",{ns:"datasetHitTesting"})})})]}):(0,t.jsxs)("div",{onClick:u,className:"flex h-7 cursor-pointer items-center space-x-0.5 rounded-lg border-[0.5px] border-components-button-secondary-bg bg-components-button-secondary-bg px-1.5 shadow-xs backdrop-blur-[5px] hover:bg-components-button-secondary-bg-hover",children:[$,(0,t.jsx)("div",{className:"text-xs font-medium uppercase text-text-secondary",children:k(`retrieval.${B}.title`,{ns:"dataset"})}),(0,t.jsx)(j.RiEqualizer2Line,{className:"size-4 text-components-menu-item-text"})]}),T&&(0,t.jsx)(A,{onClose:()=>C(!1),onSave:H,initialTopK:S.top_k,initialScoreThreshold:S.score_threshold,initialScoreThresholdEnabled:S.score_threshold_enabled})]}),(0,t.jsx)(L,{textArea:K,actionButton:V,onChange:D,value:R,showUploader:_,className:"grow",actionAreaClassName:"px-4 py-2 shrink-0 bg-background-default"})]})})};var K=e.i(157884),V=e.i(505659);let W=a.memo(e=>{let{records:s,onClickRecord:n}=e,{t:i}=(0,l.useTranslation)(),{formatTime:r}=(0,K.default)(),[o,d]=(0,a.useState)("desc"),c=(0,a.useCallback)(()=>{d(e=>"asc"===e?"desc":"asc")},[]),x=(0,a.useMemo)(()=>[...s].sort((e,t)=>"asc"===o?e.created_at-t.created_at:t.created_at-e.created_at),[s,o]);return(0,t.jsx)("div",{className:"grow overflow-y-auto",children:(0,t.jsxs)("table",{className:"w-full border-collapse border-0 text-[13px] leading-4 text-text-secondary ",children:[(0,t.jsx)("thead",{className:"sticky top-0 h-7 text-xs  font-medium uppercase leading-7 text-text-tertiary backdrop-blur-[5px]",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:"rounded-l-lg bg-background-section-burn pl-3",children:i("table.header.queryContent",{ns:"datasetHitTesting"})}),(0,t.jsx)("td",{className:"w-[128px]  bg-background-section-burn pl-3",children:i("table.header.source",{ns:"datasetHitTesting"})}),(0,t.jsx)("td",{className:"w-48 rounded-r-lg bg-background-section-burn pl-3",children:(0,t.jsxs)("div",{className:"flex cursor-pointer items-center",onClick:c,children:[i("table.header.time",{ns:"datasetHitTesting"}),(0,t.jsx)(j.RiArrowDownLine,{className:(0,b.cn)("ml-0.5 size-3.5","asc"===o?"rotate-180":"")})]})})]})}),(0,t.jsx)("tbody",{children:x.map(e=>{let{id:s,source:a,created_at:l,queries:o}=e,d="app"===e.source?j.RiApps2Line:j.RiFocus2Line,c=o.find(e=>"text_query"===e.content_type)?.content||"",x=o.filter(e=>"image_query"===e.content_type).map(e=>e.file_info).filter(Boolean).map(e=>({name:e.name,mimeType:e.mime_type,sourceUrl:e.source_url,size:e.size,extension:e.extension}));return(0,t.jsxs)("tr",{className:"group cursor-pointer border-b border-divider-subtle hover:bg-background-default-hover",onClick:()=>n(e),children:[(0,t.jsx)("td",{className:"max-w-xs p-3 pr-2",children:(0,t.jsxs)("div",{className:"flex flex-col gap-y-1",children:[c&&(0,t.jsx)("div",{className:"line-clamp-2",children:c}),x.length>0&&(0,t.jsx)(V.default,{images:x,size:"md",className:"py-1",limit:5})]})}),(0,t.jsx)("td",{className:"w-[128px] p-3 pr-2",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(d,{className:"mr-1 size-4 text-text-tertiary"}),(0,t.jsx)("span",{className:"capitalize",children:a.replace("_"," ").replace("hit testing","retrieval test")})]})}),(0,t.jsx)("td",{className:"w-48 p-3 pr-2",children:r(l,i("dateTimeFormat",{ns:"datasetHitTesting"}))})]},s)})})]})})});var Q=e.i(379415),Y=e.i(19348),Z=e.i(577507),G=e.i(558470),J=e.i(878093);let X=a.memo(e=>{let{value:s,besideChunkName:a}=e;return!s||isNaN(s)?null:(0,t.jsxs)("div",{className:(0,b.cn)("relative items-center overflow-hidden border border-components-progress-bar-border px-[5px]",a?"h-[20.5px] border-l-0":"h-[20px] rounded-md"),children:[(0,t.jsx)("div",{className:(0,b.cn)("absolute left-0 top-0 h-full border-r-[1.5px] border-components-progress-brand-progress bg-util-colors-blue-brand-blue-brand-100",1===s&&"border-r-0"),style:{width:`${100*s}%`}}),(0,t.jsxs)("div",{className:(0,b.cn)("relative flex h-full items-center space-x-0.5 text-util-colors-blue-brand-blue-brand-700"),children:[(0,t.jsx)("div",{className:"system-2xs-medium-uppercase",children:"score"}),(0,t.jsx)("div",{className:"system-xs-semibold",children:s?.toFixed(2)})]})]})}),ee=a.memo(e=>{let{payload:s,isShowAll:a}=e,{score:l,content:n,position:i}=s;return(0,t.jsxs)("div",{className:a?"":"line-clamp-2 break-all",children:[(0,t.jsxs)("div",{className:"relative top-[-2px] inline-flex items-center",children:[(0,t.jsxs)("div",{className:"system-2xs-semibold-uppercase flex h-[20.5px] items-center  bg-state-accent-solid px-1 text-text-primary-on-surface",children:["C-",i]}),(0,t.jsx)(X,{value:l,besideChunkName:!0})]}),(0,t.jsx)(J.SliceContent,{className:"bg-state-accent-hover py-0.5 text-sm font-normal text-text-secondary group-hover:bg-state-accent-hover",children:n})]})});var et=e.i(377397),es=e.i(21151),ea=e.i(402885),el=e.i(415671),en=e.i(684919);let ei=a.memo(e=>{let{className:s}=e;return(0,t.jsx)("div",{className:(0,b.cn)("h-12 bg-gradient-to-b from-components-panel-bg-transparent to-components-panel-bg",s)})}),er=a.memo(e=>{let{payload:s,onHide:n}=e,{t:i}=(0,l.useTranslation)(),{segment:r,score:o,child_chunks:d,files:c,summary:x}=s,{position:m,content:u,sign_content:p,keywords:h,document:g,answer:f}=r,j=!!(d&&d.length>0),v=g.name.split(".").slice(-1)[0],y=j?"h-[min(627px,_80vh)] overflow-y-auto":"h-[min(539px,_80vh)] overflow-y-auto",N=i(j?"segment.parentChunk":"segment.chunk",{ns:"datasetDocuments"}),w=(0,a.useMemo)(()=>c?c.map(e=>({name:e.name,mimeType:e.mime_type,sourceUrl:e.source_url,size:e.size,extension:e.extension})):[],[c]),k=w.length>0,_=!j&&h&&h.length>0;return(0,t.jsx)(es.default,{title:i("chunkDetail",{ns:"datasetHitTesting"}),isShow:!0,closable:!0,onClose:n,className:(0,b.cn)(j?"!min-w-[1200px]":"!min-w-[800px]"),children:(0,t.jsxs)("div",{className:"mt-4 flex",children:[(0,t.jsxs)("div",{className:(0,b.cn)("flex-1",j&&"pr-6"),children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex grow items-center space-x-2",children:[(0,t.jsx)(el.SegmentIndexTag,{labelPrefix:N,positionId:m,className:(0,b.cn)("w-fit group-hover:opacity-100")}),(0,t.jsx)(ea.default,{}),(0,t.jsxs)("div",{className:"flex grow items-center space-x-1",children:[(0,t.jsx)(et.default,{type:v,size:"sm"}),(0,t.jsx)("span",{className:"w-0 grow truncate text-[13px] font-normal text-text-secondary",children:g.name})]})]}),(0,t.jsx)(X,{value:o})]}),(0,t.jsxs)("div",{className:"relative",children:[!f&&(0,t.jsx)(Q.Markdown,{className:(0,b.cn)("!mt-2 !text-text-secondary",y),content:p||u,customDisallowedElements:["input"]}),f&&(0,t.jsxs)("div",{className:"break-all",children:[(0,t.jsxs)("div",{className:"flex gap-x-1",children:[(0,t.jsx)("div",{className:"w-4 shrink-0 text-[13px] font-medium leading-[20px] text-text-tertiary",children:"Q"}),(0,t.jsx)("div",{className:(0,b.cn)("body-md-regular line-clamp-20 text-text-secondary"),children:u})]}),(0,t.jsxs)("div",{className:"flex gap-x-1",children:[(0,t.jsx)("div",{className:"w-4 shrink-0 text-[13px] font-medium leading-[20px] text-text-tertiary",children:"A"}),(0,t.jsx)("div",{className:(0,b.cn)("body-md-regular line-clamp-20 text-text-secondary"),children:f})]})]}),(0,t.jsx)(ei,{className:"absolute inset-x-0 bottom-0"})]}),(k||_||!!x)&&(0,t.jsxs)("div",{className:"flex flex-col gap-y-3 pt-3",children:[k&&(0,t.jsx)(V.default,{images:w,size:"md",className:"py-1"}),!!x&&(0,t.jsx)(en.default,{value:x,disabled:!0}),_&&(0,t.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,t.jsx)("div",{className:"text-xs font-medium uppercase text-text-tertiary",children:i("keyword",{ns:"datasetHitTesting"})}),(0,t.jsx)("div",{className:"flex flex-wrap gap-x-2",children:h.map(e=>(0,t.jsx)(Z.default,{text:e},e))})]})]})]}),j&&(0,t.jsxs)("div",{className:"flex-1 pb-6 pl-6",children:[(0,t.jsx)("div",{className:"system-xs-semibold-uppercase text-text-secondary",children:i("hitChunks",{ns:"datasetHitTesting",num:d.length})}),(0,t.jsx)("div",{className:(0,b.cn)("mt-1 space-y-2",y),children:d.map(e=>(0,t.jsx)(ee,{payload:e,isShowAll:!0},e.id))})]})]})})}),eo=a.memo(e=>{let{docType:s,docTitle:a,showDetailModal:n}=e,{t:i}=(0,l.useTranslation)();return(0,t.jsxs)("div",{className:"mt-3 flex h-10 items-center justify-between border-t border-divider-subtle pl-3 pr-2",children:[(0,t.jsxs)("div",{className:"flex grow items-center space-x-1",children:[(0,t.jsx)(et.default,{type:s,size:"sm"}),(0,t.jsx)("span",{className:"w-0 grow truncate text-[13px] font-normal text-text-secondary",children:a})]}),(0,t.jsxs)("div",{className:"flex cursor-pointer items-center space-x-1 text-text-tertiary",onClick:n,children:[(0,t.jsx)("div",{className:"text-xs uppercase",children:i("open",{ns:"datasetHitTesting"})}),(0,t.jsx)(j.RiArrowRightUpLine,{className:"size-3.5"})]})]})}),ed=a.memo(e=>{let{labelPrefix:s,positionId:a,wordCount:n,score:i,className:r}=e,{t:o}=(0,l.useTranslation)();return(0,t.jsxs)("div",{className:(0,b.cn)("flex items-center justify-between",r),children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(el.SegmentIndexTag,{labelPrefix:s,positionId:a,className:(0,b.cn)("w-fit group-hover:opacity-100")}),(0,t.jsx)(ea.default,{}),(0,t.jsxs)("div",{className:"system-xs-medium text-text-tertiary",children:[n," ",o("segment.characters",{ns:"datasetDocuments",count:n})]})]}),(0,t.jsx)(X,{value:i})]})}),ec=a.memo(e=>{let{payload:n}=e,{t:i}=(0,l.useTranslation)(),{segment:r,score:o,child_chunks:d,files:c,summary:x}=n,{position:m,word_count:u,content:p,sign_content:h,keywords:g,document:f}=r,v=!!(d&&d.length>0),y=f.name.split(".").slice(-1)[0],N=(0,G.extensionToFileType)(y),[w,{toggle:k}]=(0,s.useBoolean)(!1),_=w?j.RiArrowRightSLine:j.RiArrowDownSLine,[T,{setTrue:C,setFalse:S}]=(0,s.useBoolean)(!1),E=(0,a.useMemo)(()=>c?c.map(e=>({name:e.name,mimeType:e.mime_type,sourceUrl:e.source_url,size:e.size,extension:e.extension})):[],[c]);return(0,t.jsxs)("div",{className:(0,b.cn)("cursor-pointer rounded-xl bg-chat-bubble-bg pt-3 hover:shadow-lg"),onClick:C,children:[(0,t.jsx)(ed,{className:"px-3",labelPrefix:`${v?"Parent-":""}Chunk`,positionId:m,wordCount:u,score:o}),(0,t.jsxs)("div",{className:"mt-1 px-3",children:[(0,t.jsx)(Q.Markdown,{className:"line-clamp-2",content:h||p,customDisallowedElements:["input"]}),E.length>0&&(0,t.jsx)(V.default,{images:E,size:"md",className:"py-1"}),v&&(0,t.jsxs)("div",{className:"mt-1",children:[(0,t.jsxs)("div",{className:(0,b.cn)("inline-flex h-6 cursor-pointer select-none items-center space-x-0.5 rounded-lg text-text-secondary",w&&"bg-workflow-process-bg pl-1"),onClick:e=>{e.stopPropagation(),k()},children:[(0,t.jsx)(_,{className:(0,b.cn)("h-4 w-4",w&&"opacity-50")}),(0,t.jsx)("div",{className:"text-xs font-semibold uppercase",children:i("hitChunks",{ns:"datasetHitTesting",num:d.length})})]}),!w&&(0,t.jsx)("div",{className:"space-y-2",children:d.map(e=>(0,t.jsx)("div",{className:"ml-[7px] border-l-[2px] border-text-accent-secondary pl-[7px]",children:(0,t.jsx)(ee,{payload:e,isShowAll:!1})},e.id))})]}),!v&&g&&g.length>0&&(0,t.jsx)("div",{className:"mt-2 flex flex-wrap",children:g.map(e=>(0,t.jsx)(Z.default,{text:e,className:"mr-2"},e))}),x&&(0,t.jsx)(Y.default,{summary:x,className:"mt-2"})]}),(0,t.jsx)(eo,{docType:N,docTitle:f.name,showDetailModal:C}),T&&(0,t.jsx)(er,{payload:n,onHide:S})]})});var ex=e.i(218263);let em=a.memo(e=>{let{payload:a,positionId:n}=e,{t:i}=(0,l.useTranslation)(),{content:r,title:o,score:d}=a,[c,{setTrue:x,setFalse:m}]=(0,s.useBoolean)(!1);return(0,t.jsxs)("div",{className:(0,b.cn)("cursor-pointer rounded-xl bg-chat-bubble-bg pt-3 hover:shadow-lg"),onClick:x,children:[(0,t.jsx)(ed,{className:"px-3",labelPrefix:"Chunk",positionId:n,wordCount:r.length,score:d}),(0,t.jsx)("div",{className:"mt-1 px-3",children:(0,t.jsx)("div",{className:"body-md-regular line-clamp-2 break-all text-text-primary",children:r})}),(0,t.jsx)(eo,{docType:ex.FileAppearanceTypeEnum.custom,docTitle:o,showDetailModal:x}),c&&(0,t.jsx)(es.default,{title:i("chunkDetail",{ns:"datasetHitTesting"}),className:"!min-w-[800px]",closable:!0,onClose:m,isShow:c,children:(0,t.jsxs)("div",{className:"mt-4 flex-1",children:[(0,t.jsx)(ed,{labelPrefix:"Chunk",positionId:n,wordCount:r.length,score:d}),(0,t.jsx)("div",{className:(0,b.cn)("body-md-regular mt-2 break-all text-text-secondary","h-[min(539px,_80vh)] overflow-y-auto"),children:r})]})})]})});var eu=e.i(130990),ep=e.i(194655),eh=e.i(404853),eg=e.i(225162),eb=e.i(683257),ef=e.i(137667),ej=e.i(739255),ev=e.i(616629);let ey=a.memo(e=>{let{indexMethod:s,value:n,isShow:i,onHide:r,onSave:o}=e,d=(0,a.useRef)(null),{t:c}=(0,l.useTranslation)(),m=(0,eb.useDocLink)(),[u,p]=(0,a.useState)(n),h=(0,x.useDatasetDetailContextWithSelector)(e=>e.dataset?.embedding_model),g=(0,x.useDatasetDetailContextWithSelector)(e=>e.dataset?.embedding_model_provider),{data:b}=(0,eg.useModelList)(ej.ModelTypeEnum.textEmbedding),{data:f}=(0,eg.useModelList)(ej.ModelTypeEnum.rerank),v=(0,a.useMemo)(()=>(0,ev.checkShowMultiModalTip)({embeddingModel:{provider:g??"",model:h??""},rerankingEnable:u.reranking_enable,rerankModel:{rerankingProviderName:u.reranking_model.reranking_provider_name,rerankingModelName:u.reranking_model.reranking_model_name},indexMethod:s,embeddingModelList:b,rerankModelList:f}),[g,h,u.reranking_enable,u.reranking_model,s,b,f]);return i?(0,t.jsxs)("div",{className:"flex w-full flex-col rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-2xl shadow-shadow-shadow-9",style:{height:"calc(100vh - 72px)"},ref:d,children:[(0,t.jsxs)("div",{className:"h-15 flex shrink-0 justify-between px-3 pb-1 pt-3.5",children:[(0,t.jsxs)("div",{className:"text-base font-semibold text-text-primary",children:[(0,t.jsx)("div",{children:c("form.retrievalSetting.title",{ns:"datasetSettings"})}),(0,t.jsxs)("div",{className:"text-xs font-normal leading-[18px] text-text-tertiary",children:[(0,t.jsx)("a",{target:"_blank",rel:"noopener noreferrer",href:m("/use-dify/knowledge/create-knowledge/setting-indexing-methods"),className:"text-text-accent",children:c("form.retrievalSetting.learnMore",{ns:"datasetSettings"})}),c("form.retrievalSetting.description",{ns:"datasetSettings"})]})]}),(0,t.jsx)("div",{className:"flex",children:(0,t.jsx)("div",{onClick:r,className:"flex h-8 w-8 cursor-pointer items-center justify-center",children:(0,t.jsx)(j.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})})})]}),(0,t.jsxs)("div",{className:"px-4 py-2",children:[(0,t.jsx)("div",{className:"mb-1 text-[13px] font-semibold leading-6 text-text-secondary",children:c("form.retrievalSetting.method",{ns:"datasetSettings"})}),"high_quality"===s?(0,t.jsx)(eh.default,{value:u,onChange:p,showMultiModalTip:v}):(0,t.jsx)(ep.default,{value:u,onChange:p})]}),(0,t.jsxs)("div",{className:"flex justify-end p-4 pt-2",children:[(0,t.jsx)(w.default,{className:"mr-2 shrink-0",onClick:r,children:c("operation.cancel",{ns:"common"})}),(0,t.jsx)(w.default,{variant:"primary",className:"shrink-0",onClick:()=>{(0,eu.isReRankModelSelected)({rerankModelList:f,retrievalConfig:u,indexMethod:s})?o(u):ef.default.notify({type:"error",message:c("datasetConfig.rerankModelRequired",{ns:"appDebug"})})},children:c("operation.save",{ns:"common"})})]})]}):null});e.s(["default",0,e=>{let{datasetId:j}=e,{t:y}=(0,l.useTranslation)(),N=(0,m.default)()===m.MediaType.mobile,[w,k]=(0,a.useState)(),[_,T]=(0,a.useState)(),[C,S]=(0,a.useState)([]),[E,z]=(0,a.useState)(Date.now()),[R,M]=(0,a.useState)(0),{data:H,refetch:I,isLoading:D}=(0,u.useDatasetTestingRecords)(j,{limit:10,page:R+1}),L=H?.total||0,{dataset:q}=(0,n.useContext)(x.default),F=q?.provider==="external",[U,P]=(0,a.useState)(q?.retrieval_model_dict),[A,B]=(0,a.useState)(!1),[O,{setTrue:K,setFalse:V,set:Q}]=(0,s.useBoolean)(!N),{mutateAsync:Y,isPending:Z}=(0,p.useMutation)({mutationKey:[g,"hit-testing",j],mutationFn:e=>(0,h.post)(`/datasets/${j}/hit-testing`,{body:e})}),{mutateAsync:G,isPending:J}=(0,p.useMutation)({mutationKey:[g,"external-knowledge-base-hit-testing",j],mutationFn:e=>(0,h.post)(`/datasets/${j}/external-hit-testing`,{body:e})}),X=Z||J,ee=e=>(0,t.jsxs)("div",{className:"flex h-full flex-col rounded-tl-2xl bg-background-body px-4 py-3",children:[(0,t.jsx)("div",{className:"mb-2 shrink-0 pl-2 font-semibold leading-6 text-text-primary",children:y("hit.title",{ns:"datasetHitTesting",num:e.length})}),(0,t.jsx)("div",{className:"grow space-y-2 overflow-y-auto",children:e.map((e,s)=>F?(0,t.jsx)(em,{positionId:s+1,payload:e},s):(0,t.jsx)(ec,{payload:e},s))})]}),et=(0,a.useCallback)(e=>{S(e.queries),z(Date.now())},[]);return(0,a.useEffect)(()=>{Q(!N)},[N,Q]),(0,t.jsxs)("div",{className:"relative flex h-full w-full gap-x-6 overflow-y-auto pl-6",children:[(0,t.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col py-3",children:[(0,t.jsxs)("div",{className:"mb-4 flex flex-col justify-center",children:[(0,t.jsx)("h1",{className:"text-base font-semibold text-text-primary",children:y("title",{ns:"datasetHitTesting"})}),(0,t.jsx)("p",{className:"mt-0.5 text-[13px] font-normal leading-4 text-text-tertiary",children:y("desc",{ns:"datasetHitTesting"})})]}),(0,t.jsx)($,{setHitResult:k,setExternalHitResult:T,onSubmit:K,onUpdateList:I,loading:X,queries:C,setQueries:S,isExternal:F,onClickRetrievalMethod:()=>B(!0),retrievalConfig:U,isEconomy:q?.indexing_technique==="economy",hitTestingMutation:Y,externalKnowledgeBaseHitTestingMutation:G},E),(0,t.jsx)("div",{className:"mb-3 mt-6 text-base font-semibold text-text-primary",children:y("records",{ns:"datasetHitTesting"})}),D&&(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsx)(o.default,{type:"app"})}),!D&&H?.data&&H.data.length>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(W,{records:H?.data,onClickRecord:et}),L&&L>10?(0,t.jsx)(d.default,{current:R,onChange:M,total:L,limit:10}):null]}),!D&&!H?.data?.length&&(0,t.jsx)(v,{})]}),(0,t.jsx)(r.default,{panelClassName:"!justify-start !overflow-y-auto",showClose:!0,isMobile:N,isOpen:O,onClose:V,footer:null,children:(0,t.jsx)("div",{className:"flex min-w-0 flex-1 flex-col pt-3",children:X?(0,t.jsx)("div",{className:"flex h-full flex-col rounded-tl-2xl bg-background-body px-4 py-3",children:(0,t.jsx)(f.CardSkelton,{})}):w?.records.length||_?.records.length?ee(w?.records.length?w.records:_?.records||[]):(0,t.jsxs)("div",{className:"flex h-full flex-col items-center justify-center rounded-tl-2xl bg-background-body px-4 py-3",children:[(0,t.jsx)("div",{className:(0,b.cn)(c.default.commonIcon,c.default.targetIcon,"!h-14 !w-14 !bg-text-quaternary")}),(0,t.jsx)("div",{className:"mt-3 text-[13px] text-text-quaternary",children:y("hit.emptyTip",{ns:"datasetHitTesting"})})]})})}),(0,t.jsx)(i.default,{unmount:!0,isOpen:A,onClose:()=>B(!1),footer:null,mask:N,panelClassName:"mt-16 mx-2 sm:mr-2 mb-3 !p-0 !max-w-[640px] rounded-xl",children:(0,t.jsx)(ey,{indexMethod:q?.indexing_technique||"",value:U,isShow:A,onHide:()=>B(!1),onSave:e=>{P(e),B(!1)}})})]})}],329103)}]);
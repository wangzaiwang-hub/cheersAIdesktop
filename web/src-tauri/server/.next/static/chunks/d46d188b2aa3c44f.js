(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,208333,e=>{"use strict";var t=e.i(563199),s=e.i(417944),a=e.i(38532),n=e.i(326531),l=e.i(268255);e.i(152567);var r=e.i(408767),i=e.i(151094);e.i(39598);var o=e.i(549289),d=e.i(291631),c=e.i(933620),m=e.i(860053),x=e.i(364203),u=e.i(198269),p=e.i(711536),h=e.i(705875),g=e.i(494268),f=e.i(261484),b=e.i(225244),j=e.i(837699),v=e.i(654313),y=e.i(449980),w=e.i(720374),N=e.i(683257),C=e.i(296124),_=e.i(935139),k=e.i(547105),A=e.i(211857);let I=e=>{let{api:s}=e,{setShowExternalKnowledgeAPIModal:a}=(0,C.useModalContext)(),[n,i]=(0,l.useState)(!1),[d,c]=(0,l.useState)(!1),[m,x]=(0,l.useState)(0),{mutateExternalKnowledgeApis:u}=(0,w.useExternalKnowledgeApi)(),{t:p}=(0,r.useTranslation)(),h=async()=>{try{let e=await (0,A.fetchExternalAPI)({apiTemplateId:s.id}),t={name:e.name,settings:{endpoint:e.settings.endpoint,api_key:e.settings.api_key}};a({payload:t,onSaveCallback:()=>{u()},onCancelCallback:()=>{u()},isEditMode:!0,datasetBindings:e.dataset_bindings,onEditCallback:async t=>{try{await (0,A.updateExternalAPI)({apiTemplateId:s.id,body:{...e,name:t.name,settings:{...e.settings,endpoint:t.settings.endpoint,api_key:t.settings.api_key}}}),u()}catch(e){console.error("Error updating external knowledge API:",e)}}})}catch(e){console.error("Error fetching external knowledge API data:",e)}},g=async()=>{try{let e=await (0,A.checkUsageExternalAPI)({apiTemplateId:s.id});e.is_using&&x(e.count),i(!0)}catch(e){console.error("Error checking external API usage:",e)}},f=async()=>{try{let e=await (0,A.deleteExternalAPI)({apiTemplateId:s.id});e&&"success"===e.result?(i(!1),u()):console.error("Failed to delete external API")}catch(e){console.error("Error deleting external knowledge API:",e)}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:`shadows-shadow-xs flex items-start self-stretch rounded-lg border-[0.5px] border-components-panel-border-subtle
        bg-components-panel-on-panel-item-bg p-2
        pl-3 ${d?"border-state-destructive-border bg-state-destructive-hover":""}`,children:[(0,t.jsxs)("div",{className:"flex grow flex-col items-start justify-center gap-1.5 py-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1 self-stretch text-text-secondary",children:[(0,t.jsx)(o.ApiConnectionMod,{className:"h-4 w-4"}),(0,t.jsx)("div",{className:"system-sm-medium",children:s.name})]}),(0,t.jsx)("div",{className:"system-xs-regular self-stretch text-text-tertiary",children:s.settings.endpoint})]}),(0,t.jsxs)("div",{className:"flex items-start gap-1",children:[(0,t.jsx)(v.default,{onClick:h,children:(0,t.jsx)(j.RiEditLine,{className:"h-4 w-4 text-text-tertiary hover:text-text-secondary"})}),(0,t.jsx)(v.default,{className:"hover:bg-state-destructive-hover",onClick:g,onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),children:(0,t.jsx)(j.RiDeleteBinLine,{className:"h-4 w-4 text-text-tertiary hover:text-text-destructive"})})]})]}),n&&(0,t.jsx)(k.default,{isShow:n,title:`${p("deleteExternalAPIConfirmWarningContent.title.front",{ns:"dataset"})} ${s.name}${p("deleteExternalAPIConfirmWarningContent.title.end",{ns:"dataset"})}`,content:m>0?`${p("deleteExternalAPIConfirmWarningContent.content.front",{ns:"dataset"})} ${m} ${p("deleteExternalAPIConfirmWarningContent.content.end",{ns:"dataset"})}`:p("deleteExternalAPIConfirmWarningContent.noConnectionContent",{ns:"dataset"}),type:"warning",onConfirm:f,onCancel:()=>i(!1)})]})},T=e=>{let{onClose:s}=e,{t:a}=(0,r.useTranslation)(),n=(0,N.useDocLink)(),{setShowExternalKnowledgeAPIModal:l}=(0,C.useModalContext)(),{externalKnowledgeApiList:o,mutateExternalKnowledgeApis:d,isLoading:c}=(0,w.useExternalKnowledgeApi)();return(0,t.jsx)("div",{tabIndex:-1,className:(0,_.cn)("absolute bottom-2 right-0 top-14 z-10 flex outline-none"),children:(0,t.jsxs)("div",{className:(0,_.cn)("relative flex h-full w-[420px] flex-col rounded-l-2xl border border-components-panel-border bg-components-panel-bg-alt"),children:[(0,t.jsxs)("div",{className:"flex items-start self-stretch p-4 pb-0",children:[(0,t.jsxs)("div",{className:"flex grow flex-col items-start gap-1",children:[(0,t.jsx)("div",{className:"system-xl-semibold self-stretch text-text-primary",children:a("externalAPIPanelTitle",{ns:"dataset"})}),(0,t.jsx)("div",{className:"body-xs-regular self-stretch text-text-tertiary",children:a("externalAPIPanelDescription",{ns:"dataset"})}),(0,t.jsxs)("a",{className:"flex cursor-pointer items-center justify-center gap-1 self-stretch",href:n("/use-dify/knowledge/external-knowledge-api"),target:"_blank",children:[(0,t.jsx)(j.RiBookOpenLine,{className:"h-3 w-3 text-text-accent"}),(0,t.jsx)("div",{className:"body-xs-regular grow text-text-accent",children:a("externalAPIPanelDocumentation",{ns:"dataset"})})]})]}),(0,t.jsx)("div",{className:"flex items-center",children:(0,t.jsx)(v.default,{onClick:()=>s(),children:(0,t.jsx)(j.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})})})]}),(0,t.jsx)("div",{className:"flex flex-col items-start justify-center gap-2 self-stretch px-4 py-3",children:(0,t.jsxs)(i.default,{variant:"primary",className:"flex items-center justify-center gap-0.5 px-3 py-2",onClick:()=>{l({payload:{name:"",settings:{endpoint:"",api_key:""}},datasetBindings:[],onSaveCallback:()=>{d()},onCancelCallback:()=>{d()},isEditMode:!1})},children:[(0,t.jsx)(j.RiAddLine,{className:"h-4 w-4 text-components-button-primary-text"}),(0,t.jsx)("div",{className:"system-sm-medium text-components-button-primary-text",children:a("createExternalAPI",{ns:"dataset"})})]})}),(0,t.jsx)("div",{className:"flex grow flex-col items-start gap-1 self-stretch px-4 py-0",children:c?(0,t.jsx)(y.default,{}):o.map(e=>(0,t.jsx)(I,{api:e},e.id))})]})})};var E=e.i(391185),P=e.i(836340),D=e.i(554327),M=e.i(772499);e.i(9633);var R=e.i(189445),F=e.i(890578),S=e.i(606466);let z=l.memo(e=>{let{apiBaseUrl:s}=e,{t:a}=(0,r.useTranslation)(),[n,o]=(0,l.useState)(!1),d=(0,S.useDatasetApiAccessUrl)(),c=(0,l.useCallback)(()=>{o(!0)},[]),m=(0,l.useCallback)(()=>{o(!1)},[]);return(0,t.jsxs)("div",{className:"flex w-[360px] flex-col rounded-xl border border-components-panel-border bg-components-panel-bg shadow-lg shadow-shadow-shadow-1",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-y-3 p-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-x-3",children:[(0,t.jsxs)("div",{className:"flex grow items-center gap-x-2",children:[(0,t.jsx)("div",{className:"flex size-6 shrink-0 items-center justify-center rounded-lg border-[0.5px] border-divider-subtle bg-util-colors-blue-brand-blue-brand-500 shadow-md shadow-shadow-shadow-5",children:(0,t.jsx)(R.ApiAggregate,{className:"size-4 text-text-primary-on-surface"})}),(0,t.jsx)("div",{className:"system-sm-semibold grow truncate text-text-secondary",children:a("serviceApi.card.title",{ns:"dataset"})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,t.jsx)(P.default,{className:"shrink-0",color:s?"green":"yellow"}),(0,t.jsx)("div",{className:"system-xs-semibold-uppercase text-text-success",children:a("serviceApi.enabled",{ns:"dataset"})})]})]}),(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("div",{className:"system-xs-regular leading-6 text-text-tertiary",children:a("serviceApi.card.endpoint",{ns:"dataset"})}),(0,t.jsxs)("div",{className:"flex h-8 items-center gap-0.5 rounded-lg bg-components-input-bg-normal p-1 pl-2",children:[(0,t.jsx)("div",{className:"flex h-4 min-w-0 flex-1 items-start justify-start gap-2 px-1",children:(0,t.jsx)("div",{className:"system-xs-medium truncate text-text-secondary",children:s})}),(0,t.jsx)(M.default,{content:s})]})]})]}),(0,t.jsxs)("div",{className:"flex gap-x-1 border-t-[0.5px] border-divider-subtle p-4",children:[(0,t.jsxs)(i.default,{variant:"ghost",size:"small",className:"gap-x-px text-text-tertiary",onClick:c,children:[(0,t.jsx)(j.RiKey2Line,{className:"size-3.5 shrink-0"}),(0,t.jsx)("span",{className:"system-xs-medium px-[3px]",children:a("serviceApi.card.apiKey",{ns:"dataset"})})]}),(0,t.jsx)(D.default,{href:d,target:"_blank",rel:"noopener noreferrer",children:(0,t.jsxs)(i.default,{variant:"ghost",size:"small",className:"gap-x-px text-text-tertiary",children:[(0,t.jsx)(j.RiBookOpenLine,{className:"size-3.5 shrink-0"}),(0,t.jsx)("span",{className:"system-xs-medium px-[3px]",children:a("serviceApi.card.apiReference",{ns:"dataset"})})]})})]}),(0,t.jsx)(F.default,{isShow:n,onClose:m})]})}),$=l.memo(e=>{let{apiBaseUrl:s}=e,{t:a}=(0,r.useTranslation)(),[n,i]=(0,l.useState)(!1);return(0,t.jsx)("div",{children:(0,t.jsxs)(E.PortalToFollowElem,{open:n,onOpenChange:i,placement:"top-start",offset:{mainAxis:4,crossAxis:-4},children:[(0,t.jsx)(E.PortalToFollowElemTrigger,{className:"w-full",onClick:()=>{i(!n)},children:(0,t.jsxs)("div",{className:(0,_.cn)("relative flex h-8 cursor-pointer items-center gap-2 rounded-lg border-[0.5px] border-components-button-secondary-border-hover bg-components-button-secondary-bg px-3",n?"bg-components-button-secondary-bg-hover":"hover:bg-components-button-secondary-bg-hover"),children:[(0,t.jsx)(P.default,{className:(0,_.cn)("shrink-0"),color:s?"green":"yellow"}),(0,t.jsx)("div",{className:"system-sm-medium grow text-text-secondary",children:a("serviceApi.title",{ns:"dataset"})})]})}),(0,t.jsx)(E.PortalToFollowElemContent,{className:"z-[10]",children:(0,t.jsx)(z,{apiBaseUrl:s})})]})})}),B=l.memo(()=>{let{t:e}=(0,r.useTranslation)();return(0,t.jsxs)("footer",{className:"shrink-0 px-12 py-6",children:[(0,t.jsx)("h3",{className:"text-gradient text-xl font-semibold leading-tight",children:e("didYouKnow",{ns:"dataset"})}),(0,t.jsxs)("p",{className:"mt-1 text-sm font-normal leading-tight text-text-secondary",children:[e("intro1",{ns:"dataset"}),(0,t.jsx)("span",{className:"inline-flex items-center gap-1 text-text-accent",children:e("intro2",{ns:"dataset"})}),e("intro3",{ns:"dataset"}),(0,t.jsx)("br",{}),e("intro4",{ns:"dataset"}),(0,t.jsx)("span",{className:"inline-flex items-center gap-1 text-text-accent",children:e("intro5",{ns:"dataset"})}),e("intro6",{ns:"dataset"})]})]})});var L=e.i(726371);e.i(738590);var O=e.i(597976);let U=e=>{let{label:s,className:a,labelClassName:n}=e;return(0,t.jsxs)("div",{className:(0,_.cn)("group/corner-label inline-flex items-start",a),children:[(0,t.jsx)(O.Corner,{className:"h-5 w-[13px] text-background-section-burn"}),(0,t.jsx)("div",{className:(0,_.cn)("flex items-center gap-0.5 bg-background-section-burn py-1 pr-2",n),children:(0,t.jsx)("div",{className:"system-2xs-medium-uppercase text-text-tertiary",children:s})})]})},K=l.memo(e=>{let{dataset:s}=e,{t:a}=(0,r.useTranslation)();return s.embedding_available?"rag_pipeline"===s.runtime_mode?(0,t.jsx)(U,{label:a("cornerLabel.pipeline",{ns:"dataset"}),className:"absolute right-0 top-0 z-10",labelClassName:"rounded-tr-xl"}):null:(0,t.jsx)(U,{label:a("cornerLabel.unavailable",{ns:"dataset"}),className:"absolute right-0 top-0 z-10",labelClassName:"rounded-tr-xl"})});var W=e.i(421001),q=e.i(363372);let H=l.memo(e=>{let{dataset:s}=e,{t:a}=(0,r.useTranslation)(),{formatTimeFromNow:n}=(0,q.useFormatTimeFromNow)(),i="external"===s.provider,o=(0,l.useMemo)(()=>{let e=s.total_available_documents??0;return e<s.document_count?`${e} / ${s.document_count}`:`${s.document_count}`},[s.document_count,s.total_available_documents]),d=(0,l.useMemo)(()=>{let e=s.total_available_documents??0;return e<s.document_count?a("partialEnabled",{ns:"dataset",count:s.document_count,num:e}):a("docAllEnabled",{ns:"dataset",count:e})},[a,s.document_count,s.total_available_documents]);return(0,t.jsxs)("div",{className:(0,_.cn)("flex items-center gap-x-3 px-4 pb-3 pt-2 text-text-tertiary",!s.embedding_available&&"opacity-30"),children:[(0,t.jsx)(W.default,{popupContent:d,children:(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,t.jsx)(j.RiFileTextFill,{className:"size-3 text-text-quaternary"}),(0,t.jsx)("span",{className:"system-xs-medium",children:o})]})}),!i&&(0,t.jsx)(W.default,{popupContent:`${s.app_count} ${a("appCount",{ns:"dataset"})}`,children:(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,t.jsx)(j.RiRobot2Fill,{className:"size-3 text-text-quaternary"}),(0,t.jsx)("span",{className:"system-xs-medium",children:s.app_count})]})}),(0,t.jsx)("span",{className:"system-xs-regular text-divider-deep",children:"/"}),(0,t.jsx)("span",{className:"system-xs-regular",children:`${a("updated",{ns:"dataset"})} ${n(1e3*s.updated_at)}`})]})});var G=e.i(257899),X=e.i(216425),Y=e.i(621379);let J=e=>{let{dataset:s,isExternalProvider:a,isShowDocModeInfo:n}=e,{t:l}=(0,r.useTranslation)(),{formatIndexingTechniqueAndMethod:i}=(0,X.useKnowledge)();if(a)return(0,t.jsx)("div",{className:"system-2xs-medium-uppercase flex items-center gap-x-3 text-text-tertiary",children:(0,t.jsx)("span",{children:l("externalKnowledgeBase",{ns:"dataset"})})});if(!n)return null;let o=s.indexing_technique?i(s.indexing_technique,s.retrieval_model_dict?.search_method):"";return(0,t.jsxs)("div",{className:"system-2xs-medium-uppercase flex items-center gap-x-3 text-text-tertiary",children:[!!s.doc_form&&(0,t.jsx)("span",{className:"min-w-0 max-w-full truncate",title:l(`chunkingMode.${Y.DOC_FORM_TEXT[s.doc_form]}`,{ns:"dataset"}),children:l(`chunkingMode.${Y.DOC_FORM_TEXT[s.doc_form]}`,{ns:"dataset"})}),s.indexing_technique&&o&&(0,t.jsx)("span",{className:"min-w-0 max-w-full truncate",title:o,children:o}),s.is_multimodal&&(0,t.jsx)("span",{className:"min-w-0 max-w-full truncate",title:l("multimodal",{ns:"dataset"}),children:l("multimodal",{ns:"dataset"})})]})},Q=l.memo(e=>{let{dataset:s}=e,{t:a}=(0,r.useTranslation)(),{formatTimeFromNow:n}=(0,q.useFormatTimeFromNow)(),i="external"===s.provider,o=s.doc_form&&("rag_pipeline"!==s.runtime_mode||s.is_published),d=!!(s.doc_form&&s.indexing_technique&&s.retrieval_model_dict?.search_method&&("rag_pipeline"!==s.runtime_mode||s.is_published)),c=s.doc_form?Y.DOC_FORM_ICON_WITH_BG[s.doc_form]:l.Fragment,m=i?Y.DOC_FORM_ICON_WITH_BG.external:c,x=(0,l.useMemo)(()=>s.icon_info||{icon:"ðŸ“™",icon_type:"emoji",icon_background:"#FFF4ED",icon_url:""},[s.icon_info]),u=(0,l.useMemo)(()=>`${a("segment.editedAt",{ns:"datasetDocuments"})} ${n(1e3*s.updated_at)}`,[a,s.updated_at,n]);return(0,t.jsxs)("div",{className:(0,_.cn)("flex items-center gap-x-3 px-4 pb-2 pt-4",!s.embedding_available&&"opacity-30"),children:[(0,t.jsxs)("div",{className:"relative shrink-0",children:[(0,t.jsx)(G.default,{size:"large",iconType:x.icon_type,icon:x.icon,background:"image"===x.icon_type?void 0:x.icon_background,imageUrl:"image"===x.icon_type?x.icon_url:void 0}),(o||i)&&(0,t.jsx)("div",{className:"absolute -bottom-1 -right-1 z-[5]",children:(0,t.jsx)(m,{className:"size-4"})})]}),(0,t.jsxs)("div",{className:"flex grow flex-col gap-y-1 overflow-hidden py-px",children:[(0,t.jsx)("div",{className:"system-md-semibold truncate text-text-secondary",title:s.name,children:s.name}),(0,t.jsxs)("div",{className:"flex items-center gap-1 text-[10px] font-medium leading-[18px] text-text-tertiary",children:[(0,t.jsx)("div",{className:"truncate",title:s.author_name,children:s.author_name}),(0,t.jsx)("div",{children:"Â·"}),(0,t.jsx)("div",{className:"truncate",title:u,children:u})]}),(0,t.jsx)(J,{dataset:s,isExternalProvider:i,isShowDocModeInfo:d})]})]})});var V=e.i(176891);let Z=l.memo(e=>{let{dataset:s,modalState:a,onCloseRename:n,onCloseConfirm:l,onConfirmDelete:i,onSuccess:o}=e,{t:d}=(0,r.useTranslation)();return(0,t.jsxs)(t.Fragment,{children:[a.showRenameModal&&(0,t.jsx)(V.default,{show:a.showRenameModal,dataset:s,onClose:n,onSuccess:o}),a.showConfirmDelete&&(0,t.jsx)(k.default,{title:d("deleteDatasetConfirmTitle",{ns:"dataset"}),content:a.confirmMessage,isShow:a.showConfirmDelete,onConfirm:i,onCancel:l})]})}),ee=l.memo(e=>{let{dataset:s}=e;return(0,t.jsx)("div",{className:(0,_.cn)("system-xs-regular line-clamp-2 h-10 px-4 py-1 text-text-tertiary",!s.embedding_available&&"opacity-30"),title:s.description,children:s.description})});var et=e.i(964596),es=e.i(757198);let ea=l.memo(e=>{let{Icon:s,name:a,handleClick:n}=e;return(0,t.jsxs)("div",{className:"flex cursor-pointer items-center gap-x-1 rounded-lg px-2 py-1.5 hover:bg-state-base-hover",onClick:e=>{e.preventDefault(),e.stopPropagation(),n?.()},children:[(0,t.jsx)(s,{className:"size-4 text-text-tertiary"}),(0,t.jsx)("span",{className:"system-md-regular px-1 text-text-secondary",children:a})]})}),en=l.memo(e=>{let{showDelete:s,showExportPipeline:a,openRenameModal:n,handleExportPipeline:l,detectIsUsedByApp:i}=e,{t:o}=(0,r.useTranslation)();return(0,t.jsxs)("div",{className:"relative flex w-full flex-col rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur shadow-lg shadow-shadow-shadow-5",children:[(0,t.jsxs)("div",{className:"flex flex-col p-1",children:[(0,t.jsx)(ea,{Icon:j.RiEditLine,name:o("operation.edit",{ns:"common"}),handleClick:n}),a&&(0,t.jsx)(ea,{Icon:j.RiFileDownloadLine,name:o("operations.exportPipeline",{ns:"datasetPipeline"}),handleClick:l})]}),s&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(es.default,{type:"horizontal",className:"my-0 bg-divider-subtle"}),(0,t.jsx)("div",{className:"flex flex-col p-1",children:(0,t.jsx)(ea,{Icon:j.RiDeleteBinLine,name:o("operation.delete",{ns:"common"}),handleClick:i})})]})]})}),el=l.memo(e=>{let{dataset:s,isCurrentWorkspaceDatasetOperator:a,openRenameModal:n,handleExportPipeline:l,detectIsUsedByApp:r}=e;return(0,t.jsx)("div",{className:"absolute right-2 top-2 z-[15] hidden group-hover:block",children:(0,t.jsx)(et.default,{htmlContent:(0,t.jsx)(en,{showDelete:!a,showExportPipeline:"rag_pipeline"===s.runtime_mode,openRenameModal:n,handleExportPipeline:l,detectIsUsedByApp:r}),className:"z-20 min-w-[186px]",popupClassName:"rounded-xl bg-none shadow-none ring-0 min-w-[186px]",position:"br",trigger:"click",btnElement:(0,t.jsx)("div",{className:"flex size-8 items-center justify-center rounded-[10px] hover:bg-state-base-hover",children:(0,t.jsx)(j.RiMoreFill,{className:"h-5 w-5 text-text-tertiary"})}),btnClassName:e=>(0,_.cn)("size-9 cursor-pointer justify-center rounded-[10px] border-[0.5px] border-components-actionbar-border bg-components-actionbar-bg p-0 shadow-lg shadow-shadow-shadow-5 ring-[2px] ring-inset ring-components-actionbar-bg hover:border-components-actionbar-border",e?"border-components-actionbar-border bg-state-base-hover":"")})})});var er=e.i(747271);let ei=l.forwardRef((e,s)=>{let{dataset:a,tags:n,setTags:l,onSuccess:r,isHoveringTagSelector:i,onClick:o}=e;return(0,t.jsxs)("div",{className:(0,_.cn)("relative w-full px-3",!a.embedding_available&&"opacity-30"),onClick:o,children:[(0,t.jsx)("div",{ref:s,className:(0,_.cn)("invisible w-full group-hover:visible",n.length>0&&"visible"),children:(0,t.jsx)(er.default,{position:"bl",type:"knowledge",targetID:a.id,value:n.map(e=>e.id),selectedTags:n,onCacheUpdate:l,onChange:r})}),(0,t.jsx)("div",{className:(0,_.cn)("absolute right-0 top-0 z-[5] h-full w-20 bg-tag-selector-mask-bg group-hover:bg-tag-selector-mask-hover-bg",i&&"hidden")})]})});ei.displayName="TagArea";var eo=e.i(137667),ed=e.i(875037);let ec="dataset-card";var em=e.i(475390),ex=e.i(618403);let eu=e=>{let{dataset:s,onSuccess:a}=e,{push:i}=(0,n.useRouter)(),o=(0,p.useSelector)(e=>e.isCurrentWorkspaceDatasetOperator),d=(0,l.useRef)(null),c=(0,L.useHover)(d),{tags:m,setTags:x,modalState:u,openRenameModal:h,closeRenameModal:g,closeConfirmDelete:f,handleExportPipeline:b,detectIsUsedByApp:j,onConfirmDelete:v}=(e=>{let{dataset:t,onSuccess:s}=e,{t:a}=(0,r.useTranslation)(),[n,i]=(0,l.useState)(t.tags);(0,l.useEffect)(()=>{i(t.tags)},[t.tags]);let[o,d]=(0,l.useState)({showRenameModal:!1,showConfirmDelete:!1,confirmMessage:""}),[c,m]=(0,l.useState)(!1),x=(0,l.useCallback)(()=>{d(e=>({...e,showRenameModal:!0}))},[]),u=(0,l.useCallback)(()=>{d(e=>({...e,showRenameModal:!1}))},[]),p=(0,l.useCallback)(()=>{d(e=>({...e,showConfirmDelete:!1}))},[]),{mutateAsync:h}=(0,ed.useMutation)({mutationKey:[ec,"check-usage"],mutationFn:e=>(0,A.checkIsUsedInApp)(e)}),{mutateAsync:g}=(0,ed.useMutation)({mutationKey:[ec,"delete"],mutationFn:e=>(0,A.deleteDataset)(e)}),{mutateAsync:f}=(0,em.useExportPipelineDSL)(),b=(0,l.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],{pipeline_id:s,name:n}=t;if(s&&!c)try{m(!0);let{data:t}=await f({pipelineId:s,include:e}),a=new Blob([t],{type:"application/yaml"});(0,ex.downloadBlob)({data:a,fileName:`${n}.pipeline`})}catch{eo.default.notify({type:"error",message:a("exportFailed",{ns:"app"})})}finally{m(!1)}},[t,f,c,a]),j=(0,l.useCallback)(async()=>{try{let{is_using:e}=await h(t.id),s=e?a("datasetUsedByApp",{ns:"dataset"}):a("deleteDatasetConfirmContent",{ns:"dataset"});d(e=>({...e,confirmMessage:s,showConfirmDelete:!0}))}catch(e){if(e instanceof Response){let t=await e.json();eo.default.notify({type:"error",message:t?.message||"Unknown error"})}else eo.default.notify({type:"error",message:e?.message||"Unknown error"})}},[t.id,h,a]),v=(0,l.useCallback)(async()=>{try{await g(t.id),eo.default.notify({type:"success",message:a("datasetDeleted",{ns:"dataset"})}),s?.()}finally{p()}},[t.id,g,s,a,p]);return{tags:n,setTags:i,modalState:o,openRenameModal:x,closeRenameModal:u,closeConfirmDelete:p,exporting:c,handleExportPipeline:b,detectIsUsedByApp:j,onConfirmDelete:v}})({dataset:s,onSuccess:a}),y="external"===s.provider,w=(0,l.useMemo)(()=>"rag_pipeline"===s.runtime_mode&&!s.is_published,[s.runtime_mode,s.is_published]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"group relative col-span-1 flex h-[190px] cursor-pointer flex-col rounded-xl border-[0.5px] border-solid border-components-card-border bg-components-card-bg shadow-xs shadow-shadow-shadow-3 transition-all duration-200 ease-in-out hover:bg-components-card-bg-alt hover:shadow-md hover:shadow-shadow-shadow-5","data-disable-nprogress":!0,onClick:e=>{e.preventDefault(),y?i(`/datasets/${s.id}/hitTesting`):w?i(`/datasets/${s.id}/pipeline`):i(`/datasets/${s.id}/documents`)},children:[(0,t.jsx)(K,{dataset:s}),(0,t.jsx)(Q,{dataset:s}),(0,t.jsx)(ee,{dataset:s}),(0,t.jsx)(ei,{ref:d,dataset:s,tags:m,setTags:x,onSuccess:a,isHoveringTagSelector:c,onClick:e=>{e.stopPropagation(),e.preventDefault()}}),(0,t.jsx)(H,{dataset:s}),(0,t.jsx)(el,{dataset:s,isCurrentWorkspaceDatasetOperator:o,openRenameModal:h,handleExportPipeline:b,detectIsUsedByApp:j})]}),(0,t.jsx)(Z,{dataset:s,modalState:u,onCloseRename:g,onCloseConfirm:f,onConfirmDelete:v,onSuccess:a})]})},ep=l.memo(e=>{let{Icon:s,text:a,href:n}=e;return(0,t.jsxs)(D.default,{type:"button",className:"flex w-full items-center gap-x-2 rounded-lg bg-transparent px-4 py-2 text-text-tertiary shadow-shadow-shadow-3 hover:bg-background-default-dodge hover:text-text-secondary hover:shadow-xs",href:n,children:[(0,t.jsx)(s,{className:"h-4 w-4 shrink-0"}),(0,t.jsx)("span",{className:"system-sm-medium grow text-left",children:a})]})}),eh=()=>{let{t:e}=(0,r.useTranslation)();return(0,t.jsxs)("div",{className:"flex h-[190px] flex-col gap-y-0.5 rounded-xl bg-background-default-dimmed",children:[(0,t.jsxs)("div",{className:"flex grow flex-col items-center justify-center p-2",children:[(0,t.jsx)(ep,{href:"/datasets/create",Icon:j.RiAddLine,text:e("createDataset",{ns:"dataset"})}),(0,t.jsx)(ep,{href:"/datasets/create-from-pipeline",Icon:j.RiFunctionAddLine,text:e("createFromPipeline",{ns:"dataset"})})]}),(0,t.jsx)("div",{className:"border-t-[0.5px] border-divider-subtle p-2",children:(0,t.jsx)(ep,{href:"/datasets/connect",Icon:o.ApiConnectionMod,text:e("connectDataset",{ns:"dataset"})})})]})};eh.displayName="CreateAppCard";let eg=e=>{let{tags:s,keywords:a,includeAll:n}=e,{t:i}=(0,r.useTranslation)(),o=(0,p.useSelector)(e=>e.isCurrentWorkspaceEditor),{data:d,fetchNextPage:c,hasNextPage:m,isFetching:x,isFetchingNextPage:u}=(0,b.useDatasetList)({initialPage:1,tag_ids:s,limit:30,include_all:n,keyword:a}),h=(0,b.useInvalidDatasetList)(),g=(0,l.useRef)(null),f=(0,l.useRef)(null);return(0,l.useEffect)(()=>{document.title=`${i("knowledge",{ns:"dataset"})} - CheersAI`},[i]),(0,l.useEffect)(()=>(g.current&&(f.current=new IntersectionObserver(e=>{e[0].isIntersecting&&m&&!x&&c()},{rootMargin:"100px"}),f.current.observe(g.current)),()=>f.current?.disconnect()),[g,m,x,c]),(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("nav",{className:"grid grow grid-cols-1 content-start gap-3 px-12 pt-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4",children:[o&&(0,t.jsx)(eh,{}),d?.pages.map(e=>{let{data:s}=e;return s.map(e=>(0,t.jsx)(eu,{dataset:e,onSuccess:h},e.id))}),u&&(0,t.jsx)(y.default,{}),(0,t.jsx)("div",{ref:g,className:"h-0"})]})})};e.s(["default",0,()=>{let{t:e}=(0,r.useTranslation)(),{systemFeatures:j}=(0,g.useGlobalPublicStore)(),v=(0,n.useRouter)(),{currentWorkspace:y,isCurrentWorkspaceOwner:w}=(0,p.useAppContext)(),N=(0,x.useStore)(e=>e.showTagManagementModal),{showExternalApiPanel:C,setShowExternalApiPanel:_}=(0,h.useExternalApiPanel)(),[k,{toggle:A}]=(0,s.useBoolean)(!1);(0,f.default)(e("knowledge",{ns:"dataset"}));let[I,E]=(0,l.useState)(""),[P,D]=(0,l.useState)(""),{run:M}=(0,a.useDebounceFn)(()=>{D(I)},{wait:500}),R=e=>{E(e),M()},[F,S]=(0,l.useState)([]),[z,L]=(0,l.useState)([]),{run:O}=(0,a.useDebounceFn)(()=>{L(F)},{wait:500});(0,l.useEffect)(()=>{if("normal"===y.role)return v.replace("/apps")},[y,v]);let U=(0,p.useSelector)(e=>e.isCurrentWorkspaceManager),{data:K}=(0,b.useDatasetApiBaseUrl)();return(0,t.jsxs)("div",{className:"scroll-container relative flex grow flex-col overflow-y-auto bg-background-body",children:[(0,t.jsx)("div",{className:"sticky top-0 z-10 flex items-center justify-end gap-x-1 bg-background-body px-12 pb-2 pt-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[w&&(0,t.jsx)(u.default,{isChecked:k,onChange:A,label:e("allKnowledge",{ns:"dataset"}),labelClassName:"system-md-regular text-text-secondary",className:"mr-2",tooltip:e("allKnowledgeDescription",{ns:"dataset"})}),(0,t.jsx)(m.default,{type:"knowledge",value:F,onChange:e=>{S(e),O()}}),(0,t.jsx)(d.default,{showLeftIcon:!0,showClearIcon:!0,wrapperClassName:"w-[200px]",value:I,onChange:e=>R(e.target.value),onClear:()=>R("")}),U&&(0,t.jsx)($,{apiBaseUrl:K?.api_base_url??""}),(0,t.jsx)("div",{className:"h-4 w-[1px] bg-divider-regular"}),(0,t.jsxs)(i.default,{className:"shadows-shadow-xs gap-0.5",onClick:()=>_(!0),children:[(0,t.jsx)(o.ApiConnectionMod,{className:"h-4 w-4 text-components-button-secondary-text"}),(0,t.jsx)("div",{className:"system-sm-medium flex items-center justify-center gap-1 px-0.5 text-components-button-secondary-text",children:e("externalAPIPanelTitle",{ns:"dataset"})})]})]})}),(0,t.jsx)(eg,{tags:z,keywords:P,includeAll:k}),!j.branding.enabled&&(0,t.jsx)(B,{}),N&&(0,t.jsx)(c.default,{type:"knowledge",show:N}),C&&(0,t.jsx)(T,{onClose:()=>_(!1)})]})}],208333)}]);
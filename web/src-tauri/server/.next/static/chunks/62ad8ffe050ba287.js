(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,632815,e=>{"use strict";var a=e.i(615046),s=e.i(236063),t=e.i(562572),n=e.i(214309),l=e.i(648404),i=e.i(367916);e.i(722384);let c="apps",o=new Set(["all",l.AppModeEnum.WORKFLOW,l.AppModeEnum.ADVANCED_CHAT,l.AppModeEnum.CHAT,l.AppModeEnum.AGENT_CHAT,l.AppModeEnum.COMPLETION]),r=e=>{let{page:a=1,limit:s=30,name:t="",mode:n,tag_ids:l,is_created_by_me:i}=e,c=o.has(n)?n:void 0;return{page:a,limit:s,name:t,...c&&"all"!==c?{mode:c}:{},...l?.length?{tag_ids:l}:{},...i?{is_created_by_me:i}:{}}},m=e=>[c,"list",e],d=(e,a,s)=>(0,t.useQuery)({queryKey:[c,"statistics",e,a,s],queryFn:()=>(0,i.get)(`/apps/${a}/statistics/${e}`,{params:s}),enabled:!!a}),u=(e,a,s)=>(0,t.useQuery)({queryKey:[c,"workflow-statistics",e,a,s],queryFn:()=>(0,i.get)(`/apps/${a}/workflow/statistics/${e}`,{params:s}),enabled:!!a});e.s(["useAppApiKeys",0,(e,a)=>(0,t.useQuery)({queryKey:[c,"api-keys",e],queryFn:()=>(0,i.get)(`/apps/${e}/api-keys`),enabled:!!e&&(a?.enabled??!0)}),"useAppAverageResponseTime",0,(e,a)=>d("average-response-time",e,a),"useAppAverageSessionInteractions",0,(e,a)=>d("average-session-interactions",e,a),"useAppDailyConversations",0,(e,a)=>d("daily-conversations",e,a),"useAppDailyEndUsers",0,(e,a)=>d("daily-end-users",e,a),"useAppDailyMessages",0,(e,a)=>d("daily-messages",e,a),"useAppDetail",0,e=>(0,t.useQuery)({queryKey:[c,"detail",e],queryFn:()=>(0,i.get)(`/apps/${e}`),enabled:!!e}),"useAppList",0,(e,a)=>{let s=r(e);return(0,t.useQuery)({queryKey:m(s),queryFn:()=>(0,i.get)("/apps",{params:s}),...a})},"useAppSatisfactionRate",0,(e,a)=>d("user-satisfaction-rate",e,a),"useAppTokenCosts",0,(e,a)=>d("token-costs",e,a),"useAppTokensPerSecond",0,(e,a)=>d("tokens-per-second",e,a),"useAppVoices",0,(e,a)=>(0,t.useQuery)({queryKey:[c,"voices",e,a||"en-US"],queryFn:()=>(0,i.get)(`/apps/${e}/text-to-audio/voices`,{params:{language:a||"en-US"}}),enabled:!!e}),"useGenerateRuleTemplate",0,(e,a)=>(0,t.useQuery)({queryKey:[c,"generate-rule-template",e],queryFn:()=>(0,i.post)("instruction-generate/template",{body:{type:e}}),enabled:!a,retry:0}),"useInfiniteAppList",0,(e,t)=>{let n=r(e);return(0,s.useInfiniteQuery)({queryKey:m(n),queryFn:e=>{let{pageParam:a=n.page}=e;return(0,i.get)("/apps",{params:{...n,page:a}})},getNextPageParam:e=>e.has_more?e.page+1:void 0,initialPageParam:n.page,placeholderData:a.keepPreviousData,...t})},"useInvalidateAppApiKeys",0,()=>{let e=(0,n.useQueryClient)();return a=>{a&&e.invalidateQueries({queryKey:[c,"api-keys",a]})}},"useInvalidateAppList",0,()=>{let e=(0,n.useQueryClient)();return()=>{e.invalidateQueries({queryKey:[c,"list"]})}},"useWorkflowAverageInteractions",0,(e,a)=>u("average-app-interactions",e,a),"useWorkflowDailyConversations",0,(e,a)=>u("daily-conversations",e,a),"useWorkflowDailyTerminals",0,(e,a)=>u("daily-terminals",e,a),"useWorkflowTokenCosts",0,(e,a)=>u("token-costs",e,a)])},261484,e=>{"use strict";var a=e.i(268255),s={SVG:"image/svg+xml",ICO:"image/x-icon",GIF:"image/gif",PNG:"image/png"};let t=function(e){(0,a.useEffect)(function(){if(e){var a=e.split("."),t=a[a.length-1].toLocaleUpperCase(),n=document.querySelector("link[rel*='icon']")||document.createElement("link");n.type=s[t],n.href=e,n.rel="shortcut icon",document.getElementsByTagName("head")[0].appendChild(n)}},[e])};var n=e.i(685888),l=e.i(354440),i={restoreOnUnmount:!1};let c=function(e,s){void 0===s&&(s=i);var t=(0,a.useRef)(l.default?document.title:"");(0,a.useEffect)(function(){document.title=e},[e]),(0,n.default)(function(){s.restoreOnUnmount&&(document.title=t.current)})};var o=e.i(494268),r=e.i(168014);function m(e){let s=(0,o.useIsSystemFeaturesPending)(),n=(0,o.useGlobalPublicStore)(e=>e.systemFeatures),l=e?`${e} - `:"",i="",m="";!1===s&&(n.branding.enabled?(i=`${l}${n.branding.application_title}`,m=n.branding.favicon):(i=`${l}Dify`,m=`${r.basePath}/favicon.ico`)),c(i),(0,a.useEffect)(()=>{let e=null;return n.branding.favicon&&(document.querySelectorAll("link[rel='icon'], link[rel='shortcut icon'], link[rel='apple-touch-icon'], link[rel='mask-icon']").forEach(e=>e.parentNode?.removeChild(e)),(e=document.createElement("link")).rel="apple-touch-icon",e.href=n.branding.favicon,document.head.appendChild(e)),()=>{e?.remove()}},[n.branding.favicon]),t(m)}e.s(["default",()=>m],261484)},212452,e=>{"use strict";var a=e.i(563199),s=e.i(551193),t=e.i(157169),n=e.i(268255),l=e.i(935139);e.s(["default",0,e=>{let{className:i,titleClassName:c,bodyClassName:o,footerClassName:r,titleAs:m,title:d,children:u,footer:x,show:p,onClose:h}=e,y=(0,n.useCallback)(()=>h?.(),[h]);return(0,a.jsx)(t.Transition,{appear:!0,show:p,as:n.Fragment,children:(0,a.jsxs)(s.Dialog,{as:"div",className:"relative z-40",onClose:y,children:[(0,a.jsx)(t.TransitionChild,{children:(0,a.jsx)("div",{className:(0,l.cn)("fixed inset-0 bg-background-overlay-backdrop backdrop-blur-[6px]","duration-300 ease-in data-[closed]:opacity-0","data-[enter]:opacity-100","data-[leave]:opacity-0")})}),(0,a.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,a.jsx)("div",{className:"flex min-h-full items-center justify-center",children:(0,a.jsx)(t.TransitionChild,{children:(0,a.jsxs)(s.DialogPanel,{className:(0,l.cn)("w-full max-w-[800px] overflow-hidden rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg p-6 shadow-xl transition-all","duration-100 ease-in data-[closed]:scale-95 data-[closed]:opacity-0","data-[enter]:scale-100 data-[enter]:opacity-100","data-[enter]:scale-95 data-[leave]:opacity-0",i),children:[!!d&&(0,a.jsx)(s.DialogTitle,{as:m||"h3",className:(0,l.cn)("title-2xl-semi-bold pb-3 pr-8 text-text-primary",c),children:d}),(0,a.jsx)("div",{className:(0,l.cn)(o),children:u}),!!x&&(0,a.jsx)("div",{className:(0,l.cn)("flex items-center justify-end gap-2 px-6 pb-6 pt-3",r),children:x})]})})})})]})})}])},210644,e=>{"use strict";var a=e.i(824627),s=e.i(585458),t=e.i(268255),n=e.i(393689),l=e.i(773923),i=function(e){if(!e)return 0;var a=(0,s.default)(e).valueOf()-Date.now();return a<0?0:a};e.s(["useCountDown",0,function(e){void 0===e&&(e={});var s=e||{},c=s.leftTime,o=s.targetDate,r=s.interval,m=void 0===r?1e3:r,d=s.onEnd,u=(0,t.useMemo)(function(){return(0,l.isNumber)(c)&&c>0?Date.now()+c:void 0},[c]),x="leftTime"in e?u:o,p=(0,a.__read)((0,t.useState)(function(){return i(x)}),2),h=p[0],y=p[1],f=(0,n.default)(d);(0,t.useEffect)(function(){if(!x)return void y(0);y(i(x));var e=setInterval(function(){var a,s=i(x);y(s),0===s&&(clearInterval(e),null==(a=f.current)||a.call(f))},m);return function(){return clearInterval(e)}},[x,m]);var g=(0,t.useMemo)(function(){return{days:Math.floor(h/864e5),hours:Math.floor(h/36e5)%24,minutes:Math.floor(h/6e4)%60,seconds:Math.floor(h/1e3)%60,milliseconds:Math.floor(h)%1e3}},[h]);return[h,g]}],210644)},508430,e=>{"use strict";var a=e.i(563199),s=e.i(210644),t=e.i(268255);e.i(152567);var n=e.i(408767);let l="leftTime";function i(e){let{onResend:i}=e,{t:c}=(0,n.useTranslation)(),[o,r]=(0,t.useState)(()=>Number(localStorage.getItem(l)||59e3)),[m]=(0,s.useCountDown)({leftTime:o,onEnd:()=>{r(0),localStorage.removeItem(l)}}),d=async function(){r(59e3),localStorage.setItem(l,"59000"),i?.()};return(0,t.useEffect)(()=>{localStorage.setItem(l,`${m}`)},[m]),(0,a.jsxs)("p",{className:"system-xs-regular text-text-tertiary",children:[(0,a.jsx)("span",{children:c("checkCode.didNotReceiveCode",{ns:"login"})}),m>0&&(0,a.jsxs)("span",{children:[Math.round(m/1e3),"s"]}),m<=0&&(0,a.jsx)("span",{className:"system-xs-medium cursor-pointer text-text-accent-secondary",onClick:d,children:c("checkCode.resend",{ns:"login"})})]})}e.s(["COUNT_DOWN_KEY",0,l,"COUNT_DOWN_TIME_MS",0,59e3,"default",()=>i])},806893,e=>{"use strict";var a,s=e.i(563199);e.i(152567);var t=e.i(408767),n=e.i(261484),l=e.i(837699),i=e.i(268255),c=e.i(339548),o=e.i(257899),r=e.i(151094),m=e.i(291631),d=e.i(21151),u=e.i(876359),x=e.i(137667),p=e.i(994047);let h=i.forwardRef(function(e,a){let{title:s,titleId:t,...n}=e;return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},n),s?i.createElement("title",{id:t},s):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"}))});var y=e.i(935139);let f=e=>{let{title:a,items:t,renderItem:n,onSelect:l,wrapperClassName:c}=e,[o,r]=(0,i.useState)(!1);return(0,s.jsxs)("div",{className:(0,y.cn)("overflow-hidden rounded-xl bg-background-section-burn",c),children:[(0,s.jsxs)("div",{className:"flex cursor-pointer items-center justify-between px-3 py-2 text-xs font-medium leading-[18px] text-text-secondary",onClick:()=>r(!o),children:[a,o?(0,s.jsx)(p.ChevronDownIcon,{className:"h-3 w-3 text-components-button-tertiary-text"}):(0,s.jsx)(h,{className:"h-3 w-3 text-components-button-tertiary-text"})]}),o&&(0,s.jsx)("div",{className:"mx-1 mb-1 rounded-lg border-t border-divider-subtle bg-components-panel-on-panel-item-bg py-1",children:t.map(e=>(0,s.jsx)("div",{onClick:()=>l?.(e),children:n(e)},e.key))})]})};var g=e.i(925521),v=e.i(711536),j=e.i(494268),b=e.i(56971),N=e.i(81828),w=e.i(632815),C=e.i(212452),k=e.i(508430),E=e.i(554327),S=e.i(875037);let T=(0,e.i(639751).create)(e=>({sendEmailToken:"",setSendEmailToken:a=>e({sendEmailToken:a})}));function A(){let e=T(e=>e.setSendEmailToken);return(0,S.useMutation)({mutationKey:["delete-account"],mutationFn:N.sendDeleteAccountCode,onSuccess:a=>{"success"===a.result&&e(a.data)}})}function _(e){let{t:a}=(0,t.useTranslation)(),{userProfile:n}=(0,v.useAppContext)(),[l,c]=(0,i.useState)(""),{isPending:o,mutateAsync:d}=A(),u=(0,i.useCallback)(async()=>{try{let a=await d();"success"===a.result&&e.onConfirm()}catch(e){console.error(e)}},[d,e]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"body-md-medium py-1 text-text-destructive",children:a("account.deleteTip",{ns:"common"})}),(0,s.jsxs)("div",{className:"body-md-regular pb-2 pt-1 text-text-secondary",children:[a("account.deletePrivacyLinkTip",{ns:"common"}),(0,s.jsx)(E.default,{href:"https://dify.ai/privacy",className:"text-text-accent",children:a("account.deletePrivacyLink",{ns:"common"})})]}),(0,s.jsx)("label",{className:"system-sm-semibold mb-1 mt-3 flex h-6 items-center text-text-secondary",children:a("account.deleteLabel",{ns:"common"})}),(0,s.jsx)(m.default,{placeholder:a("account.deletePlaceholder",{ns:"common"}),onChange:e=>{c(e.target.value)}}),(0,s.jsxs)("div",{className:"mt-3 flex w-full flex-col gap-2",children:[(0,s.jsx)(r.default,{className:"w-full",disabled:l!==n.email||o,loading:o,variant:"primary",onClick:u,children:a("account.sendVerificationButton",{ns:"common"})}),(0,s.jsx)(r.default,{className:"w-full",onClick:e.onCancel,children:a("operation.cancel",{ns:"common"})})]})]})}var P=e.i(326531),I=e.i(873517),D=e.i(652669);function L(e){let{t:a}=(0,t.useTranslation)(),{userProfile:n}=(0,v.useAppContext)(),l=(0,P.useRouter)(),[c,o]=(0,i.useState)(""),{isPending:m,mutateAsync:d}=(0,S.useMutation)({mutationKey:["delete-account-feedback"],mutationFn:N.submitDeleteAccountFeedback}),{mutateAsync:u}=(0,D.useLogout)(),p=(0,i.useCallback)(async()=>{try{await u(),l.push("/signin"),x.default.notify({type:"info",message:a("account.deleteSuccessTip",{ns:"common"})})}catch(e){console.error(e)}},[l,a]),h=(0,i.useCallback)(async()=>{try{await d({feedback:c,email:n.email}),e.onConfirm(),await p()}catch(e){console.error(e)}},[p,c,d,n,e]),y=(0,i.useCallback)(()=>{e.onCancel(),p()},[p,e]);return(0,s.jsxs)(C.default,{show:!0,onClose:e.onCancel,title:a("account.feedbackTitle",{ns:"common"}),className:"max-w-[480px]",footer:!1,children:[(0,s.jsx)("label",{className:"system-sm-semibold mb-1 mt-3 flex items-center text-text-secondary",children:a("account.feedbackLabel",{ns:"common"})}),(0,s.jsx)(I.default,{rows:6,value:c,placeholder:a("account.feedbackPlaceholder",{ns:"common"}),onChange:e=>{o(e.target.value)}}),(0,s.jsxs)("div",{className:"mt-3 flex w-full flex-col gap-2",children:[(0,s.jsx)(r.default,{className:"w-full",loading:m,variant:"primary",onClick:h,children:a("operation.submit",{ns:"common"})}),(0,s.jsx)(r.default,{className:"w-full",onClick:y,children:a("operation.skip",{ns:"common"})})]})]})}let F=/[A-Z\d]{6}/gi;function M(e){let{t:a}=(0,t.useTranslation)(),n=T(e=>e.sendEmailToken),[l,c]=(0,i.useState)(),[o,d]=(0,i.useState)(!0),{mutate:u}=A(),{isPending:x,mutateAsync:p}=(0,S.useMutation)({mutationKey:["confirm-delete-account"],mutationFn:N.verifyDeleteAccountCode});(0,i.useEffect)(()=>{d(!(l&&F.test(l))||x)},[l,x]);let h=(0,i.useCallback)(async()=>{try{let a=await p({code:l,token:n});"success"===a.result&&e.onConfirm()}catch(e){console.error(e)}},[n,l,p,e]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"body-md-medium pt-1 text-text-destructive",children:a("account.deleteTip",{ns:"common"})}),(0,s.jsxs)("div",{className:"body-md-regular pb-2 pt-1 text-text-secondary",children:[a("account.deletePrivacyLinkTip",{ns:"common"}),(0,s.jsx)(E.default,{href:"https://dify.ai/privacy",className:"text-text-accent",children:a("account.deletePrivacyLink",{ns:"common"})})]}),(0,s.jsx)("label",{className:"system-sm-semibold mb-1 mt-3 flex h-6 items-center text-text-secondary",children:a("account.verificationLabel",{ns:"common"})}),(0,s.jsx)(m.default,{minLength:6,maxLength:6,placeholder:a("account.verificationPlaceholder",{ns:"common"}),onChange:e=>{c(e.target.value)}}),(0,s.jsxs)("div",{className:"mt-3 flex w-full flex-col gap-2",children:[(0,s.jsx)(r.default,{className:"w-full",disabled:o,loading:x,variant:"warning",onClick:h,children:a("account.permanentlyDeleteButton",{ns:"common"})}),(0,s.jsx)(r.default,{className:"w-full",onClick:e.onCancel,children:a("operation.cancel",{ns:"common"})}),(0,s.jsx)(k.default,{onResend:u})]})]})}function O(e){let{t:a}=(0,t.useTranslation)(),[n,l]=(0,i.useState)(!1),[c,o]=(0,i.useState)(!1),r=(0,i.useCallback)(async()=>{try{l(!0),localStorage.setItem(k.COUNT_DOWN_KEY,`${k.COUNT_DOWN_TIME_MS}`)}catch(e){console.error(e)}},[]);return c?(0,s.jsx)(L,{onCancel:e.onCancel,onConfirm:e.onConfirm}):(0,s.jsxs)(C.default,{show:!0,onClose:e.onCancel,title:a("account.delete",{ns:"common"}),className:"max-w-[480px]",footer:!1,children:[!n&&(0,s.jsx)(_,{onCancel:e.onCancel,onConfirm:r}),n&&(0,s.jsx)(M,{onCancel:e.onCancel,onConfirm:()=>{o(!0)}})]})}var K=e.i(958898),U=e.i(118042),q=e.i(241661),$=e.i(757198),R=e.i(330276);let Q=e=>{let{onSave:a,...n}=e,{t:o}=(0,t.useTranslation)(),{notify:m}=(0,c.useContext)(x.ToastContext),[u,p]=(0,i.useState)(),[h,y]=(0,i.useState)(!1),[f,v]=(0,i.useState)(!1),[j,b]=(0,i.useState)(!1),[w,C]=(0,i.useState)("left"),[k,E]=(0,i.useState)(!1),S=(0,i.useCallback)(async(e,a,s,t)=>{p(e?{tempUrl:a,croppedAreaPixels:s,fileName:t}:{file:a})},[p]),T=(0,i.useCallback)(async e=>{try{await (0,N.updateUserProfile)({url:"account/avatar",body:{avatar:e}}),y(!1),a?.(),m({type:"success",message:o("actionMsg.modifiedSuccessfully",{ns:"common"})})}catch(e){m({type:"error",message:e.message})}},[m,a,o]),A=(0,i.useCallback)(async()=>{try{await (0,N.updateUserProfile)({url:"account/avatar",body:{avatar:""}}),m({type:"success",message:o("actionMsg.modifiedSuccessfully",{ns:"common"})}),b(!1),a?.()}catch(e){m({type:"error",message:e.message})}},[m,a,o]),{handleLocalFileUpload:_}=(0,R.useLocalFileUploader)({limit:3,disabled:!1,onUpload:e=>{100===e.progress&&(v(!1),p(void 0),T(e.fileId)),-1===e.progress&&v(!1)}}),P=(0,i.useCallback)(async()=>{if(!u)return;if(v(!0),"file"in u)return void _(u.file);let e=await (0,U.default)(u.tempUrl,u.croppedAreaPixels,u.fileName);_(new File([e],u.fileName,{type:e.type}))},[_,u]);return g.DISABLE_UPLOAD_IMAGE_AS_ICON?(0,s.jsx)(q.default,{...n}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{children:(0,s.jsxs)("div",{className:"group relative",children:[(0,s.jsx)(q.default,{...n,onError:e=>E(e)}),(0,s.jsx)("div",{className:"absolute inset-0 flex cursor-pointer items-center justify-center rounded-full bg-black/50 opacity-0 transition-opacity group-hover:opacity-100",onClick:()=>{"right"!==w||k?y(!0):b(!0)},onMouseMove:e=>{let a=e.currentTarget.getBoundingClientRect();C(e.clientX-a.left>a.width/2?"right":"left")},children:"right"!==w||k?(0,s.jsx)("span",{className:"text-xs text-white",children:(0,s.jsx)(l.RiPencilLine,{})}):(0,s.jsx)("span",{className:"text-xs text-white",children:(0,s.jsx)(l.RiDeleteBin5Line,{})})})]})}),(0,s.jsxs)(d.default,{closable:!0,className:"!w-[362px] !p-0",isShow:h,onClose:()=>y(!1),children:[(0,s.jsx)(K.default,{onImageInput:S,cropShape:"round"}),(0,s.jsx)($.default,{className:"m-0"}),(0,s.jsxs)("div",{className:"flex w-full items-center justify-center gap-2 p-3",children:[(0,s.jsx)(r.default,{className:"w-full",onClick:()=>y(!1),children:o("iconPicker.cancel",{ns:"app"})}),(0,s.jsx)(r.default,{variant:"primary",className:"w-full",disabled:f||!u,loading:f,onClick:P,children:o("iconPicker.ok",{ns:"app"})})]})]}),(0,s.jsxs)(d.default,{closable:!0,className:"!w-[362px] !p-6",isShow:j,onClose:()=>b(!1),children:[(0,s.jsx)("div",{className:"title-2xl-semi-bold mb-3 text-text-primary",children:o("avatar.deleteTitle",{ns:"common"})}),(0,s.jsx)("p",{className:"mb-8 text-text-secondary",children:o("avatar.deleteDescription",{ns:"common"})}),(0,s.jsxs)("div",{className:"flex w-full items-center justify-center gap-2",children:[(0,s.jsx)(r.default,{className:"w-full",onClick:()=>b(!1),children:o("operation.cancel",{ns:"common"})}),(0,s.jsx)(r.default,{variant:"warning",className:"w-full",onClick:A,children:o("operation.delete",{ns:"common"})})]})]})]})};var z=e.i(124836),G=e.i(321734),W=e.i(842090),B=((a=B||{}).start="start",a.verifyOrigin="verifyOrigin",a.newEmail="newEmail",a.verifyNew="verifyNew",a);let V=e=>{let{onClose:a,email:n,show:o}=e,{t:u}=(0,t.useTranslation)(),{notify:p}=(0,c.useContext)(x.ToastContext),h=(0,P.useRouter)(),[y,f]=(0,i.useState)("start"),[g,v]=(0,i.useState)(""),[j,b]=(0,i.useState)(""),[w,C]=(0,i.useState)(0),[k,E]=(0,i.useState)(""),[S,T]=(0,i.useState)(!1),[A,_]=(0,i.useState)(!1),[I,L]=(0,i.useState)(!1),F=async(e,a,s)=>{try{let t,n=await (0,N.sendVerifyCode)({email:e,phase:a?"old_email":"new_email",token:s});C(60),t=setInterval(()=>{C(e=>e<=0?(clearInterval(t),0):e-1)},1e3),n.data&&E(n.data)}catch(e){p({type:"error",message:`Error sending verification code: ${e?e.message:""}`})}},M=async(e,a,s,t)=>{try{let n=await (0,N.verifyEmail)({email:e,code:a,token:s});n.is_valid?(E(n.token),t?.(n.token)):p({type:"error",message:"Verifying email failed"})}catch(e){p({type:"error",message:`Error verifying email: ${e?e.message:""}`})}},O=async()=>{await F(n,!0),f("verifyOrigin")},K=async()=>{await M(n,g,k,()=>f("newEmail")),v("")},U=e=>/^[\w.!#$%&'*+/=?^`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i.test(e)&&e.length<=254,q=async e=>{L(!0);try{await (0,N.checkEmailExisted)({email:e}),T(!1),_(!1)}catch(e){if(400===e.status){let[,a]=await (0,W.asyncRunSafe)(e.json()),{code:s}=a||{};"email_already_in_use"===s&&T(!0),"account_in_freeze"===s&&_(!0)}}finally{L(!1)}},$=async()=>{U(j)?(await F(j,!1,k),f("verifyNew")):p({type:"error",message:"Invalid email format"})},{mutateAsync:R}=(0,D.useLogout)(),Q=async()=>{await R(),localStorage.removeItem("setup_status"),h.push("/signin")},B=async e=>{try{await (0,N.resetEmail)({new_email:j,token:e}),Q()}catch(e){p({type:"error",message:`Error changing email: ${e?e.message:""}`})}},V=async()=>{await M(j,g,k,B)};return(0,s.jsxs)(d.default,{isShow:o,onClose:z.noop,className:"!w-[420px] !p-6",children:[(0,s.jsx)("div",{className:"absolute right-5 top-5 cursor-pointer p-1.5",onClick:a,children:(0,s.jsx)(l.RiCloseLine,{className:"h-5 w-5 text-text-tertiary"})}),"start"===y&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"title-2xl-semi-bold pb-3 text-text-primary",children:u("account.changeEmail.title",{ns:"common"})}),(0,s.jsxs)("div",{className:"space-y-0.5 pb-2 pt-1",children:[(0,s.jsx)("div",{className:"body-md-medium text-text-warning",children:u("account.changeEmail.authTip",{ns:"common"})}),(0,s.jsx)("div",{className:"body-md-regular text-text-secondary",children:(0,s.jsx)(G.Trans,{i18nKey:"account.changeEmail.content1",ns:"common",components:{email:(0,s.jsx)("span",{className:"body-md-medium text-text-primary"})},values:{email:n}})})]}),(0,s.jsx)("div",{className:"pt-3"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.default,{className:"!w-full",variant:"primary",onClick:O,children:u("account.changeEmail.sendVerifyCode",{ns:"common"})}),(0,s.jsx)(r.default,{className:"!w-full",onClick:a,children:u("operation.cancel",{ns:"common"})})]})]}),"verifyOrigin"===y&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"title-2xl-semi-bold pb-3 text-text-primary",children:u("account.changeEmail.verifyEmail",{ns:"common"})}),(0,s.jsx)("div",{className:"space-y-0.5 pb-2 pt-1",children:(0,s.jsx)("div",{className:"body-md-regular text-text-secondary",children:(0,s.jsx)(G.Trans,{i18nKey:"account.changeEmail.content2",ns:"common",components:{email:(0,s.jsx)("span",{className:"body-md-medium text-text-primary"})},values:{email:n}})})}),(0,s.jsxs)("div",{className:"pt-3",children:[(0,s.jsx)("div",{className:"system-sm-medium mb-1 flex h-6 items-center text-text-secondary",children:u("account.changeEmail.codeLabel",{ns:"common"})}),(0,s.jsx)(m.default,{className:"!w-full",placeholder:u("account.changeEmail.codePlaceholder",{ns:"common"}),value:g,onChange:e=>v(e.target.value),maxLength:6})]}),(0,s.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,s.jsx)(r.default,{disabled:6!==g.length,className:"!w-full",variant:"primary",onClick:K,children:u("account.changeEmail.continue",{ns:"common"})}),(0,s.jsx)(r.default,{className:"!w-full",onClick:a,children:u("operation.cancel",{ns:"common"})})]}),(0,s.jsxs)("div",{className:"system-xs-regular mt-3 flex items-center gap-1 text-text-tertiary",children:[(0,s.jsx)("span",{children:u("account.changeEmail.resendTip",{ns:"common"})}),w>0&&(0,s.jsx)("span",{children:u("account.changeEmail.resendCount",{ns:"common",count:w})}),!w&&(0,s.jsx)("span",{onClick:O,className:"system-xs-medium cursor-pointer text-text-accent-secondary",children:u("account.changeEmail.resend",{ns:"common"})})]})]}),"newEmail"===y&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"title-2xl-semi-bold pb-3 text-text-primary",children:u("account.changeEmail.newEmail",{ns:"common"})}),(0,s.jsx)("div",{className:"space-y-0.5 pb-2 pt-1",children:(0,s.jsx)("div",{className:"body-md-regular text-text-secondary",children:u("account.changeEmail.content3",{ns:"common"})})}),(0,s.jsxs)("div",{className:"pt-3",children:[(0,s.jsx)("div",{className:"system-sm-medium mb-1 flex h-6 items-center text-text-secondary",children:u("account.changeEmail.emailLabel",{ns:"common"})}),(0,s.jsx)(m.default,{className:"!w-full",placeholder:u("account.changeEmail.emailPlaceholder",{ns:"common"}),value:j,onChange:e=>{var a;b(a=e.target.value),T(!1),U(a)&&q(a)},destructive:S||A}),S&&(0,s.jsx)("div",{className:"body-xs-regular mt-1 py-0.5 text-text-destructive",children:u("account.changeEmail.existingEmail",{ns:"common"})}),A&&(0,s.jsx)("div",{className:"body-xs-regular mt-1 py-0.5 text-text-destructive",children:u("account.changeEmail.unAvailableEmail",{ns:"common"})})]}),(0,s.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,s.jsx)(r.default,{disabled:!j||S||A||I||!U(j),className:"!w-full",variant:"primary",onClick:$,children:u("account.changeEmail.sendVerifyCode",{ns:"common"})}),(0,s.jsx)(r.default,{className:"!w-full",onClick:a,children:u("operation.cancel",{ns:"common"})})]})]}),"verifyNew"===y&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"title-2xl-semi-bold pb-3 text-text-primary",children:u("account.changeEmail.verifyNew",{ns:"common"})}),(0,s.jsx)("div",{className:"space-y-0.5 pb-2 pt-1",children:(0,s.jsx)("div",{className:"body-md-regular text-text-secondary",children:(0,s.jsx)(G.Trans,{i18nKey:"account.changeEmail.content4",ns:"common",components:{email:(0,s.jsx)("span",{className:"body-md-medium text-text-primary"})},values:{email:j}})})}),(0,s.jsxs)("div",{className:"pt-3",children:[(0,s.jsx)("div",{className:"system-sm-medium mb-1 flex h-6 items-center text-text-secondary",children:u("account.changeEmail.codeLabel",{ns:"common"})}),(0,s.jsx)(m.default,{className:"!w-full",placeholder:u("account.changeEmail.codePlaceholder",{ns:"common"}),value:g,onChange:e=>v(e.target.value),maxLength:6})]}),(0,s.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,s.jsx)(r.default,{disabled:6!==g.length,className:"!w-full",variant:"primary",onClick:V,children:u("account.changeEmail.changeTo",{ns:"common",email:j})}),(0,s.jsx)(r.default,{className:"!w-full",onClick:a,children:u("operation.cancel",{ns:"common"})})]}),(0,s.jsxs)("div",{className:"system-xs-regular mt-3 flex items-center gap-1 text-text-tertiary",children:[(0,s.jsx)("span",{children:u("account.changeEmail.resendTip",{ns:"common"})}),w>0&&(0,s.jsx)("span",{children:u("account.changeEmail.resendCount",{ns:"common",count:w})}),!w&&(0,s.jsx)("span",{onClick:$,className:"system-xs-medium cursor-pointer text-text-accent-secondary",children:u("account.changeEmail.resend",{ns:"common"})})]})]})]})},H=`
  system-sm-semibold text-text-secondary
`,Y=`
  mt-1 body-xs-regular text-text-tertiary
`;function X(){let{t:e}=(0,t.useTranslation)(),{systemFeatures:a}=(0,j.useGlobalPublicStore)(),{data:n}=(0,w.useAppList)({page:1,limit:100,name:""}),p=n?.data||[],{mutateUserProfile:h,userProfile:y}=(0,v.useAppContext)(),{isEducationAccount:C}=(0,b.useProviderContext)(),{notify:k}=(0,c.useContext)(x.ToastContext),[E,S]=(0,i.useState)(!1),[T,A]=(0,i.useState)(""),[_,P]=(0,i.useState)(!1),[I,D]=(0,i.useState)(!1),[L,F]=(0,i.useState)(""),[M,K]=(0,i.useState)(""),[U,q]=(0,i.useState)(""),[$,R]=(0,i.useState)(!1),[z,G]=(0,i.useState)(!1),[W,B]=(0,i.useState)(!1),[X,Z]=(0,i.useState)(!1),[J,ee]=(0,i.useState)(!1),ea=async()=>{try{P(!0),await (0,N.updateUserProfile)({url:"account/name",body:{name:T}}),k({type:"success",message:e("actionMsg.modifiedSuccessfully",{ns:"common"})}),h(),S(!1),P(!1)}catch(e){k({type:"error",message:e.message}),P(!1)}},es=e=>{k({type:"error",message:e})},et=()=>{F(""),K(""),q("")},en=async()=>{if(M.trim()?g.validPassword.test(M)?M===U||(es(e("account.notEqual",{ns:"common"})),!1):(es(e("error.passwordInvalid",{ns:"login"})),!1):(es(e("error.passwordEmpty",{ns:"login"})),!1))try{P(!0),await (0,N.updateUserProfile)({url:"account/password",body:{password:L,new_password:M,repeat_new_password:U}}),k({type:"success",message:e("actionMsg.modifiedSuccessfully",{ns:"common"})}),h(),D(!1),et(),P(!1)}catch(e){k({type:"error",message:e.message}),D(!1),P(!1)}};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"pb-3 pt-2",children:(0,s.jsx)("h4",{className:"title-2xl-semi-bold text-text-primary",children:e("account.myAccount",{ns:"common"})})}),(0,s.jsxs)("div",{className:"mb-8 flex items-center rounded-xl bg-gradient-to-r from-background-gradient-bg-fill-chat-bg-2 to-background-gradient-bg-fill-chat-bg-1 p-6",children:[(0,s.jsx)(Q,{avatar:y.avatar_url,name:y.name,onSave:h,size:64}),(0,s.jsxs)("div",{className:"ml-4",children:[(0,s.jsxs)("p",{className:"system-xl-semibold text-text-primary",children:[y.name,C&&(0,s.jsxs)(u.default,{size:"s",color:"blue",className:"ml-1 !px-2",children:[(0,s.jsx)(l.RiGraduationCapFill,{className:"mr-1 h-3 w-3"}),(0,s.jsx)("span",{className:"system-2xs-medium",children:"EDU"})]})]}),(0,s.jsx)("p",{className:"system-xs-regular text-text-tertiary",children:y.email})]})]}),(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("div",{className:H,children:e("account.name",{ns:"common"})}),(0,s.jsxs)("div",{className:"mt-2 flex w-full items-center justify-between gap-2",children:[(0,s.jsx)("div",{className:"system-sm-regular flex-1 rounded-lg bg-components-input-bg-normal p-2 text-components-input-text-filled ",children:(0,s.jsx)("span",{className:"pl-1",children:y.name})}),(0,s.jsx)("div",{className:"system-sm-medium cursor-pointer rounded-lg bg-components-button-tertiary-bg px-3 py-2 text-components-button-tertiary-text",onClick:()=>{S(!0),A(y.name)},children:e("operation.edit",{ns:"common"})})]})]}),(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("div",{className:H,children:e("account.email",{ns:"common"})}),(0,s.jsxs)("div",{className:"mt-2 flex w-full items-center justify-between gap-2",children:[(0,s.jsx)("div",{className:"system-sm-regular flex-1 rounded-lg bg-components-input-bg-normal p-2 text-components-input-text-filled ",children:(0,s.jsx)("span",{className:"pl-1",children:y.email})}),a.enable_change_email&&(0,s.jsx)("div",{className:"system-sm-medium cursor-pointer rounded-lg bg-components-button-tertiary-bg px-3 py-2 text-components-button-tertiary-text",onClick:()=>ee(!0),children:e("operation.change",{ns:"common"})})]})]}),a.enable_email_password_login&&(0,s.jsxs)("div",{className:"mb-8 flex justify-between gap-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"system-sm-semibold mb-1 text-text-secondary",children:e("account.password",{ns:"common"})}),(0,s.jsx)("div",{className:"body-xs-regular mb-2 text-text-tertiary",children:e("account.passwordTip",{ns:"common"})})]}),(0,s.jsx)(r.default,{onClick:()=>D(!0),children:y.is_password_set?e("account.resetPassword",{ns:"common"}):e("account.setPassword",{ns:"common"})})]}),(0,s.jsx)("div",{className:"mb-6 border-[1px] border-divider-subtle"}),(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("div",{className:H,children:e("account.langGeniusAccount",{ns:"common"})}),(0,s.jsx)("div",{className:Y,children:e("account.langGeniusAccountTip",{ns:"common"})}),!!p.length&&(0,s.jsx)(f,{title:`${e("account.showAppLength",{ns:"common",length:p.length})}`,items:p.map(e=>({...e,key:e.id,name:e.name})),renderItem:e=>{let{icon:a,icon_background:t,icon_type:n,icon_url:l}=e;return(0,s.jsxs)("div",{className:"flex px-3 py-1",children:[(0,s.jsx)("div",{className:"mr-3",children:(0,s.jsx)(o.default,{size:"tiny",iconType:n,icon:a,background:t,imageUrl:l})}),(0,s.jsx)("div",{className:"system-sm-medium mt-[3px] text-text-secondary",children:e.name})]})},wrapperClassName:"mt-2"}),!g.IS_CE_EDITION&&(0,s.jsx)(r.default,{className:"mt-2 text-components-button-destructive-secondary-text",onClick:()=>R(!0),children:e("account.delete",{ns:"common"})})]}),E&&(0,s.jsxs)(d.default,{isShow:!0,onClose:()=>S(!1),className:"!w-[420px] !p-6",children:[(0,s.jsx)("div",{className:"title-2xl-semi-bold mb-6 text-text-primary",children:e("account.editName",{ns:"common"})}),(0,s.jsx)("div",{className:H,children:e("account.name",{ns:"common"})}),(0,s.jsx)(m.default,{className:"mt-2",value:T,onChange:e=>A(e.target.value)}),(0,s.jsxs)("div",{className:"mt-10 flex justify-end",children:[(0,s.jsx)(r.default,{className:"mr-2",onClick:()=>S(!1),children:e("operation.cancel",{ns:"common"})}),(0,s.jsx)(r.default,{disabled:_||!T,variant:"primary",onClick:ea,children:e("operation.save",{ns:"common"})})]})]}),I&&(0,s.jsxs)(d.default,{isShow:!0,onClose:()=>{D(!1),et()},className:"!w-[420px] !p-6",children:[(0,s.jsx)("div",{className:"title-2xl-semi-bold mb-6 text-text-primary",children:y.is_password_set?e("account.resetPassword",{ns:"common"}):e("account.setPassword",{ns:"common"})}),y.is_password_set&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:H,children:e("account.currentPassword",{ns:"common"})}),(0,s.jsxs)("div",{className:"relative mt-2",children:[(0,s.jsx)(m.default,{type:z?"text":"password",value:L,onChange:e=>F(e.target.value)}),(0,s.jsx)("div",{className:"absolute inset-y-0 right-0 flex items-center",children:(0,s.jsx)(r.default,{type:"button",variant:"ghost",onClick:()=>G(!z),children:z?"ðŸ‘€":"ðŸ˜"})})]})]}),(0,s.jsx)("div",{className:"system-sm-semibold mt-8 text-text-secondary",children:y.is_password_set?e("account.newPassword",{ns:"common"}):e("account.password",{ns:"common"})}),(0,s.jsxs)("div",{className:"relative mt-2",children:[(0,s.jsx)(m.default,{type:W?"text":"password",value:M,onChange:e=>K(e.target.value)}),(0,s.jsx)("div",{className:"absolute inset-y-0 right-0 flex items-center",children:(0,s.jsx)(r.default,{type:"button",variant:"ghost",onClick:()=>B(!W),children:W?"ðŸ‘€":"ðŸ˜"})})]}),(0,s.jsx)("div",{className:"system-sm-semibold mt-8 text-text-secondary",children:e("account.confirmPassword",{ns:"common"})}),(0,s.jsxs)("div",{className:"relative mt-2",children:[(0,s.jsx)(m.default,{type:X?"text":"password",value:U,onChange:e=>q(e.target.value)}),(0,s.jsx)("div",{className:"absolute inset-y-0 right-0 flex items-center",children:(0,s.jsx)(r.default,{type:"button",variant:"ghost",onClick:()=>Z(!X),children:X?"ðŸ‘€":"ðŸ˜"})})]}),(0,s.jsxs)("div",{className:"mt-10 flex justify-end",children:[(0,s.jsx)(r.default,{className:"mr-2",onClick:()=>{D(!1),et()},children:e("operation.cancel",{ns:"common"})}),(0,s.jsx)(r.default,{disabled:_,variant:"primary",onClick:en,children:y.is_password_set?e("operation.reset",{ns:"common"}):e("operation.save",{ns:"common"})})]})]}),$&&(0,s.jsx)(O,{onCancel:()=>R(!1),onConfirm:()=>R(!1)}),J&&(0,s.jsx)(V,{show:J,onClose:()=>ee(!1),email:y.email})]})}function Z(){let{t:e}=(0,t.useTranslation)();return(0,n.default)(e("menus.account",{ns:"common"})),(0,s.jsx)("div",{className:"mx-auto w-full max-w-[640px] px-6 pt-12",children:(0,s.jsx)(X,{})})}e.s(["default",()=>Z],806893)}]);
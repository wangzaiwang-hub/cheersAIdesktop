(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,787735,e=>{"use strict";var s,t=e.i(563199),a=e.i(268255),n=e.i(339548),l=e.i(449980),r=e.i(271743),i=e.i(261484),o=e.i(935139),c=e.i(199947),d=e.i(446880),p=e.i(257899);e.i(152567);var u=e.i(408767),m=e.i(151094);e.i(237855);var x=e.i(910605),h=e.i(291631),g=e.i(299951),b=e.i(873517),f=e.i(371784),v=e.i(481162),j=e.i(955371),y=e.i(390622),w=e.i(124836);let N=(0,n.createContext)({currentConversationId:"",appPrevChatTree:[],pinnedConversationList:[],conversationList:[],newConversationInputs:{},newConversationInputsRef:{current:{}},handleNewConversationInputsChange:w.noop,inputsForms:[],handleNewConversation:w.noop,handleStartChat:w.noop,handleChangeConversation:w.noop,handlePinConversation:w.noop,handleUnpinConversation:w.noop,handleDeleteConversation:w.noop,conversationRenaming:!1,handleRenameConversation:w.noop,handleNewConversationCompleted:w.noop,chatShouldReloadKey:"",isMobile:!1,isInstalledApp:!1,handleFeedback:w.noop,currentChatInstanceRef:{current:{handleStop:w.noop}},sidebarCollapseState:!1,handleSidebarCollapse:w.noop,clearChatList:!1,setClearChatList:w.noop,isResponding:!1,setIsResponding:w.noop,currentConversationInputs:{},setCurrentConversationInputs:w.noop,allInputsHidden:!1,initUserVariables:{}}),_=()=>(0,n.useContext)(N),C=(0,a.memo)(e=>{let{showTip:s}=e,{t:n}=(0,u.useTranslation)(),{appParams:l,inputsForms:r,currentConversationId:i,currentConversationInputs:o,setCurrentConversationInputs:c,newConversationInputs:d,newConversationInputsRef:p,handleNewConversationInputsChange:m}=_(),w=i?o:d,N=(0,a.useCallback)((e,s)=>{c({...o,[e]:s}),m({...p.current,[e]:s})},[p,m,o,c]),C=r.filter(e=>!0!==e.hide);return(0,t.jsxs)("div",{className:"space-y-4",children:[C.map(e=>(0,t.jsxs)("div",{className:"space-y-1",children:[e.type!==y.InputVarType.checkbox&&(0,t.jsxs)("div",{className:"flex h-6 items-center gap-1",children:[(0,t.jsx)("div",{className:"system-md-semibold text-text-secondary",children:e.label}),!e.required&&(0,t.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:n("panel.optional",{ns:"workflow"})})]}),e.type===y.InputVarType.textInput&&(0,t.jsx)(h.default,{value:w?.[e.variable]||"",onChange:s=>N(e.variable,s.target.value),placeholder:e.label}),e.type===y.InputVarType.number&&(0,t.jsx)(h.default,{type:"number",value:w?.[e.variable]||"",onChange:s=>N(e.variable,s.target.value),placeholder:e.label}),e.type===y.InputVarType.paragraph&&(0,t.jsx)(b.default,{value:w?.[e.variable]||"",onChange:s=>N(e.variable,s.target.value),placeholder:e.label}),e.type===y.InputVarType.checkbox&&(0,t.jsx)(f.default,{name:e.label,value:!!w?.[e.variable],required:e.required,onChange:s=>N(e.variable,s)}),e.type===y.InputVarType.select&&(0,t.jsx)(g.PortalSelect,{popupClassName:"w-[200px]",value:w?.[e.variable]??e.default??"",items:e.options.map(e=>({value:e,name:e})),onSelect:s=>N(e.variable,s.value),placeholder:e.label}),e.type===y.InputVarType.singleFile&&(0,t.jsx)(x.FileUploaderInAttachmentWrapper,{value:w?.[e.variable]?[w?.[e.variable]]:[],onChange:s=>N(e.variable,s[0]),fileConfig:{allowed_file_types:e.allowed_file_types,allowed_file_extensions:e.allowed_file_extensions,allowed_file_upload_methods:e.allowed_file_upload_methods,number_limits:1,fileUploadConfig:l.system_parameters}}),e.type===y.InputVarType.multiFiles&&(0,t.jsx)(x.FileUploaderInAttachmentWrapper,{value:w?.[e.variable]||[],onChange:s=>N(e.variable,s),fileConfig:{allowed_file_types:e.allowed_file_types,allowed_file_extensions:e.allowed_file_extensions,allowed_file_upload_methods:e.allowed_file_upload_methods,number_limits:e.max_length,fileUploadConfig:l.system_parameters}}),e.type===y.InputVarType.jsonObject&&(0,t.jsx)(v.default,{language:j.CodeLanguage.json,value:w?.[e.variable]||"",onChange:s=>N(e.variable,s),noWrapper:!0,className:"bg h-[80px] overflow-y-auto rounded-[10px] bg-components-input-bg-normal p-1",placeholder:(0,t.jsx)("div",{className:"whitespace-pre",children:e.json_schema})})]},e.variable)),s&&(0,t.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:n("chat.chatFormTip",{ns:"share"})})]})});var k=e.i(757198);e.i(8482);var S=e.i(112727);let T=e=>{let{collapsed:s,setCollapsed:a}=e,{t:n}=(0,u.useTranslation)(),{isMobile:l,currentConversationId:r,handleStartChat:i,allInputsHidden:c,themeBuilder:d,inputsForms:p}=_();return c||0===p.length?null:(0,t.jsxs)("div",{className:(0,o.cn)("flex flex-col items-center px-4 pt-6",l&&"pt-4"),children:[(0,t.jsxs)("div",{className:(0,o.cn)("w-full max-w-[672px] rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-md",s&&"border border-components-card-border bg-components-card-bg shadow-none"),children:[(0,t.jsxs)("div",{className:(0,o.cn)("flex items-center gap-3 rounded-t-2xl px-6 py-4",!s&&"border-b border-divider-subtle",l&&"px-4 py-3"),children:[(0,t.jsx)(S.Message3Fill,{className:"h-6 w-6 shrink-0"}),(0,t.jsx)("div",{className:"system-xl-semibold grow text-text-secondary",children:n("chat.chatSettingsTitle",{ns:"share"})}),s&&(0,t.jsx)(m.default,{className:"uppercase text-text-tertiary",size:"small",variant:"ghost",onClick:()=>a(!1),children:n("operation.edit",{ns:"common"})}),!s&&r&&(0,t.jsx)(m.default,{className:"uppercase text-text-tertiary",size:"small",variant:"ghost",onClick:()=>a(!0),children:n("operation.close",{ns:"common"})})]}),!s&&(0,t.jsx)("div",{className:(0,o.cn)("p-6",l&&"p-4"),children:(0,t.jsx)(C,{})}),!s&&!r&&(0,t.jsx)("div",{className:(0,o.cn)("p-6",l&&"p-4"),children:(0,t.jsx)(m.default,{variant:"primary",className:"w-full",onClick:()=>i(()=>a(!0)),style:d?.theme?{backgroundColor:d?.theme.primaryColor}:{},children:n("chat.startChat",{ns:"share"})})})]}),s&&(0,t.jsxs)("div",{className:"flex w-full max-w-[720px] items-center py-4",children:[(0,t.jsx)(k.default,{bgStyle:"gradient",className:"h-px basis-1/2 rotate-180"}),(0,t.jsx)(k.default,{bgStyle:"gradient",className:"h-px basis-1/2"})]})]})};var A=e.i(12841),I=e.i(379415),R=e.i(447301),M=e.i(648404),F=e.i(680884),E=e.i(241661),L=e.i(34510),P=e.i(326773),D=e.i(53349);let z=()=>{let{appParams:e,appPrevChatTree:s,currentConversationId:n,currentConversationItem:l,currentConversationInputs:r,inputsForms:i,newConversationInputs:c,newConversationInputsRef:u,handleNewConversationCompleted:m,isMobile:x,isInstalledApp:h,appId:g,appMeta:b,handleFeedback:f,currentChatInstanceRef:v,appData:j,themeBuilder:w,sidebarCollapseState:N,clearChatList:C,setClearChatList:k,setIsResponding:S,allInputsHidden:z,initUserVariables:O}=_(),B=h?R.AppSourceType.installedApp:R.AppSourceType.webApp,U=!!n,V=(0,a.useMemo)(()=>{let s=e||{};return{...s,file_upload:{...s.file_upload,fileUploadConfig:s.system_parameters},supportFeedback:!0,opening_statement:l?.introduction||s.opening_statement}},[e,l?.introduction]),{chatList:W,setTargetMessageId:q,handleSend:$,handleStop:G,isResponding:H,suggestedQuestions:K}=(0,P.useChat)(V,{inputs:n?r:c,inputsForm:i},s,e=>(0,R.stopChatMessageResponding)("",e,B,g),C,k),Q=n?r:u?.current,Y=(0,a.useMemo)(()=>{if(z)return!1;let e="",s=!1,t=i.filter(e=>{let{required:s,type:t}=e;return s&&t!==y.InputVarType.checkbox});return t.length&&t.forEach(t=>{let{variable:a,label:n,type:l}=t;if(!e&&!s&&(Q?.[a]||(e=n),(l===y.InputVarType.singleFile||l===y.InputVarType.multiFiles)&&Q?.[a])){let e=Q[a];s=Array.isArray(e)?e.find(e=>e.transferMethod===M.TransferMethod.local_file&&!e.uploadedId):e.transferMethod===M.TransferMethod.local_file&&!e.uploadedId}}),!!e||!!s},[Q,i,z]);(0,a.useEffect)(()=>{v.current&&(v.current.handleStop=G)},[]),(0,a.useEffect)(()=>{S(H)},[H,S]);let J=(0,a.useCallback)(function(e,s){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l={query:e,files:s,inputs:(0,F.formatBooleanInputs)(i,n?r:c),conversation_id:n,parent_message_id:(t?a?.id:(0,D.getLastAnswer)(W)?.id)||null};$((0,R.getUrl)("chat-messages",B,g||""),l,{onGetSuggestedQuestions:e=>(0,R.fetchSuggestedQuestions)(e,B,g),onConversationComplete:U?void 0:m,isPublicAPI:!h})},[W,m,$,n,r,c,h,g]),X=(0,a.useCallback)((e,s)=>{let t=s?e:W.find(s=>s.id===e.parentMessageId),a=W.find(e=>e.id===t.parentMessageId);J(s?s.message:t.content,s?s.files:t.message_files,!0,(0,D.isValidGeneratedAnswer)(a)?a:null)},[W,J]),Z=(0,a.useMemo)(()=>n||W.length>1?W:W.filter(e=>!e.isOpeningStatement),[W]),[ee,es]=(0,a.useState)(!!n),et=(0,a.useMemo)(()=>z||!i.length||x&&n?null:(0,t.jsx)(T,{collapsed:ee,setCollapsed:es}),[i.length,x,n,ee,z]),ea=(0,a.useMemo)(()=>{let e=W.find(e=>e.isOpeningStatement);return H||n||!e||!ee&&i.length>0&&!z?null:e.suggestedQuestions&&e.suggestedQuestions?.length>0?(0,t.jsx)("div",{className:"flex min-h-[50vh] items-center justify-center px-4 py-12",children:(0,t.jsxs)("div",{className:"flex max-w-[720px] grow gap-4",children:[(0,t.jsx)(p.default,{size:"xl",iconType:j?.site.icon_type,icon:j?.site.icon,background:j?.site.icon_background,imageUrl:j?.site.icon_url}),(0,t.jsx)("div",{className:"w-0 grow",children:(0,t.jsxs)("div",{className:"body-lg-regular grow rounded-2xl bg-chat-bubble-bg px-4 py-3 text-text-primary",children:[(0,t.jsx)(I.Markdown,{content:e.content}),(0,t.jsx)(A.default,{item:e})]})})]})}):(0,t.jsxs)("div",{className:(0,o.cn)("flex min-h-[50vh] flex-col items-center justify-center gap-3 py-12"),children:[(0,t.jsx)(p.default,{size:"xl",iconType:j?.site.icon_type,icon:j?.site.icon,background:j?.site.icon_background,imageUrl:j?.site.icon_url}),(0,t.jsx)("div",{className:"max-w-[768px] px-4",children:(0,t.jsx)(I.Markdown,{className:"!body-2xl-regular !text-text-tertiary",content:e.content})})]})},[j?.site.icon,j?.site.icon_background,j?.site.icon_type,j?.site.icon_url,W,ee,n,i.length,H,z]),en=j?.site&&j.site.use_icon_as_answer_icon?(0,t.jsx)(d.default,{iconType:j.site.icon_type,icon:j.site.icon,background:j.site.icon_background,imageUrl:j.site.icon_url}):null;return(0,t.jsx)("div",{className:"h-full overflow-hidden bg-chatbot-bg",children:(0,t.jsx)(L.default,{appData:j??void 0,config:V,chatList:Z,isResponding:H,chatContainerInnerClassName:`mx-auto pt-6 w-full max-w-[768px] ${x&&"px-4"}`,chatFooterClassName:"pb-4",chatFooterInnerClassName:`mx-auto w-full max-w-[768px] ${x?"px-2":"px-4"}`,onSend:J,inputs:n?r:c,inputsForm:i,onRegenerate:X,onStopResponding:G,chatNode:(0,t.jsxs)(t.Fragment,{children:[et,ea]}),allToolIcons:b?.tool_icons||{},onFeedback:f,suggestedQuestions:K,answerIcon:en,hideProcessDetail:!0,themeBuilder:w,switchSibling:e=>q(e),inputDisabled:Y,sidebarCollapseState:N,questionIcon:O?.avatar_url?(0,t.jsx)(E.default,{avatar:O.avatar_url,name:O.name||"user",size:40}):void 0})})};var O=e.i(837699),B=e.i(654313),U=e.i(391185);let V=()=>{let{t:e}=(0,u.useTranslation)(),[s,n]=(0,a.useState)(!1);return(0,t.jsxs)(U.PortalToFollowElem,{open:s,onOpenChange:n,placement:"bottom-end",offset:{mainAxis:4,crossAxis:4},children:[(0,t.jsx)(U.PortalToFollowElemTrigger,{onClick:()=>n(e=>!e),children:(0,t.jsx)(B.default,{size:"l",state:s?B.ActionButtonState.Hover:B.ActionButtonState.Default,children:(0,t.jsx)(O.RiChatSettingsLine,{className:"h-[18px] w-[18px]"})})}),(0,t.jsx)(U.PortalToFollowElemContent,{className:"z-50",children:(0,t.jsxs)("div",{className:"w-[400px] rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-lg backdrop-blur-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 rounded-t-2xl border-b border-divider-subtle px-6 py-4",children:[(0,t.jsx)(S.Message3Fill,{className:"h-6 w-6 shrink-0"}),(0,t.jsx)("div",{className:"system-xl-semibold grow text-text-secondary",children:e("chat.chatSettingsTitle",{ns:"share"})})]}),(0,t.jsx)("div",{className:"p-6",children:(0,t.jsx)(C,{})})]})})]})};var W=e.i(21151);let q=a.memo(e=>{let{isShow:s,saveLoading:n,name:l,onClose:r,onSave:i}=e,{t:o}=(0,u.useTranslation)(),[c,d]=(0,a.useState)(l);return(0,t.jsxs)(W.default,{title:o("chat.renameConversation",{ns:"common"}),isShow:s,onClose:r,children:[(0,t.jsx)("div",{className:"mt-6 text-sm font-medium leading-[21px] text-text-primary",children:o("chat.conversationName",{ns:"common"})}),(0,t.jsx)(h.default,{className:"mt-2 h-10 w-full",value:c,onChange:e=>d(e.target.value),placeholder:o("chat.conversationNamePlaceholder",{ns:"common"})||""}),(0,t.jsxs)("div",{className:"mt-10 flex justify-end",children:[(0,t.jsx)(m.default,{className:"mr-2 shrink-0",onClick:r,children:o("operation.cancel",{ns:"common"})}),(0,t.jsx)(m.default,{variant:"primary",className:"shrink-0",onClick:()=>i(c),loading:n,children:o("operation.save",{ns:"common"})})]})]})});var $=e.i(547105),G=e.i(421001);let H=a.memo(e=>{let{title:s,isPinned:n,togglePin:l,isShowRenameConversation:r,onRenameConversation:i,isShowDelete:c,onDelete:d,placement:p="bottom-start"}=e,{t:m}=(0,u.useTranslation)(),[x,h]=(0,a.useState)(!1);return(0,t.jsxs)(U.PortalToFollowElem,{open:x,onOpenChange:h,placement:p,offset:4,children:[(0,t.jsx)(U.PortalToFollowElemTrigger,{onClick:()=>h(e=>!e),children:(0,t.jsxs)("div",{className:(0,o.cn)("flex cursor-pointer items-center rounded-lg p-1.5 pl-2 text-text-secondary hover:bg-state-base-hover",x&&"bg-state-base-hover"),children:[(0,t.jsx)("div",{className:"system-md-semibold",children:s}),(0,t.jsx)(O.RiArrowDownSLine,{className:"h-4 w-4 "})]})}),(0,t.jsx)(U.PortalToFollowElemContent,{className:"z-50",children:(0,t.jsxs)("div",{className:"min-w-[120px] rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur p-1 shadow-lg backdrop-blur-sm",children:[(0,t.jsx)("div",{className:(0,o.cn)("system-md-regular flex cursor-pointer items-center space-x-1 rounded-lg px-3 py-1.5 text-text-secondary hover:bg-state-base-hover"),onClick:l,children:(0,t.jsx)("span",{className:"grow",children:m(n?"sidebar.action.unpin":"sidebar.action.pin",{ns:"explore"})})}),r&&(0,t.jsx)("div",{className:(0,o.cn)("system-md-regular flex cursor-pointer items-center space-x-1 rounded-lg px-3 py-1.5 text-text-secondary hover:bg-state-base-hover"),onClick:i,children:(0,t.jsx)("span",{className:"grow",children:m("sidebar.action.rename",{ns:"explore"})})}),c&&(0,t.jsx)("div",{className:(0,o.cn)("system-md-regular group flex cursor-pointer items-center space-x-1 rounded-lg px-3 py-1.5 text-text-secondary hover:bg-state-destructive-hover hover:text-text-destructive"),onClick:d,children:(0,t.jsx)("span",{className:"grow",children:m("sidebar.action.delete",{ns:"explore"})})})]})})]})}),K=()=>{let{appData:e,currentConversationId:s,currentConversationItem:n,inputsForms:l,pinnedConversationList:r,handlePinConversation:i,handleUnpinConversation:c,conversationRenaming:d,handleRenameConversation:m,handleDeleteConversation:x,handleNewConversation:h,sidebarCollapseState:g,handleSidebarCollapse:b,isResponding:f}=_(),{t:v}=(0,u.useTranslation)(),j=r.some(e=>e.id===s),[y,w]=(0,a.useState)(null),[N,C]=(0,a.useState)(null),k=(0,a.useCallback)(e=>{"pin"===e&&i(s),"unpin"===e&&c(s),"delete"===e&&w(n),"rename"===e&&C(n)},[s,n,i,c]),S=(0,a.useCallback)(()=>{w(null)},[]),T=(0,a.useCallback)(()=>{y&&x(y.id,{onSuccess:S})},[y,x,S]),A=(0,a.useCallback)(()=>{C(null)},[]),I=(0,a.useCallback)(e=>{N&&m(N.id,e,{onSuccess:A})},[N,m,A]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex h-14 shrink-0 items-center justify-between p-3",children:[(0,t.jsxs)("div",{className:(0,o.cn)("flex items-center gap-1 transition-all duration-200 ease-in-out",!g&&"user-select-none opacity-0"),children:[(0,t.jsx)(B.default,{className:(0,o.cn)(!g&&"cursor-default"),size:"l",onClick:()=>b(!1),children:(0,t.jsx)(O.RiLayoutRight2Line,{className:"h-[18px] w-[18px]"})}),(0,t.jsx)("div",{className:"mr-1 shrink-0",children:(0,t.jsx)(p.default,{size:"large",iconType:e?.site.icon_type,icon:e?.site.icon,background:e?.site.icon_background,imageUrl:e?.site.icon_url})}),!s&&(0,t.jsx)("div",{className:(0,o.cn)("system-md-semibold grow truncate text-text-secondary"),children:e?.site.title}),s&&n&&g&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"p-1 text-divider-deep",children:"/"}),(0,t.jsx)(H,{title:n?.name||"",isPinned:!!j,togglePin:()=>k(j?"unpin":"pin"),isShowDelete:!0,isShowRenameConversation:!0,onRenameConversation:()=>k("rename"),onDelete:()=>k("delete")})]}),(0,t.jsx)("div",{className:"flex items-center px-1",children:(0,t.jsx)("div",{className:"h-[14px] w-px bg-divider-regular"})}),g&&(0,t.jsx)(G.default,{disabled:!!s,popupContent:v("chat.newChatTip",{ns:"share"}),children:(0,t.jsx)("div",{children:(0,t.jsx)(B.default,{size:"l",state:!s||f?B.ActionButtonState.Disabled:B.ActionButtonState.Default,disabled:!s||f,onClick:h,children:(0,t.jsx)(O.RiEditBoxLine,{className:"h-[18px] w-[18px]"})})})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[s&&(0,t.jsx)(G.default,{popupContent:v("chat.resetChat",{ns:"share"}),children:(0,t.jsx)(B.default,{size:"l",onClick:h,children:(0,t.jsx)(O.RiResetLeftLine,{className:"h-[18px] w-[18px]"})})}),s&&l.length>0&&(0,t.jsx)(V,{})]})]}),!!y&&(0,t.jsx)($.default,{title:v("chat.deleteConversation.title",{ns:"share"}),content:v("chat.deleteConversation.content",{ns:"share"})||"",isShow:!0,onCancel:S,onConfirm:T}),N&&(0,t.jsx)(q,{isShow:!0,onClose:A,saveLoading:d,name:N?.name||"",onSave:I})]})},Q=e=>{let{handleResetChat:s,handleViewChatSettings:n,hideViewChatSettings:l=!1}=e,{t:r}=(0,u.useTranslation)(),[i,o]=(0,a.useState)(!1);return(0,t.jsxs)(U.PortalToFollowElem,{open:i,onOpenChange:o,placement:"bottom-end",offset:{mainAxis:4,crossAxis:-4},children:[(0,t.jsx)(U.PortalToFollowElemTrigger,{onClick:()=>o(e=>!e),children:(0,t.jsx)(B.default,{size:"l",state:i?B.ActionButtonState.Hover:B.ActionButtonState.Default,children:(0,t.jsx)(O.RiMoreFill,{className:"h-[18px] w-[18px]"})})}),(0,t.jsx)(U.PortalToFollowElemContent,{className:"z-40",children:(0,t.jsxs)("div",{className:"min-w-[160px] rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur p-1 shadow-lg backdrop-blur-sm",children:[(0,t.jsx)("div",{className:"system-md-regular flex cursor-pointer items-center space-x-1 rounded-lg px-3 py-1.5 text-text-secondary hover:bg-state-base-hover",onClick:s,children:(0,t.jsx)("span",{className:"grow",children:r("chat.resetChat",{ns:"share"})})}),!l&&(0,t.jsx)("div",{className:"system-md-regular flex cursor-pointer items-center space-x-1 rounded-lg px-3 py-1.5 text-text-secondary hover:bg-state-base-hover",onClick:n,children:(0,t.jsx)("span",{className:"grow",children:r("chat.viewChatSettings",{ns:"share"})})})]})})]})};var Y=e.i(726371),J=e.i(417944);let X=a.memo(e=>{let{isActive:s,isItemHovering:n,isPinned:l,togglePin:r,isShowRenameConversation:i,onRenameConversation:c,isShowDelete:d,onDelete:p}=e,{t:m}=(0,u.useTranslation)(),[x,h]=(0,a.useState)(!1),g=(0,a.useRef)(null),[b,{setTrue:f,setFalse:v}]=(0,J.useBoolean)(!1);return(0,a.useEffect)(()=>{n||b||h(!1)},[n,b]),(0,t.jsxs)(U.PortalToFollowElem,{open:x,onOpenChange:h,placement:"bottom-end",offset:4,children:[(0,t.jsx)(U.PortalToFollowElemTrigger,{onClick:()=>h(e=>!e),children:(0,t.jsx)(B.default,{className:(0,o.cn)(n||x?"opacity-100":"opacity-0"),state:s?B.ActionButtonState.Active:x?B.ActionButtonState.Hover:B.ActionButtonState.Default,children:(0,t.jsx)(O.RiMoreFill,{className:"h-4 w-4"})})}),(0,t.jsx)(U.PortalToFollowElemContent,{className:"z-50",children:(0,t.jsxs)("div",{ref:g,className:"min-w-[120px] rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur p-1 shadow-lg backdrop-blur-sm",onMouseEnter:f,onMouseLeave:v,onClick:e=>{e.stopPropagation()},children:[(0,t.jsxs)("div",{className:(0,o.cn)("system-md-regular flex cursor-pointer items-center space-x-1 rounded-lg px-2 py-1.5 text-text-secondary hover:bg-state-base-hover"),onClick:r,children:[l&&(0,t.jsx)(O.RiUnpinLine,{className:"h-4 w-4 shrink-0 text-text-tertiary"}),!l&&(0,t.jsx)(O.RiPushpinLine,{className:"h-4 w-4 shrink-0 text-text-tertiary"}),(0,t.jsx)("span",{className:"grow",children:m(l?"sidebar.action.unpin":"sidebar.action.pin",{ns:"explore"})})]}),i&&(0,t.jsxs)("div",{className:(0,o.cn)("system-md-regular flex cursor-pointer items-center space-x-1 rounded-lg px-2 py-1.5 text-text-secondary hover:bg-state-base-hover"),onClick:c,children:[(0,t.jsx)(O.RiEditLine,{className:"h-4 w-4 shrink-0 text-text-tertiary"}),(0,t.jsx)("span",{className:"grow",children:m("sidebar.action.rename",{ns:"explore"})})]}),d&&(0,t.jsxs)("div",{className:(0,o.cn)("system-md-regular group flex cursor-pointer items-center space-x-1 rounded-lg px-2 py-1.5 text-text-secondary hover:bg-state-destructive-hover hover:text-text-destructive"),onClick:p,children:[(0,t.jsx)(O.RiDeleteBinLine,{className:(0,o.cn)("h-4 w-4 shrink-0 text-text-tertiary group-hover:text-text-destructive")}),(0,t.jsx)("span",{className:"grow",children:m("sidebar.action.delete",{ns:"explore"})})]})]})})]})}),Z=(0,a.memo)(e=>{let{isPin:s,item:n,onOperate:l,onChangeConversation:r,currentConversationId:i}=e,c=(0,a.useRef)(null),d=(0,Y.useHover)(c),p=i===n.id;return(0,t.jsxs)("div",{ref:c,className:(0,o.cn)("system-sm-medium group flex cursor-pointer rounded-lg p-1 pl-3 text-components-menu-item-text hover:bg-state-base-hover",p&&"bg-state-accent-active text-text-accent hover:bg-state-accent-active"),onClick:()=>r(n.id),children:[(0,t.jsx)("div",{className:"grow truncate p-1 pl-0",title:n.name,children:n.name}),""!==n.id&&(0,t.jsx)("div",{className:"shrink-0",onClick:e=>e.stopPropagation(),children:(0,t.jsx)(X,{isActive:p,isPinned:!!s,isItemHovering:d,togglePin:()=>l(s?"unpin":"pin",n),isShowDelete:!0,isShowRenameConversation:!0,onRenameConversation:()=>l("rename",n),onDelete:()=>l("delete",n)})})]},n.id)}),ee=e=>{let{isPin:s,title:a,list:n,onOperate:l,onChangeConversation:r,currentConversationId:i}=e;return(0,t.jsxs)("div",{className:"space-y-0.5",children:[a&&(0,t.jsx)("div",{className:"system-xs-medium-uppercase px-3 pb-1 pt-2 text-text-tertiary",children:a}),n.map(e=>(0,t.jsx)(Z,{isPin:s,item:e,onOperate:l,onChangeConversation:r,currentConversationId:i},e.id))]})};var es=e.i(124555),et=e.i(326531),ea=e.i(864632),en=e.i(608846),el=e.i(752901),er=e.i(680173),ei=e.i(925521);let eo=e=>{let{isShow:s,onClose:a,data:n}=e;return(0,t.jsx)(W.default,{isShow:s,onClose:a,className:"min-w-[400px] max-w-[400px] !p-0",closable:!0,children:(0,t.jsxs)("div",{className:(0,o.cn)("flex flex-col items-center gap-4 px-4 pb-8 pt-10"),children:[(0,t.jsx)(p.default,{size:"xxl",iconType:n?.icon_type,icon:n?.icon,background:n?.icon_background||ei.appDefaultIconBackground,imageUrl:n?.icon_url}),(0,t.jsx)("div",{className:"system-xl-semibold text-text-secondary",children:n?.title}),(0,t.jsxs)("div",{className:"system-xs-regular text-text-tertiary",children:[n?.copyright&&(0,t.jsxs)("div",{children:["Â©",new Date().getFullYear()," ",n?.copyright]}),n?.custom_disclaimer&&(0,t.jsx)("div",{className:"mt-2",children:n.custom_disclaimer})]})]})})},ec=a.memo(e=>{let{data:s,placement:n,hideLogout:l,forceClose:r}=e,i=(0,en.useWebAppStore)(e=>e.webAppAccessMode),c=(0,et.useRouter)(),d=(0,et.usePathname)(),{t:p}=(0,u.useTranslation)(),[m,x]=(0,a.useState)(!1),h=(0,a.useRef)(m),g=(0,a.useCallback)(e=>{x(e),h.current=e},[x]),b=(0,a.useCallback)(()=>{g(!h.current)},[g]),f=(0,en.useWebAppStore)(e=>e.shareCode),v=(0,a.useCallback)(async()=>{await (0,er.webAppLogout)(f),c.replace(`/webapp-signin?redirect_url=${d}`)},[c,d,er.webAppLogout,f]),[j,y]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{r&&g(!1)},[r,g]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(U.PortalToFollowElem,{open:m,onOpenChange:g,placement:n||"bottom-end",offset:{mainAxis:4,crossAxis:-4},children:[(0,t.jsx)(U.PortalToFollowElemTrigger,{onClick:b,children:(0,t.jsx)("div",{children:(0,t.jsx)(B.default,{size:"l",className:(0,o.cn)(m&&"bg-state-base-hover"),children:(0,t.jsx)(O.RiEqualizer2Line,{className:"h-[18px] w-[18px]"})})})}),(0,t.jsx)(U.PortalToFollowElemContent,{className:"z-50",children:(0,t.jsxs)("div",{className:"w-[224px] rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur shadow-lg backdrop-blur-sm",children:[(0,t.jsx)("div",{className:"p-1",children:(0,t.jsxs)("div",{className:(0,o.cn)("system-md-regular flex cursor-pointer items-center rounded-lg py-1.5 pl-3 pr-2 text-text-secondary"),children:[(0,t.jsx)("div",{className:"grow",children:p("theme.theme",{ns:"common"})}),(0,t.jsx)(ea.default,{})]})}),(0,t.jsx)(k.default,{type:"horizontal",className:"my-0"}),(0,t.jsxs)("div",{className:"p-1",children:[s?.privacy_policy&&(0,t.jsx)("a",{href:s.privacy_policy,target:"_blank",className:"system-md-regular flex cursor-pointer items-center rounded-lg px-3 py-1.5 text-text-secondary hover:bg-state-base-hover",children:(0,t.jsx)("span",{className:"grow",children:p("chat.privacyPolicyMiddle",{ns:"share"})})}),(0,t.jsx)("div",{onClick:()=>{b(),y(!0)},className:"system-md-regular cursor-pointer rounded-lg px-3 py-1.5 text-text-secondary hover:bg-state-base-hover",children:p("userProfile.about",{ns:"common"})})]}),!(l||i===el.AccessMode.EXTERNAL_MEMBERS||i===el.AccessMode.PUBLIC)&&(0,t.jsx)("div",{className:"p-1",children:(0,t.jsx)("div",{onClick:v,className:"system-md-regular cursor-pointer rounded-lg px-3 py-1.5 text-text-secondary hover:bg-state-base-hover",children:p("userProfile.logout",{ns:"common"})})})]})})]}),j&&(0,t.jsx)(eo,{isShow:j,onClose:()=>{y(!1)},data:s})]})});var ed=e.i(494268);let ep=e=>{let{isPanel:s,panelVisible:n}=e,{t:l}=(0,u.useTranslation)(),{isInstalledApp:r,appData:i,handleNewConversation:c,pinnedConversationList:d,conversationList:x,currentConversationId:h,handleChangeConversation:g,handlePinConversation:b,handleUnpinConversation:f,conversationRenaming:v,handleRenameConversation:j,handleDeleteConversation:y,sidebarCollapseState:w,handleSidebarCollapse:N,isMobile:C,isResponding:k}=_(),S=(0,ed.useGlobalPublicStore)(e=>e.systemFeatures),[T,A]=(0,a.useState)(null),[I,R]=(0,a.useState)(null),M=(0,a.useCallback)((e,s)=>{"pin"===e&&b(s.id),"unpin"===e&&f(s.id),"delete"===e&&A(s),"rename"===e&&R(s)},[b,f]),F=(0,a.useCallback)(()=>{A(null)},[]),E=(0,a.useCallback)(()=>{T&&y(T.id,{onSuccess:F})},[T,y,F]),L=(0,a.useCallback)(()=>{R(null)},[]),P=(0,a.useCallback)(e=>{I&&j(I.id,e,{onSuccess:L})},[I,j,L]);return(0,t.jsxs)("div",{className:(0,o.cn)("flex w-full grow flex-col",s&&"rounded-xl border-[0.5px] border-components-panel-border-subtle bg-components-panel-bg shadow-lg"),children:[(0,t.jsxs)("div",{className:(0,o.cn)("flex shrink-0 items-center gap-3 p-3 pr-2"),children:[(0,t.jsx)("div",{className:"shrink-0",children:(0,t.jsx)(p.default,{size:"large",iconType:i?.site.icon_type,icon:i?.site.icon,background:i?.site.icon_background,imageUrl:i?.site.icon_url})}),(0,t.jsx)("div",{className:(0,o.cn)("system-md-semibold grow truncate text-text-secondary"),children:i?.site.title}),!C&&w&&(0,t.jsx)(B.default,{size:"l",onClick:()=>N(!1),children:(0,t.jsx)(O.RiExpandRightLine,{className:"h-[18px] w-[18px]"})}),!C&&!w&&(0,t.jsx)(B.default,{size:"l",onClick:()=>N(!0),children:(0,t.jsx)(O.RiLayoutLeft2Line,{className:"h-[18px] w-[18px]"})})]}),(0,t.jsx)("div",{className:"shrink-0 px-3 py-4",children:(0,t.jsxs)(m.default,{variant:"secondary-accent",disabled:k,className:"w-full justify-center",onClick:c,children:[(0,t.jsx)(O.RiEditBoxLine,{className:"mr-1 h-4 w-4"}),l("chat.newChat",{ns:"share"})]})}),(0,t.jsxs)("div",{className:"h-0 grow space-y-2 overflow-y-auto px-3 pt-4",children:[!!d.length&&(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsx)(ee,{isPin:!0,title:l("chat.pinnedTitle",{ns:"share"})||"",list:d,onChangeConversation:g,onOperate:M,currentConversationId:h})}),!!x.length&&(0,t.jsx)(ee,{title:d.length&&l("chat.unpinnedTitle",{ns:"share"})||"",list:x,onChangeConversation:g,onOperate:M,currentConversationId:h})]}),(0,t.jsxs)("div",{className:"flex shrink-0 items-center justify-between p-3",children:[(0,t.jsx)(ec,{hideLogout:r,placement:"top-start",data:i?.site,forceClose:s&&!n}),(0,t.jsx)("div",{className:"shrink-0",children:!i?.custom_config?.remove_webapp_brand&&(0,t.jsxs)("div",{className:(0,o.cn)("flex shrink-0 items-center gap-1.5 px-1"),children:[(0,t.jsx)("div",{className:"system-2xs-medium-uppercase text-text-tertiary",children:l("chat.poweredBy",{ns:"share"})}),S.branding.enabled&&S.branding.workspace_logo?(0,t.jsx)("img",{src:S.branding.workspace_logo,alt:"logo",className:"block h-5 w-auto"}):i?.custom_config?.replace_webapp_logo?(0,t.jsx)("img",{src:`${i?.custom_config?.replace_webapp_logo}`,alt:"logo",className:"block h-5 w-auto"}):(0,t.jsx)(es.default,{size:"small"})]})}),!!T&&(0,t.jsx)($.default,{title:l("chat.deleteConversation.title",{ns:"share"}),content:l("chat.deleteConversation.content",{ns:"share"})||"",isShow:!0,onCancel:F,onConfirm:E}),I&&(0,t.jsx)(q,{isShow:!0,onClose:L,saveLoading:v,name:I?.name||"",onSave:P})]})]})},eu=()=>{let{appData:e,currentConversationId:s,currentConversationItem:n,pinnedConversationList:l,handleNewConversation:r,handlePinConversation:i,handleUnpinConversation:o,handleDeleteConversation:c,handleRenameConversation:d,conversationRenaming:m,inputsForms:x}=_(),{t:h}=(0,u.useTranslation)(),g=l.some(e=>e.id===s),[b,f]=(0,a.useState)(null),[v,j]=(0,a.useState)(null),y=(0,a.useCallback)(e=>{"pin"===e&&i(s),"unpin"===e&&o(s),"delete"===e&&f(n),"rename"===e&&j(n)},[s,n,i,o]),w=(0,a.useCallback)(()=>{f(null)},[]),N=(0,a.useCallback)(()=>{b&&c(b.id,{onSuccess:w})},[b,c,w]),k=(0,a.useCallback)(()=>{j(null)},[]),T=(0,a.useCallback)(e=>{v&&d(v.id,e,{onSuccess:k})},[v,d,k]),[A,I]=(0,a.useState)(!1),[R,M]=(0,a.useState)(!1);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex shrink-0 items-center gap-1 bg-mask-top2bottom-gray-50-to-transparent px-2 py-3",children:[(0,t.jsx)(B.default,{size:"l",className:"shrink-0",onClick:()=>I(!0),children:(0,t.jsx)(O.RiMenuLine,{className:"h-[18px] w-[18px]"})}),(0,t.jsxs)("div",{className:"flex grow items-center justify-center",children:[!s&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.default,{className:"mr-2",size:"tiny",icon:e?.site.icon,iconType:e?.site.icon_type,imageUrl:e?.site.icon_url,background:e?.site.icon_background}),(0,t.jsx)("div",{className:"system-md-semibold truncate text-text-secondary",children:e?.site.title})]}),s&&(0,t.jsx)(H,{title:n?.name||"",isPinned:!!g,togglePin:()=>y(g?"unpin":"pin"),isShowDelete:!0,isShowRenameConversation:!0,onRenameConversation:()=>y("rename"),onDelete:()=>y("delete")})]}),(0,t.jsx)(Q,{handleResetChat:r,handleViewChatSettings:()=>M(!0),hideViewChatSettings:x.length<1})]}),A&&(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex bg-background-overlay p-1",onClick:()=>I(!1),children:(0,t.jsx)("div",{className:"flex h-full w-[calc(100vw_-_40px)] rounded-xl bg-components-panel-bg shadow-lg backdrop-blur-sm",onClick:e=>e.stopPropagation(),children:(0,t.jsx)(ep,{})})}),R&&(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex justify-end bg-background-overlay p-1",onClick:()=>M(!1),children:(0,t.jsxs)("div",{className:"flex h-full w-[calc(100vw_-_40px)] flex-col rounded-xl bg-components-panel-bg shadow-lg backdrop-blur-sm",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 rounded-t-2xl border-b border-divider-subtle px-4 py-3",children:[(0,t.jsx)(S.Message3Fill,{className:"h-6 w-6 shrink-0"}),(0,t.jsx)("div",{className:"system-xl-semibold grow text-text-secondary",children:h("chat.chatSettingsTitle",{ns:"share"})})]}),(0,t.jsx)("div",{className:"p-4",children:(0,t.jsx)(C,{})})]})}),!!b&&(0,t.jsx)($.default,{title:h("chat.deleteConversation.title",{ns:"share"}),content:h("chat.deleteConversation.content",{ns:"share"})||"",isShow:!0,onCancel:w,onConfirm:N}),v&&(0,t.jsx)(q,{isShow:!0,onClose:k,saveLoading:m,name:v?.name||"",onSave:T})]})};var em=e.i(881110),ex=e.i(105845),eh=e.i(223314),eg=e.i(137667),eb=e.i(824627),ef=e.i(773923);let ev=function(e,s){(0,a.useEffect)(function(){var s=e(),t=!1;return!function(){(0,eb.__awaiter)(this,void 0,void 0,function(){return(0,eb.__generator)(this,function(e){switch(e.label){case 0:if(!(0,ef.isFunction)(s[Symbol.asyncIterator]))return[3,4];e.label=1;case 1:return[4,s.next()];case 2:if(e.sent().done||t)return[3,3];return[3,1];case 3:return[3,6];case 4:return[4,s];case 5:e.sent(),e.label=6;case 6:return[2]}})})}(),function(){t=!0}},s)};var ej=e.i(199018);function ey(e){let{enable:s=!0,icon_type:t="emoji",icon:a,icon_background:n,icon_url:l}=e;ev(async()=>{if(!s||"image"===t&&!l||"emoji"===t&&!a)return;let e="image"===t&&l,r=document.querySelector('link[rel*="icon"]')||document.createElement("link");r.href=e?l:`data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%25%22 height=%22100%25%22 fill=%22${encodeURIComponent(n||ei.appDefaultIconBackground)}%22 rx=%2230%22 ry=%2230%22 /><text x=%2212.5%22 y=%221em%22 font-size=%2275%22>${a?await (0,ej.searchEmoji)(a):"ðŸ¤–"}</text></svg>`,r.rel="shortcut icon",r.type="image/svg",document.getElementsByTagName("head")[0].appendChild(r)},[s,a,n])}var ew=e.i(218422),eN=e.i(387450),e_=e.i(290422),eC=e.i(506133);let ek=e=>{let{className:s}=e,{appData:n,appChatListDataLoading:r,chatShouldReloadKey:c,isMobile:d,themeBuilder:p,sidebarCollapseState:u}=_(),m=n?.custom_config,x=n?.site,[h,g]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{p?.buildTheme(x?.chat_color_theme,x?.chat_color_theme_inverted)},[x,m,p]),(0,a.useEffect)(()=>{u||g(!1)},[u]),(0,i.default)(x?.title||"Chat"),(0,t.jsxs)("div",{className:(0,o.cn)("flex h-full bg-background-default-burn",d&&"flex-col",s),children:[!d&&(0,t.jsx)("div",{className:(0,o.cn)("flex w-[236px] flex-col p-1 pr-0 transition-all duration-200 ease-in-out",u&&"w-0 overflow-hidden !p-0"),children:(0,t.jsx)(ep,{})}),d&&(0,t.jsx)(eu,{}),(0,t.jsxs)("div",{className:(0,o.cn)("relative grow p-2",d&&"h-[calc(100%_-_56px)] p-0"),children:[u&&(0,t.jsx)("div",{className:(0,o.cn)("absolute top-0 z-20 flex h-full w-[256px] flex-col p-2 transition-all duration-500 ease-in-out",h?"left-0":"left-[-248px]"),onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),children:(0,t.jsx)(ep,{isPanel:!0,panelVisible:h})}),(0,t.jsxs)("div",{className:(0,o.cn)("flex h-full flex-col overflow-hidden border-[0,5px] border-components-panel-border-subtle bg-chatbot-bg",d?"rounded-t-2xl":"rounded-2xl"),children:[!d&&(0,t.jsx)(K,{}),r&&(0,t.jsx)(l.default,{type:"app"}),!r&&(0,t.jsx)(z,{},c)]})]})]})},eS=e=>{let{installedAppInfo:s,className:n}=e,l=(0,r.default)()===r.MediaType.mobile,i=(0,c.useThemeContext)(),{appData:o,appParams:d,appMeta:p,appChatListDataLoading:m,currentConversationId:x,currentConversationItem:h,appPrevChatTree:g,pinnedConversationList:b,conversationList:f,newConversationInputs:v,newConversationInputsRef:j,handleNewConversationInputsChange:_,inputsForms:C,handleNewConversation:k,handleStartChat:S,handleChangeConversation:T,handlePinConversation:A,handleUnpinConversation:I,handleDeleteConversation:F,conversationRenaming:E,handleRenameConversation:L,handleNewConversationCompleted:P,chatShouldReloadKey:z,isInstalledApp:O,appId:B,handleFeedback:U,currentChatInstanceRef:V,sidebarCollapseState:W,handleSidebarCollapse:q,clearChatList:$,setClearChatList:G,isResponding:H,setIsResponding:K,currentConversationInputs:Q,setCurrentConversationInputs:Y,allInputsHidden:J,initUserVariables:X}=(e=>{let s=(0,a.useMemo)(()=>!!e,[e]),t=s?R.AppSourceType.installedApp:R.AppSourceType.webApp,n=(0,en.useWebAppStore)(e=>e.appInfo),l=(0,en.useWebAppStore)(e=>e.appParams),r=(0,en.useWebAppStore)(e=>e.appMeta);ey({enable:!e,icon_type:n?.site.icon_type,icon:n?.site.icon,icon_background:n?.site.icon_background,icon_url:n?.site.icon_url});let i=(0,a.useMemo)(()=>{if(s){let{id:s,app:t}=e;return{app_id:s,site:{title:t.name,icon_type:t.icon_type,icon:t.icon,icon_background:t.icon_background,icon_url:t.icon_url,prompt_public:!1,copyright:"",show_workflow_steps:!0,use_icon_as_answer_icon:t.use_icon_as_answer_icon},plan:"basic",custom_config:null}}return n},[s,e,n]),o=(0,a.useMemo)(()=>i?.app_id,[i]),[c,d]=(0,a.useState)();(0,a.useEffect)(()=>{(0,D.getProcessedSystemVariablesFromUrlParams)().then(e=>{let{user_id:s}=e;d(s)})},[]),(0,a.useEffect)(()=>{(async()=>{i?.site.default_language&&await (0,ew.changeLanguage)(i.site.default_language)})()},[i]);let[p,m]=(0,a.useState)(()=>{try{let e=localStorage.getItem("webappSidebarCollapse");return"collapsed"===e}catch{return!1}}),x=(0,a.useCallback)(e=>{if(o){m(e);try{localStorage.setItem("webappSidebarCollapse",e?"collapsed":"expanded")}catch{}}},[o,m]),[h,g]=(0,em.useLocalStorageState)(eC.CONVERSATION_ID_INFO,{defaultValue:{}}),b=(0,a.useMemo)(()=>h?.[o||""]?.[c||"DEFAULT"]||"",[o,h,c]),f=(0,a.useCallback)(e=>{if(o){let s=h?.[o||""];"string"==typeof s&&(s={}),g({...h,[o||""]:{...s,[c||"DEFAULT"]:e}})}},[o,h,g,c]),[v,j]=(0,a.useState)(""),N=(0,a.useMemo)(()=>b===v?"":b,[b,v]),{data:_}=(0,eN.useShareConversations)({appSourceType:t,appId:o,pinned:!0,limit:100},{enabled:!!o,refetchOnWindowFocus:!1,refetchOnReconnect:!1}),{data:C,isLoading:k}=(0,eN.useShareConversations)({appSourceType:t,appId:o,pinned:!1,limit:100},{enabled:!!o,refetchOnWindowFocus:!1,refetchOnReconnect:!1}),{data:S,isLoading:T}=(0,eN.useShareChatList)({conversationId:N,appSourceType:t,appId:o},{enabled:!!N,refetchOnWindowFocus:!1,refetchOnReconnect:!1}),A=(0,eN.useInvalidateShareConversations)(),[I,F]=(0,a.useState)(!1),[E,L]=(0,a.useState)(!1),P=(0,a.useMemo)(()=>{var e;let s;return b&&S?.data.length?(0,D.buildChatItemTree)((e=S.data,s=[],e.forEach(e=>{let t=e.message_files?.filter(e=>"user"===e.belongs_to)||[];s.push({id:`question-${e.id}`,content:e.query,isAnswer:!1,message_files:(0,eh.getProcessedFilesFromResponse)(t.map(e=>({...e,related_id:e.id,upload_file_id:e.upload_file_id}))),parentMessageId:e.parent_message_id||void 0});let a=e.message_files?.filter(e=>"assistant"===e.belongs_to)||[];s.push({id:e.id,content:e.answer,agent_thoughts:(0,e_.addFileInfos)(e.agent_thoughts?(0,e_.sortAgentSorts)(e.agent_thoughts):e.agent_thoughts,e.message_files),feedback:e.feedback,isAnswer:!0,citation:e.retriever_resources,message_files:(0,eh.getProcessedFilesFromResponse)(a.map(e=>({...e,related_id:e.id,upload_file_id:e.upload_file_id}))),parentMessageId:`question-${e.id}`})}),s)):[]},[S,b]),[z,O]=(0,a.useState)(!1),B=(0,a.useMemo)(()=>_?.data||[],[_]),{t:U}=(0,u.useTranslation)(),V=(0,a.useRef)({}),[W,q]=(0,a.useState)({}),[$,G]=(0,a.useState)({}),[H,K]=(0,a.useState)({}),Q=(0,a.useCallback)(e=>{V.current=e,q(e)},[]),Y=(0,a.useMemo)(()=>(l?.user_input_form||[]).filter(e=>!e.external_data_tool).map(e=>{if(e.paragraph){let s=$[e.paragraph.variable];return s&&e.paragraph.max_length&&s.length>e.paragraph.max_length&&(s=s.slice(0,e.paragraph.max_length)),{...e.paragraph,default:s||e.default||e.paragraph.default,type:"paragraph"}}if(e.number){let s=Number($[e.number.variable]);return{...e.number,default:s||e.default||e.number.default,type:"number"}}if(e.checkbox){let s=!0===$[e.checkbox.variable];return{...e.checkbox,default:s||e.default||e.checkbox.default,type:"checkbox"}}if(e.select){let s=e.select.options.includes($[e.select.variable]);return{...e.select,default:(s?$[e.select.variable]:void 0)||e.select.default,type:"select"}}if(e["file-list"])return{...e["file-list"],type:"file-list"};if(e.file)return{...e.file,type:"file"};if(e.json_object)return{...e.json_object,type:"json_object"};let s=$[e["text-input"].variable];return s&&e["text-input"].max_length&&s.length>e["text-input"].max_length&&(s=s.slice(0,e["text-input"].max_length)),{...e["text-input"],default:s||e.default||e["text-input"].default,type:"text-input"}}),[$,l]),J=(0,a.useMemo)(()=>Y.length>0&&Y.every(e=>!0===e.hide),[Y]);(0,a.useEffect)(()=>{(async()=>{let e=await (0,D.getRawInputsFromUrlParams)(),s=await (0,D.getRawUserVariablesFromUrlParams)();G(e),K(s)})()},[]),(0,a.useEffect)(()=>{let e={};Y.forEach(s=>{e[s.variable]=s.default||null}),Q(e)},[Q,Y]);let{data:X}=(0,eN.useShareConversationName)({conversationId:v,appSourceType:t,appId:o},{refetchOnWindowFocus:!1,enabled:!!v}),[Z,ee]=(0,a.useState)([]);(0,a.useEffect)(()=>{C?.data&&!k&&ee(C?.data)},[C,k]);let es=(0,a.useMemo)(()=>{let e=Z.slice();return z&&e[0]?.id!==""&&e.unshift({id:"",name:U("chat.newChatDefaultName",{ns:"share"}),inputs:{},introduction:""}),e},[Z,z,U]);(0,a.useEffect)(()=>{X&&ee((0,ex.produce)(e=>{let s=e.findIndex(e=>e.id===X.id);s>-1?e[s]=X:e.unshift(X)}))},[X]);let et=(0,a.useMemo)(()=>{let e=es.find(e=>e.id===b);return!e&&B.length&&(e=B.find(e=>e.id===b)),e},[es,b,B]),ea=(0,a.useMemo)(()=>b&&S?.data.length?S.data.slice().pop().inputs||{}:V.current||{},[S,b]),[el,er]=(0,a.useState)(ea||{});(0,a.useEffect)(()=>{et&&er(ea||{})},[et,ea]);let{notify:ei}=(0,eg.useToastContext)(),eo=(0,a.useCallback)(e=>{if(J)return!0;let s="",t=!1,a=Y.filter(e=>{let{required:s,type:t}=e;return s&&t!==y.InputVarType.checkbox});return(a.length&&a.forEach(a=>{let{variable:n,label:l,type:r}=a;if(!s&&!t&&(V.current[n]||e||(s=l),(r===y.InputVarType.singleFile||r===y.InputVarType.multiFiles)&&V.current[n]&&!e)){let e=V.current[n];t=Array.isArray(e)?e.find(e=>e.transferMethod===M.TransferMethod.local_file&&!e.uploadedId):e.transferMethod===M.TransferMethod.local_file&&!e.uploadedId}}),s)?(ei({type:"error",message:U("errorMessage.valueOfVarRequired",{ns:"appDebug",key:s})}),!1):!t||void ei({type:"info",message:U("errorMessage.waitForFileUpload",{ns:"appDebug"})})},[Y,ei,U,J]),ec=(0,a.useCallback)(e=>{eo()&&(O(!0),e?.())},[O,eo]),ed=(0,a.useRef)({handleStop:w.noop}),ep=(0,a.useCallback)(e=>{ed.current.handleStop(),j(""),f(e),e&&F(!1)},[f,F]),eu=(0,a.useCallback)(async()=>{ed.current.handleStop(),O(!0),ep("");let e={};Y.forEach(s=>{e[s.variable]=s.default||null}),Q(e),F(!0)},[ep,O,Q,F,Y]),eb=(0,a.useCallback)(()=>{A()},[A]),ef=(0,a.useCallback)(async e=>{await (0,R.pinConversation)(t,o,e),ei({type:"success",message:U("api.success",{ns:"common"})}),eb()},[t,o,ei,U,eb]),ev=(0,a.useCallback)(async e=>{await (0,R.unpinConversation)(t,o,e),ei({type:"success",message:U("api.success",{ns:"common"})}),eb()},[t,o,ei,U,eb]),[ej,ek]=(0,a.useState)(!1),eS=(0,a.useCallback)(async(e,s)=>{let{onSuccess:a}=s;if(!ej){try{ek(!0),await (0,R.delConversation)(t,o,e),ei({type:"success",message:U("api.success",{ns:"common"})}),a()}finally{ek(!1)}e===b&&eu(),eb()}},[s,o,ei,U,eb,eu,b,ej]),[eT,eA]=(0,a.useState)(!1),eI=(0,a.useCallback)(async(e,s,a)=>{let{onSuccess:n}=a;if(!eT){if(!s.trim())return void ei({type:"error",message:U("chat.conversationNameCanNotEmpty",{ns:"common"})});eA(!0);try{await (0,R.renameConversation)(t,o,e,s),ei({type:"success",message:U("actionMsg.modifiedSuccessfully",{ns:"common"})}),ee((0,ex.produce)(t=>{let a=Z.findIndex(s=>s.id===e),n=t[a];t[a]={...n,name:s}})),n()}finally{eA(!1)}}},[s,o,ei,U,eT,Z]),eR=(0,a.useCallback)(e=>{j(e),f(e),O(!1),A()},[f,A]),eM=(0,a.useCallback)(async(e,s)=>{await (0,R.updateFeedback)({url:`/messages/${e}/feedbacks`,body:{rating:s.rating,content:s.content}},t,o),ei({type:"success",message:U("api.success",{ns:"common"})})},[t,o,U,ei]);return{isInstalledApp:s,appId:o,currentConversationId:b,currentConversationItem:et,handleConversationIdInfoChange:f,appData:i,appParams:l||{},appMeta:r,appPinnedConversationData:_,appConversationData:C,appConversationDataLoading:k,appChatListData:S,appChatListDataLoading:T,appPrevChatTree:P,pinnedConversationList:B,conversationList:es,setShowNewConversationItemInList:O,newConversationInputs:W,newConversationInputsRef:V,handleNewConversationInputsChange:Q,inputsForms:Y,handleNewConversation:eu,handleStartChat:ec,handleChangeConversation:ep,handlePinConversation:ef,handleUnpinConversation:ev,conversationDeleting:ej,handleDeleteConversation:eS,conversationRenaming:eT,handleRenameConversation:eI,handleNewConversationCompleted:eR,newConversationId:v,chatShouldReloadKey:N,handleFeedback:eM,currentChatInstanceRef:ed,sidebarCollapseState:p,handleSidebarCollapse:x,clearChatList:I,setClearChatList:F,isResponding:E,setIsResponding:L,currentConversationInputs:el,setCurrentConversationInputs:er,allInputsHidden:J,initUserVariables:H}})(s);return(0,t.jsx)(N.Provider,{value:{appData:o,appParams:d,appMeta:p,appChatListDataLoading:m,currentConversationId:x,currentConversationItem:h,appPrevChatTree:g,pinnedConversationList:b,conversationList:f,newConversationInputs:v,newConversationInputsRef:j,handleNewConversationInputsChange:_,inputsForms:C,handleNewConversation:k,handleStartChat:S,handleChangeConversation:T,handlePinConversation:A,handleUnpinConversation:I,handleDeleteConversation:F,conversationRenaming:E,handleRenameConversation:L,handleNewConversationCompleted:P,chatShouldReloadKey:z,isMobile:l,isInstalledApp:O,appId:B,handleFeedback:U,currentChatInstanceRef:V,themeBuilder:i,sidebarCollapseState:W,handleSidebarCollapse:q,clearChatList:$,setClearChatList:G,isResponding:H,setIsResponding:K,currentConversationInputs:Q,setCurrentConversationInputs:Y,allInputsHidden:J,initUserVariables:X},children:(0,t.jsx)(ek,{className:n})})},eT=e=>{let{installedAppInfo:s,className:a}=e;return(0,t.jsx)(eS,{installedAppInfo:s,className:a})};var eA=e.i(26012),eI=e.i(543753);let eR=a.memo(e=>{let{onStartCreateContent:s}=e,{t:a}=(0,u.useTranslation)();return(0,t.jsxs)("div",{className:"rounded-xl bg-background-section-burn p-6 ",children:[(0,t.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-[10px] border-[0.5px] border-components-card-border bg-components-card-bg-alt shadow-lg backdrop-blur-sm",children:(0,t.jsx)(O.RiBookmark3Line,{className:"h-4 w-4 text-text-accent"})}),(0,t.jsx)("div",{className:"mt-3",children:(0,t.jsx)("span",{className:"system-xl-semibold text-text-secondary",children:a("generation.savedNoData.title",{ns:"share"})})}),(0,t.jsx)("div",{className:"system-sm-regular mt-1 text-text-tertiary",children:a("generation.savedNoData.description",{ns:"share"})}),(0,t.jsxs)(m.default,{variant:"primary",className:"mt-3",onClick:s,children:[(0,t.jsx)(O.RiAddLine,{className:"mr-1 h-4 w-4"}),(0,t.jsx)("span",{children:a("generation.savedNoData.startCreateContent",{ns:"share"})})]})]})}),eM=a.memo(e=>{let{className:s,isShowTextToSpeech:a,list:n,onRemove:l,onStartCreateContent:r}=e,{t:i}=(0,u.useTranslation)();return(0,t.jsx)("div",{className:(0,o.cn)("space-y-4",s),children:0===n.length?(0,t.jsx)(eR,{onStartCreateContent:r}):(0,t.jsx)(t.Fragment,{children:n.map(e=>{let{id:s,answer:n}=e;return(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:(0,o.cn)("rounded-2xl bg-background-section-burn p-4"),children:(0,t.jsx)(I.Markdown,{content:n})}),(0,t.jsx)("div",{className:"system-xs-regular mt-1 h-4 px-4 text-text-quaternary",children:(0,t.jsxs)("span",{children:[n.length," ",i("unit.char",{ns:"common"})]})}),(0,t.jsx)("div",{className:"absolute bottom-1 right-2",children:(0,t.jsxs)("div",{className:"ml-1 flex items-center gap-0.5 rounded-[10px] border-[0.5px] border-components-actionbar-border bg-components-actionbar-bg p-0.5 shadow-md backdrop-blur-sm",children:[a&&(0,t.jsx)(eI.default,{value:n}),(0,t.jsx)(B.default,{onClick:()=>{(0,eA.default)(n),eg.default.notify({type:"success",message:i("actionMsg.copySuccessfully",{ns:"common"})})},children:(0,t.jsx)(O.RiClipboardLine,{className:"h-4 w-4"})}),(0,t.jsx)(B.default,{onClick:()=>{l(s)},children:(0,t.jsx)(O.RiDeleteBinLine,{className:"h-4 w-4"})})]})})]},s)})})})});var eF=e.i(83278),eE=e.i(210807),eL=e.i(727163),eP=e.i(366892),eD=e.i(149649);e.i(288243);var ez=e.i(193105);let eO=a.memo(e=>{let s,{vars:a}=e,{t:n}=(0,u.useTranslation)(),{CSVDownloader:l,Type:r}=(0,eD.useCSVDownloader)(),i=[...a],o=(s={},i.forEach(e=>{s[e.name]=""}),s);return(0,t.jsxs)("div",{className:"mt-6",children:[(0,t.jsx)("div",{className:"system-sm-medium text-text-primary",children:n("generation.csvStructureTitle",{ns:"share"})}),(0,t.jsx)("div",{className:"mt-2 max-h-[500px] overflow-auto",children:(0,t.jsxs)("table",{className:"w-full table-fixed border-separate border-spacing-0 rounded-lg border border-divider-regular text-xs",children:[(0,t.jsx)("thead",{className:"text-text-tertiary",children:(0,t.jsx)("tr",{children:i.map((e,s)=>(0,t.jsx)("td",{className:"h-9 border-b border-divider-regular pl-3 pr-2",children:e.name},s))})}),(0,t.jsx)("tbody",{className:"text-text-secondary",children:(0,t.jsx)("tr",{children:i.map((e,s)=>(0,t.jsxs)("td",{className:"h-9 pl-4",children:[e.name," ",n("generation.field",{ns:"share"})]},s))})})]})}),(0,t.jsx)(l,{className:"mt-2 block cursor-pointer",type:r.Link,filename:"template",bom:!0,config:{},data:[o],children:(0,t.jsxs)("div",{className:"system-xs-medium flex h-[18px] items-center space-x-1 text-text-accent",children:[(0,t.jsx)(ez.Download02,{className:"h-3 w-3"}),(0,t.jsx)("span",{children:n("generation.downloadTemplate",{ns:"share"})})]})})]})});e.i(866473);var eB=e.i(260366);let eU=a.memo(e=>{let{onParsed:s}=e,{t:n}=(0,u.useTranslation)(),{CSVReader:l}=(0,eD.useCSVReader)(),[r,i]=(0,a.useState)(!1);return(0,t.jsx)(l,{onUploadAccepted:e=>{s(e.data),i(!1)},onDragOver:e=>{e.preventDefault(),i(!0)},onDragLeave:e=>{e.preventDefault(),i(!1)},children:e=>{let{getRootProps:s,acceptedFile:a}=e;return(0,t.jsx)(t.Fragment,{children:(0,t.jsx)("div",{...s(),className:(0,o.cn)("system-sm-regular flex h-20 items-center rounded-xl border border-dashed border-components-dropzone-border bg-components-dropzone-bg",a&&"border-solid border-components-panel-border bg-components-panel-on-panel-item-bg px-6 hover:border-components-panel-bg-blur hover:bg-components-panel-on-panel-item-bg-hover",r&&"border border-components-dropzone-border-accent bg-components-dropzone-bg-accent"),children:a?(0,t.jsxs)("div",{className:"flex w-full items-center space-x-2",children:[(0,t.jsx)(eB.Csv,{className:"shrink-0"}),(0,t.jsxs)("div",{className:"flex w-0 grow",children:[(0,t.jsx)("span",{className:"max-w-[calc(100%_-_30px)] truncate text-text-secondary",children:a.name.replace(/.csv$/,"")}),(0,t.jsx)("span",{className:"shrink-0 text-text-tertiary",children:".csv"})]})]}):(0,t.jsxs)("div",{className:"flex w-full items-center justify-center space-x-2",children:[(0,t.jsx)(eB.Csv,{className:"shrink-0"}),(0,t.jsxs)("div",{className:"text-text-tertiary",children:[n("generation.csvUploadTitle",{ns:"share"}),(0,t.jsx)("span",{className:"cursor-pointer text-text-accent",children:n("generation.browse",{ns:"share"})})]})]})})})}})}),eV=a.memo(e=>{let{vars:s,onSend:n,isAllFinished:l}=e,{t:i}=(0,u.useTranslation)(),c=(0,r.default)()===r.MediaType.pc,[d,p]=a.useState([]),[x,h]=a.useState(!1),g=l?O.RiPlayLargeLine:O.RiLoader2Line;return(0,t.jsxs)("div",{className:"pt-4",children:[(0,t.jsx)(eU,{onParsed:e=>{p(e),h(!0)}}),(0,t.jsx)(eO,{vars:s}),(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsxs)(m.default,{variant:"primary",className:(0,o.cn)("mt-4 pl-3 pr-4",!c&&"grow"),onClick:()=>{n(d)},disabled:!x||!l,children:[(0,t.jsx)(g,{className:(0,o.cn)(!l&&"animate-spin","mr-1 h-4 w-4 shrink-0"),"aria-hidden":"true"}),(0,t.jsx)("span",{className:"text-[13px] uppercase",children:i("generation.run",{ns:"share"})})]})})]})}),eW=a.memo(e=>{let{isMobile:s,values:a}=e,{t:n}=(0,u.useTranslation)(),{CSVDownloader:l,Type:r}=(0,eD.useCSVDownloader)();return(0,t.jsxs)(l,{className:"block cursor-pointer",type:r.Link,filename:"result",bom:!0,config:{},data:a,children:[s&&(0,t.jsx)(B.default,{children:(0,t.jsx)(O.RiDownloadLine,{className:"h-4 w-4"})}),!s&&(0,t.jsxs)(m.default,{className:(0,o.cn)("space-x-1"),children:[(0,t.jsx)(O.RiDownloadLine,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:n("operation.download",{ns:"common"})})]})]})}),eq=ei.BATCH_CONCURRENCY;var e$=((s=e$||{}).pending="pending",s.running="running",s.completed="completed",s.failed="failed",s);let eG=e=>{let{isInstalledApp:s=!1,isWorkflow:n=!1}=e,{notify:c}=eg.default,d=s?R.AppSourceType.installedApp:R.AppSourceType.webApp,{t:m}=(0,u.useTranslation)(),x=(0,r.default)()===r.MediaType.pc,h=(0,et.useSearchParams)().get("mode")||"create",[g,b]=(0,a.useState)(["create","batch"].includes(h)?h:"create"),[f,v]=(0,a.useState)(!1),j="batch"===g,[y,w]=(0,a.useState)({}),N=(0,a.useRef)(y),_=(0,a.useCallback)(e=>{w(e),N.current=e},[]),C=(0,ed.useGlobalPublicStore)(e=>e.systemFeatures),[k,S]=(0,a.useState)(""),[T,A]=(0,a.useState)(null),[I,E]=(0,a.useState)(null),[L,P]=(0,a.useState)(null),[D,z]=(0,a.useState)(null),[B,U]=(0,a.useState)(null),[V,W]=(0,a.useState)([]),q=(0,a.useCallback)(async()=>{k&&W((await (0,R.fetchSavedMessage)(d,k)).data)},[d,k]),$=async e=>{await (0,R.saveMessage)(e,d,k),c({type:"success",message:m("api.saved",{ns:"common"})}),q()},G=async e=>{await (0,R.removeMessage)(e,d,k),c({type:"success",message:m("api.remove",{ns:"common"})}),q()},[H,K]=(0,a.useState)(0),[Q,Y]=(0,a.useState)(0),[X,Z]=(0,a.useState)({enabled:!1,number_limits:2,detail:M.Resolution.low,transfer_methods:[M.TransferMethod.local_file]}),[ee,ea]=(0,a.useState)([]),[er,eo]=(0,a.useState)(null);(0,a.useEffect)(()=>{f&&eo(null)},[f]);let[ep,eu]=(0,a.useState)(0),[em,ex]=(0,a.useState)([]),eh=(0,a.useRef)([]),eb=e=>{ex(e),eh.current=e},ef=0===em.filter(e=>"pending"===e.status).length,ev=em.filter(e=>"pending"!==e.status),ej=(0,a.useRef)(0),eN=e=>{ej.current=e},e_=em.filter(e=>"completed"===e.status),eC=em.filter(e=>"failed"===e.status),ek=em.every(e=>"completed"===e.status),eS=em.every(e=>["completed","failed"].includes(e.status)),eT=(0,a.useRef)({}),eA=em.map(e=>{let s=eT.current,t={},{inputs:a}=e.params;L?.prompt_variables.forEach(e=>{t[e.name]=a[e.key]});let n=s[e.id];return"object"==typeof s[e.id]&&(n=JSON.stringify(n)),t[m("generation.completionResult",{ns:"share"})]=n,t}),eI=(e,s,t)=>{let a=eh.current,n=eT.current,l=a.filter(e=>"pending"===e.status),r=1+a.filter(e=>["completed","failed"].includes(e.status)).length,i=ej.current!==r&&l.length>0&&(r%eq==0||a.length-r<eq);i&&eN(r);let o=i?l.slice(0,eq).map(e=>e.id):[];eb(a.map(e=>e.id===s?{...e,status:t?"completed":"failed"}:i&&o.includes(e.id)?{...e,status:"running"}:e)),s&&(eT.current={...n,[`${s}`]:e})},eR=(0,en.useWebAppStore)(e=>e.appInfo),eD=(0,en.useWebAppStore)(e=>e.appParams),ez=(0,en.useWebAppStore)(e=>e.webAppAccessMode);(0,a.useEffect)(()=>{(async()=>{if(!eR||!eD)return;n||q();let{app_id:e,site:s,custom_config:t}=eR;S(e),A(s),E(t),await (0,ew.changeLanguage)(s.default_language);let{user_input_form:a,more_like_this:l,file_upload:r,text_to_speech:i}=eD;Z({...r,transfer_methods:r?.allowed_file_upload_methods||r?.allowed_upload_methods,image_file_size_limit:eD?.system_parameters.image_file_size_limit,fileUploadConfig:eD?.system_parameters}),P({prompt_template:"",prompt_variables:(0,F.userInputsFormToPromptVariables)(a)}),z(l),U(i)})()},[eR,eD,q,n]),(0,i.default)(T?.title||m("generation.title",{ns:"share"})),ey({enable:!s,icon_type:T?.icon_type,icon:T?.icon,icon_background:T?.icon_background,icon_url:T?.icon_url});let[eO,{setTrue:eB,setFalse:eU}]=(0,J.useBoolean)(!1),e$=()=>{setTimeout(()=>{eB()},0)},[eG,eH]=(0,a.useState)(!1),eK=e=>(0,t.jsx)(eE.default,{isWorkflow:n,isCallBatchAPI:f,isPC:x,isMobile:!x,appSourceType:s?R.AppSourceType.installedApp:R.AppSourceType.webApp,appId:k,isError:e?.status==="failed",promptConfig:L,moreLikeThisEnabled:!!D?.enabled,inputs:f?e.params.inputs:y,controlSend:H,controlRetry:e?.status==="failed"?ep:0,controlStopResponding:Q,onShowRes:e$,handleSaveMessage:$,taskId:e?.id,onCompleted:eI,visionConfig:X,completionFiles:ee,isShowTextToSpeech:!!B?.enabled,siteInfo:T,onRunStart:()=>eH(!0),onRunControlChange:f?void 0:eo,hideInlineStopButton:!f},e?.id),eQ=(0,t.jsxs)("div",{className:(0,o.cn)("relative flex h-full flex-col",!x&&"h-[calc(100vh_-_36px)] rounded-t-2xl shadow-lg backdrop-blur-sm",x?"bg-chatbot-bg":eO?"bg-background-default-burn":"border-t-[0.5px] border-divider-regular bg-components-panel-bg"),children:[f&&(0,t.jsxs)("div",{className:(0,o.cn)("flex shrink-0 items-center justify-between px-14 pb-2 pt-9",!x&&"px-4 pb-1 pt-3"),children:[(0,t.jsx)("div",{className:"system-md-semibold-uppercase text-text-primary",children:m("generation.executions",{ns:"share",num:em.length})}),e_.length>0&&(0,t.jsx)(eW,{isMobile:!x,values:eA})]}),(0,t.jsxs)("div",{className:(0,o.cn)("flex h-0 grow flex-col overflow-y-auto",x&&"px-14 py-8",x&&f&&"pt-0",!x&&"p-0 pb-2"),children:[f?ev.map(e=>eK(e)):eK(),!ef&&(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsx)(l.default,{type:"area"})})]}),f&&eC.length>0&&(0,t.jsxs)("div",{className:"absolute bottom-6 left-1/2 z-10 flex -translate-x-1/2 items-center gap-2 rounded-xl border border-components-panel-border bg-components-panel-bg-blur p-3 shadow-lg backdrop-blur-sm",children:[(0,t.jsx)(O.RiErrorWarningFill,{className:"h-4 w-4 text-text-destructive"}),(0,t.jsx)("div",{className:"system-sm-medium text-text-secondary",children:m("generation.batchFailed.info",{ns:"share",num:eC.length})}),(0,t.jsx)("div",{className:"h-3.5 w-px bg-divider-regular"}),(0,t.jsx)("div",{onClick:()=>{eu(Date.now())},className:"system-sm-semibold-uppercase cursor-pointer text-text-accent",children:m("generation.batchFailed.retry",{ns:"share"})})]})]});return k&&T&&L?(0,t.jsxs)("div",{className:(0,o.cn)("bg-background-default-burn",x&&"flex",!x&&"flex-col",s?"h-full rounded-2xl shadow-md":"h-screen"),children:[(0,t.jsxs)("div",{className:(0,o.cn)("relative flex h-full shrink-0 flex-col",x?"w-[600px] max-w-[50%]":eG?"h-[calc(100%_-_64px)]":"",s&&"rounded-l-2xl"),children:[(0,t.jsxs)("div",{className:(0,o.cn)("shrink-0 space-y-4 border-b border-divider-subtle",x?"bg-components-panel-bg p-8 pb-0":"p-4 pb-0"),children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(p.default,{size:x?"large":"small",iconType:T.icon_type,icon:T.icon,background:T.icon_background||ei.appDefaultIconBackground,imageUrl:T.icon_url}),(0,t.jsx)("div",{className:"system-md-semibold grow truncate text-text-secondary",children:T.title}),(0,t.jsx)(ec,{hideLogout:s||ez===el.AccessMode.PUBLIC,data:T})]}),T.description&&(0,t.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:T.description}),(0,t.jsx)(eP.default,{items:[{id:"create",name:m("generation.tabs.create",{ns:"share"})},{id:"batch",name:m("generation.tabs.batch",{ns:"share"})},...n?[]:[{id:"saved",name:m("generation.tabs.saved",{ns:"share"}),isRight:!0,icon:(0,t.jsx)(O.RiBookmark3Line,{className:"h-4 w-4"}),extra:V.length>0?(0,t.jsx)(eF.default,{className:"ml-1",children:V.length}):null}]],value:g,onChange:b})]}),(0,t.jsxs)("div",{className:(0,o.cn)("h-0 grow overflow-y-auto bg-components-panel-bg",x?"px-8":"px-4",!x&&eG&&I?.remove_webapp_brand&&"rounded-b-2xl border-b-[0.5px] border-divider-regular"),children:[(0,t.jsx)("div",{className:(0,o.cn)("create"===g?"block":"hidden"),children:(0,t.jsx)(eL.default,{siteInfo:T,inputs:y,inputsRef:N,onInputsChange:_,promptConfig:L,onSend:()=>{v(!1),K(Date.now()),eb([]),e$()},visionConfig:X,onVisionFilesChange:ea,runControl:er})}),(0,t.jsx)("div",{className:(0,o.cn)(j?"block":"hidden"),children:(0,t.jsx)(eV,{vars:L.prompt_variables,onSend:e=>{if(!(e=>{if(!e||0===e.length)return c({type:"error",message:m("generation.errorMsg.empty",{ns:"share"})}),!1;let s=e[0],t=!0;if(L?.prompt_variables.forEach((e,a)=>{t&&e.name!==s[a]&&(t=!1)}),!t)return c({type:"error",message:m("generation.errorMsg.fileStructNotMatch",{ns:"share"})}),!1;let a=e.slice(1);if(0===a.length)return c({type:"error",message:m("generation.errorMsg.atLeastOne",{ns:"share"})}),!1;let n=a.filter(e=>e.every(e=>""===e)).map(e=>a.indexOf(e));if(n.length>0){let e=!1,s=n[0]-1;if(n.forEach(t=>{if(!e){if(s+1!==t){e=!0;return}s++}}),e)return c({type:"error",message:m("generation.errorMsg.emptyLine",{ns:"share",rowIndex:s+2})}),!1}if(0===(a=a.filter(e=>!e.every(e=>""===e))).length)return c({type:"error",message:m("generation.errorMsg.atLeastOne",{ns:"share"})}),!1;let l=0,r="",i="",o=0;return a.forEach((e,s)=>{0===l&&L?.prompt_variables.forEach((t,a)=>{if(0===l){if("string"===t.type&&t.max_length&&e[a].length>t.max_length){i=t.name,o=t.max_length,l=s+1;return}t.required&&""===e[a].trim()&&(r=t.name,l=s+1)}})}),0===l||(r&&c({type:"error",message:m("generation.errorMsg.invalidLine",{ns:"share",rowIndex:l+1,varName:r})}),i&&c({type:"error",message:m("generation.errorMsg.moreThanMaxLengthLine",{ns:"share",rowIndex:l+1,varName:i,maxLength:o})}),!1)})(e))return;if(!ek)return void c({type:"info",message:m("errorMessage.waitForBatchResponse",{ns:"appDebug"})});let s=e.filter(e=>!e.every(e=>""===e)).slice(1),t=L?.prompt_variables.length||0;v(!0),eb(s.map((e,s)=>{let a={};return t>0&&e.slice(0,t).forEach((e,s)=>{let t=L?.prompt_variables[s];a[t?.key]=e,e||(t?.type==="string"||t?.type==="paragraph"?a[t?.key]="":a[t?.key]=void 0)}),{id:s+1,status:s<eq?"running":"pending",params:{inputs:a}}})),eN(0),K(Date.now()),Y(Date.now()),e$()},isAllFinished:eS})}),"saved"===g&&(0,t.jsx)(eM,{className:(0,o.cn)(x?"mt-6":"mt-4"),isShowTextToSpeech:B?.enabled,list:V,onRemove:G,onStartCreateContent:()=>b("create")})]}),!I?.remove_webapp_brand&&(0,t.jsxs)("div",{className:(0,o.cn)("flex shrink-0 items-center gap-1.5 bg-components-panel-bg py-3",x?"px-8":"px-4",!x&&eG&&"rounded-b-2xl border-b-[0.5px] border-divider-regular"),children:[(0,t.jsx)("div",{className:"system-2xs-medium-uppercase text-text-tertiary",children:m("chat.poweredBy",{ns:"share"})}),C.branding.enabled&&C.branding.workspace_logo?(0,t.jsx)("img",{src:C.branding.workspace_logo,alt:"logo",className:"block h-5 w-auto"}):I?.replace_webapp_logo?(0,t.jsx)("img",{src:`${I?.replace_webapp_logo}`,alt:"logo",className:"block h-5 w-auto"}):(0,t.jsx)(es.default,{size:"small"})]})]}),(0,t.jsxs)("div",{className:(0,o.cn)(x?"h-full w-0 grow":eO?"fixed inset-0 z-50 bg-background-overlay backdrop-blur-sm":eG?"relative h-16 shrink-0 overflow-hidden bg-background-default-burn pt-2.5":""),children:[!x&&(0,t.jsx)("div",{className:(0,o.cn)(eO?"flex items-center justify-center p-2 pt-6":"absolute left-0 top-0 z-10 flex w-full items-center justify-center px-2 pb-[57px] pt-[3px]"),onClick:()=>{eO?eU():e$()},children:(0,t.jsx)("div",{className:"h-1 w-8 cursor-grab rounded bg-divider-solid"})}),eQ]})]}):(0,t.jsx)("div",{className:"flex h-screen items-center",children:(0,t.jsx)(l.default,{type:"app"})})};var eH=e.i(993628),eK=e.i(927897),eQ=e.i(356084),eY=e.i(592160);let eJ=a.memo(e=>{let{id:s}=e,{installedApps:r,isFetchingInstalledApps:i}=(0,n.useContext)(eH.default),o=(0,en.useWebAppStore)(e=>e.updateAppInfo),c=r.find(e=>e.id===s),d=(0,en.useWebAppStore)(e=>e.updateWebAppAccessMode),p=(0,en.useWebAppStore)(e=>e.updateAppParams),u=(0,en.useWebAppStore)(e=>e.updateWebAppMeta),m=(0,en.useWebAppStore)(e=>e.updateUserCanAccessApp),{isFetching:x,data:h,error:g}=(0,eQ.useGetInstalledAppAccessModeByAppId)(c?.id??null),{isFetching:b,data:f,error:v}=(0,eQ.useGetInstalledAppParams)(c?.id??null),{isFetching:j,data:y,error:w}=(0,eQ.useGetInstalledAppMeta)(c?.id??null),{data:N,error:_}=(0,eK.useGetUserCanAccessApp)({appId:c?.app.id,isInstalledApp:!0});return((0,a.useEffect)(()=>{if(c){let{id:e,app:s}=c;o({app_id:e,site:{title:s.name,icon_type:s.icon_type,icon:s.icon,icon_background:s.icon_background,icon_url:s.icon_url,prompt_public:!1,copyright:"",show_workflow_steps:!0,use_icon_as_answer_icon:s.use_icon_as_answer_icon},plan:"basic",custom_config:null})}else o(null);f&&p(f),y&&u(y),h&&d(h.accessMode),m(!!(N&&N?.result))},[c,y,f,o,p,m,u,N,h,d]),v)?(0,t.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,t.jsx)(eY.default,{unknownReason:v.message})}):w?(0,t.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,t.jsx)(eY.default,{unknownReason:w.message})}):_?(0,t.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,t.jsx)(eY.default,{unknownReason:_.message})}):g?(0,t.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,t.jsx)(eY.default,{unknownReason:g.message})}):N&&!N.result?(0,t.jsx)("div",{className:"flex h-full flex-col items-center justify-center gap-y-2",children:(0,t.jsx)(eY.default,{className:"h-auto w-auto",code:403,unknownReason:"no permission."})}):b||j||x||i?(0,t.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,t.jsx)(l.default,{})}):c?(0,t.jsxs)("div",{className:"h-full bg-background-default py-2 pl-0 pr-2 sm:p-2",children:[c?.app.mode!==M.AppModeEnum.COMPLETION&&c?.app.mode!==M.AppModeEnum.WORKFLOW&&(0,t.jsx)(eT,{installedAppInfo:c,className:"overflow-hidden rounded-2xl shadow-md"}),c?.app.mode===M.AppModeEnum.COMPLETION&&(0,t.jsx)(eG,{isInstalledApp:!0,installedAppInfo:c}),c?.app.mode===M.AppModeEnum.WORKFLOW&&(0,t.jsx)(eG,{isWorkflow:!0,isInstalledApp:!0,installedAppInfo:c})]}):(0,t.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,t.jsx)(eY.default,{code:404,isUnknownReason:!0})})});e.s(["default",0,eJ],787735)}]);
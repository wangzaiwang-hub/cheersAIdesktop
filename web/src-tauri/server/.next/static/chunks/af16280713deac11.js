(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,981086,e=>{"use strict";let t=(0,e.i(639751).create)(e=>({detail:void 0,setDetail:t=>e({detail:t})}));e.s(["usePluginStore",0,t])},380493,430807,669381,e=>{"use strict";var t,r,s,i,n,a=e.i(563199),o=e.i(837699),l=e.i(417944),c=e.i(268255);e.i(152567);var u=e.i(408767),d=e.i(654313),m=e.i(83278),p=e.i(151094),g=e.i(852933),x=e.i(137667),h=e.i(421001),f=e.i(349714),b=e.i(819114),y=e.i(935139),v=e.i(944911),T=e.i(981086);let j=()=>{let e=(0,T.usePluginStore)(e=>e.detail),{data:t,isLoading:r,refetch:s}=(0,b.useTriggerSubscriptions)(e?.provider||"");return{detail:e,subscriptions:t,isLoading:r,refetch:s}};e.s(["useSubscriptionList",0,j],430807);var N=e.i(813672),C=e.i(308011);e.i(456721);var S=e.i(610683),w=e.i(603135),E=e.i(735852),_=e.i(746628);let k=async e=>{let t="";if(e instanceof Response)try{let r=await e.clone().json();t=r?.message||e.statusText||"Unknown error"}catch{t=e.statusText||"Unknown error"}else t=e?.message||e?.toString()||"Unknown error";let r=t.match(/PluginInvokeError:\s*(\{.+\})/);if(r)try{let e=JSON.parse(r[1]);if(e.message)return e.message;if(e.error_type)return e.error_type}catch(e){console.warn("Failed to parse plugin error JSON:",e)}return t};e.s(["parsePluginErrorMessage",0,k],669381);var F=e.i(844367),B=e.i(585458),A=e.i(481162),I=e.i(955371),O=((t=O||{}).REQUEST="request",t.RESPONSE="response",t);let M=e=>{let{logs:t,className:r}=e,{t:s}=(0,u.useTranslation)(),[i,n]=(0,c.useState)(new Set),l=(e,t)=>{let r="request"===t?{headers:e.headers,data:(e=>{if("string"==typeof e&&e.startsWith("payload="))try{let t=decodeURIComponent(e.substring(8));return JSON.parse(t)}catch{return e}if("object"==typeof e)return e;try{return JSON.parse(e)}catch{return e}})(e.data)}:e;return"object"==typeof r?(0,a.jsx)(A.default,{readOnly:!0,title:(0,a.jsx)("div",{className:"system-xs-semibold-uppercase text-text-secondary",children:t}),language:I.CodeLanguage.json,value:r,isJSONStringifyBeauty:!0,nodeId:""}):(0,a.jsxs)("div",{className:"rounded-md bg-components-input-bg-normal",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between px-2 py-1",children:[(0,a.jsx)("div",{className:"system-xs-semibold-uppercase text-text-secondary",children:t}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),navigator.clipboard.writeText(String(r)),x.default.notify({type:"success",message:s("actionMsg.copySuccessfully",{ns:"common"})})},className:"rounded-md p-0.5 hover:bg-components-panel-border",children:(0,a.jsx)(o.RiFileCopyLine,{className:"h-4 w-4 text-text-tertiary"})})]}),(0,a.jsx)("div",{className:"px-2 pb-2 pt-1",children:(0,a.jsx)("pre",{className:"code-xs-regular whitespace-pre-wrap break-all text-text-secondary",children:String(r)})})]})};return t&&0!==t.length?(0,a.jsx)("div",{className:(0,y.cn)("flex flex-col gap-1",r),children:t.map((e,t)=>{let r=e.id||t.toString(),c=i.has(r),u=200===e.response.status_code,d=e.response.status_code>=400;return(0,a.jsxs)("div",{className:(0,y.cn)("relative overflow-hidden rounded-lg border bg-components-panel-on-panel-item-bg shadow-sm hover:bg-components-panel-on-panel-item-bg-hover",d&&"border-state-destructive-border",!d&&c&&"border-components-panel-border",!d&&!c&&"border-components-panel-border-subtle"),children:[d&&(0,a.jsx)("div",{className:"pointer-events-none absolute left-0 top-0 h-7 w-[179px]",children:(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"179",height:"28",viewBox:"0 0 179 28",fill:"none",className:"h-full w-full",children:[(0,a.jsx)("g",{filter:"url(#filter0_f_error_glow)",children:(0,a.jsx)("circle",{cx:"27",cy:"14",r:"32",fill:"#F04438",fillOpacity:"0.25"})}),(0,a.jsx)("defs",{children:(0,a.jsxs)("filter",{id:"filter0_f_error_glow",x:"-125",y:"-138",width:"304",height:"304",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[(0,a.jsx)("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),(0,a.jsx)("feBlend",{mode:"normal",in:"SourceGraphic",in2:"BackgroundImageFix",result:"shape"}),(0,a.jsx)("feGaussianBlur",{stdDeviation:"60",result:"effect1_foregroundBlur"})]})})]})}),(0,a.jsxs)("button",{onClick:()=>{let e;(e=new Set(i)).has(r)?e.delete(r):e.add(r),n(e)},className:(0,y.cn)("flex w-full items-center justify-between px-2 py-1.5 text-left",c?"pb-1 pt-2":"min-h-7"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-0",children:[c?(0,a.jsx)(o.RiArrowDownSLine,{className:"h-4 w-4 text-text-tertiary"}):(0,a.jsx)(o.RiArrowRightSLine,{className:"h-4 w-4 text-text-tertiary"}),(0,a.jsxs)("div",{className:"system-xs-semibold-uppercase text-text-secondary",children:[s("modal.manual.logs.request",{ns:"pluginTrigger"})," ","#",t+1]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:(0,B.default)(e.created_at).format("HH:mm:ss")}),(0,a.jsx)("div",{className:"h-3.5 w-3.5",children:u?(0,a.jsx)(o.RiCheckboxCircleFill,{className:"h-full w-full text-text-success"}):(0,a.jsx)(o.RiErrorWarningFill,{className:"h-full w-full text-text-destructive"})})]})]}),c&&(0,a.jsxs)("div",{className:"flex flex-col gap-1 px-1 pb-1",children:[l(e.request,"request"),l(e.response,"response")]})]},r)})}):null},U={[v.SupportedCreationMethods.APIKEY]:_.TriggerCredentialTypeEnum.ApiKey,[v.SupportedCreationMethods.OAUTH]:_.TriggerCredentialTypeEnum.Oauth2,[v.SupportedCreationMethods.MANUAL]:_.TriggerCredentialTypeEnum.Unauthorized},L={[v.SupportedCreationMethods.APIKEY]:"modal.apiKey.title",[v.SupportedCreationMethods.OAUTH]:"modal.oauth.title",[v.SupportedCreationMethods.MANUAL]:"modal.manual.title"};var P=((r=P||{}).Verify="verify",r.Configuration="configuration",r);let R={values:{},isCheckValidated:!1},D=e=>{let{isActive:t,text:r}=e;return(0,a.jsxs)("div",{className:`system-2xs-semibold-uppercase flex items-center gap-1 ${t?"text-state-accent-solid":"text-text-tertiary"}`,children:[t&&(0,a.jsx)("div",{className:"h-1 w-1 rounded-full bg-state-accent-solid"}),r]})},V=e=>{let{currentStep:t}=e,{t:r}=(0,u.useTranslation)();return(0,a.jsxs)("div",{className:"mb-6 flex w-1/3 items-center gap-2",children:[(0,a.jsx)(D,{isActive:"verify"===t,text:r("modal.steps.verify",{ns:"pluginTrigger"})}),(0,a.jsx)("div",{className:"h-px w-3 shrink-0 bg-divider-deep"}),(0,a.jsx)(D,{isActive:"configuration"===t,text:r("modal.steps.configuration",{ns:"pluginTrigger"})})]})},z=e=>{let{onClose:t,createType:r,builder:s}=e,{t:i}=(0,u.useTranslation)(),n=(0,T.usePluginStore)(e=>e.detail),{refetch:l}=j(),[d,m]=(0,c.useState)(r===v.SupportedCreationMethods.APIKEY?"verify":"configuration"),[p,g]=(0,c.useState)(s),h=(0,c.useRef)(!1),{mutate:f,isPending:y}=(0,b.useVerifyAndUpdateTriggerSubscriptionBuilder)(),{mutateAsync:_}=(0,b.useCreateTriggerSubscriptionBuilder)(),{mutate:B,isPending:A}=(0,b.useBuildTriggerSubscription)(),{mutate:I}=(0,b.useUpdateTriggerSubscriptionBuilder)(),O=n?.declaration?.trigger?.subscription_schema||[],P=c.useRef(null),D=c.useRef(null),z=n?.declaration.trigger?.subscription_constructor?.parameters||[],K=c.useRef(null),q=(0,c.useMemo)(()=>(n?.declaration?.trigger?.subscription_constructor?.credentials_schema||[]).map(e=>({...e,tooltip:e.help})),[n?.declaration?.trigger?.subscription_constructor?.credentials_schema]),H=c.useRef(null),{data:$}=(0,b.useTriggerSubscriptionBuilderLogs)(n?.provider||"",p?.id||"",{enabled:r===v.SupportedCreationMethods.MANUAL,refetchInterval:3e3});(0,c.useEffect)(()=>{let e=async()=>{h.current=!0;try{let e=await _({provider:n?.provider||"",credential_type:U[r]});g(e.subscription_builder)}catch(e){console.error("createBuilder error:",e),x.default.notify({type:"error",message:i("modal.errors.createFailed",{ns:"pluginTrigger"})})}};!h.current&&!p&&n?.provider&&e()},[p,n?.provider,r,_,i]),(0,c.useEffect)(()=>{if(p?.endpoint&&D.current&&"configuration"===d){let e=D.current.getForm();e&&e.setFieldValue("callback_url",p.endpoint),(0,F.isPrivateOrLocalAddress)(p.endpoint)?(console.warn("callback_url is private or local address",p.endpoint),D.current?.setFields([{name:"callback_url",warnings:[i("modal.form.callbackUrl.privateAddressWarning",{ns:"pluginTrigger"})]}])):D.current?.setFields([{name:"callback_url",warnings:[]}])}},[p?.endpoint,d,i]);let W=(0,c.useMemo)(()=>(0,N.debounce)((e,t,r)=>{I({provider:e,subscriptionBuilderId:t,properties:r},{onError:async e=>{let t=await k(e)||i("modal.errors.updateFailed",{ns:"pluginTrigger"});console.error("Failed to update subscription builder:",e),x.default.notify({type:"error",message:t})}})},500),[I,i]),Y=(0,c.useCallback)(()=>{if(!p||!n?.provider)return;let e=P.current?.getFormValues({needCheckValidatedValues:!1})||{values:{},isCheckValidated:!0};W(n.provider,p.id,e.values)},[p,n?.provider,W]);(0,c.useEffect)(()=>()=>{W.cancel()},[W]);let J=(0,c.useMemo)(()=>"verify"===d?y?i("modal.common.verifying",{ns:"pluginTrigger"}):i("modal.common.verify",{ns:"pluginTrigger"}):A?i("modal.common.creating",{ns:"pluginTrigger"}):i("modal.common.create",{ns:"pluginTrigger"}),[d,y,A,i]);return(0,a.jsxs)(E.default,{title:i(L[r],{ns:"pluginTrigger"}),confirmButtonText:J,onClose:t,onCancel:t,onConfirm:()=>{if("verify"===d){let e;Object.keys(e=(H.current?.getFormValues({})||R).values).length?(H.current?.setFields([{name:Object.keys(e)[0],errors:[]}]),f({provider:n?.provider||"",subscriptionBuilderId:p?.id||"",credentials:e},{onSuccess:()=>{x.default.notify({type:"success",message:i("modal.apiKey.verify.success",{ns:"pluginTrigger"})}),m("configuration")},onError:async t=>{let r=await k(t)||i("modal.apiKey.verify.error",{ns:"pluginTrigger"});H.current?.setFields([{name:Object.keys(e)[0],errors:[r]}])}})):x.default.notify({type:"error",message:"Please fill in all required credentials"})}else(()=>{if(!p)return x.default.notify({type:"error",message:"Subscription builder not found"});let e=D.current?.getFormValues({});if(!e?.isCheckValidated)return;let s=e?.values?.subscription_name,a={provider:n?.provider||"",subscriptionBuilderId:p.id,name:s};if(r!==v.SupportedCreationMethods.MANUAL){if(z.length>0){let e=K.current?.getFormValues({})||R;if(!e?.isCheckValidated)return;a.parameters=e.values}}else if(O.length>0){let e=P.current?.getFormValues({})||R;if(!e?.isCheckValidated)return}B(a,{onSuccess:()=>{x.default.notify({type:"success",message:i("subscription.createSuccess",{ns:"pluginTrigger"})}),t(),l?.()},onError:async e=>{let t=await k(e)||i("subscription.createFailed",{ns:"pluginTrigger"});x.default.notify({type:"error",message:t})}})})()},disabled:y||A,bottomSlot:"verify"===d?(0,a.jsx)(C.EncryptedBottom,{}):null,size:r===v.SupportedCreationMethods.MANUAL?"md":"sm",containerClassName:"min-h-[360px]",clickOutsideNotClose:!0,children:[r===v.SupportedCreationMethods.APIKEY&&(0,a.jsx)(V,{currentStep:d}),"verify"===d&&(0,a.jsx)(a.Fragment,{children:q.length>0&&(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)(S.BaseForm,{formSchemas:q,ref:H,labelClassName:"system-sm-medium mb-2 flex items-center gap-1 text-text-primary",preventDefaultSubmit:!0,formClassName:"space-y-4",onChange:()=>{H.current?.setFields([{name:q[0].name,errors:[]}])}})})}),"configuration"===d&&(0,a.jsxs)("div",{className:"max-h-[70vh]",children:[(0,a.jsx)(S.BaseForm,{formSchemas:[{name:"subscription_name",label:i("modal.form.subscriptionName.label",{ns:"pluginTrigger"}),placeholder:i("modal.form.subscriptionName.placeholder",{ns:"pluginTrigger"}),type:w.FormTypeEnum.textInput,required:!0},{name:"callback_url",label:i("modal.form.callbackUrl.label",{ns:"pluginTrigger"}),placeholder:i("modal.form.callbackUrl.placeholder",{ns:"pluginTrigger"}),type:w.FormTypeEnum.textInput,required:!1,default:p?.endpoint||"",disabled:!0,tooltip:i("modal.form.callbackUrl.tooltip",{ns:"pluginTrigger"}),showCopy:!0}],ref:D,labelClassName:"system-sm-medium mb-2 flex items-center gap-1 text-text-primary",formClassName:"space-y-4 mb-4"}),r!==v.SupportedCreationMethods.MANUAL&&z.length>0&&(0,a.jsx)(S.BaseForm,{formSchemas:z.map(e=>{let t=(e=>{if(Object.values(w.FormTypeEnum).includes(e))return e;switch(e){case"string":case"text":default:return w.FormTypeEnum.textInput;case"password":case"secret":return w.FormTypeEnum.secretInput;case"number":case"integer":return w.FormTypeEnum.textNumber;case"boolean":return w.FormTypeEnum.boolean}})(e.type);return{...e,tooltip:e.description,type:t,dynamicSelectParams:t===w.FormTypeEnum.dynamicSelect?{plugin_id:n?.plugin_id||"",provider:n?.provider||"",action:"provider",parameter:e.name,credential_id:p?.id||""}:void 0,fieldClassName:e.type===w.FormTypeEnum.boolean?"flex items-center justify-between":void 0,labelClassName:e.type===w.FormTypeEnum.boolean?"mb-0":void 0}}),ref:K,labelClassName:"system-sm-medium mb-2 flex items-center gap-1 text-text-primary",formClassName:"space-y-4"}),r===v.SupportedCreationMethods.MANUAL&&(0,a.jsxs)(a.Fragment,{children:[O.length>0&&(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)(S.BaseForm,{formSchemas:O.map(e=>({...e,tooltip:e.description})),ref:P,labelClassName:"system-sm-medium mb-2 flex items-center gap-1 text-text-primary",formClassName:"space-y-4",onChange:Y})}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"mb-3 flex items-center gap-2",children:[(0,a.jsx)("div",{className:"system-xs-medium-uppercase text-text-tertiary",children:i("modal.manual.logs.title",{ns:"pluginTrigger"})}),(0,a.jsx)("div",{className:"h-px flex-1 bg-gradient-to-r from-divider-regular to-transparent"})]}),(0,a.jsxs)("div",{className:"mb-1 flex items-center justify-center gap-1 rounded-lg bg-background-section p-3",children:[(0,a.jsx)("div",{className:"h-3.5 w-3.5",children:(0,a.jsx)(o.RiLoader2Line,{className:"h-full w-full animate-spin"})}),(0,a.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:i("modal.manual.logs.loading",{ns:"pluginTrigger",pluginName:n?.name||""})})]}),(0,a.jsx)(M,{logs:$?.logs||[]})]})]})]})]})};var K=e.i(597280),q=((s=q||{}).Pending="pending",s.Success="success",s.Failed="failed",s),H=((i=H||{}).Default="default",i.Custom="custom",i);let $=e=>{let{oauthConfig:t,onClose:r,showOAuthCreateModal:s}=e,{t:i}=(0,u.useTranslation)(),n=(0,T.usePluginStore)(e=>e.detail),{system_configured:l,params:d,oauth_client_schema:m}=t||{},[g,h]=(0,c.useState)(),[y,v]=(0,c.useState)(),[j,N]=(0,c.useState)(l?"default":"custom"),C=c.useRef(null),w=(0,c.useMemo)(()=>{if(m&&m.length>0&&d){let e=Object.keys(d||{});for(let t of m)e.includes(t.name)&&(t.default=d?.[t.name]);return m}return[]},[m,d]),_=n?.provider||"",{mutate:k}=(0,b.useInitiateTriggerOAuth)(),{mutate:F}=(0,b.useVerifyAndUpdateTriggerSubscriptionBuilder)(),{mutate:B}=(0,b.useConfigureTriggerOAuth)(),{mutate:A}=(0,b.useDeleteTriggerOAuth)(),I=(0,c.useMemo)(()=>"pending"===y?i("modal.common.authorizing",{ns:"pluginTrigger"}):"success"===y?i("modal.oauth.authorization.waitingJump",{ns:"pluginTrigger"}):i("auth.saveAndAuth",{ns:"plugin"}),[y,i]);(0,c.useEffect)(()=>{if(_&&g&&"pending"===y){let e=setInterval(()=>{F({provider:_,subscriptionBuilderId:g.id},{onSuccess:t=>{t.verified&&(v("success"),clearInterval(e))},onError:()=>{}})},3e3);return()=>clearInterval(e)}},[g,y,F,_,i]);let O=e=>{let n="custom"===j,a={provider:_,enabled:n};if(n){let e=C.current?.getFormValues({});if(!e.isCheckValidated)return;let r=e.values;r.client_id===t?.params.client_id&&(r.client_id="[__HIDDEN__]"),r.client_secret===t?.params.client_secret&&(r.client_secret="[__HIDDEN__]"),a.client_params=r}B(a,{onSuccess:()=>{e?(v("pending"),k(_,{onSuccess:e=>{h(e.subscription_builder),(0,f.openOAuthPopup)(e.authorization_url,t=>{t&&(x.default.notify({type:"success",message:i("modal.oauth.authorization.authSuccess",{ns:"pluginTrigger"})}),r(),s(e.subscription_builder))})},onError:()=>{v("failed"),x.default.notify({type:"error",message:i("modal.oauth.authorization.authFailed",{ns:"pluginTrigger"})})}})):(r(),x.default.notify({type:"success",message:i("modal.oauth.save.success",{ns:"pluginTrigger"})}))}})};return(0,a.jsxs)(E.default,{title:i("modal.oauth.title",{ns:"pluginTrigger"}),confirmButtonText:I,cancelButtonText:i("auth.saveOnly",{ns:"plugin"}),extraButtonText:i("operation.cancel",{ns:"common"}),showExtraButton:!0,clickOutsideNotClose:!0,extraButtonVariant:"secondary",onExtraButtonClick:r,onClose:r,onCancel:()=>O(!1),onConfirm:()=>O(!0),footerSlot:t?.custom_enabled&&t?.params&&"custom"===j&&(0,a.jsx)("div",{className:"grow",children:(0,a.jsx)(p.default,{variant:"secondary",className:"text-components-button-destructive-secondary-text",onClick:()=>{A(_,{onSuccess:()=>{r(),x.default.notify({type:"success",message:i("modal.oauth.remove.success",{ns:"pluginTrigger"})})},onError:e=>{x.default.notify({type:"error",message:((e,t)=>{if(e instanceof Error&&e.message)return e.message;if("object"==typeof e&&e&&"message"in e){let t=e.message;if("string"==typeof t&&t)return t}return t})(e,i("modal.oauth.remove.failed",{ns:"pluginTrigger"}))})}})},children:i("operation.remove",{ns:"common"})})}),children:[(0,a.jsx)("div",{className:"system-sm-medium mb-2 text-text-secondary",children:i("subscription.addType.options.oauth.clientTitle",{ns:"pluginTrigger"})}),t?.system_configured&&(0,a.jsx)("div",{className:"mb-4 flex w-full items-start justify-between gap-2",children:["default","custom"].map(e=>(0,a.jsx)(K.default,{title:i(`subscription.addType.options.oauth.${e}`,{ns:"pluginTrigger"}),onSelect:()=>N(e),selected:j===e,className:"flex-1"},e))}),"custom"===j&&t?.redirect_uri&&(0,a.jsxs)("div",{className:"mb-4 flex items-start gap-3 rounded-xl bg-background-section-burn p-4",children:[(0,a.jsx)("div",{className:"rounded-lg border-[0.5px] border-components-card-border bg-components-card-bg p-2 shadow-xs shadow-shadow-shadow-3",children:(0,a.jsx)(o.RiInformation2Fill,{className:"h-5 w-5 shrink-0 text-text-accent"})}),(0,a.jsxs)("div",{className:"flex-1 text-text-secondary",children:[(0,a.jsx)("div",{className:"system-sm-regular whitespace-pre-wrap leading-4",children:i("modal.oauthRedirectInfo",{ns:"pluginTrigger"})}),(0,a.jsx)("div",{className:"system-sm-medium my-1.5 break-all leading-4",children:t.redirect_uri}),(0,a.jsxs)(p.default,{variant:"secondary",size:"small",onClick:()=>{navigator.clipboard.writeText(t.redirect_uri),x.default.notify({type:"success",message:i("actionMsg.copySuccessfully",{ns:"common"})})},children:[(0,a.jsx)(o.RiClipboardLine,{className:"mr-1 h-[14px] w-[14px]"}),i("operation.copy",{ns:"common"})]})]})]}),"custom"===j&&w.length>0&&(0,a.jsx)(S.BaseForm,{formSchemas:w,ref:C,labelClassName:"system-sm-medium mb-2 block text-text-secondary",formClassName:"space-y-4"})]})};var W=((n={}).FULL_BUTTON="full-button",n.ICON_BUTTON="icon-button",n);let Y="default";e.s(["CreateButtonType",()=>W,"CreateSubscriptionButton",0,e=>{let{buttonType:t="full-button",shape:r="square"}=e,{t:s}=(0,u.useTranslation)(),{subscriptions:i}=j(),n=i?.length||0,[N,C]=(0,c.useState)(null),S=(0,T.usePluginStore)(e=>e.detail),{data:w}=(0,b.useTriggerProviderInfo)(S?.provider||""),E=w?.supported_creation_methods||[],{data:_,refetch:k}=(0,b.useTriggerOAuthConfig)(S?.provider||"",E.includes(v.SupportedCreationMethods.OAUTH)),{mutate:F}=(0,b.useInitiateTriggerOAuth)(),B=1===E.length?E[0]:Y,[A,{setTrue:I,setFalse:O}]=(0,l.useBoolean)(!1),M=(0,c.useMemo)(()=>({[v.SupportedCreationMethods.OAUTH]:s("subscription.createButton.oauth",{ns:"pluginTrigger"}),[v.SupportedCreationMethods.APIKEY]:s("subscription.createButton.apiKey",{ns:"pluginTrigger"}),[v.SupportedCreationMethods.MANUAL]:s("subscription.createButton.manual",{ns:"pluginTrigger"}),[Y]:s("subscription.empty.button",{ns:"pluginTrigger"})}),[s]),U=e=>{e.stopPropagation(),e.preventDefault(),I()},L=(0,c.useMemo)(()=>{let e=_?.custom_enabled&&_?.custom_configured;return[{value:v.SupportedCreationMethods.OAUTH,label:s("subscription.addType.options.oauth.title",{ns:"pluginTrigger"}),tag:e?(0,a.jsx)(m.default,{className:"ml-1 mr-0.5",children:s("auth.custom",{ns:"plugin"})}):null,extra:(0,a.jsx)(h.default,{popupContent:s("subscription.addType.options.oauth.clientSettings",{ns:"pluginTrigger"}),children:(0,a.jsx)(d.ActionButton,{onClick:U,children:(0,a.jsx)(o.RiEqualizer2Line,{className:"h-4 w-4 text-text-tertiary"})})}),show:E.includes(v.SupportedCreationMethods.OAUTH)},{value:v.SupportedCreationMethods.APIKEY,label:s("subscription.addType.options.apikey.title",{ns:"pluginTrigger"}),show:E.includes(v.SupportedCreationMethods.APIKEY)},{value:v.SupportedCreationMethods.MANUAL,label:s("subscription.addType.options.manual.description",{ns:"pluginTrigger"}),extra:(0,a.jsx)(h.default,{popupContent:s("subscription.addType.options.manual.tip",{ns:"pluginTrigger"})}),show:E.includes(v.SupportedCreationMethods.MANUAL)}]},[s,_,E,B]),P=async e=>{e===v.SupportedCreationMethods.OAUTH?_?.configured?F(S?.provider||"",{onSuccess:e=>{(0,f.openOAuthPopup)(e.authorization_url,t=>{t&&(x.default.notify({type:"success",message:s("modal.oauth.authorization.authSuccess",{ns:"pluginTrigger"})}),C({type:v.SupportedCreationMethods.OAUTH,builder:e.subscription_builder}))})},onError:()=>{x.default.notify({type:"error",message:s("modal.oauth.authorization.authFailed",{ns:"pluginTrigger"})})}}):I():C({type:e})},R=e=>{n>=10?e.stopPropagation():B!==Y&&(B!==v.SupportedCreationMethods.OAUTH||1!==E.length)&&(e.stopPropagation(),e.preventDefault(),P(B))};return E.length?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(g.default,{options:L.filter(e=>e.show),value:B,onChange:e=>P(e),containerProps:{open:(B===Y||B===v.SupportedCreationMethods.OAUTH&&1===E.length)&&void 0,placement:"bottom-start",offset:4,triggerPopupSameWidth:"full-button"===t},triggerProps:{className:(0,y.cn)("h-8 bg-transparent px-0 hover:bg-transparent",B!==Y&&E.length>1&&"pointer-events-none","full-button"===t&&"grow")},popupProps:{wrapperClassName:"z-[1000]"},CustomTrigger:()=>"full-button"===t?(0,a.jsxs)(p.Button,{variant:"primary",size:"medium",className:"flex w-full items-center justify-between px-0",onClick:R,children:[(0,a.jsxs)("div",{className:"flex flex-1 items-center justify-center",children:[(0,a.jsx)(o.RiAddLine,{className:"mr-2 size-4"}),M[B],B===v.SupportedCreationMethods.OAUTH&&_?.custom_enabled&&_?.custom_configured&&(0,a.jsx)(m.default,{className:"ml-1 mr-0.5 border-text-primary-on-surface bg-components-badge-bg-dimm text-text-primary-on-surface",children:s("auth.custom",{ns:"plugin"})})]}),B===v.SupportedCreationMethods.OAUTH&&(0,a.jsxs)("div",{className:"ml-auto flex items-center",children:[(0,a.jsx)("div",{className:"h-4 w-px bg-text-primary-on-surface opacity-15"}),(0,a.jsx)(h.default,{popupContent:s("subscription.addType.options.oauth.clientSettings",{ns:"pluginTrigger"}),children:(0,a.jsx)("div",{onClick:U,className:"p-2",children:(0,a.jsx)(o.RiEqualizer2Line,{className:"size-4 text-components-button-primary-text"})})})]})]}):(0,a.jsx)(h.default,{popupContent:n>=10?s("subscription.maxCount",{ns:"pluginTrigger",num:10}):s(`subscription.addType.options.${B.toLowerCase()}.description`,{ns:"pluginTrigger"}),disabled:!(E?.length===1||n>=10),children:(0,a.jsx)(d.ActionButton,{onClick:R,className:(0,y.cn)("float-right","circle"===r&&"!rounded-full border-[0.5px] border-components-button-secondary-border-hover bg-components-button-secondary-bg-hover text-components-button-secondary-accent-text shadow-xs hover:border-components-button-secondary-border-disabled hover:bg-components-button-secondary-bg-disabled hover:text-components-button-secondary-accent-text-disabled"),state:n>=10?d.ActionButtonState.Disabled:d.ActionButtonState.Default,children:(0,a.jsx)(o.RiAddLine,{className:"size-4"})})}),CustomOption:e=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mr-8 flex grow items-center gap-1 truncate px-1",children:[e.label,e.tag]}),e.extra]})}),N&&(0,a.jsx)(z,{createType:N.type,builder:N.builder,onClose:()=>C(null)}),A&&(0,a.jsx)($,{oauthConfig:_,onClose:()=>{O(),k()},showOAuthCreateModal:e=>C({type:v.SupportedCreationMethods.OAUTH,builder:e})})]}):null}],380493)},545035,e=>{"use strict";var t=e.i(563199),r=e.i(268255),s=e.i(837699),i=e.i(151094),n=e.i(925521),a=e.i(935139);class o extends r.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null,errorCount:0}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){n.IS_DEV&&(console.error("ErrorBoundary caught an error:",e),console.error("Error Info:",t)),this.setState(e=>({errorInfo:t,errorCount:e.errorCount+1})),this.props.onError&&this.props.onError(e,t)}componentDidUpdate(e){let{resetKeys:t,resetOnPropsChange:r}=this.props,{hasError:s}=this.state;s&&e.resetKeys!==t&&t?.some((t,r)=>t!==e.resetKeys?.[r])&&this.props.resetErrorBoundary(),s&&r&&e.children!==this.props.children&&this.props.resetErrorBoundary(),e.resetKeys!==t&&this.props.onResetKeysChange(e.resetKeys)}render(){let{hasError:e,error:r,errorInfo:n,errorCount:o}=this.state,{fallback:l,children:c,showDetails:u=!1,className:d,isolate:m=!0,enableRecovery:p=!0,customTitle:g,customMessage:x,resetErrorBoundary:h}=this.props;if(e&&r)return l?"function"==typeof l?l(r,h):l:(0,t.jsxs)("div",{className:(0,a.cn)("border-state-critical-border bg-state-critical-hover-alt flex flex-col items-center justify-center rounded-lg border p-8",m&&"min-h-[200px]",d),children:[(0,t.jsxs)("div",{className:"mb-4 flex items-center gap-2",children:[(0,t.jsx)(s.RiAlertLine,{className:"text-state-critical-solid h-8 w-8"}),(0,t.jsx)("h2",{className:"text-xl font-semibold text-text-primary",children:g||"Something went wrong"})]}),(0,t.jsx)("p",{className:"mb-6 text-center text-text-secondary",children:x||"An unexpected error occurred while rendering this component."}),u&&n&&(0,t.jsxs)("details",{className:"mb-6 w-full max-w-2xl",children:[(0,t.jsx)("summary",{className:"mb-2 cursor-pointer text-sm font-medium text-text-tertiary hover:text-text-secondary",children:(0,t.jsxs)("span",{className:"inline-flex items-center gap-1",children:[(0,t.jsx)(s.RiBugLine,{className:"h-4 w-4"}),"Error Details (Development Only)"]})}),(0,t.jsxs)("div",{className:"rounded-lg bg-gray-100 p-4",children:[(0,t.jsxs)("div",{className:"mb-2",children:[(0,t.jsx)("span",{className:"font-mono text-xs font-semibold text-gray-600",children:"Error:"}),(0,t.jsx)("pre",{className:"mt-1 overflow-auto whitespace-pre-wrap font-mono text-xs text-gray-800",children:r.toString()})]}),n&&(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-mono text-xs font-semibold text-gray-600",children:"Component Stack:"}),(0,t.jsx)("pre",{className:"mt-1 max-h-40 overflow-auto whitespace-pre-wrap font-mono text-xs text-gray-700",children:n.componentStack})]}),o>1&&(0,t.jsxs)("div",{className:"mt-2 text-xs text-gray-600",children:["This error has occurred"," ",o," ","times"]})]})]}),p&&(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)(i.default,{variant:"primary",size:"small",onClick:h,children:"Try Again"}),(0,t.jsx)(i.default,{variant:"secondary",size:"small",onClick:()=>window.location.reload(),children:"Reload Page"})]})]});return c}}let l=e=>{let[t,s]=(0,r.useState)(0),i=(0,r.useRef)(e.resetKeys),n=(0,r.useRef)(void 0),a=(0,r.useCallback)(()=>{s(e=>e+1),e.onReset?.()},[e]),l=(0,r.useCallback)(e=>{n.current=e},[]);return(0,r.useEffect)(()=>{n.current!==e.resetKeys&&(i.current=e.resetKeys)},[e.resetKeys]),(0,r.createElement)(o,{...e,key:t,resetErrorBoundary:a,onResetKeysChange:l})};function c(e,r){let s=s=>(0,t.jsx)(l,{...r,children:(0,t.jsx)(e,{...s})});return s.displayName=`withErrorBoundary(${e.displayName||e.name||"Component"})`,s}e.s(["withErrorBoundary",()=>c])},437377,586713,655098,e=>{"use strict";var t,r,s=e.i(563199);e.i(152567);var i=e.i(408767),n=e.i(421001),a=e.i(935139),o=e.i(380493),l=e.i(837699),c=e.i(417944),u=e.i(654313),d=e.i(268255),m=e.i(547105),p=e.i(291631),g=e.i(137667),x=e.i(819114),h=e.i(430807);let f="subscription.list.item.actions.deleteConfirm",b=e=>{let{onClose:t,isShow:r,currentId:n,currentName:a,workflowsInUse:o}=e,{refetch:l}=(0,h.useSubscriptionList)(),{mutate:c,isPending:u}=(0,x.useDeleteTriggerSubscription)(),{t:b}=(0,i.useTranslation)(),[y,v]=(0,d.useState)("");return(0,s.jsx)(m.default,{title:b(`${f}.title`,{ns:"pluginTrigger",name:a}),confirmText:b(`${f}.confirm`,{ns:"pluginTrigger"}),content:o>0?(0,s.jsxs)(s.Fragment,{children:[b(`${f}.contentWithApps`,{ns:"pluginTrigger",count:o}),(0,s.jsx)("div",{className:"system-sm-medium mb-2 mt-6 text-text-secondary",children:b(`${f}.confirmInputTip`,{ns:"pluginTrigger",name:a})}),(0,s.jsx)(p.default,{value:y,onChange:e=>v(e.target.value),placeholder:b(`${f}.confirmInputPlaceholder`,{ns:"pluginTrigger",name:a})})]}):b(`${f}.content`,{ns:"pluginTrigger"}),isShow:r,isLoading:u,isDisabled:u,onConfirm:()=>{o>0&&y!==a?g.default.notify({type:"error",message:b(`${f}.confirmInputWarning`,{ns:"pluginTrigger"}),className:"z-[10000001]"}):c(n,{onSuccess:()=>{g.default.notify({type:"success",message:b(`${f}.success`,{ns:"pluginTrigger",name:a}),className:"z-[10000001]"}),l?.(),t(!0)},onError:e=>{g.default.notify({type:"error",message:e?.message||b(`${f}.error`,{ns:"pluginTrigger",name:a}),className:"z-[10000001]"})}})},onCancel:()=>t(!1),maskClosable:!1})};var y=e.i(746628),v=e.i(346563),T=e.i(308011);e.i(456721);var j=e.i(610683),N=e.i(603135),C=e.i(735852),S=e.i(665127),w=e.i(669381),E=e.i(808462),_=e.i(981086),k=((t=k||{}).EditCredentials="edit_credentials",t.EditConfiguration="edit_configuration",t);let F=e=>{switch(e){case"string":case"text":return N.FormTypeEnum.textInput;case"password":case"secret":return N.FormTypeEnum.secretInput;case"number":case"integer":return N.FormTypeEnum.textNumber;case"boolean":return N.FormTypeEnum.boolean;case"select":return N.FormTypeEnum.select;default:if(Object.values(N.FormTypeEnum).includes(e))return e;return N.FormTypeEnum.textInput}},B=e=>{let{isActive:t,text:r,onClick:i,clickable:n}=e;return(0,s.jsxs)("div",{className:`system-2xs-semibold-uppercase flex items-center gap-1 ${t?"text-state-accent-solid":"text-text-tertiary"} ${n?"cursor-pointer hover:text-text-secondary":""}`,onClick:n?i:void 0,children:[t&&(0,s.jsx)("div",{className:"h-1 w-1 rounded-full bg-state-accent-solid"}),r]})},A=e=>{let{currentStep:t,onStepClick:r}=e,{t:n}=(0,i.useTranslation)();return(0,s.jsxs)("div",{className:"mb-6 flex w-1/3 items-center gap-2",children:[(0,s.jsx)(B,{isActive:"edit_credentials"===t,text:n("modal.steps.verify",{ns:"pluginTrigger"}),onClick:()=>r?.("edit_credentials"),clickable:"edit_configuration"===t}),(0,s.jsx)("div",{className:"h-px w-3 shrink-0 bg-divider-deep"}),(0,s.jsx)(B,{isActive:"edit_configuration"===t,text:n("modal.steps.configuration",{ns:"pluginTrigger"})})]})},I=e=>{let{onClose:t,subscription:r,pluginDetail:n}=e,{t:a}=(0,i.useTranslation)(),o=(0,_.usePluginStore)(e=>e.detail),{refetch:l}=(0,h.useSubscriptionList)(),[c,u]=(0,d.useState)("edit_credentials"),[m,p]=(0,d.useState)(null),{mutate:f,isPending:b}=(0,x.useUpdateTriggerSubscription)(),{mutate:y,isPending:k}=(0,x.useVerifyTriggerSubscription)(),B=(0,d.useMemo)(()=>o?.declaration?.trigger?.subscription_constructor?.parameters||[],[o?.declaration?.trigger?.subscription_constructor?.parameters]),I=(0,d.useMemo)(()=>(o?.declaration?.trigger?.subscription_constructor?.credentials_schema||[]).map(e=>({...e,tooltip:e.help})),[o?.declaration?.trigger?.subscription_constructor?.credentials_schema]),O=(0,d.useRef)(null),M=(0,d.useRef)(null),U=(0,d.useRef)(null),L=(0,d.useMemo)(()=>[{name:"subscription_name",label:a("modal.form.subscriptionName.label",{ns:"pluginTrigger"}),placeholder:a("modal.form.subscriptionName.placeholder",{ns:"pluginTrigger"}),type:N.FormTypeEnum.textInput,required:!0,default:r.name},{name:"callback_url",label:a("modal.form.callbackUrl.label",{ns:"pluginTrigger"}),placeholder:a("modal.form.callbackUrl.placeholder",{ns:"pluginTrigger"}),type:N.FormTypeEnum.textInput,required:!1,default:r.endpoint||"",disabled:!0,tooltip:a("modal.form.callbackUrl.tooltip",{ns:"pluginTrigger"}),showCopy:!0}],[a,r.name,r.endpoint]),P=(0,d.useMemo)(()=>I.map(e=>({...e,type:F(e.type),tooltip:e.help,default:r.credentials?.[e.name]||e.default})),[I,r.credentials]),R=(0,d.useMemo)(()=>B.map(e=>{let t=F(e.type);return{...e,type:t,tooltip:e.description,default:r.parameters?.[e.name]||e.default,dynamicSelectParams:t===N.FormTypeEnum.dynamicSelect?{plugin_id:o?.plugin_id||"",provider:o?.provider||"",action:"provider",parameter:e.name,credential_id:r.id,credentials:m||void 0}:void 0,fieldClassName:e.type===N.FormTypeEnum.boolean?"flex items-center justify-between":void 0,labelClassName:e.type===N.FormTypeEnum.boolean?"mb-0":void 0}}),[B,r.parameters,r.id,o?.plugin_id,o?.provider,m]),D=()=>{u("edit_credentials"),p(null)};return(0,s.jsxs)(C.default,{title:a("subscription.list.item.actions.edit.title",{ns:"pluginTrigger"}),confirmButtonText:"edit_credentials"===c?k?a("modal.common.verifying",{ns:"pluginTrigger"}):a("modal.common.verify",{ns:"pluginTrigger"}):b?a("operation.saving",{ns:"common"}):a("operation.save",{ns:"common"}),onClose:t,onCancel:t,onConfirm:()=>{"edit_credentials"===c?(()=>{let e=U.current?.getFormValues({needTransformWhenSecretFieldIsPristine:!0})||{values:{},isCheckValidated:!1};if(!e.isCheckValidated)return;let t=e.values;y({provider:r.provider,subscriptionId:r.id,credentials:t},{onSuccess:()=>{g.default.notify({type:"success",message:a("modal.apiKey.verify.success",{ns:"pluginTrigger"})}),p(Object.values(t).every(e=>"[__HIDDEN__]"===e)?null:t),u("edit_configuration")},onError:async e=>{let t=await (0,w.parsePluginErrorMessage)(e)||a("modal.apiKey.verify.error",{ns:"pluginTrigger"});g.default.notify({type:"error",message:t})}})})():(()=>{let e,s=O.current?.getFormValues({});if(!s?.isCheckValidated)return;let i=s.values.subscription_name;if(B.length>0){let t=M.current?.getFormValues({needTransformWhenSecretFieldIsPristine:!0});if(!t?.isCheckValidated)return;e=(0,v.isEqual)(t.values,r.parameters||{})?void 0:t.values}f({subscriptionId:r.id,name:i,parameters:e,credentials:m||void 0},{onSuccess:()=>{g.default.notify({type:"success",message:a("subscription.list.item.actions.edit.success",{ns:"pluginTrigger"})}),l?.(),t()},onError:async e=>{let t=await (0,w.parsePluginErrorMessage)(e)||a("subscription.list.item.actions.edit.error",{ns:"pluginTrigger"});g.default.notify({type:"error",message:t})}})})()},disabled:b||k,showExtraButton:"edit_configuration"===c,extraButtonText:a("modal.common.back",{ns:"pluginTrigger"}),extraButtonVariant:"secondary",onExtraButtonClick:D,clickOutsideNotClose:!0,wrapperClassName:"!z-[101]",bottomSlot:"edit_credentials"===c?(0,s.jsx)(T.EncryptedBottom,{}):null,children:[n&&(0,s.jsx)(S.ReadmeEntrance,{pluginDetail:n,showType:E.ReadmeShowType.modal}),(0,s.jsx)(A,{currentStep:c,onStepClick:D}),"edit_credentials"===c&&(0,s.jsx)("div",{className:"mb-4",children:P.length>0&&(0,s.jsx)(j.BaseForm,{formSchemas:P,ref:U,labelClassName:"system-sm-medium mb-2 flex items-center gap-1 text-text-primary",formClassName:"space-y-4",preventDefaultSubmit:!0})}),"edit_configuration"===c&&(0,s.jsxs)("div",{className:"max-h-[70vh]",children:[(0,s.jsx)(j.BaseForm,{formSchemas:L,ref:O,labelClassName:"system-sm-medium mb-2 flex items-center gap-1 text-text-primary",formClassName:"space-y-4 mb-4"}),R.length>0&&(0,s.jsx)(j.BaseForm,{formSchemas:R,ref:M,labelClassName:"system-sm-medium mb-2 flex items-center gap-1 text-text-primary",formClassName:"space-y-4"})]})]})},O=e=>{let{onClose:t,subscription:r,pluginDetail:n}=e,{t:a}=(0,i.useTranslation)(),o=(0,_.usePluginStore)(e=>e.detail),{refetch:l}=(0,h.useSubscriptionList)(),{mutate:c,isPending:u}=(0,x.useUpdateTriggerSubscription)(),m=(0,d.useMemo)(()=>o?.declaration?.trigger?.subscription_schema||[],[o?.declaration?.trigger?.subscription_schema]),p=(0,d.useRef)(null),f=(0,d.useMemo)(()=>[{name:"subscription_name",label:a("modal.form.subscriptionName.label",{ns:"pluginTrigger"}),placeholder:a("modal.form.subscriptionName.placeholder",{ns:"pluginTrigger"}),type:N.FormTypeEnum.textInput,required:!0,default:r.name},{name:"callback_url",label:a("modal.form.callbackUrl.label",{ns:"pluginTrigger"}),placeholder:a("modal.form.callbackUrl.placeholder",{ns:"pluginTrigger"}),type:N.FormTypeEnum.textInput,required:!1,default:r.endpoint||"",disabled:!0,tooltip:a("modal.form.callbackUrl.tooltip",{ns:"pluginTrigger"}),showCopy:!0},...m.map(e=>({...e,type:(e=>{switch(e){case"string":case"text":return N.FormTypeEnum.textInput;case"password":case"secret":return N.FormTypeEnum.secretInput;case"number":case"integer":return N.FormTypeEnum.textNumber;case"boolean":return N.FormTypeEnum.boolean;case"select":return N.FormTypeEnum.select;default:if(Object.values(N.FormTypeEnum).includes(e))return e;return N.FormTypeEnum.textInput}})(e.type),tooltip:e.description,default:r.properties?.[e.name]||e.default}))],[a,r.name,r.endpoint,r.properties,m]);return(0,s.jsxs)(C.default,{title:a("subscription.list.item.actions.edit.title",{ns:"pluginTrigger"}),confirmButtonText:u?a("operation.saving",{ns:"common"}):a("operation.save",{ns:"common"}),onClose:t,onCancel:t,onConfirm:()=>{let e=p.current?.getFormValues({needTransformWhenSecretFieldIsPristine:!0});if(!e?.isCheckValidated)return;let s=e.values.subscription_name,i={...e.values};delete i.subscription_name,delete i.callback_url;let n=(0,v.isEqual)(i,r.properties||{})?void 0:i;c({subscriptionId:r.id,name:s,properties:n},{onSuccess:()=>{g.default.notify({type:"success",message:a("subscription.list.item.actions.edit.success",{ns:"pluginTrigger"})}),l?.(),t()},onError:e=>{g.default.notify({type:"error",message:((e,t)=>{if(e instanceof Error&&e.message)return e.message;if("object"==typeof e&&e&&"message"in e){let t=e.message;if("string"==typeof t&&t)return t}return t})(e,a("subscription.list.item.actions.edit.error",{ns:"pluginTrigger"}))})}})},disabled:u,clickOutsideNotClose:!0,wrapperClassName:"!z-[101]",children:[n&&(0,s.jsx)(S.ReadmeEntrance,{pluginDetail:n,showType:E.ReadmeShowType.modal}),(0,s.jsx)(j.BaseForm,{formSchemas:f,ref:p,labelClassName:"system-sm-medium mb-2 flex items-center gap-1 text-text-primary",formClassName:"space-y-4"})]})},M=e=>{let{onClose:t,subscription:r,pluginDetail:n}=e,{t:a}=(0,i.useTranslation)(),o=(0,_.usePluginStore)(e=>e.detail),{refetch:l}=(0,h.useSubscriptionList)(),{mutate:c,isPending:u}=(0,x.useUpdateTriggerSubscription)(),m=(0,d.useMemo)(()=>o?.declaration?.trigger?.subscription_constructor?.parameters||[],[o?.declaration?.trigger?.subscription_constructor?.parameters]),p=(0,d.useRef)(null),f=(0,d.useMemo)(()=>[{name:"subscription_name",label:a("modal.form.subscriptionName.label",{ns:"pluginTrigger"}),placeholder:a("modal.form.subscriptionName.placeholder",{ns:"pluginTrigger"}),type:N.FormTypeEnum.textInput,required:!0,default:r.name},{name:"callback_url",label:a("modal.form.callbackUrl.label",{ns:"pluginTrigger"}),placeholder:a("modal.form.callbackUrl.placeholder",{ns:"pluginTrigger"}),type:N.FormTypeEnum.textInput,required:!1,default:r.endpoint||"",disabled:!0,tooltip:a("modal.form.callbackUrl.tooltip",{ns:"pluginTrigger"}),showCopy:!0},...m.map(e=>{let t=(e=>{switch(e){case"string":case"text":return N.FormTypeEnum.textInput;case"password":case"secret":return N.FormTypeEnum.secretInput;case"number":case"integer":return N.FormTypeEnum.textNumber;case"boolean":return N.FormTypeEnum.boolean;case"select":return N.FormTypeEnum.select;default:if(Object.values(N.FormTypeEnum).includes(e))return e;return N.FormTypeEnum.textInput}})(e.type);return{...e,type:t,tooltip:e.description,default:r.parameters?.[e.name]||e.default,dynamicSelectParams:t===N.FormTypeEnum.dynamicSelect?{plugin_id:o?.plugin_id||"",provider:o?.provider||"",action:"provider",parameter:e.name,credential_id:r.id}:void 0,fieldClassName:e.type===N.FormTypeEnum.boolean?"flex items-center justify-between":void 0,labelClassName:e.type===N.FormTypeEnum.boolean?"mb-0":void 0}})],[a,r.name,r.endpoint,r.parameters,r.id,m,o?.plugin_id,o?.provider]);return(0,s.jsxs)(C.default,{title:a("subscription.list.item.actions.edit.title",{ns:"pluginTrigger"}),confirmButtonText:u?a("operation.saving",{ns:"common"}):a("operation.save",{ns:"common"}),onClose:t,onCancel:t,onConfirm:()=>{let e=p.current?.getFormValues({needTransformWhenSecretFieldIsPristine:!0});if(!e?.isCheckValidated)return;let s=e.values.subscription_name,i={...e.values};delete i.subscription_name,delete i.callback_url;let n=(0,v.isEqual)(i,r.parameters||{})?void 0:i;c({subscriptionId:r.id,name:s,parameters:n},{onSuccess:()=>{g.default.notify({type:"success",message:a("subscription.list.item.actions.edit.success",{ns:"pluginTrigger"})}),l?.(),t()},onError:e=>{g.default.notify({type:"error",message:((e,t)=>{if(e instanceof Error&&e.message)return e.message;if("object"==typeof e&&e&&"message"in e){let t=e.message;if("string"==typeof t&&t)return t}return t})(e,a("subscription.list.item.actions.edit.error",{ns:"pluginTrigger"}))})}})},disabled:u,clickOutsideNotClose:!0,wrapperClassName:"!z-[101]",children:[n&&(0,s.jsx)(S.ReadmeEntrance,{pluginDetail:n,showType:E.ReadmeShowType.modal}),(0,s.jsx)(j.BaseForm,{formSchemas:f,ref:p,labelClassName:"system-sm-medium mb-2 flex items-center gap-1 text-text-primary",formClassName:"space-y-4"})]})},U=e=>{let{onClose:t,subscription:r,pluginDetail:i}=e;switch(r.credential_type){case y.TriggerCredentialTypeEnum.Unauthorized:return(0,s.jsx)(O,{onClose:t,subscription:r,pluginDetail:i});case y.TriggerCredentialTypeEnum.Oauth2:return(0,s.jsx)(M,{onClose:t,subscription:r,pluginDetail:i});case y.TriggerCredentialTypeEnum.ApiKey:return(0,s.jsx)(I,{onClose:t,subscription:r,pluginDetail:i});default:return null}},L=e=>{let{data:t,pluginDetail:r}=e,{t:o}=(0,i.useTranslation)(),[d,{setTrue:m,setFalse:p}]=(0,c.useBoolean)(!1),[g,{setTrue:x,setFalse:h}]=(0,c.useBoolean)(!1);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:(0,a.cn)("group relative cursor-pointer rounded-lg border-[0.5px] px-4 py-3 shadow-xs transition-all","border-components-panel-border-subtle bg-components-panel-on-panel-item-bg","hover:bg-components-panel-on-panel-item-bg-hover","has-[.subscription-delete-btn:hover]:!border-state-destructive-border has-[.subscription-delete-btn:hover]:!bg-state-destructive-hover"),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex h-6 items-center gap-1",children:[(0,s.jsx)(l.RiWebhookLine,{className:"h-4 w-4 text-text-secondary"}),(0,s.jsx)("span",{className:"system-md-semibold text-text-secondary",children:t.name})]}),(0,s.jsxs)("div",{className:"hidden items-center gap-1 group-hover:flex",children:[(0,s.jsx)(u.default,{onClick:x,className:"transition-colors hover:bg-state-base-hover",children:(0,s.jsx)(l.RiEditLine,{className:"h-4 w-4"})}),(0,s.jsx)(u.default,{onClick:m,className:"subscription-delete-btn transition-colors hover:bg-state-destructive-hover hover:text-text-destructive",children:(0,s.jsx)(l.RiDeleteBinLine,{className:"h-4 w-4"})})]})]}),(0,s.jsxs)("div",{className:"mt-1 flex items-center justify-between",children:[(0,s.jsx)(n.default,{disabled:!t.endpoint,popupContent:t.endpoint&&(0,s.jsx)("div",{className:"max-w-[320px] break-all",children:t.endpoint}),position:"left",children:(0,s.jsx)("div",{className:"system-xs-regular flex-1 truncate text-text-tertiary",children:t.endpoint})}),(0,s.jsx)("div",{className:"mx-2 text-xs text-text-tertiary opacity-30",children:"Â·"}),(0,s.jsx)("div",{className:"system-xs-regular shrink-0 text-text-tertiary",children:t.workflows_in_use>0?o("subscription.list.item.usedByNum",{ns:"pluginTrigger",num:t.workflows_in_use}):o("subscription.list.item.noUsed",{ns:"pluginTrigger"})})]})]}),d&&(0,s.jsx)(b,{onClose:p,isShow:d,currentId:t.id,currentName:t.name,workflowsInUse:t.workflows_in_use}),g&&(0,s.jsx)(U,{onClose:h,subscription:t,pluginDetail:r})]})};e.s(["SubscriptionListView",0,e=>{let{showTopBorder:t=!1,pluginDetail:r}=e,{t:l}=(0,i.useTranslation)(),{subscriptions:c}=(0,h.useSubscriptionList)(),u=c?.length||0;return(0,s.jsxs)("div",{className:(0,a.cn)("border-divider-subtle px-4 py-2",t&&"border-t"),children:[(0,s.jsxs)("div",{className:"relative flex items-center justify-between",children:[u>0&&(0,s.jsxs)("div",{className:"flex h-8 shrink-0 items-center gap-1",children:[(0,s.jsx)("span",{className:"system-sm-semibold-uppercase text-text-secondary",children:l("subscription.listNum",{ns:"pluginTrigger",num:u})}),(0,s.jsx)(n.default,{popupContent:l("subscription.list.tip",{ns:"pluginTrigger"})})]}),(0,s.jsx)(o.CreateSubscriptionButton,{buttonType:u>0?o.CreateButtonType.ICON_BUTTON:o.CreateButtonType.FULL_BUTTON})]}),u>0&&(0,s.jsx)("div",{className:"flex flex-col gap-1",children:c?.map(e=>(0,s.jsx)(L,{data:e,pluginDetail:r},e.id))})]})}],437377),e.s(["SubscriptionSelectorView",0,e=>{let{selectedId:t,onSelect:r}=e,{t:c}=(0,i.useTranslation)(),{subscriptions:m}=(0,h.useSubscriptionList)(),[p,g]=(0,d.useState)(null),x=m?.length||0;return(0,s.jsxs)("div",{className:"w-[320px] p-1",children:[x>0&&(0,s.jsxs)("div",{className:"ml-7 mr-1.5 flex h-8 items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex shrink-0 items-center gap-1",children:[(0,s.jsx)("span",{className:"system-sm-semibold-uppercase text-text-secondary",children:c("subscription.listNum",{ns:"pluginTrigger",num:x})}),(0,s.jsx)(n.default,{popupContent:c("subscription.list.tip",{ns:"pluginTrigger"})})]}),(0,s.jsx)(o.CreateSubscriptionButton,{buttonType:o.CreateButtonType.ICON_BUTTON,shape:"circle"})]}),(0,s.jsx)("div",{className:"max-h-[320px] overflow-y-auto",children:m?.map(e=>(0,s.jsxs)("div",{className:(0,a.cn)("group flex w-full items-center justify-between rounded-lg p-1 text-left transition-colors","hover:bg-state-base-hover has-[.subscription-delete-btn:hover]:!bg-state-destructive-hover",t===e.id&&"bg-state-base-hover"),children:[(0,s.jsx)("button",{type:"button",className:"flex flex-1 items-center text-left",onClick:()=>r?.(e),children:(0,s.jsxs)("div",{className:"flex items-center",children:[t===e.id&&(0,s.jsx)(l.RiCheckLine,{className:"mr-2 h-4 w-4 shrink-0 text-text-accent"}),(0,s.jsx)(l.RiWebhookLine,{className:(0,a.cn)("mr-1.5 h-3.5 w-3.5 text-text-secondary",t!==e.id&&"ml-6")}),(0,s.jsx)("span",{className:"system-md-regular leading-6 text-text-secondary",children:e.name})]})}),(0,s.jsx)(u.default,{onClick:t=>{t.stopPropagation(),g(e)},className:"subscription-delete-btn hidden shrink-0 text-text-tertiary hover:bg-state-destructive-hover hover:text-text-destructive group-hover:flex",children:(0,s.jsx)(l.RiDeleteBinLine,{className:"size-4"})})]},e.id))}),p&&(0,s.jsx)(b,{onClose:e=>{e&&r?.({id:"",name:""}),g(null)},isShow:!!p,currentId:p.id,currentName:p.name,workflowsInUse:p.workflows_in_use})]})}],586713);var P=((r={}).PANEL="panel",r.SELECTOR="selector",r);e.s(["SubscriptionListMode",()=>P],655098)},867856,e=>{"use strict";e.s(["SubscriptionList",()=>l]);var t=e.i(563199),r=e.i(545035),s=e.i(449980),i=e.i(437377),n=e.i(586713),a=e.i(655098),o=e.i(430807);e.i(369795);let l=(0,r.withErrorBoundary)(e=>{let{mode:r=a.SubscriptionListMode.PANEL,selectedId:l,onSelect:c,pluginDetail:u}=e,{isLoading:d,refetch:m}=(0,o.useSubscriptionList)();return d?(0,t.jsx)("div",{className:"flex items-center justify-center py-4",children:(0,t.jsx)(s.default,{})}):r===a.SubscriptionListMode.SELECTOR?(0,t.jsx)(n.SubscriptionSelectorView,{selectedId:l,onSelect:e=>{c?.(e,m)}}):(0,t.jsx)(i.SubscriptionListView,{pluginDetail:u})})},369795,e=>{"use strict";e.s(["SubscriptionSelectorEntry",()=>d]);var t=e.i(563199),r=e.i(837699),s=e.i(268255);e.i(152567);var i=e.i(408767),n=e.i(391185),a=e.i(867856),o=e.i(935139),l=e.i(655098),c=e.i(430807);let u=e=>{let{selectedId:n,onClick:a,isOpen:l=!1,className:u}=e,{t:d}=(0,i.useTranslation)(),{subscriptions:m}=(0,c.useSubscriptionList)(),p=(0,s.useMemo)(()=>{if(!n)return l?{label:d("subscription.selectPlaceholder",{ns:"pluginTrigger"}),color:"yellow"}:{label:d("subscription.noSubscriptionSelected",{ns:"pluginTrigger"}),color:"red"};if(m&&m.length>0){let e=m?.find(e=>e.id===n);return e?{label:e.name,color:"green"}:{label:d("subscription.subscriptionRemoved",{ns:"pluginTrigger"}),color:"red"}}return{label:d("subscription.noSubscriptionSelected",{ns:"pluginTrigger"}),color:"red"}},[n,m,d,l]);return(0,t.jsxs)("button",{className:(0,o.cn)("flex h-8 items-center gap-1 rounded-lg px-2 transition-colors","hover:bg-state-base-hover-alt",l&&"bg-state-base-hover-alt",u),onClick:a,children:[(0,t.jsx)(r.RiWebhookLine,{className:(0,o.cn)("h-3.5 w-3.5 shrink-0 text-text-secondary","red"===p.color&&"text-components-button-destructive-secondary-text")}),(0,t.jsx)("span",{className:(0,o.cn)("system-xs-medium truncate text-components-button-ghost-text","red"===p.color&&"text-components-button-destructive-secondary-text"),children:p.label}),(0,t.jsx)(r.RiArrowDownSLine,{className:(0,o.cn)("ml-auto h-4 w-4 shrink-0 text-text-quaternary transition-transform",l&&"rotate-180","red"===p.color&&"text-components-button-destructive-secondary-text")})]})},d=e=>{let{selectedId:r,onSelect:i}=e,[o,c]=(0,s.useState)(!1);return(0,t.jsxs)(n.PortalToFollowElem,{placement:"bottom-start",offset:4,open:o,onOpenChange:c,children:[(0,t.jsx)(n.PortalToFollowElemTrigger,{asChild:!0,children:(0,t.jsx)("div",{children:(0,t.jsx)(u,{selectedId:r,onClick:()=>c(!o),isOpen:o})})}),(0,t.jsx)(n.PortalToFollowElemContent,{className:"z-[11]",children:(0,t.jsx)("div",{className:"rounded-xl border border-components-panel-border bg-components-panel-bg shadow-lg",children:(0,t.jsx)(a.SubscriptionList,{mode:l.SubscriptionListMode.SELECTOR,selectedId:r,onSelect:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];i(...t),c(!1)}})})})]})}},224651,e=>{"use strict";var t=e.i(563199),r=e.i(837699),s=e.i(417944),i=e.i(268255);e.i(152567);var n=e.i(408767),a=e.i(935139),o=e.i(669744),l=e.i(858314),c=e.i(942695);let u=e=>{let{name:i,payload:d,depth:m=1,required:p,rootClassName:g}=e,{t:x}=(0,n.useTranslation)(),h=d.type===o.Type.object&&d.properties,f=d.enum&&d.enum.length>0,[b,{toggle:y}]=(0,s.useBoolean)(!1);return(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:(0,a.cn)("flex pr-2"),children:[(0,t.jsx)(c.default,{depth:m}),(0,t.jsxs)("div",{className:"w-0 grow",children:[(0,t.jsxs)("div",{className:"relative flex select-none",children:[h&&(0,t.jsx)(r.RiArrowDropDownLine,{className:(0,a.cn)("absolute left-[-18px] top-[50%] h-4 w-4 translate-y-[-50%] cursor-pointer bg-components-panel-bg text-text-tertiary",b&&"rotate-[270deg] text-text-accent"),onClick:y}),(0,t.jsx)("div",{className:(0,a.cn)("system-sm-medium ml-[7px] h-6 truncate leading-6 text-text-secondary",1===m&&g),children:i}),(0,t.jsxs)("div",{className:"system-xs-regular ml-3 shrink-0 leading-6 text-text-tertiary",children:[(0,l.getFieldType)(d),d.schemaType&&"file"!==d.schemaType&&` (${d.schemaType})`]}),p&&(0,t.jsx)("div",{className:"system-2xs-medium-uppercase ml-3 leading-6 text-text-warning",children:x("structOutput.required",{ns:"app"})})]}),d.description&&(0,t.jsx)("div",{className:"ml-[7px] flex",children:(0,t.jsx)("div",{className:"system-xs-regular w-0 grow truncate text-text-tertiary",children:d.description})}),f&&(0,t.jsx)("div",{className:"ml-[7px] flex",children:(0,t.jsx)("div",{className:"system-xs-regular w-0 grow text-text-quaternary",children:d.enum.map((e,r)=>(0,t.jsxs)("span",{children:["string"==typeof e?`"${e}"`:e,r<d.enum.length-1&&" | "]},r))})})]})]}),h&&!b&&(0,t.jsx)("div",{children:Object.keys(d.properties).map(e=>(0,t.jsx)(u,{name:e,payload:d.properties?.[e],depth:m+1,required:!!d.required?.includes(e)},e))})]})},d=i.memo(u);e.s(["default",0,d])}]);
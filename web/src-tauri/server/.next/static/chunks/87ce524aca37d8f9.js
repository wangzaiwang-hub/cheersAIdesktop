(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,93869,(e,t,s)=>{let a=/[ .,;!?'‘’“”\-–—]+$/;t.exports=function(e,t,s){e.style.cssText+="overflow:hidden;overflow-wrap:break-word;word-wrap:break-word";let n=(t||1)*parseInt(window.getComputedStyle(e).lineHeight,10);return!(e.scrollHeight<=n)&&function e(t,s,n,l){let r=t.childNodes,o=r.length-1;for(;o>-1;){let i=r[o--];if(1===i.nodeType&&e(i,s,n,l)||3===i.nodeType&&function(e,t,s,n){let l,r=e.textContent;for(;r.length>1&&-1!==(l=r.lastIndexOf(" "));){if(e.textContent=r.substring(0,l),t.scrollHeight<=s){e.textContent=r;break}r=e.textContent}return function(e,t,s,n){let l=e.textContent,r=l.length;for(;r>1;)if(r=(l=l.substring(0,r-1).replace(a,"")).length,e.textContent=l+n,t.scrollHeight<=s)return!0;return!1}(e,t,s,n)}(i,s,n,l))return!0;t.removeChild(i)}return!1}(e,e,n,s&&s.ellipsis||"…")}},29047,e=>{e.v({layoutRightIcon:"style-module__ZLeS9G__layoutRightIcon",titleIcon:"style-module__ZLeS9G__titleIcon"})},774444,e=>{"use strict";var t,s=e.i(563199),a=e.i(837699),n=e.i(326531),l=e.i(268255);e.i(152567);var r=e.i(408767),o=e.i(757198),i=e.i(423571),d=e.i(449980),c=e.i(137667),m=e.i(151094),u=e.i(935139),x=e.i(28030),p=e.i(413159),h=e.i(793834),g=e.i(813777),f=e.i(799750),b=e.i(560956),j=e.i(421001),y=e.i(157884),C=e.i(655281),v=e.i(292500),w=e.i(836407);let N=l.memo(e=>{let{label:t,children:a}=e;return(0,s.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,s.jsx)("div",{className:"system-xs-medium w-[128px] shrink-0 items-center truncate py-1 text-text-tertiary",children:t}),(0,s.jsx)("div",{className:"w-[244px] shrink-0",children:a})]})}),k=l.memo(e=>{let{dataSetId:t,className:l,noHeader:i,title:d,uppercaseTitle:c=!0,titleTooltip:m,headerRight:x,contentClassName:p,list:h,isEdit:g,onChange:b,onDelete:k,onSelect:S,onAdd:D}=e,M=(0,n.useRouter)(),{t:_}=(0,r.useTranslation)(),{formatTime:I}=(0,y.default)();return(0,s.jsxs)("div",{className:(0,u.cn)(l),children:[!i&&(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,s.jsx)("div",{className:(0,u.cn)("text-text-secondary",c?"system-xs-semibold-uppercase":"system-md-semibold"),children:d}),m&&(0,s.jsx)(j.default,{popupContent:(0,s.jsx)("div",{className:"max-w-[240px]",children:m}),children:(0,s.jsx)("div",{children:(0,s.jsx)(a.RiQuestionLine,{className:"size-3.5 text-text-tertiary"})})})]}),x]}),(0,s.jsxs)("div",{className:(0,u.cn)("mt-3 space-y-1",p),children:[g&&(0,s.jsxs)("div",{children:[(0,s.jsx)(w.default,{datasetId:t,trigger:(0,s.jsx)(C.default,{}),onSelect:e=>S?.(e),onSave:e=>D?.(e),onManage:()=>{localStorage.setItem(f.isShowManageMetadataLocalStorageKey,"true"),M.push(`/datasets/${t}/documents`)}}),h.length>0&&(0,s.jsx)(o.default,{className:"my-3 ",bgStyle:"gradient"})]}),h.map((e,t)=>(0,s.jsx)(N,{label:e.name,children:g?(0,s.jsxs)("div",{className:"flex items-center space-x-0.5",children:[(0,s.jsx)(v.default,{className:"h-6",type:e.type,value:e.value,onChange:t=>b?.({...e,value:t})}),(0,s.jsx)("div",{className:"shrink-0 cursor-pointer rounded-md p-1  text-text-tertiary hover:bg-state-destructive-hover hover:text-text-destructive",children:(0,s.jsx)(a.RiDeleteBinLine,{className:"size-4",onClick:()=>k?.(e)})})]}):(0,s.jsx)("div",{className:"system-xs-regular py-1 text-text-secondary",children:e.value&&e.type===f.DataType.time?I(e.value,_("metadata.dateTimeFormat",{ns:"datasetDocuments"})):e.value})},e.id&&"built-in"!==e.id?e.id:`${t}`))]})]})}),S=l.memo(e=>{let{onStart:t}=e,{t:n}=(0,r.useTranslation)();return(0,s.jsxs)("div",{className:"rounded-xl bg-gradient-to-r from-workflow-workflow-progress-bg-1 to-workflow-workflow-progress-bg-2 p-4 pt-3",children:[(0,s.jsx)("div",{className:"text-xs font-semibold leading-5 text-text-secondary",children:n("metadata.metadata",{ns:"dataset"})}),(0,s.jsx)("div",{className:"system-xs-regular mt-1 text-text-tertiary",children:n("metadata.documentMetadata.metadataToolTip",{ns:"dataset"})}),(0,s.jsxs)(m.default,{variant:"primary",className:"mt-2",onClick:t,children:[(0,s.jsx)("div",{children:n("metadata.documentMetadata.startLabeling",{ns:"dataset"})}),(0,s.jsx)(a.RiArrowRightLine,{className:"ml-1 size-4"})]})]})}),D="metadata.documentMetadata",M=l.memo(e=>{let{datasetId:t,documentId:n,className:i,docDetail:d}=e,{t:j}=(0,r.useTranslation)(),{embeddingAvailable:y,isEdit:C,setIsEdit:v,list:w,tempList:N,setTempList:M,handleSelectMetaData:_,handleAddMetaData:I,hasData:R,builtList:T,builtInEnabled:L,startToEdit:E,handleSave:F,handleCancel:A,originInfo:$,technicalParameters:P}=(e=>{let{datasetId:t,documentId:s,docDetail:a}=e,{t:n}=(0,r.useTranslation)(),{dataset:o}=(0,p.useDatasetDetailContext)(),i=!!o?.embedding_available,{mutateAsync:d}=(0,g.useBatchUpdateDocMetadata)(),{checkName:m}=(0,b.default)(),[u,j]=(0,l.useState)(!1),{data:y}=(0,g.useDocumentMetaData)({datasetId:t,documentId:s}),C=y?.doc_metadata||[],v=C.filter(e=>"built-in"!==e.id),w=C.filter(e=>"built-in"===e.id),[N,k]=(0,l.useState)(v),{mutateAsync:S}=(0,g.useCreateMetaData)(t),D=(0,l.useCallback)(e=>{k(t=>-1===t.findIndex(t=>t.id===e.id)?[...t,e]:t)},[]),M=(0,l.useCallback)(async e=>{let t=m(e.name).errorMsg;if(t)return c.default.notify({message:t,type:"error"}),Promise.reject(Error(t));await S(e),c.default.notify({type:"success",message:n("api.actionSuccess",{ns:"common"})})},[m,S,n]),_=v.length>0,I=async()=>{await d({dataset_id:t,metadata_list:[{document_id:s,metadata_list:N}]}),j(!1),c.default.notify({type:"success",message:n("api.actionSuccess",{ns:"common"})})},{data:R}=(0,g.useDatasetMetaData)(t),T=R?.built_in_field_enabled,L=(0,h.useMetadataMap)(),E=(0,h.useLanguages)(),F=e=>{let t=L[e]?.subFieldsMap;return Object.keys(t).map(e=>{var s;let n,l=t[e];return{id:l?.label,type:f.DataType.string,name:l?.label,value:(s=e,(n=(0,x.get)(a,s,""))||0===n?t[s]?.inputType==="select"?("language"===s?E:{})[n]:t[s]?.render?t[s]?.render?.(n,"hit_count"===s?(0,x.get)(a,"segment_count",0):void 0):n:"-")}})};return{embeddingAvailable:i,isEdit:u,setIsEdit:j,list:v,tempList:N,setTempList:k,handleSelectMetaData:D,handleAddMetaData:M,hasData:_,builtList:w,builtInEnabled:T,startToEdit:()=>{k(v),j(!0)},handleSave:I,handleCancel:()=>{k(v),j(!1)},originInfo:F("originInfo"),technicalParameters:F("technicalParameters")}})({datasetId:t,documentId:n,docDetail:d});return(0,s.jsxs)("div",{className:(0,u.cn)("w-[388px] space-y-4",i),children:[R||C?(0,s.jsx)("div",{className:"pl-2",children:(0,s.jsx)(k,{title:j("metadata.metadata",{ns:"dataset"}),uppercaseTitle:!1,titleTooltip:j(`${D}.metadataToolTip`,{ns:"dataset"}),list:C?N:w,dataSetId:t,headerRight:y&&(C?(0,s.jsxs)("div",{className:"flex space-x-1",children:[(0,s.jsx)(m.default,{variant:"ghost",size:"small",onClick:A,children:(0,s.jsx)("div",{children:j("operation.cancel",{ns:"common"})})}),(0,s.jsx)(m.default,{variant:"primary",size:"small",onClick:F,children:(0,s.jsx)("div",{children:j("operation.save",{ns:"common"})})})]}):(0,s.jsxs)(m.default,{variant:"ghost",size:"small",onClick:E,children:[(0,s.jsx)(a.RiEditLine,{className:"mr-1 size-3.5 cursor-pointer text-text-tertiary"}),(0,s.jsx)("div",{children:j("operation.edit",{ns:"common"})})]})),isEdit:C,contentClassName:"mt-5",onChange:e=>{M(N.map(t=>t.name===e.name?e:t))},onDelete:e=>{M(N.filter(t=>t.name!==e.name))},onAdd:I,onSelect:_})}):y&&(0,s.jsx)(S,{onStart:()=>v(!0)}),L&&(0,s.jsxs)("div",{className:"pl-2",children:[(0,s.jsx)(o.default,{className:"my-3",bgStyle:"gradient"}),(0,s.jsx)(k,{noHeader:!0,titleTooltip:"Built-in metadata is system-generated metadata that is automatically added to the document. You can enable or disable built-in metadata here.",list:T,dataSetId:t})]}),(0,s.jsx)(k,{className:"pl-2",title:j(`${D}.documentInformation`,{ns:"dataset"}),list:$,dataSetId:t}),(0,s.jsx)(k,{className:"pl-2",title:j(`${D}.technicalParameters`,{ns:"dataset"}),list:P,dataSetId:t})]})});var _=e.i(271743),I=e.i(621379),R=e.i(666010),T=e.i(909564),L=e.i(722384),E=e.i(312620),F=e.i(247176),A=e.i(124836),$=e.i(21151),P=e.i(149649);e.i(288243);var z=e.i(193105),q=e.i(683257),O=e.i(491234);let U=[["question","answer"],["question1","answer1"],["question2","answer2"]],B=[["问题","答案"],["问题 1","答案 1"],["问题 2","答案 2"]],K=[["segment content"],["content1"],["content2"]],V=[["分段内容"],["内容 1"],["内容 2"]],H=l.memo(e=>{let{docForm:t}=e,{t:a}=(0,r.useTranslation)(),n=(0,q.useLocale)(),{CSVDownloader:l,Type:o}=(0,P.useCSVDownloader)();return(0,s.jsxs)("div",{className:"mt-6",children:[(0,s.jsx)("div",{className:"text-sm font-medium text-text-primary",children:a("generation.csvStructureTitle",{ns:"share"})}),(0,s.jsxs)("div",{className:"mt-2 max-h-[500px] overflow-auto",children:[t===I.ChunkingMode.qa&&(0,s.jsxs)("table",{className:"w-full table-fixed border-separate border-spacing-0 rounded-lg border border-divider-subtle text-xs",children:[(0,s.jsx)("thead",{className:"text-text-secondary",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"h-9 border-b border-divider-subtle pl-3 pr-2",children:a("list.batchModal.question",{ns:"datasetDocuments"})}),(0,s.jsx)("td",{className:"h-9 border-b border-divider-subtle pl-3 pr-2",children:a("list.batchModal.answer",{ns:"datasetDocuments"})})]})}),(0,s.jsxs)("tbody",{className:"text-text-tertiary",children:[(0,s.jsxs)("tr",{children:[(0,s.jsxs)("td",{className:"h-9 border-b border-divider-subtle pl-3 pr-2 text-[13px]",children:[a("list.batchModal.question",{ns:"datasetDocuments"})," ","1"]}),(0,s.jsxs)("td",{className:"h-9 border-b border-divider-subtle pl-3 pr-2 text-[13px]",children:[a("list.batchModal.answer",{ns:"datasetDocuments"})," ","1"]})]}),(0,s.jsxs)("tr",{children:[(0,s.jsxs)("td",{className:"h-9 pl-3 pr-2 text-[13px]",children:[a("list.batchModal.question",{ns:"datasetDocuments"})," ","2"]}),(0,s.jsxs)("td",{className:"h-9 pl-3 pr-2 text-[13px]",children:[a("list.batchModal.answer",{ns:"datasetDocuments"})," ","2"]})]})]})]}),t===I.ChunkingMode.text&&(0,s.jsxs)("table",{className:"w-full table-fixed border-separate border-spacing-0 rounded-lg border border-divider-subtle text-xs",children:[(0,s.jsx)("thead",{className:"text-text-secondary",children:(0,s.jsx)("tr",{children:(0,s.jsx)("td",{className:"h-9 border-b border-divider-subtle pl-3 pr-2",children:a("list.batchModal.contentTitle",{ns:"datasetDocuments"})})})}),(0,s.jsxs)("tbody",{className:"text-text-tertiary",children:[(0,s.jsx)("tr",{children:(0,s.jsxs)("td",{className:"h-9 border-b border-divider-subtle pl-3 pr-2 text-[13px]",children:[a("list.batchModal.content",{ns:"datasetDocuments"})," ","1"]})}),(0,s.jsx)("tr",{children:(0,s.jsxs)("td",{className:"h-9 pl-3 pr-2 text-[13px]",children:[a("list.batchModal.content",{ns:"datasetDocuments"})," ","2"]})})]})]})]}),(0,s.jsx)(l,{className:"mt-2 block cursor-pointer",type:o.Link,filename:"template",bom:!0,data:n===O.LanguagesSupported[1]?t===I.ChunkingMode.qa?B:V:t===I.ChunkingMode.qa?U:K,children:(0,s.jsxs)("div",{className:"flex h-[18px] items-center space-x-1 text-xs font-medium text-text-accent",children:[(0,s.jsx)(z.Download02,{className:"mr-1 h-3 w-3"}),a("list.batchModal.template",{ns:"datasetDocuments"})]})})]})});var Q=e.i(339548),W=e.i(223314);e.i(866473);var G=e.i(260366),Y=e.i(153435),Z=e.i(922521),X=e.i(367916),J=e.i(652669),ee=e.i(648404);let et=l.memo(e=>{let{file:t,updateFile:n}=e,{t:o}=(0,r.useTranslation)(),{notify:i}=(0,Q.useContext)(c.ToastContext),[d,x]=(0,l.useState)(!1),p=(0,l.useRef)(null),h=(0,l.useRef)(null),g=(0,l.useRef)(null),{data:f}=(0,J.useFileUploadConfig)(),b=(0,l.useMemo)(()=>f??{file_size_limit:15},[f]),j=(0,l.useCallback)(async e=>{e.progress=0;let t=new FormData;return t.append("file",e.file),(0,X.upload)({xhr:new XMLHttpRequest,data:t,onprogress:t=>{if(t.lengthComputable){let s=Math.floor(t.loaded/t.total*100);n({...e,progress:s})}}},!1,void 0,"?source=datasets").then(t=>{let s=Object.assign({},e.file,{id:t.id,...t}),a={fileID:e.fileID,file:s,progress:100};return n(a),Promise.resolve({...a})}).catch(t=>{i({type:"error",message:(0,W.getFileUploadErrorMessage)(t,o("stepOne.uploader.failed",{ns:"datasetCreation"}),o)});let s={...e,progress:-2};return n(s),Promise.resolve({...s})}).finally()},[i,o,n]),y=(0,l.useCallback)(async e=>{await j(e)},[j]),C=(0,l.useCallback)(e=>{if(!e)return!1;let t={fileID:`file0-${Date.now()}`,file:e,progress:-1};n(t),y(t)},[n,y]),v=e=>{e.preventDefault(),e.stopPropagation(),e.target!==h.current&&x(!0)},w=e=>{e.preventDefault(),e.stopPropagation()},N=e=>{e.preventDefault(),e.stopPropagation(),e.target===h.current&&x(!1)},k=e=>{if(e.preventDefault(),e.stopPropagation(),x(!1),!e.dataTransfer)return;let t=Array.from(e.dataTransfer.files);t.length>1?i({type:"error",message:o("stepOne.uploader.validation.count",{ns:"datasetCreation"})}):C(t[0])},S=()=>{g.current&&g.current.click()},D=(0,l.useCallback)(e=>{if(!e)return!1;let{size:t}=e,s=".csv"===`.${(e=>{if(!e)return"";let t=e.name.split(".");return t[t.length-1]})(e)}`.toLowerCase();s||i({type:"error",message:o("stepOne.uploader.validation.typeError",{ns:"datasetCreation"})});let a=t<=1024*b.file_size_limit*1024;return a||i({type:"error",message:o("stepOne.uploader.validation.size",{ns:"datasetCreation",size:b.file_size_limit})}),s&&a},[b,i,o]),{theme:M}=(0,Z.default)(),_=(0,l.useMemo)(()=>M===ee.Theme.dark?"#5289ff":"#296dff",[M]);return(0,l.useEffect)(()=>(p.current?.addEventListener("dragenter",v),p.current?.addEventListener("dragover",w),p.current?.addEventListener("dragleave",N),p.current?.addEventListener("drop",k),()=>{p.current?.removeEventListener("dragenter",v),p.current?.removeEventListener("dragover",w),p.current?.removeEventListener("dragleave",N),p.current?.removeEventListener("drop",k)}),[]),(0,s.jsxs)("div",{className:"mt-6",children:[(0,s.jsx)("input",{ref:g,style:{display:"none"},type:"file",id:"fileUploader",accept:".csv",onChange:e=>{let t=e.target.files?.[0];D(t)&&C(t)}}),(0,s.jsxs)("div",{ref:p,children:[!t&&(0,s.jsxs)("div",{className:(0,u.cn)("flex h-20 items-center rounded-xl border border-dashed border-components-panel-border bg-components-panel-bg-blur text-sm font-normal",d&&"border border-divider-subtle  bg-components-panel-on-panel-item-bg-hover"),children:[(0,s.jsxs)("div",{className:"flex w-full items-center justify-center space-x-2",children:[(0,s.jsx)(G.Csv,{className:"shrink-0"}),(0,s.jsxs)("div",{className:"text-text-secondary",children:[o("list.batchModal.csvUploadTitle",{ns:"datasetDocuments"}),(0,s.jsx)("span",{className:"cursor-pointer text-text-accent",onClick:S,children:o("list.batchModal.browse",{ns:"datasetDocuments"})})]})]}),d&&(0,s.jsx)("div",{ref:h,className:"absolute left-0 top-0 h-full w-full"})]}),t&&(0,s.jsxs)("div",{className:(0,u.cn)("group flex h-20 items-center rounded-xl border border-components-panel-border bg-components-panel-bg-blur px-6 text-sm font-normal","hover:border-divider-subtle hover:bg-components-panel-on-panel-item-bg-hover"),children:[(0,s.jsx)(G.Csv,{className:"shrink-0"}),(0,s.jsxs)("div",{className:"ml-2 flex w-0 grow",children:[(0,s.jsx)("span",{className:"max-w-[calc(100%_-_30px)] overflow-hidden text-ellipsis whitespace-nowrap text-text-primary",children:t.file.name.replace(/.csv$/,"")}),(0,s.jsx)("span",{className:"shrink-0 text-text-secondary",children:".csv"})]}),(0,s.jsxs)("div",{className:"hidden items-center group-hover:flex",children:[t.progress<100&&t.progress>=0&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Y.default,{percentage:t.progress,stroke:_,fill:_,animationDuration:0}),(0,s.jsx)("div",{className:"mx-2 h-4 w-px bg-text-secondary"})]}),(0,s.jsx)(m.default,{onClick:S,children:o("stepOne.uploader.change",{ns:"datasetCreation"})}),(0,s.jsx)("div",{className:"mx-2 h-4 w-px bg-text-secondary"}),(0,s.jsx)("div",{className:"cursor-pointer p-2",onClick:()=>{g.current&&(g.current.value=""),n()},children:(0,s.jsx)(a.RiDeleteBinLine,{className:"h-4 w-4 text-text-secondary"})})]})]})]})]})}),es=l.memo(e=>{let{isShow:t,docForm:n,onCancel:o,onConfirm:i}=e,{t:d}=(0,r.useTranslation)(),[c,u]=(0,l.useState)();return(0,l.useEffect)(()=>{t||u(void 0)},[t]),(0,s.jsxs)($.default,{isShow:t,onClose:A.noop,className:"!max-w-[520px] !rounded-xl px-8 py-6",children:[(0,s.jsx)("div",{className:"relative pb-1 text-xl font-medium leading-[30px] text-text-primary",children:d("list.batchModal.title",{ns:"datasetDocuments"})}),(0,s.jsx)("div",{className:"absolute right-4 top-4 cursor-pointer p-2",onClick:o,children:(0,s.jsx)(a.RiCloseLine,{className:"h-4 w-4 text-text-secondary"})}),(0,s.jsx)(et,{file:c,updateFile:e=>u(e)}),(0,s.jsx)(H,{docForm:n}),(0,s.jsxs)("div",{className:"mt-[28px] flex justify-end pt-6",children:[(0,s.jsx)(m.default,{className:"mr-2",onClick:o,children:d("list.batchModal.cancel",{ns:"datasetDocuments"})}),(0,s.jsx)(m.default,{variant:"primary",onClick:()=>{c&&(o(),i(c))},disabled:!c||!c.file||!c.file.id,children:d("list.batchModal.run",{ns:"datasetDocuments"})})]})]})});var ea=e.i(888972),en=e.i(753792),el=e.i(551444),er=e.i(908432),eo=e.i(189299),ei=e.i(317522),ed=e.i(759246),ec=e.i(179356),em=e.i(951403);let eu=l.memo(()=>{let{t:e}=(0,r.useTranslation)(),{dragging:t,fileUploadConfig:n,dragRef:l,dropRef:o,uploaderRef:i,fileChangeHandle:d,selectHandle:c}=(0,ed.useUpload)();return(0,s.jsxs)("div",{className:"w-full",children:[(0,s.jsx)("input",{ref:i,id:"fileUploader",className:"hidden",type:"file",multiple:!0,accept:em.ACCEPT_TYPES.map(e=>`.${e}`).join(","),onChange:d}),(0,s.jsxs)("div",{ref:o,className:(0,u.cn)("relative flex h-16 flex-col items-center justify-center gap-1 rounded-[10px] border border-dashed border-components-dropzone-border bg-components-dropzone-bg px-4 py-3 text-text-tertiary",t&&"border-components-dropzone-border-accent bg-components-dropzone-bg-accent"),children:[(0,s.jsxs)("div",{className:"system-sm-medium flex items-center justify-center gap-x-2 text-text-secondary",children:[(0,s.jsx)(a.RiUploadCloud2Line,{className:"size-5 text-text-tertiary"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{children:e("imageUploader.button",{ns:"dataset"})}),(0,s.jsx)("span",{className:"ml-1 cursor-pointer text-text-accent",onClick:c,children:e("imageUploader.browse",{ns:"dataset"})})]})]}),(0,s.jsx)("div",{className:"system-xs-regular",children:e("imageUploader.tip",{ns:"dataset",size:n.imageFileSizeLimit,supportTypes:em.ACCEPT_TYPES.join(", "),batchCount:n.imageFileBatchLimit})}),t&&(0,s.jsx)("div",{ref:l,className:"absolute inset-0"})]})]})});var ex=e.i(357e3);e.i(36860);var ep=e.i(47481),eh=e.i(584186),eg=e.i(94163);let ef=(0,l.memo)(e=>{let{file:t,showDeleteAction:n,onRemove:r,onReUpload:o,onPreview:i}=e,{id:d,progress:c,base64Url:u,sourceUrl:x}=t,p=(0,l.useCallback)(e=>{e.stopPropagation(),e.preventDefault(),i?.(d)},[i,d]),h=(0,l.useCallback)(e=>{e.stopPropagation(),e.preventDefault(),r?.(d)},[r,d]),g=(0,l.useCallback)(e=>{e.stopPropagation(),e.preventDefault(),o?.(d)},[o,d]);return(0,s.jsxs)("div",{className:"group/file-image relative cursor-pointer",onClick:p,children:[n&&(0,s.jsx)(m.default,{className:"absolute -right-1.5 -top-1.5 z-[11] hidden h-5 w-5 rounded-full p-0 group-hover/file-image:flex",onClick:h,children:(0,s.jsx)(a.RiCloseLine,{className:"h-4 w-4 text-components-button-secondary-text"})}),(0,s.jsx)(ex.default,{className:"h-[68px] w-[68px] shadow-md",imageUrl:u||x||""}),c>=0&&!(0,eg.fileIsUploaded)(t)&&(0,s.jsx)("div",{className:"absolute inset-0 z-10 flex items-center justify-center border-[2px] border-effects-image-frame bg-background-overlay-alt",children:(0,s.jsx)(eh.default,{percentage:c,size:12,circleStrokeColor:"stroke-components-progress-white-border",circleFillColor:"fill-transparent",sectorFillColor:"fill-components-progress-white-progress"})}),-1===c&&(0,s.jsx)("div",{className:"absolute inset-0 z-10 flex items-center justify-center border-[2px] border-state-destructive-border bg-background-overlay-destructive",onClick:g,children:(0,s.jsx)(ep.ReplayLine,{className:"size-5 text-text-primary-on-surface"})})]})}),eb=e=>{let{disabled:t,className:a}=e,n=(0,ec.useFileStoreWithSelector)(e=>e.files),[r,o]=(0,l.useState)(0),[i,d]=(0,l.useState)([]),c=(0,l.useCallback)(e=>{let t=n.findIndex(t=>t.id===e);-1!==t&&(o(t),d(n.map(e=>({url:e.base64Url||e.sourceUrl||"",name:e.name,size:e.size}))))},[n]),m=(0,l.useCallback)(()=>{d([])},[]),{handleRemoveFile:x,handleReUploadFile:p}=(0,ed.useUpload)();return(0,s.jsxs)("div",{className:(0,u.cn)("w-full",a),children:[!t&&(0,s.jsx)(eu,{}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2 py-1",children:n.map(e=>(0,s.jsx)(ef,{file:e,showDeleteAction:!t,onRemove:x,onReUpload:p,onPreview:c},e.id))}),i.length>0&&(0,s.jsx)(ei.default,{images:i,initialIndex:r,onClose:m})]})},ej=e=>{let{value:t,onChange:a,...n}=e;return(0,s.jsx)(ec.FileContextProvider,{value:t,onChange:a,children:(0,s.jsx)(eb,{...n})})};var ey=e.i(128984);e.i(698628);var eC=e.i(127210);let ev=(0,Q.createContext)({isCollapsed:!0,fullScreen:!1,toggleFullScreen:A.noop,currSegment:{showModal:!1},currChildChunk:{showModal:!1}}),ew=e=>(0,Q.useContextSelector)(ev,e);var eN=e.i(250755),ek=e.i(194902);e.i(905691);var eS=e.i(706416);let eD=e=>{let{handleCancel:t,handleSave:a,loading:n,actionType:o="edit",handleRegeneration:i,isChildChunk:d=!1,showRegenerationButton:c=!0}=e,{t:u}=(0,r.useTranslation)(),x=(0,en.useDocumentContext)(e=>e.docForm),p=(0,en.useDocumentContext)(e=>e.parentMode);(0,eN.useKeyPress)(["esc"],e=>{e.preventDefault(),t()}),(0,eN.useKeyPress)(`${(0,eS.getKeyboardKeyCodeBySystem)("ctrl")}.s`,e=>{e.preventDefault(),n||a()},{exactMatch:!0,useCapture:!0});let h=(0,l.useMemo)(()=>x===I.ChunkingMode.parentChild&&"paragraph"===p,[x,p]);return(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)(m.default,{onClick:t,children:(0,s.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,s.jsx)("span",{className:"system-sm-medium text-components-button-secondary-text",children:u("operation.cancel",{ns:"common"})}),(0,s.jsx)(ek.default,{keys:["ESC"],textColor:"secondary"})]})}),h&&"edit"===o&&!d&&c?(0,s.jsx)(m.default,{onClick:i,disabled:n,children:(0,s.jsx)("span",{className:"system-sm-medium text-components-button-secondary-text",children:u("operation.saveAndRegenerate",{ns:"common"})})}):null,(0,s.jsx)(m.default,{variant:"primary",onClick:a,disabled:n,children:(0,s.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,s.jsx)("span",{className:"text-components-button-primary-text",children:u("operation.save",{ns:"common"})}),(0,s.jsx)(ek.default,{keys:["ctrl","S"],bgColor:"white"})]})})]})};eD.displayName="ActionButtons";let eM=l.memo(eD);var e_=e.i(324935);let eI=l.memo(e=>{let{className:t,isChecked:a,onCheck:n}=e,{t:l}=(0,r.useTranslation)();return(0,s.jsxs)("div",{className:(0,u.cn)("flex items-center gap-x-1 pl-1",t),children:[(0,s.jsx)(e_.default,{className:"shrink-0",checked:a,onCheck:n},"add-another-checkbox"),(0,s.jsx)("span",{className:"system-xs-medium text-text-tertiary",children:l("segment.addAnother",{ns:"datasetDocuments"})})]})});var eR=e.i(379415);let eT=l.memo(e=>{let{value:t,placeholder:a,className:n,disabled:l,...r}=e;return(0,s.jsx)("textarea",{className:(0,u.cn)("inset-0 w-full resize-none appearance-none overflow-y-auto border-none bg-transparent outline-none",n),placeholder:a,value:t,disabled:l,...r})});eT.displayName="Textarea";let eL=l.memo(e=>{let{className:t,placeholder:a,value:n,disabled:r,containerRef:o,labelRef:i,...d}=e,c=(0,l.useRef)(null),m=(0,l.useRef)(null),[x,p]=(0,l.useState)(0);return(0,l.useEffect)(()=>{let e=c.current;if(!e)return;e.style.height="auto";let t=Number.parseInt(getComputedStyle(e).lineHeight),s=Math.max(e.scrollHeight,t);e.style.height=`${s}px`},[n]),(0,l.useEffect)(()=>{let e=o.current,t=i.current;if(!e||!t)return;let s=()=>{p(Math.floor((e.clientHeight-2*t.clientHeight-32-12)/2))};return s(),m.current=new ResizeObserver(s),m.current.observe(e),()=>{m.current?.disconnect()}},[]),(0,s.jsx)("textarea",{ref:c,className:(0,u.cn)("inset-0 w-full resize-none appearance-none border-none bg-transparent outline-none",t),style:{maxHeight:x},placeholder:a,value:n,disabled:r,...d})});eL.displayName="AutoResizeTextArea";let eE=l.memo(e=>{let{question:t,answer:a,onQuestionChange:n,onAnswerChange:o,isEditMode:i=!0}=e,{t:d}=(0,r.useTranslation)(),c=(0,l.useRef)(null),m=(0,l.useRef)(null);return(0,s.jsxs)("div",{ref:c,className:"h-full overflow-hidden",children:[(0,s.jsx)("div",{ref:m,className:"mb-1 text-xs font-medium text-text-tertiary",children:"QUESTION"}),(0,s.jsx)(eL,{className:"text-sm tracking-[-0.07px] text-text-secondary caret-[#295EFF]",value:t,placeholder:d("segment.questionPlaceholder",{ns:"datasetDocuments"})||"",onChange:e=>n(e.target.value),disabled:!i,containerRef:c,labelRef:m}),(0,s.jsx)("div",{className:"mb-1 mt-6 text-xs font-medium text-text-tertiary",children:"ANSWER"}),(0,s.jsx)(eL,{className:"text-sm tracking-[-0.07px] text-text-secondary caret-[#295EFF]",value:a,placeholder:d("segment.answerPlaceholder",{ns:"datasetDocuments"})||"",onChange:e=>o?.(e.target.value),disabled:!i,autoFocus:!0,containerRef:c,labelRef:m})]})});eE.displayName="QATextArea";let eF=e=>{let{question:t,answer:a,onQuestionChange:n,onAnswerChange:l,isEditMode:o,docForm:i}=e,{t:d}=(0,r.useTranslation)();return i===I.ChunkingMode.qa?(0,s.jsx)(eE,{question:t,answer:a,onQuestionChange:n,onAnswerChange:l,isEditMode:o}):o?(0,s.jsx)(eT,{className:"body-md-regular h-full w-full pb-6 tracking-[-0.07px] text-text-secondary caret-[#295EFF]",value:t,placeholder:d("segment.contentPlaceholder",{ns:"datasetDocuments"})||"",onChange:e=>n(e.target.value),disabled:!o,autoFocus:!0}):(0,s.jsx)(eR.Markdown,{className:"h-full w-full !text-text-secondary",content:t,customDisallowedElements:["input"]})};eF.displayName="ChunkContent";let eA=l.memo(eF);var e$=e.i(402885),eP=e.i(522977);let ez=e=>{let{segInfo:t,className:a,keywords:n,onKeywordsChange:l,isEditMode:o,actionType:i="view"}=e,{t:d}=(0,r.useTranslation)();return(0,s.jsxs)("div",{className:(0,u.cn)("flex flex-col",a),children:[(0,s.jsx)("div",{className:"system-xs-medium-uppercase text-text-tertiary",children:d("segment.keywords",{ns:"datasetDocuments"})}),(0,s.jsx)("div",{className:"flex max-h-[200px] w-full flex-wrap gap-1 overflow-auto text-text-tertiary",children:t?.keywords?.length||"view"!==i?(0,s.jsx)(eP.default,{items:n,onChange:e=>l(e),disableAdd:!o,disableRemove:!o||1===n.length}):"-"})]})};ez.displayName="Keywords";let eq=l.memo(ez);var eO=e.i(415671);let eU=(0,l.memo)(e=>{let{onCancel:t,docForm:i,onSave:d,viewNewlyAddedChunk:m}=e,{t:x}=(0,r.useTranslation)(),{notify:h}=(0,Q.useContext)(c.ToastContext),[g,f]=(0,l.useState)(""),[b,j]=(0,l.useState)(""),[y,C]=(0,l.useState)([]),{datasetId:v,documentId:w}=(0,n.useParams)(),[N,k]=(0,l.useState)([]),[S,D]=(0,l.useState)(!1),[M,_]=(0,l.useState)(!0),R=ew(e=>e.fullScreen),L=ew(e=>e.toggleFullScreen),E=(0,p.useDatasetDetailContextWithSelector)(e=>e.dataset?.indexing_technique),{appSidebarExpand:F}=(0,eo.useStore)((0,er.useShallow)(e=>({appSidebarExpand:e.appSidebarExpand}))),[A,$]=(0,l.useState)(Date.now()),P=(0,l.useRef)(null),z=(0,l.useMemo)(()=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.default,{type:"vertical",className:"mx-1 h-3 bg-divider-regular"}),(0,s.jsx)("button",{type:"button",className:"system-xs-semibold text-text-accent",onClick:()=>{clearTimeout(P.current),m()},children:x("operation.view",{ns:"common"})})]}),[m,x]),q=(0,l.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"esc";"esc"!==e&&M||t()},[t,M]),O=(0,l.useCallback)(e=>{C(e)},[]),{mutateAsync:U}=(0,T.useAddSegment)(),B=(0,l.useCallback)(async()=>{let e={content:"",attachment_ids:[]};if(i===I.ChunkingMode.qa){if(!g.trim())return h({type:"error",message:x("segment.questionEmpty",{ns:"datasetDocuments"})});if(!b.trim())return h({type:"error",message:x("segment.answerEmpty",{ns:"datasetDocuments"})});e.content=g,e.answer=b}else{if(!g.trim())return h({type:"error",message:x("segment.contentEmpty",{ns:"datasetDocuments"})});e.content=g}N?.length&&(e.keywords=N),y.length&&(e.attachment_ids=y.filter(e=>!!e.uploadedId).map(e=>e.uploadedId)),D(!0),await U({datasetId:v,documentId:w,body:e},{onSuccess(){h({type:"success",message:x("segment.chunkAdded",{ns:"datasetDocuments"}),className:`!w-[296px] !bottom-0 ${"expand"===F?"!left-[216px]":"!left-14"}
          !top-auto !right-auto !mb-[52px] !ml-11`,customComponent:z}),q("add"),f(""),j(""),C([]),$(Date.now()),k([]),P.current=setTimeout(()=>{d()},3e3)},onSettled(){D(!1)}})},[i,N,U,v,w,g,b,y,h,x,F,z,q,d]),K=(0,l.useMemo)(()=>{let e=i===I.ChunkingMode.qa?g.length+b.length:g.length;return`${(0,ey.formatNumber)(e)} ${x("segment.characters",{ns:"datasetDocuments",count:e})}`},[g.length,b.length,i,x]),V=E===eC.IndexingType.ECONOMICAL;return(0,s.jsxs)("div",{className:"flex h-full flex-col",children:[(0,s.jsxs)("div",{className:(0,u.cn)("flex items-center justify-between",R?"border border-divider-subtle py-3 pl-6 pr-4":"pl-4 pr-3 pt-3"),children:[(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("div",{className:"system-xl-semibold text-text-primary",children:x("segment.addChunk",{ns:"datasetDocuments"})}),(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)(eO.SegmentIndexTag,{label:x("segment.newChunk",{ns:"datasetDocuments"})}),(0,s.jsx)(e$.default,{}),(0,s.jsx)("span",{className:"system-xs-medium text-text-tertiary",children:K})]})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[R&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eI,{className:"mr-3",isChecked:M,onCheck:()=>_(!M)}),(0,s.jsx)(eM,{handleCancel:q.bind(null,"esc"),handleSave:B,loading:S,actionType:"add"}),(0,s.jsx)(o.default,{type:"vertical",className:"ml-4 mr-2 h-3.5 bg-divider-regular"})]}),(0,s.jsx)("div",{className:"mr-1 flex h-8 w-8 cursor-pointer items-center justify-center p-1.5",onClick:L,children:(0,s.jsx)(a.RiExpandDiagonalLine,{className:"h-4 w-4 text-text-tertiary"})}),(0,s.jsx)("div",{className:"flex h-8 w-8 cursor-pointer items-center justify-center p-1.5",onClick:q.bind(null,"esc"),children:(0,s.jsx)(a.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})})]})]}),(0,s.jsxs)("div",{className:(0,u.cn)("flex grow",R?"w-full flex-row justify-center gap-x-8 px-6 pt-6":"flex-col gap-y-1 px-4 py-3"),children:[(0,s.jsx)("div",{className:(0,u.cn)("overflow-hidden whitespace-pre-line break-all",R?"w-1/2":"grow"),children:(0,s.jsx)(eA,{docForm:i,question:g,answer:b,onQuestionChange:e=>f(e),onAnswerChange:e=>j(e),isEditMode:!0})}),(0,s.jsxs)("div",{className:(0,u.cn)("flex flex-col",R?"w-[320px] gap-y-2":"w-full gap-y-1"),children:[(0,s.jsx)(ej,{value:y,onChange:O},A),V&&(0,s.jsx)(eq,{className:R?"w-1/5":"",actionType:"add",keywords:N,isEditMode:!0,onKeywordsChange:e=>k(e)})]})]}),!R&&(0,s.jsxs)("div",{className:"flex items-center justify-between border-t-[1px] border-t-divider-subtle p-4 pt-3",children:[(0,s.jsx)(eI,{isChecked:M,onCheck:()=>_(!M)}),(0,s.jsx)(eM,{handleCancel:q.bind(null,"esc"),handleSave:B,loading:S,actionType:"add"})]})]})});var eB=e.i(249420),eK=e.i(167574);let eV=l.memo(e=>{let{chunkId:t,childChunkInfo:n,onUpdate:i,onCancel:d,docForm:c}=e,{t:m}=(0,r.useTranslation)(),[x,p]=(0,l.useState)(n?.content||""),{eventEmitter:h}=(0,eB.useEventEmitterContextContext)(),[g,f]=(0,l.useState)(!1),b=ew(e=>e.fullScreen),j=ew(e=>e.toggleFullScreen);h?.useSubscription(e=>{"update-child-segment"===e&&f(!0),"update-child-segment-done"===e&&f(!1)});let y=()=>{d()},C=()=>{i(t,n?.id||"",x)},v=(0,l.useMemo)(()=>{let e=x.length;return`${(0,ey.formatNumber)(e)} ${m("segment.characters",{ns:"datasetDocuments",count:e})}`},[x.length]),w=(0,l.useMemo)(()=>{let e=(0,eK.formatTime)({date:(n?.updated_at??0)*1e3,dateFormat:`${m("segment.dateTimeFormat",{ns:"datasetDocuments"})}`});return`${m("segment.editedAt",{ns:"datasetDocuments"})} ${e}`},[n?.updated_at]);return(0,s.jsxs)("div",{className:"flex h-full flex-col",children:[(0,s.jsxs)("div",{className:(0,u.cn)("flex items-center justify-between",b?"border border-divider-subtle py-3 pl-6 pr-4":"pl-4 pr-3 pt-3"),children:[(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("div",{className:"system-xl-semibold text-text-primary",children:m("segment.editChildChunk",{ns:"datasetDocuments"})}),(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)(eO.SegmentIndexTag,{positionId:n?.position||"",labelPrefix:m("segment.childChunk",{ns:"datasetDocuments"})}),(0,s.jsx)(e$.default,{}),(0,s.jsx)("span",{className:"system-xs-medium text-text-tertiary",children:v}),(0,s.jsx)(e$.default,{}),(0,s.jsx)("span",{className:"system-xs-medium text-text-tertiary",children:w})]})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[b&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eM,{handleCancel:y,handleSave:C,loading:g,isChildChunk:!0}),(0,s.jsx)(o.default,{type:"vertical",className:"ml-4 mr-2 h-3.5 bg-divider-regular"})]}),(0,s.jsx)("div",{className:"mr-1 flex h-8 w-8 cursor-pointer items-center justify-center p-1.5",onClick:j,children:b?(0,s.jsx)(a.RiCollapseDiagonalLine,{className:"h-4 w-4 text-text-tertiary"}):(0,s.jsx)(a.RiExpandDiagonalLine,{className:"h-4 w-4 text-text-tertiary"})}),(0,s.jsx)("div",{className:"flex h-8 w-8 cursor-pointer items-center justify-center p-1.5",onClick:d,children:(0,s.jsx)(a.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})})]})]}),(0,s.jsx)("div",{className:(0,u.cn)("flex w-full grow",b?"flex-row justify-center px-6 pt-6":"px-4 py-3"),children:(0,s.jsx)("div",{className:(0,u.cn)("h-full overflow-hidden whitespace-pre-line break-all",b?"w-1/2":"w-full"),children:(0,s.jsx)(eA,{docForm:c,question:x,onQuestionChange:e=>p(e),isEditMode:!0})})}),!b&&(0,s.jsx)("div",{className:"flex items-center justify-end border-t-[1px] border-t-divider-subtle p-4 pt-3",children:(0,s.jsx)(eM,{handleCancel:y,handleSave:C,loading:g,isChildChunk:!0})})]})});var eH=e.i(688393);let eQ={right:"right-0",left:"left-0",bottom:"bottom-0",top:"top-0"};function eW(e,t){return Array.from(document.querySelectorAll(e)).some(e=>e?.contains(t))}let eG=e=>{let{open:t,onClose:a,side:n="right",showOverlay:r=!0,modal:o=!1,needCheckChunks:i=!1,children:d,panelClassName:c,panelContentClassName:m}=e,x=(0,l.useRef)(null),p=ew(e=>e.currSegment),h=ew(e=>e.currChildChunk);(0,eN.useKeyPress)("esc",e=>{t&&(e.preventDefault(),a())},{exactMatch:!0,useCapture:!0});let g=(0,l.useCallback)(e=>{var t,s;let a=x.current;if(!a||!e||a.contains(e)||eW(".image-previewer",e))return!1;if(!i)return!0;let n=eW(".chunk-card",e),l=eW(".child-chunk",e);return t=p.showModal,s=h.showModal,!!t&&!!l||!!s&&!!n&&!l||!n&&!l},[p.showModal,h.showModal,i]),f=(0,l.useCallback)(e=>{!t||o||!x.current||g(e.target)&&queueMicrotask(a)},[g,a,t,o]);(0,l.useEffect)(()=>(window.addEventListener("pointerdown",f,{capture:!0}),()=>window.removeEventListener("pointerdown",f,{capture:!0})),[f]);let b=o&&t?"pointer-events-auto":"pointer-events-none",j=(0,s.jsxs)("div",{className:"pointer-events-none fixed inset-0 z-[9999]",children:[r&&(0,s.jsx)("div",{onClick:o?a:void 0,"aria-hidden":"true",className:(0,u.cn)("fixed inset-0 bg-black/30 opacity-0 transition-opacity duration-200 ease-in",t&&"opacity-100",b)}),(0,s.jsx)("div",{role:"dialog","aria-modal":o?"true":"false",className:(0,u.cn)("pointer-events-auto fixed flex flex-col",eQ[n],"left"===n||"right"===n?"h-screen":"w-screen",c),children:(0,s.jsx)("div",{ref:x,className:(0,u.cn)("flex grow flex-col",m),children:d})})]});return t?(0,eH.createPortal)(j,document.body):null},eY=e=>{let{isOpen:t,onClose:a=A.noop,fullScreen:n,children:l,showOverlay:r=!0,needCheckChunks:o=!1,modal:i=!1}=e;return(0,s.jsx)(eG,{open:t,onClose:a,panelClassName:(0,u.cn)(n?"w-full":"w-[568px] pb-2 pr-2 pt-16"),panelContentClassName:(0,u.cn)("bg-components-panel-bg",!n&&"rounded-xl border-[0.5px] border-components-panel-border"),showOverlay:r,needCheckChunks:o,modal:i,children:l})},eZ=(0,l.memo)(e=>{let{chunkId:t,onCancel:i,onSave:d,viewNewlyAddedChildChunk:m}=e,{t:x}=(0,r.useTranslation)(),{notify:p}=(0,Q.useContext)(c.ToastContext),[h,g]=(0,l.useState)(""),{datasetId:f,documentId:b}=(0,n.useParams)(),[j,y]=(0,l.useState)(!1),[C,v]=(0,l.useState)(!0),w=ew(e=>e.fullScreen),N=ew(e=>e.toggleFullScreen),{appSidebarExpand:k}=(0,eo.useStore)((0,er.useShallow)(e=>({appSidebarExpand:e.appSidebarExpand}))),S=(0,en.useDocumentContext)(e=>e.parentMode),D=(0,l.useRef)(null),M=(0,l.useMemo)(()=>"full-doc"===S,[S]),_=(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.default,{type:"vertical",className:"mx-1 h-3 bg-divider-regular"}),(0,s.jsx)("button",{type:"button",className:"system-xs-semibold text-text-accent",onClick:()=>{clearTimeout(D.current),m?.()},children:x("operation.view",{ns:"common"})})]}),R=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"esc";"esc"!==e&&C||i()},{mutateAsync:L}=(0,T.useAddChildSegment)(),E=async()=>{let e={content:""};if(!h.trim())return p({type:"error",message:x("segment.contentEmpty",{ns:"datasetDocuments"})});e.content=h,y(!0),await L({datasetId:f,documentId:b,segmentId:t,body:e},{onSuccess(e){p({type:"success",message:x("segment.childChunkAdded",{ns:"datasetDocuments"}),className:`!w-[296px] !bottom-0 ${"expand"===k?"!left-[216px]":"!left-14"}
          !top-auto !right-auto !mb-[52px] !ml-11`,customComponent:M&&_}),R("add"),g(""),M?D.current=setTimeout(()=>{d()},3e3):d(e.data)},onSettled(){y(!1)}})},F=(0,l.useMemo)(()=>{let e=h.length;return`${(0,ey.formatNumber)(e)} ${x("segment.characters",{ns:"datasetDocuments",count:e})}`},[h.length]);return(0,s.jsxs)("div",{className:"flex h-full flex-col",children:[(0,s.jsxs)("div",{className:(0,u.cn)("flex items-center justify-between",w?"border border-divider-subtle py-3 pl-6 pr-4":"pl-4 pr-3 pt-3"),children:[(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("div",{className:"system-xl-semibold text-text-primary",children:x("segment.addChildChunk",{ns:"datasetDocuments"})}),(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)(eO.SegmentIndexTag,{label:x("segment.newChildChunk",{ns:"datasetDocuments"})}),(0,s.jsx)(e$.default,{}),(0,s.jsx)("span",{className:"system-xs-medium text-text-tertiary",children:F})]})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[w&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eI,{className:"mr-3",isChecked:C,onCheck:()=>v(!C)}),(0,s.jsx)(eM,{handleCancel:R.bind(null,"esc"),handleSave:E,loading:j,actionType:"add",isChildChunk:!0}),(0,s.jsx)(o.default,{type:"vertical",className:"ml-4 mr-2 h-3.5 bg-divider-regular"})]}),(0,s.jsx)("div",{className:"mr-1 flex h-8 w-8 cursor-pointer items-center justify-center p-1.5",onClick:N,children:(0,s.jsx)(a.RiExpandDiagonalLine,{className:"h-4 w-4 text-text-tertiary"})}),(0,s.jsx)("div",{className:"flex h-8 w-8 cursor-pointer items-center justify-center p-1.5",onClick:R.bind(null,"esc"),children:(0,s.jsx)(a.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})})]})]}),(0,s.jsx)("div",{className:(0,u.cn)("flex w-full grow",w?"flex-row justify-center px-6 pt-6":"px-4 py-3"),children:(0,s.jsx)("div",{className:(0,u.cn)("h-full overflow-hidden whitespace-pre-line break-all",w?"w-1/2":"w-full"),children:(0,s.jsx)(eA,{docForm:I.ChunkingMode.parentChild,question:h,onQuestionChange:e=>g(e),isEditMode:!0})})}),!w&&(0,s.jsxs)("div",{className:"flex items-center justify-between border-t-[1px] border-t-divider-subtle p-4 pt-3",children:[(0,s.jsx)(eI,{isChecked:C,onCheck:()=>v(!C)}),(0,s.jsx)(eM,{handleCancel:R.bind(null,"esc"),handleSave:E,loading:j,actionType:"add",isChildChunk:!0})]})]})});var eX=e.i(503144),eJ=e.i(210644);let e0=l.memo(e=>{let{onCancel:t,onConfirm:a}=e,{t:n}=(0,r.useTranslation)();return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"pb-4",children:[(0,s.jsx)("span",{className:"title-2xl-semi-bold text-text-primary",children:n("segment.regenerationConfirmTitle",{ns:"datasetDocuments"})}),(0,s.jsx)("p",{className:"system-md-regular text-text-secondary",children:n("segment.regenerationConfirmMessage",{ns:"datasetDocuments"})})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-x-2 pt-6",children:[(0,s.jsx)(m.default,{onClick:t,children:n("operation.cancel",{ns:"common"})}),(0,s.jsx)(m.default,{variant:"warning",destructive:!0,onClick:a,children:n("operation.regenerate",{ns:"common"})})]})]})});e0.displayName="DefaultContent";let e1=l.memo(()=>{let{t:e}=(0,r.useTranslation)();return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"pb-4",children:[(0,s.jsx)("span",{className:"title-2xl-semi-bold text-text-primary",children:e("segment.regeneratingTitle",{ns:"datasetDocuments"})}),(0,s.jsx)("p",{className:"system-md-regular text-text-secondary",children:e("segment.regeneratingMessage",{ns:"datasetDocuments"})})]}),(0,s.jsx)("div",{className:"flex justify-end pt-6",children:(0,s.jsxs)(m.default,{variant:"warning",destructive:!0,disabled:!0,className:"inline-flex items-center gap-x-0.5",children:[(0,s.jsx)(a.RiLoader2Line,{className:"h-4 w-4 animate-spin text-components-button-destructive-primary-text-disabled"}),(0,s.jsx)("span",{children:e("operation.regenerate",{ns:"common"})})]})})]})});e1.displayName="RegeneratingContent";let e2=l.memo(e=>{let{onClose:t}=e,{t:a}=(0,r.useTranslation)(),n=(0,l.useRef)(Date.now()+5e3),[o]=(0,eJ.useCountDown)({targetDate:n.current,onEnd:()=>{t()}});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"pb-4",children:[(0,s.jsx)("span",{className:"title-2xl-semi-bold text-text-primary",children:a("segment.regenerationSuccessTitle",{ns:"datasetDocuments"})}),(0,s.jsx)("p",{className:"system-md-regular text-text-secondary",children:a("segment.regenerationSuccessMessage",{ns:"datasetDocuments"})})]}),(0,s.jsx)("div",{className:"flex justify-end pt-6",children:(0,s.jsx)(m.default,{variant:"primary",onClick:t,children:`${a("operation.close",{ns:"common"})}${0===o?"":`(${Math.round(o/1e3)})`}`})})]})});e2.displayName="RegenerationCompletedContent";let e4=e=>{let{isShow:t,onConfirm:a,onCancel:n,onClose:r}=e,[o,i]=(0,l.useState)(!1),[d,c]=(0,l.useState)(!1),{eventEmitter:m}=(0,eB.useEventEmitterContextContext)();return m?.useSubscription(e=>{"update-segment"===e&&(i(!0),c(!1)),"update-segment-success"===e&&c(!0),"update-segment-done"===e&&i(!1)}),(0,s.jsxs)($.default,{isShow:t,onClose:A.noop,className:"!max-w-[480px] !rounded-2xl",wrapperClassName:"!z-[10000]",children:[!o&&!d&&(0,s.jsx)(e0,{onCancel:n,onConfirm:a}),o&&!d&&(0,s.jsx)(e1,{}),!o&&d&&(0,s.jsx)(e2,{onClose:r})]})};var e5=e.i(684919);let e3=l.memo(e=>{let{segInfo:t,onUpdate:n,onCancel:i,isEditMode:d,docForm:c,onModalStateChange:m}=e,{t:x}=(0,r.useTranslation)(),[h,g]=(0,l.useState)(d?t?.content||"":t?.sign_content||""),[f,b]=(0,l.useState)(t?.answer||""),[j,y]=(0,l.useState)(t?.summary||""),[C,v]=(0,l.useState)(()=>t?.attachments?.map(e=>({id:(0,eX.v4)(),name:e.name,size:e.size,mimeType:e.mime_type,extension:e.extension,sourceUrl:e.source_url,uploadedId:e.id,progress:100}))||[]),[w,N]=(0,l.useState)(t?.keywords||[]),{eventEmitter:k}=(0,eB.useEventEmitterContextContext)(),[S,D]=(0,l.useState)(!1),[M,_]=(0,l.useState)(!1),R=ew(e=>e.fullScreen),T=ew(e=>e.toggleFullScreen),L=(0,en.useDocumentContext)(e=>e.parentMode),E=(0,p.useDatasetDetailContextWithSelector)(e=>e.dataset?.indexing_technique),F=(0,p.useDatasetDetailContextWithSelector)(e=>e.dataset?.runtime_mode);k?.useSubscription(e=>{"update-segment"===e&&D(!0),"update-segment-done"===e&&D(!1)});let A=(0,l.useCallback)(()=>{i()},[i]),$=(0,l.useCallback)(()=>{n(t?.id||"",h,f,w,C,j,!1)},[n,t?.id,h,f,w,C,j]),P=(0,l.useCallback)(()=>{_(!0),m?.(!0)},[m]),z=(0,l.useCallback)(()=>{_(!1),m?.(!1)},[m]),q=(0,l.useCallback)(()=>{_(!1),m?.(!1),i()},[i,m]),O=(0,l.useCallback)(()=>{n(t?.id||"",h,f,w,C,j,!0)},[n,t?.id,h,f,w,C,j]),U=(0,l.useCallback)(e=>{v(e)},[]),B=(0,l.useMemo)(()=>{let e=c===I.ChunkingMode.qa?h.length+f.length:h.length,s=(0,ey.formatNumber)(d?e:t.word_count),a=d?e:t.word_count;return`${s} ${x("segment.characters",{ns:"datasetDocuments",count:a})}`},[d,h.length,f.length,c,t,x]),K=c===I.ChunkingMode.parentChild&&"full-doc"===L,V=d?x("segment.editChunk",{ns:"datasetDocuments"}):x("segment.chunkDetail",{ns:"datasetDocuments"}),H=c===I.ChunkingMode.parentChild?x("segment.parentChunk",{ns:"datasetDocuments"}):x("segment.chunk",{ns:"datasetDocuments"}),Q=E===eC.IndexingType.ECONOMICAL;return(0,s.jsxs)("div",{className:"flex h-full flex-col",children:[(0,s.jsxs)("div",{className:(0,u.cn)("flex shrink-0 items-center justify-between",R?"border border-divider-subtle py-3 pl-6 pr-4":"pl-4 pr-3 pt-3"),children:[(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("div",{className:"system-xl-semibold text-text-primary",children:V}),(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)(eO.SegmentIndexTag,{positionId:t?.position||"",label:K?H:"",labelPrefix:H}),(0,s.jsx)(e$.default,{}),(0,s.jsx)("span",{className:"system-xs-medium text-text-tertiary",children:B})]})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[d&&R&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eM,{handleCancel:A,handleRegeneration:P,handleSave:$,loading:S,showRegenerationButton:"general"===F}),(0,s.jsx)(o.default,{type:"vertical",className:"ml-4 mr-2 h-3.5 bg-divider-regular"})]}),(0,s.jsx)("div",{className:"mr-1 flex h-8 w-8 cursor-pointer items-center justify-center p-1.5",onClick:T,children:R?(0,s.jsx)(a.RiCollapseDiagonalLine,{className:"h-4 w-4 text-text-tertiary"}):(0,s.jsx)(a.RiExpandDiagonalLine,{className:"h-4 w-4 text-text-tertiary"})}),(0,s.jsx)("div",{className:"flex h-8 w-8 cursor-pointer items-center justify-center p-1.5",onClick:i,children:(0,s.jsx)(a.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})})]})]}),(0,s.jsxs)("div",{className:(0,u.cn)("flex h-0 grow",R?"w-full flex-row justify-center gap-x-8 px-6 pt-6":"flex-col gap-y-1 px-4 py-3",!d&&"pb-0"),children:[(0,s.jsx)("div",{className:(0,u.cn)(d?"overflow-hidden whitespace-pre-line break-all":"overflow-y-auto",R?"w-1/2":"h-0 grow"),children:(0,s.jsx)(eA,{docForm:c,question:h,answer:f,onQuestionChange:e=>g(e),onAnswerChange:e=>b(e),isEditMode:d})}),(0,s.jsxs)("div",{className:(0,u.cn)("flex shrink-0 flex-col",R?"w-[320px] gap-y-2":"w-full gap-y-1"),children:[(0,s.jsx)(ej,{disabled:!d,value:C,onChange:U}),(0,s.jsx)(e5.default,{value:j,onChange:e=>y(e),disabled:!d}),Q&&(0,s.jsx)(eq,{className:"w-full",actionType:d?"edit":"view",segInfo:t,keywords:w,isEditMode:d,onKeywordsChange:e=>N(e)})]})]}),d&&!R&&(0,s.jsx)("div",{className:"flex items-center justify-end border-t-[1px] border-t-divider-subtle p-4 pt-3",children:(0,s.jsx)(eM,{handleCancel:A,handleRegeneration:P,handleSave:$,loading:S,showRegenerationButton:"general"===F})}),M&&(0,s.jsx)(e4,{isShow:M,onConfirm:O,onCancel:z,onClose:q})]})}),e6=e=>{let{currSegment:t,onCloseSegmentDetail:a,onUpdateSegment:n,isRegenerationModalOpen:l,setIsRegenerationModalOpen:r,showNewSegmentModal:o,onCloseNewSegmentModal:i,onSaveNewSegment:d,viewNewlyAddedChunk:c,currChildChunk:m,currChunkId:u,onCloseChildSegmentDetail:x,onUpdateChildChunk:p,showNewChildSegmentModal:h,onCloseNewChildChunkModal:g,onSaveNewChildChunk:f,viewNewlyAddedChildChunk:b,fullScreen:j,docForm:y}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eY,{isOpen:t.showModal,fullScreen:j,onClose:a,showOverlay:!1,needCheckChunks:!0,modal:l,children:(0,s.jsx)(e3,{segInfo:t.segInfo??{id:""},docForm:y,isEditMode:t.isEditMode,onUpdate:n,onCancel:a,onModalStateChange:r},t.segInfo?.id)}),(0,s.jsx)(eY,{isOpen:o,fullScreen:j,onClose:i,modal:!0,children:(0,s.jsx)(eU,{docForm:y,onCancel:i,onSave:d,viewNewlyAddedChunk:c})}),(0,s.jsx)(eY,{isOpen:m.showModal,fullScreen:j,onClose:x,showOverlay:!1,needCheckChunks:!0,children:(0,s.jsx)(eV,{chunkId:u,childChunkInfo:m.childChunkInfo??{id:""},docForm:y,onUpdate:p,onCancel:x},m.childChunkInfo?.id)}),(0,s.jsx)(eY,{isOpen:h,fullScreen:j,onClose:g,modal:!0,children:(0,s.jsx)(eZ,{chunkId:u,onCancel:g,onSave:f,viewNewlyAddedChildChunk:b})})]})};var e9=e.i(291631),e8=e.i(299951);e.i(9633);var e7=e.i(177660),e7=e7;let te=l.memo(e=>{let{isCollapsed:t,toggleCollapsed:n}=e,{t:l}=(0,r.useTranslation)();return(0,s.jsx)(j.default,{popupContent:l(t?"segment.expandChunks":"segment.collapseChunks",{ns:"datasetDocuments"}),popupClassName:"text-text-secondary system-xs-medium border-[0.5px] border-components-panel-border",children:(0,s.jsx)("button",{type:"button",className:"flex items-center justify-center rounded-lg border-[0.5px] border-components-button-secondary-border bg-components-button-secondary-bg p-2 shadow-xs shadow-shadow-shadow-3 backdrop-blur-[5px]",onClick:n,children:t?(0,s.jsx)(a.RiLineHeight,{className:"h-4 w-4 text-components-button-secondary-text"}):(0,s.jsx)(e7.default,{className:"h-4 w-4 text-components-button-secondary-text"})})})}),tt=l.memo(e=>{let{item:t,selected:n}=e;return(0,s.jsxs)("div",{className:"flex items-center justify-between px-2 py-1.5",children:[(0,s.jsx)("span",{className:"system-md-regular",children:t.name}),n&&(0,s.jsx)(a.RiCheckLine,{className:"h-4 w-4 text-text-accent"})]})});var ts=e.i(607519);let ta=e=>{let{isAllSelected:t,isSomeSelected:a,onSelectedAll:n,isLoading:l,totalText:r,statusList:i,selectDefaultValue:d,onChangeStatus:c,inputValue:m,onInputChange:u,isCollapsed:x,toggleCollapsed:p}=e;return(0,s.jsxs)("div",{className:ts.default.docSearchWrapper,children:[(0,s.jsx)(e_.default,{className:"shrink-0",checked:t,indeterminate:!t&&a,onCheck:n,disabled:l}),(0,s.jsx)("div",{className:"system-sm-semibold-uppercase flex-1 pl-5 text-text-secondary",children:r}),(0,s.jsx)(e8.SimpleSelect,{onSelect:c,items:i,defaultValue:d,className:ts.default.select,wrapperClassName:"h-fit mr-2",optionWrapClassName:"w-[160px]",optionClassName:"p-0",renderOption:e=>{let{item:t,selected:a}=e;return(0,s.jsx)(tt,{item:t,selected:a})},notClearable:!0}),(0,s.jsx)(e9.default,{showLeftIcon:!0,showClearIcon:!0,wrapperClassName:"!w-52",value:m,onChange:e=>u(e.target.value),onClear:()=>u("")}),(0,s.jsx)(o.default,{type:"vertical",className:"mx-3 h-3.5"}),(0,s.jsx)(te,{isCollapsed:x,toggleCollapsed:p})]})};var tn=e.i(422957),tl=e.i(161577),tr=e.i(715898),to=e.i(93869),ti=e.i(654313),td=e.i(878093);let tc=e=>{let{label:t,className:n,text:r,onDelete:o,labelClassName:i,labelInnerClassName:d,contentClassName:c,showDivider:m=!0,offsetOptions:x,...p}=e,[h,g]=(0,l.useState)(!1),[f,b]=(0,l.useState)(!1),{refs:j,floatingStyles:y,context:C}=(0,tr.useFloating)({open:h,onOpenChange:g,placement:"right-start",whileElementsMounted:tn.autoUpdate,middleware:[(0,tl.flip)(),(0,tl.shift)(),(0,tl.offset)(x)]}),v=(0,tr.useHover)(C,{}),w=(0,tr.useDismiss)(C),N=(0,tr.useRole)(C),{getReferenceProps:k,getFloatingProps:S}=(0,tr.useInteractions)([v,w,N]),D=h&&f;return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(td.SliceContainer,{...p,className:(0,u.cn)("mr-0 block",n),ref:e=>{j.setReference(e),e&&(0,to.default)(e,4)},...k(),children:[(0,s.jsx)(td.SliceLabel,{className:(0,u.cn)(D&&"!bg-state-destructive-solid !text-text-primary-on-surface",i),labelInnerClassName:d,children:t}),(0,s.jsx)(td.SliceContent,{className:(0,u.cn)(D&&"!bg-state-destructive-hover-alt",c),children:r}),m&&(0,s.jsx)(td.SliceDivider,{className:(0,u.cn)(D&&"!bg-state-destructive-hover-alt")}),h&&(0,s.jsx)(tr.FloatingFocusManager,{context:C,children:(0,s.jsx)("span",{ref:j.setFloating,style:y,...S(),className:"inline-flex items-center justify-center rounded-lg bg-components-actionbar-bg p-1 shadow",onMouseEnter:()=>b(!0),onMouseLeave:()=>b(!1),children:(0,s.jsx)(ti.default,{onClick:e=>{e.stopPropagation(),o(),g(!1)},state:ti.ActionButtonState.Destructive,children:(0,s.jsx)(a.RiDeleteBinLine,{className:"h-4 w-4"})})})})]})})};var tm=e.i(471371);let tu=l.memo(()=>(0,s.jsx)("div",{className:"h-32 w-full shrink-0 rounded-xl bg-background-section-burn opacity-30"}));tu.displayName="EmptyCard";let tx=l.memo(e=>{let{className:t}=e;return(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"2",height:"241",viewBox:"0 0 2 241",fill:"none",className:t,children:[(0,s.jsx)("path",{d:"M1 0.5L1 240.5",stroke:"url(#paint0_linear_1989_74474)"}),(0,s.jsx)("defs",{children:(0,s.jsxs)("linearGradient",{id:"paint0_linear_1989_74474",x1:"-7.99584",y1:"240.5",x2:"-7.88094",y2:"0.50004",gradientUnits:"userSpaceOnUse",children:[(0,s.jsx)("stop",{stopColor:"white",stopOpacity:"0.01"}),(0,s.jsx)("stop",{offset:"0.503965",stopColor:"#101828",stopOpacity:"0.08"}),(0,s.jsx)("stop",{offset:"1",stopColor:"white",stopOpacity:"0.01"})]})})]})});tx.displayName="Line";let tp=l.memo(e=>{let{onClearFilter:t}=e,{t:n}=(0,r.useTranslation)();return(0,s.jsxs)("div",{className:"relative z-0 flex h-full items-center justify-center",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsxs)("div",{className:"relative z-10 flex h-14 w-14 items-center justify-center rounded-xl border border-divider-subtle bg-components-card-bg shadow-lg shadow-shadow-shadow-5",children:[(0,s.jsx)(a.RiFileList2Line,{className:"h-6 w-6 text-text-secondary"}),(0,s.jsx)(tx,{className:"absolute -right-px top-1/2 -translate-y-1/2"}),(0,s.jsx)(tx,{className:"absolute -left-px top-1/2 -translate-y-1/2"}),(0,s.jsx)(tx,{className:"absolute left-1/2 top-0 -translate-x-1/2 -translate-y-1/2 rotate-90"}),(0,s.jsx)(tx,{className:"absolute left-1/2 top-full -translate-x-1/2 -translate-y-1/2 rotate-90"})]}),(0,s.jsx)("div",{className:"system-md-regular mt-3 text-text-tertiary",children:n("segment.empty",{ns:"datasetDocuments"})}),(0,s.jsx)("button",{type:"button",className:"system-sm-medium mt-1 text-text-accent",onClick:t,children:n("segment.clearFilter",{ns:"datasetDocuments"})})]}),(0,s.jsx)("div",{className:"absolute left-0 top-0 -z-20 flex h-full w-full flex-col gap-y-3 overflow-hidden",children:Array.from({length:10}).map((e,t)=>(0,s.jsx)(tu,{},t))}),(0,s.jsx)("div",{className:"absolute left-0 top-0 -z-10 h-full w-full bg-dataset-chunk-list-mask-bg"})]})}),th=l.memo(()=>(0,s.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,s.jsx)("div",{className:"flex h-5 w-full items-center bg-state-base-hover",children:(0,s.jsx)("span",{className:"h-5 w-[30px] bg-state-base-hover-alt"})}),(0,s.jsx)("div",{className:"h-5 w-2/3 bg-state-base-hover"})]}));th.displayName="Slice";let tg=l.memo(()=>(0,s.jsxs)("div",{className:"relative z-10 flex w-full grow flex-col gap-y-3 overflow-y-hidden",children:[(0,s.jsx)("div",{className:"absolute bottom-14 left-0 top-0 z-20 h-full w-full bg-dataset-chunk-list-mask-bg"}),Array.from({length:15}).map((e,t)=>(0,s.jsx)(th,{},t))]})),tf=e=>{let{childChunks:t,parentChunkId:n,handleInputChange:i,handleAddNewChildChunk:d,enabled:c,onDelete:m,onClickSlice:x,total:p,inputValue:h,onClearFilter:g,isLoading:f,focused:b=!1}=e,{t:j}=(0,r.useTranslation)(),y=(0,en.useDocumentContext)(e=>e.parentMode),C=ew(e=>e.currChildChunk),[v,w]=(0,l.useState)(!0),N="paragraph"===y,k="full-doc"===y,S=""!==h&&k,{displayText:D,count:M,translationKey:_}=function(e,t,s,a){if(t){let e=s??0;return{displayText:0===e?"--":String((0,ey.formatNumber)(e)),count:e,translationKey:"segment.searchResults"}}if(e){let e=s??0;return{displayText:0===e?"--":String((0,ey.formatNumber)(e)),count:e,translationKey:"segment.childChunks"}}return{displayText:String((0,ey.formatNumber)(a)),count:a,translationKey:"segment.childChunks"}}(k,S,p,t.length),I=`${D} ${j(_,{ns:"datasetDocuments",count:M})}`,R=k&&!f||!v,T=N?"hidden group-hover/card:inline-block":"";return(0,s.jsxs)("div",{className:(0,u.cn)("flex flex-col",c||b?"":"opacity-50 group-hover/card:opacity-100",N?"pb-2 pt-1":"grow px-3",k&&f&&"overflow-y-hidden"),children:[k&&(0,s.jsx)(o.default,{type:"horizontal",className:"my-1 h-px bg-divider-subtle"}),(0,s.jsxs)("div",{className:(0,u.cn)("flex items-center justify-between",k&&"sticky -top-2 left-0 bg-background-default pb-3 pt-2"),children:[(0,s.jsxs)("div",{className:(0,u.cn)("flex h-7 items-center rounded-lg pl-1 pr-3",N&&"cursor-pointer",N&&v&&"bg-dataset-child-chunk-expand-btn-bg",k&&"pl-0"),onClick:e=>{e.stopPropagation(),w(e=>!e)},children:[(()=>{if(!N)return null;let e=v?a.RiArrowRightSLine:a.RiArrowDownSLine;return(0,s.jsx)(e,{className:(0,u.cn)("mr-0.5 h-4 w-4 text-text-secondary",v&&"opacity-50")})})(),(0,s.jsx)("span",{className:"system-sm-semibold-uppercase text-text-secondary",children:I}),(0,s.jsx)("span",{className:(0,u.cn)("pl-1.5 text-xs font-medium text-text-quaternary",T),children:"·"}),(0,s.jsx)("button",{type:"button",className:(0,u.cn)("system-xs-semibold-uppercase px-1.5 py-1 text-components-button-secondary-accent-text",T,k&&f&&"text-components-button-secondary-accent-text-disabled"),onClick:e=>{e.stopPropagation(),d?.(n)},disabled:f,children:j("operation.add",{ns:"common"})})]}),k&&(0,s.jsx)(e9.default,{showLeftIcon:!0,showClearIcon:!0,wrapperClassName:"!w-52",value:h,onChange:e=>i?.(e.target.value),onClear:()=>i?.("")})]}),f&&(0,s.jsx)(tg,{}),R&&(0,s.jsxs)("div",{className:(0,u.cn)("flex gap-x-0.5",k?"mb-6 grow":"items-center"),children:[N&&(0,s.jsx)("div",{className:"self-stretch",children:(0,s.jsx)(o.default,{type:"vertical",className:"mx-[7px] w-[2px] bg-text-accent-secondary"})}),t.length>0?(0,s.jsx)(tm.FormattedText,{className:(0,u.cn)("flex w-full flex-col !leading-6",N?"gap-y-2":"gap-y-3"),children:t.map(e=>{let t=e.updated_at!==e.created_at,a=C?.childChunkInfo?.id===e.id,n=t?`C-${e.position} \xb7 ${j("segment.edited",{ns:"datasetDocuments"})}`:`C-${e.position}`;return(0,s.jsx)(tc,{label:n,text:e.content,onDelete:()=>m?.(e.segment_id,e.id),className:"child-chunk",labelClassName:a?"bg-state-accent-solid text-text-primary-on-surface":"",labelInnerClassName:"text-[10px] font-semibold align-bottom leading-6",contentClassName:(0,u.cn)("!leading-6",a?"bg-state-accent-hover-alt text-text-primary":"text-text-secondary"),showDivider:!1,onClick:t=>{t.stopPropagation(),x?.(e)},offsetOptions:e=>{let{rects:t}=e;return{mainAxis:k?-t.floating.width:12-t.floating.width,crossAxis:(20-t.floating.height)/2}}},e.id)})}):""!==h?(0,s.jsx)("div",{className:"h-full w-full",children:(0,s.jsx)(tp,{onClearFilter:g})}):null]})]})};var tb=e.i(83278),tj=e.i(547105),ty=e.i(260484),tC=e.i(505659),tv=e.i(19348),tw=e.i(577507),tN=e.i(465497);let tk=()=>{let{t:e}=(0,r.useTranslation)();return(0,s.jsxs)("div",{"data-testid":"parent-chunk-card-skeleton",className:"flex flex-col pb-2",children:[(0,s.jsx)(tN.SkeletonContainer,{className:"gap-y-0 p-1 pb-0",children:(0,s.jsxs)(tN.SkeletonContainer,{className:"gap-y-0.5 px-2 pt-1.5",children:[(0,s.jsxs)(tN.SkeletonRow,{className:"py-0.5",children:[(0,s.jsx)(tN.SkeletonRectangle,{className:"w-[72px] bg-text-quaternary"}),(0,s.jsx)(tN.SkeletonPoint,{className:"opacity-20"}),(0,s.jsx)(tN.SkeletonRectangle,{className:"w-24 bg-text-quaternary"}),(0,s.jsx)(tN.SkeletonPoint,{className:"opacity-20"}),(0,s.jsx)(tN.SkeletonRectangle,{className:"w-24 bg-text-quaternary"})]}),(0,s.jsx)(tN.SkeletonRow,{className:"py-0.5",children:(0,s.jsx)(tN.SkeletonRectangle,{className:"w-full bg-text-quaternary"})}),(0,s.jsx)(tN.SkeletonRow,{className:"py-0.5",children:(0,s.jsx)(tN.SkeletonRectangle,{className:"w-full bg-text-quaternary"})}),(0,s.jsx)(tN.SkeletonRow,{className:"py-0.5",children:(0,s.jsx)(tN.SkeletonRectangle,{className:"w-2/3 bg-text-quaternary"})})]})}),(0,s.jsx)("div",{className:"mt-0.5 flex items-center px-3",children:(0,s.jsx)("button",{type:"button",className:"system-xs-semibold-uppercase pt-0.5 text-components-button-secondary-accent-text-disabled",disabled:!0,children:e("operation.viewMore",{ns:"common"})})})]})};tk.displayName="ParentChunkCardSkelton";let tS=l.memo(tk),tD=e=>e.isCollapsed,tM=l.memo(e=>{let{detail:t,isFullDocMode:a,className:n}=e,{answer:l,content:r,sign_content:o}=t,i=ew(tD);return l?(0,s.jsxs)("div",{className:n,children:[(0,s.jsxs)("div",{className:"flex gap-x-1",children:[(0,s.jsx)("div",{className:"w-4 shrink-0 text-[13px] font-medium leading-[20px] text-text-tertiary",children:"Q"}),(0,s.jsx)(eR.Markdown,{className:(0,u.cn)("body-md-regular text-text-secondary",i?"line-clamp-2":"line-clamp-20"),content:r,customDisallowedElements:["input"]})]}),(0,s.jsxs)("div",{className:"flex gap-x-1",children:[(0,s.jsx)("div",{className:"w-4 shrink-0 text-[13px] font-medium leading-[20px] text-text-tertiary",children:"A"}),(0,s.jsx)(eR.Markdown,{className:(0,u.cn)("body-md-regular text-text-secondary",i?"line-clamp-2":"line-clamp-20"),content:l,customDisallowedElements:["input"]})]})]}):(0,s.jsx)(eR.Markdown,{className:(0,u.cn)("!mt-0.5 !text-text-secondary",a?"line-clamp-3":i?"line-clamp-2":"line-clamp-20",n),content:o||r||"",customDisallowedElements:["input"]})}),t_=l.memo(e=>{let{detail:t={status:""},onClick:n,onChangeSwitch:i,onDelete:d,onDeleteChildChunk:c,handleAddNewChildChunk:m,onClickSlice:x,onClickEdit:p,loading:h=!0,className:g="",archived:f,embeddingAvailable:b,focused:y}=e,{t:C}=(0,r.useTranslation)(),{id:v,position:w,enabled:N,content:k,sign_content:S,word_count:D,hit_count:M,answer:_,summary:R,keywords:T,child_chunks:L=[],created_at:E,updated_at:A,attachments:$=[]}=t,[P,z]=(0,l.useState)(!1),q=(0,en.useDocumentContext)(e=>e.docForm),O=(0,en.useDocumentContext)(e=>e.parentMode),U=(0,l.useMemo)(()=>q===I.ChunkingMode.text,[q]),B=(0,l.useMemo)(()=>q===I.ChunkingMode.parentChild,[q]),K=(0,l.useMemo)(()=>q===I.ChunkingMode.parentChild&&"paragraph"===O,[q,O]),V=(0,l.useMemo)(()=>q===I.ChunkingMode.parentChild&&"full-doc"===O,[q,O]),H=(0,l.useMemo)(()=>(q!==I.ChunkingMode.parentChild||"full-doc"!==O)&&(0,eK.isAfter)(1e3*A,1e3*E),[q,O,A,E]),Q=(0,l.useMemo)(()=>N||y.segmentContent?"":"opacity-50 group-hover/card:opacity-100",[N,y.segmentContent]),W=(0,l.useCallback)(()=>{(q!==I.ChunkingMode.parentChild||"full-doc"!==O)&&n?.()},[q,O,n]),G=(0,l.useMemo)(()=>{let e=(0,ey.formatNumber)(D);return`${e} ${C("segment.characters",{ns:"datasetDocuments",count:D})}`},[D,C]),Y=(0,l.useMemo)(()=>B?C("segment.parentChunk",{ns:"datasetDocuments"}):C("segment.chunk",{ns:"datasetDocuments"}),[B,C]),Z=(0,l.useMemo)(()=>$.map(e=>({name:e.name,mimeType:e.mime_type,sourceUrl:e.source_url,size:e.size,extension:e.extension})),[$]);return h?(0,s.jsx)(tS,{}):(0,s.jsxs)("div",{"data-testid":"segment-card",className:(0,u.cn)("chunk-card group/card w-full rounded-xl px-3",V?"":"pb-2 pt-2.5 hover:bg-dataset-chunk-detail-card-hover-bg",y.segmentContent?"bg-dataset-chunk-detail-card-hover-bg":"",g),onClick:W,children:[(0,s.jsx)("div",{className:"relative flex h-5 items-center justify-between",children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)(eO.SegmentIndexTag,{className:(0,u.cn)(Q),iconClassName:y.segmentIndex?"text-text-accent":"",labelClassName:y.segmentIndex?"text-text-accent":"",positionId:w,label:V?Y:"",labelPrefix:Y}),(0,s.jsx)(e$.default,{}),(0,s.jsx)("div",{className:(0,u.cn)("system-xs-medium text-text-tertiary",Q),children:G}),(0,s.jsx)(e$.default,{}),(0,s.jsx)("div",{className:(0,u.cn)("system-xs-medium text-text-tertiary",Q),children:`${(0,ey.formatNumber)(M)} ${C("segment.hitCount",{ns:"datasetDocuments"})}`}),H&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e$.default,{}),(0,s.jsx)(tb.default,{text:C("segment.edited",{ns:"datasetDocuments"}),uppercase:!0,className:Q})]})]}),V?null:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(F.default,{status:N?"enabled":"disabled",reverse:!0,textCls:"text-text-tertiary system-xs-regular"}),b&&(0,s.jsxs)("div",{className:"absolute -right-2.5 -top-2 z-20 hidden items-center gap-x-0.5 rounded-[10px] border-[0.5px] border-components-actionbar-border bg-components-actionbar-bg p-1 shadow-md backdrop-blur-[5px] group-hover/card:flex",children:[!f&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(j.default,{popupContent:"Edit",popupClassName:"text-text-secondary system-xs-medium",children:(0,s.jsx)("div",{"data-testid":"segment-edit-button",className:"flex h-6 w-6 shrink-0 cursor-pointer items-center justify-center rounded-lg hover:bg-state-base-hover",onClick:e=>{e.stopPropagation(),p?.()},children:(0,s.jsx)(a.RiEditLine,{className:"h-4 w-4 text-text-tertiary"})})}),(0,s.jsx)(j.default,{popupContent:"Delete",popupClassName:"text-text-secondary system-xs-medium",children:(0,s.jsx)("div",{"data-testid":"segment-delete-button",className:"group/delete flex h-6 w-6 shrink-0 cursor-pointer items-center justify-center rounded-lg hover:bg-state-destructive-hover",onClick:e=>{e.stopPropagation(),z(!0)},children:(0,s.jsx)(a.RiDeleteBinLine,{className:"h-4 w-4 text-text-tertiary group-hover/delete:text-text-destructive"})})}),(0,s.jsx)(o.default,{type:"vertical",className:"h-3.5 bg-divider-regular"})]}),(0,s.jsx)("div",{onClick:e=>e.stopPropagation(),className:"flex items-center",children:(0,s.jsx)(ty.default,{size:"md",disabled:f||t?.status!=="completed",defaultValue:N,onChange:async e=>{await i?.(e,v)}})})]})]})]})}),(0,s.jsx)(tM,{detail:{answer:_,content:k,sign_content:S},isFullDocMode:V,className:Q}),Z.length>0&&(0,s.jsx)(tC.default,{images:Z,size:"md",className:"py-1"}),R&&(0,s.jsx)(tv.default,{summary:R,className:"mt-2"}),U&&(0,s.jsx)("div",{className:(0,u.cn)("flex flex-wrap items-center gap-2 py-1.5",Q),children:T?.map(e=>(0,s.jsx)(tw.default,{text:e},e))}),V?(0,s.jsx)("button",{type:"button",className:"system-xs-semibold-uppercase mb-2 mt-0.5 text-text-accent",onClick:()=>n?.(),children:C("operation.viewMore",{ns:"common"})}):null,K&&L.length>0&&(0,s.jsx)(tf,{parentChunkId:v,childChunks:L,enabled:N,onDelete:c,handleAddNewChildChunk:m,onClickSlice:x,focused:y.segmentContent}),P&&(0,s.jsx)(tj.default,{isShow:P,title:C("segment.delete",{ns:"datasetDocuments"}),confirmText:C("operation.sure",{ns:"common"}),onConfirm:async()=>{await d?.(v)},onCancel:()=>z(!1)})]})});var tI=e.i(948105);let tR=l.memo(()=>(0,s.jsxs)(tN.SkeletonContainer,{className:"gap-y-0 p-1 pb-2",children:[(0,s.jsxs)(tN.SkeletonContainer,{className:"gap-y-0.5 px-2 pt-1.5",children:[(0,s.jsxs)(tN.SkeletonRow,{className:"py-0.5",children:[(0,s.jsx)(tN.SkeletonRectangle,{className:"w-[72px] bg-text-quaternary"}),(0,s.jsx)(tN.SkeletonPoint,{className:"opacity-20"}),(0,s.jsx)(tN.SkeletonRectangle,{className:"w-24 bg-text-quaternary"}),(0,s.jsx)(tN.SkeletonPoint,{className:"opacity-20"}),(0,s.jsx)(tN.SkeletonRectangle,{className:"w-24 bg-text-quaternary"}),(0,s.jsxs)(tN.SkeletonRow,{className:"grow justify-end gap-1",children:[(0,s.jsx)(tN.SkeletonRectangle,{className:"w-12 bg-text-quaternary"}),(0,s.jsx)(tN.SkeletonRectangle,{className:"mx-1 w-2 bg-text-quaternary"})]})]}),(0,s.jsx)(tN.SkeletonRow,{className:"py-0.5",children:(0,s.jsx)(tN.SkeletonRectangle,{className:"w-full bg-text-quaternary"})}),(0,s.jsx)(tN.SkeletonRow,{className:"py-0.5",children:(0,s.jsx)(tN.SkeletonRectangle,{className:"w-full bg-text-quaternary"})}),(0,s.jsx)(tN.SkeletonRow,{className:"py-0.5",children:(0,s.jsx)(tN.SkeletonRectangle,{className:"w-2/3 bg-text-quaternary"})})]}),(0,s.jsx)(tN.SkeletonContainer,{className:"p-1 pb-2",children:(0,s.jsx)(tN.SkeletonRow,{children:(0,s.jsxs)(tN.SkeletonRow,{className:"h-7 gap-x-0.5 rounded-lg bg-dataset-child-chunk-expand-btn-bg pl-1 pr-3",children:[(0,s.jsx)(a.RiArrowRightSLine,{className:"h-4 w-4 text-text-secondary opacity-20"}),(0,s.jsx)(tN.SkeletonRectangle,{className:"w-32 bg-text-quaternary"})]})})})]}));tR.displayName="CardSkelton";let tT=l.memo(()=>(0,s.jsxs)("div",{className:"relative z-10 flex h-full flex-col overflow-y-hidden",children:[(0,s.jsx)("div",{className:"absolute left-0 top-0 z-20 h-full w-full bg-dataset-chunk-list-mask-bg"}),Array.from({length:10}).map((e,t)=>(0,s.jsxs)("div",{className:"flex items-start gap-x-2",children:[(0,s.jsx)(e_.default,{className:"mt-3.5 shrink-0",disabled:!0},`${t}-checkbox`),(0,s.jsxs)("div",{className:"grow",children:[(0,s.jsx)(tR,{}),9!==t&&(0,s.jsx)("div",{className:"w-full px-3",children:(0,s.jsx)(o.default,{type:"horizontal",className:"my-1 bg-divider-subtle"})})]})]},t))]})),tL=e=>{let{ref:t,isLoading:a,items:n,selectedSegmentIds:r,onSelected:i,onClick:d,onChangeSwitch:c,onDelete:m,onDeleteChildChunk:u,handleAddNewChildChunk:x,onClickSlice:p,archived:h,embeddingAvailable:g,onClearFilter:f}=e,b=(0,en.useDocumentContext)(e=>e.docForm),j=(0,en.useDocumentContext)(e=>e.parentMode),y=ew(e=>e.currSegment),C=ew(e=>e.currChildChunk),v=(0,l.useMemo)(()=>b===I.ChunkingMode.parentChild&&"paragraph"===j?tT:tI.default,[b,j]);return a?(0,s.jsx)(v,{}):0===n.length?(0,s.jsx)("div",{className:"h-full pl-6",children:(0,s.jsx)(tp,{onClearFilter:f})}):(0,s.jsx)("div",{ref:t,className:"flex grow flex-col overflow-y-auto",children:n.map(e=>{let t=n[n.length-1].id===e.id,a=y?.segInfo?.id===e.id||!y&&C?.childChunkInfo?.segment_id===e.id,l=y?.segInfo?.id===e.id||C?.childChunkInfo?.segment_id===e.id;return(0,s.jsxs)("div",{className:"flex items-start gap-x-2",children:[(0,s.jsx)(e_.default,{className:"mt-3.5 shrink-0",checked:r.includes(e.id),onCheck:()=>i(e.id)},`${e.id}-checkbox`),(0,s.jsxs)("div",{className:"min-w-0 grow",children:[(0,s.jsx)(t_,{detail:e,onClick:()=>d(e,!0),onChangeSwitch:c,onClickEdit:()=>d(e,!0),onDelete:m,onDeleteChildChunk:u,handleAddNewChildChunk:x,onClickSlice:p,loading:!1,archived:h,embeddingAvailable:g,focused:{segmentIndex:a,segmentContent:l}},`${e.id}-card`),!t&&(0,s.jsx)("div",{className:"w-full px-3",children:(0,s.jsx)(o.default,{type:"horizontal",className:"my-1 bg-divider-subtle"})})]})]},e.id)})})};tL.displayName="SegmentList";let tE=e=>{let{segments:t,childSegments:a,isLoadingSegmentList:n,isLoadingChildSegmentList:l,currSegmentId:r,onClickCard:o,onDeleteChildChunk:i,handleInputChange:d,handleAddNewChildChunk:c,onClickSlice:m,archived:x,childChunkTotal:p,inputValue:h,onClearFilter:g}=e,f=t[0];return(0,s.jsxs)("div",{className:(0,u.cn)("flex grow flex-col overflow-x-hidden",n||l?"overflow-y-hidden":"overflow-y-auto"),children:[(0,s.jsx)(t_,{detail:f,onClick:()=>o(f),loading:n,focused:{segmentIndex:r===f?.id,segmentContent:r===f?.id}}),(0,s.jsx)(tf,{parentChunkId:f?.id,onDelete:i,childChunks:a,handleInputChange:d,handleAddNewChildChunk:c,onClickSlice:m,enabled:!x,total:p,inputValue:h,onClearFilter:g,isLoading:n||l})]})},tF=e=>{let{segmentListRef:t,embeddingAvailable:a,isLoadingSegmentList:n,segments:l,selectedSegmentIds:r,onSelected:o,onChangeSwitch:i,onDelete:d,onClickCard:c,archived:m,onDeleteChildChunk:u,handleAddNewChildChunk:x,onClickSlice:p,onClearFilter:h}=e;return(0,s.jsx)(tL,{ref:t,embeddingAvailable:a,isLoading:n,items:l,selectedSegmentIds:r,onSelected:o,onChangeSwitch:i,onDelete:d,onClick:c,archived:m,onDeleteChildChunk:u,handleAddNewChildChunk:x,onClickSlice:p,onClearFilter:h})};var tA=e.i(214309),t$=e.i(38532),tP=e.i(417944),tz=e.i(863085),tq=e.i(964596),tO=e.i(878038),tU=e.i(342687),tB=e.i(56971),tK=((t={}).WAITING="waiting",t.PROCESSING="processing",t.COMPLETED="completed",t.ERROR="error",t);let tV=l.memo(e=>{let{importStatus:t,clearProcessStatus:n,showNewSegmentModal:o,showBatchModal:i,embedding:d}=e,{t:c}=(0,r.useTranslation)(),[m,{setTrue:x,setFalse:p}]=(0,tP.useBoolean)(!1),{plan:h,enableBilling:g}=(0,tB.useProviderContext)(),{type:f}=h,b=!g||f!==tU.Plan.sandbox,j=(0,l.useCallback)(e=>()=>{b?e():x()},[b,x]),y=(0,l.useMemo)(()=>d?"text-components-button-secondary-accent-text-disabled":"text-components-button-secondary-accent-text",[d]);return t?(0,s.jsxs)(s.Fragment,{children:[("waiting"===t||"processing"===t)&&(0,s.jsxs)("div",{className:"relative mr-2 inline-flex items-center overflow-hidden rounded-lg border-[0.5px] border-components-progress-bar-border bg-components-progress-bar-border px-2.5 py-2 text-components-button-secondary-accent-text shadow-xs shadow-shadow-shadow-3 backdrop-blur-[5px]",children:[(0,s.jsx)("div",{className:(0,u.cn)("absolute left-0 top-0 z-0 h-full border-r-[1.5px] border-r-components-progress-bar-progress-highlight bg-components-progress-bar-progress","waiting"===t?"w-3/12":"w-2/3")}),(0,s.jsx)(a.RiLoader2Line,{className:"mr-1 h-4 w-4 animate-spin"}),(0,s.jsx)("span",{className:"system-sm-medium z-10 pr-0.5",children:c("list.batchModal.processing",{ns:"datasetDocuments"})})]}),"completed"===t&&(0,s.jsxs)("div",{className:"relative mr-2 inline-flex items-center overflow-hidden rounded-lg border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-xs shadow-shadow-shadow-3 backdrop-blur-[5px]",children:[(0,s.jsxs)("div",{className:"inline-flex items-center border-r border-r-divider-subtle px-2.5 py-2 text-text-success",children:[(0,s.jsx)(tz.CheckCircle,{className:"mr-1 h-4 w-4"}),(0,s.jsx)("span",{className:"system-sm-medium pr-0.5",children:c("list.batchModal.completed",{ns:"datasetDocuments"})})]}),(0,s.jsx)("div",{className:"m-1 inline-flex items-center",children:(0,s.jsx)("span",{className:"system-xs-medium cursor-pointer rounded-md px-1.5 py-1 text-components-button-ghost-text hover:bg-components-button-ghost-bg-hover",onClick:n,children:c("list.batchModal.ok",{ns:"datasetDocuments"})})}),(0,s.jsx)("div",{className:"absolute left-0 top-0 -z-10 h-full w-full bg-dataset-chunk-process-success-bg opacity-40"})]}),"error"===t&&(0,s.jsxs)("div",{className:"relative mr-2 inline-flex items-center overflow-hidden rounded-lg border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-xs shadow-shadow-shadow-3 backdrop-blur-[5px]",children:[(0,s.jsxs)("div",{className:"inline-flex items-center border-r border-r-divider-subtle px-2.5 py-2 text-text-destructive",children:[(0,s.jsx)(a.RiErrorWarningFill,{className:"mr-1 h-4 w-4"}),(0,s.jsx)("span",{className:"system-sm-medium pr-0.5",children:c("list.batchModal.error",{ns:"datasetDocuments"})})]}),(0,s.jsx)("div",{className:"m-1 inline-flex items-center",children:(0,s.jsx)("span",{className:"system-xs-medium cursor-pointer rounded-md px-1.5 py-1 text-components-button-ghost-text hover:bg-components-button-ghost-bg-hover",onClick:n,children:c("list.batchModal.ok",{ns:"datasetDocuments"})})}),(0,s.jsx)("div",{className:"absolute left-0 top-0 -z-10 h-full w-full bg-dataset-chunk-process-error-bg opacity-40"})]})]}):(0,s.jsxs)("div",{className:(0,u.cn)("relative z-20 flex items-center rounded-lg border-[0.5px] border-components-button-secondary-border bg-components-button-secondary-bg shadow-xs shadow-shadow-shadow-3 backdrop-blur-[5px]",d&&"border-components-button-secondary-border-disabled bg-components-button-secondary-bg-disabled"),children:[(0,s.jsxs)("button",{type:"button",className:`inline-flex items-center rounded-l-lg border-r-[1px] border-r-divider-subtle px-2.5 py-2
          hover:bg-state-base-hover disabled:cursor-not-allowed disabled:hover:bg-transparent`,onClick:j(o),disabled:d,children:[(0,s.jsx)(a.RiAddLine,{className:(0,u.cn)("h-4 w-4",y)}),(0,s.jsx)("span",{className:(0,u.cn)("ml-0.5 px-0.5 text-[13px] font-medium capitalize leading-[16px]",y),children:c("list.action.addButton",{ns:"datasetDocuments"})})]}),(0,s.jsx)(tq.default,{position:"br",manualClose:!0,trigger:"click",htmlContent:(0,s.jsx)("div",{className:"w-full p-1",children:(0,s.jsx)("button",{type:"button",className:"system-md-regular flex w-full items-center rounded-lg px-2 py-1.5 text-text-secondary",onClick:j(i),children:c("list.action.batchAdd",{ns:"datasetDocuments"})})}),btnElement:(0,s.jsx)("div",{className:"flex items-center justify-center",children:(0,s.jsx)(a.RiArrowDownSLine,{className:(0,u.cn)("h-4 w-4",y)})}),btnClassName:e=>(0,u.cn)(`!hover:bg-state-base-hover !rounded-l-none !rounded-r-lg !border-0 !p-2 backdrop-blur-[5px]
          disabled:cursor-not-allowed disabled:bg-transparent disabled:hover:bg-transparent`,e?"!bg-state-base-hover":""),popupClassName:"!min-w-[128px] !bg-components-panel-bg-blur !rounded-xl border-[0.5px] !ring-0 border-components-panel-border !shadow-xl !shadow-shadow-shadow-5 backdrop-blur-[5px]",className:"h-fit min-w-[128px]",disabled:d}),m&&(0,s.jsx)(tO.default,{show:!0,onClose:p,title:c("upgrade.addChunks.title",{ns:"billing"}),description:c("upgrade.addChunks.description",{ns:"billing"})})]})}),tH=e=>{let{embeddingAvailable:t,showNewSegmentModal:a,onNewSegmentModalChange:i,importStatus:d,archived:m}=e,u=(0,en.useDocumentContext)(e=>e.docForm),[x,p]=(0,l.useState)(1),[h,g]=(0,l.useState)(10),f=(e=>{let{t}=(0,r.useTranslation)(),{onPageChange:s}=e,[a,n]=(0,l.useState)(""),[o,i]=(0,l.useState)(""),[d,c]=(0,l.useState)("all"),m=(0,l.useRef)([{value:"all",name:t("list.index.all",{ns:"datasetDocuments"})},{value:0,name:t("list.status.disabled",{ns:"datasetDocuments"})},{value:1,name:t("list.status.enabled",{ns:"datasetDocuments"})}]),{run:u}=(0,t$.useDebounceFn)(()=>{i(a),s(1)},{wait:500}),x=(0,l.useCallback)(e=>{n(e),u()},[u]),p=(0,l.useCallback)(e=>{let{value:t}=e;c("all"===t?"all":!!t),s(1)},[s]),h=(0,l.useCallback)(()=>{n(""),i(""),c("all"),s(1)},[s]),g=(0,l.useCallback)(()=>{s(1)},[s]),f=(0,l.useMemo)(()=>"all"===d?"all":+!!d,[d]);return{inputValue:a,searchValue:o,selectedStatus:d,statusList:m.current,selectDefaultValue:f,handleInputChange:x,onChangeStatus:p,onClearFilter:h,resetPage:g}})({onPageChange:p}),b=(e=>{let{onNewSegmentModalChange:t}=e,[s,a]=(0,l.useState)({showModal:!1}),[n,r]=(0,l.useState)({showModal:!1}),[o,i]=(0,l.useState)(""),[d,c]=(0,l.useState)(!1),[m,u]=(0,l.useState)(!1),[x,p]=(0,l.useState)(!1),[h,g]=(0,l.useState)(!0),f=(0,l.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];a({segInfo:e,showModal:!0,isEditMode:t})},[]),b=(0,l.useCallback)(()=>{a({showModal:!1}),p(!1)},[]),j=(0,l.useCallback)(e=>{r({childChunkInfo:e,showModal:!0}),i(e.segment_id)},[]),y=(0,l.useCallback)(()=>{r({showModal:!1}),p(!1)},[]),C=(0,l.useCallback)(()=>{t(!1),p(!1)},[t]),v=(0,l.useCallback)(e=>{c(!0),i(e)},[]),w=(0,l.useCallback)(()=>{c(!1),p(!1)},[]);return{currSegment:s,onClickCard:f,onCloseSegmentDetail:b,currChildChunk:n,currChunkId:o,onClickSlice:j,onCloseChildSegmentDetail:y,onCloseNewSegmentModal:C,showNewChildSegmentModal:d,handleAddNewChildChunk:v,onCloseNewChildChunkModal:w,isRegenerationModalOpen:m,setIsRegenerationModalOpen:u,fullScreen:x,toggleFullScreen:(0,l.useCallback)(()=>{p(e=>!e)},[]),setFullScreen:p,isCollapsed:h,toggleCollapsed:(0,l.useCallback)(()=>{g(e=>!e)},[])}})({onNewSegmentModalChange:i}),[j,y]=(0,l.useState)([]),C=(0,L.useInvalid)(T.useChunkListAllKey),v=(0,L.useInvalid)(T.useChunkListEnabledKey),w=(0,L.useInvalid)(T.useChunkListDisabledKey),N=(0,l.useCallback)(()=>{({all:()=>{w(),v()},true:()=>{C(),w()},false:()=>{C(),v()}})[String(f.selectedStatus)]?.()},[f.selectedStatus,w,v,C]),k=(e=>{let{searchValue:t,selectedStatus:s,selectedSegmentIds:a,importStatus:o,currentPage:i,limit:d,onCloseSegmentDetail:m,clearSelection:u}=e,{t:x}=(0,r.useTranslation)(),{notify:p}=(0,c.useToastContext)(),h=(0,n.usePathname)(),{eventEmitter:g}=(0,eB.useEventEmitterContextContext)(),f=(0,tA.useQueryClient)(),b=(0,en.useDocumentContext)(e=>e.datasetId)||"",j=(0,en.useDocumentContext)(e=>e.documentId)||"",y=(0,en.useDocumentContext)(e=>e.docForm),C=(0,en.useDocumentContext)(e=>e.parentMode),v=(0,l.useRef)(null),w=(0,l.useRef)(!1),N=(0,l.useMemo)(()=>y===I.ChunkingMode.parentChild&&"full-doc"===C,[y,C]),k=(0,l.useMemo)(()=>({page:N?1:i,limit:N?10:d,keyword:N?"":t,enabled:s}),[N,i,d,t,s]),S=(0,l.useMemo)(()=>[...T.useSegmentListKey,b,j,k],[b,j,k]),{isLoading:D,data:M}=(0,T.useSegmentList)({datasetId:b,documentId:j,params:k}),_=(0,l.useMemo)(()=>M?.data||[],[M]),R=(0,L.useInvalid)(T.useSegmentListKey),E=(0,L.useInvalid)(T.useChunkListAllKey),F=(0,L.useInvalid)(T.useChunkListEnabledKey),A=(0,L.useInvalid)(T.useChunkListDisabledKey);(0,l.useEffect)(()=>{v.current&&w.current&&(v.current.scrollTo({top:v.current.scrollHeight,behavior:"smooth"}),w.current=!1)},[_]),(0,l.useEffect)(()=>{u(),R()},[h]),(0,l.useEffect)(()=>{o===tK.COMPLETED&&(u(),R())},[o]);let $=(0,l.useCallback)(()=>{u(),R()},[u,R]),P=(0,l.useCallback)(()=>{"all"===s?(A(),F()):R()},[s,A,F,R]),z=(0,l.useCallback)(()=>{({all:()=>{A(),F()},true:()=>{E(),A()},false:()=>{E(),F()}})[String(s)]?.()},[s,A,F,E]),q=(0,l.useCallback)((e,t)=>{f.setQueryData(S,s=>s?{...s,data:s.data.map(s=>s.id===e?t(s):s)}:s)},[f,S]),O=(0,l.useCallback)((e,t)=>{f.setQueryData(S,s=>s?{...s,data:s.data.map(s=>e.includes(s.id)?t(s):s)}:s)},[f,S]),{mutateAsync:U}=(0,T.useEnableSegment)(),{mutateAsync:B}=(0,T.useDisableSegment)(),{mutateAsync:K}=(0,T.useDeleteSegment)(),{mutateAsync:V}=(0,T.useUpdateSegment)(),H=(0,l.useCallback)(async(e,t)=>{let s=e?U:B,n=t?[t]:a;await s({datasetId:b,documentId:j,segmentIds:n},{onSuccess:()=>{p({type:"success",message:x("actionMsg.modifiedSuccessfully",{ns:"common"})}),O(n,t=>({...t,enabled:e})),P()},onError:()=>{p({type:"error",message:x("actionMsg.modifiedUnsuccessfully",{ns:"common"})})}})},[b,j,a,B,U,x,p,O,P]),Q=(0,l.useCallback)(async e=>{let t=e?[e]:a;await K({datasetId:b,documentId:j,segmentIds:t},{onSuccess:()=>{p({type:"success",message:x("actionMsg.modifiedSuccessfully",{ns:"common"})}),$(),e||u()},onError:()=>{p({type:"error",message:x("actionMsg.modifiedUnsuccessfully",{ns:"common"})})}})},[b,j,a,K,$,u,x,p]),W=(0,l.useCallback)(async function(e,t,s,a,n,l){let r=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o={content:"",attachment_ids:[]};if(y===I.ChunkingMode.qa){if(!t.trim())return void p({type:"error",message:x("segment.questionEmpty",{ns:"datasetDocuments"})});if(!s.trim())return void p({type:"error",message:x("segment.answerEmpty",{ns:"datasetDocuments"})});o.content=t,o.answer=s}else{if(!t.trim())return void p({type:"error",message:x("segment.contentEmpty",{ns:"datasetDocuments"})});o.content=t}if(a.length&&(o.keywords=a),n.length){if(n.some(e=>!e.uploadedId))return void p({type:"error",message:x("segment.allFilesUploaded",{ns:"datasetDocuments"})});o.attachment_ids=n.map(e=>e.uploadedId)}o.summary=l??"",r&&(o.regenerate_child_chunks=r),g?.emit("update-segment"),await V({datasetId:b,documentId:j,segmentId:e,body:o},{onSuccess(t){p({type:"success",message:x("actionMsg.modifiedSuccessfully",{ns:"common"})}),r||m(),q(e,e=>({...e,answer:t.data.answer,content:t.data.content,sign_content:t.data.sign_content,keywords:t.data.keywords,attachments:t.data.attachments,summary:t.data.summary,word_count:t.data.word_count,hit_count:t.data.hit_count,enabled:t.data.enabled,updated_at:t.data.updated_at,child_chunks:t.data.child_chunks})),z(),g?.emit("update-segment-success")},onSettled(){g?.emit("update-segment-done")}})},[b,j,y,V,p,g,m,q,z,x]),G=(0,l.useCallback)(()=>{let e=M?.total_pages||0,t=Math.ceil(((M?.total||0)+1)/d);w.current=!0,t>e||$()},[M,d,$]),Y=(0,l.useMemo)(()=>{if(""===t&&"all"===s){let e=M?.total?(0,ey.formatNumber)(M.total):"--",t="--"===e?0:M.total,s=y===I.ChunkingMode.parentChild&&"paragraph"===C?"segment.parentChunks":"segment.chunks";return`${e} ${x(s,{ns:"datasetDocuments",count:t})}`}let e="number"==typeof M?.total?(0,ey.formatNumber)(M.total):0,a=M?.total||0;return`${e} ${x("segment.searchResults",{ns:"datasetDocuments",count:a})}`},[M,y,C,t,s,x]);return{segments:_,isLoadingSegmentList:D,segmentListData:M,totalText:Y,isFullDocMode:N,segmentListRef:v,needScrollToBottom:w,onChangeSwitch:H,onDelete:Q,handleUpdateSegment:W,resetList:$,viewNewlyAddedChunk:G,invalidSegmentList:R,updateSegmentInCache:q}})({searchValue:f.searchValue,selectedStatus:f.selectedStatus,selectedSegmentIds:j,importStatus:d,currentPage:x,limit:h,onCloseSegmentDetail:b.onCloseSegmentDetail,clearSelection:()=>y([])}),S=(e=>{let[t,s]=(0,l.useState)([]),a=(0,l.useCallback)(e=>{s(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},[]),n=(0,l.useMemo)(()=>e.length>0&&e.every(e=>t.includes(e.id)),[e,t]),r=(0,l.useMemo)(()=>e.some(e=>t.includes(e.id)),[e,t]),o=(0,l.useCallback)(()=>{s(t=>{let s=e.map(e=>e.id);return[...t.filter(e=>!s.includes(e)),...n?[]:s]})},[e,n]);return{selectedSegmentIds:t,isAllSelected:n,isSomeSelected:r,onSelected:a,onSelectedAll:o,onCancelBatchOperation:(0,l.useCallback)(()=>{s([])},[]),clearSelection:(0,l.useCallback)(()=>{s([])},[])}})(k.segments);(0,l.useMemo)(()=>{y(S.selectedSegmentIds)},[S.selectedSegmentIds]);let D=(e=>{let{searchValue:t,currentPage:s,limit:a,segments:n,currChunkId:o,isFullDocMode:i,onCloseChildSegmentDetail:d,refreshChunkListDataWithDetailChanged:m,updateSegmentInCache:u}=e,{t:x}=(0,r.useTranslation)(),{notify:p}=(0,c.useToastContext)(),{eventEmitter:h}=(0,eB.useEventEmitterContextContext)(),g=(0,tA.useQueryClient)(),f=(0,en.useDocumentContext)(e=>e.datasetId)||"",b=(0,en.useDocumentContext)(e=>e.documentId)||"",j=(0,en.useDocumentContext)(e=>e.parentMode),y=(0,l.useRef)(null),C=(0,l.useRef)(!1),v=(0,l.useMemo)(()=>({page:0===s?1:s,limit:a,keyword:t}),[s,a,t]),w=n[0]?.id||"",N=(0,l.useMemo)(()=>[...T.useChildSegmentListKey,f,b,w,v],[f,b,w,v]),{isLoading:k,data:S}=(0,T.useChildSegmentList)({datasetId:f,documentId:b,segmentId:w,params:v},!i||0===n.length),D=(0,l.useMemo)(()=>S?.data||[],[S]),M=(0,L.useInvalid)(T.useChildSegmentListKey);(0,l.useEffect)(()=>{y.current&&C.current&&(y.current.scrollTo({top:y.current.scrollHeight,behavior:"smooth"}),C.current=!1)},[D]);let _=(0,l.useCallback)(()=>{M()},[M]),I=(0,l.useCallback)((e,t)=>{g.setQueryData(N,s=>s?{...s,data:s.data.map(s=>s.id===e?t(s):s)}:s)},[g,N]),{mutateAsync:R}=(0,T.useDeleteChildSegment)(),{mutateAsync:E}=(0,T.useUpdateChildSegment)(),F=(0,l.useCallback)(async(e,t)=>{await R({datasetId:f,documentId:b,segmentId:e,childChunkId:t},{onSuccess:()=>{p({type:"success",message:x("actionMsg.modifiedSuccessfully",{ns:"common"})}),"paragraph"===j?u(e,e=>({...e,child_chunks:e.child_chunks?.filter(e=>e.id!==t)})):_()},onError:()=>{p({type:"error",message:x("actionMsg.modifiedUnsuccessfully",{ns:"common"})})}})},[f,b,j,R,u,_,x,p]),A=(0,l.useCallback)(async(e,t,s)=>{let a={content:""};s.trim()?(a.content=s,h?.emit("update-child-segment"),await E({datasetId:f,documentId:b,segmentId:e,childChunkId:t,body:a},{onSuccess:s=>{p({type:"success",message:x("actionMsg.modifiedSuccessfully",{ns:"common"})}),d(),"paragraph"===j?(u(e,e=>({...e,child_chunks:e.child_chunks?.map(e=>e.id===t?{...e,content:s.data.content,type:s.data.type,word_count:s.data.word_count,updated_at:s.data.updated_at}:e)})),m()):I(t,e=>({...e,content:s.data.content,type:s.data.type,word_count:s.data.word_count,updated_at:s.data.updated_at}))},onSettled:()=>{h?.emit("update-child-segment-done")}})):p({type:"error",message:x("segment.contentEmpty",{ns:"datasetDocuments"})})},[f,b,j,E,p,h,d,u,I,m,x]),$=(0,l.useCallback)(e=>{"paragraph"===j?(u(o,t=>({...t,child_chunks:[...t.child_chunks||[],e]})),m()):_()},[j,o,u,m,_]),P=(0,l.useCallback)(()=>{let e=S?.total_pages||0,t=Math.ceil(((S?.total||0)+1)/a);C.current=!0,t>e||_()},[S,a,_]);return{childSegments:D,isLoadingChildSegmentList:k,childChunkListData:S,childSegmentListRef:y,needScrollToBottom:C,onDeleteChildChunk:F,handleUpdateChildChunk:A,onSaveNewChildChunk:$,resetChildList:_,viewNewlyAddedChildChunk:P}})({searchValue:f.searchValue,currentPage:x,limit:h,segments:k.segments,currChunkId:b.currChunkId,isFullDocMode:k.isFullDocMode,onCloseChildSegmentDetail:b.onCloseChildSegmentDetail,refreshChunkListDataWithDetailChanged:N,updateSegmentInCache:k.updateSegmentInCache}),M=(0,l.useMemo)(()=>k.isFullDocMode?D.childChunkListData?.total||0:k.segmentListData?.total||0,[k.isFullDocMode,D.childChunkListData,k.segmentListData]),_=(0,l.useCallback)(e=>{p(e+1)},[]),R=(0,l.useMemo)(()=>({isCollapsed:b.isCollapsed,fullScreen:b.fullScreen,toggleFullScreen:b.toggleFullScreen,currSegment:b.currSegment,currChildChunk:b.currChildChunk}),[b.isCollapsed,b.fullScreen,b.toggleFullScreen,b.currSegment,b.currChildChunk]);return(0,s.jsxs)(ev.Provider,{value:R,children:[!k.isFullDocMode&&(0,s.jsx)(ta,{isAllSelected:S.isAllSelected,isSomeSelected:S.isSomeSelected,onSelectedAll:S.onSelectedAll,isLoading:k.isLoadingSegmentList,totalText:k.totalText,statusList:f.statusList,selectDefaultValue:f.selectDefaultValue,onChangeStatus:f.onChangeStatus,inputValue:f.inputValue,onInputChange:f.handleInputChange,isCollapsed:b.isCollapsed,toggleCollapsed:b.toggleCollapsed}),k.isFullDocMode?(0,s.jsx)(tE,{segments:k.segments,childSegments:D.childSegments,isLoadingSegmentList:k.isLoadingSegmentList,isLoadingChildSegmentList:D.isLoadingChildSegmentList,currSegmentId:b.currSegment?.segInfo?.id,onClickCard:b.onClickCard,onDeleteChildChunk:D.onDeleteChildChunk,handleInputChange:f.handleInputChange,handleAddNewChildChunk:b.handleAddNewChildChunk,onClickSlice:b.onClickSlice,archived:m,childChunkTotal:D.childChunkListData?.total||0,inputValue:f.inputValue,onClearFilter:f.onClearFilter}):(0,s.jsx)(tF,{segmentListRef:k.segmentListRef,embeddingAvailable:t,isLoadingSegmentList:k.isLoadingSegmentList,segments:k.segments,selectedSegmentIds:S.selectedSegmentIds,onSelected:S.onSelected,onChangeSwitch:k.onChangeSwitch,onDelete:k.onDelete,onClickCard:b.onClickCard,archived:m,onDeleteChildChunk:D.onDeleteChildChunk,handleAddNewChildChunk:b.handleAddNewChildChunk,onClickSlice:b.onClickSlice,onClearFilter:f.onClearFilter}),(0,s.jsx)(o.default,{type:"horizontal",className:"mx-6 my-0 h-px w-auto bg-divider-subtle"}),(0,s.jsx)(ea.default,{current:x-1,onChange:_,total:M,limit:h,onLimitChange:g,className:k.isFullDocMode?"px-3":""}),u&&(0,s.jsx)(e6,{currSegment:b.currSegment,onCloseSegmentDetail:b.onCloseSegmentDetail,onUpdateSegment:k.handleUpdateSegment,isRegenerationModalOpen:b.isRegenerationModalOpen,setIsRegenerationModalOpen:b.setIsRegenerationModalOpen,showNewSegmentModal:a,onCloseNewSegmentModal:b.onCloseNewSegmentModal,onSaveNewSegment:k.resetList,viewNewlyAddedChunk:k.viewNewlyAddedChunk,currChildChunk:b.currChildChunk,currChunkId:b.currChunkId,onCloseChildSegmentDetail:b.onCloseChildSegmentDetail,onUpdateChildChunk:D.handleUpdateChildChunk,showNewChildSegmentModal:b.showNewChildSegmentModal,onCloseNewChildChunkModal:b.onCloseNewChildChunkModal,onSaveNewChildChunk:D.onSaveNewChildChunk,viewNewlyAddedChildChunk:D.viewNewlyAddedChildChunk,fullScreen:b.fullScreen,docForm:u}),S.selectedSegmentIds.length>0&&(0,s.jsx)(el.default,{className:"absolute bottom-16 left-0 z-20",selectedIds:S.selectedSegmentIds,onBatchEnable:()=>k.onChangeSwitch(!0,""),onBatchDisable:()=>k.onChangeSwitch(!1,""),onBatchDelete:()=>k.onDelete(""),onCancel:S.onCancelBatchOperation})]})};var tQ=e.i(334163),tW=e.i(684040),tG=e.i(391185),tY=e.i(453284),tZ=e.i(943963),tX=e.i(140655);let tJ=l.memo(e=>{let{datasetId:t,value:n,onChange:o}=e,{t:i}=(0,r.useTranslation)(),{name:c,extension:m,chunkingMode:x,parentMode:p}=n,[h,g]=(0,l.useState)(""),{data:f}=(0,R.useDocumentList)({datasetId:t,query:{keyword:h,page:1,limit:20}}),b=f?.data,j=x===I.ChunkingMode.text,y=x===I.ChunkingMode.parentChild,C=x===I.ChunkingMode.qa,v=y?tW.ParentChildChunk:tQ.GeneralChunk,[w,{set:N,toggle:k}]=(0,tP.useBoolean)(!1),S=a.RiArrowDownSLine,D=(0,l.useCallback)(e=>{let{id:t}=e;o(b?.find(e=>e.id===t)),N(!1)},[b,o,N]),M=(0,l.useMemo)(()=>p?"paragraph"===p?i("parentMode.paragraph",{ns:"dataset"}):i("parentMode.fullDoc",{ns:"dataset"}):"--",[p,i]);return(0,s.jsxs)(tG.PortalToFollowElem,{open:w,onOpenChange:N,placement:"bottom-start",children:[(0,s.jsx)(tG.PortalToFollowElemTrigger,{onClick:k,children:(0,s.jsxs)("div",{className:(0,u.cn)("ml-1 flex cursor-pointer select-none items-center rounded-lg px-2 py-0.5 hover:bg-state-base-hover",w&&"bg-state-base-hover"),children:[(0,s.jsx)(tZ.default,{name:c,extension:m,size:"xl"}),(0,s.jsxs)("div",{className:"ml-1 mr-0.5 flex flex-col items-start",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-0.5",children:[(0,s.jsxs)("span",{className:(0,u.cn)("system-md-semibold text-text-primary"),children:[" ",c||"--"]}),(0,s.jsx)(S,{className:"h-4 w-4 text-text-primary"})]}),(0,s.jsxs)("div",{className:"flex h-3 items-center space-x-0.5 text-text-tertiary",children:[(0,s.jsx)(v,{className:"h-3 w-3"}),(0,s.jsxs)("span",{className:(0,u.cn)("system-2xs-medium-uppercase",y&&"mt-0.5"),children:[j&&i("chunkingMode.general",{ns:"dataset"}),C&&i("chunkingMode.qa",{ns:"dataset"}),y&&`${i("chunkingMode.parentChild",{ns:"dataset"})} \xb7 ${M}`]})]})]})]})}),(0,s.jsx)(tG.PortalToFollowElemContent,{className:"z-[11]",children:(0,s.jsxs)("div",{className:"w-[360px] rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur p-1 pt-2 shadow-lg backdrop-blur-[5px]",children:[(0,s.jsx)(tY.default,{value:h,onChange:g,className:"mx-1"}),b?(0,s.jsx)(tX.default,{className:"mt-2",list:b.map(e=>({id:e.id,name:e.name,extension:e.data_source_detail_dict?.upload_file?.extension||""})),onChange:D}):(0,s.jsx)("div",{className:"mt-2 flex h-[100px] w-[360px] items-center justify-center",children:(0,s.jsx)(d.default,{})})]})})]})}),t0=e=>{let{datasetId:t,extension:a,name:l,chunkingMode:r,parent_mode:o,wrapperCls:i}=e,d=(0,n.useRouter)();return(0,s.jsx)("div",{className:(0,u.cn)("flex flex-1 items-center justify-start",i),children:(0,s.jsx)(tJ,{datasetId:t,value:{name:l,extension:a,chunkingMode:r,parentMode:o||"paragraph"},onChange:e=>{d.push(`/datasets/${t}/documents/${e.id}`)}})})};var t1=e.i(658547),t2=e.i(211857),t4=e.i(225244),t5=e.i(842090),t3=e.i(871182),t6=e.i(552188);let t9=l.memo(()=>(0,s.jsxs)(tN.SkeletonContainer,{className:"gap-y-0 p-1 pb-2",children:[(0,s.jsxs)(tN.SkeletonContainer,{className:"gap-y-0.5 px-2 pt-1.5",children:[(0,s.jsxs)(tN.SkeletonRow,{className:"py-0.5",children:[(0,s.jsx)(tN.SkeletonRectangle,{className:"w-[72px] bg-text-quaternary"}),(0,s.jsx)(tN.SkeletonPoint,{className:"opacity-20"}),(0,s.jsx)(tN.SkeletonRectangle,{className:"w-24 bg-text-quaternary"}),(0,s.jsx)(tN.SkeletonPoint,{className:"opacity-20"}),(0,s.jsx)(tN.SkeletonRectangle,{className:"w-24 bg-text-quaternary"}),(0,s.jsxs)(tN.SkeletonRow,{className:"grow justify-end gap-1",children:[(0,s.jsx)(tN.SkeletonRectangle,{className:"w-12 bg-text-quaternary"}),(0,s.jsx)(tN.SkeletonRectangle,{className:"mx-1 w-2 bg-text-quaternary"})]})]}),(0,s.jsx)(tN.SkeletonRow,{className:"py-0.5",children:(0,s.jsx)(tN.SkeletonRectangle,{className:"w-full bg-text-quaternary"})}),(0,s.jsx)(tN.SkeletonRow,{className:"py-0.5",children:(0,s.jsx)(tN.SkeletonRectangle,{className:"w-full bg-text-quaternary"})}),(0,s.jsx)(tN.SkeletonRow,{className:"py-0.5",children:(0,s.jsx)(tN.SkeletonRectangle,{className:"w-2/3 bg-text-quaternary"})})]}),(0,s.jsx)(tN.SkeletonContainer,{className:"px-2 py-1.5",children:(0,s.jsxs)(tN.SkeletonRow,{children:[(0,s.jsx)(tN.SkeletonRectangle,{className:"w-14 bg-text-quaternary"}),(0,s.jsx)(tN.SkeletonRectangle,{className:"w-[88px] bg-text-quaternary"}),(0,s.jsx)(tN.SkeletonRectangle,{className:"w-14 bg-text-quaternary"})]})})]}));t9.displayName="CardSkelton";let t8=l.memo(()=>(0,s.jsxs)("div",{className:"relative z-10 flex grow flex-col overflow-y-hidden",children:[(0,s.jsx)("div",{className:"absolute left-0 top-0 z-20 h-full w-full bg-dataset-chunk-list-mask-bg"}),Array.from({length:5}).map((e,t)=>(0,s.jsxs)("div",{className:"w-full px-11",children:[(0,s.jsx)(t9,{}),9!==t&&(0,s.jsx)("div",{className:"w-full px-3",children:(0,s.jsx)(o.default,{type:"horizontal",className:"my-1 bg-divider-subtle"})})]},t))]})),t7=l.memo(e=>{let{sourceData:t,indexingType:a,retrievalMethod:n}=e,{t:i}=(0,r.useTranslation)(),d={mode:i("embedding.mode",{ns:"datasetDocuments"}),segmentLength:i("embedding.segmentLength",{ns:"datasetDocuments"}),textCleaning:i("embedding.textCleaning",{ns:"datasetDocuments"})},c=(0,l.useCallback)(e=>{let s="-",a="number"==typeof t?.rules?.segmentation?.max_tokens?t.rules.segmentation.max_tokens:s,n="number"==typeof t?.rules?.subchunk_segmentation?.max_tokens?t.rules.subchunk_segmentation.max_tokens:s;switch(e){case"mode":s=t?.mode?t.mode===I.ProcessMode.general?i("embedding.custom",{ns:"datasetDocuments"}):`${i("embedding.hierarchical",{ns:"datasetDocuments"})} \xb7 ${t?.rules?.parent_mode==="paragraph"?i("parentMode.paragraph",{ns:"dataset"}):i("parentMode.fullDoc",{ns:"dataset"})}`:s;break;case"segmentLength":s=t?.mode?t.mode===I.ProcessMode.general?a:`${i("embedding.parentMaxTokens",{ns:"datasetDocuments"})} ${a}; ${i("embedding.childMaxTokens",{ns:"datasetDocuments"})} ${n}`:s;break;default:s=t?.mode?t?.rules?.pre_processing_rules?.filter(e=>e.enabled).map(e=>{var t;return"remove_extra_spaces"===(t=e.id)?i("stepTwo.removeExtraSpaces",{ns:"datasetCreation"}):"remove_urls_emails"===t?i("stepTwo.removeUrlEmails",{ns:"datasetCreation"}):"remove_stopwords"===t?i("stepTwo.removeStopwords",{ns:"datasetCreation"}):void 0}).join(","):s}return s},[t]);return(0,s.jsxs)("div",{className:"py-3",children:[(0,s.jsx)("div",{className:"flex flex-col gap-y-1",children:Object.keys(d).map(e=>(0,s.jsx)(t6.FieldInfo,{label:d[e],displayedValue:String(c(e))},e))}),(0,s.jsx)(o.default,{type:"horizontal",className:"bg-divider-subtle"}),(0,s.jsx)(t6.FieldInfo,{label:i("stepTwo.indexMode",{ns:"datasetCreation"}),displayedValue:i(`stepTwo.${a===eC.IndexingType.ECONOMICAL?"economical":"qualified"}`,{ns:"datasetCreation"}),valueIcon:(0,s.jsx)(t1.default,{className:"size-4",src:a===eC.IndexingType.ECONOMICAL?t3.indexMethodIcon.economical:t3.indexMethodIcon.high_quality,alt:""})}),(0,s.jsx)(t6.FieldInfo,{label:i("form.retrievalSetting.title",{ns:"datasetSettings"}),displayedValue:i(`retrieval.${a===eC.IndexingType.ECONOMICAL?"keyword_search":n??"semantic_search"}.title`,{ns:"dataset"}),valueIcon:(0,s.jsx)(t1.default,{className:"size-4",src:n===ee.RETRIEVE_METHOD.fullText?t3.retrievalIcon.fullText:n===ee.RETRIEVE_METHOD.hybrid?t3.retrievalIcon.hybrid:t3.retrievalIcon.vector,alt:""})})]})});t7.displayName="RuleDetail";let se=l.memo(e=>{let{datasetId:t,documentId:n,detailUpdate:o,indexingType:i,retrievalMethod:d}=e,{t:m}=(0,r.useTranslation)(),{notify:x}=(0,Q.useContext)(c.ToastContext),p=(0,en.useDocumentContext)(e=>e.datasetId),h=(0,en.useDocumentContext)(e=>e.documentId),g=t??p,f=n??h,[b,j]=(0,l.useState)(null),y=async()=>{let e=await (0,t2.fetchIndexingStatus)({datasetId:g,documentId:f});return j(e),e},C=(0,l.useRef)(!1),v=(0,l.useCallback)(()=>{C.current=!0},[]),w=(0,l.useCallback)(async()=>{if(!C.current)try{let e=await y();if(["completed","error","paused"].includes(e?.indexing_status)){v(),o();return}await (0,t5.sleep)(2500),await w()}catch{await (0,t5.sleep)(2500),await w()}},[v]);(0,l.useEffect)(()=>(C.current=!1,w(),()=>{v()}),[w,v]);let{data:N}=(0,t4.useProcessRule)(f),k=(0,l.useMemo)(()=>["indexing","splitting","parsing","cleaning"].includes(b?.indexing_status||""),[b]),S=(0,l.useMemo)(()=>["completed"].includes(b?.indexing_status||""),[b]),D=(0,l.useMemo)(()=>["paused"].includes(b?.indexing_status||""),[b]),M=(0,l.useMemo)(()=>["error"].includes(b?.indexing_status||""),[b]),_=(0,l.useMemo)(()=>{let e=b?.completed_segments||0,t=b?.total_segments||0;if(0===t)return 0;let s=Math.round(100*e/t);return s>100?100:s},[b]),I=async()=>{let e=k?t2.pauseDocIndexing:t2.resumeDocIndexing,[t]=await (0,t5.asyncRunSafe)(e({datasetId:g,documentId:f}));t?x({type:"error",message:m("actionMsg.modifiedUnsuccessfully",{ns:"common"})}):(x({type:"success",message:m("actionMsg.modifiedSuccessfully",{ns:"common"})}),D&&(C.current=!1,w(),o()),j(null))};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex flex-col gap-y-2 px-16 py-12",children:[(0,s.jsxs)("div",{className:"flex h-6 items-center gap-x-1",children:[k&&(0,s.jsx)(a.RiLoader2Line,{className:"h-4 w-4 animate-spin text-text-secondary"}),(0,s.jsxs)("span",{className:"system-md-semibold-uppercase grow text-text-secondary",children:[k&&m("embedding.processing",{ns:"datasetDocuments"}),S&&m("embedding.completed",{ns:"datasetDocuments"}),D&&m("embedding.paused",{ns:"datasetDocuments"}),M&&m("embedding.error",{ns:"datasetDocuments"})]}),k&&(0,s.jsxs)("button",{type:"button",className:`flex items-center gap-x-1 rounded-md border-[0.5px]
              border-components-button-secondary-border bg-components-button-secondary-bg px-1.5 py-1 shadow-xs shadow-shadow-shadow-3 backdrop-blur-[5px]`,onClick:I,children:[(0,s.jsx)(a.RiPauseCircleLine,{className:"h-3.5 w-3.5 text-components-button-secondary-text"}),(0,s.jsx)("span",{className:"system-xs-medium pr-[3px] text-components-button-secondary-text",children:m("embedding.pause",{ns:"datasetDocuments"})})]}),D&&(0,s.jsxs)("button",{type:"button",className:`flex items-center gap-x-1 rounded-md border-[0.5px]
              border-components-button-secondary-border bg-components-button-secondary-bg px-1.5 py-1 shadow-xs shadow-shadow-shadow-3 backdrop-blur-[5px]`,onClick:I,children:[(0,s.jsx)(a.RiPlayCircleLine,{className:"h-3.5 w-3.5 text-components-button-secondary-text"}),(0,s.jsx)("span",{className:"system-xs-medium pr-[3px] text-components-button-secondary-text",children:m("embedding.resume",{ns:"datasetDocuments"})})]})]}),(0,s.jsx)("div",{className:(0,u.cn)("flex h-2 w-full items-center overflow-hidden rounded-md border border-components-progress-bar-border",k?"bg-components-progress-bar-bg/50":"bg-components-progress-bar-bg"),children:(0,s.jsx)("div",{className:(0,u.cn)("h-full",(k||S)&&"bg-components-progress-bar-progress-solid",(D||M)&&"bg-components-progress-bar-progress-highlight"),style:{width:`${_}%`}})}),(0,s.jsx)("div",{className:"flex w-full items-center",children:(0,s.jsx)("span",{className:"system-xs-medium text-text-secondary",children:`${m("embedding.segments",{ns:"datasetDocuments"})} ${b?.completed_segments||"--"}/${b?.total_segments||"--"} \xb7 ${_}%`})}),(0,s.jsx)(t7,{sourceData:N,indexingType:i,retrievalMethod:d})]}),(0,s.jsx)(t8,{})]})});var st=e.i(29047);e.s(["default",0,e=>{let{datasetId:t,documentId:m}=e,x=(0,n.useRouter)(),{t:h}=(0,r.useTranslation)(),g=(0,_.default)()===_.MediaType.mobile,f=(0,p.useDatasetDetailContextWithSelector)(e=>e.dataset),b=!!f?.embedding_available,[j,y]=(0,l.useState)(!g),[C,v]=(0,l.useState)(!1),[w,N]=(0,l.useState)(!1),[k,S]=(0,l.useState)(),{mutateAsync:D}=(0,T.useCheckSegmentBatchImportProgress)(),A=async e=>{await D({jobID:e},{onSuccess:e=>{S(e.job_status),(e.job_status===tK.WAITING||e.job_status===tK.PROCESSING)&&setTimeout(()=>A(e.job_id),2500),e.job_status===tK.ERROR&&c.default.notify({type:"error",message:`${h("list.batchModal.runError",{ns:"datasetDocuments"})}`})},onError:e=>{let t="message"in e?`: ${e.message}`:"";c.default.notify({type:"error",message:`${h("list.batchModal.runError",{ns:"datasetDocuments"})}${t}`})}})},{mutateAsync:$}=(0,T.useSegmentBatchImport)(),P=async e=>{await $({url:`/datasets/${t}/documents/${m}/segments/batch_import`,body:{upload_file_id:e.file.id}},{onSuccess:e=>{S(e.job_status),A(e.job_id)},onError:e=>{let t="message"in e?`: ${e.message}`:"";c.default.notify({type:"error",message:`${h("list.batchModal.runError",{ns:"datasetDocuments"})}${t}`})}})},{data:z,error:q,refetch:O}=(0,R.useDocumentDetail)({datasetId:t,documentId:m,params:{metadata:"without"}}),{data:U}=(0,R.useDocumentMetadata)({datasetId:t,documentId:m,params:{metadata:"only"}}),B=()=>{let e=new URLSearchParams(window.location.search).toString(),s=`/datasets/${t}/documents${e?"?":""}${e}`;x.push(s)},K=!z&&!q,V=["queuing","indexing","paused"].includes((z?.display_status||"").toLowerCase()),H=(0,l.useMemo)(()=>{if(z?.data_source_info){let e;if((e=z.data_source_info)&&"upload_file"in e)return z.data_source_info.upload_file}},[z?.data_source_info]),Q=(0,L.useInvalid)(T.useSegmentListKey),W=(0,L.useInvalid)(T.useChildSegmentListKey),G=(0,R.useInvalidDocumentList)(t),Y=e=>{G(),"delete"===e?B():(O(),e&&setTimeout(()=>{Q(),W()},5e3))},Z=(0,l.useMemo)(()=>z?.document_process_rule?.rules?.parent_mode||z?.dataset_process_rule?.rules?.parent_mode||"paragraph",[z?.document_process_rule?.rules?.parent_mode,z?.dataset_process_rule?.rules?.parent_mode]),X=(0,l.useMemo)(()=>z?.doc_form===I.ChunkingMode.parentChild&&"full-doc"===Z,[z?.doc_form,Z]);return(0,s.jsx)(en.DocumentContext.Provider,{value:{datasetId:t,documentId:m,docForm:z?.doc_form,parentMode:Z},children:(0,s.jsxs)("div",{className:"flex h-full flex-col bg-background-default",children:[(0,s.jsxs)("div",{className:"flex min-h-16 flex-wrap items-center justify-between border-b border-b-divider-subtle py-2.5 pl-3 pr-4",children:[(0,s.jsx)("div",{onClick:B,className:"flex h-8 w-8 shrink-0 cursor-pointer items-center justify-center rounded-full hover:bg-components-button-tertiary-bg",children:(0,s.jsx)(a.RiArrowLeftLine,{className:"h-4 w-4 text-components-button-ghost-text hover:text-text-tertiary"})}),(0,s.jsx)(t0,{datasetId:t,extension:H?.extension,name:z?.name,wrapperCls:"mr-2",parent_mode:Z,chunkingMode:z?.doc_form}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center",children:[b&&z&&!z.archived&&!X&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(tV,{importStatus:k,clearProcessStatus:()=>S(""),showNewSegmentModal:()=>v(!0),showBatchModal:()=>N(!0),embedding:V}),(0,s.jsx)(o.default,{type:"vertical",className:"!mx-3 !h-[14px] !bg-divider-regular"})]}),(0,s.jsx)(F.default,{status:z?.display_status||"available",scene:"detail",errorMessage:z?.error||"",textCls:"font-semibold text-xs uppercase",detail:{enabled:z?.enabled||!1,archived:z?.archived||!1,id:m},datasetId:t,onUpdate:Y}),(0,s.jsx)(E.default,{scene:"detail",embeddingAvailable:b,detail:{name:z?.name||"",enabled:z?.enabled||!1,archived:z?.archived||!1,id:m,data_source_type:z?.data_source_type||"",doc_form:z?.doc_form||""},datasetId:t,onUpdate:Y,className:"!w-[200px]"}),(0,s.jsx)("button",{type:"button",className:st.default.layoutRightIcon,onClick:()=>y(!j),children:j?(0,s.jsx)(a.RiLayoutLeft2Line,{className:"h-4 w-4 text-components-button-secondary-text"}):(0,s.jsx)(a.RiLayoutRight2Line,{className:"h-4 w-4 text-components-button-secondary-text"})})]})]}),(0,s.jsxs)("div",{className:"flex flex-1 flex-row",style:{height:"calc(100% - 4rem)"},children:[K?(0,s.jsx)(d.default,{type:"app"}):(0,s.jsx)("div",{className:(0,u.cn)("flex h-full min-w-0 grow flex-col",!V&&X&&"relative pl-11 pr-11 pt-4",!V&&!X&&"relative pl-5 pr-11 pt-3"),children:V?(0,s.jsx)(se,{detailUpdate:O,indexingType:f?.indexing_technique,retrievalMethod:f?.retrieval_model_dict?.search_method}):(0,s.jsx)(tH,{embeddingAvailable:b,showNewSegmentModal:C,onNewSegmentModalChange:v,importStatus:k,archived:z?.archived})}),(0,s.jsx)(i.default,{showClose:!0,isOpen:j,onClose:()=>y(!1),isMobile:g,panelClassName:"!justify-start",footer:null,children:(0,s.jsx)(M,{className:"mr-2 mt-3",datasetId:t,documentId:m,docDetail:{...z,...U,doc_type:U?.doc_type==="others"?"":U?.doc_type}})})]}),(0,s.jsx)(es,{isShow:w,onCancel:()=>N(!1),onConfirm:P,docForm:z?.doc_form})]})})}],774444)}]);
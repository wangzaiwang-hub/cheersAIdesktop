(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,349714,844367,e=>{"use strict";var t=e.i(268255);function a(e){try{let t=new URL(e);if("http:"!==t.protocol&&"https:"!==t.protocol)throw Error("Authorization URL must be HTTP or HTTPS")}catch(t){if(t instanceof Error&&"Authorization URL must be HTTP or HTTPS"===t.message)throw t;throw Error(`Invalid URL: ${e}`)}}function s(e){try{let t=new URL(e).hostname.toLowerCase();if("localhost"===t||"127.0.0.1"===t||"::1"===t)return!0;let a=t.match(/^(\d+)\.(\d+)\.(\d+)\.(\d+)$/);if(a){let[,e,t]=a.map(Number);if(10===e||172===e&&t>=16&&t<=31||192===e&&168===t||169===e&&254===t)return!0}return t.endsWith(".local")}catch{return!1}}e.s(["isPrivateOrLocalAddress",()=>s,"validateRedirectUrl",()=>a],844367),e.s(["openOAuthPopup",0,(e,t)=>{let s=window.screenX+(window.outerWidth-600)/2,l=window.screenY+(window.outerHeight-600)/2;a(e);let n=window.open(e,"OAuth",`width=600,height=600,left=${s},top=${l},scrollbars=yes`),r=e=>{e.data?.type==="oauth_callback"&&(window.removeEventListener("message",r),t(e.data))};window.addEventListener("message",r);let i=setInterval(()=>{n?.closed&&(clearInterval(i),window.removeEventListener("message",r),t())},1e3);return n},"useOAuthCallback",0,()=>{(0,t.useEffect)(()=>{let e=new URLSearchParams(window.location.search),t=e.get("subscription_id"),a=e.get("error"),s=e.get("error_description");if(window.opener){let e=window.opener?.origin||"*";t?window.opener.postMessage({type:"oauth_callback",success:!0,subscriptionId:t},e):a?window.opener.postMessage({type:"oauth_callback",success:!1,error:a,errorDescription:s},e):window.opener.postMessage({type:"oauth_callback"},e),window.close()}},[])}],349714)},574270,e=>{"use strict";var t=e.i(563199),a=e.i(268255),s=e.i(935139);let l=a.memo(e=>{let{isChecked:a,disabled:l=!1,onCheck:n,className:r}=e;return(0,t.jsx)("div",{role:"radio","aria-checked":a,"aria-disabled":l,className:(0,s.cn)("size-4 rounded-full",a&&!l&&"border-[5px] border-components-radio-border-checked hover:border-components-radio-border-checked-hover",!a&&!l&&"border border-components-radio-border hover:border-components-radio-border-hover",a&&l&&"border-[5px] border-components-radio-border-checked-disabled",!a&&l&&"border border-components-radio-border-disabled bg-components-radio-bg-disabled",!l&&"bg-components-radio-bg shadow-xs shadow-shadow-shadow-3 hover:bg-components-radio-bg-hover",r),onClick:e=>{l||n?.(e)}})});e.s(["default",0,l])},453284,e=>{"use strict";var t=e.i(563199),a=e.i(837699),s=e.i(268255);e.i(152567);var l=e.i(408767),n=e.i(935139);e.s(["default",0,e=>{let{placeholder:r,className:i,value:o,onChange:c,white:u}=e,{t:d}=(0,l.useTranslation)(),m=(0,s.useRef)(null),[p,f]=(0,s.useState)(!1),h=(0,s.useRef)(!1),[g,x]=(0,s.useState)("");return(0,t.jsxs)("div",{className:(0,n.cn)("group flex h-8 items-center overflow-hidden rounded-lg border-none bg-components-input-bg-normal px-2 hover:bg-components-input-bg-hover",p&&"!bg-components-input-bg-active",u&&"!border-gray-300 !bg-white shadow-xs hover:!border-gray-300 hover:!bg-white",i),children:[(0,t.jsx)("div",{className:"pointer-events-none mr-1.5 flex h-4 w-4 shrink-0 items-center justify-center",children:(0,t.jsx)(a.RiSearchLine,{className:"h-4 w-4 text-components-input-text-placeholder","aria-hidden":"true"})}),(0,t.jsx)("input",{ref:m,type:"text",name:"query",className:(0,n.cn)("system-sm-regular caret-#295EFF block h-[18px] grow appearance-none border-0 bg-transparent text-components-input-text-filled outline-none placeholder:text-components-input-text-placeholder",u&&"!bg-white placeholder:!text-gray-400 hover:!bg-white group-hover:!bg-white"),placeholder:r||d("operation.search",{ns:"common"}),value:h.current?g:o,onChange:e=>{let t=e.target.value;h.current?x(t):c(t)},onCompositionStart:()=>{h.current=!0,x(o)},onCompositionEnd:e=>{h.current=!1,x(""),c(e.currentTarget.value)},onFocus:()=>f(!0),onBlur:()=>f(!1),autoComplete:"off"}),o&&(0,t.jsx)("button",{type:"button","aria-label":d("operation.clear",{ns:"common"}),className:"group/clear flex h-4 w-4 shrink-0 cursor-pointer items-center justify-center border-none bg-transparent p-0",onClick:()=>{c(""),m.current?.focus()},children:(0,t.jsx)(a.RiCloseCircleFill,{className:"h-4 w-4 text-text-quaternary group-hover/clear:text-text-tertiary"})})]})}])},588226,449758,566210,456721,610683,e=>{"use strict";var t=e.i(563199),a=e.i(268255);e.s([],456721);var s=e.i(837699),l=e.i(888468);e.i(152567);var n=e.i(408767),r=e.i(658547),i=e.i(83278),o=e.i(324935),c=e.i(453284);let u={src:e.i(48803).default,width:32,height:32,blurWidth:0,blurHeight:0};var d=e.i(935139),m=e.i(151094);let p=e=>{let{title:s="",label:l,description:p,options:f,value:h=[],onChange:g,disabled:x=!1,containerClassName:v,showSelectAll:b=!0,showCount:y=!0,showSearch:j=!0,maxHeight:k}=e,{t:C}=(0,n.useTranslation)(),[w,N]=(0,a.useState)(""),S=(0,a.useMemo)(()=>{if(!w?.trim())return f;let e=w.toLowerCase();return f.filter(t=>t.label.toLowerCase().includes(e)||t.value.toLowerCase().includes(e))},[f,w]),I=h.length,_=(0,a.useMemo)(()=>{let e=f.filter(e=>!e.disabled);return e.length>0&&e.every(e=>h.includes(e.value))},[f,h]),F=(0,a.useMemo)(()=>{let e=f.filter(e=>!e.disabled),t=e.filter(e=>h.includes(e.value)).length;return t>0&&t<e.length},[f,h]),P=(0,a.useCallback)(()=>{if(!x)if(_)g?.([]);else{let e=f.filter(e=>!e.disabled).map(e=>e.value);g?.(e)}},[_,f,g,x]),E=(0,a.useCallback)(e=>{if(x)return;let t=h.includes(e)?h.filter(t=>t!==e):[...h,e];g?.(t)},[h,g,x]);return(0,t.jsxs)("div",{className:(0,d.cn)("flex w-full flex-col gap-1",v),children:[l&&(0,t.jsx)("div",{className:"system-sm-medium text-text-secondary",children:l}),p&&(0,t.jsx)("div",{className:"body-xs-regular text-text-tertiary",children:p}),(0,t.jsxs)("div",{className:"rounded-lg border border-components-panel-border bg-components-panel-bg",children:[(b||s||j)&&(0,t.jsxs)("div",{className:"relative flex items-center gap-2 border-b border-divider-subtle px-3 py-2",children:[!w&&b&&(0,t.jsx)(o.default,{checked:_,indeterminate:F,onCheck:P,disabled:x}),w?(0,t.jsx)("div",{className:"system-sm-medium-uppercase flex-1 leading-6 text-text-secondary",children:S.length>0?C("operation.searchCount",{ns:"common",count:S.length,content:s}):C("operation.noSearchCount",{ns:"common",content:s})}):(0,t.jsxs)("div",{className:"flex min-w-0 flex-1 items-center gap-1",children:[s&&(0,t.jsx)("span",{className:"system-xs-semibold-uppercase truncate leading-5 text-text-secondary",children:s}),y&&I>0&&(0,t.jsx)(i.default,{uppercase:!0,children:C("operation.selectCount",{ns:"common",count:I})})]}),j&&(0,t.jsx)(c.default,{value:w,onChange:N,placeholder:C("placeholder.search",{ns:"common"}),className:"w-40"})]}),(0,t.jsx)("div",{className:"p-1",style:k?{maxHeight:k,overflowY:"auto"}:{},children:S.length?S.map(e=>{let a=h.includes(e.value);return(0,t.jsxs)("div",{className:(0,d.cn)("flex cursor-pointer items-center gap-2 rounded-md px-2 py-1.5 transition-colors hover:bg-state-base-hover",e.disabled&&"cursor-not-allowed opacity-50"),onClick:()=>{e.disabled||x||E(e.value)},children:[(0,t.jsx)(o.default,{checked:a,onCheck:()=>{e.disabled||x||E(e.value)},disabled:e.disabled||x}),(0,t.jsx)("div",{className:"system-sm-medium flex-1 truncate text-text-secondary",title:e.label,children:e.label})]},e.value)}):(0,t.jsx)("div",{className:"px-3 py-6 text-center text-sm text-text-tertiary",children:w?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center gap-2",children:[(0,t.jsx)(r.default,{alt:"search menu",src:u,width:32}),(0,t.jsx)("span",{className:"system-sm-regular text-text-secondary",children:C("operation.noSearchResults",{ns:"common",content:s})}),(0,t.jsx)(m.default,{variant:"secondary-accent",size:"small",onClick:()=>N(""),children:C("operation.resetKeywords",{ns:"common"})})]}):C("noData",{ns:"common"})})})]})]})};e.s(["default",0,p],449758);var f=e.i(603135),h=e.i(291631),g=e.i(545766),x=e.i(574270),v=e.i(306101),b=e.i(421001),y=e.i(225162),j=e.i(645429);let k=()=>{let e=(0,y.useLanguage)();return t=>(0,j.renderI18nObject)(t,e)};e.s(["useRenderI18nObject",0,k],566210);var C=e.i(819114);let w=e=>{let{content:t,render:s}=e;return(0,a.isValidElement)(t)||"string"==typeof t?t:"object"==typeof t&&null!==t?s(t):""},N={[f.FormItemValidateStatusEnum.Error]:{componentClassName:"border-components-input-border-destructive focus:border-components-input-border-destructive",textClassName:"text-text-destructive",infoFieldName:"errors"},[f.FormItemValidateStatusEnum.Warning]:{componentClassName:"border-components-input-border-warning focus:border-components-input-border-warning",textClassName:"text-text-warning",infoFieldName:"warnings"},[f.FormItemValidateStatusEnum.Success]:{componentClassName:"",textClassName:"",infoFieldName:""},[f.FormItemValidateStatusEnum.Validating]:{componentClassName:"",textClassName:"",infoFieldName:""}},S=(0,a.memo)(e=>{let{fieldClassName:r,labelClassName:i,inputContainerClassName:o,inputClassName:c,formSchema:u,field:m,disabled:y,onChange:j,fieldState:S}=e,I=k(),{t:_}=(0,n.useTranslation)(),{name:F,label:P,required:E,placeholder:T,options:M,labelClassName:L,disabled:A,type:$,dynamicSelectParams:R,multiple:V=!1,tooltip:q,showCopy:O,description:U,url:D,help:z}=u,H=y||A,[B,W,G,K,X]=(0,a.useMemo)(()=>{let e=[P,T,q,U,z].map(e=>w({content:e,render:I}));return e[1]||(e[1]=_("placeholder.input",{ns:"common"})),e},[P,T,q,U,z,I]),Y=(0,a.useMemo)(()=>{let e=new Set;for(let t of M||[])for(let a of t.show_on||[])e.add(a.variable);return Array.from(e)},[M]),J=(0,l.useStore)(m.form.store,e=>{let t={};for(let a of Y)t[a]=e.values[a];return t}),Q=(0,a.useMemo)(()=>M?.filter(e=>!e.show_on?.length||e.show_on.every(e=>J[e.variable]===e.value)).map(e=>({label:w({content:e.label,render:I}),value:e.value}))||[],[M,I,J]),Z=(0,l.useStore)(m.form.store,e=>e.values[m.name]),{data:ee,isLoading:et,error:ea}=(0,C.useTriggerPluginDynamicOptions)(R||{plugin_id:"",provider:"",action:"",parameter:"",credential_id:""},$===f.FormTypeEnum.dynamicSelect),es=(0,a.useMemo)(()=>ee?.options?ee.options.map(e=>({label:w({content:e.label,render:I}),value:e.value})):[],[ee,I]),el=(0,a.useCallback)(e=>{m.handleChange(e),j?.(m.name,e)},[m,j]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:(0,d.cn)(r),children:[(0,t.jsxs)("div",{className:(0,d.cn)(i,L),children:[B,E&&!(0,a.isValidElement)(P)&&(0,t.jsx)("span",{className:"ml-1 text-text-destructive-secondary",children:"*"}),q&&(0,t.jsx)(b.default,{popupContent:(0,t.jsx)("div",{className:"w-[200px]",children:G}),triggerClassName:"ml-0.5 w-4 h-4"})]}),(0,t.jsxs)("div",{className:(0,d.cn)(o),children:[[f.FormTypeEnum.textInput,f.FormTypeEnum.secretInput,f.FormTypeEnum.textNumber].includes($)&&(0,t.jsx)(h.default,{id:m.name,name:m.name,className:(0,d.cn)(c,N[S?.validateStatus]?.componentClassName),value:Z||"",onChange:e=>{el(e.target.value)},onBlur:m.handleBlur,disabled:H,placeholder:W,...(e=>{switch(e){case f.FormTypeEnum.secretInput:return{type:"password",autoComplete:"new-password"};case f.FormTypeEnum.textNumber:return{type:"number"};default:return{type:"text"}}})($),showCopyIcon:O}),$===f.FormTypeEnum.select&&!V&&(0,t.jsx)(v.default,{value:Z,onChange:e=>el(e),disabled:H,placeholder:W,options:Q,triggerPopupSameWidth:!0,popupProps:{className:"max-h-[320px] overflow-y-auto"}}),$===f.FormTypeEnum.checkbox&&(0,t.jsx)(p,{title:F,value:Z,onChange:e=>m.handleChange(e),options:Q,maxHeight:"200px"}),$===f.FormTypeEnum.dynamicSelect&&(0,t.jsx)(v.default,{options:es,value:Z,onChange:m.handleChange,disabled:H||et,placeholder:et?_("dynamicSelect.loading",{ns:"common"}):W,...ea?{popupProps:{title:_("dynamicSelect.error",{ns:"common"}),titleClassName:"text-text-destructive-secondary"}}:!es.length?{popupProps:{title:_("dynamicSelect.noData",{ns:"common"})}}:{},triggerPopupSameWidth:!0,multiple:V}),$===f.FormTypeEnum.radio&&(0,t.jsx)("div",{className:(0,d.cn)(Q.length<3?"flex items-center space-x-2":"space-y-2"),children:Q.map(e=>(0,t.jsxs)("div",{className:(0,d.cn)("system-sm-regular hover:bg-components-option-card-option-hover-bg hover:border-components-option-card-option-hover-border flex h-8 flex-[1] grow cursor-pointer items-center justify-center gap-2 rounded-lg border border-components-option-card-option-border bg-components-option-card-option-bg p-2 text-text-secondary",Z===e.value&&"border-components-option-card-option-selected-border bg-components-option-card-option-selected-bg text-text-primary shadow-xs",H&&"cursor-not-allowed opacity-50",c),onClick:()=>!H&&el(e.value),children:[u.showRadioUI&&(0,t.jsx)(x.default,{className:"mr-2",isChecked:Z===e.value}),e.label]},e.value))}),$===f.FormTypeEnum.boolean&&(0,t.jsxs)(g.default.Group,{className:"flex w-fit items-center",value:Z,onChange:e=>m.handleChange(e),children:[(0,t.jsx)(g.default,{value:!0,className:"!mr-1",children:"True"}),(0,t.jsx)(g.default,{value:!1,children:"False"})]}),S?.validateStatus&&[f.FormItemValidateStatusEnum.Error,f.FormItemValidateStatusEnum.Warning].includes(S?.validateStatus)&&(0,t.jsx)("div",{className:(0,d.cn)("system-xs-regular mt-1 px-0 py-[2px]",N[S?.validateStatus].textClassName),children:S?.[N[S?.validateStatus].infoFieldName]})]})]}),U&&(0,t.jsx)("div",{className:"system-xs-regular mt-4 text-text-tertiary",children:K}),D&&(0,t.jsxs)("a",{className:"system-xs-regular mt-4 flex items-center text-text-accent",href:D,target:"_blank",children:[(0,t.jsx)("span",{className:"break-all",children:X}),(0,t.jsx)(s.RiExternalLinkLine,{className:"ml-1 h-3 w-3 shrink-0"})]})]})});var I=e.i(102188),_=e.i(137667);let F=(0,a.memo)(e=>{let{formSchemas:s=[],defaultValues:r,formClassName:i,fieldClassName:o,labelClassName:c,inputContainerClassName:u,inputClassName:m,ref:p,disabled:h,formFromProps:g,onChange:x,onSubmit:v,preventDefaultSubmit:b=!1}=e,y=(0,a.useMemo)(()=>r||s.reduce((e,t)=>(t.default&&(e[t.name]=t.default),e),{}),[r]),j=(0,I.useForm)({defaultValues:y}),C=g||j,{getFormValues:w}=((e,t)=>{let{checkValidated:s}=((e,t)=>{let{notify:s}=(0,_.useToastContext)();return{checkValidated:(0,a.useCallback)(()=>{let a=e?.getAllErrors(),l=e.state.values;if(a){let e=a.fields,n=Object.keys(e).reduce((a,s)=>{let{show_on:n=[]}=t.find(e=>e.name===s)||{},r=n.reduce((e,t)=>(e[t.variable]=l[t.variable],e),{});return[...a,...n?.every(e=>r[e.variable]===e.value)?e[s].errors:[]]},[]);if(n.length)return s({type:"error",message:n[0]}),!1}return!0},[e,s,t])}})(e,t);return{getFormValues:(0,a.useCallback)(a=>{let{needCheckValidatedValues:l=!0,needTransformWhenSecretFieldIsPristine:n}=a,r=e?.store.state.values||{};return l?s()?{values:n?((e,t)=>{let a,s=t?.store.state.values||{},l=[];for(let a=0;a<e.length;a++){let s=e[a];if(s.type===f.FormTypeEnum.secretInput){let e=t?.getFieldMeta(s.name);e?.isPristine&&l.push(s.name)}}return a={...s},l.forEach(e=>{a[e]&&(a[e]="[__HIDDEN__]")}),a})(t,e):r,isCheckValidated:!0}:{values:{},isCheckValidated:!1}:{values:r,isCheckValidated:!0}},[e,s,t])}})(C,s),{getValidators:N}=(()=>{let{t:e}=(0,n.useTranslation)(),t=k(),s=(0,a.useCallback)(e=>(0,a.isValidElement)(e)?"":"string"==typeof e?e:"object"==typeof e&&null!==e?t(e):void 0,[]);return{getValidators:(0,a.useCallback)(t=>{let{name:a,validators:l,required:n,label:r}=t,i=l,o=s(r);return n&&!l&&(i={onMount:t=>{let{value:s}=t;if(!s)return e("errorMsg.fieldRequired",{ns:"common",field:o||a})},onChange:t=>{let{value:s}=t;if(!s)return e("errorMsg.fieldRequired",{ns:"common",field:o||a})},onBlur:t=>{let{value:a}=t;if(!a)return e("errorMsg.fieldRequired",{ns:"common",field:o})}}),i},[e,s])}})(),[F,P]=(0,a.useState)({}),E=(0,l.useStore)(C.store,e=>{let t={};return s.forEach(a=>{let{show_on:s}=a;s?.length&&s.forEach(a=>{t[a.variable]=e.values[a.variable]})}),t}),T=(0,a.useCallback)(e=>{let t={...F};for(let a of e){let{name:e,value:s,errors:l,warnings:n,validateStatus:r,help:i}=a;void 0!==s&&C.setFieldValue(e,s);let o=r;!o&&(l&&l.length>0?o=f.FormItemValidateStatusEnum.Error:n&&n.length>0&&(o=f.FormItemValidateStatusEnum.Warning)),t[e]={validateStatus:o,help:i,errors:l,warnings:n}}P(t)},[C,F]);(0,a.useImperativeHandle)(p,()=>({getForm:()=>C,getFormValues:e=>w(e),setFields:T}),[C,w,T]);let M=(0,a.useCallback)(e=>{let a=s?.find(t=>t.name===e.name);return a?(0,t.jsx)(S,{field:e,formSchema:a,fieldClassName:o??a.fieldClassName,labelClassName:c??a.labelClassName,inputContainerClassName:u,inputClassName:m,disabled:h,onChange:x,fieldState:F[e.name]}):null},[s,o,c,u,m,h,x,F]),L=(0,a.useCallback)(e=>{let a=N(e),{name:s,show_on:l=[]}=e;return l?.every(e=>E[e.variable]===e.value)?(0,t.jsx)(C.Field,{name:s,validators:a,children:M},s):null},[M,C,N,E]);return s?.length?(0,t.jsx)("form",{className:(0,d.cn)(i),onSubmit:e=>{b&&(e.preventDefault(),e.stopPropagation()),v?.(e)},children:s.map(L)}):null});e.s(["BaseForm",0,F],610683);let P=(0,a.memo)(e=>{let{formSchemas:a=[],defaultValues:s,ref:l,formFromProps:n,...r}=e;return(0,t.jsx)(F,{ref:l,formSchemas:a,defaultValues:s,formClassName:"space-y-4",labelClassName:"h-6 flex items-center mb-1 system-sm-medium text-text-secondary",formFromProps:n,...r})});e.s(["default",0,P],588226)},966428,e=>{"use strict";var t=e.i(824627),a=e.i(268255),s=e.i(67679);e.s(["useDebounce",0,function(e,l){var n=(0,t.__read)((0,a.useState)(e),2),r=n[0],i=n[1],o=(0,s.default)(function(){i(e)},l).run;return(0,a.useEffect)(function(){o()},[e]),r}],966428)},508110,e=>{"use strict";var t=e.i(340801);e.s(["Mcp",()=>t.default])},931576,598898,381480,70486,e=>{"use strict";var t=e.i(563199),a=e.i(268255);e.i(152567);var s=e.i(408767),l=e.i(21151),n=e.i(935139),r=e.i(944911),i=e.i(568349),o=e.i(664826),c=e.i(632717),u=e.i(837699),d=e.i(151094),m=e.i(324935),p=e.i(95085),f=e.i(124836),h=e.i(339548);let g=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return Object.assign({},...t)},x={enabled:!0};function v(e){var t;let s=(0,a.useRef)(void 0);s.current||(s.current=e??{all:t=t||new Map,on:function(e,a){var s=t.get(e);s?s.push(a):t.set(e,[a])},off:function(e,a){var s=t.get(e);s&&(a?s.splice(s.indexOf(a)>>>0,1):t.set(e,[]))},emit:function(e,a){var s=t.get(e);s&&s.slice().map(function(e){e(a)}),(s=t.get("*"))&&s.slice().map(function(t){t(e,a)})}}),e&&s.current!==e&&(s.current.off("*"),s.current=e);let l=s.current;return{emit:l.emit,useSubscribe:(e,t,s)=>{let{enabled:n}=g(x,s);(0,a.useEffect)(()=>{if(n)return l.on(e,t),()=>l.off(e,t)})}}}e.s(["useMitt",()=>v],598898);let b=(0,h.createContext)({emit:f.noop,useSubscribe:f.noop});function y(e){return(0,h.useContextSelector)(b,e)}e.s(["MittProvider",0,e=>{let{children:a}=e,s=v();return(0,t.jsx)(b.Provider,{value:s,children:a})},"useMittContextSelector",()=>y],381480);var j=e.i(157644),k=e.i(745754),C=e.i(105845),w=e.i(99649),N=e.i(494268),S=e.i(21693);e.i(36860);var I=e.i(438270);let _=a.memo(()=>{let{t:e}=(0,s.useTranslation)();return(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(m.default,{className:"shrink-0",checked:!1,disabled:!0}),(0,t.jsxs)("div",{className:"hover-bg-components-panel-on-panel-item-bg relative grow rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-on-panel-item-bg p-4 pb-3 shadow-xs",children:[(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsxs)("div",{className:"relative flex h-10 w-10 items-center justify-center gap-2 rounded-[10px] border-[0.5px] border-state-destructive-border bg-state-destructive-hover p-1 backdrop-blur-sm",children:[(0,t.jsx)("div",{className:"flex h-5 w-5 items-center justify-center",children:(0,t.jsx)(I.Group,{className:"text-text-quaternary"})}),(0,t.jsx)("div",{className:"absolute bottom-[-4px] right-[-4px] rounded-full border-[2px] border-components-panel-bg bg-state-destructive-solid",children:(0,t.jsx)(u.RiCloseLine,{className:"h-3 w-3 text-text-primary-on-surface"})})]}),(0,t.jsxs)("div",{className:"ml-3 grow",children:[(0,t.jsx)("div",{className:"system-md-semibold flex h-5 items-center text-text-destructive",children:e("installModal.pluginLoadError",{ns:"plugin"})}),(0,t.jsx)("div",{className:"system-xs-regular mt-0.5 text-text-tertiary",children:e("installModal.pluginLoadErrorDesc",{ns:"plugin"})})]})]}),(0,t.jsx)(S.LoadingPlaceholder,{className:"mt-3 w-[420px]"})]})]})});var F=e.i(547682);function P(e,t){if(t.plugin_installation_permission.restrict_to_marketplace_only&&("github"===e.from||"package"===e.from))return{canInstall:!1};if(t.plugin_installation_permission.plugin_installation_scope===F.InstallationScope.ALL)return{canInstall:!0};if(t.plugin_installation_permission.plugin_installation_scope===F.InstallationScope.NONE)return{canInstall:!1};let a=e.verification||{};return(e.verification&&e.verification.authorized_category||(a.authorized_category="langgenius"),t.plugin_installation_permission.plugin_installation_scope===F.InstallationScope.OFFICIAL_ONLY)?{canInstall:"langgenius"===a.authorized_category}:t.plugin_installation_permission.plugin_installation_scope===F.InstallationScope.OFFICIAL_AND_PARTNER?{canInstall:"langgenius"===a.authorized_category||"partner"===a.authorized_category}:{canInstall:!0}}function E(e){return P(e,(0,N.useGlobalPublicStore)(e=>e.systemFeatures))}let T=a.memo(()=>(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(m.default,{className:"shrink-0",checked:!1,disabled:!0}),(0,t.jsx)("div",{className:"hover-bg-components-panel-on-panel-item-bg relative grow rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-on-panel-item-bg p-4 pb-3 shadow-xs",children:(0,t.jsx)(S.default,{wrapClassName:"w-full"})})]}));var M=e.i(228403),L=e.i(925521),A=e.i(365181),$=e.i(222573),R=e.i(292005);let V=a.memo(e=>{let{checked:a,onCheckedChange:s,payload:l,isFromMarketPlace:n,versionInfo:r}=e,{getIconUrl:i}=(0,$.default)(),o={...r,toInstallVersion:l.version},{canInstall:c}=E(l);return(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(m.default,{disabled:!c,className:"shrink-0",checked:a,onCheck:()=>s(l)}),(0,t.jsx)(A.default,{className:"grow",payload:{...l,icon:n?`${L.MARKETPLACE_API_PREFIX}/plugins/${l.org}/${l.name}/icon`:i(l.icon)},titleLeft:l.version?(0,t.jsx)(R.default,{...o}):null,limitedInstall:!c})]})}),q=a.memo(e=>{let{checked:s,onCheckedChange:l,dependency:n,versionInfo:r,onFetchedPayload:i,onFetchError:o}=e,c=n.value,{data:u,error:d}=(0,j.useUploadGitHub)({repo:c.repo,version:c.release||c.version,package:c.packages||c.package}),[m,p]=a.useState(null);return((0,a.useEffect)(()=>{if(u){let e={...(0,M.pluginManifestToCardPluginProps)(u.manifest),plugin_id:u.unique_identifier};i(e),p({...e,from:n.type})}},[u]),(0,a.useEffect)(()=>{d&&o()},[d]),m)?(0,t.jsx)(V,{payload:m,versionInfo:r,checked:s,onCheckedChange:l}):(0,t.jsx)(T,{})}),O=a.memo(e=>{let{checked:a,onCheckedChange:s,payload:l,version:n,versionInfo:r}=e;return l?(0,t.jsx)(V,{checked:a,onCheckedChange:s,payload:{...l,version:n},isFromMarketPlace:!0,versionInfo:r}):(0,t.jsx)(T,{})}),U=a.memo(e=>{let{payload:a,checked:s,onCheckedChange:l,isFromMarketPlace:n,versionInfo:r}=e;if(!a.value?.manifest)return(0,t.jsx)(_,{});let i=(0,M.pluginManifestToCardPluginProps)(a.value.manifest);return(0,t.jsx)(V,{payload:{...i,from:a.type},checked:s,onCheckedChange:l,isFromMarketPlace:n,versionInfo:r})}),D=e=>{let{allPlugins:s,selectedPlugins:l,onSelect:n,onSelectAll:r,onDeSelectAll:i,onLoadedAllPlugin:o,isFromMarketPlace:c,ref:u}=e,d=(0,N.useGlobalPublicStore)(e=>e.systemFeatures),{isLoading:m,data:p,error:f}=(0,j.useFetchPluginsInMarketPlaceByInfo)(s.filter(e=>"marketplace"===e.type).map(e=>{let[t,a]=e.value.marketplace_plugin_unique_identifier.split("@")[0].split("/"),[s,l]=a.split(":");return{organization:t,plugin:s,version:l}})),{isLoading:h,data:g,error:x}=(0,j.useFetchPluginsInMarketPlaceByInfo)(s.filter(e=>"marketplace"===e.type).map(e=>e.value)),[v,b]=(0,a.useState)(s.some(e=>"package"===e.type)?s.map(e=>{if("package"===e.type)return{...e.value.manifest,plugin_id:e.value.unique_identifier}}):[]),y=a.useRef(v),k=(0,a.useCallback)(e=>{b(e),y.current=e},[]),[S,I]=(0,a.useState)([]),F=(0,a.useCallback)(e=>t=>{k((0,C.produce)(y.current,a=>{a[e]=t}))},[k]),E=(0,a.useCallback)(e=>()=>{I([...S,e])},[S]),T=(0,a.useMemo)(()=>{let e=[];return s.forEach((t,a)=>{"marketplace"===t.type&&e.push(a)}),e},[s]);(0,a.useEffect)(()=>{if(!m&&p?.data.list){let e=s.filter(e=>"marketplace"===e.type).map(e=>{let t=e.value.marketplace_plugin_unique_identifier?.split(":")[0];return{...p.data.list.find(e=>e.plugin.plugin_id===t)?.plugin,from:e.type}}),t=[];k((0,C.produce)(y.current,a=>{T.forEach((s,l)=>{e[l]?a[s]={...e[l],version:e[l].version||e[l].latest_version}:t.push(s)})})),t.length>0&&I([...S,...t])}},[m]),(0,a.useEffect)(()=>{if(!h&&g?.data.list){let e=g?.data.list,t=[];k((0,C.produce)(y.current,a=>{T.forEach((s,l)=>{if(e[l]){let t=e[l];a[s]={...t.plugin,plugin_id:t.version.unique_identifier}}else t.push(s)})})),t.length>0&&I([...S,...t])}},[h]),(0,a.useEffect)(()=>{(x||f)&&I([...S,...T])},[x,f]);let M=v.filter(e=>!!e).length+S.length===s.length,{installedInfo:L}=(0,w.default)({pluginIds:v?.filter(e=>!!e).map(e=>`${e?.org||e?.author}/${e?.name}`)||[],enabled:M}),A=(0,a.useCallback)(e=>{let t=L?.[e];return{hasInstalled:!!t,installedVersion:t?.installedVersion,toInstallVersion:""}},[L]);(0,a.useEffect)(()=>{M&&L&&o(L)},[M,L]);let $=(0,a.useCallback)(e=>()=>{let t=v.filter(e=>{let{canInstall:t}=P(e,d);return t});n(v[e],e,t.length)},[n,v,d]);return(0,a.useImperativeHandle)(u,()=>({selectAllPlugins:()=>{let e=[],t=[];s.forEach((a,s)=>{let l=v[s];if(!l)return;let{canInstall:n}=P(l,d);n&&(e.push(s),t.push(l))}),r(t,e)},deSelectAllPlugins:()=>{i()}})),(0,t.jsx)(t.Fragment,{children:s.map((e,a)=>{if(S.includes(a))return(0,t.jsx)(_,{},a);let s=v[a];return"github"===e.type?(0,t.jsx)(q,{checked:!!l.find(e=>e.plugin_id===v[a]?.plugin_id),onCheckedChange:$(a),dependency:e,onFetchedPayload:F(a),onFetchError:E(a),versionInfo:A(`${s?.org||s?.author}/${s?.name}`)},a):"marketplace"===e.type?(0,t.jsx)(O,{checked:!!l.find(e=>e.plugin_id===v[a]?.plugin_id),onCheckedChange:$(a),payload:{...s,from:e.type},version:e.value.version||s?.version||"",versionInfo:A(`${s?.org||s?.author}/${s?.name}`)},a):(0,t.jsx)(U,{checked:!!l.find(e=>e.plugin_id===v[a]?.plugin_id),onCheckedChange:$(a),payload:e,isFromMarketPlace:c,versionInfo:A(`${s?.org||s?.author}/${s?.name}`)},a)})})},z="installModal",H=a.memo(e=>{let{allPlugins:l,onStartToInstall:n,onInstalled:i,onCancel:o,isFromMarketPlace:f,isHideButton:h}=e,{t:g}=(0,s.useTranslation)(),x=y(e=>e.emit),[v,b]=a.useState([]),[C,w]=a.useState([]),N=v.length,S=(0,a.useRef)(null),{refreshPluginList:I}=(0,c.default)(),[_,F]=(0,a.useState)(!1),P=(0,a.useCallback)(()=>{_?S.current?.deSelectAllPlugins():S.current?.selectAllPlugins()},[_]),[E,T]=a.useState(!1),[M,L]=(0,a.useState)(void 0),A=(0,a.useCallback)(e=>{P(),L(e),T(!0)},[]),{check:$,stop:R}=(0,k.default)(),V=(0,a.useCallback)(()=>{R(),o()},[o,R]),{handleRefetch:q}=(0,j.usePluginTaskList)(),{mutate:O,isPending:U}=(0,j.useInstallOrUpdate)({onSuccess:async e=>{if(e.every(e=>e.status===r.TaskStatus.success||e.status===r.TaskStatus.failed)){i(v,e.map((e,t)=>({success:e.status===r.TaskStatus.success,isFromMarketPlace:"marketplace"===l[C[t]].type}))),e.some(e=>e.status===r.TaskStatus.success)&&(I(void 0,!0),x("plugin:install:success",v.map(e=>`${e.plugin_id}/${e.name}`)));return}q();let t=await Promise.all(e.map(async(e,t)=>{if(e.status!==r.TaskStatus.running)return{success:e.status===r.TaskStatus.success,isFromMarketPlace:"marketplace"===l[C[t]].type};let{status:a}=await $({taskId:e.taskId,pluginUniqueIdentifier:e.uniqueIdentifier});return{success:a===r.TaskStatus.success,isFromMarketPlace:"marketplace"===l[C[t]].type}}));i(v,t),t.some(e=>e.success)&&x("plugin:install:success",v.map(e=>`${e.plugin_id}/${e.name}`))}}),[H,B]=(0,a.useState)(!1),W=(0,a.useCallback)((e,t)=>{b(e),w(t),F(!0),B(!1)},[]),G=(0,a.useCallback)(()=>{b([]),w([]),F(!1),B(!1)},[]),K=(0,a.useCallback)((e,t,a)=>{let s,l=!!v.find(t=>t.plugin_id===e.plugin_id);b(s=l?v.filter(t=>t.plugin_id!==e.plugin_id):[...v,e]),w(l?C.filter(e=>e!==t):[...C,t]),0===s.length?(F(!1),B(!1)):s.length===a?(F(!0),B(!1)):(B(!0),F(!1))},[v,C]),{canInstallPluginFromMarketplace:X}=(0,p.useCanInstallPluginFromMarketplace)();return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex flex-col items-start justify-center gap-4 self-stretch px-6 py-3",children:[(0,t.jsx)("div",{className:"system-md-regular text-text-secondary",children:(0,t.jsx)("p",{children:g(`${z}.${N>1?"readyToInstallPackages":"readyToInstallPackage"}`,{ns:"plugin",num:N})})}),(0,t.jsx)("div",{className:"w-full space-y-1 rounded-2xl bg-background-section-burn p-2",children:(0,t.jsx)(D,{ref:S,allPlugins:l,selectedPlugins:v,onSelect:K,onSelectAll:W,onDeSelectAll:G,onLoadedAllPlugin:A,isFromMarketPlace:f})})]}),!h&&(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2 self-stretch p-6 pt-5",children:[(0,t.jsx)("div",{className:"px-2",children:E&&(0,t.jsxs)("div",{className:"flex items-center gap-x-2",onClick:P,children:[(0,t.jsx)(m.default,{checked:_,indeterminate:H}),(0,t.jsx)("p",{className:"system-sm-medium cursor-pointer text-text-secondary",children:g(_?"operation.deSelectAll":"operation.selectAll",{ns:"common"})})]})}),(0,t.jsxs)("div",{className:"flex items-center justify-end gap-2 self-stretch",children:[!E&&(0,t.jsx)(d.default,{variant:"secondary",className:"min-w-[72px]",onClick:V,children:g("operation.cancel",{ns:"common"})}),(0,t.jsxs)(d.default,{variant:"primary",className:"flex min-w-[72px] space-x-0.5",disabled:!E||U||0===v.length||!X,onClick:()=>{n?.(),O({payload:l.filter((e,t)=>C.includes(t)),plugin:v,installedInfo:M})},children:[U&&(0,t.jsx)(u.RiLoader2Line,{className:"h-4 w-4 animate-spin-slow"}),(0,t.jsx)("span",{children:g(`${z}.${U?"installing":"install"}`,{ns:"plugin"})})]})]})]})]})});var B=e.i(500536);let W=a.memo(e=>{let{list:a,installStatus:l,onCancel:n,isHideButton:r}=e,{t:i}=(0,s.useTranslation)(),{getIconUrl:o}=(0,$.default)();return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"flex flex-col items-start justify-center gap-4 self-stretch px-6 py-3",children:(0,t.jsx)("div",{className:"flex flex-wrap content-start items-start gap-1 space-y-1 self-stretch rounded-2xl bg-background-section-burn p-2",children:a.map((e,a)=>(0,t.jsx)(A.default,{className:"w-full",payload:{...e,icon:l[a].isFromMarketPlace?`${L.MARKETPLACE_API_PREFIX}/plugins/${e.org}/${e.name}/icon`:o(e.icon)},installed:l[a].success,installFailed:!l[a].success,titleLeft:e.version?(0,t.jsx)(B.default,{className:"mx-1",size:"s",state:B.BadgeState.Default,children:e.version}):null},e.plugin_id))})}),!r&&(0,t.jsx)("div",{className:"flex items-center justify-end gap-2 self-stretch p-6 pt-5",children:(0,t.jsx)(d.default,{variant:"primary",className:"min-w-[72px]",onClick:n,children:i("operation.close",{ns:"common"})})})]})}),G=a.memo(e=>{let{step:s,onStepChange:l,onStartToInstall:n,setIsInstalling:i,allPlugins:o,onClose:c,isFromMarketPlace:u}=e,[d,m]=(0,a.useState)([]),[p,f]=(0,a.useState)([]),h=(0,a.useCallback)((e,t)=>{f(t),m(e),l(r.InstallStep.installed),i(!1)},[l,i]);return(0,t.jsxs)(t.Fragment,{children:[s===r.InstallStep.readyToInstall&&(0,t.jsx)(H,{allPlugins:o,onCancel:c,onStartToInstall:n,onInstalled:h,isFromMarketPlace:u}),s===r.InstallStep.installed&&(0,t.jsx)(W,{list:d,installStatus:p,onCancel:c})]})});e.s(["default",0,G],70486);var K=e.i(36503),X=e.i(711536);let Y="installModal",J=a.memo(e=>{let{uniqueIdentifier:l,payload:n,onCancel:i,onStartToInstall:o,onInstalled:c,onFailed:m}=e,{t:p}=(0,s.useTranslation)(),f=n.version||n.latest_version,h=n.plugin_id,{installedInfo:g,isLoading:x}=(0,w.default)({pluginIds:[h],enabled:!!h}),v=g?.[h],b=v?.installedVersion,y=!!b,{mutateAsync:C}=(0,j.useInstallPackageFromMarketPlace)(),{mutateAsync:N}=(0,j.useUpdatePackageFromMarketPlace)(),[S,I]=a.useState(!1),{check:_,stop:F}=(0,k.default)(),{handleRefetch:P}=(0,j.usePluginTaskList)(n.category);(0,a.useEffect)(()=>{y&&l===v.uniqueIdentifier&&c()},[y]);let T=async()=>{if(!S){o?.(),I(!0);try{let e,t;if(y){let{all_installed:a,task_id:s}=await N({original_plugin_unique_identifier:v.uniqueIdentifier,new_plugin_unique_identifier:l});e=s,t=a}else{let{all_installed:a,task_id:s}=await C(l);e=s,t=a}if(t)return void c();P();let{status:a,error:s}=await _({taskId:e,pluginUniqueIdentifier:l});if(a===r.TaskStatus.failed)return void m(s);c(!0)}catch(e){if("string"==typeof e)return void m(e);m()}}},{langGeniusVersionInfo:L}=(0,X.useAppContext)(),{data:$}=(0,j.usePluginDeclarationFromMarketPlace)(l),V=(0,a.useMemo)(()=>!$||!L.current_version||(0,K.gte)(L.current_version,$?.manifest.meta.minimum_dify_version??"0.0.0"),[L.current_version,$]),{canInstall:q}=E({...n,from:"marketplace"});return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex flex-col items-start justify-center gap-4 self-stretch px-6 py-3",children:[(0,t.jsxs)("div",{className:"system-md-regular text-text-secondary",children:[(0,t.jsx)("p",{children:p(`${Y}.readyToInstall`,{ns:"plugin"})}),!V&&(0,t.jsx)("p",{className:"system-md-regular text-text-warning",children:p("difyVersionNotCompatible",{ns:"plugin",minimalDifyVersion:$?.manifest.meta.minimum_dify_version})})]}),(0,t.jsx)("div",{className:"flex flex-wrap content-start items-start gap-1 self-stretch rounded-2xl bg-background-section-burn p-2",children:(0,t.jsx)(A.default,{className:"w-full",payload:(0,M.pluginManifestInMarketToPluginProps)(n),titleLeft:!x&&(0,t.jsx)(R.default,{hasInstalled:y,installedVersion:b,toInstallVersion:f}),limitedInstall:!q})})]}),(0,t.jsxs)("div",{className:"flex items-center justify-end gap-2 self-stretch p-6 pt-5",children:[!S&&(0,t.jsx)(d.default,{variant:"secondary",className:"min-w-[72px]",onClick:()=>{F(),i()},children:p("operation.cancel",{ns:"common"})}),(0,t.jsxs)(d.default,{variant:"primary",className:"flex min-w-[72px] space-x-0.5",disabled:S||x||!q,onClick:T,children:[S&&(0,t.jsx)(u.RiLoader2Line,{className:"h-4 w-4 animate-spin-slow"}),(0,t.jsx)("span",{children:p(`${Y}.${S?"installing":"install"}`,{ns:"plugin"})})]})]})]})}),Q="installModal";e.s(["default",0,e=>{let{uniqueIdentifier:u,manifest:d,isBundle:m,dependencies:p,onSuccess:f,onClose:h}=e,{t:g}=(0,s.useTranslation)(),[x,v]=(0,a.useState)(r.InstallStep.readyToInstall),[b,y]=(0,a.useState)(null),{refreshPluginList:j}=(0,c.default)(),{modalClassName:k,foldAnimInto:C,setIsInstalling:w,handleStartToInstall:N}=(0,o.default)(h),S=(0,a.useCallback)(()=>m&&x===r.InstallStep.installed?g(`${Q}.installComplete`,{ns:"plugin"}):x===r.InstallStep.installed?g(`${Q}.installedSuccessfully`,{ns:"plugin"}):x===r.InstallStep.installFailed?g(`${Q}.installFailed`,{ns:"plugin"}):g(`${Q}.installPlugin`,{ns:"plugin"}),[m,x,g]),I=(0,a.useCallback)(e=>{v(r.InstallStep.installed),e||j(d),w(!1)},[d,j,w]),_=(0,a.useCallback)(e=>{v(r.InstallStep.installFailed),w(!1),e&&y(e)},[w]);return(0,t.jsxs)(l.default,{isShow:!0,onClose:C,wrapperClassName:"z-[9999]",className:(0,n.cn)(k,"shadows-shadow-xl flex min-w-[560px] flex-col items-start rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg p-0"),closable:!0,children:[(0,t.jsx)("div",{className:"flex items-start gap-2 self-stretch pb-3 pl-6 pr-14 pt-6",children:(0,t.jsx)("div",{className:"title-2xl-semi-bold self-stretch text-text-primary",children:S()})}),m?(0,t.jsx)(G,{step:x,onStepChange:v,onStartToInstall:N,setIsInstalling:w,onClose:h,allPlugins:p,isFromMarketPlace:!0}):(0,t.jsxs)(t.Fragment,{children:[x===r.InstallStep.readyToInstall&&(0,t.jsx)(J,{uniqueIdentifier:u,payload:d,onCancel:h,onInstalled:I,onFailed:_,onStartToInstall:N}),[r.InstallStep.installed,r.InstallStep.installFailed].includes(x)&&(0,t.jsx)(i.default,{payload:d,isMarketPayload:!0,isFailed:x===r.InstallStep.installFailed,errMsg:b,onCancel:f})]})]})}],931576)}]);
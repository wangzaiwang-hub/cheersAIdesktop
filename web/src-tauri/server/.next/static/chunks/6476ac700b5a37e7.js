(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,797494,e=>{"use strict";var t,s,a,n,r,l=e.i(563199),o=e.i(326531),i=e.i(268255);e.i(152567);var d=e.i(408767),c=e.i(837699),p=e.i(966428),u=e.i(654313),m=e.i(491939);e.i(417885);var x=e.i(397181),x=x,h=e.i(449980),g=e.i(888972),b=e.i(260484),f=e.i(969789),j=e.i(925521),y=e.i(56971),w=e.i(793359),v=e.i(648404),N=e.i(842090),k=e.i(935139),_=e.i(137667);let C=e=>{let{className:t}=e;return(0,l.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t??"",children:(0,l.jsx)("path",{d:"M5 6.5V5M8.93934 7.56066L10 6.5M10.0103 11.5H11.5103",stroke:"#374151",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})},A=i.memo(()=>{let{t:e}=(0,d.useTranslation)();return(0,l.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,l.jsxs)("div",{className:"box-border h-fit w-[560px] rounded-2xl bg-background-section-burn px-5 py-4",children:[(0,l.jsxs)("span",{className:"system-md-semibold text-text-secondary",children:[e("noData.title",{ns:"appAnnotation"}),(0,l.jsx)(C,{className:"relative -left-1.5 -top-3 inline"})]}),(0,l.jsx)("div",{className:"system-sm-regular mt-2 text-text-tertiary",children:e("noData.description",{ns:"appAnnotation"})})]})})});var L=e.i(291631),S=e.i(552455);let M=i.memo(e=>{let{appId:t,queryParams:s,setQueryParams:a,children:n}=e,{data:r,isLoading:o}=(0,S.useAnnotationsCount)(t),{t:i}=(0,d.useTranslation)();return o||!r?null:(0,l.jsxs)("div",{className:"mb-2 flex flex-row flex-wrap items-center justify-between gap-2",children:[(0,l.jsx)(L.default,{wrapperClassName:"w-[200px]",showLeftIcon:!0,showClearIcon:!0,value:s.keyword,placeholder:i("operation.search",{ns:"common"}),onChange:e=>{a({...s,keyword:e.target.value})},onClear:()=>a({...s,keyword:""})}),n]})});var T=e.i(870804),E=e.i(157169),P=e.i(149649);e.i(668763);var I=e.i(649538);e.i(21511);var R=e.i(382521),R=R,D=e.i(702015),F=e.i(964596),O=e.i(683257),$=e.i(491234),q=e.i(618403),H=e.i(151094),B=e.i(324935),W=e.i(592366),U=e.i(163090);e.i(495815);var G=e.i(141492),z=e.i(726002),Y=e.i(873517),V=((t={}).Query="query",t.Answer="answer",t);let K=i.memo(e=>{let{type:t,content:s,onChange:a}=e,{t:n}=(0,d.useTranslation)(),r="query"===t?(0,l.jsx)(z.User,{className:"h-6 w-6"}):(0,l.jsx)(G.Robot,{className:"h-6 w-6"}),o=n("query"===t?"addModal.queryName":"addModal.answerName",{ns:"appAnnotation"}),i=n("query"===t?"addModal.queryPlaceholder":"addModal.answerPlaceholder",{ns:"appAnnotation"});return(0,l.jsxs)("div",{className:"flex",onClick:e=>e.stopPropagation(),children:[(0,l.jsx)("div",{className:"mr-3 shrink-0",children:r}),(0,l.jsxs)("div",{className:"grow",children:[(0,l.jsx)("div",{className:"system-xs-semibold mb-1 text-text-primary",children:o}),(0,l.jsx)(Y.default,{value:s,onChange:e=>a(e.target.value),placeholder:i,autoFocus:!0})]})]})}),Q=i.memo(e=>{let{isShow:t,onHide:s,onAdd:a}=e,{t:n}=(0,d.useTranslation)(),{plan:r,enableBilling:o}=(0,y.useProviderContext)(),c=o&&r.usage.annotatedResponse>=r.total.annotatedResponse,[p,u]=(0,i.useState)(""),[m,x]=(0,i.useState)(""),[h,g]=(0,i.useState)(!1),[b,f]=(0,i.useState)(!1),j=e=>e.question?!!e.answer||n("errorMessage.answerRequired",{ns:"appAnnotation"}):n("errorMessage.queryRequired",{ns:"appAnnotation"}),w=async()=>{let e={question:p,answer:m};if(!0!==j(e))return void _.default.notify({type:"error",message:j(e)});f(!0);try{await a(e)}catch{}f(!1),h?(u(""),x("")):s()};return(0,l.jsx)("div",{children:(0,l.jsx)(W.default,{isShow:t,onHide:s,maxWidthClassName:"!max-w-[480px]",title:n("addModal.title",{ns:"appAnnotation"}),body:(0,l.jsxs)("div",{className:"space-y-6 p-6 pb-4",children:[(0,l.jsx)(K,{type:V.Query,content:p,onChange:u}),(0,l.jsx)(K,{type:V.Answer,content:m,onChange:x})]}),foot:(0,l.jsxs)("div",{children:[c&&(0,l.jsx)("div",{className:"mb-4 mt-6 px-6",children:(0,l.jsx)(U.default,{})}),(0,l.jsxs)("div",{className:"system-sm-medium flex h-16 items-center justify-between rounded-bl-xl rounded-br-xl border-t border-divider-subtle bg-background-section-burn px-4 text-text-tertiary",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(B.default,{id:"create-next-checkbox",checked:h,onCheck:()=>g(!h)}),(0,l.jsx)("div",{children:n("addModal.createNext",{ns:"appAnnotation"})})]}),(0,l.jsxs)("div",{className:"mt-2 flex space-x-2",children:[(0,l.jsx)(H.default,{className:"h-7 text-xs",onClick:s,children:n("operation.cancel",{ns:"common"})}),(0,l.jsx)(H.default,{className:"h-7 text-xs",variant:"primary",onClick:w,loading:b,disabled:c,children:n("operation.add",{ns:"common"})})]})]})]})})})});var J=e.i(124836),Z=e.i(21151);e.i(288243);var X=e.i(193105);let ee=[["question","answer"],["question1","answer1"],["question2","answer2"]],et=[["问题","答案"],["问题 1","答案 1"],["问题 2","答案 2"]],es=i.memo(()=>{let{t:e}=(0,d.useTranslation)(),t=(0,O.useLocale)(),{CSVDownloader:s,Type:a}=(0,P.useCSVDownloader)();return(0,l.jsxs)("div",{className:"mt-6",children:[(0,l.jsx)("div",{className:"system-sm-medium text-text-primary",children:e("generation.csvStructureTitle",{ns:"share"})}),(0,l.jsx)("div",{className:"mt-2 max-h-[500px] overflow-auto",children:(0,l.jsxs)("table",{className:"w-full table-fixed border-separate border-spacing-0 rounded-lg border border-divider-regular text-xs",children:[(0,l.jsx)("thead",{className:"text-text-tertiary",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{className:"h-9 border-b border-divider-regular pl-3 pr-2",children:e("batchModal.question",{ns:"appAnnotation"})}),(0,l.jsx)("td",{className:"h-9 border-b border-divider-regular pl-3 pr-2",children:e("batchModal.answer",{ns:"appAnnotation"})})]})}),(0,l.jsxs)("tbody",{className:"text-text-secondary",children:[(0,l.jsxs)("tr",{children:[(0,l.jsxs)("td",{className:"h-9 border-b border-divider-subtle pl-3 pr-2 text-[13px]",children:[e("batchModal.question",{ns:"appAnnotation"})," ","1"]}),(0,l.jsxs)("td",{className:"h-9 border-b border-divider-subtle pl-3 pr-2 text-[13px]",children:[e("batchModal.answer",{ns:"appAnnotation"})," ","1"]})]}),(0,l.jsxs)("tr",{children:[(0,l.jsxs)("td",{className:"h-9 pl-3 pr-2 text-[13px]",children:[e("batchModal.question",{ns:"appAnnotation"})," ","2"]}),(0,l.jsxs)("td",{className:"h-9 pl-3 pr-2 text-[13px]",children:[e("batchModal.answer",{ns:"appAnnotation"})," ","2"]})]})]})]})}),(0,l.jsx)(s,{className:"mt-2 block cursor-pointer",type:a.Link,filename:`template-${t}`,bom:!0,data:t!==$.LanguagesSupported[1]?ee:et,children:(0,l.jsxs)("div",{className:"system-xs-medium flex h-[18px] items-center space-x-1 text-text-accent",children:[(0,l.jsx)(X.Download02,{className:"mr-1 h-3 w-3"}),e("batchModal.template",{ns:"appAnnotation"})]})})]})});var ea=e.i(339548);e.i(866473);var en=e.i(260366);let er=i.memo(e=>{let{file:t,updateFile:s}=e,{t:a}=(0,d.useTranslation)(),{notify:n}=(0,ea.useContext)(_.ToastContext),[r,o]=(0,i.useState)(!1),p=(0,i.useRef)(null),u=(0,i.useRef)(null),m=(0,i.useRef)(null),x=e=>{e.preventDefault(),e.stopPropagation(),e.target!==u.current&&o(!0)},h=e=>{e.preventDefault(),e.stopPropagation()},g=e=>{e.preventDefault(),e.stopPropagation(),e.target===u.current&&o(!1)},b=e=>{if(e.preventDefault(),e.stopPropagation(),o(!1),!e.dataTransfer)return;let t=Array.from(e.dataTransfer.files);t.length>1?n({type:"error",message:a("stepOne.uploader.validation.count",{ns:"datasetCreation"})}):s(t[0])},f=()=>{m.current&&m.current.click()};return(0,i.useEffect)(()=>(p.current?.addEventListener("dragenter",x),p.current?.addEventListener("dragover",h),p.current?.addEventListener("dragleave",g),p.current?.addEventListener("drop",b),()=>{p.current?.removeEventListener("dragenter",x),p.current?.removeEventListener("dragover",h),p.current?.removeEventListener("dragleave",g),p.current?.removeEventListener("drop",b)}),[]),(0,l.jsxs)("div",{className:"mt-6",children:[(0,l.jsx)("input",{ref:m,style:{display:"none"},type:"file",id:"fileUploader",accept:".csv",onChange:e=>{s(e.target.files?.[0])}}),(0,l.jsxs)("div",{ref:p,children:[!t&&(0,l.jsxs)("div",{className:(0,k.cn)("system-sm-regular flex h-20 items-center rounded-xl border border-dashed border-components-dropzone-border bg-components-dropzone-bg",r&&"border border-components-dropzone-border-accent bg-components-dropzone-bg-accent"),children:[(0,l.jsxs)("div",{className:"flex w-full items-center justify-center space-x-2",children:[(0,l.jsx)(en.Csv,{className:"shrink-0"}),(0,l.jsxs)("div",{className:"text-text-tertiary",children:[a("batchModal.csvUploadTitle",{ns:"appAnnotation"}),(0,l.jsx)("span",{className:"cursor-pointer text-text-accent",onClick:f,children:a("batchModal.browse",{ns:"appAnnotation"})})]})]}),r&&(0,l.jsx)("div",{ref:u,className:"absolute left-0 top-0 h-full w-full"})]}),t&&(0,l.jsxs)("div",{className:(0,k.cn)("group flex h-20 items-center rounded-xl border border-components-panel-border bg-components-panel-bg px-6 text-sm font-normal","hover:border-components-panel-bg-blur hover:bg-components-panel-bg-blur"),children:[(0,l.jsx)(en.Csv,{className:"shrink-0"}),(0,l.jsxs)("div",{className:"ml-2 flex w-0 grow",children:[(0,l.jsx)("span",{className:"max-w-[calc(100%_-_30px)] overflow-hidden text-ellipsis whitespace-nowrap text-text-primary",children:t.name.replace(/.csv$/,"")}),(0,l.jsx)("span",{className:"shrink-0 text-text-tertiary",children:".csv"})]}),(0,l.jsxs)("div",{className:"hidden items-center group-hover:flex",children:[(0,l.jsx)(H.default,{variant:"secondary",onClick:f,children:a("stepOne.uploader.change",{ns:"datasetCreation"})}),(0,l.jsx)("div",{className:"mx-2 h-4 w-px bg-divider-regular"}),(0,l.jsx)("div",{className:"cursor-pointer p-2",onClick:()=>{m.current&&(m.current.value=""),s()},"data-testid":"remove-file-button",children:(0,l.jsx)(c.RiDeleteBinLine,{className:"h-4 w-4 text-text-tertiary"})})]})]})]})]})});(s={}).WAITING="waiting",s.PROCESSING="processing",s.COMPLETED="completed",s.ERROR="error";let el=i.memo(e=>{let{appId:t,isShow:s,onCancel:a,onAdded:n}=e,{t:r}=(0,d.useTranslation)(),{plan:o,enableBilling:p}=(0,y.useProviderContext)(),u=p&&o.usage.annotatedResponse>=o.total.annotatedResponse,[m,x]=(0,i.useState)();(0,i.useEffect)(()=>{s||x(void 0)},[s]);let[h,g]=(0,i.useState)(),b=_.default.notify,f=async e=>{try{let s=await (0,w.checkAnnotationBatchImportProgress)({jobID:e,appId:t});g(s.job_status),("waiting"===s.job_status||"processing"===s.job_status)&&setTimeout(()=>f(s.job_id),2500),"error"===s.job_status&&b({type:"error",message:`${r("batchModal.runError",{ns:"appAnnotation"})}`}),"completed"===s.job_status&&(b({type:"success",message:`${r("batchModal.completed",{ns:"appAnnotation"})}`}),n(),a())}catch(e){b({type:"error",message:`${r("batchModal.runError",{ns:"appAnnotation"})}${"message"in e?`: ${e.message}`:""}`})}},j=async e=>{let s=new FormData;s.append("file",e);try{let e=await (0,w.annotationBatchImport)({url:`/apps/${t}/annotations/batch-import`,body:s});g(e.job_status),f(e.job_id)}catch(e){b({type:"error",message:`${r("batchModal.runError",{ns:"appAnnotation"})}${"message"in e?`: ${e.message}`:""}`})}};return(0,l.jsxs)(Z.default,{isShow:s,onClose:J.noop,className:"!max-w-[520px] !rounded-xl px-8 py-6",children:[(0,l.jsx)("div",{className:"system-xl-medium relative pb-1 text-text-primary",children:r("batchModal.title",{ns:"appAnnotation"})}),(0,l.jsx)("div",{className:"absolute right-4 top-4 cursor-pointer p-2",onClick:a,children:(0,l.jsx)(c.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})}),(0,l.jsx)(er,{file:m,updateFile:e=>x(e)}),(0,l.jsx)(es,{}),u&&(0,l.jsx)("div",{className:"mt-4",children:(0,l.jsx)(U.default,{})}),(0,l.jsxs)("div",{className:"mt-[28px] flex justify-end pt-6",children:[(0,l.jsx)(H.default,{className:"system-sm-medium mr-2 text-text-tertiary",onClick:a,children:r("batchModal.cancel",{ns:"appAnnotation"})}),(0,l.jsx)(H.default,{variant:"primary",onClick:()=>{m&&j(m)},disabled:u||!m,loading:"processing"===h||"waiting"===h,children:r("batchModal.run",{ns:"appAnnotation"})})]})]})});var eo=e.i(547105);let ei=i.memo(e=>{let{isShow:t,onHide:s,onConfirm:a}=e,{t:n}=(0,d.useTranslation)();return(0,l.jsx)(eo.default,{isShow:t,onCancel:s,onConfirm:a,type:"danger",title:n("table.header.clearAllConfirm",{ns:"appAnnotation"})})}),ed=["Question","Answer"],ec=["问题","答案"],ep=i.memo(e=>{let{appId:t,onAdd:s,onAdded:a,controlUpdateList:n}=e,{t:r}=(0,d.useTranslation)(),o=(0,O.useLocale)(),{CSVDownloader:p,Type:u}=(0,P.useCSVDownloader)(),[m,x]=(0,i.useState)([]),h=0===m.length,g=()=>{let e=new Blob([m.map(e=>`{"messages": [{"role": "system", "content": ""}, {"role": "user", "content": ${JSON.stringify(e.question)}}, {"role": "assistant", "content": ${JSON.stringify(e.answer)}}]}`).join("\n")],{type:"application/jsonl"});(0,q.downloadBlob)({data:e,fileName:`annotations-${o}.jsonl`})},b=i.useCallback(async()=>{let{data:e}=await (0,w.fetchExportAnnotationList)(t);x(e)},[t]);(0,i.useEffect)(()=>{b()},[b]),(0,i.useEffect)(()=>{n&&b()},[n,b]);let[f,j]=(0,i.useState)(!1),[y,v]=(0,i.useState)(!1),N=()=>{v(!0)},_=async()=>{try{await (0,w.clearAllAnnotations)(t),a()}catch(e){console.error(`failed to clear all annotations, ${e}`)}finally{v(!1)}},[C,A]=i.useState(!1);return(0,l.jsxs)("div",{className:"flex space-x-2",children:[(0,l.jsxs)(H.default,{variant:"primary",onClick:()=>A(!0),children:[(0,l.jsx)(c.RiAddLine,{className:"mr-0.5 h-4 w-4"}),(0,l.jsx)("div",{children:r("table.header.addAnnotation",{ns:"appAnnotation"})})]}),(0,l.jsx)(F.default,{htmlContent:(0,l.jsx)(()=>(0,l.jsxs)("div",{className:"w-full py-1",children:[(0,l.jsxs)("button",{type:"button",className:"mx-1 flex h-9 w-[calc(100%_-_8px)] cursor-pointer items-center space-x-2 rounded-lg px-3 py-2 hover:bg-components-panel-on-panel-item-bg-hover disabled:opacity-50",onClick:()=>{j(!0)},children:[(0,l.jsx)(D.FilePlus02,{className:"h-4 w-4 text-text-tertiary"}),(0,l.jsx)("span",{className:"system-sm-regular grow text-left text-text-secondary",children:r("table.header.bulkImport",{ns:"appAnnotation"})})]}),(0,l.jsxs)(T.Menu,{as:"div",className:"relative h-full w-full",children:[(0,l.jsxs)(T.MenuButton,{className:"mx-1 flex h-9 w-[calc(100%_-_8px)] cursor-pointer items-center space-x-2 rounded-lg px-3 py-2 hover:bg-components-panel-on-panel-item-bg-hover disabled:opacity-50",children:[(0,l.jsx)(R.default,{className:"h-4 w-4 text-text-tertiary"}),(0,l.jsx)("span",{className:"system-sm-regular grow text-left text-text-secondary",children:r("table.header.bulkExport",{ns:"appAnnotation"})}),(0,l.jsx)(I.ChevronRight,{className:"h-[14px] w-[14px] shrink-0 text-text-tertiary"})]}),(0,l.jsx)(E.Transition,{as:i.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:(0,l.jsxs)(T.MenuItems,{className:(0,k.cn)("absolute left-1 top-[1px] z-10 min-w-[100px] origin-top-right -translate-x-full rounded-xl border-[0.5px] border-components-panel-on-panel-item-bg bg-components-panel-bg py-1 shadow-xs"),children:[(0,l.jsx)(p,{type:u.Link,filename:`annotations-${o}`,bom:!0,data:[o!==$.LanguagesSupported[1]?ed:ec,...m.map(e=>[e.question,e.answer])],children:(0,l.jsx)("button",{type:"button",disabled:h,className:"mx-1 flex h-9 w-[calc(100%_-_8px)] cursor-pointer items-center space-x-2 rounded-lg px-3 py-2 hover:bg-components-panel-on-panel-item-bg-hover disabled:opacity-50",children:(0,l.jsx)("span",{className:"system-sm-regular grow text-left text-text-secondary",children:"CSV"})})}),(0,l.jsx)("button",{type:"button",disabled:h,className:(0,k.cn)("mx-1 flex h-9 w-[calc(100%_-_8px)] cursor-pointer items-center space-x-2 rounded-lg px-3 py-2 hover:bg-components-panel-on-panel-item-bg-hover disabled:opacity-50","!border-0"),onClick:g,children:(0,l.jsx)("span",{className:"system-sm-regular grow text-left text-text-secondary",children:"JSONL"})})]})})]}),(0,l.jsxs)("button",{type:"button",onClick:N,className:"mx-1 flex h-9 w-[calc(100%_-_8px)] cursor-pointer items-center space-x-2 rounded-lg px-3 py-2 text-red-600 hover:bg-red-50 disabled:opacity-50",children:[(0,l.jsx)(c.RiDeleteBinLine,{className:"h-4 w-4"}),(0,l.jsx)("span",{className:"system-sm-regular grow text-left",children:r("table.header.clearAll",{ns:"appAnnotation"})})]})]}),{}),position:"br",trigger:"click",btnElement:(0,l.jsx)(c.RiMoreFill,{className:"h-4 w-4"}),btnClassName:"btn btn-secondary btn-medium w-8 p-0",className:"!z-20 h-fit !w-[155px]",popupClassName:"!w-full !overflow-visible",manualClose:!0}),C&&(0,l.jsx)(Q,{isShow:C,onHide:()=>A(!1),onAdd:s}),f&&(0,l.jsx)(el,{appId:t,isShow:f,onCancel:()=>j(!1),onAdded:a}),y&&(0,l.jsx)(ei,{isShow:y,onHide:()=>v(!1),onConfirm:_})]})});var eu=e.i(157884),em=e.i(417944),ex=e.i(757198);let eh=i.memo(e=>{let{className:t,selectedIds:s,onBatchDelete:a,onCancel:n}=e,{t:r}=(0,d.useTranslation)(),[o,{setTrue:i,setFalse:p}]=(0,em.useBoolean)(!1),[u,{setTrue:m,setFalse:x}]=(0,em.useBoolean)(!1),h=async()=>{m(),await a(),p(),x()};return(0,l.jsxs)("div",{className:(0,k.cn)("pointer-events-none flex w-full justify-center",t),children:[(0,l.jsxs)("div",{className:"pointer-events-auto flex items-center gap-x-1 rounded-[10px] border border-components-actionbar-border-accent bg-components-actionbar-bg-accent p-1 shadow-xl shadow-shadow-shadow-5 backdrop-blur-[5px]",children:[(0,l.jsxs)("div",{className:"inline-flex items-center gap-x-2 py-1 pl-2 pr-3",children:[(0,l.jsx)("span",{className:"flex h-5 w-5 items-center justify-center rounded-md bg-text-accent px-1 py-0.5 text-xs font-medium text-text-primary-on-surface",children:s.length}),(0,l.jsx)("span",{className:"text-[13px] font-semibold leading-[16px] text-text-accent",children:r("batchAction.selected",{ns:"appAnnotation"})})]}),(0,l.jsx)(ex.default,{type:"vertical",className:"mx-0.5 h-3.5 bg-divider-regular"}),(0,l.jsxs)("div",{className:"flex cursor-pointer items-center gap-x-0.5 px-3 py-2",onClick:i,children:[(0,l.jsx)(c.RiDeleteBinLine,{className:"h-4 w-4 text-components-button-destructive-ghost-text"}),(0,l.jsx)("button",{type:"button",className:"px-0.5 text-[13px] font-medium leading-[16px] text-components-button-destructive-ghost-text",children:r("operation.delete",{ns:"common"})})]}),(0,l.jsx)(ex.default,{type:"vertical",className:"mx-0.5 h-3.5 bg-divider-regular"}),(0,l.jsx)("button",{type:"button",className:"px-3.5 py-2 text-[13px] font-medium leading-[16px] text-components-button-ghost-text",onClick:n,children:r("operation.cancel",{ns:"common"})})]}),o&&(0,l.jsx)(eo.default,{isShow:!0,title:r("list.delete.title",{ns:"appAnnotation"}),confirmText:r("operation.delete",{ns:"common"}),onConfirm:h,onCancel:p,isLoading:u,isDisabled:u})]})}),eg=i.memo(e=>{let{isShow:t,onHide:s,onRemove:a}=e,{t:n}=(0,d.useTranslation)();return(0,l.jsx)(eo.default,{isShow:t,onCancel:s,onConfirm:a,title:n("feature.annotation.removeConfirm",{ns:"appDebug"})})}),eb=i.memo(e=>{let{list:t,onView:s,onRemove:a,selectedIds:n,onSelectedIdsChange:r,onBatchDelete:o,onCancel:p}=e,{t:m}=(0,d.useTranslation)(),{formatTime:x}=(0,eu.default)(),[h,g]=i.useState(null),[b,f]=i.useState(!1),j=(0,i.useMemo)(()=>t.length>0&&t.every(e=>n.includes(e.id)),[t,n]),y=(0,i.useMemo)(()=>t.some(e=>n.includes(e.id)),[t,n]),w=(0,i.useCallback)(()=>{let e=t.map(e=>e.id),s=n.filter(t=>!e.includes(t));j?r(s):r([...s,...e])},[j,t,n,r]);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"relative mt-2 grow overflow-x-auto",children:[(0,l.jsxs)("table",{className:(0,k.cn)("w-full min-w-[440px] border-collapse border-0"),children:[(0,l.jsx)("thead",{className:"system-xs-medium-uppercase text-text-tertiary",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{className:"w-12 whitespace-nowrap rounded-l-lg bg-background-section-burn px-2",children:(0,l.jsx)(B.default,{className:"mr-2",checked:j,indeterminate:!j&&y,onCheck:w})}),(0,l.jsx)("td",{className:"w-5 whitespace-nowrap bg-background-section-burn pl-2 pr-1",children:m("table.header.question",{ns:"appAnnotation"})}),(0,l.jsx)("td",{className:"whitespace-nowrap bg-background-section-burn py-1.5 pl-3",children:m("table.header.answer",{ns:"appAnnotation"})}),(0,l.jsx)("td",{className:"whitespace-nowrap bg-background-section-burn py-1.5 pl-3",children:m("table.header.createdAt",{ns:"appAnnotation"})}),(0,l.jsx)("td",{className:"whitespace-nowrap bg-background-section-burn py-1.5 pl-3",children:m("table.header.hits",{ns:"appAnnotation"})}),(0,l.jsx)("td",{className:"w-[96px] whitespace-nowrap rounded-r-lg bg-background-section-burn py-1.5 pl-3",children:m("table.header.actions",{ns:"appAnnotation"})})]})}),(0,l.jsx)("tbody",{className:"system-sm-regular text-text-secondary",children:t.map(e=>(0,l.jsxs)("tr",{className:"cursor-pointer border-b border-divider-subtle hover:bg-background-default-hover",onClick:()=>{s(e)},children:[(0,l.jsx)("td",{className:"w-12 px-2",onClick:e=>e.stopPropagation(),children:(0,l.jsx)(B.default,{className:"mr-2",checked:n.includes(e.id),onCheck:()=>{n.includes(e.id)?r(n.filter(t=>t!==e.id)):r([...n,e.id])}})}),(0,l.jsx)("td",{className:"max-w-[250px] overflow-hidden text-ellipsis whitespace-nowrap p-3 pr-2",title:e.question,children:e.question}),(0,l.jsx)("td",{className:"max-w-[250px] overflow-hidden text-ellipsis whitespace-nowrap p-3 pr-2",title:e.answer,children:e.answer}),(0,l.jsx)("td",{className:"p-3 pr-2",children:x(e.created_at,m("dateTimeFormat",{ns:"appLog"}))}),(0,l.jsx)("td",{className:"p-3 pr-2",children:e.hit_count}),(0,l.jsx)("td",{className:"w-[96px] p-3 pr-2",onClick:e=>e.stopPropagation(),children:(0,l.jsxs)("div",{className:"flex space-x-1 text-text-tertiary",children:[(0,l.jsx)(u.default,{onClick:()=>s(e),children:(0,l.jsx)(c.RiEditLine,{className:"h-4 w-4"})}),(0,l.jsx)(u.default,{onClick:()=>{g(e.id),f(!0)},children:(0,l.jsx)(c.RiDeleteBinLine,{className:"h-4 w-4"})})]})})]},e.id))})]}),(0,l.jsx)(eg,{isShow:b,onHide:()=>f(!1),onRemove:()=>{a(h),f(!1)}})]}),n.length>0&&(0,l.jsx)(eh,{className:"absolute bottom-20 left-0 z-20",selectedIds:n,onBatchDelete:o,onCancel:p})]})});var ef=e.i(718574),ej=e.i(83278);e.i(977512);var ey=e.i(192326),ew=e.i(988720),ev=e.i(767589);e.i(711786);var eN=e.i(983389),eN=eN;let ek=i.memo(()=>{let{t:e}=(0,d.useTranslation)();return(0,l.jsxs)("div",{className:"mx-auto mt-20 w-[480px] space-y-2 rounded-2xl bg-background-section-burn p-5",children:[(0,l.jsx)("div",{className:"inline-block rounded-lg border border-divider-subtle p-3",children:(0,l.jsx)(eN.default,{className:"h-5 w-5 text-text-tertiary"})}),(0,l.jsx)("div",{className:"system-sm-regular text-text-tertiary",children:e("viewModal.noHitHistory",{ns:"appAnnotation"})})]})});var e_=((a=e_||{}).annotation="annotation",a.hitHistory="hitHistory",a);let eC=i.memo(e=>{let{appId:t,isShow:s,onHide:a,item:n,onSave:r,onRemove:o}=e,{id:c,question:p,answer:u,created_at:m}=n,[x,h]=(0,i.useState)(p),[b,f]=(0,i.useState)(u),{t:y}=(0,d.useTranslation)(),{formatTime:v}=(0,eu.default)(),[N,_]=i.useState(0),[C,A]=(0,i.useState)(0),[L,S]=(0,i.useState)([]);(0,i.useEffect)(()=>{h(p),f(u),_(0),A(0),S([])},[p,u,c]);let M=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;try{let{data:s,total:a}=await (0,w.fetchHitHistoryList)(t,c,{page:e,limit:10});S(s),A(a)}catch{}};(0,i.useEffect)(()=>{M(N+1)},[N]),(0,i.useEffect)(()=>{s&&c&&M(1)},[c,s]);let T=[{value:"annotation",text:y("viewModal.annotatedResponse",{ns:"appAnnotation"})},{value:"hitHistory",text:L.length>0?(0,l.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,l.jsx)("div",{children:y("viewModal.hitHistory",{ns:"appAnnotation"})}),(0,l.jsx)(ej.default,{text:`${C} ${y(`viewModal.hit${L.length>1?"s":""}`,{ns:"appAnnotation"})}`})]}):y("viewModal.hitHistory",{ns:"appAnnotation"})}],[E,P]=(0,i.useState)("annotation"),I=async(e,t)=>{try{e===ev.EditItemType.Query?(await r(t,b),h(t)):(await r(x,t),f(t))}catch(e){console.error("Failed to save annotation:",e)}},[R,D]=(0,i.useState)(!1),F=(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(ev.default,{type:ev.EditItemType.Query,content:p,onSave:e=>I(ev.EditItemType.Query,e)}),(0,l.jsx)(ev.default,{type:ev.EditItemType.Answer,content:u,onSave:e=>I(ev.EditItemType.Answer,e)})]}),O=0===C?(0,l.jsx)(ek,{}):(0,l.jsxs)("div",{children:[(0,l.jsxs)("table",{className:(0,k.cn)("w-full min-w-[440px] border-collapse border-0"),children:[(0,l.jsx)("thead",{className:"system-xs-medium-uppercase text-text-tertiary",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{className:"w-5 whitespace-nowrap rounded-l-lg bg-background-section-burn pl-2 pr-1",children:y("hitHistoryTable.query",{ns:"appAnnotation"})}),(0,l.jsx)("td",{className:"whitespace-nowrap bg-background-section-burn py-1.5 pl-3",children:y("hitHistoryTable.match",{ns:"appAnnotation"})}),(0,l.jsx)("td",{className:"whitespace-nowrap bg-background-section-burn py-1.5 pl-3",children:y("hitHistoryTable.response",{ns:"appAnnotation"})}),(0,l.jsx)("td",{className:"whitespace-nowrap bg-background-section-burn py-1.5 pl-3",children:y("hitHistoryTable.source",{ns:"appAnnotation"})}),(0,l.jsx)("td",{className:"whitespace-nowrap bg-background-section-burn py-1.5 pl-3",children:y("hitHistoryTable.score",{ns:"appAnnotation"})}),(0,l.jsx)("td",{className:"w-[160px] whitespace-nowrap rounded-r-lg bg-background-section-burn py-1.5 pl-3",children:y("hitHistoryTable.time",{ns:"appAnnotation"})})]})}),(0,l.jsx)("tbody",{className:"system-sm-regular text-text-secondary",children:L.map(e=>(0,l.jsxs)("tr",{className:"cursor-pointer border-b border-divider-subtle hover:bg-background-default-hover",children:[(0,l.jsx)("td",{className:"max-w-[250px] overflow-hidden text-ellipsis whitespace-nowrap p-3 pr-2",title:e.question,children:e.question}),(0,l.jsx)("td",{className:"max-w-[250px] overflow-hidden text-ellipsis whitespace-nowrap p-3 pr-2",title:e.match,children:e.match}),(0,l.jsx)("td",{className:"max-w-[250px] overflow-hidden text-ellipsis whitespace-nowrap p-3 pr-2",title:e.response,children:e.response}),(0,l.jsx)("td",{className:"p-3 pr-2",children:e.source}),(0,l.jsx)("td",{className:"p-3 pr-2",children:e.score?e.score.toFixed(2):"-"}),(0,l.jsx)("td",{className:"p-3 pr-2",children:v(e.created_at,y("dateTimeFormat",{ns:"appLog"}))})]},e.id))})]}),C&&C>j.APP_PAGE_LIMIT?(0,l.jsx)(g.default,{className:"px-0",current:N,onChange:_,total:C}):null]});return(0,l.jsx)("div",{children:(0,l.jsx)(W.default,{isShow:s,onHide:a,maxWidthClassName:"!max-w-[800px]",title:(0,l.jsx)(ew.default,{className:"relative top-[9px] shrink-0",value:E,onChange:e=>P(e),options:T,noBorderBottom:!0,itemClassName:"!pb-3.5"}),body:(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"space-y-6 p-6 pb-4",children:"annotation"===E?F:O}),(0,l.jsx)(eo.default,{isShow:R,onCancel:()=>D(!1),onConfirm:async()=>{await o(),D(!1),a()},title:y("feature.annotation.removeConfirm",{ns:"appDebug"})})]}),foot:c?(0,l.jsxs)("div",{className:"system-sm-medium flex h-16 items-center justify-between rounded-bl-xl rounded-br-xl border-t border-divider-subtle bg-background-section-burn px-4 text-text-tertiary",children:[(0,l.jsxs)("div",{className:"flex cursor-pointer items-center space-x-2 pl-3",onClick:()=>D(!0),children:[(0,l.jsx)(ey.MessageCheckRemove,{}),(0,l.jsx)("div",{children:y("editModal.removeThisCache",{ns:"appAnnotation"})})]}),(0,l.jsxs)("div",{children:[y("editModal.createdAt",{ns:"appAnnotation"})," ",v(m,y("dateTimeFormat",{ns:"appLog"}))]})]}):void 0})})}),eA=i.memo(e=>{let{appDetail:t}=e,{t:s}=(0,d.useTranslation)(),[a,n]=(0,i.useState)(!1),[r,o]=(0,i.useState)(null),[C]=(0,i.useState)(t.mode!==v.AppModeEnum.COMPLETION),[L,S]=(0,i.useState)(()=>Date.now()),{plan:T,enableBilling:E}=(0,y.useProviderContext)(),P=E&&T.usage.annotatedResponse>=T.total.annotatedResponse,[I,R]=(0,i.useState)(!1),[D,F]=(0,i.useState)({}),[O,$]=(0,i.useState)(0),[q,H]=(0,i.useState)(j.APP_PAGE_LIMIT),[B,W]=(0,i.useState)([]),[U,G]=(0,i.useState)(0),[z,Y]=(0,i.useState)(!1),[V,K]=(0,i.useState)(()=>Date.now()),[Q,J]=(0,i.useState)(null),[Z,X]=(0,i.useState)(!1),[ee,et]=(0,i.useState)([]),es=(0,p.useDebounce)(D,{wait:500}),ea=async()=>{let e=await (0,w.fetchAnnotationConfig)(t.id);return o(e),e.id};(0,i.useEffect)(()=>{C&&ea()},[]);let en=async(e,s)=>{for(;(await (0,w.queryAnnotationJobStatus)(t.id,s,e)).job_status!==ef.JobStatus.completed;)await (0,N.sleep)(2e3)},er=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;Y(!0);try{let{data:s,total:a}=await (0,w.fetchAnnotationList)(t.id,{page:e,limit:q,keyword:es.keyword||""});W(s),G(a)}finally{Y(!1)}};(0,i.useEffect)(()=>{er(O+1)},[O,q,es]);let el=async e=>{await (0,w.addAnnotation)(t.id,e),_.default.notify({message:s("api.actionSuccess",{ns:"common"}),type:"success"}),er(),K(Date.now())},eo=async e=>{await (0,w.delAnnotation)(t.id,e),_.default.notify({message:s("api.actionSuccess",{ns:"common"}),type:"success"}),er(),K(Date.now())},ei=async()=>{try{await (0,w.delAnnotations)(t.id,ee),_.default.notify({message:s("api.actionSuccess",{ns:"common"}),type:"success"}),er(),K(Date.now()),et([])}catch(e){_.default.notify({type:"error",message:e.message||s("api.actionFailed",{ns:"common"})})}},ed=async(e,a)=>{Q&&(await (0,w.editAnnotation)(t.id,Q.id,{question:e,answer:a}),_.default.notify({message:s("api.actionSuccess",{ns:"common"}),type:"success"}),er(),K(Date.now()))};return(0,i.useEffect)(()=>{a||S(Date.now())},[a]),(0,l.jsxs)("div",{className:"flex h-full flex-col",children:[(0,l.jsx)("p",{className:"system-sm-regular text-text-tertiary",children:s("description",{ns:"appLog"})}),(0,l.jsxs)("div",{className:"relative flex h-full flex-1 flex-col py-4",children:[(0,l.jsx)(M,{appId:t.id,queryParams:D,setQueryParams:F,children:(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[C&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:(0,k.cn)(!r?.enabled&&"pr-2","flex h-7 items-center space-x-1 rounded-lg border border-components-panel-border bg-components-panel-bg-blur pl-2"),children:[(0,l.jsx)(x.default,{className:"h-4 w-4 text-util-colors-indigo-indigo-600"}),(0,l.jsx)("div",{className:"system-sm-medium text-text-primary",children:s("name",{ns:"appAnnotation"})}),(0,l.jsx)(b.default,{defaultValue:r?.enabled,size:"md",onChange:async e=>{if(e){if(P){R(!0),S(Date.now());return}n(!0)}else{let{job_id:e}=await (0,w.updateAnnotationStatus)(t.id,ef.AnnotationEnableStatus.disable,r?.embedding_model,r?.score_threshold);await en(e,ef.AnnotationEnableStatus.disable),await ea(),_.default.notify({message:s("api.actionSuccess",{ns:"common"}),type:"success"})}}},L),r?.enabled&&(0,l.jsxs)("div",{className:"flex items-center pl-1.5",children:[(0,l.jsx)("div",{className:"mr-1 h-3.5 w-[1px] shrink-0 bg-divider-subtle"}),(0,l.jsx)(u.default,{onClick:()=>n(!0),children:(0,l.jsx)(c.RiEqualizer2Line,{className:"h-4 w-4 text-text-tertiary"})})]})]}),(0,l.jsx)("div",{className:"mx-3 h-3.5 w-[1px] shrink-0 bg-divider-regular"})]}),(0,l.jsx)(ep,{appId:t.id,controlUpdateList:V,onAdd:el,onAdded:()=>{er()}})]})}),z?(0,l.jsx)(h.default,{type:"app"}):U>0?(0,l.jsx)(eb,{list:B,onRemove:eo,onView:e=>{J(e),X(!0)},selectedIds:ee,onSelectedIdsChange:et,onBatchDelete:ei,onCancel:()=>et([])}):(0,l.jsx)("div",{className:"flex h-full grow items-center justify-center",children:(0,l.jsx)(A,{})}),U&&U>j.APP_PAGE_LIMIT?(0,l.jsx)(g.default,{current:O,onChange:$,total:U,limit:q,onLimitChange:H}):null,Z&&(0,l.jsx)(eC,{appId:t.id,isShow:Z,onHide:()=>X(!1),onRemove:async()=>{await eo(Q?.id)},item:Q,onSave:ed}),a&&(0,l.jsx)(m.default,{appId:t.id,isShow:!0,isInit:!r?.enabled,onHide:()=>{n(!1)},onSave:async(e,a)=>{if(e.embedding_model_name!==r?.embedding_model?.embedding_model_name||e.embedding_provider_name!==r?.embedding_model?.embedding_provider_name){let{job_id:s}=await (0,w.updateAnnotationStatus)(t.id,ef.AnnotationEnableStatus.enable,e,a);await en(s,ef.AnnotationEnableStatus.enable)}let l=await ea();a!==r?.score_threshold&&await (0,w.updateAnnotationScore)(t.id,l,a),await ea(),_.default.notify({message:s("api.actionSuccess",{ns:"common"}),type:"success"}),n(!1)},annotationConfig:r}),I&&(0,l.jsx)(f.default,{show:I,onHide:()=>R(!1)})]})]})});var eL=e.i(585458);function eS(e,t){let s={...e};for(let e=0;e<t.length;e++){let a=t[e];delete s[a]}return s}var eM=e.i(554327),eT=e.i(321734),eE=e.i(586871),eP=e.i(168014);let eI=e=>{let{className:t}=e;return(0,l.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t??"",children:(0,l.jsx)("path",{d:"M5 6.5V5M8.93934 7.56066L10 6.5M10.0103 11.5H11.5103",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})},eR=i.memo(e=>{var t;let{appDetail:s}=e,{t:a}=(0,d.useTranslation)();return(0,l.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,l.jsxs)("div",{className:"box-border h-fit w-[560px] rounded-2xl bg-background-section-burn px-5 py-4",children:[(0,l.jsxs)("span",{className:"system-md-semibold text-text-secondary",children:[a("table.empty.element.title",{ns:"appLog"}),(0,l.jsx)(eI,{className:"relative -left-1.5 -top-3 inline text-text-secondary"})]}),(0,l.jsx)("div",{className:"system-sm-regular mt-2 text-text-tertiary",children:(0,l.jsx)(eT.Trans,{i18nKey:"table.empty.element.content",ns:"appLog",components:{shareLink:(0,l.jsx)(eM.default,{href:`${s.site.app_base_url}${eP.basePath}/${(t=s.mode)!==v.AppModeEnum.COMPLETION&&t!==v.AppModeEnum.WORKFLOW?v.AppModeEnum.CHAT:t}/${s.site.access_token}`,className:"text-util-colors-blue-blue-600",target:"_blank",rel:"noopener noreferrer"}),testLink:(0,l.jsx)(eM.default,{href:(0,eE.getRedirectionPath)(!0,s),className:"text-util-colors-blue-blue-600"})}})})]})})});var eD=e.i(929808);let eF=i.forwardRef(function(e,t){let{title:s,titleId:a,...n}=e;return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},n),s?i.createElement("title",{id:a},s):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.498 15.25H4.372c-1.026 0-1.945-.694-2.054-1.715a12.137 12.137 0 0 1-.068-1.285c0-2.848.992-5.464 2.649-7.521C5.287 4.247 5.886 4 6.504 4h4.016a4.5 4.5 0 0 1 1.423.23l3.114 1.04a4.5 4.5 0 0 0 1.423.23h1.294M7.498 15.25c.618 0 .991.724.725 1.282A7.471 7.471 0 0 0 7.5 19.75 2.25 2.25 0 0 0 9.75 22a.75.75 0 0 0 .75-.75v-.633c0-.573.11-1.14.322-1.672.304-.76.93-1.33 1.653-1.715a9.04 9.04 0 0 0 2.86-2.4c.498-.634 1.226-1.08 2.032-1.08h.384m-10.253 1.5H9.7m8.075-9.75c.01.05.027.1.05.148.593 1.2.925 2.55.925 3.977 0 1.487-.36 2.89-.999 4.125m.023-8.25c-.076-.365.183-.75.575-.75h.908c.889 0 1.713.518 1.972 1.368.339 1.11.521 2.287.521 3.507 0 1.553-.295 3.036-.831 4.398-.306.774-1.086 1.227-1.918 1.227h-1.053c-.472 0-.745-.556-.5-.96a8.95 8.95 0 0 0 .303-.54"}))}),eO=i.forwardRef(function(e,t){let{title:s,titleId:a,...n}=e;return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},n),s?i.createElement("title",{id:a},s):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.633 10.25c.806 0 1.533-.446 2.031-1.08a9.041 9.041 0 0 1 2.861-2.4c.723-.384 1.35-.956 1.653-1.715a4.498 4.498 0 0 0 .322-1.672V2.75a.75.75 0 0 1 .75-.75 2.25 2.25 0 0 1 2.25 2.25c0 1.152-.26 2.243-.723 3.218-.266.558.107 1.282.725 1.282m0 0h3.126c1.026 0 1.945.694 2.054 1.715.045.422.068.85.068 1.285a11.95 11.95 0 0 1-2.649 7.521c-.388.482-.987.729-1.605.729H13.48c-.483 0-.964-.078-1.423-.23l-3.114-1.04a4.501 4.501 0 0 0-1.423-.23H5.904m10.598-9.75H14.25M5.904 18.5c.083.205.173.405.27.602.197.4-.078.898-.523.898h-.908c-.889 0-1.713-.518-1.972-1.368a12 12 0 0 1-.521-3.507c0-1.553.295-3.036.831-4.398C3.387 9.953 4.167 9.5 5 9.5h1.053c.472 0 .745.556.5.96a8.958 8.958 0 0 0-1.302 4.665c0 1.194.232 2.333.654 3.375Z"}))});var e$=e.i(73920),eq=e.i(287200),eH=e.i(28030),eB=e.i(908432),eW=e.i(391185),eU=e.i(225162),eG=e.i(722591),ez=e.i(540284);let eY={temperature:"Temperature",top_p:"Top P",presence_penalty:"Presence Penalty",max_tokens:"Max Token",stop:"Stop",frequency_penalty:"Frequency Penalty"},eV=i.memo(e=>{let{model:t}=e,{t:s}=(0,d.useTranslation)(),a=t.name,n=t.provider,{currentModel:r,currentProvider:o}=(0,eU.useTextGenerationCurrentProviderAndModelAndModelList)({provider:n,model:a}),[p,u]=i.useState(!1);return(0,l.jsxs)("div",{className:(0,k.cn)("flex items-center rounded-lg"),children:[(0,l.jsxs)("div",{className:"mr-px flex h-8 shrink-0 items-center gap-1 rounded-l-lg bg-components-input-bg-normal pl-1.5 pr-2",children:[(0,l.jsx)(eG.default,{className:"!h-5 !w-5",provider:o,modelName:r?.model}),(0,l.jsx)(ez.default,{modelItem:r,showMode:!0})]}),(0,l.jsx)(eW.PortalToFollowElem,{open:p,onOpenChange:u,placement:"bottom-end",offset:4,children:(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(eW.PortalToFollowElemTrigger,{onClick:()=>u(e=>!e),className:"block",children:(0,l.jsx)("div",{className:(0,k.cn)("cursor-pointer rounded-r-lg bg-components-button-tertiary-bg p-2 hover:bg-components-button-tertiary-bg-hover",p&&"bg-components-button-tertiary-bg-hover"),children:(0,l.jsx)(c.RiInformation2Line,{className:"h-4 w-4 text-text-tertiary"})})}),(0,l.jsx)(eW.PortalToFollowElemContent,{className:"z-[1002]",children:(0,l.jsxs)("div",{className:"relative w-[280px] overflow-hidden rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg px-4 pb-2 pt-3 shadow-xl",children:[(0,l.jsx)("div",{className:"system-sm-semibold-uppercase mb-1 h-6 text-text-secondary",children:s("detail.modelParams",{ns:"appLog"})}),(0,l.jsx)("div",{className:"py-1",children:["temperature","top_p","presence_penalty","max_tokens","stop"].map((e,s)=>(0,l.jsxs)("div",{className:"flex justify-between py-1.5",children:[(0,l.jsx)("span",{className:"system-xs-medium-uppercase text-text-tertiary",children:eY[e]}),(0,l.jsx)("span",{className:"system-xs-medium-uppercase text-text-secondary",children:(e=>{let s=t.completion_params?.[e]||"-";if("stop"===e)if(Array.isArray(s))return s.join(",");else return"-";return s})(e)})]},s))})]})})]})})]})});var eK=e.i(189299),eQ=e.i(419874),eJ=e.i(34510),eZ=e.i(53349),eX=e.i(245962),e0=e.i(521632),e1=e.i(223314),e2=e.i(522617),e5=e.i(421001),e3=e.i(290422),e4=e.i(305230),e6=e.i(711536),e9=e.i(271743),e8=e.i(933548),e7=e.i(447301),te=e.i(83451),tt=e.i(836340);e.i(39598);var ts=e.i(678383),ta=e.i(998020);let tn=i.memo(e=>{let{varList:t,message_files:s}=e,{t:a}=(0,d.useTranslation)(),[n,{toggle:r}]=(0,em.useBoolean)(!1),[o,p]=(0,i.useState)("");return(0,l.jsxs)("div",{className:"rounded-[10px] border border-divider-subtle bg-chat-bubble-bg",children:[(0,l.jsxs)("div",{className:(0,k.cn)("flex cursor-pointer items-center gap-1 border-b border-divider-subtle px-3 pb-2 pt-2.5 text-text-secondary",n&&"border-0 pb-2.5"),onClick:r,children:[(0,l.jsx)(ts.Variable02,{className:"h-4 w-4"}),(0,l.jsx)("div",{className:"system-md-medium grow",children:a("detail.variables",{ns:"appLog"})}),n?(0,l.jsx)(c.RiArrowRightSLine,{className:"h-4 w-4"}):(0,l.jsx)(c.RiArrowDownSLine,{className:"h-4 w-4"})]}),!n&&(0,l.jsxs)("div",{className:"flex max-h-[500px] flex-col gap-2 overflow-y-auto p-3",children:[t.map((e,t)=>{let{label:s,value:a}=e;return(0,l.jsxs)("div",{className:"system-xs-medium flex py-2",children:[(0,l.jsxs)("div",{className:"flex w-[128px] shrink-0 text-text-accent",children:[(0,l.jsx)("span",{className:"shrink-0 opacity-60",children:"{{"}),(0,l.jsx)("span",{className:"truncate",children:s}),(0,l.jsx)("span",{className:"shrink-0 opacity-60",children:"}}"})]}),(0,l.jsx)("div",{className:"whitespace-pre-wrap pl-2.5 text-text-secondary",children:a})]},t)}),s.length>0&&(0,l.jsxs)("div",{className:"mt-1 flex py-2",children:[(0,l.jsx)("div",{className:"system-xs-medium w-[128px] shrink-0 text-text-tertiary",children:a("detail.uploadImages",{ns:"appLog"})}),(0,l.jsx)("div",{className:"flex space-x-2",children:s.map((e,t)=>(0,l.jsx)("div",{className:"ml-2.5 h-16 w-16 cursor-pointer rounded-lg bg-cover bg-center bg-no-repeat",style:{backgroundImage:`url(${e})`},onClick:()=>p(e)},t))})]})]}),o&&(0,l.jsx)(ta.default,{url:o,title:o,onCancel:()=>p("")})]})});eL.default.extend(eq.default),eL.default.extend(e$.default);let tr=(0,ea.createContext)({}),tl=e=>{let{count:t,iconType:s}=e;return(0,l.jsxs)("div",{className:`inline-flex w-fit items-center rounded-md p-1 text-xs ${"up"===s?"text-primary-600 bg-primary-50":"text-red-600 bg-red-50"} mr-1 last:mr-0`,children:[(0,l.jsx)("up"===s?eO:eF,{className:"mr-0.5 h-3 w-3 rounded-md"}),t>0?t:null]})},to=(e,t,s,a)=>{let n=[];try{return e.forEach(e=>{let r=e.message_files?.filter(e=>"user"===e.belongs_to)||[];n.push({id:`question-${e.id}`,content:e.inputs.query||e.inputs.default_input||e.query,isAnswer:!1,message_files:(0,e1.getProcessedFilesFromResponse)(r.map(e=>({...e,related_id:e.id}))),parentMessageId:e.parent_message_id||void 0});let l=e.message_files?.filter(e=>"assistant"===e.belongs_to)||[];n.push({id:e.id,content:e.answer,agent_thoughts:(0,e3.addFileInfos)(e.agent_thoughts?(0,e3.sortAgentSorts)(e.agent_thoughts):e.agent_thoughts,e.message_files),feedback:e.feedbacks?.find(e=>"user"===e.from_source),adminFeedback:e.feedbacks?.find(e=>"admin"===e.from_source),feedbackDisabled:!1,isAnswer:!0,message_files:(0,e1.getProcessedFilesFromResponse)(l.map(e=>({...e,related_id:e.id}))),log:[...e.message??[],...e.message?.[e.message.length-1]?.role!=="assistant"?[{role:"assistant",text:e.answer,files:e.message_files?.filter(e=>"assistant"===e.belongs_to)||[]}]:[]],workflow_run_id:e.workflow_run_id,conversationId:t,input:{inputs:e.inputs,query:e.query},more:{time:eL.default.unix(e.created_at).tz(s).format(a),tokens:e.answer_tokens+e.message_tokens,latency:(e.provider_response_latency??0).toFixed(2)},citation:e.metadata?.retriever_resources,annotation:e.annotation_hit_history?{id:e.annotation_hit_history.annotation_id,authorName:e.annotation_hit_history.annotation_create_account?.name||"N/A",created_at:e.annotation_hit_history.created_at}:e.annotation?{id:e.annotation.id,authorName:e.annotation.account.name,logAnnotation:e.annotation,created_at:0}:void 0,parentMessageId:`question-${e.id}`})}),n}catch(e){throw console.error("getFormattedChatList processing failed:",e),e}};function ti(t){let{detail:s,onFeedback:a}=t,{userProfile:{timezone:n}}=(0,e6.useAppContext)(),{formatTime:r}=(0,eu.default)(),{onClose:o,appDetail:p}=(0,ea.useContext)(tr),{notify:m}=(0,ea.useContext)(_.ToastContext),{currentLogItem:x,setCurrentLogItem:h,showMessageLogModal:g,setShowMessageLogModal:b,showPromptLogModal:f,setShowPromptLogModal:j,currentLogModalActiveTab:y}=(0,eK.useStore)((0,eB.useShallow)(e=>({currentLogItem:e.currentLogItem,setCurrentLogItem:e.setCurrentLogItem,showMessageLogModal:e.showMessageLogModal,setShowMessageLogModal:e.setShowMessageLogModal,showPromptLogModal:e.showPromptLogModal,setShowPromptLogModal:e.setShowPromptLogModal,currentLogModalActiveTab:e.currentLogModalActiveTab}))),{t:w}=(0,d.useTranslation)(),[N,k]=(0,i.useState)(!0),[C,A]=(0,i.useState)({}),L=(0,i.useRef)(!1),S=(0,i.useRef)(null),M=(0,i.useRef)(0),T=(0,i.useRef)(0),E=(0,i.useRef)(0),P=(0,i.useRef)(void 0),[I,R]=(0,i.useState)([]),[D,F]=(0,i.useState)([]),[O,$]=(0,i.useState)([]),q=(0,i.useCallback)(async()=>{if(L.current||!N)return;S.current&&S.current.abort();let e=new AbortController;S.current=e;let t=++M.current;try{L.current=!0;let a={conversation_id:s.id,limit:10};P.current&&(a.first_id=P.current);let r=await (0,e8.fetchChatMessages)({url:`/apps/${p?.id}/chat-messages`,params:a});if(t!==M.current||e.signal.aborted)return;if(r.data.length>0){let e=r.data.at(-1).inputs;A(e)}k(r.has_more);let l=to(r.data,s.id,n,w("dateTimeFormat",{ns:"appLog"}));R(e=>{let t=new Set(e.map(e=>e.id));return[...l.filter(e=>!t.has(e.id)),...e]})}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;console.error("fetchData execution failed:",e)}finally{L.current=!1,S.current===e&&(S.current=null)}},[s.id,N,n,w,p,s?.model_config?.configs?.introduction]);(0,i.useEffect)(()=>{if(0===I.length)return;let e=(0,eZ.buildChatItemTree)(I);!N&&s?.model_config?.configs?.introduction&&(e=[{id:"introduction",isAnswer:!0,isOpeningStatement:!0,content:s?.model_config?.configs?.introduction??"hello",feedbackDisabled:!0,children:e}]),F(e);let t=I.length>0?I[I.length-1].id:void 0;$((0,eZ.getThreadMessages)(e,t));let a=I.filter(e=>e.isAnswer)[0];a?.id&&(P.current=a.id)},[I,N,s?.model_config?.configs?.introduction]);let H=(0,i.useCallback)(e=>{$((0,eZ.getThreadMessages)(D,e))},[D]),B=(0,i.useCallback)((e,t,s)=>{R(I.map((a,n)=>n===s-1?{...a,content:e}:n===s?{...a,annotation:{...a.annotation,logAnnotation:{...a.annotation?.logAnnotation,content:t}}}:a))},[I]),W=(0,i.useCallback)((e,t,s,a,n)=>{R(I.map((r,l)=>l===n-1?{...r,content:s}:l===n?{...r,content:r.content,annotation:{id:e,authorName:t,logAnnotation:{content:a,account:{id:"",name:t,email:""}}}}:r))},[I]),U=(0,i.useCallback)(async t=>{let s=I[t]?.annotation;try{if(s?.id){let{delAnnotation:t}=await e.A(320876);await t(p?.id||"",s.id)}return R(I.map((e,s)=>s===t?{...e,content:e.content,annotation:void 0}:e)),m({type:"success",message:w("actionMsg.modifiedSuccessfully",{ns:"common"})}),!0}catch{return m({type:"error",message:w("actionMsg.modifiedUnsuccessfully",{ns:"common"})}),!1}},[I,p?.id,w]),G=(0,i.useRef)(!1);(0,i.useEffect)(()=>{p?.id&&s.id&&p?.mode!==v.AppModeEnum.COMPLETION&&!G.current&&(G.current=!0,q())},[p?.id,s.id,p?.mode,q]);let[z,Y]=(0,i.useState)(!1),V=(0,i.useCallback)(async()=>{if(z||!N||!p?.id||!s.id)return;let e=Date.now();if(!(e-T.current<200)){T.current=e,Y(!0);try{let e={conversation_id:s.id,limit:10};P.current&&(e.first_id=P.current);let t=await (0,e8.fetchChatMessages)({url:`/apps/${p.id}/chat-messages`,params:e});if(!t.data||0===t.data.length){k(!1),E.current=0;return}if(t.data.length>0){let e=t.data.at(-1).inputs;A(e)}k(t.has_more);let a=to(t.data,s.id,n,w("dateTimeFormat",{ns:"appLog"}));R(e=>{let t=new Set(e.map(e=>e.id)),s=a.filter(e=>!t.has(e.id));if(0===s.length)if(E.current<3&&e.length>1)return E.current++,e;else return E.current=0,e;return E.current=0,[...s,...e]})}catch(e){console.error(e),k(!1),E.current=0}finally{Y(!1)}}},[s.id,N,z,n,w,p,s?.model_config?.configs?.introduction]),K=(0,i.useCallback)(()=>{let e=document.getElementById("scrollableDiv");if(!e)return;let t=e.clientHeight,s=e.scrollHeight;Math.abs(e.scrollTop)>s-t-40&&N&&!z&&V()},[N,z,V]),Q=p?.mode!==v.AppModeEnum.COMPLETION,Z=p?.mode===v.AppModeEnum.ADVANCED_CHAT,X=s.model_config.user_input_form?.map(e=>{let t=e[Object.keys(e)[0]];return{label:t.variable,value:C[t.variable]||s.message?.inputs?.[t.variable]}})||[],ee=!Q&&s.message.message_files&&s.message.message_files.length>0?s.message.message_files.map(e=>e.url):[],[et,es]=(0,i.useState)(0),en=(0,i.useRef)(null),er=()=>{en.current&&es(document.body.clientWidth-(en.current?.clientWidth+16)-8)};return(0,i.useEffect)(()=>{let e=requestAnimationFrame(er);return()=>cancelAnimationFrame(e)},[]),(0,l.jsxs)("div",{ref:en,className:"flex h-full flex-col rounded-xl border-[0.5px] border-components-panel-border",children:[(0,l.jsxs)("div",{className:"flex shrink-0 items-center gap-2 rounded-t-xl bg-components-panel-bg pb-2 pl-4 pr-3 pt-3",children:[(0,l.jsxs)("div",{className:"shrink-0",children:[(0,l.jsx)("div",{className:"system-xs-semibold-uppercase mb-0.5 text-text-primary",children:Q?w("detail.conversationId",{ns:"appLog"}):w("detail.time",{ns:"appLog"})}),Q&&(0,l.jsxs)("div",{className:"system-2xs-regular-uppercase flex items-center text-text-secondary",children:[(0,l.jsx)(e5.default,{popupContent:s.id,children:(0,l.jsx)("div",{className:"truncate",children:s.id})}),(0,l.jsx)(eX.default,{content:s.id})]}),!Q&&(0,l.jsx)("div",{className:"system-2xs-regular-uppercase text-text-secondary",children:r(s.created_at,w("dateTimeFormat",{ns:"appLog"}))})]}),(0,l.jsx)("div",{className:"flex grow flex-wrap items-center justify-end gap-y-1",children:!Z&&(0,l.jsx)(eV,{model:s.model_config.model})}),(0,l.jsx)(u.default,{size:"l",onClick:o,children:(0,l.jsx)(c.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})})]}),(0,l.jsx)("div",{className:"shrink-0 px-1 pt-1",children:(0,l.jsx)("div",{className:"rounded-t-xl bg-background-section-burn p-3 pb-2",children:(X.length>0||!Q&&ee.length>0)&&(0,l.jsx)(tn,{varList:X,message_files:ee})})}),(0,l.jsx)("div",{className:"mx-1 mb-1 grow overflow-auto rounded-b-xl bg-background-section-burn",children:Q?O.length<8?(0,l.jsx)("div",{className:"mb-4 pt-4",children:(0,l.jsx)(eJ.default,{config:{appId:p?.id,text_to_speech:{enabled:!0},questionEditEnable:!1,supportAnnotation:!0,annotation_reply:{enabled:!0},supportFeedback:!0},chatList:O,onAnnotationAdded:W,onAnnotationEdited:B,onAnnotationRemoved:U,onFeedback:a,noChatInput:!0,showPromptLog:!0,hideProcessDetail:!0,chatContainerInnerClassName:"px-3",switchSibling:H})}):(0,l.jsxs)("div",{className:"py-4",id:"scrollableDiv",style:{display:"flex",flexDirection:"column-reverse",height:"100%",overflow:"auto"},onScroll:K,children:[(0,l.jsx)("div",{className:"flex w-full flex-col-reverse",style:{position:"relative"},children:(0,l.jsx)(eJ.default,{config:{appId:p?.id,text_to_speech:{enabled:!0},questionEditEnable:!1,supportAnnotation:!0,annotation_reply:{enabled:!0},supportFeedback:!0},chatList:O,onAnnotationAdded:W,onAnnotationEdited:B,onAnnotationRemoved:U,onFeedback:a,noChatInput:!0,showPromptLog:!0,hideProcessDetail:!0,chatContainerInnerClassName:"px-3",switchSibling:H})}),N&&(0,l.jsx)("div",{className:"py-3 text-center",children:(0,l.jsxs)("div",{className:"system-xs-regular text-text-tertiary",children:[w("detail.loading",{ns:"appLog"}),"..."]})})]}):(0,l.jsxs)("div",{className:"px-6 py-4",children:[(0,l.jsxs)("div",{className:"flex h-[18px] items-center space-x-3",children:[(0,l.jsx)("div",{className:"system-xs-semibold-uppercase text-text-tertiary",children:w("table.header.output",{ns:"appLog"})}),(0,l.jsx)("div",{className:"h-px grow",style:{background:"linear-gradient(270deg, rgba(243, 244, 246, 0) 0%, rgb(243, 244, 246) 100%)"}})]}),(0,l.jsx)(eQ.default,{appSourceType:e7.AppSourceType.webApp,className:"mt-2",content:s.message.answer,messageId:s.message.id,isError:!1,onRetry:J.noop,supportFeedback:!0,feedback:s.message.feedbacks.find(e=>"admin"===e.from_source),onFeedback:e=>a(s.message.id,e),isShowTextToSpeech:!0,siteInfo:null})]})}),g&&(0,l.jsx)(e4.WorkflowContextProvider,{children:(0,l.jsx)(e2.default,{width:et,currentLogItem:x,onCancel:()=>{h(),b(!1)},defaultTab:y})}),!Q&&f&&(0,l.jsx)(te.default,{width:et,currentLogItem:x,onCancel:()=>{h(),j(!1)}})]})}let td=e=>{let{appId:t,conversationId:s}=e,{data:a,refetch:n}=(0,S.useCompletionConversationDetail)(t,s),{notify:r}=(0,ea.useContext)(_.ToastContext),{t:o}=(0,d.useTranslation)(),i=async(e,s)=>{let{rating:a,content:l}=s;try{return await (0,e8.updateLogMessageFeedbacks)({url:`/apps/${t}/feedbacks`,body:{message_id:e,rating:a,content:l??void 0}}),n(),r({type:"success",message:o("actionMsg.modifiedSuccessfully",{ns:"common"})}),!0}catch{return r({type:"error",message:o("actionMsg.modifiedUnsuccessfully",{ns:"common"})}),!1}},c=async(e,s)=>{try{return await (0,e8.updateLogMessageAnnotations)({url:`/apps/${t}/annotations`,body:{message_id:e,content:s}}),n(),r({type:"success",message:o("actionMsg.modifiedSuccessfully",{ns:"common"})}),!0}catch{return r({type:"error",message:o("actionMsg.modifiedUnsuccessfully",{ns:"common"})}),!1}};return a?(0,l.jsx)(ti,{detail:a,onFeedback:i,onSubmitAnnotation:c}):null},tc=e=>{let{appId:t,conversationId:s}=e,{data:a}=(0,S.useChatConversationDetail)(t,s),{notify:n}=(0,ea.useContext)(_.ToastContext),{t:r}=(0,d.useTranslation)(),o=async(e,s)=>{let{rating:a,content:l}=s;try{return await (0,e8.updateLogMessageFeedbacks)({url:`/apps/${t}/feedbacks`,body:{message_id:e,rating:a,content:l??void 0}}),n({type:"success",message:r("actionMsg.modifiedSuccessfully",{ns:"common"})}),!0}catch{return n({type:"error",message:r("actionMsg.modifiedUnsuccessfully",{ns:"common"})}),!1}},i=async(e,s)=>{try{return await (0,e8.updateLogMessageAnnotations)({url:`/apps/${t}/annotations`,body:{message_id:e,content:s}}),n({type:"success",message:r("actionMsg.modifiedSuccessfully",{ns:"common"})}),!0}catch{return n({type:"error",message:r("actionMsg.modifiedUnsuccessfully",{ns:"common"})}),!1}};return a?(0,l.jsx)(ti,{detail:a,onFeedback:o,onSubmitAnnotation:i}):null},tp=e=>{let{logs:t,appDetail:s,onRefresh:a}=e,{t:n}=(0,d.useTranslation)(),{formatTime:r}=(0,eu.default)(),p=(0,o.useRouter)(),u=(0,o.usePathname)(),m=(0,o.useSearchParams)(),x=m.get("conversation_id")??void 0,g=(0,e9.default)()===e9.MediaType.mobile,[b,f]=(0,i.useState)(!1),[j,y]=(0,i.useState)(),w=(0,i.useRef)(null),N=(0,i.useRef)(null),_=(0,i.useRef)(void 0),C=s.mode!==v.AppModeEnum.COMPLETION,A=s.mode===v.AppModeEnum.ADVANCED_CHAT,{setShowPromptLogModal:L,setShowAgentLogModal:S,setShowMessageLogModal:M}=(0,eK.useStore)((0,eB.useShallow)(e=>({setShowPromptLogModal:e.setShowPromptLogModal,setShowAgentLogModal:e.setShowAgentLogModal,setShowMessageLogModal:e.setShowMessageLogModal}))),T=x??N.current??j?.id,E=(0,i.useCallback)(e=>{let t=new URLSearchParams(m.toString());e?t.set("conversation_id",e):t.delete("conversation_id");let s=t.toString();return s?`${u}?${s}`:u},[u,m]),P=(0,i.useCallback)(e=>{if(x===e.id){b||f(!0),j&&j.id===e.id||y(e);return}N.current=e.id,_.current=e,b||f(!0),j?.id!==e.id&&y(void 0),p.push(E(e.id),{scroll:!1})},[E,x,j,p,b]),I=j?.id;(0,i.useEffect)(()=>{if(!x){if(N.current)return;(b||I)&&(f(!1),y(void 0)),w.current=null,_.current=void 0;return}if(w.current===x)return;N.current===x&&(N.current=null);let e=t?.data?.find(e=>e.id===x),s=e??_.current??{id:x,isPlaceholder:!0};b||f(!0),j&&j.id===x&&("created_at"in j||!e)||y(s),(_.current?.id===x||e)&&(_.current=void 0)},[x,j,C,t?.data,b]);let R=(0,i.useCallback)(()=>{a(),f(!1),y(void 0),L(!1),S(!1),M(!1),N.current=null,_.current=void 0,w.current=x??null,x&&p.replace(E(),{scroll:!1})},[E,x,a,p,S,M,L]),D=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0;return(0,l.jsx)(e5.default,{popupContent:(0,l.jsxs)("span",{className:"inline-flex items-center text-xs text-text-tertiary",children:[(0,l.jsx)(c.RiEditFill,{className:"mr-1 h-3 w-3"}),`${n("detail.annotationTip",{ns:"appLog",user:a?.account?.name})} ${r(a?.created_at||(0,eL.default)().unix(),"MM-DD hh:mm A")}`]}),popupClassName:s&&!C?"":"!hidden",children:(0,l.jsx)("div",{className:(0,k.cn)(t?"text-text-quaternary":"text-text-secondary",s?"bg-orange-100":"","system-sm-regular overflow-hidden text-ellipsis whitespace-nowrap"),children:e||"-"})})};return t?(0,l.jsxs)("div",{className:"relative mt-2 grow overflow-x-auto",children:[(0,l.jsxs)("table",{className:(0,k.cn)("w-full min-w-[440px] border-collapse border-0"),children:[(0,l.jsx)("thead",{className:"system-xs-medium-uppercase text-text-tertiary",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{className:"w-5 whitespace-nowrap rounded-l-lg bg-background-section-burn pl-2 pr-1"}),(0,l.jsx)("td",{className:"whitespace-nowrap bg-background-section-burn py-1.5 pl-3",children:C?n("table.header.summary",{ns:"appLog"}):n("table.header.input",{ns:"appLog"})}),(0,l.jsx)("td",{className:"whitespace-nowrap bg-background-section-burn py-1.5 pl-3",children:n("table.header.endUser",{ns:"appLog"})}),A&&(0,l.jsx)("td",{className:"whitespace-nowrap bg-background-section-burn py-1.5 pl-3",children:n("table.header.status",{ns:"appLog"})}),(0,l.jsx)("td",{className:"whitespace-nowrap bg-background-section-burn py-1.5 pl-3",children:C?n("table.header.messageCount",{ns:"appLog"}):n("table.header.output",{ns:"appLog"})}),(0,l.jsx)("td",{className:"whitespace-nowrap bg-background-section-burn py-1.5 pl-3",children:n("table.header.userRate",{ns:"appLog"})}),(0,l.jsx)("td",{className:"whitespace-nowrap bg-background-section-burn py-1.5 pl-3",children:n("table.header.adminRate",{ns:"appLog"})}),(0,l.jsx)("td",{className:"whitespace-nowrap bg-background-section-burn py-1.5 pl-3",children:n("table.header.updatedTime",{ns:"appLog"})}),(0,l.jsx)("td",{className:"whitespace-nowrap rounded-r-lg bg-background-section-burn py-1.5 pl-3",children:n("table.header.time",{ns:"appLog"})})]})}),(0,l.jsx)("tbody",{className:"system-sm-regular text-text-secondary",children:t.data.map(e=>{var t;let s=e.from_end_user_session_id||e.from_account_name,a=(0,eH.get)(e,C?"name":"message.inputs.query")||(C?"":(0,eH.get)(e,"message.query")||(0,eH.get)(e,"message.inputs.default_input"))||"",o=(0,eH.get)(e,C?"message_count":"message.answer");return(0,l.jsxs)("tr",{className:(0,k.cn)("cursor-pointer border-b border-divider-subtle hover:bg-background-default-hover",T!==e.id?"":"bg-background-default-hover"),onClick:()=>P(e),children:[(0,l.jsx)("td",{className:"h-4",children:!e.read_at&&(0,l.jsx)("div",{className:"flex items-center p-3 pr-0.5",children:(0,l.jsx)("span",{className:"inline-block h-1.5 w-1.5 rounded bg-util-colors-blue-blue-500"})})}),(0,l.jsx)("td",{className:"w-[160px] p-3 pr-2",style:{maxWidth:C?300:200},children:D(a||n("table.empty.noChat",{ns:"appLog"}),!a,C&&e.annotated)}),(0,l.jsx)("td",{className:"p-3 pr-2",children:D(s||"N/A",!s)}),A&&(0,l.jsx)("td",{className:"w-[160px] p-3 pr-2",style:{maxWidth:C?300:200},children:(t=e.status_count)?t.partial_success+t.failed===0?(0,l.jsxs)("div",{className:"system-xs-semibold-uppercase inline-flex items-center gap-1",children:[(0,l.jsx)(tt.default,{color:"green"}),(0,l.jsx)("span",{className:"text-util-colors-green-green-600",children:"Success"})]}):0===t.failed?(0,l.jsxs)("div",{className:"system-xs-semibold-uppercase inline-flex items-center gap-1",children:[(0,l.jsx)(tt.default,{color:"green"}),(0,l.jsx)("span",{className:"text-util-colors-green-green-600",children:"Partial Success"})]}):(0,l.jsxs)("div",{className:"system-xs-semibold-uppercase inline-flex items-center gap-1",children:[(0,l.jsx)(tt.default,{color:"red"}),(0,l.jsxs)("span",{className:"text-util-colors-red-red-600",children:[t.failed," ",`${t.failed>1?"Failures":"Failure"}`]})]}):null}),(0,l.jsx)("td",{className:"p-3 pr-2",style:{maxWidth:C?100:200},children:D(0===o?0:o||n("table.empty.noOutput",{ns:"appLog"}),!o,!C&&!!e.annotation?.content,e.annotation)}),(0,l.jsx)("td",{className:"p-3 pr-2",children:e.user_feedback_stats.like||e.user_feedback_stats.dislike?(0,l.jsxs)(l.Fragment,{children:[!!e.user_feedback_stats.like&&(0,l.jsx)(tl,{iconType:"up",count:e.user_feedback_stats.like}),!!e.user_feedback_stats.dislike&&(0,l.jsx)(tl,{iconType:"down",count:e.user_feedback_stats.dislike})]}):D("N/A",!0)}),(0,l.jsx)("td",{className:"p-3 pr-2",children:e.admin_feedback_stats.like||e.admin_feedback_stats.dislike?(0,l.jsxs)(l.Fragment,{children:[!!e.admin_feedback_stats.like&&(0,l.jsx)(tl,{iconType:"up",count:e.admin_feedback_stats.like}),!!e.admin_feedback_stats.dislike&&(0,l.jsx)(tl,{iconType:"down",count:e.admin_feedback_stats.dislike})]}):D("N/A",!0)}),(0,l.jsx)("td",{className:"w-[160px] p-3 pr-2",children:r(e.updated_at,n("dateTimeFormat",{ns:"appLog"}))}),(0,l.jsx)("td",{className:"w-[160px] p-3 pr-2",children:r(e.created_at,n("dateTimeFormat",{ns:"appLog"}))})]},e.id)})})]}),(0,l.jsx)(e0.default,{isOpen:b,onClose:R,mask:g,footer:null,panelClassName:"mt-16 mx-2 sm:mr-2 mb-4 !p-0 !max-w-[640px] rounded-xl bg-components-panel-bg",children:(0,l.jsx)(tr.Provider,{value:{onClose:R,appDetail:s},children:C?(0,l.jsx)(tc,{appId:s.id,conversationId:j?.id}):(0,l.jsx)(td,{appId:s.id,conversationId:j?.id})})})]}):(0,l.jsx)(h.default,{})},tu={period:"2",annotation_status:"all",sort_by:"-created_at"},tm=new Map,tx=e=>{let{appDetail:t}=e,{t:s}=(0,d.useTranslation)(),a=(0,o.useRouter)(),n=(0,o.usePathname)(),r=(0,o.useSearchParams)(),c=(0,i.useCallback)(()=>{let e=Number.parseInt(r.get("page")||"1",10);return Number.isNaN(e)||e<1?0:e-1},[r]),u=tm.get(t.id),[m,x]=(0,i.useState)(u?.queryParams??tu),[b,f]=i.useState(()=>u?.currPage??c()),[y,w]=i.useState(u?.limit??j.APP_PAGE_LIMIT),N=(0,p.useDebounce)(m,{wait:500});(0,i.useEffect)(()=>{let e=c();f(t=>t===e?t:e)},[c]),(0,i.useEffect)(()=>{tm.set(t.id,{queryParams:m,currPage:b,limit:y})},[t.id,b,y,m]);let k=t.mode!==v.AppModeEnum.COMPLETION,_={page:b+1,limit:y,..."9"!==N.period?{start:(0,eL.default)().subtract(eD.TIME_PERIOD_MAPPING[N.period].value,"day").startOf("day").format("YYYY-MM-DD HH:mm"),end:(0,eL.default)().endOf("day").format("YYYY-MM-DD HH:mm")}:{},...k?{sort_by:N.sort_by}:{},...eS(N,["period"])},{data:C,refetch:A}=(0,S.useChatConversations)({appId:k?t.id:"",params:_}),{data:L,refetch:M}=(0,S.useCompletionConversations)({appId:k?"":t.id,params:_}),T=k?C?.total:L?.total,E=(0,i.useCallback)(e=>{f(0),x(e)},[]),P=(0,i.useCallback)(e=>{f(e);let t=new URLSearchParams(r.toString()),s=e+1;1===s?t.delete("page"):t.set("page",String(s));let l=t.toString();a.replace(l?`${n}?${l}`:n,{scroll:!1})},[n,a,r]);return(0,l.jsxs)("div",{className:"flex h-full grow flex-col",children:[(0,l.jsx)("p",{className:"system-sm-regular shrink-0 text-text-tertiary",children:s("description",{ns:"appLog"})}),(0,l.jsxs)("div",{className:"flex max-h-[calc(100%-16px)] flex-1 grow flex-col py-4",children:[(0,l.jsx)(eD.default,{isChatMode:k,appId:t.id,queryParams:m,setQueryParams:E}),void 0===T?(0,l.jsx)(h.default,{type:"app"}):T>0?(0,l.jsx)(tp,{logs:k?C:L,appDetail:t,onRefresh:k?A:M}):(0,l.jsx)(eR,{appDetail:t}),T&&T>j.APP_PAGE_LIMIT?(0,l.jsx)(g.default,{current:b,onChange:P,total:T,limit:y,onLimitChange:w}):null]})]})};var th=e.i(125955),tg=e.i(207331),tb=e.i(748573);eL.default.extend(th.default);let tf=(0,eL.default)(),tj={1:{value:0,name:"today"},2:{value:7,name:"last7days"},3:{value:28,name:"last4weeks"},4:{value:tf.diff(tf.subtract(3,"month"),"day"),name:"last3months"},5:{value:tf.diff(tf.subtract(12,"month"),"day"),name:"last12months"},6:{value:tf.diff(tf.startOf("month"),"day"),name:"monthToDate"},7:{value:tf.diff(tf.startOf("quarter"),"day"),name:"quarterToDate"},8:{value:tf.diff(tf.startOf("year"),"day"),name:"yearToDate"},9:{value:-1,name:"allTime"}},ty=e=>{let{queryParams:t,setQueryParams:s}=e,{t:a}=(0,d.useTranslation)();return(0,l.jsxs)("div",{className:"mb-2 flex flex-row flex-wrap gap-2",children:[(0,l.jsx)(tb.default,{value:t.status||"all",onSelect:e=>{s({...t,status:e.value}),(0,tg.trackEvent)("workflow_log_filter_status_selected",{workflow_log_filter_status:e.value})},onClear:()=>s({...t,status:"all"}),items:[{value:"all",name:"All"},{value:"succeeded",name:"Success"},{value:"failed",name:"Fail"},{value:"stopped",name:"Stop"},{value:"partial-succeeded",name:"Partial Success"}]}),(0,l.jsx)(tb.default,{className:"min-w-[150px]",panelClassName:"w-[270px]",leftIcon:(0,l.jsx)(c.RiCalendarLine,{className:"h-4 w-4 text-text-secondary"}),value:t.period,onSelect:e=>{s({...t,period:e.value})},onClear:()=>s({...t,period:"9"}),items:Object.entries(tj).map(e=>{let[t,s]=e;return{value:t,name:a(`filter.period.${s.name}`,{ns:"appLog"})}})}),(0,l.jsx)(L.default,{wrapperClassName:"w-[200px]",showLeftIcon:!0,showClearIcon:!0,value:t.keyword??"",placeholder:a("operation.search",{ns:"common"}),onChange:e=>{s({...t,keyword:e.target.value})},onClear:()=>s({...t,keyword:""})})]})},tw=i.forwardRef(function(e,t){let{title:s,titleId:a,...n}=e;return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},n),s?i.createElement("title",{id:a},s):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 13.5 12 21m0 0-7.5-7.5M12 21V3"}))});var tv=e.i(344595);let tN=e=>{let{runID:t,onClose:s,canReplay:a=!1}=e,{t:n}=(0,d.useTranslation)(),r=(0,eK.useStore)(e=>e.appDetail),i=(0,o.useRouter)();return(0,l.jsxs)("div",{className:"relative flex grow flex-col pt-3",children:[(0,l.jsx)("span",{className:"absolute right-3 top-4 z-20 cursor-pointer p-1",onClick:s,children:(0,l.jsx)(c.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})}),(0,l.jsxs)("div",{className:"flex items-center bg-components-panel-bg",children:[(0,l.jsx)("h1",{className:"system-xl-semibold shrink-0 px-4 py-1 text-text-primary",children:n("runDetail.workflowTitle",{ns:"appLog"})}),a&&(0,l.jsx)(e5.default,{popupContent:n("runDetail.testWithParams",{ns:"appLog"}),popupClassName:"rounded-xl",children:(0,l.jsx)("button",{type:"button",className:"mr-1 flex h-6 w-6 items-center justify-center rounded-md hover:bg-state-base-hover","aria-label":n("runDetail.testWithParams",{ns:"appLog"}),onClick:()=>{r?.id&&i.push(`/app/${r.id}/workflow?replayRunId=${t}`)},children:(0,l.jsx)(c.RiPlayLargeLine,{className:"h-4 w-4 text-text-tertiary"})})})]}),(0,l.jsx)(e4.WorkflowContextProvider,{children:(0,l.jsx)(tv.default,{runDetailUrl:t?`/apps/${r?.id}/workflow-runs/${t}`:"",tracingListUrl:t?`/apps/${r?.id}/workflow-runs/${t}/node-executions`:""})})]})};e.i(916131);var tk=e.i(415260),t_=e.i(952944),tC=e.i(963779),tA=e.i(36411),tL=e.i(462057),tS=e.i(120219),tM=e.i(390622),tT=e.i(922521),tE=((n={}).DEBUGGING="debugging",n.APP_RUN="app-run",n.RAG_PIPELINE_RUN="rag-pipeline-run",n.RAG_PIPELINE_DEBUGGING="rag-pipeline-debugging",n.WEBHOOK="webhook",n.SCHEDULE="schedule",n.PLUGIN="plugin",n);let tP=e=>{let{triggeredFrom:t,className:s="",showText:a=!0,triggerMetadata:n}=e,{t:r}=(0,d.useTranslation)(),{theme:o}=(0,tT.default)(),i=t===tE.PLUGIN&&n?.event_name?n.event_name:({debugging:r("triggerBy.debugging",{ns:"appLog"}),"app-run":r("triggerBy.appRun",{ns:"appLog"}),webhook:r("triggerBy.webhook",{ns:"appLog"}),schedule:r("triggerBy.schedule",{ns:"appLog"}),plugin:r("triggerBy.plugin",{ns:"appLog"}),"rag-pipeline-run":r("triggerBy.ragPipelineRun",{ns:"appLog"}),"rag-pipeline-debugging":r("triggerBy.ragPipelineDebugging",{ns:"appLog"})})[t]||t,c=((e,t,s)=>{switch(e){case"webhook":return(0,l.jsx)("div",{className:"rounded-lg border-[0.5px] border-divider-subtle bg-util-colors-blue-blue-500 p-1 shadow-md",children:(0,l.jsx)(tA.WebhookLine,{className:"h-4 w-4 text-text-primary-on-surface"})});case"schedule":return(0,l.jsx)("div",{className:"rounded-lg border-[0.5px] border-divider-subtle bg-util-colors-violet-violet-500 p-1 shadow-md",children:(0,l.jsx)(tC.Schedule,{className:"h-4 w-4 text-text-primary-on-surface"})});case"plugin":return((e,t)=>{if(!e)return null;let s=t===v.Theme.dark?e.icon_dark||e.icon:e.icon||e.icon_dark;return s?(0,l.jsx)(tS.default,{type:tM.BlockEnum.TriggerPlugin,size:"md",toolIcon:s}):null})(t,s)||(0,l.jsx)(tS.default,{type:tM.BlockEnum.TriggerPlugin,size:"md"});case"debugging":return(0,l.jsx)("div",{className:"rounded-lg border-[0.5px] border-divider-subtle bg-util-colors-blue-blue-500 p-1 shadow-md",children:(0,l.jsx)(tk.Code,{className:"h-4 w-4 text-text-primary-on-surface"})});case"rag-pipeline-run":case"rag-pipeline-debugging":return(0,l.jsx)("div",{className:"rounded-lg border-[0.5px] border-divider-subtle bg-util-colors-green-green-500 p-1 shadow-md",children:(0,l.jsx)(t_.KnowledgeRetrieval,{className:"h-4 w-4 text-text-primary-on-surface"})});default:return(0,l.jsx)("div",{className:"rounded-lg border-[0.5px] border-divider-subtle bg-util-colors-blue-brand-blue-brand-500 p-1 shadow-md",children:(0,l.jsx)(tL.WindowCursor,{className:"h-4 w-4 text-text-primary-on-surface"})})}})(t,n,o);return(0,l.jsxs)("div",{className:`flex items-center gap-1.5 ${s}`,children:[(0,l.jsx)("div",{className:"flex items-center justify-center",children:c}),a&&(0,l.jsx)("span",{className:"system-sm-regular text-text-secondary",children:i})]})},tI=e=>{let{logs:t,appDetail:s,onRefresh:a}=e,{t:n}=(0,d.useTranslation)(),{formatTime:r}=(0,eu.default)(),o=(0,e9.default)()===e9.MediaType.mobile,[c,p]=(0,i.useState)(!1),[u,m]=(0,i.useState)(),[x,g]=(0,i.useState)("desc"),[b,f]=(0,i.useState)(t?.data||[]);(0,i.useEffect)(()=>{t?.data?f([...t.data].sort((e,t)=>{let s=e.created_at-t.created_at;return"asc"===x?s:-s})):f([])},[t?.data,x]);let j=s?.mode===v.AppModeEnum.WORKFLOW,y=()=>{a(),p(!1),m(void 0)};return t&&s?(0,l.jsxs)("div",{className:"overflow-x-auto",children:[(0,l.jsxs)("table",{className:(0,k.cn)("mt-2 w-full min-w-[440px] border-collapse border-0"),children:[(0,l.jsx)("thead",{className:"system-xs-medium-uppercase text-text-tertiary",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{className:"w-5 whitespace-nowrap rounded-l-lg bg-background-section-burn pl-2 pr-1"}),(0,l.jsx)("td",{className:"whitespace-nowrap bg-background-section-burn py-1.5 pl-3",children:(0,l.jsxs)("div",{className:"flex cursor-pointer items-center hover:text-text-secondary",onClick:()=>{g("asc"===x?"desc":"asc")},children:[n("table.header.startTime",{ns:"appLog"}),(0,l.jsx)(tw,{className:(0,k.cn)("ml-0.5 h-3 w-3 stroke-current stroke-2 transition-all","text-text-tertiary","asc"===x?"rotate-180":"")})]})}),(0,l.jsx)("td",{className:"whitespace-nowrap bg-background-section-burn py-1.5 pl-3",children:n("table.header.status",{ns:"appLog"})}),(0,l.jsx)("td",{className:"whitespace-nowrap bg-background-section-burn py-1.5 pl-3",children:n("table.header.runtime",{ns:"appLog"})}),(0,l.jsx)("td",{className:"whitespace-nowrap bg-background-section-burn py-1.5 pl-3",children:n("table.header.tokens",{ns:"appLog"})}),(0,l.jsx)("td",{className:(0,k.cn)("whitespace-nowrap bg-background-section-burn py-1.5 pl-3",j?"":"rounded-r-lg"),children:n("table.header.user",{ns:"appLog"})}),j&&(0,l.jsx)("td",{className:"whitespace-nowrap rounded-r-lg bg-background-section-burn py-1.5 pl-3",children:n("table.header.triggered_from",{ns:"appLog"})})]})}),(0,l.jsx)("tbody",{className:"system-sm-regular text-text-secondary",children:b.map(e=>{var t;let s=e.created_by_end_user?e.created_by_end_user.session_id:e.created_by_account?e.created_by_account.name:"N/A";return(0,l.jsxs)("tr",{className:(0,k.cn)("cursor-pointer border-b border-divider-subtle hover:bg-background-default-hover",u?.id!==e.id?"":"bg-background-default-hover"),onClick:()=>{m(e),p(!0)},children:[(0,l.jsx)("td",{className:"h-4",children:!e.read_at&&(0,l.jsx)("div",{className:"flex items-center p-3 pr-0.5",children:(0,l.jsx)("span",{className:"inline-block h-1.5 w-1.5 rounded bg-util-colors-blue-blue-500"})})}),(0,l.jsx)("td",{className:"w-[180px] p-3 pr-2",children:r(e.created_at,n("dateTimeFormat",{ns:"appLog"}))}),(0,l.jsx)("td",{className:"p-3 pr-2",children:"succeeded"===(t=e.workflow_run.status)?(0,l.jsxs)("div",{className:"system-xs-semibold-uppercase inline-flex items-center gap-1",children:[(0,l.jsx)(tt.default,{color:"green"}),(0,l.jsx)("span",{className:"text-util-colors-green-green-600",children:"Success"})]}):"failed"===t?(0,l.jsxs)("div",{className:"system-xs-semibold-uppercase inline-flex items-center gap-1",children:[(0,l.jsx)(tt.default,{color:"red"}),(0,l.jsx)("span",{className:"text-util-colors-red-red-600",children:"Failure"})]}):"stopped"===t?(0,l.jsxs)("div",{className:"system-xs-semibold-uppercase inline-flex items-center gap-1",children:[(0,l.jsx)(tt.default,{color:"yellow"}),(0,l.jsx)("span",{className:"text-util-colors-warning-warning-600",children:"Stop"})]}):"running"===t?(0,l.jsxs)("div",{className:"system-xs-semibold-uppercase inline-flex items-center gap-1",children:[(0,l.jsx)(tt.default,{color:"blue"}),(0,l.jsx)("span",{className:"text-util-colors-blue-light-blue-light-600",children:"Running"})]}):"partial-succeeded"===t?(0,l.jsxs)("div",{className:"system-xs-semibold-uppercase inline-flex items-center gap-1",children:[(0,l.jsx)(tt.default,{color:"green"}),(0,l.jsx)("span",{className:"text-util-colors-green-green-600",children:"Partial Success"})]}):void 0}),(0,l.jsx)("td",{className:"p-3 pr-2",children:(0,l.jsx)("div",{className:(0,k.cn)(0===e.workflow_run.elapsed_time&&"text-text-quaternary"),children:`${e.workflow_run.elapsed_time.toFixed(3)}s`})}),(0,l.jsx)("td",{className:"p-3 pr-2",children:e.workflow_run.total_tokens}),(0,l.jsx)("td",{className:"p-3 pr-2",children:(0,l.jsx)("div",{className:(0,k.cn)("N/A"===s?"text-text-quaternary":"text-text-secondary","overflow-hidden text-ellipsis whitespace-nowrap"),children:s})}),j&&(0,l.jsx)("td",{className:"p-3 pr-2",children:(0,l.jsx)(tP,{triggeredFrom:e.workflow_run.triggered_from,triggerMetadata:e.details?.trigger_metadata})})]},e.id)})})]}),(0,l.jsx)(e0.default,{isOpen:c,onClose:y,mask:o,footer:null,panelClassName:"mt-16 mx-2 sm:mr-2 mb-3 !p-0 !max-w-[600px] rounded-xl border border-components-panel-border",children:(0,l.jsx)(tN,{onClose:y,runID:u?.workflow_run.id||"",canReplay:u?.workflow_run.triggered_from==="app-run"||u?.workflow_run.triggered_from==="debugging"})})]}):(0,l.jsx)(h.default,{})};eL.default.extend(eq.default),eL.default.extend(e$.default);let tR=e=>{let{appDetail:t}=e,{t:s}=(0,d.useTranslation)(),{userProfile:{timezone:a}}=(0,e6.useAppContext)(),[n,r]=(0,i.useState)({status:"all",period:"2"}),[o,c]=i.useState(0),u=(0,p.useDebounce)(n,{wait:500}),[m,x]=i.useState(j.APP_PAGE_LIMIT),b={page:o+1,detail:!0,limit:m,..."all"!==u.status?{status:u.status}:{},...u.keyword?{keyword:u.keyword}:{},..."9"!==u.period?{created_at__after:(0,eL.default)().subtract(tj[u.period].value,"day").startOf("day").tz(a).format("YYYY-MM-DDTHH:mm:ssZ"),created_at__before:(0,eL.default)().endOf("day").tz(a).format("YYYY-MM-DDTHH:mm:ssZ")}:{},...eS(u,["period","status"])},{data:f,refetch:y}=(0,S.useWorkflowLogs)({appId:t.id,params:b}),w=f?.total;return(0,l.jsxs)("div",{className:"flex h-full flex-col",children:[(0,l.jsx)("h1",{className:"system-xl-semibold text-text-primary",children:s("workflowTitle",{ns:"appLog"})}),(0,l.jsx)("p",{className:"system-sm-regular text-text-tertiary",children:s("workflowSubtitle",{ns:"appLog"})}),(0,l.jsxs)("div",{className:"flex max-h-[calc(100%-16px)] flex-1 flex-col py-4",children:[(0,l.jsx)(ty,{queryParams:n,setQueryParams:r}),void 0===w?(0,l.jsx)(h.default,{type:"app"}):w>0?(0,l.jsx)(tI,{logs:f,appDetail:t,onRefresh:y}):(0,l.jsx)(eR,{appDetail:t}),w&&w>j.APP_PAGE_LIMIT?(0,l.jsx)(g.default,{current:o,onChange:c,total:w,limit:m,onLimitChange:x}):null]})]})};var tD=((r={}).log="log",r.annotation="annotation",r);let tF=i.memo(e=>{let{pageType:t}=e,{t:s}=(0,d.useTranslation)(),a=(0,o.useRouter)(),n=(0,eK.useStore)(e=>e.appDetail),r=(0,i.useMemo)(()=>n?.mode===v.AppModeEnum.COMPLETION?[{value:tD.log,text:s("title",{ns:"appLog"})}]:[{value:tD.log,text:s("title",{ns:"appLog"})},{value:tD.annotation,text:s("title",{ns:"appAnnotation"})}],[n?.mode,s]);return n?(0,l.jsxs)("div",{className:"flex h-full flex-col px-6 pt-3",children:[n.mode!==v.AppModeEnum.WORKFLOW&&(0,l.jsx)(ew.default,{className:"shrink-0",value:t,onChange:e=>{a.push(`/app/${n.id}/${e===tD.log?"logs":"annotations"}`)},options:r}),(0,l.jsxs)("div",{className:(0,k.cn)("h-0 grow",n.mode!==v.AppModeEnum.WORKFLOW&&"mt-3"),children:[t===tD.log&&n.mode!==v.AppModeEnum.WORKFLOW&&(0,l.jsx)(tx,{appDetail:n}),t===tD.annotation&&(0,l.jsx)(eA,{appDetail:n}),t===tD.log&&n.mode===v.AppModeEnum.WORKFLOW&&(0,l.jsx)(tR,{appDetail:n})]})]}):(0,l.jsx)("div",{className:"flex h-full items-center justify-center bg-background-body",children:(0,l.jsx)(h.default,{})})});e.s(["default",0,tF],797494)}]);
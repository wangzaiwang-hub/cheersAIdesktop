(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,774776,e=>{e.v({boxHeader:"style-module__ONpVgG__boxHeader",gradientBorder:"style-module__ONpVgG__gradientBorder",optionWrap:"style-module__ONpVgG__optionWrap",warningBorder:"style-module__ONpVgG__warningBorder"})},594512,e=>{e.v({icon:"style-module__Sq5rSW__icon",mask:"style-module__Sq5rSW__mask"})},719730,890189,875489,315765,e=>{"use strict";var t=e.i(24793),a=e.i(625122);function s(e){if((0,t.isPrimitive)(e))return e;if(Array.isArray(e)||(0,a.isTypedArray)(e)||e instanceof ArrayBuffer||"u">typeof SharedArrayBuffer&&e instanceof SharedArrayBuffer)return e.slice(0);let s=Object.getPrototypeOf(e),n=s.constructor;if(e instanceof Date||e instanceof Map||e instanceof Set)return new n(e);if(e instanceof RegExp){let t=new n(e);return t.lastIndex=e.lastIndex,t}if(e instanceof DataView)return new n(e.buffer.slice(0));if(e instanceof Error){let t=new n(e.message);return t.stack=e.stack,t.name=e.name,t.cause=e.cause,t}return"u">typeof File&&e instanceof File?new n([e],e.name,{type:e.type,lastModified:e.lastModified}):"object"==typeof e?Object.assign(Object.create(s),e):e}e.s(["clone",()=>s],719730);var n=e.i(563199),l=e.i(105845),r=e.i(268255),o=e.i(339548),i=e.i(837699);e.i(152567);var d=e.i(408767),p=e.i(417944),c=e.i(26012),m=e.i(858871),u=e.i(547105),x=e.i(137667),g=e.i(421001),h=e.i(390622),f=e.i(265630),v=e.i(249420),b=e.i(296124),_=e.i(648404),y=e.i(935139),j=e.i(168014);let C=r.memo(e=>{let{className:t,headerIcon:a,title:s,headerRight:l,hasHeaderBottomBorder:r,noBodySpacing:o,children:i}=e;return(0,n.jsxs)("div",{className:(0,y.cn)("rounded-xl border-l-[0.5px] border-t-[0.5px] border-effects-highlight bg-background-section-burn pb-3",o&&"pb-0",t),children:[(0,n.jsx)("div",{className:(0,y.cn)("px-3 pt-2",r&&"border-b border-divider-subtle"),"data-testid":"feature-panel-header",children:(0,n.jsxs)("div",{className:"flex h-8 items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex shrink-0 items-center space-x-1",children:[!!a&&(0,n.jsx)("div",{className:"flex h-6 w-6 items-center justify-center",children:a}),(0,n.jsx)("div",{className:"system-sm-semibold text-text-secondary",children:s})]}),(0,n.jsx)("div",{className:"flex items-center gap-2",children:!!l&&(0,n.jsx)("div",{children:l})})]})}),!!i&&(0,n.jsx)("div",{className:(0,y.cn)(!o&&"mt-1 px-3"),"data-testid":"feature-panel-body",children:i})]})});var N=e.i(112142),w=e.i(124836);let k={add:(0,n.jsx)(i.RiAddLine,{className:"h-3.5 w-3.5"}),edit:(0,n.jsx)(i.RiEditLine,{className:"h-3.5 w-3.5"})},T=r.memo(e=>{let{className:t,type:a,actionName:s,onClick:l=w.noop}=e,{t:r}=(0,d.useTranslation)();return(0,n.jsxs)("div",{className:(0,y.cn)("flex h-7 cursor-pointer select-none items-center space-x-1 rounded-md px-3 text-text-secondary hover:bg-state-base-hover",t),onClick:l,children:[(0,n.jsx)("div",{children:k[a]}),(0,n.jsx)("div",{className:"text-xs font-medium",children:s||r(`operation.${a}`,{ns:"common"})})]})});e.i(39598);var M=e.i(193521),M=M,S=e.i(391185),E=e.i(111378);let D=e=>{let{text:t,type:a,value:s,Icon:l,onClick:r}=e;return(0,n.jsxs)("div",{className:"flex h-8 cursor-pointer items-center rounded-lg px-3 hover:bg-state-base-hover",onClick:()=>r(s),children:[l?(0,n.jsx)(l,{className:"h-4 w-4 text-text-secondary"}):(0,n.jsx)(E.default,{type:a,className:"h-4 w-4 text-text-secondary"}),(0,n.jsx)("div",{className:"ml-2 truncate text-xs text-text-primary",children:t})]})},A=r.memo(e=>{let{onChange:t}=e,{t:a}=(0,d.useTranslation)(),[s,l]=(0,r.useState)(!1),o=e=>{t(e),l(!1)};return(0,n.jsxs)(S.PortalToFollowElem,{open:s,onOpenChange:l,placement:"bottom-end",offset:{mainAxis:8,crossAxis:-2},children:[(0,n.jsx)(S.PortalToFollowElemTrigger,{onClick:()=>l(e=>!e),children:(0,n.jsx)(T,{type:"add"})}),(0,n.jsx)(S.PortalToFollowElemContent,{style:{zIndex:1e3},children:(0,n.jsxs)("div",{className:"min-w-[192px] rounded-lg border border-components-panel-border bg-components-panel-bg-blur shadow-lg backdrop-blur-sm",children:[(0,n.jsxs)("div",{className:"p-1",children:[(0,n.jsx)(D,{type:h.InputVarType.textInput,value:"string",text:a("variableConfig.string",{ns:"appDebug"}),onClick:o}),(0,n.jsx)(D,{type:h.InputVarType.paragraph,value:"paragraph",text:a("variableConfig.paragraph",{ns:"appDebug"}),onClick:o}),(0,n.jsx)(D,{type:h.InputVarType.select,value:"select",text:a("variableConfig.select",{ns:"appDebug"}),onClick:o}),(0,n.jsx)(D,{type:h.InputVarType.number,value:"number",text:a("variableConfig.number",{ns:"appDebug"}),onClick:o}),(0,n.jsx)(D,{type:h.InputVarType.checkbox,value:"checkbox",text:a("variableConfig.checkbox",{ns:"appDebug"}),onClick:o})]}),(0,n.jsx)("div",{className:"h-px border-t border-components-panel-border"}),(0,n.jsx)("div",{className:"p-1",children:(0,n.jsx)(D,{Icon:M.default,value:"api",text:a("variableConfig.apiBasedVar",{ns:"appDebug"}),onClick:o})})]})})]})});var F=e.i(83278);e.i(14479);var L=e.i(364211),M=M;let I=r.memo(e=>{let t,{type:a,className:s}=e;return t=`w-3.5 h-3.5 ${s}`,({string:(0,n.jsx)(E.default,{type:h.InputVarType.textInput,className:t}),paragraph:(0,n.jsx)(E.default,{type:h.InputVarType.paragraph,className:t}),select:(0,n.jsx)(E.default,{type:h.InputVarType.select,className:t}),number:(0,n.jsx)(E.default,{type:h.InputVarType.number,className:t}),api:(0,n.jsx)(M.default,{className:t})})[a]}),R=e=>{let{className:t,readonly:a,name:s,label:l,required:o,type:d,onEdit:p,onRemove:c,canDrag:m}=e,[u,x]=(0,r.useState)(!1);return(0,n.jsxs)("div",{className:(0,y.cn)("group relative mb-1 flex h-[34px] w-full items-center rounded-lg border-[0.5px] border-components-panel-border-subtle bg-components-panel-on-panel-item-bg pl-2.5 pr-3 shadow-xs last-of-type:mb-0 hover:bg-components-panel-on-panel-item-bg-hover hover:shadow-sm",u&&"border-state-destructive-border hover:bg-state-destructive-hover",a&&"cursor-not-allowed",t),children:[(0,n.jsx)(L.BracketsX,{className:(0,y.cn)("mr-1 h-4 w-4 shrink-0 text-text-accent",m&&"group-hover:opacity-0")}),m&&(0,n.jsx)(i.RiDraggable,{className:"absolute left-3 top-3 hidden h-3 w-3 cursor-pointer text-text-tertiary group-hover:block"}),(0,n.jsx)("div",{className:"flex w-0 grow items-center",children:(0,n.jsxs)("div",{className:"truncate",title:`${s} \xb7 ${l}`,children:[(0,n.jsx)("span",{className:"system-sm-medium text-text-secondary",children:s}),(0,n.jsx)("span",{className:"system-xs-regular px-1 text-text-quaternary",children:"Â·"}),(0,n.jsx)("span",{className:"system-xs-medium text-text-tertiary",children:l})]})}),(0,n.jsxs)("div",{className:"shrink-0",children:[(0,n.jsxs)("div",{className:(0,y.cn)("flex items-center",!a&&"group-hover:hidden"),children:[o&&(0,n.jsx)(F.default,{text:"required"}),(0,n.jsx)("span",{className:"system-xs-regular pl-2 pr-1 text-text-tertiary",children:d}),(0,n.jsx)(I,{type:d,className:"text-text-tertiary"})]}),(0,n.jsxs)("div",{className:(0,y.cn)("hidden items-center justify-end rounded-lg",!a&&"group-hover:flex"),children:[(0,n.jsx)("div",{className:"mr-1 flex h-6 w-6 cursor-pointer items-center justify-center rounded-md hover:bg-black/5",onClick:p,children:(0,n.jsx)(i.RiEditLine,{className:"h-4 w-4 text-text-tertiary"})}),(0,n.jsx)("div",{"data-testid":"var-item-delete-btn",className:"flex h-6 w-6 cursor-pointer items-center  justify-center text-text-tertiary hover:text-text-destructive",onClick:c,onMouseOver:()=>x(!0),onMouseLeave:()=>x(!1),children:(0,n.jsx)(i.RiDeleteBinLine,{className:"h-4 w-4"})})]})]})]})},P="ADD_EXTERNAL_DATA_TOOL",O=new Set(["string","paragraph","select","number","checkbox"]),V=r.memo(e=>{let{promptVariables:t,readonly:a,onPromptVariablesChange:s}=e,{t:i}=(0,d.useTranslation)(),{mode:c,dataSets:w}=(0,o.useContext)(f.default),{eventEmitter:k}=(0,v.useEventEmitterContextContext)(),T=t.length>0,[M,S]=(0,r.useState)(-1),E=-1!==M?t[M]:null,D=(0,r.useMemo)(()=>E?{...E,label:E.name,variable:E.key,type:"string"===E.type?h.InputVarType.textInput:E.type,required:E.required??!1}:null,[E]),F=(0,r.useCallback)(e=>{let a=(0,l.produce)(t,t=>{t[M]=(e=>{let{variable:t,label:a,type:s,...n}=e,l=s===h.InputVarType.textInput?"string":s,r={...n,type:l,key:t,name:a};return e.type!==h.InputVarType.select&&delete r.options,r})(e)}),n=(0,j.hasDuplicateStr)(a.map(e=>e.key))?{errorMsgKey:"varKeyError.keyAlreadyExists",typeName:"variableConfig.varName"}:(0,j.hasDuplicateStr)(a.map(e=>e.name))?{errorMsgKey:"varKeyError.keyAlreadyExists",typeName:"variableConfig.labelName"}:null;return n?(x.default.notify({type:"error",message:i(n.errorMsgKey,{ns:"appDebug",key:i(n.typeName,{ns:"appDebug"})})}),!1):(s?.(a),!0)},[M,s,t,i]),{setShowExternalDataToolModal:L}=(0,b.useModalContext)(),I=(0,r.useCallback)((e,a)=>{let{key:n,type:l,index:r,name:o,config:d,icon:p,icon_background:c}=e;L({payload:{type:l,variable:n,label:o,config:d,icon:p,icon_background:c},onSaveCallback:e=>{if(!e)return;let t=a.map((t,a)=>a===r?{key:e.variable,name:e.label,enabled:e.enabled,type:e.type,config:e.config,required:t.required,icon:e.icon,icon_background:e.icon_background}:t);s?.(t)},onCancelCallback:()=>{n||s?.(t.filter((e,t)=>t!==r))},onValidateBeforeSaveCallback:e=>{for(let a=0;a<t.length;a++)if(t[a].key===e.variable&&a!==r)return x.default.notify({type:"error",message:i("varKeyError.keyAlreadyExists",{ns:"appDebug",key:t[a].key})}),!1;return!0}})},[s,t,L,i]),V=(0,r.useCallback)(e=>{let a=(0,j.getNewVar)("",e),n=[...t,a];s?.(n),"api"===e&&I({type:e,key:a.key,name:a.name,index:t.length},n)},[I,s,t]);k?.useSubscription(e=>{if(e.type===P){let a=e.payload;s?.([...t,{key:a.variable,name:a.label,enabled:a.enabled,type:a.type,config:a.config,required:!0,icon:a.icon,icon_background:a.icon_background}])}});let[B,{setTrue:q,setFalse:U}]=(0,p.useBoolean)(!1),[H,z]=(0,r.useState)(null),$=(0,r.useCallback)(e=>{s?.(t.filter((t,a)=>a!==e))},[s,t]),W=(0,r.useCallback)(e=>{let a=t[e];if(c===_.AppModeEnum.COMPLETION&&w.length>0&&a.is_context_var){q(),z(e);return}$(e)},[w.length,$,c,t,q]),[G,{setTrue:K,setFalse:Q}]=(0,p.useBoolean)(!1),X=(0,r.useCallback)(e=>{let{key:a,type:s,index:n,name:l,config:r,icon:o,icon_background:i}=e;(S(n),O.has(s))?K():I({key:a,type:s,index:n,name:l,config:r,icon:o,icon_background:i},t)},[I,t,K]),Y=(0,r.useMemo)(()=>t.map(e=>({id:e.key,variable:{...e}})),[t]),J=!a&&t.length>1;return(0,n.jsxs)(C,{className:"mt-2",title:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"mr-1",children:i("variableTitle",{ns:"appDebug"})}),!a&&(0,n.jsx)(g.default,{popupContent:(0,n.jsx)("div",{className:"w-[180px]",children:i("variableTip",{ns:"appDebug"})})})]}),headerRight:a?null:(0,n.jsx)(A,{onChange:V}),noBodySpacing:!0,children:[!T&&(0,n.jsx)("div",{className:"mt-1 px-3 pb-3",children:(0,n.jsx)("div",{className:"pb-1 pt-2 text-xs text-text-tertiary",children:i("notSetVar",{ns:"appDebug"})})}),T&&(0,n.jsx)("div",{className:(0,y.cn)("mt-1 grid px-3 pb-3"),children:(0,n.jsx)(m.ReactSortable,{className:(0,y.cn)("grid-col-1 grid space-y-1",a&&"grid-cols-2 gap-1 space-y-0"),list:Y,setList:e=>{s?.(e.map(e=>e.variable))},handle:".handle",ghostClass:"opacity-50",animation:150,children:Y.map((e,t)=>{let{key:s,name:l,type:r,required:o,config:i,icon:d,icon_background:p}=e.variable;return(0,n.jsx)(R,{className:(0,y.cn)(J&&"handle"),readonly:a,name:s,label:l,required:!!o,type:r,onEdit:()=>X({type:r,key:s,index:t,name:l,config:i,icon:d,icon_background:p}),onRemove:()=>W(t),canDrag:J},s)})})}),G&&(0,n.jsx)(N.default,{payload:D,isShow:G,onClose:Q,onConfirm:e=>{F(e)&&Q()},varKeys:t.map(e=>e.key)}),B&&(0,n.jsx)(u.default,{isShow:B,title:i("feature.dataSet.queryVariable.deleteContextVarTitle",{ns:"appDebug",varName:t[H]?.name}),content:i("feature.dataSet.queryVariable.deleteContextVarTip",{ns:"appDebug"}),onConfirm:()=>{$(H),U()},onCancel:U})]})});var B=e.i(151094);e.i(21511);var q=e.i(389600),U=e.i(751489),H=e.i(758911),z=e.i(244755),$=e.i(823660),W=e.i(892081);e.i(668763);var G=e.i(359173),K=e.i(923978);let Q=[K.PromptRole.system,K.PromptRole.user,K.PromptRole.assistant],X=r.memo(e=>{let{value:t,onChange:a}=e,[s,{setFalse:l,toggle:o}]=(0,p.useBoolean)(!1),i=r.useRef(null);return(0,W.useClickAway)(()=>{l()},i),(0,n.jsxs)("div",{className:"relative left-[-8px]",ref:i,children:[(0,n.jsxs)("div",{onClick:o,className:(0,y.cn)(s&&"bg-indigo-100","flex h-7 cursor-pointer items-center space-x-0.5 rounded-lg pl-1.5 pr-1 text-indigo-800"),children:[(0,n.jsx)("div",{className:"text-sm font-semibold uppercase",children:t}),(0,n.jsx)(G.ChevronSelectorVertical,{className:"h-3 w-3 "})]}),s&&(0,n.jsx)("div",{className:"absolute top-[30px] z-10 rounded-lg border border-components-panel-border bg-components-panel-bg p-1 shadow-lg",children:Q.map(e=>(0,n.jsx)("div",{onClick:()=>{l(),a(e)},className:"flex h-9 min-w-[44px] cursor-pointer items-center rounded-lg px-3 text-sm font-medium uppercase text-text-secondary hover:bg-state-base-hover",children:e},e))})]})});var Y=e.i(589849),J=e.i(774776);let Z=r.memo(e=>{let t,{type:a,isChatMode:s,value:m,onChange:u,onTypeChange:h,canDelete:C,onDelete:N,promptVariables:w,isContextMissing:k,onHideContextMissingTip:T,noResize:M}=e,{t:S}=(0,d.useTranslation)(),{eventEmitter:E}=(0,v.useEventEmitterContextContext)(),{mode:D,hasSetBlockStatus:A,modelConfig:F,setModelConfig:L,conversationHistoriesRole:I,showHistoryModal:R,dataSets:O,showSelectDataSet:V,externalDataToolsConfig:W}=(0,o.useContext)(f.default),{notify:G}=(0,x.useToastContext)(),{setShowExternalDataToolModal:K}=(0,b.useModalContext)(),Q=D!==_.AppModeEnum.COMPLETION,[Z,ee]=r.useState(!1),et=(t={},w.forEach(e=>{t[e.key]=!0}),t),[ea,es]=r.useState(w),[en,{setTrue:el,setFalse:er}]=(0,p.useBoolean)(!1),eo=e=>()=>{e&&L((0,l.produce)(F,e=>{e.configs.prompt_variables=[...e.configs.prompt_variables,...ea]})),er()},[ei,ed]=r.useState(s?200:508),ep=(0,n.jsxs)("div",{className:"flex h-11 items-center justify-between rounded-tl-xl rounded-tr-xl pb-1 pl-4 pr-3 pt-2",style:{background:"linear-gradient(180deg, #FEF0C7 0%, rgba(254, 240, 199, 0) 100%)"},children:[(0,n.jsxs)("div",{className:"flex items-center pr-2",children:[(0,n.jsx)(i.RiErrorWarningFill,{className:"mr-1 h-4 w-4 text-[#F79009]"}),(0,n.jsx)("div",{className:"text-[13px] font-medium leading-[18px] text-[#DC6803]",children:S("promptMode.contextMissing",{ns:"appDebug"})})]}),(0,n.jsx)(B.default,{size:"small",variant:"secondary-accent",onClick:T,children:S("operation.ok",{ns:"common"})})]});return(0,n.jsxs)("div",{className:`rounded-xl bg-gradient-to-r from-components-input-border-active-prompt-1 to-components-input-border-active-prompt-2 p-0.5 shadow-xs ${!k?"":J.default.warningBorder}`,children:[(0,n.jsxs)("div",{className:"rounded-xl bg-background-default",children:[k?ep:(0,n.jsxs)("div",{className:(0,y.cn)(J.default.boxHeader,"flex h-11 items-center justify-between rounded-tl-xl rounded-tr-xl bg-background-default pb-1 pl-4 pr-3 pt-2 hover:shadow-xs"),children:[s?(0,n.jsx)(X,{value:a,onChange:h}):(0,n.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,n.jsx)("div",{className:"text-sm font-semibold uppercase text-indigo-800",children:S("pageTitle.line1",{ns:"appDebug"})}),(0,n.jsx)(g.default,{popupContent:(0,n.jsx)("div",{className:"w-[180px]",children:S("promptTip",{ns:"appDebug"})})})]}),(0,n.jsxs)("div",{className:(0,y.cn)(J.default.optionWrap,"items-center space-x-1"),children:[C&&(0,n.jsx)(i.RiDeleteBinLine,{onClick:N,className:"h-6 w-6 cursor-pointer p-1 text-text-tertiary"}),Z?(0,n.jsx)(U.CopyCheck,{className:"h-6 w-6 p-1 text-text-tertiary"}):(0,n.jsx)(q.Copy,{className:"h-6 w-6 cursor-pointer p-1 text-text-tertiary",onClick:()=>{(0,c.default)(m),ee(!0)}})]})]}),(0,n.jsx)(Y.default,{className:"min-h-[102px] overflow-y-auto px-4 text-sm text-text-secondary",height:ei,minHeight:102,onHeightChange:ed,footer:(0,n.jsx)("div",{className:"flex pb-2 pl-4",children:(0,n.jsx)("div",{className:"h-[18px] rounded-md bg-divider-regular px-1 text-xs leading-[18px] text-text-tertiary",children:m.length})}),hideResize:M,children:(0,n.jsx)(H.default,{className:"min-h-[84px]",value:m,contextBlock:{show:!0,selectable:!A.context,datasets:O.map(e=>({id:e.id,name:e.name,type:e.data_source_type})),onAddContext:V},variableBlock:{show:!0,variables:F.configs.prompt_variables.filter(e=>"api"!==e.type&&e.key&&e.key.trim()&&e.name&&e.name.trim()).map(e=>({name:e.name,value:e.key}))},externalToolBlock:{externalTools:F.configs.prompt_variables.filter(e=>"api"===e.type).map(e=>({name:e.name,variableName:e.key,icon:e.icon,icon_background:e.icon_background})),onAddExternalTool:()=>{K({payload:{},onSaveCallback:e=>{e&&(E?.emit({type:P,payload:e}),E?.emit({type:z.INSERT_VARIABLE_VALUE_BLOCK_COMMAND,payload:e.variable}))},onValidateBeforeSaveCallback:e=>{for(let t=0;t<w.length;t++)if(w[t].key===e.variable)return G({type:"error",message:S("varKeyError.keyAlreadyExists",{ns:"appDebug",key:w[t].key})}),!1;return!0}})}},historyBlock:{show:!s&&Q,selectable:!A.history,history:{user:I?.user_prefix,assistant:I?.assistant_prefix},onEditRole:R},queryBlock:{show:!s&&Q,selectable:!A.query},onChange:e=>{m!==e&&u(e)},onBlur:()=>{let e=(0,j.getVars)(m).filter(e=>!(e in et)&&!W.find(t=>t.variable===e)).map(e=>(0,j.getNewVar)(e,""));e.length>0&&(es(e),el())}})})]}),en&&(0,n.jsx)($.default,{varNameArr:ea.map(e=>e.name),onConfirm:eo(!0),onCancel:eo(!1),onHide:er})]})});var ee=e.i(925521);let et=r.memo(e=>{let{onClick:t}=e,{t:a}=(0,d.useTranslation)();return(0,n.jsxs)(B.default,{variant:"secondary-accent",size:"small",onClick:t,children:[(0,n.jsx)(i.RiSparklingFill,{className:"mr-1 h-3.5 w-3.5"}),(0,n.jsx)("span",{className:"",children:a("operation.automatic",{ns:"appDebug"})})]})});var ea=e.i(514112),es=e.i(987878),en=e.i(484072),el=e.i(271743);let er=r.memo(e=>{let{mode:t,promptTemplate:a,promptVariables:s,readonly:i=!1,onChange:c,noTitle:m,editorHeight:u,noResize:h}=e,{t:C}=(0,d.useTranslation)(),N=(0,el.default)()===el.MediaType.mobile,{features:k,setFeatures:T}=(0,es.useFeaturesStore)().getState(),{eventEmitter:M}=(0,v.useEventEmitterContextContext)(),{appId:S,modelConfig:E,dataSets:D,setModelConfig:A,setPrevPromptConfig:F,setIntroduction:L,hasSetBlockStatus:I,showSelectDataSet:R,externalDataToolsConfig:O}=(0,o.useContext)(f.default),{notify:V}=(0,x.useToastContext)(),{setShowExternalDataToolModal:B}=(0,b.useModalContext)(),[q,U]=r.useState(s),[W,G]=r.useState(""),[K,{setTrue:Q,setFalse:X}]=(0,p.useBoolean)(!1),J=(e,t)=>{let a=t.filter(e=>{if(O.find(t=>t.variable===e))return!1;let t=s.find(t=>t.key===e);return!t||!t.name||!t.name.trim()||!t.key||!t.key.trim()}).map(e=>(0,j.getNewVar)(e,""));if(a.length>0){U(a),G(e),Q();return}c?.(e,[])},Z=e=>()=>{c?.(W,e?q:[]),X()},[ee,{setTrue:er,setFalse:eo}]=(0,p.useBoolean)(!1),ei=u||228,[ed,ep]=(0,r.useState)(ei);return(0,n.jsxs)("div",{className:(0,y.cn)("relative rounded-xl bg-gradient-to-r from-components-input-border-active-prompt-1 to-components-input-border-active-prompt-2 p-0.5 shadow-xs"),children:[(0,n.jsxs)("div",{className:"rounded-xl bg-background-section-burn",children:[!m&&(0,n.jsxs)("div",{className:"flex h-11 items-center justify-between pl-3 pr-2.5",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,n.jsx)("div",{className:"h2 system-sm-semibold-uppercase text-text-secondary",children:t!==_.AppModeEnum.COMPLETION?C("chatSubTitle",{ns:"appDebug"}):C("completionSubTitle",{ns:"appDebug"})}),!i&&(0,n.jsx)(g.default,{popupContent:(0,n.jsx)("div",{className:"w-[180px]",children:C("promptTip",{ns:"appDebug"})})})]}),(0,n.jsx)("div",{className:"flex items-center",children:!i&&!N&&(0,n.jsx)(et,{onClick:er})})]}),(0,n.jsx)(Y.default,{className:"min-h-[228px] rounded-t-xl bg-background-default px-4 pt-2 text-sm text-text-secondary",height:ed,minHeight:ei,onHeightChange:ep,hideResize:h,footer:(0,n.jsx)("div",{className:"flex rounded-b-xl bg-background-default pb-2 pl-4",children:(0,n.jsx)("div",{className:"h-[18px] rounded-md bg-components-badge-bg-gray-soft px-1 text-xs leading-[18px] text-text-tertiary",children:a.length})}),children:(0,n.jsx)(H.default,{className:"min-h-[210px]",compact:!0,value:a,contextBlock:{show:!1,selectable:!I.context,datasets:D.map(e=>({id:e.id,name:e.name,type:e.data_source_type})),onAddContext:R},variableBlock:{show:!0,variables:E.configs.prompt_variables.filter(e=>"api"!==e.type&&e.key&&e.key.trim()&&e.name&&e.name.trim()).map(e=>({name:e.name,value:e.key}))},externalToolBlock:{show:!0,externalTools:E.configs.prompt_variables.filter(e=>"api"===e.type).map(e=>({name:e.name,variableName:e.key,icon:e.icon,icon_background:e.icon_background})),onAddExternalTool:()=>{B({payload:{},onSaveCallback:e=>{e&&(M?.emit({type:P,payload:e}),M?.emit({type:z.INSERT_VARIABLE_VALUE_BLOCK_COMMAND,payload:e.variable}))},onValidateBeforeSaveCallback:e=>{for(let t=0;t<s.length;t++)if(s[t].key===e.variable)return V({type:"error",message:C("varKeyError.keyAlreadyExists",{ns:"appDebug",key:s[t].key})}),!1;return!0}})}},historyBlock:{show:!1,selectable:!1,history:{user:"",assistant:""},onEditRole:w.noop},queryBlock:{show:!1,selectable:!I.query},onChange:e=>{J(e,[])},onBlur:()=>{J(a,(0,j.getVars)(a))},editable:!i})})]}),K&&(0,n.jsx)($.default,{varNameArr:q.map(e=>e.name),onConfirm:Z(!0),onCancel:Z(!1),onHide:X}),ee&&(0,n.jsx)(ea.default,{flowId:S,mode:t,isShow:ee,onClose:eo,onFinished:e=>{M?.emit({type:en.PROMPT_EDITOR_UPDATE_VALUE_BY_EVENT_EMITTER,payload:e.modified}),A((0,l.produce)(E,t=>{t.configs.prompt_template=e.modified,t.configs.prompt_variables=(e.variables||[]).map(e=>({key:e,name:e,type:"string",required:!0}))})),F(E.configs),t!==_.AppModeEnum.COMPLETION&&(L(e.opening_statement||""),T((0,l.produce)(k,t=>{t.opening={...t.opening,enabled:!!e.opening_statement,opening_statement:e.opening_statement}}))),eo()},currentPrompt:a,isBasicMode:!0})]})}),eo=r.memo(e=>{let{mode:t,promptTemplate:a,promptVariables:s,noTitle:p,gradientBorder:c,readonly:m=!1,editorHeight:u,noResize:x,onChange:g}=e,{t:h}=(0,d.useTranslation)(),{isAdvancedMode:v,currentAdvancedPrompt:b,setCurrentAdvancedPrompt:y,modelModeType:j,dataSets:C,hasSetBlockStatus:N}=(0,o.useContext)(f.default),w=(e,t)=>{y((0,l.produce)(b,a=>{a[e].role=t}))},k=(e,t)=>{j===_.ModelModeType.chat?y((0,l.produce)(b,a=>{a[t].text=e}),!0):y({...b,text:e},!0)},T=e=>{y((0,l.produce)(b,t=>{t.splice(e,1)}))},M=C.length>0&&!N.context,[S,E]=r.useState(!1);return v?(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"space-y-3",children:j===_.ModelModeType.chat?b.map((e,t)=>(0,n.jsx)(Z,{isChatMode:!0,type:e.role,value:e.text,onTypeChange:e=>w(t,e),canDelete:b.length>1,onDelete:()=>T(t),onChange:e=>k(e,t),promptVariables:s,isContextMissing:M&&!S,onHideContextMissingTip:()=>E(!0),noResize:x},t)):(0,n.jsx)(Z,{type:b.role,isChatMode:!1,value:b.text,onTypeChange:e=>w(0,e),canDelete:!1,onDelete:()=>T(0),onChange:e=>k(e),promptVariables:s,isContextMissing:M&&!S,onHideContextMissingTip:()=>E(!0),noResize:x})}),j===_.ModelModeType.chat&&b.length<ee.MAX_PROMPT_MESSAGE_LENGTH&&(0,n.jsxs)(B.default,{onClick:()=>{if(0===b.length)return void y([{role:K.PromptRole.system,text:""}]);let e={role:b[b.length-1]?.role===K.PromptRole.user?K.PromptRole.assistant:K.PromptRole.user,text:""};y([...b,e])},className:"mt-3 w-full",children:[(0,n.jsx)(i.RiAddLine,{className:"mr-2 h-4 w-4"}),(0,n.jsx)("div",{children:h("promptMode.operation.addMessage",{ns:"appDebug"})})]})]}):(0,n.jsx)(er,{mode:t,promptTemplate:a,promptVariables:s,readonly:m,onChange:g,noTitle:p,gradientBorder:c,editorHeight:u,noResize:x})});e.i(288243);var ei=e.i(920876);let ed=r.memo(e=>{let{showWarning:t,onShowEditModal:a}=e,{t:s}=(0,d.useTranslation)();return(0,n.jsx)(C,{className:"mt-2",title:(0,n.jsx)("div",{className:"flex items-center gap-2",children:(0,n.jsx)("div",{children:s("feature.conversationHistory.title",{ns:"appDebug"})})}),headerIcon:(0,n.jsx)("div",{className:"rounded-md p-1 shadow-xs",children:(0,n.jsx)(ei.MessageClockCircle,{className:"h-4 w-4 text-[#DD2590]"})}),headerRight:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"text-xs text-text-tertiary",children:s("feature.conversationHistory.description",{ns:"appDebug"})}),(0,n.jsx)("div",{className:"ml-3 h-[14px] w-[1px] bg-divider-regular"}),(0,n.jsx)(T,{type:"edit",onClick:a})]}),noBodySpacing:!0,children:t&&(0,n.jsx)("div",{className:"flex justify-between rounded-b-xl bg-background-section-burn px-3 py-2 text-xs text-text-secondary",children:(0,n.jsx)("div",{children:s("feature.conversationHistory.tip",{ns:"appDebug"})})})})});e.i(966391);var ep=e.i(768974),ep=ep,ec=e.i(260484),em=e.i(597280),eu=e.i(26273);let ex=r.memo(()=>{let{t:e}=(0,d.useTranslation)(),t=(0,es.useFeatures)(e=>e.features.file),a=(0,es.useFeaturesStore)(),s=(0,r.useCallback)(e=>{let{features:t,setFeatures:s}=a.getState();s((0,l.produce)(t,t=>{t.file={...t.file,allowed_file_upload_methods:e.allowed_file_upload_methods,number_limits:e.number_limits,image:{enabled:e.enabled,detail:e.image?.detail,transfer_methods:e.allowed_file_upload_methods,number_limits:e.number_limits}}}))},[a]);return(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-base font-semibold leading-6 text-text-primary",children:e("vision.visionSettings.title",{ns:"appDebug"})}),(0,n.jsxs)("div",{className:"space-y-6 pt-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"mb-2 flex items-center  space-x-1",children:[(0,n.jsx)("div",{className:"text-[13px] font-semibold leading-[18px] text-text-secondary",children:e("vision.visionSettings.resolution",{ns:"appDebug"})}),(0,n.jsx)(g.default,{popupContent:(0,n.jsx)("div",{className:"w-[180px]",children:e("vision.visionSettings.resolutionTooltip",{ns:"appDebug"}).split("\n").map(e=>(0,n.jsx)("div",{children:e},e))})})]}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)(em.default,{className:"grow",title:e("vision.visionSettings.high",{ns:"appDebug"}),selected:t?.image?.detail===_.Resolution.high,onSelect:()=>s({...t,image:{detail:_.Resolution.high}})}),(0,n.jsx)(em.default,{className:"grow",title:e("vision.visionSettings.low",{ns:"appDebug"}),selected:t?.image?.detail===_.Resolution.low,onSelect:()=>s({...t,image:{detail:_.Resolution.low}})})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"mb-2 text-[13px] font-semibold leading-[18px] text-text-secondary",children:e("vision.visionSettings.uploadMethod",{ns:"appDebug"})}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)(em.default,{className:"grow",title:e("vision.visionSettings.both",{ns:"appDebug"}),selected:!!t?.allowed_file_upload_methods?.includes(_.TransferMethod.local_file)&&!!t?.allowed_file_upload_methods?.includes(_.TransferMethod.remote_url),onSelect:()=>s({...t,allowed_file_upload_methods:[_.TransferMethod.local_file,_.TransferMethod.remote_url]})}),(0,n.jsx)(em.default,{className:"grow",title:e("vision.visionSettings.localUpload",{ns:"appDebug"}),selected:!!t?.allowed_file_upload_methods?.includes(_.TransferMethod.local_file)&&t?.allowed_file_upload_methods?.length===1,onSelect:()=>s({...t,allowed_file_upload_methods:[_.TransferMethod.local_file]})}),(0,n.jsx)(em.default,{className:"grow",title:e("vision.visionSettings.url",{ns:"appDebug"}),selected:!!t?.allowed_file_upload_methods?.includes(_.TransferMethod.remote_url)&&t?.allowed_file_upload_methods?.length===1,onSelect:()=>s({...t,allowed_file_upload_methods:[_.TransferMethod.remote_url]})})]})]}),(0,n.jsx)("div",{children:(0,n.jsx)(eu.default,{id:"upload_limit",className:"",name:e("vision.visionSettings.uploadLimit",{ns:"appDebug"}),noTooltip:!0,default:2,step:1,min:1,max:6,value:t?.number_limits||3,enable:!0,onChange:(e,a)=>{a&&s({...t,number_limits:a})}})})]})]})}),eg=(0,r.memo)(()=>{let{t:e}=(0,d.useTranslation)(),[t,a]=(0,r.useState)(!1);return(0,n.jsxs)(S.PortalToFollowElem,{open:t,onOpenChange:a,placement:"bottom-end",offset:{mainAxis:4},children:[(0,n.jsx)(S.PortalToFollowElemTrigger,{onClick:()=>a(e=>!e),children:(0,n.jsxs)(B.default,{variant:"ghost",size:"small",className:(0,y.cn)(""),children:[(0,n.jsx)(i.RiSettings2Line,{className:"h-3.5 w-3.5"}),(0,n.jsx)("div",{className:"ml-1",children:e("voice.settings",{ns:"appDebug"})})]})}),(0,n.jsx)(S.PortalToFollowElemContent,{style:{zIndex:50},children:(0,n.jsx)("div",{className:"w-80 space-y-3 rounded-lg border-[0.5px] border-components-panel-border bg-components-panel-bg p-4 shadow-lg sm:w-[412px]",children:(0,n.jsx)(ex,{})})})]})}),eh=r.memo(()=>{let{t:e}=(0,d.useTranslation)(),{isShowVisionConfig:t,isAllowVideoUpload:a,readonly:s}=(0,o.useContext)(f.default),i=(0,es.useFeatures)(e=>e.features.file),p=(0,es.useFeaturesStore)(),c=i?.allowed_file_types?.includes(h.SupportUploadFileTypes.image)??!1,m=(0,r.useCallback)(e=>{let{features:t,setFeatures:s}=p.getState();s((0,l.produce)(t,t=>{e?t.file.allowed_file_types=Array.from(new Set([...t.file?.allowed_file_types||[],h.SupportUploadFileTypes.image,...a?[h.SupportUploadFileTypes.video]:[]])):t.file.allowed_file_types=t.file.allowed_file_types?.filter(e=>e!==h.SupportUploadFileTypes.image&&(!a||e!==h.SupportUploadFileTypes.video)),t.file&&(t.file.enabled=(t.file.allowed_file_types?.length??0)>0,t.file.image={...t.file.image,enabled:e})}))},[p,a]);return t&&(!s||c)?(0,n.jsxs)("div",{className:"mt-2 flex items-center gap-2 rounded-xl border-l-[0.5px] border-t-[0.5px] border-effects-highlight bg-background-section-burn p-2",children:[(0,n.jsx)("div",{className:"shrink-0 p-1",children:(0,n.jsx)("div",{className:"rounded-lg border-[0.5px] border-divider-subtle bg-util-colors-indigo-indigo-600 p-1 shadow-xs",children:(0,n.jsx)(ep.default,{className:"h-4 w-4 text-text-primary-on-surface"})})}),(0,n.jsxs)("div",{className:"flex grow items-center",children:[(0,n.jsx)("div",{className:"system-sm-semibold mr-1 text-text-secondary",children:e("vision.name",{ns:"appDebug"})}),(0,n.jsx)(g.default,{popupContent:(0,n.jsx)("div",{className:"w-[180px]",children:e("vision.description",{ns:"appDebug"})})})]}),(0,n.jsx)("div",{className:"flex shrink-0 items-center",children:s?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"mr-2 flex items-center gap-0.5",children:[(0,n.jsx)("div",{className:"system-xs-medium-uppercase text-text-tertiary",children:e("vision.visionSettings.resolution",{ns:"appDebug"})}),(0,n.jsx)(g.default,{popupContent:(0,n.jsx)("div",{className:"w-[180px]",children:e("vision.visionSettings.resolutionTooltip",{ns:"appDebug"}).split("\n").map(e=>(0,n.jsx)("div",{children:e},e))})})]}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)(em.default,{title:e("vision.visionSettings.high",{ns:"appDebug"}),selected:i?.image?.detail===_.Resolution.high,onSelect:w.noop,className:(0,y.cn)("cursor-not-allowed rounded-lg px-3  hover:shadow-none",i?.image?.detail!==_.Resolution.high&&"hover:border-components-option-card-option-border")}),(0,n.jsx)(em.default,{title:e("vision.visionSettings.low",{ns:"appDebug"}),selected:i?.image?.detail===_.Resolution.low,onSelect:w.noop,className:(0,y.cn)("cursor-not-allowed rounded-lg px-3  hover:shadow-none",i?.image?.detail!==_.Resolution.low&&"hover:border-components-option-card-option-border")})]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eg,{}),(0,n.jsx)("div",{className:"ml-1 mr-3 h-3.5 w-[1px] bg-divider-regular"}),(0,n.jsx)(ec.default,{defaultValue:c,onChange:m,size:"md"})]})})]}):null});var ef=e.i(966739),ev=e.i(503144),eb=e.i(739255),e_=e.i(225162),ey=e.i(428594),ej=e.i(684194),eC=e.i(88961),eN=e.i(711536),ew=e.i(221927),ek=e.i(361126),eT=e.i(680884);let eM="APP_CHAT_WITH_MULTIPLE_MODEL",eS="APP_CHAT_WITH_MULTIPLE_MODEL_RESTART",eE="ORCHESTRATE_CHANGED",eD=()=>{let{isAdvancedMode:e,modelConfig:t,appId:a,promptMode:s,speechToTextConfig:n,introduction:l,suggestedQuestions:r,suggestedQuestionsAfterAnswerConfig:o,citationConfig:i,moderationConfig:d,chatPromptConfig:p,completionPromptConfig:c,dataSets:m,datasetConfigs:u,visionConfig:x,annotationConfig:g,textToSpeechConfig:v,isFunctionCall:b}=(0,f.useDebugConfigurationContext)(),y=m.map(e=>{let{id:t}=e;return{dataset:{enabled:!0,id:t}}}),j=t.configs.prompt_variables.find(e=>e.is_context_var)?.key;return{pre_prompt:e?"":t.configs.prompt_template,prompt_type:s,chat_prompt_config:e?p:(0,ek.cloneDeep)(ee.DEFAULT_CHAT_PROMPT_CONFIG),completion_prompt_config:e?c:(0,ek.cloneDeep)(ee.DEFAULT_COMPLETION_PROMPT_CONFIG),user_input_form:(0,eT.promptVariablesToUserInputsForm)(t.configs.prompt_variables),dataset_query_variable:j||"",opening_statement:l,more_like_this:t.more_like_this??{enabled:!1},suggested_questions:r,suggested_questions_after_answer:o??{enabled:!1},text_to_speech:v,speech_to_text:n,retriever_resource:i,sensitive_word_avoidance:d,agent_mode:{...t.agentConfig,strategy:b?_.AgentStrategy.functionCall:_.AgentStrategy.react},dataset_configs:{...u,datasets:{datasets:[...y]}},file_upload:{image:x,allowed_file_upload_methods:x.transfer_methods??[],allowed_file_types:[h.SupportUploadFileTypes.image],max_length:x.number_limits??0,number_limits:x.number_limits},annotation_reply:g,system_parameters:t.system_parameters,supportAnnotation:!0,appId:a,supportCitationHitInfo:!0}},eA=()=>{let{eventEmitter:e}=(0,v.useEventEmitterContextContext)();return(0,r.useCallback)(()=>{e?.emit({type:eE})},[e])},eF=e=>{let{formattingChanged:t,setFormattingChanged:a}=(0,f.useDebugConfigurationContext)(),{eventEmitter:s}=(0,v.useEventEmitterContextContext)();s?.useSubscription(s=>{s.type===eE&&e.some(e=>e.isAnswer)&&!t&&a(!0)})};e.s(["useConfigFromDebugContext",0,eD,"useDebugWithSingleOrMultipleModel",0,e=>{let t=localStorage.getItem("app-debug-with-single-or-multiple-models"),a=(0,r.useRef)({});if(t)try{a.current=JSON.parse(t)||{}}catch(e){console.error(e)}let[s,n]=(0,r.useState)(a.current[e]?.multiple||!1),[l,o]=(0,r.useState)(a.current[e]?.configs||[]);return{debugWithMultipleModel:s,multipleModelConfigs:l,handleMultipleModelConfigsChange:(0,r.useCallback)((t,s)=>{let l={multiple:t,configs:s};a.current[e]=l,localStorage.setItem("app-debug-with-single-or-multiple-models",JSON.stringify(a.current)),n(l.multiple),o(l.configs)},[e])}},"useFormattingChangedDispatcher",0,eA,"useFormattingChangedSubscription",0,eF],890189);var eL=e.i(654313),eI=e.i(257899),eR=e.i(521632),eP=e.i(216425),eO=e.i(619434);let eV=e=>{let{config:t,onSave:a,onRemove:s,readonly:l=!1,editable:o=!0}=e,p=(0,el.default)()===el.MediaType.mobile,[c,m]=(0,r.useState)(!1),{formatIndexingTechniqueAndMethod:u}=(0,eP.useKnowledge)(),{t:x}=(0,d.useTranslation)(),[g,h]=(0,r.useState)(!1),f=t.icon_info||{icon:"ðŸ“™",icon_type:"emoji",icon_background:"#FFF4ED",icon_url:""};return(0,n.jsxs)("div",{className:(0,y.cn)("group relative mb-1 flex h-10 w-full cursor-pointer items-center justify-between rounded-lg border-[0.5px] border-components-panel-border-subtle bg-components-panel-on-panel-item-bg px-2 last-of-type:mb-0 hover:bg-components-panel-on-panel-item-bg-hover",g&&"border-state-destructive-border hover:bg-state-destructive-hover",l&&"cursor-not-allowed"),children:[(0,n.jsxs)("div",{className:"flex w-0 grow items-center space-x-1.5",children:[(0,n.jsx)(eI.default,{size:"tiny",iconType:f.icon_type,icon:f.icon,background:"image"===f.icon_type?void 0:f.icon_background,imageUrl:"image"===f.icon_type?f.icon_url:void 0}),(0,n.jsx)("div",{className:"system-sm-medium w-0 grow truncate text-text-secondary",title:t.name,children:t.name})]}),(0,n.jsxs)("div",{className:"ml-2 hidden shrink-0 items-center space-x-1 group-hover:flex",children:[o&&!l&&(0,n.jsx)(eL.default,{onClick:e=>{e.stopPropagation(),m(!0)},children:(0,n.jsx)(i.RiEditLine,{className:"h-4 w-4 shrink-0 text-text-tertiary"})}),!l&&(0,n.jsx)(eL.default,{onClick:()=>s(t.id),state:g?eL.ActionButtonState.Destructive:eL.ActionButtonState.Default,onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),children:(0,n.jsx)(i.RiDeleteBinLine,{className:(0,y.cn)("h-4 w-4 shrink-0 text-text-tertiary",g&&"text-text-destructive")})})]}),!!t.indexing_technique&&(0,n.jsx)(F.default,{className:"shrink-0 group-hover:hidden",text:u(t.indexing_technique,t.retrieval_model_dict?.search_method)}),"external"===t.provider&&(0,n.jsx)(F.default,{className:"shrink-0 group-hover:hidden",text:x("externalTag",{ns:"dataset"})}),(0,n.jsx)(eR.default,{isOpen:c,onClose:()=>m(!1),footer:null,mask:p,panelClassName:"mt-16 mx-2 sm:mr-2 mb-3 !p-0 !max-w-[640px] rounded-xl",children:c&&(0,n.jsx)(eO.default,{currentDataset:t,onCancel:()=>m(!1),onSave:e=>{a(e),m(!1)}})})]})};var eB=e.i(994047);let eq=e=>{let{item:t}=e;return(0,n.jsxs)("div",{className:"flex h-[18px] items-center space-x-1 rounded bg-[#EFF8FF] px-1",children:[(0,n.jsx)(I,{type:t.type,className:"text-[#1570EF]"}),(0,n.jsxs)("div",{className:"flex text-xs font-medium text-[#1570EF]",children:[(0,n.jsx)("span",{className:"opacity-60",children:"{{"}),(0,n.jsx)("span",{className:"max-w-[150px] truncate",children:t.value}),(0,n.jsx)("span",{className:"opacity-60",children:"}}"})]})]})},eU=r.memo(e=>{let{triggerClassName:t,className:a,value:s,options:l,onChange:o,notSelectedVarTip:i}=e,{t:p}=(0,d.useTranslation)(),[c,m]=(0,r.useState)(!1),u=l.find(e=>e.value===s),x=!u;return(0,n.jsxs)(S.PortalToFollowElem,{open:c,onOpenChange:m,placement:"bottom-end",offset:{mainAxis:8},children:[(0,n.jsx)(S.PortalToFollowElemTrigger,{className:(0,y.cn)(t),onClick:()=>m(e=>!e),children:(0,n.jsxs)("div",{className:(0,y.cn)(a,x?"border-[#FEDF89] bg-[#FFFCF5] text-[#DC6803]":" border-components-button-secondary-border text-text-accent hover:bg-components-button-secondary-bg",c?"bg-components-button-secondary-bg":"bg-transparent",`
          flex h-8 cursor-pointer items-center justify-center space-x-1 rounded-lg border  px-2 text-[13px]
          font-medium  shadow-xs
          `),children:[(0,n.jsx)("div",{children:s?(0,n.jsx)(eq,{item:u}):(0,n.jsx)("div",{children:i||p("feature.dataSet.queryVariable.choosePlaceholder",{ns:"appDebug"})})}),(0,n.jsx)(eB.ChevronDownIcon,{className:(0,y.cn)(c&&"rotate-180 text-text-tertiary","h-3.5 w-3.5")})]})}),(0,n.jsx)(S.PortalToFollowElemContent,{style:{zIndex:1e3},children:l.length>0?(0,n.jsx)("div",{className:"max-h-[50vh] w-[240px] overflow-y-auto rounded-lg  border border-components-panel-border bg-components-panel-bg p-1 shadow-lg",children:l.map((e,t)=>{let{name:a,value:s,type:l}=e;return(0,n.jsx)("div",{className:"flex cursor-pointer rounded-lg px-3 py-1 hover:bg-state-base-hover",onClick:()=>{o(s),m(!1)},children:(0,n.jsx)(eq,{item:{name:a,value:s,type:l}})},t)})}):(0,n.jsxs)("div",{className:"w-[240px] rounded-lg border border-components-panel-border bg-components-panel-bg p-6 shadow-lg",children:[(0,n.jsx)("div",{className:"mb-1 text-sm font-medium text-text-secondary",children:p("feature.dataSet.queryVariable.noVar",{ns:"appDebug"})}),(0,n.jsx)("div",{className:"text-xs leading-normal text-text-tertiary",children:p("feature.dataSet.queryVariable.noVarTip",{ns:"appDebug"})})]})})]})}),eH=r.memo(e=>{let{t}=(0,d.useTranslation)(),{value:a,options:s}=e,l=s.find(e=>e.value===a);return(0,n.jsxs)("div",{className:(0,y.cn)(l?"border-components-panel-border-subtle":"rounded-bl-xl rounded-br-xl border-[#FEF0C7] bg-[#FEF0C7]","flex h-12 items-center justify-between border-t px-3 "),children:[(0,n.jsxs)("div",{className:"flex shrink-0 items-center space-x-1",children:[(0,n.jsx)("div",{className:"p-1",children:(0,n.jsx)(L.BracketsX,{className:"h-4 w-4 text-text-accent"})}),(0,n.jsx)("div",{className:"mr-1 text-sm font-medium text-text-secondary",children:t("feature.dataSet.queryVariable.title",{ns:"appDebug"})}),(0,n.jsx)(g.default,{popupContent:(0,n.jsx)("div",{className:"w-[180px]",children:t("feature.dataSet.queryVariable.tip",{ns:"appDebug"})})})]}),(0,n.jsx)(eU,{...e})]})});var ez=e.i(21151),e$=e.i(621379),eW=e.i(621708);let eG=(0,r.memo)(e=>{let{disabled:t,selectedDatasets:a}=e,{t:s}=(0,d.useTranslation)(),{datasetConfigs:l,setDatasetConfigs:p,rerankSettingModalOpen:c,setRerankSettingModalOpen:m}=(0,o.useContext)(f.default),[u,g]=(0,r.useState)(l);(0,r.useEffect)(()=>{g(l)},[l]);let{modelList:h,currentModel:v,currentProvider:b}=(0,e_.useModelListAndDefaultModelAndCurrentProviderAndModel)(eb.ModelTypeEnum.rerank),{currentModel:j}=(0,e_.useCurrentProviderAndModel)(h,{provider:u.reranking_model?.reranking_provider_name??"",model:u.reranking_model?.reranking_model_name??""});return(0,n.jsxs)("div",{children:[(0,n.jsxs)(B.default,{variant:"ghost",size:"small",className:(0,y.cn)("h-7",c&&"bg-components-button-ghost-bg-hover"),onClick:()=>{m(!0)},disabled:t,children:[(0,n.jsx)(i.RiEqualizer2Line,{className:"mr-1 h-3.5 w-3.5"}),s("retrievalSettings",{ns:"dataset"})]}),c&&(0,n.jsxs)(ez.default,{isShow:c,onClose:()=>{m(!1)},className:"sm:min-w-[528px]",children:[(0,n.jsx)(eW.default,{datasetConfigs:u,onChange:e=>{let{datasets:t,retrieval_model:s,score_threshold_enabled:n,...l}=e,r=(0,eC.getMultipleRetrievalConfig)({top_k:l.top_k,score_threshold:l.score_threshold,reranking_model:l.reranking_model&&{provider:l.reranking_model.reranking_provider_name,model:l.reranking_model.reranking_model_name},reranking_mode:l.reranking_mode,weights:l.weights,reranking_enable:l.reranking_enable},a,a,{provider:b?.provider,model:v?.model});g({...r,reranking_model:{reranking_provider_name:r.reranking_model?.provider||"",reranking_model_name:r.reranking_model?.model||""},retrieval_model:s,score_threshold_enabled:n,datasets:t})},selectedDatasets:a}),(0,n.jsxs)("div",{className:"mt-6 flex justify-end",children:[(0,n.jsx)(B.default,{className:"mr-2 shrink-0",onClick:()=>{g(l),m(!1)},children:s("operation.cancel",{ns:"common"})}),(0,n.jsx)(B.default,{variant:"primary",className:"shrink-0",onClick:()=>{let e;e="",u.retrieval_model===_.RETRIEVE_TYPE.multiWay&&u.reranking_enable&&u.reranking_mode===e$.RerankingModeEnum.RerankingModel&&!j&&(e=s("datasetConfig.rerankModelRequired",{ns:"appDebug"})),e&&x.default.notify({type:"error",message:e}),e||(p(u),m(!1))},children:s("operation.save",{ns:"common"})})]})]})]})}),eK=r.memo(e=>{let{readonly:t,hideMetadataFilter:a}=e,{t:s}=(0,d.useTranslation)(),i=(0,eN.useSelector)(e=>e.userProfile),{mode:p,dataSets:c,setDataSets:m,modelConfig:u,setModelConfig:x,showSelectDataSet:g,isAgent:h,datasetConfigs:v,datasetConfigsRef:b,setDatasetConfigs:j,setRerankSettingModalOpen:N}=(0,o.useContext)(f.default),w=eA(),k=c.length>0,{currentModel:M,currentProvider:S}=(0,e_.useModelListAndDefaultModelAndCurrentProviderAndModel)(eb.ModelTypeEnum.rerank),E=e=>{let t=c.filter(t=>t.id!==e);m(t);let{datasets:a,retrieval_model:s,score_threshold_enabled:n,...l}=v,{top_k:r,score_threshold:o,reranking_model:i,reranking_mode:d,weights:p,reranking_enable:u}=l,x={top_k:r,score_threshold:o,reranking_model:i&&i.reranking_provider_name&&i.reranking_model_name?{provider:i.reranking_provider_name,model:i.reranking_model_name}:void 0,reranking_mode:d,weights:p,reranking_enable:u},g=(0,eC.getMultipleRetrievalConfig)(x,t,c,{provider:S?.provider,model:M?.model});j({...b.current,...g,reranking_model:{reranking_provider_name:g?.reranking_model?.provider||"",reranking_model_name:g?.reranking_model?.model||""},retrieval_model:s,score_threshold_enabled:n,datasets:a});let{allExternal:h,allInternal:f,mixtureInternalAndExternal:_,mixtureHighQualityAndEconomic:y,inconsistentEmbeddingModel:C}=(0,eC.getSelectedDatasetsMode)(t);(f&&(y||C)||_||h)&&N(!0),w()},D=e=>{let t=c.findIndex(t=>t.id===e.id);m([...c.slice(0,t),e,...c.slice(t+1)]),w()},A=u.configs.prompt_variables,F=A.map(e=>({name:e.name,type:e.type,value:e.key})),L=A?.find(e=>e.is_context_var),I=(0,r.useMemo)(()=>c.map(e=>{let t={createdBy:e.created_by,partialMemberList:e.partial_member_list||[],permission:e.permission};return{...e,editable:(0,ew.hasEditPermissionForDataset)(i?.id||"",t)}}),[c,i?.id]),R=(0,r.useMemo)(()=>(0,ef.intersectionBy)(...I.filter(e=>!!e.doc_metadata).map(e=>e.doc_metadata),"name"),[I]),P=(0,r.useCallback)(e=>{j((0,l.produce)(b.current,t=>{t.metadata_filtering_mode=e}))},[j,b]),O=(0,r.useCallback)(e=>{let{id:t,name:a,type:s}=e,n=ej.ComparisonOperator.is;s===ej.MetadataFilteringVariableType.number&&(n=ej.ComparisonOperator.equal);let r={id:(0,ev.v4)(),metadata_id:t,name:a,comparison_operator:n};j((0,l.produce)(b.current,e=>{e.metadata_filtering_conditions?e.metadata_filtering_conditions.conditions.push(r):e.metadata_filtering_conditions={logical_operator:ej.LogicalOperator.and,conditions:[r]}}))},[j,b]),V=(0,r.useCallback)(e=>{let t=(b.current.metadata_filtering_conditions?.conditions||[]).findIndex(t=>t.id===e);j((0,l.produce)(b.current,e=>{t>-1&&e.metadata_filtering_conditions?.conditions.splice(t,1)}))},[j,b]),B=(0,r.useCallback)((e,t)=>{let a=(b.current.metadata_filtering_conditions?.conditions||[]).findIndex(t=>t.id===e);j((0,l.produce)(b.current,e=>{a>-1&&(e.metadata_filtering_conditions.conditions[a]=t)}))},[j,b]),q=(0,r.useCallback)(()=>{let e=b.current.metadata_filtering_conditions?.logical_operator===ej.LogicalOperator.and?ej.LogicalOperator.or:ej.LogicalOperator.and;j((0,l.produce)(b.current,t=>{t.metadata_filtering_conditions.logical_operator=e}))},[j,b]),U=(0,r.useCallback)(e=>{j((0,l.produce)(b.current,t=>{t.metadata_model_config={provider:e.provider,name:e.modelId,mode:e.mode||_.AppModeEnum.CHAT,completion_params:t.metadata_model_config?.completion_params||{temperature:.7}}}))},[j,b]),H=(0,r.useCallback)(e=>{j((0,l.produce)(b.current,t=>{t.metadata_model_config={...t.metadata_model_config,completion_params:e}}))},[j,b]);return(0,n.jsxs)(C,{className:"mt-2",title:s("feature.dataSet.title",{ns:"appDebug"}),headerRight:!t&&(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[!h&&(0,n.jsx)(eG,{disabled:!k,selectedDatasets:c}),(0,n.jsx)(T,{type:"add",onClick:g})]}),hasHeaderBottomBorder:!k,noBodySpacing:!0,children:[k?(0,n.jsx)("div",{className:(0,y.cn)("mt-1 grid grid-cols-1 px-3 pb-3",t&&"grid-cols-2 gap-1"),children:I.map(e=>(0,n.jsx)(eV,{config:e,onRemove:E,onSave:D,editable:e.editable,readonly:t},e.id))}):(0,n.jsx)("div",{className:"mt-1 px-3 pb-3",children:(0,n.jsx)("div",{className:"pb-1 pt-2 text-xs text-text-tertiary",children:s("feature.dataSet.noData",{ns:"appDebug"})})}),!a&&(0,n.jsx)("div",{className:"border-t border-t-divider-subtle py-2",children:(0,n.jsx)(ey.default,{metadataList:R,selectedDatasetsLoaded:!0,metadataFilterMode:v.metadata_filtering_mode,metadataFilteringConditions:v.metadata_filtering_conditions,handleAddCondition:O,handleMetadataFilterModeChange:P,handleRemoveCondition:V,handleToggleConditionLogicalOperator:q,handleUpdateCondition:B,metadataModelConfig:v.metadata_model_config,handleMetadataModelChange:U,handleMetadataCompletionParamsChange:H,isCommonVariable:!0,availableCommonStringVars:F.filter(e=>e.type===ej.MetadataFilteringVariableType.string||e.type===ej.MetadataFilteringVariableType.select),availableCommonNumberVars:F.filter(e=>e.type===ej.MetadataFilteringVariableType.number)})}),!t&&p===_.AppModeEnum.COMPLETION&&c.length>0&&(0,n.jsx)(eH,{value:L?.key,options:F,onChange:e=>{x((0,l.produce)(u,t=>{t.configs.prompt_variables=u.configs.prompt_variables.map(t=>({...t,is_context_var:t.key===e}))}))}})]})});e.i(8482);var eQ=e.i(322219),eQ=eQ;e.i(793622);var eX=e.i(259509),eY=e.i(836340),eJ=e.i(946700),eZ=e.i(885327),e0=e.i(672530),e1=e.i(381480),e3=e.i(154033),e2=e.i(842090),e4=e.i(661509);let e5=r.memo(()=>{let{t:e}=(0,d.useTranslation)(),[t,a]=(0,r.useState)(!1),{readonly:s,modelConfig:p,setModelConfig:m}=(0,o.useContext)(f.default),{data:u}=(0,e3.useAllBuiltInTools)(),{data:x}=(0,e3.useAllCustomTools)(),{data:h}=(0,e3.useAllWorkflowTools)(),{data:v}=(0,e3.useAllMCPTools)(),b=(0,r.useMemo)(()=>[...u||[],...x||[],...h||[],...v||[]],[u,x,h,v]),_=eA(),[j,N]=(0,r.useState)(null),[w,k]=(0,r.useState)(!1),M=(p?.agentConfig?.tools||[]).map(e=>{let t=b.find(t=>(0,e2.canFindTool)(t.id,e.provider_id)&&t.type===e.provider_type),a=t?.icon;return{...e,icon:a,collection:t}});(0,e1.useMittContextSelector)(e=>e.useSubscribe)("plugin:install:success",(0,r.useCallback)(e=>{m((0,l.produce)(p,t=>{t.agentConfig.tools.forEach(t=>{t.isDeleted&&e.includes(t.provider_id)&&(t.isDeleted=!1)})}))},[p,m]));let[S,E]=(0,r.useState)(-1),D=e=>{let t=b.find(t=>t.id===e.provider_id),a=t?.tools.find(t=>t.name===e.tool_name),s=a?(0,eZ.toolParametersToFormSchemas)(a.parameters):[],n=(0,eZ.addDefaultValue)(e.params,s);return{provider_id:e.provider_id,provider_type:e.provider_type,provider_name:e.provider_name,tool_name:e.tool_name,tool_label:e.tool_label,tool_parameters:n,notAuthor:!e.is_team_authorization,enabled:!0}},A=(0,r.useCallback)(e=>{let t=(0,l.produce)(p,t=>{let a=t.agentConfig.tools.find(e=>e.provider_id===j?.provider_id);a&&(a.credential_id=e)});N({...j,credential_id:e}),m(t),_()},[j,p,m,_]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(C,{className:(0,y.cn)("mt-2",0===M.length&&"pb-2"),noBodySpacing:0===M.length,title:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"mr-1",children:e("agent.tools.name",{ns:"appDebug"})}),(0,n.jsx)(g.default,{popupContent:(0,n.jsx)("div",{className:"w-[180px]",children:e("agent.tools.description",{ns:"appDebug"})})})]}),headerRight:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsxs)("div",{className:"text-xs font-normal leading-[18px] text-text-tertiary",children:[M.filter(e=>!!e.enabled).length,"/",M.length,"Â ",e("agent.tools.enabled",{ns:"appDebug"})]}),M.length<ee.MAX_TOOLS_NUM&&!s&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"ml-3 mr-1 h-3.5 w-px bg-divider-regular"}),(0,n.jsx)(e0.default,{trigger:(0,n.jsx)(T,{type:"add"}),isShow:t,onShowChange:a,disabled:!1,supportAddCustomTool:!0,onSelect:e=>{m((0,l.produce)(p,t=>{t.agentConfig.tools.push(D(e))}))},onSelectMultiple:e=>{m((0,l.produce)(p,t=>{t.agentConfig.tools.push(...e.map(D))}))},selectedTools:M})]})]}),children:(0,n.jsx)("div",{className:(0,y.cn)("grid grid-cols-1 items-center gap-1 2xl:grid-cols-2",s&&"cursor-not-allowed grid-cols-2"),children:M.map((t,a)=>(0,n.jsxs)("div",{className:(0,y.cn)("cursor group relative flex w-full items-center justify-between rounded-lg border-[0.5px] border-components-panel-border-subtle bg-components-panel-on-panel-item-bg p-1.5 pr-2 shadow-xs last-of-type:mb-0 hover:bg-components-panel-on-panel-item-bg-hover hover:shadow-sm",S===a&&"border-state-destructive-border hover:bg-state-destructive-hover"),children:[(0,n.jsxs)("div",{className:"flex w-0 grow items-center",children:[t.isDeleted&&(0,n.jsx)(eQ.default,{className:"h-5 w-5"}),!t.isDeleted&&(0,n.jsxs)("div",{className:(0,y.cn)((t.notAuthor||!t.enabled)&&"shrink-0 opacity-50"),children:["string"==typeof t.icon&&(0,n.jsx)("div",{className:"h-5 w-5 rounded-md bg-cover bg-center",style:{backgroundImage:`url(${t.icon})`}}),"string"!=typeof t.icon&&(0,n.jsx)(eI.default,{className:"rounded-md",size:"xs",icon:t.icon?.content,background:t.icon?.background})]}),(0,n.jsxs)("div",{className:(0,y.cn)("system-xs-regular ml-1.5 flex w-0 grow items-center truncate",t.isDeleted||t.notAuthor||!t.enabled?"opacity-50":""),children:[(0,n.jsx)("span",{className:"system-xs-medium pr-1.5 text-text-secondary",children:t.provider_type===eJ.CollectionType.builtIn?t.provider_name.split("/").pop():t.provider_name}),(0,n.jsx)("span",{className:"text-text-tertiary",children:t.tool_label}),!t.isDeleted&&!s&&(0,n.jsx)(g.default,{popupContent:(0,n.jsxs)("div",{className:"w-[180px]",children:[(0,n.jsx)("div",{className:"mb-1.5 text-text-secondary",children:t.tool_name}),(0,n.jsx)("div",{className:"mb-1.5 text-text-tertiary",children:e("toolNameUsageTip",{ns:"tools"})}),(0,n.jsx)("div",{className:"cursor-pointer text-text-accent",onClick:()=>(0,c.default)(t.tool_name),children:e("copyToolName",{ns:"tools"})})]}),children:(0,n.jsx)("div",{className:"h-4 w-4",children:(0,n.jsx)("div",{className:"ml-0.5 hidden group-hover:inline-block","data-testid":"tool-info-tooltip",children:(0,n.jsx)(i.RiInformation2Line,{className:"h-4 w-4 text-text-tertiary"})})})})]})]}),(0,n.jsxs)("div",{className:"ml-1 flex shrink-0 items-center",children:[t.isDeleted&&(0,n.jsxs)("div",{className:"mr-2 flex items-center",children:[(0,n.jsx)(g.default,{popupContent:e("toolRemoved",{ns:"tools"}),children:(0,n.jsx)("div",{className:"mr-1 cursor-pointer rounded-md p-1 hover:bg-black/5",children:(0,n.jsx)(eX.AlertTriangle,{className:"h-4 w-4 text-[#F79009]"})})}),(0,n.jsx)("div",{className:"cursor-pointer rounded-md p-1 text-text-tertiary hover:text-text-destructive",onClick:()=>{m((0,l.produce)(p,e=>{e.agentConfig.tools.splice(a,1)})),_()},onMouseOver:()=>E(a),onMouseLeave:()=>E(-1),children:(0,n.jsx)(i.RiDeleteBinLine,{className:"h-4 w-4"})})]}),!t.isDeleted&&!s&&(0,n.jsxs)("div",{className:"mr-2 hidden items-center gap-1 group-hover:flex",children:[!t.notAuthor&&(0,n.jsx)(g.default,{popupContent:e("setBuiltInTools.infoAndSetting",{ns:"tools"}),needsDelay:!1,children:(0,n.jsx)("div",{className:"cursor-pointer rounded-md p-1  hover:bg-black/5",onClick:()=>{N(t),k(!0)},children:(0,n.jsx)(i.RiEqualizer2Line,{className:"h-4 w-4 text-text-tertiary"})})}),(0,n.jsx)("div",{className:"cursor-pointer rounded-md p-1 text-text-tertiary hover:text-text-destructive",onClick:()=>{m((0,l.produce)(p,e=>{e.agentConfig.tools.splice(a,1)})),_()},onMouseOver:()=>E(a),onMouseLeave:()=>E(-1),"data-testid":"delete-removed-tool",children:(0,n.jsx)(i.RiDeleteBinLine,{className:"h-4 w-4"})})]}),(0,n.jsxs)("div",{className:(0,y.cn)(t.isDeleted&&"opacity-50"),children:[!t.notAuthor&&(0,n.jsx)(ec.default,{defaultValue:!t.isDeleted&&t.enabled,disabled:t.isDeleted||s,size:"md",onChange:e=>{m((0,l.produce)(p,t=>{t.agentConfig.tools[a].enabled=e})),_()}}),t.notAuthor&&(0,n.jsxs)(B.default,{variant:"secondary",disabled:s,size:"small",onClick:()=>{N(t),k(!0)},children:[e("notAuthorized",{ns:"tools"}),(0,n.jsx)(eY.default,{className:"ml-2",color:"orange"})]})]})]})]},a))})}),w&&(0,n.jsx)(e4.default,{toolName:j?.tool_name,setting:j?.tool_parameters,collection:j?.collection,isModel:j?.collection?.type===eJ.CollectionType.model,onSave:e=>{m((0,l.produce)(p,t=>{let a=t.agentConfig.tools.find(e=>e.provider_id===j?.collection?.id&&e.tool_name===j?.tool_name);a&&(a.tool_parameters=e)})),k(!1),_()},onHide:()=>k(!1),credentialId:j?.credential_id,onAuthorizationItemClick:A})]})});var e6=e.i(501630);let e9=r.memo(()=>{let{t:e}=(0,d.useTranslation)(),t=(0,es.useFeatures)(e=>e.features.file),a=(0,es.useFeaturesStore)(),{isShowAudioConfig:s,readonly:i}=(0,o.useContext)(f.default),p=t?.allowed_file_types?.includes(h.SupportUploadFileTypes.audio)??!1,c=(0,r.useCallback)(e=>{let{features:t,setFeatures:s}=a.getState();s((0,l.produce)(t,t=>{e?t.file.allowed_file_types=Array.from(new Set([...t.file?.allowed_file_types||[],h.SupportUploadFileTypes.audio])):t.file.allowed_file_types=t.file.allowed_file_types?.filter(e=>e!==h.SupportUploadFileTypes.audio),t.file&&(t.file.enabled=(t.file.allowed_file_types?.length??0)>0)}))},[a]);return s&&(!i||p)?(0,n.jsxs)("div",{className:"mt-2 flex items-center gap-2 rounded-xl border-l-[0.5px] border-t-[0.5px] bg-background-section-burn p-2",children:[(0,n.jsx)("div",{className:"shrink-0 p-1",children:(0,n.jsx)("div",{className:"rounded-lg border-[0.5px] border-divider-subtle bg-util-colors-violet-violet-600 p-1 shadow-xs",children:(0,n.jsx)(e6.Microphone01,{className:"h-4 w-4 text-text-primary-on-surface"})})}),(0,n.jsxs)("div",{className:"flex grow items-center",children:[(0,n.jsx)("div",{className:"system-sm-semibold mr-1 text-text-secondary",children:e("feature.audioUpload.title",{ns:"appDebug"})}),(0,n.jsx)(g.default,{popupContent:(0,n.jsx)("div",{className:"w-[180px]",children:e("feature.audioUpload.description",{ns:"appDebug"})})})]}),!i&&(0,n.jsxs)("div",{className:"flex shrink-0 items-center",children:[(0,n.jsx)("div",{className:"ml-1 mr-3 h-3.5 w-[1px] bg-divider-subtle"}),(0,n.jsx)(ec.default,{defaultValue:p,onChange:c,size:"md"})]})]}):null});var e8=e.i(399960),e8=e8;let e7=r.memo(()=>{let{t:e}=(0,d.useTranslation)(),t=(0,es.useFeatures)(e=>e.features.file),a=(0,es.useFeaturesStore)(),{isShowDocumentConfig:s,readonly:i}=(0,o.useContext)(f.default),p=t?.allowed_file_types?.includes(h.SupportUploadFileTypes.document)??!1,c=(0,r.useCallback)(e=>{let{features:t,setFeatures:s}=a.getState();s((0,l.produce)(t,t=>{e?t.file.allowed_file_types=Array.from(new Set([...t.file?.allowed_file_types||[],h.SupportUploadFileTypes.document])):t.file.allowed_file_types=t.file.allowed_file_types?.filter(e=>e!==h.SupportUploadFileTypes.document),t.file&&(t.file.enabled=(t.file.allowed_file_types?.length??0)>0)}))},[a]);return s&&(!i||p)?(0,n.jsxs)("div",{className:"mt-2 flex items-center gap-2 rounded-xl border-l-[0.5px] border-t-[0.5px] bg-background-section-burn p-2",children:[(0,n.jsx)("div",{className:"shrink-0 p-1",children:(0,n.jsx)("div",{className:"rounded-lg border-[0.5px] border-divider-subtle bg-util-colors-indigo-indigo-600 p-1 shadow-xs",children:(0,n.jsx)(e8.default,{className:"h-4 w-4 text-text-primary-on-surface"})})}),(0,n.jsxs)("div",{className:"flex grow items-center",children:[(0,n.jsx)("div",{className:"system-sm-semibold mr-1 text-text-secondary",children:e("feature.documentUpload.title",{ns:"appDebug"})}),(0,n.jsx)(g.default,{popupContent:(0,n.jsx)("div",{className:"w-[180px]",children:e("feature.documentUpload.description",{ns:"appDebug"})})})]}),!i&&(0,n.jsxs)("div",{className:"flex shrink-0 items-center",children:[(0,n.jsx)("div",{className:"ml-1 mr-3 h-3.5 w-[1px] bg-divider-subtle"}),(0,n.jsx)(ec.default,{defaultValue:p,onChange:c,size:"md"})]})]}):null}),te=r.memo(()=>{let{readonly:e,mode:t,isAdvancedMode:a,modelModeType:s,isAgent:r,hasSetBlockStatus:i,showHistoryModal:d,modelConfig:p,setModelConfig:c,setPrevPromptConfig:m,dataSets:u}=(0,o.useContext)(f.default),x=[_.AppModeEnum.ADVANCED_CHAT,_.AppModeEnum.AGENT_CHAT,_.AppModeEnum.CHAT].includes(t),g=eA(),h=p.configs.prompt_template,v=p.configs.prompt_variables;return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"relative h-0 grow overflow-y-auto px-6 pb-[50px]",children:[(0,n.jsx)(eo,{mode:t,promptTemplate:h,promptVariables:v,onChange:(e,t)=>{let a=(0,l.produce)(p,a=>{a.configs.prompt_template=e,a.configs.prompt_variables=[...a.configs.prompt_variables,...t]});p.configs.prompt_template!==e&&g(),m(p.configs),c(a)},readonly:e}),!(e&&0===v.length)&&(0,n.jsx)(V,{promptVariables:v,onPromptVariablesChange:e=>{m(p.configs),c((0,l.produce)(p,t=>{t.configs.prompt_variables=e}))},readonly:e}),!(e&&0===u.length)&&(0,n.jsx)(eK,{readonly:e,hideMetadataFilter:e}),r&&!(e&&0===p.agentConfig.tools.length)&&(0,n.jsx)(e5,{}),(0,n.jsx)(eh,{}),(0,n.jsx)(e7,{}),(0,n.jsx)(e9,{}),!e&&a&&x&&s===_.ModelModeType.completion&&(0,n.jsx)(ed,{showWarning:!i.history,onShowEditModal:d})]})})});e.s(["default",0,te],875489);var tt=e.i(908432),ta=e.i(291631),ts=e.i(299951),tn=e.i(873517),tl=e.i(371784);let tr=e=>{let t,{inputs:a}=e,{t:s}=(0,d.useTranslation)(),{modelConfig:l,setInputs:i,readonly:p}=(0,o.useContext)(f.default),c=l.configs.prompt_variables.filter(e=>{let{key:t,name:a}=e;return t&&t?.trim()&&a&&a?.trim()}),m=(t={},c.forEach(e=>{t[e.key]=!0}),t);(0,r.useEffect)(()=>{let e={...a},t=!1;c.forEach(s=>{let{key:n,default:l}=s;null!=l&&""!==l&&(void 0===a[n]||null===a[n]||""===a[n])&&(e[n]=l,t=!0)}),t&&i(e)},[c,a,i]);let u=(e,t)=>{if(!(e in m))return;let s={...a};c.forEach(a=>{a.key===e&&(s[e]=t)}),i(s)};return c.length?(0,n.jsx)("div",{className:(0,y.cn)("z-[1] rounded-xl border-[0.5px] border-components-panel-border-subtle bg-components-panel-on-panel-item-bg shadow-xs"),children:(0,n.jsx)("div",{className:"px-4 pb-4 pt-3",children:c.map((e,t)=>{let{key:l,name:r,type:o,options:i,max_length:d,required:c}=e;return(0,n.jsx)("div",{className:"mb-4 last-of-type:mb-0",children:(0,n.jsxs)("div",{children:["checkbox"!==o&&(0,n.jsxs)("div",{className:"system-sm-semibold mb-1 flex h-6 items-center gap-1 text-text-secondary",children:[(0,n.jsx)("div",{className:"truncate",children:r||l}),!c&&(0,n.jsx)("span",{className:"system-xs-regular text-text-tertiary",children:s("panel.optional",{ns:"workflow"})})]}),(0,n.jsxs)("div",{className:"grow",children:["string"===o&&(0,n.jsx)(ta.default,{value:a[l]?`${a[l]}`:"",onChange:e=>{u(l,e.target.value)},placeholder:r,autoFocus:0===t,maxLength:d,readOnly:p}),"paragraph"===o&&(0,n.jsx)(tn.default,{className:"h-[120px] grow",placeholder:r,value:a[l]?`${a[l]}`:"",onChange:e=>{u(l,e.target.value)},readOnly:p}),"select"===o&&(0,n.jsx)(ts.default,{className:"w-full",defaultValue:a[l],onSelect:e=>{u(l,e.value)},items:(i||[]).map(e=>({name:e,value:e})),allowSearch:!1,disabled:p}),"number"===o&&(0,n.jsx)(ta.default,{type:"number",value:a[l]?`${a[l]}`:"",onChange:e=>{u(l,e.target.value)},placeholder:r,autoFocus:0===t,maxLength:d,readOnly:p}),"checkbox"===o&&(0,n.jsx)(tl.default,{name:r||l,value:!!a[l],required:c,onChange:e=>{u(l,e)},readonly:p})]})]})},l)})})}):null};var to=e.i(189299),ti=e.i(958572),td=e.i(189107);let tp=r.memo(e=>{let{appType:t,onSend:a,inputs:s,visionConfig:l,onVisionFilesChange:p}=e,{t:c}=(0,d.useTranslation)(),{readonly:m,modelModeType:u,modelConfig:x,setInputs:h,mode:v,isAdvancedMode:b,completionPromptConfig:j,chatPromptConfig:C}=(0,o.useContext)(f.default),[N,w]=(0,r.useState)(!1),k=x.configs.prompt_variables.filter(e=>{let{key:t,name:a}=e;return t&&t?.trim()&&a&&a?.trim()}),T=(0,r.useMemo)(()=>{let e={};return k.forEach(t=>{e[t.key]=!0}),e},[k]);(0,r.useEffect)(()=>{let e={...s},t=!1;k.forEach(a=>{let{key:n,default:l}=a;null!=l&&""!==l&&(void 0===s[n]||null===s[n]||""===s[n])&&(e[n]=l,t=!0)}),t&&h(e)},[k,s,h]);let M=(0,r.useMemo)(()=>v!==_.AppModeEnum.COMPLETION||(b?u===_.ModelModeType.chat?C?.prompt.every(e=>{let{text:t}=e;return!t}):!j.prompt?.text:!x.configs.prompt_template),[C?.prompt,j.prompt?.text,b,v,x.configs.prompt_template,u]),S=(e,t)=>{if(!(e in T))return;let a={...s};k.forEach(s=>{s.key===e&&(a[e]=t)}),h(a)},E=(0,to.useStore)(e=>e.setShowAppConfigureFeaturesModal);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"relative z-[1] mx-3 rounded-xl border-[0.5px] border-components-panel-border-subtle bg-components-panel-on-panel-item-bg shadow-md",children:[(0,n.jsxs)("div",{className:(0,y.cn)("px-4 pt-3",N?"pb-3":"pb-1"),children:[(0,n.jsxs)("div",{className:"flex cursor-pointer items-center gap-0.5 py-0.5",onClick:()=>w(!N),children:[(0,n.jsx)("div",{className:"system-md-semibold-uppercase text-text-secondary",children:c("inputs.userInputField",{ns:"appDebug"})}),N&&(0,n.jsx)(i.RiArrowRightSLine,{className:"h-4 w-4 text-text-secondary"}),!N&&(0,n.jsx)(i.RiArrowDownSLine,{className:"h-4 w-4 text-text-secondary"})]}),!N&&(0,n.jsx)("div",{className:"system-xs-regular mt-1 text-text-tertiary",children:c("inputs.completionVarTip",{ns:"appDebug"})})]}),!N&&k.length>0&&(0,n.jsxs)("div",{className:"px-4 pb-4 pt-3",children:[k.map((e,t)=>{let{key:a,name:l,type:r,options:o,max_length:i,required:d}=e;return(0,n.jsx)("div",{className:"mb-4 last-of-type:mb-0",children:(0,n.jsxs)("div",{children:["checkbox"!==r&&(0,n.jsxs)("div",{className:"system-sm-semibold mb-1 flex h-6 items-center gap-1 text-text-secondary",children:[(0,n.jsx)("div",{className:"truncate",children:l||a}),!d&&(0,n.jsx)("span",{className:"system-xs-regular text-text-tertiary",children:c("panel.optional",{ns:"workflow"})})]}),(0,n.jsxs)("div",{className:"grow",children:["string"===r&&(0,n.jsx)(ta.default,{value:s[a]?`${s[a]}`:"",onChange:e=>{S(a,e.target.value)},placeholder:l,autoFocus:0===t,maxLength:i,readOnly:m}),"paragraph"===r&&(0,n.jsx)(tn.default,{className:"h-[120px] grow",placeholder:l,value:s[a]?`${s[a]}`:"",onChange:e=>{S(a,e.target.value)},readOnly:m}),"select"===r&&(0,n.jsx)(ts.default,{className:"w-full",defaultValue:s[a],onSelect:e=>{S(a,e.value)},items:(o||[]).map(e=>({name:e,value:e})),allowSearch:!1,bgClassName:"bg-gray-50",disabled:m}),"number"===r&&(0,n.jsx)(ta.default,{type:"number",value:s[a]?`${s[a]}`:"",onChange:e=>{S(a,e.target.value)},placeholder:l,autoFocus:0===t,maxLength:i,readOnly:m}),"checkbox"===r&&(0,n.jsx)(tl.default,{name:l||a,value:!!s[a],required:d,onChange:e=>{S(a,e)},readonly:m})]})]})},a)}),l?.enabled&&(0,n.jsxs)("div",{className:"mt-3 justify-between xl:flex",children:[(0,n.jsx)("div",{className:"mr-1 w-[120px] shrink-0 py-2 text-sm text-text-primary",children:c("imageUploader.imageUpload",{ns:"common"})}),(0,n.jsx)("div",{className:"grow",children:(0,n.jsx)(td.default,{settings:l,onFilesChange:e=>p(e.filter(e=>-1!==e.progress).map(e=>({type:"image",transfer_method:e.type,url:e.url,upload_file_id:e.fileId}))),disabled:m})})]})]}),!N&&(0,n.jsxs)("div",{className:"flex justify-between border-t border-divider-subtle p-4 pt-3",children:[(0,n.jsx)(B.default,{className:"w-[72px]",disabled:m,onClick:()=>{let e={};k.forEach(t=>{e[t.key]=""}),h(e)},children:c("operation.clear",{ns:"common"})}),M&&(0,n.jsx)(g.default,{popupContent:c("otherError.promptNoBeEmpty",{ns:"appDebug"}),children:(0,n.jsxs)(B.default,{variant:"primary",disabled:M||m,onClick:()=>a?.(),className:"w-[96px]",children:[(0,n.jsx)(i.RiPlayLargeFill,{className:"mr-0.5 h-4 w-4 shrink-0","aria-hidden":"true"}),c("inputs.run",{ns:"appDebug"})]})}),!M&&(0,n.jsxs)(B.default,{variant:"primary",disabled:M||m,onClick:()=>a?.(),className:"w-[96px]",children:[(0,n.jsx)(i.RiPlayLargeFill,{className:"mr-0.5 h-4 w-4 shrink-0","aria-hidden":"true"}),c("inputs.run",{ns:"appDebug"})]})]})]}),(0,n.jsx)("div",{className:"mx-3",children:(0,n.jsx)(ti.default,{showFileUpload:!1,isChatMode:t!==_.AppModeEnum.COMPLETION,onFeatureBarClick:E,disabled:m,hideEditEntrance:m})})]})});var tc=e.i(419874),tm=e.i(708486),tu=e.i(538883),tx=e.i(83451),tg=e.i(56971),th=e.i(459760),tf=e.i(447301);let tv=r.memo(e=>{let{name:t}=e;return(0,n.jsxs)("div",{className:"mb-1 flex items-center",children:[(0,n.jsx)("div",{className:"mr-3 text-xs font-semibold uppercase leading-[18px] text-text-tertiary",children:t}),(0,n.jsx)("div",{className:"h-px grow",style:{background:"linear-gradient(270deg, rgba(243, 244, 246, 0) 0%, #F3F4F6 100%)"}})]})});var tb=e.i(594512);let t_=(0,n.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{d:"M9.99996 13.3334V10.0001M9.99996 6.66675H10.0083M18.3333 10.0001C18.3333 14.6025 14.6023 18.3334 9.99996 18.3334C5.39759 18.3334 1.66663 14.6025 1.66663 10.0001C1.66663 5.39771 5.39759 1.66675 9.99996 1.66675C14.6023 1.66675 18.3333 5.39771 18.3333 10.0001Z",stroke:"#F79009",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),ty=r.memo(e=>{let{title:t,description:a,footer:s}=e;return(0,n.jsx)("div",{className:`${tb.default.mask} absolute inset-0 z-10 bg-components-panel-bg-blur pt-16`,children:(0,n.jsxs)("div",{className:"mx-auto px-10",children:[(0,n.jsx)("div",{className:`${tb.default.icon} flex h-11 w-11 items-center justify-center rounded-xl bg-components-panel-bg`,children:t_}),(0,n.jsx)("div",{className:"mt-4 text-[24px] font-semibold leading-normal text-text-primary",children:t}),(0,n.jsx)("div",{className:"mt-3 text-base text-text-secondary",children:a}),(0,n.jsx)("div",{className:"mt-6",children:s})]})})}),tj=r.memo(e=>{let{onConfirm:t}=e,{t:a}=(0,d.useTranslation)();return(0,n.jsx)(ty,{title:a("feature.dataSet.queryVariable.unableToQueryDataSet",{ns:"appDebug"}),description:a("feature.dataSet.queryVariable.unableToQueryDataSetTip",{ns:"appDebug"}),footer:(0,n.jsx)("div",{className:"flex space-x-2",children:(0,n.jsx)(B.default,{variant:"primary",className:"flex !w-[96px] justify-start",onClick:t,children:(0,n.jsx)("span",{className:"text-[13px] font-medium",children:a("feature.dataSet.queryVariable.ok",{ns:"appDebug"})})})})})}),tC=(0,n.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{d:"M1.33337 6.66667C1.33337 6.66667 2.67003 4.84548 3.75593 3.75883C4.84183 2.67218 6.34244 2 8.00004 2C11.3137 2 14 4.68629 14 8C14 11.3137 11.3137 14 8.00004 14C5.26465 14 2.95678 12.1695 2.23455 9.66667M1.33337 6.66667V2.66667M1.33337 6.66667H5.33337",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),tN=r.memo(e=>{let{onConfirm:t,onCancel:a}=e,{t:s}=(0,d.useTranslation)();return(0,n.jsx)(ty,{title:s("formattingChangedTitle",{ns:"appDebug"}),description:s("formattingChangedText",{ns:"appDebug"}),footer:(0,n.jsxs)("div",{className:"flex space-x-2",children:[(0,n.jsxs)(B.default,{variant:"primary",className:"flex space-x-2",onClick:t,children:[tC,(0,n.jsx)("span",{children:s("operation.refresh",{ns:"common"})})]}),(0,n.jsx)(B.default,{onClick:a,children:s("operation.cancel",{ns:"common"})})]})})}),tw=(0,n.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{d:"M14 6.00001L14 2.00001M14 2.00001H9.99999M14 2.00001L8 8M6.66667 2H5.2C4.0799 2 3.51984 2 3.09202 2.21799C2.71569 2.40973 2.40973 2.71569 2.21799 3.09202C2 3.51984 2 4.07989 2 5.2V10.8C2 11.9201 2 12.4802 2.21799 12.908C2.40973 13.2843 2.71569 13.5903 3.09202 13.782C3.51984 14 4.07989 14 5.2 14H10.8C11.9201 14 12.4802 14 12.908 13.782C13.2843 13.5903 13.5903 13.2843 13.782 12.908C14 12.4802 14 11.9201 14 10.8V9.33333",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),tk=r.memo(e=>{let{isTrailFinished:t,onSetting:a}=e,{t:s}=(0,d.useTranslation)();return(0,n.jsx)(ty,{title:s(t?"notSetAPIKey.trailFinished":"notSetAPIKey.title",{ns:"appDebug"}),description:s("notSetAPIKey.description",{ns:"appDebug"}),footer:(0,n.jsxs)(B.default,{variant:"primary",className:"flex space-x-2",onClick:a,children:[(0,n.jsx)("span",{children:s("notSetAPIKey.settingBtn",{ns:"appDebug"})}),tw]})})});var tT=e.i(336282);let tM=(0,o.createContext)({multipleModelConfigs:[],onMultipleModelConfigsChange:w.noop,onDebugWithMultipleModelChange:w.noop}),tS=()=>(0,o.useContext)(tM),tE=e=>{let{children:t,onMultipleModelConfigsChange:a,multipleModelConfigs:s,onDebugWithMultipleModelChange:l,checkCanSend:r}=e;return(0,n.jsx)(tM.Provider,{value:{onMultipleModelConfigsChange:a,multipleModelConfigs:s,onDebugWithMultipleModelChange:l,checkCanSend:r},children:t})};var tD=e.i(394895),tA=e.i(241661),tF=e.i(34510),tL=e.i(326773),tI=e.i(53349);let tR=(0,r.memo)(e=>{let{modelAndParameter:t}=e,{userProfile:a}=(0,eN.useAppContext)(),{modelConfig:s,appId:l,inputs:o,collectionList:i}=(0,f.useDebugConfigurationContext)(),{textGenerationModelList:d}=(0,tg.useProviderContext)(),p=(0,es.useFeatures)(e=>e.features),c=eD(),m=(0,r.useMemo)(()=>({...c,more_like_this:p.moreLikeThis,opening_statement:p.opening?.enabled&&p.opening?.opening_statement||"",suggested_questions:p.opening?.enabled&&p.opening?.suggested_questions||[],sensitive_word_avoidance:p.moderation,speech_to_text:p.speech2text,text_to_speech:p.text2speech,file_upload:p.file,suggested_questions_after_answer:p.suggested,retriever_resource:p.citation,annotation_reply:p.annotationReply}),[c,p]),u=(0,r.useMemo)(()=>s.configs.prompt_variables.filter(e=>"api"!==e.type).map(e=>({...e,label:e.name,variable:e.key})),[s.configs.prompt_variables]),{chatList:x,isResponding:g,handleSend:h,suggestedQuestions:b,handleRestart:_}=(0,tL.useChat)(m,{inputs:o,inputsForm:u},[],e=>(0,th.stopChatMessageResponding)(l,e));eF(x);let y=(0,r.useCallback)((e,a)=>{let s=d.find(e=>e.provider===t.provider),n=s?.models.find(e=>e.model===t.model),r=n?.features?.includes(eb.ModelFeatureEnum.vision),i={query:e,inputs:o,model_config:{...m,model:{provider:t.provider,name:t.model,mode:n?.model_properties.mode,completion_params:t.parameters}},parent_message_id:(0,tI.getLastAnswer)(x)?.id||null};m.file_upload.enabled&&a?.length&&r&&(i.files=a),h(`apps/${l}/chat-messages`,i,{onGetConversationMessages:(e,t)=>(0,th.fetchConversationMessages)(l,e,t),onGetSuggestedQuestions:(e,t)=>(0,th.fetchSuggestedQuestions)(l,e,t)})},[l,x,m,h,o,t.model,t.parameters,t.provider,d]),{eventEmitter:j}=(0,v.useEventEmitterContextContext)();j?.useSubscription(e=>{e.type===eM&&y(e.payload.message,e.payload.files),e.type===eS&&_()});let C=(0,r.useMemo)(()=>{let e={};return s.agentConfig.tools?.forEach(t=>{e[t.tool_name]=i.find(e=>(0,e2.canFindTool)(e.id,t.provider_id))?.icon}),e},[i,s.agentConfig.tools]);return x.length?(0,n.jsx)(tF.default,{config:m,chatList:x,isResponding:g,noChatInput:!0,noStopResponding:!0,chatContainerClassName:"p-4",chatFooterClassName:"p-4 pb-0",suggestedQuestions:b,onSend:y,showPromptLog:!0,questionIcon:(0,n.jsx)(tA.default,{avatar:a.avatar_url,name:a.name,size:40}),allToolIcons:C,hideLogModal:!0,noSpacing:!0}):null});e.i(538868);var tP=e.i(506033);e.i(790064);var tO=e.i(171132),tV=e.i(722591),tB=e.i(540284),tq=e.i(337464);let tU=(0,r.memo)(e=>{let{modelAndParameter:t}=e,{t:a}=(0,d.useTranslation)(),{isAdvancedMode:s}=(0,f.useDebugConfigurationContext)(),{multipleModelConfigs:l,onMultipleModelConfigsChange:r,onDebugWithMultipleModelChange:o}=tS(),p=(0,e_.useLanguage)(),c=l.findIndex(e=>e.id===t.id);return(0,n.jsx)(tq.default,{isAdvancedMode:s,provider:t.provider,modelId:t.model,completionParams:t.parameters,onCompletionParamsChange:e=>{let t=[...l];t[c]={...t[c],parameters:e},r(!0,t)},setModel:e=>{let{modelId:t,provider:a}=e,s=[...l];s[c]={...s[c],model:t,provider:a},r(!0,s)},debugWithMultipleModel:!0,onDebugWithMultipleModelChange:()=>o(t),renderTrigger:e=>{let{open:t,currentProvider:s,currentModel:l}=e;return(0,n.jsxs)("div",{className:`
            flex h-8 max-w-[200px] cursor-pointer items-center rounded-lg px-2
            ${t&&"bg-state-base-hover"}
            ${l&&l.status!==eb.ModelStatusEnum.active&&"!bg-[#FFFAEB]"}
          `,children:[s&&(0,n.jsx)(tV.default,{className:"mr-1 !h-4 !w-4",provider:s,modelName:l?.model}),!s&&(0,n.jsx)("div",{className:"mr-1 flex h-4 w-4 items-center justify-center rounded",children:(0,n.jsx)(tO.CubeOutline,{className:"h-4 w-4 text-text-accent"})}),l&&(0,n.jsx)(tB.default,{className:"mr-0.5 text-text-secondary",modelItem:l}),!l&&(0,n.jsx)("div",{className:"mr-0.5 truncate text-[13px] font-medium text-text-accent",children:a("modelProvider.selectModel",{ns:"common"})}),(0,n.jsx)(i.RiArrowDownSLine,{className:`h-3 w-3 ${l&&s?"text-text-tertiary":"text-text-accent"}`}),l&&l.status!==eb.ModelStatusEnum.active&&(0,n.jsx)(g.default,{popupContent:eb.MODEL_STATUS_TEXT[l.status][p],children:(0,n.jsx)(tP.AlertTriangle,{className:"h-4 w-4 text-[#F79009]"})})]})}})});var tH=e.i(367916);let tz=(0,r.memo)(e=>{let{modelAndParameter:t}=e,{isAdvancedMode:a,modelConfig:s,appId:l,inputs:o,promptMode:i,speechToTextConfig:p,introduction:c,suggestedQuestionsAfterAnswerConfig:m,citationConfig:u,externalDataToolsConfig:g,chatPromptConfig:h,completionPromptConfig:b,dataSets:y,datasetConfigs:j}=(0,f.useDebugConfigurationContext)(),{textGenerationModelList:C}=(0,tg.useProviderContext)(),N=(0,es.useFeatures)(e=>e.features),k=y.map(e=>{let{id:t}=e;return{dataset:{enabled:!0,id:t}}}),T=s.configs.prompt_variables.find(e=>e.is_context_var)?.key,M={pre_prompt:a?"":s.configs.prompt_template,prompt_type:i,chat_prompt_config:a?h:(0,ek.cloneDeep)(ee.DEFAULT_CHAT_PROMPT_CONFIG),completion_prompt_config:a?b:(0,ek.cloneDeep)(ee.DEFAULT_COMPLETION_PROMPT_CONFIG),user_input_form:(0,eT.promptVariablesToUserInputsForm)(s.configs.prompt_variables),dataset_query_variable:T||"",more_like_this:N.moreLikeThis,sensitive_word_avoidance:N.moderation,text_to_speech:N.text2speech,file_upload:N.file,opening_statement:c,speech_to_text:p,suggested_questions_after_answer:m,retriever_resource:u,external_data_tools:g,agent_mode:{enabled:!1,tools:[]},dataset_configs:{...j,datasets:{datasets:[...k]}},system_parameters:s.system_parameters},{completion:S,handleSend:E,isResponding:D,messageId:A}=(()=>{let{t:e}=(0,d.useTranslation)(),{notify:t}=(0,x.useToastContext)(),[a,s]=(0,r.useState)(!1),[n,l]=(0,r.useState)(""),[o,i]=(0,r.useState)(null),p=async(n,r)=>{if(a)return t({type:"info",message:e("errorMessage.waitForResponse",{ns:"appDebug"})}),!1;s(!0),l(""),i("");let o=[];return(0,tH.ssePost)(n,{body:{response_mode:"streaming",...r}},{onData:(e,t,a)=>{let{messageId:s}=a;o.push(e),l(o.join("")),i(s)},onMessageReplace:e=>{l((o=[e.answer]).join(""))},onCompleted(){s(!1)},onError(){s(!1)}}),!0};return{completion:n,isResponding:a,setIsResponding:s,handleSend:p,messageId:o}})(),{eventEmitter:F}=(0,v.useEventEmitterContextContext)();return F?.useSubscription(e=>{var a;let s,n,r;e.type===eM&&(e.payload.message,a=e.payload.files,s=C.find(e=>e.provider===t.provider),n=s?.models.find(e=>e.model===t.model),r={inputs:o,model_config:{...M,model:{provider:t.provider,name:t.model,mode:n?.model_properties.mode,completion_params:t.parameters}}},M.file_upload.enabled&&a&&a?.length>0&&(r.files=a.map(e=>e.transfer_method===_.TransferMethod.local_file?{...e,url:""}:e)),E(`apps/${l}/completion-messages`,r))}),(0,n.jsx)(tc.default,{appSourceType:tf.AppSourceType.webApp,className:"flex h-full flex-col overflow-y-auto border-none",content:S,isLoading:!S&&D,isResponding:D,siteInfo:null,messageId:A,isError:!1,onRetry:w.noop,inSidePanel:!0})}),t$=(0,r.memo)(e=>{let{modelAndParameter:t,className:a,style:s}=e,{t:l}=(0,d.useTranslation)(),{mode:r}=(0,f.useDebugConfigurationContext)(),{multipleModelConfigs:o,onMultipleModelConfigsChange:i,onDebugWithMultipleModelChange:p}=tS(),{textGenerationModelList:c}=(0,tg.useProviderContext)(),m=o.findIndex(e=>e.id===t.id),u=c.find(e=>e.provider===t.provider),x=u?.models.find(e=>e.model===t.model);return(0,n.jsxs)("div",{className:`flex min-w-[320px] flex-col rounded-xl bg-background-section-burn ${a}`,style:s,children:[(0,n.jsxs)("div",{className:"flex h-10 shrink-0 items-center justify-between border-b-[0.5px] border-divider-regular px-3",children:[(0,n.jsxs)("div",{className:"flex h-5 w-6 items-center justify-center font-medium italic text-text-tertiary",children:["#",m+1]}),(0,n.jsx)(tU,{modelAndParameter:t}),(0,n.jsx)(tD.default,{onSelect:e=>{if("duplicate"===e.value){if(o.length>=4)return;i(!0,[...o.slice(0,m+1),{...t,id:`${Date.now()}`},...o.slice(m+1)])}"debug-as-single-model"===e.value&&p(t),"remove"===e.value&&i(!0,o.filter(e=>e.id!==t.id))},items:[...o.length<=3?[{value:"duplicate",text:l("duplicateModel",{ns:"appDebug"})}]:[],...t.provider&&t.model?[{value:"debug-as-single-model",text:l("debugAsSingleModel",{ns:"appDebug"})}]:[]],secondItems:o.length>2?[{value:"remove",text:l("operation.remove",{ns:"common"})}]:void 0})]}),(0,n.jsxs)("div",{style:{height:"calc(100% - 40px)"},children:[(r===_.AppModeEnum.CHAT||r===_.AppModeEnum.AGENT_CHAT)&&u&&x&&x.status===eb.ModelStatusEnum.active&&(0,n.jsx)(tR,{modelAndParameter:t}),r===_.AppModeEnum.COMPLETION&&u&&x&&x.status===eb.ModelStatusEnum.active&&(0,n.jsx)(tz,{modelAndParameter:t})]})]})}),tW=(0,r.memo)(()=>{let{mode:e,inputs:t,modelConfig:a}=(0,f.useDebugConfigurationContext)(),s=(0,es.useFeatures)(e=>e.features.speech2text),l=(0,es.useFeatures)(e=>e.features.file),{multipleModelConfigs:o,checkCanSend:i}=tS(),{eventEmitter:d}=(0,v.useEventEmitterContextContext)(),p=e===_.AppModeEnum.CHAT||e===_.AppModeEnum.AGENT_CHAT,c=(0,r.useCallback)((e,t)=>{(!i||i())&&d?.emit({type:eM,payload:{message:e,files:t}})},[d,i]),m=2===o.length,u=3===o.length,x=4===o.length,g=(0,r.useMemo)(()=>{let e="",t="";return m&&(e="calc(50% - 4px - 24px)",t="100%"),u&&(e="calc(33.3% - 5.33px - 16px)",t="100%"),x&&(e="calc(50% - 4px - 24px)",t="calc(50% - 4px)"),{width:e,height:t}},[m,u,x]),h=(0,r.useCallback)(e=>{let t="0",a="0";return m&&1===e&&(t="calc(100% + 8px)"),u&&1===e&&(t="calc(100% + 8px)"),u&&2===e&&(t="calc(200% + 16px)"),x&&1===e&&(t="calc(100% + 8px)"),x&&2===e&&(a="calc(100% + 8px)"),x&&3===e&&(t="calc(100% + 8px)",a="calc(100% + 8px)"),{translateX:t,translateY:a}},[m,u,x]),b=(0,to.useStore)(e=>e.setShowAppConfigureFeaturesModal),y=a.configs.prompt_variables.filter(e=>"api"!==e.type).map(e=>({...e,label:e.name,variable:e.key,hide:e.hide??!1,required:e.required??!1}));return(0,n.jsxs)("div",{className:"flex h-full flex-col",children:[(0,n.jsx)("div",{className:`
          relative mb-3 grow overflow-auto px-6
        `,style:{height:p?"calc(100% - 60px)":"100%"},children:o.map((e,t)=>(0,n.jsx)(t$,{modelAndParameter:e,className:`
                absolute left-6 top-0 min-h-[200px]
                ${m&&0===t&&"mr-2"}
                ${u&&(0===t||1===t)&&"mr-2"}
                ${x&&(0===t||2===t)&&"mr-2"}
                ${x&&(0===t||1===t)&&"mb-2"}
              `,style:{width:g.width,height:g.height,transform:`translateX(${h(t).translateX}) translateY(${h(t).translateY})`}},e.id))}),p&&(0,n.jsx)("div",{className:"shrink-0 px-6 pb-0",children:(0,n.jsx)(tT.default,{botName:"Bot",showFeatureBar:!0,showFileUpload:!1,onFeatureBarClick:b,onSend:c,speechToTextConfig:s,visionConfig:l,inputs:t,inputsForm:y})})]})}),tG=(0,r.memo)(e=>{let{onMultipleModelConfigsChange:t,multipleModelConfigs:a,onDebugWithMultipleModelChange:s,checkCanSend:l}=e;return(0,n.jsx)(tE,{onMultipleModelConfigsChange:t,multipleModelConfigs:a,onDebugWithMultipleModelChange:s,checkCanSend:l,children:(0,n.jsx)(tW,{})})}),tK=e=>{let{ref:t,checkCanSend:a}=e,{userProfile:s}=(0,eN.useAppContext)(),{readonly:l,modelConfig:o,appId:i,inputs:d,collectionList:p,completionParams:c}=(0,f.useDebugConfigurationContext)(),{textGenerationModelList:m}=(0,tg.useProviderContext)(),u=(0,es.useFeatures)(e=>e.features),x=eD(),g=(0,r.useMemo)(()=>({...x,more_like_this:u.moreLikeThis,opening_statement:u.opening?.enabled&&u.opening?.opening_statement||"",suggested_questions:u.opening?.enabled&&u.opening?.suggested_questions||[],sensitive_word_avoidance:u.moderation,speech_to_text:u.speech2text,text_to_speech:u.text2speech,file_upload:u.file,suggested_questions_after_answer:u.suggested,retriever_resource:u.citation,annotation_reply:u.annotationReply}),[x,u]),h=(0,r.useMemo)(()=>o.configs.prompt_variables.filter(e=>"api"!==e.type).map(e=>({...e,label:e.name,variable:e.key})),[o.configs.prompt_variables]),{chatList:v,setTargetMessageId:b,isResponding:_,handleSend:y,suggestedQuestions:j,handleStop:C,handleRestart:N,handleAnnotationAdded:w,handleAnnotationEdited:k,handleAnnotationRemoved:T}=(0,tL.useChat)(g,{inputs:d,inputsForm:h},[],e=>(0,th.stopChatMessageResponding)(i,e));eF(v);let M=(0,r.useCallback)(function(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(a&&!a())return;let l=m.find(e=>e.provider===o.provider),r=l?.models.find(e=>e.model===o.model_id),p=r?.features?.includes(eb.ModelFeatureEnum.vision),u={query:e,inputs:d,model_config:{...g,model:{provider:o.provider,name:o.model_id,mode:o.mode,completion_params:c}},parent_message_id:(s?n?.id:(0,tI.getLastAnswer)(v)?.id)||null};g.file_upload?.enabled&&t?.length&&p&&(u.files=t),y(`apps/${i}/chat-messages`,u,{onGetConversationMessages:(e,t)=>(0,th.fetchConversationMessages)(i,e,t),onGetSuggestedQuestions:(e,t)=>(0,th.fetchSuggestedQuestions)(i,e,t)})},[i,v,a,c,g,y,d,o.mode,o.model_id,o.provider,m]),S=(0,r.useCallback)((e,t)=>{let a=t?e:v.find(t=>t.id===e.parentMessageId),s=v.find(e=>e.id===a.parentMessageId);M(t?t.message:a.content,t?t.files:a.message_files,!0,(0,tI.isValidGeneratedAnswer)(s)?s:null)},[v,M]),E=(0,r.useMemo)(()=>{let e={};return o.agentConfig.tools?.forEach(t=>{e[t.tool_name]=p.find(e=>(0,e2.canFindTool)(e.id,t.provider_id))?.icon}),e},[p,o.agentConfig.tools]);(0,r.useImperativeHandle)(t,()=>({handleRestart:N}),[N]);let D=(0,to.useStore)(e=>e.setShowAppConfigureFeaturesModal);return(0,n.jsx)(tF.default,{readonly:l,config:g,chatList:v,isResponding:_,chatContainerClassName:"px-3 pt-6",chatFooterClassName:"px-3 pt-10 pb-0",showFeatureBar:!0,showFileUpload:!1,onFeatureBarClick:D,suggestedQuestions:j,onSend:M,inputs:d,inputsForm:h,onRegenerate:S,switchSibling:e=>b(e),onStopResponding:C,showPromptLog:!0,questionIcon:(0,n.jsx)(tA.default,{avatar:s.avatar_url,name:s.name,size:40}),allToolIcons:E,onAnnotationEdited:k,onAnnotationAdded:w,onAnnotationRemoved:T,noSpacing:!0})};tK.displayName="DebugWithSingleModel";let tQ=(0,r.memo)(tK),tX=r.memo(e=>{let{isAPIKeySet:t=!0,onSetting:a,inputs:s,modelParameterParams:c,debugWithMultipleModel:m,multipleModelConfigs:u,onMultipleModelConfigsChange:h}=e,{t:b}=(0,d.useTranslation)(),{readonly:y,appId:j,mode:C,modelModeType:N,hasSetBlockStatus:k,isAdvancedMode:T,promptMode:M,chatPromptConfig:S,completionPromptConfig:E,introduction:D,suggestedQuestionsAfterAnswerConfig:A,speechToTextConfig:F,textToSpeechConfig:L,citationConfig:I,formattingChanged:R,setFormattingChanged:P,dataSets:O,modelConfig:V,completionParams:q,hasSetContextVar:U,datasetConfigs:H,externalDataToolsConfig:z}=(0,o.useContext)(f.default),{eventEmitter:$}=(0,v.useEventEmitterContextContext)(),{data:W}=(0,e_.useDefaultModel)(eb.ModelTypeEnum.textEmbedding);(0,r.useEffect)(()=>((0,l.setAutoFreeze)(!1),()=>{(0,l.setAutoFreeze)(!0)}),[]);let[G,{setTrue:K,setFalse:Q}]=(0,p.useBoolean)(!1),[X,Y]=(0,r.useState)(!1),[J,Z]=(0,r.useState)(!1);(0,r.useEffect)(()=>{R&&Y(!0)},[R]);let et=r.useRef(null),ea=async()=>{m?$?.emit({type:eS}):et.current?.handleRestart()},{notify:en}=(0,o.useContext)(x.ToastContext),el=(0,r.useCallback)(e=>{en({type:"error",message:e})},[en]),[er,eo]=(0,r.useState)([]),ei=(0,r.useCallback)(()=>{if(T&&C!==_.AppModeEnum.COMPLETION&&N===_.ModelModeType.completion){if(!k.history)return en({type:"error",message:b("otherError.historyNoBeEmpty",{ns:"appDebug"})}),!1;if(!k.query)return en({type:"error",message:b("otherError.queryNoBeEmpty",{ns:"appDebug"})}),!1}let e="";return(V.configs.prompt_variables.filter(e=>{let{key:t,name:a,required:s,type:n}=e;return("string"===n||"paragraph"===n||"select"===n||"number"===n)&&(!t||!t.trim()||!a||!a.trim()||s||null==s)}).forEach(t=>{let{key:a,name:n}=t;!e&&(s[a]||(e=n))}),e)?(el(b("errorMessage.valueOfVarRequired",{ns:"appDebug",key:e})),!1):er.find(e=>e.transfer_method===_.TransferMethod.local_file&&!e.upload_file_id)?(en({type:"info",message:b("errorMessage.waitForFileUpload",{ns:"appDebug"})}),!1):!e},[er,k.history,k.query,s,T,C,V.configs.prompt_variables,b,el,en,N]),[ed,ep]=(0,r.useState)(""),[ec,em]=(0,r.useState)(null),eu=(0,es.useFeatures)(e=>e.features),ex=(0,es.useFeaturesStore)(),eg=async()=>{if(G)return en({type:"info",message:b("errorMessage.waitForResponse",{ns:"appDebug"})}),!1;if(O.length>0&&!U)return Z(!0),!0;if(!ei())return;let e=O.map(e=>{let{id:t}=e;return{dataset:{enabled:!0,id:t}}}),t=V.configs.prompt_variables.find(e=>e.is_context_var)?.key,a={pre_prompt:T?"":V.configs.prompt_template,prompt_type:M,chat_prompt_config:T?S:(0,ek.cloneDeep)(ee.DEFAULT_CHAT_PROMPT_CONFIG),completion_prompt_config:T?E:(0,ek.cloneDeep)(ee.DEFAULT_COMPLETION_PROMPT_CONFIG),user_input_form:(0,eT.promptVariablesToUserInputsForm)(V.configs.prompt_variables),dataset_query_variable:t||"",dataset_configs:{...H,datasets:{datasets:[...e]}},agent_mode:{enabled:!1,tools:[]},model:{provider:V.provider,name:V.model_id,mode:V.mode,completion_params:q},more_like_this:eu.moreLikeThis,sensitive_word_avoidance:eu.moderation,text_to_speech:eu.text2speech,file_upload:eu.file,opening_statement:D,suggested_questions_after_answer:A,speech_to_text:F,retriever_resource:I,system_parameters:V.system_parameters,external_data_tools:z},n={inputs:(0,eT.formatBooleanInputs)(V.configs.prompt_variables,s),model_config:a};eu.file.enabled&&er&&er?.length>0&&(n.files=er.map(e=>e.transfer_method===_.TransferMethod.local_file?{...e,url:""}:e)),ep(""),em("");let l=[];K(),(0,th.sendCompletionMessage)(j,n,{onData:(e,t,a)=>{let{messageId:s}=a;l.push(e),ep(l.join("")),em(s)},onMessageReplace:e=>{ep((l=[e.answer]).join(""))},onCompleted(){Q()},onError(){Q()}})},eh=V.configs.prompt_variables.map(e=>({label:e.key,value:s[e.key]})),{textGenerationModelList:ef}=(0,tg.useProviderContext)(),ev=(0,r.useCallback)(()=>{if(m&&C){let e=u.some(e=>{let t=ef.find(t=>t.provider===e.provider),a=t?.models.find(t=>t.model===e.model);return a?.features?.includes(eb.ModelFeatureEnum.vision)}),{features:t,setFeatures:a}=ex.getState();a((0,l.produce)(t,t=>{t.file={...t.file,enabled:e}}))}},[m,ex,C,u,ef]);(0,r.useEffect)(()=>{ev()},[u,C,ev]);let{currentLogItem:ey,setCurrentLogItem:ej,showPromptLogModal:eC,setShowPromptLogModal:eN,showAgentLogModal:ew,setShowAgentLogModal:eE}=(0,to.useStore)((0,tt.useShallow)(e=>({currentLogItem:e.currentLogItem,setCurrentLogItem:e.setCurrentLogItem,showPromptLogModal:e.showPromptLogModal,setShowPromptLogModal:e.setShowPromptLogModal,showAgentLogModal:e.showAgentLogModal,setShowAgentLogModal:e.setShowAgentLogModal}))),[eD,eA]=(0,r.useState)(0),eF=(0,r.useRef)(null);(0,r.useEffect)(()=>{eF.current&&eA(document.body.clientWidth-(eF.current?.clientWidth+16)-8)},[]);let[eI,eR]=(0,r.useState)(!0);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"shrink-0",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between px-4 pb-2 pt-3",children:[(0,n.jsx)("div",{className:"system-xl-semibold text-text-primary",children:b("inputs.title",{ns:"appDebug"})}),(0,n.jsxs)("div",{className:"flex items-center",children:[m?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(B.default,{variant:"ghost-accent",onClick:()=>h(!0,[...u,{id:`${Date.now()}`,model:"",provider:"",parameters:{}}]),disabled:u.length>=4,children:[(0,n.jsx)(i.RiAddLine,{className:"mr-1 h-3.5 w-3.5"}),b("modelProvider.addModel",{ns:"common"}),"(",u.length,"/4)"]}),(0,n.jsx)("div",{className:"mx-2 h-[14px] w-[1px] bg-divider-regular"})]}):null,C!==_.AppModeEnum.COMPLETION&&(0,n.jsxs)(n.Fragment,{children:[!y&&(0,n.jsx)(g.default,{popupContent:b("operation.refresh",{ns:"common"}),children:(0,n.jsx)(eL.default,{onClick:ea,children:(0,n.jsx)(tu.RefreshCcw01,{className:"h-4 w-4"})})}),eh.length>0&&(0,n.jsxs)("div",{className:"relative ml-1 mr-2",children:[(0,n.jsx)(g.default,{popupContent:b("panel.userInputField",{ns:"workflow"}),children:(0,n.jsx)(eL.default,{state:eI?eL.ActionButtonState.Active:void 0,onClick:()=>!y&&eR(!eI),children:(0,n.jsx)(i.RiEqualizer2Line,{className:"h-4 w-4"})})}),eI&&(0,n.jsx)("div",{className:"absolute bottom-[-14px] right-[5px] z-10 h-3 w-3 rotate-45 border-l-[0.5px] border-t-[0.5px] border-components-panel-border-subtle bg-components-panel-on-panel-item-bg"})]})]})]})]}),C!==_.AppModeEnum.COMPLETION&&eI&&(0,n.jsx)("div",{className:"mx-3",children:(0,n.jsx)(tr,{inputs:s})}),C===_.AppModeEnum.COMPLETION&&(0,n.jsx)(tp,{appType:C,onSend:()=>{m?$?.emit({type:eM,payload:{message:"",files:er}}):eg()},inputs:s,visionConfig:{...eu.file,transfer_methods:eu.file.allowed_file_upload_methods||[],image_file_size_limit:eu.file?.fileUploadConfig?.image_file_size_limit},onVisionFilesChange:eo})]}),m&&(0,n.jsxs)("div",{className:"mt-3 grow overflow-hidden",ref:eF,children:[(0,n.jsx)(tG,{multipleModelConfigs:u,onMultipleModelConfigsChange:h,onDebugWithMultipleModelChange:e=>{let t=ef.find(t=>t.provider===e.provider),a=t?.models.find(t=>t.model===e.model);c.setModel({modelId:e.model,provider:e.provider,mode:a?.model_properties.mode,features:a?.features}),c.onCompletionParamsChange(e.parameters),h(!1,[])},checkCanSend:ei}),eC&&(0,n.jsx)(tx.default,{width:eD,currentLogItem:ey,onCancel:()=>{ej(),eN(!1)}}),ew&&(0,n.jsx)(tm.default,{width:eD,currentLogItem:ey,onCancel:()=>{ej(),eE(!1)}})]}),!m&&(0,n.jsxs)("div",{className:"flex grow flex-col",ref:eF,children:[C!==_.AppModeEnum.COMPLETION&&(0,n.jsx)("div",{className:"h-0 grow overflow-hidden",children:(0,n.jsx)(tQ,{ref:et,checkCanSend:ei})}),C===_.AppModeEnum.COMPLETION&&(0,n.jsxs)(n.Fragment,{children:[(ed||G)&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"mx-4 mt-3",children:(0,n.jsx)(tv,{name:b("result",{ns:"appDebug"})})}),(0,n.jsx)("div",{className:"mx-3 mb-8",children:(0,n.jsx)(tc.default,{appSourceType:tf.AppSourceType.webApp,className:"mt-2",content:ed,isLoading:!ed&&G,isShowTextToSpeech:L.enabled&&!!W,isResponding:G,messageId:ec,isError:!1,onRetry:w.noop,siteInfo:null})})]}),!ed&&!G&&(0,n.jsxs)("div",{className:"flex grow flex-col items-center justify-center gap-2",children:[(0,n.jsx)(i.RiSparklingFill,{className:"h-12 w-12 text-text-empty-state-icon"}),(0,n.jsx)("div",{className:"system-sm-regular text-text-quaternary",children:b("noResult",{ns:"appDebug"})})]})]}),C===_.AppModeEnum.COMPLETION&&eC&&(0,n.jsx)(tx.default,{width:eD,currentLogItem:ey,onCancel:()=>{ej(),eN(!1)}}),J&&(0,n.jsx)(tj,{onConfirm:()=>Z(!1)})]}),X&&(0,n.jsx)(tN,{onConfirm:()=>{ea(),Y(!1),P(!1)},onCancel:()=>{Y(!1),P(!1)}}),!t&&!y&&(0,n.jsx)(tk,{isTrailFinished:!ee.IS_CE_EDITION,onSetting:a})]})});e.s(["default",0,tX],315765)}]);
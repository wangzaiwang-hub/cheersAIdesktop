(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,597280,e=>{"use strict";var t=e.i(563199),r=e.i(294237),a=e.i(268255),s=e.i(421001),l=e.i(935139);let o=(0,r.cva)([],{variants:{align:{left:"justify-start",center:"justify-center",right:"justify-end"}},defaultVariants:{align:"center"}}),i=a.memo(e=>{let{className:r,title:i,onSelect:n,selected:c,disabled:d,align:u="center",tooltip:p}=e,m=(0,a.useCallback)(()=>{c||d||n()},[n,c,d]);return(0,t.jsxs)("div",{className:(0,l.cn)("system-sm-regular flex h-8 cursor-default items-center rounded-md border border-components-option-card-option-border bg-components-option-card-option-bg px-2 text-text-secondary",!c&&!d&&"cursor-pointer hover:border-components-option-card-option-border-hover hover:bg-components-option-card-option-bg-hover hover:shadow-xs",c&&"system-sm-medium border-[1.5px] border-components-option-card-option-selected-border bg-components-option-card-option-selected-bg shadow-xs",d&&"text-text-disabled",o({align:u}),r),onClick:m,children:[(0,t.jsx)("span",{children:i}),p&&(0,t.jsx)(s.default,{popupContent:(0,t.jsx)("div",{className:"w-[240px]",children:p})})]})});e.s(["default",0,i])},249385,e=>{"use strict";var t=e.i(563199),r=e.i(837699),a=e.i(268255),s=e.i(654313);let l=a.memo(e=>{let{onClick:a}=e;return(0,t.jsx)(s.default,{size:"l",className:"group shrink-0 hover:!bg-state-destructive-hover",onClick:a,children:(0,t.jsx)(r.RiDeleteBinLine,{className:"h-4 w-4 text-text-tertiary group-hover:text-text-destructive"})})});e.s(["default",0,l])},619507,299075,e=>{"use strict";e.i(845780);var t=e.i(720315),r=e.i(949250);e.i(275225);var a=e.i(705405),s=e.i(390622),l=e.i(654537);let o=e=>({[l.PipelineInputVarType.number]:s.VarType.number,[l.PipelineInputVarType.singleFile]:s.VarType.file,[l.PipelineInputVarType.multiFiles]:s.VarType.arrayFile,[l.PipelineInputVarType.checkbox]:s.VarType.boolean})[e]||s.VarType.string;var i=e.i(192447);let n=e=>{let{getNodes:t}=(0,i.useStoreApi)().getState(),r=t(),a=r.find(t=>t.id===e),s=!!a?.data.isInIteration,l=!!a?.data.isInLoop,o=a?.parentId;return{node:a,isInIteration:s,isInLoop:l,parentNode:r.find(e=>e.id===o)}};e.s(["default",0,n],299075),e.s(["default",0,function(e){let{onlyLeafNodeVar:l,filterVar:i,hideEnv:c,hideChatVar:d,passedInAvailableNodes:u}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{onlyLeafNodeVar:!1,filterVar:()=>!0},{getTreeLeafNodes:p,getNodeById:m,getBeforeNodesInSameBranchIncludeParent:x}=(0,t.useWorkflow)(),{getNodeAvailableVars:v}=(0,r.useWorkflowVariables)(),h=(0,t.useIsChatMode)(),f=u||(l?p(e):x(e)),{parentNode:b}=n(e),g=m(e),y=(0,a.useStore)(e=>e.ragPipelineVariables),j=g?.data?.type===s.BlockEnum.DataSource,w=[];if(j){let t=y?.filter(t=>t.belong_to_node_id===e),r=t?.filter(t=>i({variable:t.variable,type:o(t.type),nodeId:e,isRagVariable:!0},["rag",e,t.variable]));r?.length&&w.push({nodeId:e,title:g.data?.title,vars:r.map(t=>({variable:`rag.${e}.${t.variable}`,type:o(t.type),description:t.label,isRagVariable:!0}))})}return{availableVars:[...v({parentNode:b,beforeNodes:f,isChatMode:h,filterVar:i,hideEnv:c,hideChatVar:d}),...w],availableNodes:f,availableNodesWithParent:[...f,...j?[g]:[]]}}],619507)},65932,(e,t,r)=>{"use strict";t.exports=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==typeof t&&"object"==typeof r){if(t.constructor!==r.constructor)return!1;if(Array.isArray(t)){if((a=t.length)!=r.length)return!1;for(s=a;0!=s--;)if(!e(t[s],r[s]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if((a=(l=Object.keys(t)).length)!==Object.keys(r).length)return!1;for(s=a;0!=s--;)if(!Object.prototype.hasOwnProperty.call(r,l[s]))return!1;for(s=a;0!=s--;){var a,s,l,o=l[s];if(!e(t[o],r[o]))return!1}return!0}return t!=t&&r!=r}},449448,e=>{"use strict";function t(e){return[...new Set(e)]}e.s(["uniq",()=>t])},534042,141167,e=>{"use strict";var t,r=((t={}).blue="blue",t.cyan="cyan",t.green="green",t.yellow="yellow",t.pink="pink",t.violet="violet",t);e.s(["NoteTheme",()=>r],141167);let a={[r.blue]:{outer:"border-util-colors-blue-blue-500",title:"bg-util-colors-blue-blue-100",bg:"bg-util-colors-blue-blue-50",border:"border-util-colors-blue-blue-300"},[r.cyan]:{outer:"border-util-colors-cyan-cyan-500",title:"bg-util-colors-cyan-cyan-100",bg:"bg-util-colors-cyan-cyan-50",border:"border-util-colors-cyan-cyan-300"},[r.green]:{outer:"border-util-colors-green-green-500",title:"bg-util-colors-green-green-100",bg:"bg-util-colors-green-green-50",border:"border-util-colors-green-green-300"},[r.yellow]:{outer:"border-util-colors-yellow-yellow-500",title:"bg-util-colors-yellow-yellow-100",bg:"bg-util-colors-yellow-yellow-50",border:"border-util-colors-yellow-yellow-300"},[r.pink]:{outer:"border-util-colors-pink-pink-500",title:"bg-util-colors-pink-pink-100",bg:"bg-util-colors-pink-pink-50",border:"border-util-colors-pink-pink-300"},[r.violet]:{outer:"border-util-colors-violet-violet-500",title:"bg-util-colors-violet-violet-100",bg:"bg-util-colors-violet-violet-100",border:"border-util-colors-violet-violet-300"}};e.s(["CUSTOM_NOTE_NODE",0,"custom-note","THEME_MAP",0,a],534042)},42241,45490,370546,268571,737753,479735,484655,3371,e=>{"use strict";var t=e.i(563199),r=e.i(807324),a=e.i(986823);let s=e=>{let{ref:s,...l}=e;return(0,t.jsx)(r.default,{...l,ref:s,data:a.default})};s.displayName="BubbleX",e.s(["default",0,s],45490),e.i(218459);var l=e.i(792257);let o=e=>{let{ref:a,...s}=e;return(0,t.jsx)(r.default,{...s,ref:a,data:l.default})};o.displayName="DragHandle",e.s(["default",0,o],370546);var i=e.i(262909);let n=e=>{let{ref:a,...s}=e;return(0,t.jsx)(r.default,{...s,ref:a,data:i.default})};n.displayName="Env",e.s(["default",0,n],268571);var c=e.i(341579);let d=e=>{let{ref:a,...s}=e;return(0,t.jsx)(r.default,{...s,ref:a,data:c.default})};d.displayName="GlobalVariable",e.s(["default",0,d],737753);var u=e.i(274378);let p=e=>{let{ref:a,...s}=e;return(0,t.jsx)(r.default,{...s,ref:a,data:u.default})};p.displayName="Icon3Dots",e.s(["default",0,p],479735);var m=e.i(641469);let x=e=>{let{ref:a,...s}=e;return(0,t.jsx)(r.default,{...s,ref:a,data:m.default})};x.displayName="LongArrowLeft",e.s(["default",0,x],484655);var v=e.i(103751);let h=e=>{let{ref:a,...s}=e;return(0,t.jsx)(r.default,{...s,ref:a,data:v.default})};h.displayName="LongArrowRight",e.s(["default",0,h],3371),e.i(862712),e.i(234661),e.s([],42241)},649538,e=>{"use strict";var t=e.i(918077);e.s(["ChevronRight",()=>t.default])},825220,e=>{"use strict";var t=e.i(268571);e.s(["Env",()=>t.default])},379636,e=>{"use strict";var t=e.i(737753);e.s(["GlobalVariable",()=>t.default])},981875,e=>{"use strict";var t,r=((t={}).conversation="conversation",t.environment="env",t.node="node",t.system="sys",t);e.s(["VarInInspectType",()=>r])},661734,535614,951875,189497,e=>{"use strict";var t=e.i(563199),r=e.i(807324),a=e.i(732056);let s=e=>{let{ref:s,...l}=e;return(0,t.jsx)(r.default,{...l,ref:s,data:a.default})};s.displayName="InputField",e.s(["default",0,s],535614);var l=e.i(181096);let o=e=>{let{ref:a,...s}=e;return(0,t.jsx)(r.default,{...s,ref:a,data:l.default})};o.displayName="PipelineFill",e.s(["default",0,o],951875);var i=e.i(8717);let n=e=>{let{ref:a,...s}=e;return(0,t.jsx)(r.default,{...s,ref:a,data:i.default})};n.displayName="PipelineLine",e.s(["default",0,n],189497),e.s([],661734)},505816,e=>{"use strict";var t=e.i(535614);e.s(["InputField",()=>t.default])},678383,e=>{"use strict";var t=e.i(328960);e.s(["Variable02",()=>t.default])},226577,e=>{"use strict";var t=e.i(45490);e.s(["BubbleX",()=>t.default])},603198,866438,54010,645960,971481,95240,e=>{"use strict";var t=e.i(563199),r=e.i(268255),a=e.i(935139);e.i(42241);var s=e.i(226577),l=e.i(825220),o=e.i(379636);e.i(661734);var i=e.i(505816);e.i(39598);var n=e.i(678383);e.i(916131);var c=e.i(806436),d=e.i(959752),u=e.i(981875),p=e.i(963855);let m=(e,t,a)=>(0,r.useMemo)(()=>t?"text-text-warning":"loop"===a?"text-util-colors-cyan-cyan-500":(0,p.isENV)(e)||a===u.VarInInspectType.environment||"environment"===a?"text-util-colors-violet-violet-600":(0,p.isConversationVar)(e)||a===u.VarInInspectType.conversation||"conversation"===a?"text-util-colors-teal-teal-700":(0,p.isGlobalVar)(e)||a===u.VarInInspectType.system?"text-util-colors-orange-orange-600":"text-text-accent",[e,t,a]),x=(0,r.memo)(e=>{let{className:r,variables:d=[],variableCategory:m}=e,x="loop"===m?c.Loop:"rag"===m||(0,p.isRagVariableVar)(d)?i.InputField:(0,p.isENV)(d)||m===u.VarInInspectType.environment||"environment"===m?l.Env:(0,p.isConversationVar)(d)||m===u.VarInInspectType.conversation||"conversation"===m?s.BubbleX:(0,p.isGlobalVar)(d)||m===u.VarInInspectType.system?o.GlobalVariable:n.Variable02;return x&&(0,t.jsx)(x,{className:(0,a.cn)("size-3.5 shrink-0",r)})}),v=(0,r.memo)(e=>{let{isExceptionVariable:r,variableCategory:s,variables:l=[],className:o}=e,i=m(l,r,s);return(0,t.jsx)(x,{variables:l,variableCategory:s,className:(0,a.cn)(i,o)})});e.s(["default",0,v],866438);var h=e.i(837699),f=e.i(403861),b=e.i(421001);let g=(0,r.memo)(e=>{let s,l,o,{variables:i,className:n,notShowFullPath:c}=e,u=(s=d.VAR_SHOW_NAME_MAP[i.join(".")],l=i.slice(1).join("."),(0,p.isRagVariableVar)(i)&&(l=i.slice(2).join(".")),o=(0,r.useMemo)(()=>{l=i.slice(1).join("."),(0,p.isRagVariableVar)(i)&&(l=i.slice(2).join("."));let e=i.length,t=(0,p.isSystemVar)(i),r=c?i[e-1]:l;return`${t?"sys.":""}${r}`},[i,c]),s||o);return(0,t.jsx)("div",{className:(0,a.cn)("system-xs-medium truncate",n),title:u,children:u})});var y=e.i(120219);let j=(0,r.memo)(e=>{let{nodeType:r,nodeTitle:a}=e;return r?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(y.VarBlockIcon,{type:r,className:"shrink-0 text-text-secondary"}),a&&(0,t.jsx)("div",{className:"system-xs-medium max-w-[60px] truncate text-text-secondary",title:a,children:a}),(0,t.jsx)("div",{className:"system-xs-regular shrink-0 text-divider-deep",children:"/"})]}):null}),w=(0,r.memo)(e=>{let{nodeType:r,nodeTitle:s,variables:l,variableType:o,className:i,errorMsg:n,onClick:c,isExceptionVariable:d,ref:u,notShowFullPath:v,rightSlot:y}=e,w=m(l,d),N=!((0,p.isENV)(l)||(0,p.isConversationVar)(l)||(0,p.isGlobalVar)(l)||(0,p.isRagVariableVar)(l));return(0,t.jsxs)("div",{className:(0,a.cn)("inline-flex h-6 max-w-full items-center space-x-0.5 rounded-md border-[0.5px] border-components-panel-border-subtle bg-components-badge-white-to-dark px-1.5 shadow-xs",i),onClick:c,ref:u,children:[N&&(0,t.jsx)(j,{nodeType:r,nodeTitle:s}),v&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(h.RiMoreLine,{className:"h-3 w-3 shrink-0 text-text-secondary"}),(0,t.jsx)("div",{className:"system-xs-regular shrink-0 text-divider-deep",children:"/"})]}),(0,t.jsx)(x,{variables:l,className:w}),(0,t.jsx)(g,{variables:l,className:(0,a.cn)(w),notShowFullPath:v}),!!o&&(0,t.jsx)("div",{className:"system-xs-regular shrink-0 text-text-tertiary",children:(0,f.capitalize)(o)}),!!n&&(0,t.jsx)(b.default,{popupContent:n,asChild:!0,children:(0,t.jsx)(h.RiErrorWarningFill,{className:"h-3 w-3 shrink-0 text-text-destructive"})}),y]})}),N=(0,r.memo)(e=>{let{isSelected:r,variables:s,errorMsg:l,...o}=e,{hoverBorderColor:i,hoverBgColor:n,selectedBorderColor:c,selectedBgColor:d}=l?{hoverBorderColor:"hover:border-state-destructive-active",hoverBgColor:"hover:bg-state-destructive-hover",selectedBorderColor:"!border-state-destructive-solid",selectedBgColor:"!bg-state-destructive-hover"}:(0,p.isENV)(s)?{hoverBorderColor:"hover:border-util-colors-violet-violet-100",hoverBgColor:"hover:bg-util-colors-violet-violet-50",selectedBorderColor:"border-util-colors-violet-violet-600",selectedBgColor:"bg-util-colors-violet-violet-50"}:(0,p.isConversationVar)(s)?{hoverBorderColor:"hover:border-util-colors-teal-teal-100",hoverBgColor:"hover:bg-util-colors-teal-teal-50",selectedBorderColor:"border-util-colors-teal-teal-600",selectedBgColor:"bg-util-colors-teal-teal-50"}:{hoverBorderColor:"hover:border-state-accent-alt",hoverBgColor:"hover:bg-state-accent-hover",selectedBorderColor:"border-state-accent-solid",selectedBgColor:"bg-state-accent-hover"};return(0,t.jsx)(w,{className:(0,a.cn)("h-[18px] space-x-[1px] rounded-[5px] px-1 shadow-xs",!r&&n,!r&&i,r&&"border",r&&c,r&&d),variables:s,errorMsg:l,...o})});e.s(["default",0,N],54010);let V=(0,r.memo)(e=>(0,t.jsx)(w,{className:(0,a.cn)("w-full space-x-[1px] bg-workflow-block-parma-bg px-1 shadow-none"),...e}));e.s(["default",0,V],645960);let C=(0,r.memo)(e=>(0,t.jsx)(w,{...e}));e.s(["default",0,C],971481);let k=(0,r.memo)(e=>(0,t.jsx)(w,{className:(0,a.cn)("h-[18px] space-x-[1px] rounded-[5px] px-1 shadow-xs"),...e}));e.s(["default",0,k],95240),e.s([],603198)},892081,e=>{"use strict";var t=e.i(393689),r=e.i(220431);let a=function(e){if(!e||!document.getRootNode)return document;var t,a=Array.isArray(e)?e:[e];return a.every(function(e){var t=(0,r.getTargetElement)(e);return!!t&&t.getRootNode()instanceof ShadowRoot})?(t=(0,r.getTargetElement)(a[0]))?t.getRootNode():document:document};var s=e.i(99878);function l(e,l,o){void 0===o&&(o="click");var i=(0,t.default)(e);(0,s.default)(function(){var e=function(e){(Array.isArray(l)?l:[l]).some(function(t){var a=(0,r.getTargetElement)(t);return!a||a.contains(e.target)})||i.current(e)},t=a(l),s=Array.isArray(o)?o:[o];return s.forEach(function(r){return t.addEventListener(r,e)}),function(){s.forEach(function(r){return t.removeEventListener(r,e)})}},Array.isArray(o)?o:[o],l)}e.s(["useClickAway",()=>l],892081)},112757,e=>{"use strict";var t=e.i(707844);e.s(["Line3",()=>t.default])},359173,e=>{"use strict";var t=e.i(321124);e.s(["ChevronSelectorVertical",()=>t.default])},766036,e=>{"use strict";var t=e.i(563199),r=e.i(837699),a=e.i(268255),s=e.i(935139);let l=a.memo(e=>{let{className:a,onClick:l}=e;return(0,t.jsx)("div",{className:(0,s.cn)(a,"cursor-pointer select-none rounded-md p-1 hover:bg-state-base-hover"),onClick:l,children:(0,t.jsx)(r.RiAddLine,{className:"h-4 w-4 text-text-tertiary"})})});e.s(["default",0,l])},22461,116546,64997,e=>{"use strict";var t=e.i(563199),r=e.i(837699),a=e.i(124836),s=e.i(105845),l=e.i(268255);e.i(152567);var o=e.i(408767),i=e.i(192447),n=e.i(83278),c=e.i(766036);e.i(432024);var d=e.i(112757);e.i(39598);var u=e.i(678383),p=e.i(391185),m=e.i(421001),x=e.i(739255),v=e.i(120219),h=e.i(959752);e.i(845780);var f=e.i(720315),b=e.i(949250),g=e.i(417944),y=e.i(892081);e.i(668763);var j=e.i(359173);e.i(47690);var w=e.i(490774),N=e.i(935139);let V=l.memo(e=>{let{className:r,trigger:a,DropDownIcon:s=j.ChevronSelectorVertical,noLeft:o,options:i,allOptions:n,value:c,placeholder:d="",onChange:u,uppercase:p,triggerClassName:m,popupClassName:x,itemClassName:v,readonly:h,showChecked:f}=e,b=""===c||null==c,V=n?n.find(e=>e.value===c):i.find(e=>e.value===c),[C,{setFalse:k,toggle:T}]=(0,g.useBoolean)(!1),S=l.useRef(null);return(0,y.useClickAway)(()=>{k()},S),(0,t.jsxs)("div",{className:(0,N.cn)(!a&&!o&&"left-[-8px]","relative select-none",r),ref:S,children:[a?(0,t.jsx)("div",{onClick:T,className:(0,N.cn)(!h&&"cursor-pointer"),children:a}):(0,t.jsxs)("div",{onClick:T,className:(0,N.cn)(C&&"bg-state-base-hover","flex h-5 cursor-pointer items-center rounded-md pl-1 pr-0.5 text-xs font-semibold text-text-secondary hover:bg-state-base-hover"),children:[(0,t.jsx)("div",{className:(0,N.cn)("text-sm font-semibold",p&&"uppercase",b&&"text-text-tertiary",m),children:b?d:V?.label}),!h&&(0,t.jsx)(s,{className:"h-3 w-3 "})]}),C&&!h&&(0,t.jsx)("div",{className:(0,N.cn)("absolute top-[24px] z-10 w-[120px]  select-none rounded-lg border border-components-panel-border bg-components-panel-bg p-1 shadow-lg",x),children:i.map(e=>(0,t.jsxs)("div",{onClick:()=>{k(),u(e.value)},className:(0,N.cn)(v,p&&"uppercase","flex h-[30px] min-w-[44px] cursor-pointer items-center justify-between rounded-lg px-3 text-[13px] font-medium text-text-secondary hover:bg-state-base-hover"),children:[(0,t.jsx)("div",{children:e.label}),f&&e.value===c&&(0,t.jsx)(w.Check,{className:"h-4 w-4 text-text-primary"})]},e.value))})]})});e.s(["default",0,V],116546),e.i(603198);var C=e.i(697743);e.i(187243);var k=e.i(989425),T=e.i(390622);e.i(905691);var S=e.i(48498),I=e.i(157644),E=e.i(619507),R=e.i(249385),F=e.i(299951),A=e.i(225162);let B={},M=l.memo(e=>{let{schema:r=B,readonly:a,value:s,onChange:o,onOpenChange:i,isLoading:n}=e,c=(0,A.useLanguage)(),d=r.placeholder,u=(0,l.useCallback)(e=>{o(""===e.target.value?"":Number.parseFloat(e.target.value),k.VarType.constant)},[o]),p=(0,l.useCallback)(e=>{o(e=null===e?"":e,k.VarType.constant)},[o]);return(0,t.jsxs)(t.Fragment,{children:[(r.type===x.FormTypeEnum.select||r.type===x.FormTypeEnum.dynamicSelect)&&(0,t.jsx)(F.SimpleSelect,{wrapperClassName:"w-full !h-8",className:"flex items-center",disabled:a,defaultValue:s,items:r.options.map(e=>({value:e.value,name:e.label[c]||e.label.en_US})),onSelect:e=>p(e.value),placeholder:d?.[c]||d?.en_US,onOpenChange:i,isLoading:n}),r.type===x.FormTypeEnum.textNumber&&(0,t.jsx)("input",{type:"number",className:"h-8 w-full overflow-hidden rounded-lg bg-workflow-block-parma-bg p-2 text-[13px] font-normal leading-8 text-text-secondary placeholder:text-gray-400 focus:outline-none",value:s,onChange:u,readOnly:a,placeholder:d?.[c]||d?.en_US,min:r.min,max:r.max})]})});var _=e.i(963855),O=e.i(625285);let L=e=>{let{className:r}=e;return(0,t.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"240",height:"2",viewBox:"0 0 240 2",fill:"none",className:r,children:[(0,t.jsx)("path",{d:"M0 1H240",stroke:"url(#paint0_linear_8619_59125)"}),(0,t.jsx)("defs",{children:(0,t.jsxs)("linearGradient",{id:"paint0_linear_8619_59125",x1:"240",y1:"9.99584",x2:"3.95539e-05",y2:"9.88094",gradientUnits:"userSpaceOnUse",children:[(0,t.jsx)("stop",{stopColor:"white",stopOpacity:"0.01"}),(0,t.jsx)("stop",{offset:"0.9031",stopColor:"#101828",stopOpacity:"0.04"}),(0,t.jsx)("stop",{offset:"1",stopColor:"white",stopOpacity:"0.01"})]})})]})},P=e=>{let{className:r}=e;return(0,t.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"2",height:"132",viewBox:"0 0 2 132",fill:"none",className:r,children:[(0,t.jsx)("path",{d:"M1 0L1 132",stroke:"url(#paint0_linear_8619_59128)"}),(0,t.jsx)("defs",{children:(0,t.jsxs)("linearGradient",{id:"paint0_linear_8619_59128",x1:"-7.99584",y1:"132",x2:"-7.96108",y2:"6.4974e-07",gradientUnits:"userSpaceOnUse",children:[(0,t.jsx)("stop",{stopColor:"white",stopOpacity:"0.01"}),(0,t.jsx)("stop",{offset:"0.877606",stopColor:"#101828",stopOpacity:"0.04"}),(0,t.jsx)("stop",{offset:"1",stopColor:"white",stopOpacity:"0.01"})]})})]})},W=e=>{let{title:r,description:a,icon:s}=e;return(0,t.jsxs)("div",{className:"flex w-[320px] flex-col items-start gap-2 rounded-[10px] bg-workflow-process-bg p-4",children:[(0,t.jsx)("div",{className:"flex h-10 w-10 items-center justify-center gap-2 rounded-[10px]",children:(0,t.jsxs)("div",{className:"relative flex grow items-center justify-center gap-2 self-stretch rounded-[10px] border-[0.5px] border-components-card-border bg-components-card-bg p-1 shadow-lg",children:[s||(0,t.jsx)(u.Variable02,{className:"h-5 w-5 shrink-0 text-text-accent"}),(0,t.jsx)(P,{className:"absolute -right-[1px] top-1/2 -translate-y-1/4"}),(0,t.jsx)(P,{className:"absolute -left-[1px] top-1/2 -translate-y-1/4"}),(0,t.jsx)(L,{className:"absolute left-3/4 top-0 -translate-x-1/4 -translate-y-1/2"}),(0,t.jsx)(L,{className:"absolute left-3/4 top-full -translate-x-1/4 -translate-y-1/2"})]})}),(0,t.jsxs)("div",{className:"flex flex-col items-start gap-1 self-stretch",children:[(0,t.jsx)("div",{className:"system-sm-medium text-text-secondary",children:r}),a]})]})};e.s(["default",0,W],64997),e.i(275225);var D=e.i(705405),z=e.i(139269);let U=l.memo(e=>{let{vars:r,popupFor:a,onChange:s,itemWidth:i,isSupportFileVar:n=!0,zIndex:c,preferSchemaType:d}=e,{t:u}=(0,o.useTranslation)(),p=(0,D.useStore)(e=>e.pipelineId),m=(0,l.useMemo)(()=>!!p,[p]),x=(0,D.useStore)(e=>e.setShowInputFieldPanel);return(0,t.jsx)("div",{className:"space-y-1 rounded-lg border border-components-panel-border bg-components-panel-bg p-1 shadow-lg",style:{width:i||228},children:(!r||0===r.length)&&a?"toAssigned"===a?(0,t.jsx)(W,{title:u("variableReference.noAvailableVars",{ns:"workflow"})||"",description:(0,t.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:u("variableReference.noVarsForOperation",{ns:"workflow"})})}):(0,t.jsx)(W,{title:u("variableReference.noAssignedVars",{ns:"workflow"})||"",description:(0,t.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:u("variableReference.assignedVarsDescription",{ns:"workflow"})})}):(0,t.jsx)(z.default,{searchBoxClassName:"mt-1",vars:r,onChange:s,itemWidth:i,isSupportFileVar:n,zIndex:c,showManageInputField:m,onManageInputField:()=>x?.(!0),preferSchemaType:d})})}),G=[],$=l.memo(e=>{let g,y,{nodeId:j,readonly:w,className:F,isShowNodeName:A=!0,value:B=G,onOpen:L=a.noop,onChange:P,isSupportConstantValue:W,defaultVarKindType:D=k.VarType.constant,onlyLeafNodeVar:z,filterVar:$=()=>!0,isFilterFileVar:H,availableNodes:K,availableVars:X,isAddBtnTrigger:q,schema:J,valueTypePlaceHolder:Q,isInTable:Y,onRemove:Z,typePlaceHolder:ee,isSupportFileVar:et=!0,placeholder:er,minWidth:ea,popupFor:es,zIndex:el,currentTool:eo,currentProvider:ei,preferSchemaType:en}=e,{t:ec}=(0,o.useTranslation)(),ed=(0,i.useStoreApi)(),eu=(0,i.useNodes)(),ep=(0,f.useIsChatMode)(),{getCurrentVariableType:em}=(0,b.useWorkflowVariables)(),{availableVars:ex,availableNodesWithParent:ev}=(0,E.default)(j,{onlyLeafNodeVar:z,passedInAvailableNodes:K,filterVar:$}),eh=(0,i.useReactFlow)(),ef=ev.find(e=>e.data.type===T.BlockEnum.Start),eb=eu.find(e=>e.id===j),eg=!!eb?.data?.isInIteration,ey=eg?eu.find(e=>e.id===eb?.parentId):null,ej=!!eb?.data?.isInLoop,ew=ej?eu.find(e=>e.id===eb?.parentId):null,eN=(0,l.useRef)(null),[eV,eC]=(0,l.useState)(227);(0,l.useEffect)(()=>{eN.current&&eC(eN.current.clientWidth)},[eN.current]);let[ek,eT]=(0,l.useState)(D),eS=W&&ek===k.VarType.constant,eI=(0,l.useMemo)(()=>{let e=X||ex;return H?(0,_.removeFileVars)(e):e},[X,ex,H]),[eE,eR]=(0,l.useState)(!1);(0,l.useEffect)(()=>{L()},[eE]);let eF=!eS&&B.length>0,eA=(0,l.useMemo)(()=>!!eg&&!!(B[0]===eb?.parentId&&["item","index"].includes(B[1])),[eg,B,eb]),eB=(0,l.useMemo)(()=>!!ej&&!!(B[0]===eb?.parentId&&["item","index"].includes(B[1])),[ej,B,eb]),eM=eF?B[0]:"",e_=(0,l.useMemo)(()=>{if(!eF||eS)return null;if(eA)return ey?.data;if(eB)return ew?.data;if((0,_.isSystemVar)(B))return ef?.data;let e=(0,_.getNodeInfoById)(ev,eM)?.data;if(e)return{...e,id:eM}},[B,eF,eS,eA,ey,ev,eM,ef,eB,ew]),eO=B.length>2&&!(0,_.isRagVariableVar)(B),eL=(0,l.useMemo)(()=>{if(!eF)return"";let e=h.VAR_SHOW_NAME_MAP[B.join(".")];if(e)return e;let t=(0,_.isSystemVar)(B),r=Array.isArray(B)?B[B.length-1]:"";return`${t?"sys.":""}${r}`},[eF,B]),eP=[{label:"Variable",value:k.VarType.variable},{label:"Constant",value:k.VarType.constant}],eW=(0,l.useCallback)(e=>{eT(e),e===k.VarType.constant?P("",e):P([],e)},[P]),eD=(0,l.useRef)(null),[ez,eU]=(0,l.useState)(!1),[eG,e$]=(0,l.useState)(0);(0,l.useEffect)(()=>{eG&&eD.current&&(eD.current.focus(),eU(!0))},[eG]);let eH=(0,l.useCallback)((e,t)=>{P((0,s.produce)(e,e=>{e[1]&&e[1].startsWith("sys.")&&(e.shift(),e[0].split(".").forEach((t,r)=>{e[r]=t}))}),ek,t),eR(!1)},[P,ek]),eK=(0,l.useCallback)(()=>{ek===k.VarType.constant?P("",ek):P([],ek)},[P,ek]),eX=(0,l.useCallback)(e=>{let t=ev.findIndex(t=>t.id===e),r=ev[t],{clientWidth:a,clientHeight:s}=document.getElementById("workflow-container"),{setViewport:l}=eh,{transform:o}=ed.getState(),i=o[2],n=r.position;l({x:(a-400-r.width*i)/2-n.x*i,y:(s-r.height*i)/2-n.y*i,zoom:o[2]})},[ev,eh,ed]),eq=em({parentNode:eg?ey:ew,valueSelector:B,availableNodes:ev,isChatMode:ep,isConstant:!!eS,preferSchemaType:en}),{isEnv:eJ,isChatVar:eQ,isGlobal:eY,isRagVar:eZ,isValidVar:e0,isException:e1}=(0,l.useMemo)(()=>{let e=(0,_.isENV)(B),t=(0,_.isConversationVar)(B),r=(0,_.isGlobalVar)(B),a=(0,_.isRagVariableVar)(B),s=!!e_||e||t||r||a;return{isEnv:e,isChatVar:t,isGlobal:r,isRagVar:a,isValidVar:s,isException:(0,S.isExceptionVariable)(eL,e_?.type)}},[B,e_,eL]),e5=eV-56,[e2,e3,e9]=(g=((e_?.title||"")+(eL||"")+(eq||"")).length,y=15+Math.floor((e_?.title?.length||0)/g*e5),[y,-15+Math.floor((eL?.length||0)/g*e5),Math.floor((eq?.length||0)/g*e5)]),e4=W?"div":p.PortalToFollowElemTrigger,e6=W?p.PortalToFollowElemTrigger:"div",e7=(0,l.useMemo)(()=>e0&&eO?(0,t.jsx)(O.default,{nodeName:e_?.title,path:B.slice(1),varType:(0,_.varTypeToStructType)(eq),nodeType:e_?.type}):!e0&&eF?ec("errorMsg.invalidVariable",{ns:"workflow"}):null,[e0,eO,eF,ec,e_?.title,e_?.type,B,eq]),[e8,te]=(0,l.useState)(null),[tt,tr]=(0,l.useState)(!1),{mutateAsync:ta}=(0,I.useFetchDynamicOptions)(ei?.plugin_id||"",ei?.name||"",eo?.name||"",J?.variable||"","tool"),ts=async()=>{if(J?.type===x.FormTypeEnum.dynamicSelect&&eo&&ei){tr(!0);try{let e=await ta();te(e?.options||[])}finally{tr(!1)}}};(0,l.useEffect)(()=>{ts()},[eo,ei,J]);let tl=(0,l.useMemo)(()=>{if(J?.type!==x.FormTypeEnum.dynamicSelect)return J;if(e8)return{...J,options:e8};if(tt&&B&&"string"==typeof B){let e=[{value:B,label:{en_US:B,zh_Hans:B},show_on:[]}];return{...J,options:e}}return{...J,options:[]}},[J,e8,tt,B]),to=(0,l.useMemo)(()=>eJ?"environment":eQ?"conversation":eY?"global":eB?"loop":eZ?"rag":"system",[eJ,eQ,eY,eB,eZ]);return(0,t.jsx)("div",{className:(0,N.cn)(F,!w&&"cursor-pointer"),children:(0,t.jsxs)(p.PortalToFollowElem,{open:eE,onOpenChange:eR,placement:q?"bottom-end":"bottom-start",children:[(0,t.jsx)(e4,{onClick:()=>{w||(eS?e$(Date.now()):eR(!eE))},className:"group/picker-trigger-wrap relative !flex",children:(0,t.jsxs)(t.Fragment,{children:[q?(0,t.jsx)("div",{children:(0,t.jsx)(c.default,{onClick:a.noop})}):(0,t.jsxs)("div",{ref:W?null:eN,className:(0,N.cn)(eE||ez?"border-gray-300":"border-gray-100","group/wrap relative flex h-8 w-full items-center",!W&&"rounded-lg bg-components-input-bg-normal p-1",Y&&"border-none bg-transparent",w&&"bg-components-input-bg-disabled"),children:[W?(0,t.jsx)("div",{onClick:e=>{e.stopPropagation(),eR(!1),e$(Date.now())},className:"mr-1 flex h-full items-center space-x-1",children:(0,t.jsx)(V,{noLeft:!0,trigger:(0,t.jsxs)("div",{className:"radius-md flex h-8 items-center bg-components-input-bg-normal px-2",children:[(0,t.jsx)("div",{className:"system-sm-regular mr-1 text-components-input-text-filled",children:eP.find(e=>e.value===ek)?.label}),(0,t.jsx)(r.RiArrowDownSLine,{className:"h-4 w-4 text-text-quaternary"})]}),popupClassName:"top-8",readonly:w,value:ek,options:eP,onChange:eW,showChecked:!0})}):!eF&&(0,t.jsx)("div",{className:"ml-1.5 mr-1",children:(0,t.jsx)(u.Variable02,{className:`h-4 w-4 ${w?"text-components-input-text-disabled":"text-components-input-text-placeholder"}`})}),eS?(0,t.jsx)(M,{value:B,onChange:P,schema:tl,readonly:w,isLoading:tt}):(0,t.jsx)(e6,{onClick:()=>{w||(eS?e$(Date.now()):eR(!eE))},className:"h-full grow",children:(0,t.jsx)("div",{ref:W?eN:null,className:(0,N.cn)("h-full",W&&"flex items-center rounded-lg bg-components-panel-bg py-1 pl-1"),children:(0,t.jsx)(m.default,{noDecoration:eO,popupContent:e7,children:(0,t.jsx)("div",{className:(0,N.cn)("h-full items-center rounded-[5px] px-1.5",eF?"inline-flex bg-components-badge-white-to-dark":"flex"),children:eF?(0,t.jsxs)(t.Fragment,{children:[A&&!eJ&&!eQ&&!eY&&!eZ&&(0,t.jsxs)("div",{className:"flex items-center",onClick:e=>{(e.metaKey||e.ctrlKey)&&(e.stopPropagation(),eX(e_?.id))},children:[(0,t.jsx)("div",{className:"h-3 px-[1px]",children:e_?.type&&(0,t.jsx)(v.VarBlockIcon,{className:"!text-text-primary",type:e_.type})}),(0,t.jsx)("div",{className:"mx-0.5 truncate text-xs font-medium text-text-secondary",title:e_?.title,style:{maxWidth:e2},children:e_?.title}),(0,t.jsx)(d.Line3,{className:"mr-0.5"})]}),eO&&(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(r.RiMoreLine,{className:"h-3 w-3 text-text-secondary"}),(0,t.jsx)(d.Line3,{className:"mr-0.5 text-divider-deep"})]}),(0,t.jsxs)("div",{className:"flex items-center text-text-accent",children:[tt&&(0,t.jsx)(r.RiLoader4Line,{className:"h-3.5 w-3.5 animate-spin text-text-secondary"}),(0,t.jsx)(C.VariableIconWithColor,{variables:B,variableCategory:to,isExceptionVariable:e1}),(0,t.jsx)("div",{className:(0,N.cn)("ml-0.5 truncate text-xs font-medium",eJ&&"!text-text-secondary",eQ&&"text-util-colors-teal-teal-700",e1&&"text-text-warning",eY&&"text-util-colors-orange-orange-600"),title:eL,style:{maxWidth:e3},children:eL})]}),(0,t.jsx)("div",{className:"system-xs-regular ml-0.5 truncate text-center capitalize text-text-tertiary",title:eq,style:{maxWidth:e9},children:eq}),!e0&&(0,t.jsx)(r.RiErrorWarningFill,{className:"ml-0.5 h-3 w-3 text-text-destructive"})]}):(0,t.jsx)("div",{className:`overflow-hidden ${w?"text-components-input-text-disabled":"text-components-input-text-placeholder"} system-sm-regular text-ellipsis`,children:tt?(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(r.RiLoader4Line,{className:"mr-1 h-3.5 w-3.5 animate-spin text-text-secondary"}),(0,t.jsx)("span",{children:er??ec("common.setVarValuePlaceholder",{ns:"workflow"})})]}):er??ec("common.setVarValuePlaceholder",{ns:"workflow"})})})})})}),eF&&!w&&!Y&&(0,t.jsx)("div",{className:"group invisible absolute right-1 top-[50%] h-5 translate-y-[-50%] cursor-pointer rounded-md p-1 hover:bg-state-base-hover group-hover/wrap:visible",onClick:eK,children:(0,t.jsx)(r.RiCloseLine,{className:"h-3.5 w-3.5 text-text-tertiary group-hover:text-text-secondary"})}),!eF&&Q&&(0,t.jsx)(n.default,{className:" absolute right-1 top-[50%] translate-y-[-50%] capitalize",text:Q,uppercase:!1})]}),!w&&Y&&(0,t.jsx)(R.default,{className:"absolute right-1 top-0.5 hidden group-hover/picker-trigger-wrap:block",onClick:()=>Z?.()}),!eF&&ee&&(0,t.jsx)(n.default,{className:"absolute right-2 top-1.5",text:ee,uppercase:!1})]})}),(0,t.jsx)(p.PortalToFollowElemContent,{style:{zIndex:el||100},className:"mt-1",children:!eS&&(0,t.jsx)(U,{vars:eI,popupFor:es,onChange:eH,itemWidth:q?260:ea||eV,isSupportFileVar:et,zIndex:el,preferSchemaType:en})})]})})});e.s(["default",0,$],22461)}]);
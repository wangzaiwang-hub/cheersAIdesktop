(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,117959,e=>{"use strict";var t=e.i(563199),a=e.i(326531),s=e.i(268255),l=e.i(449980),n=e.i(413159),i=e.i(56971),r=e.i(621379),d=e.i(666010),c=e.i(909564),o=e.i(722384),u=e.i(417944);e.i(152567);var m=e.i(408767),x=e.i(137667),p=e.i(813777),h=e.i(799750),f=e.i(560956);let y=s.forwardRef(function(e,t){let{title:a,titleId:l,...n}=e;return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},n),a?s.createElement("title",{id:l},a):null,s.createElement("path",{fillRule:"evenodd",d:"M12 3.75a.75.75 0 0 1 .75.75v6.75h6.75a.75.75 0 0 1 0 1.5h-6.75v6.75a.75.75 0 0 1-1.5 0v-6.75H4.5a.75.75 0 0 1 0-1.5h6.75V4.5a.75.75 0 0 1 .75-.75Z",clipRule:"evenodd"}))});var g=e.i(837699),v=e.i(151094),j=e.i(748573),b=e.i(291631),C=e.i(860169),w=e.i(757198),N=e.i(935139);let k={success:{Icon:g.RiCheckboxCircleFill,color:"text-text-success"},error:{Icon:g.RiErrorWarningFill,color:"text-text-destructive"},warning:{Icon:g.RiAlertFill,color:"text-text-warning-secondary"},info:{Icon:g.RiInformation2Fill,color:"text-text-accent"}},D=s.memo(e=>{let{type:a="info",description:s,actionText:l,onAction:n,disabled:i}=e,{Icon:r,color:d}=k[a];return(0,t.jsxs)("div",{className:"relative flex h-[34px] items-center rounded-lg border border-components-panel-border bg-components-panel-bg-blur pl-2 pr-3 shadow-xs",children:[(0,t.jsx)("div",{className:`absolute inset-0 rounded-lg opacity-40 ${"success"===a&&"bg-[linear-gradient(92deg,rgba(23,178,106,0.25)_0%,rgba(255,255,255,0.00)_100%)]"||"warning"===a&&"bg-[linear-gradient(92deg,rgba(247,144,9,0.25)_0%,rgba(255,255,255,0.00)_100%)]"||"error"===a&&"bg-[linear-gradient(92deg,rgba(240,68,56,0.25)_0%,rgba(255,255,255,0.00)_100%)]"||"info"===a&&"bg-[linear-gradient(92deg,rgba(11,165,236,0.25)_0%,rgba(255,255,255,0.00)_100%)]"}`}),(0,t.jsxs)("div",{className:"relative z-10 flex h-full items-center space-x-2",children:[(0,t.jsx)(r,{className:(0,N.cn)("h-4 w-4",d)}),(0,t.jsx)("div",{className:"text-[13px] font-normal text-text-secondary",children:s}),n&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(w.default,{type:"vertical",className:"!h-4"}),(0,t.jsx)("div",{onClick:n,className:(0,N.cn)("cursor-pointer text-[13px] font-semibold text-text-accent",i&&"cursor-not-allowed text-text-disabled"),children:l})]})]})]})}),_=s.memo(e=>{let{datasetId:a}=e,{t:l}=(0,m.useTranslation)(),{data:n,isLoading:i}=(0,d.useAutoDisabledDocuments)(a),r=(0,d.useInvalidDisabledDocument)(),c=n?.document_ids,o=c&&c.length>0,{mutateAsync:u}=(0,d.useDocumentEnable)(),p=(0,s.useCallback)(async()=>{await u({datasetId:a,documentIds:c}),r(),x.default.notify({type:"success",message:l("actionMsg.modifiedSuccessfully",{ns:"common"})})},[]);return!o||i?null:(0,t.jsx)(D,{type:"info",description:l("documentsDisabled",{ns:"dataset",num:c?.length}),actionText:l("enable",{ns:"dataset"}),onAction:p})});var M=e.i(124836),S=e.i(211857),T=e.i(225244);let I=(e,t)=>({...e,value:({retry:"retry",success:"success",error:"error"})[t.type]||e.value}),L=e=>{let{datasetId:a}=e,{t:l}=(0,m.useTranslation)(),[n,i]=(0,s.useReducer)(I,{value:"success"}),{data:r,isLoading:d,refetch:c}=(0,T.useDatasetErrorDocs)(a),o=async()=>{i({type:"retry"});let e=r?.data.map(e=>e.id)||[];"success"===(await (0,S.retryErrorDocs)({datasetId:a,document_ids:e})).result?(c(),i({type:"success"})):i({type:"error"})};return((0,s.useEffect)(()=>{r?.total===0?i({type:"success"}):i({type:"error"})},[r?.total]),d||"success"===n.value)?null:(0,t.jsx)(D,{type:"warning",description:`${r?.total} ${l("docsFailedNotice",{ns:"dataset"})}`,actionText:l("retry",{ns:"dataset"}),disabled:"retry"===n.value,onAction:"error"===n.value?o:M.noop})};var E=e.i(726371),R=e.i(547105),A=e.i(521632),V=e.i(21151),$=e.i(260484),F=e.i(421001),B=e.i(391185),U=e.i(89012);let z=s.memo(e=>{let{open:a,setOpen:s,trigger:l,popupLeft:n=20,...i}=e;return(0,t.jsxs)(B.PortalToFollowElem,{open:a,onOpenChange:s,placement:"left-start",offset:{mainAxis:n,crossAxis:-38},children:[(0,t.jsx)(B.PortalToFollowElemTrigger,{onClick:()=>s(!a),children:l}),(0,t.jsx)(B.PortalToFollowElemContent,{className:"z-[1000]",children:(0,t.jsx)(U.default,{...i,onClose:()=>s(!1),onBack:()=>s(!1)})})]})});var P=e.i(873557),O=e.i(777557);let H="metadata.datasetMetadata",W=e=>{let{readonly:a,disabled:l,payload:n,onRename:i,onDelete:r}=e,{t:d}=(0,m.useTranslation)(),c=(0,P.getIcon)(n.type),o=(0,s.useCallback)(()=>{i?.()},[i]),x=(0,s.useRef)(null),p=(0,E.useHover)(x),[h,{setTrue:f,setFalse:y}]=(0,u.useBoolean)(!1),v=(0,s.useCallback)(()=>{y(),r?.()},[y,r]);return(0,t.jsx)("div",{className:(0,N.cn)(!a&&!l&&"group/item cursor-pointer hover:shadow-xs","rounded-md border border-components-panel-border-subtle bg-components-panel-on-panel-item-bg",p&&"border border-state-destructive-border bg-state-destructive-hover"),children:(0,t.jsxs)("div",{className:(0,N.cn)("flex h-8 items-center justify-between  px-2",l&&"opacity-30"),children:[(0,t.jsxs)("div",{className:"flex h-full items-center space-x-1 text-text-tertiary",children:[(0,t.jsx)(c,{className:"size-4 shrink-0"}),(0,t.jsx)("div",{className:"system-sm-medium max-w-[250px] truncate text-text-primary",children:n.name}),(0,t.jsx)("div",{className:"system-xs-regular shrink-0",children:n.type})]}),(!a||l)&&(0,t.jsx)("div",{className:"system-xs-regular ml-2 shrink-0 text-text-tertiary group-hover/item:hidden",children:l?d(`${H}.disabled`,{ns:"dataset"}):d(`${H}.values`,{ns:"dataset",num:n.count||0})}),(0,t.jsxs)("div",{className:"ml-2 hidden items-center space-x-1 text-text-tertiary group-hover/item:flex",children:[(0,t.jsx)(g.RiEditLine,{className:"size-4 cursor-pointer",onClick:o}),(0,t.jsx)("div",{ref:x,className:"hover:text-text-destructive",children:(0,t.jsx)(g.RiDeleteBinLine,{className:"size-4 cursor-pointer",onClick:f})})]}),h&&(0,t.jsx)(R.default,{isShow:!0,type:"warning",title:d("metadata.datasetMetadata.deleteTitle",{ns:"dataset"}),content:d("metadata.datasetMetadata.deleteContent",{ns:"dataset",name:n.name}),onConfirm:v,onCancel:y})]})},n.name)},Z=s.memo(e=>{let{userMetadata:a,builtInMetadata:l,isBuiltInEnabled:n,onIsBuiltInEnabledChange:i,onClose:r,onAdd:d,onRename:c,onRemove:o}=e,{t:u}=(0,m.useTranslation)(),[p,h]=(0,s.useState)(!1),[f,y]=(0,s.useState)(null),[j,C]=(0,s.useState)(""),w=(0,s.useCallback)(e=>()=>{y(e),C(e.name),h(!0)},[y,h]),[N,k]=(0,s.useState)(!1),D=(0,s.useCallback)(async e=>{await d(e),x.default.notify({type:"success",message:u("api.actionSuccess",{ns:"common"})}),k(!1)},[d,u]),_=(0,s.useCallback)(async()=>{let e=a.find(e=>e.id===f?.id);e&&(await c({...e,name:j}),x.default.notify({type:"success",message:u("api.actionSuccess",{ns:"common"})})),h(!1)},[a,f?.id,c,j,u]),M=(0,s.useCallback)(e=>async()=>{await o(e.id),x.default.notify({type:"success",message:u("api.actionSuccess",{ns:"common"})})},[o,u]);return(0,t.jsx)(A.default,{isOpen:!0,onClose:r,showClose:!0,title:u("metadata.metadata",{ns:"dataset"}),footer:null,panelClassName:"px-4 block !max-w-[420px] my-2 rounded-l-2xl",children:(0,t.jsxs)("div",{className:"h-full overflow-y-auto",children:[(0,t.jsx)("div",{className:"system-sm-regular text-text-tertiary",children:u(`${H}.description`,{ns:"dataset"})}),(0,t.jsx)(z,{open:N,setOpen:k,trigger:(0,t.jsxs)(v.default,{variant:"primary",className:"mt-3",children:[(0,t.jsx)(g.RiAddLine,{className:"mr-1"}),u(`${H}.addMetaData`,{ns:"dataset"})]}),hasBack:!0,onSave:D}),(0,t.jsx)("div",{className:"mt-3 space-y-1",children:a.map(e=>(0,t.jsx)(W,{payload:e,onRename:w(e),onDelete:M(e)},e.id))}),(0,t.jsxs)("div",{className:"mt-3 flex h-6 items-center",children:[(0,t.jsx)($.default,{defaultValue:n,onChange:i}),(0,t.jsx)("div",{className:"system-sm-semibold ml-2 mr-0.5 text-text-secondary",children:u(`${H}.builtIn`,{ns:"dataset"})}),(0,t.jsx)(F.default,{popupContent:(0,t.jsx)("div",{className:"max-w-[100px]",children:u(`${H}.builtInDescription`,{ns:"dataset"})})})]}),(0,t.jsx)("div",{className:"mt-1 space-y-1",children:l.map(e=>(0,t.jsx)(W,{readonly:!0,disabled:!n,payload:e},e.name))}),p&&(0,t.jsxs)(V.default,{isShow:!0,title:u(`${H}.rename`,{ns:"dataset"}),onClose:()=>h(!1),children:[(0,t.jsx)(O.default,{label:u(`${H}.name`,{ns:"dataset"}),className:"mt-4",children:(0,t.jsx)(b.default,{value:j,onChange:e=>C(e.target.value),placeholder:u(`${H}.namePlaceholder`,{ns:"dataset"})})}),(0,t.jsxs)("div",{className:"mt-4 flex justify-end",children:[(0,t.jsx)(v.default,{className:"mr-2",onClick:()=>{h(!1),C(f.name)},children:u("operation.cancel",{ns:"common"})}),(0,t.jsx)(v.default,{onClick:_,variant:"primary",disabled:!j,children:u("operation.save",{ns:"common"})})]})]})]})})});var q=e.i(683257),K=e.i(396977);let G=e=>{let{datasetId:a,dataSourceType:l,embeddingAvailable:n,isFreePlan:i,statusFilterValue:d,sortValue:c,inputValue:o,onStatusFilterChange:u,onStatusFilterClear:x,onSortChange:p,onInputChange:h,isShowEditMetadataModal:f,showEditMetadataModal:w,hideEditMetadataModal:N,datasetMetaData:k,builtInMetaData:M,builtInEnabled:S,onAddMetaData:T,onRenameMetaData:I,onDeleteMetaData:E,onBuiltInEnabledChange:R,onAddDocument:A}=e,{t:V}=(0,m.useTranslation)(),$=(0,q.useDocLink)(),F=(0,K.useIndexStatus)(),B=l===r.DataSourceType.NOTION,U=l===r.DataSourceType.WEB,z=(0,s.useMemo)(()=>[{value:"all",name:V("list.index.all",{ns:"datasetDocuments"})},{value:"queuing",name:F.queuing.text},{value:"indexing",name:F.indexing.text},{value:"paused",name:F.paused.text},{value:"error",name:F.error.text},{value:"available",name:F.available.text},{value:"enabled",name:F.enabled.text},{value:"disabled",name:F.disabled.text},{value:"archived",name:F.archived.text}],[F,V]),P=(0,s.useMemo)(()=>[{value:"created_at",name:V("list.sort.uploadTime",{ns:"datasetDocuments"})},{value:"hit_count",name:V("list.sort.hitCount",{ns:"datasetDocuments"})}],[V]),O=(0,s.useMemo)(()=>B?V("list.addPages",{ns:"datasetDocuments"}):U?V("list.addUrl",{ns:"datasetDocuments"}):V("list.addFile",{ns:"datasetDocuments"}),[B,U,V]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex flex-col justify-center gap-1 px-6 pt-4",children:[(0,t.jsx)("h1",{className:"text-base font-semibold text-text-primary",children:V("list.title",{ns:"datasetDocuments"})}),(0,t.jsxs)("div",{className:"flex items-center space-x-0.5 text-sm font-normal text-text-tertiary",children:[(0,t.jsx)("span",{children:V("list.desc",{ns:"datasetDocuments"})}),(0,t.jsxs)("a",{className:"flex items-center text-text-accent",target:"_blank",rel:"noopener noreferrer",href:$("/use-dify/knowledge/integrate-knowledge-within-application"),children:[(0,t.jsx)("span",{children:V("list.learnMore",{ns:"datasetDocuments"})}),(0,t.jsx)(g.RiExternalLinkLine,{className:"h-3 w-3"})]})]})]}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center justify-between px-6 pt-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(j.default,{className:"w-[160px]",showLeftIcon:!1,value:d,items:z,onSelect:e=>u(e?.value?String(e.value):""),onClear:x}),(0,t.jsx)(b.default,{showLeftIcon:!0,showClearIcon:!0,wrapperClassName:"!w-[200px]",value:o,onChange:e=>h(e.target.value),onClear:()=>h("")}),(0,t.jsx)("div",{className:"h-3.5 w-px bg-divider-regular"}),(0,t.jsx)(C.default,{order:c.startsWith("-")?"-":"",value:c.replace("-",""),items:P,onSelect:e=>p(String(e))})]}),(0,t.jsxs)("div",{className:"flex !h-8 items-center justify-center gap-2",children:[!i&&(0,t.jsx)(_,{datasetId:a}),(0,t.jsx)(L,{datasetId:a}),!n&&(0,t.jsx)(D,{type:"warning",description:V("embeddingModelNotAvailable",{ns:"dataset"})}),n&&(0,t.jsxs)(v.default,{variant:"secondary",className:"shrink-0",onClick:w,children:[(0,t.jsx)(g.RiDraftLine,{className:"mr-1 size-4"}),V("metadata.metadata",{ns:"dataset"})]}),f&&(0,t.jsx)(Z,{userMetadata:k??[],onClose:N,onAdd:T,onRename:I,onRemove:E,builtInMetadata:M??[],isBuiltInEnabled:S,onIsBuiltInEnabledChange:R}),n&&(0,t.jsxs)(v.default,{variant:"primary",onClick:A,className:"shrink-0",children:[(0,t.jsx)(y,{className:"mr-2 h-4 w-4 stroke-current"}),O]})]})]})]})};var Q=e.i(336864);let J=e=>{let{className:a}=e;return(0,t.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:a??"",children:(0,t.jsx)("path",{d:"M10.8332 5.83333L9.90355 3.9741C9.63601 3.439 9.50222 3.17144 9.30265 2.97597C9.12615 2.80311 8.91344 2.67164 8.6799 2.59109C8.41581 2.5 8.11668 2.5 7.51841 2.5H4.33317C3.39975 2.5 2.93304 2.5 2.57652 2.68166C2.26292 2.84144 2.00795 3.09641 1.84816 3.41002C1.6665 3.76654 1.6665 4.23325 1.6665 5.16667V5.83333M1.6665 5.83333H14.3332C15.7333 5.83333 16.4334 5.83333 16.9681 6.10582C17.4386 6.3455 17.821 6.72795 18.0607 7.19836C18.3332 7.73314 18.3332 8.4332 18.3332 9.83333V13.5C18.3332 14.9001 18.3332 15.6002 18.0607 16.135C17.821 16.6054 17.4386 16.9878 16.9681 17.2275C16.4334 17.5 15.7333 17.5 14.3332 17.5H5.6665C4.26637 17.5 3.56631 17.5 3.03153 17.2275C2.56112 16.9878 2.17867 16.6054 1.93899 16.135C1.6665 15.6002 1.6665 14.9001 1.6665 13.5V5.83333ZM9.99984 14.1667V9.16667M7.49984 11.6667H12.4998",stroke:"#667085",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})},X=e=>{let{className:a}=e;return(0,t.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:a??"",children:(0,t.jsx)("path",{d:"M5 6.5V5M8.93934 7.56066L10 6.5M10.0103 11.5H11.5103",stroke:"#374151",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})},Y=e=>{let{className:a}=e;return(0,t.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:a??"",children:[(0,t.jsxs)("g",{clipPath:"url(#clip0_2164_11263)",children:[(0,t.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.5725 18.2611L1.4229 15.5832C0.905706 14.9389 0.625 14.1466 0.625 13.3312V3.63437C0.625 2.4129 1.60224 1.39936 2.86295 1.31328L12.8326 0.632614C13.5569 0.583164 14.2768 0.775682 14.8717 1.17794L18.3745 3.5462C19.0015 3.97012 19.375 4.66312 19.375 5.40266V16.427C19.375 17.6223 18.4141 18.6121 17.1798 18.688L6.11458 19.3692C5.12958 19.4298 4.17749 19.0148 3.5725 18.2611Z",fill:"white"}),(0,t.jsx)("path",{d:"M7.03006 8.48669V8.35974C7.03006 8.03794 7.28779 7.77104 7.61997 7.74886L10.0396 7.58733L13.3857 12.5147V8.19009L12.5244 8.07528V8.01498C12.5244 7.68939 12.788 7.42074 13.1244 7.4035L15.326 7.29073V7.60755C15.326 7.75628 15.2154 7.88349 15.0638 7.90913L14.534 7.99874V15.0023L13.8691 15.231C13.3136 15.422 12.6952 15.2175 12.3772 14.7377L9.12879 9.83574V14.5144L10.1287 14.7057L10.1147 14.7985C10.0711 15.089 9.82028 15.3087 9.51687 15.3222L7.03006 15.4329C6.99718 15.1205 7.23132 14.841 7.55431 14.807L7.88143 14.7727V8.53453L7.03006 8.48669Z",fill:"black"}),(0,t.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12.9218 1.85424L2.95217 2.53491C2.35499 2.57568 1.89209 3.05578 1.89209 3.63437V13.3312C1.89209 13.8748 2.07923 14.403 2.42402 14.8325L4.57362 17.5104C4.92117 17.9434 5.46812 18.1818 6.03397 18.147L17.0991 17.4658C17.6663 17.4309 18.1078 16.9762 18.1078 16.427V5.40266C18.1078 5.06287 17.9362 4.74447 17.6481 4.54969L14.1453 2.18143C13.7883 1.94008 13.3564 1.82457 12.9218 1.85424ZM3.44654 3.78562C3.30788 3.68296 3.37387 3.46909 3.54806 3.4566L12.9889 2.77944C13.2897 2.75787 13.5886 2.8407 13.8318 3.01305L15.7261 4.35508C15.798 4.40603 15.7642 4.51602 15.6752 4.52086L5.67742 5.0646C5.37485 5.08106 5.0762 4.99217 4.83563 4.81406L3.44654 3.78562ZM5.20848 6.76919C5.20848 6.4444 5.47088 6.1761 5.80642 6.15783L16.3769 5.58216C16.7039 5.56435 16.9792 5.81583 16.9792 6.13239V15.6783C16.9792 16.0025 16.7177 16.2705 16.3829 16.2896L5.8793 16.8872C5.51537 16.9079 5.20848 16.6283 5.20848 16.2759V6.76919Z",fill:"black"})]}),(0,t.jsx)("defs",{children:(0,t.jsx)("clipPath",{id:"clip0_2164_11263",children:(0,t.jsx)("rect",{width:"20",height:"20",fill:"white"})})})]})},ee=e=>{let{canAdd:a=!0,onClick:s,type:l="upload"}=e,{t:n}=(0,m.useTranslation)();return(0,t.jsx)("div",{className:Q.default.emptyWrapper,children:(0,t.jsxs)("div",{className:Q.default.emptyElement,children:[(0,t.jsx)("div",{className:Q.default.emptySymbolIconWrapper,children:"upload"===l?(0,t.jsx)(J,{}):(0,t.jsx)(Y,{})}),(0,t.jsxs)("span",{className:Q.default.emptyTitle,children:[n("list.empty.title",{ns:"datasetDocuments"}),(0,t.jsx)(X,{className:"relative -left-1.5 -top-3 inline"})]}),(0,t.jsx)("div",{className:Q.default.emptyTip,children:n(`list.empty.${l}.tip`,{ns:"datasetDocuments"})}),"upload"===l&&a&&(0,t.jsxs)(v.default,{onClick:s,className:Q.default.addFileBtn,variant:"secondary-accent",children:[(0,t.jsx)(y,{className:Q.default.plusIcon}),n("list.addFile",{ns:"datasetDocuments"})]})]})})};var et=e.i(449448),ea=e.i(324935),es=e.i(377397),el=e.i(394529),en=e.i(888972),ei=e.i(83278);e.i(9633);var er=e.i(334163),ed=e.i(684040);let ec=s.memo(e=>{let{isGeneralMode:a,isQAMode:s}=e,{t:l}=(0,m.useTranslation)(),n=a?er.GeneralChunk:ed.ParentChildChunk;return(0,t.jsx)(ei.default,{children:(0,t.jsxs)("div",{className:"flex h-full items-center space-x-0.5 text-text-tertiary",children:[(0,t.jsx)(n,{className:"h-3 w-3"}),(0,t.jsx)("span",{className:"system-2xs-medium-uppercase",children:a?`${l("chunkingMode.general",{ns:"dataset"})}${s?" Â· QA":""}`:l("chunkingMode.parentChild",{ns:"dataset"})})]})})});var eo=e.i(788666),eu=e.i(558470),em=e.i(105845),ex=e.i(655281),ep=e.i(836407),eh=e.i(292500);let ef=s.memo(e=>{let{isDeleted:a,className:s,text:l}=e;return(0,t.jsx)("div",{className:(0,N.cn)("system-xs-medium w-[136px] shrink-0 truncate text-text-tertiary",a&&"text-text-quaternary line-through",s),children:l})}),ey=s.memo(e=>{let{className:a,payload:s,onChange:l,onRemove:n}=e;return(0,t.jsxs)("div",{className:(0,N.cn)("flex h-6 items-center space-x-0.5",a),children:[(0,t.jsx)(ef,{text:s.name}),(0,t.jsx)(eh.default,{type:s.type,value:s.value,onChange:e=>l({...s,value:e})}),(0,t.jsx)("div",{className:(0,N.cn)("cursor-pointer rounded-md p-1 text-text-tertiary hover:bg-state-destructive-hover hover:text-text-destructive"),onClick:n,children:(0,t.jsx)(g.RiIndeterminateCircleLine,{className:"size-4"})})]})}),eg=s.memo(e=>{let{onReset:a}=e,{t:l}=(0,m.useTranslation)(),n=(0,s.useRef)(null),i=(0,E.useHover)(n);return(0,t.jsx)("div",{ref:n,className:"size-4 cursor-pointer",children:i?(0,t.jsx)(F.default,{popupContent:l("operation.reset",{ns:"common"}),children:(0,t.jsx)("div",{className:"flex size-4 items-center justify-center rounded-full bg-text-accent-secondary",onClick:a,children:(0,t.jsx)(g.RiResetLeftLine,{className:"size-[10px] text-text-primary-on-surface"})})}):(0,t.jsx)("div",{className:"flex size-4 items-center justify-center",children:(0,t.jsx)("div",{className:"size-1 rounded-full bg-text-accent-secondary"})})})}),ev=s.memo(e=>{let{onClear:a,readOnly:s}=e,{t:l}=(0,m.useTranslation)();return(0,t.jsx)("div",{className:"h-6 grow rounded-md bg-components-input-bg-normal p-0.5 text-[0]",children:(0,t.jsxs)("div",{className:(0,N.cn)("inline-flex h-5 items-center space-x-0.5 rounded-[5px] border-[0.5px] border-components-panel-border bg-components-badge-white-to-dark pl-1.5 pr-0.5 shadow-xs",s&&"pr-1.5"),children:[(0,t.jsx)("div",{className:"system-xs-regular text-text-secondary",children:l("metadata.batchEditMetadata.multipleValue",{ns:"dataset"})}),!s&&(0,t.jsx)("div",{className:"cursor-pointer rounded-[4px] p-px text-text-tertiary hover:bg-state-base-hover hover:text-text-secondary",children:(0,t.jsx)(g.RiCloseLine,{className:"size-3.5 ",onClick:a})})]})})}),ej=s.memo(e=>{let{payload:a,onChange:s,onRemove:l,onReset:n}=e,i=a.isUpdated,r=a.updateType===h.UpdateType.delete;return(0,t.jsxs)("div",{className:"flex h-6 items-center space-x-0.5",children:[i?(0,t.jsx)(eg,{onReset:()=>n(a.id)}):(0,t.jsx)("div",{className:"size-4 shrink-0"}),(0,t.jsx)(ef,{text:a.name,isDeleted:r}),a.isMultipleValue?(0,t.jsx)(ev,{onClear:()=>s({...a,value:null,isMultipleValue:!1}),readOnly:r}):(0,t.jsx)(eh.default,{type:a.type,value:a.value,onChange:e=>s({...a,value:e}),readOnly:r}),(0,t.jsx)("div",{className:(0,N.cn)("cursor-pointer rounded-md p-1 text-text-tertiary hover:bg-state-destructive-hover hover:text-text-destructive",r&&"cursor-default bg-state-destructive-hover  text-text-destructive"),onClick:()=>l(a.id),children:(0,t.jsx)(g.RiDeleteBinLine,{className:"size-4"})})]})}),eb="metadata.batchEditMetadata",eC=s.memo(e=>{let{datasetId:a,documentNum:l,list:n,onSave:i,onHide:r,onShowManage:d}=e,{t:c}=(0,m.useTranslation)(),[o,u]=(0,s.useState)(n),y=(0,s.useCallback)(e=>{u((0,em.produce)(o,t=>{let a=t.findIndex(t=>t.id===e.id);-1!==a&&(t[a]=e,t[a].isUpdated=!0,t[a].updateType=h.UpdateType.changeValue)}))},[o]),j=(0,s.useCallback)(e=>{u((0,em.produce)(o,t=>{let a=t.findIndex(t=>t.id===e);-1!==a&&(t[a].isUpdated=!0,t[a].updateType=h.UpdateType.delete)}))},[o]),b=(0,s.useCallback)(e=>{u((0,em.produce)(o,t=>{let a=t.findIndex(t=>t.id===e);-1!==a&&(t[a]={...n[a]},t[a].isUpdated=!1,delete t[a].updateType)}))},[n,o]),{checkName:C}=(0,f.default)(),{mutate:N}=(0,p.useCreateMetaData)(a),k=(0,s.useCallback)(async e=>{let t=C(e.name).errorMsg;if(t)return x.default.notify({message:t,type:"error"}),Promise.reject(Error(t));await N(e),x.default.notify({type:"success",message:c("api.actionSuccess",{ns:"common"})})},[C,N,c]),[D,_]=(0,s.useState)([]),M=(0,s.useCallback)(e=>{_(D.map(t=>t.id===e.id?e:t))},[D]),S=(0,s.useCallback)(e=>()=>{_(D.filter((t,a)=>a!==e))},[D]),[T,I]=(0,s.useState)(!1),L=(0,s.useCallback)(()=>{i(o.filter(e=>e.updateType!==h.UpdateType.delete),D,T)},[o,D,T,i]);return(0,t.jsxs)(V.default,{title:c(`${eb}.editMetadata`,{ns:"dataset"}),isShow:!0,closable:!0,onClose:r,className:"!max-w-[640px]",children:[(0,t.jsx)("div",{className:"system-xs-medium mt-1 text-text-accent",children:c(`${eb}.editDocumentsNum`,{ns:"dataset",num:l})}),(0,t.jsxs)("div",{className:"max-h-[305px] overflow-y-auto overflow-x-hidden",children:[(0,t.jsx)("div",{className:"mt-4 space-y-2",children:o.map(e=>(0,t.jsx)(ej,{payload:e,onChange:y,onRemove:j,onReset:b},e.id))}),(0,t.jsxs)("div",{className:"mt-4 pl-[18px]",children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"system-xs-medium-uppercase mr-2 shrink-0 text-text-tertiary",children:c("metadata.createMetadata.title",{ns:"dataset"})}),(0,t.jsx)(w.default,{bgStyle:"gradient"})]}),(0,t.jsx)("div",{className:"mt-2 space-y-2",children:D.map((e,a)=>(0,t.jsx)(ey,{payload:e,onChange:M,onRemove:S(a)},a))}),(0,t.jsx)("div",{className:"mt-3",children:(0,t.jsx)(ep.default,{datasetId:a,popupPlacement:"top-start",popupOffset:{mainAxis:4,crossAxis:0},trigger:(0,t.jsx)(ex.default,{}),onSave:k,onSelect:e=>_([...D,e]),onManage:d})})]})]}),(0,t.jsxs)("div",{className:"mt-4 flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex select-none items-center",children:[(0,t.jsx)(ea.default,{checked:T,onCheck:()=>I(!T)}),(0,t.jsx)("div",{className:"system-xs-medium ml-2 mr-1 text-text-secondary",children:c(`${eb}.applyToAllSelectDocument`,{ns:"dataset"})}),(0,t.jsx)(F.default,{popupContent:(0,t.jsx)("div",{className:"max-w-[240px]",children:c(`${eb}.applyToAllSelectDocumentTip`,{ns:"dataset"})}),children:(0,t.jsx)("div",{className:"cursor-pointer p-px",children:(0,t.jsx)(g.RiQuestionLine,{className:"size-3.5 text-text-tertiary"})})})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(v.default,{onClick:r,children:c("operation.cancel",{ns:"common"})}),(0,t.jsx)(v.default,{onClick:L,variant:"primary",children:c("operation.save",{ns:"common"})})]})]})]})});var ew=e.i(915389),eN=e.i(157884),ek=e.i(654537),eD=e.i(842090),e_=e.i(618403),eM=e.i(128984),eS=e.i(551444),eT=e.i(316803);let eI=(0,s.memo)(e=>{let{status:a}=e,{t:l}=(0,m.useTranslation)(),n=(0,s.useMemo)(()=>"SUMMARIZING"===a?l("list.summary.generatingSummary",{ns:"datasetDocuments"}):"",[a,l]);return(0,t.jsx)(F.default,{popupContent:n,children:"SUMMARIZING"===a&&(0,t.jsxs)(ei.default,{className:"border-text-accent-secondary text-text-accent-secondary",children:[(0,t.jsx)(eT.SearchLinesSparkle,{className:"mr-0.5 h-3 w-3"}),(0,t.jsx)("span",{children:l("list.summary.generating",{ns:"datasetDocuments"})})]})})});var eL=e.i(247176),eE=e.i(312620),eR=e.i(223922);let eA=function(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,t.jsx)("div",{className:(0,N.cn)(a?"text-text-tertiary":"text-text-secondary",Q.default.tdValue),children:e??"-"})},eV=e=>e?e<1e3?e:`${(0,eM.formatNumber)((e/1e3).toFixed(1))}k`:eA(0,!0),e$=e=>{let{embeddingAvailable:l,documents:i=[],selectedIds:c,onSelectedIdChange:o,datasetId:f,pagination:y,onUpdate:v,onManageMetadata:j,statusFilterValue:b,remoteSortValue:C}=e,{t:w}=(0,m.useTranslation)(),{formatTime:k}=(0,eN.default)(),D=(0,a.useRouter)(),_=(0,n.useDatasetDetailContextWithSelector)(e=>e.dataset),M=_?.doc_form,S=M!==r.ChunkingMode.parentChild,T=M===r.ChunkingMode.qa,[I,L]=(0,s.useState)(null),[E,R]=(0,s.useState)("desc");(0,s.useEffect)(()=>{L(null),R("desc")},[C]);let{isShowEditModal:A,showEditModal:V,hideEditModal:$,originalList:B,handleSave:U}=(e=>{let t,{datasetId:a,docList:l,selectedDocumentIds:n,onUpdate:i}=e,[r,{setTrue:d,setFalse:c}]=(0,u.useBoolean)(!1),o=(t=[],l.forEach(e=>{e.doc_metadata?t.push(e.doc_metadata.filter(e=>"built-in"!==e.id)):t.push([])}),t),m=(0,s.useMemo)(()=>{let e={},t=[];return o.forEach(a=>{a.forEach(a=>{if(e[a.id]?.isMultipleValue)return;let s=t.find(e=>e.id===a.id);if(e[a.id]||(e[a.id]={value:a.value,isMultipleValue:!1}),s&&s.value!==a.value){e[a.id].isMultipleValue=!0,s.isMultipleValue=!0,s.value=null;return}s||t.push({...a,isMultipleValue:!1})})}),t},[o]),{mutateAsync:f}=(0,p.useBatchUpdateDocMetadata)(),y=async(e,t,s)=>{let r,d,u=(r=e.filter(e=>e.updateType===h.UpdateType.changeValue),d=m.filter(t=>!e.find(e=>e.id===t.id)),(n||l.map(e=>e.id)).map(e=>{let a=l.findIndex(t=>t.id===e),n=[...a>=0?o[a]:[],...t].filter(e=>!d.find(t=>t.id===e.id)).map(e=>({id:e.id,name:e.name,type:e.type,value:e.value}));return s&&r.forEach(e=>{n.find(t=>t.id===e.id)||e.isMultipleValue||n.push(e)}),{document_id:e,metadata_list:n=n.map(e=>{let t=r.find(t=>t.id===e.id);return t||e}),partial_update:a<0}}));await f({dataset_id:a,metadata_list:u}),i(),c(),x.default.notify({type:"success",message:(0,ew.t)("actionMsg.modifiedSuccessfully",{ns:"common"})})};return{isShowEditModal:r,showEditModal:d,hideEditModal:c,originalList:m,handleSave:y}})({datasetId:f,docList:i.filter(e=>c.includes(e.id)),selectedDocumentIds:c,onUpdate:v}),z=(0,s.useMemo)(()=>{let e=i;return(b&&"all"!==b&&(e=e.filter(e=>"string"==typeof e.display_status&&(0,eo.normalizeStatusForQuery)(e.display_status)===b)),I)?[...e].sort((e,t)=>{let a,s;switch(I){case"name":a=e.name?.toLowerCase()||"",s=t.name?.toLowerCase()||"";break;case"word_count":a=e.word_count||0,s=t.word_count||0;break;case"hit_count":a=e.hit_count||0,s=t.hit_count||0;break;case"created_at":a=e.created_at,s=t.created_at;break;default:return 0}if("name"===I){let e=a.localeCompare(s);return"asc"===E?e:-e}{let e=a-s;return"asc"===E?e:-e}}):e},[i,I,E,b]),P=(e,a)=>{let s=I===e,l=s&&"desc"===E;return(0,t.jsxs)("div",{className:"flex cursor-pointer items-center hover:text-text-secondary",onClick:()=>{I===e?R("asc"===E?"desc":"asc"):(L(e),R("desc"))},children:[a,(0,t.jsx)(g.RiArrowDownLine,{className:(0,N.cn)("ml-0.5 h-3 w-3 transition-all",s?"text-text-tertiary":"text-text-disabled",s&&!l?"rotate-180":"")})]})},[O,H]=(0,s.useState)(null),[W,{setTrue:Z,setFalse:q}]=(0,u.useBoolean)(!1),K=(0,s.useCallback)(e=>{H(e),Z()},[Z]),G=(0,s.useCallback)(()=>{v()},[v]),J=(0,s.useMemo)(()=>z.length>0&&z.every(e=>c.includes(e.id)),[z,c]),X=(0,s.useMemo)(()=>z.some(e=>c.includes(e.id)),[z,c]),Y=(0,s.useCallback)(()=>{J?o([]):o((0,et.uniq)([...c,...z.map(e=>e.id)]))},[J,z,o,c]),{mutateAsync:ee}=(0,d.useDocumentArchive)(),{mutateAsync:ei}=(0,d.useDocumentSummary)(),{mutateAsync:er}=(0,d.useDocumentEnable)(),{mutateAsync:ed}=(0,d.useDocumentDisable)(),{mutateAsync:em}=(0,d.useDocumentDelete)(),{mutateAsync:ex}=(0,d.useDocumentBatchRetryIndex)(),{mutateAsync:ep,isPending:eh}=(0,d.useDocumentDownloadZip)(),ef=e=>async()=>{let t;switch(e){case r.DocumentActionType.archive:t=ee;break;case r.DocumentActionType.summary:t=ei;break;case r.DocumentActionType.enable:t=er;break;case r.DocumentActionType.disable:t=ed;break;default:t=em}let[a]=await (0,eD.asyncRunSafe)(t({datasetId:f,documentIds:c}));a?x.default.notify({type:"error",message:w("actionMsg.modifiedUnsuccessfully",{ns:"common"})}):(e===r.DocumentActionType.delete&&o([]),x.default.notify({type:"success",message:w("actionMsg.modifiedSuccessfully",{ns:"common"})}),v())},ey=async()=>{let[e]=await (0,eD.asyncRunSafe)(ex({datasetId:f,documentIds:c}));e?x.default.notify({type:"error",message:w("actionMsg.modifiedUnsuccessfully",{ns:"common"})}):(o([]),x.default.notify({type:"success",message:w("actionMsg.modifiedSuccessfully",{ns:"common"})}),v())},eg=(0,s.useMemo)(()=>z.some(e=>c.includes(e.id)&&"error"===e.display_status),[z,c]),ev=(0,s.useCallback)(e=>{if(!e)return"";let t=e.split(".");return t.length<=1||""===t[0]&&2===t.length?"":t[t.length-1].toLowerCase()},[]),ej=(0,s.useCallback)(e=>"rag-pipeline"===e,[]),eb=(0,s.useCallback)(e=>e===ek.DatasourceType.localFile||e===r.DataSourceType.FILE,[]),eM=(0,s.useCallback)(e=>e===ek.DatasourceType.onlineDocument||e===r.DataSourceType.NOTION,[]),eT=(0,s.useCallback)(e=>e===ek.DatasourceType.websiteCrawl||e===r.DataSourceType.WEB,[]),eA=(0,s.useCallback)(e=>e===ek.DatasourceType.onlineDrive,[]),e$=(0,s.useMemo)(()=>{let e=new Set(c);return z.filter(t=>e.has(t.id)&&t.data_source_type===r.DataSourceType.FILE).map(e=>e.id)},[z,c]),eF=(0,s.useCallback)(()=>{let e="u">typeof crypto&&"function"==typeof crypto.randomUUID?crypto.randomUUID():`${Date.now().toString(36)}${Math.random().toString(36).slice(2,10)}`;return`${e}-docs.zip`},[]),eB=(0,s.useCallback)(async()=>{if(eh)return;let[e,t]=await (0,eD.asyncRunSafe)(ep({datasetId:f,documentIds:e$}));e||!t?x.default.notify({type:"error",message:w("actionMsg.downloadUnsuccessfully",{ns:"common"})}):(0,e_.downloadBlob)({data:t,fileName:eF()})},[f,e$,eF,eh,ep,w]);return(0,t.jsxs)("div",{className:"relative mt-3 flex h-full w-full flex-col",children:[(0,t.jsx)("div",{className:"relative h-0 grow overflow-x-auto",children:(0,t.jsxs)("table",{className:`w-full min-w-[700px] max-w-full border-collapse border-0 text-sm ${Q.default.documentTable}`,children:[(0,t.jsx)("thead",{className:"h-8 border-b border-divider-subtle text-xs font-medium uppercase leading-8 text-text-tertiary",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:"w-12",children:(0,t.jsxs)("div",{className:"flex items-center",onClick:e=>e.stopPropagation(),children:[l&&(0,t.jsx)(ea.default,{className:"mr-2 shrink-0",checked:J,indeterminate:!J&&X,onCheck:Y}),"#"]})}),(0,t.jsx)("td",{children:P("name",w("list.table.header.fileName",{ns:"datasetDocuments"}))}),(0,t.jsx)("td",{className:"w-[130px]",children:w("list.table.header.chunkingMode",{ns:"datasetDocuments"})}),(0,t.jsx)("td",{className:"w-24",children:P("word_count",w("list.table.header.words",{ns:"datasetDocuments"}))}),(0,t.jsx)("td",{className:"w-44",children:P("hit_count",w("list.table.header.hitCount",{ns:"datasetDocuments"}))}),(0,t.jsx)("td",{className:"w-44",children:P("created_at",w("list.table.header.uploadTime",{ns:"datasetDocuments"}))}),(0,t.jsx)("td",{className:"w-40",children:w("list.table.header.status",{ns:"datasetDocuments"})}),(0,t.jsx)("td",{className:"w-20",children:w("list.table.header.action",{ns:"datasetDocuments"})})]})}),(0,t.jsx)("tbody",{className:"text-text-secondary",children:z.map((e,a)=>{let s=eb(e.data_source_type)?e.data_source_detail_dict?.upload_file?.extension:"";return(0,t.jsxs)("tr",{className:"h-8 cursor-pointer border-b border-divider-subtle hover:bg-background-default-hover",onClick:()=>{D.push(`/datasets/${f}/documents/${e.id}`)},children:[(0,t.jsx)("td",{className:"text-left align-middle text-xs text-text-tertiary",children:(0,t.jsxs)("div",{className:"flex items-center",onClick:e=>e.stopPropagation(),children:[(0,t.jsx)(ea.default,{className:"mr-2 shrink-0",checked:c.includes(e.id),onCheck:()=>{o(c.includes(e.id)?c.filter(t=>t!==e.id):[...c,e.id])}}),a+1]})}),(0,t.jsx)("td",{children:(0,t.jsxs)("div",{className:"group mr-6 flex max-w-[460px] items-center hover:mr-0",children:[(0,t.jsxs)("div",{className:"flex shrink-0 items-center",children:[eM(e.data_source_type)&&(0,t.jsx)(el.default,{className:"mr-1.5",type:"page",src:ej(e.created_from)?e.data_source_info.page.page_icon:e.data_source_info.notion_page_icon}),eb(e.data_source_type)&&(0,t.jsx)(es.default,{type:(0,eu.extensionToFileType)(ej(e.created_from)?e?.data_source_info?.extension:e?.data_source_info?.upload_file?.extension??s),className:"mr-1.5"}),eA(e.data_source_type)&&(0,t.jsx)(es.default,{type:(0,eu.extensionToFileType)(ev(e?.data_source_info?.name)),className:"mr-1.5"}),eT(e.data_source_type)&&(0,t.jsx)(g.RiGlobalLine,{className:"mr-1.5 size-4"})]}),(0,t.jsx)(F.default,{popupContent:e.name,children:(0,t.jsx)("span",{className:"grow-1 truncate text-sm",children:e.name})}),e.summary_index_status&&(0,t.jsx)("div",{className:"ml-1 hidden shrink-0 group-hover:flex",children:(0,t.jsx)(eI,{status:e.summary_index_status})}),(0,t.jsx)("div",{className:"hidden shrink-0 group-hover:ml-auto group-hover:flex",children:(0,t.jsx)(F.default,{popupContent:w("list.table.rename",{ns:"datasetDocuments"}),children:(0,t.jsx)("div",{className:"cursor-pointer rounded-md p-1 hover:bg-state-base-hover",onClick:t=>{t.stopPropagation(),K(e)},children:(0,t.jsx)(g.RiEditLine,{className:"h-4 w-4 text-text-tertiary"})})})})]})}),(0,t.jsx)("td",{children:(0,t.jsx)(ec,{isGeneralMode:S,isQAMode:T})}),(0,t.jsx)("td",{children:eV(e.word_count)}),(0,t.jsx)("td",{children:eV(e.hit_count)}),(0,t.jsx)("td",{className:"text-[13px] text-text-secondary",children:k(e.created_at,w("dateTimeFormat",{ns:"datasetHitTesting"}))}),(0,t.jsx)("td",{children:(0,t.jsx)(eL.default,{status:e.display_status})}),(0,t.jsx)("td",{children:(0,t.jsx)(eE.default,{selectedIds:c,onSelectedIdChange:o,embeddingAvailable:l,datasetId:f,detail:function(e,t){let a={};for(let s=0;s<t.length;s++){let l=t[s];Object.hasOwn(e,l)&&(a[l]=e[l])}return a}(e,["name","enabled","archived","id","data_source_type","doc_form","display_status"]),onUpdate:v})})]},e.id)})})]})}),c.length>0&&(0,t.jsx)(eS.default,{className:"absolute bottom-16 left-0 z-20",selectedIds:c,onArchive:ef(r.DocumentActionType.archive),onBatchSummary:ef(r.DocumentActionType.summary),onBatchEnable:ef(r.DocumentActionType.enable),onBatchDisable:ef(r.DocumentActionType.disable),onBatchDownload:e$.length>0?eB:void 0,onBatchDelete:ef(r.DocumentActionType.delete),onEditMetadata:V,onBatchReIndex:eg?ey:void 0,onCancel:()=>{o([])}}),!!y.total&&(0,t.jsx)(en.default,{...y,className:"w-full shrink-0"}),W&&O&&(0,t.jsx)(eR.default,{datasetId:f,documentId:O.id,name:O.name,onClose:q,onSaved:G}),A&&(0,t.jsx)(eC,{datasetId:f,documentNum:c.length,list:B,onSave:U,onHide:$,onShowManage:()=>{$(),j()}})]})};var eF=e.i(966428),eB=e.i(38532);let eU=["-created_at","created_at","-hit_count","hit_count"],ez=e=>e&&eU.includes(e)?e:"-created_at",eP={page:1,limit:10,keyword:"",status:"all",sort:"-created_at"};function eO(e,t){let{page:a,limit:s,keyword:l,status:n,sort:i}=e||{};a&&a>1||s&&10!==s||l&&l.trim()?(t.set("page",(a||1).toString()),t.set("limit",(s||10).toString())):(t.delete("page"),t.delete("limit")),l&&l.trim()?t.set("keyword",encodeURIComponent(l)):t.delete("keyword");let r=(0,eo.sanitizeStatusValue)(n);r&&"all"!==r?t.set("status",r):t.delete("status");let d=ez(i);"-created_at"!==d?t.set("sort",d):t.delete("sort")}let eH=function(){let e=(0,a.useSearchParams)(),t=(0,s.useMemo)(()=>{let t,a,s,l,n;return t=Number.parseInt(e.get("page")||"1",10),a=Number.parseInt(e.get("limit")||"10",10),s=e.get("keyword")||"",l=(0,eo.sanitizeStatusValue)(e.get("status")),n=ez(e.get("sort")),{page:t>0?t:1,limit:a>0&&a<=100?a:10,keyword:s?decodeURIComponent(s):"",status:l,sort:n}},[e]),l=(0,a.useRouter)(),n=(0,a.usePathname)(),i=(0,s.useCallback)(e=>{let a={...t,...e};a.status=(0,eo.sanitizeStatusValue)(a.status),a.sort=ez(a.sort);let s=new URLSearchParams;eO(a,s);let i=s.toString(),r=i?`?${i}`:"";l.push(`${n}${r}`,{scroll:!1})},[t,l,n]),r=(0,s.useCallback)(()=>{let e=new URLSearchParams;eO(eP,e);let t=e.toString(),a=t?`?${t}`:"";l.push(`${n}${a}`,{scroll:!1})},[l,n]);return(0,s.useMemo)(()=>({query:t,updateQuery:i,resetQuery:r}),[t,i,r])},eW=function(){let{query:e,updateQuery:t}=eH(),[a,l]=(0,s.useState)(""),[n,i]=(0,s.useState)(""),r=(0,eF.useDebounce)(n,{wait:500}),[d,c]=(0,s.useState)(()=>(0,eo.sanitizeStatusValue)(e.status)),[o,u]=(0,s.useState)(e.sort),m=(0,s.useMemo)(()=>(0,eo.normalizeStatusForQuery)(d),[d]),[x,p]=(0,s.useState)(e.page-1),[h,f]=(0,s.useState)(e.limit),[y,g]=(0,s.useState)([]),[v,j]=(0,s.useState)(!0);(0,s.useEffect)(()=>{e.keyword&&(l(e.keyword),i(e.keyword))},[]),(0,s.useEffect)(()=>{p(e.page-1),f(e.limit),e.keyword!==n&&(l(e.keyword),i(e.keyword)),c(t=>{let a=(0,eo.sanitizeStatusValue)(e.status);return t===a?t:a}),u(e.sort)},[e]),(0,s.useEffect)(()=>{r!==e.keyword&&(p(0),t({keyword:r,page:1}))},[r,e.keyword,t]),(0,s.useEffect)(()=>{n!==e.keyword&&g([])},[n,e.keyword]),(0,s.useEffect)(()=>{g([])},[m]);let b=(0,s.useCallback)(e=>{p(e),t({page:e+1})},[t]),C=(0,s.useCallback)(e=>{f(e),p(0),t({limit:e,page:1})},[t]),{run:w}=(0,eB.useDebounceFn)(()=>{i(a)},{wait:500}),N=(0,s.useCallback)(e=>{l(e),w()},[w]),k=(0,s.useCallback)(e=>{let a=(0,eo.sanitizeStatusValue)(e);c(a),p(0),t({status:a,page:1})},[t]),D=(0,s.useCallback)(()=>{"all"!==d&&(c("all"),p(0),t({status:"all",page:1}))},[d,t]),_=(0,s.useCallback)(e=>{e!==o&&(u(e),p(0),t({sort:e,page:1}))},[o,t]),M=(0,s.useCallback)(e=>{if(!e?.data)return;let t=0;e.data.forEach(e=>{let{indexing_status:a}=e;("completed"===a||"paused"===a||"error"===a)&&t++});let a=t!==e.data.length;j("all"!==m&&["queuing","indexing","paused"].includes(m)||a)},[m]),S=(0,s.useCallback)(e=>{if(!e)return;let t=Math.ceil(e.total/h);x>0&&x+1>t&&b(t>0?t-1:0)},[h,x,b]);return{inputValue:a,searchValue:n,debouncedSearchValue:r,handleInputChange:N,statusFilterValue:d,sortValue:o,normalizedStatusFilterValue:m,handleStatusFilterChange:k,handleStatusFilterClear:D,handleSortChange:_,currPage:x,limit:h,handlePageChange:b,handleLimitChange:C,selectedIds:y,setSelectedIds:g,timerCanRun:v,updatePollingState:M,adjustPageForTotal:S}};e.s(["default",0,e=>{let{datasetId:y}=e,g=(0,a.useRouter)(),{plan:v}=(0,i.useProviderContext)(),j="sandbox"===v.type,b=(0,n.useDatasetDetailContextWithSelector)(e=>e.dataset),C=!!b?.embedding_available,{inputValue:w,debouncedSearchValue:N,handleInputChange:k,statusFilterValue:D,sortValue:_,normalizedStatusFilterValue:M,handleStatusFilterChange:S,handleStatusFilterClear:T,handleSortChange:I,currPage:L,limit:E,handlePageChange:R,handleLimitChange:A,selectedIds:V,setSelectedIds:$,timerCanRun:F,updatePollingState:B,adjustPageForTotal:U}=eW(),{data:z,isLoading:P}=(0,d.useDocumentList)({datasetId:y,query:{page:L+1,limit:E,keyword:N,status:M,sort:_},refetchInterval:2500*!!F});(0,s.useEffect)(()=>{B(z)},[z,B]),(0,s.useEffect)(()=>{U(z)},[z,U]);let O=(0,d.useInvalidDocumentList)(y),H=(0,d.useInvalidDocumentDetail)(),W=(0,o.useInvalid)(c.useSegmentListKey),Z=(0,o.useInvalid)(c.useChildSegmentListKey),q=(0,s.useCallback)(()=>{O(),H(),setTimeout(()=>{W(),Z()},5e3)},[O,H,W,Z]),{isShowEditModal:K,showEditModal:Q,hideEditModal:J,datasetMetaData:X,handleAddMetaData:Y,handleRename:et,handleDeleteMetaData:ea,builtInEnabled:es,setBuiltInEnabled:el,builtInMetaData:en}=(e=>{let{datasetId:t,onUpdateDocList:a}=e,{t:l}=(0,m.useTranslation)(),[n,{setTrue:i,setFalse:r}]=(0,u.useBoolean)(!1);(0,s.useEffect)(()=>{localStorage.getItem(h.isShowManageMetadataLocalStorageKey)&&(i(),localStorage.removeItem(h.isShowManageMetadataLocalStorageKey))},[]);let{data:d}=(0,p.useDatasetMetaData)(t),{mutate:c}=(0,p.useCreateMetaData)(t),{checkName:o}=(0,f.default)(),y=(0,s.useCallback)(async e=>{let t=o(e.name).errorMsg;if(t)return x.default.notify({message:t,type:"error"}),Promise.reject(Error(t));await c(e)},[o,c]),{mutate:g}=(0,p.useRenameMeta)(t),v=(0,s.useCallback)(async e=>{let t=o(e.name).errorMsg;if(t)return x.default.notify({message:t,type:"error"}),Promise.reject(Error(t));await g(e),a()},[o,g,a]),{mutateAsync:j}=(0,p.useDeleteMetaData)(t),b=(0,s.useCallback)(async e=>{await j(e),a()},[j,a]),[C,w]=(0,s.useState)(d?.built_in_field_enabled);(0,s.useEffect)(()=>{w(d?.built_in_field_enabled)},[d]);let{mutateAsync:N}=(0,p.useUpdateBuiltInStatus)(t),{data:k}=(0,p.useBuiltInMetaDataFields)();return{isShowEditModal:n,showEditModal:i,hideEditModal:r,datasetMetaData:d?.doc_metadata,handleAddMetaData:y,handleRename:v,handleDeleteMetaData:b,builtInMetaData:k?.fields,builtInEnabled:C,setBuiltInEnabled:async e=>{await N(e),w(e),x.default.notify({message:l("actionMsg.modifiedSuccessfully",{ns:"common"}),type:"success"})}}})({datasetId:y,dataset:b,onUpdateDocList:O}),ei=(0,s.useCallback)(()=>{b?.runtime_mode==="rag_pipeline"?g.push(`/datasets/${y}/documents/create-from-pipeline`):g.push(`/datasets/${y}/documents/create`)},[b?.runtime_mode,y,g]),er=z?.total||0,ed=z?.data;return(0,t.jsxs)("div",{className:"flex h-full flex-col",children:[(0,t.jsx)(G,{datasetId:y,dataSourceType:b?.data_source_type,embeddingAvailable:C,isFreePlan:j,statusFilterValue:D,sortValue:_,inputValue:w,onStatusFilterChange:S,onStatusFilterClear:T,onSortChange:I,onInputChange:k,isShowEditMetadataModal:K,showEditMetadataModal:Q,hideEditMetadataModal:J,datasetMetaData:X,builtInMetaData:en,builtInEnabled:!!es,onAddMetaData:Y,onRenameMetaData:et,onDeleteMetaData:ea,onBuiltInEnabledChange:el,onAddDocument:ei}),(0,t.jsx)("div",{className:"flex h-0 grow flex-col px-6 pt-4",children:(()=>{if(P)return(0,t.jsx)(l.default,{type:"app"});if(er>0)return(0,t.jsx)(e$,{embeddingAvailable:C,documents:ed||[],datasetId:y,onUpdate:q,selectedIds:V,onSelectedIdChange:$,statusFilterValue:M,remoteSortValue:_,pagination:{total:er,limit:E,onLimitChange:A,current:L,onChange:R},onManageMetadata:Q});let e=b?.data_source_type===r.DataSourceType.NOTION;return(0,t.jsx)(ee,{canAdd:C,onClick:ei,type:e?"sync":"upload"})})()})]})}],117959)}]);
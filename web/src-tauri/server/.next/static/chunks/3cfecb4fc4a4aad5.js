(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,396094,867019,503607,199288,e=>{"use strict";var t=e.i(563199),s=e.i(837699),a=e.i(105845),r=e.i(233697),l=e.i(268255);e.i(152567);var n=e.i(408767),i=e.i(339548),o=e.i(223314),d=e.i(137667),c=e.i(943963),u=e.i(925521),p=e.i(683257),m=e.i(922521),x=e.i(491234),h=e.i(367916),g=e.i(652669),f=e.i(648404),b=e.i(935139),v=e.i(443014);let j=(0,r.default)(()=>e.A(439387),{loadableGenerated:{modules:[3871]},ssr:!1});e.s(["default",0,e=>{let{allowedExtensions:r,supportBatchUpload:y=!0}=e,{t:C}=(0,n.useTranslation)(),{notify:k}=(0,i.useContext)(d.ToastContext),w=(0,p.useLocale)(),N=(0,v.useDataSourceStoreWithSelector)(e=>e.localFileList),S=(0,v.useDataSourceStore)(),[_,D]=(0,l.useState)(!1),T=(0,l.useRef)(null),P=(0,l.useRef)(null),L=(0,l.useRef)(null),I=(0,l.useRef)([]),F=!y&&N.length>0,{data:z}=(0,g.useFileUploadConfig)(),E=(0,l.useMemo)(()=>{let e={md:"markdown",pptx:"pptx",htm:"html",xlsx:"xlsx",docx:"docx"};return r.map(t=>e[t]||t).map(e=>e.toLowerCase()).filter((e,t,s)=>s.indexOf(e)===t).map(e=>e.toUpperCase()).join(w!==x.LanguagesSupported[1]?", ":"、 ")},[w,r]),O=r.map(e=>`.${e}`),A=(0,l.useMemo)(()=>({file_size_limit:z?.file_size_limit??15,batch_count_limit:y?z?.batch_count_limit??5:1,file_upload_limit:y?z?.file_upload_limit??5:1}),[z,y]),R=(0,l.useCallback)((e,t,s)=>{let{setLocalFileList:r}=S.getState();r((0,a.produce)(s,s=>{let a=s.findIndex(t=>t.fileID===e.fileID);s[a]={...s[a],progress:t}}))},[S]),$=(0,l.useCallback)(e=>{let{setLocalFileList:t}=S.getState();t(e)},[S]),B=(0,l.useCallback)(e=>{let{setCurrentLocalFile:t}=S.getState();e.id&&t(e)},[S]),M=e=>{if(!e)return"";let t=e.name.split(".");return t[t.length-1]},W=(0,l.useCallback)(e=>{let{size:t}=e,s=`.${M(e)}`,a=O.includes(s.toLowerCase());a||k({type:"error",message:C("stepOne.uploader.validation.typeError",{ns:"datasetCreation"})});let r=t<=1024*A.file_size_limit*1024;return r||k({type:"error",message:C("stepOne.uploader.validation.size",{ns:"datasetCreation",size:A.file_size_limit})}),a&&r},[k,C,O,A.file_size_limit]),U=(0,l.useCallback)(async e=>{let t=new FormData;return t.append("file",e.file),(0,h.upload)({xhr:new XMLHttpRequest,data:t,onprogress:t=>{t.lengthComputable&&R(e,Math.floor(t.loaded/t.total*100),I.current)}},!1,void 0,"?source=datasets").then(t=>{let s=Object.assign({},e.file,{id:t.id,...t}),a={fileID:e.fileID,file:s,progress:-1},r=I.current.findIndex(t=>t.fileID===e.fileID);return I.current[r]=a,R(a,100,I.current),Promise.resolve({...a})}).catch(t=>(k({type:"error",message:(0,o.getFileUploadErrorMessage)(t,C("stepOne.uploader.failed",{ns:"datasetCreation"}),C)}),R(e,-2,I.current),Promise.resolve({...e}))).finally()},[I,k,R,C]),K=(0,l.useCallback)(e=>(e.forEach(e=>e.progress=0),Promise.all(e.map(U))),[U]),G=(0,l.useCallback)(async e=>{let t=A.batch_count_limit,s=e.length,a=0,r=0;for(;a<s;){r=a+t>s?s:a+t;let l=e.slice(a,r);await K(l),a=r}},[A,K]),q=(0,l.useCallback)(e=>{let t=A.file_upload_limit;if(!e.length)return!1;if(e.length+N.length>t&&!u.IS_CE_EDITION)return k({type:"error",message:C("stepOne.uploader.validation.filesNumber",{ns:"datasetCreation",filesNumber:t})}),!1;let s=e.map((e,t)=>({fileID:`file${t}-${Date.now()}`,file:e,progress:-1})),a=[...I.current,...s];$(a),I.current=a,G(s)},[A.file_upload_limit,N.length,$,G,k,C]),V=e=>{e.preventDefault(),e.stopPropagation(),e.target!==P.current&&D(!0)},H=e=>{e.preventDefault(),e.stopPropagation()},X=e=>{e.preventDefault(),e.stopPropagation(),e.target===P.current&&D(!1)},Z=(0,l.useCallback)(e=>{if(e.preventDefault(),e.stopPropagation(),D(!1),!e.dataTransfer)return;let t=Array.from(e.dataTransfer.files);y||(t=t.slice(0,1)),q(t.filter(W))},[q,W,y]),J=(0,l.useCallback)(()=>{L.current&&L.current.click()},[]),Q=(0,l.useCallback)(e=>{let t=Array.from(e.target.files??[]);q((t=t.slice(0,A.batch_count_limit)).filter(W))},[W,q,A.batch_count_limit]),{theme:Y}=(0,m.default)(),ee=(0,l.useMemo)(()=>Y===f.Theme.dark?"#5289ff":"#296dff",[Y]);return(0,l.useEffect)(()=>{let e=T.current;return e?.addEventListener("dragenter",V),e?.addEventListener("dragover",H),e?.addEventListener("dragleave",X),e?.addEventListener("drop",Z),()=>{e?.removeEventListener("dragenter",V),e?.removeEventListener("dragover",H),e?.removeEventListener("dragleave",X),e?.removeEventListener("drop",Z)}},[Z]),(0,t.jsxs)("div",{className:"flex flex-col",children:[!F&&(0,t.jsx)("input",{ref:L,id:"fileUploader",className:"hidden",type:"file",multiple:y,accept:O.join(","),onChange:Q}),!F&&(0,t.jsxs)("div",{ref:T,className:(0,b.cn)("relative box-border flex min-h-20 flex-col items-center justify-center gap-1 rounded-xl border border-dashed border-components-dropzone-border bg-components-dropzone-bg px-4 py-3 text-xs leading-4 text-text-tertiary",_&&"border-components-dropzone-border-accent bg-components-dropzone-bg-accent"),children:[(0,t.jsxs)("div",{className:"flex min-h-5 items-center justify-center text-sm leading-4 text-text-secondary",children:[(0,t.jsx)(s.RiUploadCloud2Line,{className:"mr-2 size-5"}),(0,t.jsxs)("span",{children:[y?C("stepOne.uploader.button",{ns:"datasetCreation"}):C("stepOne.uploader.buttonSingleFile",{ns:"datasetCreation"}),r.length>0&&(0,t.jsx)("label",{className:"ml-1 cursor-pointer text-text-accent",onClick:J,children:C("stepOne.uploader.browse",{ns:"datasetCreation"})})]})]}),(0,t.jsx)("div",{children:C("stepOne.uploader.tip",{ns:"datasetCreation",size:A.file_size_limit,supportTypes:E,batchCount:A.batch_count_limit,totalCount:A.file_upload_limit})}),_&&(0,t.jsx)("div",{ref:P,className:"absolute left-0 top-0 h-full w-full"})]}),N.length>0&&(0,t.jsx)("div",{className:"mt-1 flex flex-col gap-y-1",children:N.map((e,a)=>{var r;let l=e.progress>=0&&e.progress<100,n=-2===e.progress;return(0,t.jsxs)("div",{onClick:B.bind(null,e.file),className:(0,b.cn)("flex h-12 items-center rounded-lg border border-components-panel-border bg-components-panel-on-panel-item-bg shadow-xs shadow-shadow-shadow-4",n&&"border-state-destructive-border bg-state-destructive-hover"),children:[(0,t.jsx)("div",{className:"flex w-12 shrink-0 items-center justify-center",children:(0,t.jsx)(c.default,{size:"lg",className:"shrink-0",name:e.file.name,extension:M(e.file)})}),(0,t.jsxs)("div",{className:"flex shrink grow flex-col gap-0.5",children:[(0,t.jsx)("div",{className:"flex w-full",children:(0,t.jsx)("div",{className:"w-0 grow truncate text-xs text-text-secondary",children:e.file.name})}),(0,t.jsxs)("div",{className:"w-full truncate text-2xs leading-3 text-text-tertiary",children:[(0,t.jsx)("span",{className:"uppercase",children:M(e.file)}),(0,t.jsx)("span",{className:"px-1 text-text-quaternary",children:"·"}),(0,t.jsx)("span",{children:(r=e.file.size)/1024<10?`${(r/1024).toFixed(2)}KB`:`${(r/1024/1024).toFixed(2)}MB`})]})]}),(0,t.jsxs)("div",{className:"flex w-16 shrink-0 items-center justify-end gap-1 pr-3",children:[l&&(0,t.jsx)(j,{percentage:e.progress,stroke:ee,fill:ee,animationDuration:0}),n&&(0,t.jsx)(s.RiErrorWarningFill,{className:"size-4 text-text-destructive"}),(0,t.jsx)("span",{className:"flex h-6 w-6 cursor-pointer items-center justify-center",onClick:t=>{var s;t.stopPropagation(),s=e.fileID,L.current&&(L.current.value=""),I.current=I.current.filter(e=>e.fileID!==s),$([...I.current])},children:(0,t.jsx)(s.RiDeleteBinLine,{className:"size-4 text-text-tertiary"})})]})]},`${e.fileID}-${a}`)})})]})}],396094);var y=e.i(908432),C=e.i(449980),k=e.i(706953),w=e.i(59375),N=e.i(413159),S=e.i(296124),_=e.i(654537),D=e.i(255202),T=e.i(151094),P=e.i(757198),L=e.i(421001),I=e.i(417944),F=e.i(391185),z=e.i(965930);let E=l.memo(e=>{let{credential:a,isSelected:r,onCredentialChange:n}=e,{avatar_url:i,name:o}=a,d=(0,l.useCallback)(()=>{n(a.id)},[a.id,n]);return(0,t.jsxs)("div",{className:"flex cursor-pointer items-center gap-x-2 rounded-lg p-2 hover:bg-state-base-hover",onClick:d,children:[(0,t.jsx)(z.CredentialIcon,{avatarUrl:i,name:o,size:20}),(0,t.jsx)("span",{className:"system-sm-medium grow truncate text-text-secondary",children:o}),r&&(0,t.jsx)(s.RiCheckLine,{className:"size-4 shrink-0 text-text-accent"})]})}),O=l.memo(e=>{let{currentCredentialId:s,credentials:a,onCredentialChange:r}=e;return(0,t.jsx)("div",{className:"flex w-[280px] flex-col gap-y-1 rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur p-1 shadow-lg shadow-shadow-shadow-5 backdrop-blur-[5px]",children:a.map(e=>{let a=e.id===s;return(0,t.jsx)(E,{credential:e,isSelected:a,onCredentialChange:r},e.id)})})}),A=l.memo(e=>{let{currentCredential:a,isOpen:r}=e,{avatar_url:l,name:n=""}=a||{};return(0,t.jsxs)("div",{className:(0,b.cn)("flex cursor-pointer items-center gap-x-2 rounded-md p-1 pr-2",r?"bg-state-base-hover":"hover:bg-state-base-hover"),children:[(0,t.jsx)(z.CredentialIcon,{avatarUrl:l,name:n,size:20}),(0,t.jsxs)("div",{className:"flex grow items-center gap-x-1 overflow-hidden",children:[(0,t.jsx)("span",{className:"system-md-semibold grow truncate text-text-secondary",children:n}),(0,t.jsx)(s.RiArrowDownSLine,{className:"size-4 shrink-0 text-text-secondary"})]})]})}),R=l.memo(e=>{let{currentCredentialId:s,onCredentialChange:a,credentials:r}=e,[n,{toggle:i}]=(0,I.useBoolean)(!1),o=(0,l.useMemo)(()=>r.find(e=>e.id===s),[r,s]);(0,l.useEffect)(()=>{!o&&r.length&&a(r[0].id)},[o,r]);let d=(0,l.useCallback)(e=>{a(e),i()},[a,i]);return(0,t.jsxs)(F.PortalToFollowElem,{open:n,onOpenChange:i,placement:"bottom-start",offset:{mainAxis:4},children:[(0,t.jsx)(F.PortalToFollowElemTrigger,{onClick:i,className:"grow overflow-hidden",children:(0,t.jsx)(A,{currentCredential:o,isOpen:n})}),(0,t.jsx)(F.PortalToFollowElemContent,{className:"z-10",children:(0,t.jsx)(O,{currentCredentialId:s,credentials:r,onCredentialChange:d})})]})}),$=l.memo(e=>{let{docTitle:a,docLink:r,onClickConfiguration:l,pluginName:i,...o}=e,{t:d}=(0,n.useTranslation)();return(0,t.jsxs)("div",{className:"flex items-center justify-between gap-x-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-x-1 overflow-hidden",children:[(0,t.jsx)(R,{...o}),(0,t.jsx)(P.default,{type:"vertical",className:"mx-1 h-3.5 shrink-0"}),(0,t.jsx)(L.default,{popupContent:d("configurationTip",{ns:"datasetPipeline",pluginName:i}),position:"top",children:(0,t.jsx)(T.default,{variant:"ghost",size:"small",className:"size-6 shrink-0 px-1",children:(0,t.jsx)(s.RiEqualizer2Line,{className:"h-4 w-4",onClick:l})})})]}),(0,t.jsxs)("a",{className:"system-xs-medium flex shrink-0 items-center gap-x-1 text-text-accent",href:r,target:"_blank",rel:"noopener noreferrer",children:[(0,t.jsx)(s.RiBookOpenLine,{className:"size-3.5 shrink-0"}),(0,t.jsx)("span",{title:a,children:a})]})]})});var B=e.i(697452),M=e.i(324935),W=e.i(394529),U=e.i(574270);let K=l.memo(e=>{let{index:a,style:r,data:l}=e,{t:i}=(0,n.useTranslation)(),{dataList:o,handleToggle:d,checkedIds:c,disabledCheckedIds:u,handleCheck:p,canPreview:m,handlePreview:x,listMapWithChildrenAndDescendants:h,searchValue:g,previewPageId:f,pagesMap:v,isMultipleChoice:j}=l,y=o[a],C=h[y.page_id],k=C.descendants.size>0,w=C.ancestors,N=w.length?[...w,y.page_name]:[y.page_name],S=u.has(y.page_id);return(0,t.jsxs)("div",{className:(0,b.cn)("group flex cursor-pointer items-center rounded-md pl-2 pr-[2px] hover:bg-state-base-hover",f===y.page_id&&"bg-state-base-hover"),style:{...r,top:r.top+8,left:8,right:8,width:"calc(100% - 16px)"},children:[j?(0,t.jsx)(M.default,{className:"mr-2 shrink-0",checked:c.has(y.page_id),disabled:S,onCheck:()=>{p(a)}}):(0,t.jsx)(U.default,{className:"mr-2 shrink-0",isChecked:c.has(y.page_id),disabled:S,onCheck:()=>{p(a)}}),!g&&(k?(0,t.jsx)("div",{className:"mr-1 flex h-5 w-5 shrink-0 items-center justify-center rounded-md hover:bg-components-button-ghost-bg-hover",style:{marginLeft:8*y.depth},onClick:()=>d(a),children:y.expand?(0,t.jsx)(s.RiArrowDownSLine,{className:"h-4 w-4 text-text-tertiary"}):(0,t.jsx)(s.RiArrowRightSLine,{className:"h-4 w-4 text-text-tertiary"})}):"root"!==y.parent_id&&v[y.parent_id]?(0,t.jsx)("div",{className:"mr-1 h-5 w-5 shrink-0",style:{marginLeft:8*y.depth}}):(0,t.jsx)("div",{})),(0,t.jsx)(W.default,{className:"mr-1 shrink-0",type:"page",src:y.page_icon}),(0,t.jsx)("div",{className:"grow truncate text-[13px] font-medium leading-4 text-text-secondary",title:y.page_name,children:y.page_name}),m&&(0,t.jsx)("div",{className:"ml-1 hidden h-6 shrink-0 cursor-pointer items-center rounded-md border-[0.5px] border-components-button-secondary-border bg-components-button-secondary-bg px-2 text-xs font-medium leading-4 text-components-button-secondary-text shadow-xs shadow-shadow-shadow-3 backdrop-blur-[10px] hover:border-components-button-secondary-border-hover hover:bg-components-button-secondary-bg-hover group-hover:flex",onClick:()=>x(a),children:i("dataSource.notion.selector.preview",{ns:"common"})}),g&&(0,t.jsx)("div",{className:"ml-1 max-w-[120px] shrink-0 truncate text-xs text-text-quaternary",title:N.join(" / "),children:N.join(" / ")})]})},B.areEqual),G=(e,t,s,a)=>{let r=s.parent_id,l=s.page_id;if(r&&l&&"root"!==r&&e[r]){if(t[r])t[r].children.add(l),t[r].descendants.add(l),t[r].descendants.add(a.page_id);else{let s=new Set([l]),n=new Set([l,a.page_id]);t[r]={...e[r],children:s,descendants:n,depth:0,ancestors:[]}}a.depth++,a.ancestors.unshift(t[r].page_name),"root"!==t[r].parent_id&&G(e,t,t[r],a)}},q=e=>{let{checkedIds:s,disabledValue:a,searchValue:r,pagesMap:i,list:o,onSelect:d,canPreview:c=!0,onPreview:u,isMultipleChoice:p=!0,currentCredentialId:m}=e,{t:x}=(0,n.useTranslation)(),[h,g]=(0,l.useState)([]),[f,b]=(0,l.useState)("");(0,l.useEffect)(()=>{g(o.filter(e=>"root"===e.parent_id||!i[e.parent_id]).map(e=>({...e,expand:!1,depth:0})))},[m]);let v=o.filter(e=>e.page_name.includes(r)).map(e=>({...e,expand:!1,depth:0})),j=r?v:h,y=(0,l.useMemo)(()=>o.reduce((e,t)=>{let s=t.page_id;return e[s]||(e[s]={...t,children:new Set,descendants:new Set,depth:0,ancestors:[]}),G(i,e,e[s],e[s]),e},{}),[o,i]),C=(0,l.useCallback)(e=>{let t=h[e],s=y[t.page_id],a=Array.from(s.descendants),r=Array.from(s.children),l=[];t.expand?(t.expand=!1,l=h.filter(e=>!a.includes(e.page_id))):(t.expand=!0,l=[...h.slice(0,e+1),...r.map(e=>({...i[e],expand:!1,depth:y[e].depth})),...h.slice(e+1)]),g(l)},[h,y,i]),k=(0,l.useCallback)(e=>{let t=new Set(s),a=j[e].page_id,l=y[a];if(t.has(a)){if(!r&&p)for(let e of l.descendants)t.delete(e);t.delete(a)}else{if(!r&&p)for(let e of l.descendants)t.add(e);!p&&t.size>0&&t.clear(),t.add(a)}d(new Set(t))},[j,p,y,d,r,s]),w=(0,l.useCallback)(e=>{let t=j[e].page_id;b(t),u&&u(t)},[j,u]);return j.length?(0,t.jsx)(B.FixedSizeList,{className:"py-2",height:296,itemCount:j.length,itemSize:28,width:"100%",itemKey:(e,t)=>t.dataList[e].page_id,itemData:{dataList:j,handleToggle:C,checkedIds:s,disabledCheckedIds:a,handleCheck:k,canPreview:c,handlePreview:w,listMapWithChildrenAndDescendants:y,searchValue:r,previewPageId:f,pagesMap:i,isMultipleChoice:p},children:K}):(0,t.jsx)("div",{className:"flex h-[296px] items-center justify-center text-[13px] text-text-tertiary",children:x("dataSource.notion.selector.noSearchResult",{ns:"common"})})},V=l.memo(e=>{let{name:s}=e,{t:a}=(0,n.useTranslation)();return(0,t.jsx)("div",{className:"system-sm-medium px-[5px] py-1 text-text-secondary",children:a("onlineDocument.pageSelectorTitle",{ns:"datasetPipeline",name:s})})});e.s(["default",0,e=>{let{nodeId:s,nodeData:a,isInPipeline:r=!1,supportBatchUpload:n=!0,onCredentialChange:i}=e,o=(0,p.useDocLink)(),c=(0,N.useDatasetDetailContextWithSelector)(e=>e.dataset?.pipeline_id),u=(0,S.useModalContextSelector)(e=>e.setShowAccountSettingModal),{documentsData:m,searchValue:x,selectedPagesId:g,currentCredentialId:f}=(0,v.useDataSourceStoreWithSelector)((0,y.useShallow)(e=>({documentsData:e.documentsData,searchValue:e.searchValue,selectedPagesId:e.selectedPagesId,currentCredentialId:e.currentCredentialId}))),{data:b}=(0,D.useGetDataSourceAuth)({pluginId:a.plugin_id,provider:a.provider_name}),j=(0,v.useDataSourceStore)(),T=(0,l.useMemo)(()=>(m||[]).reduce((e,t)=>(t.pages.forEach(s=>{e[s.page_id]={...s,workspace_id:t.workspace_id}}),e),{}),[m]),P=r?`/rag/pipelines/${c}/workflows/draft/datasource/nodes/${s}/run`:`/rag/pipelines/${c}/workflows/published/datasource/nodes/${s}/run`,L=(0,l.useCallback)(async()=>{let{currentCredentialId:e}=j.getState(),t=Object.entries(a.datasource_parameters||{}).reduce((e,t)=>{let[s,a]=t;return e[s]="object"==typeof a&&null!==a&&"value"in a?a.value:a,e},{});(0,h.ssePost)(P,{body:{inputs:t,credential_id:e,datasource_type:_.DatasourceType.onlineDocument}},{onDataSourceNodeCompleted:e=>{let{setDocumentsData:t}=j.getState();t(e.data)},onDataSourceNodeError:e=>{d.default.notify({type:"error",message:e.error})}})},[j,P,a.datasource_parameters]);(0,l.useEffect)(()=>{f&&L()},[f]);let I=(0,l.useCallback)(e=>{let{setSearchValue:t}=j.getState();t(e)},[j]),F=(0,l.useCallback)(e=>{let{setSelectedPagesId:t,setOnlineDocuments:s}=j.getState(),a=Array.from(e).map(e=>T[e]);t(new Set(Array.from(e))),s(a)},[j,T]),z=(0,l.useCallback)(e=>{let{setCurrentDocument:t}=j.getState();t(T[e])},[T,j]),E=(0,l.useCallback)(()=>{u({payload:w.ACCOUNT_SETTING_TAB.DATA_SOURCE})},[u]);return(0,t.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,t.jsx)($,{docTitle:"Docs",docLink:o("/use-dify/knowledge/knowledge-pipeline/authorize-data-source"),onClickConfiguration:E,pluginName:a.datasource_label,currentCredentialId:f,onCredentialChange:i,credentials:b?.result||[]}),(0,t.jsxs)("div",{className:"rounded-xl border border-components-panel-border bg-background-default-subtle",children:[(0,t.jsxs)("div",{className:"flex items-center gap-x-2 rounded-t-xl border-b border-b-divider-regular bg-components-panel-bg p-1 pl-3",children:[(0,t.jsx)("div",{className:"flex grow items-center",children:(0,t.jsx)(V,{name:a.datasource_label})}),(0,t.jsx)(k.default,{value:x,onChange:I})]}),(0,t.jsx)("div",{className:"overflow-hidden rounded-b-xl",children:m?.length?(0,t.jsx)(q,{checkedIds:g,disabledValue:new Set,searchValue:x,list:m[0].pages||[],pagesMap:T,onSelect:F,canPreview:!r,onPreview:z,isMultipleChoice:n,currentCredentialId:f}):(0,t.jsx)("div",{className:"flex h-[296px] items-center justify-center",children:(0,t.jsx)(C.default,{type:"app"})})})]})]})}],867019);var H=e.i(38532),X=e.i(291631),Z=e.i(807324),J=e.i(112785);let Q=e=>{let{ref:s,...a}=e;return(0,t.jsx)(Z.default,{...a,ref:s,data:J.default})};Q.displayName="BucketsBlue";var Y=e.i(839789);let ee=e=>{let{ref:s,...a}=e;return(0,t.jsx)(Z.default,{...a,ref:s,data:Y.default})};ee.displayName="BucketsGray";var et=e.i(791955);let es=e=>{let{ref:s,...a}=e;return(0,t.jsx)(Z.default,{...a,ref:s,data:et.default})};es.displayName="Folder";let ea=l.memo(e=>{let{bucketName:s,handleBackToBucketList:a,handleClickBucketName:r,disabled:i=!1,isActive:o=!1,showSeparator:d=!0}=e,{t:c}=(0,n.useTranslation)(),u=(0,l.useCallback)(()=>{i||r()},[i,r]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(L.default,{popupContent:c("onlineDrive.breadcrumbs.allBuckets",{ns:"datasetPipeline"}),children:(0,t.jsx)("button",{type:"button",className:"flex size-6 shrink-0 cursor-pointer items-center justify-center rounded-md hover:bg-state-base-hover",onClick:a,children:(0,t.jsx)(ee,{})})}),(0,t.jsx)("span",{className:"system-xs-regular text-divider-deep",children:"/"}),(0,t.jsx)("button",{type:"button",className:(0,b.cn)("max-w-full shrink truncate rounded-md px-[5px] py-1",o?"system-sm-medium text-text-secondary":"system-sm-regular text-text-tertiary",!i&&"hover:bg-state-base-hover"),disabled:i,onClick:u,title:s,children:s}),d&&(0,t.jsx)("span",{className:"system-xs-regular shrink-0 text-divider-deep",children:"/"})]})}),er=l.memo(e=>{let{breadcrumbs:s,handleBackToRoot:a}=e,{t:r}=(0,n.useTranslation)();return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{type:"button",className:(0,b.cn)("max-w-full shrink truncate rounded-md px-[5px] py-1",s.length>0&&"system-sm-regular text-text-tertiary hover:bg-state-base-hover",0===s.length&&"system-sm-medium text-text-secondary"),onClick:a,disabled:0===s.length,children:r("onlineDrive.breadcrumbs.allFiles",{ns:"datasetPipeline"})}),s.length>0&&(0,t.jsx)("span",{className:"system-xs-regular text-divider-deep",children:"/"})]})}),el=l.memo(e=>{let{name:s,index:a,onBreadcrumbClick:r}=e,n=(0,l.useCallback)(()=>{r(a)},[a,r]);return(0,t.jsx)("div",{className:"system-md-regular rounded-lg px-3 py-1.5 text-text-secondary hover:bg-state-base-hover",onClick:n,children:s})}),en=l.memo(e=>{let{breadcrumbs:s,startIndex:a,onBreadcrumbClick:r}=e;return(0,t.jsx)("div",{className:"flex w-[136px] flex-col rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur p-1 shadow-lg shadow-shadow-shadow-5 backdrop-blur-[5px]",children:s.map((e,s)=>(0,t.jsx)(el,{name:e,index:a+s,onBreadcrumbClick:r},`${e}-${s}`))})}),ei=l.memo(e=>{let{startIndex:a,breadcrumbs:r,onBreadcrumbClick:n}=e,[i,o]=(0,l.useState)(!1),d=(0,l.useCallback)(()=>{o(e=>!e)},[]),c=(0,l.useCallback)(e=>{n(e),o(!1)},[n]);return(0,t.jsxs)(F.PortalToFollowElem,{open:i,onOpenChange:o,placement:"bottom-start",offset:{mainAxis:4,crossAxis:-13},children:[(0,t.jsx)(F.PortalToFollowElemTrigger,{onClick:d,children:(0,t.jsx)("button",{type:"button",className:(0,b.cn)("flex size-6 items-center justify-center rounded-md",i?"bg-state-base-hover":"hover:bg-state-base-hover"),children:(0,t.jsx)(s.RiMoreFill,{className:"size-4 text-text-tertiary"})})}),(0,t.jsx)(F.PortalToFollowElemContent,{className:"z-[11]",children:(0,t.jsx)(en,{breadcrumbs:r,startIndex:a,onBreadcrumbClick:c})}),(0,t.jsx)("span",{className:"system-xs-regular text-divider-deep",children:"/"})]})}),eo=e=>{let{name:s,index:a,handleClick:r,disabled:n=!1,isActive:i=!1,showSeparator:o=!0}=e,d=(0,l.useCallback)(()=>{n||r(a)},[n,r,a]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{type:"button",className:(0,b.cn)("max-w-full shrink truncate rounded-md px-[5px] py-1",i?"system-sm-medium text-text-secondary":"system-sm-regular text-text-tertiary",!n&&"hover:bg-state-base-hover"),disabled:n,onClick:d,title:s,children:s}),o&&(0,t.jsx)("span",{className:"system-xs-regular shrink-0 text-divider-deep",children:"/"})]})};eo.displayName="BreadcrumbItem";let ed=l.memo(eo),ec=l.memo(e=>{let{breadcrumbs:s,keywords:a,bucket:r,searchResultsLength:i,isInPipeline:o}=e,{t:d}=(0,n.useTranslation)(),c=(0,v.useDataSourceStore)(),u=(0,v.useDataSourceStoreWithSelector)(e=>e.hasBucket),p=!!a&&i>0,m=0===s.length&&u&&""===r,x=(0,l.useMemo)(()=>{let e=o?2:3;return r?e-1:e},[o,r]),h=(0,l.useMemo)(()=>{let e=s.slice(0,x-1),t=s.slice(x-1,s.length-1);return{original:s,needCollapsed:s.length>x,prefixBreadcrumbs:e,collapsedBreadcrumbs:t,lastBreadcrumb:s[s.length-1]}},[x,s]),g=(0,l.useCallback)(()=>{let{setOnlineDriveFileList:e,setSelectedFileIds:t,setBreadcrumbs:s,setPrefix:a,setBucket:r}=c.getState();e([]),t([]),r(""),s([]),a([])},[c]),f=(0,l.useCallback)(()=>{let{setOnlineDriveFileList:e,setSelectedFileIds:t,setBreadcrumbs:s,setPrefix:a}=c.getState();e([]),t([]),s([]),a([])},[c]),b=(0,l.useCallback)(()=>{let{setOnlineDriveFileList:e,setSelectedFileIds:t,setBreadcrumbs:s,setPrefix:a}=c.getState();e([]),t([]),s([]),a([])},[c]),j=(0,l.useCallback)(e=>{let{breadcrumbs:t,prefix:s,setOnlineDriveFileList:a,setSelectedFileIds:r,setBreadcrumbs:l,setPrefix:n}=c.getState(),i=t.slice(0,e+1),o=s.slice(0,e+1);a([]),r([]),l(i),n(o)},[c]);return(0,t.jsxs)("div",{className:"flex grow items-center overflow-hidden",children:[p&&(0,t.jsx)("div",{className:"system-sm-medium text-test-secondary px-[5px]",children:d("onlineDrive.breadcrumbs.searchResult",{ns:"datasetPipeline",searchResultsLength:i,folderName:s.length>0?s[s.length-1]:r})}),!p&&m&&(0,t.jsx)("div",{className:"system-sm-medium text-test-secondary px-[5px]",children:d("onlineDrive.breadcrumbs.allBuckets",{ns:"datasetPipeline"})}),!p&&!m&&(0,t.jsxs)("div",{className:"flex w-full items-center gap-x-0.5 overflow-hidden",children:[u&&r&&(0,t.jsx)(ea,{bucketName:r,handleBackToBucketList:g,handleClickBucketName:f,isActive:0===s.length,disabled:0===s.length,showSeparator:s.length>0}),!u&&(0,t.jsx)(er,{breadcrumbs:s,handleBackToRoot:b}),!h.needCollapsed&&(0,t.jsx)(t.Fragment,{children:h.original.map((e,s)=>{let a=s===h.original.length-1;return(0,t.jsx)(ed,{index:s,handleClick:j,name:e,isActive:a,showSeparator:!a,disabled:a},`${e}-${s}`)})}),h.needCollapsed&&(0,t.jsxs)(t.Fragment,{children:[h.prefixBreadcrumbs.map((e,s)=>(0,t.jsx)(ed,{index:s,handleClick:j,name:e},`${e}-${s}`)),(0,t.jsx)(ei,{startIndex:h.prefixBreadcrumbs.length,breadcrumbs:h.collapsedBreadcrumbs,onBreadcrumbClick:j}),(0,t.jsx)(ed,{index:s.length-1,handleClick:j,name:h.lastBreadcrumb,isActive:!0,disabled:!0,showSeparator:!1})]})]})]})}),eu=l.memo(e=>{let{breadcrumbs:s,inputValue:a,keywords:r,bucket:l,isInPipeline:i,searchResultsLength:o,handleInputChange:d,handleResetKeywords:c}=e,{t:u}=(0,n.useTranslation)();return(0,t.jsxs)("div",{className:"flex items-center gap-x-2 bg-components-panel-bg p-1 pl-3",children:[(0,t.jsx)(ec,{breadcrumbs:s,keywords:r,bucket:l,searchResultsLength:o,isInPipeline:i}),(0,t.jsx)(X.default,{value:a,onChange:d,onClear:c,placeholder:u("onlineDrive.breadcrumbs.searchPlaceholder",{ns:"datasetPipeline"}),showLeftIcon:!0,showClearIcon:!0,wrapperClassName:"w-[200px] h-8 shrink-0"})]})}),ep=l.memo(()=>{let{t:e}=(0,n.useTranslation)();return(0,t.jsx)("div",{className:"flex size-full items-center justify-center rounded-[10px] bg-background-section px-1 py-1.5",children:(0,t.jsx)("span",{className:"system-xs-regular text-text-tertiary",children:e("onlineDrive.emptyFolder",{ns:"datasetPipeline"})})})});e.i(9633);var em=e.i(951151),em=em;let ex=l.memo(e=>{let{onResetKeywords:s}=e,{t:a}=(0,n.useTranslation)();return(0,t.jsxs)("div",{className:"flex size-full flex-col items-center justify-center gap-y-2 rounded-[10px] bg-background-section p-6",children:[(0,t.jsx)(em.default,{className:"size-8 text-text-tertiary"}),(0,t.jsx)("div",{className:"system-sm-regular text-text-secondary",children:a("onlineDrive.emptySearchResult",{ns:"datasetPipeline"})}),(0,t.jsx)(T.default,{variant:"secondary-accent",size:"small",onClick:s,className:"px-1.5",children:(0,t.jsx)("span",{className:"px-[3px]",children:a("onlineDrive.resetKeywords",{ns:"datasetPipeline"})})})]})});var eh=e.i(128984),eg=e.i(377397),ef=e.i(688200);let eb=l.memo(e=>{let{type:s,fileName:a,size:r="md",className:n}=e,i=(0,l.useMemo)(()=>s===_.OnlineDriveFileType.bucket||s===_.OnlineDriveFileType.folder?"custom":(0,ef.getFileType)(a),[s,a]);return s===_.OnlineDriveFileType.bucket?(0,t.jsx)(Q,{className:(0,b.cn)("size-[18px]",n)}):s===_.OnlineDriveFileType.folder?(0,t.jsx)(es,{className:(0,b.cn)("size-[18px]",n)}):(0,t.jsx)(eg.default,{size:r,type:i,className:(0,b.cn)("size-[18px]",n)})}),ev=l.memo(e=>{let{file:s,isSelected:a,disabled:r=!1,isMultipleChoice:i=!0,onSelect:o,onOpen:d}=e,{t:c}=(0,n.useTranslation)(),{id:u,name:p,type:m,size:x}=s,h="bucket"===m,g="folder"===m,f=r?L.default:l.Fragment,v=r?{popupContent:c("onlineDrive.notSupportedFileType",{ns:"datasetPipeline"}),position:"top-end",offset:{mainAxis:4,crossAxis:-104}}:{},j=(0,l.useCallback)(e=>{e.stopPropagation(),o(s)},[s,o]),y=(0,l.useCallback)(e=>{if(e.stopPropagation(),!r){if(h||g)return void d(s);o(s)}},[r,s,h,g,d,o]);return(0,t.jsxs)("div",{className:"flex cursor-pointer items-center gap-2 rounded-md px-2 py-[3px] hover:bg-state-base-hover",onClick:y,children:[!h&&i&&(0,t.jsx)(M.default,{className:"shrink-0",disabled:r,id:u,checked:a,onCheck:j}),!h&&!i&&(0,t.jsx)(U.default,{className:"shrink-0",disabled:r,isChecked:a,onCheck:j}),(0,t.jsx)(f,{...v,children:(0,t.jsxs)("div",{className:(0,b.cn)("flex grow items-center gap-x-1 overflow-hidden py-0.5",r&&"opacity-30"),children:[(0,t.jsx)(eb,{type:m,fileName:p,className:"shrink-0 transform-gpu"}),(0,t.jsx)("span",{className:"system-sm-medium grow truncate text-text-secondary",title:p,children:p}),!g&&"number"==typeof x&&(0,t.jsx)("span",{className:"system-xs-regular shrink-0 text-text-tertiary",children:(0,eh.formatFileSize)(x)})]})})]})}),ej=l.memo(e=>{let{fileList:a,selectedFileIds:r,keywords:i,handleResetKeywords:o,handleSelectFile:d,handleOpenFolder:c,isLoading:u,supportBatchUpload:p}=e,{t:m}=(0,n.useTranslation)(),x=(0,l.useRef)(null),h=(0,l.useRef)(null),g=(0,v.useDataSourceStore)();(0,l.useEffect)(()=>(x.current&&(h.current=new IntersectionObserver(e=>{let{setNextPageParameters:t,currentNextPageParametersRef:s,isTruncated:a}=g.getState();e[0].isIntersecting&&a.current&&!u&&t(s.current)},{rootMargin:"100px"}),h.current.observe(x.current)),()=>h.current?.disconnect()),[x,u,g]);let f=u&&0===a.length&&0===i.length,b=u&&a.length>0,j=!u&&0===a.length&&0===i.length,y=!u&&0===a.length&&i.length>0;return(0,t.jsxs)("div",{className:"grow overflow-hidden p-1 pt-0",children:[f&&(0,t.jsx)(C.default,{type:"app"}),j&&(0,t.jsx)(ep,{}),y&&(0,t.jsx)(ex,{onResetKeywords:o}),a.length>0&&(0,t.jsxs)("div",{className:"flex h-full flex-col gap-y-px overflow-y-auto rounded-[10px] bg-background-section px-1 py-1.5",children:[a.map(e=>{let s=r.includes(e.id);return(0,t.jsx)(ev,{file:e,isSelected:s,onSelect:d,onOpen:c,isMultipleChoice:p},e.id)}),b&&(0,t.jsx)("div",{className:"flex items-center justify-center py-2",role:"status","aria-live":"polite","aria-label":m("loading",{ns:"appApi"}),children:(0,t.jsx)(s.RiLoader2Line,{className:"animation-spin size-4 text-text-tertiary"})}),(0,t.jsx)("div",{ref:x,className:"h-0"})]})]})}),ey=e=>{let{fileList:s,selectedFileIds:a,breadcrumbs:r,keywords:n,bucket:i,resetKeywords:o,updateKeywords:d,searchResultsLength:c,handleSelectFile:u,handleOpenFolder:p,isInPipeline:m,isLoading:x,supportBatchUpload:h}=e,[g,f]=(0,l.useState)(n),{run:b}=(0,H.useDebounceFn)(e=>{d(e)},{wait:500}),v=()=>{f(""),o()};return(0,t.jsxs)("div",{className:"flex h-[400px] flex-col overflow-hidden rounded-xl border border-components-panel-border bg-components-panel-bg shadow-xs shadow-shadow-shadow-3",children:[(0,t.jsx)(eu,{breadcrumbs:r,inputValue:g,keywords:n,bucket:i,isInPipeline:m,handleInputChange:e=>{let t=e.target.value;f(t),b(t)},searchResultsLength:c,handleResetKeywords:v}),(0,t.jsx)(ej,{fileList:s,selectedFileIds:a,keywords:n,handleResetKeywords:v,handleOpenFolder:p,handleSelectFile:u,isLoading:x,supportBatchUpload:h})]})};e.s(["default",0,e=>{let{nodeId:s,nodeData:r,isInPipeline:n=!1,supportBatchUpload:i=!0,onCredentialChange:o}=e,c=(0,p.useDocLink)(),[u,m]=(0,l.useState)(!0),x=(0,N.useDatasetDetailContextWithSelector)(e=>e.dataset?.pipeline_id),g=(0,S.useModalContextSelector)(e=>e.setShowAccountSettingModal),{nextPageParameters:f,breadcrumbs:b,prefix:j,keywords:C,bucket:k,selectedFileIds:T,onlineDriveFileList:P,currentCredentialId:L}=(0,v.useDataSourceStoreWithSelector)((0,y.useShallow)(e=>({nextPageParameters:e.nextPageParameters,breadcrumbs:e.breadcrumbs,prefix:e.prefix,keywords:e.keywords,bucket:e.bucket,selectedFileIds:e.selectedFileIds,onlineDriveFileList:e.onlineDriveFileList,currentCredentialId:e.currentCredentialId}))),I=(0,v.useDataSourceStore)(),[F,z]=(0,l.useState)(!1),E=(0,l.useRef)(!1),{data:O}=(0,D.useGetDataSourceAuth)({pluginId:r.plugin_id,provider:r.provider_name}),A=n?`/rag/pipelines/${x}/workflows/draft/datasource/nodes/${s}/run`:`/rag/pipelines/${x}/workflows/published/datasource/nodes/${s}/run`,R=(0,l.useCallback)(async()=>{if(E.current)return;let{nextPageParameters:e,prefix:t,bucket:s,onlineDriveFileList:a,currentCredentialId:r}=I.getState();z(!0),E.current=!0,(0,h.ssePost)(A,{body:{inputs:{prefix:t[t.length-1],bucket:s,next_page_parameters:e,max_keys:30},datasource_type:_.DatasourceType.onlineDrive,credential_id:r}},{onDataSourceNodeCompleted:e=>{let{setOnlineDriveFileList:t,isTruncated:r,currentNextPageParametersRef:l,setHasBucket:n}=I.getState(),{fileList:i,isTruncated:o,nextPageParameters:d,hasBucket:c}=((e,t,s)=>{let a=[],r=!1,l={},n=!1;return 0===e.length?{fileList:a,isTruncated:r,nextPageParameters:l,hasBucket:n}:(!s&&!(t.length>0)&&e.every(e=>!!e.bucket)&&(e.length>1||1===e.length&&e[0].bucket&&0===e[0].files.length)?(e.forEach(e=>{a.push({id:e.bucket,name:e.bucket,type:_.OnlineDriveFileType.bucket})}),n=!0):(e[0].files.forEach(e=>{let{id:t,name:s,size:r,type:l}=e,n="file"===l;a.push({id:t,name:s,size:n?r:void 0,type:n?_.OnlineDriveFileType.file:_.OnlineDriveFileType.folder})}),r=e[0].is_truncated??!1,l=e[0].next_page_parameters??{},n=!!e[0].bucket),{fileList:a,isTruncated:r,nextPageParameters:l,hasBucket:n})})(e.data,b,s);t([...a,...i]),r.current=o,l.current=d,n(c),z(!1),E.current=!1},onDataSourceNodeError:e=>{d.default.notify({type:"error",message:e.error}),z(!1),E.current=!1}})},[I,A,b]);(0,l.useEffect)(()=>{L&&(u?(0===P.length&&R(),m(!1)):R())},[f,j,k,L]);let B=(0,l.useMemo)(()=>C?P.filter(e=>e.name.toLowerCase().includes(C.toLowerCase())):P,[P,C]),M=(0,l.useCallback)(e=>{let{setKeywords:t}=I.getState();t(e)},[I]),W=(0,l.useCallback)(()=>{let{setKeywords:e}=I.getState();e("")},[I]),U=(0,l.useCallback)(e=>{let{selectedFileIds:t,setSelectedFileIds:s}=I.getState();e.type===_.OnlineDriveFileType.bucket||s((0,a.produce)(t,t=>{if(t.includes(e.id)){let s=t.indexOf(e.id);t.splice(s,1)}else{if(!i&&t.length>=1)return;t.push(e.id)}}))},[I,i]),K=(0,l.useCallback)(e=>{let{breadcrumbs:t,prefix:s,setBreadcrumbs:r,setPrefix:l,setBucket:n,setOnlineDriveFileList:i,setSelectedFileIds:o}=I.getState();if(e.type!==_.OnlineDriveFileType.file)if(i([]),e.type===_.OnlineDriveFileType.bucket)n(e.name);else{o([]);let n=(0,a.produce)(t,t=>{t.push(e.name)}),i=(0,a.produce)(s,t=>{t.push(e.id)});r(n),l(i)}},[I]),G=(0,l.useCallback)(()=>{g({payload:w.ACCOUNT_SETTING_TAB.DATA_SOURCE})},[g]);return(0,t.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,t.jsx)($,{docTitle:"Docs",docLink:c("/use-dify/knowledge/knowledge-pipeline/authorize-data-source"),onClickConfiguration:G,pluginName:r.datasource_label,currentCredentialId:L,onCredentialChange:o,credentials:O?.result||[]}),(0,t.jsx)(ey,{fileList:B,selectedFileIds:T,breadcrumbs:b,keywords:C,bucket:k,resetKeywords:W,updateKeywords:M,searchResultsLength:B.length,handleSelectFile:U,handleOpenFolder:K,isInPipeline:n,isLoading:F,supportBatchUpload:i})]})}],503607);var eC=e.i(621379),ek=e.i(475390);let ew=l.memo(e=>{let{className:s="",isChecked:a,onChange:r,label:l,labelClassName:n,tooltip:i}=e;return(0,t.jsxs)("label",{className:(0,b.cn)("flex items-center space-x-2",s),children:[(0,t.jsx)(M.default,{checked:a,onCheck:()=>r(!a)}),(0,t.jsx)("div",{className:(0,b.cn)("system-sm-medium text-text-secondary",n),children:l}),i&&(0,t.jsx)(L.default,{popupContent:(0,t.jsx)("div",{className:"w-[200px]",children:i}),triggerClassName:"ml-0.5 w-4 h-4"})]})}),eN=l.memo(e=>{let{payload:s,isChecked:a,onCheckChange:r,isPreview:i,onPreview:o,showPreview:d,isMultipleChoice:c=!0}=e,{t:u}=(0,n.useTranslation)(),p=(0,l.useCallback)(()=>{r(!a)},[a,r]);return(0,t.jsxs)("div",{className:(0,b.cn)("relative flex cursor-pointer gap-x-2 rounded-lg p-2",i?"bg-state-base-active":"group hover:bg-state-base-hover"),children:[c?(0,t.jsx)(M.default,{className:"shrink-0",checked:a,onCheck:p}):(0,t.jsx)(U.default,{className:"shrink-0",isChecked:a,onCheck:p}),(0,t.jsxs)("div",{className:"flex min-w-0 grow flex-col gap-y-0.5",children:[(0,t.jsx)("div",{className:"system-sm-medium truncate text-text-secondary",title:s.title,children:s.title}),(0,t.jsx)("div",{className:"system-xs-regular truncate text-text-tertiary",title:s.source_url,children:s.source_url})]}),d&&(0,t.jsx)(T.default,{size:"small",onClick:o,className:"system-xs-medium-uppercase right-2 top-2 hidden px-1.5 group-hover:absolute group-hover:block",children:u("stepOne.website.preview",{ns:"datasetCreation"})})]})}),eS="stepOne.website",e_=l.memo(e=>{let{className:s="",previewIndex:a,list:r,checkedList:i,onSelectedChange:o,usedTime:d,onPreview:c,showPreview:u=!1,isMultipleChoice:p=!0}=e,{t:m}=(0,n.useTranslation)(),x=i.length===r.length,h=(0,l.useCallback)(()=>{x?o([]):o(r)},[x,r,o]),g=(0,l.useCallback)(e=>t=>{t?p?o([...i,e]):o([e]):o(i.filter(t=>t.source_url!==e.source_url))},[i,o,p]),f=(0,l.useCallback)(e=>{c&&c(r[e],e)},[r,c]);return(0,t.jsxs)("div",{className:(0,b.cn)("flex flex-col gap-y-2",s),children:[(0,t.jsx)("div",{className:"system-sm-medium pt-2 text-text-primary",children:m(`${eS}.scrapTimeInfo`,{ns:"datasetCreation",total:r.length,time:d.toFixed(1)})}),(0,t.jsxs)("div",{className:"overflow-hidden rounded-xl border border-components-panel-border bg-components-panel-bg",children:[p&&(0,t.jsx)("div",{className:"flex items-center px-4 py-2",children:(0,t.jsx)(ew,{isChecked:x,onChange:h,label:m(x?`${eS}.resetAll`:`${eS}.selectAll`,{ns:"datasetCreation"})})}),(0,t.jsx)("div",{className:"flex flex-col gap-y-px border-t border-divider-subtle bg-background-default-subtle p-2",children:r.map((e,s)=>(0,t.jsx)(eN,{payload:e,isChecked:i.some(t=>t.source_url===e.source_url),onCheckChange:g(e),isPreview:s===a,onPreview:f.bind(null,s),showPreview:u,isMultipleChoice:p},e.source_url))})]})]})}),eD=l.memo(e=>{let{className:s}=e;return(0,t.jsx)("div",{className:(0,b.cn)("bg-text-quaternary opacity-20",s)})}),eT=l.memo(e=>{let{firstLineWidth:s,secondLineWidth:a}=e;return(0,t.jsxs)("div",{className:"flex gap-x-2 px-2 py-[5px]",children:[(0,t.jsx)("div",{className:"py-0.5",children:(0,t.jsx)(eD,{className:"size-4 rounded-[4px]"})}),(0,t.jsxs)("div",{className:"flex grow flex-col",children:[(0,t.jsx)("div",{className:"flex h-5 w-full items-center",children:(0,t.jsx)(eD,{className:(0,b.cn)("h-2.5 rounded-sm",s)})}),(0,t.jsx)("div",{className:"flex h-[18px] w-full items-center",children:(0,t.jsx)(eD,{className:(0,b.cn)("h-1.5 rounded-sm",a)})})]})]})}),eP=l.memo(e=>{let{className:s="",crawledNum:a,totalNum:r}=e,{t:l}=(0,n.useTranslation)();return(0,t.jsxs)("div",{className:(0,b.cn)("mt-2 flex flex-col gap-y-2 pt-2",s),children:[(0,t.jsxs)("div",{className:"system-sm-medium text-text-primary",children:[l("stepOne.website.totalPageScraped",{ns:"datasetCreation"})," ",a,"/",r]}),(0,t.jsxs)("div",{className:"overflow-hidden rounded-xl border border-components-panel-border bg-components-panel-bg",children:[(0,t.jsxs)("div",{className:"flex items-center gap-x-2 px-4 py-2",children:[(0,t.jsx)(eD,{className:"size-4 rounded-[4px]"}),(0,t.jsx)(eD,{className:"h-2.5 w-14 rounded-sm"})]}),(0,t.jsx)("div",{className:"flex flex-col gap-px border-t border-divider-subtle bg-background-default-subtle p-2",children:[{firstLineWidth:"w-[35%]",secondLineWidth:"w-[50%]"},{firstLineWidth:"w-[40%]",secondLineWidth:"w-[45%]"},{firstLineWidth:"w-[30%]",secondLineWidth:"w-[36%]"}].map((e,s)=>(0,t.jsx)(eT,{firstLineWidth:e.firstLineWidth,secondLineWidth:e.secondLineWidth},s))})]})]})}),eL=l.memo(e=>{let{className:a,title:r,errorMsg:l}=e;return(0,t.jsxs)("div",{className:(0,b.cn)("flex gap-x-0.5 rounded-xl border-[0.5px] border-components-panel-border bg-opacity-40 bg-toast-error-bg p-2 shadow-xs shadow-shadow-shadow-3",a),children:[(0,t.jsx)("div",{className:"flex size-6 items-center justify-center",children:(0,t.jsx)(s.RiErrorWarningFill,{className:"h-4 w-4 text-text-destructive"})}),(0,t.jsxs)("div",{className:"flex flex-col gap-y-0.5 py-1",children:[(0,t.jsx)("div",{className:"system-xs-medium text-text-primary",children:r}),l&&(0,t.jsx)("div",{className:"system-xs-regular text-text-secondary",children:l})]})]})});var eI=e.i(634440),eF=e.i(237363),ez=e.i(870676);e.i(288243);var eE=e.i(670977),eO=e.i(849225);let eA="stepOne.website",eR=e=>{let{variables:a,step:r,runDisabled:i,onSubmit:o}=e,{t:c}=(0,n.useTranslation)(),u=(0,eO.useInitialData)(a),p=(0,eO.useConfigurations)(a),m=(0,l.useMemo)(()=>(0,ez.generateZodSchema)(p),[p]),x=(0,eI.useAppForm)({defaultValues:u,validators:{onSubmit:e=>{let{value:t}=e,s=m.safeParse(t);if(!s.success){let e=s.error.issues[0],t=`"${e.path.join(".")}" ${e.message}`;return d.default.notify({type:"error",message:t}),t}}},onSubmit:e=>{let{value:t}=e;o(t)}}),[h,{toggle:g,setTrue:f,setFalse:v}]=(0,I.useBoolean)(!1);(0,l.useEffect)(()=>{r!==eC.CrawlStep.init?f():v()},[r]);let j=(0,l.useMemo)(()=>r===eC.CrawlStep.running,[r]);return(0,t.jsxs)("form",{className:"w-full",onSubmit:e=>{e.preventDefault(),e.stopPropagation(),x.handleSubmit()},children:[(0,t.jsxs)("div",{className:"flex items-center gap-x-1 px-4 py-2",children:[(0,t.jsxs)("div",{className:"flex grow cursor-pointer select-none items-center gap-x-0.5",onClick:g,children:[(0,t.jsx)("span",{className:"system-sm-semibold-uppercase text-text-secondary",children:c(`${eA}.options`,{ns:"datasetCreation"})}),(0,t.jsx)(eE.ArrowDownRoundFill,{className:(0,b.cn)("h-4 w-4 shrink-0 text-text-quaternary",h&&"-rotate-90")})]}),(0,t.jsxs)(T.default,{variant:"primary",onClick:x.handleSubmit,disabled:i||j,loading:j,className:"shrink-0 gap-x-0.5",spinnerClassName:"!ml-0",children:[(0,t.jsx)(s.RiPlayLargeLine,{className:"size-4"}),(0,t.jsx)("span",{className:"px-0.5",children:c(j?`${eA}.running`:`${eA}.run`,{ns:"datasetCreation"})})]})]}),!h&&(0,t.jsx)("div",{className:"flex flex-col gap-3 border-t border-divider-subtle px-4 py-3",children:p.map((e,s)=>{let a=(0,eF.default)({initialData:u,config:e});return(0,t.jsx)(a,{form:x},s)})})]})},e$="stepOne.website",eB=l.memo(e=>{let{nodeId:s,nodeData:a,isInPipeline:r=!1,supportBatchUpload:i=!0,onCredentialChange:o}=e,{t:d}=(0,n.useTranslation)(),c=(0,p.useDocLink)(),[u,m]=(0,l.useState)(0),[x,g]=(0,l.useState)(0),[f,b]=(0,l.useState)(""),j=(0,N.useDatasetDetailContextWithSelector)(e=>e.dataset?.pipeline_id),C=(0,S.useModalContextSelector)(e=>e.setShowAccountSettingModal),{crawlResult:k,step:T,checkedCrawlResult:P,previewIndex:L,currentCredentialId:I}=(0,v.useDataSourceStoreWithSelector)((0,y.useShallow)(e=>({crawlResult:e.crawlResult,step:e.step,checkedCrawlResult:e.websitePages,previewIndex:e.previewIndex,currentCredentialId:e.currentCredentialId}))),{data:F}=(0,D.useGetDataSourceAuth)({pluginId:a.plugin_id,provider:a.provider_name}),z=(0,v.useDataSourceStore)(),{data:E,isFetching:O}=(0,l.useRef)(r?ek.useDraftPipelinePreProcessingParams:ek.usePublishedPipelinePreProcessingParams).current({pipeline_id:j,node_id:s},!!j&&!!s),A=T===eC.CrawlStep.init,R=T===eC.CrawlStep.finished,B=T===eC.CrawlStep.running,M=R&&f,W=r?`/rag/pipelines/${j}/workflows/draft/datasource/nodes/${s}/run`:`/rag/pipelines/${j}/workflows/published/datasource/nodes/${s}/run`,U=(0,l.useCallback)(e=>{let{setWebsitePages:t}=z.getState();t(e)},[z]),K=(0,l.useCallback)((e,t)=>{let{setCurrentWebsite:s,setPreviewIndex:a}=z.getState();s(e),a(t)},[z]),G=(0,l.useCallback)(async e=>{let{setStep:t,setCrawlResult:s,currentCredentialId:a}=z.getState();t(eC.CrawlStep.running),(0,h.ssePost)(W,{body:{inputs:e,datasource_type:_.DatasourceType.websiteCrawl,credential_id:a,response_mode:"streaming"}},{onDataSourceNodeProcessing:e=>{m(e.total??0),g(e.completed??0)},onDataSourceNodeCompleted:e=>{let{data:a,time_consuming:r}=e;s({data:a,time_consuming:r??0}),U(i?a:a.slice(0,1)),b(""),t(eC.CrawlStep.finished)},onDataSourceNodeError:e=>{b(e.error||d(`${e$}.unknownError`,{ns:"datasetCreation"})),t(eC.CrawlStep.finished)}})},[z,W,U,i,d]),q=(0,l.useCallback)(e=>{G(e)},[G]),V=(0,l.useCallback)(()=>{C({payload:w.ACCOUNT_SETTING_TAB.DATA_SOURCE})},[C]),H=(0,l.useCallback)(e=>{g(0),m(0),b(""),o(e)},[o]);return(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)($,{docTitle:"Docs",docLink:c("/use-dify/knowledge/knowledge-pipeline/authorize-data-source"),onClickConfiguration:V,pluginName:a.datasource_label,currentCredentialId:I,onCredentialChange:H,credentials:F?.result||[]}),(0,t.jsx)("div",{className:"mt-2 rounded-xl border border-components-panel-border bg-background-default-subtle",children:(0,t.jsx)(eR,{variables:E?.variables||[],step:T,runDisabled:!I||O,onSubmit:q})}),!A&&(0,t.jsxs)("div",{className:"relative flex flex-col",children:[B&&(0,t.jsx)(eP,{crawledNum:x,totalNum:u}),M&&(0,t.jsx)(eL,{className:"mt-2",title:d(`${e$}.exceptionErrorTitle`,{ns:"datasetCreation"}),errorMsg:f}),R&&!M&&(0,t.jsx)(e_,{className:"mt-2",list:k?.data||[],checkedList:P,onSelectedChange:U,usedTime:Number.parseFloat(k?.time_consuming)||0,previewIndex:L,onPreview:K,showPreview:!r,isMultipleChoice:i})]})]})});e.s(["default",0,eB],199288)}]);
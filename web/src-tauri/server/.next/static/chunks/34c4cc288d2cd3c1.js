(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,423571,e=>{"use strict";var t=e.i(563199),a=e.i(521632);e.s(["default",0,e=>{let{isMobile:s,children:n,isOpen:i,...r}=e;return(0,t.jsxs)(t.Fragment,{children:[s&&(0,t.jsx)(a.default,{isOpen:i,...r,children:n}),!s&&i&&(0,t.jsx)(t.Fragment,{children:n})]})}])},958948,e=>{"use strict";var t=e.i(563199),a=e.i(124836),s=e.i(268255),n=e.i(935139);let i=s.memo(e=>{let{icon:s,iconBgClassName:i="bg-[#F5F3FF]",title:r,description:l,noRadio:d,isChosen:o,onChosen:c=a.noop,chosenConfig:m,chosenConfigWrapClassName:u,className:x}=e;return(0,t.jsxs)("div",{className:(0,n.cn)("relative cursor-pointer rounded-xl border-[0.5px] border-components-option-card-option-border bg-components-option-card-option-bg p-3",o&&"border-[1.5px] bg-components-option-card-option-selected-bg",x),children:[(0,t.jsxs)("div",{className:"flex gap-x-2",onClick:c,children:[(0,t.jsx)("div",{className:(0,n.cn)(i,"flex size-8 shrink-0 items-center justify-center rounded-lg shadow-md"),children:s}),(0,t.jsxs)("div",{className:"grow",children:[(0,t.jsx)("div",{className:"system-sm-semibold mb-1 text-text-secondary",children:r}),(0,t.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:l})]}),!d&&(0,t.jsx)("div",{className:"absolute right-3 top-3",children:(0,t.jsx)("div",{className:(0,n.cn)("h-4 w-4 rounded-full border border-components-radio-border bg-components-radio-bg shadow-xs",o&&"border-[5px] border-components-radio-border-checked")})})]}),!!(o&&m||d)&&(0,t.jsxs)("div",{className:"mt-2 flex gap-x-2",children:[(0,t.jsx)("div",{className:"size-8 shrink-0"}),(0,t.jsx)("div",{className:(0,n.cn)(u,"grow"),children:m})]})]})});e.s(["default",0,i])},871182,e=>{"use strict";let t={src:e.i(843693).default,width:20,height:20,blurWidth:0,blurHeight:0},a={src:e.i(412660).default,width:20,height:20,blurWidth:0,blurHeight:0},s={src:e.i(854459).default,width:20,height:20,blurWidth:0,blurHeight:0},n={src:e.i(483763).default,width:16,height:18,blurWidth:0,blurHeight:0},i={src:e.i(246167).default,width:20,height:20,blurWidth:0,blurHeight:0};e.s(["indexMethodIcon",0,{high_quality:t,economical:s},"retrievalIcon",0,{vector:i,fullText:n,hybrid:a}],871182)},130990,e=>{"use strict";var t=e.i(621379),a=e.i(648404);e.s(["isReRankModelSelected",0,e=>{let{retrievalConfig:s,rerankModelList:n,indexMethod:i}=e,r=(()=>{if(s.reranking_model?.reranking_model_name){let e=n.find(e=>{let{provider:t}=e;return t===s.reranking_model?.reranking_provider_name});return e?.models.find(e=>{let{model:t}=e;return t===s.reranking_model?.reranking_model_name})}return!1})();return(!("high_quality"===i&&[a.RETRIEVE_METHOD.semantic,a.RETRIEVE_METHOD.fullText].includes(s.search_method))||!s.reranking_enable||!!r)&&("high_quality"!==i||s.search_method!==a.RETRIEVE_METHOD.hybrid||s.reranking_mode===t.RerankingModeEnum.WeightedScore||!!r)}])},526016,619306,19412,447265,536500,e=>{"use strict";var t,a=e.i(516885);e.s(["VectorSearch",()=>a.default],526016);var s=((t={}).indigo="indigo",t.blueLight="blue-light",t.orange="orange",t.purple="purple",t);e.s(["EffectColor",()=>s],619306);var n=e.i(563199),i=e.i(268255);e.i(152567);var r=e.i(408767),l=e.i(83278),d=e.i(935139);e.i(9633);var o=e.i(663554);e.s(["ArrowShape",()=>o.default],19412);var o=o;let c={[s.indigo]:"bg-util-colors-indigo-indigo-600 opacity-50",[s.blueLight]:"bg-util-colors-blue-light-blue-light-600 opacity-80",[s.orange]:"bg-util-colors-orange-orange-500 opacity-50",[s.purple]:"bg-util-colors-purple-purple-600 opacity-80"},m=i.memo(e=>{let{id:t,className:a,isActive:s,icon:i,iconActiveColor:m,title:u,description:x,isRecommended:h,effectColor:p,showEffectColor:g,disabled:_,onClick:f,children:v,showChildren:b,ref:C}=e,{t:y}=(0,r.useTranslation)();return(0,n.jsxs)("div",{ref:C,className:(0,d.cn)("cursor-pointer overflow-hidden rounded-xl border border-components-option-card-option-border bg-components-option-card-option-bg",s&&"border border-components-option-card-option-selected-border ring-[1px] ring-components-option-card-option-selected-border",_&&"cursor-not-allowed opacity-50"),onClick:()=>{s||_||f?.(t)},children:[(0,n.jsxs)("div",{className:(0,d.cn)("relative flex rounded-t-xl p-2",a),children:[p&&g&&(0,n.jsx)("div",{className:(0,d.cn)("absolute left-[-2px] top-[-2px] h-14 w-14 rounded-full blur-[80px]",`${c[p]}`)}),!!i&&(0,n.jsx)("div",{className:(0,d.cn)("flex size-6 shrink-0 items-center justify-center text-text-tertiary",s&&m),children:i}),(0,n.jsxs)("div",{className:"flex grow flex-col gap-y-0.5 py-px",children:[(0,n.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,n.jsx)("span",{className:"system-sm-medium text-text-secondary",children:u}),h&&(0,n.jsx)(l.default,{className:"h-[18px] border-text-accent-secondary text-text-accent-secondary",children:y("stepTwo.recommend",{ns:"datasetCreation"})})]}),x&&(0,n.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:x})]})]}),!!(v&&b)&&(0,n.jsxs)("div",{className:"relative rounded-b-xl bg-components-panel-bg p-4",children:[(0,n.jsx)(o.default,{className:"absolute left-[14px] top-[-11px] size-4 text-components-panel-bg"}),v]})]})});e.s(["default",0,m],447265);var u=e.i(124836),x=e.i(170866);let h=e=>e>0&&e<1?`0.${10*e}`:1===e?"1.0":e,p=(0,i.memo)(e=>{let{value:t,onChange:a=u.noop,readonly:s=!1}=e,{t:i}=(0,r.useTranslation)();return(0,n.jsx)("div",{children:(0,n.jsxs)("div",{className:"space-x-3 rounded-lg border border-components-panel-border px-3 pb-2 pt-5",children:[(0,n.jsx)(x.default,{className:(0,d.cn)("h-0.5 grow rounded-full !bg-util-colors-teal-teal-500"),max:1,min:0,step:.1,value:t.value[0],onChange:e=>!s&&a({value:[e,(10-10*e)/10]}),trackClassName:"weightedScoreSliderTrack",disabled:s}),(0,n.jsxs)("div",{className:"mt-3 flex justify-between",children:[(0,n.jsxs)("div",{className:"system-xs-semibold-uppercase flex w-[90px] shrink-0 items-center text-util-colors-blue-light-blue-light-500",children:[(0,n.jsx)("div",{className:"mr-1 truncate uppercase",title:i("weightedScore.semantic",{ns:"dataset"})||"",children:i("weightedScore.semantic",{ns:"dataset"})}),h(t.value[0])]}),(0,n.jsxs)("div",{className:"system-xs-semibold-uppercase flex w-[90px] shrink-0 items-center justify-end text-util-colors-teal-teal-500",children:[h(t.value[1]),(0,n.jsx)("div",{className:"ml-1 truncate uppercase",title:i("weightedScore.keyword",{ns:"dataset"})||"",children:i("weightedScore.keyword",{ns:"dataset"})})]})]})]})})});e.s(["default",0,p],536500)},194655,976650,713669,404853,e=>{"use strict";var t=e.i(563199),a=e.i(268255);e.i(152567);var s=e.i(408767);e.i(9633);var n=e.i(526016),i=e.i(648404),r=e.i(619306),l=e.i(447265),d=e.i(658547),o=e.i(536500);e.i(793622);var c=e.i(259509),m=e.i(363282),u=e.i(402588),x=e.i(958948),h=e.i(260484),p=e.i(137667),g=e.i(421001),_=e.i(739255),f=e.i(225162),v=e.i(117960),b=e.i(621379),C=e.i(935139);let y={src:e.i(438156).default,width:20,height:20,blurWidth:0,blurHeight:0},j={src:e.i(397088).default,width:20,height:20,blurWidth:0,blurHeight:0},k=a.memo(e=>{let{type:n,value:r,showMultiModalTip:l=!1,onChange:k}=e,{t:w}=(0,s.useTranslation)(),N=n!==i.RETRIEVE_METHOD.hybrid,T=n===i.RETRIEVE_METHOD.keywordSearch,M=n===i.RETRIEVE_METHOD.hybrid,{modelList:E}=(0,f.useModelListAndDefaultModel)(_.ModelTypeEnum.rerank),{currentModel:S}=(0,f.useCurrentProviderAndModel)(E,{provider:r.reranking_model?.reranking_provider_name??"",model:r.reranking_model?.reranking_model_name??""}),I=(0,a.useCallback)(e=>{e&&!S&&p.default.notify({type:"error",message:w("errorMsg.rerankModelRequired",{ns:"workflow"})}),k({...r,reranking_enable:e})},[S,k,r]),D=(0,a.useMemo)(()=>({provider_name:r.reranking_model.reranking_provider_name,model_name:r.reranking_model.reranking_model_name}),[r.reranking_model]),R=[{value:b.RerankingModeEnum.WeightedScore,label:w("weightedScore.title",{ns:"dataset"}),tips:w("weightedScore.description",{ns:"dataset"})},{value:b.RerankingModeEnum.RerankingModel,label:w("modelProvider.rerankModel.key",{ns:"common"}),tips:w("modelProvider.rerankModel.tip",{ns:"common"})}];return(0,t.jsxs)("div",{children:[!T&&!M&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"mb-2 flex items-center space-x-2",children:[N&&(0,t.jsx)(h.default,{size:"md",defaultValue:r.reranking_enable,onChange:I}),(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("span",{className:"system-sm-semibold mr-0.5 text-text-secondary",children:w("modelProvider.rerankModel.key",{ns:"common"})}),(0,t.jsx)(g.default,{popupContent:(0,t.jsx)("div",{className:"w-[200px]",children:w("modelProvider.rerankModel.tip",{ns:"common"})})})]})]}),r.reranking_enable&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(v.default,{defaultModel:D&&{provider:D.provider_name,model:D.model_name},modelList:E,onSelect:e=>{k({...r,reranking_model:{reranking_provider_name:e.provider,reranking_model_name:e.model}})}}),l&&(0,t.jsxs)("div",{className:"mt-2 flex h-10 items-center gap-x-0.5 overflow-hidden rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur p-2 shadow-xs backdrop-blur-[5px]",children:[(0,t.jsx)("div",{className:"absolute bottom-0 left-0 right-0 top-0 bg-dataset-warning-message-bg opacity-40"}),(0,t.jsx)("div",{className:"p-1",children:(0,t.jsx)(c.AlertTriangle,{className:"size-4 text-text-warning-secondary"})}),(0,t.jsx)("span",{className:"system-xs-medium text-text-primary",children:w("form.retrievalSetting.multiModalTip",{ns:"datasetSettings"})})]})]})]}),!M&&(0,t.jsxs)("div",{className:(0,C.cn)(!T&&"mt-4","space-between flex space-x-4"),children:[(0,t.jsx)(u.default,{className:"grow",value:r.top_k,onChange:(e,t)=>{k({...r,top_k:t})},enable:!0}),!T&&!(r.search_method===i.RETRIEVE_METHOD.fullText&&!r.reranking_enable)&&(0,t.jsx)(m.default,{className:"grow",value:r.score_threshold,onChange:(e,t)=>{k({...r,score_threshold:t})},enable:r.score_threshold_enabled,hasSwitch:!0,onSwitchChange:(e,t)=>{k({...r,score_threshold_enabled:t})}})]}),M&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"mb-4 flex gap-2",children:R.map(e=>(0,t.jsx)(x.default,{isChosen:r.reranking_mode===e.value,onChosen:()=>(e=>{if(e===r.reranking_mode)return;let t={...r,reranking_mode:e};t.weights||e!==b.RerankingModeEnum.WeightedScore||(t.weights={weight_type:b.WeightedScoreEnum.Customized,vector_setting:{vector_weight:b.DEFAULT_WEIGHTED_SCORE.other.semantic,embedding_provider_name:"",embedding_model_name:""},keyword_setting:{keyword_weight:b.DEFAULT_WEIGHTED_SCORE.other.keyword}}),e!==b.RerankingModeEnum.RerankingModel||S||p.default.notify({type:"error",message:w("errorMsg.rerankModelRequired",{ns:"workflow"})}),k(t)})(e.value),icon:(0,t.jsx)(d.default,{src:e.value===b.RerankingModeEnum.WeightedScore?y:j,alt:""}),title:e.label,description:e.tips,className:"flex-1"},e.value))}),r.reranking_mode===b.RerankingModeEnum.WeightedScore&&(0,t.jsx)(o.default,{value:{value:[r.weights.vector_setting.vector_weight,r.weights.keyword_setting.keyword_weight]},onChange:e=>{k({...r,weights:{...r.weights,vector_setting:{...r.weights.vector_setting,vector_weight:e.value[0]},keyword_setting:{...r.weights.keyword_setting,keyword_weight:e.value[1]}}})}}),r.reranking_mode!==b.RerankingModeEnum.WeightedScore&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(v.default,{defaultModel:D&&{provider:D.provider_name,model:D.model_name},modelList:E,onSelect:e=>{k({...r,reranking_model:{reranking_provider_name:e.provider,reranking_model_name:e.model}})}}),l&&(0,t.jsxs)("div",{className:"mt-2 flex h-10 items-center gap-x-0.5 overflow-hidden rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur p-2 shadow-xs backdrop-blur-[5px]",children:[(0,t.jsx)("div",{className:"absolute bottom-0 left-0 right-0 top-0 bg-dataset-warning-message-bg opacity-40"}),(0,t.jsx)("div",{className:"p-1",children:(0,t.jsx)(c.AlertTriangle,{className:"size-4 text-text-warning-secondary"})}),(0,t.jsx)("span",{className:"system-xs-medium text-text-primary",children:w("form.retrievalSetting.multiModalTip",{ns:"datasetSettings"})})]})]}),(0,t.jsxs)("div",{className:(0,C.cn)(!T&&"mt-4","space-between flex space-x-6"),children:[(0,t.jsx)(u.default,{className:"grow",value:r.top_k,onChange:(e,t)=>{k({...r,top_k:t})},enable:!0}),(0,t.jsx)(m.default,{className:"grow",value:r.score_threshold,onChange:(e,t)=>{k({...r,score_threshold:t})},enable:r.score_threshold_enabled,hasSwitch:!0,onSwitchChange:(e,t)=>{k({...r,score_threshold_enabled:t})}})]})]})]})}),w=a.memo(e=>{let{disabled:a=!1,value:d,onChange:o}=e,{t:c}=(0,s.useTranslation)();return(0,t.jsx)(l.default,{id:i.RETRIEVE_METHOD.keywordSearch,disabled:a,icon:(0,t.jsx)(n.VectorSearch,{className:"size-4"}),iconActiveColor:"text-util-colors-purple-purple-600",title:c("retrieval.keyword_search.title",{ns:"dataset"}),description:c("retrieval.keyword_search.description",{ns:"dataset"}),isActive:!0,effectColor:r.EffectColor.purple,showEffectColor:!0,showChildren:!0,className:"gap-x-2",children:(0,t.jsx)(k,{type:i.RETRIEVE_METHOD.keywordSearch,value:d,onChange:o})})});e.s(["default",0,w],194655);var N=e.i(940446);e.s(["FullTextSearch",()=>N.default],976650);var N=N,T=e.i(908287);e.s(["HybridSearch",()=>T.default],713669);var T=T,M=e.i(56971);let E=a.memo(e=>{let{disabled:d=!1,value:o,showMultiModalTip:c=!1,onChange:m}=e,{t:u}=(0,s.useTranslation)(),{supportRetrievalMethods:x}=(0,M.useProviderContext)(),{defaultModel:h,currentModel:p}=(0,f.useModelListAndDefaultModelAndCurrentProviderAndModel)(_.ModelTypeEnum.rerank),g=(0,a.useCallback)(e=>{[i.RETRIEVE_METHOD.semantic,i.RETRIEVE_METHOD.fullText].includes(e)&&m({...o,search_method:e,...!o.reranking_model.reranking_model_name||!o.reranking_model.reranking_provider_name?{reranking_model:{reranking_provider_name:p?h?.provider?.provider??"":"",reranking_model_name:p?h?.model??"":""},reranking_enable:!!p}:{reranking_enable:!0}}),e===i.RETRIEVE_METHOD.hybrid&&m({...o,search_method:e,...!o.reranking_model.reranking_model_name||!o.reranking_model.reranking_provider_name?{reranking_model:{reranking_provider_name:p?h?.provider?.provider??"":"",reranking_model_name:p?h?.model??"":""},reranking_enable:!!p,reranking_mode:p?b.RerankingModeEnum.RerankingModel:b.RerankingModeEnum.WeightedScore}:{reranking_enable:!0,reranking_mode:b.RerankingModeEnum.RerankingModel},...!o.weights?{weights:{weight_type:b.WeightedScoreEnum.Customized,vector_setting:{vector_weight:b.DEFAULT_WEIGHTED_SCORE.other.semantic,embedding_provider_name:"",embedding_model_name:""},keyword_setting:{keyword_weight:b.DEFAULT_WEIGHTED_SCORE.other.keyword}}}:{}})},[o,h,p,m]);return(0,t.jsxs)("div",{className:"flex flex-col gap-y-2",children:[x.includes(i.RETRIEVE_METHOD.semantic)&&(0,t.jsx)(l.default,{id:i.RETRIEVE_METHOD.semantic,disabled:d,icon:(0,t.jsx)(n.VectorSearch,{className:"size-4"}),iconActiveColor:"text-util-colors-purple-purple-600",title:u("retrieval.semantic_search.title",{ns:"dataset"}),description:u("retrieval.semantic_search.description",{ns:"dataset"}),isActive:o.search_method===i.RETRIEVE_METHOD.semantic,onClick:g,effectColor:r.EffectColor.purple,showEffectColor:!0,showChildren:o.search_method===i.RETRIEVE_METHOD.semantic,className:"gap-x-2",children:(0,t.jsx)(k,{type:i.RETRIEVE_METHOD.semantic,value:o,onChange:m,showMultiModalTip:c})}),x.includes(i.RETRIEVE_METHOD.fullText)&&(0,t.jsx)(l.default,{id:i.RETRIEVE_METHOD.fullText,disabled:d,icon:(0,t.jsx)(N.default,{className:"size-4"}),iconActiveColor:"text-util-colors-purple-purple-600",title:u("retrieval.full_text_search.title",{ns:"dataset"}),description:u("retrieval.full_text_search.description",{ns:"dataset"}),isActive:o.search_method===i.RETRIEVE_METHOD.fullText,onClick:g,effectColor:r.EffectColor.purple,showEffectColor:!0,showChildren:o.search_method===i.RETRIEVE_METHOD.fullText,className:"gap-x-2",children:(0,t.jsx)(k,{type:i.RETRIEVE_METHOD.fullText,value:o,onChange:m,showMultiModalTip:c})}),x.includes(i.RETRIEVE_METHOD.hybrid)&&(0,t.jsx)(l.default,{id:i.RETRIEVE_METHOD.hybrid,disabled:d,icon:(0,t.jsx)(T.default,{className:"size-4"}),iconActiveColor:"text-util-colors-purple-purple-600",title:u("retrieval.hybrid_search.title",{ns:"dataset"}),description:u("retrieval.hybrid_search.description",{ns:"dataset"}),isActive:o.search_method===i.RETRIEVE_METHOD.hybrid,onClick:g,effectColor:r.EffectColor.purple,showEffectColor:!0,isRecommended:!0,showChildren:o.search_method===i.RETRIEVE_METHOD.hybrid,className:"gap-x-2",children:(0,t.jsx)(k,{type:i.RETRIEVE_METHOD.hybrid,value:o,onChange:m,showMultiModalTip:c})})]})});e.s(["default",0,E],404853)},249432,e=>{e.v({active:"index-module__2HZM1W__active",auto:"index-module__2HZM1W__auto",button:"index-module__2HZM1W__button",calculating:"index-module__2HZM1W__calculating",click:"index-module__2HZM1W__click",content:"index-module__2HZM1W__content",csv:"index-module__2HZM1W__csv",custom:"index-module__2HZM1W__custom",customize:"index-module__2HZM1W__customize",disableMask:"index-module__2HZM1W__disableMask",disabled:"index-module__2HZM1W__disabled",divider:"index-module__2HZM1W__divider",doc:"index-module__2HZM1W__doc",docx:"index-module__2HZM1W__docx",economical:"index-module__2HZM1W__economical",fileIcon:"index-module__2HZM1W__fileIcon",fix:"index-module__2HZM1W__fix",fixed:"index-module__2HZM1W__fixed",formFooter:"index-module__2HZM1W__formFooter",formRow:"index-module__2HZM1W__formRow",htm:"index-module__2HZM1W__htm",html:"index-module__2HZM1W__html",icon:"index-module__2HZM1W__icon",indexItem:"index-module__2HZM1W__indexItem",input:"index-module__2HZM1W__input",isMobile:"index-module__2HZM1W__isMobile",json:"index-module__2HZM1W__json",label:"index-module__2HZM1W__label",markdown:"index-module__2HZM1W__markdown",md:"index-module__2HZM1W__md",pageHeader:"index-module__2HZM1W__pageHeader",pdf:"index-module__2HZM1W__pdf",previewWrap:"index-module__2HZM1W__previewWrap",qualified:"index-module__2HZM1W__qualified",radio:"index-module__2HZM1W__radio",radioItem:"index-module__2HZM1W__radioItem",recommendTag:"index-module__2HZM1W__recommendTag",ruleItem:"index-module__2HZM1W__ruleItem",segmentCount:"index-module__2HZM1W__segmentCount",segmentationItem:"index-module__2HZM1W__segmentationItem",sideTip:"index-module__2HZM1W__sideTip",source:"index-module__2HZM1W__source",sourceContent:"index-module__2HZM1W__sourceContent",sourceCount:"index-module__2HZM1W__sourceCount",tip:"index-module__2HZM1W__tip",tipCard:"index-module__2HZM1W__tipCard",title:"index-module__2HZM1W__title",txt:"index-module__2HZM1W__txt",typeFormBody:"index-module__2HZM1W__typeFormBody",typeHeader:"index-module__2HZM1W__typeHeader",typeIcon:"index-module__2HZM1W__typeIcon",warningTip:"index-module__2HZM1W__warningTip",xls:"index-module__2HZM1W__xls",xlsx:"index-module__2HZM1W__xlsx"})},274007,890644,471405,789178,e=>{"use strict";var t=e.i(563199),a=e.i(837699),s=e.i(658547);e.i(152567);var n=e.i(408767),i=e.i(151094),r=e.i(324935),l=e.i(757198),d=e.i(421001),o=e.i(268255),c=e.i(260484),m=e.i(873517),u=e.i(739255),x=e.i(225162),h=e.i(117960);let p=(0,o.memo)(e=>{let{entry:a="knowledge-base",summaryIndexSetting:s,onSummaryIndexSettingChange:i,readonly:r=!1}=e,{t:l}=(0,n.useTranslation)(),{data:p}=(0,x.useModelList)(u.ModelTypeEnum.textGeneration),g=(0,o.useMemo)(()=>{if(s?.model_name&&s?.model_provider_name)return{providerName:s?.model_provider_name,modelName:s?.model_name}},[s?.model_name,s?.model_provider_name]),_=(0,o.useCallback)(e=>{i?.({enable:e})},[i]),f=(0,o.useCallback)(e=>{i?.({model_provider_name:e.provider,model_name:e.model})},[i]),v=(0,o.useCallback)(e=>{i?.({summary_prompt:e.target.value})},[i]);return"knowledge-base"===a?(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex h-6 items-center justify-between",children:[(0,t.jsxs)("div",{className:"system-sm-semibold-uppercase flex items-center text-text-secondary",children:[l("form.summaryAutoGen",{ns:"datasetSettings"}),(0,t.jsx)(d.default,{triggerClassName:"ml-1 h-4 w-4 shrink-0",popupContent:l("form.summaryAutoGenTip",{ns:"datasetSettings"})})]}),(0,t.jsx)(c.default,{defaultValue:s?.enable??!1,onChange:_,size:"md"})]}),s?.enable&&(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"system-xs-medium-uppercase mb-1.5 mt-2 flex h-6 items-center text-text-tertiary",children:l("form.summaryModel",{ns:"datasetSettings"})}),(0,t.jsx)(h.default,{defaultModel:g&&{provider:g.providerName,model:g.modelName},modelList:p,onSelect:f,readonly:r,showDeprecatedWarnIcon:!0}),(0,t.jsx)("div",{className:"system-xs-medium-uppercase mt-3 flex h-6 items-center text-text-tertiary",children:l("form.summaryInstructions",{ns:"datasetSettings"})}),(0,t.jsx)(m.default,{value:s?.summary_prompt??"",onChange:v,disabled:r,placeholder:l("form.summaryInstructionsPlaceholder",{ns:"datasetSettings"})})]})]}):"dataset-settings"===a?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex gap-x-1",children:[(0,t.jsx)("div",{className:"flex h-7 w-[180px] shrink-0 items-center pt-1",children:(0,t.jsx)("div",{className:"system-sm-semibold text-text-secondary",children:l("form.summaryAutoGen",{ns:"datasetSettings"})})}),(0,t.jsxs)("div",{className:"py-1.5",children:[(0,t.jsxs)("div",{className:"system-sm-semibold flex items-center text-text-secondary",children:[(0,t.jsx)(c.default,{className:"mr-2",defaultValue:s?.enable??!1,onChange:_,size:"md"}),l(s?.enable?"list.status.enabled":"list.status.disabled",{ns:"datasetDocuments"})]}),(0,t.jsxs)("div",{className:"system-sm-regular mt-2 text-text-tertiary",children:[s?.enable&&l("form.summaryAutoGenTip",{ns:"datasetSettings"}),!s?.enable&&l("form.summaryAutoGenEnableTip",{ns:"datasetSettings"})]})]})]}),s?.enable&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex gap-x-1",children:[(0,t.jsx)("div",{className:"flex h-7 w-[180px] shrink-0 items-center pt-1",children:(0,t.jsx)("div",{className:"system-sm-medium text-text-tertiary",children:l("form.summaryModel",{ns:"datasetSettings"})})}),(0,t.jsx)("div",{className:"grow",children:(0,t.jsx)(h.default,{defaultModel:g&&{provider:g.providerName,model:g.modelName},modelList:p,onSelect:f,readonly:r,showDeprecatedWarnIcon:!0,triggerClassName:"h-8"})})]}),(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)("div",{className:"flex h-7 w-[180px] shrink-0 items-center pt-1",children:(0,t.jsx)("div",{className:"system-sm-medium text-text-tertiary",children:l("form.summaryInstructions",{ns:"datasetSettings"})})}),(0,t.jsx)("div",{className:"grow",children:(0,t.jsx)(m.default,{value:s?.summary_prompt??"",onChange:v,disabled:r,placeholder:l("form.summaryInstructionsPlaceholder",{ns:"datasetSettings"})})})]})]})]}):(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex h-6 items-center",children:[(0,t.jsx)(c.default,{className:"mr-2",defaultValue:s?.enable??!1,onChange:_,size:"md"}),(0,t.jsx)("div",{className:"system-sm-semibold text-text-secondary",children:l("form.summaryAutoGen",{ns:"datasetSettings"})})]}),s?.enable&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"system-sm-medium mb-1.5 flex h-6 items-center text-text-secondary",children:l("form.summaryModel",{ns:"datasetSettings"})}),(0,t.jsx)(h.default,{defaultModel:g&&{provider:g.providerName,model:g.modelName},modelList:p,onSelect:f,readonly:r,showDeprecatedWarnIcon:!0,triggerClassName:"h-8"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"system-sm-medium mb-1.5 flex h-6 items-center text-text-secondary",children:l("form.summaryInstructions",{ns:"datasetSettings"})}),(0,t.jsx)(m.default,{value:s?.summary_prompt??"",onChange:v,disabled:r,placeholder:l("form.summaryInstructionsPlaceholder",{ns:"datasetSettings"})})]})]})]})});e.s(["default",0,p],890644);var g=e.i(925521),_=e.i(621379);let f={src:e.i(755951).default,width:20,height:20,blurWidth:0,blurHeight:0};var v=e.i(249432),b=e.i(964596),C=e.i(491234),y=e.i(935139);let j=o.memo(e=>{let{currentLanguage:s,onSelect:n,disabled:i}=e;return(0,t.jsx)(b.default,{manualClose:!0,trigger:"click",disabled:i,popupClassName:"z-20",htmlContent:(0,t.jsx)("div",{className:"w-full p-1",children:C.languages.filter(e=>e.supported).map(e=>{let{prompt_name:i}=e;return(0,t.jsxs)("div",{className:"inline-flex w-full cursor-pointer items-center justify-between rounded-lg px-3 py-2 hover:bg-state-base-hover",onClick:()=>n(i),children:[(0,t.jsx)("span",{className:"system-sm-medium text-text-secondary",children:i}),s===i&&(0,t.jsx)(a.RiCheckLine,{className:"size-4 text-text-accent"})]},i)})}),btnElement:(0,t.jsxs)("div",{className:(0,y.cn)("inline-flex items-center gap-x-[1px]",i&&"cursor-not-allowed"),children:[(0,t.jsx)("span",{className:(0,y.cn)("system-xs-semibold px-[3px] text-components-button-tertiary-text",i?"text-components-button-tertiary-text-disabled":""),children:s}),(0,t.jsx)(a.RiArrowDownSLine,{className:(0,y.cn)("size-3.5 text-components-button-tertiary-text",i?"text-components-button-tertiary-text-disabled":"")})]}),btnClassName:()=>(0,y.cn)("!hover:bg-components-button-tertiary-bg !mx-1 rounded-md !border-0 !bg-components-button-tertiary-bg !px-1.5 !py-1",i?"bg-components-button-tertiary-bg-disabled":""),className:"!left-1 !z-20 h-fit !w-[140px] !translate-x-0"})});var k=e.i(291631),w=e.i(802859);let N=e=>(0,t.jsx)("label",{className:"text-xs font-semibold leading-none text-text-secondary",children:e.children}),T=e=>(0,t.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,t.jsx)(N,{children:e.label}),e.children]}),M=e=>{let{t:a}=(0,n.useTranslation)();return(0,t.jsx)(T,{label:(0,t.jsxs)("div",{className:"mb-1 flex items-center",children:[(0,t.jsx)("span",{className:"system-sm-semibold mr-0.5",children:a("stepTwo.separator",{ns:"datasetCreation"})}),(0,t.jsx)(d.default,{popupContent:(0,t.jsx)("div",{className:"max-w-[200px]",children:e.tooltip||a("stepTwo.separatorTip",{ns:"datasetCreation"})})})]}),children:(0,t.jsx)(k.default,{type:"text",className:"h-9",placeholder:a("stepTwo.separatorPlaceholder",{ns:"datasetCreation"}),...e})})},E=e=>{let a=Number.parseInt(globalThis.document?.body?.getAttribute("data-public-indexing-max-segmentation-tokens-length")||"4000",10),{t:s}=(0,n.useTranslation)();return(0,t.jsx)(T,{label:(0,t.jsx)("div",{className:"system-sm-semibold mb-1",children:s("stepTwo.maxLength",{ns:"datasetCreation"})}),children:(0,t.jsx)(w.InputNumber,{type:"number",size:"large",placeholder:`â‰¤ ${a}`,max:a,min:1,...e})})},S=e=>{let{t:a}=(0,n.useTranslation)();return(0,t.jsx)(T,{label:(0,t.jsxs)("div",{className:"mb-1 flex items-center",children:[(0,t.jsx)("span",{className:"system-sm-semibold",children:a("stepTwo.overlap",{ns:"datasetCreation"})}),(0,t.jsx)(d.default,{popupContent:(0,t.jsx)("div",{className:"max-w-[200px]",children:a("stepTwo.overlapTip",{ns:"datasetCreation"})})})]}),children:(0,t.jsx)(w.InputNumber,{type:"number",size:"large",placeholder:a("stepTwo.overlap",{ns:"datasetCreation"})||"",min:1,...e})})};e.s(["DelimiterInput",0,M,"MaxLengthInput",0,E,"OverlapInput",0,S],471405);let I=e=>(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"11",viewBox:"0 0 24 11",fill:"none",...e,children:(0,t.jsx)("path",{d:"M9.87868 1.12132C11.0503 -0.0502525 12.9497 -0.0502525 14.1213 1.12132L23.3137 10.3137H0.686292L9.87868 1.12132Z",fill:"currentColor"})}),D=e=>{let{icon:a,title:n,description:i,isActive:r,activeClassName:l,effectImg:d,disabled:o}=e;return(0,t.jsxs)("div",{className:(0,y.cn)("relative flex h-full overflow-hidden rounded-t-xl",r&&l,!o&&"cursor-pointer"),children:[(0,t.jsxs)("div",{className:"relative flex size-14 items-center justify-center overflow-hidden",children:[r&&d&&(0,t.jsx)(s.default,{src:d,className:"absolute left-0 top-0 h-full w-full",alt:"",width:56,height:56}),(0,t.jsx)("div",{className:"p-1",children:(0,t.jsx)("div",{className:"flex size-8 justify-center rounded-lg border border-components-panel-border-subtle bg-background-default-dodge p-1.5 shadow-md",children:a})})]}),(0,t.jsx)(I,{className:(0,y.cn)("absolute -bottom-1.5 left-4 text-transparent",r&&"text-components-panel-bg")}),(0,t.jsxs)("div",{className:"flex-1 space-y-0.5 py-3 pr-4",children:[(0,t.jsx)("div",{className:"system-md-semibold text-text-secondary",children:n}),(0,t.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:i})]})]})},R=e=>{let{ref:a,...s}=e,{icon:n,className:i,title:r,description:l,isActive:d,children:o,actions:c,activeHeaderClassName:m,style:u,effectImg:x,onSwitched:h,noHighlight:p,disabled:g,..._}=s;return(0,t.jsxs)("div",{className:(0,y.cn)("rounded-xl bg-components-option-card-option-bg shadow-xs",d&&!p?"border-[1.5px] border-components-option-card-option-selected-border":"border border-components-option-card-option-border",g&&"pointer-events-none opacity-50",i),style:{...u},onClick:()=>{d||g||h?.()},..._,ref:a,children:[(0,t.jsx)(D,{icon:n,title:r,description:l,isActive:d&&!p,activeClassName:m,effectImg:x,disabled:g}),!!(d&&(o||c))&&(0,t.jsxs)("div",{className:"rounded-b-xl bg-components-panel-bg px-4 py-3",children:[o,!!c&&(0,t.jsx)("div",{className:"mt-4 flex gap-2",children:c})]})]})};R.displayName="OptionCard",e.s(["OptionCard",0,R],789178);let H=e=>{let{children:a}=e;return(0,t.jsx)("label",{className:"system-sm-semibold text-text-secondary",children:a})};e.s(["GeneralChunkingOptions",0,e=>{let{segmentIdentifier:o,maxChunkLength:c,overlap:m,rules:u,currentDocForm:x,docLanguage:h,isActive:b,isInUpload:C,isNotUploadInEmptyDataset:y,hasCurrentDatasetDocForm:k,onSegmentIdentifierChange:w,onMaxChunkLengthChange:N,onOverlapChange:T,onRuleToggle:I,onDocFormChange:D,onDocLanguageChange:L,onPreview:F,onReset:W,locale:A,showSummaryIndexSetting:O,summaryIndexSetting:P,onSummaryIndexSettingChange:Z}=e,{t:q}=(0,n.useTranslation)();return(0,t.jsx)(R,{className:"mb-2 bg-background-section",title:q("stepTwo.general",{ns:"datasetCreation"}),icon:(0,t.jsx)(s.default,{width:20,height:20,src:f,alt:q("stepTwo.general",{ns:"datasetCreation"})}),activeHeaderClassName:"bg-dataset-option-card-blue-gradient",description:q("stepTwo.generalTip",{ns:"datasetCreation"}),isActive:b,onSwitched:()=>D(_.ChunkingMode.text),actions:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(i.default,{variant:"secondary-accent",onClick:F,children:[(0,t.jsx)(a.RiSearchEyeLine,{className:"mr-0.5 h-4 w-4"}),q("stepTwo.previewChunk",{ns:"datasetCreation"})]}),(0,t.jsx)(i.default,{variant:"ghost",onClick:W,children:q("stepTwo.reset",{ns:"datasetCreation"})})]}),noHighlight:C&&y,children:(0,t.jsxs)("div",{className:"flex flex-col gap-y-4",children:[(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)(M,{value:o,onChange:e=>w(e.target.value)}),(0,t.jsx)(E,{unit:"characters",value:c,onChange:N}),(0,t.jsx)(S,{unit:"characters",value:m,min:1,onChange:T})]}),(0,t.jsxs)("div",{className:"flex w-full flex-col",children:[(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,t.jsx)("div",{className:"inline-flex shrink-0",children:(0,t.jsx)(H,{children:q("stepTwo.rules",{ns:"datasetCreation"})})}),(0,t.jsx)(l.default,{className:"grow",bgStyle:"gradient"})]}),(0,t.jsxs)("div",{className:"mt-1",children:[u.map(e=>{var a;return(0,t.jsxs)("div",{className:v.default.ruleItem,onClick:()=>I(e.id),children:[(0,t.jsx)(r.default,{checked:e.enabled}),(0,t.jsx)("label",{className:"system-sm-regular ml-2 cursor-pointer text-text-secondary",children:(a=e.id,({remove_extra_spaces:q("stepTwo.removeExtraSpaces",{ns:"datasetCreation"}),remove_urls_emails:q("stepTwo.removeUrlEmails",{ns:"datasetCreation"}),remove_stopwords:q("stepTwo.removeStopwords",{ns:"datasetCreation"})})[a]??a)})]},e.id)}),O&&(0,t.jsx)("div",{className:"mt-3",children:(0,t.jsx)(p,{entry:"create-document",summaryIndexSetting:P,onSummaryIndexSettingChange:Z})}),g.IS_CE_EDITION&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.default,{type:"horizontal",className:"my-4 bg-divider-subtle"}),(0,t.jsxs)("div",{className:"flex items-center py-0.5",children:[(0,t.jsxs)("div",{className:"flex items-center",onClick:()=>{k||(x===_.ChunkingMode.qa?D(_.ChunkingMode.text):D(_.ChunkingMode.qa))},children:[(0,t.jsx)(r.default,{checked:x===_.ChunkingMode.qa,disabled:k}),(0,t.jsx)("label",{className:"system-sm-regular ml-2 cursor-pointer text-text-secondary",children:q("stepTwo.useQALanguage",{ns:"datasetCreation"})})]}),(0,t.jsx)(j,{currentLanguage:h||A,onSelect:L,disabled:x!==_.ChunkingMode.qa}),(0,t.jsx)(d.default,{popupContent:q("stepTwo.QATip",{ns:"datasetCreation"})})]}),x===_.ChunkingMode.qa&&(0,t.jsxs)("div",{style:{background:"linear-gradient(92deg, rgba(247, 144, 9, 0.1) 0%, rgba(255, 255, 255, 0.00) 100%)"},className:"mt-2 flex h-10 items-center gap-2 rounded-xl border border-components-panel-border px-3 text-xs shadow-xs backdrop-blur-[5px]",children:[(0,t.jsx)(a.RiAlertFill,{className:"size-4 text-text-warning-secondary"}),(0,t.jsx)("span",{className:"system-xs-medium text-text-primary",children:q("stepTwo.QATip",{ns:"datasetCreation"})})]})]})]})]})]})})}],274007)},962459,127210,49416,162939,559514,167041,212042,707857,e=>{"use strict";e.s(["IndexingModeSection",()=>z],962459);var t,a=e.i(563199),s=e.i(658547),n=e.i(554327);e.i(152567);var i=e.i(408767),r=e.i(83278),l=e.i(151094),d=e.i(212452),o=e.i(757198);e.i(793622);var c=e.i(259509),m=e.i(421001),u=e.i(194655),x=e.i(404853),h=e.i(117960),p=e.i(683257),g=e.i(621379),_=e.i(935139),f=e.i(871182);e.s([],212042),e.s(["useDocumentCreation",()=>Z],162939);var v=e.i(268255);e.i(201987);var b=e.i(207331),C=e.i(137667),y=e.i(130990),j=e.i(11512),k=e.i(451028),w=e.i(225244);e.s(["IndexingType",()=>S,"useIndexingConfig",()=>D],127210);var N=e.i(616629),T=e.i(739255),M=e.i(225162),E=e.i(648404),S=((t={}).QUALIFIED="high_quality",t.ECONOMICAL="economy",t);let I={search_method:E.RETRIEVE_METHOD.semantic,reranking_enable:!1,reranking_model:{reranking_provider_name:"",reranking_model_name:""},top_k:3,score_threshold_enabled:!1,score_threshold:.5},D=e=>{let{initialIndexType:t,initialEmbeddingModel:a,initialRetrievalConfig:s,isAPIKeySet:n,hasSetIndexType:i}=e,{modelList:r,defaultModel:l,currentModel:d}=(0,M.useModelListAndDefaultModelAndCurrentProviderAndModel)(T.ModelTypeEnum.rerank),{data:o}=(0,M.useModelList)(T.ModelTypeEnum.textEmbedding),{data:c}=(0,M.useDefaultModel)(T.ModelTypeEnum.textEmbedding),[m,u]=(0,v.useState)(()=>t||(n?"high_quality":"economy")),[x,h]=(0,v.useState)(a??{provider:c?.provider.provider||"",model:c?.model||""}),[p,g]=(0,v.useState)(s??I);(0,v.useEffect)(()=>{s||g({search_method:E.RETRIEVE_METHOD.semantic,reranking_enable:!!d,reranking_model:{reranking_provider_name:d?l?.provider.provider??"":"",reranking_model_name:d?l?.model??"":""},top_k:3,score_threshold_enabled:!1,score_threshold:.5})},[l,d,s]),(0,v.useEffect)(()=>{t?u(t):u(n?"high_quality":"economy")},[n,t]);let _=(0,v.useMemo)(()=>(0,N.checkShowMultiModalTip)({embeddingModel:x,rerankingEnable:p.reranking_enable,rerankModel:{rerankingProviderName:p.reranking_model.reranking_provider_name,rerankingModelName:p.reranking_model.reranking_model_name},indexMethod:m,embeddingModelList:o,rerankModelList:r}),[x,p,m,o,r]);return{indexType:m,setIndexType:u,hasSetIndexType:i,getIndexingTechnique:()=>t||m,embeddingModel:x,setEmbeddingModel:h,embeddingModelList:o,defaultEmbeddingModel:c,retrievalConfig:p,setRetrievalConfig:g,rerankModelList:r,rerankDefaultModel:l,isRerankDefaultModelValid:d,showMultiModalTip:_}},R=function(e){return e&&"string"==typeof e?e.replaceAll("\0","\\0").replaceAll("\b","\\b").replaceAll("\f","\\f").replaceAll("\n","\\n").replaceAll("\r","\\r").replaceAll("	","\\t").replaceAll("\v","\\v").replaceAll("'","\\'"):""},H=/\\(u\{([0-9A-Fa-f]+)\}|u([0-9A-Fa-f]{4})|x([0-9A-Fa-f]{2})|([1-7][0-7]{0,2}|[0-7]{2,3})|(['"tbrnfv0\\]))|\\U([0-9A-Fa-f]{8})/g,L={0:"\0",b:"\b",f:"\f",n:"\n",r:"\r",t:"	",v:"\v","'":"'",'"':'"',"\\":"\\"},F=e=>String.fromCodePoint(Number.parseInt(e,16)),W=e=>e.replace(H,(e,t,a,s,n,i,r,l)=>{if(void 0!==a)return F(a);if(void 0!==s)return F(s);if(void 0!==n)return F(n);if(void 0!==i)return String.fromCodePoint(Number.parseInt(i,8));if(void 0!==l)return F(l);else return L[r]}),A="\\n\\n",O=Number.parseInt(globalThis.document?.body?.getAttribute("data-public-indexing-max-segmentation-tokens-length")||"4000",10),P={chunkForContext:"paragraph",parent:{delimiter:"\\n\\n",maxLength:1024},child:{delimiter:"\\n",maxLength:512}};e.s(["MAXIMUM_CHUNK_TOKEN_LENGTH",0,O,"useSegmentationState",0,function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{initialSegmentationType:t,initialSummaryIndexSetting:a}=e,[s,n]=(0,v.useState)(t??g.ProcessMode.general),[i,r]=(0,v.useState)(A),[l,d]=(0,v.useState)(1024),[o,c]=(0,v.useState)(O),[m,u]=(0,v.useState)(50),[x,h]=(0,v.useState)([]),[p,_]=(0,v.useState)(),[f,b]=(0,v.useState)(a),C=(0,v.useRef)(a),y=(0,v.useCallback)(e=>{b(t=>{let a={...t,...e};return C.current=a,a})},[]),[j,k]=(0,v.useState)(P),w=(0,v.useCallback)((e,t)=>{e?r(R(e)):r(t?"":A)},[]),N=(0,v.useCallback)(e=>{h(t=>t.map(t=>t.id===e?{...t,enabled:!t.enabled}:t))},[]),T=(0,v.useCallback)(()=>{p&&(w(p.segmentation.separator),d(p.segmentation.max_tokens),u(p.segmentation.chunk_overlap),h(p.pre_processing_rules)),k(P)},[p,w]),M=(0,v.useCallback)((e,t)=>{let a=e.segmentation.separator,s=e.segmentation.max_tokens,n=e.segmentation.chunk_overlap;w(a),d(s),u(n),h(e.pre_processing_rules),_(e),t&&k({chunkForContext:e.parent_mode||"paragraph",parent:{delimiter:R(e.segmentation.separator),maxLength:e.segmentation.max_tokens},child:{delimiter:R(e.subchunk_segmentation.separator),maxLength:e.subchunk_segmentation.max_tokens}})},[w]),E=(0,v.useCallback)(e=>e===g.ChunkingMode.parentChild?{rules:{pre_processing_rules:x,segmentation:{separator:W(j.parent.delimiter),max_tokens:j.parent.maxLength},parent_mode:j.chunkForContext,subchunk_segmentation:{separator:W(j.child.delimiter),max_tokens:j.child.maxLength}},mode:"hierarchical",summary_index_setting:C.current}:{rules:{pre_processing_rules:x,segmentation:{separator:W(i),max_tokens:l,chunk_overlap:m}},mode:s,summary_index_setting:C.current},[x,j,i,l,m,s]),S=(0,v.useCallback)((e,t)=>{k(a=>{let s;return s="delimiter"===e?t?R(t):"":t,{...a,parent:{...a.parent,[e]:s}}})},[]),I=(0,v.useCallback)((e,t)=>{k(a=>{let s;return s="delimiter"===e?t?R(t):"":t,{...a,child:{...a.child,[e]:s}}})},[]),D=(0,v.useCallback)(e=>{k(t=>({...t,chunkForContext:e}))},[]);return{segmentationType:s,setSegmentationType:n,segmentIdentifier:i,setSegmentIdentifier:w,maxChunkLength:l,setMaxChunkLength:d,limitMaxChunkLength:o,setLimitMaxChunkLength:c,overlap:m,setOverlap:u,rules:x,setRules:h,defaultConfig:p,setDefaultConfig:_,toggleRule:N,summaryIndexSetting:f,handleSummaryIndexSettingChange:y,parentChildConfig:j,setParentChildConfig:k,updateParentConfig:S,updateChildConfig:I,setChunkForContext:D,resetToDefaults:T,applyConfigFromRules:M,getProcessRule:E}}],49416);let Z=e=>{let{t}=(0,i.useTranslation)(),{datasetId:a,isSetting:s,documentDetail:n,dataSourceType:r,files:l,notionPages:d,notionCredentialId:o,websitePages:c,crawlOptions:m,websiteCrawlProvider:u=j.DataSourceProvider.jinaReader,websiteCrawlJobId:x="",onStepChange:h,updateIndexingTypeCache:p,updateResultCache:_,updateRetrievalMethodCache:f,onSave:N,mutateDatasetRes:T}=e,M=(0,k.useCreateFirstDocument)(),E=(0,k.useCreateDocument)(a),I=(0,w.useInvalidDatasetList)(),D=M.isPending||E.isPending,R=(0,v.useCallback)(e=>{let{segmentationType:a,maxChunkLength:n,limitMaxChunkLength:i,overlap:r,indexType:l,embeddingModel:d,rerankModelList:o,retrievalConfig:c}=e;if("general"===a&&r>n)return C.default.notify({type:"error",message:t("stepTwo.overlapCheck",{ns:"datasetCreation"})}),!1;if("general"===a&&n>i)return C.default.notify({type:"error",message:t("stepTwo.maxLengthCheck",{ns:"datasetCreation",limit:i})}),!1;if(!s){if(l===S.QUALIFIED&&(!d.model||!d.provider))return C.default.notify({type:"error",message:t("datasetConfig.embeddingModelRequired",{ns:"appDebug"})}),!1;if(!(0,y.isReRankModelSelected)({rerankModelList:o,retrievalConfig:c,indexMethod:l}))return C.default.notify({type:"error",message:t("datasetConfig.rerankModelRequired",{ns:"appDebug"})}),!1}return!0},[t,s]),H=(0,v.useCallback)((e,t,a,i,h,p,_)=>{if(s)return{original_document_id:n?.id,doc_form:e,doc_language:t,process_rule:a,summary_index_setting:_,retrieval_model:i,embedding_model:h.model,embedding_model_provider:h.provider,indexing_technique:p};let f={data_source:{type:r,info_list:{data_source_type:r}},indexing_technique:p,process_rule:a,summary_index_setting:_,doc_form:e,doc_language:t,retrieval_model:i,embedding_model:h.model,embedding_model_provider:h.provider};return r===g.DataSourceType.FILE&&(f.data_source.info_list.file_info_list={file_ids:l.map(e=>e.id||"").filter(Boolean)}),r===g.DataSourceType.NOTION&&(f.data_source.info_list.notion_info_list=(0,k.getNotionInfo)(d,o)),r===g.DataSourceType.WEB&&(f.data_source.info_list.website_info_list=(0,k.getWebsiteInfo)({websiteCrawlProvider:u,websiteCrawlJobId:x,websitePages:c,crawlOptions:m})),f},[s,n,r,l,d,o,c,u,x,m]);return{isCreating:D,validateParams:R,buildCreationParams:H,executeCreation:(0,v.useCallback)(async(e,t,n)=>{a?await E.mutateAsync(e,{onSuccess(e){p?.(t),_?.(e),f?.(n.search_method)}}):await M.mutateAsync(e,{onSuccess(e){p?.(t),_?.(e),f?.(n.search_method)}}),T?.(),I(),(0,b.trackEvent)("create_datasets",{data_source_type:r,indexing_technique:t}),h?.(1),s&&N?.()},[a,M,E,p,_,f,T,I,r,h,s,N]),validatePreviewParams:(0,v.useCallback)(e=>!(e>O)||(C.default.notify({type:"error",message:t("stepTwo.maxLengthCheck",{ns:"datasetCreation",limit:O})}),!1),[t])}};e.s(["useIndexingEstimate",0,e=>{let{dataSourceType:t,datasetId:a,currentDocForm:s,docLanguage:n,files:i,previewFileName:r,previewNotionPage:l,notionCredentialId:d,previewWebsitePage:o,crawlOptions:c,websiteCrawlProvider:m,websiteCrawlJobId:u,indexingTechnique:x,processRule:h}=e,p=(0,k.useFetchFileIndexingEstimateForFile)({docForm:s,docLanguage:n,dataSourceType:g.DataSourceType.FILE,files:r?[i.find(e=>e.name===r)]:i,indexingTechnique:x,processRule:h,dataset_id:a}),_=(0,k.useFetchFileIndexingEstimateForNotion)({docForm:s,docLanguage:n,dataSourceType:g.DataSourceType.NOTION,notionPages:[l],indexingTechnique:x,processRule:h,dataset_id:a||"",credential_id:d}),f=(0,k.useFetchFileIndexingEstimateForWeb)({docForm:s,docLanguage:n,dataSourceType:g.DataSourceType.WEB,websitePages:[o],crawlOptions:c,websiteCrawlProvider:m??j.DataSourceProvider.jinaReader,websiteCrawlJobId:u??"",indexingTechnique:x,processRule:h,dataset_id:a||""}),b=(0,v.useCallback)(()=>t===g.DataSourceType.FILE?p:t===g.DataSourceType.NOTION?_:f,[t,p,_,f])(),C=(0,v.useCallback)(()=>{t===g.DataSourceType.FILE?p.mutate():t===g.DataSourceType.NOTION?_.mutate():f.mutate()},[t,p,_,f]);return{currentMutation:b,estimate:b.data,isIdle:b.isIdle,isPending:b.isPending,fetchEstimate:C,reset:b.reset}}],559514),e.s(["usePreviewState",0,e=>{let{dataSourceType:t,files:a,notionPages:s,websitePages:n,documentDetail:i,datasetId:r}=e,[l,d]=(0,v.useState)(r&&i?i.file:a[0]),[o,c]=(0,v.useState)(r&&i?i.notion_page:s[0]),[m,u]=(0,v.useState)(r&&i?i.website_page:n[0]),x=(0,v.useCallback)(()=>t===g.DataSourceType.FILE?a:t===g.DataSourceType.NOTION?s.map(e=>({id:e.page_id,name:e.page_name,extension:"md"})):t===g.DataSourceType.WEB?n.map(e=>({id:e.source_url,name:e.title,extension:"md"})):[],[t,a,s,n]),h=(0,v.useCallback)(()=>t===g.DataSourceType.FILE?l:t===g.DataSourceType.NOTION?{id:o?.page_id||"",name:o?.page_name||"",extension:"md"}:t===g.DataSourceType.WEB?{id:m?.source_url||"",name:m?.title||"",extension:"md"}:{id:"",name:"",extension:""},[t,l,o,m]),p=(0,v.useCallback)(e=>{if(t===g.DataSourceType.FILE)d(e);else if(t===g.DataSourceType.NOTION){let t=s.find(t=>t.page_id===e.id);t&&c(t)}else if(t===g.DataSourceType.WEB){let t=n.find(t=>t.source_url===e.id);t&&u(t)}},[t,s,n]);return{previewFile:l,setPreviewFile:d,previewNotionPage:o,setPreviewNotionPage:c,previewWebsitePage:m,setPreviewWebsitePage:u,getPreviewPickerItems:x,getPreviewPickerValue:h,handlePreviewChange:p}}],167041);var q=e.i(249432),V=e.i(789178);let z=e=>{let{indexType:t,hasSetIndexType:v,docForm:b,embeddingModel:C,embeddingModelList:y,retrievalConfig:j,showMultiModalTip:k,isModelAndRetrievalConfigDisabled:w,datasetId:N,isQAConfirmDialogOpen:T,onIndexTypeChange:M,onEmbeddingModelChange:E,onRetrievalConfigChange:I,onQAConfirmDialogClose:D,onQAConfirmDialogConfirm:R}=e,{t:H}=(0,i.useTranslation)(),L=(0,p.useDocLink)();return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"system-md-semibold mb-1 text-text-secondary",children:H("stepTwo.indexMode",{ns:"datasetCreation"})}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(!v||v&&t===S.QUALIFIED)&&(0,a.jsx)(V.OptionCard,{className:"flex-1 self-stretch",title:(0,a.jsxs)("div",{className:"flex items-center",children:[H("stepTwo.qualified",{ns:"datasetCreation"}),(0,a.jsx)(r.default,{className:(0,_.cn)("ml-1 h-[18px]",v||t!==S.QUALIFIED?"":"border-text-accent-secondary text-text-accent-secondary"),uppercase:!0,children:H("stepTwo.recommend",{ns:"datasetCreation"})}),(0,a.jsx)("span",{className:"ml-auto",children:!v&&(0,a.jsx)("span",{className:(0,_.cn)(q.default.radio)})})]}),description:H("stepTwo.qualifiedTip",{ns:"datasetCreation"}),icon:(0,a.jsx)(s.default,{src:f.indexMethodIcon.high_quality,alt:""}),isActive:!v&&t===S.QUALIFIED,disabled:v,onSwitched:()=>M(S.QUALIFIED)}),(!v||v&&t===S.ECONOMICAL)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(d.default,{show:T,onClose:D,className:"w-[432px]",children:[(0,a.jsxs)("header",{className:"mb-4 pt-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-text-primary",children:H("stepTwo.qaSwitchHighQualityTipTitle",{ns:"datasetCreation"})}),(0,a.jsx)("p",{className:"mt-2 text-sm font-normal text-text-secondary",children:H("stepTwo.qaSwitchHighQualityTipContent",{ns:"datasetCreation"})})]}),(0,a.jsxs)("div",{className:"flex gap-2 pb-6",children:[(0,a.jsx)(l.default,{className:"ml-auto",onClick:D,children:H("stepTwo.cancel",{ns:"datasetCreation"})}),(0,a.jsx)(l.default,{variant:"primary",onClick:R,children:H("stepTwo.switch",{ns:"datasetCreation"})})]})]}),(0,a.jsx)(m.default,{popupContent:(0,a.jsx)("div",{className:"rounded-lg border-components-panel-border bg-components-tooltip-bg p-3 text-xs font-medium text-text-secondary shadow-lg",children:H(b===g.ChunkingMode.qa?"stepTwo.notAvailableForQA":"stepTwo.notAvailableForParentChild",{ns:"datasetCreation"})}),noDecoration:!0,position:"top",asChild:!1,triggerClassName:"flex-1 self-stretch",children:(0,a.jsx)(V.OptionCard,{className:"h-full",title:H("stepTwo.economical",{ns:"datasetCreation"}),description:H("stepTwo.economicalTip",{ns:"datasetCreation"}),icon:(0,a.jsx)(s.default,{src:f.indexMethodIcon.economical,alt:""}),isActive:!v&&t===S.ECONOMICAL,disabled:v||b!==g.ChunkingMode.text,onSwitched:()=>M(S.ECONOMICAL)})})]})]}),!v&&t===S.QUALIFIED&&(0,a.jsxs)("div",{className:"mt-2 flex h-10 items-center gap-x-0.5 overflow-hidden rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur p-2 shadow-xs backdrop-blur-[5px]",children:[(0,a.jsx)("div",{className:"absolute bottom-0 left-0 right-0 top-0 bg-dataset-warning-message-bg opacity-40"}),(0,a.jsx)("div",{className:"p-1",children:(0,a.jsx)(c.AlertTriangle,{className:"size-4 text-text-warning-secondary"})}),(0,a.jsx)("span",{className:"system-xs-medium text-text-primary",children:H("stepTwo.highQualityTip",{ns:"datasetCreation"})})]}),v&&t===S.ECONOMICAL&&(0,a.jsxs)("div",{className:"system-xs-medium mt-2 text-text-tertiary",children:[H("stepTwo.indexSettingTip",{ns:"datasetCreation"}),(0,a.jsx)(n.default,{className:"text-text-accent",href:`/datasets/${N}/settings`,children:H("stepTwo.datasetSettingLink",{ns:"datasetCreation"})})]}),t===S.QUALIFIED&&(0,a.jsxs)("div",{className:"mt-5",children:[(0,a.jsx)("div",{className:(0,_.cn)("system-md-semibold mb-1 text-text-secondary",N&&"flex items-center justify-between"),children:H("form.embeddingModel",{ns:"datasetSettings"})}),(0,a.jsx)(h.default,{readonly:w,triggerClassName:w?"opacity-50":"",defaultModel:C,modelList:y??[],onSelect:E}),w&&(0,a.jsxs)("div",{className:"system-xs-medium mt-2 text-text-tertiary",children:[H("stepTwo.indexSettingTip",{ns:"datasetCreation"}),(0,a.jsx)(n.default,{className:"text-text-accent",href:`/datasets/${N}/settings`,children:H("stepTwo.datasetSettingLink",{ns:"datasetCreation"})})]})]}),(0,a.jsx)(o.default,{className:"my-5"}),(0,a.jsxs)("div",{children:[w?(0,a.jsx)("div",{className:(0,_.cn)("system-md-semibold mb-0.5 text-text-secondary","flex items-center justify-between"),children:(0,a.jsx)("div",{children:H("form.retrievalSetting.title",{ns:"datasetSettings"})})}):(0,a.jsxs)("div",{className:"mb-1",children:[(0,a.jsx)("div",{className:"system-md-semibold mb-0.5 text-text-secondary",children:H("form.retrievalSetting.title",{ns:"datasetSettings"})}),(0,a.jsxs)("div",{className:"body-xs-regular text-text-tertiary",children:[(0,a.jsx)("a",{target:"_blank",rel:"noopener noreferrer",href:L("/use-dify/knowledge/create-knowledge/setting-indexing-methods"),className:"text-text-accent",children:H("form.retrievalSetting.learnMore",{ns:"datasetSettings"})}),H("form.retrievalSetting.longDescription",{ns:"datasetSettings"})]})]}),(0,a.jsx)("div",{children:t===S.QUALIFIED?(0,a.jsx)(x.default,{disabled:w,value:j,onChange:I,showMultiModalTip:k}):(0,a.jsx)(u.default,{disabled:w,value:j,onChange:I})})]})]})};var U=e.i(837699),Q=e.i(324935);e.i(9633);var G=e.i(684040),B=e.i(958948),$=e.i(890644);let K={src:e.i(729301).default,width:20,height:20,blurWidth:0,blurHeight:0},X={src:e.i(755693).default,width:20,height:20,blurWidth:0,blurHeight:0},J={src:e.i(256168).default,width:220,height:220,blurWidth:0,blurHeight:0};var Y=e.i(471405);let ee=e=>{let{children:t}=e;return(0,a.jsx)("label",{className:"system-sm-semibold text-text-secondary",children:t})};e.s(["ParentChildOptions",0,e=>{let{parentChildConfig:t,rules:n,summaryIndexSetting:r,currentDocForm:d,isActive:c,isInUpload:m,isNotUploadInEmptyDataset:u,onDocFormChange:x,onChunkForContextChange:h,onParentDelimiterChange:p,onParentMaxLengthChange:_,onChildDelimiterChange:f,onChildMaxLengthChange:v,onRuleToggle:b,onSummaryIndexSettingChange:C,onPreview:y,onReset:j,showSummaryIndexSetting:k}=e,{t:w}=(0,i.useTranslation)();return(0,a.jsx)(V.OptionCard,{title:w("stepTwo.parentChild",{ns:"datasetCreation"}),icon:(0,a.jsx)(G.ParentChildChunk,{className:"h-[20px] w-[20px]"}),effectImg:J.src,className:"text-util-colors-blue-light-blue-light-500",activeHeaderClassName:"bg-dataset-option-card-blue-gradient",description:w("stepTwo.parentChildTip",{ns:"datasetCreation"}),isActive:c,onSwitched:()=>x(g.ChunkingMode.parentChild),actions:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(l.default,{variant:"secondary-accent",onClick:y,children:[(0,a.jsx)(U.RiSearchEyeLine,{className:"mr-0.5 h-4 w-4"}),w("stepTwo.previewChunk",{ns:"datasetCreation"})]}),(0,a.jsx)(l.default,{variant:"ghost",onClick:j,children:w("stepTwo.reset",{ns:"datasetCreation"})})]}),noHighlight:m&&u,children:(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,a.jsx)("div",{className:"inline-flex shrink-0",children:(0,a.jsx)(ee,{children:w("stepTwo.parentChunkForContext",{ns:"datasetCreation"})})}),(0,a.jsx)(o.default,{className:"grow",bgStyle:"gradient"})]}),(0,a.jsx)(B.default,{className:"mt-1",icon:(0,a.jsx)(s.default,{src:X,alt:""}),title:w("stepTwo.paragraph",{ns:"datasetCreation"}),description:w("stepTwo.paragraphTip",{ns:"datasetCreation"}),isChosen:"paragraph"===t.chunkForContext,onChosen:()=>h("paragraph"),chosenConfig:(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(Y.DelimiterInput,{value:t.parent.delimiter,tooltip:w("stepTwo.parentChildDelimiterTip",{ns:"datasetCreation"}),onChange:e=>p(e.target.value)}),(0,a.jsx)(Y.MaxLengthInput,{unit:"characters",value:t.parent.maxLength,onChange:_})]})}),(0,a.jsx)(B.default,{className:"mt-2",icon:(0,a.jsx)(s.default,{src:K,alt:""}),title:w("stepTwo.fullDoc",{ns:"datasetCreation"}),description:w("stepTwo.fullDocTip",{ns:"datasetCreation"}),onChosen:()=>h("full-doc"),isChosen:"full-doc"===t.chunkForContext})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,a.jsx)("div",{className:"inline-flex shrink-0",children:(0,a.jsx)(ee,{children:w("stepTwo.childChunkForRetrieval",{ns:"datasetCreation"})})}),(0,a.jsx)(o.default,{className:"grow",bgStyle:"gradient"})]}),(0,a.jsxs)("div",{className:"mt-1 flex gap-3",children:[(0,a.jsx)(Y.DelimiterInput,{value:t.child.delimiter,tooltip:w("stepTwo.parentChildChunkDelimiterTip",{ns:"datasetCreation"}),onChange:e=>f(e.target.value)}),(0,a.jsx)(Y.MaxLengthInput,{unit:"characters",value:t.child.maxLength,onChange:v})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,a.jsx)("div",{className:"inline-flex shrink-0",children:(0,a.jsx)(ee,{children:w("stepTwo.rules",{ns:"datasetCreation"})})}),(0,a.jsx)(o.default,{className:"grow",bgStyle:"gradient"})]}),(0,a.jsxs)("div",{className:"mt-1",children:[n.map(e=>{var t;return(0,a.jsxs)("div",{className:q.default.ruleItem,onClick:()=>b(e.id),children:[(0,a.jsx)(Q.default,{checked:e.enabled}),(0,a.jsx)("label",{className:"system-sm-regular ml-2 cursor-pointer text-text-secondary",children:(t=e.id,({remove_extra_spaces:w("stepTwo.removeExtraSpaces",{ns:"datasetCreation"}),remove_urls_emails:w("stepTwo.removeUrlEmails",{ns:"datasetCreation"}),remove_stopwords:w("stepTwo.removeStopwords",{ns:"datasetCreation"})})[t]??t)})]},e.id)}),k&&(0,a.jsx)("div",{className:"mt-3",children:(0,a.jsx)($.default,{entry:"create-document",summaryIndexSetting:r,onSummaryIndexSettingChange:C})})]})]})]})})}],707857)},698628,347056,470046,648203,843569,312178,422077,668701,140655,895650,471371,65904,681277,e=>{"use strict";e.s(["default",()=>en],698628);var t=e.i(563199),a=e.i(268255);e.i(152567);var s=e.i(408767),n=e.i(757198),i=e.i(137667),r=e.i(413159),l=e.i(683257),d=e.i(271743),o=e.i(491234),c=e.i(11512),m=e.i(621379),u=e.i(451028),x=e.i(935139),h=e.i(274007),p=e.i(962459),g=e.i(707857),_=e.i(837699),f=e.i(124836),v=e.i(83278),b=e.i(423571),C=e.i(465497),y=e.i(925521),j=e.i(807324);e.i(868084);var k=e.i(942174);let w=e=>{let{ref:a,...s}=e;return(0,t.jsx)(j.default,{...s,ref:a,data:k.default})};w.displayName="OptionCardEffectBlue",e.s(["default",0,w],347056);var N=e.i(710799);let T=e=>{let{ref:a,...s}=e;return(0,t.jsx)(j.default,{...s,ref:a,data:N.default})};T.displayName="OptionCardEffectBlueLight",e.s(["default",0,T],470046);var M=e.i(649280);let E=e=>{let{ref:a,...s}=e;return(0,t.jsx)(j.default,{...s,ref:a,data:M.default})};E.displayName="OptionCardEffectOrange",e.s(["default",0,E],648203);var S=e.i(101411);let I=e=>{let{ref:a,...s}=e;return(0,t.jsx)(j.default,{...s,ref:a,data:S.default})};I.displayName="OptionCardEffectPurple",e.s(["default",0,I],843569);var D=e.i(963786);let R=e=>{let{ref:a,...s}=e;return(0,t.jsx)(j.default,{...s,ref:a,data:D.default})};R.displayName="OptionCardEffectTeal",e.s(["default",0,R],312178);var H=e.i(857305);let L=e=>{let{ref:a,...s}=e;return(0,t.jsx)(j.default,{...s,ref:a,data:H.default})};L.displayName="SelectionMod",e.i(365036),e.s([],422077);let F=e=>{let{label:a,characterCount:s}=e;return(0,t.jsxs)("div",{className:"flex items-center text-xs font-medium text-text-tertiary",children:[(0,t.jsx)(L,{className:"size-[10px]"}),(0,t.jsxs)("p",{className:"ml-0.5 flex gap-2",children:[(0,t.jsx)("span",{children:a}),(0,t.jsx)("span",{children:"Â·"}),(0,t.jsx)("span",{children:`${s} characters`})]})]})},W=e=>{let{label:a,characterCount:s,children:n}=e;return(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(F,{label:a,characterCount:s}),(0,t.jsx)("div",{className:"body-md-regular text-text-secondary",children:n})]})},A=e=>{let{qa:a}=e;return(0,t.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,t.jsxs)("div",{className:"flex gap-x-1",children:[(0,t.jsx)("label",{className:"shrink-0 text-[13px] font-medium leading-[20px] text-text-tertiary",children:"Q"}),(0,t.jsx)("p",{className:"body-md-regular text-text-secondary",children:a.question})]}),(0,t.jsxs)("div",{className:"flex gap-x-1",children:[(0,t.jsx)("label",{className:"shrink-0 text-[13px] font-medium leading-[20px] text-text-tertiary",children:"A"}),(0,t.jsx)("p",{className:"body-md-regular text-text-secondary",children:a.answer})]})]})};e.s(["ChunkContainer",0,W,"QAPreview",0,A],668701);var O=e.i(417944),P=e.i(449980),Z=e.i(391185),q=e.i(943963);let V=a.memo(e=>{let{className:s,list:n,onChange:i}=e,r=(0,a.useCallback)(e=>()=>i(e),[i]);return(0,t.jsx)("div",{className:(0,x.cn)("max-h-[calc(100vh-120px)] overflow-auto",s),children:n.map(e=>{let{id:a,name:s,extension:n}=e;return(0,t.jsxs)("div",{className:"flex h-8 cursor-pointer items-center space-x-2 rounded-lg px-2 hover:bg-state-base-hover",onClick:r(e),children:[(0,t.jsx)(q.default,{name:e.name,extension:n,size:"lg"}),(0,t.jsx)("div",{className:"truncate text-sm text-text-secondary",children:s})]},a)})})});e.s(["default",0,V],140655);let z=a.memo(e=>{let{className:n,value:i,files:r,onChange:l}=e,{t:d}=(0,s.useTranslation)(),o=i?.name||"",c=i?.extension,[m,{set:u,toggle:h}]=(0,O.useBoolean)(!1),p=_.RiArrowDownSLine,g=(0,a.useCallback)(e=>{l(e),u(!1)},[l,u]);return(0,t.jsxs)(Z.PortalToFollowElem,{open:m,onOpenChange:u,placement:"bottom-start",offset:4,children:[(0,t.jsx)(Z.PortalToFollowElemTrigger,{onClick:h,children:(0,t.jsxs)("div",{className:(0,x.cn)("flex h-6 select-none items-center rounded-md px-1 hover:bg-state-base-hover",m&&"bg-state-base-hover",n),children:[(0,t.jsx)(q.default,{name:o,extension:c,size:"lg"}),(0,t.jsx)("div",{className:"ml-1 flex flex-col items-start",children:(0,t.jsxs)("div",{className:"flex items-center space-x-0.5",children:[(0,t.jsxs)("span",{className:(0,x.cn)("system-md-semibold max-w-[200px] truncate text-text-primary"),children:[" ",o||"--"]}),(0,t.jsx)(p,{className:"h-[18px] w-[18px] text-text-primary"})]})})]})}),(0,t.jsx)(Z.PortalToFollowElemContent,{className:"z-[11]",children:(0,t.jsxs)("div",{className:"w-[392px] rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur p-1 shadow-lg backdrop-blur-[5px]",children:[r?.length>1&&(0,t.jsx)("div",{className:"system-xs-medium-uppercase flex h-8 items-center pl-2 text-text-tertiary",children:d("preprocessDocument",{ns:"dataset",num:r.length})}),r?.length>0?(0,t.jsx)(V,{list:r,onChange:g}):(0,t.jsx)("div",{className:"mt-2 flex h-[100px] w-[360px] items-center justify-center",children:(0,t.jsx)(P.default,{})})]})})]})});e.s(["default",0,z],895650);var U=e.i(19348),Q=e.i(341797);let G=e=>{let{className:a,...s}=e;return(0,t.jsx)("p",{...s,className:(0,x.cn)("leading-7",a),children:e.children})};e.s(["FormattedText",0,G],471371);let B=e=>{let{children:a,className:s,header:n,mainClassName:i,ref:r,...l}=e;return(0,t.jsx)("div",{className:s,children:(0,t.jsxs)("div",{...l,ref:r,className:(0,x.cn)("flex h-full w-full flex-col rounded-tl-xl border-l-[0.5px] border-t-[0.5px] border-components-panel-border bg-background-default-lighter shadow-md shadow-shadow-shadow-5"),children:[(0,t.jsx)("header",{className:"border-b border-divider-subtle pb-3 pl-5 pr-4 pt-4",children:n}),(0,t.jsx)("main",{className:(0,x.cn)("w-full grow overflow-y-auto px-6 py-5",i),children:a})]})})};B.displayName="PreviewContainer",e.s(["default",0,B],65904);let $=e=>{let{title:a,className:s,children:n,...i}=e;return(0,t.jsxs)("div",{...i,className:(0,x.cn)(s),children:[(0,t.jsx)("div",{className:"system-2xs-semibold-uppercase mb-1 px-1 uppercase text-text-accent",children:a}),n]})};e.s(["PreviewHeader",0,$],681277);let K=e=>{let{isMobile:a,dataSourceType:n,currentDocForm:i,estimate:r,parentChildConfig:l,isSetting:d,pickerFiles:o,pickerValue:c,isIdle:u,isPending:h,onPickerChange:p}=e,{t:g}=(0,s.useTranslation)();return(0,t.jsx)(b.default,{isMobile:a,isOpen:!0,onClose:f.noop,footer:null,children:(0,t.jsxs)(B,{header:(0,t.jsx)($,{title:g("stepTwo.preview",{ns:"datasetCreation"}),children:(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(z,{files:o,onChange:p,value:d?o[0]:c}),i!==m.ChunkingMode.qa&&(0,t.jsx)(v.default,{text:g("stepTwo.previewChunkCount",{ns:"datasetCreation",count:r?.total_segments||0})})]})}),className:(0,x.cn)("relative flex h-full w-1/2 shrink-0 p-4 pr-0",a&&"w-full max-w-[524px]"),mainClassName:"space-y-6",children:[i===m.ChunkingMode.qa&&r?.qa_preview&&r.qa_preview.map((e,a)=>(0,t.jsx)(W,{label:`Chunk-${a+1}`,characterCount:e.question.length+e.answer.length,children:(0,t.jsx)(A,{qa:e})},e.question)),i===m.ChunkingMode.text&&r?.preview&&r.preview.map((e,a)=>(0,t.jsxs)(W,{label:`Chunk-${a+1}`,characterCount:e.content.length,children:[e.content,e.summary&&(0,t.jsx)(U.default,{summary:e.summary})]},e.content)),i===m.ChunkingMode.parentChild&&r?.preview&&r.preview.map((e,a)=>{let s="full-doc"===l.chunkForContext?e.child_chunks.slice(0,y.FULL_DOC_PREVIEW_LENGTH):e.child_chunks;return(0,t.jsxs)(W,{label:`Chunk-${a+1}`,characterCount:e.content.length,children:[(0,t.jsx)(G,{children:s.map((e,a)=>{let s=a+1;return(0,t.jsx)(Q.PreviewSlice,{label:`C-${s}`,text:e,tooltip:`Child-chunk-${s} \xb7 ${e.length} Characters`,labelInnerClassName:"text-[10px] font-semibold align-bottom leading-7",dividerClassName:"leading-7"},`C-${s}-${e}`)})}),e.summary&&(0,t.jsx)(U.default,{summary:e.summary})]},e.content)}),u&&(0,t.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center gap-3",children:[(0,t.jsx)(_.RiSearchEyeLine,{className:"size-10 text-text-empty-state-icon"}),(0,t.jsx)("p",{className:"text-sm text-text-tertiary",children:g("stepTwo.previewChunkTip",{ns:"datasetCreation"})})]})}),h&&(0,t.jsx)("div",{className:"space-y-6",children:Array.from({length:10},(e,a)=>(0,t.jsxs)(C.SkeletonContainer,{children:[(0,t.jsxs)(C.SkeletonRow,{children:[(0,t.jsx)(C.SkeletonRectangle,{className:"w-20"}),(0,t.jsx)(C.SkeletonPoint,{}),(0,t.jsx)(C.SkeletonRectangle,{className:"w-24"})]}),(0,t.jsx)(C.SkeletonRectangle,{className:"w-full"}),(0,t.jsx)(C.SkeletonRectangle,{className:"w-full"}),(0,t.jsx)(C.SkeletonRectangle,{className:"w-[422px]"})]},a))})]})})};var X=e.i(151094);let J=e=>{let{isSetting:a,isCreating:n,onPrevious:i,onCreate:r,onCancel:l}=e,{t:d}=(0,s.useTranslation)();return a?(0,t.jsxs)("div",{className:"mt-8 flex items-center py-2",children:[(0,t.jsx)(X.default,{loading:n,variant:"primary",onClick:r,children:d("stepTwo.save",{ns:"datasetCreation"})}),(0,t.jsx)(X.default,{className:"ml-2",onClick:l,children:d("stepTwo.cancel",{ns:"datasetCreation"})})]}):(0,t.jsxs)("div",{className:"mt-8 flex items-center py-2",children:[(0,t.jsxs)(X.default,{onClick:i,children:[(0,t.jsx)(_.RiArrowLeftLine,{className:"mr-1 h-4 w-4"}),d("stepTwo.previousStep",{ns:"datasetCreation"})]}),(0,t.jsx)(X.default,{className:"ml-auto",loading:n,variant:"primary",onClick:r,children:d("stepTwo.nextStep",{ns:"datasetCreation"})})]})};e.i(212042);var Y=e.i(127210),ee=e.i(49416),et=e.i(162939),ea=e.i(559514),es=e.i(167041);let en=e=>{let{isSetting:_,documentDetail:f,isAPIKeySet:v,datasetId:b,indexingType:C,dataSourceType:y,files:j,notionPages:k=[],notionCredentialId:w,websitePages:N=[],crawlOptions:T,websiteCrawlProvider:M=c.DataSourceProvider.jinaReader,websiteCrawlJobId:E="",onStepChange:S,updateIndexingTypeCache:I,updateResultCache:D,onSave:R,onCancel:H,updateRetrievalMethodCache:L}=e,{t:F}=(0,s.useTranslation)(),W=(0,l.useLocale)(),A=(0,d.default)()===d.MediaType.mobile,O=(0,r.useDatasetDetailContextWithSelector)(e=>e.dataset),P=(0,r.useDatasetDetailContextWithSelector)(e=>e.mutateDatasetRes),Z=!!O,q=Z&&!O?.doc_form,V=!q,z=!Z&&!_,U=b&&(!b||O?.data_source_type)?O?.data_source_type??y:y,Q=!!C,G=!!b&&!!O?.data_source_type,[B,$]=(0,a.useState)(b&&f?f.doc_form:m.ChunkingMode.text),[X,en]=(0,a.useState)(()=>b&&f?f.doc_language:W!==o.LanguagesSupported[1]?"English":"Chinese Simplified"),[ei,er]=(0,a.useState)(!1),el=O?.doc_form||B,ed=(0,ee.useSegmentationState)({initialSegmentationType:O?.doc_form===m.ChunkingMode.parentChild?m.ProcessMode.parentChild:m.ProcessMode.general,initialSummaryIndexSetting:O?.summary_index_setting}),eo=!O,ec=(0,Y.useIndexingConfig)({initialIndexType:C,initialEmbeddingModel:O?.embedding_model?{provider:O.embedding_model_provider,model:O.embedding_model}:void 0,initialRetrievalConfig:O?.retrieval_model_dict,isAPIKeySet:v,hasSetIndexType:Q}),em=(0,es.usePreviewState)({dataSourceType:U,files:j,notionPages:k,websitePages:N,documentDetail:f,datasetId:b}),eu=(0,et.useDocumentCreation)({datasetId:b,isSetting:_,documentDetail:f,dataSourceType:U,files:j,notionPages:k,notionCredentialId:w,websitePages:N,crawlOptions:T,websiteCrawlProvider:M,websiteCrawlJobId:E,onStepChange:S,updateIndexingTypeCache:I,updateResultCache:D,updateRetrievalMethodCache:L,onSave:R,mutateDatasetRes:P}),ex=(0,ea.useIndexingEstimate)({dataSourceType:U,datasetId:b,currentDocForm:el,docLanguage:X,files:j,previewFileName:em.previewFile?.name,previewNotionPage:em.previewNotionPage,notionCredentialId:w,previewWebsitePage:em.previewWebsitePage,crawlOptions:T,websiteCrawlProvider:M,websiteCrawlJobId:E,indexingTechnique:ec.getIndexingTechnique(),processRule:ed.getProcessRule(el)}),eh=(0,u.useFetchDefaultProcessRule)({onSuccess(e){ed.setSegmentIdentifier(e.rules.segmentation.separator),ed.setMaxChunkLength(e.rules.segmentation.max_tokens),ed.setOverlap(e.rules.segmentation.chunk_overlap),ed.setRules(e.rules.pre_processing_rules),ed.setDefaultConfig(e.rules),ed.setLimitMaxChunkLength(e.limits.indexing_max_segmentation_tokens_length)}}),ep=(0,a.useCallback)(e=>{e===m.ChunkingMode.qa&&ec.indexType===Y.IndexingType.ECONOMICAL?er(!0):(e===m.ChunkingMode.parentChild&&ec.indexType===Y.IndexingType.ECONOMICAL&&ec.setIndexType(Y.IndexingType.QUALIFIED),$(e),ed.setSegmentationType(e===m.ChunkingMode.parentChild?m.ProcessMode.parentChild:m.ProcessMode.general),ex.reset())},[ec,ed,ex]),eg=(0,a.useCallback)(()=>{ed.segmentationType===m.ProcessMode.general&&ed.maxChunkLength>ee.MAXIMUM_CHUNK_TOKEN_LENGTH?i.default.notify({type:"error",message:F("stepTwo.maxLengthCheck",{ns:"datasetCreation",limit:ee.MAXIMUM_CHUNK_TOKEN_LENGTH})}):ex.fetchEstimate()},[ed,F,ex]),e_=(0,a.useCallback)(async()=>{if(!eu.validateParams({segmentationType:ed.segmentationType,maxChunkLength:ed.maxChunkLength,limitMaxChunkLength:ed.limitMaxChunkLength,overlap:ed.overlap,indexType:ec.indexType,embeddingModel:ec.embeddingModel,rerankModelList:ec.rerankModelList,retrievalConfig:ec.retrievalConfig}))return;let e=eu.buildCreationParams(el,X,ed.getProcessRule(el),ec.retrievalConfig,ec.embeddingModel,ec.getIndexingTechnique(),ed.summaryIndexSetting);e&&await eu.executeCreation(e,ec.indexType,ec.retrievalConfig)},[eu,ed,ec,el,X]),ef=(0,a.useCallback)(e=>{ex.reset(),em.handlePreviewChange(e),ex.fetchEstimate()},[ex,em]),ev=(0,a.useCallback)(()=>{er(!1),ec.setIndexType(Y.IndexingType.QUALIFIED),$(m.ChunkingMode.qa)},[ec]);(0,a.useEffect)(()=>{if(_){if(f){let e=f.dataset_process_rule.rules,t=f.doc_form===m.ChunkingMode.parentChild||!!(e.parent_mode&&e.subchunk_segmentation);ed.applyConfigFromRules(e,t),ed.setSegmentationType(f.dataset_process_rule.mode)}}else eh.mutate("/datasets/process-rule")},[]);let eb=Z&&[m.ChunkingMode.text,m.ChunkingMode.qa].includes(O.doc_form)||q||z,eC=Z&&O.doc_form===m.ChunkingMode.parentChild||q||z;return(0,t.jsxs)("div",{className:"flex h-full w-full",children:[(0,t.jsxs)("div",{className:(0,x.cn)("relative h-full w-1/2 overflow-y-auto py-6",A?"px-4":"px-12"),children:[(0,t.jsx)("div",{className:"system-md-semibold mb-1 text-text-secondary",children:F("stepTwo.segmentation",{ns:"datasetCreation"})}),eb&&(0,t.jsx)(h.GeneralChunkingOptions,{segmentIdentifier:ed.segmentIdentifier,maxChunkLength:ed.maxChunkLength,overlap:ed.overlap,rules:ed.rules,currentDocForm:el,docLanguage:X,isActive:[m.ChunkingMode.text,m.ChunkingMode.qa].includes(el),isInUpload:Z,isNotUploadInEmptyDataset:V,hasCurrentDatasetDocForm:!!O?.doc_form,onSegmentIdentifierChange:e=>ed.setSegmentIdentifier(e,!0),onMaxChunkLengthChange:ed.setMaxChunkLength,onOverlapChange:ed.setOverlap,onRuleToggle:ed.toggleRule,onDocFormChange:ep,onDocLanguageChange:en,onPreview:eg,onReset:ed.resetToDefaults,locale:W,showSummaryIndexSetting:eo,summaryIndexSetting:ed.summaryIndexSetting,onSummaryIndexSettingChange:ed.handleSummaryIndexSettingChange}),eC&&(0,t.jsx)(g.ParentChildOptions,{parentChildConfig:ed.parentChildConfig,rules:ed.rules,currentDocForm:el,isActive:el===m.ChunkingMode.parentChild,isInUpload:Z,isNotUploadInEmptyDataset:V,onDocFormChange:ep,onChunkForContextChange:ed.setChunkForContext,onParentDelimiterChange:e=>ed.updateParentConfig("delimiter",e),onParentMaxLengthChange:e=>ed.updateParentConfig("maxLength",e),onChildDelimiterChange:e=>ed.updateChildConfig("delimiter",e),onChildMaxLengthChange:e=>ed.updateChildConfig("maxLength",e),onRuleToggle:ed.toggleRule,onPreview:eg,onReset:ed.resetToDefaults,showSummaryIndexSetting:eo,summaryIndexSetting:ed.summaryIndexSetting,onSummaryIndexSettingChange:ed.handleSummaryIndexSettingChange}),(0,t.jsx)(n.default,{className:"my-5"}),(0,t.jsx)(p.IndexingModeSection,{indexType:ec.indexType,hasSetIndexType:Q,docForm:B,embeddingModel:ec.embeddingModel,embeddingModelList:ec.embeddingModelList,retrievalConfig:ec.retrievalConfig,showMultiModalTip:ec.showMultiModalTip,isModelAndRetrievalConfigDisabled:G,datasetId:b,isQAConfirmDialogOpen:ei,onIndexTypeChange:ec.setIndexType,onEmbeddingModelChange:ec.setEmbeddingModel,onRetrievalConfigChange:ec.setRetrievalConfig,onQAConfirmDialogClose:()=>er(!1),onQAConfirmDialogConfirm:ev}),(0,t.jsx)(J,{isSetting:_,isCreating:eu.isCreating,onPrevious:()=>S?.(-1),onCreate:e_,onCancel:H})]}),(0,t.jsx)(K,{isMobile:A,dataSourceType:U,currentDocForm:el,estimate:ex.estimate,parentChildConfig:ed.parentChildConfig,isSetting:_,pickerFiles:em.getPreviewPickerItems(),pickerValue:em.getPreviewPickerValue(),isIdle:ex.isIdle,isPending:ex.isPending,onPickerChange:ef})]})}},616629,e=>{"use strict";e.s(["checkShowMultiModalTip",()=>s]);var t=e.i(739255);e.i(698628);var a=e.i(127210);let s=e=>{let{embeddingModel:s,rerankingEnable:n,rerankModel:i,indexMethod:r,embeddingModelList:l,rerankModelList:d}=e;if(r!==a.IndexingType.QUALIFIED||!s.provider||!s.model)return!1;let o=l.find(e=>e.provider===s.provider);if(!o)return!1;let c=o.models.find(e=>e.model===s.model);if(!c||!c.features?.includes(t.ModelFeatureEnum.vision))return!1;let{rerankingModelName:m,rerankingProviderName:u}=i;if(!n||!m||!u)return!1;let x=d.find(e=>e.provider===u);if(!x)return!1;let h=x.models.find(e=>e.model===m);return!!h&&!h.features?.includes(t.ModelFeatureEnum.vision)}}]);
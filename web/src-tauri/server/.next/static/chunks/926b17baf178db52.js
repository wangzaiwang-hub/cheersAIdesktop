(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,293792,e=>{"use strict";var t=e.i(563199);e.i(152567);var a=e.i(408767),s=e.i(151094),l=e.i(21151);e.s(["default",0,e=>{let{versions:n={importedVersion:"",systemVersion:""},onCancel:r,onConfirm:i,confirmDisabled:o=!1}=e,{t:d}=(0,a.useTranslation)();return(0,t.jsxs)(l.default,{isShow:!0,onClose:()=>r(),className:"w-[480px]",children:[(0,t.jsxs)("div",{className:"flex flex-col items-start gap-2 self-stretch pb-4",children:[(0,t.jsx)("div",{className:"title-2xl-semi-bold text-text-primary",children:d("newApp.appCreateDSLErrorTitle",{ns:"app"})}),(0,t.jsxs)("div",{className:"system-md-regular flex grow flex-col text-text-secondary",children:[(0,t.jsx)("div",{children:d("newApp.appCreateDSLErrorPart1",{ns:"app"})}),(0,t.jsx)("div",{children:d("newApp.appCreateDSLErrorPart2",{ns:"app"})}),(0,t.jsx)("br",{}),(0,t.jsxs)("div",{children:[d("newApp.appCreateDSLErrorPart3",{ns:"app"}),(0,t.jsx)("span",{className:"system-md-medium",children:n.importedVersion})]}),(0,t.jsxs)("div",{children:[d("newApp.appCreateDSLErrorPart4",{ns:"app"}),(0,t.jsx)("span",{className:"system-md-medium",children:n.systemVersion})]})]})]}),(0,t.jsxs)("div",{className:"flex items-start justify-end gap-2 self-stretch pt-6",children:[(0,t.jsx)(s.default,{variant:"secondary",onClick:()=>r(),children:d("newApp.Cancel",{ns:"app"})}),(0,t.jsx)(s.default,{variant:"primary",destructive:!0,onClick:i,disabled:o,children:d("newApp.Confirm",{ns:"app"})})]})]})}])},182368,e=>{"use strict";var t=e.i(326531),a=e.i(268255);e.i(152567);var s=e.i(408767),l=e.i(137667),n=e.i(967484),r=e.i(925521),i=e.i(711536),o=e.i(815488),d=e.i(972282),p=e.i(586871);e.s(["useImportDSL",0,()=>{let{t:e}=(0,s.useTranslation)(),{notify:c}=(0,l.useToastContext)(),[u,m]=(0,a.useState)(!1),{handleCheckPluginDependencies:f}=(0,n.usePluginDependencies)(),h=(0,i.useSelector)(e=>e.isCurrentWorkspaceEditor),{push:x}=(0,t.useRouter)(),[g,_]=(0,a.useState)(),b=(0,a.useRef)("");return{handleImportDSL:(0,a.useCallback)(async(t,a)=>{let{onSuccess:s,onPending:l,onFailed:n}=a;if(!u){m(!0);try{let a=await (0,d.importDSL)(t);if(!a)return;let{id:i,status:u,app_id:m,app_mode:g,imported_dsl_version:v,current_dsl_version:y}=a;if(u===o.DSLImportStatus.COMPLETED||u===o.DSLImportStatus.COMPLETED_WITH_WARNINGS){if(!m)return;c({type:u===o.DSLImportStatus.COMPLETED?"success":"warning",message:e(u===o.DSLImportStatus.COMPLETED?"newApp.appCreated":"newApp.caution",{ns:"app"}),children:u===o.DSLImportStatus.COMPLETED_WITH_WARNINGS&&e("newApp.appCreateDSLWarning",{ns:"app"})}),s?.(),localStorage.setItem(r.NEED_REFRESH_APP_LIST_KEY,"1"),await f(m),(0,p.getRedirection)(h,{id:m,mode:g},x)}else u===o.DSLImportStatus.PENDING?(_({importedVersion:v??"",systemVersion:y??""}),b.current=i,l?.(a)):(c({type:"error",message:e("newApp.appCreateFailed",{ns:"app"})}),n?.())}catch{c({type:"error",message:e("newApp.appCreateFailed",{ns:"app"})}),n?.()}finally{m(!1)}}},[e,c,f,h,x,u]),handleImportDSLConfirm:(0,a.useCallback)(async t=>{let{onSuccess:a,onFailed:s}=t;if(!u&&(m(!0),b.current))try{let{status:t,app_id:l,app_mode:n}=await (0,d.importDSLConfirm)({import_id:b.current});if(!l)return;t===o.DSLImportStatus.COMPLETED?(a?.(),c({type:"success",message:e("newApp.appCreated",{ns:"app"})}),await f(l),localStorage.setItem(r.NEED_REFRESH_APP_LIST_KEY,"1"),(0,p.getRedirection)(h,{id:l,mode:n},x)):t===o.DSLImportStatus.FAILED&&(c({type:"error",message:e("newApp.appCreateFailed",{ns:"app"})}),s?.())}catch{c({type:"error",message:e("newApp.appCreateFailed",{ns:"app"})}),s?.()}finally{m(!1)}},[e,c,f,h,x,u]),versions:g,isFetching:u}}])},787586,e=>{"use strict";var t,a,s=e.i(563199),l=e.i(837699),n=e.i(268255),r=e.i(449980),i=e.i(21151),o=e.i(494268),d=e.i(562572),p=e.i(10190);let c=e=>(0,d.useQuery)({queryKey:p.consoleQuery.trialApps.info.queryKey({input:{params:{appId:e}}}),queryFn:()=>p.consoleClient.trialApps.info({params:{appId:e}}),enabled:!!e}),u=e=>(0,d.useQuery)({queryKey:p.consoleQuery.trialApps.parameters.queryKey({input:{params:{appId:e}}}),queryFn:()=>p.consoleClient.trialApps.parameters({params:{appId:e}}),enabled:!!e}),m=(e,t)=>(0,d.useQuery)({queryKey:p.consoleQuery.trialApps.workflows.queryKey({input:{params:{appId:e}}}),enabled:!t,queryFn:()=>p.consoleClient.trialApps.workflows({params:{appId:e}}).then(e=>e)});var f=e.i(151094),h=e.i(261484),x=e.i(417944);e.i(152567);var g=e.i(408767),_=e.i(654313),b=e.i(294237),v=e.i(935139);let y=(0,b.cva)("",{variants:{type:{info:"from-components-badge-status-light-normal-halo to-background-gradient-mask-transparent"}}}),j=(0,n.memo)(e=>{let{type:t="info",message:a,onHide:n,className:r}=e;return(0,s.jsx)("div",{className:(0,v.cn)("pointer-events-none w-full",r),children:(0,s.jsxs)("div",{className:"relative flex space-x-1 overflow-hidden rounded-xl border border-components-panel-border bg-components-panel-bg-blur p-3 shadow-lg",children:[(0,s.jsx)("div",{className:(0,v.cn)("pointer-events-none absolute inset-0 bg-gradient-to-r  opacity-[0.4]",y({type:t}))}),(0,s.jsx)("div",{className:"flex h-6 w-6 items-center justify-center",children:(0,s.jsx)(l.RiInformation2Fill,{className:"text-text-accent"})}),(0,s.jsx)("div",{className:"p-1",children:(0,s.jsx)("div",{className:"system-xs-regular text-text-secondary",children:a})}),(0,s.jsx)("div",{className:"pointer-events-auto flex h-6 w-6 cursor-pointer items-center justify-center",onClick:n,children:(0,s.jsx)(l.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})})]})})});var w=e.i(257899),C=e.i(446880),N=e.i(12841);e.i(237855);var S=e.i(910605),T=e.i(291631),I=e.i(299951),A=e.i(873517),k=e.i(371784),E=e.i(481162),M=e.i(955371),P=e.i(390622),F=e.i(124836),L=e.i(339548),D=e.i(447301);let R=(0,L.createContext)({appData:null,appMeta:null,appParams:null,appChatListDataLoading:!1,currentConversationId:"",appPrevChatList:[],pinnedConversationList:[],conversationList:[],newConversationInputs:{},newConversationInputsRef:{current:{}},handleNewConversationInputsChange:F.noop,inputsForms:[],handleNewConversation:F.noop,handleStartChat:F.noop,handleChangeConversation:F.noop,handleNewConversationCompleted:F.noop,chatShouldReloadKey:"",isMobile:!1,appSourceType:D.AppSourceType.webApp,isInstalledApp:!1,allowResetChat:!0,handleFeedback:F.noop,currentChatInstanceRef:{current:{handleStop:F.noop}},clearChatList:!1,setClearChatList:F.noop,isResponding:!1,setIsResponding:F.noop,currentConversationInputs:{},setCurrentConversationInputs:F.noop,allInputsHidden:!1,initUserVariables:{}}),U=()=>(0,L.useContext)(R),q=(0,n.memo)(e=>{let{showTip:t}=e,{t:a}=(0,g.useTranslation)(),{appParams:l,inputsForms:r,currentConversationId:i,currentConversationInputs:o,setCurrentConversationInputs:d,newConversationInputs:p,newConversationInputsRef:c,handleNewConversationInputsChange:u}=U(),m=i?o:p,f=(0,n.useCallback)((e,t)=>{d({...o,[e]:t}),u({...c.current,[e]:t})},[c,u,o,d]),h=r.filter(e=>!0!==e.hide);return(0,s.jsxs)("div",{className:"space-y-4",children:[h.map(e=>(0,s.jsxs)("div",{className:"space-y-1",children:[e.type!==P.InputVarType.checkbox&&(0,s.jsxs)("div",{className:"flex h-6 items-center gap-1",children:[(0,s.jsx)("div",{className:"system-md-semibold text-text-secondary",children:e.label}),!e.required&&(0,s.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:a("panel.optional",{ns:"workflow"})})]}),e.type===P.InputVarType.textInput&&(0,s.jsx)(T.default,{value:m?.[e.variable]||"",onChange:t=>f(e.variable,t.target.value),placeholder:e.label}),e.type===P.InputVarType.number&&(0,s.jsx)(T.default,{type:"number",value:m?.[e.variable]||"",onChange:t=>f(e.variable,t.target.value),placeholder:e.label}),e.type===P.InputVarType.paragraph&&(0,s.jsx)(A.default,{value:m?.[e.variable]||"",onChange:t=>f(e.variable,t.target.value),placeholder:e.label}),e.type===P.InputVarType.checkbox&&(0,s.jsx)(k.default,{name:e.label,value:m?.[e.variable],required:e.required,onChange:t=>f(e.variable,t)}),e.type===P.InputVarType.select&&(0,s.jsx)(I.PortalSelect,{popupClassName:"w-[200px]",value:m?.[e.variable]??e.default??"",items:e.options.map(e=>({value:e,name:e})),onSelect:t=>f(e.variable,t.value),placeholder:e.label}),e.type===P.InputVarType.singleFile&&(0,s.jsx)(S.FileUploaderInAttachmentWrapper,{value:m?.[e.variable]?[m?.[e.variable]]:[],onChange:t=>f(e.variable,t[0]),fileConfig:{allowed_file_types:e.allowed_file_types,allowed_file_extensions:e.allowed_file_extensions,allowed_file_upload_methods:e.allowed_file_upload_methods,number_limits:1,fileUploadConfig:l.system_parameters}}),e.type===P.InputVarType.multiFiles&&(0,s.jsx)(S.FileUploaderInAttachmentWrapper,{value:m?.[e.variable]||[],onChange:t=>f(e.variable,t),fileConfig:{allowed_file_types:e.allowed_file_types,allowed_file_extensions:e.allowed_file_extensions,allowed_file_upload_methods:e.allowed_file_upload_methods,number_limits:e.max_length,fileUploadConfig:l.system_parameters}}),e.type===P.InputVarType.jsonObject&&(0,s.jsx)(E.default,{language:M.CodeLanguage.json,value:m?.[e.variable]||"",onChange:t=>f(e.variable,t),noWrapper:!0,className:"bg h-[80px] overflow-y-auto rounded-[10px] bg-components-input-bg-normal p-1",placeholder:(0,s.jsx)("div",{className:"whitespace-pre",children:e.json_schema})})]},e.variable)),t&&(0,s.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:a("chat.chatFormTip",{ns:"share"})})]})});var V=e.i(757198);e.i(8482);var O=e.i(112727);let W=e=>{let{collapsed:t,setCollapsed:a}=e,{t:l}=(0,g.useTranslation)(),{appSourceType:n,isMobile:r,currentConversationId:i,themeBuilder:o,handleStartChat:d,allInputsHidden:p,inputsForms:c}=U(),u=n===D.AppSourceType.tryApp;return p||0===c.length?null:(0,s.jsxs)("div",{className:(0,v.cn)("mb-6 flex flex-col items-center px-4 pt-6",r&&"mb-4 pt-4",u&&"mb-0 px-0"),children:[(0,s.jsxs)("div",{className:(0,v.cn)("w-full max-w-[672px] rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-md",t&&"border border-components-card-border bg-components-card-bg shadow-none",u&&"max-w-[auto]"),children:[(0,s.jsxs)("div",{className:(0,v.cn)("flex items-center gap-3 rounded-t-2xl px-6 py-4",!t&&"border-b border-divider-subtle",r&&"px-4 py-3"),children:[(0,s.jsx)(O.Message3Fill,{className:"h-6 w-6 shrink-0"}),(0,s.jsx)("div",{className:"system-xl-semibold grow text-text-secondary",children:l("chat.chatSettingsTitle",{ns:"share"})}),t&&(0,s.jsx)(f.default,{className:"uppercase text-text-tertiary",size:"small",variant:"ghost",onClick:()=>a(!1),children:l("operation.edit",{ns:"common"})}),!t&&i&&(0,s.jsx)(f.default,{className:"uppercase text-text-tertiary",size:"small",variant:"ghost",onClick:()=>a(!0),children:l("operation.close",{ns:"common"})})]}),!t&&(0,s.jsx)("div",{className:(0,v.cn)("p-6",r&&"p-4"),children:(0,s.jsx)(q,{})}),!t&&!i&&(0,s.jsx)("div",{className:(0,v.cn)("p-6",r&&"p-4"),children:(0,s.jsx)(f.default,{variant:"primary",className:"w-full",onClick:()=>d(()=>a(!0)),style:o?.theme?{backgroundColor:o?.theme.primaryColor}:{},children:l("chat.startChat",{ns:"share"})})})]}),t&&(0,s.jsxs)("div",{className:"flex w-full max-w-[720px] items-center py-4",children:[(0,s.jsx)(V.default,{bgStyle:"gradient",className:"h-px basis-1/2 rotate-180"}),(0,s.jsx)(V.default,{bgStyle:"gradient",className:"h-px basis-1/2"})]})]})};var z=e.i(168014);let K=e=>{let{className:t}=e;return(0,s.jsx)("img",{src:`${z.basePath}/logo/logo-embedded-chat-avatar.png`,className:`block h-10 w-10 ${t}`,alt:"logo"})};var Q=e.i(379415),G=e.i(648404),B=e.i(241661),H=e.i(34510),$=e.i(326773),Y=e.i(53349);let X=()=>{let{appData:e,appParams:t,appPrevChatList:a,currentConversationId:l,currentConversationItem:r,currentConversationInputs:i,inputsForms:o,newConversationInputs:d,newConversationInputsRef:p,handleNewConversationCompleted:c,isMobile:u,isInstalledApp:m,appId:f,appMeta:h,disableFeedback:x,handleFeedback:g,currentChatInstanceRef:_,themeBuilder:b,clearChatList:y,setClearChatList:j,setIsResponding:S,allInputsHidden:T,initUserVariables:I,appSourceType:A}=U(),k=(0,n.useMemo)(()=>{let e=t||{};return{...e,file_upload:{...e.file_upload,fileUploadConfig:e.system_parameters},supportFeedback:!0,opening_statement:r?.introduction||e.opening_statement}},[t,r?.introduction]),{chatList:E,setTargetMessageId:M,handleSend:F,handleStop:L,isResponding:R,suggestedQuestions:q}=(0,$.useChat)(k,{inputs:l?i:d,inputsForm:o},a,e=>(0,D.stopChatMessageResponding)("",e,A,f),y,j),V=l?i:p?.current,O=(0,n.useMemo)(()=>{if(T)return!1;let e="",t=!1,a=o.filter(e=>{let{required:t,type:a}=e;return t&&a!==P.InputVarType.checkbox});return a.length&&a.forEach(a=>{let{variable:s,label:l,type:n}=a;if(!e&&!t&&(V?.[s]||(e=l),(n===P.InputVarType.singleFile||n===P.InputVarType.multiFiles)&&V?.[s])){let e=V[s];t=Array.isArray(e)?e.find(e=>e.transferMethod===G.TransferMethod.local_file&&!e.uploadedId):e.transferMethod===G.TransferMethod.local_file&&!e.uploadedId}}),!!e||!!t},[V,o,T]);(0,n.useEffect)(()=>{_.current&&(_.current.handleStop=L)},[_,L]),(0,n.useEffect)(()=>{S(R)},[R,S]);let z=(0,n.useCallback)(function(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n={query:e,files:t,inputs:l?i:d,conversation_id:l,parent_message_id:(a?s?.id:(0,Y.getLastAnswer)(E)?.id)||null};F((0,D.getUrl)("chat-messages",A,f||""),n,{onGetSuggestedQuestions:e=>(0,D.fetchSuggestedQuestions)(e,A,f),onConversationComplete:l?void 0:c,isPublicAPI:A===D.AppSourceType.webApp})},[l,i,d,E,F,m,f,c]),X=(0,n.useCallback)((e,t)=>{let a=t?e:E.find(t=>t.id===e.parentMessageId),s=E.find(e=>e.id===a.parentMessageId);z(t?t.message:a.content,t?t.files:a.message_files,!0,(0,Y.isValidGeneratedAnswer)(s)?s:null)},[E,z]),J=(0,n.useMemo)(()=>l||E.length>1?E:E.filter(e=>!e.isOpeningStatement),[E,l]),Z=A===D.AppSourceType.tryApp,[ee,et]=(0,n.useState)(!!l&&!Z),ea=(0,n.useMemo)(()=>T||!o.length?null:u&&l?(0,s.jsx)("div",{className:"mb-4"}):(0,s.jsx)(W,{collapsed:ee,setCollapsed:et}),[o.length,u,l,ee,T]),es=(0,n.useMemo)(()=>{let t=E.find(e=>e.isOpeningStatement);return!R&&!l&&t&&(ee||!(o.length>0)||T)&&e?.site?t.suggestedQuestions&&t.suggestedQuestions?.length>0?(0,s.jsx)("div",{className:(0,v.cn)("flex items-center justify-center px-4 py-12",u?"min-h-[30vh] py-0":"h-[50vh]"),children:(0,s.jsxs)("div",{className:"flex max-w-[720px] grow gap-4",children:[(0,s.jsx)(w.default,{size:"xl",iconType:e?.site.icon_type,icon:e?.site.icon,background:e?.site.icon_background,imageUrl:e?.site.icon_url}),(0,s.jsxs)("div",{className:"body-lg-regular grow rounded-2xl bg-chat-bubble-bg px-4 py-3 text-text-primary",children:[(0,s.jsx)(Q.Markdown,{content:t.content}),(0,s.jsx)(N.default,{item:t})]})]})}):(0,s.jsxs)("div",{className:(0,v.cn)("flex min-h-[50vh] flex-col items-center justify-center gap-3 py-12",u?"min-h-[30vh] py-0":"h-[50vh]"),children:[(0,s.jsx)(w.default,{size:"xl",iconType:e?.site.icon_type,icon:e?.site.icon,background:e?.site.icon_background,imageUrl:e?.site.icon_url}),(0,s.jsx)("div",{className:"max-w-[768px] px-4",children:(0,s.jsx)(Q.Markdown,{className:"!body-2xl-regular !text-text-tertiary",content:t.content})})]}):null},[e?.site,E,ee,l,o.length,R,T]),el=document.referrer.includes("dify.ai")?(0,s.jsx)(K,{className:"relative shrink-0"}):e?.site&&e.site.use_icon_as_answer_icon?(0,s.jsx)(C.default,{iconType:e.site.icon_type,icon:e.site.icon,background:e.site.icon_background,imageUrl:e.site.icon_url}):null;return(0,s.jsx)(H.default,{isTryApp:Z,appData:e||void 0,config:k,chatList:J,isResponding:R,chatContainerInnerClassName:(0,v.cn)("mx-auto w-full max-w-full px-4",J.length&&"pt-4"),chatFooterClassName:(0,v.cn)("pb-4",!u&&"rounded-b-2xl"),chatFooterInnerClassName:(0,v.cn)("mx-auto w-full max-w-full px-4",u&&"px-2"),onSend:z,inputs:l?i:d,inputsForm:o,onRegenerate:X,onStopResponding:L,chatNode:(0,s.jsxs)(s.Fragment,{children:[ea,es]}),allToolIcons:h?.tool_icons||{},disableFeedback:x,onFeedback:g,suggestedQuestions:q,answerIcon:el,hideProcessDetail:!0,themeBuilder:b,switchSibling:e=>M(e),inputDisabled:O,questionIcon:I?.avatar_url?(0,s.jsx)(B.default,{avatar:I.avatar_url,name:I.name||"user",size:40}):void 0})};var J=e.i(881110),Z=e.i(105845),ee=e.i(137667),et=e.i(290422),ea=e.i(608846),es=e.i(218422),el=e.i(387450),en=e.i(223314),er=e.i(506133),ei=e.i(391185);let eo=e=>{let{iconColor:t}=e,{t:a}=(0,g.useTranslation)(),[r,i]=(0,n.useState)(!1);return(0,s.jsxs)(ei.PortalToFollowElem,{open:r,onOpenChange:i,placement:"bottom-end",offset:{mainAxis:4,crossAxis:4},children:[(0,s.jsx)(ei.PortalToFollowElemTrigger,{onClick:()=>i(e=>!e),children:(0,s.jsx)(_.default,{size:"l",state:r?_.ActionButtonState.Hover:_.ActionButtonState.Default,children:(0,s.jsx)(l.RiChatSettingsLine,{className:(0,v.cn)("h-[18px] w-[18px]",t)})})}),(0,s.jsx)(ei.PortalToFollowElemContent,{className:"z-[99]",children:(0,s.jsxs)("div",{className:"w-[400px] rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-lg backdrop-blur-sm",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 rounded-t-2xl border-b border-divider-subtle px-6 py-4",children:[(0,s.jsx)(O.Message3Fill,{className:"h-6 w-6 shrink-0"}),(0,s.jsx)("div",{className:"system-xl-semibold grow text-text-secondary",children:a("chat.chatSettingsTitle",{ns:"share"})})]}),(0,s.jsx)("div",{className:"p-6",children:(0,s.jsx)(q,{})})]})})]})};var ed=e.i(421001),ep=e.i(271743),ec=e.i(199947);let eu=n.memo(e=>{let{appId:t,appDetail:a,className:r}=e,{t:i}=(0,g.useTranslation)(),o=(0,ep.default)()===ep.MediaType.mobile,d=(0,ec.useThemeContext)(),{removeConversationIdInfo:p,...m}=((e,t)=>{let a=e===D.AppSourceType.tryApp,{data:s}=c(a?t:""),l=(0,ea.useWebAppStore)(e=>e.appInfo),r=a?s:l,i=(0,ea.useWebAppStore)(e=>e.appMeta),{data:o}=u(a?t:""),d=(0,ea.useWebAppStore)(e=>e.appParams),p=a?o:d,m=(0,n.useMemo)(()=>a?t:r?.app_id,[r,a,t]),f=(0,ea.useWebAppStore)(e=>e.embeddedConversationId),h=(0,ea.useWebAppStore)(e=>e.embeddedUserId),[x,_]=(0,n.useState)(),[b,v]=(0,n.useState)();(0,n.useEffect)(()=>{a||(0,Y.getProcessedSystemVariablesFromUrlParams)().then(e=>{let{user_id:t,conversation_id:a}=e;_(t),v(a)})},[]),(0,n.useEffect)(()=>{_(h||void 0)},[h]),(0,n.useEffect)(()=>{v(f||void 0)},[f]),(0,n.useEffect)(()=>{a||(async()=>{let e=new URLSearchParams(window.location.search).get("locale"),t=(await (0,Y.getProcessedSystemVariablesFromUrlParams)()).locale;e?await (0,es.changeLanguage)(e):t?await (0,es.changeLanguage)(t):r?.site?.default_language&&await (0,es.changeLanguage)(r.site?.default_language)})()},[r]);let[y,j]=(0,J.useLocalStorageState)(er.CONVERSATION_ID_INFO,{defaultValue:{}}),w=(0,n.useCallback)(e=>{j(t=>{let a={...t};return delete a[e],a})},[j]),C=!b,N=(0,n.useMemo)(()=>y?.[m||""]?.[x||"DEFAULT"]||b||"",[m,y,x,b]),S=(0,n.useCallback)(e=>{if(m){let t=y?.[m||""];"string"==typeof t&&(t={}),j({...y,[m||""]:{...t,[x||"DEFAULT"]:e}})}},[m,y,j,x]),[T,I]=(0,n.useState)(""),A=(0,n.useMemo)(()=>N===T?"":N,[N,T]),{data:k}=(0,el.useShareConversations)({appSourceType:e,appId:m,pinned:!0,limit:100}),{data:E,isLoading:M}=(0,el.useShareConversations)({appSourceType:e,appId:m,pinned:!1,limit:100}),{data:L,isLoading:R}=(0,el.useShareChatList)({conversationId:A,appSourceType:e,appId:m}),U=(0,el.useInvalidateShareConversations)(),[q,V]=(0,n.useState)(!1),[O,W]=(0,n.useState)(!1),z=(0,n.useMemo)(()=>{var e;let t;return N&&L?.data.length?(0,Y.buildChatItemTree)((e=L.data,t=[],e.forEach(e=>{let a=e.message_files?.filter(e=>"user"===e.belongs_to)||[];t.push({id:`question-${e.id}`,content:e.query,isAnswer:!1,message_files:(0,en.getProcessedFilesFromResponse)(a.map(e=>({...e,related_id:e.id}))),parentMessageId:e.parent_message_id||void 0});let s=e.message_files?.filter(e=>"assistant"===e.belongs_to)||[];t.push({id:e.id,content:e.answer,agent_thoughts:(0,et.addFileInfos)(e.agent_thoughts?(0,et.sortAgentSorts)(e.agent_thoughts):e.agent_thoughts,e.message_files),feedback:e.feedback,isAnswer:!0,citation:e.retriever_resources,message_files:(0,en.getProcessedFilesFromResponse)(s.map(e=>({...e,related_id:e.id}))),parentMessageId:`question-${e.id}`})}),t)):[]},[L,N]),[K,Q]=(0,n.useState)(!1),B=(0,n.useMemo)(()=>k?.data||[],[k]),{t:H}=(0,g.useTranslation)(),$=(0,n.useRef)({}),[X,ei]=(0,n.useState)({}),[eo,ed]=(0,n.useState)({}),[ep,ec]=(0,n.useState)({}),eu=(0,n.useCallback)(e=>{$.current=e,ei(e)},[]),em=(0,n.useMemo)(()=>(p?.user_input_form||[]).filter(e=>!e.external_data_tool).map(e=>{if(e.paragraph){let t=eo[e.paragraph.variable];return t&&e.paragraph.max_length&&t.length>e.paragraph.max_length&&(t=t.slice(0,e.paragraph.max_length)),{...e.paragraph,default:t||e.default||e.paragraph.default,type:"paragraph"}}if(e.number){let t=Number(eo[e.number.variable]);return{...e.number,default:t||e.default||e.number.default,type:"number"}}if(e.checkbox){let t=!0===eo[e.checkbox.variable];return{...e.checkbox,default:t||e.default||e.checkbox.default,type:"checkbox"}}if(e.select){let t=e.select.options.includes(eo[e.select.variable]);return{...e.select,default:(t?eo[e.select.variable]:void 0)||e.select.default,type:"select"}}if(e["file-list"])return{...e["file-list"],type:"file-list"};if(e.file)return{...e.file,type:"file"};if(e.json_object)return{...e.json_object,type:"json_object"};let t=eo[e["text-input"].variable];return t&&e["text-input"].max_length&&t.length>e["text-input"].max_length&&(t=t.slice(0,e["text-input"].max_length)),{...e["text-input"],default:t||e.default||e["text-input"].default,type:"text-input"}}),[eo,p]),ef=(0,n.useMemo)(()=>em.length>0&&em.every(e=>!0===e.hide),[em]);(0,n.useEffect)(()=>{(async()=>{if(a)return;let e=await (0,Y.getProcessedInputsFromUrlParams)(),t=await (0,Y.getProcessedUserVariablesFromUrlParams)();ed(e),ec(t)})()},[]),(0,n.useEffect)(()=>{let e={};em.forEach(t=>{e[t.variable]=t.default||null}),eu(e)},[eu,em]);let{data:eh}=(0,el.useShareConversationName)({conversationId:T,appSourceType:e,appId:m},{refetchOnWindowFocus:!1,enabled:!a}),[ex,eg]=(0,n.useState)([]);(0,n.useEffect)(()=>{E?.data&&!M&&eg(E?.data)},[E,M]);let e_=(0,n.useMemo)(()=>{let e=ex.slice();return K&&e[0]?.id!==""&&e.unshift({id:"",name:H("chat.newChatDefaultName",{ns:"share"}),inputs:{},introduction:""}),e},[ex,K,H]);(0,n.useEffect)(()=>{eh&&eg((0,Z.produce)(e=>{let t=e.findIndex(e=>e.id===eh.id);t>-1?e[t]=eh:e.unshift(eh)}))},[eh]);let eb=(0,n.useMemo)(()=>{let e=e_.find(e=>e.id===N);return!e&&B.length&&(e=B.find(e=>e.id===N)),e},[e_,N,B]),ev=(0,n.useMemo)(()=>N&&L?.data.length?L.data.slice().pop().inputs||{}:$.current||{},[L,N]),[ey,ej]=(0,n.useState)(ev||{});(0,n.useEffect)(()=>{eb&&!a&&ej(ev||{})},[eb,ev]);let{notify:ew}=(0,ee.useToastContext)(),eC=(0,n.useCallback)(e=>{if(ef)return!0;let t="",a=!1,s=em.filter(e=>{let{required:t,type:a}=e;return t&&a!==P.InputVarType.checkbox});return(s.length&&s.forEach(s=>{let{variable:l,label:n,type:r}=s;if(!t&&!a&&($.current[l]||e||(t=n),(r===P.InputVarType.singleFile||r===P.InputVarType.multiFiles)&&$.current[l]&&!e)){let e=$.current[l];a=Array.isArray(e)?e.find(e=>e.transferMethod===G.TransferMethod.local_file&&!e.uploadedId):e.transferMethod===G.TransferMethod.local_file&&!e.uploadedId}}),t)?(ew({type:"error",message:H("errorMessage.valueOfVarRequired",{ns:"appDebug",key:t})}),!1):!a||void ew({type:"info",message:H("errorMessage.waitForFileUpload",{ns:"appDebug"})})},[em,ew,H,ef]),eN=(0,n.useCallback)(e=>{eC()&&(Q(!0),e?.())},[Q,eC]),eS=(0,n.useRef)({handleStop:F.noop}),eT=(0,n.useCallback)(e=>{eS.current.handleStop(),I(""),S(e),e&&V(!1)},[S,V]),eI=(0,n.useCallback)(async()=>{a||(eS.current.handleStop(),Q(!0),eT(""),eu(await (0,Y.getProcessedInputsFromUrlParams)())),V(!0)},[a,Q,eu,V]),eA=(0,n.useCallback)(e=>{I(e),S(e),Q(!1),U()},[S,U]),ek=(0,n.useCallback)(async(t,a)=>{await (0,D.updateFeedback)({url:`/messages/${t}/feedbacks`,body:{rating:a.rating,content:a.content}},e,m),ew({type:"success",message:H("api.success",{ns:"common"})})},[e,m,H,ew]);return{appSourceType:e,isInstalledApp:!1,allowResetChat:C,appId:m,currentConversationId:N,currentConversationItem:eb,removeConversationIdInfo:w,handleConversationIdInfoChange:S,appData:r,appParams:p||{},appMeta:i,appPinnedConversationData:k,appConversationData:E,appConversationDataLoading:M,appChatListData:L,appChatListDataLoading:R,appPrevChatList:z,pinnedConversationList:B,conversationList:e_,setShowNewConversationItemInList:Q,newConversationInputs:X,newConversationInputsRef:$,handleNewConversationInputsChange:eu,inputsForms:em,handleNewConversation:eI,handleStartChat:eN,handleChangeConversation:eT,handleNewConversationCompleted:eA,newConversationId:T,chatShouldReloadKey:A,handleFeedback:ek,currentChatInstanceRef:eS,clearChatList:q,setClearChatList:V,isResponding:O,setIsResponding:W,currentConversationInputs:ey,setCurrentConversationInputs:ej,allInputsHidden:ef,initUserVariables:ep}})(D.AppSourceType.tryApp,t),f=m.currentConversationId,h=m.inputsForms;(0,n.useEffect)(()=>{t&&p(t)},[t]);let[b,{setTrue:y}]=(0,x.useBoolean)(!1);return(0,s.jsx)(R.Provider,{value:{...m,disableFeedback:!0,isMobile:o,themeBuilder:d},children:(0,s.jsxs)("div",{className:(0,v.cn)("flex h-full flex-col rounded-2xl bg-background-section-burn",r),children:[(0,s.jsxs)("div",{className:"flex shrink-0 justify-between p-3",children:[(0,s.jsxs)("div",{className:"flex grow items-center space-x-2",children:[(0,s.jsx)(w.default,{size:"large",iconType:a.site.icon_type,icon:a.site.icon,background:a.site.icon_background,imageUrl:a.site.icon_url}),(0,s.jsx)("div",{className:"system-md-semibold grow truncate text-text-primary",title:a.name,children:a.name})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[f&&(0,s.jsx)(ed.default,{popupContent:i("chat.resetChat",{ns:"share"}),children:(0,s.jsx)(_.default,{size:"l",onClick:()=>{p(t),m.handleNewConversation()},children:(0,s.jsx)(l.RiResetLeftLine,{className:"h-[18px] w-[18px]"})})}),f&&h.length>0&&(0,s.jsx)(eo,{})]})]}),(0,s.jsxs)("div",{className:"mx-auto mt-4 flex h-[0] w-[769px] grow flex-col",children:[!b&&(0,s.jsx)(j,{className:"mb-4 shrink-0",message:i("tryApp.tryInfo",{ns:"explore"}),onHide:y}),(0,s.jsx)(X,{})]})]})})});var em=e.i(210807),ef=((t={}).pending="pending",t.running="running",t.completed="completed",t.failed="failed",t),eh=e.i(925521),ex=e.i(680884),eg=e.i(727163);let e_=n.memo(e=>{let t,{appId:a,className:l,isWorkflow:i,appData:o}=e,{t:d}=(0,g.useTranslation)(),p=(0,ep.default)()===ep.MediaType.pc,[c,m]=(0,n.useState)({}),f=(0,n.useRef)(c),h=(0,n.useCallback)(e=>{m(e),f.current=e},[]),_=(0,ea.useWebAppStore)(e=>e.updateAppInfo),{data:b}=u(a),y=(0,ea.useWebAppStore)(e=>e.updateAppParams),C=(0,ea.useWebAppStore)(e=>e.appParams),[N,S]=(0,n.useState)(null),[T,I]=(0,n.useState)(null),[A,k]=(0,n.useState)(null),[E,M]=(0,n.useState)(null),[P,L]=(0,n.useState)(null),[R,U]=(0,n.useState)(0),[q,V]=(0,n.useState)({enabled:!1,number_limits:2,detail:G.Resolution.low,transfer_methods:[G.TransferMethod.local_file]}),[O,W]=(0,n.useState)([]),[z,{setTrue:K,setFalse:Q}]=(0,x.useBoolean)(!1),B=()=>{setTimeout(()=>{K()},0)},[H,$]=(0,n.useState)(!1);(0,n.useEffect)(()=>{o&&_(o)},[o,_]),(0,n.useEffect)(()=>{b&&y(b)},[b,y]),(0,n.useEffect)(()=>{(async()=>{if(!o||!C)return;let{site:e,custom_config:t}=o;S(e),k(t);let{user_input_form:a,more_like_this:s,file_upload:l,text_to_speech:n}=C;V({...l,transfer_methods:l?.allowed_file_upload_methods||l?.allowed_upload_methods,image_file_size_limit:C?.system_parameters.image_file_size_limit,fileUploadConfig:C?.system_parameters}),I({prompt_template:"",prompt_variables:(0,ex.userInputsFormToPromptVariables)(a)}),M(s),L(n)})()},[o,C]);let[Y,X]=(0,n.useState)(!1),J=(0,n.useCallback)(()=>{X(!0)},[]),[Z,{setTrue:ee}]=(0,x.useBoolean)(!1),et=(0,s.jsx)("div",{className:(0,v.cn)("relative flex h-full flex-col","rounded-r-2xl bg-chatbot-bg"),children:(0,s.jsxs)("div",{className:(0,v.cn)("flex h-0 grow flex-col overflow-y-auto p-6"),children:[Y&&!Z&&(0,s.jsx)(j,{className:"mb-3 shrink-0",message:d("tryApp.tryInfo",{ns:"explore"}),onHide:ee}),(0,s.jsx)(em.default,{isWorkflow:!!i,isCallBatchAPI:!1,isPC:p,isMobile:!p,appSourceType:D.AppSourceType.tryApp,appId:a,isError:t?.status===ef.failed,promptConfig:T,moreLikeThisEnabled:!!E?.enabled,inputs:c,controlSend:R,onShowRes:B,handleSaveMessage:F.noop,taskId:t?.id,onCompleted:J,visionConfig:q,completionFiles:O,isShowTextToSpeech:!!P?.enabled,siteInfo:N,onRunStart:()=>$(!0)},t?.id)]})});return N&&T?(0,s.jsxs)("div",{className:(0,v.cn)("rounded-2xl border border-components-panel-border bg-background-section-burn",p&&"flex",!p&&"flex-col","h-full rounded-2xl shadow-md",l),children:[(0,s.jsxs)("div",{className:(0,v.cn)("relative flex h-full shrink-0 flex-col",p&&"w-[600px] max-w-[50%]","rounded-l-2xl bg-components-panel-bg"),children:[(0,s.jsxs)("div",{className:(0,v.cn)("shrink-0 space-y-4 pb-2",p?" p-8 pb-0":"p-4 pb-0"),children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(w.default,{size:p?"large":"small",iconType:N.icon_type,icon:N.icon,background:N.icon_background||eh.appDefaultIconBackground,imageUrl:N.icon_url}),(0,s.jsx)("div",{className:"system-md-semibold grow truncate text-text-secondary",children:N.title})]}),N.description&&(0,s.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:N.description})]}),(0,s.jsx)("div",{className:(0,v.cn)("h-0 grow overflow-y-auto",p?"px-8":"px-4",!p&&H&&A?.remove_webapp_brand&&"rounded-b-2xl border-b-[0.5px] border-divider-regular"),children:(0,s.jsx)(eg.default,{siteInfo:N,inputs:c,inputsRef:f,onInputsChange:h,promptConfig:T,onSend:()=>{U(Date.now()),B()},visionConfig:q,onVisionFilesChange:W})})]}),(0,s.jsxs)("div",{className:(0,v.cn)("h-full w-0 grow"),children:[!p&&(0,s.jsx)("div",{className:(0,v.cn)(z?"flex items-center justify-center p-2 pt-6":"absolute left-0 top-0 z-10 flex w-full items-center justify-center px-2 pb-[57px] pt-[3px]"),onClick:()=>{z?Q():B()},children:(0,s.jsx)("div",{className:"h-1 w-8 cursor-grab rounded bg-divider-solid"})}),et]})]}):(0,s.jsx)("div",{className:(0,v.cn)("flex h-screen items-center",l),children:(0,s.jsx)(r.default,{type:"app"})})}),eb=n.memo(e=>{let{appId:t,appDetail:a}=e,l=a?.mode,n=["chat","advanced-chat","agent-chat"].includes(l);return(0,h.default)(a?.site?.title||""),(0,s.jsxs)("div",{className:"flex h-full w-full",children:[n&&(0,s.jsx)(eu,{appId:t,appDetail:a,className:"h-full grow"}),!n&&(0,s.jsx)(e_,{appId:t,className:"h-full grow",isWorkflow:"workflow"===l,appData:{app_id:t,custom_config:{},...a}})]})});var ev=e.i(446717),ey=e.i(276925);let ej=(e,t)=>`${eh.MARKETPLACE_API_PREFIX}/plugins/${e}/${t}/icon`,ew="system-sm-semibold-uppercase text-text-secondary mb-3",eC=n.memo(e=>{let{appId:t,className:a,category:n,appDetail:r,onCreate:i}=e,{t:o}=(0,g.useTranslation)(),d=r?.mode,{requirements:p}=(e=>{let{appDetail:t,appId:a}=e,s=["chat","completion","agent-chat"].includes(t.mode),l="agent-chat"===t.mode,n=!s,{data:r}=m(a,s),i=[];if(s){let e=t.model_config.model.provider.split("/"),a=t.model_config.model.provider.split("/").pop()||"";i.push({name:a,iconUrl:ej(e[0],e[1])})}if(l&&i.push(...t.model_config.agent_mode.tools.filter(e=>e.enabled).map(e=>{let t=e.provider_id.split("/");return{name:e.tool_label,iconUrl:ej(t[0],t[1])}})),n&&r&&r?.graph?.nodes?.length>0){let e=r.graph.nodes,t=e.filter(e=>e.data.type===P.BlockEnum.LLM);i.push(...t.map(e=>{let t=e.data,a=t.model.provider.split("/");return{name:t.model.name,iconUrl:ej(a[0],a[1])}}));let a=e.filter(e=>e.data.type===P.BlockEnum.Tool);i.push(...a.map(e=>{let t=e.data,a=t.provider_id.split("/");return{name:t.tool_label,iconUrl:ej(a[0],a[1])}}))}return{requirements:(0,ey.uniqBy)(i,"name")}})({appDetail:r,appId:t});return(0,s.jsxs)("div",{className:(0,v.cn)("flex h-full flex-col px-4 pt-2",a),children:[(0,s.jsxs)("div",{className:"flex shrink-0 grow-0 items-center gap-3",children:[(0,s.jsxs)("div",{className:"relative shrink-0",children:[(0,s.jsx)(w.default,{size:"large",iconType:r.site.icon_type,icon:r.site.icon,background:r.site.icon_background,imageUrl:r.site.icon_url}),(0,s.jsx)(ev.AppTypeIcon,{wrapperClassName:"absolute -bottom-0.5 -right-0.5 w-4 h-4 shadow-sm",className:"h-3 w-3",type:d})]}),(0,s.jsxs)("div",{className:"w-0 grow py-[1px]",children:[(0,s.jsx)("div",{className:"flex items-center text-sm font-semibold leading-5 text-text-secondary",children:(0,s.jsx)("div",{className:"truncate",title:r.name,children:r.name})}),(0,s.jsxs)("div",{className:"flex items-center text-[10px] font-medium leading-[18px] text-text-tertiary",children:["advanced-chat"===d&&(0,s.jsx)("div",{className:"truncate",children:o("types.advanced",{ns:"app"}).toUpperCase()}),"chat"===d&&(0,s.jsx)("div",{className:"truncate",children:o("types.chatbot",{ns:"app"}).toUpperCase()}),"agent-chat"===d&&(0,s.jsx)("div",{className:"truncate",children:o("types.agent",{ns:"app"}).toUpperCase()}),"workflow"===d&&(0,s.jsx)("div",{className:"truncate",children:o("types.workflow",{ns:"app"}).toUpperCase()}),"completion"===d&&(0,s.jsx)("div",{className:"truncate",children:o("types.completion",{ns:"app"}).toUpperCase()})]})]})]}),r.description&&(0,s.jsx)("div",{className:"system-sm-regular mt-[14px] shrink-0 text-text-secondary",children:r.description}),(0,s.jsxs)(f.default,{variant:"primary",className:"mt-3 flex w-full max-w-full",onClick:i,children:[(0,s.jsx)(l.RiAddLine,{className:"mr-1 size-4 shrink-0"}),(0,s.jsx)("span",{className:"truncate",children:o("tryApp.createFromSampleApp",{ns:"explore"})})]}),n&&(0,s.jsxs)("div",{className:"mt-6 shrink-0",children:[(0,s.jsx)("div",{className:ew,children:o("tryApp.category",{ns:"explore"})}),(0,s.jsx)("div",{className:"system-md-regular text-text-secondary",children:n})]}),p.length>0&&(0,s.jsxs)("div",{className:"mt-5 grow overflow-y-auto",children:[(0,s.jsx)("div",{className:ew,children:o("tryApp.requirements",{ns:"explore"})}),(0,s.jsx)("div",{className:"space-y-0.5",children:p.map(e=>(0,s.jsxs)("div",{className:"flex items-center space-x-2 py-1",children:[(0,s.jsx)("div",{className:"size-5 rounded-md bg-cover shadow-xs",style:{backgroundImage:`url(${e.iconUrl})`}}),(0,s.jsx)("div",{className:"system-md-regular w-0 grow truncate text-text-secondary",children:e.name})]},e.name))})]})]})});var eN=e.i(719730),eS=e.i(875489),eT=e.i(315765);e.i(458266);var eI=e.i(733437),eA=e.i(471981),ek=e.i(739255),eE=e.i(265630),eM=e.i(923978),eP=e.i(154033),eF=e.i(842090),eL=e.i(225162);let eD={provider:"langgenius/openai/openai",model_id:"gpt-3.5-turbo",mode:G.ModelModeType.unset,configs:{prompt_template:"",prompt_variables:[]},more_like_this:null,opening_statement:"",suggested_questions:[],sensitive_word_avoidance:null,speech_to_text:null,text_to_speech:null,file_upload:null,suggested_questions_after_answer:null,retriever_resource:null,annotation_reply:null,dataSets:[],agentConfig:eh.DEFAULT_AGENT_SETTING},eR=n.memo(e=>{let{appId:t}=e,a=(0,ep.default)()===ep.MediaType.mobile,{data:l,isLoading:i}=c(t),{data:o,isLoading:u}=(0,eP.useAllToolProviders)(),m=o?.map(e=>({...e,icon:z.basePath&&"string"==typeof e.icon&&!e.icon.includes(z.basePath)?`${z.basePath}${e.icon}`:e.icon})),f=(()=>{if(i)return[];let e=l?.model_config;if(!e)return[];let t=null;return(e.agent_mode?.tools?.find(e=>{let{dataset:t}=e;return t?.enabled})?t=e.agent_mode?.tools.filter(e=>{let{dataset:t}=e;return t?.enabled}):e.dataset_configs.datasets?.datasets?.length>0&&(t=e.dataset_configs?.datasets?.datasets),t?.length&&t?.length>0)?t.map(e=>{let{dataset:t}=e;return t.id}):[]})(),{data:h,isLoading:x}=(0,d.useQuery)({queryKey:p.consoleQuery.trialApps.datasets.queryKey({input:{params:{appId:t},query:{ids:f}}}),queryFn:()=>p.consoleClient.trialApps.datasets({params:{appId:t},query:{ids:f}}),enabled:f.length>0}),g=h?.data||[],_=i||x||u,b=(e=>{if(_||!e)return eD;let t=e.model;return{provider:(0,eF.correctModelProvider)(t.provider),model_id:t.name,mode:t.mode,configs:{prompt_template:e.pre_prompt||"",prompt_variables:(0,ex.userInputsFormToPromptVariables)([...e.user_input_form,...e.external_data_tools?.length?e.external_data_tools.map(e=>({external_data_tool:{variable:e.variable,label:e.label,enabled:e.enabled,type:e.type,config:e.config,required:!0,icon:e.icon,icon_background:e.icon_background}})):[]],e.dataset_query_variable)},more_like_this:e.more_like_this,opening_statement:e.opening_statement,suggested_questions:e.suggested_questions,sensitive_word_avoidance:e.sensitive_word_avoidance,speech_to_text:e.speech_to_text,text_to_speech:e.text_to_speech,file_upload:e.file_upload,suggested_questions_after_answer:e.suggested_questions_after_answer,retriever_resource:e.retriever_resource,annotation_reply:e.annotation_reply,external_data_tools:e.external_data_tools,dataSets:g,agentConfig:l?.mode==="agent-chat"?{max_iteration:eh.DEFAULT_AGENT_SETTING.max_iteration,...e.agent_mode,enabled:!0,tools:e.agent_mode?.tools.filter(e=>!e.dataset).map(e=>{let t=m?.find(t=>e.provider_id===t.id);return{...e,isDeleted:l?.deleted_tools?.some(t=>t.id===e.id&&t.tool_name===e.tool_name),notAuthor:t?.is_team_authorization===!1,..."builtin"===e.provider_type?{provider_id:(0,eF.correctToolProvider)(e.provider_name,!!t),provider_name:(0,eF.correctToolProvider)(e.provider_name,!!t)}:{}}})}:eh.DEFAULT_AGENT_SETTING}})(l?.model_config),v=l?.mode,y=b?.prompt_type===eM.PromptMode.advanced?eM.PromptMode.advanced:eM.PromptMode.simple,j=y===eM.PromptMode.advanced,w=j?b?.chat_prompt_config||(0,eN.clone)(eh.DEFAULT_CHAT_PROMPT_CONFIG):void 0,C=b?.suggested_questions||[],N=b?.more_like_this||{enabled:!1},S=b?.suggested_questions_after_answer||{enabled:!1},T=b?.speech_to_text||{enabled:!1},I=b?.text_to_speech||{enabled:!1,voice:"",language:""},A=b?.retriever_resource||{enabled:!1},k=b?.annotation_reply||{id:"",enabled:!1,score_threshold:eh.ANNOTATION_DEFAULT.score_threshold,embedding_model:{embedding_provider_name:"",embedding_model_name:""}},E=b?.sensitive_word_avoidance||{enabled:!1},M=b?.completion_prompt_config||(0,eN.clone)(eh.DEFAULT_COMPLETION_PROMPT_CONFIG),L={},D=(0,n.useState)({}),{currentModel:R}=(0,eL.useTextGenerationCurrentProviderAndModelAndModelList)({provider:b.provider,model:b.model_id}),U=!!R?.features?.includes(ek.ModelFeatureEnum.vision),q=!!R?.features?.includes(ek.ModelFeatureEnum.document),V=!!R?.features?.includes(ek.ModelFeatureEnum.audio),O=!!R?.features?.includes(ek.ModelFeatureEnum.video),W={enabled:!1,number_limits:2,detail:G.Resolution.low,transfer_methods:[G.TransferMethod.local_file]},K=(0,n.useMemo)(()=>({moreLikeThis:b.more_like_this||{enabled:!1},opening:{enabled:!!b.opening_statement,opening_statement:b.opening_statement||"",suggested_questions:b.suggested_questions||[]},moderation:b.sensitive_word_avoidance||{enabled:!1},speech2text:b.speech_to_text||{enabled:!1},text2speech:b.text_to_speech||{enabled:!1},file:{image:{detail:b.file_upload?.image?.detail||G.Resolution.high,enabled:!!b.file_upload?.image?.enabled,number_limits:b.file_upload?.image?.number_limits||3,transfer_methods:b.file_upload?.image?.transfer_methods||["local_file","remote_url"]},enabled:!!(b.file_upload?.enabled||b.file_upload?.image?.enabled),allowed_file_types:b.file_upload?.allowed_file_types||[],allowed_file_extensions:b.file_upload?.allowed_file_extensions||[...eA.FILE_EXTS[P.SupportUploadFileTypes.image],...eA.FILE_EXTS[P.SupportUploadFileTypes.video]].map(e=>`.${e}`),allowed_file_upload_methods:b.file_upload?.allowed_file_upload_methods||b.file_upload?.image?.transfer_methods||["local_file","remote_url"],number_limits:b.file_upload?.number_limits||b.file_upload?.image?.number_limits||3,fileUploadConfig:{}},suggested:b.suggested_questions_after_answer||{enabled:!1},citation:b.retriever_resource||{enabled:!1},annotationReply:b.annotation_reply||{enabled:!1}}),[b]);if(_)return(0,s.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,s.jsx)(r.default,{type:"area"})});let Q={readonly:!0,appId:t,isAPIKeySet:!0,isTrailFinished:!1,mode:v,modelModeType:"",promptMode:y,isAdvancedMode:j,isAgent:"agent-chat"===v,isOpenAI:!1,isFunctionCall:!1,collectionList:[],setPromptMode:F.noop,canReturnToSimpleMode:!1,setCanReturnToSimpleMode:F.noop,chatPromptConfig:w,completionPromptConfig:M,currentAdvancedPrompt:"",setCurrentAdvancedPrompt:F.noop,conversationHistoriesRole:M.conversation_histories_role,showHistoryModal:!1,setConversationHistoriesRole:F.noop,hasSetBlockStatus:!0,conversationId:"",introduction:"",setIntroduction:F.noop,suggestedQuestions:C,setSuggestedQuestions:F.noop,setConversationId:F.noop,controlClearChatMessage:!1,setControlClearChatMessage:F.noop,prevPromptConfig:{},setPrevPromptConfig:F.noop,moreLikeThisConfig:N,setMoreLikeThisConfig:F.noop,suggestedQuestionsAfterAnswerConfig:S,setSuggestedQuestionsAfterAnswerConfig:F.noop,speechToTextConfig:T,setSpeechToTextConfig:F.noop,textToSpeechConfig:I,setTextToSpeechConfig:F.noop,citationConfig:A,setCitationConfig:F.noop,annotationConfig:k,setAnnotationConfig:F.noop,moderationConfig:E,setModerationConfig:F.noop,externalDataToolsConfig:{},setExternalDataToolsConfig:F.noop,formattingChanged:!1,setFormattingChanged:F.noop,inputs:L,setInputs:F.noop,query:"",setQuery:F.noop,completionParams:D,setCompletionParams:F.noop,modelConfig:b,setModelConfig:F.noop,showSelectDataSet:F.noop,dataSets:g,setDataSets:F.noop,datasetConfigs:[],datasetConfigsRef:{},setDatasetConfigs:F.noop,hasSetContextVar:!0,isShowVisionConfig:U,visionConfig:W,setVisionConfig:F.noop,isAllowVideoUpload:O,isShowDocumentConfig:q,isShowAudioConfig:V,rerankSettingModalOpen:!1,setRerankSettingModalOpen:F.noop};return(0,s.jsx)(eE.default.Provider,{value:Q,children:(0,s.jsx)(eI.FeaturesProvider,{features:K,children:(0,s.jsx)("div",{className:"flex h-full w-full flex-col bg-components-panel-on-panel-item-bg",children:(0,s.jsxs)("div",{className:"relative flex h-[200px] grow",children:[(0,s.jsx)("div",{className:"flex h-full w-full shrink-0 flex-col sm:w-1/2",children:(0,s.jsx)(eS.default,{})}),!a&&(0,s.jsx)("div",{className:"relative flex h-full w-1/2 grow flex-col overflow-y-auto ",style:{borderColor:"rgba(0, 0, 0, 0.02)"},children:(0,s.jsx)("div",{className:"flex grow flex-col rounded-tl-2xl border-l-[0.5px] border-t-[0.5px] border-components-panel-border bg-chatbot-bg ",children:(0,s.jsx)(eT.default,{isAPIKeySet:!0,onSetting:F.noop,inputs:L,modelParameterParams:{setModel:F.noop,onCompletionParamsChange:F.noop},debugWithMultipleModel:!1,multipleModelConfigs:[],onMultipleModelConfigsChange:F.noop})})})]})})})})});var eU=e.i(445924);let eq=n.memo(e=>{let{appId:t,className:a}=e,{data:l,isLoading:n}=m(t);return n?(0,s.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,s.jsx)(r.default,{type:"area"})}):l?(0,s.jsx)("div",{className:"h-full w-full",children:(0,s.jsx)(eU.default,{...l.graph,className:(0,v.cn)(a),miniMapToRight:!0})}):null}),eV=n.memo(e=>{let{appId:t,appDetail:a}=e,l=["agent-chat","chat","completion"].includes(a.mode);return(0,s.jsx)("div",{className:"h-full w-full",children:l?(0,s.jsx)(eR,{appId:t}):(0,s.jsx)(eq,{appId:t,className:"h-full"})})});var eO=e.i(366892),eW=((a={}).TRY="try",a.DETAIL="detail",a);let ez=n.memo(e=>{let{value:t,onChange:a,disableTry:l}=e,{t:r}=(0,g.useTranslation)(),i=n.useMemo(()=>[eh.IS_CLOUD_EDITION?{id:"try",name:r("tryApp.tabHeader.try",{ns:"explore"}),disabled:l}:null,{id:"detail",name:r("tryApp.tabHeader.detail",{ns:"explore"})}].filter(e=>null!==e),[r,l]);return(0,s.jsx)(eO.default,{items:i,value:t,onChange:a,itemClassName:"ml-0 system-md-semibold-uppercase",itemWrapClassName:"pt-2",activeItemClassName:"border-util-colors-blue-brand-blue-brand-500"})}),eK=n.memo(e=>{let{appId:t,app:a,category:d,onClose:p,onCreate:u}=e,{systemFeatures:m}=(0,o.useGlobalPublicStore)(),h=!!(a&&a.can_trial&&m.enable_trial_app),[x,g]=(0,n.useState)(()=>a&&!h?eW.DETAIL:eW.TRY),{data:_,isLoading:b}=c(t);return n.useEffect(()=>{a&&!h&&x!==eW.DETAIL&&g(eW.DETAIL)},[a,h]),(0,s.jsx)(i.default,{isShow:!0,onClose:p,className:"h-[calc(100vh-32px)] min-w-[1280px] max-w-[calc(100vw-32px)] overflow-x-auto p-2",children:b?(0,s.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,s.jsx)(r.default,{type:"area"})}):(0,s.jsxs)("div",{className:"flex h-full flex-col",children:[(0,s.jsxs)("div",{className:"flex shrink-0 justify-between pl-4",children:[(0,s.jsx)(ez,{value:x,onChange:g,disableTry:!!a&&!h}),(0,s.jsx)(f.default,{size:"large",variant:"tertiary",className:"flex size-7 items-center justify-center rounded-[10px] p-0 text-components-button-tertiary-text",onClick:p,children:(0,s.jsx)(l.RiCloseLine,{className:"size-5",onClick:p})})]}),(0,s.jsxs)("div",{className:"mt-2 flex h-0 grow justify-between space-x-2",children:[x===eW.TRY?(0,s.jsx)(eb,{appId:t,appDetail:_}):(0,s.jsx)(eV,{appId:t,appDetail:_}),(0,s.jsx)(eC,{className:"w-[360px] shrink-0",appDetail:_,appId:t,category:d,onCreate:u})]})]})})});e.s(["default",0,eK],787586)}]);
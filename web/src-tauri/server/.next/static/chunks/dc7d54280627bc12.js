(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,517067,e=>{"use strict";var t=e.i(563199),s=e.i(268255),a=e.i(18800),r=e.i(120219);e.i(845780);var n=e.i(95131),l=e.i(390622),i=e.i(935139);let o=s.memo(e=>{let{label:a,value:o,selected:c,nodeData:d,onClick:u}=e,p=(0,n.useToolIcon)(d),m=(0,s.useCallback)(()=>{u?.(o)},[o,u]);return(0,t.jsxs)("div",{className:(0,i.cn)("flex cursor-pointer flex-col gap-1 rounded-xl border border-components-option-card-option-border bg-components-option-card-option-bg p-2.5 shadow-shadow-shadow-3",c?"border-components-option-card-option-selected-border bg-components-option-card-option-selected-bg shadow-xs ring-[0.5px] ring-inset ring-components-option-card-option-selected-border":"hover:bg-components-option-card-bg-hover hover:border-components-option-card-option-border-hover hover:shadow-xs"),onClick:m,children:[(0,t.jsx)("div",{className:"flex size-7 shrink-0 items-center justify-center rounded-lg border-[0.5px] border-components-panel-border bg-background-default-dodge p-1",children:(0,t.jsx)(r.default,{type:l.BlockEnum.DataSource,toolIcon:p})}),(0,t.jsx)("div",{className:(0,i.cn)("system-sm-medium line-clamp-2 grow text-text-secondary",c&&"text-text-primary"),title:a,children:a})]})});e.s(["default",0,e=>{let{dataSourceNodeId:r,onSelect:n}=e,l=(0,a.useDatasourceOptions)(),i=(0,s.useCallback)(e=>{let t=l.find(t=>t.value===e);t&&n({nodeId:t.value,nodeData:t.data})},[n,l]);return(0,s.useEffect)(()=>{l.length>0&&!r&&i(l[0].value)},[]),(0,t.jsx)("div",{className:"grid w-full grid-cols-4 gap-1",children:l.map(e=>(0,t.jsx)(o,{label:e.label,value:e.value,nodeData:e.data,selected:r===e.value,onClick:i},e.value))})}],517067)},396820,e=>{"use strict";var t=e.i(563199),s=e.i(253807);e.i(275225);var a=e.i(705405),r=e.i(837699),n=e.i(268255);e.i(152567);var l=e.i(408767);e.i(845780);var i=e.i(856105);let o=n.memo(()=>{let e=(0,a.useWorkflowStore)(),{t:s}=(0,l.useTranslation)(),{handleCancelDebugAndPreviewPanel:o}=(0,i.useWorkflowInteractions)(),c=(0,n.useCallback)(()=>{let{isPreparingDataSource:t,setIsPreparingDataSource:s}=e.getState();t&&s?.(!1),o()},[e]);return(0,t.jsxs)("div",{className:"flex items-center gap-x-2 pl-4 pr-3 pt-4",children:[(0,t.jsx)("div",{className:"system-xl-semibold grow pl-1 pr-8 text-text-primary",children:s("testRun.title",{ns:"datasetPipeline"})}),(0,t.jsx)("button",{type:"button",className:"flex size-8 shrink-0 items-center justify-center p-1.5",onClick:c,children:(0,t.jsx)(r.RiCloseLine,{className:"size-4 text-text-tertiary"})})]})});var c=e.i(908432);e.i(201987);var d=e.i(207331),u=e.i(396094),p=e.i(867019),m=e.i(503607),x=e.i(443014),h=e.i(199288),f=e.i(556354),g=e.i(654537),b=e.i(648404),v=e.i(151094);let j=n.memo(e=>{let{disabled:s,handleNextStep:a}=e,{t:r}=(0,l.useTranslation)();return(0,t.jsx)("div",{className:"flex justify-end p-4 pt-2",children:(0,t.jsx)(v.default,{disabled:s,variant:"primary",onClick:a,children:(0,t.jsx)("span",{className:"px-0.5",children:r("stepOne.button",{ns:"datasetCreation"})})})})});var y=e.i(517067),_=e.i(870676),w=e.i(849225),N=e.i(390622);let k=n.memo(e=>{let{formParams:s,runDisabled:r,onBack:n}=e,{t:i}=(0,l.useTranslation)(),{form:o,isSubmitting:c,canSubmit:d}=s,u=(0,a.useStore)(e=>e.workflowRunningData),p=u?.result.status===N.WorkflowRunningStatus.Running;return(0,t.jsxs)("div",{className:"flex items-center justify-end gap-x-2 p-4 pt-2",children:[(0,t.jsx)(v.default,{variant:"secondary",onClick:n,children:i("operations.backToDataSource",{ns:"datasetPipeline"})}),(0,t.jsx)(v.default,{variant:"primary",onClick:()=>{o.handleSubmit()},disabled:r||c||!d||p,loading:c||p,children:i("operations.process",{ns:"datasetPipeline"})})]})});var D=e.i(475390),C=e.i(634440),I=e.i(237363),T=e.i(137667);let S=e=>{let{initialData:s,configurations:a,schema:r,CustomActions:n,onSubmit:l}=e,i=(0,C.useAppForm)({defaultValues:s,validators:{onSubmit:e=>{let{value:t}=e,s=r.safeParse(t);if(!s.success){let e=s.error.issues[0],t=`Path: ${e.path.join(".")} Error: ${e.message}`;return T.default.notify({type:"error",message:t}),t}}},onSubmit:e=>{let{value:t}=e;l(t)}});return(0,t.jsxs)("form",{className:"w-full",onSubmit:e=>{e.preventDefault(),e.stopPropagation(),i.handleSubmit()},children:[(0,t.jsx)("div",{className:"flex flex-col gap-3 px-4 pb-6 pt-3",children:a.map((e,a)=>{let r=(0,I.default)({initialData:s,config:e});return(0,t.jsx)(r,{form:i},a)})}),(0,t.jsx)(i.AppForm,{children:(0,t.jsx)(i.Actions,{CustomActions:n})})]})},E=n.memo(e=>{let{dataSourceNodeId:s,onProcess:r,onBack:l}=e,{isFetchingParams:i,paramsConfig:o}=(e=>{let t=(0,a.useStore)(e=>e.pipelineId),{data:s,isFetching:r}=(0,D.useDraftPipelineProcessingParams)({pipeline_id:t,node_id:e});return{isFetchingParams:r,paramsConfig:s}})(s),c=(0,w.useInitialData)(o?.variables||[]),d=(0,w.useConfigurations)(o?.variables||[]),u=(0,_.generateZodSchema)(d),p=(0,n.useCallback)(e=>(0,t.jsx)(k,{runDisabled:i,formParams:e,onBack:l}),[i,l]);return(0,t.jsx)(S,{initialData:c,configurations:d,schema:u,onSubmit:r,CustomActions:p})}),P=n.memo(()=>{let{t:e}=(0,l.useTranslation)();return(0,t.jsx)("div",{className:"system-xs-regular flex grow flex-col justify-end p-4 pt-2 text-text-tertiary",children:e("testRun.tooltip",{ns:"datasetPipeline"})})});var R=e.i(18800),A=e.i(757198),L=e.i(935139);let U=n.memo(e=>{let{currentStep:s,steps:a}=e;return(0,t.jsx)("div",{className:"flex items-center gap-x-2 px-4 pb-2",children:a.map((e,r)=>{let n=r===s-1,l=r===a.length-1;return(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,t.jsxs)("div",{className:(0,L.cn)("flex items-center gap-x-1",n?"text-state-accent-solid":"text-text-tertiary"),children:[n&&(0,t.jsx)("div",{className:"size-1 rounded-full bg-state-accent-solid"}),(0,t.jsx)("span",{className:"system-2xs-semibold-uppercase",children:e.label})]}),!l&&(0,t.jsx)("div",{className:"flex items-center",children:(0,t.jsx)(A.default,{type:"horizontal",className:"h-px w-3 bg-divider-deep"})})]},r)})})}),W=n.memo(()=>{let{localFileList:e,onlineDocuments:s,websitePages:r,selectedFileIds:l}=(0,x.useDataSourceStoreWithSelector)((0,c.useShallow)(e=>({localFileList:e.localFileList,onlineDocuments:e.onlineDocuments,websitePages:e.websitePages,selectedFileIds:e.selectedFileIds}))),i=(0,a.useWorkflowStore)(),o=(0,x.useDataSourceStore)(),[v,_]=(0,n.useState)(),{steps:w,currentStep:N,handleNextStep:k,handleBackStep:D}=(0,R.useTestRunSteps)(),{clearOnlineDocumentData:C}=(0,R.useOnlineDocument)(),{clearWebsiteCrawlData:I}=(0,R.useWebsiteCrawl)(),{clearOnlineDriveData:T}=(0,R.useOnlineDrive)(),S=v?.nodeData.provider_type,A=(0,n.useMemo)(()=>!v||(S===g.DatasourceType.localFile?!e.length||e.some(e=>!e.file.id):S===g.DatasourceType.onlineDocument?!s.length:S===g.DatasourceType.websiteCrawl?!r.length:S===g.DatasourceType.onlineDrive&&!l.length),[v,S,e,s.length,l.length,r.length]),{handleRun:L}=(0,f.useWorkflowRun)(),W=(0,n.useCallback)(e=>{if(!v)return;let t=[],s=o.getState().currentCredentialId;if(S===g.DatasourceType.localFile){let{localFileList:e}=o.getState(),{id:s,name:a,type:r,size:n,extension:l,mime_type:i}=e[0].file,c={related_id:s,name:a,type:r,size:n,extension:l,mime_type:i,url:"",transfer_method:b.TransferMethod.local_file};t.push(c)}if(S===g.DatasourceType.onlineDocument){let{onlineDocuments:e}=o.getState(),{workspace_id:a,...r}=e[0];t.push({workspace_id:a,page:r,credential_id:s})}if(S===g.DatasourceType.websiteCrawl){let{websitePages:e}=o.getState();t.push({...e[0],credential_id:s})}if(S===g.DatasourceType.onlineDrive){let{bucket:e,onlineDriveFileList:a,selectedFileIds:r}=o.getState(),n=a.find(e=>e.id===r[0]);t.push({bucket:e,id:n?.id,name:n?.name,type:n?.type,credential_id:s})}let{setIsPreparingDataSource:a}=i.getState();L({inputs:e,start_node_id:v.nodeId,datasource_type:S,datasource_info_list:t}),(0,d.trackEvent)("pipeline_start_action_time",{action_type:"document_processing"}),a?.(!1)},[o,v,S,L,i]),F=(0,n.useCallback)(e=>{e.nodeData.provider_type===g.DatasourceType.onlineDocument?C():e.nodeData.provider_type===g.DatasourceType.websiteCrawl?I():e.nodeData.provider_type===g.DatasourceType.onlineDrive&&T()},[C,T,I]),M=(0,n.useCallback)(e=>{let{setCurrentCredentialId:t,currentNodeIdRef:s}=o.getState();F(e),t(""),s.current=e.nodeId,_(e)},[F,o]),G=(0,n.useCallback)(e=>{let{setCurrentCredentialId:t}=o.getState();F(v),t(e)},[F,o,v]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(U,{steps:w,currentStep:N}),(0,t.jsxs)("div",{className:"flex grow flex-col overflow-y-auto",children:[1===N&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex flex-col gap-y-4 px-4 py-2",children:[(0,t.jsx)(y.default,{dataSourceNodeId:v?.nodeId||"",onSelect:M}),S===g.DatasourceType.localFile&&(0,t.jsx)(u.default,{allowedExtensions:v.nodeData.fileExtensions||[],supportBatchUpload:!1}),S===g.DatasourceType.onlineDocument&&(0,t.jsx)(p.default,{nodeId:v.nodeId,nodeData:v.nodeData,isInPipeline:!0,onCredentialChange:G,supportBatchUpload:!1}),S===g.DatasourceType.websiteCrawl&&(0,t.jsx)(h.default,{nodeId:v.nodeId,nodeData:v.nodeData,isInPipeline:!0,onCredentialChange:G,supportBatchUpload:!1}),S===g.DatasourceType.onlineDrive&&(0,t.jsx)(m.default,{nodeId:v.nodeId,nodeData:v.nodeData,isInPipeline:!0,onCredentialChange:G,supportBatchUpload:!1})]}),(0,t.jsx)(j,{disabled:A,handleNextStep:k}),(0,t.jsx)(P,{})]}),2===N&&(0,t.jsx)(E,{dataSourceNodeId:v.nodeId,onProcess:W,onBack:D})]})]})});var F=e.i(449980),M=e.i(739780),G=e.i(567898),B=e.i(925521),K=e.i(74548),V=e.i(621379);let z=n.memo(e=>{let{isRunning:s,outputs:a,error:i,onSwitchToDetail:o}=e,{t:c}=(0,l.useTranslation)(),d=(0,n.useMemo)(()=>(e=>{if(!e)return;let t=e.chunk_structure,s=e.parent_mode;if(t===V.ChunkingMode.text){let t;return t=[],e.preview.slice(0,B.RAG_PIPELINE_PREVIEW_CHUNK_NUM).forEach(e=>{t.push({content:e.content,summary:e.summary})}),t}if(t===V.ChunkingMode.parentChild){let t,a;return t={parent_child_chunks:[],parent_mode:s},a=e.preview,"paragraph"===s&&a.slice(0,B.RAG_PIPELINE_PREVIEW_CHUNK_NUM).forEach(e=>{t.parent_child_chunks?.push({parent_content:e.content,parent_summary:e.summary,child_contents:e.child_chunks,parent_mode:s})}),"full-doc"===s&&a.forEach(e=>{t.parent_child_chunks?.push({parent_content:e.content,child_contents:e.child_chunks.slice(0,B.RAG_PIPELINE_PREVIEW_CHUNK_NUM),parent_mode:s})}),t}if(t===V.ChunkingMode.qa){let t;return t={qa_chunks:[]},e.qa_preview.slice(0,B.RAG_PIPELINE_PREVIEW_CHUNK_NUM).forEach(e=>{t.qa_chunks?.push({...e})}),t}})(a),[a]);return(0,t.jsxs)(t.Fragment,{children:[s&&!a&&(0,t.jsxs)("div",{className:"flex grow flex-col items-center justify-center gap-y-2 pb-20",children:[(0,t.jsx)(r.RiLoader2Line,{className:"size-4 animate-spin text-text-tertiary"}),(0,t.jsx)("div",{className:"system-sm-regular text-text-tertiary",children:c("result.resultPreview.loading",{ns:"pipeline"})})]}),!s&&i&&(0,t.jsxs)("div",{className:"flex grow flex-col items-center justify-center gap-y-2 pb-20",children:[(0,t.jsx)("div",{className:"system-sm-regular text-text-tertiary",children:c("result.resultPreview.error",{ns:"pipeline"})}),(0,t.jsx)(v.default,{onClick:o,children:c("result.resultPreview.viewDetails",{ns:"pipeline"})})]}),a&&d&&(0,t.jsxs)("div",{className:"flex grow flex-col bg-background-body p-1",children:[(0,t.jsx)(K.ChunkCardList,{chunkType:a.chunk_structure,chunkInfo:d}),(0,t.jsxs)("div",{className:"system-xs-regular mt-1 flex items-center gap-x-2 text-text-tertiary",children:[(0,t.jsx)("div",{className:"h-px flex-1 bg-gradient-to-r from-background-gradient-mask-transparent to-divider-regular"}),(0,t.jsx)("span",{className:"shrink-0truncate",title:c("result.resultPreview.footerTip",{ns:"pipeline",count:B.RAG_PIPELINE_PREVIEW_CHUNK_NUM}),children:c("result.resultPreview.footerTip",{ns:"pipeline",count:B.RAG_PIPELINE_PREVIEW_CHUNK_NUM})}),(0,t.jsx)("div",{className:"h-px flex-1 bg-gradient-to-l from-background-gradient-mask-transparent to-divider-regular"})]})]})]})}),H=n.memo(e=>{let{isActive:s,label:a,value:r,workflowRunningData:l,onClick:i}=e,o=(0,n.useCallback)(()=>{i(r)},[r,i]);return(0,t.jsx)("button",{type:"button",className:(0,L.cn)("system-sm-semibold-uppercase cursor-pointer border-b-2 border-transparent py-3 text-text-tertiary",s&&"border-util-colors-blue-brand-blue-brand-600 text-text-primary",!l&&"!cursor-not-allowed opacity-30"),onClick:o,disabled:!l,children:a})}),O=n.memo(e=>{let{currentTab:s,workflowRunningData:a,switchTab:r}=e,{t:n}=(0,l.useTranslation)();return(0,t.jsxs)("div",{className:"flex shrink-0 items-center gap-x-6 border-b-[0.5px] border-divider-subtle px-4",children:[(0,t.jsx)(H,{isActive:"RESULT"===s,label:n("result",{ns:"runLog"}),value:"RESULT",workflowRunningData:a,onClick:r}),(0,t.jsx)(H,{isActive:"DETAIL"===s,label:n("detail",{ns:"runLog"}),value:"DETAIL",workflowRunningData:a,onClick:r}),(0,t.jsx)(H,{isActive:"TRACING"===s,label:n("tracing",{ns:"runLog"}),value:"TRACING",workflowRunningData:a,onClick:r})]})}),q=(0,n.memo)(()=>{let e=(0,a.useStore)(e=>e.workflowRunningData),[s,r]=(0,n.useState)("RESULT"),l=async e=>{r(e)};return(0,t.jsxs)("div",{className:"flex grow flex-col",children:[(0,t.jsx)(O,{currentTab:s,workflowRunningData:e,switchTab:l}),(0,t.jsxs)("div",{className:"flex h-0 grow flex-col overflow-y-auto",children:["RESULT"===s&&(0,t.jsx)(z,{isRunning:!e?.result||e?.result.status===N.WorkflowRunningStatus.Running,outputs:e?.result?.outputs,error:e?.result?.error,onSwitchToDetail:()=>l("DETAIL")}),"DETAIL"===s&&(0,t.jsx)(M.default,{inputs:e?.result?.inputs,outputs:e?.result?.outputs,status:e?.result?.status||"",error:e?.result?.error,elapsed_time:e?.result?.elapsed_time,total_tokens:e?.result?.total_tokens,created_at:e?.result?.created_at,created_by:e?.result?.created_by?.name,steps:e?.result?.total_steps,exceptionCounts:e?.result?.exceptions_count}),"DETAIL"===s&&!e?.result&&(0,t.jsx)("div",{className:"flex grow items-center justify-center",children:(0,t.jsx)(F.default,{})}),"TRACING"===s&&(0,t.jsx)(G.default,{className:"bg-background-section-burn",list:e?.tracing||[]}),"TRACING"===s&&!e?.tracing?.length&&(0,t.jsx)("div",{className:"flex grow items-center justify-center",children:(0,t.jsx)(F.default,{})})]})]})});e.s(["default",0,()=>{let e=(0,a.useStore)(e=>e.isPreparingDataSource);return(0,t.jsxs)("div",{className:"relative flex h-full w-[480px] flex-col rounded-l-2xl border-y-[0.5px] border-l-[0.5px] border-components-panel-border bg-components-panel-bg shadow-xl shadow-shadow-shadow-1",children:[(0,t.jsx)(o,{}),e?(0,t.jsx)(s.default,{children:(0,t.jsx)(W,{})}):(0,t.jsx)(q,{})]})}],396820)},663443,e=>{e.n(e.i(396820))}]);
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,410893,e=>{"use strict";var t=e.i(797181);e.s(["ArrowUpRight",()=>t.default])},462505,e=>{e.v({icon:{type:"element",isRootNode:!0,name:"svg",attributes:{width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg"},children:[{type:"element",name:"g",attributes:{id:"book-open-01"},children:[{type:"element",name:"path",attributes:{id:"Fill",opacity:"0.12",d:"M1 3.1C1 2.53995 1 2.25992 1.10899 2.04601C1.20487 1.85785 1.35785 1.70487 1.54601 1.60899C1.75992 1.5 2.03995 1.5 2.6 1.5H2.8C3.9201 1.5 4.48016 1.5 4.90798 1.71799C5.28431 1.90973 5.59027 2.21569 5.78201 2.59202C6 3.01984 6 3.5799 6 4.7V10.5L5.94997 10.425C5.60265 9.90398 5.42899 9.64349 5.19955 9.45491C4.99643 9.28796 4.76238 9.1627 4.5108 9.0863C4.22663 9 3.91355 9 3.28741 9H2.6C2.03995 9 1.75992 9 1.54601 8.89101C1.35785 8.79513 1.20487 8.64215 1.10899 8.45399C1 8.24008 1 7.96005 1 7.4V3.1Z",fill:"currentColor"},children:[]},{type:"element",name:"path",attributes:{id:"Icon",d:"M6 10.5L5.94997 10.425C5.60265 9.90398 5.42899 9.64349 5.19955 9.45491C4.99643 9.28796 4.76238 9.1627 4.5108 9.0863C4.22663 9 3.91355 9 3.28741 9H2.6C2.03995 9 1.75992 9 1.54601 8.89101C1.35785 8.79513 1.20487 8.64215 1.10899 8.45399C1 8.24008 1 7.96005 1 7.4V3.1C1 2.53995 1 2.25992 1.10899 2.04601C1.20487 1.85785 1.35785 1.70487 1.54601 1.60899C1.75992 1.5 2.03995 1.5 2.6 1.5H2.8C3.9201 1.5 4.48016 1.5 4.90798 1.71799C5.28431 1.90973 5.59027 2.21569 5.78201 2.59202C6 3.01984 6 3.5799 6 4.7M6 10.5V4.7M6 10.5L6.05003 10.425C6.39735 9.90398 6.57101 9.64349 6.80045 9.45491C7.00357 9.28796 7.23762 9.1627 7.4892 9.0863C7.77337 9 8.08645 9 8.71259 9H9.4C9.96005 9 10.2401 9 10.454 8.89101C10.6422 8.79513 10.7951 8.64215 10.891 8.45399C11 8.24008 11 7.96005 11 7.4V3.1C11 2.53995 11 2.25992 10.891 2.04601C10.7951 1.85785 10.6422 1.70487 10.454 1.60899C10.2401 1.5 9.96005 1.5 9.4 1.5H9.2C8.07989 1.5 7.51984 1.5 7.09202 1.71799C6.71569 1.90973 6.40973 2.21569 6.21799 2.59202C6 3.01984 6 3.5799 6 4.7",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round"},children:[]}]}]},name:"BookOpen01"})},50874,258703,e=>{"use strict";var t=e.i(563199),a=e.i(807324),n=e.i(462505);let s=e=>{let{ref:s,...o}=e;return(0,t.jsx)(a.default,{...o,ref:s,data:n.default})};s.displayName="BookOpen01",e.s([],50874),e.s(["BookOpen01",0,s],258703)},963636,e=>{"use strict";var t=e.i(563199),a=e.i(837699),n=e.i(268255);e.i(152567);var s=e.i(408767);e.i(668763);var o=e.i(410893),r=e.i(391185),i=e.i(59375),l=e.i(296124),d=e.i(652669);e.s(["default",0,e=>{let{value:c,onChange:p}=e,{t:m}=(0,s.useTranslation)(),[x,u]=(0,n.useState)(!1),{setShowAccountSettingModal:f,setShowApiBasedExtensionModal:g}=(0,l.useModalContext)(),{data:h,refetch:b}=(0,d.useApiBasedExtensions)(),y=h?.find(e=>e.id===c);return(0,t.jsxs)(r.PortalToFollowElem,{open:x,onOpenChange:u,placement:"bottom-start",offset:4,children:[(0,t.jsx)(r.PortalToFollowElemTrigger,{onClick:()=>u(e=>!e),className:"w-full",children:y?(0,t.jsxs)("div",{className:"flex h-9 cursor-pointer items-center justify-between rounded-lg bg-components-input-bg-normal pl-3 pr-2.5",children:[(0,t.jsx)("div",{className:"text-sm text-text-primary",children:y.name}),(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"mr-1.5 w-[270px] truncate text-right text-xs text-text-quaternary",children:y.api_endpoint}),(0,t.jsx)(a.RiArrowDownSLine,{className:`h-4 w-4 text-text-secondary ${!x&&"opacity-60"}`})]})]}):(0,t.jsxs)("div",{className:"flex h-9 cursor-pointer items-center justify-between rounded-lg bg-components-input-bg-normal pl-3 pr-2.5 text-sm text-text-quaternary",children:[m("apiBasedExtension.selector.placeholder",{ns:"common"}),(0,t.jsx)(a.RiArrowDownSLine,{className:`h-4 w-4 text-text-secondary ${!x&&"opacity-60"}`})]})}),(0,t.jsx)(r.PortalToFollowElemContent,{className:"z-[102] w-[calc(100%-32px)] max-w-[576px]",children:(0,t.jsxs)("div",{className:"z-10 w-full rounded-lg border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-lg",children:[(0,t.jsxs)("div",{className:"p-1",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-3 pb-1 pt-2",children:[(0,t.jsx)("div",{className:"text-xs font-medium text-text-tertiary",children:m("apiBasedExtension.selector.title",{ns:"common"})}),(0,t.jsxs)("div",{className:"flex cursor-pointer items-center text-xs text-text-accent",onClick:()=>{u(!1),f({payload:i.ACCOUNT_SETTING_TAB.API_BASED_EXTENSION})},children:[m("apiBasedExtension.selector.manage",{ns:"common"}),(0,t.jsx)(o.ArrowUpRight,{className:"ml-0.5 h-3 w-3"})]})]}),(0,t.jsx)("div",{className:"max-h-[250px] overflow-y-auto",children:h?.map(e=>(0,t.jsxs)("div",{className:"w-full cursor-pointer rounded-md px-3 py-1.5 text-left hover:stroke-state-base-hover",onClick:()=>{p(e.id),u(!1)},children:[(0,t.jsx)("div",{className:"text-sm text-text-primary",children:e.name}),(0,t.jsx)("div",{className:"text-xs text-text-tertiary",children:e.api_endpoint})]},e.id))})]}),(0,t.jsx)("div",{className:"h-px bg-divider-regular"}),(0,t.jsx)("div",{className:"p-1",children:(0,t.jsxs)("div",{className:"flex h-8 cursor-pointer items-center px-3 text-sm text-text-accent",onClick:()=>{u(!1),g({payload:{},onSaveCallback:()=>b()})},children:[(0,t.jsx)(a.RiAddLine,{className:"mr-2 h-4 w-4"}),m("operation.add",{ns:"common"})]})})]})})]})}])},740083,e=>{"use strict";var t=e.i(563199),a=e.i(299951),n=e.i(873517),s=e.i(683257);e.s(["default",0,e=>{let{forms:o,value:r,onChange:i}=e,l=(0,s.useLocale)(),d=(e,t)=>{i({...r,[e]:t})};return(0,t.jsx)(t.Fragment,{children:o.map((e,s)=>(0,t.jsxs)("div",{className:"py-2",children:[(0,t.jsx)("div",{className:"flex h-9 items-center text-sm font-medium text-text-primary",children:"zh-Hans"===l?e.label["zh-Hans"]:e.label["en-US"]}),"text-input"===e.type&&(0,t.jsx)("input",{value:r?.[e.variable]||"",className:"block h-9 w-full appearance-none rounded-lg bg-components-input-bg-normal px-3 text-sm text-text-primary outline-none",placeholder:e.placeholder,onChange:t=>d(e.variable,t.target.value)}),"paragraph"===e.type&&(0,t.jsx)("div",{className:"relative",children:(0,t.jsx)(n.default,{className:"resize-none",value:r?.[e.variable]||"",placeholder:e.placeholder,onChange:t=>d(e.variable,t.target.value)})}),"select"===e.type&&(0,t.jsx)(a.PortalSelect,{value:r?.[e.variable],items:e.options.map(e=>({name:e.label["zh-Hans"===l?"zh-Hans":"en-US"],value:e.value})),onSelect:t=>d(e.variable,t.value),popupClassName:"w-[576px] !z-[102]"})]},s))})}])},139574,e=>{"use strict";var t=e.i(563199),a=e.i(837699),n=e.i(124836),s=e.i(268255);e.i(152567);var o=e.i(408767),r=e.i(151094),i=e.i(757198);e.i(50874);var l=e.i(258703);e.i(47690);var d=e.i(218043),d=d,c=e.i(21151),p=e.i(137667),m=e.i(963636),x=e.i(59375),u=e.i(739255),f=e.i(683257),g=e.i(296124),h=e.i(491234),b=e.i(652669),y=e.i(935139),v=e.i(740083),j=e.i(260484);let N=e=>{let{title:a,info:n,showPreset:s=!0,config:r,onConfigChange:i}=e,{t:l}=(0,o.useTranslation)(),d=(e,t)=>{"preset_response"===e&&"string"==typeof t&&(t=t.slice(0,100)),i({...r,[e]:t})};return(0,t.jsx)("div",{className:"py-2",children:(0,t.jsxs)("div",{className:"rounded-lg border border-components-panel-border bg-components-panel-bg",children:[(0,t.jsxs)("div",{className:"flex h-10 items-center justify-between rounded-lg px-3",children:[(0,t.jsx)("div",{className:"shrink-0 text-sm font-medium text-text-primary",children:a}),(0,t.jsxs)("div",{className:"flex grow items-center justify-end",children:[n&&(0,t.jsx)("div",{className:"mr-2 truncate text-xs text-text-tertiary",title:n,children:n}),(0,t.jsx)(j.default,{size:"l",defaultValue:r.enabled,onChange:e=>d("enabled",e)})]})]}),r.enabled&&s&&(0,t.jsxs)("div",{className:"rounded-lg bg-components-panel-bg px-3 pb-3 pt-1",children:[(0,t.jsxs)("div",{className:"flex h-8 items-center justify-between text-[13px] font-medium text-text-secondary",children:[l("feature.moderation.modal.content.preset",{ns:"appDebug"}),(0,t.jsx)("span",{className:"text-xs font-normal text-text-tertiary",children:l("feature.moderation.modal.content.supportMarkdown",{ns:"appDebug"})})]}),(0,t.jsxs)("div",{className:"relative h-20 rounded-lg bg-components-input-bg-normal px-3 py-2",children:[(0,t.jsx)("textarea",{value:r.preset_response||"",className:"block h-full w-full resize-none appearance-none bg-transparent text-sm text-text-secondary outline-none",placeholder:l("feature.moderation.modal.content.placeholder",{ns:"appDebug"})||"",onChange:e=>d("preset_response",e.target.value)}),(0,t.jsxs)("div",{className:"absolute bottom-2 right-2 flex h-5 items-center rounded-md bg-background-section px-1 text-xs font-medium text-text-quaternary",children:[(0,t.jsx)("span",{children:(r.preset_response||"").length}),"/",(0,t.jsx)("span",{className:"text-text-tertiary",children:"100"})]})]})]})]})})},C=["openai_moderation","keywords","api"];e.s(["default",0,e=>{let{data:j,onCancel:_,onSave:w}=e,{t:k}=(0,o.useTranslation)(),D=(0,f.useDocLink)(),{notify:E}=(0,p.useToastContext)(),S=(0,f.useLocale)(),{data:T,isPending:B,refetch:A}=(0,b.useModelProviders)(),[z,O]=(0,s.useState)(j),{setShowAccountSettingModal:P}=(0,g.useModalContext)(),{data:R}=(0,b.useCodeBasedExtensions)("moderation"),H=T?.data.find(e=>"langgenius/openai/openai"===e.provider),L=H?.system_configuration.enabled?H?.system_configuration.quota_configurations.find(e=>e.quota_type===H.system_configuration.current_quota_type):void 0,I=L?.is_valid,M=H?.custom_configuration.status===u.CustomConfigurationStatusEnum.active||I,q=[{key:"openai_moderation",name:k("feature.moderation.modal.provider.openai",{ns:"appDebug"})},{key:"keywords",name:k("feature.moderation.modal.provider.keywords",{ns:"appDebug"})},{key:"api",name:k("apiBasedExtension.selector.title",{ns:"common"})},...R?R.data.map(e=>({key:e.name,name:"zh-Hans"===S?e.label["zh-Hans"]:e.label["en-US"],form_schema:e.form_schema})):[]],F=q.find(e=>e.key===z.type),U=(e,t)=>{O({...z,config:{...z.config,[e]:t}})};return(0,t.jsxs)(c.default,{isShow:!0,onClose:n.noop,className:"!mt-14 !w-[600px] !max-w-none !p-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("div",{className:"title-2xl-semi-bold text-text-primary",children:k("feature.moderation.modal.title",{ns:"appDebug"})}),(0,t.jsx)("div",{className:"cursor-pointer p-1",onClick:_,children:(0,t.jsx)(a.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})})]}),(0,t.jsxs)("div",{className:"py-2",children:[(0,t.jsx)("div",{className:"text-sm font-medium leading-9 text-text-primary",children:k("feature.moderation.modal.provider.title",{ns:"appDebug"})}),(0,t.jsx)("div",{className:"grid grid-cols-3 gap-2.5",children:q.map(e=>(0,t.jsxs)("div",{className:(0,y.cn)("system-sm-regular flex h-8 cursor-default items-center rounded-md border border-components-option-card-option-border bg-components-option-card-option-bg px-2 text-text-secondary",z.type!==e.key&&"cursor-pointer hover:border-components-option-card-option-border-hover hover:bg-components-option-card-option-bg-hover hover:shadow-xs",z.type===e.key&&"system-sm-medium border-[1.5px] border-components-option-card-option-selected-border bg-components-option-card-option-selected-bg shadow-xs","openai_moderation"===z.type&&"openai_moderation"===e.key&&!M&&"text-text-disabled"),onClick:()=>{var t;let a,n;return t=e.key,n=q.find(e=>e.key===t),void(0>C.findIndex(e=>e===t)&&n?.form_schema&&(a=n?.form_schema.reduce((e,t)=>(e[t.variable]=t.default,e),{})),O({...z,type:t,config:a}))},children:[(0,t.jsx)("div",{className:(0,y.cn)("mr-2 h-4 w-4 rounded-full border border-components-radio-border bg-components-radio-bg shadow-xs",z.type===e.key&&"border-[5px] border-components-radio-border-checked")}),e.name]},e.key))}),!B&&!M&&"openai_moderation"===z.type&&(0,t.jsxs)("div",{className:"mt-2 flex items-center rounded-lg border border-[#FEF0C7] bg-[#FFFAEB] px-3 py-2",children:[(0,t.jsx)(d.default,{className:"mr-1 h-4 w-4 text-[#F79009]"}),(0,t.jsxs)("div",{className:"flex items-center text-xs font-medium text-gray-700",children:[k("feature.moderation.modal.openaiNotConfig.before",{ns:"appDebug"}),(0,t.jsxs)("span",{className:"cursor-pointer text-primary-600",onClick:()=>{P({payload:x.ACCOUNT_SETTING_TAB.PROVIDER,onCancelCallback:()=>{A()}})},children:[" ",k("settings.provider",{ns:"common"})," "]}),k("feature.moderation.modal.openaiNotConfig.after",{ns:"appDebug"})]})]})]}),"keywords"===z.type&&(0,t.jsxs)("div",{className:"py-2",children:[(0,t.jsx)("div",{className:"mb-1 text-sm font-medium text-text-primary",children:k("feature.moderation.modal.provider.keywords",{ns:"appDebug"})}),(0,t.jsx)("div",{className:"mb-2 text-xs text-text-tertiary",children:k("feature.moderation.modal.keywords.tip",{ns:"appDebug"})}),(0,t.jsxs)("div",{className:"relative h-[88px] rounded-lg bg-components-input-bg-normal px-3 py-2",children:[(0,t.jsx)("textarea",{value:z.config?.keywords||"",onChange:e=>{let t=e.target.value.split("\n").reduce((e,t)=>(""!==t&&e.push(t.slice(0,100)),""===t&&""!==e[e.length-1]&&e.push(t),e),[]);O({...z,config:{...z.config,keywords:t.slice(0,100).join("\n")}})},className:"block h-full w-full resize-none appearance-none bg-transparent text-sm text-text-secondary outline-none",placeholder:k("feature.moderation.modal.keywords.placeholder",{ns:"appDebug"})||""}),(0,t.jsxs)("div",{className:"absolute bottom-2 right-2 flex h-5 items-center rounded-md bg-background-section px-1 text-xs font-medium text-text-quaternary",children:[(0,t.jsx)("span",{children:(z.config?.keywords||"").split("\n").filter(Boolean).length}),"/",(0,t.jsxs)("span",{className:"text-text-tertiary",children:["100",k("feature.moderation.modal.keywords.line",{ns:"appDebug"})]})]})]})]}),"api"===z.type&&(0,t.jsxs)("div",{className:"py-2",children:[(0,t.jsxs)("div",{className:"flex h-9 items-center justify-between",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-text-primary",children:k("apiBasedExtension.selector.title",{ns:"common"})}),(0,t.jsxs)("a",{href:D("/use-dify/workspace/api-extension/api-extension"),target:"_blank",rel:"noopener noreferrer",className:"group flex items-center text-xs text-text-tertiary hover:text-primary-600",children:[(0,t.jsx)(l.BookOpen01,{className:"mr-1 h-3 w-3 text-text-tertiary group-hover:text-primary-600"}),k("apiBasedExtension.link",{ns:"common"})]})]}),(0,t.jsx)(m.default,{value:z.config?.api_based_extension_id||"",onChange:e=>{O({...z,config:{...z.config,api_based_extension_id:e}})}})]}),0>C.findIndex(e=>e===z.type)&&F?.form_schema&&(0,t.jsx)(v.default,{forms:F?.form_schema,value:z.config,onChange:e=>{O({...z,config:{...z.config,...e}})}}),(0,t.jsx)(i.default,{bgStyle:"gradient",className:"my-3 h-px"}),(0,t.jsx)(N,{title:k("feature.moderation.modal.content.input",{ns:"appDebug"})||"",config:z.config?.inputs_config||{enabled:!1,preset_response:""},onConfigChange:e=>U("inputs_config",e),info:"api"===z.type&&k("feature.moderation.modal.content.fromApi",{ns:"appDebug"})||"",showPreset:"api"!==z.type}),(0,t.jsx)(N,{title:k("feature.moderation.modal.content.output",{ns:"appDebug"})||"",config:z.config?.outputs_config||{enabled:!1,preset_response:""},onConfigChange:e=>U("outputs_config",e),info:"api"===z.type&&k("feature.moderation.modal.content.fromApi",{ns:"appDebug"})||"",showPreset:"api"!==z.type}),(0,t.jsx)("div",{className:"mb-8 mt-1 text-xs font-medium text-text-tertiary",children:k("feature.moderation.modal.content.condition",{ns:"appDebug"})}),(0,t.jsxs)("div",{className:"flex items-center justify-end",children:[(0,t.jsx)(r.default,{onClick:_,className:"mr-2",children:k("operation.cancel",{ns:"common"})}),(0,t.jsx)(r.default,{variant:"primary",onClick:()=>{if("openai_moderation"!==z.type||M){if(!z.config?.inputs_config?.enabled&&!z.config?.outputs_config?.enabled)return void E({type:"error",message:k("feature.moderation.modal.content.condition",{ns:"appDebug"})});if("keywords"===z.type&&!z.config.keywords)return void E({type:"error",message:k("errorMessage.valueOfVarRequired",{ns:"appDebug",key:S!==h.LanguagesSupported[1]?"keywords":"关键词"})});if("api"===z.type&&!z.config.api_based_extension_id)return void E({type:"error",message:k("errorMessage.valueOfVarRequired",{ns:"appDebug",key:S!==h.LanguagesSupported[1]?"API Extension":"API 扩展"})});if(0>C.findIndex(e=>e===z.type)&&F?.form_schema){for(let e=0;e<F.form_schema.length;e++)if(!z.config?.[F.form_schema[e].variable]&&F.form_schema[e].required)return void E({type:"error",message:k("errorMessage.valueOfVarRequired",{ns:"appDebug",key:S!==h.LanguagesSupported[1]?F.form_schema[e].label["en-US"]:F.form_schema[e].label["zh-Hans"]})})}if(z.config.inputs_config?.enabled&&!z.config.inputs_config.preset_response&&"api"!==z.type||z.config.outputs_config?.enabled&&!z.config.outputs_config.preset_response&&"api"!==z.type)return void E({type:"error",message:k("feature.moderation.modal.content.errorMessage",{ns:"appDebug"})});w((e=>{let{enabled:t,type:a,config:n}=e,{inputs_config:s,outputs_config:o}=n,r={};return"keywords"===a&&(r.keywords=n?.keywords),"api"===a&&(r.api_based_extension_id=n?.api_based_extension_id),0>C.findIndex(e=>e===a)&&F?.form_schema&&F.form_schema.forEach(e=>{r[e.variable]=n?.[e.variable]}),{type:a,enabled:t,config:{inputs_config:s||{enabled:!1},outputs_config:o||{enabled:!1},...r}}})(z))}},disabled:"openai_moderation"===z.type&&!M,children:k("operation.save",{ns:"common"})})]})]})}],139574)},157154,e=>{e.n(e.i(139574))}]);
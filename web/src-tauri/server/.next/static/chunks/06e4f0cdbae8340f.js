(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,261484,e=>{"use strict";var t=e.i(268255),s={SVG:"image/svg+xml",ICO:"image/x-icon",GIF:"image/gif",PNG:"image/png"};let a=function(e){(0,t.useEffect)(function(){if(e){var t=e.split("."),a=t[t.length-1].toLocaleUpperCase(),i=document.querySelector("link[rel*='icon']")||document.createElement("link");i.type=s[a],i.href=e,i.rel="shortcut icon",document.getElementsByTagName("head")[0].appendChild(i)}},[e])};var i=e.i(685888),n=e.i(354440),r={restoreOnUnmount:!1};let l=function(e,s){void 0===s&&(s=r);var a=(0,t.useRef)(n.default?document.title:"");(0,t.useEffect)(function(){document.title=e},[e]),(0,i.default)(function(){s.restoreOnUnmount&&(document.title=a.current)})};var o=e.i(494268),c=e.i(168014);function d(e){let s=(0,o.useIsSystemFeaturesPending)(),i=(0,o.useGlobalPublicStore)(e=>e.systemFeatures),n=e?`${e} - `:"",r="",d="";!1===s&&(i.branding.enabled?(r=`${n}${i.branding.application_title}`,d=i.branding.favicon):(r=`${n}Dify`,d=`${c.basePath}/favicon.ico`)),l(r),(0,t.useEffect)(()=>{let e=null;return i.branding.favicon&&(document.querySelectorAll("link[rel='icon'], link[rel='shortcut icon'], link[rel='apple-touch-icon'], link[rel='mask-icon']").forEach(e=>e.parentNode?.removeChild(e)),(e=document.createElement("link")).rel="apple-touch-icon",e.href=i.branding.favicon,document.head.appendChild(e)),()=>{e?.remove()}},[i.branding.favicon]),a(d)}e.s(["default",()=>d],261484)},612437,(e,t,s)=>{e.e,t.exports=function(e,t,s){e=e||{};var a=t.prototype,i={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function n(e,t,s,i){return a.fromToBase(e,t,s,i)}s.en.relativeTime=i,a.fromToBase=function(t,a,n,r,l){for(var o,c,d,m=n.$locale().relativeTime||i,u=e.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],p=u.length,x=0;x<p;x+=1){var h=u[x];h.d&&(o=r?s(t).diff(n,h.d,!0):n.diff(t,h.d,!0));var g=(e.rounding||Math.round)(Math.abs(o));if(d=o>0,g<=h.r||!h.r){g<=1&&x>0&&(h=u[x-1]);var f=m[h.l];l&&(g=l(""+g)),c="string"==typeof f?f.replace("%d",g):f(g,a,h.l,d);break}}if(a)return c;var y=d?m.future:m.past;return"function"==typeof y?y(c):y.replace("%s",c)},a.to=function(e,t){return n(e,t,this,!0)},a.from=function(e,t){return n(e,t,this)};var r=function(e){return e.$u?s.utc():s()};a.toNow=function(e){return this.to(r(this),e)},a.fromNow=function(e){return this.from(r(this),e)}}},363372,e=>{"use strict";var t=e.i(585458),s=e.i(612437),a=e.i(268255),i=e.i(683257),n=e.i(491234);e.i(341888),e.i(194663),e.i(726767),e.i(171457),e.i(271967),e.i(429863),e.i(659291),e.i(690397),e.i(732213),e.i(388201),e.i(855379),e.i(992481),e.i(722553),e.i(525435),e.i(932957),e.i(354438),e.i(433104),e.i(516248),e.i(931171),e.i(248238),t.default.extend(s.default),e.s(["useFormatTimeFromNow",0,()=>{let e=(0,i.useLocale)();return{formatTimeFromNow:(0,a.useCallback)(s=>{let a=n.localeMap[e]??"en";return(0,t.default)(s).locale(a).fromNow()},[e])}}])},606466,e=>{"use strict";var t=e.i(683257);e.s(["useDatasetApiAccessUrl",0,()=>(0,t.useDocLink)()("/api-reference/datasets/get-knowledge-base-list")])},198269,e=>{"use strict";var t=e.i(563199),s=e.i(268255),a=e.i(324935),i=e.i(421001),n=e.i(935139);let r=s.memo(e=>{let{className:s="",isChecked:r,onChange:l,label:o,labelClassName:c,tooltip:d,testId:m}=e;return(0,t.jsxs)("label",{className:(0,n.cn)(s,"flex h-7 items-center space-x-2"),children:[(0,t.jsx)(a.default,{checked:r,onCheck:()=>l(!r),id:m}),(0,t.jsx)("div",{className:(0,n.cn)("text-sm font-normal text-text-secondary",c),children:o}),d&&(0,t.jsx)(i.default,{popupContent:(0,t.jsx)("div",{className:"w-[200px]",children:d}),triggerClassName:"ml-0.5 w-4 h-4"})]})});e.s(["default",0,r])},318359,e=>{e.v({icon:{type:"element",isRootNode:!0,name:"svg",attributes:{width:"13",height:"20",viewBox:"0 0 13 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},children:[{type:"element",name:"path",attributes:{id:"Shape",d:"M0 0H13V20C9.98017 20 7.26458 18.1615 6.14305 15.3576L0 0Z",fill:"currentColor"},children:[]}]},name:"Corner"})},59652,e=>{e.v({icon:{type:"element",isRootNode:!0,name:"svg",attributes:{width:"11",height:"10",viewBox:"0 0 11 10",fill:"none",xmlns:"http://www.w3.org/2000/svg"},children:[{type:"element",name:"g",attributes:{id:"star-04"},children:[{type:"element",name:"path",attributes:{id:"Solid",d:"M5.88897 0.683596C5.82708 0.522683 5.67249 0.416504 5.50008 0.416504C5.32768 0.416504 5.17308 0.522683 5.11119 0.683596L4.27287 2.86321C4.1477 3.18865 4.10837 3.28243 4.05457 3.35809C4.00059 3.43401 3.93426 3.50034 3.85834 3.55433C3.78267 3.60813 3.68889 3.64746 3.36346 3.77263L1.18384 4.61094C1.02293 4.67283 0.916748 4.82743 0.916748 4.99984C0.916748 5.17224 1.02293 5.32684 1.18384 5.38873L3.36346 6.22705C3.68889 6.35221 3.78267 6.39155 3.85834 6.44535C3.93426 6.49933 4.00059 6.56566 4.05457 6.64158C4.10837 6.71724 4.1477 6.81102 4.27287 7.13646L5.11119 9.31608C5.17308 9.47699 5.32768 9.58317 5.50008 9.58317C5.67249 9.58317 5.82709 9.47699 5.88898 9.31608L6.72729 7.13646C6.85246 6.81102 6.89179 6.71724 6.94559 6.64158C6.99957 6.56566 7.06591 6.49933 7.14183 6.44535C7.21749 6.39155 7.31127 6.35221 7.6367 6.22705L9.81632 5.38873C9.97723 5.32684 10.0834 5.17224 10.0834 4.99984C10.0834 4.82743 9.97723 4.67283 9.81632 4.61094L7.6367 3.77263C7.31127 3.64746 7.21749 3.60813 7.14183 3.55433C7.06591 3.50034 6.99957 3.43401 6.94559 3.35809C6.89179 3.28243 6.85246 3.18865 6.72729 2.86321L5.88897 0.683596Z",fill:"currentColor"},children:[]}]}]},name:"Star04"})},811880,e=>{e.v({icon:{type:"element",isRootNode:!0,name:"svg",attributes:{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},children:[{type:"element",name:"g",attributes:{id:"star-06"},children:[{type:"element",name:"g",attributes:{id:"Solid"},children:[{type:"element",name:"path",attributes:{d:"M3.66675 1.33268C3.66675 0.964492 3.36827 0.666016 3.00008 0.666016C2.63189 0.666016 2.33341 0.964492 2.33341 1.33268V2.33268H1.33341C0.965225 2.33268 0.666748 2.63116 0.666748 2.99935C0.666748 3.36754 0.965225 3.66602 1.33341 3.66602H2.33341V4.66602C2.33341 5.0342 2.63189 5.33268 3.00008 5.33268C3.36827 5.33268 3.66675 5.0342 3.66675 4.66602V3.66602H4.66675C5.03494 3.66602 5.33341 3.36754 5.33341 2.99935C5.33341 2.63116 5.03494 2.33268 4.66675 2.33268H3.66675V1.33268Z",fill:"currentColor"},children:[]},{type:"element",name:"path",attributes:{d:"M3.66675 11.3327C3.66675 10.9645 3.36827 10.666 3.00008 10.666C2.63189 10.666 2.33341 10.9645 2.33341 11.3327V12.3327H1.33341C0.965225 12.3327 0.666748 12.6312 0.666748 12.9993C0.666748 13.3675 0.965225 13.666 1.33341 13.666H2.33341V14.666C2.33341 15.0342 2.63189 15.3327 3.00008 15.3327C3.36827 15.3327 3.66675 15.0342 3.66675 14.666V13.666H4.66675C5.03494 13.666 5.33341 13.3675 5.33341 12.9993C5.33341 12.6312 5.03494 12.3327 4.66675 12.3327H3.66675V11.3327Z",fill:"currentColor"},children:[]},{type:"element",name:"path",attributes:{d:"M9.28898 1.76003C9.18995 1.50257 8.94259 1.33268 8.66675 1.33268C8.3909 1.33268 8.14354 1.50257 8.04452 1.76003L6.8884 4.76594C6.68813 5.28663 6.6252 5.43668 6.53912 5.55774C6.45274 5.67921 6.34661 5.78534 6.22514 5.87172C6.10408 5.9578 5.95403 6.02073 5.43334 6.221L2.42743 7.37712C2.16997 7.47614 2.00008 7.7235 2.00008 7.99935C2.00008 8.2752 2.16997 8.52256 2.42743 8.62158L5.43334 9.7777C5.95403 9.97797 6.10408 10.0409 6.22514 10.127C6.34661 10.2134 6.45274 10.3195 6.53912 10.441C6.6252 10.562 6.68813 10.7121 6.8884 11.2328L8.04452 14.2387C8.14354 14.4961 8.3909 14.666 8.66675 14.666C8.9426 14.666 9.18995 14.4961 9.28898 14.2387L10.4451 11.2328C10.6454 10.7121 10.7083 10.562 10.7944 10.441C10.8808 10.3195 10.9869 10.2134 11.1084 10.127C11.2294 10.0409 11.3795 9.97797 11.9002 9.7777L14.9061 8.62158C15.1635 8.52256 15.3334 8.2752 15.3334 7.99935C15.3334 7.7235 15.1635 7.47614 14.9061 7.37712L11.9002 6.221C11.3795 6.02073 11.2294 5.9578 11.1084 5.87172C10.9869 5.78534 10.8808 5.67921 10.7944 5.55774C10.7083 5.43668 10.6454 5.28663 10.4451 4.76594L9.28898 1.76003Z",fill:"currentColor"},children:[]}]}]}]},name:"Star06"})},735304,e=>{e.v({autoWidth:"style-module__Qu6CpW__autoWidth",close:"style-module__Qu6CpW__close",copied:"style-module__Qu6CpW__copied",copyIcon:"style-module__Qu6CpW__copyIcon",customApi:"style-module__Qu6CpW__customApi",customModal:"style-module__Qu6CpW__customModal",trash:"style-module__Qu6CpW__trash",trashIcon:"style-module__Qu6CpW__trashIcon",w64:"style-module__Qu6CpW__w64"})},890578,e=>{"use strict";var t=e.i(563199),s=e.i(742791),a=e.i(653356),i=e.i(837699),n=e.i(268255);e.i(152567);var r=e.i(408767),l=e.i(654313),o=e.i(151094),c=e.i(547105),d=e.i(772499),m=e.i(449980),u=e.i(21151),p=e.i(711536),x=e.i(157884),h=e.i(972282),g=e.i(211857),f=e.i(225244),y=e.i(632815),v=e.i(26012),j=e.i(915389),C=e.i(421001);let b=e=>{let{value:s="",className:a,children:i}=e,[r,l]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{if(r){let e=setTimeout(()=>{l(!1)},1e3);return()=>{clearTimeout(e)}}},[r]),(0,t.jsx)("div",{className:`flex items-center rounded-lg bg-components-input-bg-normal py-2 hover:bg-state-base-hover ${a}`,children:(0,t.jsxs)("div",{className:"flex h-5 grow items-center",children:[i,(0,t.jsx)("div",{className:"relative h-full grow text-[13px]",children:(0,t.jsx)("div",{className:"r-0 absolute left-0 top-0 w-full cursor-pointer truncate pl-2 pr-2",onClick:()=>{(0,v.default)(s),l(!0)},children:(0,t.jsx)(C.default,{popupContent:r?`${(0,j.t)("copied",{ns:"appApi"})}`:`${(0,j.t)("copy",{ns:"appApi"})}`,position:"bottom",children:(0,t.jsx)("span",{className:"text-text-secondary",children:s})})})}),(0,t.jsx)("div",{className:"h-4 w-px shrink-0 bg-divider-regular"}),(0,t.jsx)("div",{className:"mx-1",children:(0,t.jsx)(d.default,{content:s})})]})})};var N=e.i(735304);let w=e=>{let{isShow:s=!1,onClose:i,newKey:n,className:l}=e,{t:c}=(0,r.useTranslation)();return(0,t.jsxs)(u.default,{isShow:s,onClose:i,title:`${c("apiKeyModal.apiSecretKey",{ns:"appApi"})}`,className:`px-8 ${l}`,children:[(0,t.jsx)("div",{className:"-mr-2 -mt-6 mb-4 flex justify-end",children:(0,t.jsx)(a.XMarkIcon,{className:"h-6 w-6 cursor-pointer text-text-tertiary",onClick:i})}),(0,t.jsx)("p",{className:"mt-1 text-[13px] font-normal leading-5 text-text-tertiary",children:c("apiKeyModal.generateTips",{ns:"appApi"})}),(0,t.jsx)("div",{className:"my-4",children:(0,t.jsx)(b,{className:"w-full",value:n?.token})}),(0,t.jsx)("div",{className:"my-4 flex justify-end",children:(0,t.jsx)(o.default,{className:`shrink-0 ${N.default.w64}`,onClick:i,children:(0,t.jsx)("span",{className:"text-xs font-medium text-text-secondary",children:c("actionMsg.ok",{ns:"appApi"})})})})]})};e.s(["default",0,e=>{let{isShow:v=!1,appId:j,onClose:C}=e,{t:b}=(0,r.useTranslation)(),{formatTime:k}=(0,x.default)(),{currentWorkspace:_,isCurrentWorkspaceManager:T,isCurrentWorkspaceEditor:S}=(0,p.useAppContext)(),[M,L]=(0,n.useState)(!1),[A,$]=(0,n.useState)(!1),[I,K]=(0,n.useState)(void 0),E=(0,y.useInvalidateAppApiKeys)(),F=(0,f.useInvalidateDatasetApiKeys)(),{data:P,isLoading:R}=(0,y.useAppApiKeys)(j,{enabled:!!j&&v}),{data:B,isLoading:D}=(0,f.useDatasetApiKeys)({enabled:!j&&v}),U=j?P:B,W=j?R:D,[V,H]=(0,n.useState)(""),Q=async()=>{if(L(!1),!V)return;let e=j?h.delApikey:g.delApikey,t=j?{url:`/apps/${j}/api-keys/${V}`,params:{}}:{url:`/datasets/api-keys/${V}`,params:{}};await e(t),j?E(j):F()},q=async()=>{let e=j?{url:`/apps/${j}/api-keys`,body:{}}:{url:"/datasets/api-keys",body:{}},t=j?h.createApikey:g.createApikey,s=await t(e);$(!0),K(s),j?E(j):F()};return(0,t.jsxs)(u.default,{isShow:v,onClose:C,title:`${b("apiKeyModal.apiSecretKey",{ns:"appApi"})}`,className:`${N.default.customModal} flex flex-col px-8`,children:[(0,t.jsx)("div",{className:"-mr-2 -mt-6 mb-4 flex justify-end",children:(0,t.jsx)(a.XMarkIcon,{className:"h-6 w-6 cursor-pointer text-text-tertiary",onClick:C})}),(0,t.jsx)("p",{className:"mt-1 shrink-0 text-[13px] font-normal leading-5 text-text-tertiary",children:b("apiKeyModal.apiSecretKeyTips",{ns:"appApi"})}),W&&(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsx)(m.default,{})}),!!U?.data?.length&&(0,t.jsxs)("div",{className:"mt-4 flex grow flex-col overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex h-9 shrink-0 items-center border-b border-divider-regular text-xs font-semibold text-text-tertiary",children:[(0,t.jsx)("div",{className:"w-64 shrink-0 px-3",children:b("apiKeyModal.secretKey",{ns:"appApi"})}),(0,t.jsx)("div",{className:"w-[200px] shrink-0 px-3",children:b("apiKeyModal.created",{ns:"appApi"})}),(0,t.jsx)("div",{className:"w-[200px] shrink-0 px-3",children:b("apiKeyModal.lastUsed",{ns:"appApi"})}),(0,t.jsx)("div",{className:"grow px-3"})]}),(0,t.jsx)("div",{className:"grow overflow-auto",children:U.data.map(e=>{let s;return(0,t.jsxs)("div",{className:"flex h-9 items-center border-b border-divider-regular text-sm font-normal text-text-secondary",children:[(0,t.jsx)("div",{className:"w-64 shrink-0 truncate px-3 font-mono",children:(s=e.token,`${s.slice(0,3)}...${s.slice(-20)}`)}),(0,t.jsx)("div",{className:"w-[200px] shrink-0 truncate px-3",children:k(Number(e.created_at),b("dateTimeFormat",{ns:"appLog"}))}),(0,t.jsx)("div",{className:"w-[200px] shrink-0 truncate px-3",children:e.last_used_at?k(Number(e.last_used_at),b("dateTimeFormat",{ns:"appLog"})):b("never",{ns:"appApi"})}),(0,t.jsxs)("div",{className:"flex grow space-x-2 px-3",children:[(0,t.jsx)(d.default,{content:e.token}),T&&(0,t.jsx)(l.default,{onClick:()=>{H(e.id),L(!0)},children:(0,t.jsx)(i.RiDeleteBinLine,{className:"h-4 w-4"})})]})]},e.id)})})]}),(0,t.jsx)("div",{className:"flex",children:(0,t.jsxs)(o.default,{className:`mt-4 flex shrink-0 ${N.default.autoWidth}`,onClick:q,disabled:!_||!S,children:[(0,t.jsx)(s.PlusIcon,{className:"mr-1 flex h-4 w-4 shrink-0"}),(0,t.jsx)("div",{className:"text-xs font-medium text-text-secondary",children:b("apiKeyModal.createNewSecretKey",{ns:"appApi"})})]})}),(0,t.jsx)(w,{className:"shrink-0",isShow:A,onClose:()=>$(!1),newKey:I}),M&&(0,t.jsx)(c.default,{title:`${b("actionMsg.deleteConfirmTitle",{ns:"appApi"})}`,content:`${b("actionMsg.deleteConfirmTips",{ns:"appApi"})}`,isShow:M,onConfirm:Q,onCancel:()=>{H(""),L(!1)}})]})}],890578)},189445,e=>{"use strict";var t=e.i(204667);e.s(["ApiAggregate",()=>t.default])},176891,e=>{"use strict";var t=e.i(563199),s=e.i(837699),a=e.i(124836),i=e.i(268255);e.i(152567);var n=e.i(408767),r=e.i(151094),l=e.i(291631),o=e.i(21151),c=e.i(873517),d=e.i(211857),m=e.i(935139),u=e.i(257899),p=e.i(360972),x=e.i(137667);e.s(["default",0,e=>{let{show:h,dataset:g,onSuccess:f,onClose:y}=e,{t:v}=(0,n.useTranslation)(),[j,C]=(0,i.useState)(!1),[b,N]=(0,i.useState)(g.name),[w,k]=(0,i.useState)(g.description),_=g.external_knowledge_info.external_knowledge_id,T=g.external_knowledge_info.external_knowledge_api_id,[S,M]=(0,i.useState)(g.icon_info?.icon_type==="image"?{type:"image",url:g.icon_info?.icon_url||"",fileId:g.icon_info?.icon||""}:{type:"emoji",icon:g.icon_info?.icon||"",background:g.icon_info?.icon_background||""}),[L,A]=(0,i.useState)(!1),$=(0,i.useRef)(g.icon_info?.icon_type==="image"?{type:"image",url:g.icon_info?.icon_url||"",fileId:g.icon_info?.icon||""}:{type:"emoji",icon:g.icon_info?.icon||"",background:g.icon_info?.icon_background||""}),I=(0,i.useCallback)(()=>{A(!0),$.current=S},[S]),K=(0,i.useCallback)(e=>{M(e),A(!1)},[]),E=(0,i.useCallback)(()=>{M($.current),A(!1)},[]),F=(0,i.useCallback)(async()=>{if(!b.trim())return void x.default.notify({type:"error",message:v("form.nameError",{ns:"datasetSettings"})});try{C(!0);let e={name:b,description:w,icon_info:{icon:"image"===S.type?S.fileId:S.icon,icon_type:S.type,icon_background:"image"===S.type?void 0:S.background,icon_url:"image"===S.type?S.url:void 0}};_&&T&&(e.external_knowledge_id=_,e.external_knowledge_api_id=T),await (0,d.updateDatasetSetting)({datasetId:g.id,body:e}),x.default.notify({type:"success",message:v("actionMsg.modifiedSuccessfully",{ns:"common"})}),f&&f(),y()}catch{x.default.notify({type:"error",message:v("actionMsg.modifiedUnsuccessfully",{ns:"common"})})}finally{C(!1)}},[S,w,g.id,T,_,b,y,f,v]);return(0,t.jsxs)(o.default,{className:"w-[520px] max-w-[520px] rounded-xl px-8 py-6",isShow:h,onClose:a.noop,children:[(0,t.jsxs)("div",{className:"flex items-center justify-between pb-2",children:[(0,t.jsx)("div",{className:"text-xl font-medium leading-[30px] text-text-primary",children:v("title",{ns:"datasetSettings"})}),(0,t.jsx)("div",{className:"cursor-pointer p-2",onClick:y,children:(0,t.jsx)(s.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:(0,m.cn)("flex flex-col py-4"),children:[(0,t.jsx)("div",{className:"shrink-0 py-2 text-sm font-medium leading-[20px] text-text-primary",children:v("form.name",{ns:"datasetSettings"})}),(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,t.jsx)(u.default,{size:"medium",onClick:I,className:"cursor-pointer",iconType:S.type,icon:"image"===S.type?S.fileId:S.icon,background:"image"===S.type?void 0:S.background,imageUrl:"image"===S.type?S.url:void 0,showEditIcon:!0}),(0,t.jsx)(l.default,{value:b,onChange:e=>N(e.target.value),className:"h-9 grow",placeholder:v("form.namePlaceholder",{ns:"datasetSettings"})||""})]})]}),(0,t.jsxs)("div",{className:(0,m.cn)("flex flex-col py-4"),children:[(0,t.jsx)("div",{className:"shrink-0 py-2 text-sm font-medium leading-[20px] text-text-primary",children:v("form.desc",{ns:"datasetSettings"})}),(0,t.jsx)("div",{className:"w-full",children:(0,t.jsx)(c.default,{value:w,onChange:e=>k(e.target.value),className:"resize-none",placeholder:v("form.descPlaceholder",{ns:"datasetSettings"})||""})})]})]}),(0,t.jsxs)("div",{className:"flex justify-end pt-6",children:[(0,t.jsx)(r.default,{className:"mr-2",onClick:y,children:v("operation.cancel",{ns:"common"})}),(0,t.jsx)(r.default,{disabled:j,variant:"primary",onClick:F,children:v("operation.save",{ns:"common"})})]}),L&&(0,t.jsx)(p.default,{onSelect:K,onClose:E})]})}])},738590,597976,e=>{"use strict";var t=e.i(563199),s=e.i(807324),a=e.i(318359);let i=e=>{let{ref:i,...n}=e;return(0,t.jsx)(s.default,{...n,ref:i,data:a.default})};i.displayName="Corner",e.i(59652),e.i(811880),e.s([],738590),e.s(["Corner",0,i],597976)},364203,e=>{"use strict";let t=(0,e.i(639751).create)(e=>({tagList:[],setTagList:t=>e(()=>({tagList:t})),showTagManagementModal:!1,setShowTagManagementModal:t=>e(()=>({showTagManagementModal:t}))}));e.s(["useStore",0,t])},807801,e=>{"use strict";var t=e.i(367916);e.s(["bindTag",0,(e,s,a)=>(0,t.post)("/tag-bindings/create",{body:{tag_ids:e,target_id:s,type:a}}),"createTag",0,(e,s)=>(0,t.post)("/tags",{body:{name:e,type:s}}),"deleteTag",0,e=>(0,t.del)(`/tags/${e}`),"fetchTagList",0,e=>(0,t.get)("/tags",{params:{type:e}}),"unBindTag",0,(e,s,a)=>(0,t.post)("/tag-bindings/remove",{body:{tag_id:e,target_id:s,type:a}}),"updateTag",0,(e,s)=>(0,t.patch)(`/tags/${e}`,{body:{name:s}})])},933620,e=>{"use strict";var t=e.i(563199),s=e.i(837699),a=e.i(268255);e.i(152567);var i=e.i(408767),n=e.i(339548),r=e.i(21151),l=e.i(137667),o=e.i(807801),c=e.i(364203),d=e.i(38532),m=e.i(547105),u=e.i(421001),p=e.i(935139);let x=e=>{let{tag:r}=e,{t:x}=(0,i.useTranslation)(),{notify:h}=(0,n.useContext)(l.ToastContext),g=(0,c.useStore)(e=>e.tagList),f=(0,c.useStore)(e=>e.setTagList),[y,v]=(0,a.useState)(!1),[j,C]=(0,a.useState)(r.name),b=async(e,t)=>{if(t===r.name)return void v(!1);if(!t){h({type:"error",message:"tag name is empty"}),C(r.name),v(!1);return}try{let s=g.map(s=>s.id===e?{...s,name:t}:s);f([...s]),v(!1),await (0,o.updateTag)(e,t),h({type:"success",message:x("actionMsg.modifiedSuccessfully",{ns:"common"})}),C(t)}catch{h({type:"error",message:x("actionMsg.modifiedUnsuccessfully",{ns:"common"})}),C(r.name),f([...g.map(t=>t.id===e?{...t,name:t.name}:t)]),v(!1)}},[N,w]=(0,a.useState)(!1),[k,_]=(0,a.useState)(!1),T=async e=>{if(!k)try{_(!0),await (0,o.deleteTag)(e),h({type:"success",message:x("actionMsg.modifiedSuccessfully",{ns:"common"})});let t=g.filter(t=>t.id!==e);f([...t]),_(!1)}catch{h({type:"error",message:x("actionMsg.modifiedUnsuccessfully",{ns:"common"})}),_(!1)}},{run:S}=(0,d.useDebounceFn)(()=>{T(r.id)},{wait:200});return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:(0,p.cn)("flex shrink-0 items-center gap-0.5 rounded-lg border border-components-panel-border py-1 pl-2 pr-1 text-sm leading-5 text-text-secondary"),children:[!y&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"text-sm leading-5 text-text-secondary",children:r.name}),(0,t.jsx)(u.default,{popupContent:(0,t.jsx)("div",{children:x("common.tagBound",{ns:"workflow"})}),needsDelay:!0,children:(0,t.jsx)("div",{className:"leading-4.5 shrink-0 px-1 text-sm font-medium text-text-tertiary",children:r.binding_count})}),(0,t.jsx)("div",{className:"group/edit shrink-0 cursor-pointer rounded-md p-1 hover:bg-state-base-hover",onClick:()=>v(!0),children:(0,t.jsx)(s.RiEditLine,{className:"h-3 w-3 text-text-tertiary group-hover/edit:text-text-secondary"})}),(0,t.jsx)("div",{className:"group/remove shrink-0 cursor-pointer rounded-md p-1 hover:bg-state-base-hover",onClick:()=>{r.binding_count?w(!0):S()},children:(0,t.jsx)(s.RiDeleteBinLine,{className:"h-3 w-3 text-text-tertiary group-hover/remove:text-text-secondary"})})]}),y&&(0,t.jsx)("input",{className:"shrink-0 appearance-none caret-primary-600 outline-none placeholder:text-text-quaternary",autoFocus:!0,value:j,onChange:e=>C(e.target.value),onKeyDown:e=>"Enter"===e.key&&b(r.id,j),onBlur:()=>b(r.id,j)})]}),(0,t.jsx)(m.default,{title:`${x("tag.delete",{ns:"common"})} "${r.name}"`,isShow:N,content:x("tag.deleteTip",{ns:"common"}),onConfirm:()=>{S(),w(!1)},onCancel:()=>w(!1)})]})};e.s(["default",0,e=>{let{show:d,type:m}=e,{t:u}=(0,i.useTranslation)(),{notify:p}=(0,n.useContext)(l.ToastContext),h=(0,c.useStore)(e=>e.tagList),g=(0,c.useStore)(e=>e.setTagList),f=(0,c.useStore)(e=>e.setShowTagManagementModal),y=async e=>{g(await (0,o.fetchTagList)(e))},[v,j]=(0,a.useState)(!1),[C,b]=(0,a.useState)(""),N=async()=>{if(C&&!v)try{j(!0);let e=await (0,o.createTag)(C,m);p({type:"success",message:u("tag.created",{ns:"common"})}),g([e,...h]),b(""),j(!1)}catch{p({type:"error",message:u("tag.failed",{ns:"common"})}),j(!1)}};return(0,a.useEffect)(()=>{y(m)},[m]),(0,t.jsxs)(r.default,{className:"!w-[600px] !max-w-[600px] rounded-xl px-8 py-6",isShow:d,onClose:()=>f(!1),children:[(0,t.jsx)("div",{className:"relative pb-2 text-xl font-semibold leading-[30px] text-text-primary",children:u("tag.manageTags",{ns:"common"})}),(0,t.jsx)("div",{className:"absolute right-4 top-4 cursor-pointer p-2",onClick:()=>f(!1),children:(0,t.jsx)(s.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})}),(0,t.jsxs)("div",{className:"mt-3 flex flex-wrap gap-2",children:[(0,t.jsx)("input",{className:"w-[100px] shrink-0 appearance-none rounded-lg border border-dashed border-divider-regular bg-transparent px-2 py-1 text-sm leading-5 text-text-secondary caret-primary-600  outline-none placeholder:text-text-quaternary focus:border-solid",placeholder:u("tag.addNew",{ns:"common"})||"",autoFocus:!0,value:C,onChange:e=>b(e.target.value),onKeyDown:e=>"Enter"===e.key&&!e.nativeEvent.isComposing&&N(),onBlur:N}),h.map(e=>(0,t.jsx)(x,{tag:e},e.id))]})]})}],933620)},922944,e=>{"use strict";var t=e.i(841054);e.s(["useMount",()=>t.default])},23651,e=>{"use strict";var t=e.i(343050);e.s(["Tag01",()=>t.default])},860053,747271,e=>{"use strict";var t=e.i(563199),s=e.i(837699),a=e.i(38532),i=e.i(922944),n=e.i(268255);e.i(152567);var r=e.i(408767);e.i(77445);var l=e.i(23651),o=e.i(360052);e.i(47690);var c=e.i(490774);e.i(288243);var d=e.i(744256),m=e.i(291631),u=e.i(391185),p=e.i(807801),x=e.i(935139),h=e.i(364203);e.s(["default",0,e=>{let{type:g,value:f,onChange:y}=e,{t:v}=(0,r.useTranslation)(),[j,C]=(0,n.useState)(!1),b=(0,h.useStore)(e=>e.tagList),N=(0,h.useStore)(e=>e.setTagList),w=(0,h.useStore)(e=>e.setShowTagManagementModal),[k,_]=(0,n.useState)(""),[T,S]=(0,n.useState)(""),{run:M}=(0,a.useDebounceFn)(()=>{S(k)},{wait:500}),L=e=>{_(e),M()},A=(0,n.useMemo)(()=>b.filter(e=>e.type===g&&e.name.includes(T)),[g,b,T]),$=(0,n.useMemo)(()=>b.find(e=>e.id===f[0]),[f,b]);return(0,i.useMount)(()=>{(0,p.fetchTagList)(g).then(e=>{N(e)})}),(0,t.jsx)(u.PortalToFollowElem,{open:j,onOpenChange:C,placement:"bottom-start",offset:4,children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(u.PortalToFollowElemTrigger,{onClick:()=>C(e=>!e),className:"block",children:(0,t.jsxs)("div",{className:(0,x.cn)("flex h-8 cursor-pointer select-none items-center gap-1 rounded-lg border-[0.5px] border-transparent bg-components-input-bg-normal px-2",!j&&!!f.length&&"shadow-xs",j&&!!f.length&&"shadow-xs"),children:[(0,t.jsx)("div",{className:"p-[1px]",children:(0,t.jsx)(l.Tag01,{className:"h-3.5 w-3.5 text-text-tertiary"})}),(0,t.jsxs)("div",{className:"text-[13px] leading-[18px] text-text-secondary",children:[!f.length&&v("tag.placeholder",{ns:"common"}),!!f.length&&$?.name]}),f.length>1&&(0,t.jsx)("div",{className:"text-xs font-medium leading-[18px] text-text-tertiary",children:`+${f.length-1}`}),!f.length&&(0,t.jsx)("div",{className:"p-[1px]",children:(0,t.jsx)(s.RiArrowDownSLine,{className:"h-3.5 w-3.5 text-text-tertiary"})}),!!f.length&&(0,t.jsx)("div",{className:"group/clear cursor-pointer p-[1px]",onClick:e=>{e.stopPropagation(),y([])},children:(0,t.jsx)(d.XCircle,{className:"h-3.5 w-3.5 text-text-tertiary group-hover/clear:text-text-secondary"})})]})}),(0,t.jsx)(u.PortalToFollowElemContent,{className:"z-[1002]",children:(0,t.jsxs)("div",{className:"relative w-[240px] rounded-lg border-[0.5px] border-components-panel-border bg-components-panel-bg-blur shadow-lg backdrop-blur-[5px]",children:[(0,t.jsx)("div",{className:"p-2",children:(0,t.jsx)(m.default,{showLeftIcon:!0,showClearIcon:!0,value:k,onChange:e=>L(e.target.value),onClear:()=>L("")})}),(0,t.jsxs)("div",{className:"max-h-72 overflow-auto p-1",children:[A.map(e=>(0,t.jsxs)("div",{className:"flex cursor-pointer select-none items-center gap-2 rounded-lg py-[6px] pl-3 pr-2 hover:bg-state-base-hover",onClick:()=>{f.includes(e.id)?y(f.filter(t=>t!==e.id)):y([...f,e.id])},children:[(0,t.jsx)("div",{title:e.name,className:"grow truncate text-sm leading-5 text-text-tertiary",children:e.name}),f.includes(e.id)&&(0,t.jsx)(c.Check,{className:"h-4 w-4 shrink-0 text-text-secondary"})]},e.id)),!A.length&&(0,t.jsxs)("div",{className:"flex flex-col items-center gap-1 p-3",children:[(0,t.jsx)(o.Tag03,{className:"h-6 w-6 text-text-tertiary"}),(0,t.jsx)("div",{className:"text-xs leading-[14px] text-text-tertiary",children:v("tag.noTag",{ns:"common"})})]})]}),(0,t.jsx)("div",{className:"border-t-[0.5px] border-divider-regular"}),(0,t.jsx)("div",{className:"p-1",children:(0,t.jsxs)("div",{className:"flex cursor-pointer select-none items-center gap-2 rounded-lg py-[6px] pl-3 pr-2 hover:bg-state-base-hover",onClick:()=>{w(!0),C(!1)},children:[(0,t.jsx)(o.Tag03,{className:"h-4 w-4 text-text-tertiary"}),(0,t.jsx)("div",{className:"grow truncate text-sm leading-5 text-text-secondary",children:v("tag.manageTags",{ns:"common"})})]})})]})})]})})}],860053);var g=e.i(964596),f=e.i(59848),y=e.i(124836),v=e.i(339548),j=e.i(324935),C=e.i(757198),b=e.i(137667);let N=n.memo(e=>{let{t:a}=(0,r.useTranslation)(),{notify:i}=(0,v.useContext)(b.ToastContext),{targetID:l,type:o,value:c,selectedTags:d,onCacheUpdate:u,onChange:x,onCreate:g}=e,N=(0,h.useStore)(e=>e.tagList),w=(0,h.useStore)(e=>e.setTagList),k=(0,h.useStore)(e=>e.setShowTagManagementModal),[_,T]=(0,n.useState)(c),[S,M]=(0,n.useState)(""),L=e=>{M(e)},A=(0,n.useMemo)(()=>N.every(e=>e.type===o&&e.name!==S),[o,N,S]),$=(0,n.useMemo)(()=>d.filter(e=>e.name.includes(S)),[S,d]),I=(0,n.useMemo)(()=>N.filter(e=>e.type===o&&!c.includes(e.id)&&e.name.includes(S)),[o,N,c,S]),[K,E]=(0,n.useState)(!1),F=async()=>{if(S&&!K)try{E(!0);let e=await (0,p.createTag)(S,o);i({type:"success",message:a("tag.created",{ns:"common"})}),w([...N,e]),M(""),E(!1),g()}catch{i({type:"error",message:a("tag.failed",{ns:"common"})}),E(!1)}},P=async e=>{try{await (0,p.bindTag)(e,l,o),i({type:"success",message:a("actionMsg.modifiedSuccessfully",{ns:"common"})})}catch{i({type:"error",message:a("actionMsg.modifiedUnsuccessfully",{ns:"common"})})}},R=async e=>{try{await (0,p.unBindTag)(e,l,o),i({type:"success",message:a("actionMsg.modifiedSuccessfully",{ns:"common"})})}catch{i({type:"error",message:a("actionMsg.modifiedUnsuccessfully",{ns:"common"})})}},B=e=>{_.includes(e.id)?T(_.filter(t=>t!==e.id)):T([..._,e.id])},D=(0,n.useMemo)(()=>c.length===_.length&&c.every(e=>_.includes(e))&&_.every(e=>c.includes(e)),[c,_]);return(0,f.useUnmount)(()=>{if(!D){let e,t,s;e=_.filter(e=>!c.includes(e)),t=c.filter(e=>!_.includes(e)),u(N.filter(e=>_.includes(e.id))),s=[],e.length&&s.push(P(e)),t.length&&s.push(...t.map(e=>R(e))),Promise.all(s).finally(()=>{x&&x()})}}),(0,t.jsxs)("div",{className:"relative w-full rounded-lg border-[0.5px] border-components-panel-border bg-components-panel-bg-blur",children:[(0,t.jsx)("div",{className:"p-2 pb-1",children:(0,t.jsx)(m.default,{showLeftIcon:!0,showClearIcon:!0,value:S,placeholder:a("tag.selectorPlaceholder",{ns:"common"})||"",onChange:e=>L(e.target.value),onClear:()=>L("")})}),S&&A&&(0,t.jsx)("div",{className:"p-1",children:(0,t.jsxs)("div",{className:"flex cursor-pointer items-center gap-x-1 rounded-lg px-2 py-1.5 hover:bg-state-base-hover",onClick:F,children:[(0,t.jsx)(s.RiAddLine,{className:"h-4 w-4 text-text-tertiary"}),(0,t.jsxs)("div",{className:"system-md-regular grow truncate px-1 text-text-secondary",children:[`${a("tag.create",{ns:"common"})} `,(0,t.jsx)("span",{className:"system-md-medium",children:`'${S}'`})]})]})}),S&&A&&I.length>0&&(0,t.jsx)(C.default,{type:"horizontal",className:"my-0 h-px bg-divider-subtle"}),(I.length>0||$.length>0)&&(0,t.jsxs)("div",{className:"max-h-[232px] overflow-y-auto p-1",children:[$.map(e=>(0,t.jsxs)("div",{className:"flex cursor-pointer items-center gap-x-1 rounded-lg px-2 py-1.5 hover:bg-state-base-hover",onClick:()=>B(e),children:[(0,t.jsx)(j.default,{className:"shrink-0",checked:_.includes(e.id),onCheck:y.noop}),(0,t.jsx)("div",{title:e.name,className:"system-md-regular grow truncate px-1 text-text-secondary",children:e.name})]},e.id)),I.map(e=>(0,t.jsxs)("div",{className:"flex cursor-pointer items-center gap-x-1 rounded-lg px-2 py-1.5 hover:bg-state-base-hover",onClick:()=>B(e),children:[(0,t.jsx)(j.default,{className:"shrink-0",checked:_.includes(e.id),onCheck:y.noop}),(0,t.jsx)("div",{title:e.name,className:"system-md-regular grow truncate px-1 text-text-secondary",children:e.name})]},e.id))]}),!S&&!I.length&&!$.length&&(0,t.jsx)("div",{className:"p-1",children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-y-1 p-3",children:[(0,t.jsx)(s.RiPriceTag3Line,{className:"h-6 w-6 text-text-quaternary"}),(0,t.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:a("tag.noTag",{ns:"common"})})]})}),(0,t.jsx)(C.default,{type:"horizontal",className:"my-0 h-px bg-divider-subtle"}),(0,t.jsx)("div",{className:"p-1",children:(0,t.jsxs)("div",{className:"flex cursor-pointer items-center gap-x-1 rounded-lg px-2 py-1.5 hover:bg-state-base-hover",onClick:()=>k(!0),children:[(0,t.jsx)(s.RiPriceTag3Line,{className:"h-4 w-4 text-text-tertiary"}),(0,t.jsx)("div",{className:"system-md-regular grow truncate px-1 text-text-secondary",children:a("tag.manageTags",{ns:"common"})})]})})]})}),w=n.memo(e=>{let{tags:a}=e,{t:i}=(0,r.useTranslation)();return(0,t.jsx)("div",{className:"flex w-full cursor-pointer items-center gap-1 overflow-hidden rounded-lg p-1 hover:bg-state-base-hover",children:a.length?(0,t.jsx)(t.Fragment,{children:a.map((e,a)=>(0,t.jsxs)("div",{className:"flex items-center gap-x-0.5 rounded-[5px] border border-divider-deep bg-components-badge-bg-dimm px-[5px] py-[3px]",children:[(0,t.jsx)(s.RiPriceTag3Line,{className:"h-3 w-3 shrink-0 text-text-quaternary"}),(0,t.jsx)("div",{className:"system-2xs-medium-uppercase text-nowrap text-text-tertiary",children:e})]},a))}):(0,t.jsxs)("div",{className:"flex items-center gap-x-0.5 rounded-[5px] border border-dashed border-divider-deep bg-components-badge-bg-dimm px-[5px] py-[3px]",children:[(0,t.jsx)(s.RiPriceTag3Line,{className:"h-3 w-3 shrink-0 text-text-quaternary"}),(0,t.jsx)("div",{className:"system-2xs-medium-uppercase text-nowrap text-text-tertiary",children:i("tag.addTag",{ns:"common"})})]})})});e.s(["default",0,e=>{let{targetID:s,isPopover:a=!0,position:i,type:r,value:l,selectedTags:o,onCacheUpdate:c,onChange:d,minWidth:m}=e,u=(0,h.useStore)(e=>e.tagList),f=(0,h.useStore)(e=>e.setTagList),y=(0,n.useCallback)(async()=>{f(await (0,p.fetchTagList)(r))},[f,r]),v=(0,n.useMemo)(()=>o?.length?o.filter(e=>u.find(t=>t.id===e.id)).map(e=>e.name):[],[o,u]);return(0,t.jsx)(t.Fragment,{children:a&&(0,t.jsx)(g.default,{htmlContent:(0,t.jsx)(N,{type:r,targetID:s,value:l,selectedTags:o,onCacheUpdate:c,onChange:d,onCreate:y}),position:i,trigger:"click",btnElement:(0,t.jsx)(w,{tags:v}),btnClassName:e=>(0,x.cn)(e?"!bg-state-base-hover !text-text-secondary":"!bg-transparent","!w-full !border-0 !p-0 !text-text-tertiary hover:!bg-state-base-hover hover:!text-text-secondary"),popupClassName:(0,x.cn)("!w-full !ring-0",m&&"!min-w-80"),className:"!z-20 h-fit !w-full"})})}],747271)}]);
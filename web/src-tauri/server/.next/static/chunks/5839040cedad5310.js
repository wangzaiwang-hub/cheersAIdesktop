(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,217712,e=>{"use strict";var t=e.i(563199),s=e.i(837699),a=e.i(268255),r=e.i(189299),i=e.i(34510),o=e.i(53349),l=e.i(223314),n=e.i(449980),d=e.i(459760);e.i(845780);var c=e.i(556354);e.i(275225);var u=e.i(705405);e.i(905691);var m=e.i(706416);e.i(152567);var x=e.i(408767);let p=(0,a.memo)(()=>{let{t:e}=(0,x.useTranslation)(),[r,i]=(0,a.useState)(!0),o=[];return o.length?(0,t.jsxs)("div",{className:`
        rounded-xl border
        ${!r?"border-components-panel-border-subtle bg-components-panel-on-panel-item-bg shadow-none":"border-transparent bg-white shadow-xs"}
      `,children:[(0,t.jsxs)("div",{className:`
          flex h-[18px] cursor-pointer items-center px-2 pt-4 text-[13px] font-semibold
          ${!r?"text-text-accent-secondary":"text-text-secondary"}
        `,onClick:()=>i(!r),children:[(0,t.jsx)(s.RiArrowDownSLine,{className:`mr-1 h-3 w-3 ${!r?"-rotate-90 text-text-accent":"text-text-tertiary"}`}),e("panel.userInputField",{ns:"workflow"}).toLocaleUpperCase()]}),(0,t.jsx)("div",{className:"px-2 pb-3 pt-1",children:r&&(0,t.jsx)("div",{className:"py-2 text-[13px] text-text-primary",children:o.map(e=>(0,t.jsx)("div",{className:"mb-2 last-of-type:mb-0"},e.variable))})})]}):null}),f=(0,a.memo)(()=>{let[e,x]=(0,a.useState)(!1),[f,h]=(0,a.useState)([]),[b,w]=(0,a.useState)([]),g=(0,r.useStore)(e=>e.appDetail),v=(0,u.useWorkflowStore)(),{handleLoadBackupDraft:j}=(0,c.useWorkflowRun)(),C=(0,u.useStore)(e=>e.historyWorkflowData),y=C?.conversation_id,N=(0,a.useCallback)(async()=>{if(g&&y)try{var e;let t;x(!1);let s=(e=(await (0,d.fetchConversationMessages)(g.id,y)).data,t=[],e.forEach(e=>{let s=e.message_files?.filter(e=>"user"===e.belongs_to)||[];t.push({id:`question-${e.id}`,content:e.query,isAnswer:!1,message_files:(0,l.getProcessedFilesFromResponse)(s.map(e=>({...e,related_id:e.id}))),parentMessageId:e.parent_message_id||void 0});let a=e.message_files?.filter(e=>"assistant"===e.belongs_to)||[];t.push({id:e.id,content:e.answer,feedback:e.feedback,isAnswer:!0,citation:e.metadata?.retriever_resources,message_files:(0,l.getProcessedFilesFromResponse)(a.map(e=>({...e,related_id:e.id}))),workflow_run_id:e.workflow_run_id,parentMessageId:`question-${e.id}`})}),t),a=(0,o.buildChatItemTree)(s);h(a),w((0,o.getThreadMessages)(a,s.at(-1)?.id))}catch{}finally{x(!0)}},[g,y]);(0,a.useEffect)(()=>{N()},[y,g,N]);let _=(0,a.useCallback)(e=>{w((0,o.getThreadMessages)(f,e))},[f]);return(0,t.jsxs)("div",{className:"flex h-full w-[420px] flex-col rounded-l-2xl border border-components-panel-border bg-chatbot-bg shadow-xl",children:[!e&&(0,t.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,t.jsx)(n.default,{})}),e&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex shrink-0 items-center justify-between p-4 pb-1 text-base font-semibold text-text-primary",children:[`TEST CHAT${(0,m.formatWorkflowRunIdentifier)(C?.finished_at)}`,(0,t.jsx)("div",{className:"flex h-6 w-6 cursor-pointer items-center justify-center",onClick:()=>{j(),v.setState({historyWorkflowData:void 0})},children:(0,t.jsx)(s.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})})]}),(0,t.jsx)("div",{className:"h-0 grow",children:(0,t.jsx)(i.default,{config:{supportCitationHitInfo:!0,questionEditEnable:!1},chatList:b,chatContainerClassName:"px-3",chatContainerInnerClassName:"pt-6 w-full max-w-full mx-auto",chatFooterClassName:"px-4 rounded-b-2xl",chatFooterInnerClassName:"pb-4 w-full max-w-full mx-auto",chatNode:(0,t.jsx)(p,{}),noChatInput:!0,allToolIcons:{},showPromptLog:!0,switchSibling:_,noSpacing:!0,chatAnswerContainerInner:"!pr-2"})})]})]})});e.s(["default",0,f],217712)},783946,e=>{e.n(e.i(217712))}]);
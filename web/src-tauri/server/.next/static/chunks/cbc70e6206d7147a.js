(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,27905,881180,70735,854938,e=>{"use strict";var t=e.i(563199),r=e.i(807324);e.i(975044),e.i(981004);var n=e.i(983163);let a=e=>{let{ref:a,...s}=e;return(0,t.jsx)(r.default,{...s,ref:a,data:n.default})};a.displayName="SlidersH",e.s(["default",0,a],881180),e.i(832332);var s=e.i(347675);let l=e=>{let{ref:n,...a}=e;return(0,t.jsx)(r.default,{...a,ref:n,data:s.default})};l.displayName="Stop",e.s(["default",0,l],70735);var i=e.i(951559);let o=e=>{let{ref:n,...a}=e;return(0,t.jsx)(r.default,{...a,ref:n,data:i.default})};o.displayName="StopCircle",e.s(["default",0,o],854938),e.s([],27905)},653488,e=>{"use strict";var t=e.i(563199),r=e.i(837699);e.i(152567);var n=e.i(408767);e.i(538868);var a=e.i(506033);e.i(27905);var s=e.i(881180),s=s,l=e.i(421001),i=e.i(56971),o=e.i(935139),c=e.i(739255),u=e.i(225162),d=e.i(722591),m=e.i(540284);e.s(["default",0,e=>{let{disabled:p,currentProvider:f,currentModel:g,providerName:x,modelId:h,hasDeprecated:v,modelDisabled:b,isInWorkflow:y}=e,{t:j}=(0,n.useTranslation)(),w=(0,u.useLanguage)(),{modelProviders:N}=(0,i.useProviderContext)();return(0,t.jsxs)("div",{className:(0,o.cn)("relative flex h-8 cursor-pointer items-center rounded-lg  px-2",!y&&"border ring-inset hover:ring-[0.5px]",!y&&(p?"border-text-warning bg-state-warning-hover ring-text-warning":"border-util-colors-indigo-indigo-600 bg-state-accent-hover ring-util-colors-indigo-indigo-600"),y&&"border border-workflow-block-parma-bg bg-workflow-block-parma-bg pr-[30px]  hover:border-components-input-border-active"),children:[f&&(0,t.jsx)(d.default,{className:"mr-1.5 !h-5 !w-5",provider:f,modelName:g?.model}),!f&&(0,t.jsx)(d.default,{className:"mr-1.5 !h-5 !w-5",provider:N.find(e=>e.provider===x),modelName:h}),g&&(0,t.jsx)(m.default,{className:"mr-1.5 text-text-primary",modelItem:g,showMode:!0,showFeatures:!0}),!g&&(0,t.jsx)("div",{className:"mr-1 truncate text-[13px] font-medium text-text-primary",children:h}),p?(0,t.jsx)(l.default,{popupContent:v?j("modelProvider.deprecated",{ns:"common"}):b&&g?c.MODEL_STATUS_TEXT[g.status][w]:"",children:(0,t.jsx)(a.AlertTriangle,{className:"h-4 w-4 text-[#F79009]"})}):(0,t.jsx)(s.default,{className:(0,o.cn)(y?"text-text-tertiary":"text-indigo-600","h-4 w-4 shrink-0")}),y&&(0,t.jsx)(r.RiArrowDownSLine,{className:"absolute right-2 top-[9px] h-3.5 w-3.5 text-text-tertiary"})]})}],653488)},92881,206741,e=>{"use strict";var t=e.i(563199),r=e.i(268255),n=e.i(545766),a=e.i(299951),s=e.i(170866),l=e.i(260484),i=e.i(522977),o=e.i(421001),c=e.i(935139),u=e.i(225162),d=e.i(750552);e.s(["default",0,e=>{let{parameterRule:m,value:p,onChange:f,onSwitch:g,isInWorkflow:x}=e,h=(0,u.useLanguage)(),[v,b]=(0,r.useState)(p),y=(0,r.useRef)(null),j=()=>{let e;return"int"===m.type||"float"===m.type?e=(0,d.isNullOrUndefined)(m.default)?m.min||0:m.default:"string"===m.type||"text"===m.type?e=m.default||"":"boolean"===m.type?e=!(0,d.isNullOrUndefined)(m.default)&&m.default:"tag"===m.type&&(e=(0,d.isNullOrUndefined)(m.default)?[]:m.default),e},w=p??v??j(),N=e=>{b(e),f&&("stop"===m.name||!(0,d.isNullOrUndefined)(p)||m.required)&&f(e)},C=e=>{let t=+e.target.value;!(0,d.isNullOrUndefined)(m.max)&&t>m.max&&(t=m.max,y.current.value=`${t}`),!(0,d.isNullOrUndefined)(m.min)&&t<m.min&&(t=m.min),N(t)},S=()=>{y.current&&(y.current.value=w)},k=e=>{if(!(0,d.isNullOrUndefined)(m.max)&&e>m.max){N(m.max),y.current.value=`${m.max}`;return}if(!(0,d.isNullOrUndefined)(m.min)&&e<m.min){N(m.min),y.current.value=`${m.min}`;return}N(e),y.current.value=`${e}`},T=e=>{N(e)},O=e=>{N(e.target.value)},M=e=>{N(e.value)},E=e=>{N(e)};return(0,r.useEffect)(()=>{("int"===m.type||"float"===m.type)&&y.current&&(y.current.value=`${w}`)},[p]),(0,t.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"shrink-0 basis-1/2",children:[(0,t.jsxs)("div",{className:(0,c.cn)("flex w-full shrink-0 items-center"),children:[!m.required&&"stop"!==m.name&&(0,t.jsx)("div",{className:"mr-2 w-7",children:(0,t.jsx)(l.default,{defaultValue:!(0,d.isNullOrUndefined)(p),onChange:e=>{g&&g(e,v||j())},size:"md"})}),(0,t.jsx)("div",{className:"system-xs-regular mr-0.5 truncate text-text-secondary",title:m.label[h]||m.label.en_US,children:m.label[h]||m.label.en_US}),m.help&&(0,t.jsx)(o.default,{popupContent:(0,t.jsx)("div",{className:"w-[150px] whitespace-pre-wrap",children:m.help[h]||m.help.en_US}),popupClassName:"mr-1",triggerClassName:"mr-1 w-4 h-4 shrink-0"})]}),"tag"===m.type&&(0,t.jsx)("div",{className:(0,c.cn)(!x&&"w-[150px]","system-xs-regular text-text-tertiary"),children:m?.tagPlaceholder?.[h]})]}),(()=>{let e=("int"===m.type||"float"===m.type)&&!(0,d.isNullOrUndefined)(m.min)&&!(0,d.isNullOrUndefined)(m.max);if("int"===m.type){let r=100;return m.max&&(m.max<100?r=1:m.max<1e3&&(r=10)),(0,t.jsxs)(t.Fragment,{children:[e&&(0,t.jsx)(s.default,{className:"w-[120px]",value:w,min:m.min,max:m.max,step:r,onChange:k}),(0,t.jsx)("input",{ref:y,className:"system-sm-regular ml-4 block h-8 w-16 shrink-0 appearance-none rounded-lg bg-components-input-bg-normal pl-3 text-components-input-text-filled outline-none",type:"number",max:m.max,min:m.min,step:e?r:+`0.${m.precision||0}`,onChange:C,onBlur:S})]})}return"float"===m.type?(0,t.jsxs)(t.Fragment,{children:[e&&(0,t.jsx)(s.default,{className:"w-[120px]",value:w,min:m.min,max:m.max,step:.1,onChange:k}),(0,t.jsx)("input",{ref:y,className:"system-sm-regular ml-4 block h-8 w-16 shrink-0 appearance-none rounded-lg bg-components-input-bg-normal pl-3 text-components-input-text-filled outline-none",type:"number",max:m.max,min:m.min,step:e?.1:+`0.${m.precision||0}`,onChange:C,onBlur:S})]}):"boolean"===m.type?(0,t.jsxs)(n.default.Group,{className:"flex w-[150px] items-center",value:w,onChange:T,children:[(0,t.jsx)(n.default,{value:!0,className:"w-[70px] px-[18px]",children:"True"}),(0,t.jsx)(n.default,{value:!1,className:"w-[70px] px-[18px]",children:"False"})]}):"string"!==m.type||m.options?.length?"text"===m.type?(0,t.jsx)("textarea",{className:"system-sm-regular ml-4 h-20 w-full rounded-lg bg-components-input-bg-normal px-1 text-components-input-text-filled",value:w,onChange:O}):"string"===m.type&&m?.options?.length?(0,t.jsx)(a.SimpleSelect,{className:"!py-0",wrapperClassName:(0,c.cn)("!h-8 w-full"),defaultValue:w,onSelect:M,items:m.options.map(e=>({value:e,name:e}))}):"tag"===m.type?(0,t.jsx)("div",{className:(0,c.cn)("!h-8 w-full"),children:(0,t.jsx)(i.default,{items:w,onChange:E,customizedConfirmKey:"Tab",isInWorkflow:x,required:m.required})}):null:(0,t.jsx)("input",{className:(0,c.cn)(x?"w-[150px]":"w-full","system-sm-regular ml-4 flex h-8 appearance-none items-center rounded-lg bg-components-input-bg-normal px-3 text-components-input-text-filled outline-none"),value:w,onChange:O})})()]})}],92881);var m=e.i(837699);e.i(152567);var p=e.i(408767),f=e.i(151094),g=e.i(394895),x=e.i(807324),h=e.i(108417);let v=e=>{let{ref:r,...n}=e;return(0,t.jsx)(x.default,{...n,ref:r,data:h.default})};v.displayName="Brush01",e.i(84761),e.i(645127),e.i(700519),e.i(674360),e.i(174622);var b=e.i(52377);let y=e=>{let{ref:r,...n}=e;return(0,t.jsx)(x.default,{...n,ref:r,data:b.default})};y.displayName="Scales02",e.i(288243);var j=e.i(324097),j=j,w=e.i(925521);let N={Creative:"model.tone.Creative",Balanced:"model.tone.Balanced",Precise:"model.tone.Precise",Custom:"model.tone.Custom"};e.s(["default",0,e=>{let{onSelect:n}=e,{t:a}=(0,p.useTranslation)(),s=(0,r.useCallback)(e=>(0,t.jsxs)(f.default,{size:"small",variant:"secondary",className:(0,c.cn)(e&&"bg-state-base-hover"),children:[a("modelProvider.loadPresets",{ns:"common"}),(0,t.jsx)(m.RiArrowDownSLine,{className:"ml-0.5 h-3.5 w-3.5"})]}),[a]),l=w.TONE_LIST.slice(0,3).map(e=>{var r;let n;return{value:e.id,text:(0,t.jsxs)("div",{className:"flex h-full items-center",children:[(r=e.id,n="mr-2 w-[14px] h-[14px]",({1:(0,t.jsx)(v,{className:`${n} text-[#6938EF]`}),2:(0,t.jsx)(y,{className:`${n} text-indigo-600`}),3:(0,t.jsx)(j.default,{className:`${n} text-[#107569]`})})[r]),a(N[e.name],{ns:"common"})]})}});return(0,t.jsx)(g.default,{renderTrigger:s,items:l,onSelect:e=>n(e.value),popupClassName:"z-[1003]"})}],206741)},874033,(e,t,r)=>{t.exports=function(e){return e&&e.__esModule?e:{default:e}},t.exports.__esModule=!0,t.exports.default=t.exports},386568,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e.r(824627),a=e.r(268255);r.default=function(e,t){void 0===e&&(e=!1);var r=(0,n.__read)((0,a.useState)(e),2),s=r[0],l=r[1];return[s,(0,a.useMemo)(function(){var r=void 0===t?!e:t;return{toggle:function(){return l(function(t){return t===e?r:e})},set:function(e){return l(e)},setLeft:function(){return l(e)},setRight:function(){return l(r)}}},[])]}},224381,(e,t,r)=>{"use strict";var n=e.r(874033);Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){void 0===e&&(e=!1);var t=(0,a.__read)((0,l.default)(!!e),2),r=t[0],n=t[1],i=n.toggle,o=n.set;return[r,(0,s.useMemo)(function(){return{toggle:i,set:function(e){return o(!!e)},setTrue:function(){return o(!0)},setFalse:function(){return o(!1)}}},[])]};var a=e.r(824627),s=e.r(268255),l=n(e.r(386568))},650282,353549,589849,298272,280388,914697,705557,e=>{"use strict";function t(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function r(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?t(Object(n),!0).forEach(function(t){var r;r=n[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):t(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach(function(t){var n;n=r[t],t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function l(e){return function t(){for(var r=this,n=arguments.length,a=Array(n),s=0;s<n;s++)a[s]=arguments[s];return a.length>=e.length?e.apply(this,a):function(){for(var e=arguments.length,n=Array(e),s=0;s<e;s++)n[s]=arguments[s];return t.apply(r,[].concat(a,n))}}}function i(e){return({}).toString.call(e).includes("Object")}function o(e){return"function"==typeof e}var c,u,d=l(function(e,t){throw Error(e[t]||e.default)})({initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"}),m=function(e,t){return i(t)||d("changeType"),Object.keys(t).some(function(t){return!Object.prototype.hasOwnProperty.call(e,t)})&&d("changeField"),t},p=function(e){o(e)||d("selectorType")},f=function(e){o(e)||i(e)||d("handlerType"),i(e)&&Object.values(e).some(function(e){return!o(e)})&&d("handlersType")},g=function(e){e||d("initialIsRequired"),i(e)||d("initialType"),Object.keys(e).length||d("initialContent")};function x(e,t){return o(t)?t(e.current):t}function h(e,t){return e.current=s(s({},e.current),t),t}function v(e,t,r){return o(t)?t(e.current):Object.keys(r).forEach(function(r){var n;return null==(n=t[r])?void 0:n.call(t,e.current[r])}),r}var b={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:"Deprecation warning!\n    You are using deprecated way of configuration.\n\n    Instead of using\n      monaco.config({ urls: { monacoBase: '...' } })\n    use\n      monaco.config({ paths: { vs: '...' } })\n\n    For more please check the link https://github.com/suren-atoyan/monaco-loader#config\n  "},y=(c=function(e,t){throw Error(e[t]||e.default)},function e(){for(var t=this,r=arguments.length,n=Array(r),a=0;a<r;a++)n[a]=arguments[a];return n.length>=c.length?c.apply(this,n):function(){for(var r=arguments.length,a=Array(r),s=0;s<r;s++)a[s]=arguments[s];return e.apply(t,[].concat(n,a))}})(b);let j=function(e){return(e||y("configIsRequired"),({}).toString.call(e).includes("Object")||y("configType"),e.urls)?(console.warn(b.deprecation),{paths:{vs:e.urls.monacoBase}}):e},w=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){return t.reduceRight(function(e,t){return t(e)},e)}};var N={type:"cancelation",msg:"operation is manually canceled"};let C=function(e){var t=!1,r=new Promise(function(r,n){e.then(function(e){return t?n(N):r(e)}),e.catch(n)});return r.cancel=function(){return t=!0},r};var S=function(e){if(Array.isArray(e))return e}(u=({create:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};g(e),f(t);var r={current:e},n=l(v)(r,t),a=l(h)(r),s=l(m)(e),i=l(x)(r);return[function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return e};return p(e),e(r.current)},function(e){(function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){return t.reduceRight(function(e,t){return t(e)},e)}})(n,a,s,i)(e)}]}}).create({config:{paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.52.2/min/vs"}},isInitialized:!1,resolve:null,reject:null,monaco:null}))||function(e,t){if("u">typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,a=!1,s=void 0;try{for(var l,i=e[Symbol.iterator]();!(n=(l=i.next()).done)&&(r.push(l.value),2!==r.length);n=!0);}catch(e){a=!0,s=e}finally{try{n||null==i.return||i.return()}finally{if(a)throw s}}return r}}(u,2)||function(e,t){if(e){if("string"==typeof e)return n(e,2);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n(e,2)}}(u,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),k=S[0],T=S[1];function O(e){return document.body.appendChild(e)}function M(e){var t,r,n=k(function(e){return{config:e.config,reject:e.reject}}),a=(t="".concat(n.config.paths.vs,"/loader.js"),r=document.createElement("script"),t&&(r.src=t),r);return a.onload=function(){return e()},a.onerror=n.reject,a}function E(){var e=k(function(e){return{config:e.config,resolve:e.resolve,reject:e.reject}}),t=window.require;t.config(e.config),t(["vs/editor/editor.main"],function(t){R(t),e.resolve(t)},function(t){e.reject(t)})}function R(e){k().monaco||T({monaco:e})}var P=new Promise(function(e,t){return T({resolve:e,reject:t})});let D={config:function(e){var t=j(e),n=t.monaco,a=function(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},s=Object.keys(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)r=s[n],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}(t,["monaco"]);T(function(e){return{config:function e(t,n){return Object.keys(n).forEach(function(r){n[r]instanceof Object&&t[r]&&Object.assign(n[r],e(t[r],n[r]))}),r(r({},t),n)}(e.config,a),monaco:n}})},init:function(){var e=k(function(e){return{monaco:e.monaco,isInitialized:e.isInitialized,resolve:e.resolve}});if(!e.isInitialized){if(T({isInitialized:!0}),e.monaco)return e.resolve(e.monaco),C(P);if(window.monaco&&window.monaco.editor)return R(window.monaco),e.resolve(window.monaco),C(P);w(O,M)(E)}return C(P)},__getMonacoInstance:function(){return k(function(e){return e.monaco})}};var L=e.i(268255),I={display:"flex",position:"relative",textAlign:"initial"},_={width:"100%"},$={display:"none"},A={display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"},F=function(e){let{children:t}=e;return L.default.createElement("div",{style:A},t)},B=(0,L.memo)(function(e){let{width:t,height:r,isEditorReady:n,loading:a,_ref:s,className:l,wrapperProps:i}=e;return L.default.createElement("section",{style:{...I,width:t,height:r},...i},!n&&L.default.createElement(F,null,a),L.default.createElement("div",{ref:s,style:{..._,...!n&&$},className:l}))}),z=function(e){(0,L.useEffect)(e,[])},V=function(e,t){let r=!(arguments.length>2)||void 0===arguments[2]||arguments[2],n=(0,L.useRef)(!0);(0,L.useEffect)(n.current||!r?()=>{n.current=!1}:e,t)};function U(){}function G(e,t,r,n){var a,s,l,i,o,c;return a=e,s=n,a.editor.getModel(H(a,s))||(l=e,i=t,o=r,c=n,l.editor.createModel(i,o,c?H(l,c):void 0))}function H(e,t){return e.Uri.parse(t)}(0,L.memo)(function(e){let{original:t,modified:r,language:n,originalLanguage:a,modifiedLanguage:s,originalModelPath:l,modifiedModelPath:i,keepCurrentOriginalModel:o=!1,keepCurrentModifiedModel:c=!1,theme:u="light",loading:d="Loading...",options:m={},height:p="100%",width:f="100%",className:g,wrapperProps:x={},beforeMount:h=U,onMount:v=U}=e,[b,y]=(0,L.useState)(!1),[j,w]=(0,L.useState)(!0),N=(0,L.useRef)(null),C=(0,L.useRef)(null),S=(0,L.useRef)(null),k=(0,L.useRef)(v),T=(0,L.useRef)(h),O=(0,L.useRef)(!1);z(()=>{let e=D.init();return e.then(e=>(C.current=e)&&w(!1)).catch(e=>e?.type!=="cancelation"&&console.error("Monaco initialization: error:",e)),()=>{let t;return N.current?(t=N.current?.getModel(),void(o||t?.original?.dispose(),c||t?.modified?.dispose(),N.current?.dispose())):e.cancel()}}),V(()=>{if(N.current&&C.current){let e=N.current.getOriginalEditor(),r=G(C.current,t||"",a||n||"text",l||"");r!==e.getModel()&&e.setModel(r)}},[l],b),V(()=>{if(N.current&&C.current){let e=N.current.getModifiedEditor(),t=G(C.current,r||"",s||n||"text",i||"");t!==e.getModel()&&e.setModel(t)}},[i],b),V(()=>{let e=N.current.getModifiedEditor();e.getOption(C.current.editor.EditorOption.readOnly)?e.setValue(r||""):r!==e.getValue()&&(e.executeEdits("",[{range:e.getModel().getFullModelRange(),text:r||"",forceMoveMarkers:!0}]),e.pushUndoStop())},[r],b),V(()=>{N.current?.getModel()?.original.setValue(t||"")},[t],b),V(()=>{let{original:e,modified:t}=N.current.getModel();C.current.editor.setModelLanguage(e,a||n||"text"),C.current.editor.setModelLanguage(t,s||n||"text")},[n,a,s],b),V(()=>{C.current?.editor.setTheme(u)},[u],b),V(()=>{N.current?.updateOptions(m)},[m],b);let M=(0,L.useCallback)(()=>{if(!C.current)return;T.current(C.current);let e=G(C.current,t||"",a||n||"text",l||""),o=G(C.current,r||"",s||n||"text",i||"");N.current?.setModel({original:e,modified:o})},[n,r,s,t,a,l,i]),E=(0,L.useCallback)(()=>{!O.current&&S.current&&(N.current=C.current.editor.createDiffEditor(S.current,{automaticLayout:!0,...m}),M(),C.current?.editor.setTheme(u),y(!0),O.current=!0)},[m,u,M]);return(0,L.useEffect)(()=>{b&&k.current(N.current,C.current)},[b]),(0,L.useEffect)(()=>{j||b||E()},[j,b,E]),L.default.createElement(B,{width:f,height:p,isEditorReady:b,loading:d,_ref:S,className:g,wrapperProps:x})});var q=function(e){let t=(0,L.useRef)();return(0,L.useEffect)(()=>{t.current=e},[e]),t.current},W=new Map,K=(0,L.memo)(function(e){let{defaultValue:t,defaultLanguage:r,defaultPath:n,value:a,language:s,path:l,theme:i="light",line:o,loading:c="Loading...",options:u={},overrideServices:d={},saveViewState:m=!0,keepCurrentModel:p=!1,width:f="100%",height:g="100%",className:x,wrapperProps:h={},beforeMount:v=U,onMount:b=U,onChange:y,onValidate:j=U}=e,[w,N]=(0,L.useState)(!1),[C,S]=(0,L.useState)(!0),k=(0,L.useRef)(null),T=(0,L.useRef)(null),O=(0,L.useRef)(null),M=(0,L.useRef)(b),E=(0,L.useRef)(v),R=(0,L.useRef)(),P=(0,L.useRef)(a),I=q(l),_=(0,L.useRef)(!1),$=(0,L.useRef)(!1);z(()=>{let e=D.init();return e.then(e=>(k.current=e)&&S(!1)).catch(e=>e?.type!=="cancelation"&&console.error("Monaco initialization: error:",e)),()=>T.current?void(R.current?.dispose(),p?m&&W.set(l,T.current.saveViewState()):T.current.getModel()?.dispose(),T.current.dispose()):e.cancel()}),V(()=>{let e=G(k.current,t||a||"",r||s||"",l||n||"");e!==T.current?.getModel()&&(m&&W.set(I,T.current?.saveViewState()),T.current?.setModel(e),m&&T.current?.restoreViewState(W.get(l)))},[l],w),V(()=>{T.current?.updateOptions(u)},[u],w),V(()=>{T.current&&void 0!==a&&(T.current.getOption(k.current.editor.EditorOption.readOnly)?T.current.setValue(a):a!==T.current.getValue()&&($.current=!0,T.current.executeEdits("",[{range:T.current.getModel().getFullModelRange(),text:a,forceMoveMarkers:!0}]),T.current.pushUndoStop(),$.current=!1))},[a],w),V(()=>{let e=T.current?.getModel();e&&s&&k.current?.editor.setModelLanguage(e,s)},[s],w),V(()=>{void 0!==o&&T.current?.revealLine(o)},[o],w),V(()=>{k.current?.editor.setTheme(i)},[i],w);let A=(0,L.useCallback)(()=>{if(!(!O.current||!k.current)&&!_.current){E.current(k.current);let e=l||n,c=G(k.current,a||t||"",r||s||"",e||"");T.current=k.current?.editor.create(O.current,{model:c,automaticLayout:!0,...u},d),m&&T.current.restoreViewState(W.get(e)),k.current.editor.setTheme(i),void 0!==o&&T.current.revealLine(o),N(!0),_.current=!0}},[t,r,n,a,s,l,u,d,m,i,o]);return(0,L.useEffect)(()=>{w&&M.current(T.current,k.current)},[w]),(0,L.useEffect)(()=>{C||w||A()},[C,w,A]),P.current=a,(0,L.useEffect)(()=>{w&&y&&(R.current?.dispose(),R.current=T.current?.onDidChangeModelContent(e=>{$.current||y(T.current.getValue(),e)}))},[w,y]),(0,L.useEffect)(()=>{if(w){let e=k.current.editor.onDidChangeMarkers(e=>{let t=T.current.getModel()?.uri;if(t&&e.find(e=>e.path===t.path)){let e=k.current.editor.getModelMarkers({resource:t});j?.(e)}});return()=>{e?.dispose()}}return()=>{}},[w,j]),L.default.createElement(B,{width:f,height:g,isEditorReady:w,loading:c,_ref:O,className:x,wrapperProps:h})});e.s(["Editor",()=>K,"default",()=>K],650282),e.s(["loader",0,D],353549);var J=e.i(563199),Y=e.i(38532),Q=e.i(935139);let X=L.memo(e=>{let{className:t,height:r,minHeight:n,onHeightChange:a,children:s,footer:l,hideResize:i}=e,[o,c]=(0,L.useState)(0),[u,d]=(0,L.useState)(!1),[m,p]=(0,L.useState)(()=>getComputedStyle(document.body).userSelect),[f,g]=(0,L.useState)(r),x=(0,L.useCallback)(e=>{c(e.clientY),d(!0),g(r),p(getComputedStyle(document.body).userSelect),document.body.style.userSelect="none"},[r]),h=(0,L.useCallback)(()=>{d(!1),document.body.style.userSelect=m},[m]),{run:v}=(0,Y.useDebounceFn)(e=>{if(!u)return;let t=f+(e.clientY-o);t<n&&(t=n),a(t)},{wait:0}),b=(0,L.useCallback)(v,[u,r,n,o]);return(0,L.useEffect)(()=>(document.addEventListener("mousemove",b),()=>{document.removeEventListener("mousemove",b)}),[b]),(0,L.useEffect)(()=>(document.addEventListener("mouseup",h),()=>{document.removeEventListener("mouseup",h)}),[h]),(0,J.jsxs)("div",{className:"relative",children:[(0,J.jsx)("div",{className:(0,Q.cn)(t,"overflow-y-auto"),style:{height:r},children:s}),l,!i&&(0,J.jsx)("div",{className:"absolute bottom-0 left-0 flex h-2 w-full cursor-row-resize justify-center",onMouseDown:x,children:(0,J.jsx)("div",{className:"h-[3px] w-5 rounded-sm bg-gray-300"})})]})});e.s(["default",0,X],589849);var Z=e.i(837699);e.i(152567);var ee=e.i(408767),et=e.i(421001),er=e.i(390622),en=e.i(357e3),ea=e.i(377397),es=e.i(387124),el=e.i(223314);e.s(["default",0,e=>{let{fileList:t,isExpanded:r=!1,noBorder:n=!1,noPadding:a=!1}=e,{t:s}=(0,ee.useTranslation)(),[l,i]=(0,L.useState)(r),o=(0,L.useMemo)(()=>t.reduce((e,t)=>{let{list:r}=t;return[...e,...r]},[]),[t]);return t.length?(0,J.jsxs)("div",{className:(0,Q.cn)("px-3 py-2",l&&"py-3",!n&&"border-t border-divider-subtle",a&&"!p-0"),children:[(0,J.jsxs)("div",{className:"flex justify-between gap-1",children:[l&&(0,J.jsx)("div",{className:"system-xs-semibold-uppercase grow cursor-pointer py-1 text-text-secondary",onClick:()=>i(!l),children:s("runDetail.fileListLabel",{ns:"appLog"})}),!l&&(0,J.jsx)("div",{className:"flex gap-1",children:o.map(e=>{let{id:t,name:r,type:n,supportFileType:a,base64Url:s,url:l}=e,i=a===er.SupportUploadFileTypes.image;return(0,J.jsxs)(J.Fragment,{children:[i&&(0,J.jsx)(et.default,{popupContent:r,children:(0,J.jsx)("div",{children:(0,J.jsx)(en.default,{className:"h-8 w-8",imageUrl:s||l||""})},t)}),!i&&(0,J.jsx)(et.default,{popupContent:r,children:(0,J.jsx)("div",{className:"rounded-md border-[0.5px] border-components-panel-border bg-components-panel-on-panel-item-bg p-1.5 shadow-xs",children:(0,J.jsx)(ea.default,{type:(0,el.getFileAppearanceType)(r,n),size:"lg"})},t)})]})})}),(0,J.jsxs)("div",{className:"flex cursor-pointer items-center gap-1",onClick:()=>i(!l),children:[!l&&(0,J.jsx)("div",{className:"system-xs-medium-uppercase text-text-tertiary",children:s("runDetail.fileListDetail",{ns:"appLog"})}),(0,J.jsx)(Z.RiArrowRightSLine,{className:(0,Q.cn)("h-4 w-4 text-text-tertiary",l&&"rotate-90")})]})]}),l&&(0,J.jsx)("div",{className:"flex flex-col gap-3",children:t.map(e=>(0,J.jsxs)("div",{className:"system-xs-regular flex flex-col gap-1",children:[(0,J.jsx)("div",{className:"py-1 text-text-tertiary ",children:e.varName}),e.list.map(e=>(0,J.jsx)(es.default,{file:e,showDeleteAction:!1,showDownloadAction:!0,canPreview:!0},e.id))]},e.varName))})]}):null}],298272),e.s(["default",0,e=>{let{ref:t,hasFooter:r=!0,isInNode:n}=e,[a,s]=(0,L.useState)(!1),[l,i]=(0,L.useState)(t?.current?.clientHeight),o=a?l-(r?56:29):0;return(0,L.useEffect)(()=>{t?.current&&i(t.current?.clientHeight)},[a]),{wrapClassName:a?n?"fixed z-10  right-[9px] top-[166px] bottom-[8px]  p-4 bg-components-panel-bg rounded-xl":"absolute z-10 left-4 right-6 top-[52px] bottom-0 pb-4 bg-components-panel-bg":"",wrapStyle:a?{boxShadow:"0px 0px 12px -4px rgba(16, 24, 40, 0.05), 0px -3px 6px -2px rgba(16, 24, 40, 0.03)"}:{},editorExpandHeight:o,isExpand:a,setIsExpand:s}}],280388);var ei=e.i(149086),eo=e.i(354440),ec=(0,ei.createUseStorageState)(function(){return eo.default?sessionStorage:void 0});e.s(["useSessionStorageState",0,ec],914697);var eu=e.i(382257);e.s(["Generator",()=>eu.default],705557)},904962,e=>{e.v({optimizationNoteText:"style-module__9rk8qW__optimizationNoteText",textGradient:"style-module__9rk8qW__textGradient"})},481162,337464,459760,934465,526330,621544,981744,473617,313746,513203,830462,485587,882262,479419,e=>{"use strict";e.s(["default",()=>eR,"languageMap",()=>eE],481162);var t=e.i(563199),r=e.i(650282),n=e.i(353549),a=e.i(124836),s=e.i(268255),l=e.i(223314),i=e.i(955371),o=e.i(922521),c=e.i(648404),u=e.i(935139),d=e.i(168014);e.s(["default",()=>eM],479419);var m=e.i(26012),p=e.i(589849),f=e.i(654313),g=e.i(298272);e.i(21511);var x=e.i(389600),h=e.i(751489),v=e.i(280388),b=e.i(417944);e.s(["GetCodeGeneratorResModal",()=>ej,"default",()=>ew],830462);var y=e.i(914697),j=e.i(224381);e.i(152567);var w=e.i(408767),N=e.i(151094),C=e.i(547105);e.i(36860);var S=e.i(705557),k=e.i(449980),T=e.i(21151),O=e.i(137667),M=e.i(739255),E=e.i(225162);e.i(668763);var R=e.i(194145),P=e.i(391185),D=e.i(925521),L=e.i(56971),I=e.i(652669),_=e.i(117960),$=e.i(92881),A=e.i(206741),F=e.i(653488);let B=e=>{let{popupClassName:r,portalToFollowElemContentClassName:n,isAdvancedMode:a,modelId:l,provider:i,setModel:o,completionParams:c,onCompletionParamsChange:d,hideDebugWithMultipleModel:m,debugWithMultipleModel:p,onDebugWithMultipleModelChange:f,renderTrigger:g,readonly:x,isInWorkflow:h}=e,{t:v}=(0,w.useTranslation)(),{isAPIKeySet:b}=(0,L.useProviderContext)(),[y,j]=(0,s.useState)(!1),{data:N,isPending:C}=(0,I.useModelParameterRules)(i,l),{currentProvider:S,currentModel:T,activeTextGenerationModelList:O}=(0,E.useTextGenerationCurrentProviderAndModelAndModelList)({provider:i,model:l}),B=!S||!T,z=T?.status!==M.ModelStatusEnum.active,V=!b||B||z,U=(0,s.useMemo)(()=>N?.data||[],[N]);return(0,t.jsx)(P.PortalToFollowElem,{open:y,onOpenChange:j,placement:h?"left":"bottom-end",offset:4,children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(P.PortalToFollowElemTrigger,{onClick:()=>{x||j(e=>!e)},className:"block",children:g?g({open:y,disabled:V,modelDisabled:z,hasDeprecated:B,currentProvider:S,currentModel:T,providerName:i,modelId:l}):(0,t.jsx)(F.default,{disabled:V,isInWorkflow:h,modelDisabled:z,hasDeprecated:B,currentProvider:S,currentModel:T,providerName:i,modelId:l})}),(0,t.jsx)(P.PortalToFollowElemContent,{className:(0,u.cn)("z-[60]",n),children:(0,t.jsxs)("div",{className:(0,u.cn)(r,"w-[389px] rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-lg"),children:[(0,t.jsxs)("div",{className:(0,u.cn)("max-h-[420px] overflow-y-auto p-4 pt-3"),children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:(0,u.cn)("system-sm-semibold mb-1 flex h-6 items-center text-text-secondary"),children:v("modelProvider.model",{ns:"common"}).toLocaleUpperCase()}),(0,t.jsx)(_.default,{defaultModel:i||l?{provider:i,model:l}:void 0,modelList:O,onSelect:e=>{let{provider:t,model:r}=e,n=O.find(e=>e.provider===t),a=n?.models.find(e=>e.model===r);o({modelId:r,provider:t,mode:a?.model_properties.mode,features:a?.features||[]})}})]}),!!U.length&&(0,t.jsx)("div",{className:"my-3 h-px bg-divider-subtle"}),C&&(0,t.jsx)("div",{className:"mt-5",children:(0,t.jsx)(k.default,{})}),!C&&!!U.length&&(0,t.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,t.jsx)("div",{className:(0,u.cn)("system-sm-semibold flex h-6 items-center text-text-secondary"),children:v("modelProvider.parameters",{ns:"common"})}),D.PROVIDER_WITH_PRESET_TONE.includes(i)&&(0,t.jsx)(A.default,{onSelect:e=>{let t=D.TONE_LIST.find(t=>t.id===e);t&&d({...c,...t.config})}})]}),!C&&!!U.length&&[...U,...a?[D.STOP_PARAMETER_RULE]:[]].map(e=>(0,t.jsx)($.default,{parameterRule:e,value:c?.[e.name],onChange:t=>{var r;return r=e.name,void d({...c,[r]:t})},onSwitch:(t,r)=>((e,t,r)=>{if(!t){let t={...c};delete t[e],d(t)}t&&d({...c,[e]:r})})(e.name,t,r),isInWorkflow:h},`${l}-${e.name}`))]}),!m&&(0,t.jsxs)("div",{className:"bg-components-section-burn system-sm-regular flex h-[50px] cursor-pointer items-center justify-between rounded-b-xl border-t border-t-divider-subtle px-4 text-text-accent",onClick:()=>f?.(),children:[v(p?"debugAsSingleModel":"debugAsMultipleModel",{ns:"appDebug"}),(0,t.jsx)(R.ArrowNarrowLeft,{className:"h-3 w-3 rotate-180"})]})]})})]})})};e.s(["default",0,B],337464);var z=e.i(367916);let V=async(e,t)=>(0,z.post)(`apps/${e}/chat-messages/${t}/stop`),U=async(e,t,r)=>{let{onData:n,onCompleted:a,onError:s,onMessageReplace:l}=r;return(0,z.ssePost)(`apps/${e}/completion-messages`,{body:{...t,response_mode:"streaming"}},{onData:n,onCompleted:a,onError:s,onMessageReplace:l})},G=e=>(0,z.post)("/instruction-generate",{body:e});e.s(["fetchConversationMessages",0,(e,t,r)=>(0,z.get)(`apps/${e}/chat-messages`,{params:{conversation_id:t}},{getAbortController:r}),"fetchPromptTemplate",0,e=>{let{appMode:t,mode:r,modelName:n,hasSetDataSet:a}=e;return(0,z.get)("/app/prompt-templates",{params:{app_mode:t,model_mode:r,model_name:n,has_context:a}})},"fetchSuggestedQuestions",0,(e,t,r)=>(0,z.get)(`apps/${e}/chat-messages/${t}/suggested-questions`,{},{getAbortController:r}),"fetchTextGenerationMessage",0,e=>{let{appId:t,messageId:r}=e;return(0,z.get)(`/apps/${t}/messages/${r}`)},"generateBasicAppFirstTimeRule",0,e=>(0,z.post)("/rule-generate",{body:e}),"generateRule",0,G,"sendCompletionMessage",0,U,"stopChatMessageResponding",0,V],459760);var H=e.i(632815);e.i(288243);var q=e.i(670977),W=e.i(873517);let K="generate",J=s.memo(e=>{let{value:r,onChange:n}=e,{t:a}=(0,w.useTranslation)(),[s,{toggle:l}]=(0,b.useBoolean)(!0);return(0,t.jsxs)("div",{className:"mt-4 text-[0px]",children:[(0,t.jsxs)("div",{className:"mb-1.5 flex  cursor-pointer items-center text-sm font-medium leading-5 text-text-primary",onClick:l,children:[(0,t.jsx)("div",{className:"system-sm-semibold-uppercase mr-1 text-text-secondary",children:a(`${K}.idealOutput`,{ns:"appDebug"})}),(0,t.jsxs)("div",{className:"system-xs-regular text-text-tertiary",children:["(",a(`${K}.optional`,{ns:"appDebug"}),")"]}),(0,t.jsx)(q.ArrowDownRoundFill,{className:(0,u.cn)("size text-text-quaternary",s&&"relative top-[1px] rotate-[-90deg]")})]}),!s&&(0,t.jsx)(W.default,{className:"h-[80px]",placeholder:a(`${K}.idealOutputPlaceholder`,{ns:"appDebug"}),value:r,onChange:e=>n(e.target.value)})]})});e.s(["default",0,J],934465),e.i(845780);var Y=e.i(949250),Q=e.i(619507);e.i(275225);var X=e.i(705405),Z=e.i(390622),ee=e.i(758911),et=e.i(484072),er=e.i(669744),en=e.i(249420);let ea="generate",es=s.memo(e=>{let{editorKey:r,generatorType:n,value:a,onChange:s,availableVars:l,availableNodes:i,getVarType:o=()=>er.Type.string,isShowCurrentBlock:c,isShowLastRunBlock:d}=e,{t:m}=(0,w.useTranslation)(),{eventEmitter:p}=(0,en.useEventEmitterContextContext)(),f="code"===n,g=f?(0,t.jsx)("div",{className:"system-sm-regular whitespace-break-spaces !leading-6 text-text-placeholder",children:m(`${ea}.codeGenInstructionPlaceHolderLine`,{ns:"appDebug"})}):(0,t.jsxs)("div",{className:"system-sm-regular text-text-placeholder",children:[(0,t.jsx)("div",{className:"leading-6",children:m(`${ea}.instructionPlaceHolderTitle`,{ns:"appDebug"})}),(0,t.jsxs)("div",{className:"mt-2",children:[(0,t.jsx)("div",{children:m(`${ea}.instructionPlaceHolderLine1`,{ns:"appDebug"})}),(0,t.jsx)("div",{children:m(`${ea}.instructionPlaceHolderLine2`,{ns:"appDebug"})}),(0,t.jsx)("div",{children:m(`${ea}.instructionPlaceHolderLine3`,{ns:"appDebug"})})]})]});return(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(ee.default,{wrapperClassName:"border !border-components-input-bg-normal bg-components-input-bg-normal hover:!border-components-input-bg-hover rounded-[10px] px-4 pt-3",instanceId:r,placeholder:g,placeholderClassName:"px-4 pt-3",className:(0,u.cn)("min-h-[240px] pb-8"),value:a,workflowVariableBlock:{show:!0,variables:l,getVarType:o,workflowNodesMap:i.reduce((e,t)=>(e[t.id]={title:t.data.title,type:t.data.type,width:t.width,height:t.height,position:t.position},t.data.type===Z.BlockEnum.Start&&(e.sys={title:m("blocks.start",{ns:"workflow"}),type:Z.BlockEnum.Start}),e),{})},currentBlock:{show:c,generatorType:n},errorMessageBlock:{show:f},lastRunBlock:{show:d},onChange:s,editable:!0,isSupportFileVar:!1},r),(0,t.jsxs)("div",{className:"system-xs-regular absolute bottom-0 left-4 flex h-8 items-center space-x-0.5 text-components-input-text-placeholder",children:[(0,t.jsx)("span",{children:m("generate.press",{ns:"appDebug"})}),(0,t.jsx)("span",{className:"system-kbd flex h-4 w-3.5 items-center justify-center rounded-[4px] bg-components-kbd-bg-gray text-text-placeholder",children:"/"}),(0,t.jsx)("span",{children:m("generate.to",{ns:"appDebug"})}),(0,t.jsx)("span",{onClick:()=>{p?.emit({type:et.PROMPT_EDITOR_INSERT_QUICKLY,instanceId:r})},className:"!ml-1 cursor-pointer hover:border-b hover:border-dotted hover:border-text-tertiary hover:text-text-tertiary",children:m("generate.insertContext",{ns:"appDebug"})})]})]})});e.s(["default",0,es],526330);let el=s.memo(e=>{let{nodeId:r,value:n,editorKey:a,onChange:l,generatorType:i,isShowCurrentBlock:o}=e,c=(0,X.useWorkflowStore)(),u=(0,s.useCallback)((e,t)=>{let{nodesWithInspectVars:r}=c.getState(),n=t?.[0];return!!r.find(e=>e.nodeId===n)&&e.type!==Z.VarType.file&&e.type!==Z.VarType.arrayFile},[c]),{availableVars:d,availableNodes:m}=(0,Q.default)(r,{onlyLeafNodeVar:!1,filterVar:u}),p=(0,Y.useWorkflowVariableType)();return(0,t.jsx)(es,{value:n,onChange:l,editorKey:a,generatorType:i,availableVars:d,availableNodes:m,getVarType:p,isShowCurrentBlock:o,isShowLastRunBlock:!0})});e.s(["default",0,el],621544);let ei=s.memo(()=>{let{t:e}=(0,w.useTranslation)();return(0,t.jsxs)("div",{className:"flex h-full w-0 grow flex-col items-center justify-center space-y-3 px-8",children:[(0,t.jsx)(S.Generator,{className:"size-8 text-text-quaternary"}),(0,t.jsx)("div",{className:"text-center text-[13px] font-normal leading-5 text-text-tertiary",children:(0,t.jsx)("div",{children:e("generate.newNoDataLine1",{ns:"appDebug"})})})]})});e.s(["default",0,ei],981744);var eo=e.i(837699),ec=e.i(421001);let eu=s.memo(e=>{let{value:n,onUpdate:a,showFormatButton:l=!0,editorWrapperClassName:i,readOnly:d=!1,hideTopMenu:p=!1,topContent:f,className:g,onFocus:x,onBlur:h}=e,{t:v}=(0,w.useTranslation)(),{theme:b}=(0,o.default)(),y=(0,s.useRef)(null),j=(0,s.useRef)(null),[N,C]=s.useState(!1),S=(0,s.useRef)(null);(0,s.useEffect)(()=>{y.current&&(b===c.Theme.light?y.current.editor.setTheme("light-theme"):y.current.editor.setTheme("dark-theme"))},[b]);let k=(0,s.useCallback)((e,t)=>{j.current=e,y.current=t,e.onDidFocusEditorText(()=>{x?.()}),e.onDidBlurEditorText(()=>{h?.()}),t.editor.defineTheme("light-theme",{base:"vs",inherit:!0,rules:[],colors:{"editor.background":"#00000000","editor.lineHighlightBackground":"#00000000",focusBorder:"#00000000"}}),t.editor.defineTheme("dark-theme",{base:"vs-dark",inherit:!0,rules:[],colors:{"editor.background":"#00000000","editor.lineHighlightBackground":"#00000000",focusBorder:"#00000000"}}),t.editor.setTheme("light-theme"),C(!0)},[]),T=(0,s.useCallback)(()=>{j.current&&j.current.getAction("editor.action.formatDocument")?.run()},[]),O=(0,s.useCallback)(e=>{void 0!==e&&a?.(e)},[a]),M=(0,s.useMemo)(()=>b===c.Theme.light?"light-theme":"dark-theme",[b]);return(0,s.useEffect)(()=>{let e=new ResizeObserver(()=>{j.current?.layout()});return S.current&&e.observe(S.current),()=>{e.disconnect()}},[]),(0,t.jsxs)("div",{className:(0,u.cn)("flex h-full flex-col overflow-hidden bg-components-input-bg-normal",p&&"pt-2",g),children:[!p&&(0,t.jsxs)("div",{className:"flex items-center justify-between pl-2 pr-1 pt-1",children:[(0,t.jsx)("div",{className:"system-xs-semibold-uppercase py-0.5 text-text-secondary",children:(0,t.jsx)("span",{className:"px-1 py-0.5",children:"JSON"})}),(0,t.jsxs)("div",{className:"flex items-center gap-x-0.5",children:[l&&(0,t.jsx)(ec.default,{popupContent:v("operation.format",{ns:"common"}),children:(0,t.jsx)("button",{type:"button",className:"flex h-6 w-6 items-center justify-center",onClick:T,children:(0,t.jsx)(eo.RiIndentIncrease,{className:"h-4 w-4 text-text-tertiary"})})}),(0,t.jsx)(ec.default,{popupContent:v("operation.copy",{ns:"common"}),children:(0,t.jsx)("button",{type:"button",className:"flex h-6 w-6 items-center justify-center",onClick:()=>(0,m.default)(n),children:(0,t.jsx)(eo.RiClipboardLine,{className:"h-4 w-4 text-text-tertiary"})})})]})]}),f,(0,t.jsx)("div",{className:(0,u.cn)("relative overflow-hidden",i),children:(0,t.jsx)(r.Editor,{defaultLanguage:"json",theme:N?M:"default-theme",value:n,onChange:O,onMount:k,options:{readOnly:d,domReadOnly:!0,minimap:{enabled:!1},tabSize:2,scrollBeyondLastLine:!1,wordWrap:"on",wrappingIndent:"same",overviewRulerBorder:!1,hideCursorInOverviewRuler:!0,renderLineHighlightOnlyWhenFocus:!1,renderLineHighlight:"none",scrollbar:{vertical:"hidden",horizontal:"hidden",verticalScrollbarSize:0,horizontalScrollbarSize:0,alwaysConsumeMouseWheel:!1}}})})]})});e.s(["default",0,eu],473617);let ed=s.memo(e=>{let{value:r,workflowVariableBlock:n}=e,[a,l]=s.useState("keyIdPrefix-0");return(0,s.useEffect)(()=>{l(`prompt-res-editor-${Date.now()}`)},[r]),(0,t.jsx)(ee.default,{value:r,editable:!1,className:"h-full bg-transparent pt-0",workflowVariableBlock:n},a)}),em=s.memo(e=>{let{value:r,nodeId:n}=e,{t:a}=(0,w.useTranslation)(),{availableVars:s,availableNodes:l}=(0,Q.default)(n,{onlyLeafNodeVar:!1,filterVar:e=>!0});return(0,t.jsx)(ed,{value:r,workflowVariableBlock:{show:!0,variables:s||[],getVarType:()=>er.Type.string,workflowNodesMap:l.reduce((e,t)=>(e[t.id]={title:t.data.title,type:t.data.type,width:t.width,height:t.height,position:t.position},t.data.type===Z.BlockEnum.Start&&(e.sys={title:a("blocks.start",{ns:"workflow"}),type:Z.BlockEnum.Start}),e),{})}})});var ep=e.i(379415),ef=e.i(904962);let eg=e=>{let{message:r,className:n}=e,{t:a}=(0,w.useTranslation)(),[s,{toggle:l}]=(0,b.useBoolean)(!1);return(0,t.jsxs)("div",{className:(0,u.cn)("rounded-xl border-[0.5px] border-components-panel-border bg-background-section-burn pl-4 shadow-xs",n),children:[(0,t.jsxs)("div",{className:"my-3 flex h-4 items-center justify-between pr-3",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,t.jsx)(eo.RiSparklingFill,{className:"size-3.5 text-components-input-border-active-prompt-1"}),(0,t.jsx)("span",{className:(0,u.cn)(ef.default.optimizationNoteText,"system-xs-semibold-uppercase"),children:a("generate.optimizationNote",{ns:"appDebug"})})]}),(0,t.jsx)(eo.RiArrowDownSLine,{className:(0,u.cn)("size-4 cursor-pointer text-text-tertiary",s&&"rotate-[-90deg]"),onClick:l})]}),!s&&(0,t.jsx)("div",{className:"pb-4 pr-4",children:(0,t.jsx)(ep.Markdown,{className:"!text-sm",content:r})})]})};var ex=e.i(337352);let eh=e=>{let{versionLen:r,value:n,onChange:a}=e,{t:l}=(0,w.useTranslation)(),[i,{setFalse:o,toggle:c,set:d}]=(0,b.useBoolean)(!1),m=r>1,p=(0,s.useCallback)(e=>{m&&d(e)},[m,c]),f=(0,s.useCallback)(()=>{m&&c()},[m,c]),g=Array.from({length:r},(e,t)=>({label:`${l("generate.version",{ns:"appDebug"})} ${t+1}${t===r-1?` \xb7 ${l("generate.latest",{ns:"appDebug"})}`:""}`,value:t}));return(0,t.jsxs)(P.PortalToFollowElem,{placement:"bottom-start",offset:{mainAxis:4,crossAxis:-12},open:i,onOpenChange:p,children:[(0,t.jsx)(P.PortalToFollowElemTrigger,{onClick:f,asChild:!0,children:(0,t.jsxs)("div",{className:(0,u.cn)("system-xs-medium flex items-center text-text-tertiary",i&&"text-text-secondary",m&&"cursor-pointer"),children:[(0,t.jsxs)("div",{children:[l("generate.version",{ns:"appDebug"})," ",n+1,n===r-1&&` \xb7 ${l("generate.latest",{ns:"appDebug"})}`]}),m&&(0,t.jsx)(eo.RiArrowDownSLine,{className:"size-3 "})]})}),(0,t.jsx)(P.PortalToFollowElemContent,{className:(0,u.cn)("z-[99]"),children:(0,t.jsxs)("div",{className:(0,u.cn)("w-[208px] rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur p-1 shadow-lg"),children:[(0,t.jsx)("div",{className:(0,u.cn)("system-xs-medium-uppercase flex h-[22px] items-center px-3 pl-3 text-text-tertiary"),children:l("generate.versions",{ns:"appDebug"})}),g.map(e=>(0,t.jsxs)("div",{className:(0,u.cn)("system-sm-medium flex h-7 cursor-pointer items-center rounded-lg px-2 text-text-secondary hover:bg-state-base-hover"),title:e.label,onClick:()=>{a(e.value),o()},children:[(0,t.jsx)("div",{className:"mr-1 grow truncate px-1 pl-1",children:e.label}),n===e.value&&(0,t.jsx)(eo.RiCheckLine,{className:"h-4 w-4 shrink-0 text-text-accent"})]},e.value))]})})]})},ev=s.memo(e=>{let{isBasicMode:r,nodeId:n,current:a,currentVersionIndex:s,setCurrentVersionIndex:l,versions:i,onApply:o,generatorType:c}=e,{t:u}=(0,w.useTranslation)(),d=c===ex.GeneratorType.prompt;return(0,t.jsxs)("div",{className:"flex h-full flex-col",children:[(0,t.jsxs)("div",{className:"mb-3 flex shrink-0 items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"shrink-0 text-base font-semibold leading-[160%] text-text-secondary",children:u("generate.resTitle",{ns:"appDebug"})}),(0,t.jsx)(eh,{versionLen:i.length,value:s,onChange:l})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(N.default,{className:"px-2",onClick:()=>{(0,m.default)(a.modified),O.default.notify({type:"success",message:u("actionMsg.copySuccessfully",{ns:"common"})})},children:(0,t.jsx)(eo.RiClipboardLine,{className:"h-4 w-4 text-text-secondary"})}),(0,t.jsx)(N.default,{variant:"primary",onClick:o,children:u("generate.apply",{ns:"appDebug"})})]})]}),(0,t.jsxs)("div",{className:"flex grow flex-col overflow-y-auto",children:[a?.message&&(0,t.jsx)(eg,{message:a.message,className:"mb-3 shrink-0"}),(0,t.jsx)("div",{className:"grow pb-6",children:d?r?(0,t.jsx)(ed,{value:a?.modified,workflowVariableBlock:{show:!1}}):(0,t.jsx)(em,{value:a?.modified||"",nodeId:n}):(0,t.jsx)(eu,{editorWrapperClassName:"h-full",className:"bg-transparent pt-0",value:a?.modified,readOnly:!0,hideTopMenu:!0})})]})]})});e.s(["default",0,ev],313746);let eb="gen-data-",ey=e=>{let{storageKey:t}=e,[r,n]=(0,y.useSessionStorageState)(`${eb}${t}-versions`,{defaultValue:[]}),[a,l]=(0,y.useSessionStorageState)(`${eb}${t}-version-index`,{defaultValue:0}),i=r?.[a||0],o=(0,s.useCallback)(e=>{l(()=>r?.length||0),n(t=>[...t,e])},[n,l,r?.length]);return{versions:r,addVersion:o,currentVersionIndex:a,setCurrentVersionIndex:l,current:i}};e.s(["default",0,ey],513203);let ej=e=>{let{flowId:r,nodeId:n,currentCode:a,mode:l,isShow:i,codeLanguages:o,onClose:c,onFinished:u}=e,{t:d}=(0,w.useTranslation)(),m={temperature:.7,max_tokens:0,top_p:0,echo:!1,stop:[],presence_penalty:0,frequency_penalty:0},p=localStorage.getItem("auto-gen-model")?JSON.parse(localStorage.getItem("auto-gen-model")):null,[f,g]=s.useState(p||{name:"",provider:"",mode:l,completion_params:m}),{defaultModel:x}=(0,E.useModelListAndDefaultModelAndCurrentProviderAndModel)(M.ModelTypeEnum.textGeneration),[h,v]=(0,y.useSessionStorageState)(`improve-instruction-${r}-${n}`),b=h||"",[R,P]=(0,s.useState)(""),[D,{setTrue:L,setFalse:I}]=(0,j.default)(!1),{addVersion:_,current:$,currentVersionIndex:A,setCurrentVersionIndex:F,versions:z}=ey({storageKey:`${r}-${n}`}),[V,U]=(0,s.useState)(`${r}-0`),{data:q}=(0,H.useGenerateRuleTemplate)(ex.GeneratorType.code);(0,s.useEffect)(()=>{!b&&q&&v(q.data),U(`${r}-${Date.now()}`)},[q]);let W=(0,s.useCallback)(e=>{let t={...f,provider:e.provider,name:e.modelId,mode:e.mode};g(t),localStorage.setItem("auto-gen-model",JSON.stringify(t))},[f,g]),K=(0,s.useCallback)(e=>{let t={...f,completion_params:e};g(t),localStorage.setItem("auto-gen-model",JSON.stringify(t))},[f,g]),Y=async()=>{if((""!==b.trim()||(O.default.notify({type:"error",message:d("errorMsg.fieldRequired",{ns:"common",field:d("code.instruction",{ns:"appDebug"})})}),0))&&!D){L();try{let{error:e,...t}=await G({flow_id:r,node_id:n,current:a,instruction:b,model_config:f,ideal_output:R,language:eE[o]||"javascript"});t.code&&(t.modified=t.code),e?O.default.notify({type:"error",message:e}):_(t)}finally{I()}}},[Q,{setTrue:X,setFalse:Z}]=(0,j.default)(!1);(0,s.useEffect)(()=>{if(x){let e=localStorage.getItem("auto-gen-model")?JSON.parse(localStorage.getItem("auto-gen-model")||""):null;e?g({...e,completion_params:{...m,...e.completion_params}}):g(e=>({...e,name:x.model,provider:x.provider.provider}))}},[x]);let ee=(0,t.jsxs)("div",{className:"flex h-full w-0 grow flex-col items-center justify-center space-y-3",children:[(0,t.jsx)(k.default,{}),(0,t.jsx)("div",{className:"text-[13px] text-text-tertiary",children:d("codegen.loading",{ns:"appDebug"})})]});return(0,t.jsxs)(T.default,{isShow:i,onClose:c,className:"min-w-[1140px] !p-0",children:[(0,t.jsxs)("div",{className:"relative flex h-[680px] flex-wrap",children:[(0,t.jsxs)("div",{className:"h-full w-[570px] shrink-0 overflow-y-auto border-r border-divider-regular p-6",children:[(0,t.jsxs)("div",{className:"mb-5",children:[(0,t.jsx)("div",{className:`text-lg font-bold leading-[28px] ${ef.default.textGradient}`,children:d("codegen.title",{ns:"appDebug"})}),(0,t.jsx)("div",{className:"mt-1 text-[13px] font-normal text-text-tertiary",children:d("codegen.description",{ns:"appDebug"})})]}),(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsx)(B,{popupClassName:"!w-[520px]",portalToFollowElemContentClassName:"z-[1000]",isAdvancedMode:!0,provider:f.provider,completionParams:f.completion_params,modelId:f.name,setModel:W,onCompletionParamsChange:K,hideDebugWithMultipleModel:!0})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"text-[0px]",children:[(0,t.jsx)("div",{className:"system-sm-semibold-uppercase mb-1.5 text-text-secondary",children:d("codegen.instruction",{ns:"appDebug"})}),(0,t.jsx)(el,{editorKey:V,value:b,onChange:v,nodeId:n,generatorType:ex.GeneratorType.code,isShowCurrentBlock:!!a})]}),(0,t.jsx)(J,{value:R,onChange:P}),(0,t.jsxs)("div",{className:"mt-7 flex justify-end space-x-2",children:[(0,t.jsx)(N.default,{onClick:c,children:d("generate.dismiss",{ns:"appDebug"})}),(0,t.jsxs)(N.default,{className:"flex space-x-1",variant:"primary",onClick:Y,disabled:D,children:[(0,t.jsx)(S.Generator,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"text-xs font-semibold ",children:d("codegen.generate",{ns:"appDebug"})})]})]})]})]}),D&&ee,!D&&!$&&(0,t.jsx)(ei,{}),!D&&$&&(0,t.jsx)("div",{className:"h-full w-0 grow bg-background-default-subtle p-6 pb-0",children:(0,t.jsx)(ev,{current:$,currentVersionIndex:A||0,setCurrentVersionIndex:F,versions:z||[],onApply:X,generatorType:ex.GeneratorType.code})})]}),Q&&(0,t.jsx)(C.default,{title:d("codegen.overwriteConfirmTitle",{ns:"appDebug"}),content:d("codegen.overwriteConfirmMessage",{ns:"appDebug"}),isShow:!0,onConfirm:()=>{Z(),u($)},onCancel:Z})]})},ew=s.memo(ej);e.i(491401);var eN=e.i(585736);let eC=s.memo(e=>{let{nodeId:r,currentCode:n,className:a,codeLanguages:l,onGenerated:i}=e,[o,{setTrue:d,setFalse:m}]=(0,b.useBoolean)(!1),p=(0,s.useCallback)(e=>{i?.(e.modified),m()},[i,m]),g=(0,eN.useHooksStore)(e=>e.configsMap);return(0,t.jsxs)("div",{className:(0,u.cn)(a),children:[(0,t.jsx)(f.ActionButton,{className:"hover:bg-[#155EFF]/8",onClick:d,children:(0,t.jsx)(S.Generator,{className:"h-4 w-4 text-primary-600"})}),o&&(0,t.jsx)(ej,{mode:c.AppModeEnum.CHAT,isShow:o,codeLanguages:l,onClose:m,onFinished:p,flowId:g?.flowId||"",nodeId:r,currentCode:n})]})}),eS=s.memo(e=>{let{isExpand:r,onExpandChange:n}=e,a=(0,s.useCallback)(()=>{n(!r)},[r]),l=r?eo.RiCollapseDiagonalLine:eo.RiExpandDiagonalLine;return(0,t.jsx)(f.default,{onClick:a,children:(0,t.jsx)(l,{className:"h-4 w-4"})})});e.s(["default",0,eS],485587);let ek=e=>{let{className:r,style:n,children:a}=e;return(0,t.jsx)("div",{className:r,style:n,children:a})},eT=e=>{let{className:r,style:n,isExpand:a,children:s}=e,l=(0,X.useStore)(e=>e.panelWidth),i=a?{...n,width:l-1}:n;return(0,t.jsx)("div",{className:r,style:i,children:s})},eO=s.memo(e=>{let{isInNode:r,...n}=e;return r?(0,t.jsx)(eT,{...n}):(0,t.jsx)(ek,{...n})});e.s(["default",0,eO],882262);let eM=s.memo(e=>{let{nodeId:r,className:n,title:a,headerRight:l,children:i,minHeight:o=120,value:c,isFocus:d,isInNode:b,onGenerated:y,codeLanguages:j,fileList:w=[],showFileList:N,showCodeGenerator:C=!1,tip:S,footer:k}=e,T=(0,s.useRef)(null),{wrapClassName:O,wrapStyle:M,isExpand:E,setIsExpand:R,editorExpandHeight:P}=(0,v.default)({ref:T,hasFooter:!1,isInNode:b}),D=o-28,[L,I]=(0,s.useState)(D),[_,$]=s.useState(!1),A=(0,s.useCallback)(()=>{(0,m.default)(c),$(!0),setTimeout(()=>{$(!1)},2e3)},[c]);return(0,t.jsx)(eO,{className:(0,u.cn)(O),style:M,isInNode:b,isExpand:E,children:(0,t.jsxs)("div",{ref:T,className:(0,u.cn)(n,E&&"h-full","rounded-lg border",d?"overflow-hidden border-components-input-border-hover bg-components-input-bg-hover":"border-transparent bg-components-input-bg-normal"),children:[(0,t.jsxs)("div",{className:"flex h-7 items-center justify-between pl-3 pr-2 pt-1",children:[(0,t.jsx)("div",{className:"system-xs-semibold-uppercase text-text-secondary",children:a}),(0,t.jsxs)("div",{className:"flex items-center",onClick:e=>{e.nativeEvent.stopImmediatePropagation(),e.stopPropagation()},children:[l,!!(C&&j)&&(0,t.jsx)("div",{className:"ml-1",children:(0,t.jsx)(eC,{onGenerated:y,codeLanguages:j,currentCode:c,nodeId:r})}),(0,t.jsx)(f.default,{className:"ml-1",onClick:A,children:_?(0,t.jsx)(h.CopyCheck,{className:"h-4 w-4"}):(0,t.jsx)(x.Copy,{className:"h-4 w-4 cursor-pointer"})}),(0,t.jsx)("div",{className:"ml-1",children:(0,t.jsx)(eS,{isExpand:E,onExpandChange:R})})]})]}),!!S&&(0,t.jsx)("div",{className:"px-1 py-0.5",children:S}),(0,t.jsx)(p.default,{height:E?P:L,minHeight:D,onHeightChange:I,hideResize:E,children:(0,t.jsx)("div",{className:"h-full pb-2 pl-2",children:i})}),N&&w.length>0&&(0,t.jsx)(g.default,{fileList:w}),k]})})});n.loader.config({paths:{vs:`${window.location.origin}${d.basePath}/vs`}});let eE={[i.CodeLanguage.javascript]:"javascript",[i.CodeLanguage.python3]:"python",[i.CodeLanguage.json]:"json"},eR=s.memo(e=>{let{nodeId:n,value:i="",placeholder:d="",onChange:m=a.noop,title:p="",headerRight:f,language:g,readOnly:x,isJSONStringifyBeauty:h,height:v,isInNode:b,onMount:y,noWrapper:j,isExpand:w,showFileList:N,onGenerated:C,showCodeGenerator:S=!1,className:k,tip:T,footer:O}=e,[M,E]=s.useState(!1),[R,P]=s.useState(!1),[D,L]=(0,s.useState)(56),{theme:I}=(0,o.default)(),_=(0,s.useRef)(i);(0,s.useEffect)(()=>{_.current=i},[i]);let $=(0,s.useMemo)(()=>"object"==typeof i?(0,l.getFilesInLogs)(i):[],[i]),A=(0,s.useRef)(null),F=()=>{A.current&&L(A.current.getContentHeight())},B=(()=>{if(!h)return i;try{return JSON.stringify(i,null,2)}catch{return i}})(),z=(0,s.useMemo)(()=>I===c.Theme.light?"light":"vs-dark",[I]),V=(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.default,{language:eE[g]||"javascript",theme:R?z:"default-theme",value:B,loading:(0,t.jsx)("span",{className:"text-text-primary",children:"Loading..."}),onChange:e=>{m(e||""),setTimeout(()=>{F()},10)},options:{readOnly:x,domReadOnly:!0,quickSuggestions:!1,minimap:{enabled:!1},lineNumbersMinChars:1,wordWrap:"on",unicodeHighlight:{ambiguousCharacters:!1},stickyScroll:{enabled:!1}},onMount:(e,t)=>{A.current=e,F(),e.onDidFocusEditorText(()=>{E(!0)}),e.onDidBlurEditorText(()=>{E(!1)}),t.editor.setTheme(I===c.Theme.light?"light":"vs-dark"),y?.(e,t),P(!0)}}),!B&&!M&&(0,t.jsx)("div",{className:"pointer-events-none absolute left-[36px] top-0 text-[13px] font-normal leading-[18px] text-gray-300",children:d})]});return(0,t.jsx)("div",{className:(0,u.cn)(w&&"h-full",k),children:j?(0,t.jsx)("div",{className:"no-wrapper relative",style:{height:w?"100%":D/2+18,minHeight:18},children:V}):(0,t.jsx)(eM,{nodeId:n,className:"relative",title:p,value:B,headerRight:f,isFocus:M&&!x,minHeight:v||200,isInNode:b,onGenerated:C,codeLanguages:g,fileList:$,showFileList:N,showCodeGenerator:S,tip:T,footer:O,children:V})})})}]);
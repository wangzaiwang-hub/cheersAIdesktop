(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,419874,e=>{"use strict";var t=e.i(563199),a=e.i(837699),s=e.i(417944),r=e.i(26012),n=e.i(326531),i=e.i(268255);e.i(152567);var l=e.i(408767),o=e.i(189299),d=e.i(654313),c=e.i(744704),u=e.i(75518),p=e.i(449980),m=e.i(379415),x=e.i(543753),f=e.i(137667),g=e.i(459760),h=e.i(447301),y=e.i(935139);e.i(237855);var b=e.i(297162),j=e.i(481162),v=e.i(955371);let k=(0,i.memo)(e=>{let{data:a,content:s,currentTab:r}=e;return(0,t.jsxs)(t.Fragment,{children:["RESULT"===r&&(0,t.jsxs)("div",{className:"space-y-3 p-4",children:[a?.resultText&&(0,t.jsx)(m.Markdown,{content:a?.resultText||""}),!!a?.files?.length&&(0,t.jsx)("div",{className:"flex flex-col gap-2",children:a?.files.map(e=>(0,t.jsxs)("div",{className:"system-xs-regular flex flex-col gap-1",children:[(0,t.jsx)("div",{className:"py-1 text-text-tertiary ",children:e.varName}),(0,t.jsx)(b.FileList,{files:e.list,showDeleteAction:!1,showDownloadAction:!0,canPreview:!0})]},e.varName))})]}),"DETAIL"===r&&s&&(0,t.jsx)("div",{className:"p-4",children:(0,t.jsx)(j.default,{readOnly:!0,title:(0,t.jsx)("div",{children:"JSON OUTPUT"}),language:v.CodeLanguage.json,value:s,isJSONStringifyBeauty:!0})})]})}),S=e=>{let{isWorkflow:b,workflowProcessData:j,className:v,isError:N,onRetry:w,content:_,messageId:T,isLoading:C,isResponding:A,moreLikeThis:R,isInWebApp:I=!1,feedback:L,onFeedback:F,onSave:E,depth:M=1,isMobile:D,appSourceType:U,installedAppId:W,taskId:P,controlClearMoreLikeThis:O,supportFeedback:q,isShowTextToSpeech:B,hideProcessDetail:$,siteInfo:K,inSidePanel:G}=e,{t:J}=(0,l.useTranslation)(),Q=(0,n.useParams)(),V=1===M,X=U===h.AppSourceType.tryApp,[z,H]=(0,i.useState)(""),[Y,Z]=(0,i.useState)(null),[ee,et]=(0,i.useState)({rating:null}),{config:ea}=(0,u.useChatContext)(),es=(0,o.useStore)(e=>e.setCurrentLogItem),er=(0,o.useStore)(e=>e.setShowPromptLogModal),en=async e=>{await (0,h.updateFeedback)({url:`/messages/${Y}/feedbacks`,body:{rating:e.rating}},U,W),et(e)},[ei,{setTrue:el,setFalse:eo}]=(0,s.useBoolean)(!1),ed=async()=>{if(ei||!T)return void f.default.notify({type:"warning",message:J("errorMessage.waitForResponse",{ns:"appDebug"})});el();let e=await (0,h.fetchMoreLikeThis)(T,U,W);H(e.answer),et({rating:null}),Z(e.id),eo()};(0,i.useEffect)(()=>{O&&(Z(null),H(""))},[O]),(0,i.useEffect)(()=>{C&&Z(null)},[C]);let ec=async()=>{let e=await (0,g.fetchTextGenerationMessage)({appId:Q.appId,messageId:T});es(Array.isArray(e.message)?{...e,log:[...e.message,..."assistant"!==e.message[e.message.length-1].role?[{role:"assistant",text:e.answer,files:e.message_files?.filter(e=>"assistant"===e.belongs_to)||[]}]:[]]}:{...e,log:["string"==typeof e.message?{text:e.message}:e.message]}),er(!0)},[eu,ep]=(0,i.useState)("DETAIL"),em=!!j?.resultText||!!j?.files?.length,ex=async e=>{ep(e)};return(0,i.useEffect)(()=>{j?.resultText||j?.files?.length?ex("RESULT"):ex("DETAIL")},[j?.files?.length,j?.resultText]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:(0,y.cn)("relative",!V&&"mt-3",v),children:[C&&(0,t.jsx)("div",{className:(0,y.cn)("flex h-10 items-center",!G&&"rounded-2xl border-t border-divider-subtle bg-chat-bubble-bg"),children:(0,t.jsx)(p.default,{type:"area"})}),!C&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:(0,y.cn)("relative",!G&&"rounded-2xl border-t border-divider-subtle bg-chat-bubble-bg"),children:[j&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:(0,y.cn)("p-3",em&&"border-b border-divider-subtle"),children:[P&&(0,t.jsxs)("div",{className:(0,y.cn)("system-2xs-medium-uppercase mb-2 flex items-center text-text-accent-secondary",N&&"text-text-destructive"),children:[(0,t.jsx)(a.RiPlayList2Line,{className:"mr-1 h-3 w-3"}),(0,t.jsx)("span",{children:J("generation.execution",{ns:"share"})}),(0,t.jsx)("span",{className:"px-1",children:"·"}),(0,t.jsx)("span",{children:P})]}),K&&j&&(0,t.jsx)(c.default,{data:j,expand:j.expand,hideProcessDetail:$,hideInfo:$,readonly:!K.show_workflow_steps}),em&&(0,t.jsxs)("div",{className:"flex items-center space-x-6 px-1",children:[(0,t.jsx)("div",{className:(0,y.cn)("system-sm-semibold-uppercase cursor-pointer border-b-2 border-transparent py-3 text-text-tertiary","RESULT"===eu&&"border-util-colors-blue-brand-blue-brand-600 text-text-primary"),onClick:()=>ex("RESULT"),children:J("result",{ns:"runLog"})}),(0,t.jsx)("div",{className:(0,y.cn)("system-sm-semibold-uppercase cursor-pointer border-b-2 border-transparent py-3 text-text-tertiary","DETAIL"===eu&&"border-util-colors-blue-brand-blue-brand-600 text-text-primary"),onClick:()=>ex("DETAIL"),children:J("detail",{ns:"runLog"})})]})]}),!N&&(0,t.jsx)(k,{data:j,content:_,currentTab:eu})]}),!j&&P&&(0,t.jsxs)("div",{className:(0,y.cn)("system-2xs-medium-uppercase sticky left-0 top-0 flex w-full items-center rounded-t-2xl bg-components-actionbar-bg p-4 pb-3 text-text-accent-secondary",N&&"text-text-destructive"),children:[(0,t.jsx)(a.RiPlayList2Line,{className:"mr-1 h-3 w-3"}),(0,t.jsx)("span",{children:J("generation.execution",{ns:"share"})}),(0,t.jsx)("span",{className:"px-1",children:"·"}),(0,t.jsx)("span",{children:`${P}${M>1?`-${M-1}`:""}`})]}),N&&(0,t.jsx)("div",{className:"body-lg-regular p-4 pt-0 text-text-quaternary",children:J("generation.batchFailed.outputPlaceholder",{ns:"share"})}),!j&&!N&&"string"==typeof _&&(0,t.jsx)("div",{className:(0,y.cn)("p-4",P&&"pt-0"),children:(0,t.jsx)(m.Markdown,{content:_})})]}),(0,t.jsxs)("div",{className:(0,y.cn)("system-xs-regular relative mt-1 h-4 px-4 text-text-quaternary",D&&(Y||ei)&&M<3&&"pl-10"),children:[!b&&(0,t.jsxs)("span",{children:[_?.length," ",J("unit.char",{ns:"common"})]}),(0,t.jsxs)("div",{className:"absolute bottom-1 right-2 flex items-center",children:[!I&&U!==h.AppSourceType.installedApp&&!A&&(0,t.jsx)("div",{className:"ml-1 flex items-center gap-0.5 rounded-[10px] border-[0.5px] border-components-actionbar-border bg-components-actionbar-bg p-0.5 shadow-md backdrop-blur-sm",children:(0,t.jsx)(d.default,{disabled:N||!T,onClick:ec,children:(0,t.jsx)(a.RiFileList3Line,{className:"h-4 w-4"})})}),(0,t.jsxs)("div",{className:"ml-1 flex items-center gap-0.5 rounded-[10px] border-[0.5px] border-components-actionbar-border bg-components-actionbar-bg p-0.5 shadow-md backdrop-blur-sm",children:[R&&!X&&(0,t.jsx)(d.default,{state:3===M?d.ActionButtonState.Disabled:d.ActionButtonState.Default,disabled:3===M,onClick:ed,children:(0,t.jsx)(a.RiSparklingLine,{className:"h-4 w-4"})}),B&&!X&&(0,t.jsx)(x.default,{id:T,voice:ea?.text_to_speech?.voice}),("RESULT"===eu&&j?.resultText||!b)&&(0,t.jsx)(d.default,{disabled:N||!T,onClick:()=>{let e=b?j?.resultText:_;"string"==typeof e?(0,r.default)(e):(0,r.default)(JSON.stringify(e)),f.default.notify({type:"success",message:J("actionMsg.copySuccessfully",{ns:"common"})})},children:(0,t.jsx)(a.RiClipboardLine,{className:"h-4 w-4"})}),I&&N&&(0,t.jsx)(d.default,{onClick:w,children:(0,t.jsx)(a.RiReplay15Line,{className:"h-4 w-4"})}),I&&!b&&!X&&(0,t.jsx)(d.default,{disabled:N||!T,onClick:()=>{E?.(T)},children:(0,t.jsx)(a.RiBookmark3Line,{className:"h-4 w-4"})})]}),(q||I)&&!b&&!X&&!N&&T&&(0,t.jsxs)("div",{className:"ml-1 flex items-center gap-0.5 rounded-[10px] border-[0.5px] border-components-actionbar-border bg-components-actionbar-bg p-0.5 shadow-md backdrop-blur-sm",children:[!L?.rating&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d.default,{onClick:()=>F?.({rating:"like"}),children:(0,t.jsx)(a.RiThumbUpLine,{className:"h-4 w-4"})}),(0,t.jsx)(d.default,{onClick:()=>F?.({rating:"dislike"}),children:(0,t.jsx)(a.RiThumbDownLine,{className:"h-4 w-4"})})]}),L?.rating==="like"&&(0,t.jsx)(d.default,{state:d.ActionButtonState.Active,onClick:()=>F?.({rating:null}),children:(0,t.jsx)(a.RiThumbUpLine,{className:"h-4 w-4"})}),L?.rating==="dislike"&&(0,t.jsx)(d.default,{state:d.ActionButtonState.Destructive,onClick:()=>F?.({rating:null}),children:(0,t.jsx)(a.RiThumbDownLine,{className:"h-4 w-4"})})]})]})]}),!V&&(0,t.jsxs)("div",{className:(0,y.cn)("absolute top-[-32px] flex h-[33px] w-4 justify-center",D?"left-[17px]":"left-[50%] translate-x-[-50%]"),children:[(0,t.jsx)("div",{className:"h-full w-0.5 bg-divider-regular"}),(0,t.jsx)("div",{className:(0,y.cn)("absolute left-0 flex h-4 w-4 items-center justify-center rounded-2xl border-[0.5px] border-divider-subtle bg-util-colors-blue-blue-500 shadow-xs",D?"top-[3.5px]":"top-2"),children:(0,t.jsx)(a.RiSparklingFill,{className:"h-3 w-3 text-text-primary-on-surface"})})]})]})]}),(Y||ei)&&M<3&&(0,t.jsx)(S,{isInWebApp:!0,content:z,messageId:Y,depth:M+1,moreLikeThis:!0,onFeedback:en,isLoading:ei,feedback:ee,onSave:E,isShowTextToSpeech:B,isMobile:D,appSourceType:U,installedAppId:W,controlClearMoreLikeThis:O,isWorkflow:b,siteInfo:K,taskId:P})]})},N=i.memo(S);e.s(["default",0,N],419874)},290422,e=>{"use strict";e.s(["addFileInfos",0,(e,t)=>e&&t?e.map(e=>e.files&&e.files?.length>0?{...e,message_files:e.files.map(e=>t.find(t=>t.id===e))}:e):e,"sortAgentSorts",0,e=>{if(!e||e.some(e=>void 0===e.position))return e;let t=[...e];return t.sort((e,t)=>e.position-t.position),t}])},366892,e=>{"use strict";var t=e.i(563199),a=e.i(268255),s=e.i(935139);let r=a.memo(e=>{let{items:a,value:r,itemClassName:n,itemWrapClassName:i,activeItemClassName:l,onChange:o}=e,d=e=>{let{id:a,name:d,icon:c,extra:u,disabled:p}=e;return(0,t.jsxs)("div",{className:(0,s.cn)("system-md-semibold relative flex cursor-pointer items-center border-b-2 border-transparent pb-2 pt-2.5",a===r?(0,s.cn)("border-components-tab-active text-text-primary",l):"text-text-tertiary",p&&"cursor-not-allowed opacity-30",i),onClick:()=>!p&&o(a),children:[c||"",(0,t.jsx)("div",{className:(0,s.cn)("ml-2",n),children:d}),u||""]},a)};return(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("div",{className:"flex space-x-4",children:a.filter(e=>!e.isRight).map(d)}),(0,t.jsx)("div",{className:"flex space-x-4",children:a.filter(e=>e.isRight).map(d)})]})});e.s(["default",0,r])},881110,e=>{"use strict";var t=e.i(149086),a=e.i(354440),s=(0,t.createUseStorageState)(function(){return a.default?localStorage:void 0});e.s(["useLocalStorageState",0,s],881110)},112727,387450,608846,210807,727163,e=>{"use strict";var t=e.i(484474);e.s(["Message3Fill",()=>t.default],112727);var a=e.i(563199);e.i(326531);var s=e.i(268255),r=e.i(639751);e.i(53349);var n=e.i(449980),i=e.i(752901),l=e.i(562572),o=e.i(447301),d=e.i(722384);let c="webapp",u=[c,"conversations"];e.s(["useGetWebAppAccessModeByCode",0,e=>(0,l.useQuery)({queryKey:[c,"appAccessMode",e],queryFn:()=>(0,o.getAppAccessModeByAppCode)(e),enabled:!!e,staleTime:0,gcTime:0}),"useInvalidateShareConversations",0,()=>(0,d.useInvalid)(u),"useShareChatList",0,function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{enabled:a=!0,refetchOnReconnect:s,refetchOnWindowFocus:r}=t,n=a&&e.appSourceType!==o.AppSourceType.tryApp&&(e.appSourceType!==o.AppSourceType.installedApp||!!e.appId)&&!!e.conversationId;return(0,l.useQuery)({queryKey:[c,"chatList",e],queryFn:()=>(0,o.fetchChatList)(e.conversationId,e.appSourceType,e.appId),enabled:n,refetchOnReconnect:s,refetchOnWindowFocus:r,staleTime:0})},"useShareConversationName",0,function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{enabled:a=!0,refetchOnReconnect:s,refetchOnWindowFocus:r}=t,n=a&&(e.appSourceType!==o.AppSourceType.installedApp||!!e.appId)&&!!e.conversationId;return(0,l.useQuery)({queryKey:[c,"conversationName",e],queryFn:()=>(0,o.generationConversationName)(e.appSourceType,e.appId,e.conversationId),enabled:n,refetchOnReconnect:s,refetchOnWindowFocus:r})},"useShareConversations",0,function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{enabled:a=!0,refetchOnReconnect:s,refetchOnWindowFocus:r}=t,n=a&&e.appSourceType!==o.AppSourceType.tryApp&&(e.appSourceType!==o.AppSourceType.installedApp||!!e.appId);return(0,l.useQuery)({queryKey:[c,"conversations",e],queryFn:()=>(0,o.fetchConversations)(e.appSourceType,e.appId,e.lastId,e.pinned,e.limit),enabled:n,refetchOnReconnect:s,refetchOnWindowFocus:r})}],387450),e.i(494268);let p=(0,r.create)(e=>({shareCode:null,updateShareCode:t=>e(()=>({shareCode:t})),appInfo:null,updateAppInfo:t=>e(()=>({appInfo:t})),appParams:null,updateAppParams:t=>e(()=>({appParams:t})),webAppAccessMode:i.AccessMode.SPECIFIC_GROUPS_MEMBERS,updateWebAppAccessMode:t=>e(()=>({webAppAccessMode:t})),appMeta:null,updateWebAppMeta:t=>e(()=>({appMeta:t})),userCanAccessApp:!1,updateUserCanAccessApp:t=>e(()=>({userCanAccessApp:t})),embeddedUserId:null,updateEmbeddedUserId:t=>e(()=>({embeddedUserId:t})),embeddedConversationId:null,updateEmbeddedConversationId:t=>e(()=>({embeddedConversationId:t}))}));e.s(["useWebAppStore",0,p],608846);var m=e.i(837699),x=e.i(417944),f=e.i(915389),g=e.i(105845),h=e.i(419874),y=e.i(151094),b=e.i(223314);e.i(992280);var j=e.i(85789),v=e.i(137667);e.i(152567);var k=e.i(408767);let S=s.memo(()=>{let{t:e}=(0,k.useTranslation)();return(0,a.jsxs)("div",{className:"flex h-full w-full flex-col items-center justify-center",children:[(0,a.jsx)(m.RiSparklingFill,{className:"h-12 w-12 text-text-empty-state-icon"}),(0,a.jsx)("div",{className:"system-sm-regular mt-2 text-text-quaternary",children:e("generation.noData",{ns:"share"})})]})});var N=e.i(390622),w=e.i(925521),_=e.i(648404),T=e.i(842090),C=e.i(680884);let A=s.memo(e=>{let{isWorkflow:t,isCallBatchAPI:r,isPC:i,isMobile:l,appSourceType:d,appId:c,isError:u,isShowTextToSpeech:p,promptConfig:k,moreLikeThisEnabled:A,inputs:R,controlSend:I,controlRetry:L,controlStopResponding:F,onShowRes:E,handleSaveMessage:M,taskId:D,onCompleted:U,visionConfig:W,completionFiles:P,siteInfo:O,onRunStart:q,onRunControlChange:B,hideInlineStopButton:$=!1}=e,[K,{setTrue:G,setFalse:J}]=(0,x.useBoolean)(!1),[Q,V]=(0,s.useState)(""),X=(0,s.useRef)(""),z=e=>{X.current=e,V(e)},[H,Y]=(0,s.useState)(),Z=(0,s.useRef)(void 0),ee=e=>{Z.current=e,Y(e)},[et,ea]=(0,s.useState)(null),[es,er]=(0,s.useState)(!1),en=(0,s.useRef)(null),ei=(0,s.useCallback)(()=>{ea(null),er(!1),en.current=null,B?.(null)},[B]);(0,s.useEffect)(()=>{let e=()=>{en.current?.abort()};return F&&(e(),J(),ei()),e},[F,ei,J]);let{notify:el}=v.default,eo=!Q,[ed,ec]=(0,s.useState)(null),[eu,ep]=(0,s.useState)({rating:null}),em=async e=>{await (0,o.updateFeedback)({url:`/messages/${ed}/feedbacks`,body:{rating:e.rating,content:e.content}},d,c),ep(e)},ex=(0,s.useCallback)(async()=>{if(et&&!es){er(!0);try{t?await (0,o.stopWorkflowMessage)(c,et,d,c||""):await (0,o.stopChatMessageResponding)(c,et,d,c||""),en.current?.abort()}catch(e){el({type:"error",message:e instanceof Error?e.message:String(e)})}finally{er(!1)}}},[c,et,d,c,es,t,el]);(0,s.useEffect)(()=>{B&&(K&&et?B({onStop:ex,isStopping:es}):B(null))},[et,ex,K,es,B]);let ef=async()=>{if(K)return el({type:"info",message:(0,f.t)("errorMessage.waitForResponse",{ns:"appDebug"})}),!1;if(!(()=>{if(r)return!0;let e=k?.prompt_variables;if(!e||e?.length===0)return!P.find(e=>e.transfer_method===_.TransferMethod.local_file&&!e.upload_file_id)||(el({type:"info",message:(0,f.t)("errorMessage.waitForFileUpload",{ns:"appDebug"})}),!1);let t="";return((e?.filter(e=>{let{key:t,name:a,required:s,type:r}=e;return"boolean"!==r&&"checkbox"!==r&&(!t||!t.trim()||!a||!a.trim()||s||null==s)})||[]).forEach(e=>{let{key:a,name:s}=e;!t&&(R[a]||(t=s))}),t)?(el({type:"error",message:(0,f.t)("errorMessage.valueOfVarRequired",{ns:"appDebug",key:t})}),!1):P.find(e=>e.transfer_method===_.TransferMethod.local_file&&!e.upload_file_id)?(el({type:"info",message:(0,f.t)("errorMessage.waitForFileUpload",{ns:"appDebug"})}),!1):!t})())return;let e={...(0,C.formatBooleanInputs)(k?.prompt_variables,R)};k?.prompt_variables.forEach(t=>{let a=e[t.key];"file"===t.type&&a&&"object"==typeof a&&!Array.isArray(a)?e[t.key]=(0,b.getProcessedFiles)([a])[0]:"file-list"===t.type&&Array.isArray(a)&&a.length>0&&(e[t.key]=(0,b.getProcessedFiles)(a))});let a={inputs:e};W.enabled&&P&&P?.length>0&&(a.files=P.map(e=>e.transfer_method===_.TransferMethod.local_file?{...e,url:""}:e)),ec(null),ep({rating:null}),z(""),ei();let s=[],n="";i||(E(),q()),G();let l=!1,u=!1;(async()=>{await (0,T.sleep)(w.TEXT_GENERATION_TIMEOUT_MS),l||(J(),U(X.current,D,!1),ei(),u=!0)})(),t?(0,o.sendWorkflowMessage)(a,{onWorkflowStarted:e=>{let{workflow_run_id:t,task_id:a}=e;n=t,ea(a||null),er(!1),ee({status:N.WorkflowRunningStatus.Running,tracing:[],expand:!1,resultText:""})},onIterationStart:e=>{let{data:t}=e;ee((0,g.produce)(Z.current,e=>{e.expand=!0,e.tracing.push({...t,status:N.NodeRunningStatus.Running,expand:!0})}))},onIterationNext:()=>{ee((0,g.produce)(Z.current,e=>{e.expand=!0;let t=e.tracing.find(e=>e.node_id===a.node_id&&(e.execution_metadata?.parallel_id===a.execution_metadata?.parallel_id||e.parallel_id===a.execution_metadata?.parallel_id));t?.details.push([])}))},onIterationFinish:e=>{let{data:t}=e;ee((0,g.produce)(Z.current,e=>{e.expand=!0;let a=e.tracing.findIndex(e=>e.node_id===t.node_id&&(e.execution_metadata?.parallel_id===t.execution_metadata?.parallel_id||e.parallel_id===t.execution_metadata?.parallel_id));e.tracing[a]={...t,expand:!!t.error}}))},onLoopStart:e=>{let{data:t}=e;ee((0,g.produce)(Z.current,e=>{e.expand=!0,e.tracing.push({...t,status:N.NodeRunningStatus.Running,expand:!0})}))},onLoopNext:()=>{ee((0,g.produce)(Z.current,e=>{e.expand=!0;let t=e.tracing.find(e=>e.node_id===a.node_id&&(e.execution_metadata?.parallel_id===a.execution_metadata?.parallel_id||e.parallel_id===a.execution_metadata?.parallel_id));t?.details.push([])}))},onLoopFinish:e=>{let{data:t}=e;ee((0,g.produce)(Z.current,e=>{e.expand=!0;let a=e.tracing.findIndex(e=>e.node_id===t.node_id&&(e.execution_metadata?.parallel_id===t.execution_metadata?.parallel_id||e.parallel_id===t.execution_metadata?.parallel_id));e.tracing[a]={...t,expand:!!t.error}}))},onNodeStarted:e=>{let{data:t}=e;t.iteration_id||t.loop_id||ee((0,g.produce)(Z.current,e=>{e.expand=!0,e.tracing.push({...t,status:N.NodeRunningStatus.Running,expand:!0})}))},onNodeFinished:e=>{let{data:t}=e;t.iteration_id||t.loop_id||ee((0,g.produce)(Z.current,e=>{let a=e.tracing.findIndex(e=>e.node_id===t.node_id&&(e.execution_metadata?.parallel_id===t.execution_metadata?.parallel_id||e.parallel_id===t.execution_metadata?.parallel_id));a>-1&&e.tracing&&(e.tracing[a]={...e.tracing[a].extras?{extras:e.tracing[a].extras}:{},...t,expand:!!t.error})}))},onWorkflowFinished:e=>{let{data:t}=e;if(u)return void el({type:"warning",message:(0,f.t)("warningMessage.timeoutExceeded",{ns:"appDebug"})});let a=t.status,s=e=>{if(!e)return;let t=e=>{[N.NodeRunningStatus.Running,N.NodeRunningStatus.Waiting].includes(e.status)&&(e.status=N.NodeRunningStatus.Stopped),e.details?.forEach(e=>e.forEach(t)),e.retryDetail?.forEach(t),e.parallelDetail?.children?.forEach(t)};e.forEach(t)};if(a===N.WorkflowRunningStatus.Stopped){ee((0,g.produce)(Z.current,e=>{e.status=N.WorkflowRunningStatus.Stopped,s(e.tracing)})),J(),ei(),U(X.current,D,!1),l=!0;return}if(t.error){el({type:"error",message:t.error}),ee((0,g.produce)(Z.current,e=>{e.status=N.WorkflowRunningStatus.Failed,s(e.tracing)})),J(),ei(),U(X.current,D,!1),l=!0;return}ee((0,g.produce)(Z.current,e=>{e.status=N.WorkflowRunningStatus.Succeeded,e.files=(0,b.getFilesInLogs)(t.outputs||[])})),t.outputs?(z(t.outputs),1===Object.keys(t.outputs).length&&"string"==typeof t.outputs[Object.keys(t.outputs)[0]]&&ee((0,g.produce)(Z.current,e=>{e.resultText=t.outputs[Object.keys(t.outputs)[0]]}))):z(""),J(),ei(),ec(n),U(X.current,D,!0),l=!0},onTextChunk:e=>{let{data:{text:t}}=e;ee((0,g.produce)(Z.current,e=>{e.resultText+=t}))},onTextReplace:e=>{let{data:{text:t}}=e;ee((0,g.produce)(Z.current,e=>{e.resultText=t}))}},d,c).catch(e=>{J(),ei(),el({type:"error",message:e instanceof Error?e.message:String(e)})}):(0,o.sendCompletionMessage)(a,{onData:(e,t,a)=>{let{messageId:r,taskId:i}=a;n=r,i&&"string"==typeof i&&""!==i.trim()&&ea(e=>e??i),s.push(e),z(s.join(""))},onCompleted:()=>{u?el({type:"warning",message:(0,f.t)("warningMessage.timeoutExceeded",{ns:"appDebug"})}):(J(),ei(),ec(n),U(X.current,D,!0),l=!0)},onMessageReplace:e=>{z((s=[e.answer]).join(""))},onError(){u?el({type:"warning",message:(0,f.t)("warningMessage.timeoutExceeded",{ns:"appDebug"})}):(J(),ei(),U(X.current,D,!1),l=!0)},getAbortController:e=>{en.current=e}},d,c)},[eg,eh]=(0,s.useState)(0);(0,s.useEffect)(()=>{I&&(ef(),eh(Date.now()))},[I]),(0,s.useEffect)(()=>{L&&ef()},[L]);let ey=()=>(0,a.jsxs)(a.Fragment,{children:[!$&&K&&et&&(0,a.jsx)("div",{className:`mb-3 flex ${i?"justify-end":"justify-center"}`,children:(0,a.jsxs)(y.default,{variant:"secondary",disabled:es,onClick:ex,children:[es?(0,a.jsx)(m.RiLoader2Line,{className:"mr-[5px] h-3.5 w-3.5 animate-spin"}):(0,a.jsx)(j.StopCircle,{className:"mr-[5px] h-3.5 w-3.5"}),(0,a.jsx)("span",{className:"text-xs font-normal",children:(0,f.t)("operation.stopResponding",{ns:"appDebug"})})]})}),(0,a.jsx)(h.default,{isWorkflow:t,workflowProcessData:H,isError:u,onRetry:ef,content:Q,messageId:ed,isInWebApp:!0,moreLikeThis:A,onFeedback:em,feedback:eu,onSave:M,isMobile:l,appSourceType:d,installedAppId:c,isLoading:!!r&&!Q&&K,taskId:r?D<10?`0${D}`:`${D}`:void 0,controlClearMoreLikeThis:eg,isShowTextToSpeech:p,hideProcessDetail:!0,siteInfo:O})]});return(0,a.jsxs)(a.Fragment,{children:[!r&&!t&&(K&&!Q?(0,a.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,a.jsx)(n.default,{type:"area"})}):(0,a.jsx)(a.Fragment,{children:eo?(0,a.jsx)(S,{}):ey()})),!r&&t&&(K&&!H?(0,a.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,a.jsx)(n.default,{type:"area"})}):H?ey():(0,a.jsx)(S,{})),r&&ey()]})});e.s(["default",0,A],210807),e.i(237855);var R=e.i(910605),I=e.i(189107),L=e.i(291631),F=e.i(299951),E=e.i(873517),M=e.i(371784),D=e.i(481162),U=e.i(955371),W=e.i(271743),P=e.i(935139);let O=s.memo(e=>{let{promptConfig:t,inputs:r,inputsRef:n,onInputsChange:i,onSend:l,visionConfig:o,onVisionFilesChange:d,runControl:c}=e,{t:u}=(0,k.useTranslation)(),p=(0,W.default)()===W.MediaType.pc,[x,f]=(0,s.useState)(!1),g=!!c,h=u("generation.stopRun",{ns:"share",defaultValue:"Stop Run"}),b=(0,s.useCallback)(e=>{g&&(e.preventDefault(),c?.onStop?.())},[g,c]),v=(0,s.useCallback)(e=>{i(e),n.current=e},[i,n]);return(0,s.useEffect)(()=>{if(x)return;let e={};t.prompt_variables.forEach(t=>{"select"===t.type?e[t.key]=t.default:"string"===t.type||"paragraph"===t.type?e[t.key]=t.default||"":"number"===t.type?e[t.key]=t.default??"":"checkbox"===t.type?e[t.key]=t.default||!1:"file"===t.type?e[t.key]=void 0:"file-list"===t.type?e[t.key]=[]:e[t.key]=void 0}),i(e),f(!0)},[t.prompt_variables,i]),(0,a.jsx)("div",{className:"",children:(0,a.jsx)("section",{children:(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),l()},children:[null!=r&&0!==Object.keys(r).length&&x?t.prompt_variables.filter(e=>!0!==e.hide).map(e=>(0,a.jsxs)("div",{className:"mt-4 w-full",children:["checkbox"!==e.type&&(0,a.jsxs)("div",{className:"system-md-semibold flex h-6 items-center gap-1 text-text-secondary",children:[(0,a.jsx)("div",{className:"truncate",children:e.name}),!e.required&&(0,a.jsx)("span",{className:"system-xs-regular text-text-tertiary",children:u("panel.optional",{ns:"workflow"})})]}),(0,a.jsxs)("div",{className:"mt-1",children:["select"===e.type&&(0,a.jsx)(F.default,{className:"w-full",defaultValue:r[e.key],onSelect:t=>{v({...n.current,[e.key]:t.value})},items:(e.options||[]).map(e=>({name:e,value:e})),allowSearch:!1}),"string"===e.type&&(0,a.jsx)(L.default,{type:"text",placeholder:e.name,value:r[e.key],onChange:t=>{v({...n.current,[e.key]:t.target.value})},maxLength:e.max_length}),"paragraph"===e.type&&(0,a.jsx)(E.default,{className:"h-[104px] sm:text-xs",placeholder:e.name,value:r[e.key],onChange:t=>{v({...n.current,[e.key]:t.target.value})}}),"number"===e.type&&(0,a.jsx)(L.default,{type:"number",placeholder:e.name,value:r[e.key],onChange:t=>{v({...n.current,[e.key]:t.target.value})}}),"checkbox"===e.type&&(0,a.jsx)(M.default,{name:e.name||e.key,value:!!r[e.key],required:e.required,onChange:t=>{v({...n.current,[e.key]:t})}}),"file"===e.type&&(0,a.jsx)(R.FileUploaderInAttachmentWrapper,{value:r[e.key]&&"object"==typeof r[e.key]?[r[e.key]]:[],onChange:t=>{v({...n.current,[e.key]:t[0]})},fileConfig:{...e.config,fileUploadConfig:o.fileUploadConfig}}),"file-list"===e.type&&(0,a.jsx)(R.FileUploaderInAttachmentWrapper,{value:Array.isArray(r[e.key])?r[e.key]:[],onChange:t=>{v({...n.current,[e.key]:t})},fileConfig:{...e.config,fileUploadConfig:o.fileUploadConfig}}),"json_object"===e.type&&(0,a.jsx)(D.default,{language:U.CodeLanguage.json,value:r[e.key],onChange:t=>{v({...n.current,[e.key]:t})},noWrapper:!0,className:"bg h-[80px] overflow-y-auto rounded-[10px] bg-components-input-bg-normal p-1",placeholder:(0,a.jsx)("div",{className:"whitespace-pre",children:"string"==typeof e.json_schema?e.json_schema:JSON.stringify(e.json_schema||"",null,2)})})]})]},e.key)):null,o?.enabled&&(0,a.jsxs)("div",{className:"mt-4 w-full",children:[(0,a.jsx)("div",{className:"system-md-semibold flex h-6 items-center text-text-secondary",children:u("imageUploader.imageUpload",{ns:"common"})}),(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsx)(I.default,{settings:o,onFilesChange:e=>d(e.filter(e=>-1!==e.progress).map(e=>({type:"image",transfer_method:e.type,url:e.url,upload_file_id:e.fileId})))})})]}),(0,a.jsx)("div",{className:"mb-3 mt-6 w-full",children:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,a.jsx)(y.default,{onClick:()=>{let e={};t.prompt_variables.forEach(t=>{"string"===t.type||"paragraph"===t.type||"number"===t.type?e[t.key]="":"checkbox"===t.type?e[t.key]=!1:e[t.key]=void 0}),i(e)},disabled:!1,children:(0,a.jsx)("span",{className:"text-[13px]",children:u("operation.clear",{ns:"common"})})}),(0,a.jsx)(y.default,{className:(0,P.cn)(!p&&"grow"),type:g?"button":"submit",variant:g?"secondary":"primary",disabled:g&&c?.isStopping,onClick:b,"data-testid":g?"stop-button":"run-button",children:g?(0,a.jsxs)(a.Fragment,{children:[c?.isStopping?(0,a.jsx)(m.RiLoader2Line,{className:"mr-1 h-4 w-4 shrink-0 animate-spin","aria-hidden":"true"}):(0,a.jsx)(j.StopCircle,{className:"mr-1 h-4 w-4 shrink-0","aria-hidden":"true"}),(0,a.jsx)("span",{className:"text-[13px]",children:h})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(m.RiPlayLargeLine,{className:"mr-1 h-4 w-4 shrink-0","aria-hidden":"true"}),(0,a.jsx)("span",{className:"text-[13px]",children:u("generation.run",{ns:"share"})})]})})]})})]})})})});e.s(["default",0,O],727163)}]);
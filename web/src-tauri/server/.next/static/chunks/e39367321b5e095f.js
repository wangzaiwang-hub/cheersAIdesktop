(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,68723,e=>{"use strict";var t,s,a=e.i(563199),i=e.i(227579),r=e.i(837699),l=e.i(326531),n=e.i(268255);e.i(152567);var o=e.i(408767),c=e.i(225244),d=e.i(757198),p=e.i(38532),m=e.i(250755),u=e.i(124836),x=e.i(339548),h=e.i(151094),g=e.i(291631),f=e.i(21151),y=e.i(137667),b=e.i(967484),v=e.i(815488),j=e.i(475390);let N=n.memo(e=>{let{onClose:t}=e,{t:s}=(0,o.useTranslation)();return(0,a.jsxs)("div",{className:"title-2xl-semi-bold relative flex items-center justify-between pb-3 pl-6 pr-14 pt-6 text-text-primary",children:[s("importFromDSL",{ns:"app"}),(0,a.jsx)("div",{className:"absolute right-5 top-5 flex size-8 cursor-pointer items-center",onClick:t,children:(0,a.jsx)(r.RiCloseLine,{className:"size-[18px] text-text-tertiary"})})]})});var w=e.i(725001),C=e.i(935139);let k=n.memo(e=>{let{isActive:t,label:s,onClick:i}=e;return(0,a.jsxs)("div",{className:(0,C.cn)("system-md-semibold relative flex h-full cursor-pointer items-center text-text-tertiary",t&&"text-text-primary"),onClick:i,children:[s,t&&(0,a.jsx)("div",{className:"absolute bottom-0 h-0.5 w-full bg-util-colors-blue-brand-blue-brand-600"})]})}),T=e=>{let{currentTab:t,setCurrentTab:s}=e,{t:i}=(0,o.useTranslation)(),r=[{key:w.CreateFromDSLModalTab.FROM_FILE,label:i("importFromDSLFile",{ns:"app"})},{key:w.CreateFromDSLModalTab.FROM_URL,label:i("importFromDSLUrl",{ns:"app"})}];return(0,a.jsx)("div",{className:"system-md-semibold flex h-9 items-center gap-x-6 border-b border-divider-subtle px-6 text-text-tertiary",children:r.map(e=>(0,a.jsx)(k,{isActive:t===e.key,label:e.label,onClick:s.bind(null,e.key)},e.key))})};var L=e.i(654313),P=e.i(128984);let S=n.memo(e=>{let{file:t,updateFile:s,className:i}=e,{t:l}=(0,o.useTranslation)(),{notify:c}=(0,x.useContext)(y.ToastContext),[d,p]=(0,n.useState)(!1),m=(0,n.useRef)(null),u=(0,n.useRef)(null),h=(0,n.useRef)(null),g=e=>{e.preventDefault(),e.stopPropagation(),e.target!==u.current&&p(!0)},f=e=>{e.preventDefault(),e.stopPropagation()},b=e=>{e.preventDefault(),e.stopPropagation(),e.target===u.current&&p(!1)},v=e=>{if(e.preventDefault(),e.stopPropagation(),p(!1),!e.dataTransfer)return;let t=Array.from(e.dataTransfer.files);t.length>1?c({type:"error",message:l("stepOne.uploader.validation.count",{ns:"datasetCreation"})}):s(t[0])};return(0,n.useEffect)(()=>{let e=m.current;return e?.addEventListener("dragenter",g),e?.addEventListener("dragover",f),e?.addEventListener("dragleave",b),e?.addEventListener("drop",v),()=>{e?.removeEventListener("dragenter",g),e?.removeEventListener("dragover",f),e?.removeEventListener("dragleave",b),e?.removeEventListener("drop",v)}},[]),(0,a.jsxs)("div",{className:(0,C.cn)("mt-6",i),children:[(0,a.jsx)("input",{ref:h,style:{display:"none"},type:"file",id:"fileUploader",accept:".pipeline",onChange:e=>{s(e.target.files?.[0])}}),(0,a.jsxs)("div",{ref:m,children:[!t&&(0,a.jsxs)("div",{className:(0,C.cn)("flex h-12 items-center rounded-[10px] border border-dashed border-components-dropzone-border bg-components-dropzone-bg text-sm font-normal",d&&"border-components-dropzone-border-accent bg-components-dropzone-bg-accent"),children:[(0,a.jsxs)("div",{className:"flex w-full items-center justify-center space-x-2",children:[(0,a.jsx)(r.RiUploadCloud2Line,{className:"h-6 w-6 text-text-tertiary"}),(0,a.jsxs)("div",{className:"text-text-tertiary",children:[l("dslUploader.button",{ns:"app"}),(0,a.jsx)("span",{className:"cursor-pointer pl-1 text-text-accent",onClick:()=>{h.current&&(h.current.value="",h.current.click(),h.current.oncancel=()=>s(t))},children:l("dslUploader.browse",{ns:"app"})})]})]}),d&&(0,a.jsx)("div",{ref:u,className:"absolute left-0 top-0 h-full w-full"})]}),t&&(0,a.jsxs)("div",{className:"group flex items-center rounded-lg border-[0.5px] border-components-panel-border bg-components-panel-on-panel-item-bg shadow-xs hover:bg-components-panel-on-panel-item-bg-hover",children:[(0,a.jsx)("div",{className:"flex items-center justify-center p-3",children:(0,a.jsx)(r.RiNodeTree,{className:"h-6 w-6 shrink-0 text-text-secondary"})}),(0,a.jsxs)("div",{className:"flex grow flex-col items-start gap-0.5 py-1 pr-2",children:[(0,a.jsx)("span",{className:"font-inter max-w-[calc(100%_-_30px)] overflow-hidden text-ellipsis whitespace-nowrap text-[12px] font-medium leading-4 text-text-secondary",children:t.name}),(0,a.jsxs)("div",{className:"font-inter flex h-3 items-center gap-1 self-stretch text-[10px] font-medium uppercase leading-3 text-text-tertiary",children:[(0,a.jsx)("span",{children:"PIPELINE"}),(0,a.jsx)("span",{className:"text-text-quaternary",children:"Â·"}),(0,a.jsx)("span",{children:(0,P.formatFileSize)(t.size)})]})]}),(0,a.jsx)("div",{className:"hidden items-center pr-3 group-hover:flex",children:(0,a.jsx)(L.default,{onClick:()=>{h.current&&(h.current.value=""),s()},children:(0,a.jsx)(r.RiDeleteBinLine,{className:"h-4 w-4 text-text-tertiary"})})})]})]})]})});var _=((t={}).FROM_FILE="from-file",t.FROM_URL="from-url",t);let D=e=>{let{show:t,onSuccess:s,onClose:i,activeTab:r="from-file",dslUrl:c=""}=e,{push:d}=(0,l.useRouter)(),{t:w}=(0,o.useTranslation)(),{notify:C}=(0,x.useContext)(y.ToastContext),[k,L]=(0,n.useState)(),[P,_]=(0,n.useState)(),[D,E]=(0,n.useState)(r),[I,z]=(0,n.useState)(c),[R,A]=(0,n.useState)(!1),[F,M]=(0,n.useState)(),[O,U]=(0,n.useState)(),{handleCheckPluginDependencies:B}=(0,b.usePluginDependencies)(),G=(0,n.useRef)(!1),{mutateAsync:$}=(0,j.useImportPipelineDSL)(),W=async()=>{let e;if("from-file"===D&&!k||"from-url"===D&&!I||G.current)return;if(G.current=!0,"from-file"===D&&(e=await $({mode:v.DSLImportMode.YAML_CONTENT,yaml_content:P||""})),"from-url"===D&&(e=await $({mode:v.DSLImportMode.YAML_URL,yaml_url:I||""})),!e){C({type:"error",message:w("creation.errorTip",{ns:"datasetPipeline"})}),G.current=!1;return}let{id:t,status:a,pipeline_id:r,dataset_id:l,imported_dsl_version:n,current_dsl_version:o}=e;a===v.DSLImportStatus.COMPLETED||a===v.DSLImportStatus.COMPLETED_WITH_WARNINGS?(s&&s(),i&&i(),C({type:a===v.DSLImportStatus.COMPLETED?"success":"warning",message:w(a===v.DSLImportStatus.COMPLETED?"creation.successTip":"creation.caution",{ns:"datasetPipeline"}),children:a===v.DSLImportStatus.COMPLETED_WITH_WARNINGS&&w("newApp.appCreateDSLWarning",{ns:"app"})}),r&&await B(r,!0),d(`/datasets/${l}/pipeline`)):a===v.DSLImportStatus.PENDING?(M({importedVersion:n??"",systemVersion:o??""}),i&&i(),setTimeout(()=>{A(!0)},300),U(t)):C({type:"error",message:w("creation.errorTip",{ns:"datasetPipeline"})}),G.current=!1},{run:K}=(0,p.useDebounceFn)(W,{wait:300});(0,m.useKeyPress)("esc",()=>{t&&!R&&i()});let{mutateAsync:q}=(0,j.useImportPipelineDSLConfirm)(),H=async()=>{if(!O)return;let e=await q(O);if(!e)return void C({type:"error",message:w("creation.errorTip",{ns:"datasetPipeline"})});let{status:t,pipeline_id:a,dataset_id:r}=e;t===v.DSLImportStatus.COMPLETED?(s&&s(),i&&i(),C({type:"success",message:w("creation.successTip",{ns:"datasetPipeline"})}),a&&await B(a,!0),d(`datasets/${r}/pipeline`)):t===v.DSLImportStatus.FAILED&&C({type:"error",message:w("creation.errorTip",{ns:"datasetPipeline"})})},V=(0,n.useMemo)(()=>"from-file"===D?!k:"from-url"===D&&!I,[D,k,I]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(f.default,{className:"w-[520px] rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg p-0 shadow-xl",isShow:t,onClose:u.noop,children:[(0,a.jsx)(N,{onClose:i}),(0,a.jsx)(T,{currentTab:D,setCurrentTab:E}),(0,a.jsxs)("div",{className:"px-6 py-4",children:["from-file"===D&&(0,a.jsx)(S,{className:"mt-0",file:k,updateFile:e=>{let t;L(e),e&&((t=new FileReader).onload=function(e){_(e.target?.result)},t.readAsText(e)),e||_("")}}),"from-url"===D&&(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"system-md-semibold leading6 mb-1 text-text-secondary",children:"DSL URL"}),(0,a.jsx)(g.default,{placeholder:w("importFromDSLUrlPlaceholder",{ns:"app"})||"",value:I,onChange:e=>z(e.target.value)})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-x-2 p-6 pt-5",children:[(0,a.jsx)(h.default,{onClick:i,children:w("newApp.Cancel",{ns:"app"})}),(0,a.jsx)(h.default,{disabled:V,variant:"primary",onClick:K,className:"gap-1",children:(0,a.jsx)("span",{children:w("newApp.import",{ns:"app"})})})]})]}),(0,a.jsxs)(f.default,{isShow:R,onClose:()=>A(!1),className:"w-[480px]",children:[(0,a.jsxs)("div",{className:"flex flex-col items-start gap-2 self-stretch pb-4",children:[(0,a.jsx)("div",{className:"title-2xl-semi-bold text-text-primary",children:w("newApp.appCreateDSLErrorTitle",{ns:"app"})}),(0,a.jsxs)("div",{className:"system-md-regular flex grow flex-col text-text-secondary",children:[(0,a.jsx)("div",{children:w("newApp.appCreateDSLErrorPart1",{ns:"app"})}),(0,a.jsx)("div",{children:w("newApp.appCreateDSLErrorPart2",{ns:"app"})}),(0,a.jsx)("br",{}),(0,a.jsxs)("div",{children:[w("newApp.appCreateDSLErrorPart3",{ns:"app"}),(0,a.jsx)("span",{className:"system-md-medium",children:F?.importedVersion})]}),(0,a.jsxs)("div",{children:[w("newApp.appCreateDSLErrorPart4",{ns:"app"}),(0,a.jsx)("span",{className:"system-md-medium",children:F?.systemVersion})]})]})]}),(0,a.jsxs)("div",{className:"flex items-start justify-end gap-2 self-stretch pt-6",children:[(0,a.jsx)(h.default,{variant:"secondary",onClick:()=>A(!1),children:w("newApp.Cancel",{ns:"app"})}),(0,a.jsx)(h.default,{variant:"primary",destructive:!0,onClick:H,children:w("newApp.Confirm",{ns:"app"})})]})]})]})},E=n.memo(()=>{let{t:e}=(0,o.useTranslation)(),[t,s]=(0,n.useState)(!1),i=(0,l.useSearchParams)(),{replace:p}=(0,l.useRouter)(),m=i.get("remoteInstallUrl")||void 0,u=(0,c.useInvalidDatasetList)(),x=(0,n.useMemo)(()=>{if(m)return _.FROM_URL},[m]),h=(0,n.useCallback)(()=>{s(!0)},[]),g=(0,n.useCallback)(()=>{s(!1),m&&p("/datasets/create-from-pipeline")},[m,p]),f=(0,n.useCallback)(()=>{u()},[u]);return(0,a.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 z-10 flex flex-col gap-y-4 bg-knowledge-pipeline-creation-footer-bg px-16 pb-6 backdrop-blur-[6px]",children:[(0,a.jsx)(d.default,{type:"horizontal",className:"my-0 w-8"}),(0,a.jsxs)("button",{type:"button",className:"system-md-medium flex items-center gap-x-3 text-text-accent",onClick:h,children:[(0,a.jsx)(r.RiFileUploadLine,{className:"size-5"}),(0,a.jsx)("span",{children:e("creation.importDSL",{ns:"datasetPipeline"})})]}),(0,a.jsx)(D,{show:t,onClose:g,activeTab:x,dslUrl:m,onSuccess:f})]})});var I=e.i(554327);let z=n.memo(()=>{let{t:e}=(0,o.useTranslation)();return(0,a.jsxs)("div",{className:"system-md-semibold relative flex px-16 pb-2 pt-5 text-text-primary",children:[(0,a.jsx)("span",{children:e("creation.backToKnowledge",{ns:"datasetPipeline"})}),(0,a.jsx)(I.default,{className:"absolute bottom-0 left-5",href:"/datasets",replace:!0,children:(0,a.jsx)(h.default,{variant:"secondary-accent",className:"size-9 rounded-full p-0",children:(0,a.jsx)(r.RiArrowLeftLine,{className:"size-5 "})})})]})});var R=e.i(494268),A=e.i(683257),F=e.i(491234);e.i(201987);var M=e.i(207331),O=e.i(451028);let U=n.memo(()=>{let{t:e}=(0,o.useTranslation)(),{push:t}=(0,l.useRouter)(),{mutateAsync:s}=(0,O.useCreatePipelineDataset)(),i=(0,c.useInvalidDatasetList)(),d=(0,n.useCallback)(async()=>{await s(void 0,{onSuccess:s=>{if(s){let{id:a}=s;y.default.notify({type:"success",message:e("creation.successTip",{ns:"datasetPipeline"})}),i(),(0,M.trackEvent)("create_datasets_from_scratch",{dataset_id:a}),t(`/datasets/${a}/pipeline`)}},onError:()=>{y.default.notify({type:"error",message:e("creation.errorTip",{ns:"datasetPipeline"})})}})},[s,t,i,e]);return(0,a.jsxs)("div",{className:"group relative flex h-[132px] cursor-pointer flex-col rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-on-panel-item-bg pb-3 shadow-xs shadow-shadow-shadow-3",onClick:d,children:[(0,a.jsxs)("div",{className:"flex items-center gap-x-3 p-4 pb-2",children:[(0,a.jsx)("div",{className:"flex size-10 shrink-0 items-center justify-center rounded-[10px] border border-dashed border-divider-regular bg-background-section group-hover:border-state-accent-hover-alt group-hover:bg-state-accent-hover",children:(0,a.jsx)(r.RiAddCircleLine,{className:"size-5 text-text-quaternary group-hover:text-text-accent"})}),(0,a.jsx)("div",{className:"system-md-semibold truncate text-text-primary",children:e("creation.createFromScratch.title",{ns:"datasetPipeline"})})]}),(0,a.jsx)("p",{className:"system-xs-regular line-clamp-3 px-4 py-1 text-text-tertiary",children:e("creation.createFromScratch.description",{ns:"datasetPipeline"})})]})});var B=e.i(547105),G=e.i(618403),$=e.i(964596);let W=n.memo(e=>{let{openEditModal:t,onDelete:s,onExport:i}=e,{t:r}=(0,o.useTranslation)();return(0,a.jsxs)("div",{className:"relative flex w-full flex-col rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur shadow-lg shadow-shadow-shadow-5",children:[(0,a.jsxs)("div",{className:"flex flex-col p-1",children:[(0,a.jsx)("div",{className:"flex cursor-pointer items-center gap-x-1 rounded-lg px-2 py-1.5 hover:bg-state-base-hover",onClick:e=>{e.stopPropagation(),e.preventDefault(),t()},children:(0,a.jsx)("span",{className:"system-md-regular px-1 text-text-secondary",children:r("operations.editInfo",{ns:"datasetPipeline"})})}),(0,a.jsx)("div",{className:"flex cursor-pointer items-center gap-x-1 rounded-lg px-2 py-1.5 hover:bg-state-base-hover",onClick:e=>{e.stopPropagation(),e.preventDefault(),i()},children:(0,a.jsx)("span",{className:"system-md-regular px-1 text-text-secondary",children:r("operations.exportPipeline",{ns:"datasetPipeline"})})})]}),(0,a.jsx)(d.default,{type:"horizontal",className:"my-0 bg-divider-subtle"}),(0,a.jsx)("div",{className:"flex flex-col p-1",children:(0,a.jsx)("div",{className:"group flex cursor-pointer items-center gap-x-1 rounded-lg px-2 py-1.5 hover:bg-state-destructive-hover",onClick:e=>{e.stopPropagation(),e.preventDefault(),s()},children:(0,a.jsx)("span",{className:"system-md-regular px-1 text-text-secondary group-hover:text-text-destructive",children:r("operation.delete",{ns:"common"})})})})]})}),K=n.memo(e=>{let{onApplyTemplate:t,handleShowTemplateDetails:s,showMoreOperations:i,openEditModal:l,handleExportDSL:n,handleDelete:c}=e,{t:d}=(0,o.useTranslation)();return(0,a.jsxs)("div",{className:"absolute bottom-0 left-0 z-10 hidden w-full items-center gap-x-1 bg-pipeline-template-card-hover-bg p-4 pt-8 group-hover:flex",children:[(0,a.jsxs)(h.default,{variant:"primary",onClick:t,className:"grow gap-x-0.5",children:[(0,a.jsx)(r.RiAddLine,{className:"size-4"}),(0,a.jsx)("span",{className:"px-0.5",children:d("operations.choose",{ns:"datasetPipeline"})})]}),(0,a.jsxs)(h.default,{variant:"secondary",onClick:s,className:"grow gap-x-0.5",children:[(0,a.jsx)(r.RiArrowRightUpLine,{className:"size-4"}),(0,a.jsx)("span",{className:"px-0.5",children:d("operations.details",{ns:"datasetPipeline"})})]}),i&&(0,a.jsx)($.default,{htmlContent:(0,a.jsx)(W,{openEditModal:l,onExport:n,onDelete:c}),className:"z-20 min-w-[160px]",popupClassName:"rounded-xl bg-none shadow-none ring-0 min-w-[160px]",position:"br",trigger:"click",btnElement:(0,a.jsx)(r.RiMoreFill,{className:"size-4 text-text-tertiary"}),btnClassName:"size-8 cursor-pointer justify-center rounded-lg p-0 shadow-xs shadow-shadow-shadow-3"})]})});var q=e.i(257899);e.i(389111);var H=e.i(889625),V=e.i(621379);let Q=n.memo(e=>{let{name:t,description:s,iconInfo:i,chunkStructure:r}=e,{t:l}=(0,o.useTranslation)(),n=V.DOC_FORM_ICON_WITH_BG[r]||H.General;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-x-3 p-4 pb-2",children:[(0,a.jsxs)("div",{className:"relative shrink-0",children:[(0,a.jsx)(q.default,{size:"large",iconType:i.icon_type,icon:i.icon,background:"image"===i.icon_type?void 0:i.icon_background,imageUrl:"image"===i.icon_type?i.icon_url:void 0}),(0,a.jsx)("div",{className:"absolute -bottom-1 -right-1 z-10",children:(0,a.jsx)(n,{className:"size-4"})})]}),(0,a.jsxs)("div",{className:"flex grow flex-col gap-y-1 overflow-hidden py-px",children:[(0,a.jsx)("div",{className:"system-md-semibold truncate text-text-secondary",title:t,children:t}),(0,a.jsx)("div",{className:"system-2xs-medium-uppercase text-text-tertiary",children:l(`chunkingMode.${V.DOC_FORM_TEXT[r]}`,{ns:"dataset"})})]})]}),(0,a.jsx)("p",{className:"system-xs-regular line-clamp-3 grow px-4 py-1 text-text-tertiary",title:s,children:s})]})});var Y=e.i(449980),J=e.i(421001),X=e.i(445924),Z=((s={}).indigo="indigo",s.blueLight="blue-light",s.green="green",s.none="none",s);let ee={[Z.indigo]:"bg-util-colors-indigo-indigo-600 opacity-80",[Z.blueLight]:"bg-util-colors-blue-light-blue-light-500 opacity-80",[Z.green]:"bg-util-colors-teal-teal-600 opacity-80",[Z.none]:""},et={[Z.indigo]:"bg-components-icon-bg-indigo-solid",[Z.blueLight]:"bg-components-icon-bg-blue-light-solid",[Z.green]:"bg-components-icon-bg-teal-solid",[Z.none]:""},es=n.memo(e=>{let{className:t,icon:s,title:i,description:r,effectColor:l}=e;return(0,a.jsxs)("div",{className:(0,C.cn)("relative flex overflow-hidden rounded-xl border-[0.5px] border-components-panel-border-subtle bg-components-panel-bg p-2 shadow-xs shadow-shadow-shadow-3",t),children:[(0,a.jsx)("div",{className:(0,C.cn)("absolute -left-1 -top-1 size-14 rounded-full blur-[80px]",`${ee[l]}`)}),(0,a.jsx)("div",{className:"p-1",children:(0,a.jsx)("div",{className:(0,C.cn)("flex size-6 shrink-0 items-center justify-center rounded-lg border-[0.5px] border-divider-subtle text-text-primary-on-surface shadow-md shadow-shadow-shadow-5",`${et[l]}`),children:s})}),(0,a.jsxs)("div",{className:"flex grow flex-col gap-y-0.5 py-px",children:[(0,a.jsx)("div",{className:"flex items-center gap-x-1",children:(0,a.jsx)("span",{className:"system-sm-medium text-text-secondary",children:i})}),r&&(0,a.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:r})]})]})});e.i(9633);var ea=e.i(334163),ei=e.i(684040),er=e.i(92234);let el=n.memo(e=>{let{id:t,type:s,onApplyTemplate:i,onClose:l}=e,{t:c}=(0,o.useTranslation)(),{data:d}=(0,j.usePipelineTemplateById)({template_id:t,type:s},!0),p=(0,n.useMemo)(()=>{if(!d)return{type:"emoji",icon:"ðŸ“™",background:"#FFF4ED"};let e=d.icon_info;return"image"===e.icon_type?{type:"image",url:e.icon_url||"",fileId:e.icon||""}:{type:"icon",icon:e.icon||"",background:e.icon_background||""}},[d]),m=(()=>{let{t:e}=(0,o.useTranslation)(),t={icon:(0,a.jsx)(ea.GeneralChunk,{className:"size-4"}),title:"General",description:e("stepTwo.generalTip",{ns:"datasetCreation"}),effectColor:Z.indigo},s={icon:(0,a.jsx)(ei.ParentChildChunk,{className:"size-4"}),title:"Parent-Child",description:e("stepTwo.parentChildTip",{ns:"datasetCreation"}),effectColor:Z.blueLight},i={icon:(0,a.jsx)(er.QuestionAndAnswer,{className:"size-4"}),title:"Q&A",description:e("stepTwo.qaTip",{ns:"datasetCreation"}),effectColor:Z.green};return{[V.ChunkingMode.text]:t,[V.ChunkingMode.parentChild]:s,[V.ChunkingMode.qa]:i}})();return d?(0,a.jsxs)("div",{className:"flex h-full",children:[(0,a.jsx)("div",{className:"flex grow items-center justify-center p-3 pr-0",children:(0,a.jsx)(X.default,{...d.graph,className:"overflow-hidden rounded-2xl"})}),(0,a.jsxs)("div",{className:"relative flex w-[360px] shrink-0 flex-col",children:[(0,a.jsx)("button",{type:"button",className:"absolute right-4 top-4 z-10 flex size-8 items-center justify-center",onClick:l,children:(0,a.jsx)(r.RiCloseLine,{className:"size-4 text-text-tertiary"})}),(0,a.jsxs)("div",{className:"flex items-start gap-x-3 pb-2 pl-4 pr-12 pt-6",children:[(0,a.jsx)(q.default,{size:"large",iconType:p.type,icon:"image"===p.type?p.fileId:p.icon,background:"image"===p.type?void 0:p.background,imageUrl:"image"===p.type?p.url:void 0,showEditIcon:!0}),(0,a.jsxs)("div",{className:"flex grow flex-col gap-y-1 overflow-hidden py-px",children:[(0,a.jsx)("div",{className:"system-md-semibold truncate text-text-secondary",title:d.name,children:d.name}),d.created_by&&(0,a.jsx)("div",{className:"system-2xs-medium-uppercase truncate text-text-tertiary",title:d.created_by,children:c("details.createdBy",{ns:"datasetPipeline",author:d.created_by})})]})]}),(0,a.jsx)("p",{className:"system-sm-regular px-4 pb-2 pt-1 text-text-secondary",children:d.description}),(0,a.jsx)("div",{className:"p-3",children:(0,a.jsxs)(h.default,{variant:"primary",onClick:i,className:"w-full gap-x-0.5",children:[(0,a.jsx)(r.RiAddLine,{className:"size-4"}),(0,a.jsx)("span",{className:"px-0.5",children:c("operations.useTemplate",{ns:"datasetPipeline"})})]})}),(0,a.jsxs)("div",{className:"flex flex-col gap-y-1 px-4 py-2",children:[(0,a.jsxs)("div",{className:"flex h-6 items-center gap-x-0.5",children:[(0,a.jsx)("span",{className:"system-sm-semibold-uppercase text-text-secondary",children:c("details.structure",{ns:"datasetPipeline"})}),(0,a.jsx)(J.default,{popupClassName:"max-w-[240px]",popupContent:c("details.structureTooltip",{ns:"datasetPipeline"})})]}),(0,a.jsx)(es,{...m[d.chunk_structure]})]})]})]}):(0,a.jsx)(Y.default,{type:"app"})});var en=e.i(360972),eo=e.i(873517);let ec=n.memo(e=>{let{onClose:t,pipeline:s}=e,{t:i}=(0,o.useTranslation)(),[l,c]=(0,n.useState)(s.name),d=s.icon,[p,m]=(0,n.useState)("image"===d.icon_type?{type:"image",url:d.icon_url||"",fileId:d.icon||""}:{type:"emoji",icon:d.icon||"",background:d.icon_background||""}),[u,x]=(0,n.useState)(s.description),[f,b]=(0,n.useState)(!1),v=(0,n.useRef)("image"===d.icon_type?{type:"image",url:d.icon_url||"",fileId:d.icon||""}:{type:"emoji",icon:d.icon||"",background:d.icon_background||""}),N=(0,n.useCallback)(e=>{c(e.target.value)},[]),w=(0,n.useCallback)(()=>{b(!0),v.current=p},[p]),C=(0,n.useCallback)(e=>{m(e),b(!1)},[]),k=(0,n.useCallback)(()=>{m(v.current),b(!1)},[]),T=(0,n.useCallback)(e=>{x(e.target.value)},[]),{mutateAsync:L}=(0,j.useUpdateTemplateInfo)(),P=(0,j.useInvalidCustomizedTemplateList)(),S=(0,n.useCallback)(async()=>{if(!l)return void y.default.notify({type:"error",message:"Please enter a name for the Knowledge Base."});let e={template_id:s.id,name:l,icon_info:{icon_type:p.type,icon:"image"===p.type?p.fileId:p.icon,icon_background:"image"===p.type?void 0:p.background,icon_url:"image"===p.type?p.url:void 0},description:u};await L(e,{onSuccess:()=>{P(),t()}})},[l,p,u,s.id,L,P,t]);return(0,a.jsxs)("div",{className:"relative flex flex-col",children:[(0,a.jsx)("div",{className:"pb-3 pl-6 pr-14 pt-6",children:(0,a.jsx)("span",{className:"title-2xl-semi-bold text-text-primary",children:i("editPipelineInfo",{ns:"datasetPipeline"})})}),(0,a.jsx)("button",{type:"button",className:"absolute right-5 top-5 flex size-8 items-center justify-center",onClick:t,children:(0,a.jsx)(r.RiCloseLine,{className:"size-5 text-text-tertiary"})}),(0,a.jsxs)("div",{className:"flex flex-col gap-y-5 px-6 py-3",children:[(0,a.jsxs)("div",{className:"flex items-end gap-x-3 self-stretch",children:[(0,a.jsxs)("div",{className:"flex grow flex-col gap-y-1 pb-1",children:[(0,a.jsx)("label",{className:"system-sm-medium flex h-6 items-center text-text-secondary",children:i("pipelineNameAndIcon",{ns:"datasetPipeline"})}),(0,a.jsx)(g.default,{onChange:N,value:l,placeholder:i("knowledgeNameAndIconPlaceholder",{ns:"datasetPipeline"})})]}),(0,a.jsx)(q.default,{size:"xxl",onClick:w,className:"cursor-pointer",iconType:p.type,icon:"image"===p.type?p.fileId:p.icon,background:"image"===p.type?void 0:p.background,imageUrl:"image"===p.type?p.url:void 0,showEditIcon:!0})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,a.jsx)("label",{className:"system-sm-medium flex h-6 items-center text-text-secondary",children:i("knowledgeDescription",{ns:"datasetPipeline"})}),(0,a.jsx)(eo.default,{onChange:T,value:u,placeholder:i("knowledgeDescriptionPlaceholder",{ns:"datasetPipeline"})})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-x-2 p-6 pt-5",children:[(0,a.jsx)(h.default,{variant:"secondary",onClick:t,children:i("operation.cancel",{ns:"common"})}),(0,a.jsx)(h.default,{variant:"primary",onClick:S,children:i("operation.save",{ns:"common"})})]}),f&&(0,a.jsx)(en.default,{onSelect:C,onClose:k})]})}),ed=n.memo(e=>{let{pipeline:t,showMoreOperations:s=!0,type:i}=e,{t:r}=(0,o.useTranslation)(),{push:d}=(0,l.useRouter)(),[p,m]=(0,n.useState)(!1),[u,x]=(0,n.useState)(!1),[h,g]=(0,n.useState)(!1),{refetch:v}=(0,j.usePipelineTemplateById)({template_id:t.id,type:i},!1),{mutateAsync:N}=(0,O.useCreatePipelineDatasetFromCustomized)(),{handleCheckPluginDependencies:w}=(0,b.usePluginDependencies)(),C=(0,c.useInvalidDatasetList)(),k=(0,n.useCallback)(async()=>{let{data:e}=await v();if(!e)return void y.default.notify({type:"error",message:r("creation.errorTip",{ns:"datasetPipeline"})});let s={yaml_content:e.export_data};await N(s,{onSuccess:async e=>{y.default.notify({type:"success",message:r("creation.successTip",{ns:"datasetPipeline"})}),C(),e.pipeline_id&&await w(e.pipeline_id,!0),(0,M.trackEvent)("create_datasets_with_pipeline",{template_name:t.name,template_id:t.id,template_type:i}),d(`/datasets/${e.dataset_id}/pipeline`)},onError:()=>{y.default.notify({type:"error",message:r("creation.errorTip",{ns:"datasetPipeline"})})}})},[v,N,r,w,d,C,t.name,t.id,i]),T=(0,n.useCallback)(()=>{g(!0)},[]),L=(0,n.useCallback)(()=>{m(!0)},[]),P=(0,n.useCallback)(()=>{m(!1)},[]),S=(0,n.useCallback)(()=>{g(!1)},[]),{mutateAsync:_,isPending:D}=(0,j.useExportTemplateDSL)(),E=(0,n.useCallback)(async()=>{D||await _(t.id,{onSuccess:e=>{let s=new Blob([e.data],{type:"application/yaml"});(0,G.downloadBlob)({data:s,fileName:`${t.name}.pipeline`}),y.default.notify({type:"success",message:r("exportDSL.successTip",{ns:"datasetPipeline"})})},onError:()=>{y.default.notify({type:"error",message:r("exportDSL.errorTip",{ns:"datasetPipeline"})})}})},[r,D,t.id,t.name,_]),I=(0,n.useCallback)(()=>{x(!0)},[]),z=(0,n.useCallback)(()=>{x(!1)},[]),{mutateAsync:R}=(0,j.useDeleteTemplate)(),A=(0,j.useInvalidCustomizedTemplateList)(),F=(0,n.useCallback)(async()=>{await R(t.id,{onSuccess:()=>{A(),x(!1)}})},[t.id,R,A]);return(0,a.jsxs)("div",{className:"group relative flex h-[132px] cursor-pointer flex-col rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-on-panel-item-bg pb-3 shadow-xs shadow-shadow-shadow-3",children:[(0,a.jsx)(Q,{name:t.name,description:t.description,iconInfo:t.icon,chunkStructure:t.chunk_structure}),(0,a.jsx)(K,{onApplyTemplate:k,handleShowTemplateDetails:T,showMoreOperations:s,openEditModal:L,handleExportDSL:E,handleDelete:I}),p&&(0,a.jsx)(f.default,{isShow:p,onClose:P,className:"max-w-[520px] p-0",children:(0,a.jsx)(ec,{pipeline:t,onClose:P})}),u&&(0,a.jsx)(B.default,{title:r("deletePipeline.title",{ns:"datasetPipeline"}),content:r("deletePipeline.content",{ns:"datasetPipeline"}),isShow:u,onConfirm:F,onCancel:z}),h&&(0,a.jsx)(f.default,{isShow:h,onClose:S,className:"h-[calc(100vh-64px)] max-w-[1680px] rounded-3xl p-0",children:(0,a.jsx)(el,{id:t.id,type:i,onClose:S,onApplyTemplate:k})})]})}),ep=()=>{let e=(0,A.useLocale)(),t=(0,n.useMemo)(()=>["zh-Hans","ja-JP"].includes(e)?e:F.LanguagesSupported[0],[e]),s=(0,R.useGlobalPublicStore)(e=>e.systemFeatures.enable_marketplace),{data:i,isLoading:r}=(0,j.usePipelineTemplateList)({type:"built-in",language:t},s),l=i?.pipeline_templates||[];return(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-3 py-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4",children:[(0,a.jsx)(U,{}),!r&&l.map((e,t)=>(0,a.jsx)(ed,{type:"built-in",pipeline:e,showMoreOperations:!1},t))]})},em=()=>{let{t:e}=(0,o.useTranslation)(),{data:t,isLoading:s}=(0,j.usePipelineTemplateList)({type:"customized"}),i=t?.pipeline_templates||[];return s||0===i.length?null:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"system-sm-semibold-uppercase pt-2 text-text-tertiary",children:e("templates.customized",{ns:"datasetPipeline"})}),(0,a.jsx)("div",{className:"grid grid-cols-1 gap-3 py-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4",children:i.map((e,t)=>(0,a.jsx)(ed,{type:"customized",pipeline:e},t))})]})},eu=()=>(0,a.jsxs)("div",{className:"grow gap-y-1 overflow-y-auto px-16 pb-[60px] pt-1",children:[(0,a.jsx)(ep,{}),(0,a.jsx)(em,{})]});e.s(["default",0,()=>(0,a.jsxs)("div",{className:"relative flex h-[calc(100vh-56px)] flex-col overflow-hidden rounded-t-2xl border-t border-effects-highlight bg-background-default-subtle",children:[(0,a.jsx)(i.default,{className:"left-8 top-[-34px] opacity-20"}),(0,a.jsx)(z,{}),(0,a.jsx)(eu,{}),(0,a.jsx)(E,{})]})],68723)}]);
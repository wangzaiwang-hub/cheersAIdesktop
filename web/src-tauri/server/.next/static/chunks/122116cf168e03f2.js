(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,360766,e=>{"use strict";var t=e.i(268255),a=e.i(192447),r=e.i(213889);e.i(275225);var o=e.i(705405),i=e.i(154033),n=e.i(387852),l=e.i(141696),s=e.i(840247),d=e.i(963855);e.s(["useSetWorkflowVarsWithValue",0,e=>{let{flowType:u,flowId:f}=e,c=(0,o.useWorkflowStore)(),p=(0,a.useStoreApi)(),m=(0,n.useInvalidateConversationVarValues)(u,f),g=(0,n.useInvalidateSysVarValues)(u,f),{handleCancelAllNodeSuccessStatus:w}=(0,r.useNodesInteractionsWithoutSync)(),{schemaTypeDefinitions:_}=(0,s.default)(),{data:k}=(0,i.useAllBuiltInTools)(),{data:y}=(0,i.useAllCustomTools)(),{data:h}=(0,i.useAllWorkflowTools)(),{data:v}=(0,i.useAllMCPTools)(),b={buildInTools:k||[],customTools:y||[],workflowTools:h||[],mcpTools:v||[],dataSourceList:(0,o.useStore)(e=>e.dataSourceList)||[]},E=(e,t,a)=>{let{setNodesWithInspectVars:r}=c.getState(),{getNodes:o}=p.getState(),i=o(),n=(0,d.toNodeOutputVars)(i,!1,()=>!0,[],[],[],t||b,a||_),l={};i.forEach(e=>{l[e.id]=e});let s={};e.forEach(e=>{let t=e.selector[0];l[t]&&(s[t]=!0)}),r(Object.keys(s).map(e=>l[e]).map(t=>{let a=t.id,r=e.filter(e=>e.selector[0]===a),o=n.find(e=>e.nodeId===a);return{nodeId:a,nodePayload:t.data,nodeType:t.data.type,title:t.data.title,vars:r.map(e=>{let t=o?o.vars.find(t=>t.variable===e.name)?.schemaType:"";return{...e,schemaType:t}}),isSingRunRunning:!1,isValueFetched:!1}}))};return{fetchInspectVars:(0,t.useCallback)(async e=>{let{passInVars:t,vars:a,passedInAllPluginInfoList:r,passedInSchemaTypeDefinitions:o}=e;m(),g(),E(t?a:await (0,l.fetchAllInspectVars)(u,f),r,o),w()},[m,g,u,f,E,w,_,s.getMatchedSchemaType])}}])},877166,721423,879306,187921,14868,202259,57375,893925,762433,13254,827377,248405,612594,883354,128250,721954,697797,547944,260781,879756,e=>{"use strict";var t,a,r,o,i,n,l,s,d,u,f,c,p=e.i(739255),m=e.i(645429),g=e.i(390622);e.i(905691);var w=e.i(97672);let _=(0,w.genNodeMetaData)({sort:3,type:g.BlockEnum.Agent});var k=e.i(746628),y=((t={}).overwrite="over-write",t.clear="clear",t.append="append",t.extend="extend",t.set="set",t.increment="+=",t.decrement="-=",t.multiply="*=",t.divide="/=",t.removeFirst="remove-first",t.removeLast="remove-last",t),h=((a={}).variable="variable",a.constant="constant",a);e.s(["AssignerNodeInputType",()=>h,"WriteMode",()=>y,"writeModeTypesNum",0,["+=","-=","*=","/="]],721423);let v="errorMsg",b={metaData:(0,w.genNodeMetaData)({classification:k.BlockClassificationEnum.Transform,sort:5,type:g.BlockEnum.Assigner,helpLinkUri:"variable-assigner"}),defaultValue:{version:"2",items:[]},checkValid(e,t){let a="",{items:r}=e;return r?.forEach(e=>{a||e.variable_selector?.length||(a=t(`${v}.fieldRequired`,{ns:"workflow",field:t("nodes.assigner.assignedVariable",{ns:"workflow"})})),!a&&e.operation!==y.clear&&e.operation!==y.removeFirst&&e.operation!==y.removeLast&&(e.operation===y.set||e.operation===y.increment||e.operation===y.decrement||e.operation===y.multiply||e.operation===y.divide?e.value||!1===e.value||"number"==typeof e.value||(a=t(`${v}.fieldRequired`,{ns:"workflow",field:t("nodes.assigner.variable",{ns:"workflow"})})):e.value?.length||(a=t(`${v}.fieldRequired`,{ns:"workflow",field:t("nodes.assigner.variable",{ns:"workflow"})})))}),{isValid:!a,errorMessage:a}}};e.s(["default",0,b],879306);var E=e.i(955371);let R="errorMsg",T={metaData:(0,w.genNodeMetaData)({classification:k.BlockClassificationEnum.Transform,sort:1,type:g.BlockEnum.Code}),defaultValue:{code:"",code_language:E.CodeLanguage.python3,variables:[],outputs:{}},checkValid(e,t){let a="",{code:r,variables:o}=e;return!a&&o.filter(e=>!e.variable).length>0&&(a=t(`${R}.fieldRequired`,{ns:"workflow",field:t(`${R}.fields.variable`,{ns:"workflow"})})),!a&&o.filter(e=>!e.value_selector.length).length>0&&(a=t(`${R}.fieldRequired`,{ns:"workflow",field:t(`${R}.fields.variableValue`,{ns:"workflow"})})),a||r||(a=t(`${R}.fieldRequired`,{ns:"workflow",field:t(`${R}.fields.code`,{ns:"workflow"})})),{isValid:!a,errorMessage:a}}};e.s(["default",0,T],187921);let S={metaData:(0,w.genNodeMetaData)({classification:k.BlockClassificationEnum.Transform,sort:4,type:g.BlockEnum.DocExtractor,helpLinkUri:"doc-extractor"}),defaultValue:{variable_selector:[],is_array_file:!1},checkValid(e,t){let a="",{variable_selector:r}=e;return a||r?.length||(a=t("errorMsg.fieldRequired",{ns:"workflow",field:t("nodes.assigner.assignedVariable",{ns:"workflow"})})),{isValid:!a,errorMessage:a}}};e.s(["default",0,S],14868);var V=((r={}).get="get",r.post="post",r.head="head",r.patch="patch",r.put="put",r.delete="delete",r),M=((o={}).none="none",o.formData="form-data",o.xWwwFormUrlencoded="x-www-form-urlencoded",o.rawText="raw-text",o.json="json",o.binary="binary",o),q=((i={}).text="text",i.file="file",i),x=((n={}).none="no-auth",n.apiKey="api-key",n),N=((l={}).basic="basic",l.bearer="bearer",l.custom="custom",l);e.s(["APIType",()=>N,"AuthorizationType",()=>x,"BodyPayloadValueType",()=>q,"BodyType",()=>M,"Method",()=>V],202259);let C={metaData:(0,w.genNodeMetaData)({classification:k.BlockClassificationEnum.Utilities,sort:1,type:g.BlockEnum.HttpRequest}),defaultValue:{variables:[],method:V.get,url:"",authorization:{type:x.none,config:null},headers:"",params:"",body:{type:M.none,data:[]},ssl_verify:!0,timeout:{max_connect_timeout:0,max_read_timeout:0,max_write_timeout:0},retry_config:{retry_enabled:!0,max_retries:3,retry_interval:100}},checkValid(e,t){let a="";return a||e.url||(a=t("errorMsg.fieldRequired",{ns:"workflow",field:t("nodes.http.api",{ns:"workflow"})})),a||e.body.type!==M.binary||e.body.data[0]?.file&&e.body.data[0]?.file?.length!==0||(a=t("errorMsg.fieldRequired",{ns:"workflow",field:t("nodes.http.binaryFileVariable",{ns:"workflow"})})),{isValid:!a,errorMessage:a}}};e.s(["default",0,C],57375);var I=e.i(670082),O=e.i(146106);let B="errorMsg",A={metaData:(0,w.genNodeMetaData)({classification:k.BlockClassificationEnum.Logic,sort:1,type:g.BlockEnum.IfElse,helpLinkUri:"ifelse"}),defaultValue:{_targetBranches:[{id:"true",name:"IF"},{id:"false",name:"ELSE"}],cases:[{case_id:"true",logical_operator:I.LogicalOperator.and,conditions:[]}]},checkValid(e,t){let a="",{cases:r}=e;return r&&0!==r.length||(a=t(`${B}.fieldRequired`,{ns:"workflow",field:"IF"})),r.forEach((e,r)=>{e.conditions.length||(a=t(`${B}.fieldRequired`,{ns:"workflow",field:0===r?"IF":"ELIF"})),e.conditions.forEach(e=>{a||e.variable_selector&&0!==e.variable_selector.length||(a=t(`${B}.fieldRequired`,{ns:"workflow",field:t(`${B}.fields.variable`,{ns:"workflow"})})),a||e.comparison_operator||(a=t(`${B}.fieldRequired`,{ns:"workflow",field:t("nodes.ifElse.operator",{ns:"workflow"})})),!a&&(e.sub_variable_condition?e.sub_variable_condition.conditions.every(e=>!!e.comparison_operator&&(!!(0,O.isEmptyRelatedOperator)(e.comparison_operator)||(e.varType===g.VarType.boolean||e.varType===g.VarType.arrayBoolean?void 0===e.value:!!e.value)))||(a=t(`${B}.fieldRequired`,{ns:"workflow",field:t(`${B}.fields.variableValue`,{ns:"workflow"})})):(0,O.isEmptyRelatedOperator)(e.comparison_operator)||(e.varType===g.VarType.boolean||e.varType===g.VarType.arrayBoolean?void 0!==e.value:e.value)||(a=t(`${B}.fieldRequired`,{ns:"workflow",field:t(`${B}.fields.variableValue`,{ns:"workflow"})})))})}),{isValid:!a,errorMessage:a}}};e.s(["default",0,A],893925);let W=(0,w.genNodeMetaData)({sort:-1,type:g.BlockEnum.IterationStart}),D={metaData:(0,w.genNodeMetaData)({classification:k.BlockClassificationEnum.Logic,sort:2,type:g.BlockEnum.Iteration,isTypeFixed:!0}),defaultValue:{start_node_id:"",iterator_selector:[],output_selector:[],_children:[],_isShowTips:!1,is_parallel:!1,parallel_nums:10,error_handle_mode:g.ErrorHandleMode.Terminated,flatten_output:!0},checkValid(e,t){let a="";return a||e.iterator_selector&&0!==e.iterator_selector.length||(a=t("errorMsg.fieldRequired",{ns:"workflow",field:t("nodes.iteration.input",{ns:"workflow"})})),a||e.output_selector&&0!==e.output_selector.length||(a=t("errorMsg.fieldRequired",{ns:"workflow",field:t("nodes.iteration.output",{ns:"workflow"})})),{isValid:!a,errorMessage:a}}};e.s(["default",0,D],762433);var $=e.i(925521),L=e.i(648404),j=e.i(88961);let F={metaData:(0,w.genNodeMetaData)({sort:2,type:g.BlockEnum.KnowledgeRetrieval}),defaultValue:{query_variable_selector:[],query_attachment_selector:[],dataset_ids:[],retrieval_mode:L.RETRIEVE_TYPE.multiWay,multiple_retrieval_config:{top_k:$.DATASET_DEFAULT.top_k,score_threshold:void 0,reranking_enable:!1}},checkValid(e,t){let a="";a||e.dataset_ids&&0!==e.dataset_ids.length||(a=t("errorMsg.fieldRequired",{ns:"workflow",field:t("nodes.knowledgeRetrieval.knowledge",{ns:"workflow"})})),a||e.retrieval_mode!==L.RETRIEVE_TYPE.oneWay||e.single_retrieval_config?.model?.provider||(a=t("errorMsg.fieldRequired",{ns:"workflow",field:t("modelProvider.systemReasoningModel.key",{ns:"common"})}));let{_datasets:r,multiple_retrieval_config:o,retrieval_mode:i}=e;if(i===L.RETRIEVE_TYPE.multiWay){let e=(0,j.checkoutRerankModelConfiguredInRetrievalSettings)(r||[],o);a||e||(a=t("errorMsg.fieldRequired",{ns:"workflow",field:t("errorMsg.fields.rerankModel",{ns:"workflow"})}))}return{isValid:!a,errorMessage:a}}};e.s(["default",0,F],13254);var P=((s={}).ASC="asc",s.DESC="desc",s);e.s(["OrderBy",()=>P],827377);let U="errorMsg",H={metaData:(0,w.genNodeMetaData)({classification:k.BlockClassificationEnum.Utilities,sort:2,type:g.BlockEnum.ListFilter}),defaultValue:{variable:[],filter_by:{enabled:!1,conditions:[]},extract_by:{enabled:!1,serial:"1"},order_by:{enabled:!1,key:"",value:P.ASC},limit:{enabled:!1,size:10}},checkValid(e,t){let a="",{variable:r,var_type:o,filter_by:i,item_var_type:n}=e;return a||r?.length||(a=t(`${U}.fieldRequired`,{ns:"workflow",field:t("nodes.listFilter.inputVar",{ns:"workflow"})})),!a&&i?.enabled&&(o!==g.VarType.arrayFile||i.conditions[0]?.key||(a=t(`${U}.fieldRequired`,{ns:"workflow",field:t("nodes.listFilter.filterConditionKey",{ns:"workflow"})})),a||i.conditions[0]?.comparison_operator||(a=t(`${U}.fieldRequired`,{ns:"workflow",field:t("nodes.listFilter.filterConditionComparisonOperator",{ns:"workflow"})})),a||(0,O.comparisonOperatorNotRequireValue)(i.conditions[0]?.comparison_operator)||(n===g.VarType.boolean?i.conditions[0]?.value!==void 0:i.conditions[0]?.value)||(a=t(`${U}.fieldRequired`,{ns:"workflow",field:t("nodes.listFilter.filterConditionComparisonValue",{ns:"workflow"})}))),{isValid:!a,errorMessage:a}}},K=`{
  "content": "",
  "title": "",
  "url": "",
  "icon": "",
  "metadata": {
    "dataset_id": "",
    "dataset_name": "",
    "document_id": [],
    "document_name": "",
    "document_data_source_type": "",
    "segment_id": "",
    "segment_position": "",
    "segment_word_count": "",
    "segment_hit_count": "",
    "segment_index_node_hash": "",
    "score": ""
  }
}`,z="errorMsg",Q={metaData:(0,w.genNodeMetaData)({sort:1,type:g.BlockEnum.LLM}),defaultValue:{model:{provider:"",name:"",mode:L.AppModeEnum.CHAT,completion_params:{temperature:.7}},prompt_template:[{role:g.PromptRole.system,text:""}],context:{enabled:!1,variable_selector:[]},vision:{enabled:!1}},defaultRunInputData:{"#context#":[K],"#files#":[]},checkValid(e,t){let a="";return a||e.model.provider||(a=t(`${z}.fieldRequired`,{ns:"workflow",field:t(`${z}.fields.model`,{ns:"workflow"})})),a||e.memory||(e.model.mode===L.AppModeEnum.CHAT?e.prompt_template.some(e=>e.edition_type===g.EditionType.jinja2?""!==e.jinja2_text:""!==e.text):e.prompt_template.edition_type===g.EditionType.jinja2?""!==e.prompt_template.jinja2_text:""!==e.prompt_template.text)||(a=t(`${z}.fieldRequired`,{ns:"workflow",field:t("nodes.llm.prompt",{ns:"workflow"})})),!a&&e.memory&&e.model.mode===L.AppModeEnum.CHAT&&e.memory.query_prompt_template&&!e.memory.query_prompt_template.includes("{{#sys.query#}}")&&(a=t("nodes.llm.sysQueryInUser",{ns:"workflow"})),!a&&(e.model.mode===L.AppModeEnum.CHAT?e.prompt_template.some(e=>e.edition_type===g.EditionType.jinja2):e.prompt_template.edition_type===g.EditionType.jinja2)&&e.prompt_config?.jinja2_variables&&e.prompt_config?.jinja2_variables.forEach(e=>{a||e.variable||(a=t(`${z}.fieldRequired`,{ns:"workflow",field:t(`${z}.fields.variable`,{ns:"workflow"})})),a||e.value_selector.length||(a=t(`${z}.fieldRequired`,{ns:"workflow",field:t(`${z}.fields.variableValue`,{ns:"workflow"})}))}),!a&&e.vision?.enabled&&!e.vision.configs?.variable_selector?.length&&(a=t(`${z}.fieldRequired`,{ns:"workflow",field:t(`${z}.fields.visionVariable`,{ns:"workflow"})})),{isValid:!a,errorMessage:a}}};e.s(["default",0,Q],248405);let Y=(0,w.genNodeMetaData)({classification:k.BlockClassificationEnum.Logic,sort:2,type:g.BlockEnum.LoopEnd,isSingleton:!0}),X=(0,w.genNodeMetaData)({sort:-1,type:g.BlockEnum.LoopStart});var G=((d={}).and="and",d.or="or",d),J=((u={}).contains="contains",u.notContains="not contains",u.startWith="start with",u.endWith="end with",u.is="is",u.isNot="is not",u.empty="empty",u.notEmpty="not empty",u.equal="=",u.notEqual="≠",u.largerThan=">",u.lessThan="<",u.largerThanOrEqual="≥",u.lessThanOrEqual="≤",u.isNull="is null",u.isNotNull="is not null",u.in="in",u.notIn="not in",u.allOf="all of",u.exists="exists",u.notExists="not exists",u);e.s(["ComparisonOperator",()=>J,"LogicalOperator",()=>G],612594);let Z=e=>[J.empty,J.notEmpty,J.isNull,J.isNotNull,J.exists,J.notExists].includes(e),ee=[J.equal,J.notEqual,J.largerThan,J.largerThanOrEqual,J.lessThan,J.lessThanOrEqual];function et(e){return!!e&&!ee.includes(e)}e.s(["comparisonOperatorNotRequireValue",0,e=>!!e&&[J.empty,J.notEmpty,J.isNull,J.isNotNull,J.exists,J.notExists].includes(e),"getOperators",0,(e,t)=>{if(t){let{key:e}=t;switch(e){case"name":case"mime_type":case"url":return[J.contains,J.notContains,J.startWith,J.endWith,J.is,J.isNot,J.empty,J.notEmpty];case"type":case"transfer_method":return[J.in,J.notIn];case"size":return[J.largerThan,J.largerThanOrEqual,J.lessThan,J.lessThanOrEqual];case"extension":return[J.is,J.isNot,J.contains,J.notContains]}return[]}switch(e){case g.VarType.string:return[J.contains,J.notContains,J.startWith,J.endWith,J.is,J.isNot,J.empty,J.notEmpty];case g.VarType.number:return[J.equal,J.notEqual,J.largerThan,J.lessThan,J.largerThanOrEqual,J.lessThanOrEqual,J.empty,J.notEmpty];case g.VarType.boolean:return[J.is,J.isNot,J.empty,J.notEmpty];case g.VarType.object:return[J.empty,J.notEmpty];case g.VarType.file:return[J.exists,J.notExists];case g.VarType.arrayString:case g.VarType.arrayNumber:return[J.contains,J.notContains,J.empty,J.notEmpty];case g.VarType.array:case g.VarType.arrayObject:return[J.empty,J.notEmpty];case g.VarType.arrayFile:return[J.contains,J.notContains,J.allOf,J.empty,J.notEmpty];default:return[J.is,J.isNot,J.empty,J.notEmpty]}},"isComparisonOperatorNeedTranslate",()=>et,"isEmptyRelatedOperator",0,Z],883354);let ea="errorMsg",er={metaData:(0,w.genNodeMetaData)({classification:k.BlockClassificationEnum.Logic,sort:3,type:g.BlockEnum.Loop,author:"AICT-Team",isTypeFixed:!0}),defaultValue:{start_node_id:"",break_conditions:[],loop_count:10,_children:[],logical_operator:G.and},checkValid(e,t){let a="";return e.loop_variables?.forEach(e=>{e.label||(a=t(`${ea}.fieldRequired`,{ns:"workflow",field:t(`${ea}.fields.variable`,{ns:"workflow"})}))}),e.break_conditions.forEach(e=>{a||e.variable_selector&&0!==e.variable_selector.length||(a=t(`${ea}.fieldRequired`,{ns:"workflow",field:t(`${ea}.fields.variable`,{ns:"workflow"})})),a||e.comparison_operator||(a=t(`${ea}.fieldRequired`,{ns:"workflow",field:t("nodes.ifElse.operator",{ns:"workflow"})})),!a&&(e.sub_variable_condition&&![J.empty,J.notEmpty].includes(e.comparison_operator)?e.sub_variable_condition.conditions.every(e=>!!e.comparison_operator&&(!!Z(e.comparison_operator)||!!e.value))||(a=t(`${ea}.fieldRequired`,{ns:"workflow",field:t(`${ea}.fields.variableValue`,{ns:"workflow"})})):Z(e.comparison_operator)||(e.varType===g.VarType.boolean?void 0!==e.value:e.value)||(a=t(`${ea}.fieldRequired`,{ns:"workflow",field:t(`${ea}.fields.variableValue`,{ns:"workflow"})})))}),!a&&(Number.isNaN(Number(e.loop_count))||!Number.isInteger(Number(e.loop_count))||e.loop_count<1||e.loop_count>$.LOOP_NODE_MAX_COUNT)&&(a=t("nodes.loop.loopMaxCountError",{ns:"workflow",maxCount:$.LOOP_NODE_MAX_COUNT})),{isValid:!a,errorMessage:a}}},eo=[{value:L.TransferMethod.local_file,i18nKey:"localUpload"},{value:L.TransferMethod.remote_url,i18nKey:"url"}],ei=["type","size","name","url","extension","mime_type","transfer_method","related_id"];ei.filter(e=>"transfer_method"!==e),e.s(["FILE_TYPE_OPTIONS",0,[{value:"image",i18nKey:"image"},{value:"document",i18nKey:"doc"},{value:"audio",i18nKey:"audio"},{value:"video",i18nKey:"video"}],"SUB_VARIABLES",0,ei,"TRANSFER_METHOD",0,eo,"default",0,er],128250);var en=((f={}).string="string",f.number="number",f.bool="boolean",f.select="select",f.arrayString="array[string]",f.arrayNumber="array[number]",f.arrayObject="array[object]",f.arrayBool="array[boolean]",f),el=((c={}).prompt="prompt",c.functionCall="function_call",c);e.s(["ParamType",()=>en,"ReasoningModeType",()=>el],721954);let es={metaData:(0,w.genNodeMetaData)({classification:k.BlockClassificationEnum.Transform,sort:6,type:g.BlockEnum.ParameterExtractor}),defaultValue:{query:[],model:{provider:"",name:"",mode:L.AppModeEnum.CHAT,completion_params:{temperature:.7}},reasoning_mode:el.prompt,vision:{enabled:!1}},checkValid(e,t){let a="";return a||e.query&&0!==e.query.length||(a=t("errorMsg.fieldRequired",{ns:"workflow",field:t("nodes.parameterExtractor.inputVar",{ns:"workflow"})})),a||e.model.provider||(a=t("errorMsg.fieldRequired",{ns:"workflow",field:t("nodes.parameterExtractor.model",{ns:"workflow"})})),a||e.parameters&&0!==e.parameters.length||(a=t("errorMsg.fieldRequired",{ns:"workflow",field:t("nodes.parameterExtractor.extractParameters",{ns:"workflow"})})),a||e.parameters.forEach(e=>{if(!a){if(!e.name){a=t("errorMsg.fieldRequired",{ns:"workflow",field:t("nodes.parameterExtractor.addExtractParameterContent.namePlaceholder",{ns:"workflow"})});return}if(!e.type){a=t("errorMsg.fieldRequired",{ns:"workflow",field:t("nodes.parameterExtractor.addExtractParameterContent.typePlaceholder",{ns:"workflow"})});return}e.description||(a=t("errorMsg.fieldRequired",{ns:"workflow",field:t("nodes.parameterExtractor.addExtractParameterContent.descriptionPlaceholder",{ns:"workflow"})}))}}),!a&&e.vision?.enabled&&!e.vision.configs?.variable_selector?.length&&(a=t("errorMsg.fieldRequired",{ns:"workflow",field:t("errorMsg.fields.visionVariable",{ns:"workflow"})})),{isValid:!a,errorMessage:a}}};e.s(["default",0,es],697797);let ed={metaData:(0,w.genNodeMetaData)({classification:k.BlockClassificationEnum.QuestionUnderstand,sort:1,type:g.BlockEnum.QuestionClassifier}),defaultValue:{query_variable_selector:[],model:{provider:"",name:"",mode:L.AppModeEnum.CHAT,completion_params:{temperature:.7}},classes:[{id:"1",name:""},{id:"2",name:""}],_targetBranches:[{id:"1",name:""},{id:"2",name:""}],vision:{enabled:!1}},checkValid(e,t){let a="";return a||e.query_variable_selector&&0!==e.query_variable_selector.length||(a=t("errorMsg.fieldRequired",{ns:"workflow",field:t("nodes.questionClassifiers.inputVars",{ns:"workflow"})})),a||e.model.provider||(a=t("errorMsg.fieldRequired",{ns:"workflow",field:t("nodes.questionClassifiers.model",{ns:"workflow"})})),a||e.classes&&0!==e.classes.length||(a=t("errorMsg.fieldRequired",{ns:"workflow",field:t("nodes.questionClassifiers.class",{ns:"workflow"})})),!a&&e.classes.some(e=>!e.name)&&(a=t("errorMsg.fieldRequired",{ns:"workflow",field:t("nodes.questionClassifiers.topicName",{ns:"workflow"})})),!a&&e.vision?.enabled&&!e.vision.configs?.variable_selector?.length&&(a=t("errorMsg.fieldRequired",{ns:"workflow",field:t("errorMsg.fields.visionVariable",{ns:"workflow"})})),{isValid:!a,errorMessage:a}}};e.s(["default",0,ed],547944);let eu="errorMsg",ef={metaData:(0,w.genNodeMetaData)({classification:k.BlockClassificationEnum.Transform,sort:2,type:g.BlockEnum.TemplateTransform,helpLinkUri:"template"}),defaultValue:{template:"",variables:[]},checkValid(e,t){let a="",{template:r,variables:o}=e;return!a&&o.filter(e=>!e.variable).length>0&&(a=t(`${eu}.fieldRequired`,{ns:"workflow",field:t(`${eu}.fields.variable`,{ns:"workflow"})})),!a&&o.filter(e=>!e.value_selector.length).length>0&&(a=t(`${eu}.fieldRequired`,{ns:"workflow",field:t(`${eu}.fields.variableValue`,{ns:"workflow"})})),a||r||(a=t(`${eu}.fieldRequired`,{ns:"workflow",field:t("nodes.templateTransform.code",{ns:"workflow"})})),{isValid:!a,errorMessage:a}}};e.s(["default",0,ef],260781);var ec=e.i(144480);let ep={metaData:(0,w.genNodeMetaData)({classification:k.BlockClassificationEnum.Transform,sort:3,type:g.BlockEnum.VariableAggregator}),defaultValue:{output_type:g.VarType.any,variables:[]},checkValid(e,t){let a="",{variables:r,advanced_settings:o}=e,{group_enabled:i=!1,groups:n=[]}=o||{},l=(e,r)=>{e.forEach(e=>{e&&0!==e.length||(a=t("errorMsg.fieldRequired",{ns:"workflow",field:t(r,{ns:"workflow"})}))})};return i?n&&0!==n.length?a||n.forEach(e=>{l(e.variables||[],"errorMsg.fields.variableValue")}):a=t("errorMsg.fieldRequired",{ns:"workflow",field:t("nodes.variableAssigner.title",{ns:"workflow"})}):r&&0!==r.length?a||l(r,"errorMsg.fields.variableValue"):a=t("errorMsg.fieldRequired",{ns:"workflow",field:t("nodes.variableAssigner.title",{ns:"workflow"})}),{isValid:!a,errorMessage:a}}};e.s(["default",0,ep],879756);let em=[Q,F,{metaData:_,defaultValue:{tool_node_version:"2"},checkValid(e,t,a){let{strategy:r,language:o,isReadyForCheckValid:i}=a;if(!i)return{isValid:!0,errorMessage:""};if(!r)return{isValid:!1,errorMessage:t("nodes.agent.checkList.strategyNotSelected",{ns:"workflow"})};for(let a of r.parameters){if(a.required&&a.type===p.FormTypeEnum.toolSelector){let r=e.agent_parameters?.[a.name]?.value;if(!r)return{isValid:!1,errorMessage:t("errorMsg.fieldRequired",{ns:"workflow",field:(0,m.renderI18nObject)(a.label,o)})};{if(!r.enabled)return{isValid:!1,errorMessage:t("errorMsg.noValidTool",{ns:"workflow",field:(0,m.renderI18nObject)(a.label,o)})};let i=r.schemas||[],n=r.settings,l=r.parameters,s=e.version,d=e.tool_node_version,u=s||d;i.forEach(e=>{if(e?.required&&("form"===e.form&&!u&&!n[e.name]?.value||"form"===e.form&&u&&!n[e.name]?.value.value||"llm"===e.form&&!u&&0===l[e.name].auto&&!l[e.name]?.value||"llm"===e.form&&u&&0===l[e.name].auto&&!l[e.name]?.value.value))return{isValid:!1,errorMessage:t("errorMsg.toolParameterRequired",{ns:"workflow",field:(0,m.renderI18nObject)(a.label,o),param:(0,m.renderI18nObject)(e.label,o)})}})}}if(a.required&&a.type===p.FormTypeEnum.multiToolSelector){let r=e.agent_parameters?.[a.name]?.value||[];if(!r.length)return{isValid:!1,errorMessage:t("errorMsg.fieldRequired",{ns:"workflow",field:(0,m.renderI18nObject)(a.label,o)})};{if(r.every(e=>!e.enabled))return{isValid:!1,errorMessage:t("errorMsg.noValidTool",{ns:"workflow",field:(0,m.renderI18nObject)(a.label,o)})};let e={isValid:!0,errorMessage:""};for(let e of r){let r=e.schemas||[],i=e.settings,n=e.parameters;r.forEach(e=>{if(e?.required&&("form"===e.form&&!i[e.name]?.value||"llm"===e.form&&n[e.name]?.auto===0&&!n[e.name]?.value))return{isValid:!1,errorMessage:t("errorMsg.toolParameterRequired",{ns:"workflow",field:(0,m.renderI18nObject)(a.label,o),param:(0,m.renderI18nObject)(e.label,o)})}})}return e}}if(a.required&&!(e.agent_parameters?.[a.name]?.value||a.default))return{isValid:!1,errorMessage:t("errorMsg.fieldRequired",{ns:"workflow",field:(0,m.renderI18nObject)(a.label,o)})}}return{isValid:!0,errorMessage:""}}},ed,A,D,{metaData:W,defaultValue:{},checkValid:()=>({isValid:!0})},er,{metaData:X,defaultValue:{},checkValid:()=>({isValid:!0})},{metaData:Y,defaultValue:{},checkValid:()=>({isValid:!0})},T,ef,ep,S,b,es,C,H,ec.default];e.s(["WORKFLOW_COMMON_NODES",0,em],877166)},225036,e=>{"use strict";var t=e.i(105845),a=e.i(268255);e.i(275225);var r=e.i(705405),o=e.i(390622),i=e.i(223314),n=e.i(192447),l=e.i(381086),s=e.i(959752);e.s(["useWorkflowRunEvent",0,()=>{let e,d,u,f,c,p,m,g,w,_,k,y,h,v,b,E,R,T,S,V,M,q,x,N,C,I,O,{handleWorkflowStarted:B}=(e=(0,n.useStoreApi)(),d=(0,r.useWorkflowStore)(),{handleWorkflowStarted:(0,a.useCallback)(a=>{let{task_id:r,data:i}=a,{workflowRunningData:n,setWorkflowRunningData:l,setIterParallelLogMap:s}=d.getState(),{getNodes:u,setNodes:f,edges:c,setEdges:p}=e.getState();s(new Map),l((0,t.produce)(n,e=>{e.task_id=r,e.result={...e?.result,...i,status:o.WorkflowRunningStatus.Running}}));let m=u();f((0,t.produce)(m,e=>{e.forEach(e=>{e.data._waitingRun=!0,e.data._runningBranchId=void 0})})),p((0,t.produce)(c,e=>{e.forEach(e=>{e.data={...e.data,_sourceRunningStatus:void 0,_targetRunningStatus:void 0,_waitingRun:!0}})}))},[d,e])}),{handleWorkflowFinished:A}=(u=(0,r.useWorkflowStore)(),{handleWorkflowFinished:(0,a.useCallback)(e=>{let{data:a}=e,{workflowRunningData:r,setWorkflowRunningData:o}=u.getState(),n=a.outputs&&1===Object.keys(a.outputs).length&&"string"==typeof a.outputs[Object.keys(a.outputs)[0]];o((0,t.produce)(r,e=>{e.result={...e.result,...a,files:(0,i.getFilesInLogs)(a.outputs)},n&&(e.resultTabActive=!0,e.resultText=a.outputs[Object.keys(a.outputs)[0]])}))},[u])}),{handleWorkflowFailed:W}=(f=(0,r.useWorkflowStore)(),{handleWorkflowFailed:(0,a.useCallback)(()=>{let{workflowRunningData:e,setWorkflowRunningData:a}=f.getState();a((0,t.produce)(e,e=>{e.result={...e.result,status:o.WorkflowRunningStatus.Failed}}))},[f])}),{handleWorkflowNodeStarted:D}=(c=(0,n.useStoreApi)(),p=(0,r.useWorkflowStore)(),m=(0,n.useReactFlow)(),{handleWorkflowNodeStarted:(0,a.useCallback)((e,a)=>{let{data:r}=e,{workflowRunningData:i,setWorkflowRunningData:n}=p.getState(),{getNodes:l,setNodes:s,edges:d,setEdges:u,transform:f}=c.getState(),g=l();n((0,t.produce)(i,e=>{e.tracing.push({...r,status:o.NodeRunningStatus.Running})}));let{setViewport:w}=m,_=g.findIndex(e=>e.id===r.node_id),k=g[_],y=k.position,h=f[2];k.parentId||w({x:(a.clientWidth-400-k.width*h)/2-y.x*h,y:(a.clientHeight-k.height*h)/2-y.y*h,zoom:f[2]}),s((0,t.produce)(g,e=>{e[_].data._runningStatus=o.NodeRunningStatus.Running,e[_].data._waitingRun=!1})),u((0,t.produce)(d,e=>{e.filter(e=>e.target===r.node_id).forEach(e=>{let t=g.find(t=>t.id===e.source);t&&"data"in t&&(!t.data._runningBranchId&&"source"===e.sourceHandle||t.data._runningBranchId&&e.sourceHandle===t.data._runningBranchId)&&(e.data={...e.data,_sourceRunningStatus:t.data._runningStatus,_targetRunningStatus:o.NodeRunningStatus.Running,_waitingRun:!1})})}))},[p,c,m])}),{handleWorkflowNodeFinished:$}=(g=(0,n.useStoreApi)(),w=(0,r.useWorkflowStore)(),{handleWorkflowNodeFinished:(0,a.useCallback)(e=>{let{data:a}=e,{workflowRunningData:r,setWorkflowRunningData:i}=w.getState(),{getNodes:n,setNodes:s,edges:d,setEdges:u}=g.getState(),f=n();i((0,t.produce)(r,e=>{let t=e.tracing.findIndex(e=>e.id===a.id);t>-1&&(e.tracing[t]={...e.tracing[t],...a})})),s((0,t.produce)(f,e=>{let t=e.find(e=>e.id===a.node_id);t.data._runningStatus=a.status,a.status===o.NodeRunningStatus.Exception?a.execution_metadata?.error_strategy===l.ErrorHandleTypeEnum.failBranch&&(t.data._runningBranchId=l.ErrorHandleTypeEnum.failBranch):(a.node_type===o.BlockEnum.IfElse&&(t.data._runningBranchId=a?.outputs?.selected_case_id),a.node_type===o.BlockEnum.QuestionClassifier&&(t.data._runningBranchId=a?.outputs?.class_id))})),u((0,t.produce)(d,e=>{e.filter(e=>e.target===a.node_id).forEach(e=>{e.data={...e.data,_targetRunningStatus:a.status}})}))},[g,w])}),{handleWorkflowNodeIterationStarted:L}=(_=(0,n.useStoreApi)(),k=(0,n.useReactFlow)(),y=(0,r.useWorkflowStore)(),{handleWorkflowNodeIterationStarted:(0,a.useCallback)((e,a)=>{let{data:r}=e,{workflowRunningData:i,setWorkflowRunningData:n,setIterTimes:l}=y.getState(),{getNodes:d,setNodes:u,edges:f,setEdges:c,transform:p}=_.getState(),m=d();n((0,t.produce)(i,e=>{e.tracing.push({...r,status:o.NodeRunningStatus.Running})})),l(s.DEFAULT_ITER_TIMES);let{setViewport:g}=k,w=m.findIndex(e=>e.id===r.node_id),h=m[w],v=h.position,b=p[2];h.parentId||g({x:(a.clientWidth-400-h.width*b)/2-v.x*b,y:(a.clientHeight-h.height*b)/2-v.y*b,zoom:p[2]}),u((0,t.produce)(m,e=>{e[w].data._runningStatus=o.NodeRunningStatus.Running,e[w].data._iterationLength=r.metadata.iterator_length,e[w].data._waitingRun=!1})),c((0,t.produce)(f,e=>{e.filter(e=>e.target===r.node_id).forEach(e=>{e.data={...e.data,_sourceRunningStatus:m.find(t=>t.id===e.source).data._runningStatus,_targetRunningStatus:o.NodeRunningStatus.Running,_waitingRun:!1}})}))},[y,_,k])}),{handleWorkflowNodeIterationNext:j}=(h=(0,n.useStoreApi)(),v=(0,r.useWorkflowStore)(),{handleWorkflowNodeIterationNext:(0,a.useCallback)(e=>{let{iterTimes:a,setIterTimes:r}=v.getState(),{data:o}=e,{getNodes:i,setNodes:n}=h.getState(),l=i();n((0,t.produce)(l,e=>{e.find(e=>e.id===o.node_id).data._iterationIndex=a,r(a+1)}))},[v,h])}),{handleWorkflowNodeIterationFinished:F}=(b=(0,n.useStoreApi)(),E=(0,r.useWorkflowStore)(),{handleWorkflowNodeIterationFinished:(0,a.useCallback)(e=>{let{data:a}=e,{workflowRunningData:r,setWorkflowRunningData:o,setIterTimes:i}=E.getState(),{getNodes:n,setNodes:l,edges:d,setEdges:u}=b.getState(),f=n();o((0,t.produce)(r,e=>{let t=e.tracing.findIndex(e=>e.id===a.id);t>-1&&(e.tracing[t]={...e.tracing[t],...a})})),i(s.DEFAULT_ITER_TIMES),l((0,t.produce)(f,e=>{e.find(e=>e.id===a.node_id).data._runningStatus=a.status})),u((0,t.produce)(d,e=>{e.filter(e=>e.target===a.node_id).forEach(e=>{e.data={...e.data,_targetRunningStatus:a.status}})}))},[E,b])}),{handleWorkflowNodeLoopStarted:P}=(R=(0,n.useStoreApi)(),T=(0,n.useReactFlow)(),S=(0,r.useWorkflowStore)(),{handleWorkflowNodeLoopStarted:(0,a.useCallback)((e,a)=>{let{data:r}=e,{workflowRunningData:i,setWorkflowRunningData:n}=S.getState(),{getNodes:l,setNodes:s,edges:d,setEdges:u,transform:f}=R.getState(),c=l();n((0,t.produce)(i,e=>{e.tracing.push({...r,status:o.NodeRunningStatus.Running})}));let{setViewport:p}=T,m=c.findIndex(e=>e.id===r.node_id),g=c[m],w=g.position,_=f[2];g.parentId||p({x:(a.clientWidth-400-g.width*_)/2-w.x*_,y:(a.clientHeight-g.height*_)/2-w.y*_,zoom:f[2]}),s((0,t.produce)(c,e=>{e[m].data._runningStatus=o.NodeRunningStatus.Running,e[m].data._loopLength=r.metadata.loop_length,e[m].data._waitingRun=!1})),u((0,t.produce)(d,e=>{e.filter(e=>e.target===r.node_id).forEach(e=>{e.data={...e.data,_sourceRunningStatus:c.find(t=>t.id===e.source).data._runningStatus,_targetRunningStatus:o.NodeRunningStatus.Running,_waitingRun:!1}})}))},[S,R,T])}),{handleWorkflowNodeLoopNext:U}=(V=(0,n.useStoreApi)(),{handleWorkflowNodeLoopNext:(0,a.useCallback)(e=>{let{data:a}=e,{getNodes:r,setNodes:i}=V.getState(),n=r();i((0,t.produce)(n,e=>{e.find(e=>e.id===a.node_id).data._loopIndex=a.index,e.forEach(e=>{e.parentId===a.node_id&&(e.data._waitingRun=!0,e.data._runningStatus=o.NodeRunningStatus.Waiting)})}))},[V])}),{handleWorkflowNodeLoopFinished:H}=(M=(0,n.useStoreApi)(),q=(0,r.useWorkflowStore)(),{handleWorkflowNodeLoopFinished:(0,a.useCallback)(e=>{let{data:a}=e,{workflowRunningData:r,setWorkflowRunningData:o}=q.getState(),{getNodes:i,setNodes:n,edges:l,setEdges:s}=M.getState(),d=i();o((0,t.produce)(r,e=>{let t=e.tracing.findIndex(e=>e.id===a.id);t>-1&&(e.tracing[t]={...e.tracing[t],...a})})),n((0,t.produce)(d,e=>{e.find(e=>e.id===a.node_id).data._runningStatus=a.status})),s((0,t.produce)(l,e=>{e.filter(e=>e.target===a.node_id).forEach(e=>{e.data={...e.data,_targetRunningStatus:a.status}})}))},[q,M])}),{handleWorkflowNodeRetry:K}=(x=(0,n.useStoreApi)(),N=(0,r.useWorkflowStore)(),{handleWorkflowNodeRetry:(0,a.useCallback)(e=>{let{data:a}=e,{workflowRunningData:r,setWorkflowRunningData:o}=N.getState(),{getNodes:i,setNodes:n}=x.getState(),l=i();o((0,t.produce)(r,e=>{e.tracing.push(a)})),n((0,t.produce)(l,e=>{e.find(e=>e.id===a.node_id).data._retryIndex=a.retry_index}))},[N,x])}),{handleWorkflowTextChunk:z}=(C=(0,r.useWorkflowStore)(),{handleWorkflowTextChunk:(0,a.useCallback)(e=>{let{data:{text:a}}=e,{workflowRunningData:r,setWorkflowRunningData:o}=C.getState();o((0,t.produce)(r,e=>{e.resultTabActive=!0,e.resultText+=a}))},[C])}),{handleWorkflowTextReplace:Q}=(I=(0,r.useWorkflowStore)(),{handleWorkflowTextReplace:(0,a.useCallback)(e=>{let{data:{text:a}}=e,{workflowRunningData:r,setWorkflowRunningData:o}=I.getState();o((0,t.produce)(r,e=>{e.resultText=a}))},[I])}),{handleWorkflowAgentLog:Y}=(O=(0,r.useWorkflowStore)(),{handleWorkflowAgentLog:(0,a.useCallback)(e=>{let{data:a}=e,{workflowRunningData:r,setWorkflowRunningData:o}=O.getState();o((0,t.produce)(r,e=>{let t=e.tracing.findIndex(e=>e.node_id===a.node_id);if(t>-1){let r=e.tracing[t];if(r.execution_metadata)if(r.execution_metadata.agent_log){let e=r.execution_metadata.agent_log.findIndex(e=>e.message_id===a.message_id);e>-1?r.execution_metadata.agent_log[e]={...r.execution_metadata.agent_log[e],...a}:r.execution_metadata.agent_log.push(a)}else r.execution_metadata.agent_log=[a];else r.execution_metadata={agent_log:[a]}}}))},[O])});return{handleWorkflowStarted:B,handleWorkflowFinished:A,handleWorkflowFailed:W,handleWorkflowNodeStarted:D,handleWorkflowNodeFinished:$,handleWorkflowNodeIterationStarted:L,handleWorkflowNodeIterationNext:j,handleWorkflowNodeIterationFinished:F,handleWorkflowNodeLoopStarted:P,handleWorkflowNodeLoopNext:U,handleWorkflowNodeLoopFinished:H,handleWorkflowNodeRetry:K,handleWorkflowTextChunk:z,handleWorkflowTextReplace:Q,handleWorkflowAgentLog:Y}}],225036)}]);
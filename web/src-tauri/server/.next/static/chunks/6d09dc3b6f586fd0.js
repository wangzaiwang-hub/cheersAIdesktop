(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,149086,289751,219830,e=>{"use strict";var t,s=e.i(824627),a=e.i(268255),r=e.i(295978),n=e.i(773923),i=e.i(703440);let o=function(e){i.default&&!(0,n.isFunction)(e)&&console.error("useMemoizedFn expected parameter is a function, got ".concat(typeof e));var t=(0,a.useRef)(e);t.current=(0,a.useMemo)(function(){return e},[e]);var s=(0,a.useRef)(void 0);return s.current||(s.current=function(){for(var e=[],s=0;s<arguments.length;s++)e[s]=arguments[s];return t.current.apply(this,e)}),s.current};e.s(["default",0,o],289751);let l=(t=a.useEffect,function(e,s){var r=(0,a.useRef)(!1);t(function(){return function(){r.current=!1}},[]),t(function(){if(r.current)return e();r.current=!0},s)});e.s(["default",0,l],219830);var c="AHOOKS_SYNC_STORAGE_EVENT_NAME";function d(e){return function(t,i){void 0===i&&(i={});var d,u=i.listenStorageChange,m=void 0!==u&&u,x=i.onError,f=void 0===x?function(e){console.error(e)}:x;try{d=e()}catch(e){f(e)}function p(){try{var e=null==d?void 0:d.getItem(t);if(e)return i.deserializer?i.deserializer(e):JSON.parse(e)}catch(e){f(e)}return(0,n.isFunction)(i.defaultValue)?i.defaultValue():i.defaultValue}var h=(0,s.__read)((0,a.useState)(p),2),v=h[0],g=h[1];l(function(){g(p())},[t]);var b=function(e){e.key===t&&e.storageArea===d&&g(p())};return(0,r.default)("storage",b,{enable:m}),(0,r.default)(c,function(e){b(e.detail)},{enable:m}),[v,o(function(e){var s=(0,n.isFunction)(e)?e(v):e;m||g(s);try{var a=void 0,r=null==d?void 0:d.getItem(t);(0,n.isUndef)(s)?(a=null,null==d||d.removeItem(t)):(a=i.serializer?i.serializer(s):JSON.stringify(s),null==d||d.setItem(t,a)),dispatchEvent(new CustomEvent(c,{detail:{key:t,newValue:a,oldValue:r,storageArea:d}}))}catch(e){f(e)}})]}}e.s(["createUseStorageState",()=>d],149086)},881110,e=>{"use strict";var t=e.i(149086),s=e.i(354440),a=(0,t.createUseStorageState)(function(){return s.default?localStorage:void 0});e.s(["useLocalStorageState",0,a],881110)},963058,e=>{"use strict";var t=e.i(563199),s=e.i(837699),a=e.i(268255),r=e.i(688393);e.i(152567);var n=e.i(408767),i=e.i(151094),o=e.i(683257);let l=a.memo(function(e){let{isShow:l,title:c,content:d,onConfirm:u,onCancel:m,maskClosable:x=!0,showLink:f,email:p}=e,{t:h}=(0,n.useTranslation)(),v=(0,o.useDocLink)(),g=(0,a.useRef)(null),[b,y]=(0,a.useState)(l),N=v("/use-dify/workspace/subscription-management#dify-for-education");(0,a.useEffect)(()=>{let e=e=>{"Escape"===e.key&&m()};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[m]);let j=e=>{x&&g.current&&!g.current.contains(e.target)&&m()};return((0,a.useEffect)(()=>(document.addEventListener("mousedown",j),()=>{document.removeEventListener("mousedown",j)}),[x]),(0,a.useEffect)(()=>{if(l)y(!0);else{let e=setTimeout(()=>y(!1),200);return()=>clearTimeout(e)}},[l]),b)?(0,r.createPortal)((0,t.jsx)("div",{className:"fixed inset-0 z-[10000000] flex items-center justify-center bg-background-overlay",onClick:e=>{e.preventDefault(),e.stopPropagation()},children:(0,t.jsx)("div",{ref:g,className:"relative w-full max-w-[481px] overflow-hidden",children:(0,t.jsxs)("div",{className:"shadows-shadow-lg flex max-w-full flex-col items-start rounded-2xl border-[0.5px] border-solid border-components-panel-border bg-components-panel-bg",children:[(0,t.jsxs)("div",{className:"flex flex-col items-start gap-2 self-stretch pb-4 pl-6 pr-6 pt-6",children:[(0,t.jsx)("div",{className:"title-2xl-semi-bold text-text-primary",children:c}),(0,t.jsx)("div",{className:"system-md-regular w-full text-text-tertiary",children:d})]}),p&&(0,t.jsxs)("div",{className:"w-full space-y-1 px-6 py-3",children:[(0,t.jsx)("div",{className:"system-sm-semibold py-1 text-text-secondary",children:h("emailLabel",{ns:"education"})}),(0,t.jsx)("div",{className:"system-sm-regular rounded-lg bg-components-input-bg-disabled px-3 py-2 text-components-input-text-filled-disabled",children:p})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2 self-stretch p-6",children:[(0,t.jsx)("div",{className:"flex items-center gap-1",children:f&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("a",{onClick:()=>{window.open(N,"_blank","noopener,noreferrer")},href:N,target:"_blank",className:"system-xs-regular cursor-pointer text-text-accent",children:h("learn",{ns:"education"})}),(0,t.jsx)(s.RiExternalLinkLine,{className:"h-3 w-3 text-text-accent"})]})}),(0,t.jsx)(i.default,{variant:"primary",className:"!w-20",onClick:u,children:h("operation.ok",{ns:"common"})})]})]})})}),document.body):null});e.s(["default",0,l])},30652,e=>{e.v({icon:{type:"element",isRootNode:!0,name:"svg",attributes:{width:"16",height:"22",viewBox:"0 0 16 22",fill:"none",xmlns:"http://www.w3.org/2000/svg"},children:[{type:"element",name:"path",attributes:{id:"Rectangle 979",d:"M0 0H16L9.91493 16.7339C8.76529 19.8955 5.76063 22 2.39658 22H0V0Z",fill:"white"},children:[]}]},name:"Triangle"})},246913,e=>{"use strict";var t=e.i(38532),s=e.i(881110),a=e.i(585458),r=e.i(73920),n=e.i(287200),i=e.i(326531),o=e.i(268255),l=e.i(59375),c=e.i(711536),d=e.i(296124),u=e.i(56971),m=e.i(218631),x=e.i(948124);a.default.extend(n.default),a.default.extend(r.default);let f=(e,t)=>{if(!e||!t)return!1;let s=(0,a.default)().tz(t).startOf("day"),r=a.default.unix(e).tz(t).startOf("day");return s.isSame(r)||s.isAfter(r)};e.s(["useEducation",0,()=>{let{mutateAsync:e,isPending:s,data:a}=(0,m.useEducationAutocomplete)(),[r,n]=(0,o.useState)([]),i=(0,o.useCallback)(t=>{t.keywords&&e(t).then(e=>{let s=t.page||0,a=e.data;s>0?n(e=>[...e||[],...a]):n(a)})},[e]),{run:l}=(0,t.useDebounceFn)(e=>{i(e)},{wait:300});return{schools:r,setSchools:n,querySchoolsWithDebounced:l,handleUpdateSchools:i,isLoading:s,hasNext:a?.has_next}},"useEducationInit",0,()=>{let e=(0,d.useModalContextSelector)(e=>e.setShowAccountSettingModal),t=(0,d.useModalContextSelector)(e=>e.setShowEducationExpireNoticeModal),a=localStorage.getItem(x.EDUCATION_VERIFYING_LOCALSTORAGE_ITEM),r=(0,i.useSearchParams)().get("action");(e=>{let{onNotice:t}=e,{userProfile:{timezone:a}}=(0,c.useAppContext)(),{educationAccountExpireAt:r,allowRefreshEducationVerify:n,isLoadingEducationAccountInfo:i}=(0,u.useProviderContext)(),[l,d]=(0,s.useLocalStorageState)("education-reverify-prev-expire-at",{defaultValue:0}),[m,x]=(0,s.useLocalStorageState)("education-reverify-has-noticed",{defaultValue:!1}),[p,h]=(0,s.useLocalStorageState)("education-expired-has-noticed",{defaultValue:!1});return(0,o.useEffect)(()=>{if(!i&&a&&n){let e=f(r,a),s=l!==r;s&&(d(r),x(!1),h(!1)),!s&&(e?p:m)||(t({expireAt:r,expired:e}),e?h(!0):x(!0))}},[n,a]),f(r,a)})({onNotice:e=>{t({payload:e})}});let n=(0,i.useRouter)(),{mutateAsync:p}=(0,m.useEducationVerify)(),h=async()=>{let{token:e}=await p();e&&n.push(`/education-apply?token=${e}`)};(0,o.useEffect)(()=>{("yes"===a||r===x.EDUCATION_VERIFY_URL_SEARCHPARAMS_ACTION)&&(e({payload:l.ACCOUNT_SETTING_TAB.BILLING}),r===x.EDUCATION_VERIFY_URL_SEARCHPARAMS_ACTION&&localStorage.setItem(x.EDUCATION_VERIFYING_LOCALSTORAGE_ITEM,"yes")),r===x.EDUCATION_RE_VERIFY_ACTION&&h()},[e,a,r])}])},604094,e=>{"use strict";var t=e.i(563199),s=e.i(326531),a=e.i(268255),r=e.i(837699),n=e.i(124836);e.i(152567);var i=e.i(408767),o=e.i(151094),l=e.i(324935),c=e.i(137667),d=e.i(948124),u=e.i(683257),m=e.i(56971),x=e.i(218631),f=e.i(124555),p=e.i(935139);let h=e=>{let{onChange:s,value:a}=e,{t:r}=(0,i.useTranslation)(),n=[{key:"Student",value:r("form.schoolRole.option.student",{ns:"education"})},{key:"Teacher",value:r("form.schoolRole.option.teacher",{ns:"education"})},{key:"School-Administrator",value:r("form.schoolRole.option.administrator",{ns:"education"})}];return(0,t.jsx)("div",{className:"flex",children:n.map(e=>(0,t.jsxs)("div",{className:"system-md-regular mr-6 flex h-5 cursor-pointer items-center text-text-primary",onClick:()=>s(e.key),children:[(0,t.jsx)("div",{className:(0,p.cn)("mr-2 h-4 w-4 rounded-full border border-components-radio-border bg-components-radio-bg shadow-xs",e.key===a&&"border-[5px] border-components-radio-border-checked ")}),e.value]},e.key))})};var v=e.i(291631),g=e.i(391185),b=e.i(246913);let y=e=>{let{value:s,onChange:r}=e,{t:n}=(0,i.useTranslation)(),[o,l]=(0,a.useState)(!1),{schools:c,setSchools:d,querySchoolsWithDebounced:u,handleUpdateSchools:m,hasNext:x}=(0,b.useEducation)(),f=(0,a.useRef)(0),p=(0,a.useRef)(s),h=(0,a.useCallback)(e=>{let t=p.current,s=f.current;e?u({keywords:t,page:s}):m({keywords:t,page:s})},[u,m]),y=(0,a.useCallback)(e=>{l(!0),d([]),f.current=0;let t=e.target.value;p.current=t,r(t),h(!0)},[r,h,d]),N=(0,a.useCallback)(e=>{let{scrollTop:t,scrollHeight:s,clientHeight:a}=e.target;t+a>=s-5&&t>0&&x&&(f.current+=1,h())},[h,x]);return(0,t.jsxs)(g.PortalToFollowElem,{open:o,onOpenChange:l,placement:"bottom",offset:4,triggerPopupSameWidth:!0,children:[(0,t.jsx)(g.PortalToFollowElemTrigger,{className:"block w-full",children:(0,t.jsx)(v.default,{className:"w-full",placeholder:n("form.schoolName.placeholder",{ns:"education"}),value:s,onChange:y})}),(0,t.jsx)(g.PortalToFollowElemContent,{className:"z-[32]",children:!!c.length&&s&&(0,t.jsx)("div",{className:"max-h-[330px] overflow-y-auto rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur p-1",onScroll:N,children:c.map((e,s)=>(0,t.jsx)("div",{className:"system-md-regular flex h-8 cursor-pointer items-center truncate rounded-lg px-2 py-1.5 text-text-secondary hover:bg-state-base-hover",title:e,onClick:()=>{r(e),l(!1)},children:e},s))})})]})};var N=e.i(241661),j=e.i(807324),S=e.i(30652);let w=e=>{let{ref:s,...a}=e;return(0,t.jsx)(j.default,{...a,ref:s,data:S.default})};w.displayName="Triangle";var E=e.i(711536),C=e.i(652669);let k=()=>{let e=(0,s.useRouter)(),{t:a}=(0,i.useTranslation)(),{userProfile:r}=(0,E.useAppContext)(),{mutateAsync:n}=(0,C.useLogout)(),l=async()=>{await n(),localStorage.removeItem("setup_status"),e.push("/signin")};return(0,t.jsxs)("div",{className:"relative flex items-center justify-between rounded-xl border-[4px] border-components-panel-on-panel-item-bg bg-gradient-to-r from-background-gradient-bg-fill-chat-bg-2 to-background-gradient-bg-fill-chat-bg-1 pb-6 pl-6 pr-8 pt-9 shadow-shadow-shadow-5",children:[(0,t.jsxs)("div",{className:"absolute left-0 top-0 flex items-center",children:[(0,t.jsx)("div",{className:"system-2xs-semibold-uppercase flex h-[22px] items-center bg-components-panel-on-panel-item-bg pl-2 pt-1 text-text-accent-light-mode-only",children:a("currentSigned",{ns:"education"})}),(0,t.jsx)(w,{className:"h-[22px] w-4 text-components-panel-on-panel-item-bg"})]}),(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(N.default,{className:"mr-4",avatar:r.avatar_url,name:r.name,size:48}),(0,t.jsxs)("div",{className:"pt-1.5",children:[(0,t.jsx)("div",{className:"system-md-semibold text-text-primary",children:r.name}),(0,t.jsx)("div",{className:"system-sm-regular text-text-secondary",children:r.email})]})]}),(0,t.jsx)(o.default,{variant:"secondary",onClick:l,children:a("userProfile.logout",{ns:"common"})})]})};var T=e.i(963058);let A=()=>{let{t:e}=(0,i.useTranslation)(),[p,v]=(0,a.useState)(""),[g,b]=(0,a.useState)("Student"),[N,j]=(0,a.useState)(!1),[S,w]=(0,a.useState)(!1),{isPending:E,mutateAsync:C}=(0,x.useEducationAdd)({onSuccess:n.noop}),[A,R]=(0,a.useState)(void 0),{onPlanInfoChanged:I}=(0,m.useProviderContext)(),_=(0,x.useInvalidateEducationStatus)(),{notify:L}=(0,c.useToastContext)(),O=(0,s.useRouter)(),V=(0,u.useDocLink)(),P=()=>{R(void 0),I(),_(),localStorage.removeItem(d.EDUCATION_VERIFYING_LOCALSTORAGE_ITEM),O.replace("/")},F=(0,s.useSearchParams)().get("token");return(0,t.jsxs)("div",{className:"fixed inset-0 z-[31] overflow-y-auto bg-background-body p-6",children:[(0,t.jsxs)("div",{className:"mx-auto w-full max-w-[1408px] rounded-2xl border border-effects-highlight bg-background-default-subtle",children:[(0,t.jsx)("div",{className:"h-[349px] w-full overflow-hidden rounded-t-2xl bg-cover bg-center bg-no-repeat",style:{backgroundImage:"url(/education/bg.png)"}}),(0,t.jsx)("div",{className:"mt-[-349px] box-content flex h-7 items-center justify-between p-6",children:(0,t.jsx)(f.default,{size:"large",style:"monochromeWhite"})}),(0,t.jsxs)("div",{className:"mx-auto max-w-[720px] px-8 pb-[180px]",children:[(0,t.jsxs)("div",{className:"mb-2 flex h-[192px] flex-col justify-end pb-4 pt-3 text-text-primary-on-surface",children:[(0,t.jsx)("div",{className:"title-5xl-bold mb-2 shadow-xs",children:e("toVerified",{ns:"education"})}),(0,t.jsxs)("div",{className:"system-md-medium shadow-xs",children:[e("toVerifiedTip.front",{ns:"education"})," ",(0,t.jsx)("span",{className:"system-md-semibold underline",children:e("toVerifiedTip.coupon",{ns:"education"})})," ",e("toVerifiedTip.end",{ns:"education"})]})]}),(0,t.jsx)("div",{className:"mb-7",children:(0,t.jsx)(k,{})}),(0,t.jsxs)("div",{className:"mb-7",children:[(0,t.jsx)("div",{className:"system-md-semibold mb-1 flex h-6 items-center text-text-secondary",children:e("form.schoolName.title",{ns:"education"})}),(0,t.jsx)(y,{value:p,onChange:v})]}),(0,t.jsxs)("div",{className:"mb-7",children:[(0,t.jsx)("div",{className:"system-md-semibold mb-1 flex h-6 items-center text-text-secondary",children:e("form.schoolRole.title",{ns:"education"})}),(0,t.jsx)(h,{value:g,onChange:b})]}),(0,t.jsxs)("div",{className:"mb-7",children:[(0,t.jsx)("div",{className:"system-md-semibold mb-1 flex h-6 items-center text-text-secondary",children:e("form.terms.title",{ns:"education"})}),(0,t.jsxs)("div",{className:"system-md-regular mb-1 text-text-tertiary",children:[e("form.terms.desc.front",{ns:"education"})," ",(0,t.jsx)("a",{href:"https://dify.ai/terms",target:"_blank",className:"text-text-secondary hover:underline",children:e("form.terms.desc.termsOfService",{ns:"education"})})," ",e("form.terms.desc.and",{ns:"education"})," ",(0,t.jsx)("a",{href:"https://dify.ai/privacy",target:"_blank",className:"text-text-secondary hover:underline",children:e("form.terms.desc.privacyPolicy",{ns:"education"})}),e("form.terms.desc.end",{ns:"education"})]}),(0,t.jsxs)("div",{className:"system-md-regular py-2 text-text-primary",children:[(0,t.jsxs)("div",{className:"mb-2 flex",children:[(0,t.jsx)(l.default,{className:"mr-2 shrink-0",checked:N,onCheck:()=>j(!N)}),e("form.terms.option.age",{ns:"education"})]}),(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)(l.default,{className:"mr-2 shrink-0",checked:S,onCheck:()=>w(!S)}),e("form.terms.option.inSchool",{ns:"education"})]})]})]}),(0,t.jsx)(o.default,{variant:"primary",disabled:!N||!S||!p||!g||E,onClick:()=>{C({token:F||"",role:g,institution:p}).then(t=>{"success"===t.message?R({title:e("successTitle",{ns:"education"}),desc:e("successContent",{ns:"education"}),onConfirm:P}):L({type:"error",message:e("submitError",{ns:"education"})})})},children:e("submit",{ns:"education"})}),(0,t.jsx)("div",{className:"mb-4 mt-5 h-px bg-gradient-to-r from-[rgba(16,24,40,0.08)]"}),(0,t.jsxs)("a",{className:"system-xs-regular flex items-center text-text-accent",href:V("/use-dify/workspace/subscription-management#dify-for-education"),target:"_blank",children:[e("learn",{ns:"education"}),(0,t.jsx)(r.RiExternalLinkLine,{className:"ml-1 h-3 w-3"})]})]})]}),(0,t.jsx)(T.default,{isShow:!!A,title:A?.title||"",content:A?.desc,onConfirm:A?.onConfirm||n.noop,onCancel:A?.onConfirm||n.noop})]})};function R(){let e=(0,s.useRouter)(),{enableEducationPlan:r}=(0,m.useProviderContext)(),n=(0,s.useSearchParams)().get("token"),i=(0,a.useMemo)(()=>r&&n,[r,n]);return(0,a.useEffect)(()=>{i||e.replace("/")},[i,e]),(0,t.jsx)(A,{})}e.s(["default",()=>R],604094)}]);
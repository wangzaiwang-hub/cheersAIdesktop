(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,241661,e=>{"use strict";var a=e.i(563199),t=e.i(268255),s=e.i(935139);e.s(["default",0,e=>{let{name:i,avatar:n,size:r=30,className:l,textClassName:o,onError:c}=e,d="shrink-0 flex items-center rounded-full bg-primary-600",u={width:`${r}px`,height:`${r}px`,fontSize:`${r}px`,lineHeight:`${r}px`},[p,h]=(0,t.useState)(!1);return((0,t.useEffect)(()=>{n&&p&&h(!1)},[n]),n&&!p)?(0,a.jsx)("img",{className:(0,s.cn)(d,l),style:u,alt:i,src:n,onError:()=>{h(!0),c?.(!0)},onLoad:()=>c?.(!1)}):(0,a.jsx)("div",{className:(0,s.cn)(d,l),style:u,children:(0,a.jsx)("div",{className:(0,s.cn)(o,"scale-[0.4] text-center text-white"),style:u,children:i&&i[0].toLocaleUpperCase()})})}])},921310,e=>{"use strict";e.s(["OAUTH_AUTHORIZE_PENDING_KEY",0,"oauth_authorize_pending","OAUTH_AUTHORIZE_PENDING_TTL",0,180,"REDIRECT_URL_KEY",0,"oauth_redirect_url"])},513805,e=>{"use strict";var a=e.i(563199),t=e.i(837699),s=e.i(585458),i=e.i(326531),n=e.i(268255);e.i(152567);var r=e.i(408767),l=e.i(241661),o=e.i(151094),c=e.i(449980),d=e.i(137667),u=e.i(225162),p=e.i(711536),h=e.i(652669),m=e.i(875037),x=e.i(562572),g=e.i(367916);let f="oauth-provider";var y=e.i(921310);function v(){let{t:e}=(0,r.useTranslation)(),v={"read:name":{icon:t.RiInfoCardLine,label:e("scopes.name",{ns:"oauth"})},"read:email":{icon:t.RiMailLine,label:e("scopes.email",{ns:"oauth"})},"read:avatar":{icon:t.RiAccountCircleLine,label:e("scopes.avatar",{ns:"oauth"})},"read:interface_language":{icon:t.RiTranslate2,label:e("scopes.languagePreference",{ns:"oauth"})},"read:timezone":{icon:t.RiGlobalLine,label:e("scopes.timezone",{ns:"oauth"})}},b=(0,i.useRouter)(),_=(0,u.useLanguage)(),j=(0,i.useSearchParams)(),N=decodeURIComponent(j.get("client_id")||""),R=decodeURIComponent(j.get("redirect_uri")||""),{userProfile:w}=(0,p.useAppContext)(),{data:U,isLoading:I,isError:T}=(0,x.useQuery)({queryKey:[f,"authAppInfo",N,R],queryFn:()=>(0,g.post)("/oauth/provider",{body:{client_id:N,redirect_uri:R}},{silent:!0}),enabled:!!(N&&R)}),{mutateAsync:A,isPending:E}=(0,m.useMutation)({mutationKey:[f,"authorize"],mutationFn:e=>(0,g.post)("/oauth/provider/authorize",{body:e})}),C=(0,n.useRef)(!1),{isLoading:L,data:$}=(0,h.useIsLogin)(),z=$?.logged_in,k=()=>{try{var e,a;let t,i=function(e,a){try{return`${globalThis.location.origin}${e}${a}`}catch{return e+a}}("/account/oauth/authorize",`?client_id=${encodeURIComponent(N)}&redirect_uri=${encodeURIComponent(R)}`);e=y.OAUTH_AUTHORIZE_PENDING_KEY,a=y.OAUTH_AUTHORIZE_PENDING_TTL,t={value:i,expiry:(0,s.default)().add(a,"seconds").unix()},localStorage.setItem(e,JSON.stringify(t)),b.push(`/signin?${y.REDIRECT_URL_KEY}=${encodeURIComponent(i)}`)}catch{b.push("/signin")}},O=async()=>{if(N&&R)try{let{code:e}=await A({client_id:N}),a=new URL(R);a.searchParams.set("code",e),globalThis.location.href=a.toString()}catch(a){d.default.notify({type:"error",message:`${e("error.authorizeFailed",{ns:"oauth"})}: ${a.message}`})}};return((0,n.useEffect)(()=>{let a=!N||!R;(a||T)&&!C.current&&(C.current=!0,d.default.notify({type:"error",message:a?e("error.invalidParams",{ns:"oauth"}):e("error.authAppInfoFetchFailed",{ns:"oauth"}),duration:0}))},[N,R,T]),I||L)?(0,a.jsx)("div",{className:"bg-background-default-subtle",children:(0,a.jsx)(c.default,{type:"app"})}):(0,a.jsxs)("div",{className:"bg-background-default-subtle",children:[U?.app_icon&&(0,a.jsx)("div",{className:"w-max rounded-2xl border-[0.5px] border-components-panel-border bg-text-primary-on-surface p-3 shadow-lg",children:(0,a.jsx)("img",{src:U.app_icon,alt:"app icon",className:"h-10 w-10 rounded"})}),(0,a.jsxs)("div",{className:`mb-4 mt-5 flex flex-col gap-2 ${z?"pb-2":""}`,children:[(0,a.jsxs)("div",{className:"title-4xl-semi-bold",children:[z&&(0,a.jsx)("div",{className:"text-text-primary",children:e("connect",{ns:"oauth"})}),(0,a.jsx)("div",{className:"text-[var(--color-saas-dify-blue-inverted)]",children:U?.app_label[_]||U?.app_label?.en_US||e("unknownApp",{ns:"oauth"})}),!z&&(0,a.jsx)("div",{className:"text-text-primary",children:e("tips.notLoggedIn",{ns:"oauth"})})]}),(0,a.jsx)("div",{className:"body-md-regular text-text-secondary",children:z?`${U?.app_label[_]||U?.app_label?.en_US||e("unknownApp",{ns:"oauth"})} ${e("tips.loggedIn",{ns:"oauth"})}`:e("tips.needLogin",{ns:"oauth"})})]}),z&&w&&(0,a.jsxs)("div",{className:"flex items-center justify-between rounded-xl bg-background-section-burn-inverted p-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,a.jsx)(l.default,{avatar:w.avatar_url,name:w.name,size:36}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"system-md-semi-bold text-text-secondary",children:w.name}),(0,a.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:w.email})]})]}),(0,a.jsx)(o.default,{variant:"tertiary",size:"small",onClick:k,children:e("switchAccount",{ns:"oauth"})})]}),z&&!!U?.scope&&(0,a.jsx)("div",{className:"mt-2 flex flex-col gap-2.5 rounded-xl bg-background-section-burn-inverted px-[22px] py-5 text-text-secondary",children:U.scope.split(/\s+/).filter(Boolean).map(e=>{let s=v[e];return(0,a.jsxs)("div",{className:"body-sm-medium flex items-center gap-2 text-text-secondary",children:[s?(0,a.jsx)(s.icon,{className:"h-4 w-4"}):(0,a.jsx)(t.RiAccountCircleLine,{className:"h-4 w-4"}),s.label]},e)})}),(0,a.jsx)("div",{className:"flex flex-col items-center gap-2 pt-4",children:z?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.default,{variant:"primary",size:"large",className:"w-full",onClick:O,disabled:!N||!R||T||E,loading:E,children:e("continue",{ns:"oauth"})}),(0,a.jsx)(o.default,{size:"large",className:"w-full",onClick:()=>b.push("/apps"),children:e("operation.cancel",{ns:"common"})})]}):(0,a.jsx)(o.default,{variant:"primary",size:"large",className:"w-full",onClick:k,children:e("login",{ns:"oauth"})})}),(0,a.jsx)("div",{className:"mt-4 py-2",children:(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"400",height:"1",viewBox:"0 0 400 1",fill:"none",children:[(0,a.jsx)("path",{d:"M0 0.5H400",stroke:"url(#paint0_linear_2_5904)"}),(0,a.jsx)("defs",{children:(0,a.jsxs)("linearGradient",{id:"paint0_linear_2_5904",x1:"400",y1:"9.49584",x2:"0.000228929",y2:"9.17666",gradientUnits:"userSpaceOnUse",children:[(0,a.jsx)("stop",{"stop-color":"white","stop-opacity":"0.01"}),(0,a.jsx)("stop",{offset:"0.505","stop-color":"#101828","stop-opacity":"0.08"}),(0,a.jsx)("stop",{offset:"1","stop-color":"white","stop-opacity":"0.01"})]})})]})}),(0,a.jsx)("div",{className:"system-xs-regular mt-3 text-text-tertiary",children:e("tips.common",{ns:"oauth"})})]})}e.s(["default",()=>v],513805)}]);
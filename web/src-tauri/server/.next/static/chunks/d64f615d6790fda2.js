(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,668295,32032,e=>{"use strict";var t=e.i(824627),s=e.i(268255),a=e.i(393689);e.s(["useGetState",0,function(e){var r=(0,t.__read)((0,s.useState)(e),2),l=r[0],n=r[1],o=(0,a.default)(l);return[l,n,(0,s.useCallback)(function(){return o.current},[])]}],668295);var r=e.i(563199),l=e.i(837699),n=e.i(38532),o=e.i(124836);e.i(152567);var i=e.i(408767),d=e.i(324935);e.i(77445);var c=e.i(360052),p=e.i(291631),m=e.i(391185),u=e.i(40666),x=e.i(935139);e.s(["default",0,e=>{let{value:t,onChange:a}=e,{t:h}=(0,i.useTranslation)(),[y,g]=(0,s.useState)(!1),{tags:v}=(0,u.useTags)(),[f,b]=(0,s.useState)(""),[j,N]=(0,s.useState)(""),{run:w}=(0,n.useDebounceFn)(()=>{N(f)},{wait:500}),T=e=>{b(e),w()},C=(0,s.useMemo)(()=>v.filter(e=>e.name.includes(j)),[v,j]),_=(0,s.useMemo)(()=>t.map(e=>v.find(t=>t.name===e)?.label).join(", "),[t,v]);return(0,r.jsx)(m.PortalToFollowElem,{open:y,onOpenChange:g,placement:"bottom-start",offset:4,children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(m.PortalToFollowElemTrigger,{onClick:()=>g(e=>!e),className:"block",children:(0,r.jsxs)("div",{className:(0,x.cn)("flex h-10 cursor-pointer items-center gap-1 rounded-lg border-[0.5px] border-transparent bg-components-input-bg-normal px-3 hover:bg-components-input-bg-hover",y&&"!hover:bg-components-input-bg-hover hover:bg-components-input-bg-hover"),children:[(0,r.jsxs)("div",{title:t.length>0?_:"",className:(0,x.cn)("grow truncate text-[13px] leading-[18px] text-text-secondary",!t.length&&"!text-text-quaternary"),children:[!t.length&&h("createTool.toolInput.labelPlaceholder",{ns:"tools"}),!!t.length&&_]}),(0,r.jsx)("div",{className:"ml-1 shrink-0 text-text-secondary opacity-60",children:(0,r.jsx)(l.RiArrowDownSLine,{className:"h-4 w-4"})})]})}),(0,r.jsx)(m.PortalToFollowElemContent,{className:"z-[1040]",children:(0,r.jsxs)("div",{className:"relative w-[591px] rounded-lg border-[0.5px] border-components-panel-border bg-components-panel-bg-blur shadow-lg  backdrop-blur-[5px]",children:[(0,r.jsx)("div",{className:"border-b-[0.5px] border-divider-regular p-2",children:(0,r.jsx)(p.default,{showLeftIcon:!0,showClearIcon:!0,value:f,onChange:e=>T(e.target.value),onClear:()=>T("")})}),(0,r.jsxs)("div",{className:"max-h-[264px] overflow-y-auto p-1",children:[C.map(e=>(0,r.jsxs)("div",{className:"flex cursor-pointer items-center gap-2 rounded-lg py-[6px] pl-3 pr-2 hover:bg-components-panel-on-panel-item-bg-hover",onClick:()=>{t.includes(e.name)?a(t.filter(t=>t!==e.name)):a([...t,e.name])},children:[(0,r.jsx)(d.default,{className:"shrink-0",checked:t.includes(e.name),onCheck:o.noop}),(0,r.jsx)("div",{title:e.label,className:"grow truncate text-sm leading-5 text-text-secondary",children:e.label})]},e.name)),!C.length&&(0,r.jsxs)("div",{className:"flex flex-col items-center gap-1 p-3",children:[(0,r.jsx)(c.Tag03,{className:"h-6 w-6 text-text-quaternary"}),(0,r.jsx)("div",{className:"text-xs leading-[14px] text-text-tertiary",children:h("tag.noTag",{ns:"common"})})]})]})]})})]})})}],32032)},344600,e=>{"use strict";let t=e=>{let t=new URLSearchParams;return t.set("provider",e),t.toString()};var s=e.i(367916);e.s(["createCustomCollection",0,e=>(0,s.post)("/workspaces/current/tool-provider/api/add",{body:{...e}}),"createWorkflowToolProvider",0,e=>(0,s.post)("/workspaces/current/tool-provider/workflow/create",{body:{...e}}),"deleteWorkflowTool",0,e=>(0,s.post)("/workspaces/current/tool-provider/workflow/delete",{body:{workflow_tool_id:e}}),"fetchBuiltInToolCredential",0,e=>(0,s.get)(`/workspaces/current/tool-provider/builtin/${e}/credentials`),"fetchBuiltInToolCredentialSchema",0,e=>(0,s.get)(`/workspaces/current/tool-provider/builtin/${e}/credentials_schema`),"fetchBuiltInToolList",0,e=>(0,s.get)(`/workspaces/current/tool-provider/builtin/${e}/tools`),"fetchCollectionList",0,()=>(0,s.get)("/workspaces/current/tool-providers"),"fetchCustomCollection",0,e=>{let a=t(e);return(0,s.get)(`/workspaces/current/tool-provider/api/get?${a}`)},"fetchCustomToolList",0,e=>{let a=t(e);return(0,s.get)(`/workspaces/current/tool-provider/api/tools?${a}`)},"fetchModelToolList",0,e=>{let a=t(e);return(0,s.get)(`/workspaces/current/tool-provider/model/tools?${a}`)},"fetchWorkflowToolDetail",0,e=>(0,s.get)(`/workspaces/current/tool-provider/workflow/get?workflow_tool_id=${e}`),"fetchWorkflowToolDetailByAppID",0,e=>(0,s.get)(`/workspaces/current/tool-provider/workflow/get?workflow_app_id=${e}`),"fetchWorkflowToolList",0,e=>(0,s.get)(`/workspaces/current/tool-provider/workflow/tools?workflow_tool_id=${e}`),"importSchemaFromURL",0,e=>(0,s.get)("/workspaces/current/tool-provider/api/remote",{params:{url:e}}),"parseParamsSchema",0,e=>(0,s.post)("/workspaces/current/tool-provider/api/schema",{body:{schema:e}}),"removeBuiltInToolCredential",0,e=>(0,s.post)(`/workspaces/current/tool-provider/builtin/${e}/delete`,{body:{}}),"removeCustomCollection",0,e=>(0,s.post)("/workspaces/current/tool-provider/api/delete",{body:{provider:e}}),"saveWorkflowToolProvider",0,e=>(0,s.post)("/workspaces/current/tool-provider/workflow/update",{body:{...e}}),"testAPIAvailable",0,e=>(0,s.post)("/workspaces/current/tool-provider/api/test/pre",{body:{...e}}),"updateBuiltInToolCredential",0,(e,t)=>(0,s.post)(`/workspaces/current/tool-provider/builtin/${e}/update`,{body:{credentials:t}}),"updateCustomCollection",0,e=>(0,s.post)("/workspaces/current/tool-provider/api/update",{body:{...e}})],344600)},672530,362468,e=>{"use strict";var t=e.i(563199),s=e.i(417944),a=e.i(268255);e.i(152567);var r=e.i(408767),l=e.i(391185),n=e.i(137667),o=e.i(400612),i=e.i(837699),d=e.i(966428),c=e.i(668295),p=e.i(105845),m=e.i(257899),u=e.i(151094),x=e.i(592366),h=e.i(561518),y=e.i(291631),g=e.i(873517),v=e.i(32032),f=e.i(344600),b=e.i(935139);e.i(47690);var j=e.i(849124),N=e.i(946700),w=e.i(574270),T=e.i(421001);let C=e=>{let{text:s,value:a,isChecked:r,onClick:l}=e;return(0,t.jsxs)("div",{className:(0,b.cn)(r?"border-[2px] border-util-colors-indigo-indigo-600 bg-components-panel-on-panel-item-bg shadow-sm":"border border-components-card-border","mb-2 flex h-9 w-[150px] cursor-pointer items-center space-x-2 rounded-xl bg-components-panel-on-panel-item-bg pl-3 hover:bg-components-panel-on-panel-item-bg-hover"),onClick:()=>l(a),children:[(0,t.jsx)(w.default,{isChecked:r}),(0,t.jsx)("div",{className:"system-sm-regular text-text-primary",children:s})]})},_=a.memo(e=>{let{positionCenter:s,credential:l,onChange:n,onHide:o}=e,{t:i}=(0,r.useTranslation)(),[d,c]=a.useState(l);return(0,t.jsx)(x.default,{isShow:!0,positionCenter:s,onHide:o,title:i("createTool.authMethod.title",{ns:"tools"}),dialogClassName:"z-[60]",dialogBackdropClassName:"z-[70]",panelClassName:"mt-2 !w-[520px] h-fit z-[80]",maxWidthClassName:"!max-w-[520px]",height:"fit-content",headerClassName:"!border-b-divider-regular",body:(0,t.jsxs)("div",{className:"px-6 pt-2",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"system-sm-medium py-2 text-text-primary",children:i("createTool.authMethod.type",{ns:"tools"})}),(0,t.jsxs)("div",{className:"flex space-x-3",children:[(0,t.jsx)(C,{text:i("createTool.authMethod.types.none",{ns:"tools"}),value:N.AuthType.none,isChecked:d.auth_type===N.AuthType.none,onClick:e=>c({auth_type:e})}),(0,t.jsx)(C,{text:i("createTool.authMethod.types.api_key_header",{ns:"tools"}),value:N.AuthType.apiKeyHeader,isChecked:d.auth_type===N.AuthType.apiKeyHeader,onClick:e=>c({auth_type:e,api_key_header:d.api_key_header||"Authorization",api_key_value:d.api_key_value||"",api_key_header_prefix:d.api_key_header_prefix||N.AuthHeaderPrefix.custom})}),(0,t.jsx)(C,{text:i("createTool.authMethod.types.api_key_query",{ns:"tools"}),value:N.AuthType.apiKeyQuery,isChecked:d.auth_type===N.AuthType.apiKeyQuery,onClick:e=>c({auth_type:e,api_key_query_param:d.api_key_query_param||"key",api_key_value:d.api_key_value||""})})]})]}),d.auth_type===N.AuthType.apiKeyHeader&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"system-sm-medium py-2 text-text-primary",children:i("createTool.authHeaderPrefix.title",{ns:"tools"})}),(0,t.jsxs)("div",{className:"flex space-x-3",children:[(0,t.jsx)(C,{text:i("createTool.authHeaderPrefix.types.basic",{ns:"tools"}),value:N.AuthHeaderPrefix.basic,isChecked:d.api_key_header_prefix===N.AuthHeaderPrefix.basic,onClick:e=>c({...d,api_key_header_prefix:e})}),(0,t.jsx)(C,{text:i("createTool.authHeaderPrefix.types.bearer",{ns:"tools"}),value:N.AuthHeaderPrefix.bearer,isChecked:d.api_key_header_prefix===N.AuthHeaderPrefix.bearer,onClick:e=>c({...d,api_key_header_prefix:e})}),(0,t.jsx)(C,{text:i("createTool.authHeaderPrefix.types.custom",{ns:"tools"}),value:N.AuthHeaderPrefix.custom,isChecked:d.api_key_header_prefix===N.AuthHeaderPrefix.custom,onClick:e=>c({...d,api_key_header_prefix:e})})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"system-sm-medium flex items-center py-2 text-text-primary",children:[i("createTool.authMethod.key",{ns:"tools"}),(0,t.jsx)(T.default,{popupContent:(0,t.jsx)("div",{className:"w-[261px] text-text-tertiary",children:i("createTool.authMethod.keyTooltip",{ns:"tools"})}),triggerClassName:"ml-0.5 w-4 h-4"})]}),(0,t.jsx)(y.default,{value:d.api_key_header,onChange:e=>c({...d,api_key_header:e.target.value}),placeholder:i("createTool.authMethod.types.apiKeyPlaceholder",{ns:"tools"})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"system-sm-medium py-2 text-text-primary",children:i("createTool.authMethod.value",{ns:"tools"})}),(0,t.jsx)(y.default,{value:d.api_key_value,onChange:e=>c({...d,api_key_value:e.target.value}),placeholder:i("createTool.authMethod.types.apiValuePlaceholder",{ns:"tools"})})]})]}),d.auth_type===N.AuthType.apiKeyQuery&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"system-sm-medium flex items-center py-2 text-text-primary",children:[i("createTool.authMethod.queryParam",{ns:"tools"}),(0,t.jsx)(T.default,{popupContent:(0,t.jsx)("div",{className:"w-[261px] text-text-tertiary",children:i("createTool.authMethod.queryParamTooltip",{ns:"tools"})}),triggerClassName:"ml-0.5 w-4 h-4"})]}),(0,t.jsx)(y.default,{value:d.api_key_query_param,onChange:e=>c({...d,api_key_query_param:e.target.value}),placeholder:i("createTool.authMethod.types.queryParamPlaceholder",{ns:"tools"})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"system-sm-medium py-2 text-text-primary",children:i("createTool.authMethod.value",{ns:"tools"})}),(0,t.jsx)(y.default,{value:d.api_key_value,onChange:e=>c({...d,api_key_value:e.target.value}),placeholder:i("createTool.authMethod.types.apiValuePlaceholder",{ns:"tools"})})]})]})]}),(0,t.jsxs)("div",{className:"mt-4 flex shrink-0 justify-end space-x-2 py-4",children:[(0,t.jsx)(u.default,{onClick:o,children:i("operation.cancel",{ns:"common"})}),(0,t.jsx)(u.default,{variant:"primary",onClick:()=>{n(d),o()},children:i("operation.save",{ns:"common"})})]})]})})});var k=e.i(892081);let S=[{key:"json",content:`{
      "openapi": "3.1.0",
      "info": {
        "title": "Get weather data",
        "description": "Retrieves current weather data for a location.",
        "version": "v1.0.0"
      },
      "servers": [
        {
          "url": "https://weather.example.com"
        }
      ],
      "paths": {
        "/location": {
          "get": {
            "description": "Get temperature for a specific location",
            "operationId": "GetCurrentWeather",
            "parameters": [
              {
                "name": "location",
                "in": "query",
                "description": "The city and state to retrieve the weather for",
                "required": true,
                "schema": {
                  "type": "string"
                }
              }
            ],
            "deprecated": false
          }
        }
      },
      "components": {
        "schemas": {}
      }
    }`},{key:"yaml",content:`# Taken from https://github.com/OAI/OpenAPI-Specification/blob/main/examples/v3.0/petstore.yaml

    openapi: "3.0.0"
    info:
      version: 1.0.0
      title: Swagger Petstore
      license:
        name: MIT
    servers:
      - url: https://petstore.swagger.io/v1
    paths:
      /pets:
        get:
          summary: List all pets
          operationId: listPets
          tags:
            - pets
          parameters:
            - name: limit
              in: query
              description: How many items to return at one time (max 100)
              required: false
              schema:
                type: integer
                maximum: 100
                format: int32
          responses:
            '200':
              description: A paged array of pets
              headers:
                x-next:
                  description: A link to the next page of responses
                  schema:
                    type: string
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/Pets"
            default:
              description: unexpected error
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/Error"
        post:
          summary: Create a pet
          operationId: createPets
          tags:
            - pets
          responses:
            '201':
              description: Null response
            default:
              description: unexpected error
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/Error"
      /pets/{petId}:
        get:
          summary: Info for a specific pet
          operationId: showPetById
          tags:
            - pets
          parameters:
            - name: petId
              in: path
              required: true
              description: The id of the pet to retrieve
              schema:
                type: string
          responses:
            '200':
              description: Expected response to a valid request
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/Pet"
            default:
              description: unexpected error
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/Error"
    components:
      schemas:
        Pet:
          type: object
          required:
            - id
            - name
          properties:
            id:
              type: integer
              format: int64
            name:
              type: string
            tag:
              type: string
        Pets:
          type: array
          maxItems: 100
          items:
            $ref: "#/components/schemas/Pet"
        Error:
          type: object
          required:
            - code
            - message
          properties:
            code:
              type: integer
              format: int32
            message:
              type: string`},{key:"blankTemplate",content:`{
      "openapi": "3.1.0",
      "info": {
        "title": "Untitled",
        "description": "Your OpenAPI specification",
        "version": "v1.0.0"
      },
      "servers": [
        {
          "url": ""
        }
      ],
      "paths": {},
      "components": {
        "schemas": {}
      }
    }`}],P=a.memo(e=>{let{onChange:s}=e,{t:l}=(0,r.useTranslation)(),[o,d]=(0,a.useState)(!1),[c,p]=(0,a.useState)(""),[m,x]=(0,a.useState)(!1),h=async()=>{if(!c.startsWith("http://")&&!c.startsWith("https://"))return void n.default.notify({type:"error",message:l("createTool.urlError",{ns:"tools"})});x(!0);try{let{schema:e}=await (0,f.importSchemaFromURL)(c);p(""),s(e)}finally{x(!1),d(!1)}},g=a.useRef(null);(0,k.useClickAway)(()=>{d(!1)},g);let[v,b]=(0,a.useState)(!1),j=a.useRef(null);return(0,k.useClickAway)(()=>{b(!1)},j),(0,t.jsxs)("div",{className:"relative flex w-[224px] justify-end space-x-1",children:[(0,t.jsxs)("div",{ref:g,children:[(0,t.jsxs)(u.default,{size:"small",className:"space-x-1 ",onClick:()=>{d(!o)},children:[(0,t.jsx)(i.RiAddLine,{className:"h-3 w-3"}),(0,t.jsx)("div",{className:"system-xs-medium text-text-secondary",children:l("createTool.importFromUrl",{ns:"tools"})})]}),o&&(0,t.jsx)("div",{className:" absolute left-[-35px] top-[26px] rounded-lg border border-components-panel-border bg-components-panel-bg p-2 shadow-lg",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(y.default,{type:"text",className:"w-[244px]",placeholder:l("createTool.importFromUrlPlaceHolder",{ns:"tools"}),value:c,onChange:e=>p(e.target.value)}),(0,t.jsx)(u.default,{className:"absolute right-1 top-1",size:"small",variant:"primary",disabled:!c,onClick:h,loading:m,children:m?"":l("operation.ok",{ns:"common"})})]})})]}),(0,t.jsxs)("div",{className:"relative -mt-0.5",ref:j,children:[(0,t.jsxs)(u.default,{size:"small",className:"space-x-1",onClick:()=>{b(!v)},children:[(0,t.jsx)("div",{className:"system-xs-medium text-text-secondary",children:l("createTool.examples",{ns:"tools"})}),(0,t.jsx)(i.RiArrowDownSLine,{className:"h-3 w-3"})]}),v&&(0,t.jsx)("div",{className:"absolute right-0 top-7 rounded-lg bg-components-panel-bg p-1 shadow-sm",children:S.map(e=>(0,t.jsx)("div",{onClick:()=>{s(e.content),b(!1)},className:"system-sm-regular cursor-pointer whitespace-nowrap rounded-lg px-3 py-1.5 leading-5 text-text-secondary hover:bg-components-panel-on-panel-item-bg-hover",children:l(`createTool.exampleOptions.${e.key}`,{ns:"tools"})},e.key))})]})]})});var E=e.i(683257),F=e.i(491234);let M=a.memo(e=>{let{positionCenter:s,customCollection:l,tool:n,onHide:o}=e,{t:d}=(0,r.useTranslation)(),c=(0,E.useLocale)(),p=(0,F.getLanguage)(c),[m,h]=(0,a.useState)(!1),[g,v]=a.useState(l.credentials),[b,j]=(0,a.useState)(!1),[w,T]=(0,a.useState)(""),{operation_id:C,parameters:k}=n,[S,P]=(0,a.useState)({}),M=async()=>{if(b)return;j(!0);let e=JSON.parse(JSON.stringify(g));e.auth_type===N.AuthType.none&&(delete e.api_key_header_prefix,delete e.api_key_header,delete e.api_key_value);let t={provider_name:l.provider,tool_name:C,credentials:e,schema_type:l.schema_type,schema:l.schema,parameters:S},s=await (0,f.testAPIAvailable)(t);T(s.error||s.result),j(!1)};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(x.default,{isShow:!0,positionCenter:s,onHide:o,title:`${d("test.title",{ns:"tools"})}  ${C}`,panelClassName:"mt-2 !w-[600px]",maxWidthClassName:"!max-w-[600px]",height:"calc(100vh - 16px)",headerClassName:"!border-b-divider-regular",body:(0,t.jsxs)("div",{className:"overflow-y-auto px-6 pt-2",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"system-sm-medium py-2 text-text-primary",children:d("createTool.authMethod.title",{ns:"tools"})}),(0,t.jsxs)("div",{className:"flex h-9 cursor-pointer items-center justify-between rounded-lg bg-components-input-bg-normal px-2.5",onClick:()=>h(!0),children:[(0,t.jsx)("div",{className:"system-xs-regular text-text-primary",children:d(`createTool.authMethod.types.${g.auth_type}`,{ns:"tools"})}),(0,t.jsx)(i.RiSettings2Line,{className:"h-4 w-4 text-text-secondary"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"system-sm-medium py-2 text-text-primary",children:d("test.parametersValue",{ns:"tools"})}),(0,t.jsx)("div",{className:"rounded-lg border border-divider-regular",children:(0,t.jsxs)("table",{className:"system-xs-regular w-full font-normal text-text-secondary",children:[(0,t.jsx)("thead",{className:"uppercase text-text-tertiary",children:(0,t.jsxs)("tr",{className:"border-b border-divider-regular",children:[(0,t.jsx)("th",{className:"p-2 pl-3 font-medium",children:d("test.parameters",{ns:"tools"})}),(0,t.jsx)("th",{className:"p-2 pl-3 font-medium",children:d("test.value",{ns:"tools"})})]})}),(0,t.jsx)("tbody",{children:k.map((e,s)=>(0,t.jsxs)("tr",{className:"border-b border-divider-regular last:border-0",children:[(0,t.jsx)("td",{className:"py-2 pl-3 pr-2.5",children:e.label[p]}),(0,t.jsx)("td",{className:"",children:(0,t.jsx)(y.default,{value:S[e.name]||"",onChange:t=>P({...S,[e.name]:t.target.value}),type:"text",className:"!hover:border-transparent !hover:bg-transparent !focus:border-transparent !focus:bg-transparent !border-transparent !bg-transparent"})})]},s))})]})})]})]}),(0,t.jsx)(u.default,{variant:"primary",className:" mt-4 h-10 w-full",loading:b,disabled:b,onClick:M,children:d("test.title",{ns:"tools"})}),(0,t.jsxs)("div",{className:"mt-6",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"system-xs-semibold text-text-tertiary",children:d("test.testResult",{ns:"tools"})}),(0,t.jsx)("div",{className:"bg-[rgb(243, 244, 246)] h-px w-0 grow"})]}),(0,t.jsx)("div",{className:"system-xs-regular mt-2 h-[200px] overflow-y-auto overflow-x-hidden rounded-lg bg-components-input-bg-normal px-3 py-2 text-text-secondary",children:w||(0,t.jsx)("span",{className:"text-text-quaternary",children:d("test.testResultPlaceholder",{ns:"tools"})})})]})]})}),m&&(0,t.jsx)(_,{positionCenter:s,credential:g,onChange:v,onHide:()=>h(!1)})]})}),I=a.memo(e=>{let{positionLeft:s,dialogClassName:l="",payload:o,onHide:w,onAdd:T,onEdit:C,onRemove:k}=e,{t:S}=(0,r.useTranslation)(),E=!o,F=!!o,[I,A]=(0,a.useState)(!E),[V,L]=(0,a.useState)(o?.tools||[]),[q,R]=(0,a.useState)(o?.labels||[]),[O,U,z]=(0,c.useGetState)(E?{provider:"",credentials:{auth_type:N.AuthType.none,api_key_header:"Authorization",api_key_header_prefix:N.AuthHeaderPrefix.basic},icon:{content:"ðŸ•µï¸",background:"#FEF7C3"},schema_type:"",schema:""}:o),$=F?o.provider:"";(0,a.useEffect)(()=>{F&&(U(o),L(o.tools||[]),R(o.labels||[]))},[F,o]);let[D,B]=(0,a.useState)(!1),W=O.icon,H=O.schema,K=(0,d.useDebounce)(H,{wait:500}),G=e=>{U((0,p.produce)(O,t=>{t.schema=e}))};(0,a.useEffect)(()=>{if(K){if(F&&I)return void A(!1);(async()=>{try{let{parameters_schema:e,schema_type:t}=await (0,f.parseParamsSchema)(K),s=z(),a=(0,p.produce)(s,e=>{e.schema_type=t});U(a),L(e)}catch{let e=z();U((0,p.produce)(e,e=>{e.schema_type=""})),L([])}})()}},[K]);let[J,Q]=(0,a.useState)(!1),X=O.credentials,[Y,Z]=(0,a.useState)(null),[ee,et]=(0,a.useState)(!1);return(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(x.default,{isShow:!0,positionCenter:E&&!s,onHide:w,title:S(`createTool.${E?"title":"editTitle"}`,{ns:"tools"}),dialogClassName:l,panelClassName:"mt-2 !w-[640px]",maxWidthClassName:"!max-w-[640px]",height:"calc(100vh - 16px)",headerClassName:"!border-b-divider-regular",body:(0,t.jsxs)("div",{className:"flex h-full flex-col",children:[(0,t.jsxs)("div",{className:"h-0 grow space-y-4 overflow-y-auto px-6 py-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"system-sm-medium py-2 text-text-primary",children:[S("createTool.name",{ns:"tools"})," ",(0,t.jsx)("span",{className:"ml-1 text-red-500",children:"*"})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,t.jsx)(m.default,{size:"large",onClick:()=>{B(!0)},className:"cursor-pointer",icon:W.content,background:W.background}),(0,t.jsx)(y.default,{className:"h-10 grow",placeholder:S("createTool.toolNamePlaceHolder",{ns:"tools"}),value:O.provider,onChange:e=>{U((0,p.produce)(O,t=>{t.provider=e.target.value}))}})]})]}),(0,t.jsxs)("div",{className:"select-none",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsxs)("div",{className:"system-sm-medium py-2 text-text-primary",children:[S("createTool.schema",{ns:"tools"}),(0,t.jsx)("span",{className:"ml-1 text-red-500",children:"*"})]}),(0,t.jsx)("div",{className:"mx-2 h-3 w-px bg-divider-regular"}),(0,t.jsxs)("a",{href:"https://swagger.io/specification/",target:"_blank",rel:"noopener noreferrer",className:"flex h-[18px] items-center space-x-1  text-text-accent",children:[(0,t.jsx)("div",{className:"text-xs font-normal",children:S("createTool.viewSchemaSpec",{ns:"tools"})}),(0,t.jsx)(j.LinkExternal02,{className:"h-3 w-3"})]})]}),(0,t.jsx)(P,{onChange:G})]}),(0,t.jsx)(g.default,{className:"h-[240px] resize-none",value:H,onChange:e=>G(e.target.value),placeholder:S("createTool.schemaPlaceHolder",{ns:"tools"})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"system-sm-medium py-2 text-text-primary",children:S("createTool.availableTools.title",{ns:"tools"})}),(0,t.jsx)("div",{className:"w-full overflow-x-auto rounded-lg border border-divider-regular",children:(0,t.jsxs)("table",{className:"system-xs-regular w-full text-text-secondary",children:[(0,t.jsx)("thead",{className:"uppercase text-text-tertiary",children:(0,t.jsxs)("tr",{className:(0,b.cn)(V.length>0&&"border-b","border-divider-regular"),children:[(0,t.jsx)("th",{className:"p-2 pl-3 font-medium",children:S("createTool.availableTools.name",{ns:"tools"})}),(0,t.jsx)("th",{className:"w-[236px] p-2 pl-3 font-medium",children:S("createTool.availableTools.description",{ns:"tools"})}),(0,t.jsx)("th",{className:"p-2 pl-3 font-medium",children:S("createTool.availableTools.method",{ns:"tools"})}),(0,t.jsx)("th",{className:"p-2 pl-3 font-medium",children:S("createTool.availableTools.path",{ns:"tools"})}),(0,t.jsx)("th",{className:"w-[54px] p-2 pl-3 font-medium",children:S("createTool.availableTools.action",{ns:"tools"})})]})}),(0,t.jsx)("tbody",{children:V.map((e,s)=>(0,t.jsxs)("tr",{className:"border-b border-divider-regular last:border-0",children:[(0,t.jsx)("td",{className:"p-2 pl-3",children:e.operation_id}),(0,t.jsx)("td",{className:"w-[236px] p-2 pl-3",children:e.summary}),(0,t.jsx)("td",{className:"p-2 pl-3",children:e.method}),(0,t.jsx)("td",{className:"p-2 pl-3",children:(e=>{if(!e)return"";try{return decodeURI(new URL(e).pathname)||""}catch{return e}})(e.server_url)}),(0,t.jsx)("td",{className:"w-[62px] p-2 pl-3",children:(0,t.jsx)(u.default,{size:"small",onClick:()=>{Z(e),et(!0)},children:S("createTool.availableTools.test",{ns:"tools"})})})]},s))})]})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"system-sm-medium py-2 text-text-primary",children:S("createTool.authMethod.title",{ns:"tools"})}),(0,t.jsxs)("div",{className:"flex h-9 cursor-pointer items-center justify-between rounded-lg bg-components-input-bg-normal px-2.5",onClick:()=>Q(!0),children:[(0,t.jsx)("div",{className:"system-xs-regular text-text-primary",children:S(`createTool.authMethod.types.${X.auth_type}`,{ns:"tools"})}),(0,t.jsx)(i.RiSettings2Line,{className:"h-4 w-4 text-text-secondary"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"system-sm-medium py-2 text-text-primary",children:S("createTool.toolInput.label",{ns:"tools"})}),(0,t.jsx)(v.default,{value:q,onChange:e=>{R(e)}})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"system-sm-medium py-2 text-text-primary",children:S("createTool.privacyPolicy",{ns:"tools"})}),(0,t.jsx)(y.default,{value:O.privacy_policy,onChange:e=>{U((0,p.produce)(O,t=>{t.privacy_policy=e.target.value}))},className:"h-10 grow",placeholder:S("createTool.privacyPolicyPlaceholder",{ns:"tools"})||""})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"system-sm-medium py-2 text-text-primary",children:S("createTool.customDisclaimer",{ns:"tools"})}),(0,t.jsx)(y.default,{value:O.custom_disclaimer,onChange:e=>{U((0,p.produce)(O,t=>{t.custom_disclaimer=e.target.value}))},className:"h-10 grow",placeholder:S("createTool.customDisclaimerPlaceholder",{ns:"tools"})||""})]})]}),(0,t.jsxs)("div",{className:(0,b.cn)(F?"justify-between":"justify-end","mt-2 flex shrink-0 rounded-b-[10px] border-t border-divider-regular bg-background-section-burn px-6 py-4"),children:[F&&(0,t.jsx)(u.default,{variant:"warning",onClick:k,children:S("operation.delete",{ns:"common"})}),(0,t.jsxs)("div",{className:"flex space-x-2 ",children:[(0,t.jsx)(u.default,{onClick:w,children:S("operation.cancel",{ns:"common"})}),(0,t.jsx)(u.default,{variant:"primary",onClick:()=>{let e=(0,p.produce)(O,e=>{delete e.tools,e.credentials.auth_type===N.AuthType.none&&(delete e.credentials.api_key_header,delete e.credentials.api_key_header_prefix,delete e.credentials.api_key_value),e.labels=q}),t="";(e.provider||(t=S("errorMsg.fieldRequired",{ns:"common",field:S("createTool.name",{ns:"tools"})})),e.schema||(t=S("errorMsg.fieldRequired",{ns:"common",field:S("createTool.schema",{ns:"tools"})})),t)?n.default.notify({type:"error",message:t}):E?T?.(e):C?.({...e,original_provider:$})},children:S("operation.save",{ns:"common"})})]})]}),D&&(0,t.jsx)(h.default,{onSelect:(e,t)=>{var s;s={content:e,background:t},U((0,p.produce)(O,e=>{e.icon=s})),B(!1)},onClose:()=>{B(!1)}}),J&&(0,t.jsx)(_,{positionCenter:E,credential:X,onChange:e=>{U((0,p.produce)(O,t=>{t.credentials=e}))},onHide:()=>Q(!1)}),ee&&(0,t.jsx)(M,{positionCenter:E,tool:Y,customCollection:O,onHide:()=>et(!1)})]}),isShowMask:!0,clickOutsideNotOpen:!0})})});e.s(["default",0,I],362468);var A=e.i(811388),V=e.i(494268),L=e.i(157644),q=e.i(154033);let R=a.memo(e=>{let{disabled:i,trigger:d,placement:c="right-start",offset:p=0,isShow:m,onShowChange:u,onSelect:x,onSelectMultiple:h,supportAddCustomTool:y,scope:g="all",selectedTools:v,panelClassName:j}=e,{t:N}=(0,r.useTranslation)(),[w,T]=(0,a.useState)(""),[C,_]=(0,a.useState)([]),{enable_marketplace:k}=(0,V.useGlobalPublicStore)(e=>e.systemFeatures),{data:S}=(0,q.useAllBuiltInTools)(),{data:P}=(0,q.useAllCustomTools)(),E=(0,q.useInvalidateAllCustomTools)(),{data:F}=(0,q.useAllWorkflowTools)(),{data:M}=(0,q.useAllMCPTools)(),R=(0,q.useInvalidateAllBuiltInTools)(),O=(0,q.useInvalidateAllWorkflowTools)(),U=(0,q.useInvalidateAllMCPTools)(),{plugins:z=[],isLoading:$}=(0,L.useFeaturedToolsRecommendations)(k),{builtinToolList:D,customToolList:B,workflowToolList:W}=(0,a.useMemo)(()=>"plugins"===g?{builtinToolList:S,customToolList:[],workflowToolList:[]}:"custom"===g?{builtinToolList:[],customToolList:P,workflowToolList:[]}:"workflow"===g?{builtinToolList:[],customToolList:[],workflowToolList:F}:{builtinToolList:S,customToolList:P,workflowToolList:F},[g,S,P,F]),[H,{setFalse:K,setTrue:G}]=(0,s.useBoolean)(!1),J=async e=>{await (0,f.createCustomCollection)(e),n.default.notify({type:"success",message:N("api.actionSuccess",{ns:"common"})}),K(),E()};return H?(0,t.jsx)(I,{dialogClassName:"bg-background-overlay",payload:null,onHide:K,onAdd:J}):(0,t.jsxs)(l.PortalToFollowElem,{placement:c,offset:p,open:m,onOpenChange:u,children:[(0,t.jsx)(l.PortalToFollowElemTrigger,{onClick:()=>{i||u(!0)},children:d}),(0,t.jsx)(l.PortalToFollowElemContent,{className:"z-[1000]",children:(0,t.jsxs)("div",{className:(0,b.cn)("relative min-h-20 rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur shadow-lg backdrop-blur-sm",j),children:[(0,t.jsx)("div",{className:"p-2 pb-1",children:(0,t.jsx)(o.default,{search:w,onSearchChange:T,tags:C,onTagsChange:_,placeholder:N("searchTools",{ns:"plugin"}),supportAddCustomTool:y,onAddedCustomTool:E,onShowAddCustomCollectionModal:G,inputClassName:"grow"})}),(0,t.jsx)(A.default,{className:"mt-1",toolContentClassName:"max-w-[100%]",tags:C,searchText:w,onSelect:(e,t)=>{x(t)},onSelectMultiple:(e,t)=>{h(t)},buildInTools:D||[],customTools:B||[],workflowTools:W||[],mcpTools:M||[],selectedTools:v,onTagsChange:_,featuredPlugins:z,featuredLoading:$,showFeatured:"all"===g&&k,onFeaturedInstallSuccess:async()=>{R(),E(),O(),U()}})]})})]})});e.s(["default",0,R],672530)},282700,958865,350988,495620,464727,734186,508844,899713,288716,207826,609995,899620,724081,325011,78336,e=>{"use strict";var t=e.i(563199),s=e.i(268255);e.i(152567);var a=e.i(408767),r=e.i(391185),l=e.i(449980),n=e.i(471981);e.i(237855);var o=e.i(910605),i=e.i(291631),d=e.i(299951),c=e.i(873517),p=e.i(390622);let m=e=>{let{inputsForms:r,inputs:l,inputsRef:n,onFormChange:m}=e,{t:u}=(0,a.useTranslation)(),x=(0,s.useCallback)((e,t)=>{m({...n.current,[e]:t})},[m,n]);return r.length?(0,t.jsx)("div",{className:"flex flex-col gap-4 px-4 py-2",children:r.map(e=>(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"system-sm-semibold mb-1 flex h-6 items-center gap-1 text-text-secondary",children:[(0,t.jsx)("div",{className:"truncate",children:e.label}),!e.required&&(0,t.jsx)("span",{className:"system-xs-regular text-text-tertiary",children:u("panel.optional",{ns:"workflow"})})]}),(e=>{let{label:s,variable:a,options:r}=e;return e.type===p.InputVarType.textInput?(0,t.jsx)(i.default,{value:l[a]||"",onChange:e=>x(a,e.target.value),placeholder:s}):e.type===p.InputVarType.number?(0,t.jsx)(i.default,{type:"number",value:l[a]||"",onChange:e=>x(a,e.target.value),placeholder:s}):e.type===p.InputVarType.paragraph?(0,t.jsx)(c.default,{value:l[a]||"",onChange:e=>x(a,e.target.value),placeholder:s}):e.type===p.InputVarType.select?(0,t.jsx)(d.PortalSelect,{popupClassName:"w-[356px] z-[1050]",value:l[a]||"",items:r.map(e=>({value:e,name:e})),onSelect:e=>x(a,e.value),placeholder:s}):e.type===p.InputVarType.singleFile?(0,t.jsx)(o.FileUploaderInAttachmentWrapper,{value:l[a]?[l[a]]:[],onChange:e=>x(a,e[0]),fileConfig:{allowed_file_types:e.allowed_file_types,allowed_file_extensions:e.allowed_file_extensions,allowed_file_upload_methods:e.allowed_file_upload_methods,number_limits:1,fileUploadConfig:e.fileUploadConfig}}):e.type===p.InputVarType.multiFiles?(0,t.jsx)(o.FileUploaderInAttachmentWrapper,{value:l[a],onChange:e=>x(a,e),fileConfig:{allowed_file_types:e.allowed_file_types,allowed_file_extensions:e.allowed_file_extensions,allowed_file_upload_methods:e.allowed_file_upload_methods,number_limits:e.max_length,fileUploadConfig:e.fileUploadConfig}}):void 0})(e)]},e.variable))}):null};var u=e.i(632815),x=e.i(652669),h=e.i(387852),y=e.i(648404),g=e.i(935139);let v=e=>{let{value:r,appDetail:o,onFormChange:i}=e,{t:d}=(0,a.useTranslation)(),c=(0,s.useRef)(r?.inputs||{}),v=o.mode!==y.AppModeEnum.ADVANCED_CHAT&&o.mode!==y.AppModeEnum.WORKFLOW,{data:f}=(0,x.useFileUploadConfig)(),{data:b,isFetching:j}=(0,u.useAppDetail)(o.id),{data:N,isFetching:w}=(0,h.useAppWorkflow)(v?"":o.id),T=j||w,C=(0,s.useMemo)(()=>{let e;return e=v?b?.model_config?.file_upload:N?.features?.file_upload,{image:{detail:e?.image?.detail||y.Resolution.high,enabled:!!e?.image?.enabled,number_limits:e?.image?.number_limits||3,transfer_methods:e?.image?.transfer_methods||["local_file","remote_url"]},enabled:!!(e?.enabled||e?.image?.enabled),allowed_file_types:e?.allowed_file_types||[p.SupportUploadFileTypes.image],allowed_file_extensions:e?.allowed_file_extensions||[...n.FILE_EXTS[p.SupportUploadFileTypes.image]].map(e=>`.${e}`),allowed_file_upload_methods:e?.allowed_file_upload_methods||e?.image?.transfer_methods||["local_file","remote_url"],number_limits:e?.number_limits||e?.image?.number_limits||3}},[b?.model_config?.file_upload,N?.features?.file_upload,v]),_=(0,s.useMemo)(()=>{if(!b)return[];let e=[];if(v)e=b.model_config?.user_input_form?.filter(e=>!e.external_data_tool).map(e=>e.paragraph?{...e.paragraph,type:"paragraph",required:!1}:e.number?{...e.number,type:"number",required:!1}:e.checkbox?{...e.checkbox,type:"checkbox",required:!1}:e.select?{...e.select,type:"select",required:!1}:e["file-list"]?{...e["file-list"],type:"file-list",required:!1,fileUploadConfig:f}:e.file?{...e.file,type:"file",required:!1,fileUploadConfig:f}:e.json_object?{...e.json_object,type:"json_object"}:{...e["text-input"],type:"text-input",required:!1})||[];else{let t=N?.graph?.nodes.find(e=>e.data.type===p.BlockEnum.Start);e=t?.data.variables.map(e=>e.type===p.InputVarType.multiFiles||e.type===p.InputVarType.singleFile?{...e,required:!1,fileUploadConfig:f}:{...e,required:!1})||[]}return(b.mode===y.AppModeEnum.COMPLETION||b.mode===y.AppModeEnum.WORKFLOW)&&C.enabled&&e.push({label:"Image Upload",variable:"#image#",type:p.InputVarType.singleFile,required:!1,...C,fileUploadConfig:f}),e||[]},[C,b,N,f,v]);return(0,t.jsxs)("div",{className:(0,g.cn)("flex max-h-[240px] flex-col rounded-b-2xl border-t border-divider-subtle pb-4"),children:[T&&(0,t.jsx)("div",{className:"pt-3",children:(0,t.jsx)(l.default,{type:"app"})}),!T&&(0,t.jsx)("div",{className:"system-sm-semibold mb-2 mt-3 flex h-6 shrink-0 items-center px-4 text-text-secondary",children:d("appSelector.params",{ns:"app"})}),!T&&!_.length&&(0,t.jsx)("div",{className:"flex h-16 flex-col items-center justify-center",children:(0,t.jsx)("div",{className:"system-sm-regular text-text-tertiary",children:d("appSelector.noParams",{ns:"app"})})}),!T&&!!_.length&&(0,t.jsx)("div",{className:"grow overflow-y-auto",children:(0,t.jsx)(m,{inputs:r?.inputs||{},inputsRef:c,inputsForms:_,onFormChange:e=>{c.current=e,i(e)}})})]})};var f=e.i(257899);let b=s.memo(e=>{let{scope:l,disabled:n,trigger:o,placement:d="right-start",offset:c=0,isShow:p,onShowChange:m,onSelect:u,apps:x,isLoading:h,hasMore:g,onLoadMore:v,searchText:b,onSearchChange:j}=e,{t:N}=(0,a.useTranslation)(),w=(0,s.useRef)(null),T=(0,s.useRef)(null),C=(0,s.useRef)(!1),_=(0,s.useCallback)(e=>{e[0].isIntersecting&&!C.current&&g&&!h&&(C.current=!0,v(),setTimeout(()=>{C.current=!1},500))},[g,h,v]);return(0,s.useEffect)(()=>{if(!p){T.current&&(T.current.disconnect(),T.current=null);return}let e=null,t=()=>{w.current&&(T.current=new IntersectionObserver(_,{root:null,rootMargin:"100px",threshold:.1}),T.current.observe(w.current))};return(e=new MutationObserver(s=>{w.current&&(t(),e?.disconnect())})).observe(document.body,{childList:!0,subtree:!0}),w.current&&t(),()=>{T.current&&(T.current.disconnect(),T.current=null),e?.disconnect()}},[p,_]),(0,t.jsxs)(r.PortalToFollowElem,{placement:d,offset:c,open:p,onOpenChange:m,children:[(0,t.jsx)(r.PortalToFollowElemTrigger,{onClick:()=>{n||m(!0)},children:o}),(0,t.jsx)(r.PortalToFollowElemContent,{className:"z-[1000]",children:(0,t.jsxs)("div",{className:"relative flex max-h-[400px] min-h-20 w-[356px] flex-col rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur shadow-lg backdrop-blur-sm",children:[(0,t.jsx)("div",{className:"p-2 pb-1",children:(0,t.jsx)(i.default,{showLeftIcon:!0,showClearIcon:!0,value:b,onChange:e=>j(e.target.value),onClear:()=>j("")})}),(0,t.jsxs)("div",{className:"min-h-0 flex-1 overflow-y-auto p-1",children:[x.map(e=>(0,t.jsxs)("div",{className:"flex cursor-pointer items-center gap-3 rounded-lg py-1 pl-2 pr-3 hover:bg-state-base-hover",onClick:()=>u(e),children:[(0,t.jsx)(f.default,{className:"shrink-0",size:"xs",iconType:e.icon_type,icon:e.icon,background:e.icon_background,imageUrl:e.icon_url}),(0,t.jsxs)("div",{title:`${e.name} (${e.id})`,className:"system-sm-medium grow text-components-input-text-filled",children:[(0,t.jsx)("span",{className:"mr-1",children:e.name}),(0,t.jsxs)("span",{className:"text-text-tertiary",children:["(",e.id.slice(0,8),")"]})]}),(0,t.jsx)("div",{className:"system-2xs-medium-uppercase shrink-0 text-text-tertiary",children:(e=>{switch(e.mode){case y.AppModeEnum.ADVANCED_CHAT:return"chatflow";case y.AppModeEnum.AGENT_CHAT:return"agent";case y.AppModeEnum.CHAT:return"chat";case y.AppModeEnum.COMPLETION:return"completion";case y.AppModeEnum.WORKFLOW:return"workflow"}})(e)})]},e.id)),(0,t.jsx)("div",{ref:w,className:"h-4 w-full",children:h&&(0,t.jsx)("div",{className:"flex justify-center py-2",children:(0,t.jsx)("div",{className:"text-sm text-gray-500",children:N("loading",{ns:"common"})})})})]})]})})]})});var j=e.i(837699);let N=e=>{let{open:s,appDetail:r}=e,{t:l}=(0,a.useTranslation)();return(0,t.jsxs)("div",{className:(0,g.cn)("group flex cursor-pointer items-center rounded-lg bg-components-input-bg-normal p-2 pl-3 hover:bg-state-base-hover-alt",s&&"bg-state-base-hover-alt",r&&"py-1.5 pl-1.5"),children:[r&&(0,t.jsx)(f.default,{className:"mr-2",size:"xs",iconType:r.icon_type,icon:r.icon,background:r.icon_background,imageUrl:r.icon_url}),r&&(0,t.jsx)("div",{title:r.name,className:"system-sm-medium grow text-components-input-text-filled",children:r.name}),!r&&(0,t.jsx)("div",{className:"system-sm-regular grow truncate text-components-input-text-placeholder",children:l("appSelector.placeholder",{ns:"app"})}),(0,t.jsx)(j.RiArrowDownSLine,{className:(0,g.cn)("ml-0.5 h-4 w-4 shrink-0 text-text-quaternary group-hover:text-text-secondary",s&&"text-text-secondary")})]})},w=s.memo(e=>{let{value:l,scope:n,disabled:o,placement:i="bottom",offset:d=4,onSelect:c}=e,{t:p}=(0,a.useTranslation)(),[m,x]=(0,s.useState)(!1),[h,y]=(0,s.useState)(""),[g,f]=(0,s.useState)(!1),{data:j,isLoading:w,isFetchingNextPage:T,fetchNextPage:C,hasNextPage:_}=(0,u.useInfiniteAppList)({page:1,limit:20,name:h}),k=(0,s.useMemo)(()=>{let e=j?.pages??[];return e.length?e.flatMap(e=>{let{data:t}=e;return t}):[]},[j?.pages]),{data:S}=(0,u.useAppDetail)(l?.app_id||""),P=(0,s.useMemo)(()=>{if(l?.app_id)return S||k.find(e=>e.id===l.app_id)},[l?.app_id,S,k]),E=(0,s.useMemo)(()=>{if(!P)return k;let e=k.findIndex(e=>e.id===P.id);if(-1===e)return[P,...k];let t=[...k];return t[e]=P,t},[P,k]),F=_??!0,M=(0,s.useCallback)(async()=>{if(!g&&!T&&F){f(!0);try{await C()}finally{setTimeout(()=>{f(!1)},300)}}},[g,T,F,C]),[I,A]=(0,s.useState)(!1),V=(0,s.useMemo)(()=>({app_id:l?.app_id||"",inputs:{...l?.inputs,...l?.files?.length?{"#image#":l.files[0]}:{}}}),[l]);return(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(r.PortalToFollowElem,{placement:i,offset:d,open:m,onOpenChange:x,children:[(0,t.jsx)(r.PortalToFollowElemTrigger,{className:"w-full",onClick:()=>{o||x(!0)},children:(0,t.jsx)(N,{open:m,appDetail:P})}),(0,t.jsx)(r.PortalToFollowElemContent,{className:"z-[1000]",children:(0,t.jsxs)("div",{className:"relative min-h-20 w-[389px] rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur shadow-lg backdrop-blur-sm",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1 px-4 py-3",children:[(0,t.jsx)("div",{className:"system-sm-semibold flex h-6 items-center text-text-secondary",children:p("appSelector.label",{ns:"app"})}),(0,t.jsx)(b,{placement:"bottom",offset:d,trigger:(0,t.jsx)(N,{open:I,appDetail:P}),isShow:I,onShowChange:A,disabled:!1,onSelect:e=>{let t=e.id!==l?.app_id;c({app_id:e.id,inputs:t?{}:l?.inputs||{},files:t?[]:l?.files||[]}),A(!1)},scope:n||"all",apps:E,isLoading:w||g||T,hasMore:F,onLoadMore:M,searchText:h,onSearchChange:y})]}),P&&(0,t.jsx)(v,{value:V,appDetail:P,onFormChange:e=>{let t=e["#image#"];delete e["#image#"],c({app_id:l?.app_id||"",inputs:e,files:t?[t]:l?.files||[]})}})]})})]})})});e.s(["default",0,w],282700);var T=e.i(137667),C=e.i(739255),_=e.i(225162),k=e.i(151094),S=e.i(745754),P=e.i(944911),E=e.i(157644);let F=e=>{let{className:r,uniqueIdentifier:l,extraIdentifiers:n=[],onSuccess:o,...i}=e,{t:d}=(0,a.useTranslation)(),c=Array.from(new Set([l,...n].filter(e=>!!e))),p=(0,E.useCheckInstalled)({pluginIds:c,enabled:c.length>0}),m=(0,E.useInstallPackageFromMarketPlace)(),[u,x]=(0,s.useState)(!1),h=p.isLoading||m.isPending||u;if(!p.data)return null;let y=new Set(c);return p.data.plugins.some(e=>y.has(e.id)||e.plugin_unique_identifier&&y.has(e.plugin_unique_identifier)||e.plugin_id&&y.has(e.plugin_id))?null:(0,t.jsxs)(k.default,{variant:"secondary",disabled:h,...i,onClick:e=>{e.stopPropagation(),h||(x(!0),m.mutate(l,{onSuccess:async e=>{let t=async()=>{await p.refetch(),o?.(),x(!1),m.reset()};if(!e||e.all_installed)return void await t();let{check:s}=(0,S.default)();try{let{status:a}=await s({taskId:e.task_id,pluginUniqueIdentifier:l});if(a===P.TaskStatus.failed){x(!1),m.reset();return}await t()}catch{x(!1),m.reset()}},onError:()=>{x(!1),m.reset()}}))},className:(0,g.cn)("flex items-center",r),children:[d(h?"nodes.agent.pluginInstaller.installing":"nodes.agent.pluginInstaller.install",{ns:"workflow"}),h?(0,t.jsx)(j.RiLoader2Line,{className:"ml-1 size-3.5 animate-spin"}):(0,t.jsx)(j.RiInstallLine,{className:"ml-1 size-3.5"})]})};e.s(["InstallPluginButton",0,F],958865);var M=e.i(56971),I=e.i(722591);let A=e=>{let{modelProvider:s,handleOpenModal:r}=e,{t:l}=(0,a.useTranslation)();return(0,t.jsxs)(k.default,{size:"small",className:"z-[100]",onClick:e=>{e.stopPropagation(),r(s,C.ConfigurationMethodEnum.predefinedModel,void 0)},children:[(0,t.jsx)("div",{className:"flex items-center justify-center gap-1 px-[3px]",children:l("nodes.agent.notAuthorized",{ns:"workflow"})}),(0,t.jsx)("div",{className:"flex h-[14px] w-[14px] items-center justify-center",children:(0,t.jsx)("div",{className:"h-2 w-2 shrink-0 rounded-[3px] border border-components-badge-status-light-warning-border-inner bg-components-badge-status-light-warning-bg shadow-components-badge-status-light-warning-halo"})})]})};var V=e.i(540284);let L=e=>{let{currentModel:s,modelId:a}=e;return s?(0,t.jsx)(V.default,{className:"flex grow items-center gap-1 px-1 py-[3px]",modelItem:s,showMode:!0,showFeatures:!0}):(0,t.jsx)("div",{className:"flex grow items-center gap-1 truncate px-1 py-[3px] opacity-50",children:(0,t.jsx)("div",{className:"system-sm-regular overflow-hidden text-ellipsis text-components-input-text-filled",children:a})})};var q=e.i(554327),R=e.i(421001),O=e.i(417944),U=e.i(83278),z=e.i(500536),$=e.i(222573),D=e.i(228403),B=e.i(21151),W=e.i(365181);let H=e=>{let{plugin:s,onCancel:a,mutation:r,confirmButtonText:l,cancelButtonText:n,modelTitle:o,description:i,cardTitleLeft:d,mutate:c,modalBottomLeft:p}=e;return(0,t.jsxs)(B.default,{isShow:!0,onClose:a,className:"min-w-[560px]",closable:!0,title:o,children:[(0,t.jsx)("div",{className:"system-md-regular mb-2 mt-3 text-text-secondary",children:i}),(0,t.jsx)("div",{className:"flex flex-wrap content-start items-start gap-1 self-stretch rounded-2xl bg-background-section-burn p-2",children:(0,t.jsx)(W.default,{installed:r.isSuccess,payload:s,className:"w-full",titleLeft:d})}),(0,t.jsxs)("div",{className:"flex items-center gap-2 self-stretch pt-5",children:[(0,t.jsx)("div",{children:p}),(0,t.jsxs)("div",{className:"ml-auto flex gap-2",children:[!r.isPending&&(0,t.jsx)(k.default,{onClick:a,children:n}),(0,t.jsx)(k.default,{variant:"primary",loading:r.isPending,onClick:c,disabled:r.isPending,children:l})]})]})]})};H.displayName="PluginMutationModal";let K=(0,s.memo)(H);var G=e.i(425667),J=e.i(168014);let Q=e=>{let{uniqueIdentifier:r,tooltip:l,onChange:n,className:o}=e,[i]=r?.split(":")||[""],[d,c]=(0,s.useState)(!1),[p,{setTrue:m,setFalse:u}]=(0,O.useBoolean)(!1),[x,h]=(0,s.useState)(),y=(0,E.useCheckInstalled)({pluginIds:[i],enabled:!0}),v=y.data?.plugins.at(0),f=(0,s.useCallback)(()=>{u(),y.refetch(),n?.(x.version)},[u,n,y,x]),{getIconUrl:b}=(0,$.default)(),N=v?.declaration.icon?b(v.declaration.icon):void 0,w=(0,E.useUpdatePackageFromMarketPlace)(),{t:T}=(0,a.useTranslation)();return r&&i?(0,t.jsx)(R.default,{popupContent:!d&&!p&&l,triggerMethod:"hover",children:(0,t.jsxs)("div",{className:(0,g.cn)("flex w-fit items-center justify-center",o),onClick:e=>e.stopPropagation(),children:[p&&v&&(0,t.jsx)(K,{onCancel:u,plugin:(0,D.pluginManifestToCardPluginProps)({...v.declaration,icon:N}),mutation:w,mutate:()=>{w.mutate({new_plugin_unique_identifier:x.pluginUniqueIden,original_plugin_unique_identifier:r},{onSuccess(){f()}})},confirmButtonText:T("nodes.agent.installPlugin.install",{ns:"workflow"}),cancelButtonText:T("nodes.agent.installPlugin.cancel",{ns:"workflow"}),modelTitle:T("nodes.agent.installPlugin.title",{ns:"workflow"}),description:T("nodes.agent.installPlugin.desc",{ns:"workflow"}),cardTitleLeft:(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(z.Badge,{className:"mx-1",size:"s",state:z.BadgeState.Warning,children:`${v.version} -> ${x.version}`})}),modalBottomLeft:(0,t.jsxs)(q.default,{className:"flex items-center justify-center gap-1",href:(0,J.getMarketplaceUrl)(`/plugins/${v.declaration.author}/${v.declaration.name}`),target:"_blank",children:[(0,t.jsx)("span",{className:"system-xs-regular text-xs text-text-accent",children:T("nodes.agent.installPlugin.changelog",{ns:"workflow"})}),(0,t.jsx)(j.RiExternalLinkLine,{className:"size-3 text-text-accent"})]})}),v&&(0,t.jsx)(G.default,{isShow:d,onShowChange:c,pluginID:i,currentVersion:v.version,onSelect:e=>{h({pluginUniqueIden:e.unique_identifier,version:e.version}),m()},trigger:(0,t.jsx)(U.default,{className:(0,g.cn)("mx-1 flex hover:bg-state-base-hover",d&&"bg-state-base-hover"),uppercase:!0,text:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{children:v.version}),(0,t.jsx)(j.RiArrowLeftRightLine,{className:"ml-1 h-3 w-3 text-text-tertiary"})]}),hasRedCornerMark:!0})})]})}):null};e.s(["SwitchPluginVersion",0,Q],350988);let X=e=>{let{needsConfiguration:s,modelProvider:a,inModelList:r,disabled:l,pluginInfo:n,t:o}=e,{data:i}=(0,E.useInstalledPluginList)(),d=(e,s,a,r)=>(0,t.jsxs)("div",{className:"flex w-[240px] max-w-[240px] flex-col gap-1 px-1 py-1.5",onClick:e=>e.stopPropagation(),children:[(0,t.jsx)("div",{className:"title-xs-semi-bold text-text-primary",children:e}),s&&(0,t.jsx)("div",{className:"body-xs-regular min-w-[200px] text-text-secondary",children:s}),a&&r&&(0,t.jsx)("div",{className:"body-xs-regular z-[100] cursor-pointer text-text-accent",children:(0,t.jsx)(q.default,{href:r,onClick:e=>{e.stopPropagation()},children:a})})]});return(0,t.jsxs)(t.Fragment,{children:[!s&&a&&l&&(0,t.jsx)(t.Fragment,{children:r?(0,t.jsx)(R.default,{popupContent:o("nodes.agent.modelSelectorTooltips.deprecated",{ns:"workflow"}),asChild:!1,needsDelay:!1,children:(0,t.jsx)(j.RiErrorWarningFill,{className:"h-4 w-4 text-text-destructive"})}):n?(0,t.jsx)(Q,{tooltip:d(o("nodes.agent.modelNotSupport.title",{ns:"workflow"}),o("nodes.agent.modelNotSupport.descForVersionSwitch",{ns:"workflow"})),uniqueIdentifier:i?.plugins.find(e=>e.name===n.name)?.plugin_unique_identifier??""}):(0,t.jsx)(R.default,{popupContent:d(o("nodes.agent.modelNotSupport.title",{ns:"workflow"}),o("nodes.agent.modelNotSupport.desc",{ns:"workflow"}),o("nodes.agent.linkToPlugin",{ns:"workflow"}),"/plugins"),asChild:!1,children:(0,t.jsx)(j.RiErrorWarningFill,{className:"h-4 w-4 text-text-destructive"})})}),!a&&!n&&(0,t.jsx)(R.default,{popupContent:d(o("nodes.agent.modelNotInMarketplace.title",{ns:"workflow"}),o("nodes.agent.modelNotInMarketplace.desc",{ns:"workflow"}),o("nodes.agent.linkToPlugin",{ns:"workflow"}),"/plugins"),asChild:!1,children:(0,t.jsx)(j.RiErrorWarningFill,{className:"h-4 w-4 text-text-destructive"})})]})},Y=e=>{let{disabled:r,currentProvider:n,currentModel:o,providerName:i,modelId:d,hasDeprecated:c,scope:p}=e,{t:m}=(0,a.useTranslation)(),{modelProviders:u}=(0,M.useProviderContext)(),x=(0,_.useUpdateModelProviders)(),h=(0,_.useUpdateModelList)(),{modelProvider:y,needsConfiguration:v}=(0,s.useMemo)(()=>{let e=u.find(e=>e.provider===i),t=e?.custom_configuration.status===C.CustomConfigurationStatusEnum.noConfigure&&!(!0===e.system_configuration.enabled&&e.system_configuration.quota_configurations.find(t=>t.quota_type===e.system_configuration.current_quota_type));return{modelProvider:e,needsConfiguration:t}},[u,i]),[f,b]=(0,s.useState)(!1),N=(0,E.useInvalidateInstalledPluginList)(),w=(0,_.useModelModalHandler)(),{data:T=!1}=(0,E.useModelInList)(n,d),{data:k,isLoading:S}=(0,E.usePluginInfo)(i);return d&&S?(0,t.jsx)(l.default,{}):(0,t.jsx)("div",{className:(0,g.cn)("group relative flex grow cursor-pointer items-center gap-[2px] rounded-lg bg-components-input-bg-normal p-1 hover:bg-state-base-hover-alt"),children:d?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(I.default,{className:"p-0.5",provider:n||y,modelName:o?.model||d,isDeprecated:c}),(0,t.jsx)(L,{currentModel:o,modelId:d}),v&&(0,t.jsx)(A,{modelProvider:y,handleOpenModal:w}),(0,t.jsx)(X,{needsConfiguration:v,modelProvider:!!y,inModelList:T,disabled:!!r,pluginInfo:k,t:m}),!f&&!y&&k&&(0,t.jsx)(F,{onClick:e=>e.stopPropagation(),size:"small",uniqueIdentifier:k.latest_package_identifier,onSuccess:()=>{[C.ModelTypeEnum.textGeneration,C.ModelTypeEnum.textEmbedding,C.ModelTypeEnum.rerank,C.ModelTypeEnum.moderation,C.ModelTypeEnum.speech2text,C.ModelTypeEnum.tts].forEach(e=>{p?.includes(e)&&h(e)}),x(),N(),b(!0)}}),y&&!r&&!v&&(0,t.jsx)("div",{className:"flex items-center pr-1",children:(0,t.jsx)(j.RiEqualizer2Line,{className:"h-4 w-4 text-text-tertiary group-hover:text-text-secondary"})})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"flex grow items-center gap-1 p-1 pl-2",children:(0,t.jsx)("span",{className:"system-sm-regular overflow-hidden text-ellipsis whitespace-nowrap text-components-input-text-placeholder",children:m("nodes.agent.configureModel",{ns:"workflow"})})}),(0,t.jsx)("div",{className:"flex items-center pr-1",children:(0,t.jsx)(j.RiEqualizer2Line,{className:"h-4 w-4 text-text-tertiary group-hover:text-text-secondary"})})]})})};var Z=e.i(653488),ee=e.i(117960);let et=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e||0===Object.keys(e).length)return{params:{},removedDetails:{}};let a={};t.forEach(e=>{a[e.name]=e});let r={},l={};return Object.entries(e).forEach(e=>{let[t,n]=e;if("stop"===t&&s){r[t]=n;return}let o=a[t];if(!o){l[t]="unsupported";return}switch(o.type){case"int":case"float":{if("number"!=typeof n){l[t]="invalid type";return}let e=o.min??-1/0,s=o.max??1/0;if(n<e||n>s){l[t]=`out of range (${e}-${s})`;return}r[t]=n;return}case"boolean":if("boolean"!=typeof n){l[t]="invalid type";return}r[t]=n;return;case"string":case"text":if("string"!=typeof n){l[t]="invalid type";return}if(Array.isArray(o.options)&&o.options.length&&!o.options.includes(n)){l[t]="unsupported option";return}r[t]=n;return;default:l[t]=`unsupported rule type: ${o?.type??"unknown"}`}}),{params:r,removedDetails:l}},es=async function(t,s,a){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],{fetchModelParameterRules:l}=await e.A(170830),n=`/workspaces/current/model-providers/${t}/models/parameter-rules?model=${s}`,{data:o}=await l(n);return et(a,o??[],r)};e.s(["fetchAndMergeValidCompletionParams",0,es],495620);var ea=e.i(92881),er=e.i(206741),el=e.i(925521);let en=e=>{let{isAdvancedMode:r,provider:n,modelId:o,completionParams:i,onCompletionParamsChange:d}=e,{t:c}=(0,a.useTranslation)(),{data:p,isPending:m}=(0,x.useModelParameterRules)(n,o),u=(0,s.useMemo)(()=>p?.data||[],[p]);return m?(0,t.jsx)("div",{className:"mt-5",children:(0,t.jsx)(l.default,{})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,t.jsx)("div",{className:(0,g.cn)("system-sm-semibold flex h-6 items-center text-text-secondary"),children:c("modelProvider.parameters",{ns:"common"})}),el.PROVIDER_WITH_PRESET_TONE.includes(n)&&(0,t.jsx)(er.default,{onSelect:e=>{let t=el.TONE_LIST.find(t=>t.id===e);t&&d({...i,...t.config})}})]}),!!u.length&&[...u,...r?[el.STOP_PARAMETER_RULE]:[]].map(e=>(0,t.jsx)(ea.default,{parameterRule:e,value:i?.[e.name],onChange:t=>{var s;return s=e.name,void d({...i,[s]:t})},onSwitch:(t,s)=>((e,t,s)=>{if(!t){let t={...i};delete t[e],d(t)}t&&d({...i,[e]:s})})(e.name,t,s),isInWorkflow:!0},`${o}-${e.name}`))]})};var eo=e.i(491234);let ei=e=>{let{currentModel:r,language:l,voice:n,onChange:o}=e,{t:i}=(0,a.useTranslation)(),c=(0,s.useMemo)(()=>r?r.model_properties.voices.map(e=>({...e,value:e.mode})):[],[r]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("div",{className:"system-sm-semibold mb-1 flex items-center py-1 text-text-secondary",children:i("voice.voiceSettings.language",{ns:"appDebug"})}),(0,t.jsx)(d.PortalSelect,{triggerClassName:"h-8",popupClassName:(0,g.cn)("z-[1000]"),popupInnerClassName:(0,g.cn)("w-[354px]"),value:l,items:eo.languages.filter(e=>e.supported),onSelect:e=>{o(e.value,n)}})]}),(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("div",{className:"system-sm-semibold mb-1 flex items-center py-1 text-text-secondary",children:i("voice.voiceSettings.voice",{ns:"appDebug"})}),(0,t.jsx)(d.PortalSelect,{triggerClassName:"h-8",popupClassName:(0,g.cn)("z-[1000]"),popupInnerClassName:(0,g.cn)("w-[354px]"),value:n,items:c,onSelect:e=>{o(l,e.value)}})]})]})},ed=e=>{let{popupClassName:l,portalToFollowElemContentClassName:n,isAdvancedMode:o,value:i,setModel:d,renderTrigger:c,readonly:p,isInWorkflow:m,isAgentStrategy:u,scope:x=C.ModelTypeEnum.textGeneration}=e,{t:h}=(0,a.useTranslation)(),{isAPIKeySet:y}=(0,M.useProviderContext)(),[v,f]=(0,s.useState)(!1),b=x.split("&"),j=(0,s.useMemo)(()=>b.includes("all")?[]:b.filter(e=>![C.ModelTypeEnum.textGeneration,C.ModelTypeEnum.textEmbedding,C.ModelTypeEnum.rerank,C.ModelTypeEnum.moderation,C.ModelTypeEnum.speech2text,C.ModelTypeEnum.tts].includes(e)).map(e=>e),[b]),{data:N}=(0,_.useModelList)(C.ModelTypeEnum.textGeneration),{data:w}=(0,_.useModelList)(C.ModelTypeEnum.textEmbedding),{data:k}=(0,_.useModelList)(C.ModelTypeEnum.rerank),{data:S}=(0,_.useModelList)(C.ModelTypeEnum.moderation),{data:P}=(0,_.useModelList)(C.ModelTypeEnum.speech2text),{data:E}=(0,_.useModelList)(C.ModelTypeEnum.tts),F=(0,s.useMemo)(()=>b.includes("all")?[...N,...w,...k,...P,...E,...S]:b.includes(C.ModelTypeEnum.textGeneration)?N:b.includes(C.ModelTypeEnum.textEmbedding)?w:b.includes(C.ModelTypeEnum.rerank)?k:b.includes(C.ModelTypeEnum.moderation)?S:b.includes(C.ModelTypeEnum.speech2text)?P:b.includes(C.ModelTypeEnum.tts)?E:[],[b,N,w,k,P,E,S]),{currentProvider:I,currentModel:A}=(0,s.useMemo)(()=>{let e=F.find(e=>e.provider===i?.provider),t=e?.models.find(e=>e.model===i?.model);return{currentProvider:e,currentModel:t}},[F,i?.provider,i?.model]),V=(0,s.useMemo)(()=>!I||!A,[A,I]),L=(0,s.useMemo)(()=>A?.status!==C.ModelStatusEnum.active,[A?.status]),q=(0,s.useMemo)(()=>!y||V||L,[V,y,L]),R=async e=>{let{provider:t,model:s}=e,a=F.find(e=>e.provider===t),r=a?.models.find(e=>e.model===s),l=r?.model_type,n={};if(l===C.ModelTypeEnum.textGeneration)try{let{params:e,removedDetails:a}=await es(t,s,i?.completion_params,o);n=e;let r=Object.keys(a||{});r.length&&T.default.notify({type:"warning",message:`${h("modelProvider.parametersInvalidRemoved",{ns:"common"})}: ${r.map(e=>`${e} (${a[e]})`).join(", ")}`})}catch{T.default.notify({type:"error",message:h("error",{ns:"common"})})}d({provider:t,model:s,model_type:l,...l===C.ModelTypeEnum.textGeneration?{mode:r?.model_properties.mode,completion_params:n}:{}})};return(0,t.jsx)(r.PortalToFollowElem,{open:v,onOpenChange:f,placement:m?"left":"bottom-end",offset:4,children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(r.PortalToFollowElemTrigger,{onClick:()=>{p||f(e=>!e)},className:"block",children:c?c({open:v,disabled:q,modelDisabled:L,hasDeprecated:V,currentProvider:I,currentModel:A,providerName:i?.provider,modelId:i?.model}):u?(0,t.jsx)(Y,{disabled:q,hasDeprecated:V,currentProvider:I,currentModel:A,providerName:i?.provider,modelId:i?.model,scope:x}):(0,t.jsx)(Z.default,{disabled:q,isInWorkflow:m,modelDisabled:L,hasDeprecated:V,currentProvider:I,currentModel:A,providerName:i?.provider,modelId:i?.model})}),(0,t.jsx)(r.PortalToFollowElemContent,{className:(0,g.cn)("z-50",n),children:(0,t.jsx)("div",{className:(0,g.cn)(l,"w-[389px] rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-lg"),children:(0,t.jsxs)("div",{className:(0,g.cn)("max-h-[420px] overflow-y-auto p-4 pt-3"),children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:(0,g.cn)("system-sm-semibold mb-1 flex h-6 items-center text-text-secondary"),children:h("modelProvider.model",{ns:"common"}).toLocaleUpperCase()}),(0,t.jsx)(ee.default,{defaultModel:i?.provider||i?.model?{provider:i?.provider,model:i?.model}:void 0,modelList:F,scopeFeatures:j,onSelect:R})]}),(A?.model_type===C.ModelTypeEnum.textGeneration||A?.model_type===C.ModelTypeEnum.tts)&&(0,t.jsx)("div",{className:"my-3 h-px bg-divider-subtle"}),A?.model_type===C.ModelTypeEnum.textGeneration&&(0,t.jsx)(en,{provider:i?.provider,modelId:i?.model,completionParams:i?.completion_params||{},onCompletionParamsChange:e=>{let t={...i?.completionParams,completion_params:e};d({...i,...t})},isAdvancedMode:o}),A?.model_type===C.ModelTypeEnum.tts&&(0,t.jsx)(ei,{currentModel:A,language:i?.language,voice:i?.voice,onChange:(e,t)=>{d({...i,language:e,voice:t})}})]})})})]})})};e.s(["default",0,ed],464727);var ec=e.i(105845),ep=e.i(260484),em=e.i(481162);let eu=e=>{let{value:s,onChange:a}=e;return(0,t.jsxs)("div",{className:"flex w-full space-x-1",children:[(0,t.jsx)("div",{className:(0,g.cn)("system-sm-regular flex h-8 grow cursor-default items-center justify-center rounded-md border border-components-option-card-option-border bg-components-option-card-option-bg px-2 text-text-secondary",!s&&"cursor-pointer hover:border-components-option-card-option-border-hover hover:bg-components-option-card-option-bg-hover hover:shadow-xs",s&&"system-sm-medium border-[1.5px] border-components-option-card-option-selected-border bg-components-option-card-option-selected-bg shadow-xs"),onClick:()=>a(!0),children:"True"}),(0,t.jsx)("div",{className:(0,g.cn)("system-sm-regular flex h-8 grow cursor-default items-center justify-center rounded-md border border-components-option-card-option-border bg-components-option-card-option-bg px-2 text-text-secondary",s&&"cursor-pointer hover:border-components-option-card-option-border-hover hover:bg-components-option-card-option-bg-hover hover:shadow-xs",!s&&"system-sm-medium border-[1.5px] border-components-option-card-option-selected-border bg-components-option-card-option-selected-bg shadow-xs"),onClick:()=>a(!1),children:"False"})]})};e.s(["default",0,eu],734186),e.i(39598);var ex=e.i(678383);e.i(187243);var eh=e.i(989425);let ey=e=>{let{value:s,onChange:r}=e,{t:l}=(0,a.useTranslation)();return(0,t.jsxs)("div",{className:"inline-flex h-8 shrink-0 gap-px rounded-[10px] bg-components-segmented-control-bg-normal p-0.5",children:[(0,t.jsx)(R.default,{popupContent:s===eh.VarType.variable?"":l("nodes.common.typeSwitch.variable",{ns:"workflow"}),children:(0,t.jsx)("div",{className:(0,g.cn)("cursor-pointer rounded-lg px-2.5 py-1.5 text-text-tertiary hover:bg-state-base-hover",s===eh.VarType.variable&&"bg-components-segmented-control-item-active-bg text-text-secondary shadow-xs hover:bg-components-segmented-control-item-active-bg"),onClick:()=>r(eh.VarType.variable),children:(0,t.jsx)(ex.Variable02,{className:"h-4 w-4"})})}),(0,t.jsx)(R.default,{popupContent:s===eh.VarType.constant?"":l("nodes.common.typeSwitch.input",{ns:"workflow"}),children:(0,t.jsx)("div",{className:(0,g.cn)("cursor-pointer rounded-lg px-2.5 py-1.5 text-text-tertiary hover:bg-state-base-hover",s===eh.VarType.constant&&"bg-components-segmented-control-item-active-bg text-text-secondary shadow-xs hover:bg-components-segmented-control-item-active-bg"),onClick:()=>r(eh.VarType.constant),children:(0,t.jsx)(j.RiEditLine,{className:"h-4 w-4"})})})]})};e.s(["default",0,ey],508844);var eg=e.i(22461),ev=e.i(955371),ef=e.i(758911);e.i(275225);var eb=e.i(705405),ej=e.i(558544),eN=e.i(717522),ew=e.i(43121);let eT=e=>{let{disableVariableInsertion:r=!1}=e,{t:l}=(0,a.useTranslation)(),[n]=(0,ej.useLexicalComposerContext)(),o=(0,s.useCallback)(e=>{n.update(()=>{let t=new ew.CustomTextNode(e);(0,eN.$insertNodes)([t])}),n.dispatchCommand(eN.FOCUS_COMMAND,void 0)},[n]);return(0,t.jsxs)("div",{className:"pointer-events-auto flex h-full w-full cursor-text items-center px-2",onClick:e=>{e.stopPropagation(),o("")},children:[(0,t.jsxs)("div",{className:"flex grow items-center",children:[l("nodes.tool.insertPlaceholder1",{ns:"workflow"}),!r&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"system-kbd mx-0.5 flex h-4 w-4 items-center justify-center rounded bg-components-kbd-bg-gray text-text-placeholder",children:"/"}),(0,t.jsx)("div",{className:"system-sm-regular cursor-pointer text-components-input-text-placeholder underline decoration-dotted decoration-auto underline-offset-auto hover:text-text-tertiary",onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),o("/")},children:l("nodes.tool.insertPlaceholder2",{ns:"workflow"})})]})]}),(0,t.jsx)(U.default,{className:"shrink-0",text:"String",uppercase:!1})]})},eC=(0,s.memo)(e=>{let{readOnly:s=!1,nodesOutputVars:r,availableNodes:l=[],value:n="",onChange:o,showManageInputField:i,onManageInputField:d,disableVariableInsertion:c=!1}=e,{t:m}=(0,a.useTranslation)(),u=(0,eb.useStore)(e=>e.controlPromptEditorRerenderKey);return(0,t.jsx)(ef.default,{wrapperClassName:(0,g.cn)("min-h-8 w-full rounded-lg border border-transparent bg-components-input-bg-normal px-2 py-1","hover:border-components-input-border-hover hover:bg-components-input-bg-hover","focus-within:border-components-input-border-active focus-within:bg-components-input-bg-active focus-within:shadow-xs"),className:"caret:text-text-accent",editable:!s,value:n,workflowVariableBlock:{show:!c,variables:r||[],workflowNodesMap:l.reduce((e,t)=>(e[t.id]={title:t.data.title,type:t.data.type},t.data.type===p.BlockEnum.Start&&(e.sys={title:m("blocks.start",{ns:"workflow"}),type:p.BlockEnum.Start}),e),{}),showManageInputField:i,onManageInputField:d},placeholder:(0,t.jsx)(eT,{disableVariableInsertion:c}),onChange:o},u)});e.s(["default",0,eC],899713);var e_=e.i(124836),ek=e.i(669744),eS=e.i(858314);e.s(["MittProvider",()=>eq,"VisualEditorContext",()=>eA,"VisualEditorContextProvider",()=>eV,"useMittContext",()=>eR],207826);var eP=e.i(598898);e.s(["createVisualEditorStore",()=>eM,"useVisualEditorStore",()=>eI],288716);var eE=e.i(763989),eF=e.i(639751);let eM=()=>(0,eE.createStore)(e=>({hoveringProperty:null,setHoveringProperty:t=>e({hoveringProperty:t}),isAddingNewField:!1,setIsAddingNewField:t=>e({isAddingNewField:t}),advancedEditing:!1,setAdvancedEditing:t=>e({advancedEditing:t}),backupSchema:null,setBackupSchema:t=>e({backupSchema:t})})),eI=e=>{let t=(0,s.useContext)(eA);if(!t)throw Error("Missing VisualEditorContext.Provider in the tree");return(0,eF.useStore)(t,e)},eA=(0,s.createContext)(null),eV=e=>{let{children:a}=e,r=(0,s.useRef)(null);return r.current||(r.current=eM()),(0,t.jsx)(eA.Provider,{value:r.current,children:a})},eL=(0,s.createContext)({emit:e_.noop,useSubscribe:e_.noop}),eq=e=>{let{children:s}=e,a=(0,eP.useMitt)();return(0,t.jsx)(eL.Provider,{value:a,children:s})},eR=()=>(0,s.useContext)(eL);var eO=e.i(38532),eU=e.i(757198);let ez=s.memo(()=>{let{t:e}=(0,a.useTranslation)(),r=eI(e=>e.setIsAddingNewField),{emit:l}=eR(),n=(0,s.useCallback)(()=>{r(!0),setTimeout(()=>{l("addField",{path:[]})},100)},[r,l]);return(0,t.jsx)("div",{className:"py-2 pl-5",children:(0,t.jsxs)(k.default,{size:"small",variant:"secondary-accent",className:"flex items-center gap-x-[1px]",onClick:n,children:[(0,t.jsx)(j.RiAddCircleFill,{className:"h-3.5 w-3.5"}),(0,t.jsx)("span",{className:"px-[3px]",children:e("nodes.llm.jsonSchema.addField",{ns:"workflow"})})]})})}),e$=s.memo(e=>{let{name:s,type:r,required:l,description:n}=e,{t:o}=(0,a.useTranslation)();return(0,t.jsxs)("div",{className:"flex flex-col py-0.5",children:[(0,t.jsxs)("div",{className:"flex h-6 items-center gap-x-1 pl-1 pr-0.5",children:[(0,t.jsx)("div",{className:"system-sm-semibold truncate border border-transparent px-1 py-px text-text-primary",children:s}),(0,t.jsx)("div",{className:"system-xs-medium px-1 py-0.5 text-text-tertiary",children:r}),l&&(0,t.jsx)("div",{className:"system-2xs-medium-uppercase px-1 py-0.5 text-text-warning",children:o("nodes.llm.jsonSchema.required",{ns:"workflow"})})]}),n&&(0,t.jsx)("div",{className:"system-xs-regular truncate px-2 pb-1 text-text-tertiary",children:n})]})});var eD=e.i(59848);let eB=s.memo(e=>{let{disableAddBtn:s,onAddChildField:r,onEdit:l,onDelete:n}=e,{t:o}=(0,a.useTranslation)();return(0,t.jsxs)("div",{className:"flex items-center gap-x-0.5",children:[(0,t.jsx)(R.default,{popupContent:o("nodes.llm.jsonSchema.addChildField",{ns:"workflow"}),children:(0,t.jsx)("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded-md text-text-tertiary hover:bg-state-base-hover hover:text-text-secondary disabled:cursor-not-allowed disabled:text-text-disabled",onClick:r,disabled:s,children:(0,t.jsx)(j.RiAddCircleLine,{className:"h-4 w-4"})})}),(0,t.jsx)(R.default,{popupContent:o("operation.edit",{ns:"common"}),children:(0,t.jsx)("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded-md text-text-tertiary hover:bg-state-base-hover hover:text-text-secondary",onClick:l,children:(0,t.jsx)(j.RiEditLine,{className:"h-4 w-4"})})}),(0,t.jsx)(R.default,{popupContent:o("operation.remove",{ns:"common"}),children:(0,t.jsx)("button",{type:"button",className:"flex h-6 w-6 items-center justify-center rounded-md text-text-tertiary hover:bg-state-destructive-hover hover:text-text-destructive",onClick:n,children:(0,t.jsx)(j.RiDeleteBinLine,{className:"h-4 w-4"})})})]})});var eW=e.i(250755),eH=e.i(194902);e.i(905691);var eK=e.i(706416);let eG=s.memo(e=>{let{isConfirmDisabled:s,onCancel:r,onConfirm:l}=e,{t:n}=(0,a.useTranslation)();return(0,eW.useKeyPress)([`${(0,eK.getKeyboardKeyCodeBySystem)("ctrl")}.enter`],e=>{e.preventDefault(),l()},{exactMatch:!0,useCapture:!0}),(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,t.jsx)(k.default,{size:"small",variant:"secondary",onClick:r,children:n("operation.cancel",{ns:"common"})}),(0,t.jsxs)(k.default,{className:"flex items-center gap-x-1",disabled:s,size:"small",variant:"primary",onClick:l,children:[(0,t.jsx)("span",{children:n("operation.confirm",{ns:"common"})}),(0,t.jsx)(eH.default,{keys:["ctrl","âŽ"],bgColor:"white"})]})]})}),eJ=s.memo(e=>{let{onChange:r,options:l}=e,{t:n}=(0,a.useTranslation)(),[o,i]=(0,s.useState)(l.enum),d=(0,s.useCallback)(e=>{i(e.target.value)},[]),p=(0,s.useCallback)(e=>{r({enum:e.target.value})},[r]);return(0,t.jsx)("div",{className:"border-t border-divider-subtle",children:(0,t.jsxs)("div",{className:"flex flex-col gap-y-1 px-2 py-1.5",children:[(0,t.jsxs)("div",{className:"flex w-full items-center gap-x-2",children:[(0,t.jsx)("span",{className:"system-2xs-medium-uppercase text-text-tertiary",children:n("nodes.llm.jsonSchema.stringValidations",{ns:"workflow"})}),(0,t.jsx)("div",{className:"grow",children:(0,t.jsx)(eU.default,{type:"horizontal",className:"my-0 h-px bg-line-divider-bg"})})]}),(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("div",{className:"system-xs-medium flex h-6 items-center text-text-secondary",children:"Enum"}),(0,t.jsx)(c.default,{size:"small",className:"min-h-6",value:o,onChange:d,onBlur:p,placeholder:"abcd, 1, 1.5, etc."})]})]})})}),eQ=s.memo(e=>{let{value:a,placeholder:r,onChange:l,onBlur:n,minWidth:o=60,maxWidth:i=300,className:d,...c}=e,[p,m]=(0,s.useState)(o),u=s.useRef(null);return(0,s.useEffect)(()=>{if(u.current){u.current.textContent=a||r;let e=Math.max(o,Math.min(u.current.offsetWidth+16,i));p!==e&&m(e)}},[a,r,o,i,p]),(0,t.jsxs)("div",{className:"relative inline-flex items-center",children:[(0,t.jsx)("span",{ref:u,className:"system-sm-semibold invisible absolute left-0 top-0 -z-10 whitespace-pre px-1","aria-hidden":"true",children:a||r}),(0,t.jsx)("input",{value:a,className:(0,g.cn)("system-sm-semibold placeholder:system-sm-semibold h-5 rounded-[5px] border border-transparent px-1","py-px text-text-primary caret-[#295EFF] shadow-shadow-shadow-3 outline-none","placeholder:text-text-placeholder hover:bg-state-base-hover focus:border-components-input-border-active focus:bg-components-input-bg-active focus:shadow-xs",d),style:{width:`${p}px`,minWidth:`${o}px`,maxWidth:`${i}px`,transition:"width 100ms ease-out"},placeholder:r,onChange:l,onBlur:n,onKeyUp:e=>{"Enter"===e.key&&e.currentTarget.blur&&e.currentTarget.blur(),c.onKeyUp&&c.onKeyUp(e)},...c})]})}),eX=s.memo(e=>{let{defaultValue:s,toggleRequired:r}=e,{t:l}=(0,a.useTranslation)();return(0,t.jsxs)("div",{className:"flex items-center gap-x-1 rounded-[5px] border border-divider-subtle bg-background-default-lighter px-1.5 py-1",children:[(0,t.jsx)("span",{className:"system-2xs-medium-uppercase text-text-secondary",children:l("nodes.llm.jsonSchema.required",{ns:"workflow"})}),(0,t.jsx)(ep.default,{size:"xs",defaultValue:s,onChange:r})]})}),eY=e=>{let{items:a,currentValue:l,onSelect:n,popupClassName:o}=e,[i,d]=(0,s.useState)(!1);return(0,t.jsxs)(r.PortalToFollowElem,{open:i,onOpenChange:d,placement:"bottom-start",offset:{mainAxis:4},children:[(0,t.jsx)(r.PortalToFollowElemTrigger,{onClick:()=>d(e=>!e),children:(0,t.jsxs)("div",{className:(0,g.cn)("flex items-center rounded-[5px] p-0.5 pl-1 hover:bg-state-base-hover",i&&"bg-state-base-hover"),children:[(0,t.jsx)("span",{className:"system-xs-medium text-text-tertiary",children:l}),(0,t.jsx)(j.RiArrowDownSLine,{className:"h-4 w-4 text-text-tertiary"})]})}),(0,t.jsx)(r.PortalToFollowElemContent,{className:o,children:(0,t.jsx)("div",{className:"w-40 rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg p-1 shadow-lg shadow-shadow-shadow-5",children:a.map(e=>{let s=e.value===l;return(0,t.jsxs)("div",{className:"flex items-center gap-x-1 rounded-lg px-2 py-1 hover:bg-state-base-hover",onClick:()=>{n(e),d(!1)},children:[(0,t.jsx)("span",{className:"system-sm-medium px-1 text-text-secondary",children:e.text}),s&&(0,t.jsx)(j.RiCheckLine,{className:"h-4 w-4 text-text-accent"})]},e.value)})})})]})},eZ=[{value:ek.Type.string,text:"string"},{value:ek.Type.number,text:"number"},{value:ek.Type.boolean,text:"boolean"},{value:ek.Type.object,text:"object"},{value:ek.ArrayType.string,text:"array[string]"},{value:ek.ArrayType.number,text:"array[number]"},{value:ek.ArrayType.object,text:"array[object]"}],e0=[{value:ek.Type.string,text:"string"},{value:ek.Type.number,text:"number"},{value:ek.Type.boolean,text:"boolean"},{value:ek.ArrayType.string,text:"array[string]"},{value:ek.ArrayType.number,text:"array[number]"}],e1=e=>{let{fields:r,depth:l,path:n,parentPath:o}=e,{t:i}=(0,a.useTranslation)(),[d,c]=(0,s.useState)(r),[p,m]=(0,s.useState)(null),u=eI(e=>e.isAddingNewField),x=eI(e=>e.setIsAddingNewField),h=eI(e=>e.advancedEditing),y=eI(e=>e.setAdvancedEditing),{emit:v,useSubscribe:f}=eR(),b=(0,s.useRef)(!1),j=l===el.JSON_SCHEMA_MAX_DEPTH,N=j||d.type!==ek.Type.object&&d.type!==ek.ArrayType.object,w=d.type===ek.Type.string||d.type===ek.Type.number,T=h||u,C=(0,s.useMemo)(()=>{let e="";return(d.type===ek.Type.string||d.type===ek.Type.number)&&(e=(d.enum||[]).join(", ")),{enum:e}},[d.type,d.enum]);f("restorePropertyName",()=>{c(e=>({...e,name:r.name}))}),f("fieldChangeSuccess",()=>{u&&x(!1),h&&y(!1)});let _=(0,s.useCallback)(()=>{v("propertyNameChange",{path:n,parentPath:o,oldFields:r,fields:d})},[r,d,n,o,v]),k=(0,s.useCallback)(e=>{v("propertyTypeChange",{path:n,parentPath:o,oldFields:r,fields:{...d,type:e}})},[r,d,n,o,v]),S=(0,s.useCallback)(()=>{v("propertyRequiredToggle",{path:n,parentPath:o,oldFields:r,fields:d})},[v,n,o,r,d]),P=(0,s.useCallback)(e=>{v("propertyOptionsChange",{path:n,parentPath:o,oldFields:r,fields:{...d,...e}})},[v,n,o,r,d]),E=(0,s.useCallback)(()=>{v("propertyDelete",{path:n,parentPath:o,oldFields:r,fields:d})},[v,n,o,r,d]),F=(0,s.useCallback)(()=>{v("addField",{path:n})},[v,n]),M=(0,s.useCallback)(()=>{v("fieldChange",{path:n,parentPath:o,oldFields:r,fields:d})},[v,n,o,r,d]),I=(0,s.useCallback)(e=>{c(t=>({...t,name:e.target.value?.trim()}))},[]),A=(0,s.useCallback)(()=>{T||_()},[T,_]),V=(0,s.useCallback)(e=>{c(t=>({...t,type:e.value})),T||k(e.value)},[T,k]),L=(0,s.useCallback)(()=>{c(e=>({...e,required:!e.required})),T||S()},[T,S]),q=(0,s.useCallback)(e=>{c(t=>({...t,description:e.target.value}))},[]),R=(0,s.useCallback)(()=>{T||P({description:d.description,enum:d.enum})},[T,P,d]),O=(0,s.useCallback)(e=>{let t;if(""===e.enum)t=void 0;else{let s=e.enum.replace(/\s/g,"").split(",");t=d.type===ek.Type.number?s.map(e=>Number(e)).filter(e=>!Number.isNaN(e)):s}c(e=>({...e,enum:t})),T||P({description:d.description,enum:t})},[T,P,d]),U=(0,s.useCallback)(()=>{b.current=!0,E()},[E]),z=(0,s.useCallback)(()=>{m({...d}),y(!0)},[d,y]),$=(0,s.useCallback)(()=>{b.current=!0,F()},[F]),D=(0,s.useCallback)(()=>{M()},[M]),B=(0,s.useCallback)(()=>{if(u){b.current=!0,v("restoreSchema"),x(!1);return}p&&(c(p),m(null)),y(!1)},[u,v,x,y,p]);return(0,eD.useUnmount)(()=>{T||b.current||M()}),(0,t.jsxs)("div",{className:"flex flex-col rounded-lg bg-components-panel-bg py-0.5 shadow-sm shadow-shadow-shadow-4",children:[(0,t.jsxs)("div",{className:"flex h-6 items-center pl-1 pr-0.5",children:[(0,t.jsxs)("div",{className:"flex grow items-center gap-x-1",children:[(0,t.jsx)(eQ,{value:d.name,placeholder:i("nodes.llm.jsonSchema.fieldNamePlaceholder",{ns:"workflow"}),minWidth:80,maxWidth:300,onChange:I,onBlur:A}),(0,t.jsx)(eY,{currentValue:d.type,items:j?e0:eZ,onSelect:V,popupClassName:"z-[1000]"}),d.required&&(0,t.jsx)("div",{className:"system-2xs-medium-uppercase px-1 py-0.5 text-text-warning",children:i("nodes.llm.jsonSchema.required",{ns:"workflow"})})]}),(0,t.jsx)(eX,{defaultValue:d.required,toggleRequired:L}),(0,t.jsx)(eU.default,{type:"vertical",className:"h-3"}),T?(0,t.jsx)(eG,{isConfirmDisabled:""===d.name,onCancel:B,onConfirm:D}):(0,t.jsx)(eB,{disableAddBtn:N,onAddChildField:$,onDelete:U,onEdit:z})]}),(r.description||T)&&(0,t.jsx)("div",{className:(0,g.cn)("flex",T?"p-2 pt-1":"px-2 pb-1"),children:(0,t.jsx)("input",{value:d.description,className:"system-xs-regular placeholder:system-xs-regular h-4 w-full p-0 text-text-tertiary caret-[#295EFF] outline-none placeholder:text-text-placeholder",placeholder:i("nodes.llm.jsonSchema.descriptionPlaceholder",{ns:"workflow"}),onChange:q,onBlur:R,onKeyUp:e=>"Enter"===e.key&&e.currentTarget.blur()})}),T&&w&&(0,t.jsx)(eJ,{options:C,onChange:O})]})},e2={0:"pl-0",1:"pl-[20px]",2:"pl-[40px]",3:"pl-[60px]",4:"pl-[80px]",5:"pl-[100px]",6:"pl-[120px]",7:"pl-[140px]",8:"pl-[160px]",9:"pl-[180px]",10:"pl-[200px]"},e5={0:"left-0",1:"left-[20px]",2:"left-[40px]",3:"left-[60px]",4:"left-[80px]",5:"left-[100px]",6:"left-[120px]",7:"left-[140px]",8:"left-[160px]",9:"left-[180px]",10:"left-[200px]"},e4=e=>{let{name:a,required:r,schema:l,path:n,parentPath:o,depth:i,readOnly:d}=e,[c,p]=(0,s.useState)(!0),m=eI(e=>e.hoveringProperty),u=eI(e=>e.setHoveringProperty),x=eI(e=>e.isAddingNewField),h=eI(e=>e.advancedEditing),{run:y}=(0,eO.useDebounceFn)(e=>{u(e)},{wait:50}),v=(0,s.useMemo)(()=>(0,eS.getHasChildren)(l),[l]),f=(0,s.useMemo)(()=>(0,eS.getFieldType)(l),[l]),b=m===n.join(".");return(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsxs)("div",{className:(0,g.cn)("relative z-10",e2[i]),children:[i>0&&v&&(0,t.jsx)("div",{className:(0,g.cn)("absolute top-0 z-10 flex h-7 w-5 items-center bg-background-section-burn px-0.5",e5[i-1]),children:(0,t.jsx)("button",{type:"button",onClick:()=>{p(!c)},className:"py-0.5 text-text-tertiary hover:text-text-accent",children:c?(0,t.jsx)(j.RiArrowDropDownLine,{className:"h-4 w-4"}):(0,t.jsx)(j.RiArrowDropRightLine,{className:"h-4 w-4"})})}),(0,t.jsx)("div",{onMouseEnter:()=>{d||h||x||y(n.join("."))},onMouseLeave:()=>{d||h||x||y(null)},children:b&&i>0?(0,t.jsx)(e1,{fields:{name:a,type:f,required:r,description:l.description,enum:l.enum},path:n,parentPath:o,depth:i}):(0,t.jsx)(e$,{name:a,type:f,required:r,description:l.description})})]}),(0,t.jsx)("div",{className:(0,g.cn)("absolute z-0 flex w-5 justify-center",l.description?"top-12 h-[calc(100%-3rem)]":"top-7 h-[calc(100%-1.75rem)]",e5[i]),children:(0,t.jsx)(eU.default,{type:"vertical",className:(0,g.cn)("mx-0",b?"bg-divider-deep":"bg-divider-subtle")})}),c&&v&&i<el.JSON_SCHEMA_MAX_DEPTH&&(0,t.jsxs)(t.Fragment,{children:[l.type===ek.Type.object&&l.properties&&Object.entries(l.properties).map(e=>{let[s,a]=e;return(0,t.jsx)(e4,{name:s,required:!!l.required?.includes(s),schema:a,path:[...n,"properties",s],parentPath:n,depth:i+1},s)}),l.type===ek.Type.array&&l.items&&l.items.type===ek.Type.object&&l.items.properties&&Object.entries(l.items.properties).map(e=>{let[s,a]=e;return(0,t.jsx)(e4,{name:s,required:!!l.items?.required?.includes(s),schema:a,path:[...n,"items","properties",s],parentPath:n,depth:i+1},s)})]}),!d&&0===i&&!x&&(0,t.jsx)(ez,{})]})},e3=s.memo(e4),e6=e=>{let{className:s,schema:a,readOnly:r}=e;return(e=>{let{schema:t,onChange:s}=e,a=s||e_.noop,r=eI(e=>e.backupSchema),l=eI(e=>e.setBackupSchema),n=eI(e=>e.isAddingNewField),o=eI(e=>e.setIsAddingNewField),i=eI(e=>e.advancedEditing),d=eI(e=>e.setAdvancedEditing),c=eI(e=>e.setHoveringProperty),{emit:p,useSubscribe:m}=eR();m("restoreSchema",()=>{r&&(a(r),l(null))}),m("quitEditing",e=>{let{callback:t}=e;t?.(r),r&&(a(r),l(null)),n&&o(!1),i&&d(!1),c(null)}),m("propertyNameChange",e=>{let{parentPath:s,oldFields:r,fields:l}=e,{name:n}=r,{name:o}=l;a((0,ec.produce)(t,e=>{if(n===o)return;let t=(0,eS.findPropertyWithPath)(e,s);if(t.type===ek.Type.object){let e=t.properties||{};if(e[o]){T.default.notify({type:"error",message:"Property name already exists"}),p("restorePropertyName");return}let s=Object.entries(e).reduce((e,t)=>{let[s,a]=t;return e[s===n?o:s]=a,e},{}),a=t.required||[],r=(0,ec.produce)(a,e=>{let t=e.indexOf(n);-1!==t&&e.splice(t,1,o)});t.properties=s,t.required=r}if(t.type===ek.Type.array&&t.items&&t.items.type===ek.Type.object){let e=t.items.properties||{};if(e[o]){T.default.notify({type:"error",message:"Property name already exists"}),p("restorePropertyName");return}let s=Object.entries(e).reduce((e,t)=>{let[s,a]=t;return e[s===n?o:s]=a,e},{}),a=t.items.required||[],r=(0,ec.produce)(a,e=>{let t=e.indexOf(n);-1!==t&&e.splice(t,1,o)});t.items.properties=s,t.items.required=r}}))}),m("propertyTypeChange",e=>{let{path:s,oldFields:r,fields:l}=e,{type:n}=r,{type:o}=l;n===o||a((0,ec.produce)(t,e=>{let t=(0,eS.findPropertyWithPath)(e,s);switch(t.type===ek.Type.object&&(delete t.properties,delete t.required),t.type===ek.Type.array&&delete t.items,o){case ek.Type.object:t.type=ek.Type.object,t.properties={},t.required=[],t.additionalProperties=!1;break;case ek.ArrayType.string:t.type=ek.Type.array,t.items={type:ek.Type.string};break;case ek.ArrayType.number:t.type=ek.Type.array,t.items={type:ek.Type.number};break;case ek.ArrayType.object:t.type=ek.Type.array,t.items={type:ek.Type.object,properties:{},required:[],additionalProperties:!1};break;default:t.type=o}}))}),m("propertyRequiredToggle",e=>{let{parentPath:s,fields:r}=e,{name:l}=r;a((0,ec.produce)(t,e=>{let t=(0,eS.findPropertyWithPath)(e,s);if(t.type===ek.Type.object){let e=t.required||[];t.required=e.includes(l)?e.filter(e=>e!==l):[...e,l]}if(t.type===ek.Type.array&&t.items&&t.items.type===ek.Type.object){let e=t.items.required||[],s=e.includes(l)?e.filter(e=>e!==l):[...e,l];t.items.required=s}}))}),m("propertyOptionsChange",e=>{let{path:s,fields:r}=e;a((0,ec.produce)(t,e=>{let t=(0,eS.findPropertyWithPath)(e,s);t.description=r.description,t.enum=r.enum}))}),m("propertyDelete",e=>{let{parentPath:s,fields:r}=e,{name:l}=r;a((0,ec.produce)(t,e=>{let t=(0,eS.findPropertyWithPath)(e,s);t.type===ek.Type.object&&t.properties&&(delete t.properties[l],t.required=t.required?.filter(e=>e!==l)),t.type===ek.Type.array&&t.items?.properties&&t.items?.type===ek.Type.object&&(delete t.items.properties[l],t.items.required=t.items.required?.filter(e=>e!==l))}))}),m("addField",e=>{i&&d(!1),l(t);let{path:s}=e;o(!0),a((0,ec.produce)(t,e=>{let t=(0,eS.findPropertyWithPath)(e,s);t.type===ek.Type.object&&(t.properties={...t.properties,"":{type:ek.Type.string}},c([...s,"properties",""].join("."))),t.type===ek.Type.array&&t.items&&t.items.type===ek.Type.object&&(t.items.properties={...t.items.properties,"":{type:ek.Type.string}},c([...s,"items","properties",""].join(".")))}))}),m("fieldChange",e=>{let s=!1,{parentPath:r,oldFields:l,fields:n}=e,o=(0,ec.produce)(t,e=>{let t=(0,eS.findPropertyWithPath)(e,r),{name:a,type:o,required:i}=l,{name:d,type:c,required:p}=n;if(t.type===ek.Type.object&&t.properties){if(a!==d){let e=t.properties;e[d]&&(T.default.notify({type:"error",message:"Property name already exists"}),s=!0);let r=Object.entries(e).reduce((e,t)=>{let[s,r]=t;return e[s===a?d:s]=r,e},{}),l=t.required||[],n=(0,ec.produce)(l,e=>{let t=e.indexOf(a);-1!==t&&e.splice(t,1,d)});t.properties=r,t.required=n}if(i!==p){let e=t.required||[];t.required=e.includes(d)?e.filter(e=>e!==d):[...e,d]}let e=t.properties[d];if(o!==c)switch(e.type===ek.Type.object&&(delete e.properties,delete e.required),e.type===ek.Type.array&&delete e.items,c){case ek.Type.object:e.type=ek.Type.object,e.properties={},e.required=[],e.additionalProperties=!1;break;case ek.ArrayType.string:e.type=ek.Type.array,e.items={type:ek.Type.string};break;case ek.ArrayType.number:e.type=ek.Type.array,e.items={type:ek.Type.number};break;case ek.ArrayType.object:e.type=ek.Type.array,e.items={type:ek.Type.object,properties:{},required:[],additionalProperties:!1};break;default:e.type=c}e.description=n.description,e.enum=n.enum}if(t.type===ek.Type.array&&t.items&&t.items.type===ek.Type.object&&t.items.properties){if(a!==d){let e=t.items.properties||{};e[d]&&(T.default.notify({type:"error",message:"Property name already exists"}),s=!0);let r=Object.entries(e).reduce((e,t)=>{let[s,r]=t;return e[s===a?d:s]=r,e},{}),l=t.items.required||[],n=(0,ec.produce)(l,e=>{let t=e.indexOf(a);-1!==t&&e.splice(t,1,d)});t.items.properties=r,t.items.required=n}if(i!==p){let e=t.items.required||[],s=e.includes(d)?e.filter(e=>e!==d):[...e,d];t.items.required=s}let e=t.items.properties[d];if(o!==c)switch(e.type===ek.Type.object&&(delete e.properties,delete e.required),e.type===ek.Type.array&&delete e.items,c){case ek.Type.object:e.type=ek.Type.object,e.properties={},e.required=[],e.additionalProperties=!1;break;case ek.ArrayType.string:e.type=ek.Type.array,e.items={type:ek.Type.string};break;case ek.ArrayType.number:e.type=ek.Type.array,e.items={type:ek.Type.number};break;case ek.ArrayType.object:e.type=ek.Type.array,e.items={type:ek.Type.object,properties:{},required:[],additionalProperties:!1};break;default:e.type=c}e.description=n.description,e.enum=n.enum}});s||(a(o),p("fieldChangeSuccess"))})})(e),(0,t.jsx)("div",{className:(0,g.cn)("h-full overflow-auto rounded-xl bg-background-section-burn p-1 pl-2",s),children:(0,t.jsx)(e3,{name:e.rootName||"structured_output",schema:a,required:!1,path:[],depth:0,readOnly:r})})};e.s(["default",0,e6],609995);let e8=s.memo(e=>{let{isShow:s,schema:r,rootName:l,onClose:n}=e,{t:o}=(0,a.useTranslation)();return(0,t.jsx)(B.default,{isShow:s,onClose:n,className:"max-w-[960px] p-0",wrapperClassName:"z-[9999]",children:(0,t.jsxs)("div",{className:"pb-6",children:[(0,t.jsxs)("div",{className:"relative flex p-6 pb-3 pr-14",children:[(0,t.jsx)("div",{className:"title-2xl-semi-bold grow truncate text-text-primary",children:o("nodes.agent.parameterSchema",{ns:"workflow"})}),(0,t.jsx)("div",{className:"absolute right-5 top-5 flex h-8 w-8 items-center justify-center p-1.5",onClick:n,children:(0,t.jsx)(j.RiCloseLine,{className:"h-[18px] w-[18px] text-text-tertiary"})})]}),(0,t.jsx)("div",{className:"flex max-h-[700px] overflow-y-auto px-6 py-2",children:(0,t.jsx)(eq,{children:(0,t.jsx)(eV,{children:(0,t.jsx)(e6,{className:"w-full",schema:r,rootName:l,readOnly:!0})})})})]})})});e.s(["default",0,e8],899620),e.s(["default",0,e=>{let{value:r,onChange:l,schemas:n,nodeOutputVars:o,availableNodes:c,nodeId:m}=e,{t:u}=(0,a.useTranslation)(),x=(0,_.useLanguage)(),h=e=>e===C.FormTypeEnum.file||e===C.FormTypeEnum.files?eh.VarType.variable:e===C.FormTypeEnum.select||e===C.FormTypeEnum.checkbox||e===C.FormTypeEnum.textNumber||e===C.FormTypeEnum.array||e===C.FormTypeEnum.object?eh.VarType.constant:e===C.FormTypeEnum.textInput||e===C.FormTypeEnum.secretInput?eh.VarType.mixed:void 0,y=(e,t,s)=>{l({...r,[e]:{value:t?null:{type:h(s),value:null},auto:+!!t}})},v=(0,s.useCallback)((e,t)=>s=>{l((0,ec.produce)(r,a=>{a[e].value={type:s,value:s===eh.VarType.variable?"":t}}))},[l,r]),f=(0,s.useCallback)((e,t)=>s=>{l((0,ec.produce)(r,a=>{a[e].value={type:h(t),value:s}}))},[l,r]),b=(0,s.useCallback)(e=>t=>{l((0,ec.produce)(r,s=>{s[e].value=t}))},[l,r]),N=(0,s.useCallback)(e=>t=>{l((0,ec.produce)(r,s=>{let a=s[e].value;s[e].value={...a,...t}}))},[l,r]),T=(0,s.useCallback)(e=>t=>{l((0,ec.produce)(r,s=>{s[e].value={type:eh.VarType.variable,value:t}}))},[l,r]),[k,{setTrue:S,setFalse:P}]=(0,O.useBoolean)(!1),[E,F]=(0,s.useState)(null),[M,I]=(0,s.useState)("");return(0,t.jsxs)("div",{className:"space-y-3 px-4 py-2",children:[!k&&n.map(e=>((e,s)=>{let{default:a,variable:l,label:n,required:h,tooltip:_,type:k,scope:S,url:P,input_schema:E,placeholder:F,options:M}=e,I=r[l]?.auto,A=_&&(0,t.jsx)(R.default,{popupContent:(0,t.jsx)("div",{className:"w-[200px]",children:_[x]||_.en_US}),triggerClassName:"ml-0.5 w-4 h-4",asChild:!1}),V=r[l].value,L=k===C.FormTypeEnum.textInput||k===C.FormTypeEnum.secretInput,q=k===C.FormTypeEnum.textNumber,O=k===C.FormTypeEnum.object,U=k===C.FormTypeEnum.array,z=O||U,$=k===C.FormTypeEnum.file||k===C.FormTypeEnum.files,D=k===C.FormTypeEnum.checkbox,B=k===C.FormTypeEnum.select,W=k===C.FormTypeEnum.appSelector,H=k===C.FormTypeEnum.modelSelector,K=q||O||U,G=V?.type===eh.VarType.constant||!V?.type,J=$||V?.type===eh.VarType.variable,Q=()=>{if(L)return p.VarType.string;if(q)return p.VarType.number;if(k===C.FormTypeEnum.files)return p.VarType.arrayFile;if(k===C.FormTypeEnum.file)return p.VarType.file;if(D)return p.VarType.boolean;else if(O)return p.VarType.object;else if(U)return p.VarType.arrayObject;else return p.VarType.string};return(0,t.jsxs)("div",{className:"space-y-0.5",children:[(0,t.jsxs)("div",{className:"system-sm-semibold flex items-center justify-between py-2 text-text-secondary",children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("span",{className:(0,g.cn)("code-sm-semibold max-w-[140px] truncate text-text-secondary"),title:n[x]||n.en_US,children:n[x]||n.en_US}),h&&(0,t.jsx)("span",{className:"ml-1 text-red-500",children:"*"}),A,(0,t.jsx)("span",{className:"system-xs-regular mx-1 text-text-quaternary",children:"Â·"}),(0,t.jsx)("span",{className:"system-xs-regular text-text-tertiary",children:Q()}),z&&(0,t.jsx)(R.default,{popupContent:(0,t.jsx)("div",{className:"system-xs-medium text-text-secondary",children:u("nodes.agent.clickToViewParameterSchema",{ns:"workflow"})}),asChild:!1,children:(0,t.jsx)("div",{className:"ml-0.5 cursor-pointer rounded-[4px] p-px text-text-tertiary hover:bg-state-base-hover hover:text-text-secondary",onClick:()=>s(E,n[x]||n.en_US),children:(0,t.jsx)(j.RiBracesLine,{className:"size-3.5"})})})]}),(0,t.jsxs)("div",{className:"flex cursor-pointer items-center gap-1 rounded-[6px] border border-divider-subtle bg-background-default-lighter px-2 py-1 hover:bg-state-base-hover",onClick:()=>y(l,!I,k),children:[(0,t.jsx)("span",{className:"system-xs-medium text-text-secondary",children:u("detailPanel.toolSelector.auto",{ns:"plugin"})}),(0,t.jsx)(ep.default,{size:"xs",defaultValue:!!I,onChange:e=>y(l,e,k)})]})]}),0===I&&(0,t.jsxs)("div",{className:(0,g.cn)("gap-1",!(z&&G)&&"flex"),children:[K&&(0,t.jsx)(ey,{value:V?.type||eh.VarType.constant,onChange:v(l,a)}),L&&(0,t.jsx)(eC,{value:V?.value||"",onChange:f(l,k),nodesOutputVars:o,availableNodes:c}),q&&G&&(0,t.jsx)(i.default,{className:"h-8 grow",type:"number",value:V?.value||"",onChange:e=>f(l,k)(e.target.value),placeholder:F?.[x]||F?.en_US}),D&&(0,t.jsx)(eu,{value:V?.value,onChange:f(l,k)}),B&&M&&(0,t.jsx)(d.SimpleSelect,{wrapperClassName:"h-8 grow",defaultValue:V?.value,items:M.filter(e=>!e.show_on.length||e.show_on.every(e=>r[e.variable]?.value?.value===e.value)).map(e=>({value:e.value,name:e.label[x]||e.label.en_US})),onSelect:e=>f(l,k)(e.value),placeholder:F?.[x]||F?.en_US}),z&&G&&(0,t.jsx)("div",{className:"mt-1 w-full",children:(0,t.jsx)(em.default,{title:"JSON",value:V?.value,isExpand:!0,isInNode:!0,height:100,language:ev.CodeLanguage.json,onChange:f(l,k),className:"w-full",placeholder:(0,t.jsx)("div",{className:"whitespace-pre",children:F?.[x]||F?.en_US})})}),W&&(0,t.jsx)(w,{disabled:!1,scope:S||"all",value:V,onSelect:b(l)}),H&&(0,t.jsx)(ed,{popupClassName:"!w-[387px]",isAdvancedMode:!0,isInWorkflow:!0,value:V,setModel:N(l),scope:S}),J&&(0,t.jsx)(eg.default,{zIndex:1001,className:"h-8 grow",readonly:!1,isShowNodeName:!0,nodeId:m,value:V?.value||[],onChange:T(l),filterVar:(()=>{if(q)return e=>e.type===p.VarType.number;if(L)return e=>[p.VarType.string,p.VarType.number,p.VarType.secret].includes(e.type);if($)return e=>[p.VarType.file,p.VarType.arrayFile].includes(e.type);if(D)return e=>e.type===p.VarType.boolean;if(O)return e=>e.type===p.VarType.object;else if(U)return e=>[p.VarType.array,p.VarType.arrayString,p.VarType.arrayNumber,p.VarType.arrayObject].includes(e.type)})(),schema:e,valueTypePlaceHolder:Q()})]}),P&&(0,t.jsxs)("a",{href:P,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center text-xs text-text-accent",children:[u("howToGet",{ns:"tools"}),(0,t.jsx)(j.RiArrowRightUpLine,{className:"ml-1 h-3 w-3"})]})]},l)})(e,(e,t)=>{F(e),I(t),S()})),k&&(0,t.jsx)(e8,{isShow:k,schema:E,rootName:M,onClose:P})]})}],724081),e.i(302047);var e7=e.i(674245),e9=e.i(677316);e.s(["PluginAuthInAgent",()=>e9.default],325011);var e9=e9,te=e.i(946700);e.s(["default",0,e=>{let{currentProvider:s,credentialId:a,onAuthorizationItemClick:r}=e;return s&&s.type===te.CollectionType.builtIn&&s.allow_delete?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eU.default,{className:"my-1 w-full"}),(0,t.jsx)("div",{className:"px-4 py-2",children:(0,t.jsx)(e9.default,{pluginPayload:{provider:s.name,category:e7.AuthCategory.tool,providerType:s.type},credentialId:a,onAuthorizationItemClick:r})})]}):null}],78336)},844083,780783,620191,925304,527525,753212,732139,811871,882889,121653,e=>{"use strict";e.s([],844083);var t=e.i(724081),s=e.i(899620),a=e.i(78336),r=e.i(563199);e.i(152567);var l=e.i(408767),n=e.i(873517),o=e.i(672530),i=e.i(665127),d=e.i(837699),c=e.i(120219),p=e.i(390622),m=e.i(935139);let u=e=>{let{open:t,provider:s,value:a,isConfigure:n}=e,{t:o}=(0,l.useTranslation)();return(0,r.jsxs)("div",{className:(0,m.cn)("group flex cursor-pointer items-center rounded-lg bg-components-input-bg-normal p-2 pl-3 hover:bg-state-base-hover-alt",t&&"bg-state-base-hover-alt",a?.provider_name&&"py-1.5 pl-1.5"),children:[a?.provider_name&&s&&(0,r.jsx)("div",{className:"mr-1 shrink-0 rounded-lg border border-components-panel-border bg-components-panel-bg p-px",children:(0,r.jsx)(c.default,{className:"!h-4 !w-4",type:p.BlockEnum.Tool,toolIcon:s.icon})}),a?.tool_name&&(0,r.jsx)("div",{className:"system-sm-medium grow text-components-input-text-filled",children:a.tool_name}),!a?.provider_name&&(0,r.jsx)("div",{className:"system-sm-regular grow text-components-input-text-placeholder",children:o(n?"detailPanel.configureTool":"detailPanel.toolSelector.placeholder",{ns:"plugin"})}),n&&(0,r.jsx)(d.RiEqualizer2Line,{className:(0,m.cn)("ml-0.5 h-4 w-4 shrink-0 text-text-quaternary group-hover:text-text-secondary",t&&"text-text-secondary")}),!n&&(0,r.jsx)(d.RiArrowDownSLine,{className:(0,m.cn)("ml-0.5 h-4 w-4 shrink-0 text-text-quaternary group-hover:text-text-secondary",t&&"text-text-secondary")})]})};var x=e.i(268255),h=e.i(151094),y=(e.i(449980),e.i(137667),e.i(633957),e.i(885327),e.i(566210),e.i(344600),e.i(654313)),g=e.i(257899);e.i(36860);var v=e.i(438270),f=e.i(260484),b=e.i(421001);let j=e=>{let{title:t,action:s,children:a}=e;return(0,r.jsxs)("div",{className:"w-[180px]",children:[!!t&&(0,r.jsx)("div",{className:"mb-1.5 font-semibold text-text-secondary",children:t}),(0,r.jsx)("div",{className:"mb-1.5 text-text-tertiary",children:a}),!!s&&(0,r.jsx)("div",{className:"cursor-pointer text-text-accent",children:s})]})};e.s(["ToolTipContent",0,j],780783);var N=e.i(836340),w=e.i(958865),T=e.i(802105),C=e.i(181296),_=e.i(350988),k=e.i(757198),S=e.i(988720);e.s(["default",()=>Z],527525);var P=e.i(417944),E=e.i(739255),F=e.i(225162),M=s;e.s(["SchemaModal",()=>M.default],620191);var M=s,I=e.i(789604),A=e.i(516457),V=e.i(449758),L=e.i(291631),q=e.i(299951),R=e.i(282700),O=e.i(464727),U=e.i(944911),z=e.i(481162),$=e.i(22461),D=e.i(619507),B=e.i(955371),W=e.i(899713),H=e.i(157644),K=e.i(819114),G=e.i(705848),J=e.i(734186),Q=e.i(508844);let X=e=>{let{readOnly:t,nodeId:s,schema:a,value:l,onChange:n,inPanel:o,currentTool:i,currentProvider:c,showManageInputField:u,onManageInputField:h,extraParams:y,providerType:g,disableVariableInsertion:v=!1}=e,f=(0,F.useLanguage)(),[b,j]=(0,x.useState)(null),[N,w]=(0,x.useState)(!1),{placeholder:T,variable:C,type:_,_type:k,default:S,options:P,multiple:M,scope:X}=a,Y=l[C],Z=_===E.FormTypeEnum.textInput||_===E.FormTypeEnum.secretInput,ee=_===E.FormTypeEnum.textNumber,et=_===E.FormTypeEnum.object,es=_===E.FormTypeEnum.array,ea=et||es,er=_===E.FormTypeEnum.file||_===E.FormTypeEnum.files,el=k===E.FormTypeEnum.boolean,en=k===E.FormTypeEnum.checkbox,eo=_===E.FormTypeEnum.select,ei=_===E.FormTypeEnum.dynamicSelect,ed=_===E.FormTypeEnum.appSelector,ec=_===E.FormTypeEnum.modelSelector,ep=ee||el||et||es||eo,em=Y?.type===G.VarKindType.constant||!Y?.type,eu=er||Y?.type===G.VarKindType.variable,ex=M&&(eo||ei),{availableVars:eh,availableNodesWithParent:ey}=(0,D.default)(s,{onlyLeafNodeVar:!1,filterVar:e=>[p.VarType.string,p.VarType.number,p.VarType.secret].includes(e.type)}),{mutateAsync:eg}=(0,H.useFetchDynamicOptions)(c?.plugin_id||"",c?.name||"",i?.name||"",C||"",g,y),{data:ev,isLoading:ef}=(0,K.useTriggerPluginDynamicOptions)({plugin_id:c?.plugin_id||"",provider:c?.name||"",action:i?.name||"",parameter:C||"",extra:y,credential_id:c?.credential_id||""},ei&&g===U.PluginCategoryEnum.trigger&&!!i&&!!c),eb=ev?.options,ej=g===U.PluginCategoryEnum.trigger?eb??b:b,eN=g===U.PluginCategoryEnum.trigger&&ef||N;(0,x.useEffect)(()=>{(async()=>{if(ei&&i&&c&&(g===U.PluginCategoryEnum.tool||g===U.PluginCategoryEnum.trigger)){w(!0);try{let e=await eg();j(e?.options||[])}catch(e){console.error("Failed to fetch dynamic options:",e),j([])}finally{w(!1)}}})()},[ei,i?.name,c?.name,C,y,g,eg]);let ew=e=>{n({...l,[C]:{...Y,type:er?G.VarKindType.variable:eo||ei||el||ee||es||et?G.VarKindType.constant:Z?G.VarKindType.mixed:void 0,value:ee?Number.parseFloat(e):e}})},eT=e=>{if(!e||0===e.length)return"";let t=(ei?ej||P||[]:P||[]).filter(t=>e.includes(t.value));return t.length<=2?t.map(e=>e.label?.[f]||e.label?.en_US||e.value).join(", "):`${t.length} selected`},eC=e=>{n({...l,[C]:{...Y,value:e}})},e_=(0,x.useMemo)(()=>(P||[]).filter(e=>!e.show_on?.length||e.show_on.every(e=>l[e.variable]?.value===e.value||l[e.variable]===e.value)),[P,l]),ek=(0,x.useMemo)(()=>e_.map(e=>({value:e.value,label:e.label?.[f]||e.label?.en_US||e.value})),[e_,f]),eS=(0,x.useMemo)(()=>{let e=[];Array.isArray(Y?.value)?e=Y.value:"string"==typeof Y?.value?e=[Y.value]:Array.isArray(S)&&(e=S);let t=new Set(e_.map(e=>e.value));return e.filter(e=>t.has(e))},[Y?.value,S,e_]);return(0,r.jsxs)("div",{className:(0,m.cn)("gap-1",!(ea&&em)&&"flex"),children:[ep&&(0,r.jsx)(Q.default,{value:Y?.type||G.VarKindType.constant,onChange:e=>{e===G.VarKindType.variable?n({...l,[C]:{...Y,type:G.VarKindType.variable,value:""}}):n({...l,[C]:{...Y,type:G.VarKindType.constant,value:S}})}}),Z&&(0,r.jsx)(W.default,{readOnly:t,value:Y?.value||"",onChange:ew,nodesOutputVars:eh,availableNodes:ey,showManageInputField:u,onManageInputField:h,disableVariableInsertion:v}),ee&&em&&(0,r.jsx)(L.default,{className:"h-8 grow",type:"number",value:Number.isNaN(Y?.value)?"":Y?.value,onChange:e=>ew(e.target.value),placeholder:T?.[f]||T?.en_US}),en&&em&&(0,r.jsx)(V.default,{title:a.label?.[f]||a.label?.en_US||C,value:eS,onChange:e=>{n({...l,[C]:{...Y,type:G.VarKindType.constant,value:e}})},options:ek,disabled:t,maxHeight:"200px"}),el&&em&&(0,r.jsx)(J.default,{value:Y?.value,onChange:ew}),eo&&em&&!ex&&(0,r.jsx)(q.SimpleSelect,{wrapperClassName:"h-8 grow",disabled:t,defaultValue:Y?.value,items:P.filter(e=>!e.show_on.length||e.show_on.every(e=>l[e.variable]===e.value)).map(e=>({value:e.value,name:e.label[f]||e.label.en_US,icon:e.icon})),onSelect:e=>ew(e.value),placeholder:T?.[f]||T?.en_US,renderOption:P.some(e=>e.icon)?e=>{let{item:t}=e;return(0,r.jsxs)("div",{className:"flex items-center",children:[t.icon&&(0,r.jsx)("img",{src:t.icon,alt:"",className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:t.name})]})}:void 0}),eo&&em&&ex&&(0,r.jsx)(I.Listbox,{multiple:!0,value:Y?.value||[],onChange:ew,disabled:t,children:(0,r.jsxs)("div",{className:"group/simple-select relative h-8 grow",children:[(0,r.jsxs)(I.ListboxButton,{className:"flex h-full w-full cursor-pointer items-center rounded-lg border-0 bg-components-input-bg-normal pl-3 pr-10 focus-visible:bg-state-base-hover-alt focus-visible:outline-none group-hover/simple-select:bg-state-base-hover-alt sm:text-sm sm:leading-6",children:[(0,r.jsx)("span",{className:(0,m.cn)("system-sm-regular block truncate text-left",Y?.value?.length>0?"text-components-input-text-filled":"text-components-input-text-placeholder"),children:eT(Y?.value)||T?.[f]||T?.en_US||"Select options"}),(0,r.jsx)("span",{className:"absolute inset-y-0 right-0 flex items-center pr-2",children:(0,r.jsx)(A.ChevronDownIcon,{className:"h-4 w-4 text-text-quaternary group-hover/simple-select:text-text-secondary","aria-hidden":"true"})})]}),(0,r.jsx)(I.ListboxOptions,{className:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur px-1 py-1 text-base shadow-lg backdrop-blur-sm focus:outline-none sm:text-sm",children:P.filter(e=>!e.show_on?.length||e.show_on.every(e=>l[e.variable]===e.value)).map(e=>(0,r.jsx)(I.ListboxOption,{value:e.value,className:e=>{let{focus:t}=e;return(0,m.cn)("relative cursor-pointer select-none rounded-lg py-2 pl-3 pr-9 text-text-secondary hover:bg-state-base-hover",t&&"bg-state-base-hover")},children:t=>{let{selected:s}=t;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex items-center",children:[e.icon&&(0,r.jsx)("img",{src:e.icon,alt:"",className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{className:(0,m.cn)("block truncate",s&&"font-normal"),children:e.label[f]||e.label.en_US})]}),s&&(0,r.jsx)("span",{className:"absolute inset-y-0 right-0 flex items-center pr-2 text-text-accent",children:(0,r.jsx)(d.RiCheckLine,{className:"h-4 w-4","aria-hidden":"true"})})]})}},e.value))})]})}),ei&&!ex&&(0,r.jsx)(q.SimpleSelect,{wrapperClassName:"h-8 grow",disabled:t||eN,defaultValue:Y?.value,items:(ej||P||[]).filter(e=>!e.show_on?.length||e.show_on.every(e=>l[e.variable]===e.value)).map(e=>({value:e.value,name:e.label[f]||e.label.en_US,icon:e.icon})),onSelect:e=>ew(e.value),placeholder:eN?"Loading...":T?.[f]||T?.en_US,renderOption:e=>{let{item:t}=e;return(0,r.jsxs)("div",{className:"flex items-center",children:[t.icon&&(0,r.jsx)("img",{src:t.icon,alt:"",className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:t.name})]})}}),ei&&ex&&(0,r.jsx)(I.Listbox,{multiple:!0,value:Y?.value||[],onChange:ew,disabled:t||eN,children:(0,r.jsxs)("div",{className:"group/simple-select relative h-8 grow",children:[(0,r.jsxs)(I.ListboxButton,{className:"flex h-full w-full cursor-pointer items-center rounded-lg border-0 bg-components-input-bg-normal pl-3 pr-10 focus-visible:bg-state-base-hover-alt focus-visible:outline-none group-hover/simple-select:bg-state-base-hover-alt sm:text-sm sm:leading-6",children:[(0,r.jsx)("span",{className:(0,m.cn)("system-sm-regular block truncate text-left",eN?"text-components-input-text-placeholder":Y?.value?.length>0?"text-components-input-text-filled":"text-components-input-text-placeholder"),children:eN?"Loading...":eT(Y?.value)||T?.[f]||T?.en_US||"Select options"}),(0,r.jsx)("span",{className:"absolute inset-y-0 right-0 flex items-center pr-2",children:eN?(0,r.jsx)(d.RiLoader4Line,{className:"h-3.5 w-3.5 animate-spin text-text-secondary"}):(0,r.jsx)(A.ChevronDownIcon,{className:"h-4 w-4 text-text-quaternary group-hover/simple-select:text-text-secondary","aria-hidden":"true"})})]}),(0,r.jsx)(I.ListboxOptions,{className:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur px-1 py-1 text-base shadow-lg backdrop-blur-sm focus:outline-none sm:text-sm",children:(ej||P||[]).filter(e=>!e.show_on?.length||e.show_on.every(e=>l[e.variable]===e.value)).map(e=>(0,r.jsx)(I.ListboxOption,{value:e.value,className:e=>{let{focus:t}=e;return(0,m.cn)("relative cursor-pointer select-none rounded-lg py-2 pl-3 pr-9 text-text-secondary hover:bg-state-base-hover",t&&"bg-state-base-hover")},children:t=>{let{selected:s}=t;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex items-center",children:[e.icon&&(0,r.jsx)("img",{src:e.icon,alt:"",className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{className:(0,m.cn)("block truncate",s&&"font-normal"),children:e.label[f]||e.label.en_US})]}),s&&(0,r.jsx)("span",{className:"absolute inset-y-0 right-0 flex items-center pr-2 text-text-accent",children:(0,r.jsx)(d.RiCheckLine,{className:"h-4 w-4","aria-hidden":"true"})})]})}},e.value))})]})}),ea&&em&&(0,r.jsx)("div",{className:"mt-1 w-full",children:(0,r.jsx)(z.default,{title:"JSON",value:Y?.value,isExpand:!0,isInNode:!0,language:B.CodeLanguage.json,onChange:ew,className:"w-full",placeholder:(0,r.jsx)("div",{className:"whitespace-pre",children:T?.[f]||T?.en_US})})}),ed&&(0,r.jsx)(R.default,{disabled:t,scope:X||"all",value:Y?.value,onSelect:eC}),ec&&em&&(0,r.jsx)(O.default,{popupClassName:"!w-[387px]",isAdvancedMode:!0,isInWorkflow:!0,value:Y?.value,setModel:eC,readonly:t,scope:X}),eu&&(0,r.jsx)($.default,{zIndex:o?1e3:void 0,className:"h-8 grow",readonly:t,isShowNodeName:!0,nodeId:s,value:Y?.value||[],onChange:e=>{n({...l,[C]:{...Y,type:G.VarKindType.variable,value:e||""}})},filterVar:(()=>{if(ee)return e=>e.type===p.VarType.number;if(Z)return e=>[p.VarType.string,p.VarType.number,p.VarType.secret].includes(e.type);if(er)return e=>[p.VarType.file,p.VarType.arrayFile].includes(e.type);if(el)return e=>e.type===p.VarType.boolean;if(et)return e=>e.type===p.VarType.object;else if(es)return e=>[p.VarType.array,p.VarType.arrayString,p.VarType.arrayNumber,p.VarType.arrayObject].includes(e.type)})(),schema:a,valueTypePlaceHolder:(()=>{if(Z)return p.VarType.string;if(ee)return p.VarType.number;if(_===E.FormTypeEnum.files)return p.VarType.arrayFile;if(_===E.FormTypeEnum.file)return p.VarType.file;if(eo)return p.VarType.string;else if(el)return p.VarType.boolean;else if(et)return p.VarType.object;else if(es)return p.VarType.arrayObject;else return p.VarType.string})(),currentTool:i,currentProvider:c,isFilterFileVar:el})]})};e.s(["default",0,X],925304);let Y=e=>{let{readOnly:t,nodeId:s,schema:a,value:l,onChange:n,inPanel:o,currentTool:i,currentProvider:c,showManageInputField:p,onManageInputField:m,extraParams:u,providerType:x="tool"}=e,y=(0,F.useLanguage)(),{name:g,label:v,type:f,required:j,tooltip:N,input_schema:w}=a,T=f===E.FormTypeEnum.object||f===E.FormTypeEnum.array,C=f===E.FormTypeEnum.textInput||f===E.FormTypeEnum.secretInput,[_,{setTrue:k,setFalse:S}]=(0,P.useBoolean)(!1);return(0,r.jsxs)("div",{className:"space-y-0.5 py-1",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex h-6 items-center",children:[(0,r.jsx)("div",{className:"system-sm-medium text-text-secondary",children:v[y]||v.en_US}),j&&(0,r.jsx)("div",{className:"system-xs-regular ml-1 text-text-destructive-secondary",children:"*"}),!C&&N&&(0,r.jsx)(b.default,{popupContent:(0,r.jsx)("div",{className:"w-[200px]",children:N[y]||N.en_US}),triggerClassName:"ml-1 w-4 h-4",asChild:!1}),T&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"system-xs-regular ml-1 mr-0.5 text-text-quaternary",children:"Â·"}),(0,r.jsxs)(h.default,{variant:"ghost",size:"small",onClick:k,className:"system-xs-regular px-1 text-text-tertiary",children:[(0,r.jsx)(d.RiBracesLine,{className:"mr-1 size-3.5"}),(0,r.jsx)("span",{children:"JSON Schema"})]})]})]}),C&&N&&(0,r.jsx)("div",{className:"body-xs-regular pb-0.5 text-text-tertiary",children:N[y]||N.en_US})]}),(0,r.jsx)(X,{readOnly:t,nodeId:s,schema:a,value:l,onChange:n,inPanel:o,currentTool:i,currentProvider:c,showManageInputField:p,onManageInputField:m,extraParams:u,providerType:x}),_&&(0,r.jsx)(M.default,{isShow:!0,onClose:S,rootName:g,schema:w})]})},Z=e=>{let{readOnly:t,nodeId:s,schema:a,value:l,onChange:n,inPanel:o,currentTool:i,currentProvider:d,showManageInputField:c,onManageInputField:p,extraParams:m}=e;return(0,r.jsx)("div",{className:"space-y-1",children:a.map((e,a)=>(0,r.jsx)(Y,{readOnly:t,nodeId:s,schema:e,value:l,onChange:n,inPanel:o,currentTool:i,currentProvider:d,showManageInputField:c,onManageInputField:p,extraParams:m,providerType:"tool"},a))})},ee=()=>{let{t:e}=(0,l.useTranslation)();return(0,r.jsxs)("div",{className:"pb-1",children:[(0,r.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:e("detailPanel.toolSelector.paramsTip1",{ns:"plugin"})}),(0,r.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:e("detailPanel.toolSelector.paramsTip2",{ns:"plugin"})})]})},et=e=>{let{value:s,currentProvider:a,nodeId:n,currType:o,settingsFormSchemas:i,paramsFormSchemas:d,settingsValue:c,showTabSlider:p,userSettingsOnly:m,reasoningConfigOnly:u,nodeOutputVars:x,availableNodes:h,onCurrTypeChange:y,onSettingsFormChange:g,onParamsFormChange:v}=e,{t:f}=(0,l.useTranslation)(),b=i.length>0,j=d.length>0,N=a?.is_team_authorization;return(b||j)&&N?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(k.default,{className:"my-1 w-full"}),n&&p&&(0,r.jsx)(S.default,{className:"mt-1 shrink-0 px-4",itemClassName:"py-3",noBorderBottom:!0,smallItem:!0,value:o,onChange:e=>{("settings"===e||"params"===e)&&y(e)},options:[{value:"settings",text:f("detailPanel.toolSelector.settings",{ns:"plugin"})},{value:"params",text:f("detailPanel.toolSelector.params",{ns:"plugin"})}]}),n&&p&&"params"===o&&(0,r.jsx)("div",{className:"px-4 py-2",children:(0,r.jsx)(ee,{})}),m&&(0,r.jsx)("div",{className:"p-4 pb-1",children:(0,r.jsx)("div",{className:"system-sm-semibold-uppercase text-text-primary",children:f("detailPanel.toolSelector.settings",{ns:"plugin"})})}),n&&u&&(0,r.jsxs)("div",{className:"mb-1 p-4 pb-1",children:[(0,r.jsx)("div",{className:"system-sm-semibold-uppercase text-text-primary",children:f("detailPanel.toolSelector.params",{ns:"plugin"})}),(0,r.jsx)(ee,{})]}),("settings"===o||m)&&(0,r.jsx)("div",{className:"px-4 py-2",children:(0,r.jsx)(Z,{inPanel:!0,readOnly:!1,nodeId:n,schema:i,value:c,onChange:g})}),n&&("params"===o||u)&&(0,r.jsx)(t.default,{value:s?.parameters||{},onChange:v,schemas:d,nodeOutputVars:x,availableNodes:h,nodeId:n})]}):null};e.s(["ToolAuthorizationSection",()=>a.default],753212),e.s(["ToolBaseForm",0,e=>{let{value:t,currentProvider:s,offset:a=4,scope:d,selectedTools:c,isShowChooseTool:p,panelShowState:m,hasTrigger:x,onShowChange:h,onPanelShowStateChange:y,onSelectTool:g,onSelectMultipleTool:v,onDescriptionChange:f}=e,{t:b}=(0,l.useTranslation)();return(0,r.jsxs)("div",{className:"flex flex-col gap-3 px-4 py-2",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsxs)("div",{className:"system-sm-semibold flex h-6 items-center justify-between text-text-secondary",children:[b("detailPanel.toolSelector.toolLabel",{ns:"plugin"}),s?.plugin_unique_identifier&&(0,r.jsx)(i.ReadmeEntrance,{pluginDetail:s,showShortTip:!0,className:"pb-0"})]}),(0,r.jsx)(o.default,{placement:"bottom",offset:a,trigger:(0,r.jsx)(u,{open:m||p,value:t,provider:s}),isShow:m||p,onShowChange:x?y||(()=>{}):h,disabled:!1,supportAddCustomTool:!0,onSelect:g,onSelectMultiple:v,scope:d,selectedTools:c})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("div",{className:"system-sm-semibold flex h-6 items-center text-text-secondary",children:b("detailPanel.toolSelector.descriptionLabel",{ns:"plugin"})}),(0,r.jsx)(n.default,{className:"resize-none",placeholder:b("detailPanel.toolSelector.descriptionPlaceholder",{ns:"plugin"}),value:t?.extra?.description||"",onChange:f,disabled:!t?.provider_name})]})]})}],732139),e.s(["ToolItem",0,e=>{let{open:t,icon:s,isMCPTool:a,providerShowName:n,providerName:o,toolLabel:i,showSwitch:c,switchValue:p,onSwitchChange:u,onDelete:k,noAuth:S,uninstalled:P,installInfo:E,onInstall:F,isError:M,errorTip:I,versionMismatch:A,authRemoved:V}=e,{t:L}=(0,l.useTranslation)(),{allowed:q}=(0,T.useMCPToolAvailability)(),R=a?n:o?.split("/").pop(),O=P||A||M,[U,z]=(0,x.useState)(!1),$=a&&!q;return(0,r.jsxs)("div",{className:(0,m.cn)("group flex cursor-default items-center gap-1 rounded-lg border-[0.5px] border-components-panel-border-subtle bg-components-panel-on-panel-item-bg p-1.5 pr-2 shadow-xs hover:bg-components-panel-on-panel-item-bg-hover hover:shadow-sm",t&&"bg-components-panel-on-panel-item-bg-hover shadow-sm",U&&"border-state-destructive-border shadow-xs hover:bg-state-destructive-hover"),children:[s&&(0,r.jsxs)("div",{className:(0,m.cn)("shrink-0",O&&"opacity-50",$&&"opacity-30"),children:["string"==typeof s&&(0,r.jsx)("div",{className:"h-7 w-7 rounded-lg border-[0.5px] border-components-panel-border-subtle bg-background-default-dodge bg-cover bg-center",style:{backgroundImage:`url(${s})`}}),"string"!=typeof s&&(0,r.jsx)(g.default,{className:"h-7 w-7 rounded-lg border-[0.5px] border-components-panel-border-subtle bg-background-default-dodge",size:"xs",icon:s?.content,background:s?.background})]}),!s&&(0,r.jsx)("div",{className:(0,m.cn)("flex h-7 w-7 items-center justify-center rounded-md border-[0.5px] border-components-panel-border-subtle bg-background-default-subtle",O&&"opacity-50",$&&"opacity-30"),children:(0,r.jsx)("div",{className:"flex h-5 w-5 items-center justify-center opacity-35",children:(0,r.jsx)(v.Group,{className:"text-text-tertiary"})})}),(0,r.jsxs)("div",{className:(0,m.cn)("grow truncate pl-0.5",O&&"opacity-50",$&&"opacity-30"),children:[(0,r.jsx)("div",{className:"system-2xs-medium-uppercase text-text-tertiary",children:R}),(0,r.jsx)("div",{className:"system-xs-medium text-text-secondary",children:i})]}),(0,r.jsxs)("div",{className:"hidden items-center gap-1 group-hover:flex",children:[!S&&!M&&!P&&!A&&!$&&(0,r.jsx)(y.default,{children:(0,r.jsx)(d.RiEqualizer2Line,{className:"h-4 w-4"})}),(0,r.jsx)("div",{className:"cursor-pointer rounded-md p-1 text-text-tertiary hover:text-text-destructive",onClick:e=>{e.stopPropagation(),k?.()},onMouseOver:()=>z(!0),onMouseLeave:()=>z(!1),children:(0,r.jsx)(d.RiDeleteBinLine,{className:"h-4 w-4"})})]}),!M&&!P&&!S&&!A&&!$&&c&&(0,r.jsx)("div",{className:"mr-1",onClick:e=>e.stopPropagation(),children:(0,r.jsx)(f.default,{size:"md",defaultValue:p,onChange:u})}),$&&(0,r.jsx)(C.default,{}),!M&&!P&&!A&&S&&(0,r.jsxs)(h.default,{variant:"secondary",size:"small",children:[L("notAuthorized",{ns:"tools"}),(0,r.jsx)(N.default,{className:"ml-2",color:"orange"})]}),!M&&!P&&!A&&V&&(0,r.jsxs)(h.default,{variant:"secondary",size:"small",children:[L("auth.authRemoved",{ns:"plugin"}),(0,r.jsx)(N.default,{className:"ml-2",color:"red"})]}),!M&&!P&&A&&E&&(0,r.jsx)("div",{onClick:e=>e.stopPropagation(),children:(0,r.jsx)(_.SwitchPluginVersion,{className:"-mt-1",uniqueIdentifier:E,tooltip:(0,r.jsx)(j,{title:L("detailPanel.toolSelector.unsupportedTitle",{ns:"plugin"}),children:`${L("detailPanel.toolSelector.unsupportedContent",{ns:"plugin"})} ${L("detailPanel.toolSelector.unsupportedContent2",{ns:"plugin"})}`}),onChange:()=>{F?.()}})}),!M&&P&&E&&(0,r.jsx)(w.InstallPluginButton,{onClick:e=>e.stopPropagation(),size:"small",uniqueIdentifier:E,onSuccess:()=>{F?.()}}),M&&(0,r.jsx)(b.default,{popupContent:I,children:(0,r.jsx)("div",{children:(0,r.jsx)(d.RiErrorWarningFill,{className:"h-4 w-4 text-text-destructive"})})})]})}],811871),e.s(["ToolSettingsPanel",()=>et],882889),e.s(["ToolTrigger",0,u],121653)},64732,e=>{"use strict";var t=e.i(925521);e.s(["getIconFromMarketPlace",0,e=>`${t.MARKETPLACE_API_PREFIX}/plugins/${e}/icon`])},633957,123706,710522,e=>{"use strict";e.s(["default",()=>q],633957);var t=e.i(563199),s=e.i(268255),a=e.i(545766),r=e.i(574270),l=e.i(299951),n=e.i(421001),o=e.i(282700),i=e.i(464727);e.s(["default",()=>E],710522);var d=e.i(837699);e.i(152567);var c=e.i(408767),p=e.i(654313),m=e.i(757198);e.i(288243);var u=e.i(670977);e.s(["default",()=>S],123706);var x=e.i(554327),h=e.i(391185),y=e.i(946700),g=e.i(935139);e.i(844083);var v=e.i(753212),f=e.i(732139),b=e.i(811871),j=e.i(882889),N=e.i(121653),w=e.i(885327),T=e.i(157644),C=e.i(154033),_=e.i(64732);let k=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=e?.split("/").splice(0,2).join("/"),{data:s}=(0,T.usePluginManifestInfo)(t);return{inMarketPlace:!!s,manifest:s?.data.plugin,pluginID:t}},S=s.memo(e=>{let{value:a,selectedTools:r,isEdit:l,disabled:n,placement:o="left",offset:i=4,onSelect:d,onSelectMultiple:p,onDelete:m,scope:u,supportEnableSwitch:S,trigger:P,controlledState:E,onControlledStateChange:F,panelShowState:M,onPanelShowStateChange:I,nodeOutputVars:A,availableNodes:V,nodeId:L=""}=e,{t:q}=(0,c.useTranslation)(),{isShow:R,setIsShow:O,isShowChooseTool:U,setIsShowChooseTool:z,currType:$,setCurrType:D,currentProvider:B,currentTool:W,settingsFormSchemas:H,paramsFormSchemas:K,showTabSlider:G,userSettingsOnly:J,reasoningConfigOnly:Q,manifestIcon:X,inMarketPlace:Y,manifest:Z,handleSelectTool:ee,handleSelectMultipleTool:et,handleDescriptionChange:es,handleSettingsFormChange:ea,handleParamsFormChange:er,handleEnabledChange:el,handleAuthorizationItemClick:en,handleInstall:eo,getSettingsValue:ei}=(e=>{let{value:t,onSelect:a,onSelectMultiple:r}=e,[l,n]=(0,s.useState)(!1),[o,i]=(0,s.useState)(!1),[d,c]=(0,s.useState)("settings"),{data:p}=(0,C.useAllBuiltInTools)(),{data:m}=(0,C.useAllCustomTools)(),{data:u}=(0,C.useAllWorkflowTools)(),{data:x}=(0,C.useAllMCPTools)(),h=(0,C.useInvalidateAllBuiltInTools)(),y=(0,T.useInvalidateInstalledPluginList)(),{inMarketPlace:g,manifest:v,pluginID:f}=k(t?.provider_name),b=(0,s.useMemo)(()=>[...p||[],...m||[],...u||[],...x||[]].find(e=>e.id===t?.provider_name),[t,p,m,u,x]),j=(0,s.useMemo)(()=>b?.tools.find(e=>e.name===t?.tool_name),[b?.tools,t?.tool_name]),N=(0,s.useMemo)(()=>b&&b.tools.find(e=>e.name===t?.tool_name)?.parameters.filter(e=>"llm"!==e.form)||[],[b,t]),S=(0,s.useMemo)(()=>b&&b.tools.find(e=>e.name===t?.tool_name)?.parameters.filter(e=>"llm"===e.form)||[],[b,t]),P=(0,s.useMemo)(()=>(0,w.toolParametersToFormSchemas)(N),[N]),E=(0,s.useMemo)(()=>(0,w.toolParametersToFormSchemas)(S),[S]),F=N.length>0&&S.length>0,M=N.length>0&&!S.length,I=S.length>0&&!N.length,A=(0,s.useMemo)(()=>v&&f?(0,_.getIconFromMarketPlace)(f):"",[v,f]),V=(0,s.useCallback)(e=>{let t=(0,w.generateFormValue)(e.params,(0,w.toolParametersToFormSchemas)(e.paramSchemas.filter(e=>"llm"!==e.form))),s=(0,w.generateFormValue)(e.params,(0,w.toolParametersToFormSchemas)(e.paramSchemas.filter(e=>"llm"===e.form)),!0);return{provider_name:e.provider_id,provider_show_name:e.provider_name,tool_name:e.tool_name,tool_label:e.tool_label,tool_description:e.tool_description,settings:t,parameters:s,enabled:e.is_team_authorization,extra:{description:e.tool_description}}},[]),L=(0,s.useCallback)(e=>{a(V(e))},[V,a]),q=(0,s.useCallback)(e=>{let t=e.map(e=>V(e));r?.(t)},[V,r]),R=(0,s.useCallback)(e=>{t&&a({...t,extra:{...t.extra,description:e.target.value||""}})},[t,a]),O=(0,s.useCallback)(e=>{if(!t)return;let s=(0,w.getStructureValue)(e);a({...t,settings:s})},[t,a]),U=(0,s.useCallback)(e=>{t&&a({...t,parameters:e})},[t,a]),z=(0,s.useCallback)(e=>{t&&a({...t,enabled:e})},[t,a]),$=(0,s.useCallback)(e=>{t&&a({...t,credential_id:e})},[t,a]);return{isShow:l,setIsShow:n,isShowChooseTool:o,setIsShowChooseTool:i,currType:d,setCurrType:c,currentProvider:b,currentTool:j,currentToolSettings:N,currentToolParams:S,settingsFormSchemas:P,paramsFormSchemas:E,showTabSlider:F,userSettingsOnly:M,reasoningConfigOnly:I,manifestIcon:A,inMarketPlace:g,manifest:v,handleSelectTool:L,handleSelectMultipleTool:q,handleDescriptionChange:R,handleSettingsFormChange:O,handleParamsFormChange:U,handleEnabledChange:z,handleAuthorizationItemClick:$,handleInstall:(0,s.useCallback)(async()=>{try{await h()}catch(e){console.error("Failed to invalidate built-in tools cache",e)}try{await y()}catch(e){console.error("Failed to invalidate installed plugin list cache",e)}},[h,y]),getSettingsValue:(0,s.useCallback)(()=>(0,w.getPlainValue)(t?.settings||{}),[t?.settings])}})({value:a,onSelect:d,onSelectMultiple:p}),ed=P?E:R;return(0,t.jsxs)(h.PortalToFollowElem,{placement:o,offset:i,open:ed,onOpenChange:P?F:O,children:[(0,t.jsxs)(h.PortalToFollowElemTrigger,{className:"w-full",onClick:()=>{B&&W&&(n||O(!0))},children:[P,!P&&!a?.provider_name&&(0,t.jsx)(N.ToolTrigger,{isConfigure:!0,open:R,value:a,provider:B}),!P&&a?.provider_name&&(0,t.jsx)(b.ToolItem,{open:R,icon:B?.icon||X,isMCPTool:B?.type===y.CollectionType.mcp,providerName:a.provider_name,providerShowName:a.provider_show_name,toolLabel:a.tool_label||a.tool_name,showSwitch:S,switchValue:a.enabled,onSwitchChange:el,onDelete:m,noAuth:B&&W&&!B.is_team_authorization,uninstalled:!B&&Y,versionMismatch:B&&Y&&!W,installInfo:Z?.latest_package_identifier,onInstall:eo,isError:(!B||!W)&&!Y,errorTip:(0,t.jsxs)("div",{className:"max-w-[240px] space-y-1 text-xs",children:[(0,t.jsx)("h3",{className:"font-semibold text-text-primary",children:q(W?"detailPanel.toolSelector.uninstalledTitle":"detailPanel.toolSelector.unsupportedTitle",{ns:"plugin"})}),(0,t.jsx)("p",{className:"tracking-tight text-text-secondary",children:q(W?"detailPanel.toolSelector.uninstalledContent":"detailPanel.toolSelector.unsupportedContent",{ns:"plugin"})}),(0,t.jsx)("p",{children:(0,t.jsx)(x.default,{href:"/plugins",className:"tracking-tight text-text-accent",children:q("detailPanel.toolSelector.uninstalledLink",{ns:"plugin"})})})]})})]}),(0,t.jsx)(h.PortalToFollowElemContent,{className:"z-10",children:(0,t.jsxs)("div",{className:(0,g.cn)("relative max-h-[642px] min-h-20 w-[361px] rounded-xl","border-[0.5px] border-components-panel-border bg-components-panel-bg-blur","overflow-y-auto pb-2 pb-4 shadow-lg backdrop-blur-sm"),children:[(0,t.jsx)("div",{className:"system-xl-semibold px-4 pb-1 pt-3.5 text-text-primary",children:q(`detailPanel.toolSelector.${l?"toolSetting":"title"}`,{ns:"plugin"})}),(0,t.jsx)(f.ToolBaseForm,{value:a,currentProvider:B,offset:i,scope:u,selectedTools:r,isShowChooseTool:U,panelShowState:M,hasTrigger:!!P,onShowChange:z,onPanelShowStateChange:I,onSelectTool:ee,onSelectMultipleTool:et,onDescriptionChange:es}),(0,t.jsx)(v.ToolAuthorizationSection,{currentProvider:B,credentialId:a?.credential_id,onAuthorizationItemClick:en}),(0,t.jsx)(j.ToolSettingsPanel,{value:a,currentProvider:B,nodeId:L,currType:$,settingsFormSchemas:H,paramsFormSchemas:K,settingsValue:ei(),showTabSlider:G,userSettingsOnly:J,reasoningConfigOnly:Q,nodeOutputVars:A,availableNodes:V,onCurrTypeChange:D,onSettingsFormChange:ea,onParamsFormChange:er})]})})]})});var P=e.i(802105);let E=e=>{let{disabled:a,value:r=[],label:l,required:o,tooltip:i,supportCollapse:x,scope:h,onChange:y,nodeOutputVars:v,availableNodes:f,nodeId:b}=e,{t:j}=(0,c.useTranslation)(),{allowed:N}=(0,P.useMCPToolAvailability)(),{data:w}=(0,C.useAllMCPTools)(),T=r.filter(e=>w?.find(t=>t.id===e.provider_name)?e.enabled&&N:e.enabled).length,[_,k]=s.useState(!1),[E,F]=s.useState(!1),[M,I]=s.useState(!0),A=e=>{y([...r,...e].reduce((e,t)=>(e.find(e=>e.provider_name===t.provider_name&&e.tool_name===t.tool_name)||e.push(t),e),[])),F(!1)};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"mb-1 flex items-center",children:[(0,t.jsxs)("div",{className:(0,g.cn)("relative flex grow items-center gap-0.5",x&&"cursor-pointer"),onClick:()=>{x&&k(!_)},children:[(0,t.jsx)("div",{className:"system-sm-semibold-uppercase flex h-6 items-center text-text-secondary",children:l}),o&&(0,t.jsx)("div",{className:"text-red-500",children:"*"}),i&&(0,t.jsx)(n.default,{popupContent:i,children:(0,t.jsx)("div",{children:(0,t.jsx)(d.RiQuestionLine,{className:"h-3.5 w-3.5 text-text-quaternary hover:text-text-tertiary"})})}),x&&(0,t.jsx)(u.ArrowDownRoundFill,{className:(0,g.cn)("h-4 w-4 cursor-pointer text-text-quaternary group-hover/collapse:text-text-secondary",_&&"rotate-[270deg]")})]}),r.length>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"system-xs-medium flex items-center gap-1 text-text-tertiary",children:[(0,t.jsx)("span",{children:`${T}/${r.length}`}),(0,t.jsx)("span",{children:j("agent.tools.enabled",{ns:"appDebug"})})]}),(0,t.jsx)(m.default,{type:"vertical",className:"ml-3 mr-1 h-3"})]}),!a&&(0,t.jsx)(p.default,{className:"mx-1",onClick:()=>{k(!1),F(!E),I(!0)},children:(0,t.jsx)(d.RiAddLine,{className:"h-4 w-4"})})]}),!_&&(0,t.jsxs)(t.Fragment,{children:[0===r.length&&(0,t.jsx)("div",{className:"system-xs-regular flex justify-center rounded-[10px] bg-background-section p-3 text-text-tertiary",children:j("detailPanel.toolSelector.empty",{ns:"plugin"})}),r.length>0&&r.map((e,s)=>(0,t.jsx)("div",{className:"mb-1",children:(0,t.jsx)(S,{nodeId:b,nodeOutputVars:v,availableNodes:f,scope:h,value:e,selectedTools:r,onSelect:e=>{let t;(t=[...r])[s]=e,y(t)},onSelectMultiple:A,onDelete:()=>{let e;(e=[...r]).splice(s,1),y(e)},supportEnableSwitch:!0,isEdit:!0})},s))]}),(0,t.jsx)(S,{nodeId:b,nodeOutputVars:v,availableNodes:f,scope:h,value:void 0,selectedTools:r,onSelect:e=>{y([...r,e].reduce((e,t)=>(e.find(e=>e.provider_name===t.provider_name&&e.tool_name===t.tool_name)||e.push(t),e),[])),F(!1)},controlledState:E,onControlledStateChange:F,trigger:(0,t.jsx)("div",{className:""}),panelShowState:M,onPanelShowStateChange:I,isEdit:!1,onSelectMultiple:A})]})};var F=e.i(22461),M=e.i(863085);let I=()=>{let{t:e}=(0,c.useTranslation)();return(0,t.jsx)("div",{className:"mt-2 text-xs font-normal text-primary-600",children:e("provider.validating",{ns:"common"})})};var A=e.i(739255),V=e.i(225162);let L=e=>{let{value:s,onChange:a,onFocus:r,placeholder:l,validated:n,className:o,disabled:i,type:d="text",min:c,max:p}=e;return(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("input",{tabIndex:0,className:`
          block h-8 w-full appearance-none rounded-lg border border-transparent bg-components-input-bg-normal px-3 text-sm
          text-components-input-text-filled caret-primary-600 outline-none
          placeholder:text-sm placeholder:text-text-tertiary
          hover:border-components-input-border-hover hover:bg-components-input-bg-hover focus:border-components-input-border-active
          focus:bg-components-input-bg-active focus:shadow-xs
          ${n?"pr-[30px]":""}
          ${o||""}
        `,placeholder:l||"",onChange:e=>a(e.target.value),onBlur:e=>{var t;let s,r;return t=e.target.value,s=Number.parseFloat(`${c}`),r=Number.parseFloat(`${p}`),void(!isNaN(s)&&Number.parseFloat(t)<s?a(`${c}`):!isNaN(r)&&Number.parseFloat(t)>r&&a(`${p}`))},onFocus:r,value:s,disabled:i,type:d,min:c,max:p}),n&&(0,t.jsx)("div",{className:"absolute right-2.5 top-2.5",children:(0,t.jsx)(M.CheckCircle,{className:"h-4 w-4 text-[#039855]"})})]})},q=function(e){let{className:d,itemClassName:c,fieldLabelClassName:p,value:m,onChange:u,formSchemas:x,validating:h,validatedSuccess:y,showOnVariableMap:v,isEditMode:f,isAgentStrategy:b=!1,readonly:j,inputClassName:N,isShowDefaultValue:w=!1,fieldMoreInfo:T,customRenderField:C,override:_,nodeId:k,nodeOutputVars:P,availableNodes:M}=e,q=(0,V.useLanguage)(),[R,O]=(0,s.useState)(""),U={className:d,itemClassName:c,fieldLabelClassName:p,value:m,onChange:u,formSchemas:x,validating:h,validatedSuccess:y,showOnVariableMap:v,isEditMode:f,readonly:j,inputClassName:N,isShowDefaultValue:w,fieldMoreInfo:T},z=(e,t)=>{if(f&&("__model_type"===e||"__model_name"===e))return;O(e);let s={};v[e]?.length&&v[e].forEach(e=>{let t=x.find(t=>t.variable===e);s[e]=t?t.default:void 0}),u({...m,[e]:t,...s})},$=(0,s.useCallback)((e,t)=>{let s={...m[e],...t,type:A.FormTypeEnum.modelSelector};u({...m,[e]:s})},[u,m]);return(0,t.jsx)("div",{className:d,children:x.map(e=>(e=>{let s=e.tooltip,d=s&&(0,t.jsx)(n.default,{popupContent:(0,t.jsx)("div",{className:"w-[200px]",children:s[q]||s.en_US}),triggerClassName:"ml-1 w-4 h-4",asChild:!1});if(_){let[t,s]=_;if(t.includes(e.type)){let t=s(e,U);if(t)return t}}if(e.type===A.FormTypeEnum.textInput||e.type===A.FormTypeEnum.secretInput||e.type===A.FormTypeEnum.textNumber){let{variable:s,label:a,placeholder:r,required:l,show_on:n}=e;if(n.length&&!n.every(e=>m[e.variable]===e.value))return null;let o=j||f&&("__model_type"===s||"__model_name"===s);return(0,t.jsxs)("div",{className:(0,g.cn)(c,"py-3"),children:[(0,t.jsxs)("div",{className:(0,g.cn)(p,"system-sm-semibold flex items-center py-2 text-text-secondary"),children:[a[q]||a.en_US,l&&(0,t.jsx)("span",{className:"ml-1 text-red-500",children:"*"}),d]}),(0,t.jsx)(L,{className:(0,g.cn)(N,`${o&&"cursor-not-allowed opacity-60"}`),value:w&&(""===m[s]||void 0===m[s]||null===m[s])?e.default:m[s],onChange:e=>z(s,e),validated:y,placeholder:r?.[q]||r?.en_US,disabled:o,type:e.type===A.FormTypeEnum.secretInput?"password":e.type===A.FormTypeEnum.textNumber?"number":"text",...e.type===A.FormTypeEnum.textNumber?{min:e.min,max:e.max}:{}}),T?.(e),h&&R===s&&(0,t.jsx)(I,{})]},s)}if(e.type===A.FormTypeEnum.radio){let{options:s,variable:a,label:l,show_on:n,required:o}=e;if(n.length&&!n.every(e=>m[e.variable]===e.value))return null;let i=f&&("__model_type"===a||"__model_name"===a);return(0,t.jsxs)("div",{className:(0,g.cn)(c,"py-3"),children:[(0,t.jsxs)("div",{className:(0,g.cn)(p,"system-sm-semibold flex items-center py-2 text-text-secondary"),children:[l[q]||l.en_US,o&&(0,t.jsx)("span",{className:"ml-1 text-red-500",children:"*"}),d]}),(0,t.jsx)("div",{className:(0,g.cn)("grid gap-3",`grid-cols-${s?.length}`),children:s.filter(e=>!e.show_on.length||e.show_on.every(e=>m[e.variable]===e.value)).map(e=>(0,t.jsxs)("div",{className:`
                    flex cursor-pointer items-center gap-2 rounded-lg border border-components-option-card-option-border bg-components-option-card-option-bg px-3 py-2
                    ${m[a]===e.value&&"border-[1.5px] border-components-option-card-option-selected-border bg-components-option-card-option-selected-bg shadow-sm"}
                    ${i&&"!cursor-not-allowed opacity-60"}
                  `,onClick:()=>z(a,e.value),children:[(0,t.jsx)(r.default,{isChecked:m[a]===e.value}),(0,t.jsx)("div",{className:"system-sm-regular text-text-secondary",children:e.label[q]||e.label.en_US})]},`${a}-${e.value}`))}),T?.(e),h&&R===a&&(0,t.jsx)(I,{})]},a)}if(e.type===A.FormTypeEnum.select){let{options:s,variable:a,label:r,show_on:n,required:o,placeholder:i}=e;return n.length&&!n.every(e=>m[e.variable]===e.value)?null:(0,t.jsxs)("div",{className:(0,g.cn)(c,"py-3"),children:[(0,t.jsxs)("div",{className:(0,g.cn)(p,"system-sm-semibold flex items-center py-2 text-text-secondary"),children:[r[q]||r.en_US,o&&(0,t.jsx)("span",{className:"ml-1 text-red-500",children:"*"}),d]}),(0,t.jsx)(l.SimpleSelect,{wrapperClassName:"h-8",className:(0,g.cn)(N),disabled:j,defaultValue:w&&(""===m[a]||void 0===m[a]||null===m[a])?e.default:m[a],items:s.filter(e=>!e.show_on.length||e.show_on.every(e=>m[e.variable]===e.value)).map(e=>({value:e.value,name:e.label[q]||e.label.en_US})),onSelect:e=>z(a,e.value),placeholder:i?.[q]||i?.en_US}),T?.(e),h&&R===a&&(0,t.jsx)(I,{})]},a)}if(e.type===A.FormTypeEnum.checkbox){let{variable:s,label:r,show_on:l,required:n}=e;return l.length&&!l.every(e=>m[e.variable]===e.value)?null:(0,t.jsxs)("div",{className:(0,g.cn)(c,"py-3"),children:[(0,t.jsxs)("div",{className:"system-sm-semibold flex items-center justify-between py-2 text-text-secondary",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("span",{className:(0,g.cn)(p,"system-sm-semibold flex items-center py-2 text-text-secondary"),children:r[q]||r.en_US}),n&&(0,t.jsx)("span",{className:"ml-1 text-red-500",children:"*"}),d]}),(0,t.jsxs)(a.default.Group,{className:"flex items-center",value:m[s],onChange:e=>z(s,e),children:[(0,t.jsx)(a.default,{value:!0,className:"!mr-1",children:"True"}),(0,t.jsx)(a.default,{value:!1,children:"False"})]})]}),T?.(e)]},s)}if(e.type===A.FormTypeEnum.modelSelector){let{variable:s,label:a,required:r,scope:l}=e;return(0,t.jsxs)("div",{className:(0,g.cn)(c,"py-3"),children:[(0,t.jsxs)("div",{className:(0,g.cn)(p,"system-sm-semibold flex items-center py-2 text-text-secondary"),children:[a[q]||a.en_US,r&&(0,t.jsx)("span",{className:"ml-1 text-red-500",children:"*"}),d]}),(0,t.jsx)(i.default,{popupClassName:"!w-[387px]",isAdvancedMode:!0,isInWorkflow:!0,isAgentStrategy:b,value:m[s],setModel:e=>$(s,e),readonly:j,scope:l}),T?.(e),h&&R===s&&(0,t.jsx)(I,{})]},s)}if(e.type===A.FormTypeEnum.toolSelector){let{variable:s,label:a,required:r,scope:l}=e;return(0,t.jsxs)("div",{className:(0,g.cn)(c,"py-3"),children:[(0,t.jsxs)("div",{className:(0,g.cn)(p,"system-sm-semibold flex items-center py-2 text-text-secondary"),children:[a[q]||a.en_US,r&&(0,t.jsx)("span",{className:"ml-1 text-red-500",children:"*"}),d]}),(0,t.jsx)(S,{scope:l,nodeId:k,nodeOutputVars:P||[],availableNodes:M||[],disabled:j,value:m[s],onSelect:e=>z(s,e),onDelete:()=>z(s,null)}),T?.(e),h&&R===s&&(0,t.jsx)(I,{})]},s)}if(e.type===A.FormTypeEnum.multiToolSelector){let{variable:s,label:a,tooltip:r,required:l,scope:n}=e;return(0,t.jsxs)("div",{className:(0,g.cn)(c,"py-3"),children:[(0,t.jsx)(E,{disabled:j,nodeId:k,nodeOutputVars:P||[],availableNodes:M||[],scope:n,label:a[q]||a.en_US,required:l,tooltip:r?.[q]||r?.en_US,value:m[s]||[],onChange:e=>z(s,e),supportCollapse:!0}),T?.(e),h&&R===s&&(0,t.jsx)(I,{})]},s)}if(e.type===A.FormTypeEnum.appSelector){let{variable:s,label:a,required:r,scope:l}=e;return(0,t.jsxs)("div",{className:(0,g.cn)(c,"py-3"),children:[(0,t.jsxs)("div",{className:(0,g.cn)(p,"system-sm-semibold flex items-center py-2 text-text-secondary"),children:[a[q]||a.en_US,r&&(0,t.jsx)("span",{className:"ml-1 text-red-500",children:"*"}),d]}),(0,t.jsx)(o.default,{disabled:j,scope:l,value:m[s],onSelect:e=>z(s,{...e,type:A.FormTypeEnum.appSelector})}),T?.(e),h&&R===s&&(0,t.jsx)(I,{})]},s)}if(e.type===A.FormTypeEnum.any){let{variable:s,label:a,required:r,scope:l}=e;return(0,t.jsxs)("div",{className:(0,g.cn)(c,"py-3"),children:[(0,t.jsxs)("div",{className:(0,g.cn)(p,"system-sm-semibold flex items-center py-2 text-text-secondary"),children:[a[q]||a.en_US,r&&(0,t.jsx)("span",{className:"ml-1 text-red-500",children:"*"}),d]}),(0,t.jsx)(F.default,{zIndex:1001,readonly:!1,isShowNodeName:!0,nodeId:k||"",value:m[s]||[],onChange:e=>z(s,e),filterVar:e=>!l||l.split("&").includes(e.type)}),T?.(e),h&&R===s&&(0,t.jsx)(I,{})]},s)}if(!Object.values(A.FormTypeEnum).includes(e.type))return C?.(e,U)})(e))})}}]);
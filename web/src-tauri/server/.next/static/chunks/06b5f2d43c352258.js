(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,540136,e=>{"use strict";var s=e.i(563199),t=e.i(268255),i=e.i(449980),a=e.i(724605),l=e.i(305230);e.i(905691);var n=e.i(322034),r=e.i(413159),o=e.i(326531);e.i(152567);var c=e.i(408767),d=e.i(151094),m=e.i(547105),u=e.i(137667),p=e.i(225244),x=e.i(722384),h=e.i(475390),f=e.i(658547),w=e.i(922521),g=e.i(168014);let j=t.memo(()=>{let{theme:e}=(0,w.default)();return(0,s.jsxs)("picture",{children:[(0,s.jsx)("source",{media:"(resolution: 1x)",srcSet:`${g.basePath}/screenshots/${e}/Pipeline.png`}),(0,s.jsx)("source",{media:"(resolution: 2x)",srcSet:`${g.basePath}/screenshots/${e}/Pipeline@2x.png`}),(0,s.jsx)("source",{media:"(resolution: 3x)",srcSet:`${g.basePath}/screenshots/${e}/Pipeline@3x.png`}),(0,s.jsx)(f.default,{src:`${g.basePath}/screenshots/${e}/Pipeline.png`,alt:"Pipeline Screenshot",width:692,height:456})]})}),b=t.memo(()=>{let{t:e}=(0,c.useTranslation)(),{datasetId:i}=(0,o.useParams)(),[a,l]=(0,t.useState)(!1),{mutateAsync:n,isPending:r}=(0,h.useConvertDatasetToPipeline)(),f=(0,x.useInvalid)([...p.datasetDetailQueryKeyPrefix,i]),w=(0,t.useCallback)(()=>{n(i,{onSuccess:s=>{"success"===s.status?(u.default.notify({type:"success",message:e("conversion.successMessage",{ns:"datasetPipeline"})}),l(!1),f()):"failed"===s.status&&u.default.notify({type:"error",message:e("conversion.errorMessage",{ns:"datasetPipeline"})})},onError:()=>{u.default.notify({type:"error",message:e("conversion.errorMessage",{ns:"datasetPipeline"})})}})},[n,i,f,e]),g=(0,t.useCallback)(()=>{l(!0)},[]),b=(0,t.useCallback)(()=>{l(!1)},[]);return(0,s.jsxs)("div",{className:"flex h-full w-full items-center justify-center bg-background-body p-6 pb-16",children:[(0,s.jsxs)("div",{className:"flex rounded-2xl border-[0.5px] border-components-card-border bg-components-card-bg shadow-sm shadow-shadow-shadow-4",children:[(0,s.jsxs)("div",{className:"flex max-w-[480px] flex-col justify-between p-10",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-y-2.5",children:[(0,s.jsx)("div",{className:"title-4xl-semi-bold text-text-primary",children:e("conversion.title",{ns:"datasetPipeline"})}),(0,s.jsxs)("div",{className:"body-md-medium",children:[(0,s.jsx)("span",{className:"text-text-secondary",children:e("conversion.descriptionChunk1",{ns:"datasetPipeline"})}),(0,s.jsx)("span",{className:"text-text-tertiary",children:e("conversion.descriptionChunk2",{ns:"datasetPipeline"})})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-x-4",children:[(0,s.jsx)(d.default,{variant:"primary",className:"w-32",onClick:g,children:e("operations.convert",{ns:"datasetPipeline"})}),(0,s.jsx)("span",{className:"system-xs-regular text-text-warning",children:e("conversion.warning",{ns:"datasetPipeline"})})]})]}),(0,s.jsx)("div",{className:"pb-8 pl-[25px] pr-0 pt-6",children:(0,s.jsx)("div",{className:"rounded-l-xl border border-effects-highlight bg-background-default p-1 shadow-md shadow-shadow-shadow-5 backdrop-blur-[5px]",children:(0,s.jsx)("div",{className:"overflow-hidden rounded-l-lg",children:(0,s.jsx)(j,{})})})})]}),a&&(0,s.jsx)(m.default,{title:e("conversion.confirm.title",{ns:"datasetPipeline"}),content:e("conversion.confirm.content",{ns:"datasetPipeline"}),isShow:a,onConfirm:w,onCancel:b,isLoading:r,isDisabled:r})]})});var v=e.i(360766);e.i(275225);var y=e.i(705405);e.i(160186);var N=e.i(412008),S=e.i(313111),k=e.i(168408),C=e.i(342746),P=e.i(316462),D=e.i(21734),L=e.i(853484),T=e.i(648404),I=e.i(480600);let A=()=>{let e=(0,y.useStore)(e=>e.pipelineId),s=(0,y.useStore)(e=>e.fileUploadConfig);return(0,t.useMemo)(()=>({flowId:e,flowType:I.FlowType.ragPipeline,fileSettings:{image:{enabled:!1,detail:T.Resolution.high,number_limits:3,transfer_methods:[T.TransferMethod.local_file,T.TransferMethod.remote_url]},fileUploadConfig:s}}),[e])};var E=e.i(684498),_=e.i(959752),R=e.i(16060);e.i(845780);var F=e.i(804612),M=e.i(568603),W=e.i(249420),$=e.i(337132),z=e.i(447362),U=e.i(120219),B=e.i(265522),O=e.i(95131),V=e.i(616332),K=e.i(390622),G=e.i(997908),H=e.i(233697),Q=e.i(525160);let X=(0,H.default)(()=>e.A(622938),{loadableGenerated:{modules:[689516]},ssr:!1}),Y=(0,H.default)(()=>e.A(577475),{loadableGenerated:{modules:[663443]},ssr:!1}),q=(0,H.default)(()=>e.A(672112),{loadableGenerated:{modules:[283916]},ssr:!1}),J=(0,H.default)(()=>e.A(640692),{loadableGenerated:{modules:[883816]},ssr:!1}),Z=(0,H.default)(()=>e.A(289356),{loadableGenerated:{modules:[645423]},ssr:!1}),ee=(0,H.default)(()=>e.A(665761),{loadableGenerated:{modules:[932933]},ssr:!1}),es=()=>{let e=(0,y.useStore)(e=>e.historyWorkflowData),t=(0,y.useStore)(e=>e.showDebugAndPreviewPanel),i=(0,y.useStore)(e=>e.showGlobalVariablePanel);return(0,s.jsxs)(s.Fragment,{children:[e&&(0,s.jsx)(X,{}),t&&(0,s.jsx)(Y,{}),i&&(0,s.jsx)(ee,{})]})},et=()=>{let e=(0,y.useStore)(e=>e.showInputFieldPanel),t=(0,y.useStore)(e=>e.showInputFieldPreviewPanel),i=(0,y.useStore)(e=>e.inputFieldEditPanelProps);return(0,s.jsxs)(s.Fragment,{children:[t&&(0,s.jsx)(Z,{}),i&&(0,s.jsx)(J,{...i}),e&&(0,s.jsx)(q,{})]})},ei=(0,t.memo)(()=>{let e=(0,y.useStore)(e=>e.pipelineId),i=(0,t.useMemo)(()=>({getVersionListUrl:`/rag/pipelines/${e}/workflows`,deleteVersionUrl:s=>`/rag/pipelines/${e}/workflows/${s}`,updateVersionUrl:s=>`/rag/pipelines/${e}/workflows/${s}`,latestVersionId:""}),[e]),a=(0,t.useMemo)(()=>({components:{left:(0,s.jsx)(et,{}),right:(0,s.jsx)(es,{})},versionHistoryPanelProps:i}),[i]);return(0,s.jsx)(Q.default,{...a})});var ea=e.i(837699);let el=(0,t.memo)(()=>{let{t:e}=(0,c.useTranslation)(),i=(0,y.useStore)(e=>e.publishedAt),[a,l]=(0,t.useState)(!1);return i||a?null:(0,s.jsx)("div",{className:"pointer-events-none absolute bottom-[45px] left-0 right-0 z-10 flex justify-center",children:(0,s.jsxs)("div",{className:"relative flex w-[420px] space-x-1 overflow-hidden rounded-xl border border-components-panel-border bg-components-panel-bg-blur p-3 shadow-lg",children:[(0,s.jsx)("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-r from-components-badge-status-light-normal-halo to-background-gradient-mask-transparent opacity-[0.4]"}),(0,s.jsx)("div",{className:"flex h-6 w-6 items-center justify-center",children:(0,s.jsx)(ea.RiInformation2Fill,{className:"text-text-accent"})}),(0,s.jsxs)("div",{className:"p-1",children:[(0,s.jsx)("div",{className:"system-sm-semibold mb-1 text-text-primary",children:e("publishToast.title",{ns:"pipeline"})}),(0,s.jsx)("div",{className:"system-xs-regular text-text-secondary",children:e("publishToast.desc",{ns:"pipeline"})})]}),(0,s.jsx)("div",{className:"pointer-events-auto flex h-6 w-6 cursor-pointer items-center justify-center",onClick:()=>l(!0),children:(0,s.jsx)(ea.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})})]})})});var en=e.i(576597);e.i(661734);var er=e.i(505816);let eo=()=>{let{t:e}=(0,c.useTranslation)(),i=(0,y.useStore)(e=>e.setShowInputFieldPanel),a=(0,y.useStore)(e=>e.setShowEnvPanel),l=(0,t.useCallback)(()=>{i?.(!0),a(!1)},[i,a]);return(0,s.jsxs)(d.default,{variant:"secondary",className:"flex gap-x-0.5",onClick:l,children:[(0,s.jsx)(er.InputField,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"px-0.5",children:e("inputField",{ns:"datasetPipeline"})})]})};var ec=e.i(391185),ed=e.i(604208),em=e.i(417944),eu=e.i(250755),ep=e.i(554327),ex=e.i(321734);e.i(201987);var eh=e.i(207331),ef=e.i(757198);e.i(432024);var ew=e.i(845255),eg=e.i(876359),ej=e.i(944419),eb=e.i(194902),ev=e.i(706416),ey=e.i(683257),eN=e.i(296124),eS=e.i(56971),ek=e.i(606466),eC=e.i(363372),eP=e.i(387852),eD=e.i(935139),eL=e.i(124836),eT=e.i(257899),eI=e.i(360972),eA=e.i(291631),eE=e.i(21151),e_=e.i(873517);let eR=e=>{let{confirmDisabled:i,onCancel:a,onConfirm:l}=e,{t:n}=(0,c.useTranslation)(),r=(0,y.useWorkflowStore)(),[o,m]=(0,t.useState)(()=>r.getState().knowledgeName),[u,p]=(0,t.useState)(()=>r.getState().knowledgeIcon),[x,h]=(0,t.useState)(""),[f,w]=(0,t.useState)(!1),g=(0,t.useCallback)(e=>{"image"===e.type&&p({icon_type:"image",icon_url:e.url,icon_background:"",icon:""}),"emoji"===e.type&&p({icon_type:"emoji",icon:e.icon,icon_background:e.background,icon_url:""}),w(!1)},[]),j=(0,t.useCallback)(()=>{p({icon_type:u.icon_type,icon:u.icon,icon_background:u.icon_background,icon_url:u.icon_url}),w(!1)},[u]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(eE.default,{isShow:!0,onClose:eL.noop,className:"relative !w-[520px] !p-0",children:[(0,s.jsxs)("div",{className:"title-2xl-semi-bold relative flex items-center p-6 pb-3 pr-14 text-text-primary",children:[n("common.publishAs",{ns:"pipeline"}),(0,s.jsx)("div",{"data-testid":"publish-modal-close-btn",className:"absolute right-5 top-5 flex h-8 w-8 cursor-pointer items-center justify-center",onClick:a,children:(0,s.jsx)(ea.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})})]}),(0,s.jsxs)("div",{className:"px-6 py-3",children:[(0,s.jsxs)("div",{className:"mb-5 flex",children:[(0,s.jsxs)("div",{className:"mr-3 grow",children:[(0,s.jsx)("div",{className:"system-sm-medium mb-1 flex h-6 items-center text-text-secondary",children:n("common.publishAsPipeline.name",{ns:"pipeline"})}),(0,s.jsx)(eA.default,{value:o,onChange:e=>m(e.target.value),placeholder:n("common.publishAsPipeline.namePlaceholder",{ns:"pipeline"})||""})]}),(0,s.jsx)(eT.default,{size:"xxl",onClick:()=>{w(!0)},className:"mt-2 shrink-0 cursor-pointer",iconType:u?.icon_type,icon:u?.icon,background:u?.icon_background,imageUrl:u?.icon_url})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"system-sm-medium mb-1 flex h-6 items-center text-text-secondary ",children:n("common.publishAsPipeline.description",{ns:"pipeline"})}),(0,s.jsx)(e_.default,{className:"resize-none",placeholder:n("common.publishAsPipeline.descriptionPlaceholder",{ns:"pipeline"})||"",value:x,onChange:e=>h(e.target.value)})]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-end px-6 py-5",children:[(0,s.jsx)(d.default,{className:"mr-2",onClick:a,children:n("operation.cancel",{ns:"common"})}),(0,s.jsx)(d.default,{disabled:!o?.trim()||i,variant:"primary",onClick:()=>void(!i&&l(o?.trim()||"",u,x?.trim())),children:n("common.publish",{ns:"workflow"})})]})]}),f&&(0,s.jsx)(eI.default,{onSelect:g,onClose:j})]})},eF=["ctrl","⇧","P"],eM=(0,t.memo)(()=>{let{t:e}=(0,c.useTranslation)(),{datasetId:i}=(0,o.useParams)(),{push:a}=(0,o.useRouter)(),l=(0,ey.useDocLink)(),n=(0,y.useStore)(e=>e.publishedAt),f=(0,y.useStore)(e=>e.draftUpdatedAt),w=(0,y.useStore)(e=>e.pipelineId),g=(0,r.useDatasetDetailContextWithSelector)(e=>e.mutateDatasetRes),[j,b]=(0,t.useState)(!1),{formatTimeFromNow:v}=(0,eC.useFormatTimeFromNow)(),{handleCheckBeforePublish:N}=(0,ej.useChecklistBeforePublish)(),{mutateAsync:S}=(0,eP.usePublishWorkflow)(),{notify:k}=(0,u.useToastContext)(),C=(0,y.useWorkflowStore)(),{isAllowPublishAsCustomKnowledgePipelineTemplate:P}=(0,eS.useProviderContext)(),D=(0,eN.useModalContextSelector)(e=>e.setShowPricingModal),L=(0,ek.useDatasetApiAccessUrl)(),[T,{setFalse:I,setTrue:A}]=(0,em.useBoolean)(!1),[E,{setFalse:_,setTrue:R}]=(0,em.useBoolean)(!1),{mutateAsync:F}=(0,h.usePublishAsCustomizedPipeline)(),[M,{setFalse:W,setTrue:$}]=(0,em.useBoolean)(!1),[z,{setFalse:U,setTrue:B}]=(0,em.useBoolean)(!1),O=(0,x.useInvalid)([...h.publishedPipelineInfoQueryKeyPrefix,w]),V=(0,p.useInvalidDatasetList)(),K=(0,t.useCallback)(async t=>{if(!E)try{if(await N()){if(!n&&!T)return void A();R();let a=await S({url:`/rag/pipelines/${w}/workflows/publish`,title:t?.title||"",releaseNotes:t?.releaseNotes||""});b(!0),(0,eh.trackEvent)("app_published_time",{action_mode:"pipeline",app_id:i,app_name:t?.title||""}),a&&(k({type:"success",message:e("publishPipeline.success.message",{ns:"datasetPipeline"}),children:(0,s.jsx)("div",{className:"system-xs-regular text-text-secondary",children:(0,s.jsx)(ex.Trans,{i18nKey:"publishPipeline.success.tip",ns:"datasetPipeline",components:{CustomLink:(0,s.jsx)(ep.default,{className:"system-xs-medium text-text-accent",href:`/datasets/${i}/documents`})}})})}),C.getState().setPublishedAt(a.created_at),g?.(),O(),V())}}catch{k({type:"error",message:e("publishPipeline.error.message",{ns:"datasetPipeline"})})}finally{E&&_(),T&&I()}},[N,S,w,k,e,C,g,O,A,n,T,_,R,I,E]);(0,eu.useKeyPress)(`${(0,ev.getKeyboardKeyCodeBySystem)("ctrl")}.shift.p`,e=>{e.preventDefault(),j||K()},{exactMatch:!0,useCapture:!0});let G=(0,t.useCallback)(()=>{a(`/datasets/${i}/documents/create-from-pipeline`)},[i,a]),H=(0,h.useInvalidCustomizedTemplateList)(),Q=(0,t.useCallback)(async(t,i,a)=>{try{B(),await F({pipelineId:w||"",name:t,icon_info:i,description:a}),k({type:"success",message:e("publishTemplate.success.message",{ns:"datasetPipeline"}),children:(0,s.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,s.jsx)("span",{className:"system-xs-regular text-text-secondary",children:e("publishTemplate.success.tip",{ns:"datasetPipeline"})}),(0,s.jsx)(ep.default,{href:l(),target:"_blank",className:"system-xs-medium-uppercase inline-block text-text-accent",children:e("publishTemplate.success.learnMore",{ns:"datasetPipeline"})})]})}),H()}catch{k({type:"error",message:e("publishTemplate.error.message",{ns:"datasetPipeline"})})}finally{U(),W()}},[w,F,B,U,W,k,e]),X=(0,t.useCallback)(()=>{P?$():D()},[P,$,D]);return(0,s.jsxs)("div",{className:(0,eD.cn)("rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-xl shadow-shadow-shadow-5",P?"w-[360px]":"w-[400px]"),children:[(0,s.jsxs)("div",{className:"p-4 pt-3",children:[(0,s.jsx)("div",{className:"system-xs-medium-uppercase flex h-6 items-center text-text-tertiary",children:n?e("common.latestPublished",{ns:"workflow"}):e("common.currentDraftUnpublished",{ns:"workflow"})}),n?(0,s.jsx)("div",{className:"flex items-center justify-between",children:(0,s.jsxs)("div",{className:"system-sm-medium flex items-center text-text-secondary",children:[e("common.publishedAt",{ns:"workflow"})," ",v(n)]})}):(0,s.jsxs)("div",{className:"system-sm-medium flex items-center text-text-secondary",children:[e("common.autoSaved",{ns:"workflow"})," ","·",!!f&&v(f)]}),(0,s.jsx)(d.default,{variant:"primary",className:"mt-3 w-full",onClick:()=>K(),disabled:j||E,children:j?e("common.published",{ns:"workflow"}):(0,s.jsxs)("div",{className:"flex gap-1",children:[(0,s.jsx)("span",{children:e("common.publishUpdate",{ns:"workflow"})}),(0,s.jsx)(eb.default,{keys:eF,bgColor:"white"})]})})]}),(0,s.jsxs)("div",{className:"border-t-[0.5px] border-t-divider-regular p-4 pt-3",children:[(0,s.jsxs)(d.default,{className:"mb-1 w-full hover:bg-state-accent-hover hover:text-text-accent",variant:"tertiary",onClick:G,disabled:!n,children:[(0,s.jsxs)("div",{className:"flex grow items-center",children:[(0,s.jsx)(ea.RiPlayCircleLine,{className:"mr-2 h-4 w-4"}),e("common.goToAddDocuments",{ns:"pipeline"})]}),(0,s.jsx)(ea.RiArrowRightUpLine,{className:"ml-2 h-4 w-4 shrink-0"})]}),(0,s.jsx)(ep.default,{href:L,target:"_blank",rel:"noopener noreferrer",children:(0,s.jsxs)(d.default,{className:"w-full hover:bg-state-accent-hover hover:text-text-accent",variant:"tertiary",disabled:!n,children:[(0,s.jsxs)("div",{className:"flex grow items-center",children:[(0,s.jsx)(ea.RiTerminalBoxLine,{className:"mr-2 h-4 w-4"}),e("common.accessAPIReference",{ns:"workflow"})]}),(0,s.jsx)(ea.RiArrowRightUpLine,{className:"ml-2 h-4 w-4 shrink-0"})]})}),(0,s.jsx)(ef.default,{className:"my-2"}),(0,s.jsx)(d.default,{className:"w-full hover:bg-state-accent-hover hover:text-text-accent",variant:"tertiary",onClick:X,disabled:!n||z,children:(0,s.jsxs)("div",{className:"flex grow items-center gap-x-2 overflow-hidden",children:[(0,s.jsx)(ea.RiHammerLine,{className:"h-4 w-4 shrink-0"}),(0,s.jsx)("span",{className:"grow truncate text-left",title:e("common.publishAs",{ns:"pipeline"}),children:e("common.publishAs",{ns:"pipeline"})}),!P&&(0,s.jsxs)(eg.default,{className:"shrink-0 cursor-pointer select-none",size:"s",color:"indigo",children:[(0,s.jsx)(ew.SparklesSoft,{className:"flex size-3 items-center text-components-premium-badge-indigo-text-stop-0"}),(0,s.jsx)("span",{className:"system-2xs-medium p-0.5",children:e("upgradeBtn.encourageShort",{ns:"billing"})})]})]})})]}),T&&(0,s.jsx)(m.default,{isShow:T,title:e("common.confirmPublish",{ns:"pipeline"}),content:e("common.confirmPublishContent",{ns:"pipeline"}),onCancel:I,onConfirm:K,isDisabled:E}),M&&(0,s.jsx)(eR,{confirmDisabled:z,onConfirm:Q,onCancel:W})]})}),eW=(0,t.memo)(()=>{let{t:e}=(0,c.useTranslation)(),[i,a]=(0,t.useState)(!1),{handleSyncWorkflowDraft:l}=(0,ed.useNodesSyncDraft)(),n=(0,t.useCallback)(e=>{e&&l(!0),a(e)},[l]);return(0,s.jsxs)(ec.PortalToFollowElem,{open:i,onOpenChange:a,placement:"bottom-end",offset:{mainAxis:4,crossAxis:40},children:[(0,s.jsx)(ec.PortalToFollowElemTrigger,{onClick:()=>n(!i),children:(0,s.jsxs)(d.default,{className:"px-2",variant:"primary",children:[(0,s.jsx)("span",{className:"pl-1",children:e("common.publish",{ns:"workflow"})}),(0,s.jsx)(ea.RiArrowDownSLine,{className:"h-4 w-4"})]})}),(0,s.jsx)(ec.PortalToFollowElemContent,{className:"z-[11]",children:(0,s.jsx)(eM,{})})]})});e.i(27905);var e$=e.i(348042),ez=e.i(556354),eU=e.i(886485),eB=e.i(443523);let eO=t.memo(e=>{let{text:i}=e,{t:a}=(0,c.useTranslation)(),{handleWorkflowStartRunInWorkflow:l}=(0,eU.useWorkflowStartRun)(),{handleStopRun:n}=(0,ez.useWorkflowRun)(),r=(0,y.useWorkflowStore)(),o=(0,y.useStore)(e=>e.workflowRunningData),d=(0,y.useStore)(e=>e.isPreparingDataSource),m=o?.result.status===K.WorkflowRunningStatus.Running,u=d||m,p=(0,t.useCallback)(()=>{n(o?.task_id||"")},[n,o?.task_id]),x=(0,t.useCallback)(()=>{let{setIsPreparingDataSource:e,setShowDebugAndPreviewPanel:s}=r.getState();e?.(!1),s(!1)},[r]),{eventEmitter:h}=(0,W.useEventEmitterContextContext)();return h?.useSubscription(e=>{e.type===eB.EVENT_WORKFLOW_STOP&&p()}),(0,s.jsxs)("div",{className:"flex items-center gap-x-px",children:[(0,s.jsxs)("button",{type:"button",className:(0,eD.cn)("system-xs-medium flex h-7 items-center gap-x-1 px-1.5 text-text-accent hover:bg-state-accent-hover",u&&"cursor-not-allowed bg-state-accent-hover",u?"rounded-l-md":"rounded-md"),onClick:()=>{l()},disabled:u,children:[!u&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ea.RiPlayLargeLine,{className:"mr-1 size-4"}),o?a("common.reRun",{ns:"pipeline"}):i??a("common.testRun",{ns:"pipeline"})]}),m&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ea.RiLoader2Line,{className:"mr-1 size-4 animate-spin"}),a("common.processing",{ns:"pipeline"})]}),d&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ea.RiDatabase2Line,{className:"mr-1 size-4"}),a("common.preparingDataSource",{ns:"pipeline"})]}),!u&&(0,s.jsx)(eb.default,{keys:["alt","R"],textColor:"secondary"})]}),m&&(0,s.jsx)("button",{type:"button",className:(0,eD.cn)("flex size-7 items-center justify-center rounded-r-md bg-state-accent-active"),onClick:p,children:(0,s.jsx)(e$.StopCircle,{className:"size-4 text-text-accent"})}),d&&(0,s.jsx)("button",{type:"button",className:(0,eD.cn)("flex size-7 items-center justify-center rounded-r-md bg-state-accent-active"),onClick:x,children:(0,s.jsx)(ea.RiCloseLine,{className:"size-4 text-text-accent"})})]})}),eV=(0,t.memo)(()=>{let e=(0,y.useStore)(e=>e.pipelineId),i=(0,t.useMemo)(()=>({historyUrl:`/rag/pipelines/${e}/workflow-runs`}),[e]),a=(0,t.useMemo)(()=>({normal:{components:{left:(0,s.jsx)(eo,{}),middle:(0,s.jsx)(eW,{})},runAndHistoryProps:{showRunButton:!0,viewHistoryProps:i,components:{RunMode:eO}}},viewHistory:{viewHistoryProps:i}}),[i]);return(0,s.jsx)(en.default,{...a})});var eK=e.i(339548),eG=e.i(930453),eH=e.i(967484),eQ=e.i(815488),eX=e.i(141696);let eY=(0,t.memo)(e=>{let{onCancel:i,onBackup:a,onImport:l}=e,{t:r}=(0,c.useTranslation)(),{notify:o}=(0,eK.useContext)(u.ToastContext),[m,p]=(0,t.useState)(),[x,f]=(0,t.useState)(),[w,g]=(0,t.useState)(!1),{eventEmitter:j}=(0,W.useEventEmitterContextContext)(),[b,v]=(0,t.useState)(!0),[N,S]=(0,t.useState)(!1),[k,C]=(0,t.useState)(),[P,D]=(0,t.useState)(),{handleCheckPluginDependencies:L}=(0,eH.usePluginDependencies)(),{mutateAsync:T}=(0,h.useImportPipelineDSL)(),{mutateAsync:I}=(0,h.useImportPipelineDSLConfirm)(),A=(0,y.useWorkflowStore)(),E=(0,t.useCallback)(async e=>{let{graph:s,hash:t,rag_pipeline_variables:i}=await (0,eX.fetchWorkflowDraft)(`/rag/pipelines/${e}/workflows/draft`),{nodes:a,edges:l,viewport:r}=s;j?.emit({type:_.WORKFLOW_DATA_UPDATE,payload:{nodes:(0,n.initialNodes)(a,l),edges:(0,n.initialEdges)(l,a),viewport:r,hash:t,rag_pipeline_variables:i||[]}})},[j]),R=(0,t.useRef)(!1),F=(0,t.useCallback)(async()=>{let{pipelineId:e}=A.getState();if(!R.current&&(R.current=!0,m)){try{if(e&&x){g(!0);let{id:s,status:t,pipeline_id:a,imported_dsl_version:n,current_dsl_version:c}=await T({mode:eQ.DSLImportMode.YAML_CONTENT,yaml_content:x,pipeline_id:e});if(t===eQ.DSLImportStatus.COMPLETED||t===eQ.DSLImportStatus.COMPLETED_WITH_WARNINGS){if(!a)return void o({type:"error",message:r("common.importFailure",{ns:"workflow"})});E(a),l&&l(),o({type:t===eQ.DSLImportStatus.COMPLETED?"success":"warning",message:r(t===eQ.DSLImportStatus.COMPLETED?"common.importSuccess":"common.importWarning",{ns:"workflow"}),children:t===eQ.DSLImportStatus.COMPLETED_WITH_WARNINGS&&r("common.importWarningDetails",{ns:"workflow"})}),await L(a,!0),g(!1),i()}else t===eQ.DSLImportStatus.PENDING?(v(!1),setTimeout(()=>{S(!0)},300),C({importedVersion:n??"",systemVersion:c??""}),D(s)):(g(!1),o({type:"error",message:r("common.importFailure",{ns:"workflow"})}))}}catch(e){g(!1),o({type:"error",message:r("common.importFailure",{ns:"workflow"})})}R.current=!1}},[m,x,i,o,r,l,E,L,A,T]),M=async()=>{try{if(!P)return;let{status:e,pipeline_id:s}=await I(P);if(e===eQ.DSLImportStatus.COMPLETED){if(!s)return void o({type:"error",message:r("common.importFailure",{ns:"workflow"})});E(s),await L(s,!0),l&&l(),o({type:"success",message:r("common.importSuccess",{ns:"workflow"})}),g(!1),i()}else e===eQ.DSLImportStatus.FAILED&&(g(!1),o({type:"error",message:r("common.importFailure",{ns:"workflow"})}))}catch(e){g(!1),o({type:"error",message:r("common.importFailure",{ns:"workflow"})})}};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(eE.default,{className:"w-[520px] rounded-2xl p-6",isShow:b,onClose:i,children:[(0,s.jsxs)("div",{className:"mb-3 flex items-center justify-between",children:[(0,s.jsx)("div",{className:"title-2xl-semi-bold text-text-primary",children:r("common.importDSL",{ns:"workflow"})}),(0,s.jsx)("div",{className:"flex h-[22px] w-[22px] cursor-pointer items-center justify-center",onClick:i,children:(0,s.jsx)(ea.RiCloseLine,{className:"h-[18px] w-[18px] text-text-tertiary"})})]}),(0,s.jsxs)("div",{className:"relative mb-2 flex grow gap-0.5 overflow-hidden rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur p-2 shadow-xs",children:[(0,s.jsx)("div",{className:"absolute left-0 top-0 h-full w-full bg-toast-warning-bg opacity-40"}),(0,s.jsx)("div",{className:"flex items-start justify-center p-1",children:(0,s.jsx)(ea.RiAlertFill,{className:"h-4 w-4 shrink-0 text-text-warning-secondary"})}),(0,s.jsxs)("div",{className:"flex grow flex-col items-start gap-0.5 py-1",children:[(0,s.jsx)("div",{className:"system-xs-medium whitespace-pre-line text-text-primary",children:r("common.importDSLTip",{ns:"workflow"})}),(0,s.jsx)("div",{className:"flex items-start gap-1 self-stretch pb-0.5 pt-1",children:(0,s.jsxs)(d.default,{size:"small",variant:"secondary",className:"z-[1000]",onClick:a,children:[(0,s.jsx)(ea.RiFileDownloadLine,{className:"h-3.5 w-3.5 text-components-button-secondary-text"}),(0,s.jsx)("div",{className:"flex items-center justify-center gap-1 px-[3px]",children:r("common.backupCurrentDraft",{ns:"workflow"})})]})})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"system-md-semibold pt-2 text-text-primary",children:r("common.chooseDSL",{ns:"workflow"})}),(0,s.jsx)("div",{className:"flex w-full flex-col items-start justify-center gap-4 self-stretch py-4",children:(0,s.jsx)(eG.default,{file:m,updateFile:e=>{let s;p(e),e&&((s=new FileReader).onload=function(e){f(e.target?.result)},s.readAsText(e)),e||f("")},className:"!mt-0 w-full",accept:".pipeline",displayName:"PIPELINE"})})]}),(0,s.jsxs)("div",{className:"flex items-center justify-end gap-2 self-stretch pt-5",children:[(0,s.jsx)(d.default,{onClick:i,children:r("newApp.Cancel",{ns:"app"})}),(0,s.jsx)(d.default,{disabled:!m||w,variant:"warning",onClick:F,loading:w,children:r("common.overwriteAndImport",{ns:"workflow"})})]})]}),(0,s.jsxs)(eE.default,{isShow:N,onClose:()=>S(!1),className:"w-[480px]",children:[(0,s.jsxs)("div",{className:"flex flex-col items-start gap-2 self-stretch pb-4",children:[(0,s.jsx)("div",{className:"title-2xl-semi-bold text-text-primary",children:r("newApp.appCreateDSLErrorTitle",{ns:"app"})}),(0,s.jsxs)("div",{className:"system-md-regular flex grow flex-col text-text-secondary",children:[(0,s.jsx)("div",{children:r("newApp.appCreateDSLErrorPart1",{ns:"app"})}),(0,s.jsx)("div",{children:r("newApp.appCreateDSLErrorPart2",{ns:"app"})}),(0,s.jsx)("br",{}),(0,s.jsxs)("div",{children:[r("newApp.appCreateDSLErrorPart3",{ns:"app"}),(0,s.jsx)("span",{className:"system-md-medium",children:k?.importedVersion})]}),(0,s.jsxs)("div",{children:[r("newApp.appCreateDSLErrorPart4",{ns:"app"}),(0,s.jsx)("span",{className:"system-md-medium",children:k?.systemVersion})]})]})]}),(0,s.jsxs)("div",{className:"flex items-start justify-end gap-2 self-stretch pt-6",children:[(0,s.jsx)(d.default,{variant:"secondary",onClick:()=>S(!1),children:r("newApp.Cancel",{ns:"app"})}),(0,s.jsx)(d.default,{variant:"primary",destructive:!0,onClick:M,children:r("newApp.Confirm",{ns:"app"})})]})]})]})}),eq=(0,t.memo)(()=>{let{eventEmitter:e}=(0,W.useEventEmitterContextContext)(),[i,a]=(0,t.useState)([]),l=(0,y.useStore)(e=>e.showImportDSLModal),n=(0,y.useStore)(e=>e.setShowImportDSLModal),{handlePaneContextmenuCancel:r}=(0,M.usePanelInteractions)(),{exportCheck:o,handleExportDSL:c}=(0,F.useDSL)();return(()=>{let e=(0,V.default)(),{handleNodeSelect:i}=(0,B.useNodesInteractions)(),a=(0,O.useGetToolIcon)(),l=(0,t.useMemo)(()=>e.map(e=>{let s=e.data,t=s.title||s.type||"Untitled Node",i=s.desc||"";return s.type===K.BlockEnum.Tool&&(i=s.tool_description||s.tool_label||i),s.type===K.BlockEnum.LLM&&s.model?.provider&&s.model?.name&&(i=`${s.model.name} (${s.model.provider}) - ${s.model.mode||i}`),s.type===K.BlockEnum.KnowledgeRetrieval&&s.dataset_ids?.length&&(i=`Knowledge Retrieval with ${s.dataset_ids.length} datasets - ${i}`),{id:e.id,title:t,desc:i,type:s.type,blockType:s.type,nodeData:s,toolIcon:a(s),modelInfo:s.type===K.BlockEnum.LLM?{provider:s.model?.provider,name:s.model?.name,mode:s.model?.mode}:{provider:void 0,name:void 0,mode:void 0}}}),[e,a]),n=(0,t.useCallback)((e,s)=>{if(!s)return 1;let t=0,i=s.toLowerCase();return e.title.toLowerCase().includes(i)&&(t+=10),e.type.toLowerCase().includes(i)&&(t+=8),e.desc.toLowerCase().includes(i)&&(t+=5),e.modelInfo.provider?.toLowerCase().includes(i)&&(t+=6),e.modelInfo.name?.toLowerCase().includes(i)&&(t+=6),e.modelInfo.mode?.toLowerCase().includes(i)&&(t+=4),t},[]),r=(0,t.useCallback)(e=>{if(!l.length)return[];let t=e.toLowerCase().trim();return l.map(e=>{let i=n(e,t);return i>0?{id:e.id,title:e.title,description:e.desc||e.type,type:"workflow-node",path:`#${e.id}`,icon:(0,s.jsx)(U.default,{type:e.blockType,className:"shrink-0",size:"sm",toolIcon:e.toolIcon}),metadata:{nodeId:e.id,nodeData:e.nodeData},data:e.nodeData,score:i}:null}).filter(e=>null!==e).sort((e,s)=>t?(s.score||0)-(e.score||0):e.title.localeCompare(s.title))},[l,n]);return(0,t.useEffect)(()=>(l.length>0&&(z.ragPipelineNodesAction.searchFn=r),()=>{z.ragPipelineNodesAction.searchFn=void 0}),[l,r]),(0,t.useEffect)(()=>(0,G.setupNodeSelectionListener)(i),[i])})(),e?.useSubscription(e=>{e.type===_.DSL_EXPORT_CHECK&&a(e.payload.data)}),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)($.default,{}),l&&(0,s.jsx)(eY,{onCancel:()=>n(!1),onBackup:o,onImport:r}),i.length>0&&(0,s.jsx)(R.default,{envList:i,onConfirm:c,onClose:()=>a([])}),(0,s.jsx)(eV,{}),(0,s.jsx)(ei,{}),(0,s.jsx)(el,{})]})}),eJ=e=>{let i,{nodes:l,edges:n,viewport:r}=e,o=(0,y.useWorkflowStore)(),c=(0,t.useCallback)(e=>{let{rag_pipeline_variables:s,environment_variables:t}=e;if(s){let{setRagPipelineVariables:e}=o.getState();e?.(s)}if(t){let{setEnvironmentVariables:e}=o.getState();e(t)}},[o]),{doSyncWorkflowDraft:d,syncWorkflowDraftWhenPageClose:m}=(0,C.useNodesSyncDraft)(),{handleRefreshWorkflowDraft:u}=(0,P.usePipelineRefreshDraft)(),{handleBackupDraft:p,handleLoadBackupDraft:x,handleRestoreFromPublishedWorkflow:h,handleRun:f,handleStopRun:w}=(0,D.usePipelineRun)(),{handleStartWorkflowRun:g,handleWorkflowStartRunInWorkflow:j}=(0,L.usePipelineStartRun)(),b=(0,N.useAvailableNodesMetaData)(),{getWorkflowRunAndTraceUrl:T}=(0,k.useGetRunAndTraceUrl)(),{exportCheck:I,handleExportDSL:_}=(0,S.useDSL)(),R=A(),{fetchInspectVars:F}=(0,v.useSetWorkflowVarsWithValue)({...R}),{hasNodeInspectVars:M,hasSetInspectVar:W,fetchInspectVarValue:$,editInspectVarValue:z,renameInspectVarName:U,appendNodeInspectVars:B,deleteInspectVar:O,deleteNodeInspectorVars:V,deleteAllInspectorVars:K,isInspectVarEdited:G,resetToLastRunVar:H,invalidateSysVarValues:Q,resetConversationVar:X,invalidateConversationVarValues:Y}=(i=A(),{...(0,E.useInspectVarsCrudCommon)({...i})}),q=(0,t.useMemo)(()=>({availableNodesMetaData:b,syncWorkflowDraftWhenPageClose:m,doSyncWorkflowDraft:d,handleRefreshWorkflowDraft:u,handleBackupDraft:p,handleLoadBackupDraft:x,handleRestoreFromPublishedWorkflow:h,handleRun:f,handleStopRun:w,handleStartWorkflowRun:g,handleWorkflowStartRunInWorkflow:j,getWorkflowRunAndTraceUrl:T,exportCheck:I,handleExportDSL:_,fetchInspectVars:F,hasNodeInspectVars:M,hasSetInspectVar:W,fetchInspectVarValue:$,editInspectVarValue:z,renameInspectVarName:U,appendNodeInspectVars:B,deleteInspectVar:O,deleteNodeInspectorVars:V,deleteAllInspectorVars:K,isInspectVarEdited:G,resetToLastRunVar:H,invalidateSysVarValues:Q,resetConversationVar:X,invalidateConversationVarValues:Y,configsMap:R}),[b,m,d,u,p,x,h,f,w,g,j,T,I,_,F,M,W,$,z,U,B,O,V,K,G,H,Q,X,Y,R]);return(0,s.jsx)(a.WorkflowWithInnerContext,{nodes:l,edges:n,viewport:r,hooksStore:q,onWorkflowDataUpdate:c,children:(0,s.jsx)(eq,{})})};var eZ=e.i(138957),e0=e.i(464747);let e1=e=>({pipelineId:"",knowledgeName:"",showInputFieldPanel:!1,setShowInputFieldPanel:s=>e(()=>({showInputFieldPanel:s})),showInputFieldPreviewPanel:!1,setShowInputFieldPreviewPanel:s=>e(()=>({showInputFieldPreviewPanel:s})),inputFieldEditPanelProps:null,setInputFieldEditPanelProps:s=>e(()=>({inputFieldEditPanelProps:s})),nodesDefaultConfigs:{},setNodesDefaultConfigs:s=>e(()=>({nodesDefaultConfigs:s})),ragPipelineVariables:[],setRagPipelineVariables:s=>e(()=>({ragPipelineVariables:s})),dataSourceList:[],setDataSourceList:s=>{let t=s.map(e=>(0,e0.transformDataSourceToTool)(e));e(()=>({dataSourceList:t}))},isPreparingDataSource:!1,setIsPreparingDataSource:s=>e(()=>({isPreparingDataSource:s}))});e.i(656391);var e4=e.i(609211);let e2=()=>{let{data:e,isLoading:l}=(0,eZ.usePipelineInit)(),r=(0,t.useMemo)(()=>e?(0,n.initialNodes)(e.graph.nodes,e.graph.edges):[],[e]),o=(0,t.useMemo)(()=>e?(0,n.initialEdges)(e.graph.edges,e.graph.nodes):[],[e]);if(!e||l)return(0,s.jsx)("div",{className:"relative flex h-full w-full items-center justify-center",children:(0,s.jsx)(i.default,{})});let{nodes:c,viewport:d}=(0,e4.processNodesWithoutDataSource)(r,e.graph.viewport);return(0,s.jsx)(a.default,{edges:o,nodes:c,children:(0,s.jsx)(eJ,{edges:o,nodes:c,viewport:d})})},e5=()=>(0,r.useDatasetDetailContextWithSelector)(e=>e.dataset?.pipeline_id)?(0,s.jsx)(l.WorkflowContextProvider,{injectWorkflowStoreSliceFn:e1,children:(0,s.jsx)(e2,{})}):(0,s.jsx)(b,{});e.s(["default",0,()=>(0,s.jsx)("div",{className:"h-full w-full overflow-x-auto",children:(0,s.jsx)(e5,{})})],540136)}]);
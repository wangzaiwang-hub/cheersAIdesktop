(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,622085,e=>{"use strict";var l=e.i(563199),t=e.i(268255);e.i(152567);var s=e.i(408767),a=e.i(21151),i=e.i(137667),n=e.i(222573),r=e.i(935139),o=e.i(944911),c=e.i(568349),d=e.i(908132),u=e.i(664826),p=e.i(632717),m=e.i(228403),g=e.i(837699),f=e.i(151094),x=e.i(99649),b=e.i(887460),h=e.i(157644),y=e.i(365181),F=e.i(745754),j=e.i(292005);let I="installModal",S=e=>{let{updatePayload:a,uniqueIdentifier:i,payload:n,repoUrl:r,selectedVersion:c,selectedPackage:d,onBack:u,onStartToInstall:p,onInstalled:S,onFailed:v}=e,{t:H}=(0,s.useTranslation)(),k=n.version,G=n.plugin_id,{installedInfo:P,isLoading:N}=(0,x.default)({pluginIds:[G],enabled:!!G}),w=P?.[G],U=w?.installedVersion,C=!!U,[$,T]=t.useState(!1),{mutateAsync:V}=(0,h.useInstallPackageFromGitHub)(),{handleRefetch:M}=(0,h.usePluginTaskList)(n.category),{check:R}=(0,F.default)();(0,t.useEffect)(()=>{C&&i===w.uniqueIdentifier&&S()},[C]);let q=async()=>{if(!$){T(!0),p?.();try{let e,l,{owner:t,repo:s}=(0,m.parseGitHubUrl)(r);if(a){let{all_installed:n,task_id:r}=await (0,b.updateFromGitHub)(`${t}/${s}`,c,d,a.originalPackageInfo.id,i);e=r,l=n}else if(C){let{all_installed:a,task_id:n}=await (0,b.updateFromGitHub)(`${t}/${s}`,c,d,w.uniqueIdentifier,i);e=n,l=a}else{let{all_installed:a,task_id:n}=await V({repoUrl:`${t}/${s}`,selectedVersion:c,selectedPackage:d,uniqueIdentifier:i});e=n,l=a}if(l)return void S();M();let{status:n,error:u}=await R({taskId:e,pluginUniqueIdentifier:i});if(n===o.TaskStatus.failed)return void v(u);S(!0)}catch(e){if("string"==typeof e)return void v(e);v()}finally{T(!1)}}};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"system-md-regular text-text-secondary",children:(0,l.jsx)("p",{children:H(`${I}.readyToInstall`,{ns:"plugin"})})}),(0,l.jsx)("div",{className:"flex flex-wrap content-start items-start gap-1 self-stretch rounded-2xl bg-background-section-burn p-2",children:(0,l.jsx)(y.default,{className:"w-full",payload:(0,m.pluginManifestToCardPluginProps)(n),titleLeft:!N&&(0,l.jsx)(j.default,{hasInstalled:C,installedVersion:U,toInstallVersion:k})})}),(0,l.jsxs)("div",{className:"mt-4 flex items-center justify-end gap-2 self-stretch",children:[!$&&(0,l.jsx)(f.default,{variant:"secondary",className:"min-w-[72px]",onClick:u,children:H("installModal.back",{ns:"plugin"})}),(0,l.jsxs)(f.default,{variant:"primary",className:"flex min-w-[72px] space-x-0.5",onClick:q,disabled:$||N,children:[$&&(0,l.jsx)(g.RiLoader2Line,{className:"h-4 w-4 animate-spin-slow"}),(0,l.jsx)("span",{children:H(`${I}.${$?"installing":"install"}`,{ns:"plugin"})})]})]})]})};var v=e.i(299951);let H="installFromGitHub",k=e=>{let{updatePayload:a,repoUrl:i,selectedVersion:n,versions:r,onSelectVersion:o,selectedPackage:c,packages:u,onSelectPackage:p,onUploaded:m,onFailed:g,onBack:x}=e,{t:b}=(0,s.useTranslation)(),h=!!a,[y,F]=t.useState(!1),{handleUpload:j}=(0,d.useGitHubUpload)(),I=async()=>{if(!y){F(!0);try{let e=i.replace("https://github.com/","");await j(e,n,c,e=>{m({uniqueIdentifier:e.unique_identifier,manifest:e.manifest})})}catch(e){e.response?.message?g(e.response?.message):g(b(`${H}.uploadFailed`,{ns:"plugin"}))}finally{F(!1)}}};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("label",{htmlFor:"version",className:"flex flex-col items-start justify-center self-stretch text-text-secondary",children:(0,l.jsx)("span",{className:"system-sm-semibold",children:b(`${H}.selectVersion`,{ns:"plugin"})})}),(0,l.jsx)(v.PortalSelect,{value:n,onSelect:o,items:r,installedValue:a?.originalPackageInfo.version,placeholder:b(`${H}.selectVersionPlaceholder`,{ns:"plugin"})||"",popupClassName:"w-[512px] z-[1001]",triggerClassName:"text-components-input-text-filled"}),(0,l.jsx)("label",{htmlFor:"package",className:"flex flex-col items-start justify-center self-stretch text-text-secondary",children:(0,l.jsx)("span",{className:"system-sm-semibold",children:b(`${H}.selectPackage`,{ns:"plugin"})})}),(0,l.jsx)(v.PortalSelect,{value:c,onSelect:p,items:u,readonly:!n,placeholder:b(`${H}.selectPackagePlaceholder`,{ns:"plugin"})||"",popupClassName:"w-[512px] z-[1001]",triggerClassName:"text-components-input-text-filled"}),(0,l.jsxs)("div",{className:"mt-4 flex items-center justify-end gap-2 self-stretch",children:[!h&&(0,l.jsx)(f.default,{variant:"secondary",className:"min-w-[72px]",onClick:x,disabled:y,children:b("installModal.back",{ns:"plugin"})}),(0,l.jsx)(f.default,{variant:"primary",className:"min-w-[72px]",onClick:I,disabled:!n||!c||y,children:b("installModal.next",{ns:"plugin"})})]})]})},G=e=>{let{repoUrl:t,onChange:a,onNext:i,onCancel:n}=e,{t:r}=(0,s.useTranslation)();return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("label",{htmlFor:"repoUrl",className:"flex flex-col items-start justify-center self-stretch text-text-secondary",children:(0,l.jsx)("span",{className:"system-sm-semibold",children:r("installFromGitHub.gitHubRepo",{ns:"plugin"})})}),(0,l.jsx)("input",{type:"url",id:"repoUrl",name:"repoUrl",value:t,onChange:e=>a(e.target.value),className:"shadows-shadow-xs system-sm-regular flex grow items-center gap-[2px] self-stretch overflow-hidden text-ellipsis rounded-lg border border-components-input-border-active bg-components-input-bg-active p-2 text-components-input-text-filled",placeholder:"Please enter GitHub repo URL"}),(0,l.jsxs)("div",{className:"mt-4 flex items-center justify-end gap-2 self-stretch",children:[(0,l.jsx)(f.default,{variant:"secondary",className:"min-w-[72px]",onClick:n,children:r("installModal.cancel",{ns:"plugin"})}),(0,l.jsx)(f.default,{variant:"primary",className:"min-w-[72px]",onClick:i,disabled:!t.trim(),children:r("installModal.next",{ns:"plugin"})})]})]})},P="installFromGitHub";e.s(["default",0,e=>{let{updatePayload:g,onClose:f,onSuccess:x}=e,{t:b}=(0,s.useTranslation)(),{getIconUrl:h}=(0,n.default)(),{fetchReleases:y}=(0,d.useGitHubReleases)(),{refreshPluginList:F}=(0,p.default)(),{modalClassName:j,foldAnimInto:I,setIsInstalling:v,handleStartToInstall:H}=(0,u.default)(f),[N,w]=(0,t.useState)({step:g?o.InstallStepFromGitHub.selectPackage:o.InstallStepFromGitHub.setUrl,repoUrl:g?.originalPackageInfo?.repo?(0,m.convertRepoToUrl)(g.originalPackageInfo.repo):"",selectedVersion:"",selectedPackage:"",releases:g?g.originalPackageInfo.releases:[]}),[U,C]=(0,t.useState)(null),[$,T]=(0,t.useState)(null),[V,M]=(0,t.useState)(null),R=N.releases.map(e=>({value:e.tag_name,name:e.tag_name})),q=N.selectedVersion&&N.releases.find(e=>e.tag_name===N.selectedVersion)?.assets.map(e=>({value:e.name,name:e.name}))||[],L=(0,t.useCallback)(()=>N.step===o.InstallStepFromGitHub.installed?b(`${P}.installedSuccessfully`,{ns:"plugin"}):N.step===o.InstallStepFromGitHub.installFailed?b(`${P}.installFailed`,{ns:"plugin"}):g?b(`${P}.updatePlugin`,{ns:"plugin"}):b(`${P}.installPlugin`,{ns:"plugin"}),[N.step,b,g]),_=async()=>{let{isValid:e,owner:l,repo:t}=(0,m.parseGitHubUrl)(N.repoUrl);if(!e||!l||!t)return void i.default.notify({type:"error",message:b("error.inValidGitHubUrl",{ns:"plugin"})});try{let e=await y(l,t);e.length>0?w(l=>({...l,releases:e,step:o.InstallStepFromGitHub.selectPackage})):i.default.notify({type:"error",message:b("error.noReleasesFound",{ns:"plugin"})})}catch{i.default.notify({type:"error",message:b("error.fetchReleasesError",{ns:"plugin"})})}},B=async e=>{try{let l=await h(e.manifest.icon);T({...e.manifest,icon:l}),C(e.uniqueIdentifier),w(e=>({...e,step:o.InstallStepFromGitHub.readyToInstall}))}catch(e){M(e?.response?.message||b("installModal.installFailedDesc",{ns:"plugin"})),w(e=>({...e,step:(0,o.InstallStepFromGitHub.uploadFailed)}))}},A=(0,t.useCallback)(e=>{M(e),w(e=>({...e,step:o.InstallStepFromGitHub.uploadFailed}))},[]),z=(0,t.useCallback)(e=>{w(e=>({...e,step:o.InstallStepFromGitHub.installed})),e||F($),v(!1),x()},[$,x,F,v]),E=(0,t.useCallback)(e=>{w(e=>({...e,step:o.InstallStepFromGitHub.installFailed})),v(!1),e&&M(e)},[v]),K=()=>{w(e=>{switch(e.step){case o.InstallStepFromGitHub.selectPackage:return{...e,step:o.InstallStepFromGitHub.setUrl};case o.InstallStepFromGitHub.readyToInstall:return{...e,step:o.InstallStepFromGitHub.selectPackage};default:return e}})};return(0,l.jsxs)(a.default,{isShow:!0,onClose:I,className:(0,r.cn)(j,`shadows-shadow-xl flex min-w-[560px] flex-col items-start rounded-2xl border-[0.5px]
        border-components-panel-border bg-components-panel-bg p-0`),closable:!0,children:[(0,l.jsx)("div",{className:"flex items-start gap-2 self-stretch pb-3 pl-6 pr-14 pt-6",children:(0,l.jsxs)("div",{className:"flex grow flex-col items-start gap-1",children:[(0,l.jsx)("div",{className:"title-2xl-semi-bold self-stretch text-text-primary",children:L()}),(0,l.jsx)("div",{className:"system-xs-regular self-stretch text-text-tertiary",children:![o.InstallStepFromGitHub.uploadFailed,o.InstallStepFromGitHub.installed,o.InstallStepFromGitHub.installFailed].includes(N.step)&&b("installFromGitHub.installNote",{ns:"plugin"})})]})}),[o.InstallStepFromGitHub.uploadFailed,o.InstallStepFromGitHub.installed,o.InstallStepFromGitHub.installFailed].includes(N.step)?(0,l.jsx)(c.default,{payload:$,isFailed:[o.InstallStepFromGitHub.uploadFailed,o.InstallStepFromGitHub.installFailed].includes(N.step),errMsg:V,onCancel:f}):(0,l.jsxs)("div",{className:`flex flex-col items-start justify-center self-stretch px-6 py-3 ${N.step===o.InstallStepFromGitHub.installed?"gap-2":"gap-4"}`,children:[N.step===o.InstallStepFromGitHub.setUrl&&(0,l.jsx)(G,{repoUrl:N.repoUrl,onChange:e=>w(l=>({...l,repoUrl:e})),onNext:_,onCancel:f}),N.step===o.InstallStepFromGitHub.selectPackage&&(0,l.jsx)(k,{updatePayload:g,repoUrl:N.repoUrl,selectedVersion:N.selectedVersion,versions:R,onSelectVersion:e=>w(l=>({...l,selectedVersion:e.value})),selectedPackage:N.selectedPackage,packages:q,onSelectPackage:e=>w(l=>({...l,selectedPackage:e.value})),onUploaded:B,onFailed:A,onBack:K}),N.step===o.InstallStepFromGitHub.readyToInstall&&(0,l.jsx)(S,{updatePayload:g,uniqueIdentifier:U,payload:$,repoUrl:N.repoUrl,selectedVersion:N.selectedVersion,selectedPackage:N.selectedPackage,onBack:K,onStartToInstall:H,onInstalled:z,onFailed:E})]})]})}],622085)},144226,e=>{"use strict";var l=e.i(563199),t=e.i(268255),s=e.i(944911),a=e.i(622085);let i=t.memo(e=>{let{payload:t,onSave:s,onCancel:i}=e;return(0,l.jsx)(a.default,{updatePayload:t,onClose:i,onSuccess:s})});var n=e.i(583926);let r=t.memo(e=>{let{type:t,marketPlace:a,github:r,onCancel:o,onSave:c}=e;return t===s.PluginSource.github?(0,l.jsx)(i,{payload:r,onSave:c,onCancel:o}):(0,l.jsx)(n.default,{payload:a,onSave:c,onCancel:o})});e.s(["default",0,r],144226)},43994,e=>{e.n(e.i(144226))}]);
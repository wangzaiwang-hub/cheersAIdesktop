(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,203742,e=>{"use strict";var s=e.i(563199),t=e.i(869873),a=e.i(551193),r=e.i(837699),l=e.i(268255);e.i(152567);var c=e.i(408767),i=e.i(494268),n=e.i(752901),o=e.i(927897);let p=(0,e.i(639751).create)(e=>({appId:"",setAppId:s=>e({appId:s}),specificGroups:[],setSpecificGroups:s=>e({specificGroups:s}),specificMembers:[],setSpecificMembers:s=>e({specificMembers:s}),currentMenu:n.AccessMode.SPECIFIC_GROUPS_MEMBERS,setCurrentMenu:s=>e({currentMenu:s}),selectedGroupsForBreadcrumb:[],setSelectedGroupsForBreadcrumb:s=>e({selectedGroupsForBreadcrumb:s})}));var d=e.i(151094),x=e.i(137667),m=e.i(157169),u=e.i(935139);let h=e=>{let{className:t,children:c,show:i,onClose:n}=e,o=(0,l.useCallback)(()=>{n?.()},[n]);return(0,s.jsx)(m.Transition,{appear:!0,show:i,as:l.Fragment,children:(0,s.jsxs)(a.Dialog,{as:"div",open:!0,className:"relative z-[99]",onClose:()=>null,children:[(0,s.jsx)(m.Transition.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,s.jsx)("div",{className:"fixed inset-0 bg-background-overlay"})}),(0,s.jsx)("div",{className:"fixed inset-0 flex items-center justify-center",children:(0,s.jsx)(m.Transition.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,s.jsxs)(a.Dialog.Panel,{className:(0,u.cn)("relative h-auto min-h-[323px] w-[600px] overflow-y-auto rounded-2xl bg-components-panel-bg p-0 shadow-xl transition-all",t),children:[(0,s.jsx)("div",{onClick:()=>o(),className:"absolute right-5 top-5 z-10 flex h-8 w-8 cursor-pointer items-center justify-center",children:(0,s.jsx)(r.RiCloseLine,{className:"h-5 w-5 text-text-tertiary"})}),c]})})})]})})},j=e=>{let{type:t,children:a}=e,r=p(e=>e.currentMenu),l=p(e=>e.setCurrentMenu);return r!==t?(0,s.jsx)("div",{className:"cursor-pointer rounded-[10px] border-[1px] border-components-option-card-option-border bg-components-option-card-option-bg hover:border-components-option-card-option-border-hover hover:bg-components-option-card-option-bg-hover",onClick:()=>l(t),children:a}):(0,s.jsx)("div",{className:"rounded-[10px] border-[1.5px] border-components-option-card-option-selected-border bg-components-option-card-option-selected-bg shadow-sm",children:a})};j.displayName="AccessControlItem";var g=e.i(241661),f=e.i(449980),b=e.i(421001),y=e.i(715898),N=e.i(966428),v=e.i(711536),C=e.i(324935),w=e.i(291631),M=e.i(391185);function S(){var e;let{t}=(0,c.useTranslation)(),[a,i]=(0,l.useState)(!1),[x,m]=(0,l.useState)(""),u=p(e=>e.selectedGroupsForBreadcrumb),h=(0,N.useDebounce)(x,{wait:500}),j=u[u.length-1],{isLoading:g,isFetchingNextPage:b,fetchNextPage:v,data:C}=(0,o.useSearchForWhiteListCandidates)({keyword:h,groupId:j?.id,resultsPerPage:10},a),S=(0,l.useRef)(null);return(0,l.useEffect)(()=>{let e,s=C?.pages?.[0]?.hasMore??!1;return S.current&&(e=new IntersectionObserver(e=>{e[0].isIntersecting&&!g&&s&&v()},{rootMargin:"20px"})).observe(S.current),()=>e?.disconnect()},[g,v,S,C]),(0,s.jsxs)(M.PortalToFollowElem,{open:a,onOpenChange:i,offset:{crossAxis:300},placement:"bottom-end",children:[(0,s.jsx)(M.PortalToFollowElemTrigger,{asChild:!0,children:(0,s.jsxs)(d.default,{variant:"ghost-accent",size:"small",className:"flex shrink-0 items-center gap-x-0.5",onClick:()=>i(!a),children:[(0,s.jsx)(r.RiAddCircleFill,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:t("operation.add",{ns:"common"})})]})}),a&&(0,s.jsx)(y.FloatingOverlay,{}),(0,s.jsx)(M.PortalToFollowElemContent,{className:"z-[100]",children:(0,s.jsxs)("div",{className:"relative flex max-h-[400px] w-[400px] flex-col overflow-y-auto rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur shadow-lg backdrop-blur-[5px]",children:[(0,s.jsx)("div",{className:"sticky top-0 z-10 bg-components-panel-bg-blur p-2 pb-0.5 backdrop-blur-[5px]",children:(0,s.jsx)(w.default,{value:x,onChange:e=>{m(e.target.value)},showLeftIcon:!0,placeholder:t("accessControlDialog.operateGroupAndMember.searchPlaceholder",{ns:"app"})})}),g?(0,s.jsx)("div",{className:"p-1",children:(0,s.jsx)(f.default,{})}):(C?.pages?.length??0)>0?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"flex h-7 items-center px-2 py-0.5",children:(0,s.jsx)(k,{})}),(0,s.jsxs)("div",{className:"p-1",children:[(e=C?.pages??[],e?.map(e=>(0,s.jsx)("div",{children:e.subjects?.map((e,t)=>e.subjectType===n.SubjectType.GROUP?(0,s.jsx)(R,{group:e.groupData},t):(0,s.jsx)(T,{member:e.accountData},t))},`search_group_member_page_${e.currPage}`))??null),b&&(0,s.jsx)(f.default,{})]}),(0,s.jsx)("div",{ref:S,className:"h-0",children:" "})]}):(0,s.jsx)("div",{className:"flex h-7 items-center justify-center px-2 py-0.5",children:(0,s.jsx)("span",{className:"system-xs-regular text-text-tertiary",children:t("accessControlDialog.operateGroupAndMember.noResult",{ns:"app"})})})]})})]})}function k(){let e=p(e=>e.selectedGroupsForBreadcrumb),t=p(e=>e.setSelectedGroupsForBreadcrumb),{t:a}=(0,c.useTranslation)(),r=(0,l.useCallback)(s=>{t(e.slice(0,s+1))},[t,e]),i=(0,l.useCallback)(()=>{t([])},[t]);return(0,s.jsxs)("div",{className:"flex h-7 items-center gap-x-0.5 px-2 py-0.5",children:[(0,s.jsx)("span",{className:(0,u.cn)("system-xs-regular text-text-tertiary",e.length>0&&"cursor-pointer text-text-accent"),onClick:i,children:a("accessControlDialog.operateGroupAndMember.allMembers",{ns:"app"})}),e.map((t,a)=>(0,s.jsxs)("div",{className:"system-xs-regular flex items-center gap-x-0.5 text-text-tertiary",children:[(0,s.jsx)("span",{children:"/"}),(0,s.jsx)("span",{className:a===e.length-1?"":"cursor-pointer text-text-accent",onClick:()=>r(a),children:t.name})]},a))]})}function R(e){let{group:t}=e,{t:a}=(0,c.useTranslation)(),i=p(e=>e.specificGroups),n=p(e=>e.setSpecificGroups),o=p(e=>e.selectedGroupsForBreadcrumb),x=p(e=>e.setSelectedGroupsForBreadcrumb),m=i.some(e=>e.id===t.id),u=(0,l.useCallback)(()=>{m?n(i.filter(e=>e.id!==t.id)):n([...i,t])},[i,n,t,m]),h=(0,l.useCallback)(()=>{x([...o,t])},[o,x,t]);return(0,s.jsxs)(G,{children:[(0,s.jsx)(C.default,{checked:m,className:"h-4 w-4 shrink-0",onCheck:u}),(0,s.jsxs)("div",{className:"item-center flex grow",children:[(0,s.jsx)("div",{className:"mr-2 h-5 w-5 overflow-hidden rounded-full bg-components-icon-bg-blue-solid",children:(0,s.jsx)("div",{className:"bg-access-app-icon-mask-bg flex h-full w-full items-center justify-center",children:(0,s.jsx)(r.RiOrganizationChart,{className:"h-[14px] w-[14px] text-components-avatar-shape-fill-stop-0"})})}),(0,s.jsx)("p",{className:"system-sm-medium mr-1 text-text-secondary",children:t.name}),(0,s.jsx)("p",{className:"system-xs-regular text-text-tertiary",children:t.groupSize})]}),(0,s.jsxs)(d.default,{size:"small",disabled:m,variant:"ghost-accent",className:"flex shrink-0 items-center justify-between px-1.5 py-1",onClick:h,children:[(0,s.jsx)("span",{className:"px-[3px]",children:a("accessControlDialog.operateGroupAndMember.expand",{ns:"app"})}),(0,s.jsx)(r.RiArrowRightSLine,{className:"h-4 w-4"})]})]})}function T(e){let{member:t}=e,a=(0,v.useSelector)(e=>e.userProfile),{t:r}=(0,c.useTranslation)(),i=p(e=>e.specificMembers),n=p(e=>e.setSpecificMembers),o=i.some(e=>e.id===t.id),d=(0,l.useCallback)(()=>{o?n(i.filter(e=>e.id!==t.id)):n([...i,t])},[i,n,t,o]);return(0,s.jsxs)(G,{className:"pr-3",children:[(0,s.jsx)(C.default,{checked:o,className:"h-4 w-4 shrink-0",onCheck:d}),(0,s.jsxs)("div",{className:"flex grow items-center",children:[(0,s.jsx)("div",{className:"mr-2 h-5 w-5 overflow-hidden rounded-full bg-components-icon-bg-blue-solid",children:(0,s.jsx)("div",{className:"bg-access-app-icon-mask-bg flex h-full w-full items-center justify-center",children:(0,s.jsx)(g.default,{className:"h-[14px] w-[14px]",textClassName:"text-[12px]",avatar:null,name:t.name})})}),(0,s.jsx)("p",{className:"system-sm-medium mr-1 text-text-secondary",children:t.name}),a.email===t.email&&(0,s.jsxs)("p",{className:"system-xs-regular text-text-tertiary",children:["(",r("you",{ns:"common"}),")"]})]}),(0,s.jsx)("p",{className:"system-xs-regular text-text-quaternary",children:t.email})]})}function G(e){let{children:t,className:a}=e;return(0,s.jsx)("div",{className:(0,u.cn)("flex cursor-pointer items-center space-x-2 p-1 pl-2 hover:rounded-lg hover:bg-state-base-hover",a),children:t})}function I(){let e=p(e=>e.currentMenu),t=p(e=>e.appId),a=p(e=>e.setSpecificGroups),i=p(e=>e.setSpecificMembers),{t:d}=(0,c.useTranslation)(),{isPending:x,data:m}=(0,o.useAppWhiteListSubjects)(t,!!t&&e===n.AccessMode.SPECIFIC_GROUPS_MEMBERS);return((0,l.useEffect)(()=>{a(m?.groups??[]),i(m?.members??[])},[m,a,i]),e!==n.AccessMode.SPECIFIC_GROUPS_MEMBERS)?(0,s.jsx)("div",{className:"flex items-center p-3",children:(0,s.jsxs)("div",{className:"flex grow items-center gap-x-2",children:[(0,s.jsx)(r.RiLockLine,{className:"h-4 w-4 text-text-primary"}),(0,s.jsx)("p",{className:"system-sm-medium text-text-primary",children:d("accessControlDialog.accessItems.specific",{ns:"app"})})]})}):(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center gap-x-1 p-3",children:[(0,s.jsxs)("div",{className:"flex grow items-center gap-x-1",children:[(0,s.jsx)(r.RiLockLine,{className:"h-4 w-4 text-text-primary"}),(0,s.jsx)("p",{className:"system-sm-medium text-text-primary",children:d("accessControlDialog.accessItems.specific",{ns:"app"})})]}),(0,s.jsx)("div",{className:"flex items-center gap-x-1",children:(0,s.jsx)(S,{})})]}),(0,s.jsx)("div",{className:"px-1 pb-1",children:(0,s.jsx)("div",{className:"flex max-h-[400px] flex-col gap-y-2 overflow-y-auto rounded-lg bg-background-section p-2",children:x?(0,s.jsx)(f.default,{}):(0,s.jsx)(E,{})})})]})}function E(){let{t:e}=(0,c.useTranslation)(),t=p(e=>e.specificGroups),a=p(e=>e.specificMembers);return t.length<=0&&a.length<=0?(0,s.jsx)("div",{className:"px-2 pb-1.5 pt-5",children:(0,s.jsx)("p",{className:"system-xs-regular text-center text-text-tertiary",children:e("accessControlDialog.noGroupsOrMembers",{ns:"app"})})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{className:"system-2xs-medium-uppercase sticky top-0 text-text-tertiary",children:e("accessControlDialog.groups",{ns:"app",count:t.length??0})}),(0,s.jsx)("div",{className:"flex flex-row flex-wrap gap-1",children:t.map((e,t)=>(0,s.jsx)(F,{group:e},t))}),(0,s.jsx)("p",{className:"system-2xs-medium-uppercase sticky top-0 text-text-tertiary",children:e("accessControlDialog.members",{ns:"app",count:a.length??0})}),(0,s.jsx)("div",{className:"flex flex-row flex-wrap gap-1",children:a.map((e,t)=>(0,s.jsx)(A,{member:e},t))})]})}function F(e){let{group:t}=e,a=p(e=>e.specificGroups),c=p(e=>e.setSpecificGroups),i=(0,l.useCallback)(()=>{c(a.filter(e=>e.id!==t.id))},[t,c,a]);return(0,s.jsxs)(_,{icon:(0,s.jsx)(r.RiOrganizationChart,{className:"h-[14px] w-[14px] text-components-avatar-shape-fill-stop-0"}),onRemove:i,children:[(0,s.jsx)("p",{className:"system-xs-regular text-text-primary",children:t.name}),(0,s.jsx)("p",{className:"system-xs-regular text-text-tertiary",children:t.groupSize})]})}function A(e){let{member:t}=e,a=p(e=>e.specificMembers),r=p(e=>e.setSpecificMembers),c=(0,l.useCallback)(()=>{r(a.filter(e=>e.id!==t.id))},[t,r,a]);return(0,s.jsx)(_,{icon:(0,s.jsx)(g.default,{className:"h-[14px] w-[14px]",textClassName:"text-[12px]",avatar:null,name:t.name}),onRemove:c,children:(0,s.jsx)("p",{className:"system-xs-regular text-text-primary",children:t.name})})}function _(e){let{icon:t,onRemove:a,children:l}=e;return(0,s.jsxs)("div",{className:"group flex flex-row items-center gap-x-1 rounded-full border-[0.5px] bg-components-badge-white-to-dark p-1 pr-1.5 shadow-xs",children:[(0,s.jsx)("div",{className:"h-5 w-5 overflow-hidden rounded-full bg-components-icon-bg-blue-solid",children:(0,s.jsx)("div",{className:"bg-access-app-icon-mask-bg flex h-full w-full items-center justify-center",children:t})}),l,(0,s.jsx)("div",{className:"flex h-4 w-4 cursor-pointer items-center justify-center",onClick:a,children:(0,s.jsx)(r.RiCloseCircleFill,{className:"h-[14px] w-[14px] text-text-quaternary"})})]})}function P(){let{t:e}=(0,c.useTranslation)();return(0,s.jsx)(b.default,{asChild:!1,popupContent:e("accessControlDialog.webAppSSONotEnabledTip",{ns:"app"}),children:(0,s.jsx)(r.RiAlertFill,{className:"h-4 w-4 shrink-0 text-text-warning-secondary"})})}function D(e){let{app:m,onClose:u,onConfirm:g}=e,{t:f}=(0,c.useTranslation)(),b=(0,i.useGlobalPublicStore)(e=>e.systemFeatures),y=p(e=>e.setAppId),N=p(e=>e.specificGroups),v=p(e=>e.specificMembers),C=p(e=>e.currentMenu),w=p(e=>e.setCurrentMenu),M=b.webapp_auth.enabled&&(b.webapp_auth.allow_sso||b.webapp_auth.allow_email_password_login||b.webapp_auth.allow_email_code_login);(0,l.useEffect)(()=>{y(m.id),w(m.access_mode??n.AccessMode.SPECIFIC_GROUPS_MEMBERS)},[m,y,w]);let{isPending:S,mutateAsync:k}=(0,o.useUpdateAccessMode)(),R=(0,l.useCallback)(async()=>{let e={appId:m.id,accessMode:C};if(C===n.AccessMode.SPECIFIC_GROUPS_MEMBERS){let s=[];N.forEach(e=>{s.push({subjectId:e.id,subjectType:n.SubjectType.GROUP})}),v.forEach(e=>{s.push({subjectId:e.id,subjectType:n.SubjectType.ACCOUNT})}),e.subjects=s}await k(e),x.default.notify({type:"success",message:f("accessControlDialog.updateSuccess",{ns:"app"})}),g?.()},[k,m,N,v,f,g,C]);return(0,s.jsx)(h,{show:!0,onClose:u,children:(0,s.jsxs)("div",{className:"flex flex-col gap-y-3",children:[(0,s.jsxs)("div",{className:"pb-3 pl-6 pr-14 pt-6",children:[(0,s.jsx)(a.DialogTitle,{className:"title-2xl-semi-bold text-text-primary",children:f("accessControlDialog.title",{ns:"app"})}),(0,s.jsx)(t.Description,{className:"system-xs-regular mt-1 text-text-tertiary",children:f("accessControlDialog.description",{ns:"app"})})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-y-1 px-6 pb-3",children:[(0,s.jsx)("div",{className:"leading-6",children:(0,s.jsx)("p",{className:"system-sm-medium text-text-tertiary",children:f("accessControlDialog.accessLabel",{ns:"app"})})}),(0,s.jsx)(j,{type:n.AccessMode.ORGANIZATION,children:(0,s.jsx)("div",{className:"flex items-center p-3",children:(0,s.jsxs)("div",{className:"flex grow items-center gap-x-2",children:[(0,s.jsx)(r.RiBuildingLine,{className:"h-4 w-4 text-text-primary"}),(0,s.jsx)("p",{className:"system-sm-medium text-text-primary",children:f("accessControlDialog.accessItems.organization",{ns:"app"})})]})})}),(0,s.jsx)(j,{type:n.AccessMode.SPECIFIC_GROUPS_MEMBERS,children:(0,s.jsx)(I,{})}),(0,s.jsx)(j,{type:n.AccessMode.EXTERNAL_MEMBERS,children:(0,s.jsxs)("div",{className:"flex items-center p-3",children:[(0,s.jsxs)("div",{className:"flex grow items-center gap-x-2",children:[(0,s.jsx)(r.RiVerifiedBadgeLine,{className:"h-4 w-4 text-text-primary"}),(0,s.jsx)("p",{className:"system-sm-medium text-text-primary",children:f("accessControlDialog.accessItems.external",{ns:"app"})})]}),!M&&(0,s.jsx)(P,{})]})}),(0,s.jsx)(j,{type:n.AccessMode.PUBLIC,children:(0,s.jsxs)("div",{className:"flex items-center gap-x-2 p-3",children:[(0,s.jsx)(r.RiGlobalLine,{className:"h-4 w-4 text-text-primary"}),(0,s.jsx)("p",{className:"system-sm-medium text-text-primary",children:f("accessControlDialog.accessItems.anyone",{ns:"app"})})]})})]}),(0,s.jsxs)("div",{className:"flex items-center justify-end gap-x-2 p-6 pt-5",children:[(0,s.jsx)(d.default,{onClick:u,children:f("operation.cancel",{ns:"common"})}),(0,s.jsx)(d.default,{disabled:S,loading:S,variant:"primary",onClick:R,children:f("operation.confirm",{ns:"common"})})]})]})})}e.s(["default",()=>D],203742)},351332,e=>{e.n(e.i(203742))}]);
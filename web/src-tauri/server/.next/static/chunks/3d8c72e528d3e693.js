(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,483940,e=>{"use strict";var s=e.i(268255);e.i(604193);var t=e.i(665830),l=e.i(615046);function a(e){return e}function n(e,s,n){if("object"!=typeof s||null===s)return;let i=e.getMutationCache(),r=e.getQueryCache(),o=n?.defaultOptions?.deserializeData??e.getDefaultOptions().hydrate?.deserializeData??a,c=s.mutations||[],u=s.queries||[];c.forEach(s=>{let{state:t,...l}=s;i.build(e,{...e.getDefaultOptions().hydrate?.mutations,...n?.defaultOptions?.mutations,...l},t)}),u.forEach(s=>{let{queryKey:a,state:i,queryHash:c,meta:u,promise:d,dehydratedAt:p}=s,m=d?(0,t.tryResolveSync)(d):void 0,x=void 0===i.data?m?.data:i.data,g=void 0===x?x:o(x),h=r.get(c),f=h?.state.status==="pending",v=h?.state.fetchStatus==="fetching";if(h){let e=m&&void 0!==p&&p>h.state.dataUpdatedAt;if(i.dataUpdatedAt>h.state.dataUpdatedAt||e){let{fetchStatus:e,...s}=i;h.setState({...s,data:g})}}else h=r.build(e,{...e.getDefaultOptions().hydrate?.queries,...n?.defaultOptions?.queries,queryKey:a,queryHash:c,meta:u},{...i,data:g,fetchStatus:"idle",status:void 0!==g?"success":i.status});d&&!f&&!v&&(void 0===p||p>h.state.dataUpdatedAt)&&h.fetch(void 0,{initialPromise:Promise.resolve(d).then(o)}).catch(l.noop)})}var i=e.i(214309),r=e=>{let{children:t,options:l={},state:a,queryClient:r}=e,o=(0,i.useQueryClient)(r),c=s.useRef(l);s.useEffect(()=>{c.current=l});let u=s.useMemo(()=>{if(a){if("object"!=typeof a)return;let e=o.getQueryCache(),s=a.queries||[],t=[],l=[];for(let a of s){let s=e.get(a.queryHash);s?(a.state.dataUpdatedAt>s.state.dataUpdatedAt||a.promise&&"pending"!==s.state.status&&"fetching"!==s.state.fetchStatus&&void 0!==a.dehydratedAt&&a.dehydratedAt>s.state.dataUpdatedAt)&&l.push(a):t.push(a)}if(t.length>0&&n(o,{queries:t},c.current),l.length>0)return l}},[o,a]);return s.useEffect(()=>{u&&n(o,{queries:u},c.current)},[o,u]),t};e.s(["HydrationBoundary",()=>r],483940)},206433,e=>{"use strict";var s=e.i(563199),t=e.i(374170),l=e.i(449980),a=e.i(837699),n=e.i(268255),i=e.i(391185),r=e.i(602116);let o=()=>{let{t:e}=(0,t.useTranslation)(),l=[{value:"install_count",order:"DESC",text:e("marketplace.sortOption.mostPopular",{ns:"plugin"})},{value:"version_updated_at",order:"DESC",text:e("marketplace.sortOption.recentlyUpdated",{ns:"plugin"})},{value:"created_at",order:"DESC",text:e("marketplace.sortOption.newlyReleased",{ns:"plugin"})},{value:"created_at",order:"ASC",text:e("marketplace.sortOption.firstReleased",{ns:"plugin"})}],[o,c]=(0,r.useMarketplaceSort)(),[u,d]=(0,n.useState)(!1),p=l.find(e=>e.value===o.sortBy&&e.order===o.sortOrder)??l[0];return(0,s.jsxs)(i.PortalToFollowElem,{placement:"bottom-start",offset:{mainAxis:4,crossAxis:0},open:u,onOpenChange:d,children:[(0,s.jsx)(i.PortalToFollowElemTrigger,{onClick:()=>d(e=>!e),children:(0,s.jsxs)("div",{className:"flex h-8 cursor-pointer items-center rounded-lg bg-state-base-hover-alt px-2 pr-3",children:[(0,s.jsx)("span",{className:"system-sm-regular mr-1 text-text-secondary",children:e("marketplace.sortBy",{ns:"plugin"})}),(0,s.jsx)("span",{className:"system-sm-medium mr-1 text-text-primary",children:p.text}),(0,s.jsx)(a.RiArrowDownSLine,{className:"h-4 w-4 text-text-tertiary"})]})}),(0,s.jsx)(i.PortalToFollowElemContent,{children:(0,s.jsx)("div",{className:"rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur p-1 shadow-lg backdrop-blur-sm",children:l.map(e=>(0,s.jsxs)("div",{className:"system-md-regular flex h-8 cursor-pointer items-center justify-between rounded-lg px-3 pr-2 text-text-primary hover:bg-components-panel-on-panel-item-bg-hover",onClick:()=>c({sortBy:e.value,sortOrder:e.order}),children:[e.text,o.sortBy===e.value&&o.sortOrder===e.order&&(0,s.jsx)(a.RiCheckLine,{className:"ml-2 h-4 w-4 text-text-accent"})]},`${e.value}-${e.order}`))})})]})};var c=e.i(966428),u=e.i(616301),d=e.i(351797),p=e.i(236063),m=e.i(562572),x=e.i(10190),g=e.i(108185),h=e.i(224729);e.s(["default",0,e=>{let{showInstallButton:a}=e,{t:i}=(0,t.useTranslation)(),{plugins:f,pluginsTotal:v,marketplaceCollections:b,marketplaceCollectionPluginsMap:j,isLoading:y,isFetchingNextPage:N,page:P}=function(){var e,s;let[t]=(0,r.useSearchPluginText)(),l=(0,c.useDebounce)(t,{wait:500}),[a]=(0,r.useFilterPluginTags)(),[i]=(0,r.useActivePluginType)(),o=(e=(0,g.getCollectionsParams)(i),(0,m.useQuery)({queryKey:x.marketplaceQuery.collections.queryKey({input:{query:e}}),queryFn:s=>{let{signal:t}=s;return(0,g.getMarketplaceCollectionsAndPlugins)(e,{signal:t})}})),h=(0,r.useMarketplaceSortValue)(),f=(0,r.useMarketplaceSearchMode)(),v=(s=(0,n.useMemo)(()=>{if(f)return{query:l,category:i===u.PLUGIN_TYPE_SEARCH_MAP.all?void 0:i,tags:a,sort_by:h.sortBy,sort_order:h.sortOrder,type:(0,g.getMarketplaceListFilterType)(i)}},[f,l,i,a,h]),(0,p.useInfiniteQuery)({queryKey:x.marketplaceQuery.searchAdvanced.queryKey({input:{body:s,params:{kind:s?.type==="bundle"?"bundles":"plugins"}}}),queryFn:e=>{let{pageParam:t=1,signal:l}=e;return(0,g.getMarketplacePlugins)(s,t,l)},getNextPageParam:e=>{let s=e.page+1;return e.page*e.page_size<(e.total||0)?s:void 0},initialPageParam:1,enabled:void 0!==s})),{hasNextPage:b,fetchNextPage:j,isFetching:y,isFetchingNextPage:N}=v,P=(0,n.useCallback)(()=>{b&&!y&&j()},[j,b,y]);return(0,d.useMarketplaceContainerScroll)(P),{marketplaceCollections:o.data?.marketplaceCollections,marketplaceCollectionPluginsMap:o.data?.marketplaceCollectionPluginsMap,plugins:v.data?.pages.flatMap(e=>e.plugins),pluginsTotal:v.data?.pages[0]?.total,page:v.data?.pages.length||1,isLoading:o.isLoading||v.isLoading,isFetchingNextPage:N}}();return(0,s.jsxs)("div",{style:{scrollbarGutter:"stable"},className:"relative flex grow flex-col bg-background-default-subtle px-12 py-2",children:[f&&(0,s.jsxs)("div",{className:"mb-4 flex items-center pt-3",children:[(0,s.jsx)("div",{className:"title-xl-semi-bold text-text-primary",children:i("marketplace.pluginsResult",{ns:"plugin",num:v})}),(0,s.jsx)("div",{className:"mx-3 h-3.5 w-[1px] bg-divider-regular"}),(0,s.jsx)(o,{})]}),y&&1===P&&(0,s.jsx)("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:(0,s.jsx)(l.default,{})}),(!y||P>1)&&(0,s.jsx)(h.default,{marketplaceCollections:b||[],marketplaceCollectionPluginsMap:j||{},plugins:f,showInstallButton:a}),N&&(0,s.jsx)(l.default,{className:"my-3"})]})}],206433)},251843,e=>{"use strict";var s=e.i(563199),t=e.i(935139),l=e.i(374170),a=e.i(837699),n=e.i(353269);e.i(49389);var i=e.i(425126),i=i,r=e.i(602116),o=e.i(616301);let c=e=>{let{className:c}=e,{t:u}=(0,l.useTranslation)(),[d,p]=(0,r.useActivePluginType)(),m=(0,n.useSetAtom)(r.searchModeAtom),x=[{value:o.PLUGIN_TYPE_SEARCH_MAP.all,text:u("category.all",{ns:"plugin"}),icon:null},{value:o.PLUGIN_TYPE_SEARCH_MAP.model,text:u("category.models",{ns:"plugin"}),icon:(0,s.jsx)(a.RiBrain2Line,{className:"mr-1.5 h-4 w-4"})},{value:o.PLUGIN_TYPE_SEARCH_MAP.tool,text:u("category.tools",{ns:"plugin"}),icon:(0,s.jsx)(a.RiHammerLine,{className:"mr-1.5 h-4 w-4"})},{value:o.PLUGIN_TYPE_SEARCH_MAP.datasource,text:u("category.datasources",{ns:"plugin"}),icon:(0,s.jsx)(a.RiDatabase2Line,{className:"mr-1.5 h-4 w-4"})},{value:o.PLUGIN_TYPE_SEARCH_MAP.trigger,text:u("category.triggers",{ns:"plugin"}),icon:(0,s.jsx)(i.default,{className:"mr-1.5 h-4 w-4"})},{value:o.PLUGIN_TYPE_SEARCH_MAP.agent,text:u("category.agents",{ns:"plugin"}),icon:(0,s.jsx)(a.RiSpeakAiLine,{className:"mr-1.5 h-4 w-4"})},{value:o.PLUGIN_TYPE_SEARCH_MAP.extension,text:u("category.extensions",{ns:"plugin"}),icon:(0,s.jsx)(a.RiPuzzle2Line,{className:"mr-1.5 h-4 w-4"})},{value:o.PLUGIN_TYPE_SEARCH_MAP.bundle,text:u("category.bundles",{ns:"plugin"}),icon:(0,s.jsx)(a.RiArchive2Line,{className:"mr-1.5 h-4 w-4"})}];return(0,s.jsx)("div",{className:(0,t.cn)("flex shrink-0 items-center justify-center space-x-2 bg-background-body py-3",c),children:x.map(e=>(0,s.jsxs)("div",{className:(0,t.cn)("system-md-medium flex h-8 cursor-pointer items-center rounded-xl border border-transparent px-3 text-text-tertiary hover:bg-state-base-hover hover:text-text-secondary",d===e.value&&"border-components-main-nav-nav-button-border !bg-components-main-nav-nav-button-bg-active !text-components-main-nav-nav-button-text-active shadow-xs"),onClick:()=>{p(e.value),o.PLUGIN_CATEGORY_WITH_COLLECTIONS.has(e.value)&&m(null)},children:[e.icon,e.text]},e.value))})};var u=e.i(400612);let d=()=>{let{t:e}=(0,l.useTranslation)(),[t,a]=(0,r.useSearchPluginText)(),[n,i]=(0,r.useFilterPluginTags)();return(0,s.jsx)(u.default,{wrapperClassName:"z-[11] mx-auto w-[640px] shrink-0",inputClassName:"w-full",search:t,onSearchChange:a,tags:n,onTagsChange:i,placeholder:e("searchPlugins",{ns:"plugin"}),usedInMarketplace:!0})};e.s(["default",0,e=>{let{pluginTypeSwitchClassName:l}=e,a=l?.includes("top-");return(0,s.jsxs)("div",{className:(0,t.cn)("mt-4 bg-background-body",a&&"sticky z-10",l),children:[(0,s.jsx)(d,{}),(0,s.jsx)(c,{})]})}],251843)},2429,560285,615124,523723,486287,e=>{"use strict";var s=e.i(563199),t=e.i(124836),l=e.i(45284),a=e.i(268255),n=e.i(339548),i=e.i(494268),r=e.i(40666);let o=(0,n.createContext)({containerRef:{current:null},currentPluginID:void 0,setCurrentPluginID:t.noop,filters:{categories:[],tags:[],searchQuery:""},setFilters:t.noop,activeTab:"",setActiveTab:t.noop,options:[]});function c(e){return(0,n.useContextSelector)(o,e)}e.s(["PluginPageContextProvider",0,e=>{let{children:t}=e,n=(0,a.useRef)(null),[c,u]=(0,a.useState)({categories:[],tags:[],searchQuery:""}),[d,p]=(0,a.useState)(),{enable_marketplace:m}=(0,i.useGlobalPublicStore)(e=>e.systemFeatures),x=(0,r.usePluginPageTabs)(),g=(0,a.useMemo)(()=>m?x:x.filter(e=>e.value!==r.PLUGIN_PAGE_TABS_MAP.marketplace),[x,m]),[h,f]=(0,l.useQueryState)("tab",{defaultValue:g[0].value});return(0,s.jsx)(o.Provider,{value:{containerRef:n,currentPluginID:d,setCurrentPluginID:p,filters:c,setFilters:u,activeTab:h,setActiveTab:f,options:g},children:t})},"usePluginPageContext",()=>c],2429);var u=e.i(719251);e.s(["FileZip",()=>u.default],560285);var d=e.i(698589);e.s(["Github",()=>d.default],615124);var p=e.i(835633);e.s(["MagicBox",()=>p.default],523723),e.i(152567);var m=e.i(408767),x=e.i(21151),g=e.i(222573),h=e.i(935139),f=e.i(944911),v=e.i(664826),b=e.i(70486),j=e.i(568349),y=e.i(632717),N=e.i(837699),P=e.i(321734),C=e.i(36503),w=e.i(151094),_=e.i(99649),k=e.i(711536),T=e.i(887460),S=e.i(157644),A=e.i(365181),E=e.i(745754),L=e.i(292005),I=e.i(228403);let U="installModal",F=a.memo(e=>{let{uniqueIdentifier:t,payload:l,onCancel:n,onStartToInstall:i,onInstalled:r,onFailed:o}=e,{t:c}=(0,m.useTranslation)(),u=l.version,d=`${l.author}/${l.name}`,{installedInfo:p,isLoading:x}=(0,_.default)({pluginIds:[d],enabled:!!d}),g=p?.[d],h=g?.installedVersion,v=!!h;(0,a.useEffect)(()=>{v&&t===g.uniqueIdentifier&&r()},[v]);let[b,j]=a.useState(!1),{mutateAsync:y}=(0,S.useInstallPackageFromLocal)(),{check:F,stop:R}=(0,E.default)(),{handleRefetch:M}=(0,S.usePluginTaskList)(l.category),O=async()=>{if(!b){j(!0),i?.();try{v&&await (0,T.uninstallPlugin)(g.installedId);let{all_installed:e,task_id:s}=await y(t);if(e)return void r();M();let{status:l,error:a}=await F({taskId:s,pluginUniqueIdentifier:t});if(l===f.TaskStatus.failed)return void o(a);r(!0)}catch(e){if("string"==typeof e)return void o(e);o()}}},{langGeniusVersionInfo:D}=(0,k.useAppContext)(),$=(0,a.useMemo)(()=>!D.current_version||(0,C.gte)(D.current_version,l.meta.minimum_dify_version??"0.0.0"),[D.current_version,l.meta.minimum_dify_version]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex flex-col items-start justify-center gap-4 self-stretch px-6 py-3",children:[(0,s.jsxs)("div",{className:"system-md-regular text-text-secondary",children:[(0,s.jsx)("p",{children:c(`${U}.readyToInstall`,{ns:"plugin"})}),(0,s.jsx)("p",{children:(0,s.jsx)(P.Trans,{i18nKey:`${U}.fromTrustSource`,ns:"plugin",components:{trustSource:(0,s.jsx)("span",{className:"system-md-semibold"})}})}),!$&&(0,s.jsx)("p",{className:"system-md-regular flex items-center gap-1 text-text-warning",children:c("difyVersionNotCompatible",{ns:"plugin",minimalDifyVersion:l.meta.minimum_dify_version})})]}),(0,s.jsx)("div",{className:"flex flex-wrap content-start items-start gap-1 self-stretch rounded-2xl bg-background-section-burn p-2",children:(0,s.jsx)(A.default,{className:"w-full",payload:(0,I.pluginManifestToCardPluginProps)(l),titleLeft:!x&&(0,s.jsx)(L.default,{hasInstalled:v,installedVersion:h,toInstallVersion:u})})})]}),(0,s.jsxs)("div",{className:"flex items-center justify-end gap-2 self-stretch p-6 pt-5",children:[!b&&(0,s.jsx)(w.default,{variant:"secondary",className:"min-w-[72px]",onClick:()=>{R(),n()},children:c("operation.cancel",{ns:"common"})}),(0,s.jsxs)(w.default,{variant:"primary",className:"flex min-w-[72px] space-x-0.5",disabled:b||x,onClick:O,children:[b&&(0,s.jsx)(N.RiLoader2Line,{className:"h-4 w-4 animate-spin-slow"}),(0,s.jsx)("span",{children:c(`${U}.${b?"installing":"install"}`,{ns:"plugin"})})]})]})]})}),R=a.memo(e=>{let{step:t,onStepChange:l,onStartToInstall:n,setIsInstalling:i,onClose:r,uniqueIdentifier:o,manifest:c,errorMsg:u,onError:d}=e,{refreshPluginList:p}=(0,y.default)(),m=(0,a.useCallback)(e=>{l(f.InstallStep.installed),e||p(c),i(!1)},[c,l,p,i]),x=(0,a.useCallback)(e=>{l(f.InstallStep.installFailed),i(!1),e&&d(e)},[d,l,i]);return(0,s.jsxs)(s.Fragment,{children:[t===f.InstallStep.readyToInstall&&(0,s.jsx)(F,{uniqueIdentifier:o,payload:c,onCancel:r,onInstalled:m,onFailed:x,onStartToInstall:n}),[f.InstallStep.uploadFailed,f.InstallStep.installed,f.InstallStep.installFailed].includes(t)&&(0,s.jsx)(j.default,{payload:c,isFailed:[f.InstallStep.uploadFailed,f.InstallStep.installFailed].includes(t),errMsg:u,onCancel:r})]})}),M="installModal",O=a.memo(e=>{let{isBundle:t,file:l,onCancel:n,onPackageUploaded:i,onBundleUploaded:r,onFailed:o}=e,{t:c}=(0,m.useTranslation)(),u=l.name,d=async()=>{try{await (0,T.uploadFile)(l,t)}catch(e){if(e.response?.message)o(e.response?.message);else{let s=e.response;if(t)return void r(s);i({uniqueIdentifier:s.unique_identifier,manifest:s.manifest})}}};return a.useEffect(()=>{d()},[]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex flex-col items-start justify-center gap-4 self-stretch px-6 py-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1 self-stretch",children:[(0,s.jsx)(N.RiLoader2Line,{className:"h-4 w-4 animate-spin-slow text-text-accent"}),(0,s.jsx)("div",{className:"system-md-regular text-text-secondary",children:c(`${M}.uploadingPackage`,{ns:"plugin",packageName:u})})]}),(0,s.jsx)("div",{className:"flex flex-wrap content-start items-start gap-1 self-stretch rounded-2xl bg-background-section-burn p-2",children:(0,s.jsx)(A.default,{className:"w-full",payload:{name:u},isLoading:!0,loadingFileName:u,installed:!1})})]}),(0,s.jsxs)("div",{className:"flex items-center justify-end gap-2 self-stretch p-6 pt-5",children:[(0,s.jsx)(w.default,{variant:"secondary",className:"min-w-[72px]",onClick:n,children:c("operation.cancel",{ns:"common"})}),(0,s.jsx)(w.default,{variant:"primary",className:"min-w-[72px]",disabled:!0,children:c(`${M}.install`,{ns:"plugin"})})]})]})}),D="installModal";e.s(["default",0,e=>{let{file:t,onClose:l}=e,{t:n}=(0,m.useTranslation)(),[i,r]=(0,a.useState)(f.InstallStep.uploading),[o,c]=(0,a.useState)(null),[u,d]=(0,a.useState)(null),[p,j]=(0,a.useState)(null),y=t.name.endsWith(".difybndl"),[N,P]=(0,a.useState)([]),{modalClassName:C,foldAnimInto:w,setIsInstalling:_,handleStartToInstall:k}=(0,v.default)(l),T=(0,a.useCallback)(()=>i===f.InstallStep.uploadFailed?n(`${D}.uploadFailed`,{ns:"plugin"}):y&&i===f.InstallStep.installed?n(`${D}.installComplete`,{ns:"plugin"}):i===f.InstallStep.installed?n(`${D}.installedSuccessfully`,{ns:"plugin"}):i===f.InstallStep.installFailed?n(`${D}.installFailed`,{ns:"plugin"}):n(`${D}.installPlugin`,{ns:"plugin"}),[y,i,n]),{getIconUrl:S}=(0,g.default)(),A=(0,a.useCallback)(async e=>{let{manifest:s,uniqueIdentifier:t}=e,l=await S(s.icon),a=s.icon_dark?await S(s.icon_dark):void 0;c(t),d({...s,icon:l,icon_dark:a}),r(f.InstallStep.readyToInstall)},[S]),E=(0,a.useCallback)(e=>{P(e),r(f.InstallStep.readyToInstall)},[]),L=(0,a.useCallback)(e=>{j(e),r(f.InstallStep.uploadFailed)},[]);return(0,s.jsxs)(x.default,{isShow:!0,onClose:w,className:(0,h.cn)(C,"shadows-shadow-xl flex min-w-[560px] flex-col items-start rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg p-0"),closable:!0,children:[(0,s.jsx)("div",{className:"flex items-start gap-2 self-stretch pb-3 pl-6 pr-14 pt-6",children:(0,s.jsx)("div",{className:"title-2xl-semi-bold self-stretch text-text-primary",children:T()})}),i===f.InstallStep.uploading&&(0,s.jsx)(O,{isBundle:y,file:t,onCancel:l,onPackageUploaded:A,onBundleUploaded:E,onFailed:L}),y?(0,s.jsx)(b.default,{step:i,onStepChange:r,onStartToInstall:k,setIsInstalling:_,onClose:l,allPlugins:N}):(0,s.jsx)(R,{step:i,onStepChange:r,onStartToInstall:k,setIsInstalling:_,onClose:l,uniqueIdentifier:o,manifest:u,errorMsg:p,onError:j})]})}],486287)},303504,e=>{"use strict";var s=e.i(563199),t=e.i(837699),l=e.i(417944),a=e.i(124836),n=e.i(554327),i=e.i(268255);e.i(152567);var r=e.i(408767),o=e.i(151094),c=e.i(115131),u=e.i(421001),d=e.i(21151),p=e.i(944911),m=e.i(597280),x=e.i(494268),g=e.i(321734),h=e.i(519089),f=e.i(7266),v=e.i(59375),b=e.i(711536),j=e.i(296124),y=e.i(935139);let N=i.memo(e=>{let{label:t,description:l}=e;return(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:(0,y.cn)("flex h-6 items-center",l&&"h-4"),children:(0,s.jsx)("span",{className:"system-sm-semibold text-text-secondary",children:t})}),l&&(0,s.jsx)("div",{className:"body-xs-regular mt-1 text-text-tertiary",children:l})]})});var P=e.i(266498);let C=i.memo(e=>{let{updateMode:t}=e,{t:l}=(0,r.useTranslation)(),a=`${l(`autoUpdate.upgradeModePlaceholder.${t===P.AUTO_UPDATE_MODE.partial?"partial":"exclude"}`,{ns:"plugin"})}`;return(0,s.jsx)("div",{className:"system-xs-regular rounded-[10px] border border-components-option-card-option-border bg-background-section p-3 text-center text-text-tertiary",children:a})});var w=e.i(580932),_=e.i(925521);let k=i.memo(e=>{let{className:t,plugins:l}=e,a=l.length<14,n=l.slice(0,14);return(0,s.jsxs)("div",{className:(0,y.cn)("flex items-center space-x-1",t),children:[n.map(e=>(0,s.jsx)(w.default,{size:"tiny",src:`${_.MARKETPLACE_API_PREFIX}/plugins/${e}/icon`},e)),!a&&(0,s.jsxs)("div",{className:"system-xs-medium text-text-tertiary",children:["+",l.length-14]})]})});var T=e.i(449980),S=e.i(391185),A=e.i(400612),E=e.i(157644),L=e.i(616301);e.i(47690);var I=e.i(144655);e.i(36860);var U=e.i(438270);let F=i.memo(e=>{let{className:t,noPlugins:l}=e,{t:a}=(0,r.useTranslation)(),n=l?(0,s.jsx)(U.Group,{className:"size-6 text-text-quaternary"}):(0,s.jsx)(I.SearchMenu,{className:"size-8 text-text-tertiary"}),i=a(`autoUpdate.noPluginPlaceholder.${l?"noInstalled":"noFound"}`,{ns:"plugin"});return(0,s.jsx)("div",{className:(0,y.cn)("flex items-center justify-center",t),children:(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[n,(0,s.jsx)("div",{className:"system-sm-regular mt-2 text-text-tertiary",children:i})]})})});var R=e.i(324935),M=e.i(683257),O=e.i(645429);let D=i.memo(e=>{let{payload:t,isChecked:l,onCheckChange:a}=e,n=(0,M.useGetLanguage)(),{plugin_id:i,declaration:r}=t,{label:o,author:c}=r;return(0,s.jsx)("div",{className:"p-1",children:(0,s.jsxs)("div",{className:"flex w-full select-none items-center rounded-lg pr-2 hover:bg-state-base-hover",children:[(0,s.jsxs)("div",{className:"flex h-8 grow items-center space-x-2 pl-3 pr-2",children:[(0,s.jsx)(w.default,{size:"tiny",src:`${_.MARKETPLACE_API_PREFIX}/plugins/${i}/icon`}),(0,s.jsx)("div",{className:"system-sm-medium max-w-[150px] shrink-0 truncate text-text-primary",children:(0,O.renderI18nObject)(o,n)}),(0,s.jsx)("div",{className:"system-xs-regular max-w-[150px] shrink-0  truncate text-text-quaternary",children:c})]}),(0,s.jsx)(R.default,{checked:l,onCheck:a,className:"shrink-0"})]})})}),$=i.memo(e=>{let{trigger:t,value:l,onChange:a,isShow:n,onShowChange:o}=e,{t:c}=(0,r.useTranslation)(),u=(0,i.useCallback)(()=>{o(!n)},[o,n]),d=[{key:L.PLUGIN_TYPE_SEARCH_MAP.all,name:c("category.all",{ns:"plugin"})},{key:L.PLUGIN_TYPE_SEARCH_MAP.model,name:c("category.models",{ns:"plugin"})},{key:L.PLUGIN_TYPE_SEARCH_MAP.tool,name:c("category.tools",{ns:"plugin"})},{key:L.PLUGIN_TYPE_SEARCH_MAP.agent,name:c("category.agents",{ns:"plugin"})},{key:L.PLUGIN_TYPE_SEARCH_MAP.extension,name:c("category.extensions",{ns:"plugin"})},{key:L.PLUGIN_TYPE_SEARCH_MAP.datasource,name:c("category.datasources",{ns:"plugin"})},{key:L.PLUGIN_TYPE_SEARCH_MAP.trigger,name:c("category.triggers",{ns:"plugin"})},{key:L.PLUGIN_TYPE_SEARCH_MAP.bundle,name:c("category.bundles",{ns:"plugin"})}],[m,x]=(0,i.useState)(L.PLUGIN_TYPE_SEARCH_MAP.all),[g,h]=(0,i.useState)(""),[f,v]=(0,i.useState)([]),{data:b,isLoading:j}=(0,E.useInstalledPluginList)(),N=(0,i.useMemo)(()=>(b?b.plugins:[]).filter(e=>e.source===p.PluginSource.marketplace&&(m===L.PLUGIN_TYPE_SEARCH_MAP.all||e.declaration.category===m)&&(0===f.length||f.some(s=>e.declaration.tags.includes(s)))&&(""===g||e.plugin_id.toLowerCase().includes(g.toLowerCase()))),[b,m,g,f]),P=(0,i.useCallback)(e=>()=>{a(l.includes(e)?l.filter(s=>s!==e):[...l,e])},[a,l]),C=(0,s.jsx)("div",{className:"max-h-[396px] overflow-y-auto",children:N.map(e=>(0,s.jsx)(D,{payload:e,isChecked:l.includes(e.plugin_id),onCheckChange:P(e.plugin_id)},e.plugin_id))}),w=(0,s.jsx)("div",{className:"flex h-[396px] items-center justify-center",children:(0,s.jsx)(T.default,{})}),_=(0,s.jsx)(F,{className:"h-[396px]",noPlugins:!g});return(0,s.jsxs)(S.PortalToFollowElem,{placement:"top",offset:0,open:n,onOpenChange:o,children:[(0,s.jsx)(S.PortalToFollowElemTrigger,{className:"block w-full",onClick:u,children:t}),(0,s.jsx)(S.PortalToFollowElemContent,{className:"z-[1000]",children:(0,s.jsxs)("div",{className:(0,y.cn)("relative min-h-20 w-full rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur pb-2 shadow-lg backdrop-blur-sm"),children:[(0,s.jsx)("div",{className:"p-2 pb-1",children:(0,s.jsx)(A.default,{search:g,onSearchChange:h,tags:f,onTagsChange:v,placeholder:c("searchTools",{ns:"plugin"}),inputClassName:"w-full"})}),(0,s.jsx)("div",{className:"flex items-center justify-between border-b-[0.5px] border-divider-subtle bg-background-default-hover px-3 shadow-xs",children:(0,s.jsx)("div",{className:"flex h-8 items-center space-x-1",children:d.map(e=>(0,s.jsx)("div",{className:(0,y.cn)("flex h-6 cursor-pointer items-center rounded-md px-2 hover:bg-state-base-hover","text-xs font-medium text-text-secondary",m===e.key&&"bg-state-base-hover-alt"),onClick:()=>x(e.key),children:e.name},e.key))})}),!j&&N.length>0&&C,!j&&0===N.length&&_,j&&w]})})]})}),G="autoUpdate",z=i.memo(e=>{let{updateMode:a,value:n,onChange:i}=e,{t:c}=(0,r.useTranslation)(),u=n.length>0,d=a===P.AUTO_UPDATE_MODE.exclude,[p,{set:m}]=(0,l.useBoolean)(!1);return(0,s.jsxs)("div",{className:"mt-2 rounded-[10px] bg-background-section-burn p-2.5",children:[u?(0,s.jsxs)("div",{className:"flex justify-between text-text-tertiary",children:[(0,s.jsx)("div",{className:"system-xs-medium",children:c(`${G}.${d?"excludeUpdate":"partialUPdate"}`,{ns:"plugin",num:n.length})}),(0,s.jsx)("div",{className:"system-xs-medium cursor-pointer",onClick:()=>{i([])},children:c(`${G}.operation.clearAll`,{ns:"plugin"})})]}):(0,s.jsx)(C,{updateMode:a}),u&&(0,s.jsx)(k,{className:"mt-2",plugins:n}),(0,s.jsx)($,{trigger:(0,s.jsxs)(o.default,{className:"mt-2 w-full",size:"small",variant:"secondary-accent",children:[(0,s.jsx)(t.RiAddLine,{className:"size-3.5"}),c(`${G}.operation.select`,{ns:"plugin"})]}),value:n,onChange:i,isShow:p,onShowChange:m})]})}),q="autoUpdate.strategy",B=e=>{let{value:l,onChange:a}=e,{t:n}=(0,r.useTranslation)(),[c,u]=(0,i.useState)(!1),d=[{value:P.AUTO_UPDATE_STRATEGY.disabled,label:n(`${q}.disabled.name`,{ns:"plugin"}),description:n(`${q}.disabled.description`,{ns:"plugin"})},{value:P.AUTO_UPDATE_STRATEGY.fixOnly,label:n(`${q}.fixOnly.name`,{ns:"plugin"}),description:n(`${q}.fixOnly.description`,{ns:"plugin"})},{value:P.AUTO_UPDATE_STRATEGY.latest,label:n(`${q}.latest.name`,{ns:"plugin"}),description:n(`${q}.latest.description`,{ns:"plugin"})}],p=d.find(e=>e.value===l);return(0,s.jsxs)(S.PortalToFollowElem,{open:c,onOpenChange:u,placement:"top-end",offset:4,children:[(0,s.jsx)(S.PortalToFollowElemTrigger,{onClick:e=>{e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),u(e=>!e)},children:(0,s.jsxs)(o.default,{size:"small",children:[p?.label,(0,s.jsx)(t.RiArrowDownSLine,{className:"h-3.5 w-3.5"})]})}),(0,s.jsx)(S.PortalToFollowElemContent,{className:"z-[99]",children:(0,s.jsx)("div",{className:"w-[280px] rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur p-1 shadow-lg",children:d.map(e=>(0,s.jsxs)("div",{className:"flex cursor-pointer rounded-lg p-2 pr-3 hover:bg-state-base-hover",onClick:s=>{s.stopPropagation(),s.nativeEvent.stopImmediatePropagation(),a(e.value),u(!1)},children:[(0,s.jsx)("div",{className:"mr-1 w-4 shrink-0",children:l===e.value&&(0,s.jsx)(t.RiCheckLine,{className:"h-4 w-4 text-text-accent"})}),(0,s.jsxs)("div",{className:"grow",children:[(0,s.jsx)("div",{className:"system-sm-semibold mb-0.5 text-text-secondary",children:e.label}),(0,s.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:e.description})]})]},e.value))})})]})};var H=e.i(564536);let Y="autoUpdate",Q=e=>{let{children:t}=e,l=(0,j.useModalContextSelector)(e=>e.setShowAccountSettingModal);return(0,s.jsx)("span",{className:"body-xs-regular cursor-pointer text-text-accent",onClick:()=>l({payload:v.ACCOUNT_SETTING_TAB.LANGUAGE}),children:t})},K=i.memo(e=>{let{payload:l,onChange:a}=e,{t:n}=(0,r.useTranslation)(),{userProfile:{timezone:o}}=(0,b.useAppContext)(),{strategy_setting:c,upgrade_time_of_day:u,upgrade_mode:d,exclude_plugins:p,include_plugins:x}=l,v=(0,i.useCallback)(e=>e.filter(e=>Number.parseInt(e,10)%15==0),[]),j=(0,i.useMemo)(()=>{switch(c){case P.AUTO_UPDATE_STRATEGY.fixOnly:return n(`${Y}.strategy.fixOnly.selectedDescription`,{ns:"plugin"});case P.AUTO_UPDATE_STRATEGY.latest:return n(`${Y}.strategy.latest.selectedDescription`,{ns:"plugin"});default:return""}},[c,n]),C=(0,i.useMemo)(()=>{switch(d){case P.AUTO_UPDATE_MODE.partial:return x;case P.AUTO_UPDATE_MODE.exclude:return p;default:return[]}},[d,p,x]),w=(0,i.useCallback)(e=>{d===P.AUTO_UPDATE_MODE.partial?a({...l,include_plugins:e}):d===P.AUTO_UPDATE_MODE.exclude&&a({...l,exclude_plugins:e})},[l,d,a]),_=(0,i.useCallback)(e=>s=>{a({...l,[e]:s})},[l,a]),k=(0,i.useCallback)(e=>{let{inputElem:l,onClick:a,isOpen:n}=e;return(0,s.jsxs)("div",{className:"group float-right flex h-8 w-[160px] cursor-pointer items-center justify-between rounded-lg bg-components-input-bg-normal px-2 hover:bg-state-base-hover-alt",onClick:a,children:[(0,s.jsxs)("div",{className:"flex w-0 grow items-center gap-x-1",children:[(0,s.jsx)(t.RiTimeLine,{className:(0,y.cn)("h-4 w-4 shrink-0 text-text-tertiary",n?"text-text-secondary":"group-hover:text-text-secondary")}),l]}),(0,s.jsx)("div",{className:"system-sm-regular text-text-tertiary",children:(0,f.convertTimezoneToOffsetStr)(o)})]})},[o]);return(0,s.jsxs)("div",{className:"self-stretch px-6",children:[(0,s.jsxs)("div",{className:"my-3 flex items-center",children:[(0,s.jsx)("div",{className:"system-xs-medium-uppercase text-text-tertiary",children:n(`${Y}.updateSettings`,{ns:"plugin"})}),(0,s.jsx)("div",{className:"ml-2 h-px grow bg-divider-subtle"})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(N,{label:n(`${Y}.automaticUpdates`,{ns:"plugin"}),description:j}),(0,s.jsx)(B,{value:c,onChange:_("strategy_setting")})]}),c!==P.AUTO_UPDATE_STRATEGY.disabled&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(N,{label:n(`${Y}.updateTime`,{ns:"plugin"})}),(0,s.jsxs)("div",{className:"flex flex-col justify-start",children:[(0,s.jsx)(h.default,{value:(0,H.timeOfDayToDayjs)((0,H.convertUTCDaySecondsToLocalSeconds)(u,o)),timezone:o,onChange:e=>_("upgrade_time_of_day")((0,H.convertLocalSecondsToUTCDaySeconds)((0,H.dayjsToTimeOfDay)(e),o)),onClear:()=>_("upgrade_time_of_day")((0,H.convertLocalSecondsToUTCDaySeconds)(0,o)),popupClassName:"z-[99]",title:n(`${Y}.updateTime`,{ns:"plugin"}),minuteFilter:v,renderTrigger:k,placement:"bottom-end"}),(0,s.jsx)("div",{className:"body-xs-regular mt-1 text-right text-text-tertiary",children:(0,s.jsx)(g.Trans,{i18nKey:`${Y}.changeTimezone`,ns:"plugin",components:{setTimezone:(0,s.jsx)(Q,{})}})})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(N,{label:n(`${Y}.specifyPluginsToUpdate`,{ns:"plugin"})}),(0,s.jsx)("div",{className:"mt-1 flex w-full items-start justify-between gap-2",children:[P.AUTO_UPDATE_MODE.update_all,P.AUTO_UPDATE_MODE.exclude,P.AUTO_UPDATE_MODE.partial].map(e=>(0,s.jsx)(m.default,{title:n(`${Y}.upgradeMode.${e}`,{ns:"plugin"}),onSelect:()=>_("upgrade_mode")(e),selected:d===e,className:"flex-1"},e))}),d!==P.AUTO_UPDATE_MODE.update_all&&(0,s.jsx)(z,{value:C,onChange:w,updateMode:d})]})]})]})]})}),V={strategy_setting:P.AUTO_UPDATE_STRATEGY.disabled,upgrade_time_of_day:0,upgrade_mode:P.AUTO_UPDATE_MODE.update_all,exclude_plugins:[],include_plugins:[]},W="privilege",X=i.memo(e=>{let{payload:t,onHide:l,onSave:a}=e,{t:n}=(0,r.useTranslation)(),{auto_upgrade:c,permission:u}=t||{},[g,h]=(0,i.useState)(u),[f,v]=(0,i.useState)(c||V),{enable_marketplace:b}=(0,x.useGlobalPublicStore)(e=>e.systemFeatures),j=(0,i.useCallback)(e=>s=>{h({...g,[e]:s})},[g]),y=(0,i.useCallback)(async()=>{await a({permission:g,auto_upgrade:f}),l()},[l,a,f,g]);return(0,s.jsx)(d.default,{isShow:!0,onClose:l,closable:!0,className:"w-[620px] max-w-[620px] !p-0",children:(0,s.jsxs)("div",{className:"shadows-shadow-xl flex w-full flex-col items-start rounded-2xl border border-components-panel-border bg-components-panel-bg",children:[(0,s.jsx)("div",{className:"flex items-start gap-2 self-stretch pb-3 pl-6 pr-14 pt-6",children:(0,s.jsx)("span",{className:"title-2xl-semi-bold self-stretch text-text-primary",children:n(`${W}.title`,{ns:"plugin"})})}),(0,s.jsx)("div",{className:"flex flex-col items-start justify-center gap-4 self-stretch px-6 py-3",children:[{title:n(`${W}.whoCanInstall`,{ns:"plugin"}),key:"install_permission",value:g?.install_permission||p.PermissionType.noOne},{title:n(`${W}.whoCanDebug`,{ns:"plugin"}),key:"debug_permission",value:g?.debug_permission||p.PermissionType.noOne}].map(e=>{let{title:t,key:l,value:a}=e;return(0,s.jsxs)("div",{className:"flex flex-col items-start gap-1 self-stretch",children:[(0,s.jsx)(N,{label:t}),(0,s.jsx)("div",{className:"flex w-full items-start justify-between gap-2",children:[p.PermissionType.everyone,p.PermissionType.admin,p.PermissionType.noOne].map(e=>(0,s.jsx)(m.default,{title:n(`${W}.${e}`,{ns:"plugin"}),onSelect:()=>j(l)(e),selected:a===e,className:"flex-1"},e))})]},l)})}),b&&(0,s.jsx)(K,{payload:f,onChange:v}),(0,s.jsxs)("div",{className:"flex h-[76px] items-center justify-end gap-2 self-stretch p-6 pt-5",children:[(0,s.jsx)(o.default,{className:"min-w-[72px]",onClick:l,children:n("operation.cancel",{ns:"common"})}),(0,s.jsx)(o.default,{className:"min-w-[72px]",variant:"primary",onClick:y,children:n("operation.save",{ns:"common"})})]})]})})});var Z=e.i(261484),J=e.i(549213),ee=e.i(887460),es=e.i(842090),et=e.i(40666),el=e.i(486287),ea=e.i(931576),en=e.i(2429),ei=e.i(21746);let er="debugInfo",eo=i.memo(()=>{let{t:e}=(0,r.useTranslation)(),l=(0,M.useDocLink)(),{data:a,isLoading:n}=(0,E.useDebugKey)(),i=a?.key?.replace(/(.{8})(.*)(.{8})/,"$1********$3");return n?null:(0,s.jsx)(u.default,{triggerMethod:"click",disabled:!a,popupContent:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex items-center gap-1 self-stretch",children:[(0,s.jsx)("span",{className:"system-sm-semibold flex shrink-0 grow basis-0 flex-col items-start justify-center text-text-secondary",children:e(`${er}.title`,{ns:"plugin"})}),(0,s.jsxs)("a",{href:l("/develop-plugin/features-and-specs/plugin-types/remote-debug-a-plugin"),target:"_blank",className:"flex cursor-pointer items-center gap-0.5 text-text-accent-light-mode-only",children:[(0,s.jsx)("span",{className:"system-xs-medium",children:e(`${er}.viewDocs`,{ns:"plugin"})}),(0,s.jsx)(t.RiArrowRightUpLine,{className:"h-3 w-3"})]})]}),(0,s.jsxs)("div",{className:"space-y-0.5",children:[(0,s.jsx)(ei.default,{label:"URL",value:`${a?.host}:${a?.port}`}),(0,s.jsx)(ei.default,{label:"Key",value:a?.key||"",maskedValue:i})]})]}),popupClassName:"flex flex-col items-start w-[256px] px-4 py-3.5 gap-1 border border-components-panel-border rounded-xl bg-components-tooltip-bg shadows-shadow-lg z-50",asChild:!1,position:"bottom",children:(0,s.jsx)(o.default,{className:"h-full w-full p-2 text-components-button-secondary-text",children:(0,s.jsx)(t.RiBugLine,{className:"h-4 w-4"})})})});e.i(61666);var ec=e.i(560285);e.i(288243);var eu=e.i(615124);e.i(992280);var ed=e.i(523723),ep=e.i(622085);let em=e=>{let{onSwitchToMarketplaceTab:l}=e,{t:n}=(0,r.useTranslation)(),c=(0,i.useRef)(null),[u,d]=(0,i.useState)(!1),[p,m]=(0,i.useState)(null),[g,h]=(0,i.useState)(null),{enable_marketplace:f,plugin_installation_permission:v}=(0,x.useGlobalPublicStore)(e=>e.systemFeatures),[b,j]=(0,i.useState)([]);return(0,i.useEffect)(()=>{let e=[];f&&e.push({icon:ed.MagicBox,text:n("source.marketplace",{ns:"plugin"}),action:"marketplace"}),v.restrict_to_marketplace_only||(e.push({icon:eu.Github,text:n("source.github",{ns:"plugin"}),action:"github"}),e.push({icon:ec.FileZip,text:n("source.local",{ns:"plugin"}),action:"local"})),j(e)},[v,f,n]),(0,s.jsxs)(S.PortalToFollowElem,{open:u,onOpenChange:d,placement:"bottom-start",offset:4,children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(S.PortalToFollowElemTrigger,{onClick:()=>d(e=>!e),children:(0,s.jsxs)(o.default,{className:(0,y.cn)("h-full w-full p-2 text-components-button-secondary-text",u&&"bg-state-base-hover"),children:[(0,s.jsx)(t.RiAddLine,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"pl-1",children:n("installPlugin",{ns:"plugin"})}),(0,s.jsx)(t.RiArrowDownSLine,{className:"ml-1 h-4 w-4"})]})}),(0,s.jsx)(S.PortalToFollowElemContent,{className:"z-[1002]",children:(0,s.jsxs)("div",{className:"shadows-shadow-lg flex w-[200px] flex-col items-start rounded-xl border border-components-panel-border bg-components-panel-bg-blur p-1 pb-2",children:[(0,s.jsx)("span",{className:"system-xs-medium-uppercase flex items-start self-stretch pb-0.5 pl-2 pr-3 pt-1 text-text-tertiary",children:n("installFrom",{ns:"plugin"})}),(0,s.jsx)("input",{type:"file",ref:c,style:{display:"none"},onChange:e=>{let s=e.target.files?.[0];s&&(h(s),m("local"),d(!1))},accept:_.SUPPORT_INSTALL_LOCAL_FILE_EXTENSIONS}),(0,s.jsx)("div",{className:"w-full",children:b.map(e=>{let{icon:t,text:a,action:n}=e;return(0,s.jsxs)("div",{className:"flex w-full !cursor-pointer items-center gap-1 rounded-lg px-2 py-1.5 hover:bg-state-base-hover",onClick:()=>{"local"===n?c.current?.click():("marketplace"===n?l():m(n),d(!1))},children:[(0,s.jsx)(t,{className:"h-4 w-4 text-text-tertiary"}),(0,s.jsx)("span",{className:"system-md-regular px-1 text-text-secondary",children:a})]},n)})})]})})]}),"github"===p&&(0,s.jsx)(ep.default,{onSuccess:a.noop,onClose:()=>m(null)}),"local"===p&&g&&(0,s.jsx)(el.default,{file:g,onClose:()=>m(null),onSuccess:a.noop})]})};var ex=e.i(222573);let eg=e=>{let{plugin:t,getIconUrl:l,language:a,statusIcon:n,statusText:i,statusClassName:r,action:o}=e;return(0,s.jsxs)("div",{className:"flex items-center rounded-lg p-2 hover:bg-state-base-hover",children:[(0,s.jsxs)("div",{className:"relative mr-2 flex h-6 w-6 items-center justify-center rounded-md border-[0.5px] border-components-panel-border-subtle bg-background-default-dodge",children:[n,(0,s.jsx)(w.default,{size:"tiny",src:l(t.icon)})]}),(0,s.jsxs)("div",{className:"grow",children:[(0,s.jsx)("div",{className:"system-md-regular truncate text-text-secondary",children:t.labels[a]}),(0,s.jsx)("div",{className:`system-xs-regular ${r||"text-text-tertiary"}`,children:i})]}),o]})},eh=e=>{let{title:t,count:l,plugins:a,getIconUrl:n,language:i,statusIcon:r,defaultStatusText:o,statusClassName:c,headerAction:u,renderItemAction:d}=e;return 0===a.length?null:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"system-sm-semibold-uppercase sticky top-0 flex h-7 items-center justify-between px-2 pt-1 text-text-secondary",children:[t," ","(",l,")",u]}),(0,s.jsx)("div",{className:"max-h-[200px] overflow-y-auto",children:a.map(e=>(0,s.jsx)(eg,{plugin:e,getIconUrl:n,language:i,statusIcon:r,statusText:e.message||o,statusClassName:c,action:d?.(e)},e.plugin_unique_identifier))})]})},ef=e=>{let{runningPlugins:l,successPlugins:a,errorPlugins:n,getIconUrl:i,onClearAll:c,onClearErrors:u,onClearSingle:d}=e,{t:p}=(0,r.useTranslation)(),m=(0,M.useGetLanguage)();return(0,s.jsxs)("div",{className:"w-[360px] rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur p-1 shadow-lg",children:[l.length>0&&(0,s.jsx)(eh,{title:p("task.installing",{ns:"plugin"}),count:l.length,plugins:l,getIconUrl:i,language:m,statusIcon:(0,s.jsx)(t.RiLoaderLine,{className:"absolute -bottom-0.5 -right-0.5 z-10 h-3 w-3 animate-spin text-text-accent"}),defaultStatusText:p("task.installing",{ns:"plugin"})}),a.length>0&&(0,s.jsx)(eh,{title:p("task.installed",{ns:"plugin"}),count:a.length,plugins:a,getIconUrl:i,language:m,statusIcon:(0,s.jsx)(t.RiCheckboxCircleFill,{className:"absolute -bottom-0.5 -right-0.5 z-10 h-3 w-3 text-text-success"}),defaultStatusText:p("task.installed",{ns:"plugin"}),statusClassName:"text-text-success",headerAction:(0,s.jsx)(o.default,{className:"shrink-0",size:"small",variant:"ghost",onClick:c,children:p("task.clearAll",{ns:"plugin"})})}),n.length>0&&(0,s.jsx)(eh,{title:p("task.installError",{ns:"plugin",errorLength:n.length}),count:n.length,plugins:n,getIconUrl:i,language:m,statusIcon:(0,s.jsx)(t.RiErrorWarningFill,{className:"absolute -bottom-0.5 -right-0.5 z-10 h-3 w-3 text-text-destructive"}),defaultStatusText:p("task.installError",{ns:"plugin",errorLength:n.length}),statusClassName:"text-text-destructive break-all",headerAction:(0,s.jsx)(o.default,{className:"shrink-0",size:"small",variant:"ghost",onClick:u,children:p("task.clearAll",{ns:"plugin"})}),renderItemAction:e=>(0,s.jsx)(o.default,{className:"shrink-0",size:"small",variant:"ghost",onClick:()=>d(e.taskId,e.plugin_unique_identifier),children:p("operation.clear",{ns:"common"})})})]})};var ev=e.i(584186),eb=e.i(85061);let ej=e=>{let{tip:l,isInstalling:a,isInstallingWithSuccess:n,isInstallingWithError:i,isSuccess:r,isFailed:o,successPluginsLength:c,runningPluginsLength:d,totalPluginsLength:p,onClick:m}=e,x=a||i,g=i||o,h=r||c>0&&0===d;return(0,s.jsx)(u.default,{popupContent:l,asChild:!0,offset:8,children:(0,s.jsxs)("div",{className:(0,y.cn)("relative flex h-8 w-8 items-center justify-center rounded-lg border-[0.5px] border-components-button-secondary-border bg-components-button-secondary-bg shadow-xs hover:bg-components-button-secondary-bg-hover",g&&"cursor-pointer border-components-button-destructive-secondary-border-hover bg-state-destructive-hover hover:bg-state-destructive-hover-alt",(a||n||r)&&"cursor-pointer hover:bg-components-button-secondary-bg-hover"),id:"plugin-task-trigger",onClick:m,children:[x?(0,s.jsx)(eb.default,{}):(0,s.jsx)(t.RiInstallLine,{className:(0,y.cn)("h-4 w-4 text-components-button-secondary-text",g&&"text-components-button-destructive-secondary-text")}),(0,s.jsxs)("div",{className:"absolute -right-1 -top-1",children:[(a||n)&&(0,s.jsx)(ev.default,{percentage:(p>0?c/p:0)*100,circleFillColor:"fill-components-progress-brand-bg"}),i&&(0,s.jsx)(ev.default,{percentage:(p>0?d/p:0)*100,circleFillColor:"fill-components-progress-brand-bg",sectorFillColor:"fill-components-progress-error-border",circleStrokeColor:"stroke-components-progress-error-border"}),h&&!a&&!n&&!i&&(0,s.jsx)(t.RiCheckboxCircleFill,{className:"h-3.5 w-3.5 text-text-success"}),o&&(0,s.jsx)(t.RiErrorWarningFill,{className:"h-3.5 w-3.5 text-text-destructive"})]})]})})};var ey=e.i(840636);let eN=()=>{let{t:e}=(0,r.useTranslation)(),[t,l]=(0,i.useState)(!1),{errorPlugins:a,successPlugins:n,runningPlugins:o,runningPluginsLength:c,successPluginsLength:u,errorPluginsLength:d,totalPluginsLength:p,isInstalling:m,isInstallingWithSuccess:x,isInstallingWithError:g,isSuccess:h,isFailed:f,handleClearErrorPlugin:v}=(0,ey.usePluginTaskStatus)(),{getIconUrl:b}=(0,ex.default)(),j=(0,i.useMemo)(()=>g?e("task.installingWithError",{ns:"plugin",installingLength:c,successLength:u,errorLength:d}):x?e("task.installingWithSuccess",{ns:"plugin",installingLength:c,successLength:u}):m?e("task.installing",{ns:"plugin"}):f?e("task.installedError",{ns:"plugin",errorLength:d}):h?e("task.installSuccess",{ns:"plugin",successLength:u}):e("task.installed",{ns:"plugin"}),[d,f,m,g,x,h,c,u,e]),y=(0,i.useCallback)(async e=>{for(let s of e)await v(s.taskId,s.plugin_unique_identifier);0===c&&l(!1)},[v,c]),N=(0,i.useCallback)(()=>y([...n,...a]),[y,n,a]),P=(0,i.useCallback)(()=>y(a),[y,a]),C=(0,i.useCallback)((e,s)=>y([{taskId:e,plugin_unique_identifier:s}]),[y]),w=(0,i.useCallback)(()=>{(f||m||x||g||h)&&l(e=>!e)},[f,m,x,g,h]);return 0===p?null:(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsxs)(S.PortalToFollowElem,{open:t,onOpenChange:l,placement:"bottom-start",offset:{mainAxis:4,crossAxis:79},children:[(0,s.jsx)(S.PortalToFollowElemTrigger,{onClick:w,children:(0,s.jsx)(ej,{tip:j,isInstalling:m,isInstallingWithSuccess:x,isInstallingWithError:g,isSuccess:h,isFailed:f,successPluginsLength:u,runningPluginsLength:c,totalPluginsLength:p,onClick:()=>{}})}),(0,s.jsx)(S.PortalToFollowElemContent,{className:"z-[11]",children:(0,s.jsx)(ef,{runningPlugins:o,successPlugins:n,errorPlugins:a,getIconUrl:b,onClearAll:N,onClearErrors:P,onClearSingle:C})})]})})};var eP=e.i(95085);let eC=e=>{let{plugins:d,marketplace:p}=e,{t:m}=(0,r.useTranslation)(),g=(0,M.useDocLink)();(0,Z.default)(m("metadata.title",{ns:"plugin"}));let[{packageId:h,bundleInfo:f},v]=(0,J.usePluginInstallation)(),[b,j]=(0,i.useState)(null),[N,P]=(0,i.useState)([]),[C,{setTrue:w,setFalse:k}]=(0,l.useBoolean)(!1),T=()=>{k(),v(null)},[S,A]=(0,i.useState)(null);(0,i.useEffect)(()=>{(async()=>{if(j(null),await (0,es.sleep)(100),h){let{data:e}=await (0,ee.fetchManifestFromMarketPlace)(encodeURIComponent(h)),{plugin:s,version:t}=e;A({...s,version:t.version,icon:`${_.MARKETPLACE_API_PREFIX}/plugins/${s.org}/${s.name}/icon`}),j(h),w();return}if(f)try{let{data:e}=await (0,ee.fetchBundleInfoFromMarketPlace)(f);P(e.version.dependencies),w()}catch(e){console.error("Failed to load bundle info:",e)}})()},[h,f,w]);let{referenceSetting:E,canManagement:I,canDebugger:U,canSetPermissions:F,setReferenceSettings:R}=(0,eP.default)(),[O,{setTrue:D,setFalse:$}]=(0,l.useBoolean)(!1),[G,z]=(0,i.useState)(null),q=(0,en.usePluginPageContext)(e=>e.containerRef),B=(0,en.usePluginPageContext)(e=>e.options),H=(0,en.usePluginPageContext)(e=>e.activeTab),Y=(0,en.usePluginPageContext)(e=>e.setActiveTab),{enable_marketplace:Q}=(0,x.useGlobalPublicStore)(e=>e.systemFeatures),K=(0,i.useMemo)(()=>H===et.PLUGIN_PAGE_TABS_MAP.plugins,[H]),V=(0,i.useMemo)(()=>{let e=Object.values(L.PLUGIN_TYPE_SEARCH_MAP);return H===et.PLUGIN_PAGE_TABS_MAP.marketplace||e.includes(H)},[H]),{dragging:W,fileUploader:ei,fileChangeHandle:er,removeFile:ec}=(e=>{let{onFileChange:s,containerRef:t,enabled:l=!0}=e,[a,n]=(0,i.useState)(!1),r=(0,i.useRef)(null),o=e=>{e.preventDefault(),e.stopPropagation(),e.dataTransfer?.types.includes("Files")&&n(!0)},c=e=>{e.preventDefault(),e.stopPropagation()},u=e=>{e.preventDefault(),e.stopPropagation(),null!==e.relatedTarget&&t.current?.contains(e.relatedTarget)||n(!1)},d=e=>{if(e.preventDefault(),e.stopPropagation(),n(!1),!e.dataTransfer)return;let t=Array.from(e.dataTransfer.files);t.length>0&&s(t[0])},p=l?e=>{s(e.target.files?.[0]||null)}:null,m=l?()=>{r.current&&(r.current.value=""),s(null)}:null;return(0,i.useEffect)(()=>{if(!l)return;let e=t.current;return e&&(e.addEventListener("dragenter",o),e.addEventListener("dragover",c),e.addEventListener("dragleave",u),e.addEventListener("drop",d)),()=>{e&&(e.removeEventListener("dragenter",o),e.removeEventListener("dragover",c),e.removeEventListener("dragleave",u),e.removeEventListener("drop",d))}},[t,l]),{dragging:!!l&&a,fileUploader:r,fileChangeHandle:p,removeFile:m}})({onFileChange:e=>{e&&e.name.endsWith(".difypkg")?z(e):z(null)},containerRef:q,enabled:K&&I});return(0,s.jsxs)("div",{id:"marketplace-container",ref:q,style:{scrollbarGutter:"stable"},className:(0,y.cn)("relative flex grow flex-col overflow-y-auto border-t border-divider-subtle",K?"rounded-t-xl bg-components-panel-bg":"bg-background-body"),children:[(0,s.jsx)("div",{className:(0,y.cn)("sticky top-0 z-10 flex min-h-[60px] items-center gap-1 self-stretch bg-components-panel-bg px-12 pb-2 pt-4",V&&"bg-background-body"),children:(0,s.jsxs)("div",{className:"flex w-full items-center justify-between",children:[(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)(c.default,{value:K?et.PLUGIN_PAGE_TABS_MAP.plugins:et.PLUGIN_PAGE_TABS_MAP.marketplace,onChange:Y,options:B})}),(0,s.jsxs)("div",{className:"flex shrink-0 items-center gap-1",children:[V&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.default,{href:"https://github.com/langgenius/dify-plugins/issues/new?template=plugin_request.yaml",target:"_blank",children:(0,s.jsx)(o.default,{variant:"ghost",className:"text-text-tertiary",children:m("requestAPlugin",{ns:"plugin"})})}),(0,s.jsx)(n.default,{href:g("/develop-plugin/publishing/marketplace-listing/release-to-dify-marketplace"),target:"_blank",children:(0,s.jsxs)(o.default,{className:"px-3",variant:"secondary-accent",children:[(0,s.jsx)(t.RiBookOpenLine,{className:"mr-1 h-4 w-4"}),m("publishPlugins",{ns:"plugin"})]})}),(0,s.jsx)("div",{className:"mx-1 h-3.5 w-[1px] shrink-0 bg-divider-regular"})]}),(0,s.jsx)(eN,{}),I&&(0,s.jsx)(em,{onSwitchToMarketplaceTab:()=>Y("discover")}),U&&(0,s.jsx)(eo,{}),F&&(0,s.jsx)(u.default,{popupContent:m("privilege.title",{ns:"plugin"}),children:(0,s.jsx)(o.default,{"data-testid":"plugin-settings-button",className:"group h-full w-full p-2 text-components-button-secondary-text",onClick:D,children:(0,s.jsx)(t.RiEqualizer2Line,{className:"h-4 w-4"})})})]})]})}),K&&(0,s.jsxs)(s.Fragment,{children:[d,W&&(0,s.jsx)("div",{className:"absolute inset-0 m-0.5 rounded-2xl border-2 border-dashed border-components-dropzone-border-accent bg-[rgba(21,90,239,0.14)] p-2"}),(0,s.jsxs)("div",{className:`flex items-center justify-center gap-2 py-4 ${W?"text-text-accent":"text-text-quaternary"}`,children:[(0,s.jsx)(t.RiDragDropLine,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"system-xs-regular",children:m("installModal.dropPluginToInstall",{ns:"plugin"})})]}),G&&(0,s.jsx)(el.default,{file:G,onClose:ec??a.noop,onSuccess:a.noop}),(0,s.jsx)("input",{ref:ei,className:"hidden",type:"file",id:"fileUploader",accept:_.SUPPORT_INSTALL_LOCAL_FILE_EXTENSIONS,onChange:er??a.noop})]}),V&&Q&&p,O&&(0,s.jsx)(X,{payload:E,onHide:$,onSave:R}),C&&b&&(0,s.jsx)(ea.default,{manifest:S,uniqueIdentifier:b,isBundle:!!f,dependencies:N,onClose:T,onSuccess:T})]})};e.s(["default",0,e=>(0,s.jsx)(en.PluginPageContextProvider,{children:(0,s.jsx)(eC,{...e})})],303504)},792805,e=>{"use strict";var s=e.i(563199),t=e.i(38532),l=e.i(268255);e.i(152567);var a=e.i(408767),n=e.i(151094),i=e.i(449980),r=e.i(828410),o=e.i(683257),c=e.i(645429),u=e.i(157644),d=e.i(944911),p=e.i(2429),m=e.i(124836);e.i(36860);var x=e.i(438270);e.i(61666);var g=e.i(560285);e.i(288243);var h=e.i(615124);e.i(992280);var f=e.i(523723),v=e.i(622085),b=e.i(486287),j=e.i(925521),y=e.i(494268),N=e.i(850917);let P=()=>{let{t:e}=(0,a.useTranslation)(),t=(0,l.useRef)(null),[i,r]=(0,l.useState)(null),[o,c]=(0,l.useState)(null),{enable_marketplace:d,plugin_installation_permission:P}=(0,y.useGlobalPublicStore)(e=>e.systemFeatures),C=(0,p.usePluginPageContext)(e=>e.setActiveTab),w=(0,p.usePluginPageContext)(e=>e.filters),{data:_}=(0,u.useInstalledPluginList)(),k=(0,l.useMemo)(()=>_?.plugins.length===0?e("list.noInstalled",{ns:"plugin"}):w.categories.length>0||w.tags.length>0||w.searchQuery?e("list.notFound",{ns:"plugin"}):void 0,[_?.plugins.length,e,w.categories.length,w.tags.length,w.searchQuery]),[T,S]=(0,l.useState)([]);return(0,l.useEffect)(()=>{let s=[];d&&s.push({icon:f.MagicBox,text:e("source.marketplace",{ns:"plugin"}),action:"marketplace"}),P.restrict_to_marketplace_only||(s.push({icon:h.Github,text:e("source.github",{ns:"plugin"}),action:"github"}),s.push({icon:g.FileZip,text:e("source.local",{ns:"plugin"}),action:"local"})),S(s)},[P,d,e]),(0,s.jsxs)("div",{className:"relative z-0 w-full grow",children:[(0,s.jsx)("div",{className:"absolute top-0 z-10 grid h-full w-full grid-cols-2 gap-2 overflow-hidden px-12",children:Array.from({length:20}).fill(0).map((e,t)=>(0,s.jsx)("div",{className:"h-24 rounded-xl bg-components-card-bg"},t))}),(0,s.jsx)("div",{className:"absolute z-20 h-full w-full bg-gradient-to-b from-components-panel-bg-transparent to-components-panel-bg"}),(0,s.jsxs)("div",{className:"relative z-30 flex h-full items-center justify-center",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center gap-y-3",children:[(0,s.jsxs)("div",{className:"relative -z-10 flex size-14 items-center justify-center rounded-xl border-[1px] border-dashed border-divider-deep bg-components-card-bg shadow-xl shadow-shadow-shadow-5",children:[(0,s.jsx)(x.Group,{className:"h-5 w-5 text-text-tertiary"}),(0,s.jsx)(N.default,{className:"absolute right-[-1px] top-1/2 -translate-y-1/2"}),(0,s.jsx)(N.default,{className:"absolute left-[-1px] top-1/2 -translate-y-1/2"}),(0,s.jsx)(N.default,{className:"absolute left-1/2 top-0 -translate-x-1/2 -translate-y-1/2 rotate-90"}),(0,s.jsx)(N.default,{className:"absolute left-1/2 top-full -translate-x-1/2 -translate-y-1/2 rotate-90"})]}),(0,s.jsx)("div",{className:"system-md-regular text-text-tertiary",children:k}),(0,s.jsxs)("div",{className:"flex w-[236px] flex-col",children:[(0,s.jsx)("input",{type:"file",ref:t,style:{display:"none"},onChange:e=>{let s=e.target.files?.[0];s&&(c(s),r("local"))},accept:j.SUPPORT_INSTALL_LOCAL_FILE_EXTENSIONS}),(0,s.jsx)("div",{className:"flex w-full flex-col gap-y-1",children:T.map(e=>{let{icon:l,text:a,action:i}=e;return(0,s.jsxs)(n.default,{className:"justify-start gap-x-0.5 px-3",onClick:()=>{"local"===i?t.current?.click():"marketplace"===i?C("discover"):r(i)},children:[(0,s.jsx)(l,{className:"size-4"}),(0,s.jsx)("span",{className:"px-0.5",children:a})]},i)})})]})]}),"github"===i&&(0,s.jsx)(v.default,{onSuccess:m.noop,onClose:()=>r(null)}),"local"===i&&o&&(0,s.jsx)(b.default,{file:o,onClose:()=>r(null),onSuccess:m.noop})]})]})};P.displayName="Empty";let C=l.memo(P);var w=e.i(837699),_=e.i(324935),k=e.i(291631),T=e.i(391185),S=e.i(935139),A=e.i(40666);let E=e=>{let{value:t,onChange:n}=e,{t:i}=(0,a.useTranslation)(),[r,o]=(0,l.useState)(!1),[c,u]=(0,l.useState)(""),{categories:d,categoriesMap:p}=(0,A.useCategories)(),m=d.filter(e=>e.name.toLowerCase().includes(c.toLowerCase())),x=t.length;return(0,s.jsxs)(T.PortalToFollowElem,{placement:"bottom-start",offset:{mainAxis:4},open:r,onOpenChange:o,children:[(0,s.jsx)(T.PortalToFollowElemTrigger,{onClick:()=>o(e=>!e),children:(0,s.jsxs)("div",{className:(0,S.cn)("flex h-8 cursor-pointer items-center rounded-lg bg-components-input-bg-normal px-2 py-1 text-text-tertiary hover:bg-state-base-hover-alt",x&&"text-text-secondary",r&&"bg-state-base-hover"),children:[(0,s.jsxs)("div",{className:(0,S.cn)("system-sm-medium flex items-center p-1"),children:[!x&&i("allCategories",{ns:"plugin"}),!!x&&t.map(e=>p[e].label).slice(0,2).join(","),x>2&&(0,s.jsxs)("div",{className:"system-xs-medium ml-1 text-text-tertiary",children:["+",x-2]})]}),!!x&&(0,s.jsx)(w.RiCloseCircleFill,{className:"h-4 w-4 cursor-pointer text-text-quaternary",onClick:e=>{e.stopPropagation(),n([])}}),!x&&(0,s.jsx)(w.RiArrowDownSLine,{className:"h-4 w-4"})]})}),(0,s.jsx)(T.PortalToFollowElemContent,{className:"z-10",children:(0,s.jsxs)("div",{className:"w-[240px] rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur shadow-lg backdrop-blur-sm",children:[(0,s.jsx)("div",{className:"p-2 pb-1",children:(0,s.jsx)(k.default,{showLeftIcon:!0,value:c,onChange:e=>u(e.target.value),placeholder:i("searchCategories",{ns:"plugin"})})}),(0,s.jsx)("div",{className:"max-h-[448px] overflow-y-auto p-1",children:m.map(e=>(0,s.jsxs)("div",{className:"flex h-7 cursor-pointer items-center rounded-lg px-2 py-1.5 hover:bg-state-base-hover",onClick:()=>{var s;return s=e.name,void(t.includes(s)?n(t.filter(e=>e!==s)):n([...t,s]))},children:[(0,s.jsx)(_.default,{className:"mr-1",checked:t.includes(e.name)}),(0,s.jsx)("div",{className:"system-sm-medium px-1 text-text-secondary",children:e.label})]},e.name))})]})})]})},L=e=>{let{searchQuery:t,onChange:l}=e,{t:n}=(0,a.useTranslation)();return(0,s.jsx)(k.default,{wrapperClassName:"flex w-[200px] items-center rounded-lg",className:"bg-components-input-bg-normal",showLeftIcon:!0,value:t,placeholder:n("search",{ns:"plugin"}),onChange:e=>{l(e.target.value)}})},I=e=>{let{value:t,onChange:n}=e,{t:i}=(0,a.useTranslation)(),[r,o]=(0,l.useState)(!1),[c,u]=(0,l.useState)(""),{tags:d,getTagLabel:p}=(0,A.useTags)(),m=d.filter(e=>e.name.toLowerCase().includes(c.toLowerCase())),x=t.length;return(0,s.jsxs)(T.PortalToFollowElem,{placement:"bottom-start",offset:{mainAxis:4},open:r,onOpenChange:o,children:[(0,s.jsx)(T.PortalToFollowElemTrigger,{onClick:()=>o(e=>!e),children:(0,s.jsxs)("div",{className:(0,S.cn)("flex h-8 cursor-pointer select-none items-center rounded-lg bg-components-input-bg-normal px-2 py-1 text-text-tertiary hover:bg-state-base-hover-alt",x&&"text-text-secondary",r&&"bg-state-base-hover"),children:[(0,s.jsxs)("div",{className:(0,S.cn)("system-sm-medium flex items-center p-1"),children:[!x&&i("allTags",{ns:"pluginTags"}),!!x&&t.map(e=>p(e)).slice(0,2).join(","),x>2&&(0,s.jsxs)("div",{className:"system-xs-medium ml-1 text-text-tertiary",children:["+",x-2]})]}),!!x&&(0,s.jsx)(w.RiCloseCircleFill,{className:"h-4 w-4 cursor-pointer text-text-quaternary",onClick:()=>n([])}),!x&&(0,s.jsx)(w.RiArrowDownSLine,{className:"h-4 w-4"})]})}),(0,s.jsx)(T.PortalToFollowElemContent,{className:"z-10",children:(0,s.jsxs)("div",{className:"w-[240px] rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur shadow-lg backdrop-blur-sm",children:[(0,s.jsx)("div",{className:"p-2 pb-1",children:(0,s.jsx)(k.default,{showLeftIcon:!0,value:c,onChange:e=>u(e.target.value),placeholder:i("searchTags",{ns:"pluginTags"})})}),(0,s.jsx)("div",{className:"max-h-[448px] overflow-y-auto p-1",children:m.map(e=>(0,s.jsxs)("div",{className:"flex h-7 cursor-pointer select-none items-center rounded-lg px-2 py-1.5 hover:bg-state-base-hover",onClick:()=>{var s;return s=e.name,void(t.includes(s)?n(t.filter(e=>e!==s)):n([...t,s]))},children:[(0,s.jsx)(_.default,{className:"mr-1",checked:t.includes(e.name)}),(0,s.jsx)("div",{className:"system-sm-medium px-1 text-text-secondary",children:e.label})]},e.name))})]})})]})},U=e=>{let{onFilterChange:t}=e,a=(0,p.usePluginPageContext)(e=>e.filters),[n,i]=(0,l.useState)(a),r=e=>{let s={...n,...e};i(s),t(s)};return(0,s.jsxs)("div",{className:"flex items-center gap-2 self-stretch",children:[(0,s.jsx)(E,{value:n.categories,onChange:e=>r({categories:e})}),(0,s.jsx)(I,{value:n.tags,onChange:e=>r({tags:e})}),(0,s.jsx)(L,{searchQuery:n.searchQuery,onChange:e=>r({searchQuery:e})})]})};var F=e.i(36503),R=e.i(421001),M=e.i(632717),O=e.i(711536),D=e.i(566210),$=e.i(922521),G=e.i(168014),z=e.i(83278);e.i(432024);var q=e.i(406618),B=e.i(180852),H=e.i(327304),Y=e.i(519436),Q=e.i(312343),K=e.i(169563),V=e.i(417944),W=e.i(137667),X=e.i(296124),Z=e.i(887460),J=e.i(654313),ee=e.i(547105),es=e.i(908132),et=e.i(677717);let el="action",ea=l.memo(e=>{let{author:t,installationId:n,pluginUniqueIdentifier:i,pluginName:r,category:o,isShowFetchNewVersion:c,isShowInfo:p,isShowDelete:m,onDelete:x,meta:g}=e,{t:h}=(0,a.useTranslation)(),[f,{setTrue:v,setFalse:b}]=(0,V.useBoolean)(!1),[j,{setTrue:y,setFalse:N}]=(0,V.useBoolean)(!1),{checkForUpdates:P,fetchReleases:C}=(0,es.useGitHubReleases)(),{setShowUpdatePluginModal:_}=(0,X.useModalContext)(),k=(0,u.useInvalidateInstalledPluginList)(),T=async()=>{let e=g.repo.split("/")[0]||t,s=g.repo.split("/")[1]||r,l=await C(e,s);if(0===l.length)return;let{needUpdate:a,toastProps:n}=P(l,g.version);W.default.notify(n),a&&_({onSaveCallback:()=>{k()},payload:{type:d.PluginSource.github,category:o,github:{originalPackageInfo:{id:i,repo:g.repo,version:g.version,package:g.package,releases:l}}}})},[S,{setTrue:A,setFalse:E}]=(0,V.useBoolean)(!1),L=(0,l.useCallback)(async()=>{y();try{(await (0,Z.uninstallPlugin)(n)).success&&(E(),x())}catch(e){console.error("uninstallPlugin error",e)}finally{N()}},[n,x]);return(0,s.jsxs)("div",{className:"flex space-x-1",children:[c&&(0,s.jsx)(R.default,{popupContent:h(`${el}.checkForUpdates`,{ns:"plugin"}),children:(0,s.jsx)(J.default,{onClick:T,children:(0,s.jsx)(w.RiLoopLeftLine,{className:"h-4 w-4 text-text-tertiary"})})}),p&&(0,s.jsx)(R.default,{popupContent:h(`${el}.pluginInfo`,{ns:"plugin"}),children:(0,s.jsx)(J.default,{onClick:v,children:(0,s.jsx)(w.RiInformation2Line,{className:"h-4 w-4 text-text-tertiary"})})}),m&&(0,s.jsx)(R.default,{popupContent:h(`${el}.delete`,{ns:"plugin"}),children:(0,s.jsx)(J.default,{className:"text-text-tertiary hover:bg-state-destructive-hover hover:text-text-destructive",onClick:A,children:(0,s.jsx)(w.RiDeleteBinLine,{className:"h-4 w-4"})})}),f&&(0,s.jsx)(et.default,{repository:g.repo,release:g.version,packageName:g.package,onHide:b}),(0,s.jsx)(ee.default,{isShow:S,title:h(`${el}.delete`,{ns:"plugin"}),content:(0,s.jsxs)("div",{children:[h(`${el}.deleteContentLeft`,{ns:"plugin"}),(0,s.jsx)("span",{className:"system-md-semibold",children:r}),h(`${el}.deleteContentRight`,{ns:"plugin"}),(0,s.jsx)("br",{})]}),onCancel:E,onConfirm:L,isLoading:j,isDisabled:j})]})}),en=l.memo(e=>{let{className:t,plugin:n}=e,{t:i}=(0,a.useTranslation)(),{theme:r}=(0,$.default)(),{categoriesMap:o}=(0,A.useCategories)(!0),c=(0,p.usePluginPageContext)(e=>e.currentPluginID),u=(0,p.usePluginPageContext)(e=>e.setCurrentPluginID),{refreshPluginList:m}=(0,M.default)(),{source:x,tenant_id:g,installation_id:h,plugin_unique_identifier:f,endpoints_active:v,meta:b,plugin_id:N,status:P,deprecated_reason:C}=n,{category:_,author:k,name:T,label:E,description:L,icon:I,icon_dark:U,verified:V,meta:W}=n.declaration,X=(0,l.useMemo)(()=>[d.PluginSource.github,d.PluginSource.marketplace].includes(x)?k:"",[x,k]),{langGeniusVersionInfo:Z}=(0,O.useAppContext)(),J=(0,l.useMemo)(()=>!Z.current_version||(0,F.gte)(Z.current_version,W.minimum_dify_version??"0.0.0"),[W.minimum_dify_version,Z.current_version]),ee=(0,l.useMemo)(()=>"deleted"===P&&!!C,[P,C]),es=(0,l.useCallback)(()=>{m({category:_})},[_,m]),et=(0,D.useRenderI18nObject)(),el=et(E),en=et(L),{enable_marketplace:ei}=(0,y.useGlobalPublicStore)(e=>e.systemFeatures),er="dark"===r&&U?U:I,eo=er?er.startsWith("http")?er:`${j.API_PREFIX}/workspaces/current/plugin/icon?tenant_id=${g}&filename=${er}`:"";return(0,s.jsxs)("div",{className:(0,S.cn)("relative overflow-hidden rounded-xl border-[1.5px] border-background-section-burn p-1",c===N&&"border-components-option-card-option-selected-border",x===d.PluginSource.debugging?"bg-[repeating-linear-gradient(-45deg,rgba(16,24,40,0.04),rgba(16,24,40,0.04)_5px,rgba(0,0,0,0.02)_5px,rgba(0,0,0,0.02)_10px)]":"bg-background-section-burn"),onClick:()=>{u(n.plugin_id)},children:[(0,s.jsxs)("div",{className:(0,S.cn)("hover-bg-components-panel-on-panel-item-bg relative z-10 rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-on-panel-item-bg p-4 pb-3 shadow-xs",t),children:[(0,s.jsx)(H.default,{text:o[_].label}),(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("div",{className:"flex h-10 w-10 items-center justify-center overflow-hidden rounded-xl border-[1px] border-components-panel-border-subtle",children:(0,s.jsx)("img",{className:"h-full w-full",src:eo,alt:`plugin-${f}-logo`})}),(0,s.jsxs)("div",{className:"ml-3 w-0 grow",children:[(0,s.jsxs)("div",{className:"flex h-5 items-center",children:[(0,s.jsx)(K.default,{title:el}),V&&(0,s.jsx)(B.default,{className:"ml-0.5 h-4 w-4",text:i("marketplace.verifiedTip",{ns:"plugin"})}),!J&&(0,s.jsx)(R.default,{popupContent:i("difyVersionNotCompatible",{ns:"plugin",minimalDifyVersion:W.minimum_dify_version}),children:(0,s.jsx)(w.RiErrorWarningLine,{color:"red",className:"ml-0.5 h-4 w-4 shrink-0 text-text-accent"})}),(0,s.jsx)(z.default,{className:"ml-1 shrink-0",text:x===d.PluginSource.github?n.meta.version:n.version,hasRedCornerMark:x===d.PluginSource.marketplace&&!!n.latest_version&&n.latest_version!==n.version})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(Y.default,{text:en,descriptionLineRows:1}),(0,s.jsx)("div",{onClick:e=>e.stopPropagation(),children:(0,s.jsx)(ea,{pluginUniqueIdentifier:f,installationId:h,author:k,pluginName:T,usedInApps:5,isShowFetchNewVersion:x===d.PluginSource.github,isShowInfo:x===d.PluginSource.github,isShowDelete:!0,meta:b,onDelete:es,category:_})})]})]})]})]}),(0,s.jsxs)("div",{className:"mb-1 mt-1.5 flex h-4 items-center gap-x-2 px-4",children:[(0,s.jsxs)("div",{className:"flex grow items-center overflow-hidden",children:[(0,s.jsx)(Q.default,{orgName:X,packageName:T,packageNameClassName:"w-auto max-w-[150px]"}),_===d.PluginCategoryEnum.extension&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"system-xs-regular mx-2 text-text-quaternary",children:""}),(0,s.jsxs)("div",{className:"system-xs-regular flex items-center gap-x-1 overflow-hidden text-text-tertiary",children:[(0,s.jsx)(w.RiLoginCircleLine,{className:"size-3 shrink-0"}),(0,s.jsx)("span",{className:"truncate",title:i("endpointsEnabled",{ns:"plugin",num:v}),children:i("endpointsEnabled",{ns:"plugin",num:v})})]})]})]}),(0,s.jsxs)("div",{className:"flex shrink-0 items-center",children:[x===d.PluginSource.github&&(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("a",{href:`https://github.com/${b.repo}`,target:"_blank",className:"flex items-center gap-1",children:[(0,s.jsx)("div",{className:"system-2xs-medium-uppercase text-text-tertiary",children:i("from",{ns:"plugin"})}),(0,s.jsxs)("div",{className:"flex items-center space-x-0.5 text-text-secondary",children:[(0,s.jsx)(q.Github,{className:"h-3 w-3"}),(0,s.jsx)("div",{className:"system-2xs-semibold-uppercase",children:"GitHub"}),(0,s.jsx)(w.RiArrowRightUpLine,{className:"h-3 w-3"})]})]})}),x===d.PluginSource.marketplace&&ei&&(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("a",{href:(0,G.getMarketplaceUrl)(`/plugins/${k}/${T}`,{theme:r}),target:"_blank",className:"flex items-center gap-0.5",children:[(0,s.jsxs)("div",{className:"system-2xs-medium-uppercase text-text-tertiary",children:[i("from",{ns:"plugin"})," ",(0,s.jsx)("span",{className:"text-text-secondary",children:"marketplace"})]}),(0,s.jsx)(w.RiArrowRightUpLine,{className:"h-3 w-3 text-text-secondary"})]})}),x===d.PluginSource.local&&(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(w.RiHardDrive3Line,{className:"h-3 w-3 text-text-tertiary"}),(0,s.jsx)("div",{className:"system-2xs-medium-uppercase text-text-tertiary",children:"Local Plugin"})]})}),x===d.PluginSource.debugging&&(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(w.RiBugLine,{className:"h-3 w-3 text-text-warning"}),(0,s.jsx)("div",{className:"system-2xs-medium-uppercase text-text-warning",children:"Debugging Plugin"})]})})]}),x===d.PluginSource.marketplace&&ei&&ee&&(0,s.jsxs)("div",{className:"system-2xs-medium-uppercase flex shrink-0 items-center gap-x-2",children:[(0,s.jsx)("span",{className:"text-text-tertiary",children:""}),(0,s.jsx)("span",{className:"text-text-warning",children:i("deprecated",{ns:"plugin"})})]})]}),x===d.PluginSource.marketplace&&ei&&ee&&(0,s.jsx)("div",{className:"absolute bottom-[-71px] right-[-45px] z-0 size-40 bg-components-badge-status-light-warning-halo opacity-60 blur-[120px]"})]})}),ei=e=>{let{pluginList:t}=e;return(0,s.jsx)("div",{className:"pb-3",children:(0,s.jsx)("div",{className:"grid grid-cols-2 gap-3",children:t.map(e=>(0,s.jsx)(en,{plugin:e},e.plugin_id))})})};e.s(["default",0,()=>{let{t:e}=(0,a.useTranslation)(),m=(0,o.useGetLanguage)(),x=(0,p.usePluginPageContext)(e=>e.filters),g=(0,p.usePluginPageContext)(e=>e.setFilters),{data:h,isLoading:f,isFetching:v,isLastPage:b,loadNextPage:j}=(0,u.useInstalledPluginList)(),{data:y}=(0,u.useInstalledLatestVersion)(h?.plugins.filter(e=>e.source===d.PluginSource.marketplace).map(e=>e.plugin_id)??[]),N=(0,u.useInvalidateInstalledPluginList)(),P=(0,p.usePluginPageContext)(e=>e.currentPluginID),w=(0,p.usePluginPageContext)(e=>e.setCurrentPluginID),{run:_}=(0,t.useDebounceFn)(e=>{g(e)},{wait:500}),k=(0,l.useMemo)(()=>h?.plugins.map(e=>({...e,latest_version:y?.versions[e.plugin_id]?.version??"",latest_unique_identifier:y?.versions[e.plugin_id]?.unique_identifier??"",status:y?.versions[e.plugin_id]?.status??"active",deprecated_reason:y?.versions[e.plugin_id]?.deprecated_reason??"",alternative_plugin_id:y?.versions[e.plugin_id]?.alternative_plugin_id??""}))||[],[h,y]),T=(0,l.useMemo)(()=>{let{categories:e,searchQuery:s,tags:t}=x;return k.filter(l=>(0===e.length||e.includes(l.declaration.category))&&(0===t.length||t.some(e=>l.declaration.tags.includes(e)))&&((e,s,t)=>{if(!s)return!0;let l=s.toLowerCase(),{declaration:a}=e;if(e.plugin_id.toLowerCase().includes(l)||e.name?.toLowerCase().includes(l)||a.name?.toLowerCase().includes(l))return!0;let n=(0,c.renderI18nObject)(a.label,t);if(n?.toLowerCase().includes(l))return!0;let i=(0,c.renderI18nObject)(a.description,t);return!!i?.toLowerCase().includes(l)})(l,s,m))},[k,x,m]),S=(0,l.useMemo)(()=>k.find(e=>e.plugin_id===P),[P,k]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex flex-col items-start justify-center gap-3 self-stretch px-12 pb-3 pt-1",children:[(0,s.jsx)("div",{className:"h-px self-stretch bg-divider-subtle"}),(0,s.jsx)(U,{onFilterChange:_})]}),f&&(0,s.jsx)(i.default,{type:"app"}),!f&&(0,s.jsx)(s.Fragment,{children:(T?.length??0)>0?(0,s.jsxs)("div",{className:"flex grow flex-wrap content-start items-start justify-center gap-2 self-stretch overflow-y-auto px-12",children:[(0,s.jsx)("div",{className:"w-full",children:(0,s.jsx)(ei,{pluginList:T||[]})}),!b&&(0,s.jsx)("div",{className:"flex justify-center py-4",children:v?(0,s.jsx)(i.default,{className:"size-8"}):(0,s.jsx)(n.default,{onClick:j,children:e("common.loadMore",{ns:"workflow"})})})]}):(0,s.jsx)(C,{})}),(0,s.jsx)(r.default,{detail:S,onUpdate:()=>N(),onHide:()=>w(void 0)})]})}],792805)}]);
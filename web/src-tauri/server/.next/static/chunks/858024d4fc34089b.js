(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,910605,e=>{"use strict";var t=e.i(27808);e.s(["FileUploaderInAttachmentWrapper",()=>t.default])},371784,e=>{"use strict";var t=e.i(563199),a=e.i(268255);e.i(152567);var s=e.i(408767),r=e.i(324935);let n=a.memo(e=>{let{value:n,onChange:i,name:l,required:o,readonly:d}=e,{t:u}=(0,s.useTranslation)(),c=(0,a.useCallback)(()=>{i(!n)},[n,i]);return(0,t.jsxs)("div",{className:"flex h-6 items-center gap-2",children:[(0,t.jsx)(r.default,{className:"!h-4 !w-4",checked:!!n,onCheck:c,disabled:d}),(0,t.jsxs)("div",{className:"system-sm-medium flex items-center gap-1 text-text-secondary",children:[l,!o&&(0,t.jsx)("span",{className:"system-xs-regular text-text-tertiary",children:u("panel.optional",{ns:"workflow"})})]})]})});e.s(["default",0,n])},501912,449435,e=>{"use strict";var t=e.i(223751);e.s(["Link03",()=>t.default],501912);var a=e.i(563199),s=e.i(268255);e.i(152567);var r=e.i(408767),n=e.i(151094),i=e.i(648404);let l=/^(https?|ftp):\/\//;e.s(["default",0,e=>{let{onUpload:t,disabled:o}=e,{t:d}=(0,r.useTranslation)(),[u,c]=(0,s.useState)("");return(0,a.jsxs)("div",{className:"flex h-8 items-center rounded-lg border border-components-panel-border bg-components-panel-bg pl-1.5 pr-1 shadow-xs",children:[(0,a.jsx)("input",{type:"text",className:"mr-0.5 h-[18px] grow appearance-none bg-transparent px-1 text-[13px] text-text-primary outline-none",value:u,onChange:e=>c(e.target.value),placeholder:d("imageUploader.pasteImageLinkInputPlaceholder",{ns:"common"})||""}),(0,a.jsx)(n.default,{variant:"primary",size:"small",disabled:!u||o,onClick:()=>{o||t({type:i.TransferMethod.remote_url,_id:`${Date.now()}`,fileId:"",progress:l.test(u)?0:-1,url:u})},children:d("operation.ok",{ns:"common"})})]})}],449435)},538883,e=>{"use strict";var t=e.i(780887);e.s(["RefreshCcw01",()=>t.default])},189107,e=>{"use strict";var t=e.i(563199),a=e.i(268255);e.i(152567);var s=e.i(408767);e.i(47690);var r=e.i(501912);e.i(644896);var n=e.i(541983),i=e.i(391185),l=e.i(648404),o=e.i(330276),d=e.i(449435),u=e.i(837699);e.i(668763);var c=e.i(538883);e.i(793622);var p=e.i(259509),m=e.i(998020),h=e.i(421001),g=e.i(935139);let f=e=>{let{list:r,readonly:n,onRemove:i,onReUpload:o,onImageLinkLoadSuccess:d,onImageLinkLoadError:f}=e,{t:x}=(0,s.useTranslation)(),[b,_]=(0,a.useState)("");return(0,t.jsxs)("div",{className:"flex flex-wrap",children:[r.map(e=>(0,t.jsxs)("div",{className:"group relative mr-1 rounded-lg border-[0.5px] border-black/5",children:[e.type===l.TransferMethod.local_file&&100!==e.progress&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"absolute inset-0 z-[1] flex items-center justify-center bg-black/30",style:{left:e.progress>-1?`${e.progress}%`:0},children:-1===e.progress&&(0,t.jsx)(c.RefreshCcw01,{className:"h-5 w-5 text-white",onClick:()=>o?.(e._id)})}),e.progress>-1&&(0,t.jsxs)("span",{className:"absolute left-[50%] top-[50%] z-[1] translate-x-[-50%] translate-y-[-50%] text-sm text-white mix-blend-lighten",children:[e.progress,"%"]})]}),e.type===l.TransferMethod.remote_url&&100!==e.progress&&(0,t.jsxs)("div",{className:`
                  absolute inset-0 z-[1] flex items-center justify-center rounded-lg border
                  ${-1===e.progress?"border-[#DC6803] bg-[#FEF0C7]":"border-transparent bg-black/[0.16]"}
                `,children:[e.progress>-1&&(0,t.jsx)(u.RiLoader2Line,{className:"h-5 w-5 animate-spin text-white"}),-1===e.progress&&(0,t.jsx)(h.default,{popupContent:x("imageUploader.pasteImageLinkInvalid",{ns:"common"}),children:(0,t.jsx)(p.AlertTriangle,{className:"h-4 w-4 text-[#DC6803]"})})]}),(0,t.jsx)("img",{className:"h-16 w-16 cursor-pointer rounded-lg border-[0.5px] border-black/5 object-cover",alt:e.file?.name,onLoad:()=>{e.type===l.TransferMethod.remote_url&&d&&-1!==e.progress&&d(e._id)},onError:()=>{e.type===l.TransferMethod.remote_url&&f&&f(e._id)},src:e.type===l.TransferMethod.remote_url?e.url:e.base64Url,onClick:()=>100===e.progress&&_(e.type===l.TransferMethod.remote_url?e.url:e.base64Url)}),!n&&(0,t.jsx)("button",{type:"button",className:(0,g.cn)("absolute -right-[9px] -top-[9px] z-10 h-[18px] w-[18px] items-center justify-center","rounded-2xl shadow-lg hover:bg-state-base-hover",-1===e.progress?"flex":"hidden group-hover:flex"),onClick:()=>i?.(e._id),children:(0,t.jsx)(u.RiCloseLine,{className:"h-3 w-3 text-text-tertiary"})})]},e._id)),b&&(0,t.jsx)(m.default,{url:b,onCancel:()=>_(""),title:""})]})},x=e=>{let{children:s,onUpload:r,closePopover:n,limit:i,disabled:d}=e,[u,c]=(0,a.useState)(!1),{handleLocalFileUpload:p}=(0,o.useLocalFileUploader)({limit:i,onUpload:r,disabled:d});return(0,t.jsxs)("div",{className:"relative",onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),children:[s(u),(0,t.jsx)("input",{className:"absolute inset-0 block w-full cursor-pointer text-[0] opacity-0 disabled:cursor-not-allowed",onClick:e=>e.target.value="",type:"file",accept:l.ALLOW_FILE_EXTENSIONS.map(e=>`.${e}`).join(","),onChange:e=>{let t=e.target.files?.[0];t&&(p(t),n?.())},disabled:d})]})},b=e=>{let{onUpload:n,disabled:l}=e,{t:o}=(0,s.useTranslation)(),[u,c]=(0,a.useState)(!1);return(0,t.jsxs)(i.PortalToFollowElem,{open:u,onOpenChange:c,placement:"top-start",children:[(0,t.jsx)(i.PortalToFollowElemTrigger,{onClick:()=>{l||c(e=>!e)},children:(0,t.jsxs)("div",{className:`
          relative flex h-8 items-center justify-center rounded-lg bg-components-button-tertiary-bg px-3 text-xs text-text-tertiary hover:bg-components-button-tertiary-bg-hover
          ${l?"cursor-not-allowed":"cursor-pointer"}
        `,children:[(0,t.jsx)(r.Link03,{className:"mr-2 h-4 w-4"}),o("imageUploader.pasteImageLink",{ns:"common"})]})}),(0,t.jsx)(i.PortalToFollowElemContent,{className:"z-10",children:(0,t.jsx)("div",{className:"w-[320px] rounded-lg border-[0.5px] border-components-panel-border bg-components-panel-bg p-2 shadow-lg",children:(0,t.jsx)(d.default,{onUpload:e=>{c(!1),n(e)}})})})]})};e.s(["default",0,e=>{let{settings:r,onFilesChange:i,disabled:d}=e,{t:u}=(0,s.useTranslation)(),{files:c,onUpload:p,onRemove:m,onImageLinkLoadError:h,onImageLinkLoadSuccess:g,onReUpload:_}=(0,o.useImageFiles)();(0,a.useEffect)(()=>{i(c)},[c]);let y=(0,t.jsx)(x,{onUpload:p,disabled:c.length>=r.number_limits||d,limit:+r.image_file_size_limit,children:e=>(0,t.jsxs)("div",{className:`
            flex h-8 cursor-pointer items-center justify-center rounded-lg
            bg-components-button-tertiary-bg px-3 text-xs text-text-tertiary
            ${e&&"hover:bg-components-button-tertiary-bg-hover"}
          `,children:[(0,t.jsx)(n.ImagePlus,{className:"mr-2 h-4 w-4"}),u("imageUploader.uploadFromComputer",{ns:"common"})]})}),w=(0,t.jsx)(b,{onUpload:p,disabled:c.length>=r.number_limits||d});return(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"mb-1",children:(0,t.jsx)(f,{list:c,onRemove:m,onReUpload:_,onImageLinkLoadError:h,onImageLinkLoadSuccess:g})}),(0,t.jsx)("div",{className:`grid gap-1 ${2===r.transfer_methods.length?"grid-cols-2":"grid-cols-1"}`,children:r.transfer_methods.map(e=>e===l.TransferMethod.local_file?(0,t.jsx)(a.Fragment,{children:y},l.TransferMethod.local_file):e===l.TransferMethod.remote_url?(0,t.jsx)(a.Fragment,{children:w},l.TransferMethod.remote_url):null)})]})}],189107)},130822,e=>{"use strict";var t=e.i(223314),a=e.i(390622);let s=e=>({type:e.type,transfer_method:e.transfer_method,url:e.remote_url,upload_file_id:e.related_id});e.s(["getProcessedInputs",0,(e,r)=>{let n={...e};return r.forEach(r=>{let i=e[r.variable];if(r.type===a.InputVarType.checkbox){n[r.variable]=!!i;return}if(null!=i){if(r.type===a.InputVarType.singleFile)"transfer_method"in i?n[r.variable]=s(i):n[r.variable]=(0,t.getProcessedFiles)([i])[0];else if(r.type===a.InputVarType.multiFiles)"transfer_method"in i[0]?n[r.variable]=i.map(s):n[r.variable]=(0,t.getProcessedFiles)(i);else if(r.type===a.InputVarType.jsonObject)try{let e="string"==typeof i?JSON.parse(i):i;e&&"object"==typeof e&&!Array.isArray(e)?n[r.variable]=e:n[r.variable]=i}catch{n[r.variable]=i}}}),n},"processOpeningStatement",0,(e,t,a)=>e?e.replace(/\{\{([^}]+)\}\}/g,(e,s)=>{let r=t[s];if(r)return r;let n=a.find(e=>e.variable===s);return n?`{{${n.label}}}`:e}):e])},419874,e=>{"use strict";var t=e.i(563199),a=e.i(837699),s=e.i(417944),r=e.i(26012),n=e.i(326531),i=e.i(268255);e.i(152567);var l=e.i(408767),o=e.i(189299),d=e.i(654313),u=e.i(744704),c=e.i(75518),p=e.i(449980),m=e.i(379415),h=e.i(543753),g=e.i(137667),f=e.i(459760),x=e.i(447301),b=e.i(935139);e.i(237855);var _=e.i(297162),y=e.i(481162),w=e.i(955371);let v=(0,i.memo)(e=>{let{data:a,content:s,currentTab:r}=e;return(0,t.jsxs)(t.Fragment,{children:["RESULT"===r&&(0,t.jsxs)("div",{className:"space-y-3 p-4",children:[a?.resultText&&(0,t.jsx)(m.Markdown,{content:a?.resultText||""}),!!a?.files?.length&&(0,t.jsx)("div",{className:"flex flex-col gap-2",children:a?.files.map(e=>(0,t.jsxs)("div",{className:"system-xs-regular flex flex-col gap-1",children:[(0,t.jsx)("div",{className:"py-1 text-text-tertiary ",children:e.varName}),(0,t.jsx)(_.FileList,{files:e.list,showDeleteAction:!1,showDownloadAction:!0,canPreview:!0})]},e.varName))})]}),"DETAIL"===r&&s&&(0,t.jsx)("div",{className:"p-4",children:(0,t.jsx)(y.default,{readOnly:!0,title:(0,t.jsx)("div",{children:"JSON OUTPUT"}),language:w.CodeLanguage.json,value:s,isJSONStringifyBeauty:!0})})]})}),j=e=>{let{isWorkflow:_,workflowProcessData:y,className:w,isError:k,onRetry:C,content:N,messageId:I,isLoading:T,isResponding:L,moreLikeThis:F,isInWebApp:S=!1,feedback:R,onFeedback:M,onSave:A,depth:E=1,isMobile:P,appSourceType:q,installedAppId:U,taskId:D,controlClearMoreLikeThis:B,supportFeedback:O,isShowTextToSpeech:$,hideProcessDetail:V,siteInfo:W,inSidePanel:H}=e,{t:z}=(0,l.useTranslation)(),Z=(0,n.useParams)(),G=1===E,J=q===x.AppSourceType.tryApp,[K,Q]=(0,i.useState)(""),[X,Y]=(0,i.useState)(null),[ee,et]=(0,i.useState)({rating:null}),{config:ea}=(0,c.useChatContext)(),es=(0,o.useStore)(e=>e.setCurrentLogItem),er=(0,o.useStore)(e=>e.setShowPromptLogModal),en=async e=>{await (0,x.updateFeedback)({url:`/messages/${X}/feedbacks`,body:{rating:e.rating}},q,U),et(e)},[ei,{setTrue:el,setFalse:eo}]=(0,s.useBoolean)(!1),ed=async()=>{if(ei||!I)return void g.default.notify({type:"warning",message:z("errorMessage.waitForResponse",{ns:"appDebug"})});el();let e=await (0,x.fetchMoreLikeThis)(I,q,U);Q(e.answer),et({rating:null}),Y(e.id),eo()};(0,i.useEffect)(()=>{B&&(Y(null),Q(""))},[B]),(0,i.useEffect)(()=>{T&&Y(null)},[T]);let eu=async()=>{let e=await (0,f.fetchTextGenerationMessage)({appId:Z.appId,messageId:I});es(Array.isArray(e.message)?{...e,log:[...e.message,..."assistant"!==e.message[e.message.length-1].role?[{role:"assistant",text:e.answer,files:e.message_files?.filter(e=>"assistant"===e.belongs_to)||[]}]:[]]}:{...e,log:["string"==typeof e.message?{text:e.message}:e.message]}),er(!0)},[ec,ep]=(0,i.useState)("DETAIL"),em=!!y?.resultText||!!y?.files?.length,eh=async e=>{ep(e)};return(0,i.useEffect)(()=>{y?.resultText||y?.files?.length?eh("RESULT"):eh("DETAIL")},[y?.files?.length,y?.resultText]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:(0,b.cn)("relative",!G&&"mt-3",w),children:[T&&(0,t.jsx)("div",{className:(0,b.cn)("flex h-10 items-center",!H&&"rounded-2xl border-t border-divider-subtle bg-chat-bubble-bg"),children:(0,t.jsx)(p.default,{type:"area"})}),!T&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:(0,b.cn)("relative",!H&&"rounded-2xl border-t border-divider-subtle bg-chat-bubble-bg"),children:[y&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:(0,b.cn)("p-3",em&&"border-b border-divider-subtle"),children:[D&&(0,t.jsxs)("div",{className:(0,b.cn)("system-2xs-medium-uppercase mb-2 flex items-center text-text-accent-secondary",k&&"text-text-destructive"),children:[(0,t.jsx)(a.RiPlayList2Line,{className:"mr-1 h-3 w-3"}),(0,t.jsx)("span",{children:z("generation.execution",{ns:"share"})}),(0,t.jsx)("span",{className:"px-1",children:"·"}),(0,t.jsx)("span",{children:D})]}),W&&y&&(0,t.jsx)(u.default,{data:y,expand:y.expand,hideProcessDetail:V,hideInfo:V,readonly:!W.show_workflow_steps}),em&&(0,t.jsxs)("div",{className:"flex items-center space-x-6 px-1",children:[(0,t.jsx)("div",{className:(0,b.cn)("system-sm-semibold-uppercase cursor-pointer border-b-2 border-transparent py-3 text-text-tertiary","RESULT"===ec&&"border-util-colors-blue-brand-blue-brand-600 text-text-primary"),onClick:()=>eh("RESULT"),children:z("result",{ns:"runLog"})}),(0,t.jsx)("div",{className:(0,b.cn)("system-sm-semibold-uppercase cursor-pointer border-b-2 border-transparent py-3 text-text-tertiary","DETAIL"===ec&&"border-util-colors-blue-brand-blue-brand-600 text-text-primary"),onClick:()=>eh("DETAIL"),children:z("detail",{ns:"runLog"})})]})]}),!k&&(0,t.jsx)(v,{data:y,content:N,currentTab:ec})]}),!y&&D&&(0,t.jsxs)("div",{className:(0,b.cn)("system-2xs-medium-uppercase sticky left-0 top-0 flex w-full items-center rounded-t-2xl bg-components-actionbar-bg p-4 pb-3 text-text-accent-secondary",k&&"text-text-destructive"),children:[(0,t.jsx)(a.RiPlayList2Line,{className:"mr-1 h-3 w-3"}),(0,t.jsx)("span",{children:z("generation.execution",{ns:"share"})}),(0,t.jsx)("span",{className:"px-1",children:"·"}),(0,t.jsx)("span",{children:`${D}${E>1?`-${E-1}`:""}`})]}),k&&(0,t.jsx)("div",{className:"body-lg-regular p-4 pt-0 text-text-quaternary",children:z("generation.batchFailed.outputPlaceholder",{ns:"share"})}),!y&&!k&&"string"==typeof N&&(0,t.jsx)("div",{className:(0,b.cn)("p-4",D&&"pt-0"),children:(0,t.jsx)(m.Markdown,{content:N})})]}),(0,t.jsxs)("div",{className:(0,b.cn)("system-xs-regular relative mt-1 h-4 px-4 text-text-quaternary",P&&(X||ei)&&E<3&&"pl-10"),children:[!_&&(0,t.jsxs)("span",{children:[N?.length," ",z("unit.char",{ns:"common"})]}),(0,t.jsxs)("div",{className:"absolute bottom-1 right-2 flex items-center",children:[!S&&q!==x.AppSourceType.installedApp&&!L&&(0,t.jsx)("div",{className:"ml-1 flex items-center gap-0.5 rounded-[10px] border-[0.5px] border-components-actionbar-border bg-components-actionbar-bg p-0.5 shadow-md backdrop-blur-sm",children:(0,t.jsx)(d.default,{disabled:k||!I,onClick:eu,children:(0,t.jsx)(a.RiFileList3Line,{className:"h-4 w-4"})})}),(0,t.jsxs)("div",{className:"ml-1 flex items-center gap-0.5 rounded-[10px] border-[0.5px] border-components-actionbar-border bg-components-actionbar-bg p-0.5 shadow-md backdrop-blur-sm",children:[F&&!J&&(0,t.jsx)(d.default,{state:3===E?d.ActionButtonState.Disabled:d.ActionButtonState.Default,disabled:3===E,onClick:ed,children:(0,t.jsx)(a.RiSparklingLine,{className:"h-4 w-4"})}),$&&!J&&(0,t.jsx)(h.default,{id:I,voice:ea?.text_to_speech?.voice}),("RESULT"===ec&&y?.resultText||!_)&&(0,t.jsx)(d.default,{disabled:k||!I,onClick:()=>{let e=_?y?.resultText:N;"string"==typeof e?(0,r.default)(e):(0,r.default)(JSON.stringify(e)),g.default.notify({type:"success",message:z("actionMsg.copySuccessfully",{ns:"common"})})},children:(0,t.jsx)(a.RiClipboardLine,{className:"h-4 w-4"})}),S&&k&&(0,t.jsx)(d.default,{onClick:C,children:(0,t.jsx)(a.RiReplay15Line,{className:"h-4 w-4"})}),S&&!_&&!J&&(0,t.jsx)(d.default,{disabled:k||!I,onClick:()=>{A?.(I)},children:(0,t.jsx)(a.RiBookmark3Line,{className:"h-4 w-4"})})]}),(O||S)&&!_&&!J&&!k&&I&&(0,t.jsxs)("div",{className:"ml-1 flex items-center gap-0.5 rounded-[10px] border-[0.5px] border-components-actionbar-border bg-components-actionbar-bg p-0.5 shadow-md backdrop-blur-sm",children:[!R?.rating&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d.default,{onClick:()=>M?.({rating:"like"}),children:(0,t.jsx)(a.RiThumbUpLine,{className:"h-4 w-4"})}),(0,t.jsx)(d.default,{onClick:()=>M?.({rating:"dislike"}),children:(0,t.jsx)(a.RiThumbDownLine,{className:"h-4 w-4"})})]}),R?.rating==="like"&&(0,t.jsx)(d.default,{state:d.ActionButtonState.Active,onClick:()=>M?.({rating:null}),children:(0,t.jsx)(a.RiThumbUpLine,{className:"h-4 w-4"})}),R?.rating==="dislike"&&(0,t.jsx)(d.default,{state:d.ActionButtonState.Destructive,onClick:()=>M?.({rating:null}),children:(0,t.jsx)(a.RiThumbDownLine,{className:"h-4 w-4"})})]})]})]}),!G&&(0,t.jsxs)("div",{className:(0,b.cn)("absolute top-[-32px] flex h-[33px] w-4 justify-center",P?"left-[17px]":"left-[50%] translate-x-[-50%]"),children:[(0,t.jsx)("div",{className:"h-full w-0.5 bg-divider-regular"}),(0,t.jsx)("div",{className:(0,b.cn)("absolute left-0 flex h-4 w-4 items-center justify-center rounded-2xl border-[0.5px] border-divider-subtle bg-util-colors-blue-blue-500 shadow-xs",P?"top-[3.5px]":"top-2"),children:(0,t.jsx)(a.RiSparklingFill,{className:"h-3 w-3 text-text-primary-on-surface"})})]})]})]}),(X||ei)&&E<3&&(0,t.jsx)(j,{isInWebApp:!0,content:K,messageId:X,depth:E+1,moreLikeThis:!0,onFeedback:en,isLoading:ei,feedback:ee,onSave:A,isShowTextToSpeech:$,isMobile:P,appSourceType:q,installedAppId:U,controlClearMoreLikeThis:B,isWorkflow:_,siteInfo:W,taskId:D})]})},k=i.memo(j);e.s(["default",0,k],419874)},837063,e=>{e.v({icon:{type:"element",isRootNode:!0,name:"svg",attributes:{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},children:[{type:"element",name:"g",attributes:{opacity:"0.5"},children:[{type:"element",name:"rect",attributes:{width:"24",height:"24",rx:"6",fill:"#E5E7EB"},children:[]},{type:"element",name:"rect",attributes:{x:"0.25",y:"0.25",width:"23.5",height:"23.5",rx:"5.75",stroke:"black","stroke-opacity":"0.05","stroke-width":"0.5"},children:[]},{type:"element",name:"path",attributes:{d:"M11.8876 5.30588C11.9601 5.26959 12.019 5.21074 12.0553 5.13817L12.414 4.4208C12.5522 4.1444 12.9466 4.1444 13.0848 4.4208L13.4435 5.13817C13.4797 5.21074 13.5386 5.26959 13.6112 5.30588L14.3285 5.66457C14.6049 5.80276 14.6049 6.19719 14.3285 6.33539L13.6112 6.69407C13.5386 6.73036 13.4797 6.78921 13.4435 6.86178L13.0848 7.57916C12.9466 7.85555 12.5522 7.85555 12.414 7.57916L12.0553 6.86178C12.019 6.78921 11.9601 6.73036 11.8876 6.69407L11.1702 6.33539C10.8938 6.19719 10.8938 5.80276 11.1702 5.66457L11.8876 5.30588Z",fill:"#667085"},children:[]},{type:"element",name:"path",attributes:{d:"M7.88756 6.55588C7.96013 6.51959 8.01898 6.46074 8.05527 6.38817L8.28895 5.9208C8.42715 5.6444 8.82158 5.6444 8.95978 5.9208L9.19346 6.38817C9.22975 6.46074 9.2886 6.51959 9.36117 6.55588L9.82854 6.78956C10.1049 6.92776 10.1049 7.32219 9.82854 7.46039L9.36117 7.69407C9.2886 7.73036 9.22975 7.78921 9.19346 7.86178L8.95978 8.32915C8.82158 8.60555 8.42715 8.60555 8.28895 8.32915L8.05527 7.86178C8.01898 7.78921 7.96013 7.73036 7.88756 7.69407L7.42019 7.46039C7.14379 7.32219 7.14379 6.92776 7.42019 6.78957L7.88756 6.55588Z",fill:"#667085"},children:[]},{type:"element",name:"path",attributes:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M17.9417 5.91012C18.1985 6.08504 18.2648 6.43496 18.0899 6.6917L16.0062 9.74998H17.4375C17.7482 9.74998 18 10.0018 18 10.3125V18.1875C18 18.9124 17.4124 19.5 16.6875 19.5H7.3125C6.58763 19.5 6 18.9123 6 18.1875V10.3125C6 10.0018 6.25184 9.74998 6.5625 9.74998H14.6449L17.1601 6.05826C17.3351 5.80152 17.685 5.7352 17.9417 5.91012ZM10.3125 12.75C10.0018 12.75 9.75 13.0018 9.75 13.3125C9.75 13.6231 10.0018 13.875 10.3125 13.875H13.6875C13.9982 13.875 14.25 13.6231 14.25 13.3125C14.25 13.0018 13.9982 12.75 13.6875 12.75H10.3125Z",fill:"#667085"},children:[]}]}]},name:"DefaultToolIcon"})},38215,e=>{e.v({icon:{type:"element",isRootNode:!0,name:"svg",attributes:{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},children:[{type:"element",name:"path",attributes:{d:"M5 6.5V5M8.93934 7.56066L10 6.5M10.0103 11.5H11.5103",stroke:"#667085","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},children:[]}]},name:"Icon3Dots"})},137153,e=>{e.v({icon:{type:"element",isRootNode:!0,name:"svg",attributes:{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},children:[{type:"element",name:"g",attributes:{id:"message-3-fill"},children:[{type:"element",name:"g",attributes:{id:"Vector",filter:"url(#filter0_d_1071_49501)"},children:[{type:"element",name:"path",attributes:{d:"M2 8.99374C2 5.68349 4.67654 3 8.00066 3H15.9993C19.3134 3 22 5.69478 22 8.99374V21H8.00066C4.68659 21 2 18.3052 2 15.0063V8.99374ZM14 11V13H16V11H14ZM8 11V13H10V11H8Z",fill:"url(#paint0_linear_1071_49501)"},children:[]}]}]},{type:"element",name:"defs",attributes:{},children:[{type:"element",name:"filter",attributes:{id:"filter0_d_1071_49501",x:"1.5",y:"2.75",width:"21",height:"19",filterUnits:"userSpaceOnUse","color-interpolation-filters":"sRGB"},children:[{type:"element",name:"feFlood",attributes:{"flood-opacity":"0",result:"BackgroundImageFix"},children:[]},{type:"element",name:"feColorMatrix",attributes:{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"},children:[]},{type:"element",name:"feOffset",attributes:{dy:"0.25"},children:[]},{type:"element",name:"feGaussianBlur",attributes:{stdDeviation:"0.25"},children:[]},{type:"element",name:"feComposite",attributes:{in2:"hardAlpha",operator:"out"},children:[]},{type:"element",name:"feColorMatrix",attributes:{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.2 0"},children:[]},{type:"element",name:"feBlend",attributes:{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_1071_49501"},children:[]},{type:"element",name:"feBlend",attributes:{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_1071_49501",result:"shape"},children:[]}]},{type:"element",name:"linearGradient",attributes:{id:"paint0_linear_1071_49501",x1:"12",y1:"3",x2:"12",y2:"21",gradientUnits:"userSpaceOnUse"},children:[{type:"element",name:"stop",attributes:{"stop-color":"#296DFF"},children:[]},{type:"element",name:"stop",attributes:{offset:"1","stop-color":"#0BA5EC"},children:[]}]}]}]},name:"Message3Fill"})},243661,e=>{e.v({icon:{type:"element",isRootNode:!0,name:"svg",attributes:{width:"624",height:"48",viewBox:"0 0 624 48",fill:"none",xmlns:"http://www.w3.org/2000/svg"},children:[{type:"element",name:"rect",attributes:{x:"8",y:"7",width:"16",height:"16",rx:"5",fill:"#F2F4F7"},children:[]},{type:"element",name:"rect",attributes:{x:"32",y:"10",width:"233",height:"10",rx:"3",fill:"#EAECF0"},children:[]},{type:"element",name:"rect",attributes:{x:"32",y:"31",width:"345",height:"6",rx:"3",fill:"#F2F4F7"},children:[]}]},name:"RowStruct"})},8482,322219,484474,706248,e=>{"use strict";var t=e.i(563199),a=e.i(807324),s=e.i(837063);let r=e=>{let{ref:r,...n}=e;return(0,t.jsx)(a.default,{...n,ref:r,data:s.default})};r.displayName="DefaultToolIcon",e.s(["default",0,r],322219),e.i(38215);var n=e.i(137153);let i=e=>{let{ref:s,...r}=e;return(0,t.jsx)(a.default,{...r,ref:s,data:n.default})};i.displayName="Message3Fill",e.s(["default",0,i],484474);var l=e.i(243661);let o=e=>{let{ref:s,...r}=e;return(0,t.jsx)(a.default,{...r,ref:s,data:l.default})};o.displayName="RowStruct",e.s(["default",0,o],706248),e.s([],8482)},680884,e=>{"use strict";e.s(["formatBooleanInputs",0,(e,t)=>{if(!e)return t;let a={...t};return e.forEach(e=>{"checkbox"===e.type&&(a[e.key]=!!a[e.key])}),a},"promptVariablesToUserInputsForm",0,e=>{let t=[];return e.filter(e=>{let{key:t,name:a}=e;return t&&t.trim()&&a&&a.trim()}).forEach(e=>{"string"===e.type||"paragraph"===e.type?t.push({["string"===e.type?"text-input":"paragraph"]:{label:e.name,variable:e.key,required:!1!==e.required,max_length:e.max_length,default:"",hide:e.hide}}):"number"===e.type||"checkbox"===e.type?t.push({[e.type]:{label:e.name,variable:e.key,required:!1!==e.required,default:"",hide:e.hide}}):"select"===e.type?t.push({select:{label:e.name,variable:e.key,required:!1!==e.required,options:e.options,default:e.default??"",hide:e.hide}}):t.push({external_data_tool:{label:e.name,variable:e.key,enabled:e.enabled,type:e.type,config:e.config,required:e.required,icon:e.icon,icon_background:e.icon_background,hide:e.hide}})}),t},"userInputsFormToPromptVariables",0,(e,t)=>{if(!e)return[];let a=[];return e.forEach(e=>{let[s,r]=e.paragraph?["paragraph",e.paragraph]:e["text-input"]?["string",e["text-input"]]:e.number?["number",e.number]:e.checkbox?["boolean",e.checkbox]:e.file?["file",e.file]:e["file-list"]?["file-list",e["file-list"]]:e.external_data_tool?[e.external_data_tool.type,e.external_data_tool]:e.json_object?["json_object",e.json_object]:["select",e.select||{}],n=t===r?.variable;"string"===s||"paragraph"===s?a.push({key:r.variable,name:r.label,required:r.required,type:s,max_length:r.max_length,options:[],is_context_var:n,hide:r.hide,default:r.default}):"number"===s?a.push({key:r.variable,name:r.label,required:r.required,type:s,options:[],hide:r.hide,default:r.default}):"boolean"===s?a.push({key:r.variable,name:r.label,required:r.required,type:"checkbox",options:[],hide:r.hide,default:r.default}):"select"===s?a.push({key:r.variable,name:r.label,required:r.required,type:"select",options:r.options,is_context_var:n,hide:r.hide,default:r.default}):"file"===s?a.push({key:r.variable,name:r.label,required:r.required,type:s,config:{allowed_file_types:r.allowed_file_types,allowed_file_extensions:r.allowed_file_extensions,allowed_file_upload_methods:r.allowed_file_upload_methods,number_limits:1},hide:r.hide,default:r.default}):"file-list"===s?a.push({key:r.variable,name:r.label,required:r.required,type:s,config:{allowed_file_types:r.allowed_file_types,allowed_file_extensions:r.allowed_file_extensions,allowed_file_upload_methods:r.allowed_file_upload_methods,number_limits:r.max_length},hide:r.hide,default:r.default}):a.push({key:r.variable,name:r.label,required:r.required,type:r.type,enabled:r.enabled,config:r.config,icon:r.icon,icon_background:r.icon_background,is_context_var:n,hide:r.hide})}),a}])},326773,e=>{"use strict";var t=e.i(276925),a=e.i(124836),s=e.i(105845),r=e.i(326531),n=e.i(268255);e.i(152567);var i=e.i(408767),l=e.i(503144),o=e.i(153935),d=e.i(223314),u=e.i(137667),c=e.i(390622),p=e.i(157884),m=e.i(367916),h=e.i(648404),g=e.i(53349),f=e.i(130822);e.s(["useChat",0,(e,x,b,_,y,w)=>{let{t:v}=(0,i.useTranslation)(),{formatTime:j}=(0,p.default)(),{notify:k}=(0,u.useToastContext)(),C=(0,n.useRef)(""),N=(0,n.useRef)(!1),[I,T]=(0,n.useState)(!1),L=(0,n.useRef)(!1),F=(0,n.useRef)(""),[S,R]=(0,n.useState)([]),M=(0,n.useRef)(null),A=(0,n.useRef)(null),E=(0,r.useParams)(),P=(0,r.usePathname)(),[q,U]=(0,n.useState)(b||[]),D=(0,n.useRef)(q),[B,O]=(0,n.useState)(),$=(0,n.useMemo)(()=>(0,g.getThreadMessages)(q,B),[q,B]),V=(0,n.useCallback)(e=>(0,f.processOpeningStatement)(e,x?.inputs||{},x?.inputsForm||[]),[x?.inputs,x?.inputsForm]),W=(0,n.useMemo)(()=>{let t=[...$];if(e?.opening_statement){let a=$.findIndex(e=>e.isOpeningStatement);a>-1?t[a]={...t[a],content:V(e.opening_statement),suggestedQuestions:e.suggested_questions?.map(e=>V(e))}:t.unshift({id:"opening-statement",content:V(e.opening_statement),isAnswer:!0,isOpeningStatement:!0,suggestedQuestions:e.suggested_questions?.map(e=>V(e))})}return t},[$,e?.opening_statement,V,e?.suggested_questions]);(0,n.useEffect)(()=>((0,s.setAutoFreeze)(!1),()=>{(0,s.setAutoFreeze)(!0)}),[]);let H=(0,n.useCallback)((e,t)=>(0,s.produce)(D.current,a=>{let s=[...a];for(;s.length>0;){let a=s.shift();if(a.id===e){t(a);break}a.children&&s.push(...a.children)}}),[]),z=(0,n.useCallback)((e,t)=>{let a=H(e,e=>{"function"==typeof t?t(e):Object.keys(t).forEach(a=>{e[a]=t[a]})});U(a),D.current=a},[H]),Z=(0,n.useCallback)(e=>{T(e),L.current=e},[]),G=(0,n.useCallback)(()=>{N.current=!0,Z(!1),_&&F.current&&_(F.current),M.current&&M.current.abort(),A.current&&A.current.abort()},[_,Z]),J=(0,n.useCallback)(e=>{C.current="",F.current="",G(),U([]),R([]),e?.()},[G]),K=(0,n.useCallback)(e=>{let t,{parentId:a,responseItem:r,placeholderQuestionId:n,questionItem:i}=e,l={...i,children:[{...r,children:[]}]};U(t=a||q.some(e=>[n,i.id].includes(e.id))?H(a,e=>{let t=e.children.findIndex(e=>[n,i.id].includes(e.id));-1===t?e.children.push(l):e.children[t]=l}):(0,s.produce)(q,e=>{e.push(l)})),D.current=t},[q,H]),Q=(0,n.useCallback)(async(s,r,n)=>{let{onGetConversationMessages:i,onGetSuggestedQuestions:u,onConversationComplete:p,isPublicAPI:g}=n;if(R([]),L.current)return k({type:"info",message:v("errorMessage.waitForResponse",{ns:"appDebug"})}),!1;let b=$.find(e=>e.id===r.parent_message_id),_=`question-${Date.now()}`,y={id:_,content:r.query,isAnswer:!1,message_files:r.files,parentMessageId:r.parent_message_id},w=`answer-placeholder-${Date.now()}`,I={id:w,content:"",isAnswer:!0,parentMessageId:y.id,siblingIndex:b?.children?.length??q.length};O(b?.id),K({parentId:r.parent_message_id,responseItem:I,placeholderQuestionId:_,questionItem:y});let T={id:w,content:"",agent_thoughts:[],message_files:[],isAnswer:!0,parentMessageId:y.id,siblingIndex:b?.children?.length??q.length};Z(!0),N.current=!1;let{query:S,files:U,inputs:D,...B}=r,V={response_mode:"streaming",conversation_id:C.current,files:(0,d.getProcessedFiles)(U||[]),query:S,inputs:(0,f.getProcessedInputs)(D||{},x?.inputsForm||[]),...B};V?.files?.length&&(V.files=V.files.map(e=>e.transfer_method===h.TransferMethod.local_file?{...e,url:""}:e));let W=!1,H=!1,G="",J=!1;E.token?(G="/text-to-audio",J=!0):E.appId&&(G=P.search("explore/installed")>-1?`/installed-apps/${E.appId}/text-to-audio`:`/apps/${E.appId}/text-to-audio`);let Q=null,X=()=>(Q||(Q=o.AudioPlayerManager.getInstance().getAudioPlayer(G,J,(0,l.v4)(),"none","none",a.noop)),Q);return(0,m.ssePost)(s,{body:V},{isPublicAPI:g,onData:(e,t,a)=>{let{conversationId:s,messageId:n,taskId:i}=a;if(W){let t=T.agent_thoughts?.[T.agent_thoughts?.length-1];t&&(t.thought=t.thought+e)}else T.content=T.content+e;n&&!H&&(y.id=`question-${n}`,T.id=n,T.parentMessageId=y.id,H=!0),t&&s&&(C.current=s),F.current=i,n&&(T.id=n),K({placeholderQuestionId:_,questionItem:y,responseItem:T,parentId:r.parent_message_id})},async onCompleted(t){if(Z(!1),!t){if(p&&p(C.current),C.current&&!N.current&&i){let{data:e}=await i(C.current,e=>M.current=e),t=e.find(e=>e.id===T.id);if(!t)return;let a=t.agent_thoughts?.length>0&&t.agent_thoughts[t.agent_thoughts?.length-1].thought===t.answer;z(T.id,{content:a?"":t.answer,log:[...t.message,..."assistant"!==t.message[t.message.length-1].role?[{role:"assistant",text:t.answer,files:t.message_files?.filter(e=>"assistant"===e.belongs_to)||[]}]:[]],more:{time:j(t.created_at,"hh:mm A"),tokens:t.answer_tokens+t.message_tokens,latency:t.provider_response_latency.toFixed(2),tokens_per_second:t.provider_response_latency>0?(t.answer_tokens/t.provider_response_latency).toFixed(2):void 0},conversationId:C.current,input:{inputs:t.inputs,query:t.query}})}if(e?.suggested_questions_after_answer?.enabled&&!N.current&&u)try{let{data:e}=await u(T.id,e=>A.current=e);R(e)}catch(e){R([])}}},onFile(e){let t=e.type||"image",a="transferMethod"in e?e:null,s={id:a?.id||e.id,type:a?.type||("image"===t?"image/png":"video"===t?"video/mp4":"audio"===t?"audio/mpeg":"application/octet-stream"),transferMethod:a?.transferMethod||("image"===t?"remote_url":"local_file"),uploadedId:a?.uploadedId||e.id,supportFileType:a?.supportFileType||("image"===t?"image":"video"===t?"video":"audio"===t?"audio":"document"),progress:a?.progress??100,name:a?.name||`generated_${t}.${"image"===t?"png":"video"===t?"mp4":"audio"===t?"mp3":"bin"}`,url:a?.url||e.url,size:a?.size??0},n=T.agent_thoughts?.[T.agent_thoughts?.length-1];if(n)T.agent_thoughts[T.agent_thoughts.length-1].message_files=[...n.message_files??[],s];else{let e=T.message_files??[];T.message_files=[...e,s]}K({placeholderQuestionId:_,questionItem:y,responseItem:T,parentId:r.parent_message_id})},onThought(e){if(W=!0,e.message_id&&!H&&(T.id=e.message_id),e.conversation_id&&(T.conversationId=e.conversation_id),0===T.agent_thoughts.length)T.agent_thoughts.push(e);else{let t=T.agent_thoughts[T.agent_thoughts.length-1];t.id===e.id?(e.thought=t.thought,e.message_files=t.message_files,T.agent_thoughts[T.agent_thoughts.length-1]=e):T.agent_thoughts.push(e)}K({placeholderQuestionId:_,questionItem:y,responseItem:T,parentId:r.parent_message_id})},onMessageEnd:e=>{if(e.metadata?.annotation_reply){T.id=e.id,T.annotation={id:e.metadata.annotation_reply.id,authorName:e.metadata.annotation_reply.account.name},K({placeholderQuestionId:_,questionItem:y,responseItem:T,parentId:r.parent_message_id});return}T.citation=e.metadata?.retriever_resources||[];let a=(0,d.getProcessedFilesFromResponse)(e.files||[]);T.allFiles=(0,t.uniqBy)([...T.allFiles||[],...a||[]],"id"),K({placeholderQuestionId:_,questionItem:y,responseItem:T,parentId:r.parent_message_id})},onMessageReplace:e=>{T.content=e.answer},onError(){Z(!1),K({placeholderQuestionId:_,questionItem:y,responseItem:T,parentId:r.parent_message_id})},onWorkflowStarted:e=>{let{workflow_run_id:t,task_id:a}=e;F.current=a,T.workflow_run_id=t,T.workflowProcess={status:c.WorkflowRunningStatus.Running,tracing:[]},K({placeholderQuestionId:_,questionItem:y,responseItem:T,parentId:r.parent_message_id})},onWorkflowFinished:e=>{let{data:t}=e;T.workflowProcess.status=t.status,K({placeholderQuestionId:_,questionItem:y,responseItem:T,parentId:r.parent_message_id})},onIterationStart:e=>{let{data:t}=e;T.workflowProcess.tracing.push({...t,status:c.WorkflowRunningStatus.Running}),K({placeholderQuestionId:_,questionItem:y,responseItem:T,parentId:r.parent_message_id})},onIterationFinish:e=>{let{data:t}=e,a=T.workflowProcess.tracing,s=a.findIndex(e=>e.node_id===t.node_id&&(e.execution_metadata?.parallel_id===t.execution_metadata?.parallel_id||e.parallel_id===t.execution_metadata?.parallel_id));a[s]={...a[s],...t,status:c.WorkflowRunningStatus.Succeeded},K({placeholderQuestionId:_,questionItem:y,responseItem:T,parentId:r.parent_message_id})},onNodeStarted:e=>{let{data:t}=e;t.iteration_id||r.loop_id||(T.workflowProcess.tracing.push({...t,status:c.WorkflowRunningStatus.Running}),K({placeholderQuestionId:_,questionItem:y,responseItem:T,parentId:r.parent_message_id}))},onNodeFinished:e=>{let{data:t}=e;if(t.iteration_id||r.loop_id)return;let a=T.workflowProcess.tracing.findIndex(e=>e.execution_metadata?.parallel_id?e.node_id===t.node_id&&e.execution_metadata?.parallel_id===t.execution_metadata?.parallel_id:e.node_id===t.node_id);T.workflowProcess.tracing[a]=t,K({placeholderQuestionId:_,questionItem:y,responseItem:T,parentId:r.parent_message_id})},onTTSChunk:(e,t)=>{if(!t||""===t)return;let a=X();a&&(a.playAudioWithAudio(t,!0),o.AudioPlayerManager.getInstance().resetMsgId(e))},onTTSEnd:(e,t)=>{let a=X();a&&a.playAudioWithAudio(t,!1)},onLoopStart:e=>{let{data:t}=e;T.workflowProcess.tracing.push({...t,status:c.WorkflowRunningStatus.Running}),K({placeholderQuestionId:_,questionItem:y,responseItem:T,parentId:r.parent_message_id})},onLoopFinish:e=>{let{data:t}=e,a=T.workflowProcess.tracing,s=a.findIndex(e=>e.node_id===t.node_id&&(e.execution_metadata?.parallel_id===t.execution_metadata?.parallel_id||e.parallel_id===t.execution_metadata?.parallel_id));a[s]={...a[s],...t,status:c.WorkflowRunningStatus.Succeeded},K({placeholderQuestionId:_,questionItem:y,responseItem:T,parentId:r.parent_message_id})}}),!0},[v,q.length,$,e?.suggested_questions_after_answer,K,z,k,Z,j,E.token,E.appId,P,x]),X=(0,n.useCallback)((e,t,a)=>{let s=W[a-1].id,r=W[a].id;z(s,{content:e}),z(r,{content:t,annotation:{...W[a].annotation,logAnnotation:void 0}})},[W,z]),Y=(0,n.useCallback)((e,t,a,s,r)=>{let n=W[r-1].id,i=W[r].id;z(n,{content:a}),z(i,{content:W[r].content,annotation:{id:e,authorName:t,logAnnotation:{content:s,account:{id:"",name:t,email:""}}}})},[W,z]),ee=(0,n.useCallback)(e=>{z(W[e].id,{content:W[e].content,annotation:{...W[e].annotation,id:""}})},[W,z]);return(0,n.useEffect)(()=>{y&&J(()=>w?.(!1))},[y,w,J]),{chatList:W,setTargetMessageId:O,conversationId:C.current,isResponding:I,setIsResponding:T,handleSend:Q,suggestedQuestions:S,handleRestart:J,handleStop:G,handleAnnotationEdited:X,handleAnnotationAdded:Y,handleAnnotationRemoved:ee}}])}]);
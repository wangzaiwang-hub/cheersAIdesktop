(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,962027,e=>{"use strict";let t,r,n,o,a;var i,s=e.i(824627),c=e.i(978912),u=function(e,t){return(u=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},l=function(){return(l=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function f(e,t,r,n){return new(r||(r=Promise))(function(o,a){function i(e){try{c(n.next(e))}catch(e){a(e)}}function s(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(i,s)}c((n=n.apply(e,t||[])).next())})}function h(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){var u=[s,c];if(r)throw TypeError("Generator is already executing.");for(;a&&(a=0,u[0]&&(i=0)),i;)try{if(r=1,n&&(o=2&u[0]?n.return:u[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,u[1])).done)return o;switch(n=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,n=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===u[0]||2===u[0])){i=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){i.label=u[1];break}if(6===u[0]&&i.label<o[1]){i.label=o[1],o=u;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(u);break}o[2]&&i.ops.pop(),i.trys.pop();continue}u=t.call(e,i)}catch(e){u=[6,e],n=0}finally{r=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}}function p(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}"function"==typeof SuppressedError&&SuppressedError;var d="is not",v="contains",y="does not contain",g="less",m="less or equal",b="greater",w="greater or equal",x="version less",S="version less or equal",A="version greater",_="version greater or equal",C="set is",E="set is not",I="set contains",T="set does not contain",B="set contains any",D="set does not contain any",O=function(e){for(var t=[],r=0,n=0;n<e.length;n++){var o=e.charCodeAt(n);o<128?t[r++]=o:(o<2048?t[r++]=o>>6|192:((64512&o)==55296&&n+1<e.length&&(64512&e.charCodeAt(n+1))==56320?(o=65536+((1023&o)<<10)+(1023&e.charCodeAt(++n)),t[r++]=o>>18|240,t[r++]=o>>12&63|128):t[r++]=o>>12|224,t[r++]=o>>6&63|128),t[r++]=63&o|128)}return Uint8Array.from(t)},F=function(e,t){void 0===t&&(t=0);for(var r=O(e),n=r.length,o=n>>2,a=t,i=0;i<o;i++)a=k(M(r,i<<2),a);var s=o<<2,c=0;switch(n-s){case 3:c^=r[s+2]<<16,c^=r[s+1]<<8,c^=r[s],a^=c=Math.imul(c=N(c=Math.imul(c,-0x3361d2af),15),0x1b873593);break;case 2:c^=r[s+1]<<8,c^=r[s],a^=c=Math.imul(c=N(c=Math.imul(c,-0x3361d2af),15),0x1b873593);break;case 1:c^=r[s],a^=c=Math.imul(c=N(c=Math.imul(c,-0x3361d2af),15),0x1b873593)}return j(a^=n)>>>0},k=function(e,t){var r=e,n=t;return n^=r=Math.imul(r=N(r=Math.imul(r,-0x3361d2af),15),0x1b873593),(n=Math.imul(n=N(n,13),5))+-0x19ab949c|0},j=function(e){var t=e;return t^=t>>>16,t=Math.imul(t,-0x7a143595),t^=t>>>13,t=Math.imul(t,-0x3d4d51cb),t^=t>>>16},N=function(e,t,r){void 0===r&&(r=32),t>r&&(t%=r);var n=(e&0xffffffff<<r-t>>>0)>>>0>>>r-t>>>0;return(e<<t|n)>>>0},M=function(e,t){return void 0===t&&(t=0),P(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])},P=function(e){return(-0x1000000&e)>>>24|(0xff0000&e)>>>8|(65280&e)<<8|(255&e)<<24},L=function(e,t){var r,n;if(t&&0!==t.length){try{for(var o=p(t),a=o.next();!a.done;a=o.next()){var i=a.value;if(!i||!e||"object"!=typeof e)return;e=e[i]}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}if(!e)return;return e}},R="^".concat("(\\d+)\\.(\\d+)","(\\.").concat("(\\d+)").concat("(-(([-\\w]+\\.?)*))?",")?$"),K=function(){function e(e,t,r,n){void 0===n&&(n=void 0),this.major=e,this.minor=t,this.patch=r,this.preRelease=n}return e.parse=function(t){if(t){var r=new RegExp(R).exec(t);if(r){var n=Number(r[1]),o=Number(r[2]);if(!(isNaN(n)||isNaN(o)))return new e(n,o,Number(r[4])||0,r[5]||void 0)}}},e.prototype.compareTo=function(e){if(this.major>e.major)return 1;if(this.major<e.major)return -1;if(this.minor>e.minor)return 1;if(this.minor<e.minor)return -1;if(this.patch>e.patch)return 1;if(this.patch<e.patch||this.preRelease&&!e.preRelease)return -1;if(!this.preRelease&&e.preRelease)return 1;if(this.preRelease&&e.preRelease){if(this.preRelease>e.preRelease)return 1;if(this.preRelease<e.preRelease)return -1}return 0},e}(),U=function(){function e(){}return e.prototype.evaluate=function(e,t){var r,n,o={},a={context:e,result:o};try{for(var i=p(t),s=i.next();!s.done;s=i.next()){var c=s.value,u=this.evaluateFlag(a,c);u&&(o[c.key]=u)}}catch(e){r={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return o},e.prototype.evaluateFlag=function(e,t){try{for(var r,n,o,a=p(t.segments),i=a.next();!i.done;i=a.next()){var s=i.value;if(o=this.evaluateSegment(e,t,s)){var c=l(l(l({},t.metadata),s.metadata),o.metadata);o=l(l({},o),{metadata:c});break}}}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return o},e.prototype.evaluateSegment=function(e,t,r){var n,o,a,i;if(!r.conditions){var s=this.bucket(e,r);return void 0!==s?t.variants[s]:void 0}try{for(var c=p(r.conditions),u=c.next();!u.done;u=c.next()){var l=u.value,f=!0;try{for(var h=(a=void 0,p(l)),d=h.next();!d.done;d=h.next()){var v=d.value;if(!(f=this.matchCondition(e,v)))break}}catch(e){a={error:e}}finally{try{d&&!d.done&&(i=h.return)&&i.call(h)}finally{if(a)throw a.error}}if(f){var s=this.bucket(e,r);if(void 0!==s)return t.variants[s];return}}}catch(e){n={error:e}}finally{try{u&&!u.done&&(o=c.return)&&o.call(c)}finally{if(n)throw n.error}}},e.prototype.matchCondition=function(e,t){var r=L(e,t.selector);if(!r)return this.matchNull(t.op,t.values);if(this.isSetOperator(t.op)){var n=this.coerceStringArray(r);return!!n&&this.matchSet(n,t.op,t.values)}var o=this.coerceString(r);return void 0!==o&&this.matchString(o,t.op,t.values)},e.prototype.getHash=function(e){return F(e)},e.prototype.bucket=function(e,t){if(!t.bucket)return t.variant;var r,n,o,a,i=this.coerceString(L(e,t.bucket.selector));if(!i||0===i.length)return t.variant;var s="".concat(t.bucket.salt,"/").concat(i),c=this.getHash(s),u=c%100,l=Math.floor(c/100);try{for(var f=p(t.bucket.allocations),h=f.next();!h.done;h=f.next()){var d=h.value,v=d.range[0],y=d.range[1];if(u>=v&&u<y)try{for(var g=(o=void 0,p(d.distributions)),m=g.next();!m.done;m=g.next()){var b=m.value,w=b.range[0],x=b.range[1];if(l>=w&&l<x)return b.variant}}catch(e){o={error:e}}finally{try{m&&!m.done&&(a=g.return)&&a.call(g)}finally{if(o)throw o.error}}}}catch(e){r={error:e}}finally{try{h&&!h.done&&(n=f.return)&&n.call(f)}finally{if(r)throw r.error}}return t.variant},e.prototype.matchNull=function(e,t){var r=this.containsNone(t);switch(e){case"is":case v:case g:case m:case b:case w:case x:case S:case A:case _:case C:case I:case B:return r;case d:case y:case T:case D:return!r;default:return!1}},e.prototype.matchSet=function(e,t,r){switch(t){case C:return this.setEquals(e,r);case E:return!this.setEquals(e,r);case I:return this.matchesSetContainsAll(e,r);case T:return!this.matchesSetContainsAll(e,r);case B:return this.matchesSetContainsAny(e,r);case D:return!this.matchesSetContainsAny(e,r);default:return!1}},e.prototype.matchString=function(e,t,r){var n=this;switch(t){case"is":return this.matchesIs(e,r);case d:return!this.matchesIs(e,r);case v:return this.matchesContains(e,r);case y:return!this.matchesContains(e,r);case g:case m:case b:case w:return this.matchesComparable(e,t,r,function(e){return n.parseNumber(e)},this.comparator);case x:case S:case A:case _:return this.matchesComparable(e,t,r,function(e){return K.parse(e)},this.versionComparator);case"regex match":return this.matchesRegex(e,r);case"regex does not match":return!this.matchesRegex(e,r);default:return!1}},e.prototype.matchesIs=function(e,t){if(this.containsBooleans(t)){var r=e.toLowerCase();if("true"===r||"false"===r)return t.some(function(e){return e.toLowerCase()===r})}return t.some(function(t){return e===t})},e.prototype.matchesContains=function(e,t){var r,n;try{for(var o=p(t),a=o.next();!a.done;a=o.next()){var i=a.value;if(e.toLowerCase().includes(i.toLowerCase()))return!0}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return!1},e.prototype.matchesComparable=function(e,t,r,n,o){var a=this,i=n(e),s=r.map(function(e){return n(e)}).filter(function(e){return void 0!==e});return void 0===i||0===s.length?r.some(function(r){return a.comparator(e,t,r)}):s.some(function(e){return o(i,t,e)})},e.prototype.comparator=function(e,t,r){switch(t){case g:case x:return e<r;case m:case S:return e<=r;case b:case A:return e>r;case w:case _:return e>=r;default:return!1}},e.prototype.versionComparator=function(e,t,r){var n=e.compareTo(r);switch(t){case g:case x:return n<0;case m:case S:return n<=0;case b:case A:return n>0;case w:case _:return n>=0;default:return!1}},e.prototype.matchesRegex=function(e,t){return t.some(function(t){return!!new RegExp(t).exec(e)})},e.prototype.containsNone=function(e){return e.some(function(e){return"(none)"===e})},e.prototype.containsBooleans=function(e){return e.some(function(e){switch(e.toLowerCase()){case"true":case"false":return!0;default:return!1}})},e.prototype.parseNumber=function(e){var t;return null!=(t=Number(e))?t:void 0},e.prototype.coerceString=function(e){if(e)return"object"==typeof e?JSON.stringify(e):String(e)},e.prototype.coerceStringArray=function(e){var t=this;if(Array.isArray(e)){var r=e;return r.map(function(e){return t.coerceString(e)}).filter(Boolean)}var n=String(e);try{var o=JSON.parse(n);if(!Array.isArray(o))return;var r=e;return r.map(function(e){return t.coerceString(e)}).filter(Boolean)}catch(e){return}},e.prototype.isSetOperator=function(e){switch(e){case C:case E:case I:case T:case B:case D:return!0;default:return!1}},e.prototype.setEquals=function(e,t){var r=new Set(e),n=new Set(t);return r.size===n.size&&(function(e,t,r){if(r||2==arguments.length)for(var n,o=0,a=t.length;o<a;o++)!n&&o in t||(n||(n=Array.prototype.slice.call(t,0,o)),n[o]=t[o]);return e.concat(n||Array.prototype.slice.call(t))})([],function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,a=r.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(n=a.next()).done;)i.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(o)throw o.error}}return i}(n),!1).every(function(e){return r.has(e)})},e.prototype.matchesSetContainsAll=function(e,t){var r,n;if(e.length<t.length)return!1;try{for(var o=p(t),a=o.next();!a.done;a=o.next()){var i=a.value;if(!this.matchesIs(i,e))return!1}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return!0},e.prototype.matchesSetContainsAny=function(e,t){var r,n;try{for(var o=p(t),a=o.next();!a.done;a=o.next()){var i=a.value;if(this.matchesIs(i,e))return!0}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return!1},e}();let q="function"==typeof atob,V="function"==typeof btoa,z="function"==typeof c.Buffer,J="function"==typeof TextDecoder?new TextDecoder:void 0,W="function"==typeof TextEncoder?new TextEncoder:void 0,X=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),Z=(n={},X.forEach((e,t)=>n[e]=t),n),G=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,H=String.fromCharCode.bind(String),$="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),Q=e=>e.replace(/=/g,"").replace(/[+\/]/g,e=>"+"==e?"-":"_"),Y=V?e=>btoa(e):z?e=>c.Buffer.from(e,"binary").toString("base64"):e=>{let t,r,n,o,a="",i=e.length%3;for(let i=0;i<e.length;){if((r=e.charCodeAt(i++))>255||(n=e.charCodeAt(i++))>255||(o=e.charCodeAt(i++))>255)throw TypeError("invalid character found");a+=X[(t=r<<16|n<<8|o)>>18&63]+X[t>>12&63]+X[t>>6&63]+X[63&t]}return i?a.slice(0,i-3)+"===".substring(i):a},ee=z?e=>c.Buffer.from(e).toString("base64"):e=>{let t=[];for(let r=0,n=e.length;r<n;r+=4096)t.push(H.apply(null,e.subarray(r,r+4096)));return Y(t.join(""))},et=e=>{if(e.length<2){var t=e.charCodeAt(0);return t<128?e:t<2048?H(192|t>>>6)+H(128|63&t):H(224|t>>>12&15)+H(128|t>>>6&63)+H(128|63&t)}var t=65536+(e.charCodeAt(0)-55296)*1024+(e.charCodeAt(1)-56320);return H(240|t>>>18&7)+H(128|t>>>12&63)+H(128|t>>>6&63)+H(128|63&t)},er=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,en=z?e=>c.Buffer.from(e,"utf8").toString("base64"):W?e=>ee(W.encode(e)):e=>Y(e.replace(er,et)),eo=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t?Q(en(e)):en(e)},ea=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,ei=e=>{switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return H((t>>>10)+55296)+H((1023&t)+56320);case 3:return H((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return H((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},es=q?e=>atob(e.replace(/[^A-Za-z0-9\+\/]/g,"")):z?e=>c.Buffer.from(e,"base64").toString("binary"):e=>{if(e=e.replace(/\s+/g,""),!G.test(e))throw TypeError("malformed base64.");e+="==".slice(2-(3&e.length));let t,r="",n,o;for(let a=0;a<e.length;)t=Z[e.charAt(a++)]<<18|Z[e.charAt(a++)]<<12|(n=Z[e.charAt(a++)])<<6|(o=Z[e.charAt(a++)]),r+=64===n?H(t>>16&255):64===o?H(t>>16&255,t>>8&255):H(t>>16&255,t>>8&255,255&t);return r},ec=z?e=>$(c.Buffer.from(e,"base64")):e=>$(es(e).split("").map(e=>e.charCodeAt(0))),eu=z?e=>c.Buffer.from(e,"base64").toString("utf8"):J?e=>J.decode(ec(e)):e=>es(e).replace(ea,ei);var el=function(e){if("function"!=typeof e&&null!==e)throw TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=r}function r(t,n){var o=e.call(this,n)||this;return o.statusCode=t,Object.setPrototypeOf(o,r.prototype),o}return u(r,e),r.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t),r}(Error);(function(e,t,r){this.deploymentKey=e,this.serverUrl=t,this.httpClient=r}).prototype.getVariants=function(e,t){return f(this,void 0,void 0,function(){var r,n,o;return h(this,function(a){switch(a.label){case 0:return r=eo(JSON.stringify(e),!0),n={Authorization:"Api-Key ".concat(this.deploymentKey),"X-Amp-Exp-User":r},(null==t?void 0:t.flagKeys)&&(n["X-Amp-Exp-Flag-Keys"]=eo(JSON.stringify(t.flagKeys),!0)),(null==t?void 0:t.trackingOption)&&(n["X-Amp-Exp-Track"]=t.trackingOption),[4,this.httpClient.request({requestUrl:"".concat(this.serverUrl,"/sdk/v2/vardata?v=0"),method:"GET",headers:n,timeoutMillis:null==t?void 0:t.timeoutMillis})];case 1:if(200!=(o=a.sent()).status)throw new el(o.status,"Fetch error response: status=".concat(o.status));return[2,JSON.parse(o.body)]}})})},(function(e,t,r){this.deploymentKey=e,this.serverUrl=t,this.httpClient=r}).prototype.getFlags=function(e){return f(this,void 0,void 0,function(){var t,r;return h(this,function(n){switch(n.label){case 0:return t={Authorization:"Api-Key ".concat(this.deploymentKey)},(null==e?void 0:e.libraryName)&&(null==e?void 0:e.libraryVersion)&&(t["X-Amp-Exp-Library"]="".concat(e.libraryName,"/").concat(e.libraryVersion)),[4,this.httpClient.request({requestUrl:"".concat(this.serverUrl,"/sdk/v2/flags"),method:"GET",headers:t,timeoutMillis:null==e?void 0:e.timeoutMillis})];case 1:if(200!=(r=n.sent()).status)throw Error("Flags error response: status=".concat(r.status));return[2,JSON.parse(r.body).reduce(function(e,t){return e[t.key]=t,e},{})]}})})};var ef="u">typeof globalThis?globalThis:e.g||self;function eh(e,t){this.poller=void 0,this.action=e,this.ms=t}eh.prototype.start=function(){this.poller||(this.poller=ef.setInterval(this.action,this.ms),this.action())},eh.prototype.stop=function(){this.poller&&(ef.clearInterval(this.poller),this.poller=void 0)};let ep=(e,t)=>t.some(t=>e instanceof t),ed=new WeakMap,ev=new WeakMap,ey=new WeakMap,eg={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return ed.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return em(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function em(e){if(e instanceof IDBRequest){let t;return t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("success",o),e.removeEventListener("error",a)},o=()=>{t(em(e.result)),n()},a=()=>{r(e.error),n()};e.addEventListener("success",o),e.addEventListener("error",a)}),ey.set(t,e),t}if(ev.has(e))return ev.get(e);let n=function(e){if("function"==typeof e)return(r||(r=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return e.apply(eb(this),r),em(this.request)}:function(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return em(e.apply(eb(this),r))};return(e instanceof IDBTransaction&&function(e){if(ed.has(e))return;let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",a),e.removeEventListener("abort",a)},o=()=>{t(),n()},a=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",o),e.addEventListener("error",a),e.addEventListener("abort",a)});ed.set(e,t)}(e),ep(e,t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(e,eg):e}(e);return n!==e&&(ev.set(e,n),ey.set(n,e)),n}let eb=e=>ey.get(e),ew=["get","getKey","getAll","getAllKeys","count"],ex=["put","add","delete","clear"],eS=new Map;function eA(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(eS.get(t))return eS.get(t);let r=t.replace(/FromIndex$/,""),n=t!==r,o=ex.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(o||ew.includes(r)))return;let a=async function(e){for(var t=arguments.length,a=Array(t>1?t-1:0),i=1;i<t;i++)a[i-1]=arguments[i];let s=this.transaction(e,o?"readwrite":"readonly"),c=s.store;return n&&(c=c.index(a.shift())),(await Promise.all([c[r](...a),o&&s.done]))[0]};return eS.set(t,a),a}eg={...o=eg,get:(e,t,r)=>eA(e,t)||o.get(e,t,r),has:(e,t)=>!!eA(e,t)||o.has(e,t)};let e_=["continue","continuePrimaryKey","advance"],eC={},eE=new WeakMap,eI=new WeakMap,eT={get(e,t){if(!e_.includes(t))return e[t];let r=eC[t];return r||(r=eC[t]=function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];eE.set(this,eI.get(this)[t](...r))}),r}};async function*eB(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let n=this;if(n instanceof IDBCursor||(n=await n.openCursor(...t)),!n)return;let o=new Proxy(n,eT);for(eI.set(o,n),ey.set(o,eb(n));n;)yield o,n=await (eE.get(o)||n.continue()),eE.delete(o)}function eD(e,t){return t===Symbol.asyncIterator&&ep(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&ep(e,[IDBIndex,IDBObjectStore])}eg={...a=eg,get:(e,t,r)=>eD(e,t)?eB:a.get(e,t,r),has:(e,t)=>eD(e,t)||a.has(e,t)};var eO=new function(){var e=this;this.dbs={},this.createStore=function(t){return(0,s.__awaiter)(e,void 0,void 0,function(){return(0,s.__generator)(this,function(e){switch(e.label){case 0:return[4,function(e,t){let{blocked:r,upgrade:n,blocking:o,terminated:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=indexedDB.open(e,t),s=em(i);return n&&i.addEventListener("upgradeneeded",e=>{n(em(i.result),e.oldVersion,e.newVersion,em(i.transaction),e)}),r&&i.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),s.then(e=>{a&&e.addEventListener("close",()=>a()),o&&e.addEventListener("versionchange",e=>o(e.oldVersion,e.newVersion,e))}).catch(()=>{}),s}(t,1,{upgrade:function(e){e.objectStoreNames.contains("eventTypesForSession")||e.createObjectStore("eventTypesForSession",{keyPath:"sessionId"})}})];case 1:return[2,e.sent()]}})})},this.openOrCreateDB=function(t){return(0,s.__awaiter)(e,void 0,void 0,function(){var e,r;return(0,s.__generator)(this,function(n){switch(n.label){case 0:if(this.dbs&&this.dbs[t])return[2,this.dbs[t]];return e="".concat(t.substring(0,10),"_amp_targeting"),[4,this.createStore(e)];case 1:return r=n.sent(),this.dbs[t]=r,[2,r]}})})},this.updateEventListForSession=function(t){var r=t.sessionId,n=t.eventType,o=t.eventTime,a=t.loggerProvider,i=t.tx;return(0,s.__awaiter)(e,void 0,void 0,function(){var e,t,c,u,l,f,h;return(0,s.__generator)(this,function(p){switch(p.label){case 0:return p.trys.push([0,3,,4]),[4,i.store.get(r)];case 1:return c=(t=(e=p.sent())?e.eventTypes:{})[n]||{},u=(0,s.__assign)((0,s.__assign)({},t),((f={})[n]=(0,s.__assign)((0,s.__assign)({},c),((h={})[o]={event_type:n},h)),f)),[4,i.store.put({sessionId:r,eventTypes:u})];case 2:return p.sent(),[2,u];case 3:return l=p.sent(),a.warn("Failed to store events for targeting ".concat(r,": ").concat(l)),[3,4];case 4:return[2,void 0]}})})},this.deleteOldSessionEventTypes=function(t){var r=t.currentSessionId,n=t.loggerProvider,o=t.tx;return(0,s.__awaiter)(e,void 0,void 0,function(){var e,t,a,i,c;return(0,s.__generator)(this,function(s){switch(s.label){case 0:return s.trys.push([0,6,,7]),[4,o.store.getAll()];case 1:e=s.sent(),t=0,s.label=2;case 2:if(!(t<e.length))return[3,5];if(a=e[t],i=Date.now()-a.sessionId,!(a.sessionId!==r&&i>1728e5))return[3,4];return[4,o.store.delete(a.sessionId)];case 3:s.sent(),s.label=4;case 4:return t++,[3,2];case 5:return[3,7];case 6:return c=s.sent(),n.warn("Failed to clear old session events for targeting: ".concat(c)),[3,7];case 7:return[2]}})})},this.storeEventTypeForSession=function(t){var r=t.loggerProvider,n=t.sessionId,o=t.eventType,a=t.eventTime,i=t.apiKey;return(0,s.__awaiter)(e,void 0,void 0,function(){var e,t,c;return(0,s.__generator)(this,function(s){switch(s.label){case 0:return s.trys.push([0,5,,6]),[4,this.openOrCreateDB(i)];case 1:if(!(e=s.sent().transaction("eventTypesForSession","readwrite")))return[2];return[4,this.updateEventListForSession({sessionId:n,tx:e,loggerProvider:r,eventType:o,eventTime:a})];case 2:return t=s.sent(),[4,this.deleteOldSessionEventTypes({currentSessionId:n,tx:e,loggerProvider:r})];case 3:return s.sent(),[4,e.done];case 4:return s.sent(),[2,t];case 5:return c=s.sent(),r.warn("Failed to store events for targeting ".concat(n,": ").concat(c)),[3,6];case 6:return[2,void 0]}})})}},eF={evaluateTargeting:(i=new function(){var e=this;this.evaluateTargeting=function(t){var r=t.apiKey,n=t.loggerProvider,o=t.event,a=t.sessionId,i=t.userProperties,c=t.deviceId,u=t.flag;return(0,s.__awaiter)(e,void 0,void 0,function(){var e,t,l,f;return(0,s.__generator)(this,function(s){switch(s.label){case 0:if(!(o&&o.time))return[3,2];return[4,eO.storeEventTypeForSession({loggerProvider:n,apiKey:r,sessionId:a,eventType:o.event_type,eventTime:o.time})];case 1:return t=s.sent(),[3,3];case 2:t=void 0,s.label=3;case 3:return f={session_id:a,event:o,event_types:(l=(e=t)&&new Set(Object.keys(e)))&&Array.from(l),user:{device_id:c,user_properties:i}},[2,this.evaluationEngine.evaluate(f,[u])]}})})},this.evaluationEngine=new U}).evaluateTargeting.bind(i)}.evaluateTargeting;e.s(["evaluateTargeting",()=>eF],962027)}]);
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,222573,e=>{"use strict";var t=e.i(268255),i=e.i(925521),n=e.i(711536);e.s(["default",0,()=>{let e=(0,n.useSelector)(e=>e.currentWorkspace);return{getIconUrl:(0,t.useCallback)(t=>`${i.API_PREFIX}/workspaces/current/plugin/icon?tenant_id=${e.id}&filename=${t}`,[e.id])}}])},508110,e=>{"use strict";var t=e.i(340801);e.s(["Mcp",()=>t.default])},475390,e=>{"use strict";var t=e.i(875037),i=e.i(562572);e.i(214309);var n=e.i(654537),a=e.i(367916),s=e.i(722384);let r="pipeline",u=[r,"template-list"],l=[r,"published-pipeline"];e.s(["publishedPipelineInfoQueryKeyPrefix",0,l,"useCheckPipelineDependencies",0,function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,t.useMutation)({mutationKey:[r,"check-dependencies"],mutationFn:e=>(0,a.get)(`/rag/pipelines/imports/${e}/check-dependencies`),...e})},"useConvertDatasetToPipeline",0,()=>(0,t.useMutation)({mutationKey:[r,"convert-dataset-to-pipeline"],mutationFn:e=>(0,a.post)(`/rag/pipelines/transform/datasets/${e}`)}),"useDataSourceList",0,(e,t)=>(0,i.useQuery)({enabled:e,queryKey:[r,"datasource"],staleTime:0,queryFn:async()=>{let e=await (0,a.get)("/rag/pipelines/datasource-plugins");return t?.(e),e},retry:!1}),"useDatasourceSingleRun",0,function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,t.useMutation)({mutationKey:[r,"datasource-node-single-run"],mutationFn:e=>{let{pipeline_id:t,...i}=e;return(0,a.post)(`/rag/pipelines/${t}/workflows/draft/datasource/variables-inspect`,{body:i})},...e})},"useDeleteTemplate",0,function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,t.useMutation)({mutationKey:[r,"template-delete"],mutationFn:e=>(0,a.del)(`/rag/pipeline/customized/templates/${e}`),...e})},"useDraftPipelinePreProcessingParams",0,function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{pipeline_id:n,node_id:s}=e;return(0,i.useQuery)({queryKey:[r,"draft-pipeline-pre-processing-params",n,s],queryFn:()=>(0,a.get)(`/rag/pipelines/${n}/workflows/draft/pre-processing/parameters`,{params:{node_id:s}}),staleTime:0,enabled:t})},"useDraftPipelineProcessingParams",0,function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{pipeline_id:n,node_id:s}=e;return(0,i.useQuery)({queryKey:[r,"draft-pipeline-processing-params",n,s],queryFn:()=>(0,a.get)(`/rag/pipelines/${n}/workflows/draft/processing/parameters`,{params:{node_id:s}}),staleTime:0,enabled:t})},"useExportPipelineDSL",0,()=>(0,t.useMutation)({mutationKey:[r,"export-pipeline-dsl"],mutationFn:e=>{let{pipelineId:t,include:i=!1}=e;return(0,a.get)(`/rag/pipelines/${t}/exports?include_secret=${i}`)}}),"useExportTemplateDSL",0,function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,t.useMutation)({mutationKey:[r,"template-dsl-export"],mutationFn:e=>(0,a.post)(`/rag/pipeline/customized/templates/${e}`),...e})},"useImportPipelineDSL",0,function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,t.useMutation)({mutationKey:[r,"dsl-import"],mutationFn:e=>(0,a.post)("/rag/pipelines/imports",{body:e}),...e})},"useImportPipelineDSLConfirm",0,function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,t.useMutation)({mutationKey:[r,"dsl-import-confirm"],mutationFn:e=>(0,a.post)(`/rag/pipelines/imports/${e}/confirm`),...e})},"useInvalidCustomizedTemplateList",0,()=>(0,s.useInvalid)([...u,"customized"]),"useInvalidDataSourceList",0,()=>(0,s.useInvalid)([r,"datasource"]),"usePipelineExecutionLog",0,e=>{let{dataset_id:t,document_id:n}=e;return(0,i.useQuery)({queryKey:[r,"pipeline-execution-log",t,n],queryFn:()=>(0,a.get)(`/datasets/${t}/documents/${n}/pipeline-execution-log`),staleTime:0})},"usePipelineTemplateById",0,(e,t)=>{let{template_id:n,type:s}=e;return(0,i.useQuery)({queryKey:[r,"template",s,n],queryFn:()=>(0,a.get)(`/rag/pipeline/templates/${n}`,{params:{type:s}}),enabled:t,staleTime:0})},"usePipelineTemplateList",0,function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return(0,i.useQuery)({queryKey:[...u,e],queryFn:()=>(0,a.get)("/rag/pipeline/templates",{params:e}),enabled:t})},"usePreviewOnlineDocument",0,()=>(0,t.useMutation)({mutationKey:[r,"preview-online-document"],mutationFn:e=>{let{pipelineId:t,datasourceNodeId:i,workspaceID:s,pageID:r,pageType:u,credentialId:l}=e;return(0,a.post)(`/rag/pipelines/${t}/workflows/published/datasource/nodes/${i}/preview`,{body:{datasource_type:n.DatasourceType.onlineDocument,credential_id:l,inputs:{workspace_id:s,page_id:r,type:u}}})}}),"usePublishAsCustomizedPipeline",0,()=>(0,t.useMutation)({mutationKey:[r,"publish-as-customized-pipeline"],mutationFn:e=>{let{pipelineId:t,name:i,icon_info:n,description:s}=e;return(0,a.post)(`/rag/pipelines/${t}/customized/publish`,{body:{name:i,icon_info:n,description:s}})}}),"usePublishedPipelineInfo",0,e=>(0,i.useQuery)({queryKey:[...l,e],queryFn:()=>(0,a.get)(`/rag/pipelines/${e}/workflows/publish`),enabled:!!e}),"usePublishedPipelinePreProcessingParams",0,function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{pipeline_id:n,node_id:s}=e;return(0,i.useQuery)({queryKey:[r,"published-pipeline-pre-processing-params",n,s],queryFn:()=>(0,a.get)(`/rag/pipelines/${n}/workflows/published/pre-processing/parameters`,{params:{node_id:s}}),staleTime:0,enabled:t})},"usePublishedPipelineProcessingParams",0,e=>{let{pipeline_id:t,node_id:n}=e;return(0,i.useQuery)({queryKey:[r,"published-pipeline-processing-params",t,n],queryFn:()=>(0,a.get)(`/rag/pipelines/${t}/workflows/published/processing/parameters`,{params:{node_id:n}}),staleTime:0})},"useRunPublishedPipeline",0,function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,t.useMutation)({mutationKey:[r,"run-published-pipeline"],mutationFn:e=>{let{pipeline_id:t,is_preview:i,...n}=e;return(0,a.post)(`/rag/pipelines/${t}/workflows/published/run`,{body:{...n,is_preview:i,response_mode:"blocking"}})},...e})},"useUpdateTemplateInfo",0,function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,t.useMutation)({mutationKey:[r,"template-update"],mutationFn:e=>{let{template_id:t,...i}=e;return(0,a.patch)(`/rag/pipeline/customized/templates/${t}`,{body:i})},...e})}])},255202,e=>{"use strict";var t=e.i(875037),i=e.i(562572),n=e.i(367916),a=e.i(722384);let s="data-source-auth";e.s(["useGetDataSourceAuth",0,e=>{let{pluginId:t,provider:a}=e;return(0,i.useQuery)({queryKey:[s,"specific-data-source",t,a],queryFn:()=>(0,n.get)(`/auth/plugin/datasource/${t}/${a}`),retry:0})},"useGetDataSourceListAuth",0,()=>(0,i.useQuery)({queryKey:[s,"list"],queryFn:()=>(0,n.get)("/auth/plugin/datasource/list"),retry:0}),"useGetDataSourceOAuthUrl",0,e=>(0,t.useMutation)({mutationKey:[s,"oauth-url",e],mutationFn:t=>(0,n.get)(`/oauth/plugin/${e}/datasource/get-authorization-url?credential_id=${t}`)}),"useGetDefaultDataSourceListAuth",0,()=>(0,i.useQuery)({queryKey:[s,"default-list"],queryFn:()=>(0,n.get)("/auth/plugin/datasource/default-list"),retry:0}),"useInvalidDataSourceAuth",0,e=>{let{pluginId:t,provider:i}=e;return(0,a.useInvalid)([s,"specific-data-source",t,i])},"useInvalidDataSourceListAuth",0,()=>(0,a.useInvalid)([s,"list"]),"useInvalidDefaultDataSourceListAuth",0,()=>(0,a.useInvalid)([s,"default-list"])])},887460,e=>{"use strict";var t=e.i(367916);let i=async(e,i)=>{let n=new FormData;return n.append(i?"bundle":"pkg",e),(0,t.upload)({xhr:new XMLHttpRequest,data:n},!1,`/workspaces/current/plugin/upload/${i?"bundle":"pkg"}`)},n=async e=>(0,t.post)("/workspaces/current/plugin/upgrade/marketplace",{body:e}),a=async(e,i,n,a,s)=>(0,t.post)("/workspaces/current/plugin/upgrade/github",{body:{repo:e,version:i,package:n,original_plugin_unique_identifier:a,new_plugin_unique_identifier:s}}),s=async(e,i,n)=>(0,t.post)("/workspaces/current/plugin/upload/github",{body:{repo:e,version:i,package:n}}),r=async e=>(0,t.getMarketplace)(`/plugins/identifier?unique_identifier=${e}`),u=async e=>{let{org:i,name:n,version:a}=e;return(0,t.getMarketplace)(`/bundles/${i}/${n}/${a}`)},l=async e=>{let{org:i,name:n}=e;return(0,t.getMarketplace)(`/plugins/${i}/${n}`)},o=async e=>(0,t.get)(`/workspaces/current/plugin/tasks/${e}`),p=async e=>(0,t.post)("/workspaces/current/plugin/uninstall",{body:{plugin_installation_id:e}});e.s(["checkTaskStatus",0,o,"fetchBundleInfoFromMarketPlace",0,u,"fetchManifestFromMarketPlace",0,r,"fetchPluginInfoFromMarketPlace",0,l,"uninstallPlugin",0,p,"updateFromGitHub",0,a,"updateFromMarketPlace",0,n,"uploadFile",0,i,"uploadGitHub",0,s])},95085,e=>{"use strict";e.s(["default",()=>d,"useCanInstallPluginFromMarketplace",()=>p]);var t=e.i(268255);e.i(152567);var i=e.i(408767),n=e.i(711536),a=e.i(494268),s=e.i(157644),r=e.i(137667),u=e.i(944911);let l=(e,t)=>!!e&&e!==u.PermissionType.noOne&&(e===u.PermissionType.everyone||t),o=()=>{let{t:e}=(0,i.useTranslation)(),{isCurrentWorkspaceManager:t,isCurrentWorkspaceOwner:a}=(0,n.useAppContext)(),{data:u}=(0,s.useReferenceSettings)(),{permission:o}=u||{},p=(0,s.useInvalidateReferenceSettings)(),{mutate:d,isPending:c}=(0,s.useMutationReferenceSettings)({onSuccess:()=>{p(),r.default.notify({type:"success",message:e("api.actionSuccess",{ns:"common"})})}}),g=t||a;return{referenceSetting:u,setReferenceSettings:d,canManagement:l(o?.install_permission,g),canDebugger:l(o?.debug_permission,g),canSetPermissions:g,isUpdatePending:c}},p=()=>{let{enable_marketplace:e}=(0,a.useGlobalPublicStore)(e=>e.systemFeatures),{canManagement:i}=o();return{canInstallPluginFromMarketplace:(0,t.useMemo)(()=>e&&i,[e,i])}},d=o},157644,e=>{"use strict";e.s(["useCheckInstalled",()=>k,"useDebugKey",()=>D,"useDownloadPlugin",()=>B,"useFeaturedToolsRecommendations",()=>P,"useFeaturedTriggersRecommendations",()=>b,"useFetchDynamicOptions",()=>W,"useFetchPluginsInMarketPlaceByIds",()=>A,"useFetchPluginsInMarketPlaceByInfo",()=>E,"useInstallOrUpdate",()=>K,"useInstallPackageFromGitHub",()=>S,"useInstallPackageFromLocal",()=>$,"useInstallPackageFromMarketPlace",()=>F,"useInstalledLatestVersion",()=>q,"useInstalledPluginList",()=>w,"useInvalidateInstalledPluginList",()=>_,"useInvalidateReferenceSettings",()=>Q,"useModelInList",()=>O,"useMutationCheckDependencies",()=>H,"useMutationClearTaskPlugin",()=>G,"useMutationReferenceSettings",()=>R,"usePluginDeclarationFromMarketPlace",()=>M,"usePluginInfo",()=>V,"usePluginManifestInfo",()=>z,"usePluginReadme",()=>X,"usePluginReadmeAsset",()=>J,"usePluginTaskList",()=>U,"useReferenceSettings",()=>C,"useRemoveAutoUpgrade",()=>j,"useUpdatePackageFromMarketPlace",()=>I,"useUploadGitHub",()=>T,"useVersionListOfPlugin",()=>x]);var t=e.i(236063),i=e.i(875037),n=e.i(562572),a=e.i(214309),s=e.i(361126),r=e.i(268255),u=e.i(632717),l=e.i(108185),o=e.i(95085),p=e.i(944911),d=e.i(81828),c=e.i(887460),g=e.i(367916),y=e.i(154033);let m="plugins",f=[m,"installedPluginList"],k=e=>{let{pluginIds:t,enabled:i}=e;return(0,n.useQuery)({queryKey:[m,"checkInstalled",t],queryFn:()=>(0,g.post)("/workspaces/current/plugin/list/installations/ids",{body:{plugin_ids:t}}),enabled:i,staleTime:0})},h=[m,"recommendedMarketplacePlugins"],v=function(){let{collection:e="__recommended-plugins-tools",enabled:t=!0,limit:i=15}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,n.useQuery)({queryKey:[...h,e,i],queryFn:async()=>(await (0,g.postMarketplace)(`/collections/${e}/plugins`,{body:{limit:i}})).data.plugins.map(e=>(0,l.getFormattedPlugin)(e)),enabled:t,staleTime:6e4})},P=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15,{data:i=[],isLoading:n}=v({collection:"__recommended-plugins-tools",enabled:e,limit:t});return{plugins:i,isLoading:n}},b=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15,{data:i=[],isLoading:n}=v({collection:"__recommended-plugins-triggers",enabled:e,limit:t});return{plugins:i,isLoading:n}},w=function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=async e=>{let{pageParam:t=1}=e;return await (0,g.get)(`/workspaces/current/plugin/list?page=${t}&page_size=${i}`)},{data:a,error:s,fetchNextPage:r,hasNextPage:u,isFetchingNextPage:l,isLoading:o,isSuccess:p}=(0,t.useInfiniteQuery)({enabled:!e,queryKey:f,queryFn:n,getNextPageParam:(e,t)=>{let n=e.total,a=t.length;if(!(a*i>=n))return a+1},initialPageParam:1}),d=a?.pages.flatMap(e=>e.plugins)??[],c=a?.pages[0].total??0;return{data:e?void 0:{plugins:d,total:c},isLastPage:!u,loadNextPage:()=>{r()},isLoading:o,isFetching:l,error:s,isSuccess:p}},q=e=>(0,n.useQuery)({queryKey:[m,"installedLatestVersion",e],queryFn:()=>(0,g.post)("/workspaces/current/plugin/list/latest-versions",{body:{plugin_ids:e}}),enabled:!!e.length,initialData:e.length?void 0:{versions:{}}}),_=()=>{let e=(0,a.useQueryClient)(),t=(0,y.useInvalidateAllBuiltInTools)();return()=>{e.invalidateQueries({queryKey:f}),t()}},F=e=>(0,i.useMutation)({...e,mutationFn:e=>(0,g.post)("/workspaces/current/plugin/install/marketplace",{body:{plugin_unique_identifiers:[e]}})}),I=e=>(0,i.useMutation)({...e,mutationFn:e=>(0,g.post)("/workspaces/current/plugin/upgrade/marketplace",{body:e})}),M=e=>(0,n.useQuery)({queryKey:[m,"pluginDeclaration",e],queryFn:()=>(0,g.get)("/workspaces/current/plugin/marketplace/pkg",{params:{plugin_unique_identifier:e}}),enabled:!!e}),x=e=>(0,n.useQuery)({enabled:!!e,queryKey:[m,"versions",e],queryFn:()=>(0,g.getMarketplace)(`/plugins/${e}/versions`,{params:{page:1,page_size:100}})}),$=()=>(0,i.useMutation)({mutationFn:e=>(0,g.post)("/workspaces/current/plugin/install/pkg",{body:{plugin_unique_identifiers:[e]}})}),S=()=>(0,i.useMutation)({mutationFn:e=>{let{repoUrl:t,selectedVersion:i,selectedPackage:n,uniqueIdentifier:a}=e;return(0,g.post)("/workspaces/current/plugin/install/github",{body:{repo:t,version:i,package:n,plugin_unique_identifier:a}})}}),T=e=>(0,n.useQuery)({queryKey:[m,"uploadGitHub",e],queryFn:()=>(0,g.post)("/workspaces/current/plugin/upload/github",{body:e}),retry:0}),K=e=>{let{onSuccess:t}=e,{mutateAsync:n}=I();return(0,i.useMutation)({mutationFn:e=>{let{payload:t,plugin:i,installedInfo:a}=e;return Promise.all(t.map(async(e,t)=>{try{let s=a[`${i[t]?.org||i[t]?.author}/${i[t]?.name}`],r=!!s,u="",l="",o=!1;if("github"===e.type){if(!(u=e.value.github_plugin_unique_identifier)){let{unique_identifier:t}=await (0,g.post)("/workspaces/current/plugin/upload/github",{body:{repo:e.value.repo,version:e.value.release||e.value.version,package:e.value.packages||e.value.package}});if((u=e.value.github_plugin_unique_identifier||t)===s?.uniqueIdentifier)return{status:p.TaskStatus.success,taskId:"",uniqueIdentifier:""}}if(!r){let{task_id:t,all_installed:i}=await (0,g.post)("/workspaces/current/plugin/install/github",{body:{repo:e.value.repo,version:e.value.release||e.value.version,package:e.value.packages||e.value.package,plugin_unique_identifier:u}});l=t,o=i}}if("marketplace"===e.type){if((u=e.value.marketplace_plugin_unique_identifier||i[t]?.plugin_id)===s?.uniqueIdentifier)return{status:p.TaskStatus.success,taskId:"",uniqueIdentifier:""};if(!r){let{task_id:e,all_installed:t}=await (0,g.post)("/workspaces/current/plugin/install/marketplace",{body:{plugin_unique_identifiers:[u]}});l=e,o=t}}if("package"===e.type){if((u=e.value.unique_identifier)===s?.uniqueIdentifier)return{status:p.TaskStatus.success,taskId:"",uniqueIdentifier:""};if(!r){let{task_id:e,all_installed:t}=await (0,g.post)("/workspaces/current/plugin/install/pkg",{body:{plugin_unique_identifiers:[u]}});l=e,o=t}}if(r)if("package"===e.type){await (0,c.uninstallPlugin)(s.installedId);let{task_id:e,all_installed:t}=await (0,g.post)("/workspaces/current/plugin/install/pkg",{body:{plugin_unique_identifiers:[u]}});l=e,o=t}else{let{task_id:e,all_installed:t}=await n({original_plugin_unique_identifier:s?.uniqueIdentifier,new_plugin_unique_identifier:u});l=e,o=t}if(o)return{status:p.TaskStatus.success,taskId:"",uniqueIdentifier:""};return{status:p.TaskStatus.running,taskId:l,uniqueIdentifier:u}}catch(e){return Promise.resolve({status:p.TaskStatus.failed,taskId:"",uniqueIdentifier:""})}}))},onSuccess:t})},D=()=>(0,n.useQuery)({queryKey:[m,"debugKey"],queryFn:()=>(0,g.get)("/workspaces/current/plugin/debugging-key")}),L=[m,"referenceSettings"],C=()=>(0,n.useQuery)({queryKey:L,queryFn:()=>(0,g.get)("/workspaces/current/plugin/preferences/fetch")}),Q=()=>{let e=(0,a.useQueryClient)();return()=>{e.invalidateQueries({queryKey:L})}},R=e=>{let{onSuccess:t}=e;return(0,i.useMutation)({mutationFn:e=>(0,g.post)("/workspaces/current/plugin/preferences/change",{body:e}),onSuccess:t})},j=()=>(0,i.useMutation)({mutationFn:e=>(0,g.post)("/workspaces/current/plugin/preferences/autoupgrade/exclude",{body:e})}),A=(e,t)=>(0,n.useQuery)({...t,queryKey:[m,"fetchPluginsInMarketPlaceByIds",e],queryFn:()=>(0,g.postMarketplace)("/plugins/identifier/batch",{body:{unique_identifiers:e}}),enabled:e?.filter(e=>!!e).length>0,retry:0}),E=e=>(0,n.useQuery)({queryKey:[m,"fetchPluginsInMarketPlaceByInfo",e],queryFn:()=>(0,g.postMarketplace)("/plugins/versions/batch",{body:{plugin_tuples:e.map(e=>({org:e.organization,name:e.plugin,version:e.version}))}}),enabled:e?.filter(e=>!!e).length>0,retry:0}),N=[m,"pluginTaskList"],U=e=>{let[t,i]=(0,r.useState)(!1),{canManagement:a}=(0,o.default)(),{refreshPluginList:l}=(0,u.default)(),{data:d,isFetched:c,isRefetching:y,refetch:m,...f}=(0,n.useQuery)({enabled:a,queryKey:N,queryFn:()=>(0,g.get)("/workspaces/current/plugin/tasks?page=1&page_size=100"),refetchInterval:e=>{let t=e.state.data;return!t?.tasks.every(e=>e.status===p.TaskStatus.success||e.status===p.TaskStatus.failed)&&5e3}});(0,r.useEffect)(()=>{if(!t||y)return;let i=(0,s.cloneDeep)(d),n=i?.tasks.every(e=>e.status===p.TaskStatus.success||e.status===p.TaskStatus.failed),a=i?.tasks.every(e=>e.status===p.TaskStatus.failed);n&&i?.tasks.length&&!a&&l(e?{category:e}:void 0,!e)},[y]),(0,r.useEffect)(()=>{i(!0)},[]);let k=(0,r.useCallback)(()=>{m()},[m]);return{data:d,pluginTasks:d?.tasks||[],isFetched:c,handleRefetch:k,...f}},G=()=>(0,i.useMutation)({mutationFn:e=>{let{taskId:t,pluginId:i}=e,n=encodeURIComponent(i);return(0,g.post)(`/workspaces/current/plugin/tasks/${t}/delete/${n}`)}}),z=e=>(0,n.useQuery)({enabled:!!e,queryKey:[[m,"manifest",e]],queryFn:()=>(0,g.getMarketplace)(`/plugins/${e}`),retry:0}),B=(e,t)=>(0,n.useQuery)({queryKey:[m,"downloadPlugin",e],queryFn:()=>(0,g.getMarketplace)(`/plugins/${e.organization}/${e.pluginName}/${e.version}/download`),enabled:t,retry:0}),H=()=>(0,i.useMutation)({mutationFn:e=>(0,g.get)(`/apps/imports/${e}/check-dependencies`)}),O=(e,t)=>{let i=e?.provider;return(0,n.useQuery)({queryKey:["modelInList",i,t],queryFn:async()=>{if(!t||!i)return!1;try{let e=await (0,d.fetchModelProviderModelList)(`/workspaces/current/model-providers/${i}/models`);return!!t&&!!e.data.find(e=>e.model===t)}catch{return!1}},enabled:!!t&&!!i})},V=e=>(0,n.useQuery)({queryKey:["pluginInfo",e],queryFn:async()=>{if(!e)return null;let t=e.split("/"),i=t[0],n=t[1];try{let e=await (0,c.fetchPluginInfoFromMarketPlace)({org:i,name:n});return e.data.plugin.category===p.PluginCategoryEnum.model?e.data.plugin:null}catch{return null}},enabled:!!e}),W=(e,t,n,a,s,r)=>(0,i.useMutation)({mutationFn:()=>(0,g.get)("/workspaces/current/plugin/parameters/dynamic-options",{params:{plugin_id:e,provider:t,action:n,parameter:a,provider_type:s,...r}})}),X=e=>{let{plugin_unique_identifier:t,language:i}=e;return(0,n.useQuery)({queryKey:["pluginReadme",t,i],queryFn:()=>(0,g.get)("/workspaces/current/plugin/readme",{params:{plugin_unique_identifier:t,language:i}},{silent:!0}),enabled:!!t,retry:0})},J=e=>{let{file_name:t,plugin_unique_identifier:i}=e,a=t?.replace(/(^\.\/_assets\/|^_assets\/)/,"");return(0,n.useQuery)({queryKey:["pluginReadmeAsset",i,a],queryFn:()=>(0,g.get)("/workspaces/current/plugin/asset",{params:{plugin_unique_identifier:i,file_name:a}},{silent:!0}),enabled:!!i&&!!t&&/(^\.\/_assets|^_assets)/.test(t)})}},632717,e=>{"use strict";e.s(["default",()=>d]);var t=e.i(739255),i=e.i(225162),n=e.i(56971),a=e.i(255202),s=e.i(475390),r=e.i(157644),u=e.i(243922),l=e.i(154033),o=e.i(819114),p=e.i(944911);let d=()=>{let e=(0,r.useInvalidateInstalledPluginList)(),{mutate:d}=(0,i.useModelList)(t.ModelTypeEnum.textGeneration),{mutate:c}=(0,i.useModelList)(t.ModelTypeEnum.textEmbedding),{mutate:g}=(0,i.useModelList)(t.ModelTypeEnum.rerank),{refreshModelProviders:y}=(0,n.useProviderContext)(),m=(0,l.useInvalidateAllToolProviders)(),f=(0,l.useInvalidateAllBuiltInTools)(),k=(0,s.useInvalidDataSourceList)(),h=(0,a.useInvalidDataSourceListAuth)(),v=(0,u.useInvalidateStrategyProviders)(),P=(0,o.useInvalidateAllTriggerPlugins)(),b=(0,l.useInvalidateRAGRecommendedPlugins)();return{refreshPluginList:(t,i)=>{e(),(t&&p.PluginCategoryEnum.tool.includes(t.category)||i)&&(m(),f(),b("tool")),(t&&p.PluginCategoryEnum.trigger.includes(t.category)||i)&&P(),(t&&p.PluginCategoryEnum.datasource.includes(t.category)||i)&&(k(),h()),(t&&p.PluginCategoryEnum.model.includes(t.category)||i)&&(y(),d(),c(),g()),(t&&p.PluginCategoryEnum.agent.includes(t.category)||i)&&v()}}}},465497,e=>{"use strict";var t=e.i(563199),i=e.i(935139);e.s(["SkeletonContainer",0,e=>{let{className:n,children:a,...s}=e;return(0,t.jsx)("div",{className:(0,i.cn)("flex flex-col gap-1",n),...s,children:a})},"SkeletonPoint",0,e=>{let{className:n,...a}=e;return(0,t.jsx)("div",{className:(0,i.cn)("text-xs font-medium text-text-quaternary",n),...a,children:"Â·"})},"SkeletonRectangle",0,e=>{let{className:n,children:a,...s}=e;return(0,t.jsx)("div",{className:(0,i.cn)("my-1 h-2 rounded-sm bg-text-quaternary opacity-20",n),...s,children:a})},"SkeletonRow",0,e=>{let{className:n,children:a,...s}=e;return(0,t.jsx)("div",{className:(0,i.cn)("flex items-center gap-2",n),...s,children:a})}])},523614,e=>{"use strict";var t=e.i(36503);e.s(["compareVersion",0,(e,i)=>t.default.compare(e,i),"getLatestVersion",0,e=>t.default.rsort(e)[0],"isEqualOrLaterThanVersion",0,(e,i)=>t.default.gte(e,i)])},908132,e=>{"use strict";var t=e.i(137667),i=e.i(925521),n=e.i(887460),a=e.i(523614);let s=e=>e.map(e=>({tag_name:e.tag_name,assets:e.assets.map(e=>({browser_download_url:e.browser_download_url,name:e.name}))}));e.s(["useGitHubReleases",0,()=>({fetchReleases:async(e,n)=>{try{if(i.GITHUB_ACCESS_TOKEN){let t=await fetch(`/repos/${e}/${n}/releases`),i=await t.json();if(200!==i.status)throw Error(i.data.message);return s(i.data)}{let t=await fetch(`https://api.github.com/repos/${e}/${n}/releases`);if(!t.ok)throw Error("Failed to fetch repository releases");let i=await t.json();return s(i)}}catch(e){return e instanceof Error?t.default.notify({type:"error",message:e.message}):t.default.notify({type:"error",message:"Failed to fetch repository releases"}),[]}},checkForUpdates:(e,t)=>{let i=!1,n={type:"info",message:"No new version available"};if(0===e.length)return n.type="error",n.message="Input releases is empty",{needUpdate:i,toastProps:n};let s=e.map(e=>e.tag_name),r=(0,a.getLatestVersion)(s);try{(i=1===(0,a.compareVersion)(r,t))&&(n.message=`New version available: ${r}`)}catch{i=!1,n.type="error",n.message="Fail to compare versions, please check the version format"}return{needUpdate:i,toastProps:n}}}),"useGitHubUpload",0,()=>({handleUpload:async(e,i,a,s)=>{try{let t=await (0,n.uploadGitHub)(e,i,a),r={manifest:t.manifest,unique_identifier:t.unique_identifier};return s&&s(r),r}catch(e){throw t.default.notify({type:"error",message:"Error uploading package"}),e}}})])},583926,e=>{"use strict";var t,i=e.i(563199),n=e.i(268255);e.i(152567);var a=e.i(408767),s=e.i(500536),r=e.i(151094),u=e.i(21151),l=e.i(365181),o=e.i(745754),p=e.i(228403),d=e.i(887460),c=e.i(157644),g=e.i(935139),y=e.i(137667),m=e.i(222573),f=e.i(944911);let k="autoUpdate.pluginDowngradeWarning",h=e=>{let{onCancel:t,onJustDowngrade:n,onExcludeAndDowngrade:s}=e,{t:u}=(0,a.useTranslation)();return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"flex flex-col items-start gap-2 self-stretch",children:[(0,i.jsx)("div",{className:"title-2xl-semi-bold text-text-primary",children:u(`${k}.title`,{ns:"plugin"})}),(0,i.jsx)("div",{className:"system-md-regular text-text-secondary",children:u(`${k}.description`,{ns:"plugin"})})]}),(0,i.jsxs)("div",{className:"mt-9 flex items-start justify-end space-x-2 self-stretch",children:[(0,i.jsx)(r.default,{variant:"secondary",onClick:()=>t(),children:u("newApp.Cancel",{ns:"app"})}),(0,i.jsx)(r.default,{variant:"secondary",destructive:!0,onClick:n,children:u(`${k}.downgrade`,{ns:"plugin"})}),(0,i.jsx)(r.default,{variant:"primary",onClick:s,children:u(`${k}.exclude`,{ns:"plugin"})})]})]})},v="upgrade";var P=((t=P||{}).notStarted="notStarted",t.upgrading="upgrading",t.installed="installed",t);let b=n.memo(e=>{let{payload:t,pluginId:k,onSave:P,onCancel:b,isShowDowngradeWarningModal:w}=e,{originalPackageInfo:q,targetPackageInfo:_}=t,{t:F}=(0,a.useTranslation)(),{getIconUrl:I}=(0,m.default)(),[M,x]=(0,n.useState)(q.payload.icon);(0,n.useEffect)(()=>{(async()=>{x(await I(q.payload.icon))})()},[q,I]);let{check:$,stop:S}=(0,o.default)(),[T,K]=(0,n.useState)("notStarted"),{handleRefetch:D}=(0,c.usePluginTaskList)(t.category),L=(0,n.useMemo)(()=>({notStarted:F(`${v}.upgrade`,{ns:"plugin"}),upgrading:F(`${v}.upgrading`,{ns:"plugin"}),installed:F(`${v}.close`,{ns:"plugin"})})[T],[F,T]),C=(0,n.useCallback)(async()=>{if("notStarted"===T){K("upgrading");try{let{all_installed:e,task_id:t}=await (0,d.updateFromMarketPlace)({original_plugin_unique_identifier:q.id,new_plugin_unique_identifier:_.id});if(e)return void P();D();let{status:i,error:n}=await $({taskId:t,pluginUniqueIdentifier:_.id});if(i===f.TaskStatus.failed)return void y.default.notify({type:"error",message:n});P()}catch(e){K("notStarted")}return}"installed"===T&&P()},[P,T,$,q.id,D,_.id]),{mutateAsync:Q}=(0,c.useRemoveAutoUpgrade)(),R=(0,c.useInvalidateReferenceSettings)(),j=async()=>{k&&await Q({plugin_id:k}),R(),C()},A=w&&"notStarted"===T;return(0,i.jsxs)(u.default,{isShow:!0,onClose:b,className:(0,g.cn)("min-w-[560px]",A&&"min-w-[640px]"),closable:!0,title:!A&&F(`${v}.${"installed"===T?"successfulTitle":"title"}`,{ns:"plugin"}),children:[A&&(0,i.jsx)(h,{onCancel:b,onJustDowngrade:C,onExcludeAndDowngrade:j}),!A&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"system-md-regular mb-2 mt-3 text-text-secondary",children:F(`${v}.description`,{ns:"plugin"})}),(0,i.jsx)("div",{className:"flex flex-wrap content-start items-start gap-1 self-stretch rounded-2xl bg-background-section-burn p-2",children:(0,i.jsx)(l.default,{installed:"installed"===T,payload:(0,p.pluginManifestToCardPluginProps)({...q.payload,icon:M}),className:"w-full",titleLeft:(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(s.default,{className:"mx-1",size:"s",state:s.BadgeState.Warning,children:`${q.payload.version} -> ${_.version}`})})})}),(0,i.jsxs)("div",{className:"flex items-center justify-end gap-2 self-stretch pt-5",children:["notStarted"===T&&(0,i.jsx)(r.default,{onClick:()=>{S(),b()},children:F("operation.cancel",{ns:"common"})}),(0,i.jsx)(r.default,{variant:"primary",loading:"upgrading"===T,onClick:C,disabled:"upgrading"===T,children:L})]})]})]})});e.s(["default",0,b],583926)}]);
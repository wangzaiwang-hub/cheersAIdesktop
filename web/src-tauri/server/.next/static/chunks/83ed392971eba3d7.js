(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,500536,e=>{"use strict";var t,n=e.i(563199),l=e.i(294237),a=e.i(935139),i=((t=i||{}).Warning="warning",t.Accent="accent",t.Default="",t);let r=(0,l.cva)("badge",{variants:{size:{s:"badge-s",m:"badge-m",l:"badge-l"}},defaultVariants:{size:"m"}}),s=e=>{let{className:t,size:l,state:i="",iconOnly:s=!1,uppercase:o=!1,styleCss:d,children:c,...m}=e;return(0,n.jsx)("div",{className:(0,a.cn)(r({size:l,className:t}),function(e){switch(e){case"warning":return"badge-warning";case"accent":return"badge-accent";default:return""}}(i),"s"===l?s?"p-[3px]":"px-[5px] py-[3px]":"l"===l?s?"p-1.5":"px-2 py-1":s?"p-1":"px-[5px] py-[2px]",o?"system-2xs-medium-uppercase":"system-2xs-medium"),style:d,...m,children:c})};s.displayName="Badge",e.s(["Badge",()=>s,"BadgeState",()=>i,"default",0,s])},65932,(e,t,n)=>{"use strict";t.exports=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;if(Array.isArray(t)){if((l=t.length)!=n.length)return!1;for(a=l;0!=a--;)if(!e(t[a],n[a]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((l=(i=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(a=l;0!=a--;)if(!Object.prototype.hasOwnProperty.call(n,i[a]))return!1;for(a=l;0!=a--;){var l,a,i,r=i[a];if(!e(t[r],n[r]))return!1}return!0}return t!=t&&n!=n}},291428,e=>{e.v({icon:{type:"element",isRootNode:!0,name:"svg",attributes:{width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg"},children:[{type:"element",name:"g",attributes:{id:"alert-triangle"},children:[{type:"element",name:"path",attributes:{id:"Solid","fill-rule":"evenodd","clip-rule":"evenodd",d:"M6.40616 0.834185C6.14751 0.719172 5.85222 0.719172 5.59356 0.834185C5.3938 0.923011 5.26403 1.07947 5.17373 1.20696C5.08495 1.3323 4.9899 1.49651 4.88536 1.67711L0.751783 8.81693C0.646828 8.99818 0.551451 9.16289 0.486781 9.30268C0.421056 9.44475 0.349754 9.63572 0.372478 9.85369C0.401884 10.1357 0.549654 10.392 0.779012 10.5588C0.956259 10.6877 1.15726 10.7217 1.31314 10.736C1.46651 10.75 1.65684 10.75 1.86628 10.75H10.1334C10.3429 10.75 10.5332 10.75 10.6866 10.736C10.8425 10.7217 11.0435 10.6877 11.2207 10.5588C11.4501 10.392 11.5978 10.1357 11.6272 9.85369C11.65 9.63572 11.5787 9.44475 11.5129 9.30268C11.4483 9.1629 11.3529 8.9982 11.248 8.81697L7.11436 1.67709C7.00983 1.49651 6.91477 1.3323 6.82599 1.20696C6.73569 1.07947 6.60593 0.923011 6.40616 0.834185ZM6.49988 4.5C6.49988 4.22386 6.27602 4 5.99988 4C5.72374 4 5.49988 4.22386 5.49988 4.5V6.5C5.49988 6.77614 5.72374 7 5.99988 7C6.27602 7 6.49988 6.77614 6.49988 6.5V4.5ZM5.99988 8C5.72374 8 5.49988 8.22386 5.49988 8.5C5.49988 8.77614 5.72374 9 5.99988 9H6.00488C6.28102 9 6.50488 8.77614 6.50488 8.5C6.50488 8.22386 6.28102 8 6.00488 8H5.99988Z",fill:"currentColor"},children:[]}]}]},name:"AlertTriangle"})},793622,417494,259509,e=>{"use strict";var t=e.i(563199),n=e.i(807324),l=e.i(291428);let a=e=>{let{ref:a,...i}=e;return(0,t.jsx)(n.default,{...i,ref:a,data:l.default})};a.displayName="AlertTriangle",e.s(["default",0,a],417494),e.s([],793622),e.s(["AlertTriangle",0,a],259509)},845255,e=>{"use strict";var t=e.i(502662);e.s(["SparklesSoft",()=>t.default])},84366,e=>{"use strict";var t=e.i(563199),n=e.i(268255);e.i(152567);var l=e.i(408767),a=e.i(151094);e.i(432024);var i=e.i(845255),r=e.i(296124),s=e.i(876359);let o=n.memo(e=>{let{className:n,size:o="m",style:d,isPlain:c=!1,isShort:m=!1,onClick:u,loc:p,labelKey:f}=e,{t:x}=(0,l.useTranslation)(),{setShowPricingModal:g}=(0,r.useModalContext)(),h=()=>{u?u():g(),p&&window.gtag&&window.gtag("event","click_upgrade_btn",{loc:p})},b=x(m?"upgradeBtn.encourageShort":"upgradeBtn.encourage",{ns:"billing"}),v=f?x(f,{ns:"billing"}):b;return c?(0,t.jsx)(a.default,{className:n,style:d,onClick:h,children:f?v:x("upgradeBtn.plain",{ns:"billing"})}):(0,t.jsxs)(s.default,{size:o,color:"blue",allowHover:!0,onClick:h,className:n,style:d,children:[(0,t.jsx)(i.SparklesSoft,{className:"flex h-3.5 w-3.5 items-center py-[1px] pl-[3px] text-components-premium-badge-indigo-text-stop-0"}),(0,t.jsx)("div",{className:"system-xs-medium",children:(0,t.jsx)("span",{className:"p-1",children:v})})]})});e.s(["default",0,o])},34628,e=>{e.v({gridBg:"style-module__T68GKq__gridBg"})},325222,e=>{"use strict";var t=e.i(563199),n=e.i(935139),l=e.i(34628);e.s(["default",0,e=>{let{children:a,wrapperClassName:i,canvasClassName:r,gradientClassName:s}=e;return(0,t.jsxs)("div",{className:(0,n.cn)("relative bg-saas-background",i),children:[(0,t.jsx)("div",{className:(0,n.cn)("absolute inset-0 z-0 h-full w-full opacity-70",r,l.default.gridBg)}),(0,t.jsx)("div",{className:(0,n.cn)("absolute z-[1] h-full w-full rounded-lg bg-grid-mask-background",s)}),(0,t.jsx)("div",{className:"relative z-[2]",children:a})]})}])},177335,e=>{e.v({simplePieChart:"index-module__rIA7nG__simplePieChart"})},153435,e=>{"use strict";var t=e.i(563199),n=e.i(676197),l=e.i(268255),a=e.i(935139),i=e.i(177335);let r=(0,l.memo)(e=>{let{percentage:r=80,fill:s="#fdb022",stroke:o="#f79009",size:d=12,animationDuration:c,className:m}=e,u=(0,l.useMemo)(()=>({series:[{type:"pie",radius:["83%","100%"],animation:!1,data:[{value:100,itemStyle:{color:o}}],emphasis:{disabled:!0},labelLine:{show:!1},cursor:"default"},{type:"pie",radius:"83%",animationDuration:c??600,data:[{value:r,itemStyle:{color:s}},{value:100-r,itemStyle:{color:"#fff"}}],emphasis:{disabled:!0},labelLine:{show:!1},cursor:"default"}]}),[o,s,r,c]);return(0,t.jsx)(n.default,{option:u,className:(0,a.cn)(i.default.simplePieChart,m),style:{"--simple-pie-chart-color":s,width:d,height:d}})});e.s(["default",0,r])},530020,e=>{e.v({textGradient:"style-module__wQozFa__textGradient"})},591324,e=>{"use strict";var t=e.i(563199),n=e.i(268255);e.i(152567);var l=e.i(408767),a=e.i(151094),i=e.i(547105),r=e.i(449980),s=e.i(21151),o=e.i(137667);e.i(466836);var d=e.i(726547),d=d,c=e.i(683503),m=e.i(935139),u=e.i(739255),p=e.i(225162),f=e.i(215128),x=e.i(722591),g=e.i(540284),h=e.i(837699),b=e.i(500536),v=e.i(325222);e.i(77445);var _=e.i(964493);e.i(793622);var j=e.i(259509),y=e.i(260484),C=e.i(421001),w=e.i(84366),N=e.i(530020),M=e.i(105058),M=M,k=e.i(925521),S=e.i(56971),P=e.i(836340),T=e.i(393689),T=T,B=e.i(153435);let F=(0,n.memo)(e=>{let{secondsRemaining:a,onFinish:i}=e,{t:r}=(0,l.useTranslation)(),s=(0,n.useRef)(Date.now()),[o,d]=(0,n.useState)(s.current),c=(0,n.useMemo)(()=>Math.ceil((s.current-o)/1e3),[o]),m=(0,n.useRef)(void 0),u=(0,n.useCallback)(()=>{m.current&&(window.clearTimeout(m.current),m.current=void 0)},[]),p=(0,T.default)(i),f=(0,n.useCallback)(()=>{u(),m.current=window.setTimeout(()=>{Date.now()<=s.current?(d(Date.now()),f()):(p.current?.(),u())},1e3)},[u,p]);return(0,n.useEffect)(()=>{let e=Date.now();return s.current=e+(a??0)*1e3,d(e),f(),u},[u,f,a]),c?(0,t.jsx)(C.default,{popupContent:r("modelProvider.apiKeyRateLimit",{ns:"common",seconds:c}),children:(0,t.jsx)(B.default,{percentage:Math.round(c/60*100),className:"h-3 w-3"})}):null}),E=e=>{let{draftConfig:a,setDraftConfig:i,provider:r,model:s,configurationMethod:o,currentCustomConfigurationModelFixedFields:d,withSwitch:c=!1,className:p,modelCredential:f,onUpdate:x,onRemove:g}=e,{t:T}=(0,l.useTranslation)(),B=o===u.ConfigurationMethodEnum.predefinedModel,E=(0,S.useProviderContextSelector)(e=>e.modelLoadBalancingEnabled),I=(0,n.useCallback)((e,t)=>{i(n=>{if(!n)return n;let l=[...n.configs],a=t(l[e]);return a?l[e]=a:l.splice(e,1),{...n,configs:l}})},[i]),O=(0,n.useCallback)(e=>{i(t=>t?{...t,configs:[...t.configs,{credential_id:e.credential_id,enabled:!0,name:e.credential_name}]}:t)},[i]),R=(0,n.useCallback)(e=>{(E||!e)&&a&&i({...a,enabled:e})},[a,E,i]),A=(0,n.useCallback)((e,t)=>{I(e,e=>({...e,enabled:"boolean"==typeof t?t:!e.enabled}))},[I]),D=(0,n.useCallback)(e=>{I(e,e=>{let{ttl:t,...n}=e;return{...n,in_cooldown:!1}})},[I]),z=(0,n.useMemo)(()=>a?a.configs:[],[a]),L=(0,n.useCallback)((e,t)=>{x?.(e,t)},[x]),G=(0,n.useCallback)(e=>{let t=a?.configs.findIndex(t=>t.credential_id===e&&"__inherit__"!==t.name);t&&t>-1&&I(t,()=>void 0),g?.(e)},[a?.configs,I,g]);return a?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:(0,m.cn)("min-h-16 rounded-xl border bg-components-panel-bg transition-colors",c||!a.enabled?"border-components-panel-border":"border-util-colors-blue-blue-600",c||a.enabled?"cursor-default":"cursor-pointer",p),onClick:c||a.enabled?void 0:()=>R(!0),children:[(0,t.jsxs)("div",{className:"flex select-none items-center gap-2 px-[15px] py-3",children:[(0,t.jsx)("div",{className:"flex h-8 w-8 shrink-0 grow-0 items-center justify-center rounded-lg border border-util-colors-indigo-indigo-100 bg-util-colors-indigo-indigo-50 text-util-colors-blue-blue-600",children:(0,t.jsx)(_.Balance,{className:"h-4 w-4"})}),(0,t.jsxs)("div",{className:"grow",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1 text-sm text-text-primary",children:[T("modelProvider.loadBalancing",{ns:"common"}),(0,t.jsx)(C.default,{popupContent:T("modelProvider.loadBalancingInfo",{ns:"common"}),popupClassName:"max-w-[300px]",triggerClassName:"w-3 h-3"})]}),(0,t.jsx)("div",{className:"text-xs text-text-tertiary",children:T("modelProvider.loadBalancingDescription",{ns:"common"})})]}),c&&(0,t.jsx)(y.default,{defaultValue:!!a.enabled,size:"l",className:"ml-3 justify-self-end",disabled:!E&&!a.enabled,onChange:e=>R(e)})]}),a.enabled&&(0,t.jsxs)("div",{className:"flex flex-col gap-1 px-3 pb-3",children:[z.map((e,n)=>{let l="__inherit__"===e.name,a=f.available_credentials.find(t=>t.credential_id===e.credential_id);return(0,t.jsxs)("div",{className:"group flex h-10 items-center rounded-lg border border-components-panel-border bg-components-panel-on-panel-item-bg px-3 shadow-xs",children:[(0,t.jsxs)("div",{className:"flex grow items-center",children:[(0,t.jsx)("div",{className:"mr-2 flex h-3 w-3 items-center justify-center",children:e.in_cooldown&&e.ttl?(0,t.jsx)(F,{secondsRemaining:e.ttl,onFinish:()=>D(n)}):(0,t.jsx)(C.default,{popupContent:T("modelProvider.apiKeyStatusNormal",{ns:"common"}),children:(0,t.jsx)(P.default,{color:a?.not_allowed_to_use?"gray":"green"})})}),(0,t.jsx)("div",{className:"mr-1 text-[13px] text-text-secondary",children:l?T("modelProvider.defaultConfig",{ns:"common"}):e.name}),l&&B&&(0,t.jsx)(b.default,{className:"ml-2",children:T("modelProvider.providerManaged",{ns:"common"})}),a?.from_enterprise&&(0,t.jsx)(b.default,{className:"ml-2",children:"Enterprise"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[!l&&(0,t.jsx)(t.Fragment,{children:(0,t.jsx)("div",{className:"flex items-center gap-1 opacity-0 transition-opacity group-hover:opacity-100",children:(0,t.jsx)(C.default,{popupContent:T("operation.remove",{ns:"common"}),children:(0,t.jsx)("span",{className:"flex h-8 w-8 cursor-pointer items-center justify-center rounded-lg bg-components-button-secondary-bg text-text-tertiary transition-colors hover:bg-components-button-secondary-bg-hover",onClick:()=>I(n,()=>void 0),children:(0,t.jsx)(h.RiIndeterminateCircleLine,{className:"h-4 w-4"})})})})}),(e.credential_id||"__inherit__"===e.name)&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"mr-2 h-3 border-r border-r-divider-subtle"}),(0,t.jsx)(y.default,{defaultValue:!a?.not_allowed_to_use&&!!e.enabled,size:"md",className:"justify-self-end",onChange:e=>A(n,e),disabled:a?.not_allowed_to_use})]})]})]},e.id||n)}),(0,t.jsx)(M.default,{provider:r,model:s,configurationMethod:o,modelCredential:f,onSelectCredential:O,onUpdate:L,onRemove:G})]}),a.enabled&&z.length<2&&(0,t.jsxs)("div",{className:"flex h-[34px] items-center rounded-b-xl border-t border-t-divider-subtle bg-components-panel-bg px-6 text-xs text-text-secondary",children:[(0,t.jsx)(j.AlertTriangle,{className:"mr-1 h-3 w-3 text-[#f79009]"}),T("modelProvider.loadBalancingLeastKeyWarning",{ns:"common"})]})]}),!E&&!k.IS_CE_EDITION&&(0,t.jsx)(v.default,{canvasClassName:"!rounded-xl",children:(0,t.jsxs)("div",{className:"mt-2 flex h-14 items-center justify-between rounded-xl border-[0.5px] border-components-panel-border px-4 shadow-md",children:[(0,t.jsx)("div",{className:(0,m.cn)("text-gradient text-sm font-semibold leading-tight",N.default.textGradient),children:T("modelProvider.upgradeForLoadBalancing",{ns:"common"})}),(0,t.jsx)(w.default,{})]})})]}):null},I=(0,n.memo)(e=>{let{provider:h,configurateMethod:b,currentCustomConfigurationModelFixedFields:v,model:_,credential:j,open:y=!1,onClose:C,onSave:w}=e,{t:N}=(0,l.useTranslation)(),{notify:M}=(0,o.useToastContext)(),{doingAction:k,deleteModel:S,openConfirmDelete:P,closeConfirmDelete:T,handleConfirmDelete:B}=(0,f.useAuth)(h,b,v,{isModelCredential:!0}),[F,I]=(0,n.useState)(!1),O=b===u.ConfigurationMethodEnum.predefinedModel,R=O?"predefined-model":"custom-model",{isLoading:A,data:D,refetch:z}=(0,c.useGetModelCredential)(!0,h.provider,j?.credential_id,_.model,_.model_type,R),{load_balancing:L,current_credential_id:G,available_credentials:K,current_credential_name:U}=D??{},[H,V]=(0,n.useState)(),Z=(0,n.useMemo)(()=>L?L?.configs.reduce((e,t)=>(t.id&&(e[t.id]=t),e),{}):{},[L]);(0,n.useEffect)(()=>{L&&V(L)},[L]);let W=(0,n.useCallback)(e=>{H&&V({...H,enabled:e})},[H]),q=(0,n.useMemo)(()=>O?h?.provider_credential_schema?.credential_form_schemas?.filter(e=>{let{type:t}=e;return t===u.FormTypeEnum.secretInput})??[]:h?.model_credential_schema?.credential_form_schemas?.filter(e=>{let{type:t}=e;return t===u.FormTypeEnum.secretInput})??[],[h?.model_credential_schema?.credential_form_schemas,h?.provider_credential_schema?.credential_form_schemas,O]),Q=(0,n.useCallback)(e=>{let t={...e};return q.forEach(n=>{let{variable:l}=n;e.id&&t.credentials[l]===Z[e.id]?.credentials?.[l]&&(t.credentials[l]="[__HIDDEN__]")}),t},[q,Z]),{mutateAsync:J}=(0,c.useUpdateModelLoadBalancingConfig)(h.provider),X=(0,n.useMemo)(()=>{if(G)return{credential_id:G,credential_name:U}},[G,U]),[Y,$]=(0,n.useState)(X),{handleRefreshModel:ee}=(0,p.useRefreshModel)(),et=async()=>{try{I(!0);let e=await J({credential_id:Y?.credential_id||G,config_from:R,model:_.model,model_type:_.model_type,load_balancing:{...H,configs:H.configs.map(Q),enabled:!!H?.enabled}});"success"===e.result&&(M({type:"success",message:N("actionMsg.modifiedSuccessfully",{ns:"common"})}),ee(h,v,!1),w?.(h.provider),C?.())}finally{I(!1)}},en=(0,n.useCallback)(async()=>{await B(),C?.()},[B,C]),el=(0,n.useCallback)(async(e,t)=>{let n=await z(),l=n.data?.available_credentials||[],a=t?.__authorization_name__,i=e?.credential;if(!l.length)return void C?.();if(i)V(e=>{if(!e)return e;let t=[...e.configs],n=t.findIndex(e=>e.credential_id===i.credential_id&&"__inherit__"!==e.name),a=l.findIndex(e=>e.credential_id===i.credential_id);return a>-1&&n>-1&&(t[n].name=l[a].credential_name||""),{...e,configs:t}});else{let e=l.find(e=>e.credential_name===a);e&&V(t=>t?{...t,configs:[...t.configs,{credential_id:e.credential_id,enabled:!0,name:e.credential_name}]}:t)}},[z,j]),ea=(0,n.useCallback)(async()=>{let e=await z();(e.data?.available_credentials||[]).length||C?.()},[z,C]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.default,{isShow:!!_&&y,onClose:C,className:"w-[640px] max-w-none px-8 pt-8",title:(0,t.jsxs)("div",{className:"pb-3 font-semibold",children:[(0,t.jsx)("div",{className:"h-[30px]",children:H?.enabled?N("modelProvider.auth.configLoadBalancing",{ns:"common"}):N("modelProvider.auth.configModel",{ns:"common"})}),!!_&&(0,t.jsxs)("div",{className:"flex h-5 items-center",children:[(0,t.jsx)(x.default,{className:"mr-2 shrink-0",provider:h,modelName:_.model}),(0,t.jsx)(g.default,{className:"system-md-regular grow text-text-secondary",modelItem:_,showModelType:!0,showMode:!0,showContextSize:!0})]})]}),children:H?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"py-2",children:[(0,t.jsx)("div",{className:(0,m.cn)("min-h-16 rounded-xl border bg-components-panel-bg transition-colors",H.enabled?"cursor-pointer border-components-panel-border":"cursor-default border-util-colors-blue-blue-600"),onClick:H.enabled?()=>W(!1):void 0,children:(0,t.jsxs)("div",{className:"flex select-none items-center gap-2 px-[15px] py-3",children:[(0,t.jsx)("div",{className:"flex h-8 w-8 shrink-0 grow-0 items-center justify-center rounded-lg border border-components-card-border bg-components-card-bg",children:!!_&&(0,t.jsx)(x.default,{className:"shrink-0",provider:h,modelName:_.model})}),(0,t.jsxs)("div",{className:"grow",children:[(0,t.jsx)("div",{className:"text-sm text-text-secondary",children:O?N("modelProvider.auth.providerManaged",{ns:"common"}):N("modelProvider.auth.specifyModelCredential",{ns:"common"})}),(0,t.jsx)("div",{className:"text-xs text-text-tertiary",children:O?N("modelProvider.auth.providerManagedTip",{ns:"common"}):N("modelProvider.auth.specifyModelCredentialTip",{ns:"common"})})]}),!O&&(0,t.jsx)(d.default,{provider:h,customModelCredential:Y??X,setCustomModelCredential:$,model:_,credentials:K,onUpdate:ea,onRemove:ea})]})}),D&&(0,t.jsx)(E,{draftConfig:H,setDraftConfig:V,provider:h,currentCustomConfigurationModelFixedFields:{__model_name:_.model,__model_type:_.model_type},configurationMethod:_.fetch_from,className:"mt-2",modelCredential:D,onUpdate:el,onRemove:ea,model:{model:_.model,model_type:_.model_type}})]}),(0,t.jsxs)("div",{className:"mt-6 flex items-center justify-between gap-2",children:[(0,t.jsx)("div",{children:!O&&(0,t.jsx)(a.default,{onClick:()=>P(void 0,{model:_.model,model_type:_.model_type}),className:"text-components-button-destructive-secondary-text",children:N("modelProvider.auth.removeModel",{ns:"common"})})}),(0,t.jsxs)("div",{className:"space-x-2",children:[(0,t.jsx)(a.default,{onClick:C,children:N("operation.cancel",{ns:"common"})}),(0,t.jsx)(a.default,{variant:"primary",onClick:et,disabled:F||H?.enabled&&(H?.configs.filter(e=>e.enabled).length??0)<2||A,children:N("operation.save",{ns:"common"})})]})]})]}):(0,t.jsx)(r.default,{type:"area"})}),S&&(0,t.jsx)(i.default,{isShow:!0,title:N("modelProvider.confirmDelete",{ns:"common"}),onCancel:T,onConfirm:en,isDisabled:k})]})});e.s(["default",0,I],591324)},100550,e=>{e.n(e.i(591324))}]);
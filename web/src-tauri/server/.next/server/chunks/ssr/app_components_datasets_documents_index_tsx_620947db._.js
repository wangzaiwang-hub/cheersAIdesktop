module.exports=[402120,a=>{"use strict";var b=a.i(608061),c=a.i(533306),d=a.i(57843),e=a.i(105249),f=a.i(698636),g=a.i(375616),h=a.i(986431),i=a.i(820051),j=a.i(470759),k=a.i(425282),l=a.i(497746);a.i(752298);var m=a.i(693025),n=a.i(114715),o=a.i(585447),p=a.i(803506),q=a.i(820703);let r=d.forwardRef(function({title:a,titleId:b,...c},e){return d.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:e,"aria-labelledby":b},c),a?d.createElement("title",{id:b},a):null,d.createElement("path",{fillRule:"evenodd",d:"M12 3.75a.75.75 0 0 1 .75.75v6.75h6.75a.75.75 0 0 1 0 1.5h-6.75v6.75a.75.75 0 0 1-1.5 0v-6.75H4.5a.75.75 0 0 1 0-1.5h6.75V4.5a.75.75 0 0 1 .75-.75Z",clipRule:"evenodd"}))});var s=a.i(429150),t=a.i(909795),u=a.i(430901),v=a.i(816134),w=a.i(882012),x=a.i(757801),y=a.i(527344);let z={success:{Icon:s.RiCheckboxCircleFill,color:"text-text-success"},error:{Icon:s.RiErrorWarningFill,color:"text-text-destructive"},warning:{Icon:s.RiAlertFill,color:"text-text-warning-secondary"},info:{Icon:s.RiInformation2Fill,color:"text-text-accent"}},A=d.memo(({type:a="info",description:c,actionText:d,onAction:e,disabled:f})=>{let{Icon:g,color:h}=z[a];return(0,b.jsxs)("div",{className:"relative flex h-[34px] items-center rounded-lg border border-components-panel-border bg-components-panel-bg-blur pl-2 pr-3 shadow-xs",children:[(0,b.jsx)("div",{className:`absolute inset-0 rounded-lg opacity-40 ${"success"===a&&"bg-[linear-gradient(92deg,rgba(23,178,106,0.25)_0%,rgba(255,255,255,0.00)_100%)]"||"warning"===a&&"bg-[linear-gradient(92deg,rgba(247,144,9,0.25)_0%,rgba(255,255,255,0.00)_100%)]"||"error"===a&&"bg-[linear-gradient(92deg,rgba(240,68,56,0.25)_0%,rgba(255,255,255,0.00)_100%)]"||"info"===a&&"bg-[linear-gradient(92deg,rgba(11,165,236,0.25)_0%,rgba(255,255,255,0.00)_100%)]"}`}),(0,b.jsxs)("div",{className:"relative z-10 flex h-full items-center space-x-2",children:[(0,b.jsx)(g,{className:(0,y.cn)("h-4 w-4",h)}),(0,b.jsx)("div",{className:"text-[13px] font-normal text-text-secondary",children:c}),e&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(x.default,{type:"vertical",className:"!h-4"}),(0,b.jsx)("div",{onClick:e,className:(0,y.cn)("cursor-pointer text-[13px] font-semibold text-text-accent",f&&"cursor-not-allowed text-text-disabled"),children:d})]})]})]})}),B=d.memo(({datasetId:a})=>{let{t:c}=(0,m.useTranslation)(),{data:e,isLoading:f}=(0,i.useAutoDisabledDocuments)(a),g=(0,i.useInvalidDisabledDocument)(),h=e?.document_ids,j=h&&h.length>0,{mutateAsync:k}=(0,i.useDocumentEnable)(),l=(0,d.useCallback)(async()=>{await k({datasetId:a,documentIds:h}),g(),n.default.notify({type:"success",message:c("actionMsg.modifiedSuccessfully",{ns:"common"})})},[]);return!j||f?null:(0,b.jsx)(A,{type:"info",description:c("documentsDisabled",{ns:"dataset",num:h?.length}),actionText:c("enable",{ns:"dataset"}),onAction:l})});var C=a.i(111089),D=a.i(218257),E=a.i(847733);let F=(a,b)=>({...a,value:({retry:"retry",success:"success",error:"error"})[b.type]||a.value}),G=({datasetId:a})=>{let{t:c}=(0,m.useTranslation)(),[e,f]=(0,d.useReducer)(F,{value:"success"}),{data:g,isLoading:h,refetch:i}=(0,E.useDatasetErrorDocs)(a),j=async()=>{f({type:"retry"});let b=g?.data.map(a=>a.id)||[];"success"===(await (0,D.retryErrorDocs)({datasetId:a,document_ids:b})).result?(i(),f({type:"success"})):f({type:"error"})};return((0,d.useEffect)(()=>{g?.total===0?f({type:"success"}):f({type:"error"})},[g?.total]),h||"success"===e.value)?null:(0,b.jsx)(A,{type:"warning",description:`${g?.total} ${c("docsFailedNotice",{ns:"dataset"})}`,actionText:c("retry",{ns:"dataset"}),disabled:"retry"===e.value,onAction:"error"===e.value?j:C.noop})};var H=a.i(292458),I=a.i(42550),J=a.i(632789),K=a.i(940272),L=a.i(81492),M=a.i(483664),N=a.i(825319),O=a.i(834075);let P=d.memo(({open:a,setOpen:c,trigger:d,popupLeft:e=20,...f})=>(0,b.jsxs)(N.PortalToFollowElem,{open:a,onOpenChange:c,placement:"left-start",offset:{mainAxis:e,crossAxis:-38},children:[(0,b.jsx)(N.PortalToFollowElemTrigger,{onClick:()=>c(!a),children:d}),(0,b.jsx)(N.PortalToFollowElemContent,{className:"z-[1000]",children:(0,b.jsx)(O.default,{...f,onClose:()=>c(!1),onBack:()=>c(!1)})})]}));var Q=a.i(173958),R=a.i(412491);let S="metadata.datasetMetadata",T=({readonly:a,disabled:c,payload:e,onRename:f,onDelete:g})=>{let{t:h}=(0,m.useTranslation)(),i=(0,Q.getIcon)(e.type),j=(0,d.useCallback)(()=>{f?.()},[f]),k=(0,d.useRef)(null),n=(0,H.useHover)(k),[o,{setTrue:p,setFalse:q}]=(0,l.useBoolean)(!1),r=(0,d.useCallback)(()=>{q(),g?.()},[q,g]);return(0,b.jsx)("div",{className:(0,y.cn)(!a&&!c&&"group/item cursor-pointer hover:shadow-xs","rounded-md border border-components-panel-border-subtle bg-components-panel-on-panel-item-bg",n&&"border border-state-destructive-border bg-state-destructive-hover"),children:(0,b.jsxs)("div",{className:(0,y.cn)("flex h-8 items-center justify-between  px-2",c&&"opacity-30"),children:[(0,b.jsxs)("div",{className:"flex h-full items-center space-x-1 text-text-tertiary",children:[(0,b.jsx)(i,{className:"size-4 shrink-0"}),(0,b.jsx)("div",{className:"system-sm-medium max-w-[250px] truncate text-text-primary",children:e.name}),(0,b.jsx)("div",{className:"system-xs-regular shrink-0",children:e.type})]}),(!a||c)&&(0,b.jsx)("div",{className:"system-xs-regular ml-2 shrink-0 text-text-tertiary group-hover/item:hidden",children:c?h(`${S}.disabled`,{ns:"dataset"}):h(`${S}.values`,{ns:"dataset",num:e.count||0})}),(0,b.jsxs)("div",{className:"ml-2 hidden items-center space-x-1 text-text-tertiary group-hover/item:flex",children:[(0,b.jsx)(s.RiEditLine,{className:"size-4 cursor-pointer",onClick:j}),(0,b.jsx)("div",{ref:k,className:"hover:text-text-destructive",children:(0,b.jsx)(s.RiDeleteBinLine,{className:"size-4 cursor-pointer",onClick:p})})]}),o&&(0,b.jsx)(I.default,{isShow:!0,type:"warning",title:h("metadata.datasetMetadata.deleteTitle",{ns:"dataset"}),content:h("metadata.datasetMetadata.deleteContent",{ns:"dataset",name:e.name}),onConfirm:r,onCancel:q})]})},e.name)},U=d.memo(({userMetadata:a,builtInMetadata:c,isBuiltInEnabled:e,onIsBuiltInEnabledChange:f,onClose:g,onAdd:h,onRename:i,onRemove:j})=>{let{t:k}=(0,m.useTranslation)(),[l,o]=(0,d.useState)(!1),[p,q]=(0,d.useState)(null),[r,u]=(0,d.useState)(""),w=(0,d.useCallback)(a=>()=>{q(a),u(a.name),o(!0)},[q,o]),[x,y]=(0,d.useState)(!1),z=(0,d.useCallback)(async a=>{await h(a),n.default.notify({type:"success",message:k("api.actionSuccess",{ns:"common"})}),y(!1)},[h,k]),A=(0,d.useCallback)(async()=>{let b=a.find(a=>a.id===p?.id);b&&(await i({...b,name:r}),n.default.notify({type:"success",message:k("api.actionSuccess",{ns:"common"})})),o(!1)},[a,p?.id,i,r,k]),B=(0,d.useCallback)(a=>async()=>{await j(a.id),n.default.notify({type:"success",message:k("api.actionSuccess",{ns:"common"})})},[j,k]);return(0,b.jsx)(J.default,{isOpen:!0,onClose:g,showClose:!0,title:k("metadata.metadata",{ns:"dataset"}),footer:null,panelClassName:"px-4 block !max-w-[420px] my-2 rounded-l-2xl",children:(0,b.jsxs)("div",{className:"h-full overflow-y-auto",children:[(0,b.jsx)("div",{className:"system-sm-regular text-text-tertiary",children:k(`${S}.description`,{ns:"dataset"})}),(0,b.jsx)(P,{open:x,setOpen:y,trigger:(0,b.jsxs)(t.default,{variant:"primary",className:"mt-3",children:[(0,b.jsx)(s.RiAddLine,{className:"mr-1"}),k(`${S}.addMetaData`,{ns:"dataset"})]}),hasBack:!0,onSave:z}),(0,b.jsx)("div",{className:"mt-3 space-y-1",children:a.map(a=>(0,b.jsx)(T,{payload:a,onRename:w(a),onDelete:B(a)},a.id))}),(0,b.jsxs)("div",{className:"mt-3 flex h-6 items-center",children:[(0,b.jsx)(L.default,{defaultValue:e,onChange:f}),(0,b.jsx)("div",{className:"system-sm-semibold ml-2 mr-0.5 text-text-secondary",children:k(`${S}.builtIn`,{ns:"dataset"})}),(0,b.jsx)(M.default,{popupContent:(0,b.jsx)("div",{className:"max-w-[100px]",children:k(`${S}.builtInDescription`,{ns:"dataset"})})})]}),(0,b.jsx)("div",{className:"mt-1 space-y-1",children:c.map(a=>(0,b.jsx)(T,{readonly:!0,disabled:!e,payload:a},a.name))}),l&&(0,b.jsxs)(K.default,{isShow:!0,title:k(`${S}.rename`,{ns:"dataset"}),onClose:()=>o(!1),children:[(0,b.jsx)(R.default,{label:k(`${S}.name`,{ns:"dataset"}),className:"mt-4",children:(0,b.jsx)(v.default,{value:r,onChange:a=>u(a.target.value),placeholder:k(`${S}.namePlaceholder`,{ns:"dataset"})})}),(0,b.jsxs)("div",{className:"mt-4 flex justify-end",children:[(0,b.jsx)(t.default,{className:"mr-2",onClick:()=>{o(!1),u(p.name)},children:k("operation.cancel",{ns:"common"})}),(0,b.jsx)(t.default,{onClick:A,variant:"primary",disabled:!r,children:k("operation.save",{ns:"common"})})]})]})]})})});var V=a.i(252813),W=a.i(677658);let X=({datasetId:a,dataSourceType:c,embeddingAvailable:e,isFreePlan:f,statusFilterValue:g,sortValue:i,inputValue:j,onStatusFilterChange:k,onStatusFilterClear:l,onSortChange:n,onInputChange:o,isShowEditMetadataModal:p,showEditMetadataModal:q,hideEditMetadataModal:x,datasetMetaData:y,builtInMetaData:z,builtInEnabled:C,onAddMetaData:D,onRenameMetaData:E,onDeleteMetaData:F,onBuiltInEnabledChange:H,onAddDocument:I})=>{let{t:J}=(0,m.useTranslation)(),K=(0,V.useDocLink)(),L=(0,W.useIndexStatus)(),M=c===h.DataSourceType.NOTION,N=c===h.DataSourceType.WEB,O=(0,d.useMemo)(()=>[{value:"all",name:J("list.index.all",{ns:"datasetDocuments"})},{value:"queuing",name:L.queuing.text},{value:"indexing",name:L.indexing.text},{value:"paused",name:L.paused.text},{value:"error",name:L.error.text},{value:"available",name:L.available.text},{value:"enabled",name:L.enabled.text},{value:"disabled",name:L.disabled.text},{value:"archived",name:L.archived.text}],[L,J]),P=(0,d.useMemo)(()=>[{value:"created_at",name:J("list.sort.uploadTime",{ns:"datasetDocuments"})},{value:"hit_count",name:J("list.sort.hitCount",{ns:"datasetDocuments"})}],[J]),Q=(0,d.useMemo)(()=>M?J("list.addPages",{ns:"datasetDocuments"}):N?J("list.addUrl",{ns:"datasetDocuments"}):J("list.addFile",{ns:"datasetDocuments"}),[M,N,J]);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"flex flex-col justify-center gap-1 px-6 pt-4",children:[(0,b.jsx)("h1",{className:"text-base font-semibold text-text-primary",children:J("list.title",{ns:"datasetDocuments"})}),(0,b.jsxs)("div",{className:"flex items-center space-x-0.5 text-sm font-normal text-text-tertiary",children:[(0,b.jsx)("span",{children:J("list.desc",{ns:"datasetDocuments"})}),(0,b.jsxs)("a",{className:"flex items-center text-text-accent",target:"_blank",rel:"noopener noreferrer",href:K("/use-dify/knowledge/integrate-knowledge-within-application"),children:[(0,b.jsx)("span",{children:J("list.learnMore",{ns:"datasetDocuments"})}),(0,b.jsx)(s.RiExternalLinkLine,{className:"h-3 w-3"})]})]})]}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center justify-between px-6 pt-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(u.default,{className:"w-[160px]",showLeftIcon:!1,value:g,items:O,onSelect:a=>k(a?.value?String(a.value):""),onClear:l}),(0,b.jsx)(v.default,{showLeftIcon:!0,showClearIcon:!0,wrapperClassName:"!w-[200px]",value:j,onChange:a=>o(a.target.value),onClear:()=>o("")}),(0,b.jsx)("div",{className:"h-3.5 w-px bg-divider-regular"}),(0,b.jsx)(w.default,{order:i.startsWith("-")?"-":"",value:i.replace("-",""),items:P,onSelect:a=>n(String(a))})]}),(0,b.jsxs)("div",{className:"flex !h-8 items-center justify-center gap-2",children:[!f&&(0,b.jsx)(B,{datasetId:a}),(0,b.jsx)(G,{datasetId:a}),!e&&(0,b.jsx)(A,{type:"warning",description:J("embeddingModelNotAvailable",{ns:"dataset"})}),e&&(0,b.jsxs)(t.default,{variant:"secondary",className:"shrink-0",onClick:q,children:[(0,b.jsx)(s.RiDraftLine,{className:"mr-1 size-4"}),J("metadata.metadata",{ns:"dataset"})]}),p&&(0,b.jsx)(U,{userMetadata:y??[],onClose:x,onAdd:D,onRename:E,onRemove:F,builtInMetadata:z??[],isBuiltInEnabled:C,onIsBuiltInEnabledChange:H}),e&&(0,b.jsxs)(t.default,{variant:"primary",onClick:I,className:"shrink-0",children:[(0,b.jsx)(r,{className:"mr-2 h-4 w-4 stroke-current"}),Q]})]})]})]})};var Y=a.i(301034);let Z=({className:a})=>(0,b.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:a??"",children:(0,b.jsx)("path",{d:"M10.8332 5.83333L9.90355 3.9741C9.63601 3.439 9.50222 3.17144 9.30265 2.97597C9.12615 2.80311 8.91344 2.67164 8.6799 2.59109C8.41581 2.5 8.11668 2.5 7.51841 2.5H4.33317C3.39975 2.5 2.93304 2.5 2.57652 2.68166C2.26292 2.84144 2.00795 3.09641 1.84816 3.41002C1.6665 3.76654 1.6665 4.23325 1.6665 5.16667V5.83333M1.6665 5.83333H14.3332C15.7333 5.83333 16.4334 5.83333 16.9681 6.10582C17.4386 6.3455 17.821 6.72795 18.0607 7.19836C18.3332 7.73314 18.3332 8.4332 18.3332 9.83333V13.5C18.3332 14.9001 18.3332 15.6002 18.0607 16.135C17.821 16.6054 17.4386 16.9878 16.9681 17.2275C16.4334 17.5 15.7333 17.5 14.3332 17.5H5.6665C4.26637 17.5 3.56631 17.5 3.03153 17.2275C2.56112 16.9878 2.17867 16.6054 1.93899 16.135C1.6665 15.6002 1.6665 14.9001 1.6665 13.5V5.83333ZM9.99984 14.1667V9.16667M7.49984 11.6667H12.4998",stroke:"#667085",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),$=({className:a})=>(0,b.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:a??"",children:(0,b.jsx)("path",{d:"M5 6.5V5M8.93934 7.56066L10 6.5M10.0103 11.5H11.5103",stroke:"#374151",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),_=({className:a})=>(0,b.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:a??"",children:[(0,b.jsxs)("g",{clipPath:"url(#clip0_2164_11263)",children:[(0,b.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.5725 18.2611L1.4229 15.5832C0.905706 14.9389 0.625 14.1466 0.625 13.3312V3.63437C0.625 2.4129 1.60224 1.39936 2.86295 1.31328L12.8326 0.632614C13.5569 0.583164 14.2768 0.775682 14.8717 1.17794L18.3745 3.5462C19.0015 3.97012 19.375 4.66312 19.375 5.40266V16.427C19.375 17.6223 18.4141 18.6121 17.1798 18.688L6.11458 19.3692C5.12958 19.4298 4.17749 19.0148 3.5725 18.2611Z",fill:"white"}),(0,b.jsx)("path",{d:"M7.03006 8.48669V8.35974C7.03006 8.03794 7.28779 7.77104 7.61997 7.74886L10.0396 7.58733L13.3857 12.5147V8.19009L12.5244 8.07528V8.01498C12.5244 7.68939 12.788 7.42074 13.1244 7.4035L15.326 7.29073V7.60755C15.326 7.75628 15.2154 7.88349 15.0638 7.90913L14.534 7.99874V15.0023L13.8691 15.231C13.3136 15.422 12.6952 15.2175 12.3772 14.7377L9.12879 9.83574V14.5144L10.1287 14.7057L10.1147 14.7985C10.0711 15.089 9.82028 15.3087 9.51687 15.3222L7.03006 15.4329C6.99718 15.1205 7.23132 14.841 7.55431 14.807L7.88143 14.7727V8.53453L7.03006 8.48669Z",fill:"black"}),(0,b.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12.9218 1.85424L2.95217 2.53491C2.35499 2.57568 1.89209 3.05578 1.89209 3.63437V13.3312C1.89209 13.8748 2.07923 14.403 2.42402 14.8325L4.57362 17.5104C4.92117 17.9434 5.46812 18.1818 6.03397 18.147L17.0991 17.4658C17.6663 17.4309 18.1078 16.9762 18.1078 16.427V5.40266C18.1078 5.06287 17.9362 4.74447 17.6481 4.54969L14.1453 2.18143C13.7883 1.94008 13.3564 1.82457 12.9218 1.85424ZM3.44654 3.78562C3.30788 3.68296 3.37387 3.46909 3.54806 3.4566L12.9889 2.77944C13.2897 2.75787 13.5886 2.8407 13.8318 3.01305L15.7261 4.35508C15.798 4.40603 15.7642 4.51602 15.6752 4.52086L5.67742 5.0646C5.37485 5.08106 5.0762 4.99217 4.83563 4.81406L3.44654 3.78562ZM5.20848 6.76919C5.20848 6.4444 5.47088 6.1761 5.80642 6.15783L16.3769 5.58216C16.7039 5.56435 16.9792 5.81583 16.9792 6.13239V15.6783C16.9792 16.0025 16.7177 16.2705 16.3829 16.2896L5.8793 16.8872C5.51537 16.9079 5.20848 16.6283 5.20848 16.2759V6.76919Z",fill:"black"})]}),(0,b.jsx)("defs",{children:(0,b.jsx)("clipPath",{id:"clip0_2164_11263",children:(0,b.jsx)("rect",{width:"20",height:"20",fill:"white"})})})]}),aa=({canAdd:a=!0,onClick:c,type:d="upload"})=>{let{t:e}=(0,m.useTranslation)();return(0,b.jsx)("div",{className:Y.default.emptyWrapper,children:(0,b.jsxs)("div",{className:Y.default.emptyElement,children:[(0,b.jsx)("div",{className:Y.default.emptySymbolIconWrapper,children:"upload"===d?(0,b.jsx)(Z,{}):(0,b.jsx)(_,{})}),(0,b.jsxs)("span",{className:Y.default.emptyTitle,children:[e("list.empty.title",{ns:"datasetDocuments"}),(0,b.jsx)($,{className:"relative -left-1.5 -top-3 inline"})]}),(0,b.jsx)("div",{className:Y.default.emptyTip,children:e(`list.empty.${d}.tip`,{ns:"datasetDocuments"})}),"upload"===d&&a&&(0,b.jsxs)(t.default,{onClick:c,className:Y.default.addFileBtn,variant:"secondary-accent",children:[(0,b.jsx)(r,{className:Y.default.plusIcon}),e("list.addFile",{ns:"datasetDocuments"})]})]})})};var ab=a.i(562168),ac=a.i(168799),ad=a.i(780442),ae=a.i(965442),af=a.i(796499),ag=a.i(218865);a.i(224256);var ah=a.i(463561),ai=a.i(12588);let aj=d.memo(({isGeneralMode:a,isQAMode:c})=>{let{t:d}=(0,m.useTranslation)(),e=a?ah.GeneralChunk:ai.ParentChildChunk;return(0,b.jsx)(ag.default,{children:(0,b.jsxs)("div",{className:"flex h-full items-center space-x-0.5 text-text-tertiary",children:[(0,b.jsx)(e,{className:"h-3 w-3"}),(0,b.jsx)("span",{className:"system-2xs-medium-uppercase",children:a?`${d("chunkingMode.general",{ns:"dataset"})}${c?" Â· QA":""}`:d("chunkingMode.parentChild",{ns:"dataset"})})]})})});var ak=a.i(869758),al=a.i(155467),am=a.i(494261),an=a.i(127349),ao=a.i(220809),ap=a.i(625963);let aq=d.memo(({isDeleted:a,className:c,text:d})=>(0,b.jsx)("div",{className:(0,y.cn)("system-xs-medium w-[136px] shrink-0 truncate text-text-tertiary",a&&"text-text-quaternary line-through",c),children:d})),ar=d.memo(({className:a,payload:c,onChange:d,onRemove:e})=>(0,b.jsxs)("div",{className:(0,y.cn)("flex h-6 items-center space-x-0.5",a),children:[(0,b.jsx)(aq,{text:c.name}),(0,b.jsx)(ap.default,{type:c.type,value:c.value,onChange:a=>d({...c,value:a})}),(0,b.jsx)("div",{className:(0,y.cn)("cursor-pointer rounded-md p-1 text-text-tertiary hover:bg-state-destructive-hover hover:text-text-destructive"),onClick:e,children:(0,b.jsx)(s.RiIndeterminateCircleLine,{className:"size-4"})})]})),as=d.memo(({onReset:a})=>{let{t:c}=(0,m.useTranslation)(),e=(0,d.useRef)(null),f=(0,H.useHover)(e);return(0,b.jsx)("div",{ref:e,className:"size-4 cursor-pointer",children:f?(0,b.jsx)(M.default,{popupContent:c("operation.reset",{ns:"common"}),children:(0,b.jsx)("div",{className:"flex size-4 items-center justify-center rounded-full bg-text-accent-secondary",onClick:a,children:(0,b.jsx)(s.RiResetLeftLine,{className:"size-[10px] text-text-primary-on-surface"})})}):(0,b.jsx)("div",{className:"flex size-4 items-center justify-center",children:(0,b.jsx)("div",{className:"size-1 rounded-full bg-text-accent-secondary"})})})}),at=d.memo(({onClear:a,readOnly:c})=>{let{t:d}=(0,m.useTranslation)();return(0,b.jsx)("div",{className:"h-6 grow rounded-md bg-components-input-bg-normal p-0.5 text-[0]",children:(0,b.jsxs)("div",{className:(0,y.cn)("inline-flex h-5 items-center space-x-0.5 rounded-[5px] border-[0.5px] border-components-panel-border bg-components-badge-white-to-dark pl-1.5 pr-0.5 shadow-xs",c&&"pr-1.5"),children:[(0,b.jsx)("div",{className:"system-xs-regular text-text-secondary",children:d("metadata.batchEditMetadata.multipleValue",{ns:"dataset"})}),!c&&(0,b.jsx)("div",{className:"cursor-pointer rounded-[4px] p-px text-text-tertiary hover:bg-state-base-hover hover:text-text-secondary",children:(0,b.jsx)(s.RiCloseLine,{className:"size-3.5 ",onClick:a})})]})})}),au=d.memo(({payload:a,onChange:c,onRemove:d,onReset:e})=>{let f=a.isUpdated,g=a.updateType===p.UpdateType.delete;return(0,b.jsxs)("div",{className:"flex h-6 items-center space-x-0.5",children:[f?(0,b.jsx)(as,{onReset:()=>e(a.id)}):(0,b.jsx)("div",{className:"size-4 shrink-0"}),(0,b.jsx)(aq,{text:a.name,isDeleted:g}),a.isMultipleValue?(0,b.jsx)(at,{onClear:()=>c({...a,value:null,isMultipleValue:!1}),readOnly:g}):(0,b.jsx)(ap.default,{type:a.type,value:a.value,onChange:b=>c({...a,value:b}),readOnly:g}),(0,b.jsx)("div",{className:(0,y.cn)("cursor-pointer rounded-md p-1 text-text-tertiary hover:bg-state-destructive-hover hover:text-text-destructive",g&&"cursor-default bg-state-destructive-hover  text-text-destructive"),onClick:()=>d(a.id),children:(0,b.jsx)(s.RiDeleteBinLine,{className:"size-4"})})]})}),av="metadata.batchEditMetadata",aw=d.memo(({datasetId:a,documentNum:c,list:e,onSave:f,onHide:g,onShowManage:h})=>{let{t:i}=(0,m.useTranslation)(),[j,k]=(0,d.useState)(e),l=(0,d.useCallback)(a=>{k((0,am.produce)(j,b=>{let c=b.findIndex(b=>b.id===a.id);-1!==c&&(b[c]=a,b[c].isUpdated=!0,b[c].updateType=p.UpdateType.changeValue)}))},[j]),r=(0,d.useCallback)(a=>{k((0,am.produce)(j,b=>{let c=b.findIndex(b=>b.id===a);-1!==c&&(b[c].isUpdated=!0,b[c].updateType=p.UpdateType.delete)}))},[j]),u=(0,d.useCallback)(a=>{k((0,am.produce)(j,b=>{let c=b.findIndex(b=>b.id===a);-1!==c&&(b[c]={...e[c]},b[c].isUpdated=!1,delete b[c].updateType)}))},[e,j]),{checkName:v}=(0,q.default)(),{mutate:w}=(0,o.useCreateMetaData)(a),y=(0,d.useCallback)(async a=>{let b=v(a.name).errorMsg;if(b)return n.default.notify({message:b,type:"error"}),Promise.reject(Error(b));await w(a),n.default.notify({type:"success",message:i("api.actionSuccess",{ns:"common"})})},[v,w,i]),[z,A]=(0,d.useState)([]),B=(0,d.useCallback)(a=>{A(z.map(b=>b.id===a.id?a:b))},[z]),C=(0,d.useCallback)(a=>()=>{A(z.filter((b,c)=>c!==a))},[z]),[D,E]=(0,d.useState)(!1),F=(0,d.useCallback)(()=>{f(j.filter(a=>a.updateType!==p.UpdateType.delete),z,D)},[j,z,D,f]);return(0,b.jsxs)(K.default,{title:i(`${av}.editMetadata`,{ns:"dataset"}),isShow:!0,closable:!0,onClose:g,className:"!max-w-[640px]",children:[(0,b.jsx)("div",{className:"system-xs-medium mt-1 text-text-accent",children:i(`${av}.editDocumentsNum`,{ns:"dataset",num:c})}),(0,b.jsxs)("div",{className:"max-h-[305px] overflow-y-auto overflow-x-hidden",children:[(0,b.jsx)("div",{className:"mt-4 space-y-2",children:j.map(a=>(0,b.jsx)(au,{payload:a,onChange:l,onRemove:r,onReset:u},a.id))}),(0,b.jsxs)("div",{className:"mt-4 pl-[18px]",children:[(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)("div",{className:"system-xs-medium-uppercase mr-2 shrink-0 text-text-tertiary",children:i("metadata.createMetadata.title",{ns:"dataset"})}),(0,b.jsx)(x.default,{bgStyle:"gradient"})]}),(0,b.jsx)("div",{className:"mt-2 space-y-2",children:z.map((a,c)=>(0,b.jsx)(ar,{payload:a,onChange:B,onRemove:C(c)},c))}),(0,b.jsx)("div",{className:"mt-3",children:(0,b.jsx)(ao.default,{datasetId:a,popupPlacement:"top-start",popupOffset:{mainAxis:4,crossAxis:0},trigger:(0,b.jsx)(an.default,{}),onSave:y,onSelect:a=>A([...z,a]),onManage:h})})]})]}),(0,b.jsxs)("div",{className:"mt-4 flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex select-none items-center",children:[(0,b.jsx)(ac.default,{checked:D,onCheck:()=>E(!D)}),(0,b.jsx)("div",{className:"system-xs-medium ml-2 mr-1 text-text-secondary",children:i(`${av}.applyToAllSelectDocument`,{ns:"dataset"})}),(0,b.jsx)(M.default,{popupContent:(0,b.jsx)("div",{className:"max-w-[240px]",children:i(`${av}.applyToAllSelectDocumentTip`,{ns:"dataset"})}),children:(0,b.jsx)("div",{className:"cursor-pointer p-px",children:(0,b.jsx)(s.RiQuestionLine,{className:"size-3.5 text-text-tertiary"})})})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(t.default,{onClick:g,children:i("operation.cancel",{ns:"common"})}),(0,b.jsx)(t.default,{onClick:F,variant:"primary",children:i("operation.save",{ns:"common"})})]})]})]})});var ax=a.i(934402),ay=a.i(98654),az=a.i(827460),aA=a.i(459858),aB=a.i(760327),aC=a.i(573912),aD=a.i(301128),aE=a.i(850959);let aF=(0,d.memo)(({status:a})=>{let{t:c}=(0,m.useTranslation)(),e=(0,d.useMemo)(()=>"SUMMARIZING"===a?c("list.summary.generatingSummary",{ns:"datasetDocuments"}):"",[a,c]);return(0,b.jsx)(M.default,{popupContent:e,children:"SUMMARIZING"===a&&(0,b.jsxs)(ag.default,{className:"border-text-accent-secondary text-text-accent-secondary",children:[(0,b.jsx)(aE.SearchLinesSparkle,{className:"mr-0.5 h-3 w-3"}),(0,b.jsx)("span",{children:c("list.summary.generating",{ns:"datasetDocuments"})})]})})});var aG=a.i(322927),aH=a.i(380794),aI=a.i(889493);let aJ=a=>a?a<1e3?a:`${(0,aC.formatNumber)((a/1e3).toFixed(1))}k`:((a,c=!1)=>(0,b.jsx)("div",{className:(0,y.cn)(c?"text-text-tertiary":"text-text-secondary",Y.default.tdValue),children:0}))(0,!0),aK=({embeddingAvailable:a,documents:e=[],selectedIds:g,onSelectedIdChange:j,datasetId:k,pagination:q,onUpdate:r,onManageMetadata:t,statusFilterValue:u,remoteSortValue:v})=>{let{t:w}=(0,m.useTranslation)(),{formatTime:x}=(0,ay.default)(),z=(0,c.useRouter)(),A=(0,f.useDatasetDetailContextWithSelector)(a=>a.dataset),B=A?.doc_form,C=B!==h.ChunkingMode.parentChild,D=B===h.ChunkingMode.qa,[E,F]=(0,d.useState)(null),[G,H]=(0,d.useState)("desc");(0,d.useEffect)(()=>{F(null),H("desc")},[v]);let{isShowEditModal:I,showEditModal:J,hideEditModal:K,originalList:L,handleSave:N}=(({datasetId:a,docList:b,selectedDocumentIds:c,onUpdate:e})=>{let f,[g,{setTrue:h,setFalse:i}]=(0,l.useBoolean)(!1),j=(f=[],b.forEach(a=>{a.doc_metadata?f.push(a.doc_metadata.filter(a=>"built-in"!==a.id)):f.push([])}),f),k=(0,d.useMemo)(()=>{let a={},b=[];return j.forEach(c=>{c.forEach(c=>{if(a[c.id]?.isMultipleValue)return;let d=b.find(a=>a.id===c.id);if(a[c.id]||(a[c.id]={value:c.value,isMultipleValue:!1}),d&&d.value!==c.value){a[c.id].isMultipleValue=!0,d.isMultipleValue=!0,d.value=null;return}d||b.push({...c,isMultipleValue:!1})})}),b},[j]),{mutateAsync:m}=(0,o.useBatchUpdateDocMetadata)(),q=async(d,f,g)=>{let h,l,o=(h=d.filter(a=>a.updateType===p.UpdateType.changeValue),l=k.filter(a=>!d.find(b=>b.id===a.id)),(c||b.map(a=>a.id)).map(a=>{let c=b.findIndex(b=>b.id===a),d=[...c>=0?j[c]:[],...f].filter(a=>!l.find(b=>b.id===a.id)).map(a=>({id:a.id,name:a.name,type:a.type,value:a.value}));return g&&h.forEach(a=>{d.find(b=>b.id===a.id)||a.isMultipleValue||d.push(a)}),{document_id:a,metadata_list:d=d.map(a=>{let b=h.find(b=>b.id===a.id);return b||a}),partial_update:c<0}}));await m({dataset_id:a,metadata_list:o}),e(),i(),n.default.notify({type:"success",message:(0,ax.t)("actionMsg.modifiedSuccessfully",{ns:"common"})})};return{isShowEditModal:g,showEditModal:h,hideEditModal:i,originalList:k,handleSave:q}})({datasetId:k,docList:e.filter(a=>g.includes(a.id)),selectedDocumentIds:g,onUpdate:r}),O=(0,d.useMemo)(()=>{let a=e;return(u&&"all"!==u&&(a=a.filter(a=>"string"==typeof a.display_status&&(0,ak.normalizeStatusForQuery)(a.display_status)===u)),E)?[...a].sort((a,b)=>{let c,d;switch(E){case"name":c=a.name?.toLowerCase()||"",d=b.name?.toLowerCase()||"";break;case"word_count":c=a.word_count||0,d=b.word_count||0;break;case"hit_count":c=a.hit_count||0,d=b.hit_count||0;break;case"created_at":c=a.created_at,d=b.created_at;break;default:return 0}if("name"===E){let a=c.localeCompare(d);return"asc"===G?a:-a}{let a=c-d;return"asc"===G?a:-a}}):a},[e,E,G,u]),P=(a,c)=>{let d=E===a,e=d&&"desc"===G;return(0,b.jsxs)("div",{className:"flex cursor-pointer items-center hover:text-text-secondary",onClick:()=>{E===a?H("asc"===G?"desc":"asc"):(F(a),H("desc"))},children:[c,(0,b.jsx)(s.RiArrowDownLine,{className:(0,y.cn)("ml-0.5 h-3 w-3 transition-all",d?"text-text-tertiary":"text-text-disabled",d&&!e?"rotate-180":"")})]})},[Q,R]=(0,d.useState)(null),[S,{setTrue:T,setFalse:U}]=(0,l.useBoolean)(!1),V=(0,d.useCallback)(a=>{R(a),T()},[T]),W=(0,d.useCallback)(()=>{r()},[r]),X=(0,d.useMemo)(()=>O.length>0&&O.every(a=>g.includes(a.id)),[O,g]),Z=(0,d.useMemo)(()=>O.some(a=>g.includes(a.id)),[O,g]),$=(0,d.useCallback)(()=>{X?j([]):j((0,ab.uniq)([...g,...O.map(a=>a.id)]))},[X,O,j,g]),{mutateAsync:_}=(0,i.useDocumentArchive)(),{mutateAsync:aa}=(0,i.useDocumentSummary)(),{mutateAsync:ag}=(0,i.useDocumentEnable)(),{mutateAsync:ah}=(0,i.useDocumentDisable)(),{mutateAsync:ai}=(0,i.useDocumentDelete)(),{mutateAsync:am}=(0,i.useDocumentBatchRetryIndex)(),{mutateAsync:an,isPending:ao}=(0,i.useDocumentDownloadZip)(),ap=a=>async()=>{let b;switch(a){case h.DocumentActionType.archive:b=_;break;case h.DocumentActionType.summary:b=aa;break;case h.DocumentActionType.enable:b=ag;break;case h.DocumentActionType.disable:b=ah;break;default:b=ai}let[c]=await (0,aA.asyncRunSafe)(b({datasetId:k,documentIds:g}));c?n.default.notify({type:"error",message:w("actionMsg.modifiedUnsuccessfully",{ns:"common"})}):(a===h.DocumentActionType.delete&&j([]),n.default.notify({type:"success",message:w("actionMsg.modifiedSuccessfully",{ns:"common"})}),r())},aq=async()=>{let[a]=await (0,aA.asyncRunSafe)(am({datasetId:k,documentIds:g}));a?n.default.notify({type:"error",message:w("actionMsg.modifiedUnsuccessfully",{ns:"common"})}):(j([]),n.default.notify({type:"success",message:w("actionMsg.modifiedSuccessfully",{ns:"common"})}),r())},ar=(0,d.useMemo)(()=>O.some(a=>g.includes(a.id)&&"error"===a.display_status),[O,g]),as=(0,d.useCallback)(a=>{if(!a)return"";let b=a.split(".");return b.length<=1||""===b[0]&&2===b.length?"":b[b.length-1].toLowerCase()},[]),at=(0,d.useCallback)(a=>"rag-pipeline"===a,[]),au=(0,d.useCallback)(a=>a===az.DatasourceType.localFile||a===h.DataSourceType.FILE,[]),av=(0,d.useCallback)(a=>a===az.DatasourceType.onlineDocument||a===h.DataSourceType.NOTION,[]),aC=(0,d.useCallback)(a=>a===az.DatasourceType.websiteCrawl||a===h.DataSourceType.WEB,[]),aE=(0,d.useCallback)(a=>a===az.DatasourceType.onlineDrive,[]),aK=(0,d.useMemo)(()=>{let a=new Set(g);return O.filter(b=>a.has(b.id)&&b.data_source_type===h.DataSourceType.FILE).map(a=>a.id)},[O,g]),aL=(0,d.useCallback)(()=>{let a="u">typeof crypto&&"function"==typeof crypto.randomUUID?crypto.randomUUID():`${Date.now().toString(36)}${Math.random().toString(36).slice(2,10)}`;return`${a}-docs.zip`},[]),aM=(0,d.useCallback)(async()=>{if(ao)return;let[a,b]=await (0,aA.asyncRunSafe)(an({datasetId:k,documentIds:aK}));a||!b?n.default.notify({type:"error",message:w("actionMsg.downloadUnsuccessfully",{ns:"common"})}):(0,aB.downloadBlob)({data:b,fileName:aL()})},[k,aK,aL,ao,an,w]);return(0,b.jsxs)("div",{className:"relative mt-3 flex h-full w-full flex-col",children:[(0,b.jsx)("div",{className:"relative h-0 grow overflow-x-auto",children:(0,b.jsxs)("table",{className:`w-full min-w-[700px] max-w-full border-collapse border-0 text-sm ${Y.default.documentTable}`,children:[(0,b.jsx)("thead",{className:"h-8 border-b border-divider-subtle text-xs font-medium uppercase leading-8 text-text-tertiary",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{className:"w-12",children:(0,b.jsxs)("div",{className:"flex items-center",onClick:a=>a.stopPropagation(),children:[a&&(0,b.jsx)(ac.default,{className:"mr-2 shrink-0",checked:X,indeterminate:!X&&Z,onCheck:$}),"#"]})}),(0,b.jsx)("td",{children:P("name",w("list.table.header.fileName",{ns:"datasetDocuments"}))}),(0,b.jsx)("td",{className:"w-[130px]",children:w("list.table.header.chunkingMode",{ns:"datasetDocuments"})}),(0,b.jsx)("td",{className:"w-24",children:P("word_count",w("list.table.header.words",{ns:"datasetDocuments"}))}),(0,b.jsx)("td",{className:"w-44",children:P("hit_count",w("list.table.header.hitCount",{ns:"datasetDocuments"}))}),(0,b.jsx)("td",{className:"w-44",children:P("created_at",w("list.table.header.uploadTime",{ns:"datasetDocuments"}))}),(0,b.jsx)("td",{className:"w-40",children:w("list.table.header.status",{ns:"datasetDocuments"})}),(0,b.jsx)("td",{className:"w-20",children:w("list.table.header.action",{ns:"datasetDocuments"})})]})}),(0,b.jsx)("tbody",{className:"text-text-secondary",children:O.map((c,d)=>{let e=au(c.data_source_type)?c.data_source_detail_dict?.upload_file?.extension:"";return(0,b.jsxs)("tr",{className:"h-8 cursor-pointer border-b border-divider-subtle hover:bg-background-default-hover",onClick:()=>{z.push(`/datasets/${k}/documents/${c.id}`)},children:[(0,b.jsx)("td",{className:"text-left align-middle text-xs text-text-tertiary",children:(0,b.jsxs)("div",{className:"flex items-center",onClick:a=>a.stopPropagation(),children:[(0,b.jsx)(ac.default,{className:"mr-2 shrink-0",checked:g.includes(c.id),onCheck:()=>{j(g.includes(c.id)?g.filter(a=>a!==c.id):[...g,c.id])}}),d+1]})}),(0,b.jsx)("td",{children:(0,b.jsxs)("div",{className:"group mr-6 flex max-w-[460px] items-center hover:mr-0",children:[(0,b.jsxs)("div",{className:"flex shrink-0 items-center",children:[av(c.data_source_type)&&(0,b.jsx)(ae.default,{className:"mr-1.5",type:"page",src:at(c.created_from)?c.data_source_info.page.page_icon:c.data_source_info.notion_page_icon}),au(c.data_source_type)&&(0,b.jsx)(ad.default,{type:(0,al.extensionToFileType)(at(c.created_from)?c?.data_source_info?.extension:c?.data_source_info?.upload_file?.extension??e),className:"mr-1.5"}),aE(c.data_source_type)&&(0,b.jsx)(ad.default,{type:(0,al.extensionToFileType)(as(c?.data_source_info?.name)),className:"mr-1.5"}),aC(c.data_source_type)&&(0,b.jsx)(s.RiGlobalLine,{className:"mr-1.5 size-4"})]}),(0,b.jsx)(M.default,{popupContent:c.name,children:(0,b.jsx)("span",{className:"grow-1 truncate text-sm",children:c.name})}),c.summary_index_status&&(0,b.jsx)("div",{className:"ml-1 hidden shrink-0 group-hover:flex",children:(0,b.jsx)(aF,{status:c.summary_index_status})}),(0,b.jsx)("div",{className:"hidden shrink-0 group-hover:ml-auto group-hover:flex",children:(0,b.jsx)(M.default,{popupContent:w("list.table.rename",{ns:"datasetDocuments"}),children:(0,b.jsx)("div",{className:"cursor-pointer rounded-md p-1 hover:bg-state-base-hover",onClick:a=>{a.stopPropagation(),V(c)},children:(0,b.jsx)(s.RiEditLine,{className:"h-4 w-4 text-text-tertiary"})})})})]})}),(0,b.jsx)("td",{children:(0,b.jsx)(aj,{isGeneralMode:C,isQAMode:D})}),(0,b.jsx)("td",{children:aJ(c.word_count)}),(0,b.jsx)("td",{children:aJ(c.hit_count)}),(0,b.jsx)("td",{className:"text-[13px] text-text-secondary",children:x(c.created_at,w("dateTimeFormat",{ns:"datasetHitTesting"}))}),(0,b.jsx)("td",{children:(0,b.jsx)(aG.default,{status:c.display_status})}),(0,b.jsx)("td",{children:(0,b.jsx)(aH.default,{selectedIds:g,onSelectedIdChange:j,embeddingAvailable:a,datasetId:k,detail:function(a,b){let c={};for(let d=0;d<b.length;d++){let e=b[d];Object.hasOwn(a,e)&&(c[e]=a[e])}return c}(c,["name","enabled","archived","id","data_source_type","doc_form","display_status"]),onUpdate:r})})]},c.id)})})]})}),g.length>0&&(0,b.jsx)(aD.default,{className:"absolute bottom-16 left-0 z-20",selectedIds:g,onArchive:ap(h.DocumentActionType.archive),onBatchSummary:ap(h.DocumentActionType.summary),onBatchEnable:ap(h.DocumentActionType.enable),onBatchDisable:ap(h.DocumentActionType.disable),onBatchDownload:aK.length>0?aM:void 0,onBatchDelete:ap(h.DocumentActionType.delete),onEditMetadata:J,onBatchReIndex:ar?aq:void 0,onCancel:()=>{j([])}}),!!q.total&&(0,b.jsx)(af.default,{...q,className:"w-full shrink-0"}),S&&Q&&(0,b.jsx)(aI.default,{datasetId:k,documentId:Q.id,name:Q.name,onClose:U,onSaved:W}),I&&(0,b.jsx)(aw,{datasetId:k,documentNum:g.length,list:L,onSave:N,onHide:K,onShowManage:()=>{K(),t()}})]})};var aL=a.i(836011),aM=a.i(981133);let aN=["-created_at","created_at","-hit_count","hit_count"],aO=a=>a&&aN.includes(a)?a:"-created_at",aP={page:1,limit:10,keyword:"",status:"all",sort:"-created_at"};function aQ(a,b){let{page:c,limit:d,keyword:e,status:f,sort:g}=a||{};c&&c>1||d&&10!==d||e&&e.trim()?(b.set("page",(c||1).toString()),b.set("limit",(d||10).toString())):(b.delete("page"),b.delete("limit")),e&&e.trim()?b.set("keyword",encodeURIComponent(e)):b.delete("keyword");let h=(0,ak.sanitizeStatusValue)(f);h&&"all"!==h?b.set("status",h):b.delete("status");let i=aO(g);"-created_at"!==i?b.set("sort",i):b.delete("sort")}let aR=function(){let a=(0,c.useSearchParams)(),b=(0,d.useMemo)(()=>{let b,c,d,e,f;return b=Number.parseInt(a.get("page")||"1",10),c=Number.parseInt(a.get("limit")||"10",10),d=a.get("keyword")||"",e=(0,ak.sanitizeStatusValue)(a.get("status")),f=aO(a.get("sort")),{page:b>0?b:1,limit:c>0&&c<=100?c:10,keyword:d?decodeURIComponent(d):"",status:e,sort:f}},[a]),e=(0,c.useRouter)(),f=(0,c.usePathname)(),g=(0,d.useCallback)(a=>{let c={...b,...a};c.status=(0,ak.sanitizeStatusValue)(c.status),c.sort=aO(c.sort);let d=new URLSearchParams;aQ(c,d);let g=d.toString(),h=g?`?${g}`:"";e.push(`${f}${h}`,{scroll:!1})},[b,e,f]),h=(0,d.useCallback)(()=>{let a=new URLSearchParams;aQ(aP,a);let b=a.toString(),c=b?`?${b}`:"";e.push(`${f}${c}`,{scroll:!1})},[e,f]);return(0,d.useMemo)(()=>({query:b,updateQuery:g,resetQuery:h}),[b,g,h])},aS=function(){let{query:a,updateQuery:b}=aR(),[c,e]=(0,d.useState)(""),[f,g]=(0,d.useState)(""),h=(0,aL.useDebounce)(f,{wait:500}),[i,j]=(0,d.useState)(()=>(0,ak.sanitizeStatusValue)(a.status)),[k,l]=(0,d.useState)(a.sort),m=(0,d.useMemo)(()=>(0,ak.normalizeStatusForQuery)(i),[i]),[n,o]=(0,d.useState)(a.page-1),[p,q]=(0,d.useState)(a.limit),[r,s]=(0,d.useState)([]),[t,u]=(0,d.useState)(!0);(0,d.useEffect)(()=>{a.keyword&&(e(a.keyword),g(a.keyword))},[]),(0,d.useEffect)(()=>{o(a.page-1),q(a.limit),a.keyword!==f&&(e(a.keyword),g(a.keyword)),j(b=>{let c=(0,ak.sanitizeStatusValue)(a.status);return b===c?b:c}),l(a.sort)},[a]),(0,d.useEffect)(()=>{h!==a.keyword&&(o(0),b({keyword:h,page:1}))},[h,a.keyword,b]),(0,d.useEffect)(()=>{f!==a.keyword&&s([])},[f,a.keyword]),(0,d.useEffect)(()=>{s([])},[m]);let v=(0,d.useCallback)(a=>{o(a),b({page:a+1})},[b]),w=(0,d.useCallback)(a=>{q(a),o(0),b({limit:a,page:1})},[b]),{run:x}=(0,aM.useDebounceFn)(()=>{g(c)},{wait:500}),y=(0,d.useCallback)(a=>{e(a),x()},[x]),z=(0,d.useCallback)(a=>{let c=(0,ak.sanitizeStatusValue)(a);j(c),o(0),b({status:c,page:1})},[b]),A=(0,d.useCallback)(()=>{"all"!==i&&(j("all"),o(0),b({status:"all",page:1}))},[i,b]),B=(0,d.useCallback)(a=>{a!==k&&(l(a),o(0),b({sort:a,page:1}))},[k,b]),C=(0,d.useCallback)(a=>{if(!a?.data)return;let b=0;a.data.forEach(a=>{let{indexing_status:c}=a;("completed"===c||"paused"===c||"error"===c)&&b++});let c=b!==a.data.length;u("all"!==m&&["queuing","indexing","paused"].includes(m)||c)},[m]),D=(0,d.useCallback)(a=>{if(!a)return;let b=Math.ceil(a.total/p);n>0&&n+1>b&&v(b>0?b-1:0)},[p,n,v]);return{inputValue:c,searchValue:f,debouncedSearchValue:h,handleInputChange:y,statusFilterValue:i,sortValue:k,normalizedStatusFilterValue:m,handleStatusFilterChange:z,handleStatusFilterClear:A,handleSortChange:B,currPage:n,limit:p,handlePageChange:v,handleLimitChange:w,selectedIds:r,setSelectedIds:s,timerCanRun:t,updatePollingState:C,adjustPageForTotal:D}};a.s(["default",0,({datasetId:a})=>{let r=(0,c.useRouter)(),{plan:s}=(0,g.useProviderContext)(),t="sandbox"===s.type,u=(0,f.useDatasetDetailContextWithSelector)(a=>a.dataset),v=!!u?.embedding_available,{inputValue:w,debouncedSearchValue:x,handleInputChange:y,statusFilterValue:z,sortValue:A,normalizedStatusFilterValue:B,handleStatusFilterChange:C,handleStatusFilterClear:D,handleSortChange:E,currPage:F,limit:G,handlePageChange:H,handleLimitChange:I,selectedIds:J,setSelectedIds:K,timerCanRun:L,updatePollingState:M,adjustPageForTotal:N}=aS(),{data:O,isLoading:P}=(0,i.useDocumentList)({datasetId:a,query:{page:F+1,limit:G,keyword:x,status:B,sort:A},refetchInterval:2500*!!L});(0,d.useEffect)(()=>{M(O)},[O,M]),(0,d.useEffect)(()=>{N(O)},[O,N]);let Q=(0,i.useInvalidDocumentList)(a),R=(0,i.useInvalidDocumentDetail)(),S=(0,k.useInvalid)(j.useSegmentListKey),T=(0,k.useInvalid)(j.useChildSegmentListKey),U=(0,d.useCallback)(()=>{Q(),R(),setTimeout(()=>{S(),T()},5e3)},[Q,R,S,T]),{isShowEditModal:V,showEditModal:W,hideEditModal:Y,datasetMetaData:Z,handleAddMetaData:$,handleRename:_,handleDeleteMetaData:ab,builtInEnabled:ac,setBuiltInEnabled:ad,builtInMetaData:ae}=(({datasetId:a,onUpdateDocList:b})=>{let{t:c}=(0,m.useTranslation)(),[e,{setTrue:f,setFalse:g}]=(0,l.useBoolean)(!1);(0,d.useEffect)(()=>{localStorage.getItem(p.isShowManageMetadataLocalStorageKey)&&(f(),localStorage.removeItem(p.isShowManageMetadataLocalStorageKey))},[]);let{data:h}=(0,o.useDatasetMetaData)(a),{mutate:i}=(0,o.useCreateMetaData)(a),{checkName:j}=(0,q.default)(),k=(0,d.useCallback)(async a=>{let b=j(a.name).errorMsg;if(b)return n.default.notify({message:b,type:"error"}),Promise.reject(Error(b));await i(a)},[j,i]),{mutate:r}=(0,o.useRenameMeta)(a),s=(0,d.useCallback)(async a=>{let c=j(a.name).errorMsg;if(c)return n.default.notify({message:c,type:"error"}),Promise.reject(Error(c));await r(a),b()},[j,r,b]),{mutateAsync:t}=(0,o.useDeleteMetaData)(a),u=(0,d.useCallback)(async a=>{await t(a),b()},[t,b]),[v,w]=(0,d.useState)(h?.built_in_field_enabled);(0,d.useEffect)(()=>{w(h?.built_in_field_enabled)},[h]);let{mutateAsync:x}=(0,o.useUpdateBuiltInStatus)(a),{data:y}=(0,o.useBuiltInMetaDataFields)();return{isShowEditModal:e,showEditModal:f,hideEditModal:g,datasetMetaData:h?.doc_metadata,handleAddMetaData:k,handleRename:s,handleDeleteMetaData:u,builtInMetaData:y?.fields,builtInEnabled:v,setBuiltInEnabled:async a=>{await x(a),w(a),n.default.notify({message:c("actionMsg.modifiedSuccessfully",{ns:"common"}),type:"success"})}}})({datasetId:a,dataset:u,onUpdateDocList:Q}),af=(0,d.useCallback)(()=>{u?.runtime_mode==="rag_pipeline"?r.push(`/datasets/${a}/documents/create-from-pipeline`):r.push(`/datasets/${a}/documents/create`)},[u?.runtime_mode,a,r]),ag=O?.total||0,ah=O?.data;return(0,b.jsxs)("div",{className:"flex h-full flex-col",children:[(0,b.jsx)(X,{datasetId:a,dataSourceType:u?.data_source_type,embeddingAvailable:v,isFreePlan:t,statusFilterValue:z,sortValue:A,inputValue:w,onStatusFilterChange:C,onStatusFilterClear:D,onSortChange:E,onInputChange:y,isShowEditMetadataModal:V,showEditMetadataModal:W,hideEditMetadataModal:Y,datasetMetaData:Z,builtInMetaData:ae,builtInEnabled:!!ac,onAddMetaData:$,onRenameMetaData:_,onDeleteMetaData:ab,onBuiltInEnabledChange:ad,onAddDocument:af}),(0,b.jsx)("div",{className:"flex h-0 grow flex-col px-6 pt-4",children:(()=>{if(P)return(0,b.jsx)(e.default,{type:"app"});if(ag>0)return(0,b.jsx)(aK,{embeddingAvailable:v,documents:ah||[],datasetId:a,onUpdate:U,selectedIds:J,onSelectedIdChange:K,statusFilterValue:B,remoteSortValue:A,pagination:{total:ag,limit:G,onLimitChange:I,current:F,onChange:H},onManageMetadata:W});let c=u?.data_source_type===h.DataSourceType.NOTION;return(0,b.jsx)(aa,{canAdd:v,onClick:af,type:c?"sync":"upload"})})()})]})}],402120)}];

//# sourceMappingURL=app_components_datasets_documents_index_tsx_620947db._.js.map
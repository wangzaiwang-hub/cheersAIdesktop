module.exports=[246302,a=>{"use strict";var b,c,d=a.i(608061),e=a.i(22761),f=a.i(429150),g=a.i(533306),h=a.i(57843);a.i(752298);var i=a.i(693025),j=a.i(847733),k=a.i(757801),l=a.i(981133),m=a.i(261574),n=a.i(111089),o=a.i(639378),p=a.i(909795),q=a.i(816134),r=a.i(940272),s=a.i(114715),t=a.i(422335),u=a.i(343837),v=a.i(599656);let w=h.memo(({onClose:a})=>{let{t:b}=(0,i.useTranslation)();return(0,d.jsxs)("div",{className:"title-2xl-semi-bold relative flex items-center justify-between pb-3 pl-6 pr-14 pt-6 text-text-primary",children:[b("importFromDSL",{ns:"app"}),(0,d.jsx)("div",{className:"absolute right-5 top-5 flex size-8 cursor-pointer items-center",onClick:a,children:(0,d.jsx)(f.RiCloseLine,{className:"size-[18px] text-text-tertiary"})})]})});var x=a.i(689808),y=a.i(527344);let z=h.memo(({isActive:a,label:b,onClick:c})=>(0,d.jsxs)("div",{className:(0,y.cn)("system-md-semibold relative flex h-full cursor-pointer items-center text-text-tertiary",a&&"text-text-primary"),onClick:c,children:[b,a&&(0,d.jsx)("div",{className:"absolute bottom-0 h-0.5 w-full bg-util-colors-blue-brand-blue-brand-600"})]})),A=({currentTab:a,setCurrentTab:b})=>{let{t:c}=(0,i.useTranslation)(),e=[{key:x.CreateFromDSLModalTab.FROM_FILE,label:c("importFromDSLFile",{ns:"app"})},{key:x.CreateFromDSLModalTab.FROM_URL,label:c("importFromDSLUrl",{ns:"app"})}];return(0,d.jsx)("div",{className:"system-md-semibold flex h-9 items-center gap-x-6 border-b border-divider-subtle px-6 text-text-tertiary",children:e.map(c=>(0,d.jsx)(z,{isActive:a===c.key,label:c.label,onClick:b.bind(null,c.key)},c.key))})};var B=a.i(175809),C=a.i(573912);let D=h.memo(({file:a,updateFile:b,className:c})=>{let{t:e}=(0,i.useTranslation)(),{notify:g}=(0,o.useContext)(s.ToastContext),[j,k]=(0,h.useState)(!1),l=(0,h.useRef)(null),m=(0,h.useRef)(null),n=(0,h.useRef)(null),p=a=>{a.preventDefault(),a.stopPropagation(),a.target!==m.current&&k(!0)},q=a=>{a.preventDefault(),a.stopPropagation()},r=a=>{a.preventDefault(),a.stopPropagation(),a.target===m.current&&k(!1)},t=a=>{if(a.preventDefault(),a.stopPropagation(),k(!1),!a.dataTransfer)return;let c=Array.from(a.dataTransfer.files);c.length>1?g({type:"error",message:e("stepOne.uploader.validation.count",{ns:"datasetCreation"})}):b(c[0])};return(0,h.useEffect)(()=>{let a=l.current;return a?.addEventListener("dragenter",p),a?.addEventListener("dragover",q),a?.addEventListener("dragleave",r),a?.addEventListener("drop",t),()=>{a?.removeEventListener("dragenter",p),a?.removeEventListener("dragover",q),a?.removeEventListener("dragleave",r),a?.removeEventListener("drop",t)}},[]),(0,d.jsxs)("div",{className:(0,y.cn)("mt-6",c),children:[(0,d.jsx)("input",{ref:n,style:{display:"none"},type:"file",id:"fileUploader",accept:".pipeline",onChange:a=>{b(a.target.files?.[0])}}),(0,d.jsxs)("div",{ref:l,children:[!a&&(0,d.jsxs)("div",{className:(0,y.cn)("flex h-12 items-center rounded-[10px] border border-dashed border-components-dropzone-border bg-components-dropzone-bg text-sm font-normal",j&&"border-components-dropzone-border-accent bg-components-dropzone-bg-accent"),children:[(0,d.jsxs)("div",{className:"flex w-full items-center justify-center space-x-2",children:[(0,d.jsx)(f.RiUploadCloud2Line,{className:"h-6 w-6 text-text-tertiary"}),(0,d.jsxs)("div",{className:"text-text-tertiary",children:[e("dslUploader.button",{ns:"app"}),(0,d.jsx)("span",{className:"cursor-pointer pl-1 text-text-accent",onClick:()=>{n.current&&(n.current.value="",n.current.click(),n.current.oncancel=()=>b(a))},children:e("dslUploader.browse",{ns:"app"})})]})]}),j&&(0,d.jsx)("div",{ref:m,className:"absolute left-0 top-0 h-full w-full"})]}),a&&(0,d.jsxs)("div",{className:"group flex items-center rounded-lg border-[0.5px] border-components-panel-border bg-components-panel-on-panel-item-bg shadow-xs hover:bg-components-panel-on-panel-item-bg-hover",children:[(0,d.jsx)("div",{className:"flex items-center justify-center p-3",children:(0,d.jsx)(f.RiNodeTree,{className:"h-6 w-6 shrink-0 text-text-secondary"})}),(0,d.jsxs)("div",{className:"flex grow flex-col items-start gap-0.5 py-1 pr-2",children:[(0,d.jsx)("span",{className:"font-inter max-w-[calc(100%_-_30px)] overflow-hidden text-ellipsis whitespace-nowrap text-[12px] font-medium leading-4 text-text-secondary",children:a.name}),(0,d.jsxs)("div",{className:"font-inter flex h-3 items-center gap-1 self-stretch text-[10px] font-medium uppercase leading-3 text-text-tertiary",children:[(0,d.jsx)("span",{children:"PIPELINE"}),(0,d.jsx)("span",{className:"text-text-quaternary",children:"Â·"}),(0,d.jsx)("span",{children:(0,C.formatFileSize)(a.size)})]})]}),(0,d.jsx)("div",{className:"hidden items-center pr-3 group-hover:flex",children:(0,d.jsx)(B.default,{onClick:()=>{n.current&&(n.current.value=""),b()},children:(0,d.jsx)(f.RiDeleteBinLine,{className:"h-4 w-4 text-text-tertiary"})})})]})]})]})});var E=((b={}).FROM_FILE="from-file",b.FROM_URL="from-url",b);let F=({show:a,onSuccess:b,onClose:c,activeTab:e="from-file",dslUrl:f=""})=>{let{push:j}=(0,g.useRouter)(),{t:k}=(0,i.useTranslation)(),{notify:x}=(0,o.useContext)(s.ToastContext),[y,z]=(0,h.useState)(),[B,C]=(0,h.useState)(),[E,F]=(0,h.useState)(e),[G,H]=(0,h.useState)(f),[I,J]=(0,h.useState)(!1),[K,L]=(0,h.useState)(),[M,N]=(0,h.useState)(),{handleCheckPluginDependencies:O}=(0,t.usePluginDependencies)(),P=(0,h.useRef)(!1),{mutateAsync:Q}=(0,v.useImportPipelineDSL)(),R=async()=>{let a;if("from-file"===E&&!y||"from-url"===E&&!G||P.current)return;if(P.current=!0,"from-file"===E&&(a=await Q({mode:u.DSLImportMode.YAML_CONTENT,yaml_content:B||""})),"from-url"===E&&(a=await Q({mode:u.DSLImportMode.YAML_URL,yaml_url:G||""})),!a){x({type:"error",message:k("creation.errorTip",{ns:"datasetPipeline"})}),P.current=!1;return}let{id:d,status:e,pipeline_id:f,dataset_id:g,imported_dsl_version:h,current_dsl_version:i}=a;e===u.DSLImportStatus.COMPLETED||e===u.DSLImportStatus.COMPLETED_WITH_WARNINGS?(b&&b(),c&&c(),x({type:e===u.DSLImportStatus.COMPLETED?"success":"warning",message:k(e===u.DSLImportStatus.COMPLETED?"creation.successTip":"creation.caution",{ns:"datasetPipeline"}),children:e===u.DSLImportStatus.COMPLETED_WITH_WARNINGS&&k("newApp.appCreateDSLWarning",{ns:"app"})}),f&&await O(f,!0),j(`/datasets/${g}/pipeline`)):e===u.DSLImportStatus.PENDING?(L({importedVersion:h??"",systemVersion:i??""}),c&&c(),setTimeout(()=>{J(!0)},300),N(d)):x({type:"error",message:k("creation.errorTip",{ns:"datasetPipeline"})}),P.current=!1},{run:S}=(0,l.useDebounceFn)(R,{wait:300});(0,m.useKeyPress)("esc",()=>{a&&!I&&c()});let{mutateAsync:T}=(0,v.useImportPipelineDSLConfirm)(),U=async()=>{if(!M)return;let a=await T(M);if(!a)return void x({type:"error",message:k("creation.errorTip",{ns:"datasetPipeline"})});let{status:d,pipeline_id:e,dataset_id:f}=a;d===u.DSLImportStatus.COMPLETED?(b&&b(),c&&c(),x({type:"success",message:k("creation.successTip",{ns:"datasetPipeline"})}),e&&await O(e,!0),j(`datasets/${f}/pipeline`)):d===u.DSLImportStatus.FAILED&&x({type:"error",message:k("creation.errorTip",{ns:"datasetPipeline"})})},V=(0,h.useMemo)(()=>"from-file"===E?!y:"from-url"===E&&!G,[E,y,G]);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(r.default,{className:"w-[520px] rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg p-0 shadow-xl",isShow:a,onClose:n.noop,children:[(0,d.jsx)(w,{onClose:c}),(0,d.jsx)(A,{currentTab:E,setCurrentTab:F}),(0,d.jsxs)("div",{className:"px-6 py-4",children:["from-file"===E&&(0,d.jsx)(D,{className:"mt-0",file:y,updateFile:a=>{let b;z(a),a&&((b=new FileReader).onload=function(a){C(a.target?.result)},b.readAsText(a)),a||C("")}}),"from-url"===E&&(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"system-md-semibold leading6 mb-1 text-text-secondary",children:"DSL URL"}),(0,d.jsx)(q.default,{placeholder:k("importFromDSLUrlPlaceholder",{ns:"app"})||"",value:G,onChange:a=>H(a.target.value)})]})]}),(0,d.jsxs)("div",{className:"flex justify-end gap-x-2 p-6 pt-5",children:[(0,d.jsx)(p.default,{onClick:c,children:k("newApp.Cancel",{ns:"app"})}),(0,d.jsx)(p.default,{disabled:V,variant:"primary",onClick:S,className:"gap-1",children:(0,d.jsx)("span",{children:k("newApp.import",{ns:"app"})})})]})]}),(0,d.jsxs)(r.default,{isShow:I,onClose:()=>J(!1),className:"w-[480px]",children:[(0,d.jsxs)("div",{className:"flex flex-col items-start gap-2 self-stretch pb-4",children:[(0,d.jsx)("div",{className:"title-2xl-semi-bold text-text-primary",children:k("newApp.appCreateDSLErrorTitle",{ns:"app"})}),(0,d.jsxs)("div",{className:"system-md-regular flex grow flex-col text-text-secondary",children:[(0,d.jsx)("div",{children:k("newApp.appCreateDSLErrorPart1",{ns:"app"})}),(0,d.jsx)("div",{children:k("newApp.appCreateDSLErrorPart2",{ns:"app"})}),(0,d.jsx)("br",{}),(0,d.jsxs)("div",{children:[k("newApp.appCreateDSLErrorPart3",{ns:"app"}),(0,d.jsx)("span",{className:"system-md-medium",children:K?.importedVersion})]}),(0,d.jsxs)("div",{children:[k("newApp.appCreateDSLErrorPart4",{ns:"app"}),(0,d.jsx)("span",{className:"system-md-medium",children:K?.systemVersion})]})]})]}),(0,d.jsxs)("div",{className:"flex items-start justify-end gap-2 self-stretch pt-6",children:[(0,d.jsx)(p.default,{variant:"secondary",onClick:()=>J(!1),children:k("newApp.Cancel",{ns:"app"})}),(0,d.jsx)(p.default,{variant:"primary",destructive:!0,onClick:U,children:k("newApp.Confirm",{ns:"app"})})]})]})]})},G=h.memo(()=>{let{t:a}=(0,i.useTranslation)(),[b,c]=(0,h.useState)(!1),e=(0,g.useSearchParams)(),{replace:l}=(0,g.useRouter)(),m=e.get("remoteInstallUrl")||void 0,n=(0,j.useInvalidDatasetList)(),o=(0,h.useMemo)(()=>{if(m)return E.FROM_URL},[m]),p=(0,h.useCallback)(()=>{c(!0)},[]),q=(0,h.useCallback)(()=>{c(!1),m&&l("/datasets/create-from-pipeline")},[m,l]),r=(0,h.useCallback)(()=>{n()},[n]);return(0,d.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 z-10 flex flex-col gap-y-4 bg-knowledge-pipeline-creation-footer-bg px-16 pb-6 backdrop-blur-[6px]",children:[(0,d.jsx)(k.default,{type:"horizontal",className:"my-0 w-8"}),(0,d.jsxs)("button",{type:"button",className:"system-md-medium flex items-center gap-x-3 text-text-accent",onClick:p,children:[(0,d.jsx)(f.RiFileUploadLine,{className:"size-5"}),(0,d.jsx)("span",{children:a("creation.importDSL",{ns:"datasetPipeline"})})]}),(0,d.jsx)(F,{show:b,onClose:q,activeTab:o,dslUrl:m,onSuccess:r})]})});var H=a.i(413192);let I=h.memo(()=>{let{t:a}=(0,i.useTranslation)();return(0,d.jsxs)("div",{className:"system-md-semibold relative flex px-16 pb-2 pt-5 text-text-primary",children:[(0,d.jsx)("span",{children:a("creation.backToKnowledge",{ns:"datasetPipeline"})}),(0,d.jsx)(H.default,{className:"absolute bottom-0 left-5",href:"/datasets",replace:!0,children:(0,d.jsx)(p.default,{variant:"secondary-accent",className:"size-9 rounded-full p-0",children:(0,d.jsx)(f.RiArrowLeftLine,{className:"size-5 "})})})]})});var J=a.i(724423),K=a.i(252813),L=a.i(136403);a.i(60796);var M=a.i(55282),N=a.i(164024);let O=h.memo(()=>{let{t:a}=(0,i.useTranslation)(),{push:b}=(0,g.useRouter)(),{mutateAsync:c}=(0,N.useCreatePipelineDataset)(),e=(0,j.useInvalidDatasetList)(),k=(0,h.useCallback)(async()=>{await c(void 0,{onSuccess:c=>{if(c){let{id:d}=c;s.default.notify({type:"success",message:a("creation.successTip",{ns:"datasetPipeline"})}),e(),(0,M.trackEvent)("create_datasets_from_scratch",{dataset_id:d}),b(`/datasets/${d}/pipeline`)}},onError:()=>{s.default.notify({type:"error",message:a("creation.errorTip",{ns:"datasetPipeline"})})}})},[c,b,e,a]);return(0,d.jsxs)("div",{className:"group relative flex h-[132px] cursor-pointer flex-col rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-on-panel-item-bg pb-3 shadow-xs shadow-shadow-shadow-3",onClick:k,children:[(0,d.jsxs)("div",{className:"flex items-center gap-x-3 p-4 pb-2",children:[(0,d.jsx)("div",{className:"flex size-10 shrink-0 items-center justify-center rounded-[10px] border border-dashed border-divider-regular bg-background-section group-hover:border-state-accent-hover-alt group-hover:bg-state-accent-hover",children:(0,d.jsx)(f.RiAddCircleLine,{className:"size-5 text-text-quaternary group-hover:text-text-accent"})}),(0,d.jsx)("div",{className:"system-md-semibold truncate text-text-primary",children:a("creation.createFromScratch.title",{ns:"datasetPipeline"})})]}),(0,d.jsx)("p",{className:"system-xs-regular line-clamp-3 px-4 py-1 text-text-tertiary",children:a("creation.createFromScratch.description",{ns:"datasetPipeline"})})]})});var P=a.i(42550),Q=a.i(760327),R=a.i(234782);let S=h.memo(({openEditModal:a,onDelete:b,onExport:c})=>{let{t:e}=(0,i.useTranslation)();return(0,d.jsxs)("div",{className:"relative flex w-full flex-col rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur shadow-lg shadow-shadow-shadow-5",children:[(0,d.jsxs)("div",{className:"flex flex-col p-1",children:[(0,d.jsx)("div",{className:"flex cursor-pointer items-center gap-x-1 rounded-lg px-2 py-1.5 hover:bg-state-base-hover",onClick:b=>{b.stopPropagation(),b.preventDefault(),a()},children:(0,d.jsx)("span",{className:"system-md-regular px-1 text-text-secondary",children:e("operations.editInfo",{ns:"datasetPipeline"})})}),(0,d.jsx)("div",{className:"flex cursor-pointer items-center gap-x-1 rounded-lg px-2 py-1.5 hover:bg-state-base-hover",onClick:a=>{a.stopPropagation(),a.preventDefault(),c()},children:(0,d.jsx)("span",{className:"system-md-regular px-1 text-text-secondary",children:e("operations.exportPipeline",{ns:"datasetPipeline"})})})]}),(0,d.jsx)(k.default,{type:"horizontal",className:"my-0 bg-divider-subtle"}),(0,d.jsx)("div",{className:"flex flex-col p-1",children:(0,d.jsx)("div",{className:"group flex cursor-pointer items-center gap-x-1 rounded-lg px-2 py-1.5 hover:bg-state-destructive-hover",onClick:a=>{a.stopPropagation(),a.preventDefault(),b()},children:(0,d.jsx)("span",{className:"system-md-regular px-1 text-text-secondary group-hover:text-text-destructive",children:e("operation.delete",{ns:"common"})})})})]})}),T=h.memo(({onApplyTemplate:a,handleShowTemplateDetails:b,showMoreOperations:c,openEditModal:e,handleExportDSL:g,handleDelete:h})=>{let{t:j}=(0,i.useTranslation)();return(0,d.jsxs)("div",{className:"absolute bottom-0 left-0 z-10 hidden w-full items-center gap-x-1 bg-pipeline-template-card-hover-bg p-4 pt-8 group-hover:flex",children:[(0,d.jsxs)(p.default,{variant:"primary",onClick:a,className:"grow gap-x-0.5",children:[(0,d.jsx)(f.RiAddLine,{className:"size-4"}),(0,d.jsx)("span",{className:"px-0.5",children:j("operations.choose",{ns:"datasetPipeline"})})]}),(0,d.jsxs)(p.default,{variant:"secondary",onClick:b,className:"grow gap-x-0.5",children:[(0,d.jsx)(f.RiArrowRightUpLine,{className:"size-4"}),(0,d.jsx)("span",{className:"px-0.5",children:j("operations.details",{ns:"datasetPipeline"})})]}),c&&(0,d.jsx)(R.default,{htmlContent:(0,d.jsx)(S,{openEditModal:e,onExport:g,onDelete:h}),className:"z-20 min-w-[160px]",popupClassName:"rounded-xl bg-none shadow-none ring-0 min-w-[160px]",position:"br",trigger:"click",btnElement:(0,d.jsx)(f.RiMoreFill,{className:"size-4 text-text-tertiary"}),btnClassName:"size-8 cursor-pointer justify-center rounded-lg p-0 shadow-xs shadow-shadow-shadow-3"})]})});var U=a.i(355968);a.i(618184);var V=a.i(441424),W=a.i(986431);let X=h.memo(({name:a,description:b,iconInfo:c,chunkStructure:e})=>{let{t:f}=(0,i.useTranslation)(),g=W.DOC_FORM_ICON_WITH_BG[e]||V.General;return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"flex items-center gap-x-3 p-4 pb-2",children:[(0,d.jsxs)("div",{className:"relative shrink-0",children:[(0,d.jsx)(U.default,{size:"large",iconType:c.icon_type,icon:c.icon,background:"image"===c.icon_type?void 0:c.icon_background,imageUrl:"image"===c.icon_type?c.icon_url:void 0}),(0,d.jsx)("div",{className:"absolute -bottom-1 -right-1 z-10",children:(0,d.jsx)(g,{className:"size-4"})})]}),(0,d.jsxs)("div",{className:"flex grow flex-col gap-y-1 overflow-hidden py-px",children:[(0,d.jsx)("div",{className:"system-md-semibold truncate text-text-secondary",title:a,children:a}),(0,d.jsx)("div",{className:"system-2xs-medium-uppercase text-text-tertiary",children:f(`chunkingMode.${W.DOC_FORM_TEXT[e]}`,{ns:"dataset"})})]})]}),(0,d.jsx)("p",{className:"system-xs-regular line-clamp-3 grow px-4 py-1 text-text-tertiary",title:b,children:b})]})});var Y=a.i(105249),Z=a.i(483664),$=a.i(653621),_=((c={}).indigo="indigo",c.blueLight="blue-light",c.green="green",c.none="none",c);let aa={[_.indigo]:"bg-util-colors-indigo-indigo-600 opacity-80",[_.blueLight]:"bg-util-colors-blue-light-blue-light-500 opacity-80",[_.green]:"bg-util-colors-teal-teal-600 opacity-80",[_.none]:""},ab={[_.indigo]:"bg-components-icon-bg-indigo-solid",[_.blueLight]:"bg-components-icon-bg-blue-light-solid",[_.green]:"bg-components-icon-bg-teal-solid",[_.none]:""},ac=h.memo(({className:a,icon:b,title:c,description:e,effectColor:f})=>(0,d.jsxs)("div",{className:(0,y.cn)("relative flex overflow-hidden rounded-xl border-[0.5px] border-components-panel-border-subtle bg-components-panel-bg p-2 shadow-xs shadow-shadow-shadow-3",a),children:[(0,d.jsx)("div",{className:(0,y.cn)("absolute -left-1 -top-1 size-14 rounded-full blur-[80px]",`${aa[f]}`)}),(0,d.jsx)("div",{className:"p-1",children:(0,d.jsx)("div",{className:(0,y.cn)("flex size-6 shrink-0 items-center justify-center rounded-lg border-[0.5px] border-divider-subtle text-text-primary-on-surface shadow-md shadow-shadow-shadow-5",`${ab[f]}`),children:b})}),(0,d.jsxs)("div",{className:"flex grow flex-col gap-y-0.5 py-px",children:[(0,d.jsx)("div",{className:"flex items-center gap-x-1",children:(0,d.jsx)("span",{className:"system-sm-medium text-text-secondary",children:c})}),e&&(0,d.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:e})]})]}));a.i(224256);var ad=a.i(463561),ae=a.i(12588),af=a.i(765239);let ag=h.memo(({id:a,type:b,onApplyTemplate:c,onClose:e})=>{let{t:g}=(0,i.useTranslation)(),{data:j}=(0,v.usePipelineTemplateById)({template_id:a,type:b},!0),k=(0,h.useMemo)(()=>{if(!j)return{type:"emoji",icon:"ðŸ“™",background:"#FFF4ED"};let a=j.icon_info;return"image"===a.icon_type?{type:"image",url:a.icon_url||"",fileId:a.icon||""}:{type:"icon",icon:a.icon||"",background:a.icon_background||""}},[j]),l=(()=>{let{t:a}=(0,i.useTranslation)(),b={icon:(0,d.jsx)(ad.GeneralChunk,{className:"size-4"}),title:"General",description:a("stepTwo.generalTip",{ns:"datasetCreation"}),effectColor:_.indigo},c={icon:(0,d.jsx)(ae.ParentChildChunk,{className:"size-4"}),title:"Parent-Child",description:a("stepTwo.parentChildTip",{ns:"datasetCreation"}),effectColor:_.blueLight},e={icon:(0,d.jsx)(af.QuestionAndAnswer,{className:"size-4"}),title:"Q&A",description:a("stepTwo.qaTip",{ns:"datasetCreation"}),effectColor:_.green};return{[W.ChunkingMode.text]:b,[W.ChunkingMode.parentChild]:c,[W.ChunkingMode.qa]:e}})();return j?(0,d.jsxs)("div",{className:"flex h-full",children:[(0,d.jsx)("div",{className:"flex grow items-center justify-center p-3 pr-0",children:(0,d.jsx)($.default,{...j.graph,className:"overflow-hidden rounded-2xl"})}),(0,d.jsxs)("div",{className:"relative flex w-[360px] shrink-0 flex-col",children:[(0,d.jsx)("button",{type:"button",className:"absolute right-4 top-4 z-10 flex size-8 items-center justify-center",onClick:e,children:(0,d.jsx)(f.RiCloseLine,{className:"size-4 text-text-tertiary"})}),(0,d.jsxs)("div",{className:"flex items-start gap-x-3 pb-2 pl-4 pr-12 pt-6",children:[(0,d.jsx)(U.default,{size:"large",iconType:k.type,icon:"image"===k.type?k.fileId:k.icon,background:"image"===k.type?void 0:k.background,imageUrl:"image"===k.type?k.url:void 0,showEditIcon:!0}),(0,d.jsxs)("div",{className:"flex grow flex-col gap-y-1 overflow-hidden py-px",children:[(0,d.jsx)("div",{className:"system-md-semibold truncate text-text-secondary",title:j.name,children:j.name}),j.created_by&&(0,d.jsx)("div",{className:"system-2xs-medium-uppercase truncate text-text-tertiary",title:j.created_by,children:g("details.createdBy",{ns:"datasetPipeline",author:j.created_by})})]})]}),(0,d.jsx)("p",{className:"system-sm-regular px-4 pb-2 pt-1 text-text-secondary",children:j.description}),(0,d.jsx)("div",{className:"p-3",children:(0,d.jsxs)(p.default,{variant:"primary",onClick:c,className:"w-full gap-x-0.5",children:[(0,d.jsx)(f.RiAddLine,{className:"size-4"}),(0,d.jsx)("span",{className:"px-0.5",children:g("operations.useTemplate",{ns:"datasetPipeline"})})]})}),(0,d.jsxs)("div",{className:"flex flex-col gap-y-1 px-4 py-2",children:[(0,d.jsxs)("div",{className:"flex h-6 items-center gap-x-0.5",children:[(0,d.jsx)("span",{className:"system-sm-semibold-uppercase text-text-secondary",children:g("details.structure",{ns:"datasetPipeline"})}),(0,d.jsx)(Z.default,{popupClassName:"max-w-[240px]",popupContent:g("details.structureTooltip",{ns:"datasetPipeline"})})]}),(0,d.jsx)(ac,{...l[j.chunk_structure]})]})]})]}):(0,d.jsx)(Y.default,{type:"app"})});var ah=a.i(429178),ai=a.i(146172);let aj=h.memo(({onClose:a,pipeline:b})=>{let{t:c}=(0,i.useTranslation)(),[e,g]=(0,h.useState)(b.name),j=b.icon,[k,l]=(0,h.useState)("image"===j.icon_type?{type:"image",url:j.icon_url||"",fileId:j.icon||""}:{type:"emoji",icon:j.icon||"",background:j.icon_background||""}),[m,n]=(0,h.useState)(b.description),[o,r]=(0,h.useState)(!1),t=(0,h.useRef)("image"===j.icon_type?{type:"image",url:j.icon_url||"",fileId:j.icon||""}:{type:"emoji",icon:j.icon||"",background:j.icon_background||""}),u=(0,h.useCallback)(a=>{g(a.target.value)},[]),w=(0,h.useCallback)(()=>{r(!0),t.current=k},[k]),x=(0,h.useCallback)(a=>{l(a),r(!1)},[]),y=(0,h.useCallback)(()=>{l(t.current),r(!1)},[]),z=(0,h.useCallback)(a=>{n(a.target.value)},[]),{mutateAsync:A}=(0,v.useUpdateTemplateInfo)(),B=(0,v.useInvalidCustomizedTemplateList)(),C=(0,h.useCallback)(async()=>{if(!e)return void s.default.notify({type:"error",message:"Please enter a name for the Knowledge Base."});let c={template_id:b.id,name:e,icon_info:{icon_type:k.type,icon:"image"===k.type?k.fileId:k.icon,icon_background:"image"===k.type?void 0:k.background,icon_url:"image"===k.type?k.url:void 0},description:m};await A(c,{onSuccess:()=>{B(),a()}})},[e,k,m,b.id,A,B,a]);return(0,d.jsxs)("div",{className:"relative flex flex-col",children:[(0,d.jsx)("div",{className:"pb-3 pl-6 pr-14 pt-6",children:(0,d.jsx)("span",{className:"title-2xl-semi-bold text-text-primary",children:c("editPipelineInfo",{ns:"datasetPipeline"})})}),(0,d.jsx)("button",{type:"button",className:"absolute right-5 top-5 flex size-8 items-center justify-center",onClick:a,children:(0,d.jsx)(f.RiCloseLine,{className:"size-5 text-text-tertiary"})}),(0,d.jsxs)("div",{className:"flex flex-col gap-y-5 px-6 py-3",children:[(0,d.jsxs)("div",{className:"flex items-end gap-x-3 self-stretch",children:[(0,d.jsxs)("div",{className:"flex grow flex-col gap-y-1 pb-1",children:[(0,d.jsx)("label",{className:"system-sm-medium flex h-6 items-center text-text-secondary",children:c("pipelineNameAndIcon",{ns:"datasetPipeline"})}),(0,d.jsx)(q.default,{onChange:u,value:e,placeholder:c("knowledgeNameAndIconPlaceholder",{ns:"datasetPipeline"})})]}),(0,d.jsx)(U.default,{size:"xxl",onClick:w,className:"cursor-pointer",iconType:k.type,icon:"image"===k.type?k.fileId:k.icon,background:"image"===k.type?void 0:k.background,imageUrl:"image"===k.type?k.url:void 0,showEditIcon:!0})]}),(0,d.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,d.jsx)("label",{className:"system-sm-medium flex h-6 items-center text-text-secondary",children:c("knowledgeDescription",{ns:"datasetPipeline"})}),(0,d.jsx)(ai.default,{onChange:z,value:m,placeholder:c("knowledgeDescriptionPlaceholder",{ns:"datasetPipeline"})})]})]}),(0,d.jsxs)("div",{className:"flex items-center justify-end gap-x-2 p-6 pt-5",children:[(0,d.jsx)(p.default,{variant:"secondary",onClick:a,children:c("operation.cancel",{ns:"common"})}),(0,d.jsx)(p.default,{variant:"primary",onClick:C,children:c("operation.save",{ns:"common"})})]}),o&&(0,d.jsx)(ah.default,{onSelect:x,onClose:y})]})}),ak=h.memo(({pipeline:a,showMoreOperations:b=!0,type:c})=>{let{t:e}=(0,i.useTranslation)(),{push:f}=(0,g.useRouter)(),[k,l]=(0,h.useState)(!1),[m,n]=(0,h.useState)(!1),[o,p]=(0,h.useState)(!1),{refetch:q}=(0,v.usePipelineTemplateById)({template_id:a.id,type:c},!1),{mutateAsync:u}=(0,N.useCreatePipelineDatasetFromCustomized)(),{handleCheckPluginDependencies:w}=(0,t.usePluginDependencies)(),x=(0,j.useInvalidDatasetList)(),y=(0,h.useCallback)(async()=>{let{data:b}=await q();if(!b)return void s.default.notify({type:"error",message:e("creation.errorTip",{ns:"datasetPipeline"})});let d={yaml_content:b.export_data};await u(d,{onSuccess:async b=>{s.default.notify({type:"success",message:e("creation.successTip",{ns:"datasetPipeline"})}),x(),b.pipeline_id&&await w(b.pipeline_id,!0),(0,M.trackEvent)("create_datasets_with_pipeline",{template_name:a.name,template_id:a.id,template_type:c}),f(`/datasets/${b.dataset_id}/pipeline`)},onError:()=>{s.default.notify({type:"error",message:e("creation.errorTip",{ns:"datasetPipeline"})})}})},[q,u,e,w,f,x,a.name,a.id,c]),z=(0,h.useCallback)(()=>{p(!0)},[]),A=(0,h.useCallback)(()=>{l(!0)},[]),B=(0,h.useCallback)(()=>{l(!1)},[]),C=(0,h.useCallback)(()=>{p(!1)},[]),{mutateAsync:D,isPending:E}=(0,v.useExportTemplateDSL)(),F=(0,h.useCallback)(async()=>{E||await D(a.id,{onSuccess:b=>{let c=new Blob([b.data],{type:"application/yaml"});(0,Q.downloadBlob)({data:c,fileName:`${a.name}.pipeline`}),s.default.notify({type:"success",message:e("exportDSL.successTip",{ns:"datasetPipeline"})})},onError:()=>{s.default.notify({type:"error",message:e("exportDSL.errorTip",{ns:"datasetPipeline"})})}})},[e,E,a.id,a.name,D]),G=(0,h.useCallback)(()=>{n(!0)},[]),H=(0,h.useCallback)(()=>{n(!1)},[]),{mutateAsync:I}=(0,v.useDeleteTemplate)(),J=(0,v.useInvalidCustomizedTemplateList)(),K=(0,h.useCallback)(async()=>{await I(a.id,{onSuccess:()=>{J(),n(!1)}})},[a.id,I,J]);return(0,d.jsxs)("div",{className:"group relative flex h-[132px] cursor-pointer flex-col rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-on-panel-item-bg pb-3 shadow-xs shadow-shadow-shadow-3",children:[(0,d.jsx)(X,{name:a.name,description:a.description,iconInfo:a.icon,chunkStructure:a.chunk_structure}),(0,d.jsx)(T,{onApplyTemplate:y,handleShowTemplateDetails:z,showMoreOperations:b,openEditModal:A,handleExportDSL:F,handleDelete:G}),k&&(0,d.jsx)(r.default,{isShow:k,onClose:B,className:"max-w-[520px] p-0",children:(0,d.jsx)(aj,{pipeline:a,onClose:B})}),m&&(0,d.jsx)(P.default,{title:e("deletePipeline.title",{ns:"datasetPipeline"}),content:e("deletePipeline.content",{ns:"datasetPipeline"}),isShow:m,onConfirm:K,onCancel:H}),o&&(0,d.jsx)(r.default,{isShow:o,onClose:C,className:"h-[calc(100vh-64px)] max-w-[1680px] rounded-3xl p-0",children:(0,d.jsx)(ag,{id:a.id,type:c,onClose:C,onApplyTemplate:y})})]})}),al=()=>{let a=(0,K.useLocale)(),b=(0,h.useMemo)(()=>["zh-Hans","ja-JP"].includes(a)?a:L.LanguagesSupported[0],[a]),c=(0,J.useGlobalPublicStore)(a=>a.systemFeatures.enable_marketplace),{data:e,isLoading:f}=(0,v.usePipelineTemplateList)({type:"built-in",language:b},c),g=e?.pipeline_templates||[];return(0,d.jsxs)("div",{className:"grid grid-cols-1 gap-3 py-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4",children:[(0,d.jsx)(O,{}),!f&&g.map((a,b)=>(0,d.jsx)(ak,{type:"built-in",pipeline:a,showMoreOperations:!1},b))]})},am=()=>{let{t:a}=(0,i.useTranslation)(),{data:b,isLoading:c}=(0,v.usePipelineTemplateList)({type:"customized"}),e=b?.pipeline_templates||[];return c||0===e.length?null:(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"system-sm-semibold-uppercase pt-2 text-text-tertiary",children:a("templates.customized",{ns:"datasetPipeline"})}),(0,d.jsx)("div",{className:"grid grid-cols-1 gap-3 py-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4",children:e.map((a,b)=>(0,d.jsx)(ak,{type:"customized",pipeline:a},b))})]})},an=()=>(0,d.jsxs)("div",{className:"grow gap-y-1 overflow-y-auto px-16 pb-[60px] pt-1",children:[(0,d.jsx)(al,{}),(0,d.jsx)(am,{})]});a.s(["default",0,()=>(0,d.jsxs)("div",{className:"relative flex h-[calc(100vh-56px)] flex-col overflow-hidden rounded-t-2xl border-t border-effects-highlight bg-background-default-subtle",children:[(0,d.jsx)(e.default,{className:"left-8 top-[-34px] opacity-20"}),(0,d.jsx)(I,{}),(0,d.jsx)(an,{}),(0,d.jsx)(G,{})]})],246302)}];

//# sourceMappingURL=app_components_datasets_create-from-pipeline_index_tsx_182e90a0._.js.map
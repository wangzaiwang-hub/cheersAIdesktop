module.exports=[799955,a=>{"use strict";let b,c,d,e,f;var g,h=a.i(314875),i=function(a,b){return(i=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])})(a,b)},j=function(){return(j=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c])Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a}).apply(this,arguments)};function k(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){var b;a.done?e(a.value):((b=a.value)instanceof c?b:new c(function(a){a(b)})).then(g,h)}i((d=d.apply(a,b||[])).next())})}function l(a,b){var c,d,e,f,g={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]};return f={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function h(h){return function(i){var j=[h,i];if(c)throw TypeError("Generator is already executing.");for(;f&&(f=0,j[0]&&(g=0)),g;)try{if(c=1,d&&(e=2&j[0]?d.return:j[0]?d.throw||((e=d.return)&&e.call(d),0):d.next)&&!(e=e.call(d,j[1])).done)return e;switch(d=0,e&&(j=[2&j[0],e.value]),j[0]){case 0:case 1:e=j;break;case 4:return g.label++,{value:j[1],done:!1};case 5:g.label++,d=j[1],j=[0];continue;case 7:j=g.ops.pop(),g.trys.pop();continue;default:if(!(e=(e=g.trys).length>0&&e[e.length-1])&&(6===j[0]||2===j[0])){g=0;continue}if(3===j[0]&&(!e||j[1]>e[0]&&j[1]<e[3])){g.label=j[1];break}if(6===j[0]&&g.label<e[1]){g.label=e[1],e=j;break}if(e&&g.label<e[2]){g.label=e[2],g.ops.push(j);break}e[2]&&g.ops.pop(),g.trys.pop();continue}j=b.call(a,g)}catch(a){j=[6,a],d=0}finally{c=e=0}if(5&j[0])throw j[1];return{value:j[0]?j[1]:void 0,done:!0}}}}function m(a){var b="function"==typeof Symbol&&Symbol.iterator,c=b&&a[b],d=0;if(c)return c.call(a);if(a&&"number"==typeof a.length)return{next:function(){return a&&d>=a.length&&(a=void 0),{value:a&&a[d++],done:!a}}};throw TypeError(b?"Object is not iterable.":"Symbol.iterator is not defined.")}"function"==typeof SuppressedError&&SuppressedError;var n="is not",o="contains",p="does not contain",q="less",r="less or equal",s="greater",t="greater or equal",u="version less",v="version less or equal",w="version greater",x="version greater or equal",y="set is",z="set is not",A="set contains",B="set does not contain",C="set contains any",D="set does not contain any",E=function(a){for(var b=[],c=0,d=0;d<a.length;d++){var e=a.charCodeAt(d);e<128?b[c++]=e:(e<2048?b[c++]=e>>6|192:((64512&e)==55296&&d+1<a.length&&(64512&a.charCodeAt(d+1))==56320?(e=65536+((1023&e)<<10)+(1023&a.charCodeAt(++d)),b[c++]=e>>18|240,b[c++]=e>>12&63|128):b[c++]=e>>12|224,b[c++]=e>>6&63|128),b[c++]=63&e|128)}return Uint8Array.from(b)},F=function(a,b){void 0===b&&(b=0);for(var c=E(a),d=c.length,e=d>>2,f=b,g=0;g<e;g++)f=G(J(c,g<<2),f);var h=e<<2,i=0;switch(d-h){case 3:i^=c[h+2]<<16,i^=c[h+1]<<8,i^=c[h],f^=i=Math.imul(i=I(i=Math.imul(i,-0x3361d2af),15),0x1b873593);break;case 2:i^=c[h+1]<<8,i^=c[h],f^=i=Math.imul(i=I(i=Math.imul(i,-0x3361d2af),15),0x1b873593);break;case 1:i^=c[h],f^=i=Math.imul(i=I(i=Math.imul(i,-0x3361d2af),15),0x1b873593)}return H(f^=d)>>>0},G=function(a,b){var c=a,d=b;return d^=c=Math.imul(c=I(c=Math.imul(c,-0x3361d2af),15),0x1b873593),(d=Math.imul(d=I(d,13),5))+-0x19ab949c|0},H=function(a){var b=a;return b^=b>>>16,b=Math.imul(b,-0x7a143595),b^=b>>>13,b=Math.imul(b,-0x3d4d51cb),b^=b>>>16},I=function(a,b,c){void 0===c&&(c=32),b>c&&(b%=c);var d=(a&0xffffffff<<c-b>>>0)>>>0>>>c-b>>>0;return(a<<b|d)>>>0},J=function(a,b){return void 0===b&&(b=0),K(a[b]<<24|a[b+1]<<16|a[b+2]<<8|a[b+3])},K=function(a){return(-0x1000000&a)>>>24|(0xff0000&a)>>>8|(65280&a)<<8|(255&a)<<24},L=function(a,b){var c,d;if(b&&0!==b.length){try{for(var e=m(b),f=e.next();!f.done;f=e.next()){var g=f.value;if(!g||!a||"object"!=typeof a)return;a=a[g]}}catch(a){c={error:a}}finally{try{f&&!f.done&&(d=e.return)&&d.call(e)}finally{if(c)throw c.error}}if(!a)return;return a}},M="^".concat("(\\d+)\\.(\\d+)","(\\.").concat("(\\d+)").concat("(-(([-\\w]+\\.?)*))?",")?$"),N=function(){function a(a,b,c,d){void 0===d&&(d=void 0),this.major=a,this.minor=b,this.patch=c,this.preRelease=d}return a.parse=function(b){if(b){var c=new RegExp(M).exec(b);if(c){var d=Number(c[1]),e=Number(c[2]);if(!(isNaN(d)||isNaN(e)))return new a(d,e,Number(c[4])||0,c[5]||void 0)}}},a.prototype.compareTo=function(a){if(this.major>a.major)return 1;if(this.major<a.major)return -1;if(this.minor>a.minor)return 1;if(this.minor<a.minor)return -1;if(this.patch>a.patch)return 1;if(this.patch<a.patch||this.preRelease&&!a.preRelease)return -1;if(!this.preRelease&&a.preRelease)return 1;if(this.preRelease&&a.preRelease){if(this.preRelease>a.preRelease)return 1;if(this.preRelease<a.preRelease)return -1}return 0},a}(),O=function(){function a(){}return a.prototype.evaluate=function(a,b){var c,d,e={},f={context:a,result:e};try{for(var g=m(b),h=g.next();!h.done;h=g.next()){var i=h.value,j=this.evaluateFlag(f,i);j&&(e[i.key]=j)}}catch(a){c={error:a}}finally{try{h&&!h.done&&(d=g.return)&&d.call(g)}finally{if(c)throw c.error}}return e},a.prototype.evaluateFlag=function(a,b){try{for(var c,d,e,f=m(b.segments),g=f.next();!g.done;g=f.next()){var h=g.value;if(e=this.evaluateSegment(a,b,h)){var i=j(j(j({},b.metadata),h.metadata),e.metadata);e=j(j({},e),{metadata:i});break}}}catch(a){c={error:a}}finally{try{g&&!g.done&&(d=f.return)&&d.call(f)}finally{if(c)throw c.error}}return e},a.prototype.evaluateSegment=function(a,b,c){var d,e,f,g;if(!c.conditions){var h=this.bucket(a,c);return void 0!==h?b.variants[h]:void 0}try{for(var i=m(c.conditions),j=i.next();!j.done;j=i.next()){var k=j.value,l=!0;try{for(var n=(f=void 0,m(k)),o=n.next();!o.done;o=n.next()){var p=o.value;if(!(l=this.matchCondition(a,p)))break}}catch(a){f={error:a}}finally{try{o&&!o.done&&(g=n.return)&&g.call(n)}finally{if(f)throw f.error}}if(l){var h=this.bucket(a,c);if(void 0!==h)return b.variants[h];return}}}catch(a){d={error:a}}finally{try{j&&!j.done&&(e=i.return)&&e.call(i)}finally{if(d)throw d.error}}},a.prototype.matchCondition=function(a,b){var c=L(a,b.selector);if(!c)return this.matchNull(b.op,b.values);if(this.isSetOperator(b.op)){var d=this.coerceStringArray(c);return!!d&&this.matchSet(d,b.op,b.values)}var e=this.coerceString(c);return void 0!==e&&this.matchString(e,b.op,b.values)},a.prototype.getHash=function(a){return F(a)},a.prototype.bucket=function(a,b){if(!b.bucket)return b.variant;var c,d,e,f,g=this.coerceString(L(a,b.bucket.selector));if(!g||0===g.length)return b.variant;var h="".concat(b.bucket.salt,"/").concat(g),i=this.getHash(h),j=i%100,k=Math.floor(i/100);try{for(var l=m(b.bucket.allocations),n=l.next();!n.done;n=l.next()){var o=n.value,p=o.range[0],q=o.range[1];if(j>=p&&j<q)try{for(var r=(e=void 0,m(o.distributions)),s=r.next();!s.done;s=r.next()){var t=s.value,u=t.range[0],v=t.range[1];if(k>=u&&k<v)return t.variant}}catch(a){e={error:a}}finally{try{s&&!s.done&&(f=r.return)&&f.call(r)}finally{if(e)throw e.error}}}}catch(a){c={error:a}}finally{try{n&&!n.done&&(d=l.return)&&d.call(l)}finally{if(c)throw c.error}}return b.variant},a.prototype.matchNull=function(a,b){var c=this.containsNone(b);switch(a){case"is":case o:case q:case r:case s:case t:case u:case v:case w:case x:case y:case A:case C:return c;case n:case p:case B:case D:return!c;default:return!1}},a.prototype.matchSet=function(a,b,c){switch(b){case y:return this.setEquals(a,c);case z:return!this.setEquals(a,c);case A:return this.matchesSetContainsAll(a,c);case B:return!this.matchesSetContainsAll(a,c);case C:return this.matchesSetContainsAny(a,c);case D:return!this.matchesSetContainsAny(a,c);default:return!1}},a.prototype.matchString=function(a,b,c){var d=this;switch(b){case"is":return this.matchesIs(a,c);case n:return!this.matchesIs(a,c);case o:return this.matchesContains(a,c);case p:return!this.matchesContains(a,c);case q:case r:case s:case t:return this.matchesComparable(a,b,c,function(a){return d.parseNumber(a)},this.comparator);case u:case v:case w:case x:return this.matchesComparable(a,b,c,function(a){return N.parse(a)},this.versionComparator);case"regex match":return this.matchesRegex(a,c);case"regex does not match":return!this.matchesRegex(a,c);default:return!1}},a.prototype.matchesIs=function(a,b){if(this.containsBooleans(b)){var c=a.toLowerCase();if("true"===c||"false"===c)return b.some(function(a){return a.toLowerCase()===c})}return b.some(function(b){return a===b})},a.prototype.matchesContains=function(a,b){var c,d;try{for(var e=m(b),f=e.next();!f.done;f=e.next()){var g=f.value;if(a.toLowerCase().includes(g.toLowerCase()))return!0}}catch(a){c={error:a}}finally{try{f&&!f.done&&(d=e.return)&&d.call(e)}finally{if(c)throw c.error}}return!1},a.prototype.matchesComparable=function(a,b,c,d,e){var f=this,g=d(a),h=c.map(function(a){return d(a)}).filter(function(a){return void 0!==a});return void 0===g||0===h.length?c.some(function(c){return f.comparator(a,b,c)}):h.some(function(a){return e(g,b,a)})},a.prototype.comparator=function(a,b,c){switch(b){case q:case u:return a<c;case r:case v:return a<=c;case s:case w:return a>c;case t:case x:return a>=c;default:return!1}},a.prototype.versionComparator=function(a,b,c){var d=a.compareTo(c);switch(b){case q:case u:return d<0;case r:case v:return d<=0;case s:case w:return d>0;case t:case x:return d>=0;default:return!1}},a.prototype.matchesRegex=function(a,b){return b.some(function(b){return!!new RegExp(b).exec(a)})},a.prototype.containsNone=function(a){return a.some(function(a){return"(none)"===a})},a.prototype.containsBooleans=function(a){return a.some(function(a){switch(a.toLowerCase()){case"true":case"false":return!0;default:return!1}})},a.prototype.parseNumber=function(a){var b;return null!=(b=Number(a))?b:void 0},a.prototype.coerceString=function(a){if(a)return"object"==typeof a?JSON.stringify(a):String(a)},a.prototype.coerceStringArray=function(a){var b=this;if(Array.isArray(a)){var c=a;return c.map(function(a){return b.coerceString(a)}).filter(Boolean)}var d=String(a);try{var e=JSON.parse(d);if(!Array.isArray(e))return;var c=a;return c.map(function(a){return b.coerceString(a)}).filter(Boolean)}catch(a){return}},a.prototype.isSetOperator=function(a){switch(a){case y:case z:case A:case B:case C:case D:return!0;default:return!1}},a.prototype.setEquals=function(a,b){var c=new Set(a),d=new Set(b);return c.size===d.size&&(function(a,b,c){if(c||2==arguments.length)for(var d,e=0,f=b.length;e<f;e++)!d&&e in b||(d||(d=Array.prototype.slice.call(b,0,e)),d[e]=b[e]);return a.concat(d||Array.prototype.slice.call(b))})([],function(a,b){var c="function"==typeof Symbol&&a[Symbol.iterator];if(!c)return a;var d,e,f=c.call(a),g=[];try{for(;(void 0===b||b-- >0)&&!(d=f.next()).done;)g.push(d.value)}catch(a){e={error:a}}finally{try{d&&!d.done&&(c=f.return)&&c.call(f)}finally{if(e)throw e.error}}return g}(d),!1).every(function(a){return c.has(a)})},a.prototype.matchesSetContainsAll=function(a,b){var c,d;if(a.length<b.length)return!1;try{for(var e=m(b),f=e.next();!f.done;f=e.next()){var g=f.value;if(!this.matchesIs(g,a))return!1}}catch(a){c={error:a}}finally{try{f&&!f.done&&(d=e.return)&&d.call(e)}finally{if(c)throw c.error}}return!0},a.prototype.matchesSetContainsAny=function(a,b){var c,d;try{for(var e=m(b),f=e.next();!f.done;f=e.next()){var g=f.value;if(this.matchesIs(g,a))return!0}}catch(a){c={error:a}}finally{try{f&&!f.done&&(d=e.return)&&d.call(e)}finally{if(c)throw c.error}}return!1},a}();let P="function"==typeof atob,Q="function"==typeof btoa,R="function"==typeof Buffer,S="function"==typeof TextDecoder?new TextDecoder:void 0,T="function"==typeof TextEncoder?new TextEncoder:void 0,U=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),V=(d={},U.forEach((a,b)=>d[a]=b),d),W=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,X=String.fromCharCode.bind(String),Y="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):a=>new Uint8Array(Array.prototype.slice.call(a,0)),Z=a=>a.replace(/=/g,"").replace(/[+\/]/g,a=>"+"==a?"-":"_"),$=Q?a=>btoa(a):R?a=>Buffer.from(a,"binary").toString("base64"):a=>{let b,c,d,e,f="",g=a.length%3;for(let g=0;g<a.length;){if((c=a.charCodeAt(g++))>255||(d=a.charCodeAt(g++))>255||(e=a.charCodeAt(g++))>255)throw TypeError("invalid character found");f+=U[(b=c<<16|d<<8|e)>>18&63]+U[b>>12&63]+U[b>>6&63]+U[63&b]}return g?f.slice(0,g-3)+"===".substring(g):f},_=R?a=>Buffer.from(a).toString("base64"):a=>{let b=[];for(let c=0,d=a.length;c<d;c+=4096)b.push(X.apply(null,a.subarray(c,c+4096)));return $(b.join(""))},aa=a=>{if(a.length<2){var b=a.charCodeAt(0);return b<128?a:b<2048?X(192|b>>>6)+X(128|63&b):X(224|b>>>12&15)+X(128|b>>>6&63)+X(128|63&b)}var b=65536+(a.charCodeAt(0)-55296)*1024+(a.charCodeAt(1)-56320);return X(240|b>>>18&7)+X(128|b>>>12&63)+X(128|b>>>6&63)+X(128|63&b)},ab=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,ac=R?a=>Buffer.from(a,"utf8").toString("base64"):T?a=>_(T.encode(a)):a=>$(a.replace(ab,aa)),ad=(a,b=!1)=>b?Z(ac(a)):ac(a),ae=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,af=a=>{switch(a.length){case 4:var b=((7&a.charCodeAt(0))<<18|(63&a.charCodeAt(1))<<12|(63&a.charCodeAt(2))<<6|63&a.charCodeAt(3))-65536;return X((b>>>10)+55296)+X((1023&b)+56320);case 3:return X((15&a.charCodeAt(0))<<12|(63&a.charCodeAt(1))<<6|63&a.charCodeAt(2));default:return X((31&a.charCodeAt(0))<<6|63&a.charCodeAt(1))}},ag=P?a=>atob(a.replace(/[^A-Za-z0-9\+\/]/g,"")):R?a=>Buffer.from(a,"base64").toString("binary"):a=>{if(a=a.replace(/\s+/g,""),!W.test(a))throw TypeError("malformed base64.");a+="==".slice(2-(3&a.length));let b,c="",d,e;for(let f=0;f<a.length;)b=V[a.charAt(f++)]<<18|V[a.charAt(f++)]<<12|(d=V[a.charAt(f++)])<<6|(e=V[a.charAt(f++)]),c+=64===d?X(b>>16&255):64===e?X(b>>16&255,b>>8&255):X(b>>16&255,b>>8&255,255&b);return c},ah=R?a=>Y(Buffer.from(a,"base64")):a=>Y(ag(a).split("").map(a=>a.charCodeAt(0))),ai=R?a=>Buffer.from(a,"base64").toString("utf8"):S?a=>S.decode(ah(a)):a=>ag(a).replace(ae,af);var aj=function(a){if("function"!=typeof a&&null!==a)throw TypeError("Class extends value "+String(a)+" is not a constructor or null");function b(){this.constructor=c}function c(b,d){var e=a.call(this,d)||this;return e.statusCode=b,Object.setPrototypeOf(e,c.prototype),e}return i(c,a),c.prototype=null===a?Object.create(a):(b.prototype=a.prototype,new b),c}(Error);(function(a,b,c){this.deploymentKey=a,this.serverUrl=b,this.httpClient=c}).prototype.getVariants=function(a,b){return k(this,void 0,void 0,function(){var c,d,e;return l(this,function(f){switch(f.label){case 0:return c=ad(JSON.stringify(a),!0),d={Authorization:"Api-Key ".concat(this.deploymentKey),"X-Amp-Exp-User":c},(null==b?void 0:b.flagKeys)&&(d["X-Amp-Exp-Flag-Keys"]=ad(JSON.stringify(b.flagKeys),!0)),(null==b?void 0:b.trackingOption)&&(d["X-Amp-Exp-Track"]=b.trackingOption),[4,this.httpClient.request({requestUrl:"".concat(this.serverUrl,"/sdk/v2/vardata?v=0"),method:"GET",headers:d,timeoutMillis:null==b?void 0:b.timeoutMillis})];case 1:if(200!=(e=f.sent()).status)throw new aj(e.status,"Fetch error response: status=".concat(e.status));return[2,JSON.parse(e.body)]}})})},(function(a,b,c){this.deploymentKey=a,this.serverUrl=b,this.httpClient=c}).prototype.getFlags=function(a){return k(this,void 0,void 0,function(){var b,c;return l(this,function(d){switch(d.label){case 0:return b={Authorization:"Api-Key ".concat(this.deploymentKey)},(null==a?void 0:a.libraryName)&&(null==a?void 0:a.libraryVersion)&&(b["X-Amp-Exp-Library"]="".concat(a.libraryName,"/").concat(a.libraryVersion)),[4,this.httpClient.request({requestUrl:"".concat(this.serverUrl,"/sdk/v2/flags"),method:"GET",headers:b,timeoutMillis:null==a?void 0:a.timeoutMillis})];case 1:if(200!=(c=d.sent()).status)throw Error("Flags error response: status=".concat(c.status));return[2,JSON.parse(c.body).reduce(function(a,b){return a[b.key]=b,a},{})]}})})};var ak="u">typeof globalThis?globalThis:a.g||self;function al(a,b){this.poller=void 0,this.action=a,this.ms=b}al.prototype.start=function(){this.poller||(this.poller=ak.setInterval(this.action,this.ms),this.action())},al.prototype.stop=function(){this.poller&&(ak.clearInterval(this.poller),this.poller=void 0)};let am=(a,b)=>b.some(b=>a instanceof b),an=new WeakMap,ao=new WeakMap,ap=new WeakMap,aq={get(a,b,c){if(a instanceof IDBTransaction){if("done"===b)return an.get(a);if("store"===b)return c.objectStoreNames[1]?void 0:c.objectStore(c.objectStoreNames[0])}return ar(a[b])},set:(a,b,c)=>(a[b]=c,!0),has:(a,b)=>a instanceof IDBTransaction&&("done"===b||"store"===b)||b in a};function ar(a){if(a instanceof IDBRequest){let b;return b=new Promise((b,c)=>{let d=()=>{a.removeEventListener("success",e),a.removeEventListener("error",f)},e=()=>{b(ar(a.result)),d()},f=()=>{c(a.error),d()};a.addEventListener("success",e),a.addEventListener("error",f)}),ap.set(b,a),b}if(ao.has(a))return ao.get(a);let d=function(a){if("function"==typeof a)return(c||(c=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(a)?function(...b){return a.apply(as(this),b),ar(this.request)}:function(...b){return ar(a.apply(as(this),b))};return(a instanceof IDBTransaction&&function(a){if(an.has(a))return;let b=new Promise((b,c)=>{let d=()=>{a.removeEventListener("complete",e),a.removeEventListener("error",f),a.removeEventListener("abort",f)},e=()=>{b(),d()},f=()=>{c(a.error||new DOMException("AbortError","AbortError")),d()};a.addEventListener("complete",e),a.addEventListener("error",f),a.addEventListener("abort",f)});an.set(a,b)}(a),am(a,b||(b=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(a,aq):a}(a);return d!==a&&(ao.set(a,d),ap.set(d,a)),d}let as=a=>ap.get(a),at=["get","getKey","getAll","getAllKeys","count"],au=["put","add","delete","clear"],av=new Map;function aw(a,b){if(!(a instanceof IDBDatabase&&!(b in a)&&"string"==typeof b))return;if(av.get(b))return av.get(b);let c=b.replace(/FromIndex$/,""),d=b!==c,e=au.includes(c);if(!(c in(d?IDBIndex:IDBObjectStore).prototype)||!(e||at.includes(c)))return;let f=async function(a,...b){let f=this.transaction(a,e?"readwrite":"readonly"),g=f.store;return d&&(g=g.index(b.shift())),(await Promise.all([g[c](...b),e&&f.done]))[0]};return av.set(b,f),f}aq={...e=aq,get:(a,b,c)=>aw(a,b)||e.get(a,b,c),has:(a,b)=>!!aw(a,b)||e.has(a,b)};let ax=["continue","continuePrimaryKey","advance"],ay={},az=new WeakMap,aA=new WeakMap,aB={get(a,b){if(!ax.includes(b))return a[b];let c=ay[b];return c||(c=ay[b]=function(...a){az.set(this,aA.get(this)[b](...a))}),c}};async function*aC(...a){let b=this;if(b instanceof IDBCursor||(b=await b.openCursor(...a)),!b)return;let c=new Proxy(b,aB);for(aA.set(c,b),ap.set(c,as(b));b;)yield c,b=await (az.get(c)||b.continue()),az.delete(c)}function aD(a,b){return b===Symbol.asyncIterator&&am(a,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===b&&am(a,[IDBIndex,IDBObjectStore])}aq={...f=aq,get:(a,b,c)=>aD(a,b)?aC:f.get(a,b,c),has:(a,b)=>aD(a,b)||f.has(a,b)};var aE=new function(){var a=this;this.dbs={},this.createStore=function(b){return(0,h.__awaiter)(a,void 0,void 0,function(){return(0,h.__generator)(this,function(a){switch(a.label){case 0:return[4,function(a,b,{blocked:c,upgrade:d,blocking:e,terminated:f}={}){let g=indexedDB.open(a,1),h=ar(g);return d&&g.addEventListener("upgradeneeded",a=>{d(ar(g.result),a.oldVersion,a.newVersion,ar(g.transaction),a)}),c&&g.addEventListener("blocked",a=>c(a.oldVersion,a.newVersion,a)),h.then(a=>{f&&a.addEventListener("close",()=>f()),e&&a.addEventListener("versionchange",a=>e(a.oldVersion,a.newVersion,a))}).catch(()=>{}),h}(b,0,{upgrade:function(a){a.objectStoreNames.contains("eventTypesForSession")||a.createObjectStore("eventTypesForSession",{keyPath:"sessionId"})}})];case 1:return[2,a.sent()]}})})},this.openOrCreateDB=function(b){return(0,h.__awaiter)(a,void 0,void 0,function(){var a,c;return(0,h.__generator)(this,function(d){switch(d.label){case 0:if(this.dbs&&this.dbs[b])return[2,this.dbs[b]];return a="".concat(b.substring(0,10),"_amp_targeting"),[4,this.createStore(a)];case 1:return c=d.sent(),this.dbs[b]=c,[2,c]}})})},this.updateEventListForSession=function(b){var c=b.sessionId,d=b.eventType,e=b.eventTime,f=b.loggerProvider,g=b.tx;return(0,h.__awaiter)(a,void 0,void 0,function(){var a,b,i,j,k,l,m;return(0,h.__generator)(this,function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),[4,g.store.get(c)];case 1:return i=(b=(a=n.sent())?a.eventTypes:{})[d]||{},j=(0,h.__assign)((0,h.__assign)({},b),((l={})[d]=(0,h.__assign)((0,h.__assign)({},i),((m={})[e]={event_type:d},m)),l)),[4,g.store.put({sessionId:c,eventTypes:j})];case 2:return n.sent(),[2,j];case 3:return k=n.sent(),f.warn("Failed to store events for targeting ".concat(c,": ").concat(k)),[3,4];case 4:return[2,void 0]}})})},this.deleteOldSessionEventTypes=function(b){var c=b.currentSessionId,d=b.loggerProvider,e=b.tx;return(0,h.__awaiter)(a,void 0,void 0,function(){var a,b,f,g,i;return(0,h.__generator)(this,function(h){switch(h.label){case 0:return h.trys.push([0,6,,7]),[4,e.store.getAll()];case 1:a=h.sent(),b=0,h.label=2;case 2:if(!(b<a.length))return[3,5];if(f=a[b],g=Date.now()-f.sessionId,!(f.sessionId!==c&&g>1728e5))return[3,4];return[4,e.store.delete(f.sessionId)];case 3:h.sent(),h.label=4;case 4:return b++,[3,2];case 5:return[3,7];case 6:return i=h.sent(),d.warn("Failed to clear old session events for targeting: ".concat(i)),[3,7];case 7:return[2]}})})},this.storeEventTypeForSession=function(b){var c=b.loggerProvider,d=b.sessionId,e=b.eventType,f=b.eventTime,g=b.apiKey;return(0,h.__awaiter)(a,void 0,void 0,function(){var a,b,i;return(0,h.__generator)(this,function(h){switch(h.label){case 0:return h.trys.push([0,5,,6]),[4,this.openOrCreateDB(g)];case 1:if(!(a=h.sent().transaction("eventTypesForSession","readwrite")))return[2];return[4,this.updateEventListForSession({sessionId:d,tx:a,loggerProvider:c,eventType:e,eventTime:f})];case 2:return b=h.sent(),[4,this.deleteOldSessionEventTypes({currentSessionId:d,tx:a,loggerProvider:c})];case 3:return h.sent(),[4,a.done];case 4:return h.sent(),[2,b];case 5:return i=h.sent(),c.warn("Failed to store events for targeting ".concat(d,": ").concat(i)),[3,6];case 6:return[2,void 0]}})})}},aF={evaluateTargeting:(g=new function(){var a=this;this.evaluateTargeting=function(b){var c=b.apiKey,d=b.loggerProvider,e=b.event,f=b.sessionId,g=b.userProperties,i=b.deviceId,j=b.flag;return(0,h.__awaiter)(a,void 0,void 0,function(){var a,b,k,l;return(0,h.__generator)(this,function(h){switch(h.label){case 0:if(!(e&&e.time))return[3,2];return[4,aE.storeEventTypeForSession({loggerProvider:d,apiKey:c,sessionId:f,eventType:e.event_type,eventTime:e.time})];case 1:return b=h.sent(),[3,3];case 2:b=void 0,h.label=3;case 3:return l={session_id:f,event:e,event_types:(k=(a=b)&&new Set(Object.keys(a)))&&Array.from(k),user:{device_id:i,user_properties:g}},[2,this.evaluationEngine.evaluate(l,[j])]}})})},this.evaluationEngine=new O}).evaluateTargeting.bind(g)}.evaluateTargeting;a.s(["evaluateTargeting",()=>aF],799955)}];

//# sourceMappingURL=45478_%40amplitude_targeting_lib_esm_index_692bde65.js.map
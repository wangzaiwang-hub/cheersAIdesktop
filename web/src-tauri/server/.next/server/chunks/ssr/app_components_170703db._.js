module.exports=[826009,a=>{"use strict";var b=a.i(834934);a.s(["ChevronSelectorVertical",()=>b.default])},500878,123009,a=>{"use strict";var b=a.i(608061),c=a.i(429150),d=a.i(57843),e=a.i(527344);let f=d.memo(({className:a,onClick:d})=>(0,b.jsx)("div",{className:(0,e.cn)(a,"cursor-pointer select-none rounded-md p-1 hover:bg-state-base-hover"),onClick:d,children:(0,b.jsx)(c.RiAddLine,{className:"h-4 w-4 text-text-tertiary"})}));a.s(["default",0,f],500878);var g=a.i(749254);a.s(["Line3",()=>g.default],123009)},597209,60732,253102,325586,a=>{"use strict";var b=a.i(608061),c=a.i(429150),d=a.i(111089),e=a.i(494261),f=a.i(57843);a.i(752298);var g=a.i(693025),h=a.i(970502),i=a.i(218865),j=a.i(500878);a.i(916818);var k=a.i(123009);a.i(805980);var l=a.i(634919),m=a.i(825319),n=a.i(483664),o=a.i(933988),p=a.i(438961),q=a.i(252613);a.i(529638);var r=a.i(829781),s=a.i(35176),t=a.i(497746),u=a.i(617633);a.i(943046);var v=a.i(826009);a.i(622666);var w=a.i(332945),x=a.i(527344);let y=f.memo(({className:a,trigger:c,DropDownIcon:d=v.ChevronSelectorVertical,noLeft:e,options:g,allOptions:h,value:i,placeholder:j="",onChange:k,uppercase:l,triggerClassName:m,popupClassName:n,itemClassName:o,readonly:p,showChecked:q})=>{let r=""===i||null==i,s=h?h.find(a=>a.value===i):g.find(a=>a.value===i),[y,{setFalse:z,toggle:A}]=(0,t.useBoolean)(!1),B=f.useRef(null);return(0,u.useClickAway)(()=>{z()},B),(0,b.jsxs)("div",{className:(0,x.cn)(!c&&!e&&"left-[-8px]","relative select-none",a),ref:B,children:[c?(0,b.jsx)("div",{onClick:A,className:(0,x.cn)(!p&&"cursor-pointer"),children:c}):(0,b.jsxs)("div",{onClick:A,className:(0,x.cn)(y&&"bg-state-base-hover","flex h-5 cursor-pointer items-center rounded-md pl-1 pr-0.5 text-xs font-semibold text-text-secondary hover:bg-state-base-hover"),children:[(0,b.jsx)("div",{className:(0,x.cn)("text-sm font-semibold",l&&"uppercase",r&&"text-text-tertiary",m),children:r?j:s?.label}),!p&&(0,b.jsx)(d,{className:"h-3 w-3 "})]}),y&&!p&&(0,b.jsx)("div",{className:(0,x.cn)("absolute top-[24px] z-10 w-[120px]  select-none rounded-lg border border-components-panel-border bg-components-panel-bg p-1 shadow-lg",n),children:g.map(a=>(0,b.jsxs)("div",{onClick:()=>{z(),k(a.value)},className:(0,x.cn)(o,l&&"uppercase","flex h-[30px] min-w-[44px] cursor-pointer items-center justify-between rounded-lg px-3 text-[13px] font-medium text-text-secondary hover:bg-state-base-hover"),children:[(0,b.jsx)("div",{children:a.label}),q&&a.value===i&&(0,b.jsx)(w.Check,{className:"h-4 w-4 text-text-primary"})]},a.value))})]})});a.s(["default",0,y],60732),a.i(963284);var z=a.i(304905);a.i(207642);var A=a.i(315680),B=a.i(735310);a.i(713310);var C=a.i(81862),D=a.i(781362),E=a.i(849546),F=a.i(175809);let G=f.memo(({onClick:a})=>(0,b.jsx)(F.default,{size:"l",className:"group shrink-0 hover:!bg-state-destructive-hover",onClick:a,children:(0,b.jsx)(c.RiDeleteBinLine,{className:"h-4 w-4 text-text-tertiary group-hover:text-text-destructive"})}));a.s(["default",0,G],253102);var H=a.i(805611),I=a.i(701458);let J={},K=f.memo(({schema:a=J,readonly:c,value:d,onChange:e,onOpenChange:g,isLoading:h})=>{let i=(0,I.useLanguage)(),j=a.placeholder,k=(0,f.useCallback)(a=>{e(""===a.target.value?"":Number.parseFloat(a.target.value),A.VarType.constant)},[e]),l=(0,f.useCallback)(a=>{e(a=null===a?"":a,A.VarType.constant)},[e]);return(0,b.jsxs)(b.Fragment,{children:[(a.type===o.FormTypeEnum.select||a.type===o.FormTypeEnum.dynamicSelect)&&(0,b.jsx)(H.SimpleSelect,{wrapperClassName:"w-full !h-8",className:"flex items-center",disabled:c,defaultValue:d,items:a.options.map(a=>({value:a.value,name:a.label[i]||a.label.en_US})),onSelect:a=>l(a.value),placeholder:j?.[i]||j?.en_US,onOpenChange:g,isLoading:h}),a.type===o.FormTypeEnum.textNumber&&(0,b.jsx)("input",{type:"number",className:"h-8 w-full overflow-hidden rounded-lg bg-workflow-block-parma-bg p-2 text-[13px] font-normal leading-8 text-text-secondary placeholder:text-gray-400 focus:outline-none",value:d,onChange:k,readOnly:c,placeholder:j?.[i]||j?.en_US,min:a.min,max:a.max})]})});var L=a.i(986963),M=a.i(294057);let N=({className:a})=>(0,b.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"240",height:"2",viewBox:"0 0 240 2",fill:"none",className:a,children:[(0,b.jsx)("path",{d:"M0 1H240",stroke:"url(#paint0_linear_8619_59125)"}),(0,b.jsx)("defs",{children:(0,b.jsxs)("linearGradient",{id:"paint0_linear_8619_59125",x1:"240",y1:"9.99584",x2:"3.95539e-05",y2:"9.88094",gradientUnits:"userSpaceOnUse",children:[(0,b.jsx)("stop",{stopColor:"white",stopOpacity:"0.01"}),(0,b.jsx)("stop",{offset:"0.9031",stopColor:"#101828",stopOpacity:"0.04"}),(0,b.jsx)("stop",{offset:"1",stopColor:"white",stopOpacity:"0.01"})]})})]}),O=({className:a})=>(0,b.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"2",height:"132",viewBox:"0 0 2 132",fill:"none",className:a,children:[(0,b.jsx)("path",{d:"M1 0L1 132",stroke:"url(#paint0_linear_8619_59128)"}),(0,b.jsx)("defs",{children:(0,b.jsxs)("linearGradient",{id:"paint0_linear_8619_59128",x1:"-7.99584",y1:"132",x2:"-7.96108",y2:"6.4974e-07",gradientUnits:"userSpaceOnUse",children:[(0,b.jsx)("stop",{stopColor:"white",stopOpacity:"0.01"}),(0,b.jsx)("stop",{offset:"0.877606",stopColor:"#101828",stopOpacity:"0.04"}),(0,b.jsx)("stop",{offset:"1",stopColor:"white",stopOpacity:"0.01"})]})})]}),P=({title:a,description:c,icon:d})=>(0,b.jsxs)("div",{className:"flex w-[320px] flex-col items-start gap-2 rounded-[10px] bg-workflow-process-bg p-4",children:[(0,b.jsx)("div",{className:"flex h-10 w-10 items-center justify-center gap-2 rounded-[10px]",children:(0,b.jsxs)("div",{className:"relative flex grow items-center justify-center gap-2 self-stretch rounded-[10px] border-[0.5px] border-components-card-border bg-components-card-bg p-1 shadow-lg",children:[d||(0,b.jsx)(l.Variable02,{className:"h-5 w-5 shrink-0 text-text-accent"}),(0,b.jsx)(O,{className:"absolute -right-[1px] top-1/2 -translate-y-1/4"}),(0,b.jsx)(O,{className:"absolute -left-[1px] top-1/2 -translate-y-1/4"}),(0,b.jsx)(N,{className:"absolute left-3/4 top-0 -translate-x-1/4 -translate-y-1/2"}),(0,b.jsx)(N,{className:"absolute left-3/4 top-full -translate-x-1/4 -translate-y-1/2"})]})}),(0,b.jsxs)("div",{className:"flex flex-col items-start gap-1 self-stretch",children:[(0,b.jsx)("div",{className:"system-sm-medium text-text-secondary",children:a}),c]})]});a.s(["default",0,P],325586),a.i(412708);var Q=a.i(851571),R=a.i(697638);let S=f.memo(({vars:a,popupFor:c,onChange:d,itemWidth:e,isSupportFileVar:h=!0,zIndex:i,preferSchemaType:j})=>{let{t:k}=(0,g.useTranslation)(),l=(0,Q.useStore)(a=>a.pipelineId),m=(0,f.useMemo)(()=>!!l,[l]),n=(0,Q.useStore)(a=>a.setShowInputFieldPanel);return(0,b.jsx)("div",{className:"space-y-1 rounded-lg border border-components-panel-border bg-components-panel-bg p-1 shadow-lg",style:{width:e||228},children:(!a||0===a.length)&&c?"toAssigned"===c?(0,b.jsx)(P,{title:k("variableReference.noAvailableVars",{ns:"workflow"})||"",description:(0,b.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:k("variableReference.noVarsForOperation",{ns:"workflow"})})}):(0,b.jsx)(P,{title:k("variableReference.noAssignedVars",{ns:"workflow"})||"",description:(0,b.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:k("variableReference.assignedVarsDescription",{ns:"workflow"})})}):(0,b.jsx)(R.default,{searchBoxClassName:"mt-1",vars:a,onChange:d,itemWidth:e,isSupportFileVar:h,zIndex:i,showManageInputField:m,onManageInputField:()=>n?.(!0),preferSchemaType:j})})}),T=[],U=f.memo(({nodeId:a,readonly:t,className:u,isShowNodeName:v=!0,value:w=T,onOpen:F=d.noop,onChange:H,isSupportConstantValue:I,defaultVarKindType:J=A.VarType.constant,onlyLeafNodeVar:N,filterVar:O=()=>!0,isFilterFileVar:P,availableNodes:Q,availableVars:R,isAddBtnTrigger:U,schema:V,valueTypePlaceHolder:W,isInTable:X,onRemove:Y,typePlaceHolder:Z,isSupportFileVar:$=!0,placeholder:_,minWidth:aa,popupFor:ab,zIndex:ac,currentTool:ad,currentProvider:ae,preferSchemaType:af})=>{let ag,ah,{t:ai}=(0,g.useTranslation)(),aj=(0,h.useStoreApi)(),ak=(0,h.useNodes)(),al=(0,r.useIsChatMode)(),{getCurrentVariableType:am}=(0,s.useWorkflowVariables)(),{availableVars:an,availableNodesWithParent:ao}=(0,E.default)(a,{onlyLeafNodeVar:N,passedInAvailableNodes:Q,filterVar:O}),ap=(0,h.useReactFlow)(),aq=ao.find(a=>a.data.type===B.BlockEnum.Start),ar=ak.find(b=>b.id===a),as=!!ar?.data?.isInIteration,at=as?ak.find(a=>a.id===ar?.parentId):null,au=!!ar?.data?.isInLoop,av=au?ak.find(a=>a.id===ar?.parentId):null,aw=(0,f.useRef)(null),[ax,ay]=(0,f.useState)(227);(0,f.useEffect)(()=>{aw.current&&ay(aw.current.clientWidth)},[aw.current]);let[az,aA]=(0,f.useState)(J),aB=I&&az===A.VarType.constant,aC=(0,f.useMemo)(()=>{let a=R||an;return P?(0,L.removeFileVars)(a):a},[R,an,P]),[aD,aE]=(0,f.useState)(!1);(0,f.useEffect)(()=>{F()},[aD]);let aF=!aB&&w.length>0,aG=(0,f.useMemo)(()=>!!as&&!!(w[0]===ar?.parentId&&["item","index"].includes(w[1])),[as,w,ar]),aH=(0,f.useMemo)(()=>!!au&&!!(w[0]===ar?.parentId&&["item","index"].includes(w[1])),[au,w,ar]),aI=aF?w[0]:"",aJ=(0,f.useMemo)(()=>{if(!aF||aB)return null;if(aG)return at?.data;if(aH)return av?.data;if((0,L.isSystemVar)(w))return aq?.data;let a=(0,L.getNodeInfoById)(ao,aI)?.data;if(a)return{...a,id:aI}},[w,aF,aB,aG,at,ao,aI,aq,aH,av]),aK=w.length>2&&!(0,L.isRagVariableVar)(w),aL=(0,f.useMemo)(()=>{if(!aF)return"";let a=q.VAR_SHOW_NAME_MAP[w.join(".")];if(a)return a;let b=(0,L.isSystemVar)(w),c=Array.isArray(w)?w[w.length-1]:"";return`${b?"sys.":""}${c}`},[aF,w]),aM=[{label:"Variable",value:A.VarType.variable},{label:"Constant",value:A.VarType.constant}],aN=(0,f.useCallback)(a=>{aA(a),a===A.VarType.constant?H("",a):H([],a)},[H]),aO=(0,f.useRef)(null),[aP,aQ]=(0,f.useState)(!1),[aR,aS]=(0,f.useState)(0);(0,f.useEffect)(()=>{aR&&aO.current&&(aO.current.focus(),aQ(!0))},[aR]);let aT=(0,f.useCallback)((a,b)=>{H((0,e.produce)(a,a=>{a[1]&&a[1].startsWith("sys.")&&(a.shift(),a[0].split(".").forEach((b,c)=>{a[c]=b}))}),az,b),aE(!1)},[H,az]),aU=(0,f.useCallback)(()=>{az===A.VarType.constant?H("",az):H([],az)},[H,az]),aV=(0,f.useCallback)(a=>{let b=ao.findIndex(b=>b.id===a),c=ao[b],{clientWidth:d,clientHeight:e}=document.getElementById("workflow-container"),{setViewport:f}=ap,{transform:g}=aj.getState(),h=g[2],i=c.position;f({x:(d-400-c.width*h)/2-i.x*h,y:(e-c.height*h)/2-i.y*h,zoom:g[2]})},[ao,ap,aj]),aW=am({parentNode:as?at:av,valueSelector:w,availableNodes:ao,isChatMode:al,isConstant:!!aB,preferSchemaType:af}),{isEnv:aX,isChatVar:aY,isGlobal:aZ,isRagVar:a$,isValidVar:a_,isException:a0}=(0,f.useMemo)(()=>{let a=(0,L.isENV)(w),b=(0,L.isConversationVar)(w),c=(0,L.isGlobalVar)(w),d=(0,L.isRagVariableVar)(w),e=!!aJ||a||b||c||d;return{isEnv:a,isChatVar:b,isGlobal:c,isRagVar:d,isValidVar:e,isException:(0,C.isExceptionVariable)(aL,aJ?.type)}},[w,aJ,aL]),a1=ax-56,[a2,a3,a4]=(ag=((aJ?.title||"")+(aL||"")+(aW||"")).length,ah=15+Math.floor((aJ?.title?.length||0)/ag*a1),[ah,-15+Math.floor((aL?.length||0)/ag*a1),Math.floor((aW?.length||0)/ag*a1)]),a5=I?"div":m.PortalToFollowElemTrigger,a6=I?m.PortalToFollowElemTrigger:"div",a7=(0,f.useMemo)(()=>a_&&aK?(0,b.jsx)(M.default,{nodeName:aJ?.title,path:w.slice(1),varType:(0,L.varTypeToStructType)(aW),nodeType:aJ?.type}):!a_&&aF?ai("errorMsg.invalidVariable",{ns:"workflow"}):null,[a_,aK,aF,ai,aJ?.title,aJ?.type,w,aW]),[a8,a9]=(0,f.useState)(null),[ba,bb]=(0,f.useState)(!1),{mutateAsync:bc}=(0,D.useFetchDynamicOptions)(ae?.plugin_id||"",ae?.name||"",ad?.name||"",V?.variable||"","tool"),bd=async()=>{if(V?.type===o.FormTypeEnum.dynamicSelect&&ad&&ae){bb(!0);try{let a=await bc();a9(a?.options||[])}finally{bb(!1)}}};(0,f.useEffect)(()=>{bd()},[ad,ae,V]);let be=(0,f.useMemo)(()=>{if(V?.type!==o.FormTypeEnum.dynamicSelect)return V;if(a8)return{...V,options:a8};if(ba&&w&&"string"==typeof w){let a=[{value:w,label:{en_US:w,zh_Hans:w},show_on:[]}];return{...V,options:a}}return{...V,options:[]}},[V,a8,ba,w]),bf=(0,f.useMemo)(()=>aX?"environment":aY?"conversation":aZ?"global":aH?"loop":a$?"rag":"system",[aX,aY,aZ,aH,a$]);return(0,b.jsx)("div",{className:(0,x.cn)(u,!t&&"cursor-pointer"),children:(0,b.jsxs)(m.PortalToFollowElem,{open:aD,onOpenChange:aE,placement:U?"bottom-end":"bottom-start",children:[(0,b.jsx)(a5,{onClick:()=>{t||(aB?aS(Date.now()):aE(!aD))},className:"group/picker-trigger-wrap relative !flex",children:(0,b.jsxs)(b.Fragment,{children:[U?(0,b.jsx)("div",{children:(0,b.jsx)(j.default,{onClick:d.noop})}):(0,b.jsxs)("div",{ref:I?null:aw,className:(0,x.cn)(aD||aP?"border-gray-300":"border-gray-100","group/wrap relative flex h-8 w-full items-center",!I&&"rounded-lg bg-components-input-bg-normal p-1",X&&"border-none bg-transparent",t&&"bg-components-input-bg-disabled"),children:[I?(0,b.jsx)("div",{onClick:a=>{a.stopPropagation(),aE(!1),aS(Date.now())},className:"mr-1 flex h-full items-center space-x-1",children:(0,b.jsx)(y,{noLeft:!0,trigger:(0,b.jsxs)("div",{className:"radius-md flex h-8 items-center bg-components-input-bg-normal px-2",children:[(0,b.jsx)("div",{className:"system-sm-regular mr-1 text-components-input-text-filled",children:aM.find(a=>a.value===az)?.label}),(0,b.jsx)(c.RiArrowDownSLine,{className:"h-4 w-4 text-text-quaternary"})]}),popupClassName:"top-8",readonly:t,value:az,options:aM,onChange:aN,showChecked:!0})}):!aF&&(0,b.jsx)("div",{className:"ml-1.5 mr-1",children:(0,b.jsx)(l.Variable02,{className:`h-4 w-4 ${t?"text-components-input-text-disabled":"text-components-input-text-placeholder"}`})}),aB?(0,b.jsx)(K,{value:w,onChange:H,schema:be,readonly:t,isLoading:ba}):(0,b.jsx)(a6,{onClick:()=>{t||(aB?aS(Date.now()):aE(!aD))},className:"h-full grow",children:(0,b.jsx)("div",{ref:I?aw:null,className:(0,x.cn)("h-full",I&&"flex items-center rounded-lg bg-components-panel-bg py-1 pl-1"),children:(0,b.jsx)(n.default,{noDecoration:aK,popupContent:a7,children:(0,b.jsx)("div",{className:(0,x.cn)("h-full items-center rounded-[5px] px-1.5",aF?"inline-flex bg-components-badge-white-to-dark":"flex"),children:aF?(0,b.jsxs)(b.Fragment,{children:[v&&!aX&&!aY&&!aZ&&!a$&&(0,b.jsxs)("div",{className:"flex items-center",onClick:a=>{(a.metaKey||a.ctrlKey)&&(a.stopPropagation(),aV(aJ?.id))},children:[(0,b.jsx)("div",{className:"h-3 px-[1px]",children:aJ?.type&&(0,b.jsx)(p.VarBlockIcon,{className:"!text-text-primary",type:aJ.type})}),(0,b.jsx)("div",{className:"mx-0.5 truncate text-xs font-medium text-text-secondary",title:aJ?.title,style:{maxWidth:a2},children:aJ?.title}),(0,b.jsx)(k.Line3,{className:"mr-0.5"})]}),aK&&(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)(c.RiMoreLine,{className:"h-3 w-3 text-text-secondary"}),(0,b.jsx)(k.Line3,{className:"mr-0.5 text-divider-deep"})]}),(0,b.jsxs)("div",{className:"flex items-center text-text-accent",children:[ba&&(0,b.jsx)(c.RiLoader4Line,{className:"h-3.5 w-3.5 animate-spin text-text-secondary"}),(0,b.jsx)(z.VariableIconWithColor,{variables:w,variableCategory:bf,isExceptionVariable:a0}),(0,b.jsx)("div",{className:(0,x.cn)("ml-0.5 truncate text-xs font-medium",aX&&"!text-text-secondary",aY&&"text-util-colors-teal-teal-700",a0&&"text-text-warning",aZ&&"text-util-colors-orange-orange-600"),title:aL,style:{maxWidth:a3},children:aL})]}),(0,b.jsx)("div",{className:"system-xs-regular ml-0.5 truncate text-center capitalize text-text-tertiary",title:aW,style:{maxWidth:a4},children:aW}),!a_&&(0,b.jsx)(c.RiErrorWarningFill,{className:"ml-0.5 h-3 w-3 text-text-destructive"})]}):(0,b.jsx)("div",{className:`overflow-hidden ${t?"text-components-input-text-disabled":"text-components-input-text-placeholder"} system-sm-regular text-ellipsis`,children:ba?(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)(c.RiLoader4Line,{className:"mr-1 h-3.5 w-3.5 animate-spin text-text-secondary"}),(0,b.jsx)("span",{children:_??ai("common.setVarValuePlaceholder",{ns:"workflow"})})]}):_??ai("common.setVarValuePlaceholder",{ns:"workflow"})})})})})}),aF&&!t&&!X&&(0,b.jsx)("div",{className:"group invisible absolute right-1 top-[50%] h-5 translate-y-[-50%] cursor-pointer rounded-md p-1 hover:bg-state-base-hover group-hover/wrap:visible",onClick:aU,children:(0,b.jsx)(c.RiCloseLine,{className:"h-3.5 w-3.5 text-text-tertiary group-hover:text-text-secondary"})}),!aF&&W&&(0,b.jsx)(i.default,{className:" absolute right-1 top-[50%] translate-y-[-50%] capitalize",text:W,uppercase:!1})]}),!t&&X&&(0,b.jsx)(G,{className:"absolute right-1 top-0.5 hidden group-hover/picker-trigger-wrap:block",onClick:()=>Y?.()}),!aF&&Z&&(0,b.jsx)(i.default,{className:"absolute right-2 top-1.5",text:Z,uppercase:!1})]})}),(0,b.jsx)(m.PortalToFollowElemContent,{style:{zIndex:ac||100},className:"mt-1",children:!aB&&(0,b.jsx)(S,{vars:aC,popupFor:ab,onChange:aT,itemWidth:U?260:aa||ax,isSupportFileVar:$,zIndex:ac,preferSchemaType:af})})]})})});a.s(["default",0,U],597209)}];

//# sourceMappingURL=app_components_170703db._.js.map
module.exports=[305579,a=>{"use strict";var b=a.i(608061),c=a.i(57843);let d=c.forwardRef(function({title:a,titleId:b,...d},e){return c.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:e,"aria-labelledby":b},d),a?c.createElement("title",{id:b},a):null,c.createElement("path",{fillRule:"evenodd",d:"M6.28 5.22a.75.75 0 0 1 0 1.06L2.56 10l3.72 3.72a.75.75 0 0 1-1.06 1.06L.97 10.53a.75.75 0 0 1 0-1.06l4.25-4.25a.75.75 0 0 1 1.06 0Zm7.44 0a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.75.75 0 0 1-1.06-1.06L17.44 10l-3.72-3.72a.75.75 0 0 1 0-1.06ZM11.377 2.011a.75.75 0 0 1 .612.867l-2.5 14.5a.75.75 0 0 1-1.478-.255l2.5-14.5a.75.75 0 0 1 .866-.612Z",clipRule:"evenodd"}))});var e=a.i(497746),f=a.i(537797),g=a.i(351117),h=a.i(217553),i=a.i(494261),j=a.i(533306);a.i(752298);var k=a.i(693025),l=a.i(639378),m=a.i(388206),n=a.i(65395),o=a.i(42550),p=a.i(133824),q=a.i(938409),r=a.i(735310),s=a.i(954200);let t=a=>{let{t:d}=(0,k.useTranslation)(),e=(0,p.useFeatures)(a=>a.features),f=(0,p.useFeaturesStore)(),[g,h]=(0,c.useState)(!1),{more_like_this:j,opening_statement:l,suggested_questions:m,sensitive_word_avoidance:t,speech_to_text:u,text_to_speech:v,suggested_questions_after_answer:w,retriever_resource:x,annotation_reply:y,file_upload:z,resetAppConfig:A}=a.publishedConfig.modelConfig,B=(0,c.useCallback)(()=>{A?.();let{features:a,setFeatures:b}=f.getState();b((0,i.produce)(a,a=>{a.moreLikeThis=j||{enabled:!1},a.opening={enabled:!!l,opening_statement:l||"",suggested_questions:m||[]},a.moderation=t||{enabled:!1},a.speech2text=u||{enabled:!1},a.text2speech=v||{enabled:!1},a.suggested=w||{enabled:!1},a.citation=x||{enabled:!1},a.annotationReply=y||{enabled:!1},a.file={image:{detail:z?.image?.detail||s.Resolution.high,enabled:!!z?.image?.enabled,number_limits:z?.image?.number_limits||3,transfer_methods:z?.image?.transfer_methods||["local_file","remote_url"]},enabled:!!(z?.enabled||z?.image?.enabled),allowed_file_types:z?.allowed_file_types||[r.SupportUploadFileTypes.image],allowed_file_extensions:z?.allowed_file_extensions||q.FILE_EXTS[r.SupportUploadFileTypes.image].map(a=>`.${a}`),allowed_file_upload_methods:z?.allowed_file_upload_methods||z?.image?.transfer_methods||["local_file","remote_url"],number_limits:z?.number_limits||z?.image?.number_limits||3}})),h(!1)},[f,a]),C=(0,c.useCallback)(b=>a.onPublish?.(b,e),[e,a]);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(n.default,{...a,onPublish:C,onRestore:()=>h(!0)}),g&&(0,b.jsx)(o.default,{title:d("resetConfig.title",{ns:"appDebug"}),content:d("resetConfig.message",{ns:"appDebug"}),isShow:g,onConfirm:B,onCancel:()=>h(!1)})]})};var u=a.i(536799),v=a.i(909795),w=a.i(940272);let x=c.memo(({isShow:a,saveLoading:d,data:e,onClose:f,onSave:g})=>{let{t:h}=(0,k.useTranslation)(),[i,j]=(0,c.useState)(e);return(0,b.jsxs)(w.default,{title:h("feature.conversationHistory.editModal.title",{ns:"appDebug"}),isShow:a,onClose:f,children:[(0,b.jsx)("div",{className:"mt-6 text-sm font-medium leading-[21px] text-text-primary",children:h("feature.conversationHistory.editModal.userPrefix",{ns:"appDebug"})}),(0,b.jsx)("input",{className:"mt-2 box-border h-10 w-full rounded-lg bg-components-input-bg-normal px-3 text-sm leading-10",value:i.user_prefix,onChange:a=>j({...i,user_prefix:a.target.value})}),(0,b.jsx)("div",{className:"mt-6 text-sm font-medium leading-[21px] text-text-primary",children:h("feature.conversationHistory.editModal.assistantPrefix",{ns:"appDebug"})}),(0,b.jsx)("input",{className:"mt-2 box-border h-10 w-full rounded-lg bg-components-input-bg-normal px-3 text-sm leading-10",value:i.assistant_prefix,onChange:a=>j({...i,assistant_prefix:a.target.value}),placeholder:h("chat.conversationNamePlaceholder",{ns:"common"})||""}),(0,b.jsxs)("div",{className:"mt-10 flex justify-end",children:[(0,b.jsx)(v.default,{className:"mr-2 shrink-0",onClick:f,children:h("operation.cancel",{ns:"common"})}),(0,b.jsx)(v.default,{variant:"primary",className:"shrink-0",onClick:()=>g(i),loading:d,children:h("operation.save",{ns:"common"})})]})]})});var y=a.i(429150),z=a.i(617633);a.i(151730);var A=a.i(568910),A=A;a.i(316493);var B=a.i(142272),B=B,C=a.i(703298),D=a.i(18039),E=a.i(483664),F=a.i(527344);let G=c.memo(({className:a,icon:c,name:d,description:e,children:f})=>(0,b.jsxs)("div",{className:(0,F.cn)(a,"flex h-12 items-center justify-between rounded-lg bg-background-section-burn px-3"),children:[(0,b.jsxs)("div",{className:"flex items-center",children:[c,(0,b.jsx)("div",{className:"ml-3 mr-1 text-sm font-semibold leading-6 text-text-secondary",children:d}),(0,b.jsx)(E.default,{popupContent:(0,b.jsx)("div",{className:"w-[180px]",children:e})})]}),(0,b.jsx)("div",{children:f})]})),H=c.memo(({isChatModel:a,payload:d,isFunctionCall:e,onCancel:f,onSave:g})=>{let{t:h}=(0,k.useTranslation)(),[i,j]=(0,c.useState)(d),l=(0,c.useRef)(null),[m,n]=(0,c.useState)(!1);return(0,z.useClickAway)(()=>{m&&f()},l),(0,c.useEffect)(()=>{n(!0)},[]),(0,b.jsx)("div",{className:"fixed inset-0 z-[100] flex justify-end overflow-hidden p-2",style:{backgroundColor:"rgba(16, 24, 40, 0.20)"},children:(0,b.jsxs)("div",{ref:l,className:"flex h-full w-[640px] flex-col overflow-hidden rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-xl",children:[(0,b.jsxs)("div",{className:"flex h-14 shrink-0 items-center justify-between border-b border-divider-regular pl-6 pr-5",children:[(0,b.jsx)("div",{className:"flex flex-col text-base font-semibold text-text-primary",children:(0,b.jsx)("div",{className:"leading-6",children:h("agent.setting.name",{ns:"appDebug"})})}),(0,b.jsx)("div",{className:"flex items-center",children:(0,b.jsx)("div",{onClick:f,className:"flex h-6 w-6 cursor-pointer items-center justify-center",children:(0,b.jsx)(y.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})})})]}),(0,b.jsxs)("div",{className:"grow overflow-y-auto border-b p-6 pb-[68px] pt-5",style:{borderBottom:"rgba(0, 0, 0, 0.05)"},children:[(0,b.jsx)(G,{className:"mb-4",icon:(0,b.jsx)(A.default,{className:"h-4 w-4 text-indigo-600"}),name:h("agent.agentMode",{ns:"appDebug"}),description:h("agent.agentModeDes",{ns:"appDebug"}),children:(0,b.jsx)("div",{className:"text-[13px] font-medium leading-[18px] text-text-primary",children:h(e?"agent.agentModeType.functionCall":"agent.agentModeType.ReACT",{ns:"appDebug"})})}),(0,b.jsx)(G,{className:"mb-4",icon:(0,b.jsx)(B.default,{className:"h-4 w-4 text-[#FB6514]"}),name:h("agent.setting.maximumIterations.name",{ns:"appDebug"}),description:h("agent.setting.maximumIterations.description",{ns:"appDebug"}),children:(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)(C.default,{className:"mr-3 w-[156px]",min:1,max:D.MAX_ITERATIONS_NUM,value:i.max_iteration,onChange:a=>{j({...i,max_iteration:a})}}),(0,b.jsx)("input",{type:"number",min:1,max:D.MAX_ITERATIONS_NUM,step:1,className:"block h-7 w-11 rounded-lg border-0 bg-components-input-bg-normal px-1.5 pl-1 leading-7 text-text-primary placeholder:text-text-tertiary focus:ring-1 focus:ring-inset focus:ring-primary-600",value:i.max_iteration,onChange:a=>{let b=Number.parseInt(a.target.value,10);b<1&&(b=1),b>D.MAX_ITERATIONS_NUM&&(b=D.MAX_ITERATIONS_NUM),j({...i,max_iteration:b})}})]})}),!e&&(0,b.jsxs)("div",{className:"rounded-xl bg-background-section-burn py-2 shadow-xs",children:[(0,b.jsx)("div",{className:"flex h-8 items-center px-4 text-sm font-semibold leading-6 text-text-secondary",children:h("builtInPromptTitle",{ns:"tools"})}),(0,b.jsx)("div",{className:"h-[396px] overflow-y-auto whitespace-pre-line px-4 text-sm font-normal leading-5 text-text-secondary",children:a?D.DEFAULT_AGENT_PROMPT.chat:D.DEFAULT_AGENT_PROMPT.completion}),(0,b.jsx)("div",{className:"px-4",children:(0,b.jsx)("div",{className:"inline-flex h-5 items-center rounded-md bg-components-input-bg-normal px-1 text-xs font-medium leading-[18px] text-text-tertiary",children:(a?D.DEFAULT_AGENT_PROMPT.chat:D.DEFAULT_AGENT_PROMPT.completion).length})})]})]}),(0,b.jsxs)("div",{className:"sticky bottom-0 z-[5] flex w-full justify-end border-t border-divider-regular bg-background-section-burn px-6 py-4",children:[(0,b.jsx)(v.default,{onClick:f,className:"mr-2",children:h("operation.cancel",{ns:"common"})}),(0,b.jsx)(v.default,{variant:"primary",onClick:()=>{g(i)},children:h("operation.save",{ns:"common"})})]})]})})}),I=c.memo(({onAgentSettingChange:a,isFunctionCall:d,isChatModel:e,agentConfig:f})=>{let{t:g}=(0,k.useTranslation)(),[h,i]=(0,c.useState)(!1);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(v.default,{onClick:()=>i(!0),className:"mr-2 shrink-0",children:[(0,b.jsx)(y.RiSettings2Line,{className:"mr-1 h-4 w-4 text-text-tertiary"}),g("agent.setting.name",{ns:"appDebug"})]}),h&&(0,b.jsx)(H,{isFunctionCall:d,payload:f,isChatModel:e,onSave:b=>{a(b),i(!1)},onCancel:()=>i(!1)})]})});var J=a.i(884184),K=a.i(55465),L=a.i(271364),M=a.i(158873),N=a.i(721647),O=a.i(243103),P=a.i(757801),Q=a.i(632789);a.i(26354);var R=a.i(858364),S=a.i(501039),T=a.i(456478),U=a.i(375616),V=a.i(202738),W=a.i(459858),X=a.i(81492);let Y=({icon:a,title:c,tooltip:d,value:e,description:f,children:g,disabled:h,onChange:i,onMouseEnter:j,onMouseLeave:k})=>(0,b.jsxs)("div",{className:"mb-1 rounded-xl border-l-[0.5px] border-t-[0.5px] border-effects-highlight bg-background-section-burn p-3",onMouseEnter:j,onMouseLeave:k,children:[(0,b.jsxs)("div",{className:"mb-2 flex items-center gap-2",children:[a,(0,b.jsxs)("div",{className:"system-sm-semibold flex grow items-center text-text-secondary",children:[c,d&&(0,b.jsx)(E.default,{popupContent:d,children:(0,b.jsx)("div",{className:"ml-0.5 p-px",children:(0,b.jsx)(y.RiQuestionLine,{className:"h-3.5 w-3.5 text-text-quaternary"})})})]}),(0,b.jsx)(X.default,{disabled:h,className:"shrink-0",onChange:a=>i?.(a),defaultValue:e})]}),f&&(0,b.jsx)("div",{className:"system-xs-regular line-clamp-2 min-h-8 text-text-tertiary",children:f}),g]});a.i(23019);var Z=a.i(161572),$=a.i(477401);let _=({disabled:a,onChange:d})=>{let{t:e}=(0,k.useTranslation)(),f=(0,j.useRouter)(),g=(0,j.usePathname)().match(/\/app\/([^/]+)/),h=g?.length&&g[1]?g[1]:"",l=(0,p.useFeaturesStore)(),m=(0,p.useFeatures)(a=>a.features.annotationReply),n=(0,c.useCallback)(a=>{let{features:b,setFeatures:c}=l.getState(),e=(0,i.produce)(b,b=>{b.annotationReply=a});c(e),d&&d(e)},[l,d]),{handleEnableAnnotation:o,handleDisableAnnotation:q,isShowAnnotationConfigInit:r,setIsShowAnnotationConfigInit:s,isShowAnnotationFullModal:t,setIsShowAnnotationFullModal:u}=(({appId:a,annotationConfig:b,setAnnotationConfig:d})=>{let{plan:e,enableBilling:f}=(0,U.useProviderContext)(),g=f&&e.usage.annotatedResponse>=e.total.annotatedResponse,[h,j]=(0,c.useState)(!1),[k,l]=c.useState(!1),m=async(b,c)=>{let d=!1;for(;!d&&!(d=(await (0,V.queryAnnotationJobStatus)(a,c,b)).job_status===T.JobStatus.completed);)await (0,W.sleep)(2e3)};return{handleEnableAnnotation:async(c,e)=>{if(g)return;let{job_id:f}=await (0,V.updateAnnotationStatus)(a,T.AnnotationEnableStatus.enable,c,e);await m(f,T.AnnotationEnableStatus.enable),d((0,i.produce)(b,a=>{a.enabled=!0,a.embedding_model=c,a.score_threshold||(a.score_threshold=D.ANNOTATION_DEFAULT.score_threshold)}))},handleDisableAnnotation:async c=>{b.enabled&&(await (0,V.updateAnnotationStatus)(a,T.AnnotationEnableStatus.disable,c),d((0,i.produce)(b,a=>{a.enabled=!1})))},isShowAnnotationConfigInit:k,setIsShowAnnotationConfigInit:a=>{a&&g?j(!0):l(a)},isShowAnnotationFullModal:h,setIsShowAnnotationFullModal:j,setScore:(a,c)=>{d((0,i.produce)(b,b=>{b.score_threshold=a,c&&(b.embedding_model=c)}))}}})({appId:h,annotationConfig:m||{id:"",enabled:!1,score_threshold:D.ANNOTATION_DEFAULT.score_threshold,embedding_model:{embedding_provider_name:"",embedding_model_name:""}},setAnnotationConfig:n}),w=(0,c.useCallback)(a=>{a?s(!0):q(m?.embedding_model)},[m?.embedding_model,q,s]),[x,z]=(0,c.useState)(!1);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(Y,{icon:(0,b.jsx)("div",{className:"shrink-0 rounded-lg border-[0.5px] border-divider-subtle bg-util-colors-indigo-indigo-600 p-1 shadow-xs",children:(0,b.jsx)(Z.MessageFast,{className:"h-4 w-4 text-text-primary-on-surface"})}),title:e("feature.annotation.title",{ns:"appDebug"}),value:!!m?.enabled,onChange:a=>w(a),onMouseEnter:()=>z(!0),onMouseLeave:()=>z(!1),disabled:a,children:(0,b.jsxs)(b.Fragment,{children:[!m?.enabled&&(0,b.jsx)("div",{className:"system-xs-regular line-clamp-2 min-h-8 text-text-tertiary",children:e("feature.annotation.description",{ns:"appDebug"})}),!!m?.enabled&&(0,b.jsxs)(b.Fragment,{children:[!x&&(0,b.jsxs)("div",{className:"flex items-center gap-4 pt-0.5",children:[(0,b.jsxs)("div",{className:"",children:[(0,b.jsx)("div",{className:"system-2xs-medium-uppercase mb-0.5 text-text-tertiary",children:e("feature.annotation.scoreThreshold.title",{ns:"appDebug"})}),(0,b.jsx)("div",{className:"system-xs-regular text-text-secondary",children:m.score_threshold||"-"})]}),(0,b.jsx)("div",{className:"h-[27px] w-px rotate-12 bg-divider-subtle"}),(0,b.jsxs)("div",{className:"",children:[(0,b.jsx)("div",{className:"system-2xs-medium-uppercase mb-0.5 text-text-tertiary",children:e("modelProvider.embeddingModel.key",{ns:"common"})}),(0,b.jsx)("div",{className:"system-xs-regular text-text-secondary",children:m.embedding_model?.embedding_model_name})]})]}),x&&(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)(v.default,{className:"w-[178px]",onClick:()=>s(!0),disabled:a,children:[(0,b.jsx)(y.RiEqualizer2Line,{className:"mr-1 h-4 w-4"}),e("operation.params",{ns:"common"})]}),(0,b.jsxs)(v.default,{className:"w-[178px]",onClick:()=>{f.push(`/app/${h}/annotations`)},children:[(0,b.jsx)(y.RiExternalLinkLine,{className:"mr-1 h-4 w-4"}),e("feature.annotation.cacheManagement",{ns:"appDebug"})]})]})]})]})}),(0,b.jsx)(S.default,{appId:h,isInit:!0,isShow:r,onHide:()=>{s(!1)},onSave:async(a,b)=>{await o(a,b),s(!1)},annotationConfig:m}),t&&(0,b.jsx)($.default,{show:t,onHide:()=>u(!1)})]})};var aa=a.i(74801),ab=a.i(447361);let ac=({disabled:a,onChange:d})=>{let{t:e}=(0,k.useTranslation)(),f=(0,p.useFeatures)(a=>a.features),g=(0,p.useFeaturesStore)(),h=(0,c.useCallback)((a,b)=>{let{features:c,setFeatures:e}=g.getState(),f=(0,i.produce)(c,c=>{c[a]={...c[a],enabled:b}});e(f),d&&d(f)},[g,d]);return(0,b.jsx)(Y,{icon:(0,b.jsx)("div",{className:"shrink-0 rounded-lg border-[0.5px] border-divider-subtle bg-util-colors-warning-warning-500 p-1 shadow-xs",children:(0,b.jsx)(ab.Citations,{className:"h-4 w-4 text-text-primary-on-surface"})}),title:e("feature.citation.title",{ns:"appDebug"}),value:!!f.citation?.enabled,description:e("feature.citation.description",{ns:"appDebug"}),onChange:a=>h(aa.FeatureEnum.citation,a),disabled:a})};var ad=a.i(935904),ae=a.i(29255);let af=({disabled:a,onChange:d,promptVariables:e,workflowVariables:f,onAutoAddPromptVariable:g})=>{let{t:h}=(0,k.useTranslation)(),{setShowOpeningModal:j}=(0,ae.useModalContext)(),l=(0,p.useFeatures)(a=>a.features.opening),m=(0,p.useFeaturesStore)(),[n,o]=(0,c.useState)(!1),q=(0,c.useCallback)(()=>{if(a)return;let{features:b,setFeatures:c}=m.getState();j({payload:{...l,promptVariables:e,workflowVariables:f,onAutoAddPromptVariable:g},onSaveCallback:a=>{c((0,i.produce)(b,b=>{b.opening=a})),d&&d()},onCancelCallback:()=>{d&&d()}})},[a,m,g,d,l,e,j]),r=(0,c.useCallback)((a,b)=>{let{features:c,setFeatures:e}=m.getState();e((0,i.produce)(c,c=>{c[a]={...c[a],enabled:b}})),d&&d()},[m,d]);return(0,b.jsx)(Y,{icon:(0,b.jsx)("div",{className:"shrink-0 rounded-lg border-[0.5px] border-divider-subtle bg-util-colors-blue-light-blue-light-500 p-1 shadow-xs",children:(0,b.jsx)(ad.LoveMessage,{className:"h-4 w-4 text-text-primary-on-surface"})}),title:h("feature.conversationOpener.title",{ns:"appDebug"}),value:!!l?.enabled,onChange:a=>r(aa.FeatureEnum.opening,a),onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),disabled:a,children:(0,b.jsxs)(b.Fragment,{children:[!l?.enabled&&(0,b.jsx)("div",{className:"system-xs-regular line-clamp-2 min-h-8 text-text-tertiary",children:h("feature.conversationOpener.description",{ns:"appDebug"})}),!!l?.enabled&&(0,b.jsxs)(b.Fragment,{children:[!n&&(0,b.jsx)("div",{className:"system-xs-regular line-clamp-2 min-h-8 text-text-tertiary",children:l.opening_statement||h("openingStatement.placeholder",{ns:"appDebug"})}),n&&(0,b.jsxs)(v.default,{className:"w-full",onClick:q,disabled:a,children:[(0,b.jsx)(y.RiEditLine,{className:"mr-1 h-4 w-4"}),h("openingStatement.writeOpener",{ns:"appDebug"})]})]})]})})};var ag=a.i(144012),ah=a.i(941938);let ai=({className:a,children:d,show:e,onClose:f,inWorkflow:g=!0})=>{let h=(0,c.useCallback)(()=>f?.(),[f]);return(0,b.jsx)(ah.Transition,{appear:!0,show:e,as:c.Fragment,children:(0,b.jsxs)(ag.Dialog,{as:"div",className:"relative z-40",onClose:h,children:[(0,b.jsx)(ah.TransitionChild,{children:(0,b.jsx)("div",{className:(0,F.cn)("fixed inset-0 bg-black/25","data-[closed]:opacity-0","data-[enter]:opacity-100 data-[enter]:duration-300 data-[enter]:ease-out","data-[leave]:opacity-0 data-[leave]:duration-200 data-[leave]:ease-in")})}),(0,b.jsx)("div",{className:"fixed inset-0",children:(0,b.jsx)("div",{className:(0,F.cn)("flex min-h-full flex-col items-end justify-center pb-2",g?"pt-[112px]":"pr-2 pt-[64px]"),children:(0,b.jsx)(ah.TransitionChild,{children:(0,b.jsx)(ag.DialogPanel,{className:(0,F.cn)("relative flex h-0 w-[420px] grow flex-col overflow-hidden border-components-panel-border bg-components-panel-bg-alt p-0 text-left align-middle shadow-xl transition-all",g?"rounded-l-2xl border-b-[0.5px] border-l-[0.5px] border-t-[0.5px]":"rounded-2xl border-[0.5px]","data-[closed]:scale-95  data-[closed]:opacity-0","data-[enter]:scale-100 data-[enter]:opacity-100 data-[enter]:duration-300 data-[enter]:ease-out","data-[leave]:scale-95 data-[leave]:opacity-0 data-[leave]:duration-200 data-[leave]:ease-in",a),children:d})})})})]})})};var aj=a.i(709656);let ak=c.memo(({imageUpload:a,onClose:d,onChange:e})=>{let{t:f}=(0,k.useTranslation)(),g=(0,p.useFeaturesStore)(),h=(0,p.useFeatures)(a=>a.features.file),j=(0,c.useMemo)(()=>({allowed_file_upload_methods:h?.allowed_file_upload_methods||["local_file","remote_url"],allowed_file_types:h?.allowed_file_types||[r.SupportUploadFileTypes.image],allowed_file_extensions:h?.allowed_file_extensions||q.FILE_EXTS[r.SupportUploadFileTypes.image],max_length:h?.number_limits||3}),[h]),[l,m]=(0,c.useState)(j),n=(0,c.useCallback)(()=>{let{features:a,setFeatures:b}=g.getState();b((0,i.produce)(a,a=>{a.file={...a.file,allowed_file_upload_methods:l.allowed_file_upload_methods,number_limits:l.max_length,allowed_file_types:l.allowed_file_types,allowed_file_extensions:l.allowed_file_extensions}})),e&&e()},[g,e,l]);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,b.jsx)("div",{className:"system-xl-semibold text-text-primary",children:f(a?"feature.imageUpload.modalTitle":"feature.fileUpload.modalTitle",{ns:"appDebug"})}),(0,b.jsx)("div",{className:"cursor-pointer p-1",onClick:d,children:(0,b.jsx)(y.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})})]}),(0,b.jsx)(aj.default,{isMultiple:!0,inFeaturePanel:!0,hideSupportFileType:a,payload:l,onChange:a=>m(a)}),(0,b.jsxs)("div",{className:"mt-4 flex items-center justify-end",children:[(0,b.jsx)(v.default,{onClick:d,className:"mr-2",children:f("operation.cancel",{ns:"common"})}),(0,b.jsx)(v.default,{variant:"primary",onClick:n,disabled:0===l.allowed_file_types.length,children:f("operation.save",{ns:"common"})})]})]})});var al=a.i(825319);let am=(0,c.memo)(({open:a,onOpen:c,onChange:d,disabled:e,children:f,imageUpload:g})=>(0,b.jsxs)(al.PortalToFollowElem,{open:a,onOpenChange:c,placement:"left",offset:{mainAxis:32},children:[(0,b.jsx)(al.PortalToFollowElemTrigger,{className:"flex",onClick:()=>!e&&c(a=>!a),children:f}),(0,b.jsx)(al.PortalToFollowElemContent,{style:{zIndex:50},children:(0,b.jsx)("div",{className:"max-h-[calc(100vh-20px)] w-[360px] overflow-y-auto rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg p-4 shadow-2xl",children:(0,b.jsx)(ak,{imageUpload:g,onClose:()=>c(!1),onChange:a=>{d?.(a),c(!1)}})})})]}));var an=a.i(32139);let ao=({disabled:a,onChange:d})=>{let{t:e}=(0,k.useTranslation)(),f=(0,p.useFeatures)(a=>a.features.file),g=(0,p.useFeaturesStore)(),[h,j]=(0,c.useState)(!1),[l,m]=(0,c.useState)(!1),n=(0,c.useMemo)(()=>f?.allowed_file_types?.join(",")||"-",[f?.allowed_file_types]),o=(0,c.useCallback)((a,b)=>{let{features:c,setFeatures:e}=g.getState();e((0,i.produce)(c,c=>{c[a]={...c[a],enabled:b,image:{enabled:b}}})),d&&d()},[g,d]);return(0,b.jsx)(Y,{icon:(0,b.jsx)("div",{className:"shrink-0 rounded-lg border-[0.5px] border-divider-subtle bg-util-colors-blue-blue-600 p-1 shadow-xs",children:(0,b.jsx)(an.FolderUpload,{className:"h-4 w-4 text-text-primary-on-surface"})}),title:e("feature.fileUpload.title",{ns:"appDebug"}),value:f?.enabled,onChange:a=>o(aa.FeatureEnum.file,a),onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),disabled:a,children:(0,b.jsxs)(b.Fragment,{children:[!f?.enabled&&(0,b.jsx)("div",{className:"system-xs-regular line-clamp-2 min-h-8 text-text-tertiary",children:e("feature.fileUpload.description",{ns:"appDebug"})}),f?.enabled&&(0,b.jsxs)(b.Fragment,{children:[!l&&!h&&(0,b.jsxs)("div",{className:"flex items-center gap-4 pt-0.5",children:[(0,b.jsxs)("div",{className:"",children:[(0,b.jsx)("div",{className:"system-2xs-medium-uppercase mb-0.5 text-text-tertiary",children:e("feature.fileUpload.supportedTypes",{ns:"appDebug"})}),(0,b.jsx)("div",{className:"system-xs-regular text-text-secondary",children:n})]}),(0,b.jsx)("div",{className:"h-[27px] w-px rotate-12 bg-divider-subtle"}),(0,b.jsxs)("div",{className:"",children:[(0,b.jsx)("div",{className:"system-2xs-medium-uppercase mb-0.5 text-text-tertiary",children:e("feature.fileUpload.numberLimit",{ns:"appDebug"})}),(0,b.jsx)("div",{className:"system-xs-regular text-text-secondary",children:f?.number_limits})]})]}),(l||h)&&(0,b.jsx)(am,{open:h&&!a,onOpen:a=>{j(a),m(a)},onChange:d,children:(0,b.jsxs)(v.default,{className:"w-full",disabled:a,children:[(0,b.jsx)(y.RiEqualizer2Line,{className:"mr-1 h-4 w-4"}),e("operation.settings",{ns:"common"})]})})]})]})})};var ap=a.i(383973);let aq=({disabled:a,onChange:d})=>{let{t:e}=(0,k.useTranslation)(),f=(0,p.useFeatures)(a=>a.features),g=(0,p.useFeaturesStore)(),h=(0,c.useCallback)((a,b)=>{let{features:c,setFeatures:e}=g.getState(),f=(0,i.produce)(c,c=>{c[a]={...c[a],enabled:b}});e(f),d&&d(f)},[g,d]);return(0,b.jsx)(Y,{icon:(0,b.jsx)("div",{className:"shrink-0 rounded-lg border-[0.5px] border-divider-subtle bg-util-colors-blue-light-blue-light-500 p-1 shadow-xs",children:(0,b.jsx)(ap.VirtualAssistant,{className:"h-4 w-4 text-text-primary-on-surface"})}),title:e("feature.suggestedQuestionsAfterAnswer.title",{ns:"appDebug"}),value:!!f.suggested?.enabled,description:e("feature.suggestedQuestionsAfterAnswer.description",{ns:"appDebug"}),onChange:a=>h(aa.FeatureEnum.suggested,a),disabled:a})};var ar=a.i(218865);let as=({disabled:a,onChange:d})=>{let{t:e}=(0,k.useTranslation)(),f=(0,p.useFeatures)(a=>a.features.file),g=(0,p.useFeaturesStore)(),[h,j]=(0,c.useState)(!1),[l,m]=(0,c.useState)(!1),n=(0,c.useMemo)(()=>f?.allowed_file_types?.join(",")||"-",[f?.allowed_file_types]),o=(0,c.useCallback)((a,b)=>{let{features:c,setFeatures:e}=g.getState();e((0,i.produce)(c,c=>{c[a]={...c[a],enabled:b,image:{enabled:b}}})),d&&d()},[g,d]);return(0,b.jsx)(Y,{icon:(0,b.jsx)("div",{className:"shrink-0 rounded-lg border-[0.5px] border-divider-subtle bg-util-colors-indigo-indigo-600 p-1 shadow-xs",children:(0,b.jsx)(y.RiImage2Fill,{className:"h-4 w-4 text-text-primary-on-surface"})}),title:(0,b.jsxs)("div",{className:"flex items-center",children:[e("feature.imageUpload.title",{ns:"appDebug"}),(0,b.jsx)(ar.default,{text:"LEGACY",className:"mx-1 shrink-0 border-text-accent-secondary text-text-accent-secondary"})]}),value:f?.enabled,onChange:a=>o(aa.FeatureEnum.file,a),onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),disabled:a,children:(0,b.jsxs)(b.Fragment,{children:[!f?.enabled&&(0,b.jsx)("div",{className:"system-xs-regular line-clamp-2 min-h-8 text-text-tertiary",children:e("feature.imageUpload.description",{ns:"appDebug"})}),f?.enabled&&(0,b.jsxs)(b.Fragment,{children:[!l&&!h&&(0,b.jsxs)("div",{className:"flex items-center gap-4 pt-0.5",children:[(0,b.jsxs)("div",{className:"",children:[(0,b.jsx)("div",{className:"system-2xs-medium-uppercase mb-0.5 text-text-tertiary",children:e("feature.imageUpload.supportedTypes",{ns:"appDebug"})}),(0,b.jsx)("div",{className:"system-xs-regular text-text-secondary",children:n})]}),(0,b.jsx)("div",{className:"h-[27px] w-px rotate-12 bg-divider-subtle"}),(0,b.jsxs)("div",{className:"",children:[(0,b.jsx)("div",{className:"system-2xs-medium-uppercase mb-0.5 text-text-tertiary",children:e("feature.imageUpload.numberLimit",{ns:"appDebug"})}),(0,b.jsx)("div",{className:"system-xs-regular text-text-secondary",children:f?.number_limits})]})]}),(l||h)&&(0,b.jsx)(am,{imageUpload:!0,open:h&&!a,onOpen:a=>{j(a),m(a)},onChange:d,children:(0,b.jsxs)(v.default,{className:"w-full",disabled:a,children:[(0,b.jsx)(y.RiEqualizer2Line,{className:"mr-1 h-4 w-4"}),e("operation.settings",{ns:"common"})]})})]})]})})};var at=a.i(193498),au=a.i(252813),av=a.i(763539);let aw=({disabled:a,onChange:d})=>{let{t:e}=(0,k.useTranslation)(),{setShowModerationSettingModal:f}=(0,ae.useModalContext)(),g=(0,au.useLocale)(),h=(0,p.useFeaturesStore)(),j=(0,p.useFeatures)(a=>a.features.moderation),{data:l}=(0,av.useCodeBasedExtensions)("moderation"),[m,n]=(0,c.useState)(!1),o=(0,c.useCallback)((a,b)=>{let{features:c,setFeatures:e}=h.getState();if(b&&!c.moderation?.type&&a===aa.FeatureEnum.moderation&&f({payload:{enabled:!0,type:"keywords",config:{keywords:"",inputs_config:{enabled:!0,preset_response:""}}},onSaveCallback:a=>{let b=(0,i.produce)(c,b=>{b.moderation=a});e(b),d&&d(b)},onCancelCallback:()=>{e((0,i.produce)(c,a=>{a.moderation={enabled:!1}})),d&&d()}}),!b){let a=(0,i.produce)(c,a=>{a.moderation={enabled:!1}});e(a),d&&d(a)}},[h,d,f]),q=(0,c.useMemo)(()=>j?.type==="openai_moderation"?e("feature.moderation.modal.provider.openai",{ns:"appDebug"}):j?.type==="keywords"?e("feature.moderation.modal.provider.keywords",{ns:"appDebug"}):j?.type==="api"?e("apiBasedExtension.selector.title",{ns:"common"}):l?.data.find(a=>a.name===j?.type)?.label[g]||"-",[l?.data,g,j?.type,e]),r=(0,c.useMemo)(()=>j?.config?.inputs_config?.enabled&&j.config?.outputs_config?.enabled?e("feature.moderation.allEnabled",{ns:"appDebug"}):j?.config?.inputs_config?.enabled?e("feature.moderation.inputEnabled",{ns:"appDebug"}):j?.config?.outputs_config?.enabled?e("feature.moderation.outputEnabled",{ns:"appDebug"}):void 0,[j?.config?.inputs_config?.enabled,j?.config?.outputs_config?.enabled,e]);return(0,b.jsx)(Y,{icon:(0,b.jsx)("div",{className:"shrink-0 rounded-lg border-[0.5px] border-divider-subtle bg-text-success p-1 shadow-xs",children:(0,b.jsx)(at.ContentModeration,{className:"h-4 w-4 text-text-primary-on-surface"})}),title:e("feature.moderation.title",{ns:"appDebug"}),value:!!j?.enabled,onChange:a=>o(aa.FeatureEnum.moderation,a),onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),disabled:a,children:(0,b.jsxs)(b.Fragment,{children:[!j?.enabled&&(0,b.jsx)("div",{className:"system-xs-regular line-clamp-2 min-h-8 text-text-tertiary",children:e("feature.moderation.description",{ns:"appDebug"})}),!!j?.enabled&&(0,b.jsxs)(b.Fragment,{children:[!m&&(0,b.jsxs)("div",{className:"flex items-center gap-4 pt-0.5",children:[(0,b.jsxs)("div",{className:"",children:[(0,b.jsx)("div",{className:"system-2xs-medium-uppercase mb-0.5 text-text-tertiary",children:e("feature.moderation.modal.provider.title",{ns:"appDebug"})}),(0,b.jsx)("div",{className:"system-xs-regular text-text-secondary",children:q})]}),(0,b.jsx)("div",{className:"h-[27px] w-px rotate-12 bg-divider-subtle"}),(0,b.jsxs)("div",{className:"",children:[(0,b.jsx)("div",{className:"system-2xs-medium-uppercase mb-0.5 text-text-tertiary",children:e("feature.moderation.contentEnableLabel",{ns:"appDebug"})}),(0,b.jsx)("div",{className:"system-xs-regular text-text-secondary",children:r})]})]}),m&&(0,b.jsxs)(v.default,{className:"w-full",onClick:()=>{if(a)return;let{features:b,setFeatures:c}=h.getState();f({payload:j,onSaveCallback:a=>{let e=(0,i.produce)(b,b=>{b.moderation=a});c(e),d&&d(e)},onCancelCallback:()=>{d&&d()}})},disabled:a,children:[(0,b.jsx)(y.RiEqualizer2Line,{className:"mr-1 h-4 w-4"}),e("operation.settings",{ns:"common"})]})]})]})})},ax=({disabled:a,onChange:d})=>{let{t:e}=(0,k.useTranslation)(),f=(0,p.useFeatures)(a=>a.features),g=(0,p.useFeaturesStore)(),h=(0,c.useCallback)((a,b)=>{let{features:c,setFeatures:e}=g.getState();e((0,i.produce)(c,c=>{c[a]={...c[a],enabled:b}})),d&&d()},[g,d]);return(0,b.jsx)(Y,{icon:(0,b.jsx)("div",{className:"shrink-0 rounded-lg border-[0.5px] border-divider-subtle bg-util-colors-blue-light-blue-light-500 p-1 shadow-xs",children:(0,b.jsx)(y.RiSparklingFill,{className:"h-4 w-4 text-text-primary-on-surface"})}),title:e("feature.moreLikeThis.title",{ns:"appDebug"}),tooltip:e("feature.moreLikeThis.tip",{ns:"appDebug"}),value:!!f.moreLikeThis?.enabled,description:e("feature.moreLikeThis.description",{ns:"appDebug"}),onChange:a=>h(aa.FeatureEnum.moreLikeThis,a),disabled:a})};var ay=a.i(718194);let az=({disabled:a,onChange:d})=>{let{t:e}=(0,k.useTranslation)(),f=(0,p.useFeatures)(a=>a.features),g=(0,p.useFeaturesStore)(),h=(0,c.useCallback)((a,b)=>{let{features:c,setFeatures:e}=g.getState();e((0,i.produce)(c,c=>{c[a]={...c[a],enabled:b}})),d&&d()},[g,d]);return(0,b.jsx)(Y,{icon:(0,b.jsx)("div",{className:"shrink-0 rounded-lg border-[0.5px] border-divider-subtle bg-util-colors-violet-violet-600 p-1 shadow-xs",children:(0,b.jsx)(ay.Microphone01,{className:"h-4 w-4 text-text-primary-on-surface"})}),title:e("feature.speechToText.title",{ns:"appDebug"}),value:!!f.speech2text?.enabled,description:e("feature.speechToText.description",{ns:"appDebug"}),onChange:a=>h(aa.FeatureEnum.speech2text,a),disabled:a})};var aA=a.i(106896),aB=a.i(773910),aC=a.i(136403);let aD=({disabled:a,onChange:d})=>{let{t:e}=(0,k.useTranslation)(),f=(0,p.useFeatures)(a=>a.features.text2speech),g=aC.languages.find(a=>a.value===f?.language),[h,j]=(0,c.useState)(!1),[l,m]=(0,c.useState)(!1),n=(0,p.useFeatures)(a=>a.features),o=(0,p.useFeaturesStore)(),q=(0,c.useCallback)((a,b)=>{let{features:c,setFeatures:e}=o.getState();e((0,i.produce)(c,c=>{c[a]={...c[a],enabled:b}})),d&&d()},[o,d]);return(0,b.jsx)(Y,{icon:(0,b.jsx)("div",{className:"shrink-0 rounded-lg border-[0.5px] border-divider-subtle bg-util-colors-violet-violet-600 p-1 shadow-xs",children:(0,b.jsx)(aB.TextToAudio,{className:"h-4 w-4 text-text-primary-on-surface"})}),title:e("feature.textToSpeech.title",{ns:"appDebug"}),value:!!n.text2speech?.enabled,onChange:a=>q(aa.FeatureEnum.text2speech,a),onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),disabled:a,children:(0,b.jsxs)(b.Fragment,{children:[!n.text2speech?.enabled&&(0,b.jsx)("div",{className:"system-xs-regular line-clamp-2 min-h-8 text-text-tertiary",children:e("feature.textToSpeech.description",{ns:"appDebug"})}),!!n.text2speech?.enabled&&(0,b.jsxs)(b.Fragment,{children:[!l&&!h&&(0,b.jsxs)("div",{className:"flex items-center gap-4 pt-0.5",children:[(0,b.jsxs)("div",{className:"",children:[(0,b.jsx)("div",{className:"system-2xs-medium-uppercase mb-0.5 text-text-tertiary",children:e("voice.voiceSettings.language",{ns:"appDebug"})}),(0,b.jsx)("div",{className:"system-xs-regular text-text-secondary",children:g?.name||"-"})]}),(0,b.jsx)("div",{className:"h-[27px] w-px rotate-12 bg-divider-subtle"}),(0,b.jsxs)("div",{className:"",children:[(0,b.jsx)("div",{className:"system-2xs-medium-uppercase mb-0.5 text-text-tertiary",children:e("voice.voiceSettings.voice",{ns:"appDebug"})}),(0,b.jsx)("div",{className:"system-xs-regular text-text-secondary",children:n.text2speech?.voice||e("voice.defaultDisplay",{ns:"appDebug"})})]}),(0,b.jsx)("div",{className:"h-[27px] w-px rotate-12 bg-divider-subtle"}),(0,b.jsxs)("div",{className:"",children:[(0,b.jsx)("div",{className:"system-2xs-medium-uppercase mb-0.5 text-text-tertiary",children:e("voice.voiceSettings.autoPlay",{ns:"appDebug"})}),(0,b.jsx)("div",{className:"system-xs-regular text-text-secondary",children:e(n.text2speech?.autoPlay===s.TtsAutoPlay.enabled?"voice.voiceSettings.autoPlayEnabled":"voice.voiceSettings.autoPlayDisabled",{ns:"appDebug"})})]})]}),(l||h)&&(0,b.jsx)(aA.default,{open:h&&!a,onOpen:j,onChange:d,children:(0,b.jsxs)(v.default,{className:"w-full",disabled:a,children:[(0,b.jsx)(y.RiEqualizer2Line,{className:"mr-1 h-4 w-4"}),e("voice.voiceSettings.title",{ns:"appDebug"})]})})]})]})})};var aE=a.i(933988),aF=a.i(701458);let aG=({show:a,isChatMode:c,disabled:d,onChange:e,onClose:f,inWorkflow:g=!0,showFileUpload:h=!0,promptVariables:i,workflowVariables:j,onAutoAddPromptVariable:l})=>{let{t:m}=(0,k.useTranslation)(),{data:n}=(0,aF.useDefaultModel)(aE.ModelTypeEnum.speech2text),{data:o}=(0,aF.useDefaultModel)(aE.ModelTypeEnum.tts);return(0,b.jsx)(ai,{show:a,onClose:f,inWorkflow:g,children:(0,b.jsxs)("div",{className:"flex h-full grow flex-col",children:[(0,b.jsxs)("div",{className:"flex shrink-0 justify-between p-4 pb-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"system-xl-semibold text-text-primary",children:m("common.features",{ns:"workflow"})}),(0,b.jsx)("div",{className:"body-xs-regular text-text-tertiary",children:m("common.featuresDescription",{ns:"workflow"})})]}),(0,b.jsx)("div",{className:"h-8 w-8 cursor-pointer p-2",onClick:f,children:(0,b.jsx)(y.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})})]}),(0,b.jsxs)("div",{className:"grow basis-0 overflow-y-auto px-4 pb-4",children:[h&&(0,b.jsxs)("div",{className:"relative mb-1 rounded-xl border border-components-panel-border p-2 shadow-xs",children:[(0,b.jsx)("div",{className:"absolute left-0 top-0 h-full w-full rounded-xl opacity-40",style:{background:"linear-gradient(92deg, rgba(11, 165, 236, 0.25) 18.12%, rgba(255, 255, 255, 0.00) 167.31%)"}}),(0,b.jsxs)("div",{className:"relative flex h-full w-full items-start",children:[(0,b.jsx)("div",{className:"mr-0.5 shrink-0 p-0.5",children:(0,b.jsx)(y.RiInformation2Fill,{className:"h-5 w-5 text-text-accent"})}),(0,b.jsx)("div",{className:"system-xs-medium p-1 text-text-primary",children:(0,b.jsx)("span",{children:m(c?"common.fileUploadTip":"common.ImageUploadLegacyTip",{ns:"workflow"})})})]})]}),!c&&!g&&(0,b.jsx)(ax,{disabled:d,onChange:e}),c&&(0,b.jsx)(af,{disabled:d,onChange:e,promptVariables:i,workflowVariables:j,onAutoAddPromptVariable:l}),c&&(0,b.jsx)(aq,{disabled:d,onChange:e}),o&&(c||!g)&&(0,b.jsx)(aD,{disabled:d,onChange:e}),c&&n&&(0,b.jsx)(az,{disabled:d,onChange:e}),h&&c&&(0,b.jsx)(ao,{disabled:d,onChange:e}),h&&!c&&(0,b.jsx)(as,{disabled:d,onChange:e}),c&&(0,b.jsx)(ac,{disabled:d,onChange:e}),(c||!g)&&(0,b.jsx)(aw,{disabled:d,onChange:e}),!g&&c&&(0,b.jsx)(_,{disabled:d,onChange:e})]})]})})};var aH=a.i(105249),aI=a.i(114715),aJ=a.i(933887),aK=a.i(962800),aL=a.i(29936),aM=a.i(438616),aN=a.i(705134),aO=a.i(120179),aP=a.i(104188),aQ=a.i(585124),aR=a.i(802066),aS=a.i(218257),aT=a.i(844299),aU=a.i(862359),aV=a.i(653822),aW=a.i(685895),aX=a.i(499257);let aY=c.memo(()=>{let{t:a}=(0,k.useTranslation)(),{notify:n}=(0,l.useContext)(aI.ToastContext),{isLoadingCurrentWorkspace:p,currentWorkspace:w}=(0,aN.useAppContext)(),{appDetail:y,showAppConfigureFeaturesModal:z,setAppSidebarExpand:A,setShowAppConfigureFeaturesModal:B}=(0,O.useStore)((0,m.useShallow)(a=>({appDetail:a.appDetail,setAppSidebarExpand:a.setAppSidebarExpand,showAppConfigureFeaturesModal:a.showAppConfigureFeaturesModal,setShowAppConfigureFeaturesModal:a.setShowAppConfigureFeaturesModal}))),{data:C}=(0,av.useFileUploadConfig)(),E=(0,c.useMemo)(()=>y?.model_config?.updated_at,[y]),[F,G]=(0,c.useState)(!1),{setShowAccountSettingModal:H}=(0,ae.useModalContext)(),[S,T]=(0,c.useState)(!1),V=!S,X=(0,j.usePathname)().match(/\/app\/([^/]+)/),Y=X?.length&&X[1]?X[1]:"",[Z,$]=(0,c.useState)(s.AppModeEnum.CHAT),[_,aa]=(0,c.useState)(null),[ab,ac]=(0,c.useState)(""),ad=(0,aQ.default)()===aQ.MediaType.mobile,[af,{setTrue:ag,setFalse:ah}]=(0,e.useBoolean)(!1),[ai,aj]=(0,c.useState)(""),[ak,al]=(0,c.useState)([]),[am,an]=(0,c.useState)(0),[ao,ap]=(0,c.useState)({prompt_template:"",prompt_variables:[]}),[aq,ar]=(0,c.useState)({enabled:!1}),[as,at]=(0,c.useState)({enabled:!1}),[au,aw]=(0,c.useState)({enabled:!1}),[ax,ay]=(0,c.useState)({enabled:!1,voice:"",language:""}),[az,aA]=(0,c.useState)({enabled:!1}),[aB,aC]=(0,c.useState)({id:"",enabled:!1,score_threshold:D.ANNOTATION_DEFAULT.score_threshold,embedding_model:{embedding_provider_name:"",embedding_model_name:""}}),aD=(0,L.useFormattingChangedDispatcher)(),aY=(a,b)=>{aC(a),b||aD()},[aZ,a$]=(0,c.useState)({enabled:!1}),[a_,a0]=(0,c.useState)([]),[a1,a2]=(0,c.useState)({}),[a3,a4]=(0,c.useState)(""),[a5,a6]=(0,c.useState)({}),[a7,a8,a9]=(0,f.useGetState)([]),ba=a=>{let b={...a};b.stop&&0!==b.stop.length||bn.current!==s.ModelModeType.completion||(b.stop=a9(),a8([])),a6(b)},[bb,bc]=(0,c.useState)({provider:"langgenius/openai/openai",model_id:"gpt-3.5-turbo",mode:s.ModelModeType.unset,configs:{prompt_template:"",prompt_variables:[]},chat_prompt_config:(0,g.clone)(D.DEFAULT_CHAT_PROMPT_CONFIG),completion_prompt_config:(0,g.clone)(D.DEFAULT_COMPLETION_PROMPT_CONFIG),more_like_this:null,opening_statement:"",suggested_questions:[],sensitive_word_avoidance:null,speech_to_text:null,text_to_speech:null,file_upload:null,suggested_questions_after_answer:null,retriever_resource:null,annotation_reply:null,external_data_tools:[],system_parameters:{audio_file_size_limit:0,file_size_limit:0,image_file_size_limit:0,video_file_size_limit:0,workflow_file_upload_limit:0},dataSets:[],agentConfig:D.DEFAULT_AGENT_SETTING}),bd=Z===s.AppModeEnum.AGENT_CHAT,be="langgenius/openai/openai"===bb.provider,[bf,bg]=(0,c.useState)([]),[bh,bi]=(0,c.useState)({retrieval_model:s.RETRIEVE_TYPE.multiWay,reranking_model:{reranking_provider_name:"",reranking_model_name:""},top_k:D.DATASET_DEFAULT.top_k,score_threshold_enabled:!1,score_threshold:D.DATASET_DEFAULT.score_threshold,datasets:{datasets:[]}}),bj=(0,c.useRef)(bh),bk=(0,c.useCallback)(a=>{bi(a),bj.current=a},[]),bl=a=>{bc(a)},bm=bb.mode,bn=(0,c.useRef)(bm);(0,c.useEffect)(()=>{bn.current=bm},[bm]);let[bo,bp]=(0,c.useState)([]),bq=bb.configs.prompt_variables.find(a=>a.is_context_var)?.key,br=!!bq,[bs,{setTrue:bt,setFalse:bu}]=(0,e.useBoolean)(!1),bv=bo.map(a=>a.id),[bw,bx]=(0,c.useState)(!1),{currentModel:by,currentProvider:bz}=(0,aF.useModelListAndDefaultModelAndCurrentProviderAndModel)(aE.ModelTypeEnum.rerank),[bA,{setTrue:bB,setFalse:bC}]=(0,e.useBoolean)(!1),bD=a=>{let b=a.modelConfig;bl(a.modelConfig),ba(a.completionParams),bp(b.dataSets||[]),aj(b.opening_statement),ar(b.more_like_this||{enabled:!1}),at(b.suggested_questions_after_answer||{enabled:!1}),aw(b.speech_to_text||{enabled:!1}),ay(b.text_to_speech||{enabled:!1,voice:"",language:""}),aA(b.retriever_resource||{enabled:!1})},{isAPIKeySet:bE}=(0,U.useProviderContext)(),{currentModel:bF,textGenerationModelList:bG}=(0,aF.useTextGenerationCurrentProviderAndModelAndModelList)({provider:bb.provider,model:bb.model_id}),bH=(0,aW.supportFunctionCall)(bF?.features);(0,c.useEffect)(()=>{if(S&&!bm){let a=bF?.model_properties.mode;a&&bl((0,i.produce)(bb,b=>{b.mode=a}))}},[bG,S,bm,bF,bb]);let[bI,bJ]=(0,c.useState)(M.PromptMode.simple),bK=bI===M.PromptMode.advanced,[bL,bM]=(0,c.useState)(!0),bN=async a=>{a===M.PromptMode.advanced&&(await bZ(),bM(!0)),bJ(a)},[bO,bP]=(0,c.useState)({enabled:!1,number_limits:2,detail:s.Resolution.low,transfer_methods:[s.TransferMethod.local_file]}),bQ=(a,b)=>{bP({enabled:a.enabled||!1,number_limits:a.number_limits||2,detail:a.detail||s.Resolution.low,transfer_methods:a.transfer_methods||[s.TransferMethod.local_file]}),b||aD()},{chatPromptConfig:bR,setChatPromptConfig:bS,completionPromptConfig:bT,setCompletionPromptConfig:bU,currentAdvancedPrompt:bV,setCurrentAdvancedPrompt:bW,hasSetBlockStatus:bX,setConversationHistoriesRole:bY,migrateToDefaultPrompt:bZ}=(({appMode:a,modelModeType:b,modelName:d,promptMode:e,prePrompt:f,onUserChangedPrompt:h,hasSetDataSet:j,completionParams:k,setCompletionParams:l,setStop:m})=>{let n=e===M.PromptMode.advanced,[o,p]=(0,c.useState)(()=>(0,g.clone)(D.DEFAULT_CHAT_PROMPT_CONFIG)),[r,t]=(0,c.useState)(()=>(0,g.clone)(D.DEFAULT_COMPLETION_PROMPT_CONFIG)),u=n?b===s.ModelModeType.chat?o.prompt:r.prompt:[],v=(()=>{if(!n)return{context:(0,q.checkHasContextBlock)(f),history:!1,query:!1};if(b===s.ModelModeType.chat)return{context:!!o.prompt.find(a=>(0,q.checkHasContextBlock)(a.text)),history:!1,query:!!o.prompt.find(a=>(0,q.checkHasQueryBlock)(a.text))};{let a=r.prompt?.text;return{context:(0,q.checkHasContextBlock)(a),history:(0,q.checkHasHistoryBlock)(a),query:(0,q.checkHasQueryBlock)(a)}}})(),w=async(c,e)=>{let g=f||"";if(a){if(!n){let{chat_prompt_config:c,completion_prompt_config:e,stop:f}=await (0,N.fetchPromptTemplate)({appMode:a,mode:b,modelName:d,hasSetDataSet:j});b===s.ModelModeType.chat?p((0,i.produce)(c,a=>{a.prompt=a.prompt.map(a=>({...a,text:a.text.replace(q.PRE_PROMPT_PLACEHOLDER_TEXT,g)}))})):(t((0,i.produce)(e,a=>{a.prompt.text=a.prompt.text.replace(q.PRE_PROMPT_PLACEHOLDER_TEXT,g)})),l({...k,stop:f}));return}if(c){let{completion_prompt_config:b,chat_prompt_config:c,stop:f}=await (0,N.fetchPromptTemplate)({appMode:a,mode:e,modelName:d,hasSetDataSet:j});e===s.ModelModeType.completion?(t((0,i.produce)(b,b=>{r.prompt?.text?b.prompt.text=r.prompt?.text.replace(q.PRE_PROMPT_PLACEHOLDER_TEXT,g):b.prompt.text=b.prompt.text.replace(q.PRE_PROMPT_PLACEHOLDER_TEXT,g),[s.AppModeEnum.ADVANCED_CHAT,s.AppModeEnum.AGENT_CHAT,s.AppModeEnum.CHAT].includes(a)&&r.conversation_histories_role.assistant_prefix&&r.conversation_histories_role.user_prefix&&(b.conversation_histories_role=r.conversation_histories_role)})),k.stop&&0!==k.stop.length||l({...k,stop:f}),m(f)):p((0,i.produce)(c,a=>{a.prompt=a.prompt.map(a=>({...a,text:a.text.replace(q.PRE_PROMPT_PLACEHOLDER_TEXT,g)}))}))}}};return{chatPromptConfig:o,setChatPromptConfig:p,completionPromptConfig:r,setCompletionPromptConfig:t,currentAdvancedPrompt:u,setCurrentAdvancedPrompt:(a,c)=>{n&&(b===s.ModelModeType.chat?p({...o,prompt:a}):t({...r,prompt:a}),c&&h())},hasSetBlockStatus:v,setConversationHistoriesRole:a=>{t({...r,conversation_histories_role:a})},migrateToDefaultPrompt:w}})({appMode:Z,modelName:bb.model_id,promptMode:bI,modelModeType:bm,prePrompt:bb.configs.prompt_template,hasSetDataSet:bo.length>0,onUserChangedPrompt:()=>{bM(!1)},completionParams:a5,setCompletionParams:ba,setStop:a8}),b$=async({modelId:b,provider:c,mode:d,features:e})=>{bK&&(d===s.ModelModeType.completion&&(Z!==s.AppModeEnum.COMPLETION?bT.prompt?.text&&bT.conversation_histories_role.assistant_prefix&&bT.conversation_histories_role.user_prefix||await bZ(!0,s.ModelModeType.completion):bT.prompt?.text||await bZ(!0,s.ModelModeType.completion)),d===s.ModelModeType.chat&&0===bR.prompt.length&&await bZ(!0,s.ModelModeType.chat)),bl((0,i.produce)(bb,a=>{a.provider=c,a.model_id=b,a.mode=d}));let f=e&&e.includes(aE.ModelFeatureEnum.vision);bQ({...bO,enabled:f},!0);try{let{params:d,removedDetails:e}=await (0,aU.fetchAndMergeValidCompletionParams)(c,b,a5,bK);Object.keys(e).length&&aI.default.notify({type:"warning",message:`${a("modelProvider.parametersInvalidRemoved",{ns:"common"})}: ${Object.entries(e).map(([a,b])=>`${a} (${b})`).join(", ")}`}),ba(d)}catch{aI.default.notify({type:"error",message:a("error",{ns:"common"})}),ba({})}},b_=!!bF?.features?.includes(aE.ModelFeatureEnum.vision),b0=!!bF?.features?.includes(aE.ModelFeatureEnum.document),b1=!!bF?.features?.includes(aE.ModelFeatureEnum.audio),b2=!!bF?.features?.includes(aE.ModelFeatureEnum.video),b3=(0,c.useMemo)(()=>({moreLikeThis:bb.more_like_this||{enabled:!1},opening:{enabled:!!bb.opening_statement,opening_statement:bb.opening_statement||"",suggested_questions:bb.suggested_questions||[]},moderation:bb.sensitive_word_avoidance||{enabled:!1},speech2text:bb.speech_to_text||{enabled:!1},text2speech:bb.text_to_speech||{enabled:!1},file:{image:{detail:bb.file_upload?.image?.detail||s.Resolution.high,enabled:!!bb.file_upload?.image?.enabled,number_limits:bb.file_upload?.image?.number_limits||3,transfer_methods:bb.file_upload?.image?.transfer_methods||["local_file","remote_url"]},enabled:!!(bb.file_upload?.enabled||bb.file_upload?.image?.enabled),allowed_file_types:bb.file_upload?.allowed_file_types||[],allowed_file_extensions:bb.file_upload?.allowed_file_extensions||[...q.FILE_EXTS[r.SupportUploadFileTypes.image],...q.FILE_EXTS[r.SupportUploadFileTypes.video]].map(a=>`.${a}`),allowed_file_upload_methods:bb.file_upload?.allowed_file_upload_methods||bb.file_upload?.image?.transfer_methods||["local_file","remote_url"],number_limits:bb.file_upload?.number_limits||bb.file_upload?.image?.number_limits||3,fileUploadConfig:C},suggested:bb.suggested_questions_after_answer||{enabled:!1},citation:bb.retriever_resource||{enabled:!1},annotationReply:bb.annotation_reply||{enabled:!1}}),[C,bb]),b4=(0,c.useCallback)(a=>{B(!0),a&&aD()},[aD,B]),b5=(0,c.useCallback)(a=>{bl((0,i.produce)(bb,b=>{b.configs.prompt_variables=[...b.configs.prompt_variables,...a]}))},[bb]);(0,c.useEffect)(()=>{(async()=>{let a=await (0,aT.fetchCollectionList)();aX.basePath&&a.forEach(a=>{"string"!=typeof a.icon||a.icon.includes(aX.basePath)||(a.icon=`${aX.basePath}${a.icon}`)}),bg(a);let b=await (0,aR.fetchAppDetailDirect)({url:"/apps",id:Y});$(b.mode);let c=b.model_config,d=c.prompt_type===M.PromptMode.advanced?M.PromptMode.advanced:M.PromptMode.simple;bJ(d),d===M.PromptMode.advanced&&(c.chat_prompt_config&&c.chat_prompt_config.prompt.length>0?bS(c.chat_prompt_config):bS((0,g.clone)(D.DEFAULT_CHAT_PROMPT_CONFIG)),bU(c.completion_prompt_config||(0,g.clone)(D.DEFAULT_COMPLETION_PROMPT_CONFIG)),bM(!1));let e=c.model,f=null;if(c.agent_mode?.tools?.find(({dataset:a})=>a?.enabled)?f=c.agent_mode?.tools.filter(({dataset:a})=>a?.enabled):c.dataset_configs.datasets?.datasets?.length>0&&(f=c.dataset_configs?.datasets?.datasets),bo&&f?.length&&f?.length>0){let{data:a}=await (0,aS.fetchDatasets)({url:"/datasets",params:{page:1,ids:f.map(({dataset:a})=>a.id)}});bp(f=a)}if(aj(c.opening_statement),al(c.suggested_questions||[]),c.more_like_this&&ar(c.more_like_this),c.suggested_questions_after_answer&&at(c.suggested_questions_after_answer),c.speech_to_text&&aw(c.speech_to_text),c.text_to_speech&&ay(c.text_to_speech),c.retriever_resource&&aA(c.retriever_resource),c.annotation_reply){let a=c.annotation_reply;c.annotation_reply.enabled&&(a={...c.annotation_reply,embedding_model:{...c.annotation_reply.embedding_model,embedding_provider_name:(0,W.correctModelProvider)(c.annotation_reply.embedding_model.embedding_provider_name)}}),aY(a,!0)}c.sensitive_word_avoidance&&a$(c.sensitive_word_avoidance),c.external_data_tools&&a0(c.external_data_tools);let h={modelConfig:{provider:(0,W.correctModelProvider)(e.provider),model_id:e.name,mode:e.mode,configs:{prompt_template:c.pre_prompt||"",prompt_variables:(0,aV.userInputsFormToPromptVariables)([...c.user_input_form,...c.external_data_tools?.length?c.external_data_tools.map(a=>({external_data_tool:{variable:a.variable,label:a.label,enabled:a.enabled,type:a.type,config:a.config,required:!0,icon:a.icon,icon_background:a.icon_background}})):[]],c.dataset_query_variable)},more_like_this:c.more_like_this??{enabled:!1},opening_statement:c.opening_statement,suggested_questions:c.suggested_questions??[],sensitive_word_avoidance:c.sensitive_word_avoidance,speech_to_text:c.speech_to_text,text_to_speech:c.text_to_speech,file_upload:c.file_upload??null,suggested_questions_after_answer:c.suggested_questions_after_answer??{enabled:!1},retriever_resource:c.retriever_resource,annotation_reply:c.annotation_reply??null,external_data_tools:c.external_data_tools??[],system_parameters:c.system_parameters,dataSets:f||[],agentConfig:b.mode===s.AppModeEnum.AGENT_CHAT?{max_iteration:D.DEFAULT_AGENT_SETTING.max_iteration,...c.agent_mode,enabled:!0,tools:(c.agent_mode?.tools??[]).filter(a=>!a.dataset).map(c=>{let d=a.find(a=>c.provider_id===a.id);return{...c,isDeleted:b.deleted_tools?.some(a=>a.provider_id===c.provider_id&&a.tool_name===c.tool_name)??!1,notAuthor:d?.is_team_authorization===!1,..."builtin"===c.provider_type?{provider_id:(0,W.correctToolProvider)(c.provider_name,!!d),provider_name:(0,W.correctToolProvider)(c.provider_name,!!d)}:{}}}),strategy:c.agent_mode?.strategy??s.AgentStrategy.react}:D.DEFAULT_AGENT_SETTING},completionParams:e.completion_params};c.file_upload&&bQ(c.file_upload.image,!0),bD(h),aa(h);let i=(0,aL.getMultipleRetrievalConfig)({...c.dataset_configs,reranking_model:c.dataset_configs.reranking_model&&{provider:c.dataset_configs.reranking_model.reranking_provider_name,model:c.dataset_configs.reranking_model.reranking_model_name}},f,f,{provider:bz?.provider,model:by?.model}),j={...c.dataset_configs,...i,...i.reranking_model?{reranking_model:{reranking_model_name:i.reranking_model.model,reranking_provider_name:(0,W.correctModelProvider)(i.reranking_model.provider)}}:{}};j.retrieval_model=j.retrieval_model??s.RETRIEVE_TYPE.multiWay,bk(j),T(!0)})()},[Y]);let b6=Z===s.AppModeEnum.COMPLETION&&(bK?bm===s.ModelModeType.chat?bR.prompt.every(({text:a})=>!a):!bT.prompt?.text:!bb.configs.prompt_template),b7=Z===s.AppModeEnum.COMPLETION?b6:!!bK&&(bm===s.ModelModeType.completion&&(!bX.history||!bX.query)||!1),b8=Z===s.AppModeEnum.COMPLETION&&bo.length>0&&!br,b9=async(b,c)=>{let d=b?.model||bb.model_id,e=bb.configs.prompt_template,f=bb.configs.prompt_variables;if(b6)return void n({type:"error",message:a("otherError.promptNoBeEmpty",{ns:"appDebug"})});if(bK&&Z!==s.AppModeEnum.COMPLETION&&bm===s.ModelModeType.completion){if(!bX.history)return void n({type:"error",message:a("otherError.historyNoBeEmpty",{ns:"appDebug"})});if(!bX.query)return void n({type:"error",message:a("otherError.queryNoBeEmpty",{ns:"appDebug"})})}if(b8)return void n({type:"error",message:a("feature.dataSet.queryVariable.contextVarNotEmpty",{ns:"appDebug"})});let h=bo.map(({id:a})=>({dataset:{enabled:!0,id:a}})),j={...c?.file};delete j?.fileUploadConfig;let k={pre_prompt:bK?"":e,prompt_type:bI,chat_prompt_config:bK?bR:(0,g.clone)(D.DEFAULT_CHAT_PROMPT_CONFIG),completion_prompt_config:bK?bT:(0,g.clone)(D.DEFAULT_COMPLETION_PROMPT_CONFIG),user_input_form:(0,aV.promptVariablesToUserInputsForm)(f),dataset_query_variable:bq||"",more_like_this:c?.moreLikeThis,opening_statement:c?.opening?.enabled&&c.opening?.opening_statement||"",suggested_questions:c?.opening?.enabled&&c.opening?.suggested_questions||[],sensitive_word_avoidance:c?.moderation,speech_to_text:c?.speech2text,text_to_speech:c?.text2speech,file_upload:j,suggested_questions_after_answer:c?.suggested,retriever_resource:c?.citation,agent_mode:{...bb.agentConfig,strategy:bH?s.AgentStrategy.functionCall:s.AgentStrategy.react},external_data_tools:a_,model:{provider:b?.provider||bb.provider,name:d,mode:bb.mode,completion_params:b?.parameters||a5},dataset_configs:{...bh,datasets:{datasets:[...h]}},system_parameters:bb.system_parameters};return await (0,aR.updateAppModelConfig)({url:`/apps/${Y}/model-config`,body:k}),aa({modelConfig:(0,i.produce)(bb,a=>{a.opening_statement=ai,a.more_like_this=aq,a.suggested_questions_after_answer=as,a.speech_to_text=au,a.text_to_speech=ax,a.retriever_resource=az,a.dataSets=bo}),completionParams:a5}),n({type:"success",message:a("api.success",{ns:"common"})}),bM(!1),!0},[ca,cb]=(0,c.useState)(!1),{debugWithMultipleModel:cc,multipleModelConfigs:cd,handleMultipleModelConfigsChange:ce}=(0,L.useDebugWithSingleOrMultipleModel)(Y);if(V||p||!w.id)return(0,b.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,b.jsx)(aH.default,{type:"area"})});let cf={appId:Y,isAPIKeySet:bE,isTrailFinished:!1,mode:Z,modelModeType:bm,promptMode:bI,isAdvancedMode:bK,isAgent:bd,isOpenAI:be,isFunctionCall:bH,collectionList:bf,setPromptMode:bN,canReturnToSimpleMode:bL,setCanReturnToSimpleMode:bM,chatPromptConfig:bR,completionPromptConfig:bT,currentAdvancedPrompt:bV,setCurrentAdvancedPrompt:bW,conversationHistoriesRole:bT.conversation_histories_role,showHistoryModal:bB,setConversationHistoriesRole:bY,hasSetBlockStatus:bX,conversationId:ab,introduction:ai,setIntroduction:aj,suggestedQuestions:ak,setSuggestedQuestions:al,setConversationId:ac,controlClearChatMessage:am,setControlClearChatMessage:an,prevPromptConfig:ao,setPrevPromptConfig:ap,moreLikeThisConfig:aq,setMoreLikeThisConfig:ar,suggestedQuestionsAfterAnswerConfig:as,setSuggestedQuestionsAfterAnswerConfig:at,speechToTextConfig:au,setSpeechToTextConfig:aw,textToSpeechConfig:ax,setTextToSpeechConfig:ay,citationConfig:az,setCitationConfig:aA,annotationConfig:aB,setAnnotationConfig:aY,moderationConfig:aZ,setModerationConfig:a$,externalDataToolsConfig:a_,setExternalDataToolsConfig:a0,formattingChanged:F,setFormattingChanged:G,inputs:a1,setInputs:a2,query:a3,setQuery:a4,completionParams:a5,setCompletionParams:ba,modelConfig:bb,setModelConfig:bl,showSelectDataSet:bt,dataSets:bo,setDataSets:bp,datasetConfigs:bh,datasetConfigsRef:bj,setDatasetConfigs:bk,hasSetContextVar:br,isShowVisionConfig:b_,visionConfig:bO,setVisionConfig:bQ,isAllowVideoUpload:b2,isShowDocumentConfig:b0,isShowAudioConfig:b1,rerankSettingModalOpen:bw,setRerankSettingModalOpen:bx};return(0,b.jsx)(aO.default.Provider,{value:cf,children:(0,b.jsx)(R.FeaturesProvider,{features:b3,children:(0,b.jsxs)(aP.MittProvider,{children:[(0,b.jsx)("div",{className:"flex h-full flex-col",children:(0,b.jsxs)("div",{className:"relative flex h-[200px] grow pt-14",children:[(0,b.jsx)("div",{className:"bg-default-subtle absolute left-0 top-0 h-14 w-full",children:(0,b.jsxs)("div",{className:"flex h-14 items-center justify-between px-6",children:[(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)("div",{className:"system-xl-semibold text-text-primary",children:a("orchestrate",{ns:"appDebug"})}),(0,b.jsx)("div",{className:"flex h-[14px] items-center space-x-1 text-xs",children:bK&&(0,b.jsx)("div",{className:"system-xs-medium-uppercase ml-1 flex h-5 items-center rounded-md border border-components-button-secondary-border px-1.5 uppercase text-text-tertiary",children:a("promptMode.advanced",{ns:"appDebug"})})})]}),(0,b.jsxs)("div",{className:"flex items-center",children:[bd&&(0,b.jsx)(I,{isChatModel:bb.mode===s.ModelModeType.chat,agentConfig:bb.agentConfig,isFunctionCall:bH,onAgentSettingChange:a=>{bl((0,i.produce)(bb,b=>{b.agentConfig=a}))}}),!cc&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(aK.default,{isAdvancedMode:bK,provider:bb.provider,completionParams:a5,modelId:bb.model_id,setModel:b$,onCompletionParamsChange:a=>{ba(a)},debugWithMultipleModel:cc,onDebugWithMultipleModelChange:()=>{ce(!0,[{id:`${Date.now()}`,model:bb.model_id,provider:bb.provider,parameters:a5},{id:`${Date.now()}-no-repeat`,model:"",provider:"",parameters:{}}]),A("collapse")}}),(0,b.jsx)(P.default,{type:"vertical",className:"mx-2 h-[14px]"})]}),ad&&(0,b.jsxs)(v.default,{className:"mr-2 !h-8 !text-[13px] font-medium",onClick:ag,children:[(0,b.jsx)("span",{className:"mr-1",children:a("operation.debugConfig",{ns:"appDebug"})}),(0,b.jsx)(d,{className:"h-4 w-4 text-text-tertiary"})]}),(0,b.jsx)(t,{publishDisabled:b7,publishedAt:1e3*(E||0),debugWithMultipleModel:cc,multipleModelConfigs:cd,onPublish:b9,publishedConfig:_,resetAppConfig:()=>bD(_)})]})]})}),(0,b.jsx)("div",{className:`flex h-full w-full shrink-0 flex-col sm:w-1/2 ${cc&&"max-w-[560px]"}`,children:(0,b.jsx)(u.default,{})}),!ad&&(0,b.jsx)("div",{className:"relative flex h-full w-1/2 grow flex-col overflow-y-auto ",style:{borderColor:"rgba(0, 0, 0, 0.02)"},children:(0,b.jsx)("div",{className:"flex grow flex-col rounded-tl-2xl border-l-[0.5px] border-t-[0.5px] border-components-panel-border bg-chatbot-bg ",children:(0,b.jsx)(K.default,{isAPIKeySet:bE,onSetting:()=>H({payload:aJ.ACCOUNT_SETTING_TAB.PROVIDER}),inputs:a1,modelParameterParams:{setModel:b$,onCompletionParamsChange:ba},debugWithMultipleModel:cc,multipleModelConfigs:cd,onMultipleModelConfigsChange:ce})})})]})}),ca&&(0,b.jsx)(o.default,{title:a("trailUseGPT4Info.title",{ns:"appDebug"}),content:a("trailUseGPT4Info.description",{ns:"appDebug"}),isShow:ca,onConfirm:()=>{H({payload:aJ.ACCOUNT_SETTING_TAB.PROVIDER}),cb(!1)},onCancel:()=>cb(!1)}),bs&&(0,b.jsx)(J.default,{isShow:bs,onClose:bu,selectedIds:bv,onSelect:a=>{if((0,h.isEqual)(a.map(a=>a.id),bo.map(a=>a.id)))return void bu();aD();let b=a;if(a.find(a=>!a.name)){let c=(0,i.produce)(a,b=>{a.forEach((a,c)=>{if(!a.name){let d=bo.find(b=>b.id===a.id);d&&(b[c]=d)}})});bp(c),b=c}else bp(a);bu();let{allExternal:c,allInternal:d,mixtureInternalAndExternal:e,mixtureHighQualityAndEconomic:f,inconsistentEmbeddingModel:g}=(0,aL.getSelectedDatasetsMode)(b);(d&&(f||g)||e||c)&&bx(!0);let{datasets:j,retrieval_model:k,score_threshold_enabled:l,...m}=bh,{top_k:n,score_threshold:o,reranking_model:p,reranking_mode:q,weights:r,reranking_enable:s}=m,t={top_k:n,score_threshold:o,reranking_model:p?.reranking_provider_name&&p?.reranking_model_name?{provider:p.reranking_provider_name,model:p.reranking_model_name}:void 0,reranking_mode:q,weights:r,reranking_enable:s},u=(0,aL.getMultipleRetrievalConfig)(t,b,bo,{provider:bz?.provider,model:by?.model});bk({...bj.current,...u,reranking_model:{reranking_provider_name:u?.reranking_model?.provider||"",reranking_model_name:u?.reranking_model?.model||""},retrieval_model:k,score_threshold_enabled:l,datasets:j})}}),bA&&(0,b.jsx)(x,{isShow:bA,saveLoading:!1,onClose:bC,data:bT.conversation_histories_role,onSave:a=>{bY(a),bC()}}),ad&&(0,b.jsx)(Q.default,{showClose:!0,isOpen:af,onClose:ah,mask:!0,footer:null,children:(0,b.jsx)(K.default,{isAPIKeySet:bE,onSetting:()=>H({payload:aJ.ACCOUNT_SETTING_TAB.PROVIDER}),inputs:a1,modelParameterParams:{setModel:b$,onCompletionParamsChange:ba},debugWithMultipleModel:cc,multipleModelConfigs:cd,onMultipleModelConfigsChange:ce})}),z&&(0,b.jsx)(aG,{show:!0,inWorkflow:!1,showFileUpload:!1,isChatMode:Z!==s.AppModeEnum.COMPLETION,disabled:!1,onChange:b4,onClose:()=>B(!1),promptVariables:bb.configs.prompt_variables,onAutoAddPromptVariable:b5}),(0,b.jsx)(aM.default,{})]})})})});a.s(["default",0,aY],305579)}];

//# sourceMappingURL=app_components_app_configuration_index_tsx_d50c29c0._.js.map
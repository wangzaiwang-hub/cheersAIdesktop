module.exports=[520452,a=>{"use strict";var b,c=a.i(608061),d=a.i(57843),e=a.i(639378),f=a.i(105249),g=a.i(585124),h=a.i(280342),i=a.i(527344),j=a.i(463963),k=a.i(627001),l=a.i(355968);a.i(752298);var m=a.i(693025),n=a.i(909795);a.i(3626);var o=a.i(684714),p=a.i(816134),q=a.i(805611),r=a.i(146172),s=a.i(532655),t=a.i(373178),u=a.i(787405),v=a.i(735310),w=a.i(111089);let x=(0,e.createContext)({currentConversationId:"",appPrevChatTree:[],pinnedConversationList:[],conversationList:[],newConversationInputs:{},newConversationInputsRef:{current:{}},handleNewConversationInputsChange:w.noop,inputsForms:[],handleNewConversation:w.noop,handleStartChat:w.noop,handleChangeConversation:w.noop,handlePinConversation:w.noop,handleUnpinConversation:w.noop,handleDeleteConversation:w.noop,conversationRenaming:!1,handleRenameConversation:w.noop,handleNewConversationCompleted:w.noop,chatShouldReloadKey:"",isMobile:!1,isInstalledApp:!1,handleFeedback:w.noop,currentChatInstanceRef:{current:{handleStop:w.noop}},sidebarCollapseState:!1,handleSidebarCollapse:w.noop,clearChatList:!1,setClearChatList:w.noop,isResponding:!1,setIsResponding:w.noop,currentConversationInputs:{},setCurrentConversationInputs:w.noop,allInputsHidden:!1,initUserVariables:{}}),y=()=>(0,e.useContext)(x),z=(0,d.memo)(({showTip:a})=>{let{t:b}=(0,m.useTranslation)(),{appParams:e,inputsForms:f,currentConversationId:g,currentConversationInputs:h,setCurrentConversationInputs:i,newConversationInputs:j,newConversationInputsRef:k,handleNewConversationInputsChange:l}=y(),n=g?h:j,w=(0,d.useCallback)((a,b)=>{i({...h,[a]:b}),l({...k.current,[a]:b})},[k,l,h,i]),x=f.filter(a=>!0!==a.hide);return(0,c.jsxs)("div",{className:"space-y-4",children:[x.map(a=>(0,c.jsxs)("div",{className:"space-y-1",children:[a.type!==v.InputVarType.checkbox&&(0,c.jsxs)("div",{className:"flex h-6 items-center gap-1",children:[(0,c.jsx)("div",{className:"system-md-semibold text-text-secondary",children:a.label}),!a.required&&(0,c.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:b("panel.optional",{ns:"workflow"})})]}),a.type===v.InputVarType.textInput&&(0,c.jsx)(p.default,{value:n?.[a.variable]||"",onChange:b=>w(a.variable,b.target.value),placeholder:a.label}),a.type===v.InputVarType.number&&(0,c.jsx)(p.default,{type:"number",value:n?.[a.variable]||"",onChange:b=>w(a.variable,b.target.value),placeholder:a.label}),a.type===v.InputVarType.paragraph&&(0,c.jsx)(r.default,{value:n?.[a.variable]||"",onChange:b=>w(a.variable,b.target.value),placeholder:a.label}),a.type===v.InputVarType.checkbox&&(0,c.jsx)(s.default,{name:a.label,value:!!n?.[a.variable],required:a.required,onChange:b=>w(a.variable,b)}),a.type===v.InputVarType.select&&(0,c.jsx)(q.PortalSelect,{popupClassName:"w-[200px]",value:n?.[a.variable]??a.default??"",items:a.options.map(a=>({value:a,name:a})),onSelect:b=>w(a.variable,b.value),placeholder:a.label}),a.type===v.InputVarType.singleFile&&(0,c.jsx)(o.FileUploaderInAttachmentWrapper,{value:n?.[a.variable]?[n?.[a.variable]]:[],onChange:b=>w(a.variable,b[0]),fileConfig:{allowed_file_types:a.allowed_file_types,allowed_file_extensions:a.allowed_file_extensions,allowed_file_upload_methods:a.allowed_file_upload_methods,number_limits:1,fileUploadConfig:e.system_parameters}}),a.type===v.InputVarType.multiFiles&&(0,c.jsx)(o.FileUploaderInAttachmentWrapper,{value:n?.[a.variable]||[],onChange:b=>w(a.variable,b),fileConfig:{allowed_file_types:a.allowed_file_types,allowed_file_extensions:a.allowed_file_extensions,allowed_file_upload_methods:a.allowed_file_upload_methods,number_limits:a.max_length,fileUploadConfig:e.system_parameters}}),a.type===v.InputVarType.jsonObject&&(0,c.jsx)(t.default,{language:u.CodeLanguage.json,value:n?.[a.variable]||"",onChange:b=>w(a.variable,b),noWrapper:!0,className:"bg h-[80px] overflow-y-auto rounded-[10px] bg-components-input-bg-normal p-1",placeholder:(0,c.jsx)("div",{className:"whitespace-pre",children:a.json_schema})})]},a.variable)),a&&(0,c.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:b("chat.chatFormTip",{ns:"share"})})]})});var A=a.i(757801);a.i(735510);var B=a.i(492507);let C=({collapsed:a,setCollapsed:b})=>{let{t:d}=(0,m.useTranslation)(),{isMobile:e,currentConversationId:f,handleStartChat:g,allInputsHidden:h,themeBuilder:j,inputsForms:k}=y();return h||0===k.length?null:(0,c.jsxs)("div",{className:(0,i.cn)("flex flex-col items-center px-4 pt-6",e&&"pt-4"),children:[(0,c.jsxs)("div",{className:(0,i.cn)("w-full max-w-[672px] rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-md",a&&"border border-components-card-border bg-components-card-bg shadow-none"),children:[(0,c.jsxs)("div",{className:(0,i.cn)("flex items-center gap-3 rounded-t-2xl px-6 py-4",!a&&"border-b border-divider-subtle",e&&"px-4 py-3"),children:[(0,c.jsx)(B.Message3Fill,{className:"h-6 w-6 shrink-0"}),(0,c.jsx)("div",{className:"system-xl-semibold grow text-text-secondary",children:d("chat.chatSettingsTitle",{ns:"share"})}),a&&(0,c.jsx)(n.default,{className:"uppercase text-text-tertiary",size:"small",variant:"ghost",onClick:()=>b(!1),children:d("operation.edit",{ns:"common"})}),!a&&f&&(0,c.jsx)(n.default,{className:"uppercase text-text-tertiary",size:"small",variant:"ghost",onClick:()=>b(!0),children:d("operation.close",{ns:"common"})})]}),!a&&(0,c.jsx)("div",{className:(0,i.cn)("p-6",e&&"p-4"),children:(0,c.jsx)(z,{})}),!a&&!f&&(0,c.jsx)("div",{className:(0,i.cn)("p-6",e&&"p-4"),children:(0,c.jsx)(n.default,{variant:"primary",className:"w-full",onClick:()=>g(()=>b(!0)),style:j?.theme?{backgroundColor:j?.theme.primaryColor}:{},children:d("chat.startChat",{ns:"share"})})})]}),a&&(0,c.jsxs)("div",{className:"flex w-full max-w-[720px] items-center py-4",children:[(0,c.jsx)(A.default,{bgStyle:"gradient",className:"h-px basis-1/2 rotate-180"}),(0,c.jsx)(A.default,{bgStyle:"gradient",className:"h-px basis-1/2"})]})]})};var D=a.i(246378),E=a.i(189583),F=a.i(692520),G=a.i(954200),H=a.i(653822),I=a.i(892839),J=a.i(992602),K=a.i(847118),L=a.i(546107);let M=()=>{let{appParams:a,appPrevChatTree:b,currentConversationId:e,currentConversationItem:f,currentConversationInputs:g,inputsForms:h,newConversationInputs:j,newConversationInputsRef:m,handleNewConversationCompleted:n,isMobile:o,isInstalledApp:p,appId:q,appMeta:r,handleFeedback:s,currentChatInstanceRef:t,appData:u,themeBuilder:w,sidebarCollapseState:x,clearChatList:z,setClearChatList:A,setIsResponding:B,allInputsHidden:M,initUserVariables:N}=y(),O=p?F.AppSourceType.installedApp:F.AppSourceType.webApp,P=!!e,Q=(0,d.useMemo)(()=>{let b=a||{};return{...b,file_upload:{...b.file_upload,fileUploadConfig:b.system_parameters},supportFeedback:!0,opening_statement:f?.introduction||b.opening_statement}},[a,f?.introduction]),{chatList:R,setTargetMessageId:S,handleSend:T,handleStop:U,isResponding:V,suggestedQuestions:W}=(0,K.useChat)(Q,{inputs:e?g:j,inputsForm:h},b,a=>(0,F.stopChatMessageResponding)("",a,O,q),z,A),X=e?g:m?.current,Y=(0,d.useMemo)(()=>{if(M)return!1;let a="",b=!1,c=h.filter(({required:a,type:b})=>a&&b!==v.InputVarType.checkbox);return c.length&&c.forEach(({variable:c,label:d,type:e})=>{if(!a&&!b&&(X?.[c]||(a=d),(e===v.InputVarType.singleFile||e===v.InputVarType.multiFiles)&&X?.[c])){let a=X[c];b=Array.isArray(a)?a.find(a=>a.transferMethod===G.TransferMethod.local_file&&!a.uploadedId):a.transferMethod===G.TransferMethod.local_file&&!a.uploadedId}}),!!a||!!b},[X,h,M]);(0,d.useEffect)(()=>{t.current&&(t.current.handleStop=U)},[]),(0,d.useEffect)(()=>{B(V)},[V,B]);let Z=(0,d.useCallback)((a,b,c=!1,d=null)=>{let f={query:a,files:b,inputs:(0,H.formatBooleanInputs)(h,e?g:j),conversation_id:e,parent_message_id:(c?d?.id:(0,L.getLastAnswer)(R)?.id)||null};T((0,F.getUrl)("chat-messages",O,q||""),f,{onGetSuggestedQuestions:a=>(0,F.fetchSuggestedQuestions)(a,O,q),onConversationComplete:P?void 0:n,isPublicAPI:!p})},[R,n,T,e,g,j,p,q]),$=(0,d.useCallback)((a,b)=>{let c=b?a:R.find(b=>b.id===a.parentMessageId),d=R.find(a=>a.id===c.parentMessageId);Z(b?b.message:c.content,b?b.files:c.message_files,!0,(0,L.isValidGeneratedAnswer)(d)?d:null)},[R,Z]),_=(0,d.useMemo)(()=>e||R.length>1?R:R.filter(a=>!a.isOpeningStatement),[R]),[aa,ab]=(0,d.useState)(!!e),ac=(0,d.useMemo)(()=>M||!h.length||o&&e?null:(0,c.jsx)(C,{collapsed:aa,setCollapsed:ab}),[h.length,o,e,aa,M]),ad=(0,d.useMemo)(()=>{let a=R.find(a=>a.isOpeningStatement);return V||e||!a||!aa&&h.length>0&&!M?null:a.suggestedQuestions&&a.suggestedQuestions?.length>0?(0,c.jsx)("div",{className:"flex min-h-[50vh] items-center justify-center px-4 py-12",children:(0,c.jsxs)("div",{className:"flex max-w-[720px] grow gap-4",children:[(0,c.jsx)(l.default,{size:"xl",iconType:u?.site.icon_type,icon:u?.site.icon,background:u?.site.icon_background,imageUrl:u?.site.icon_url}),(0,c.jsx)("div",{className:"w-0 grow",children:(0,c.jsxs)("div",{className:"body-lg-regular grow rounded-2xl bg-chat-bubble-bg px-4 py-3 text-text-primary",children:[(0,c.jsx)(E.Markdown,{content:a.content}),(0,c.jsx)(D.default,{item:a})]})})]})}):(0,c.jsxs)("div",{className:(0,i.cn)("flex min-h-[50vh] flex-col items-center justify-center gap-3 py-12"),children:[(0,c.jsx)(l.default,{size:"xl",iconType:u?.site.icon_type,icon:u?.site.icon,background:u?.site.icon_background,imageUrl:u?.site.icon_url}),(0,c.jsx)("div",{className:"max-w-[768px] px-4",children:(0,c.jsx)(E.Markdown,{className:"!body-2xl-regular !text-text-tertiary",content:a.content})})]})},[u?.site.icon,u?.site.icon_background,u?.site.icon_type,u?.site.icon_url,R,aa,e,h.length,V,M]),ae=u?.site&&u.site.use_icon_as_answer_icon?(0,c.jsx)(k.default,{iconType:u.site.icon_type,icon:u.site.icon,background:u.site.icon_background,imageUrl:u.site.icon_url}):null;return(0,c.jsx)("div",{className:"h-full overflow-hidden bg-chatbot-bg",children:(0,c.jsx)(J.default,{appData:u??void 0,config:Q,chatList:_,isResponding:V,chatContainerInnerClassName:`mx-auto pt-6 w-full max-w-[768px] ${o&&"px-4"}`,chatFooterClassName:"pb-4",chatFooterInnerClassName:`mx-auto w-full max-w-[768px] ${o?"px-2":"px-4"}`,onSend:Z,inputs:e?g:j,inputsForm:h,onRegenerate:$,onStopResponding:U,chatNode:(0,c.jsxs)(c.Fragment,{children:[ac,ad]}),allToolIcons:r?.tool_icons||{},onFeedback:s,suggestedQuestions:W,answerIcon:ae,hideProcessDetail:!0,themeBuilder:w,switchSibling:a=>S(a),inputDisabled:Y,sidebarCollapseState:x,questionIcon:N?.avatar_url?(0,c.jsx)(I.default,{avatar:N.avatar_url,name:N.name||"user",size:40}):void 0})})};var N=a.i(429150),O=a.i(175809),P=a.i(825319);let Q=()=>{let{t:a}=(0,m.useTranslation)(),[b,e]=(0,d.useState)(!1);return(0,c.jsxs)(P.PortalToFollowElem,{open:b,onOpenChange:e,placement:"bottom-end",offset:{mainAxis:4,crossAxis:4},children:[(0,c.jsx)(P.PortalToFollowElemTrigger,{onClick:()=>e(a=>!a),children:(0,c.jsx)(O.default,{size:"l",state:b?O.ActionButtonState.Hover:O.ActionButtonState.Default,children:(0,c.jsx)(N.RiChatSettingsLine,{className:"h-[18px] w-[18px]"})})}),(0,c.jsx)(P.PortalToFollowElemContent,{className:"z-50",children:(0,c.jsxs)("div",{className:"w-[400px] rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-lg backdrop-blur-sm",children:[(0,c.jsxs)("div",{className:"flex items-center gap-3 rounded-t-2xl border-b border-divider-subtle px-6 py-4",children:[(0,c.jsx)(B.Message3Fill,{className:"h-6 w-6 shrink-0"}),(0,c.jsx)("div",{className:"system-xl-semibold grow text-text-secondary",children:a("chat.chatSettingsTitle",{ns:"share"})})]}),(0,c.jsx)("div",{className:"p-6",children:(0,c.jsx)(z,{})})]})})]})};var R=a.i(940272);let S=d.memo(({isShow:a,saveLoading:b,name:e,onClose:f,onSave:g})=>{let{t:h}=(0,m.useTranslation)(),[i,j]=(0,d.useState)(e);return(0,c.jsxs)(R.default,{title:h("chat.renameConversation",{ns:"common"}),isShow:a,onClose:f,children:[(0,c.jsx)("div",{className:"mt-6 text-sm font-medium leading-[21px] text-text-primary",children:h("chat.conversationName",{ns:"common"})}),(0,c.jsx)(p.default,{className:"mt-2 h-10 w-full",value:i,onChange:a=>j(a.target.value),placeholder:h("chat.conversationNamePlaceholder",{ns:"common"})||""}),(0,c.jsxs)("div",{className:"mt-10 flex justify-end",children:[(0,c.jsx)(n.default,{className:"mr-2 shrink-0",onClick:f,children:h("operation.cancel",{ns:"common"})}),(0,c.jsx)(n.default,{variant:"primary",className:"shrink-0",onClick:()=>g(i),loading:b,children:h("operation.save",{ns:"common"})})]})]})});var T=a.i(42550),U=a.i(483664);let V=d.memo(({title:a,isPinned:b,togglePin:e,isShowRenameConversation:f,onRenameConversation:g,isShowDelete:h,onDelete:j,placement:k="bottom-start"})=>{let{t:l}=(0,m.useTranslation)(),[n,o]=(0,d.useState)(!1);return(0,c.jsxs)(P.PortalToFollowElem,{open:n,onOpenChange:o,placement:k,offset:4,children:[(0,c.jsx)(P.PortalToFollowElemTrigger,{onClick:()=>o(a=>!a),children:(0,c.jsxs)("div",{className:(0,i.cn)("flex cursor-pointer items-center rounded-lg p-1.5 pl-2 text-text-secondary hover:bg-state-base-hover",n&&"bg-state-base-hover"),children:[(0,c.jsx)("div",{className:"system-md-semibold",children:a}),(0,c.jsx)(N.RiArrowDownSLine,{className:"h-4 w-4 "})]})}),(0,c.jsx)(P.PortalToFollowElemContent,{className:"z-50",children:(0,c.jsxs)("div",{className:"min-w-[120px] rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur p-1 shadow-lg backdrop-blur-sm",children:[(0,c.jsx)("div",{className:(0,i.cn)("system-md-regular flex cursor-pointer items-center space-x-1 rounded-lg px-3 py-1.5 text-text-secondary hover:bg-state-base-hover"),onClick:e,children:(0,c.jsx)("span",{className:"grow",children:l(b?"sidebar.action.unpin":"sidebar.action.pin",{ns:"explore"})})}),f&&(0,c.jsx)("div",{className:(0,i.cn)("system-md-regular flex cursor-pointer items-center space-x-1 rounded-lg px-3 py-1.5 text-text-secondary hover:bg-state-base-hover"),onClick:g,children:(0,c.jsx)("span",{className:"grow",children:l("sidebar.action.rename",{ns:"explore"})})}),h&&(0,c.jsx)("div",{className:(0,i.cn)("system-md-regular group flex cursor-pointer items-center space-x-1 rounded-lg px-3 py-1.5 text-text-secondary hover:bg-state-destructive-hover hover:text-text-destructive"),onClick:j,children:(0,c.jsx)("span",{className:"grow",children:l("sidebar.action.delete",{ns:"explore"})})})]})})]})}),W=()=>{let{appData:a,currentConversationId:b,currentConversationItem:e,inputsForms:f,pinnedConversationList:g,handlePinConversation:h,handleUnpinConversation:j,conversationRenaming:k,handleRenameConversation:n,handleDeleteConversation:o,handleNewConversation:p,sidebarCollapseState:q,handleSidebarCollapse:r,isResponding:s}=y(),{t}=(0,m.useTranslation)(),u=g.some(a=>a.id===b),[v,w]=(0,d.useState)(null),[x,z]=(0,d.useState)(null),A=(0,d.useCallback)(a=>{"pin"===a&&h(b),"unpin"===a&&j(b),"delete"===a&&w(e),"rename"===a&&z(e)},[b,e,h,j]),B=(0,d.useCallback)(()=>{w(null)},[]),C=(0,d.useCallback)(()=>{v&&o(v.id,{onSuccess:B})},[v,o,B]),D=(0,d.useCallback)(()=>{z(null)},[]),E=(0,d.useCallback)(a=>{x&&n(x.id,a,{onSuccess:D})},[x,n,D]);return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("div",{className:"flex h-14 shrink-0 items-center justify-between p-3",children:[(0,c.jsxs)("div",{className:(0,i.cn)("flex items-center gap-1 transition-all duration-200 ease-in-out",!q&&"user-select-none opacity-0"),children:[(0,c.jsx)(O.default,{className:(0,i.cn)(!q&&"cursor-default"),size:"l",onClick:()=>r(!1),children:(0,c.jsx)(N.RiLayoutRight2Line,{className:"h-[18px] w-[18px]"})}),(0,c.jsx)("div",{className:"mr-1 shrink-0",children:(0,c.jsx)(l.default,{size:"large",iconType:a?.site.icon_type,icon:a?.site.icon,background:a?.site.icon_background,imageUrl:a?.site.icon_url})}),!b&&(0,c.jsx)("div",{className:(0,i.cn)("system-md-semibold grow truncate text-text-secondary"),children:a?.site.title}),b&&e&&q&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{className:"p-1 text-divider-deep",children:"/"}),(0,c.jsx)(V,{title:e?.name||"",isPinned:!!u,togglePin:()=>A(u?"unpin":"pin"),isShowDelete:!0,isShowRenameConversation:!0,onRenameConversation:()=>A("rename"),onDelete:()=>A("delete")})]}),(0,c.jsx)("div",{className:"flex items-center px-1",children:(0,c.jsx)("div",{className:"h-[14px] w-px bg-divider-regular"})}),q&&(0,c.jsx)(U.default,{disabled:!!b,popupContent:t("chat.newChatTip",{ns:"share"}),children:(0,c.jsx)("div",{children:(0,c.jsx)(O.default,{size:"l",state:!b||s?O.ActionButtonState.Disabled:O.ActionButtonState.Default,disabled:!b||s,onClick:p,children:(0,c.jsx)(N.RiEditBoxLine,{className:"h-[18px] w-[18px]"})})})})]}),(0,c.jsxs)("div",{className:"flex items-center gap-1",children:[b&&(0,c.jsx)(U.default,{popupContent:t("chat.resetChat",{ns:"share"}),children:(0,c.jsx)(O.default,{size:"l",onClick:p,children:(0,c.jsx)(N.RiResetLeftLine,{className:"h-[18px] w-[18px]"})})}),b&&f.length>0&&(0,c.jsx)(Q,{})]})]}),!!v&&(0,c.jsx)(T.default,{title:t("chat.deleteConversation.title",{ns:"share"}),content:t("chat.deleteConversation.content",{ns:"share"})||"",isShow:!0,onCancel:B,onConfirm:C}),x&&(0,c.jsx)(S,{isShow:!0,onClose:D,saveLoading:k,name:x?.name||"",onSave:E})]})},X=({handleResetChat:a,handleViewChatSettings:b,hideViewChatSettings:e=!1})=>{let{t:f}=(0,m.useTranslation)(),[g,h]=(0,d.useState)(!1);return(0,c.jsxs)(P.PortalToFollowElem,{open:g,onOpenChange:h,placement:"bottom-end",offset:{mainAxis:4,crossAxis:-4},children:[(0,c.jsx)(P.PortalToFollowElemTrigger,{onClick:()=>h(a=>!a),children:(0,c.jsx)(O.default,{size:"l",state:g?O.ActionButtonState.Hover:O.ActionButtonState.Default,children:(0,c.jsx)(N.RiMoreFill,{className:"h-[18px] w-[18px]"})})}),(0,c.jsx)(P.PortalToFollowElemContent,{className:"z-40",children:(0,c.jsxs)("div",{className:"min-w-[160px] rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur p-1 shadow-lg backdrop-blur-sm",children:[(0,c.jsx)("div",{className:"system-md-regular flex cursor-pointer items-center space-x-1 rounded-lg px-3 py-1.5 text-text-secondary hover:bg-state-base-hover",onClick:a,children:(0,c.jsx)("span",{className:"grow",children:f("chat.resetChat",{ns:"share"})})}),!e&&(0,c.jsx)("div",{className:"system-md-regular flex cursor-pointer items-center space-x-1 rounded-lg px-3 py-1.5 text-text-secondary hover:bg-state-base-hover",onClick:b,children:(0,c.jsx)("span",{className:"grow",children:f("chat.viewChatSettings",{ns:"share"})})})]})})]})};var Y=a.i(292458),Z=a.i(497746);let $=d.memo(({isActive:a,isItemHovering:b,isPinned:e,togglePin:f,isShowRenameConversation:g,onRenameConversation:h,isShowDelete:j,onDelete:k})=>{let{t:l}=(0,m.useTranslation)(),[n,o]=(0,d.useState)(!1),p=(0,d.useRef)(null),[q,{setTrue:r,setFalse:s}]=(0,Z.useBoolean)(!1);return(0,d.useEffect)(()=>{b||q||o(!1)},[b,q]),(0,c.jsxs)(P.PortalToFollowElem,{open:n,onOpenChange:o,placement:"bottom-end",offset:4,children:[(0,c.jsx)(P.PortalToFollowElemTrigger,{onClick:()=>o(a=>!a),children:(0,c.jsx)(O.default,{className:(0,i.cn)(b||n?"opacity-100":"opacity-0"),state:a?O.ActionButtonState.Active:n?O.ActionButtonState.Hover:O.ActionButtonState.Default,children:(0,c.jsx)(N.RiMoreFill,{className:"h-4 w-4"})})}),(0,c.jsx)(P.PortalToFollowElemContent,{className:"z-50",children:(0,c.jsxs)("div",{ref:p,className:"min-w-[120px] rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur p-1 shadow-lg backdrop-blur-sm",onMouseEnter:r,onMouseLeave:s,onClick:a=>{a.stopPropagation()},children:[(0,c.jsxs)("div",{className:(0,i.cn)("system-md-regular flex cursor-pointer items-center space-x-1 rounded-lg px-2 py-1.5 text-text-secondary hover:bg-state-base-hover"),onClick:f,children:[e&&(0,c.jsx)(N.RiUnpinLine,{className:"h-4 w-4 shrink-0 text-text-tertiary"}),!e&&(0,c.jsx)(N.RiPushpinLine,{className:"h-4 w-4 shrink-0 text-text-tertiary"}),(0,c.jsx)("span",{className:"grow",children:l(e?"sidebar.action.unpin":"sidebar.action.pin",{ns:"explore"})})]}),g&&(0,c.jsxs)("div",{className:(0,i.cn)("system-md-regular flex cursor-pointer items-center space-x-1 rounded-lg px-2 py-1.5 text-text-secondary hover:bg-state-base-hover"),onClick:h,children:[(0,c.jsx)(N.RiEditLine,{className:"h-4 w-4 shrink-0 text-text-tertiary"}),(0,c.jsx)("span",{className:"grow",children:l("sidebar.action.rename",{ns:"explore"})})]}),j&&(0,c.jsxs)("div",{className:(0,i.cn)("system-md-regular group flex cursor-pointer items-center space-x-1 rounded-lg px-2 py-1.5 text-text-secondary hover:bg-state-destructive-hover hover:text-text-destructive"),onClick:k,children:[(0,c.jsx)(N.RiDeleteBinLine,{className:(0,i.cn)("h-4 w-4 shrink-0 text-text-tertiary group-hover:text-text-destructive")}),(0,c.jsx)("span",{className:"grow",children:l("sidebar.action.delete",{ns:"explore"})})]})]})})]})}),_=(0,d.memo)(({isPin:a,item:b,onOperate:e,onChangeConversation:f,currentConversationId:g})=>{let h=(0,d.useRef)(null),j=(0,Y.useHover)(h),k=g===b.id;return(0,c.jsxs)("div",{ref:h,className:(0,i.cn)("system-sm-medium group flex cursor-pointer rounded-lg p-1 pl-3 text-components-menu-item-text hover:bg-state-base-hover",k&&"bg-state-accent-active text-text-accent hover:bg-state-accent-active"),onClick:()=>f(b.id),children:[(0,c.jsx)("div",{className:"grow truncate p-1 pl-0",title:b.name,children:b.name}),""!==b.id&&(0,c.jsx)("div",{className:"shrink-0",onClick:a=>a.stopPropagation(),children:(0,c.jsx)($,{isActive:k,isPinned:!!a,isItemHovering:j,togglePin:()=>e(a?"unpin":"pin",b),isShowDelete:!0,isShowRenameConversation:!0,onRenameConversation:()=>e("rename",b),onDelete:()=>e("delete",b)})})]},b.id)}),aa=({isPin:a,title:b,list:d,onOperate:e,onChangeConversation:f,currentConversationId:g})=>(0,c.jsxs)("div",{className:"space-y-0.5",children:[b&&(0,c.jsx)("div",{className:"system-xs-medium-uppercase px-3 pb-1 pt-2 text-text-tertiary",children:b}),d.map(b=>(0,c.jsx)(_,{isPin:a,item:b,onOperate:e,onChangeConversation:f,currentConversationId:g},b.id))]});var ab=a.i(161934),ac=a.i(533306),ad=a.i(147962),ae=a.i(726951),af=a.i(179062),ag=a.i(174465),ah=a.i(18039);let ai=({isShow:a,onClose:b,data:d})=>(0,c.jsx)(R.default,{isShow:a,onClose:b,className:"min-w-[400px] max-w-[400px] !p-0",closable:!0,children:(0,c.jsxs)("div",{className:(0,i.cn)("flex flex-col items-center gap-4 px-4 pb-8 pt-10"),children:[(0,c.jsx)(l.default,{size:"xxl",iconType:d?.icon_type,icon:d?.icon,background:d?.icon_background||ah.appDefaultIconBackground,imageUrl:d?.icon_url}),(0,c.jsx)("div",{className:"system-xl-semibold text-text-secondary",children:d?.title}),(0,c.jsxs)("div",{className:"system-xs-regular text-text-tertiary",children:[d?.copyright&&(0,c.jsxs)("div",{children:["Â©",new Date().getFullYear()," ",d?.copyright]}),d?.custom_disclaimer&&(0,c.jsx)("div",{className:"mt-2",children:d.custom_disclaimer})]})]})}),aj=d.memo(({data:a,placement:b,hideLogout:e,forceClose:f})=>{let g=(0,ae.useWebAppStore)(a=>a.webAppAccessMode),h=(0,ac.useRouter)(),j=(0,ac.usePathname)(),{t:k}=(0,m.useTranslation)(),[l,n]=(0,d.useState)(!1),o=(0,d.useRef)(l),p=(0,d.useCallback)(a=>{n(a),o.current=a},[n]),q=(0,d.useCallback)(()=>{p(!o.current)},[p]),r=(0,ae.useWebAppStore)(a=>a.shareCode),s=(0,d.useCallback)(async()=>{await (0,ag.webAppLogout)(r),h.replace(`/webapp-signin?redirect_url=${j}`)},[h,j,ag.webAppLogout,r]),[t,u]=(0,d.useState)(!1);return(0,d.useEffect)(()=>{f&&p(!1)},[f,p]),(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(P.PortalToFollowElem,{open:l,onOpenChange:p,placement:b||"bottom-end",offset:{mainAxis:4,crossAxis:-4},children:[(0,c.jsx)(P.PortalToFollowElemTrigger,{onClick:q,children:(0,c.jsx)("div",{children:(0,c.jsx)(O.default,{size:"l",className:(0,i.cn)(l&&"bg-state-base-hover"),children:(0,c.jsx)(N.RiEqualizer2Line,{className:"h-[18px] w-[18px]"})})})}),(0,c.jsx)(P.PortalToFollowElemContent,{className:"z-50",children:(0,c.jsxs)("div",{className:"w-[224px] rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur shadow-lg backdrop-blur-sm",children:[(0,c.jsx)("div",{className:"p-1",children:(0,c.jsxs)("div",{className:(0,i.cn)("system-md-regular flex cursor-pointer items-center rounded-lg py-1.5 pl-3 pr-2 text-text-secondary"),children:[(0,c.jsx)("div",{className:"grow",children:k("theme.theme",{ns:"common"})}),(0,c.jsx)(ad.default,{})]})}),(0,c.jsx)(A.default,{type:"horizontal",className:"my-0"}),(0,c.jsxs)("div",{className:"p-1",children:[a?.privacy_policy&&(0,c.jsx)("a",{href:a.privacy_policy,target:"_blank",className:"system-md-regular flex cursor-pointer items-center rounded-lg px-3 py-1.5 text-text-secondary hover:bg-state-base-hover",children:(0,c.jsx)("span",{className:"grow",children:k("chat.privacyPolicyMiddle",{ns:"share"})})}),(0,c.jsx)("div",{onClick:()=>{q(),u(!0)},className:"system-md-regular cursor-pointer rounded-lg px-3 py-1.5 text-text-secondary hover:bg-state-base-hover",children:k("userProfile.about",{ns:"common"})})]}),!(e||g===af.AccessMode.EXTERNAL_MEMBERS||g===af.AccessMode.PUBLIC)&&(0,c.jsx)("div",{className:"p-1",children:(0,c.jsx)("div",{onClick:s,className:"system-md-regular cursor-pointer rounded-lg px-3 py-1.5 text-text-secondary hover:bg-state-base-hover",children:k("userProfile.logout",{ns:"common"})})})]})})]}),t&&(0,c.jsx)(ai,{isShow:t,onClose:()=>{u(!1)},data:a})]})});var ak=a.i(724423);let al=({isPanel:a,panelVisible:b})=>{let{t:e}=(0,m.useTranslation)(),{isInstalledApp:f,appData:g,handleNewConversation:h,pinnedConversationList:j,conversationList:k,currentConversationId:o,handleChangeConversation:p,handlePinConversation:q,handleUnpinConversation:r,conversationRenaming:s,handleRenameConversation:t,handleDeleteConversation:u,sidebarCollapseState:v,handleSidebarCollapse:w,isMobile:x,isResponding:z}=y(),A=(0,ak.useGlobalPublicStore)(a=>a.systemFeatures),[B,C]=(0,d.useState)(null),[D,E]=(0,d.useState)(null),F=(0,d.useCallback)((a,b)=>{"pin"===a&&q(b.id),"unpin"===a&&r(b.id),"delete"===a&&C(b),"rename"===a&&E(b)},[q,r]),G=(0,d.useCallback)(()=>{C(null)},[]),H=(0,d.useCallback)(()=>{B&&u(B.id,{onSuccess:G})},[B,u,G]),I=(0,d.useCallback)(()=>{E(null)},[]),J=(0,d.useCallback)(a=>{D&&t(D.id,a,{onSuccess:I})},[D,t,I]);return(0,c.jsxs)("div",{className:(0,i.cn)("flex w-full grow flex-col",a&&"rounded-xl border-[0.5px] border-components-panel-border-subtle bg-components-panel-bg shadow-lg"),children:[(0,c.jsxs)("div",{className:(0,i.cn)("flex shrink-0 items-center gap-3 p-3 pr-2"),children:[(0,c.jsx)("div",{className:"shrink-0",children:(0,c.jsx)(l.default,{size:"large",iconType:g?.site.icon_type,icon:g?.site.icon,background:g?.site.icon_background,imageUrl:g?.site.icon_url})}),(0,c.jsx)("div",{className:(0,i.cn)("system-md-semibold grow truncate text-text-secondary"),children:g?.site.title}),!x&&v&&(0,c.jsx)(O.default,{size:"l",onClick:()=>w(!1),children:(0,c.jsx)(N.RiExpandRightLine,{className:"h-[18px] w-[18px]"})}),!x&&!v&&(0,c.jsx)(O.default,{size:"l",onClick:()=>w(!0),children:(0,c.jsx)(N.RiLayoutLeft2Line,{className:"h-[18px] w-[18px]"})})]}),(0,c.jsx)("div",{className:"shrink-0 px-3 py-4",children:(0,c.jsxs)(n.default,{variant:"secondary-accent",disabled:z,className:"w-full justify-center",onClick:h,children:[(0,c.jsx)(N.RiEditBoxLine,{className:"mr-1 h-4 w-4"}),e("chat.newChat",{ns:"share"})]})}),(0,c.jsxs)("div",{className:"h-0 grow space-y-2 overflow-y-auto px-3 pt-4",children:[!!j.length&&(0,c.jsx)("div",{className:"mb-4",children:(0,c.jsx)(aa,{isPin:!0,title:e("chat.pinnedTitle",{ns:"share"})||"",list:j,onChangeConversation:p,onOperate:F,currentConversationId:o})}),!!k.length&&(0,c.jsx)(aa,{title:j.length&&e("chat.unpinnedTitle",{ns:"share"})||"",list:k,onChangeConversation:p,onOperate:F,currentConversationId:o})]}),(0,c.jsxs)("div",{className:"flex shrink-0 items-center justify-between p-3",children:[(0,c.jsx)(aj,{hideLogout:f,placement:"top-start",data:g?.site,forceClose:a&&!b}),(0,c.jsx)("div",{className:"shrink-0",children:!g?.custom_config?.remove_webapp_brand&&(0,c.jsxs)("div",{className:(0,i.cn)("flex shrink-0 items-center gap-1.5 px-1"),children:[(0,c.jsx)("div",{className:"system-2xs-medium-uppercase text-text-tertiary",children:e("chat.poweredBy",{ns:"share"})}),A.branding.enabled&&A.branding.workspace_logo?(0,c.jsx)("img",{src:A.branding.workspace_logo,alt:"logo",className:"block h-5 w-auto"}):g?.custom_config?.replace_webapp_logo?(0,c.jsx)("img",{src:`${g?.custom_config?.replace_webapp_logo}`,alt:"logo",className:"block h-5 w-auto"}):(0,c.jsx)(ab.default,{size:"small"})]})}),!!B&&(0,c.jsx)(T.default,{title:e("chat.deleteConversation.title",{ns:"share"}),content:e("chat.deleteConversation.content",{ns:"share"})||"",isShow:!0,onCancel:G,onConfirm:H}),D&&(0,c.jsx)(S,{isShow:!0,onClose:I,saveLoading:s,name:D?.name||"",onSave:J})]})]})},am=()=>{let{appData:a,currentConversationId:b,currentConversationItem:e,pinnedConversationList:f,handleNewConversation:g,handlePinConversation:h,handleUnpinConversation:i,handleDeleteConversation:j,handleRenameConversation:k,conversationRenaming:n,inputsForms:o}=y(),{t:p}=(0,m.useTranslation)(),q=f.some(a=>a.id===b),[r,s]=(0,d.useState)(null),[t,u]=(0,d.useState)(null),v=(0,d.useCallback)(a=>{"pin"===a&&h(b),"unpin"===a&&i(b),"delete"===a&&s(e),"rename"===a&&u(e)},[b,e,h,i]),w=(0,d.useCallback)(()=>{s(null)},[]),x=(0,d.useCallback)(()=>{r&&j(r.id,{onSuccess:w})},[r,j,w]),A=(0,d.useCallback)(()=>{u(null)},[]),C=(0,d.useCallback)(a=>{t&&k(t.id,a,{onSuccess:A})},[t,k,A]),[D,E]=(0,d.useState)(!1),[F,G]=(0,d.useState)(!1);return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("div",{className:"flex shrink-0 items-center gap-1 bg-mask-top2bottom-gray-50-to-transparent px-2 py-3",children:[(0,c.jsx)(O.default,{size:"l",className:"shrink-0",onClick:()=>E(!0),children:(0,c.jsx)(N.RiMenuLine,{className:"h-[18px] w-[18px]"})}),(0,c.jsxs)("div",{className:"flex grow items-center justify-center",children:[!b&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(l.default,{className:"mr-2",size:"tiny",icon:a?.site.icon,iconType:a?.site.icon_type,imageUrl:a?.site.icon_url,background:a?.site.icon_background}),(0,c.jsx)("div",{className:"system-md-semibold truncate text-text-secondary",children:a?.site.title})]}),b&&(0,c.jsx)(V,{title:e?.name||"",isPinned:!!q,togglePin:()=>v(q?"unpin":"pin"),isShowDelete:!0,isShowRenameConversation:!0,onRenameConversation:()=>v("rename"),onDelete:()=>v("delete")})]}),(0,c.jsx)(X,{handleResetChat:g,handleViewChatSettings:()=>G(!0),hideViewChatSettings:o.length<1})]}),D&&(0,c.jsx)("div",{className:"fixed inset-0 z-50 flex bg-background-overlay p-1",onClick:()=>E(!1),children:(0,c.jsx)("div",{className:"flex h-full w-[calc(100vw_-_40px)] rounded-xl bg-components-panel-bg shadow-lg backdrop-blur-sm",onClick:a=>a.stopPropagation(),children:(0,c.jsx)(al,{})})}),F&&(0,c.jsx)("div",{className:"fixed inset-0 z-50 flex justify-end bg-background-overlay p-1",onClick:()=>G(!1),children:(0,c.jsxs)("div",{className:"flex h-full w-[calc(100vw_-_40px)] flex-col rounded-xl bg-components-panel-bg shadow-lg backdrop-blur-sm",onClick:a=>a.stopPropagation(),children:[(0,c.jsxs)("div",{className:"flex items-center gap-3 rounded-t-2xl border-b border-divider-subtle px-4 py-3",children:[(0,c.jsx)(B.Message3Fill,{className:"h-6 w-6 shrink-0"}),(0,c.jsx)("div",{className:"system-xl-semibold grow text-text-secondary",children:p("chat.chatSettingsTitle",{ns:"share"})})]}),(0,c.jsx)("div",{className:"p-4",children:(0,c.jsx)(z,{})})]})}),!!r&&(0,c.jsx)(T.default,{title:p("chat.deleteConversation.title",{ns:"share"}),content:p("chat.deleteConversation.content",{ns:"share"})||"",isShow:!0,onCancel:w,onConfirm:x}),t&&(0,c.jsx)(S,{isShow:!0,onClose:A,saveLoading:n,name:t?.name||"",onSave:C})]})};var an=a.i(411171),ao=a.i(494261),ap=a.i(818386),aq=a.i(114715),ar=a.i(314875),as=a.i(429264);let at=function(a,b){(0,d.useEffect)(function(){var b=a(),c=!1;return!function(){(0,ar.__awaiter)(this,void 0,void 0,function(){return(0,ar.__generator)(this,function(a){switch(a.label){case 0:if(!(0,as.isFunction)(b[Symbol.asyncIterator]))return[3,4];a.label=1;case 1:return[4,b.next()];case 2:if(a.sent().done||c)return[3,3];return[3,1];case 3:return[3,6];case 4:return[4,b];case 5:a.sent(),a.label=6;case 6:return[2]}})})}(),function(){c=!0}},b)};var au=a.i(112247);function av(a){let{enable:b=!0,icon_type:c="emoji",icon:d,icon_background:e,icon_url:f}=a;at(async()=>{if(!b||"image"===c&&!f||"emoji"===c&&!d)return;let a="image"===c&&f,g=document.querySelector('link[rel*="icon"]')||document.createElement("link");g.href=a?f:`data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%25%22 height=%22100%25%22 fill=%22${encodeURIComponent(e||ah.appDefaultIconBackground)}%22 rx=%2230%22 ry=%2230%22 /><text x=%2212.5%22 y=%221em%22 font-size=%2275%22>${d?await (0,au.searchEmoji)(d):"ðŸ¤–"}</text></svg>`,g.rel="shortcut icon",g.type="image/svg",document.getElementsByTagName("head")[0].appendChild(g)},[b,d,e])}var aw=a.i(783098),ax=a.i(325111),ay=a.i(858877),az=a.i(788022);let aA=({className:a})=>{let{appData:b,appChatListDataLoading:e,chatShouldReloadKey:g,isMobile:j,themeBuilder:k,sidebarCollapseState:l}=y(),m=b?.custom_config,n=b?.site,[o,p]=(0,d.useState)(!1);return(0,d.useEffect)(()=>{k?.buildTheme(n?.chat_color_theme,n?.chat_color_theme_inverted)},[n,m,k]),(0,d.useEffect)(()=>{l||p(!1)},[l]),(0,h.default)(n?.title||"Chat"),(0,c.jsxs)("div",{className:(0,i.cn)("flex h-full bg-background-default-burn",j&&"flex-col",a),children:[!j&&(0,c.jsx)("div",{className:(0,i.cn)("flex w-[236px] flex-col p-1 pr-0 transition-all duration-200 ease-in-out",l&&"w-0 overflow-hidden !p-0"),children:(0,c.jsx)(al,{})}),j&&(0,c.jsx)(am,{}),(0,c.jsxs)("div",{className:(0,i.cn)("relative grow p-2",j&&"h-[calc(100%_-_56px)] p-0"),children:[l&&(0,c.jsx)("div",{className:(0,i.cn)("absolute top-0 z-20 flex h-full w-[256px] flex-col p-2 transition-all duration-500 ease-in-out",o?"left-0":"left-[-248px]"),onMouseEnter:()=>p(!0),onMouseLeave:()=>p(!1),children:(0,c.jsx)(al,{isPanel:!0,panelVisible:o})}),(0,c.jsxs)("div",{className:(0,i.cn)("flex h-full flex-col overflow-hidden border-[0,5px] border-components-panel-border-subtle bg-chatbot-bg",j?"rounded-t-2xl":"rounded-2xl"),children:[!j&&(0,c.jsx)(W,{}),e&&(0,c.jsx)(f.default,{type:"app"}),!e&&(0,c.jsx)(M,{},g)]})]})]})},aB=({installedAppInfo:a,className:b})=>{let e=(0,g.default)()===g.MediaType.mobile,f=(0,j.useThemeContext)(),{appData:h,appParams:i,appMeta:k,appChatListDataLoading:l,currentConversationId:n,currentConversationItem:o,appPrevChatTree:p,pinnedConversationList:q,conversationList:r,newConversationInputs:s,newConversationInputsRef:t,handleNewConversationInputsChange:u,inputsForms:y,handleNewConversation:z,handleStartChat:A,handleChangeConversation:B,handlePinConversation:C,handleUnpinConversation:D,handleDeleteConversation:E,conversationRenaming:H,handleRenameConversation:I,handleNewConversationCompleted:J,chatShouldReloadKey:K,isInstalledApp:M,appId:N,handleFeedback:O,currentChatInstanceRef:P,sidebarCollapseState:Q,handleSidebarCollapse:R,clearChatList:S,setClearChatList:T,isResponding:U,setIsResponding:V,currentConversationInputs:W,setCurrentConversationInputs:X,allInputsHidden:Y,initUserVariables:Z}=(a=>{let b=(0,d.useMemo)(()=>!!a,[a]),c=b?F.AppSourceType.installedApp:F.AppSourceType.webApp,e=(0,ae.useWebAppStore)(a=>a.appInfo),f=(0,ae.useWebAppStore)(a=>a.appParams),g=(0,ae.useWebAppStore)(a=>a.appMeta);av({enable:!a,icon_type:e?.site.icon_type,icon:e?.site.icon,icon_background:e?.site.icon_background,icon_url:e?.site.icon_url});let h=(0,d.useMemo)(()=>{if(b){let{id:b,app:c}=a;return{app_id:b,site:{title:c.name,icon_type:c.icon_type,icon:c.icon,icon_background:c.icon_background,icon_url:c.icon_url,prompt_public:!1,copyright:"",show_workflow_steps:!0,use_icon_as_answer_icon:c.use_icon_as_answer_icon},plan:"basic",custom_config:null}}return e},[b,a,e]),i=(0,d.useMemo)(()=>h?.app_id,[h]),[j,k]=(0,d.useState)();(0,d.useEffect)(()=>{(0,L.getProcessedSystemVariablesFromUrlParams)().then(({user_id:a})=>{k(a)})},[]),(0,d.useEffect)(()=>{(async()=>{h?.site.default_language&&await (0,aw.changeLanguage)(h.site.default_language)})()},[h]);let[l,n]=(0,d.useState)(()=>!1),o=(0,d.useCallback)(a=>{if(i){n(a);try{localStorage.setItem("webappSidebarCollapse",a?"collapsed":"expanded")}catch{}}},[i,n]),[p,q]=(0,an.useLocalStorageState)(az.CONVERSATION_ID_INFO,{defaultValue:{}}),r=(0,d.useMemo)(()=>p?.[i||""]?.[j||"DEFAULT"]||"",[i,p,j]),s=(0,d.useCallback)(a=>{if(i){let b=p?.[i||""];"string"==typeof b&&(b={}),q({...p,[i||""]:{...b,[j||"DEFAULT"]:a}})}},[i,p,q,j]),[t,u]=(0,d.useState)(""),x=(0,d.useMemo)(()=>r===t?"":r,[r,t]),{data:y}=(0,ax.useShareConversations)({appSourceType:c,appId:i,pinned:!0,limit:100},{enabled:!!i,refetchOnWindowFocus:!1,refetchOnReconnect:!1}),{data:z,isLoading:A}=(0,ax.useShareConversations)({appSourceType:c,appId:i,pinned:!1,limit:100},{enabled:!!i,refetchOnWindowFocus:!1,refetchOnReconnect:!1}),{data:B,isLoading:C}=(0,ax.useShareChatList)({conversationId:x,appSourceType:c,appId:i},{enabled:!!x,refetchOnWindowFocus:!1,refetchOnReconnect:!1}),D=(0,ax.useInvalidateShareConversations)(),[E,H]=(0,d.useState)(!1),[I,J]=(0,d.useState)(!1),K=(0,d.useMemo)(()=>{var a;let b;return r&&B?.data.length?(0,L.buildChatItemTree)((a=B.data,b=[],a.forEach(a=>{let c=a.message_files?.filter(a=>"user"===a.belongs_to)||[];b.push({id:`question-${a.id}`,content:a.query,isAnswer:!1,message_files:(0,ap.getProcessedFilesFromResponse)(c.map(a=>({...a,related_id:a.id,upload_file_id:a.upload_file_id}))),parentMessageId:a.parent_message_id||void 0});let d=a.message_files?.filter(a=>"assistant"===a.belongs_to)||[];b.push({id:a.id,content:a.answer,agent_thoughts:(0,ay.addFileInfos)(a.agent_thoughts?(0,ay.sortAgentSorts)(a.agent_thoughts):a.agent_thoughts,a.message_files),feedback:a.feedback,isAnswer:!0,citation:a.retriever_resources,message_files:(0,ap.getProcessedFilesFromResponse)(d.map(a=>({...a,related_id:a.id,upload_file_id:a.upload_file_id}))),parentMessageId:`question-${a.id}`})}),b)):[]},[B,r]),[M,N]=(0,d.useState)(!1),O=(0,d.useMemo)(()=>y?.data||[],[y]),{t:P}=(0,m.useTranslation)(),Q=(0,d.useRef)({}),[R,S]=(0,d.useState)({}),[T,U]=(0,d.useState)({}),[V,W]=(0,d.useState)({}),X=(0,d.useCallback)(a=>{Q.current=a,S(a)},[]),Y=(0,d.useMemo)(()=>(f?.user_input_form||[]).filter(a=>!a.external_data_tool).map(a=>{if(a.paragraph){let b=T[a.paragraph.variable];return b&&a.paragraph.max_length&&b.length>a.paragraph.max_length&&(b=b.slice(0,a.paragraph.max_length)),{...a.paragraph,default:b||a.default||a.paragraph.default,type:"paragraph"}}if(a.number){let b=Number(T[a.number.variable]);return{...a.number,default:b||a.default||a.number.default,type:"number"}}if(a.checkbox){let b=!0===T[a.checkbox.variable];return{...a.checkbox,default:b||a.default||a.checkbox.default,type:"checkbox"}}if(a.select){let b=a.select.options.includes(T[a.select.variable]);return{...a.select,default:(b?T[a.select.variable]:void 0)||a.select.default,type:"select"}}if(a["file-list"])return{...a["file-list"],type:"file-list"};if(a.file)return{...a.file,type:"file"};if(a.json_object)return{...a.json_object,type:"json_object"};let b=T[a["text-input"].variable];return b&&a["text-input"].max_length&&b.length>a["text-input"].max_length&&(b=b.slice(0,a["text-input"].max_length)),{...a["text-input"],default:b||a.default||a["text-input"].default,type:"text-input"}}),[T,f]),Z=(0,d.useMemo)(()=>Y.length>0&&Y.every(a=>!0===a.hide),[Y]);(0,d.useEffect)(()=>{(async()=>{let a=await (0,L.getRawInputsFromUrlParams)(),b=await (0,L.getRawUserVariablesFromUrlParams)();U(a),W(b)})()},[]),(0,d.useEffect)(()=>{let a={};Y.forEach(b=>{a[b.variable]=b.default||null}),X(a)},[X,Y]);let{data:$}=(0,ax.useShareConversationName)({conversationId:t,appSourceType:c,appId:i},{refetchOnWindowFocus:!1,enabled:!!t}),[_,aa]=(0,d.useState)([]);(0,d.useEffect)(()=>{z?.data&&!A&&aa(z?.data)},[z,A]);let ab=(0,d.useMemo)(()=>{let a=_.slice();return M&&a[0]?.id!==""&&a.unshift({id:"",name:P("chat.newChatDefaultName",{ns:"share"}),inputs:{},introduction:""}),a},[_,M,P]);(0,d.useEffect)(()=>{$&&aa((0,ao.produce)(a=>{let b=a.findIndex(a=>a.id===$.id);b>-1?a[b]=$:a.unshift($)}))},[$]);let ac=(0,d.useMemo)(()=>{let a=ab.find(a=>a.id===r);return!a&&O.length&&(a=O.find(a=>a.id===r)),a},[ab,r,O]),ad=(0,d.useMemo)(()=>r&&B?.data.length?B.data.slice().pop().inputs||{}:Q.current||{},[B,r]),[af,ag]=(0,d.useState)(ad||{});(0,d.useEffect)(()=>{ac&&ag(ad||{})},[ac,ad]);let{notify:ah}=(0,aq.useToastContext)(),ai=(0,d.useCallback)(a=>{if(Z)return!0;let b="",c=!1,d=Y.filter(({required:a,type:b})=>a&&b!==v.InputVarType.checkbox);return(d.length&&d.forEach(({variable:d,label:e,type:f})=>{if(!b&&!c&&(Q.current[d]||a||(b=e),(f===v.InputVarType.singleFile||f===v.InputVarType.multiFiles)&&Q.current[d]&&!a)){let a=Q.current[d];c=Array.isArray(a)?a.find(a=>a.transferMethod===G.TransferMethod.local_file&&!a.uploadedId):a.transferMethod===G.TransferMethod.local_file&&!a.uploadedId}}),b)?(ah({type:"error",message:P("errorMessage.valueOfVarRequired",{ns:"appDebug",key:b})}),!1):!c||void ah({type:"info",message:P("errorMessage.waitForFileUpload",{ns:"appDebug"})})},[Y,ah,P,Z]),aj=(0,d.useCallback)(a=>{ai()&&(N(!0),a?.())},[N,ai]),ak=(0,d.useRef)({handleStop:w.noop}),al=(0,d.useCallback)(a=>{ak.current.handleStop(),u(""),s(a),a&&H(!1)},[s,H]),am=(0,d.useCallback)(async()=>{ak.current.handleStop(),N(!0),al("");let a={};Y.forEach(b=>{a[b.variable]=b.default||null}),X(a),H(!0)},[al,N,X,H,Y]),ar=(0,d.useCallback)(()=>{D()},[D]),as=(0,d.useCallback)(async a=>{await (0,F.pinConversation)(c,i,a),ah({type:"success",message:P("api.success",{ns:"common"})}),ar()},[c,i,ah,P,ar]),at=(0,d.useCallback)(async a=>{await (0,F.unpinConversation)(c,i,a),ah({type:"success",message:P("api.success",{ns:"common"})}),ar()},[c,i,ah,P,ar]),[au,aA]=(0,d.useState)(!1),aB=(0,d.useCallback)(async(a,{onSuccess:b})=>{if(!au){try{aA(!0),await (0,F.delConversation)(c,i,a),ah({type:"success",message:P("api.success",{ns:"common"})}),b()}finally{aA(!1)}a===r&&am(),ar()}},[b,i,ah,P,ar,am,r,au]),[aC,aD]=(0,d.useState)(!1),aE=(0,d.useCallback)(async(a,b,{onSuccess:d})=>{if(!aC){if(!b.trim())return void ah({type:"error",message:P("chat.conversationNameCanNotEmpty",{ns:"common"})});aD(!0);try{await (0,F.renameConversation)(c,i,a,b),ah({type:"success",message:P("actionMsg.modifiedSuccessfully",{ns:"common"})}),aa((0,ao.produce)(c=>{let d=_.findIndex(b=>b.id===a),e=c[d];c[d]={...e,name:b}})),d()}finally{aD(!1)}}},[b,i,ah,P,aC,_]),aF=(0,d.useCallback)(a=>{u(a),s(a),N(!1),D()},[s,D]),aG=(0,d.useCallback)(async(a,b)=>{await (0,F.updateFeedback)({url:`/messages/${a}/feedbacks`,body:{rating:b.rating,content:b.content}},c,i),ah({type:"success",message:P("api.success",{ns:"common"})})},[c,i,P,ah]);return{isInstalledApp:b,appId:i,currentConversationId:r,currentConversationItem:ac,handleConversationIdInfoChange:s,appData:h,appParams:f||{},appMeta:g,appPinnedConversationData:y,appConversationData:z,appConversationDataLoading:A,appChatListData:B,appChatListDataLoading:C,appPrevChatTree:K,pinnedConversationList:O,conversationList:ab,setShowNewConversationItemInList:N,newConversationInputs:R,newConversationInputsRef:Q,handleNewConversationInputsChange:X,inputsForms:Y,handleNewConversation:am,handleStartChat:aj,handleChangeConversation:al,handlePinConversation:as,handleUnpinConversation:at,conversationDeleting:au,handleDeleteConversation:aB,conversationRenaming:aC,handleRenameConversation:aE,handleNewConversationCompleted:aF,newConversationId:t,chatShouldReloadKey:x,handleFeedback:aG,currentChatInstanceRef:ak,sidebarCollapseState:l,handleSidebarCollapse:o,clearChatList:E,setClearChatList:H,isResponding:I,setIsResponding:J,currentConversationInputs:af,setCurrentConversationInputs:ag,allInputsHidden:Z,initUserVariables:V}})(a);return(0,c.jsx)(x.Provider,{value:{appData:h,appParams:i,appMeta:k,appChatListDataLoading:l,currentConversationId:n,currentConversationItem:o,appPrevChatTree:p,pinnedConversationList:q,conversationList:r,newConversationInputs:s,newConversationInputsRef:t,handleNewConversationInputsChange:u,inputsForms:y,handleNewConversation:z,handleStartChat:A,handleChangeConversation:B,handlePinConversation:C,handleUnpinConversation:D,handleDeleteConversation:E,conversationRenaming:H,handleRenameConversation:I,handleNewConversationCompleted:J,chatShouldReloadKey:K,isMobile:e,isInstalledApp:M,appId:N,handleFeedback:O,currentChatInstanceRef:P,themeBuilder:f,sidebarCollapseState:Q,handleSidebarCollapse:R,clearChatList:S,setClearChatList:T,isResponding:U,setIsResponding:V,currentConversationInputs:W,setCurrentConversationInputs:X,allInputsHidden:Y,initUserVariables:Z},children:(0,c.jsx)(aA,{className:b})})},aC=({installedAppInfo:a,className:b})=>(0,c.jsx)(aB,{installedAppInfo:a,className:b});var aD=a.i(875067),aE=a.i(34830);let aF=d.memo(({onStartCreateContent:a})=>{let{t:b}=(0,m.useTranslation)();return(0,c.jsxs)("div",{className:"rounded-xl bg-background-section-burn p-6 ",children:[(0,c.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-[10px] border-[0.5px] border-components-card-border bg-components-card-bg-alt shadow-lg backdrop-blur-sm",children:(0,c.jsx)(N.RiBookmark3Line,{className:"h-4 w-4 text-text-accent"})}),(0,c.jsx)("div",{className:"mt-3",children:(0,c.jsx)("span",{className:"system-xl-semibold text-text-secondary",children:b("generation.savedNoData.title",{ns:"share"})})}),(0,c.jsx)("div",{className:"system-sm-regular mt-1 text-text-tertiary",children:b("generation.savedNoData.description",{ns:"share"})}),(0,c.jsxs)(n.default,{variant:"primary",className:"mt-3",onClick:a,children:[(0,c.jsx)(N.RiAddLine,{className:"mr-1 h-4 w-4"}),(0,c.jsx)("span",{children:b("generation.savedNoData.startCreateContent",{ns:"share"})})]})]})}),aG=d.memo(({className:a,isShowTextToSpeech:b,list:d,onRemove:e,onStartCreateContent:f})=>{let{t:g}=(0,m.useTranslation)();return(0,c.jsx)("div",{className:(0,i.cn)("space-y-4",a),children:0===d.length?(0,c.jsx)(aF,{onStartCreateContent:f}):(0,c.jsx)(c.Fragment,{children:d.map(({id:a,answer:d})=>(0,c.jsxs)("div",{className:"relative",children:[(0,c.jsx)("div",{className:(0,i.cn)("rounded-2xl bg-background-section-burn p-4"),children:(0,c.jsx)(E.Markdown,{content:d})}),(0,c.jsx)("div",{className:"system-xs-regular mt-1 h-4 px-4 text-text-quaternary",children:(0,c.jsxs)("span",{children:[d.length," ",g("unit.char",{ns:"common"})]})}),(0,c.jsx)("div",{className:"absolute bottom-1 right-2",children:(0,c.jsxs)("div",{className:"ml-1 flex items-center gap-0.5 rounded-[10px] border-[0.5px] border-components-actionbar-border bg-components-actionbar-bg p-0.5 shadow-md backdrop-blur-sm",children:[b&&(0,c.jsx)(aE.default,{value:d}),(0,c.jsx)(O.default,{onClick:()=>{(0,aD.default)(d),aq.default.notify({type:"success",message:g("actionMsg.copySuccessfully",{ns:"common"})})},children:(0,c.jsx)(N.RiClipboardLine,{className:"h-4 w-4"})}),(0,c.jsx)(O.default,{onClick:()=>{e(a)},children:(0,c.jsx)(N.RiDeleteBinLine,{className:"h-4 w-4"})})]})})]},a))})})});var aH=a.i(218865),aI=a.i(75959),aJ=a.i(800963),aK=a.i(213228),aL=a.i(240928);a.i(658335);var aM=a.i(350295);let aN=d.memo(({vars:a})=>{let b,{t:d}=(0,m.useTranslation)(),{CSVDownloader:e,Type:f}=(0,aL.useCSVDownloader)(),g=[...a],h=(b={},g.forEach(a=>{b[a.name]=""}),b);return(0,c.jsxs)("div",{className:"mt-6",children:[(0,c.jsx)("div",{className:"system-sm-medium text-text-primary",children:d("generation.csvStructureTitle",{ns:"share"})}),(0,c.jsx)("div",{className:"mt-2 max-h-[500px] overflow-auto",children:(0,c.jsxs)("table",{className:"w-full table-fixed border-separate border-spacing-0 rounded-lg border border-divider-regular text-xs",children:[(0,c.jsx)("thead",{className:"text-text-tertiary",children:(0,c.jsx)("tr",{children:g.map((a,b)=>(0,c.jsx)("td",{className:"h-9 border-b border-divider-regular pl-3 pr-2",children:a.name},b))})}),(0,c.jsx)("tbody",{className:"text-text-secondary",children:(0,c.jsx)("tr",{children:g.map((a,b)=>(0,c.jsxs)("td",{className:"h-9 pl-4",children:[a.name," ",d("generation.field",{ns:"share"})]},b))})})]})}),(0,c.jsx)(e,{className:"mt-2 block cursor-pointer",type:f.Link,filename:"template",bom:!0,config:{},data:[h],children:(0,c.jsxs)("div",{className:"system-xs-medium flex h-[18px] items-center space-x-1 text-text-accent",children:[(0,c.jsx)(aM.Download02,{className:"h-3 w-3"}),(0,c.jsx)("span",{children:d("generation.downloadTemplate",{ns:"share"})})]})})]})});a.i(836482);var aO=a.i(979492);let aP=d.memo(({onParsed:a})=>{let{t:b}=(0,m.useTranslation)(),{CSVReader:e}=(0,aL.useCSVReader)(),[f,g]=(0,d.useState)(!1);return(0,c.jsx)(e,{onUploadAccepted:b=>{a(b.data),g(!1)},onDragOver:a=>{a.preventDefault(),g(!0)},onDragLeave:a=>{a.preventDefault(),g(!1)},children:({getRootProps:a,acceptedFile:d})=>(0,c.jsx)(c.Fragment,{children:(0,c.jsx)("div",{...a(),className:(0,i.cn)("system-sm-regular flex h-20 items-center rounded-xl border border-dashed border-components-dropzone-border bg-components-dropzone-bg",d&&"border-solid border-components-panel-border bg-components-panel-on-panel-item-bg px-6 hover:border-components-panel-bg-blur hover:bg-components-panel-on-panel-item-bg-hover",f&&"border border-components-dropzone-border-accent bg-components-dropzone-bg-accent"),children:d?(0,c.jsxs)("div",{className:"flex w-full items-center space-x-2",children:[(0,c.jsx)(aO.Csv,{className:"shrink-0"}),(0,c.jsxs)("div",{className:"flex w-0 grow",children:[(0,c.jsx)("span",{className:"max-w-[calc(100%_-_30px)] truncate text-text-secondary",children:d.name.replace(/.csv$/,"")}),(0,c.jsx)("span",{className:"shrink-0 text-text-tertiary",children:".csv"})]})]}):(0,c.jsxs)("div",{className:"flex w-full items-center justify-center space-x-2",children:[(0,c.jsx)(aO.Csv,{className:"shrink-0"}),(0,c.jsxs)("div",{className:"text-text-tertiary",children:[b("generation.csvUploadTitle",{ns:"share"}),(0,c.jsx)("span",{className:"cursor-pointer text-text-accent",children:b("generation.browse",{ns:"share"})})]})]})})})})}),aQ=d.memo(({vars:a,onSend:b,isAllFinished:e})=>{let{t:f}=(0,m.useTranslation)(),h=(0,g.default)()===g.MediaType.pc,[j,k]=d.useState([]),[l,o]=d.useState(!1),p=e?N.RiPlayLargeLine:N.RiLoader2Line;return(0,c.jsxs)("div",{className:"pt-4",children:[(0,c.jsx)(aP,{onParsed:a=>{k(a),o(!0)}}),(0,c.jsx)(aN,{vars:a}),(0,c.jsx)("div",{className:"flex justify-end",children:(0,c.jsxs)(n.default,{variant:"primary",className:(0,i.cn)("mt-4 pl-3 pr-4",!h&&"grow"),onClick:()=>{b(j)},disabled:!l||!e,children:[(0,c.jsx)(p,{className:(0,i.cn)(!e&&"animate-spin","mr-1 h-4 w-4 shrink-0"),"aria-hidden":"true"}),(0,c.jsx)("span",{className:"text-[13px] uppercase",children:f("generation.run",{ns:"share"})})]})})]})}),aR=d.memo(({isMobile:a,values:b})=>{let{t:d}=(0,m.useTranslation)(),{CSVDownloader:e,Type:f}=(0,aL.useCSVDownloader)();return(0,c.jsxs)(e,{className:"block cursor-pointer",type:f.Link,filename:"result",bom:!0,config:{},data:b,children:[a&&(0,c.jsx)(O.default,{children:(0,c.jsx)(N.RiDownloadLine,{className:"h-4 w-4"})}),!a&&(0,c.jsxs)(n.default,{className:(0,i.cn)("space-x-1"),children:[(0,c.jsx)(N.RiDownloadLine,{className:"h-4 w-4"}),(0,c.jsx)("span",{children:d("operation.download",{ns:"common"})})]})]})}),aS=ah.BATCH_CONCURRENCY;var aT=((b=aT||{}).pending="pending",b.running="running",b.completed="completed",b.failed="failed",b);let aU=({isInstalledApp:a=!1,isWorkflow:b=!1})=>{let{notify:e}=aq.default,j=a?F.AppSourceType.installedApp:F.AppSourceType.webApp,{t:k}=(0,m.useTranslation)(),n=(0,g.default)()===g.MediaType.pc,o=(0,ac.useSearchParams)().get("mode")||"create",[p,q]=(0,d.useState)(["create","batch"].includes(o)?o:"create"),[r,s]=(0,d.useState)(!1),t="batch"===p,[u,v]=(0,d.useState)({}),w=(0,d.useRef)(u),x=(0,d.useCallback)(a=>{v(a),w.current=a},[]),y=(0,ak.useGlobalPublicStore)(a=>a.systemFeatures),[z,A]=(0,d.useState)(""),[B,C]=(0,d.useState)(null),[D,E]=(0,d.useState)(null),[I,J]=(0,d.useState)(null),[K,L]=(0,d.useState)(null),[M,O]=(0,d.useState)(null),[P,Q]=(0,d.useState)([]),R=(0,d.useCallback)(async()=>{z&&Q((await (0,F.fetchSavedMessage)(j,z)).data)},[j,z]),S=async a=>{await (0,F.saveMessage)(a,j,z),e({type:"success",message:k("api.saved",{ns:"common"})}),R()},T=async a=>{await (0,F.removeMessage)(a,j,z),e({type:"success",message:k("api.remove",{ns:"common"})}),R()},[U,V]=(0,d.useState)(0),[W,X]=(0,d.useState)(0),[Y,$]=(0,d.useState)({enabled:!1,number_limits:2,detail:G.Resolution.low,transfer_methods:[G.TransferMethod.local_file]}),[_,aa]=(0,d.useState)([]),[ad,ag]=(0,d.useState)(null);(0,d.useEffect)(()=>{r&&ag(null)},[r]);let[ai,al]=(0,d.useState)(0),[am,an]=(0,d.useState)([]),ao=(0,d.useRef)([]),ap=a=>{an(a),ao.current=a},ar=0===am.filter(a=>"pending"===a.status).length,as=am.filter(a=>"pending"!==a.status),at=(0,d.useRef)(0),au=a=>{at.current=a},ax=am.filter(a=>"completed"===a.status),ay=am.filter(a=>"failed"===a.status),az=am.every(a=>"completed"===a.status),aA=am.every(a=>["completed","failed"].includes(a.status)),aB=(0,d.useRef)({}),aC=am.map(a=>{let b=aB.current,c={},{inputs:d}=a.params;I?.prompt_variables.forEach(a=>{c[a.name]=d[a.key]});let e=b[a.id];return"object"==typeof b[a.id]&&(e=JSON.stringify(e)),c[k("generation.completionResult",{ns:"share"})]=e,c}),aD=(a,b,c)=>{let d=ao.current,e=aB.current,f=d.filter(a=>"pending"===a.status),g=1+d.filter(a=>["completed","failed"].includes(a.status)).length,h=at.current!==g&&f.length>0&&(g%aS==0||d.length-g<aS);h&&au(g);let i=h?f.slice(0,aS).map(a=>a.id):[];ap(d.map(a=>a.id===b?{...a,status:c?"completed":"failed"}:h&&i.includes(a.id)?{...a,status:"running"}:a)),b&&(aB.current={...e,[`${b}`]:a})},aE=(0,ae.useWebAppStore)(a=>a.appInfo),aF=(0,ae.useWebAppStore)(a=>a.appParams),aL=(0,ae.useWebAppStore)(a=>a.webAppAccessMode);(0,d.useEffect)(()=>{(async()=>{if(!aE||!aF)return;b||R();let{app_id:a,site:c,custom_config:d}=aE;A(a),C(c),E(d),await (0,aw.changeLanguage)(c.default_language);let{user_input_form:e,more_like_this:f,file_upload:g,text_to_speech:h}=aF;$({...g,transfer_methods:g?.allowed_file_upload_methods||g?.allowed_upload_methods,image_file_size_limit:aF?.system_parameters.image_file_size_limit,fileUploadConfig:aF?.system_parameters}),J({prompt_template:"",prompt_variables:(0,H.userInputsFormToPromptVariables)(e)}),L(f),O(h)})()},[aE,aF,R,b]),(0,h.default)(B?.title||k("generation.title",{ns:"share"})),av({enable:!a,icon_type:B?.icon_type,icon:B?.icon,icon_background:B?.icon_background,icon_url:B?.icon_url});let[aM,{setTrue:aN,setFalse:aO}]=(0,Z.useBoolean)(!1),aP=()=>{setTimeout(()=>{aN()},0)},[aT,aU]=(0,d.useState)(!1),aV=d=>(0,c.jsx)(aI.default,{isWorkflow:b,isCallBatchAPI:r,isPC:n,isMobile:!n,appSourceType:a?F.AppSourceType.installedApp:F.AppSourceType.webApp,appId:z,isError:d?.status==="failed",promptConfig:I,moreLikeThisEnabled:!!K?.enabled,inputs:r?d.params.inputs:u,controlSend:U,controlRetry:d?.status==="failed"?ai:0,controlStopResponding:W,onShowRes:aP,handleSaveMessage:S,taskId:d?.id,onCompleted:aD,visionConfig:Y,completionFiles:_,isShowTextToSpeech:!!M?.enabled,siteInfo:B,onRunStart:()=>aU(!0),onRunControlChange:r?void 0:ag,hideInlineStopButton:!r},d?.id),aW=(0,c.jsxs)("div",{className:(0,i.cn)("relative flex h-full flex-col",!n&&"h-[calc(100vh_-_36px)] rounded-t-2xl shadow-lg backdrop-blur-sm",n?"bg-chatbot-bg":aM?"bg-background-default-burn":"border-t-[0.5px] border-divider-regular bg-components-panel-bg"),children:[r&&(0,c.jsxs)("div",{className:(0,i.cn)("flex shrink-0 items-center justify-between px-14 pb-2 pt-9",!n&&"px-4 pb-1 pt-3"),children:[(0,c.jsx)("div",{className:"system-md-semibold-uppercase text-text-primary",children:k("generation.executions",{ns:"share",num:am.length})}),ax.length>0&&(0,c.jsx)(aR,{isMobile:!n,values:aC})]}),(0,c.jsxs)("div",{className:(0,i.cn)("flex h-0 grow flex-col overflow-y-auto",n&&"px-14 py-8",n&&r&&"pt-0",!n&&"p-0 pb-2"),children:[r?as.map(a=>aV(a)):aV(),!ar&&(0,c.jsx)("div",{className:"mt-4",children:(0,c.jsx)(f.default,{type:"area"})})]}),r&&ay.length>0&&(0,c.jsxs)("div",{className:"absolute bottom-6 left-1/2 z-10 flex -translate-x-1/2 items-center gap-2 rounded-xl border border-components-panel-border bg-components-panel-bg-blur p-3 shadow-lg backdrop-blur-sm",children:[(0,c.jsx)(N.RiErrorWarningFill,{className:"h-4 w-4 text-text-destructive"}),(0,c.jsx)("div",{className:"system-sm-medium text-text-secondary",children:k("generation.batchFailed.info",{ns:"share",num:ay.length})}),(0,c.jsx)("div",{className:"h-3.5 w-px bg-divider-regular"}),(0,c.jsx)("div",{onClick:()=>{al(Date.now())},className:"system-sm-semibold-uppercase cursor-pointer text-text-accent",children:k("generation.batchFailed.retry",{ns:"share"})})]})]});return z&&B&&I?(0,c.jsxs)("div",{className:(0,i.cn)("bg-background-default-burn",n&&"flex",!n&&"flex-col",a?"h-full rounded-2xl shadow-md":"h-screen"),children:[(0,c.jsxs)("div",{className:(0,i.cn)("relative flex h-full shrink-0 flex-col",n?"w-[600px] max-w-[50%]":aT?"h-[calc(100%_-_64px)]":"",a&&"rounded-l-2xl"),children:[(0,c.jsxs)("div",{className:(0,i.cn)("shrink-0 space-y-4 border-b border-divider-subtle",n?"bg-components-panel-bg p-8 pb-0":"p-4 pb-0"),children:[(0,c.jsxs)("div",{className:"flex items-center gap-3",children:[(0,c.jsx)(l.default,{size:n?"large":"small",iconType:B.icon_type,icon:B.icon,background:B.icon_background||ah.appDefaultIconBackground,imageUrl:B.icon_url}),(0,c.jsx)("div",{className:"system-md-semibold grow truncate text-text-secondary",children:B.title}),(0,c.jsx)(aj,{hideLogout:a||aL===af.AccessMode.PUBLIC,data:B})]}),B.description&&(0,c.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:B.description}),(0,c.jsx)(aK.default,{items:[{id:"create",name:k("generation.tabs.create",{ns:"share"})},{id:"batch",name:k("generation.tabs.batch",{ns:"share"})},...b?[]:[{id:"saved",name:k("generation.tabs.saved",{ns:"share"}),isRight:!0,icon:(0,c.jsx)(N.RiBookmark3Line,{className:"h-4 w-4"}),extra:P.length>0?(0,c.jsx)(aH.default,{className:"ml-1",children:P.length}):null}]],value:p,onChange:q})]}),(0,c.jsxs)("div",{className:(0,i.cn)("h-0 grow overflow-y-auto bg-components-panel-bg",n?"px-8":"px-4",!n&&aT&&D?.remove_webapp_brand&&"rounded-b-2xl border-b-[0.5px] border-divider-regular"),children:[(0,c.jsx)("div",{className:(0,i.cn)("create"===p?"block":"hidden"),children:(0,c.jsx)(aJ.default,{siteInfo:B,inputs:u,inputsRef:w,onInputsChange:x,promptConfig:I,onSend:()=>{s(!1),V(Date.now()),ap([]),aP()},visionConfig:Y,onVisionFilesChange:aa,runControl:ad})}),(0,c.jsx)("div",{className:(0,i.cn)(t?"block":"hidden"),children:(0,c.jsx)(aQ,{vars:I.prompt_variables,onSend:a=>{if(!(a=>{if(!a||0===a.length)return e({type:"error",message:k("generation.errorMsg.empty",{ns:"share"})}),!1;let b=a[0],c=!0;if(I?.prompt_variables.forEach((a,d)=>{c&&a.name!==b[d]&&(c=!1)}),!c)return e({type:"error",message:k("generation.errorMsg.fileStructNotMatch",{ns:"share"})}),!1;let d=a.slice(1);if(0===d.length)return e({type:"error",message:k("generation.errorMsg.atLeastOne",{ns:"share"})}),!1;let f=d.filter(a=>a.every(a=>""===a)).map(a=>d.indexOf(a));if(f.length>0){let a=!1,b=f[0]-1;if(f.forEach(c=>{if(!a){if(b+1!==c){a=!0;return}b++}}),a)return e({type:"error",message:k("generation.errorMsg.emptyLine",{ns:"share",rowIndex:b+2})}),!1}if(0===(d=d.filter(a=>!a.every(a=>""===a))).length)return e({type:"error",message:k("generation.errorMsg.atLeastOne",{ns:"share"})}),!1;let g=0,h="",i="",j=0;return d.forEach((a,b)=>{0===g&&I?.prompt_variables.forEach((c,d)=>{if(0===g){if("string"===c.type&&c.max_length&&a[d].length>c.max_length){i=c.name,j=c.max_length,g=b+1;return}c.required&&""===a[d].trim()&&(h=c.name,g=b+1)}})}),0===g||(h&&e({type:"error",message:k("generation.errorMsg.invalidLine",{ns:"share",rowIndex:g+1,varName:h})}),i&&e({type:"error",message:k("generation.errorMsg.moreThanMaxLengthLine",{ns:"share",rowIndex:g+1,varName:i,maxLength:j})}),!1)})(a))return;if(!az)return void e({type:"info",message:k("errorMessage.waitForBatchResponse",{ns:"appDebug"})});let b=a.filter(a=>!a.every(a=>""===a)).slice(1),c=I?.prompt_variables.length||0;s(!0),ap(b.map((a,b)=>{let d={};return c>0&&a.slice(0,c).forEach((a,b)=>{let c=I?.prompt_variables[b];d[c?.key]=a,a||(c?.type==="string"||c?.type==="paragraph"?d[c?.key]="":d[c?.key]=void 0)}),{id:b+1,status:b<aS?"running":"pending",params:{inputs:d}}})),au(0),V(Date.now()),X(Date.now()),aP()},isAllFinished:aA})}),"saved"===p&&(0,c.jsx)(aG,{className:(0,i.cn)(n?"mt-6":"mt-4"),isShowTextToSpeech:M?.enabled,list:P,onRemove:T,onStartCreateContent:()=>q("create")})]}),!D?.remove_webapp_brand&&(0,c.jsxs)("div",{className:(0,i.cn)("flex shrink-0 items-center gap-1.5 bg-components-panel-bg py-3",n?"px-8":"px-4",!n&&aT&&"rounded-b-2xl border-b-[0.5px] border-divider-regular"),children:[(0,c.jsx)("div",{className:"system-2xs-medium-uppercase text-text-tertiary",children:k("chat.poweredBy",{ns:"share"})}),y.branding.enabled&&y.branding.workspace_logo?(0,c.jsx)("img",{src:y.branding.workspace_logo,alt:"logo",className:"block h-5 w-auto"}):D?.replace_webapp_logo?(0,c.jsx)("img",{src:`${D?.replace_webapp_logo}`,alt:"logo",className:"block h-5 w-auto"}):(0,c.jsx)(ab.default,{size:"small"})]})]}),(0,c.jsxs)("div",{className:(0,i.cn)(n?"h-full w-0 grow":aM?"fixed inset-0 z-50 bg-background-overlay backdrop-blur-sm":aT?"relative h-16 shrink-0 overflow-hidden bg-background-default-burn pt-2.5":""),children:[!n&&(0,c.jsx)("div",{className:(0,i.cn)(aM?"flex items-center justify-center p-2 pt-6":"absolute left-0 top-0 z-10 flex w-full items-center justify-center px-2 pb-[57px] pt-[3px]"),onClick:()=>{aM?aO():aP()},children:(0,c.jsx)("div",{className:"h-1 w-8 cursor-grab rounded bg-divider-solid"})}),aW]})]}):(0,c.jsx)("div",{className:"flex h-screen items-center",children:(0,c.jsx)(f.default,{type:"app"})})};var aV=a.i(113817),aW=a.i(190124),aX=a.i(828644),aY=a.i(393621);let aZ=d.memo(({id:a})=>{let{installedApps:b,isFetchingInstalledApps:g}=(0,e.useContext)(aV.default),h=(0,ae.useWebAppStore)(a=>a.updateAppInfo),i=b.find(b=>b.id===a),j=(0,ae.useWebAppStore)(a=>a.updateWebAppAccessMode),k=(0,ae.useWebAppStore)(a=>a.updateAppParams),l=(0,ae.useWebAppStore)(a=>a.updateWebAppMeta),m=(0,ae.useWebAppStore)(a=>a.updateUserCanAccessApp),{isFetching:n,data:o,error:p}=(0,aX.useGetInstalledAppAccessModeByAppId)(i?.id??null),{isFetching:q,data:r,error:s}=(0,aX.useGetInstalledAppParams)(i?.id??null),{isFetching:t,data:u,error:v}=(0,aX.useGetInstalledAppMeta)(i?.id??null),{data:w,error:x}=(0,aW.useGetUserCanAccessApp)({appId:i?.app.id,isInstalledApp:!0});return((0,d.useEffect)(()=>{if(i){let{id:a,app:b}=i;h({app_id:a,site:{title:b.name,icon_type:b.icon_type,icon:b.icon,icon_background:b.icon_background,icon_url:b.icon_url,prompt_public:!1,copyright:"",show_workflow_steps:!0,use_icon_as_answer_icon:b.use_icon_as_answer_icon},plan:"basic",custom_config:null})}else h(null);r&&k(r),u&&l(u),o&&j(o.accessMode),m(!!(w&&w?.result))},[i,u,r,h,k,m,l,w,o,j]),s)?(0,c.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,c.jsx)(aY.default,{unknownReason:s.message})}):v?(0,c.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,c.jsx)(aY.default,{unknownReason:v.message})}):x?(0,c.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,c.jsx)(aY.default,{unknownReason:x.message})}):p?(0,c.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,c.jsx)(aY.default,{unknownReason:p.message})}):w&&!w.result?(0,c.jsx)("div",{className:"flex h-full flex-col items-center justify-center gap-y-2",children:(0,c.jsx)(aY.default,{className:"h-auto w-auto",code:403,unknownReason:"no permission."})}):q||t||n||g?(0,c.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,c.jsx)(f.default,{})}):i?(0,c.jsxs)("div",{className:"h-full bg-background-default py-2 pl-0 pr-2 sm:p-2",children:[i?.app.mode!==G.AppModeEnum.COMPLETION&&i?.app.mode!==G.AppModeEnum.WORKFLOW&&(0,c.jsx)(aC,{installedAppInfo:i,className:"overflow-hidden rounded-2xl shadow-md"}),i?.app.mode===G.AppModeEnum.COMPLETION&&(0,c.jsx)(aU,{isInstalledApp:!0,installedAppInfo:i}),i?.app.mode===G.AppModeEnum.WORKFLOW&&(0,c.jsx)(aU,{isWorkflow:!0,isInstalledApp:!0,installedAppInfo:i})]}):(0,c.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,c.jsx)(aY.default,{code:404,isUnknownReason:!0})})});a.s(["default",0,aZ],520452)}];

//# sourceMappingURL=app_components_explore_installed-app_index_tsx_b1c207ec._.js.map
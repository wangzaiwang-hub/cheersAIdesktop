module.exports=[191442,a=>{a.v({close:"index-module__jPL1Bq__close",form:"index-module__jPL1Bq__form",label:"index-module__jPL1Bq__label",modal:"index-module__jPL1Bq__modal",modalHeader:"index-module__jPL1Bq__modalHeader",tip:"index-module__jPL1Bq__tip",title:"index-module__jPL1Bq__title"})},852718,a=>{a.v({jinaLogo:"index-module__cWw7Lq__jinaLogo",watercrawlLogo:"index-module__cWw7Lq__watercrawlLogo"})},706088,a=>{a.v({active:"index-module__Q4Dh-a__active",comingTag:"index-module__Q4Dh-a__comingTag",dataSourceItem:"index-module__Q4Dh-a__dataSourceItem",datasetIcon:"index-module__Q4Dh-a__datasetIcon",disabled:"index-module__Q4Dh-a__disabled",form:"index-module__Q4Dh-a__form",notion:"index-module__Q4Dh-a__notion",notionIcon:"index-module__Q4Dh-a__notionIcon",stepHeader:"index-module__Q4Dh-a__stepHeader",submitButton:"index-module__Q4Dh-a__submitButton",web:"index-module__Q4Dh-a__web"})},16199,a=>{a.v({fileContent:"index-module__G3NbVq__fileContent",fileName:"index-module__G3NbVq__fileName",filePreview:"index-module__G3NbVq__filePreview",filetype:"index-module__G3NbVq__filetype",loading:"index-module__G3NbVq__loading",previewContent:"index-module__G3NbVq__previewContent",previewHeader:"index-module__G3NbVq__previewHeader",title:"index-module__G3NbVq__title"})},742136,a=>{a.v({fileContent:"index-module__tGB31q__fileContent",fileName:"index-module__tGB31q__fileName",filePreview:"index-module__tGB31q__filePreview",loading:"index-module__tGB31q__loading",previewContent:"index-module__tGB31q__previewContent",previewHeader:"index-module__tGB31q__previewHeader",title:"index-module__tGB31q__title"})},168132,a=>{"use strict";var b,c,d,e=a.i(608061),f=a.i(494261),g=a.i(57843);a.i(752298);var h=a.i(693025),i=a.i(105249),j=a.i(933887),k=a.i(701458),l=a.i(698636),m=a.i(29255),n=a.i(723205),o=a.i(986431),p=a.i(234651),q=a.i(393621),r=a.i(933988),s=a.i(429150),t=a.i(497746),u=a.i(909795);a.i(916818);var v=a.i(260403);a.i(73009);var w=a.i(43223),w=w;let x=g.memo(({onSetting:a})=>{let{t:b}=(0,h.useTranslation)();return(0,e.jsxs)("div",{className:"flex flex-col items-start rounded-2xl bg-workflow-process-bg p-6",children:[(0,e.jsx)("div",{className:"mb-2 h-12 w-12 rounded-[10px] border-[0.5px] border-components-card-border p-3 shadow-lg shadow-shadow-shadow-5",children:(0,e.jsx)(v.Notion,{className:"size-6"})}),(0,e.jsxs)("div",{className:"mb-1 flex flex-col gap-y-1 pb-3 pt-1",children:[(0,e.jsxs)("span",{className:"system-md-semibold text-text-secondary",children:[b("stepOne.notionSyncTitle",{ns:"datasetCreation"}),(0,e.jsx)(w.default,{className:"relative -left-1.5 -top-2.5 inline h-4 w-4 text-text-secondary"})]}),(0,e.jsx)("div",{className:"system-sm-regular text-text-tertiary",children:b("stepOne.notionSyncTip",{ns:"datasetCreation"})})]}),(0,e.jsx)(u.default,{variant:"primary",onClick:a,children:b("stepOne.connect",{ns:"datasetCreation"})})]})});var y=a.i(528698),z=a.i(749249),A=a.i(41511);let B="notion-pre-import-pages";var C=a.i(757801),D=a.i(527344);let E=g.memo(({isInPipeline:a=!1,onClickConfiguration:b,title:c,buttonText:d,docTitle:f,docLink:g})=>(0,e.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,e.jsxs)("div",{className:"flex shrink-0 grow items-center gap-x-1",children:[(0,e.jsx)("div",{className:(0,D.cn)("text-text-secondary",a?"system-sm-semibold":"system-md-semibold"),children:c}),(0,e.jsx)(C.default,{type:"vertical",className:"mx-1 h-3.5"}),(0,e.jsxs)(u.default,{variant:"secondary",size:"small",className:(0,D.cn)(a?"size-6 px-1":"gap-x-0.5 px-1.5"),onClick:b,children:[(0,e.jsx)(s.RiEqualizer2Line,{className:"size-4"}),!a&&(0,e.jsx)("span",{className:"system-xs-medium",children:d})]})]}),(0,e.jsxs)("a",{className:"system-xs-medium flex items-center gap-x-1 overflow-hidden text-text-accent",href:g,target:"_blank",rel:"noopener noreferrer",children:[(0,e.jsx)(s.RiBookOpenLine,{className:"size-3.5 shrink-0"}),(0,e.jsx)("span",{className:"grow truncate",title:f,children:f})]})]}));var F=a.i(318519),G=a.i(941938),H=a.i(313560);let I=g.memo(({value:a,items:b,onSelect:c})=>{let d=b.find(b=>b.credentialId===a),f=(0,g.useMemo)(()=>d.workspaceName||d.credentialName,[d]);return(0,e.jsx)(F.Menu,{as:"div",className:"relative inline-block text-left",children:({open:a})=>(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(F.MenuButton,{className:`flex h-7 items-center justify-center rounded-md p-1 pr-2 hover:bg-state-base-hover ${a&&"bg-state-base-hover"} cursor-pointer`,children:[(0,e.jsx)(H.CredentialIcon,{className:"mr-2",avatarUrl:d?.workspaceIcon,name:f,size:20}),(0,e.jsx)("div",{className:"mr-1 w-[90px] truncate text-left text-sm font-medium text-text-secondary",title:f,children:f}),(0,e.jsx)(s.RiArrowDownSLine,{className:"h-4 w-4 text-text-secondary"})]}),(0,e.jsx)(G.Transition,{as:g.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:(0,e.jsx)(F.MenuItems,{className:"absolute left-0 top-8 z-10 w-80 origin-top-right rounded-lg border-[0.5px] border-components-panel-border bg-components-panel-bg-blur shadow-lg shadow-shadow-shadow-5",children:(0,e.jsx)("div",{className:"max-h-50 overflow-auto p-1",children:b.map(a=>{let b=a.workspaceName||a.credentialName;return(0,e.jsx)(F.MenuItem,{children:(0,e.jsxs)("div",{className:"flex h-9 cursor-pointer items-center rounded-lg px-3 hover:bg-state-base-hover",onClick:()=>c(a.credentialId),children:[(0,e.jsx)(H.CredentialIcon,{className:"mr-2 shrink-0",avatarUrl:a.workspaceIcon,name:b,size:20}),(0,e.jsx)("div",{className:"system-sm-medium mr-2 grow truncate text-text-secondary",title:b,children:b})]})},a.credentialId)})})})})]})})});var J=a.i(879859),K=a.i(168799),L=a.i(965442);let M=(a,b,c,d)=>{let e=c.parent_id,f=c.page_id;if(e&&f&&"root"!==e&&a[e]){if(b[e])b[e].children.add(f),b[e].descendants.add(f),b[e].descendants.add(d.page_id);else{let c=new Set([f]),g=new Set([f,d.page_id]);b[e]={...a[e],children:c,descendants:g,depth:0,ancestors:[]}}d.depth++,d.ancestors.unshift(b[e].page_name),"root"!==b[e].parent_id&&M(a,b,b[e],d)}},N=(0,g.memo)(({index:a,style:b,data:c})=>{let{t:d}=(0,h.useTranslation)(),{dataList:f,handleToggle:g,checkedIds:i,disabledCheckedIds:j,handleCheck:k,canPreview:l,handlePreview:m,listMapWithChildrenAndDescendants:n,searchValue:o,previewPageId:p,pagesMap:q}=c,r=f[a],t=n[r.page_id],u=t.descendants.size>0,v=t.ancestors,w=v.length?[...v,r.page_name]:[r.page_name],x=j.has(r.page_id);return(0,e.jsxs)("div",{className:(0,D.cn)("group flex cursor-pointer items-center rounded-md pl-2 pr-[2px] hover:bg-state-base-hover",p===r.page_id&&"bg-state-base-hover"),style:{...b,top:b.top+8,left:8,right:8,width:"calc(100% - 16px)"},children:[(0,e.jsx)(K.default,{className:"mr-2 shrink-0",checked:i.has(r.page_id),disabled:x,onCheck:()=>{k(a)}}),!o&&(u?(0,e.jsx)("div",{className:"mr-1 flex h-5 w-5 shrink-0 items-center justify-center rounded-md hover:bg-components-button-ghost-bg-hover",style:{marginLeft:8*r.depth},onClick:()=>g(a),children:r.expand?(0,e.jsx)(s.RiArrowDownSLine,{className:"h-4 w-4 text-text-tertiary"}):(0,e.jsx)(s.RiArrowRightSLine,{className:"h-4 w-4 text-text-tertiary"})}):"root"!==r.parent_id&&q[r.parent_id]?(0,e.jsx)("div",{className:"mr-1 h-5 w-5 shrink-0",style:{marginLeft:8*r.depth}}):(0,e.jsx)("div",{})),(0,e.jsx)(L.default,{className:"mr-1 shrink-0",type:"page",src:r.page_icon}),(0,e.jsx)("div",{className:"grow truncate text-[13px] font-medium leading-4 text-text-secondary",title:r.page_name,children:r.page_name}),l&&(0,e.jsx)("div",{className:"ml-1 hidden h-6 shrink-0 cursor-pointer items-center rounded-md border-[0.5px] border-components-button-secondary-border bg-components-button-secondary-bg px-2 text-xs font-medium leading-4 text-components-button-secondary-text shadow-xs shadow-shadow-shadow-3 backdrop-blur-[10px] hover:border-components-button-secondary-border-hover hover:bg-components-button-secondary-bg-hover group-hover:flex",onClick:()=>m(a),children:d("dataSource.notion.selector.preview",{ns:"common"})}),o&&(0,e.jsx)("div",{className:"ml-1 max-w-[120px] shrink-0 truncate text-xs text-text-quaternary",title:w.join(" / "),children:w.join(" / ")})]})},J.areEqual),O=({value:a,disabledValue:b,searchValue:c,pagesMap:d,list:f,onSelect:i,canPreview:j=!0,previewPageId:k,onPreview:l})=>{let{t:m}=(0,h.useTranslation)(),[n,o]=(0,g.useState)([]),[p,q]=(0,g.useState)("");(0,g.useEffect)(()=>{o(f.filter(a=>"root"===a.parent_id||!d[a.parent_id]).map(a=>({...a,expand:!1,depth:0})))},[f]);let r=f.filter(a=>a.page_name.includes(c)).map(a=>({...a,expand:!1,depth:0})),s=c?r:n,t=(0,g.useMemo)(()=>f.reduce((a,b)=>{let c=b.page_id;return a[c]||(a[c]={...b,children:new Set,descendants:new Set,depth:0,ancestors:[]}),M(d,a,a[c],a[c]),a},{}),[f,d]),u=new Set(a);return s.length?(0,e.jsx)(J.FixedSizeList,{className:"py-2",height:296,itemCount:s.length,itemSize:28,width:"100%",itemKey:(a,b)=>b.dataList[a].page_id,itemData:{dataList:s,handleToggle:a=>{let b=n[a],c=t[b.page_id],e=Array.from(c.descendants),f=Array.from(c.children),g=[];b.expand?(b.expand=!1,g=n.filter(a=>!e.includes(a.page_id))):(b.expand=!0,g=[...n.slice(0,a+1),...f.map(a=>({...d[a],expand:!1,depth:t[a].depth})),...n.slice(a+1)]),o(g)},checkedIds:a,disabledCheckedIds:b,handleCheck:a=>{let b=s[a].page_id,d=t[b];if(u.has(b)){if(!c)for(let a of d.descendants)u.delete(a);u.delete(b)}else{if(!c)for(let a of d.descendants)u.add(a);u.add(b)}i(new Set(u))},canPreview:j,handlePreview:a=>{let b=s[a].page_id;q(b),l&&l(b)},listMapWithChildrenAndDescendants:t,searchValue:c,previewPageId:void 0===k?p:k,pagesMap:d},children:N}):(0,e.jsx)("div",{className:"flex h-[296px] items-center justify-center text-[13px] text-text-tertiary",children:m("dataSource.notion.selector.noSearchResult",{ns:"common"})})};var P=a.i(612757);let Q=({value:a,onSelect:b,canPreview:c,previewPageId:d,onPreview:f,datasetId:h="",credentialList:k,onSelectCredential:l})=>{let n,[o,p]=(0,g.useState)(""),q=(0,m.useModalContextSelector)(a=>a.setShowAccountSettingModal),r=(n=(0,z.useQueryClient)(),({datasetId:a,credentialId:b})=>{n.invalidateQueries({queryKey:[B,a,b]})}),s=(0,g.useMemo)(()=>k.map(a=>({credentialId:a.id,credentialName:a.name,workspaceIcon:a.credential.workspace_icon,workspaceName:a.credential.workspace_name})),[k]),[t,u]=(0,g.useState)(s[0]);(0,g.useEffect)(()=>{let a=s.find(a=>a.credentialId===t?.credentialId);if(a)l?.(a?.credentialId||"");else{let a=s[0];r({datasetId:h,credentialId:a.credentialId}),u(s[0]),b([]),l?.(a.credentialId)}},[s]);let{data:v,isFetching:w,isError:C}=(({datasetId:a,credentialId:b})=>(0,y.useQuery)({queryKey:[B,a,b],queryFn:async()=>(0,A.get)("/notion/pre-import/pages",{params:{dataset_id:a,credential_id:b}}),retry:0}))({datasetId:h,credentialId:t.credentialId||""}),D=(0,g.useMemo)(()=>{let a=new Set,b=new Set;return[(v?.notion_info||[]).reduce((c,d)=>(d.pages.forEach(e=>{e.is_bound&&(a.add(e.page_id),b.add(e.page_id)),c[e.page_id]={...e,workspace_id:d.workspace_id}}),c),{}),a,b]},[v?.notion_info]),F=(0,g.useMemo)(()=>[...Array.from(D[1]),...a||[]],[D,a]),[G,H]=(0,g.useState)(()=>new Set(F));(0,g.useEffect)(()=>{H(new Set(F))},[F]);let J=(0,g.useCallback)(a=>{p(a)},[]),K=(0,g.useCallback)(a=>{let c=s.find(b=>b.credentialId===a);r({datasetId:h,credentialId:c.credentialId}),u(c),b([]),l?.(c.credentialId)},[h,r,s,b,l]),L=(0,g.useCallback)(a=>{let c=Array.from(a).map(a=>D[0][a]);H(new Set(Array.from(a))),b(c)},[D,b]),M=(0,g.useCallback)(a=>{f&&f(D[0][a])},[D,f]),N=(0,g.useCallback)(()=>{q({payload:j.ACCOUNT_SETTING_TAB.DATA_SOURCE})},[q]);return C?(0,e.jsx)(x,{onSetting:N}):(0,e.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,e.jsx)(E,{onClickConfiguration:N,title:"Choose notion pages",buttonText:"Configure Notion",docTitle:"Notion docs",docLink:"https://www.notion.so/docs"}),(0,e.jsxs)("div",{className:"rounded-xl border border-components-panel-border bg-background-default-subtle",children:[(0,e.jsxs)("div",{className:"flex h-12 items-center gap-x-2 rounded-t-xl border-b border-b-divider-regular bg-components-panel-bg p-2",children:[(0,e.jsx)("div",{className:"flex grow items-center gap-x-1",children:(0,e.jsx)(I,{value:t.credentialId,items:s,onSelect:K})}),(0,e.jsx)(P.default,{value:o,onChange:J})]}),(0,e.jsx)("div",{className:"overflow-hidden rounded-b-xl",children:w?(0,e.jsx)("div",{className:"flex h-[296px] items-center justify-center",children:(0,e.jsx)(i.default,{})}):(0,e.jsx)(O,{value:G,disabledValue:D[2],searchValue:o,list:v.notion_info?.[0].pages||[],pagesMap:D[0],onSelect:L,canPreview:c,previewPageId:d,onPreview:M})})]})]})};var R=a.i(931164),S=a.i(623090),T=a.i(375616),U=a.i(533306),V=a.i(639378);a.i(60796);var W=a.i(55282),X=a.i(816134),Y=a.i(940272),Z=a.i(114715),$=a.i(218257),_=a.i(847733),aa=a.i(191442);let ab=({show:a=!1,onHide:b})=>{let[c,d]=(0,g.useState)(""),{t:f}=(0,h.useTranslation)(),{notify:i}=(0,V.useContext)(Z.ToastContext),j=(0,U.useRouter)(),k=(0,_.useInvalidDatasetList)(),l=async()=>{if(!c)return void i({type:"error",message:f("stepOne.modal.nameNotEmpty",{ns:"datasetCreation"})});if(c.length>40)return void i({type:"error",message:f("stepOne.modal.nameLengthInvalid",{ns:"datasetCreation"})});try{let a=await (0,$.createEmptyDataset)({name:c});k(),(0,W.trackEvent)("create_empty_datasets",{name:c,dataset_id:a.id}),b(),j.push(`/datasets/${a.id}/documents`)}catch{i({type:"error",message:f("stepOne.modal.failed",{ns:"datasetCreation"})})}};return(0,e.jsxs)(Y.default,{isShow:a,onClose:b,className:(0,D.cn)(aa.default.modal,"!max-w-[520px]","px-8"),children:[(0,e.jsxs)("div",{className:aa.default.modalHeader,children:[(0,e.jsx)("div",{className:aa.default.title,children:f("stepOne.modal.title",{ns:"datasetCreation"})}),(0,e.jsx)("span",{className:aa.default.close,onClick:b})]}),(0,e.jsx)("div",{className:aa.default.tip,children:f("stepOne.modal.tip",{ns:"datasetCreation"})}),(0,e.jsxs)("div",{className:aa.default.form,children:[(0,e.jsx)("div",{className:aa.default.label,children:f("stepOne.modal.input",{ns:"datasetCreation"})}),(0,e.jsx)(X.default,{value:c,placeholder:f("stepOne.modal.placeholder",{ns:"datasetCreation"})||"",onChange:a=>d(a.target.value)})]}),(0,e.jsxs)("div",{className:"flex flex-row-reverse",children:[(0,e.jsx)(u.default,{className:"ml-2 w-24",variant:"primary",onClick:l,children:f("stepOne.modal.confirmButton",{ns:"datasetCreation"})}),(0,e.jsx)(u.default,{className:"w-24",onClick:b,children:f("stepOne.modal.cancelButton",{ns:"datasetCreation"})})]})]})};var ac=a.i(818386),ad=a.i(971748),ae=a.i(18039),af=a.i(252813),ag=a.i(730357),ah=a.i(136403),ai=a.i(763539),aj=a.i(954200),ak=a.i(42521);let al=({fileList:a,titleClassName:b,prepareFileList:c,onFileUpdate:d,onFileListUpdate:f,onPreview:i,supportBatchUpload:j=!1})=>{let k,{t:l}=(0,h.useTranslation)(),{notify:m}=(0,V.useContext)(Z.ToastContext),n=(0,af.useLocale)(),[o,p]=(0,g.useState)(!1),q=(0,g.useRef)(null),r=(0,g.useRef)(null),t=(0,g.useRef)(null),u=!j&&a.length>0,{data:v}=(0,ai.useFileUploadConfig)(),{data:w}=(0,ai.useFileSupportTypes)(),x=w?.allowed_extensions||[],y=(k={md:"markdown",pptx:"pptx",htm:"html",xlsx:"xlsx",docx:"docx"},[...x].map(a=>k[a]||a).map(a=>a.toLowerCase()).filter((a,b,c)=>c.indexOf(a)===b).map(a=>a.toUpperCase()).join(n!==ah.LanguagesSupported[1]?", ":"ã€ ")),z=x.map(a=>`.${a}`),B=(0,g.useMemo)(()=>({file_size_limit:v?.file_size_limit??15,batch_count_limit:j?v?.batch_count_limit??5:1,file_upload_limit:j?v?.file_upload_limit??5:1}),[v,j]),C=(0,g.useRef)([]),E=a=>{if(!a)return"";let b=a.name.split(".");return b[b.length-1]},F=(0,g.useCallback)(a=>{let{size:b}=a,c=`.${E(a)}`,d=z.includes(c.toLowerCase());d||m({type:"error",message:l("stepOne.uploader.validation.typeError",{ns:"datasetCreation"})});let e=b<=1024*B.file_size_limit*1024;return e||m({type:"error",message:l("stepOne.uploader.validation.size",{ns:"datasetCreation",size:B.file_size_limit})}),d&&e},[B,m,l,z]),G=(0,g.useCallback)(async a=>{let b=new FormData;return b.append("file",a.file),(0,A.upload)({xhr:new XMLHttpRequest,data:b,onprogress:b=>{b.lengthComputable&&d(a,Math.floor(b.loaded/b.total*100),C.current)}},!1,void 0,"?source=datasets").then(b=>{let c={fileID:a.fileID,file:b,progress:-1},e=C.current.findIndex(b=>b.fileID===a.fileID);return C.current[e]=c,d(c,100,C.current),Promise.resolve({...c})}).catch(b=>(m({type:"error",message:(0,ac.getFileUploadErrorMessage)(b,l("stepOne.uploader.failed",{ns:"datasetCreation"}),l)}),d(a,-2,C.current),Promise.resolve({...a}))).finally()},[C,m,d,l]),H=(0,g.useCallback)(a=>(a.forEach(a=>a.progress=0),Promise.all(a.map(G))),[G]),I=(0,g.useCallback)(async a=>{let b=B.batch_count_limit,c=a.length,d=0,e=0;for(;d<c;){e=d+b>c?c:d+b;let f=a.slice(d,e);await H(f),d=e}},[B,H]),J=(0,g.useCallback)(b=>{let d=B.file_upload_limit;if(!b.length)return!1;if(b.length+a.length>d&&!ae.IS_CE_EDITION)return m({type:"error",message:l("stepOne.uploader.validation.filesNumber",{ns:"datasetCreation",filesNumber:d})}),!1;let e=b.map((a,b)=>({fileID:`file${b}-${Date.now()}`,file:a,progress:-1})),f=[...C.current,...e];c(f),C.current=f,I(e)},[c,I,m,l,a,B]),K=a=>{a.preventDefault(),a.stopPropagation(),a.target!==r.current&&p(!0)},L=a=>{a.preventDefault(),a.stopPropagation()},M=a=>{a.preventDefault(),a.stopPropagation(),a.target===r.current&&p(!1)},N=(0,g.useCallback)((a,b="")=>new Promise(c=>{if(a.isFile)a.file(a=>{a.relativePath=`${b}${a.name}`,c([a])});else if(a.isDirectory){let d=a.createReader(),e=[],f=()=>{d.readEntries(async d=>{d.length?(e.push(...d),f()):c((await Promise.all(e.map(c=>N(c,`${b}${a.name}/`)))).flat())})};f()}else c([])}),[]),O=(0,g.useCallback)(async a=>{if(a.preventDefault(),a.stopPropagation(),p(!1),!a.dataTransfer)return;let b=(await Promise.all(Array.from(a.dataTransfer.items).map(a=>{let b=a.webkitGetAsEntry?.();if(b)return N(b);let c=a.getAsFile?.();return c?Promise.resolve([c]):Promise.resolve([])}))).flat();j||(b=b.slice(0,1)),J((b=b.slice(0,B.batch_count_limit)).filter(F))},[J,F,j,N,B]),P=(0,g.useCallback)(a=>{let b=Array.from(a.target.files??[]);J((b=b.slice(0,B.batch_count_limit)).filter(F))},[F,J,B]),{theme:Q}=(0,ag.default)(),R=(0,g.useMemo)(()=>Q===aj.Theme.dark?"#5289ff":"#296dff",[Q]);return(0,g.useEffect)(()=>(q.current?.addEventListener("dragenter",K),q.current?.addEventListener("dragover",L),q.current?.addEventListener("dragleave",M),q.current?.addEventListener("drop",O),()=>{q.current?.removeEventListener("dragenter",K),q.current?.removeEventListener("dragover",L),q.current?.removeEventListener("dragleave",M),q.current?.removeEventListener("drop",O)}),[O]),(0,e.jsxs)("div",{className:"mb-5 w-[640px]",children:[!u&&(0,e.jsx)("input",{ref:t,id:"fileUploader",className:"hidden",type:"file",multiple:j,accept:z.join(","),onChange:P}),(0,e.jsx)("div",{className:(0,D.cn)("mb-1 text-sm font-semibold leading-6 text-text-secondary",b),children:l("stepOne.uploader.title",{ns:"datasetCreation"})}),!u&&(0,e.jsxs)("div",{ref:q,className:(0,D.cn)("relative mb-2 box-border flex min-h-20 max-w-[640px] flex-col items-center justify-center gap-1 rounded-xl border border-dashed border-components-dropzone-border bg-components-dropzone-bg px-4 py-3 text-xs leading-4 text-text-tertiary",o&&"border-components-dropzone-border-accent bg-components-dropzone-bg-accent"),children:[(0,e.jsxs)("div",{className:"flex min-h-5 items-center justify-center text-sm leading-4 text-text-secondary",children:[(0,e.jsx)(s.RiUploadCloud2Line,{className:"mr-2 size-5"}),(0,e.jsxs)("span",{children:[j?l("stepOne.uploader.button",{ns:"datasetCreation"}):l("stepOne.uploader.buttonSingleFile",{ns:"datasetCreation"}),x.length>0&&(0,e.jsx)("label",{className:"ml-1 cursor-pointer text-text-accent",onClick:()=>{t.current&&t.current.click()},children:l("stepOne.uploader.browse",{ns:"datasetCreation"})})]})]}),(0,e.jsx)("div",{children:l("stepOne.uploader.tip",{ns:"datasetCreation",size:B.file_size_limit,supportTypes:y,batchCount:B.batch_count_limit,totalCount:B.file_upload_limit})}),o&&(0,e.jsx)("div",{ref:r,className:"absolute left-0 top-0 h-full w-full"})]}),(0,e.jsx)("div",{className:"max-w-[640px] cursor-default space-y-1",children:a.map((a,b)=>{var c;return(0,e.jsxs)("div",{onClick:()=>a.file?.id&&i(a.file),className:(0,D.cn)("flex h-12 max-w-[640px] items-center rounded-lg border border-components-panel-border bg-components-panel-on-panel-item-bg text-xs leading-3 text-text-tertiary shadow-xs"),children:[(0,e.jsx)("div",{className:"flex w-12 shrink-0 items-center justify-center",children:(0,e.jsx)(ak.default,{size:"xl",className:"shrink-0",name:a.file.name,extension:E(a.file)})}),(0,e.jsxs)("div",{className:"flex shrink grow flex-col gap-0.5",children:[(0,e.jsx)("div",{className:"flex w-full",children:(0,e.jsx)("div",{className:"w-0 grow truncate text-sm leading-4 text-text-secondary",children:a.file.name})}),(0,e.jsxs)("div",{className:"w-full truncate leading-3 text-text-tertiary",children:[(0,e.jsx)("span",{className:"uppercase",children:E(a.file)}),(0,e.jsx)("span",{className:"px-1 text-text-quaternary",children:"Â·"}),(0,e.jsx)("span",{children:(c=a.file.size)/1024<10?`${(c/1024).toFixed(2)}KB`:`${(c/1024/1024).toFixed(2)}MB`})]})]}),(0,e.jsxs)("div",{className:"flex w-16 shrink-0 items-center justify-end gap-1 pr-3",children:[a.progress<100&&a.progress>=0&&(0,e.jsx)(ad.default,{percentage:a.progress,stroke:R,fill:R,animationDuration:0}),(0,e.jsx)("span",{className:"flex h-6 w-6 cursor-pointer items-center justify-center",onClick:b=>{var c;b.stopPropagation(),c=a.fileID,t.current&&(t.current.value=""),C.current=C.current.filter(a=>a.fileID!==c),f?.([...C.current])},children:(0,e.jsx)(s.RiDeleteBinLine,{className:"size-4 text-text-tertiary"})})]})]},`${a.fileID}-${b}`)})})]})};var am=a.i(459858),an=a.i(664358);let ao=g.memo(({isPreview:a,payload:b,isChecked:c,onCheckChange:d,onPreview:f,testId:i})=>{let{t:j}=(0,h.useTranslation)(),k=(0,g.useCallback)(()=>{d(!c)},[c,d]);return(0,e.jsx)("div",{className:(0,D.cn)(a?"bg-state-base-active":"group hover:bg-state-base-hover","cursor-pointer rounded-lg p-2"),children:(0,e.jsxs)("div",{className:"relative flex",children:[(0,e.jsx)("div",{className:"flex h-5 items-center",children:(0,e.jsx)(K.default,{className:"mr-2 shrink-0",checked:c,onCheck:k,id:i})}),(0,e.jsxs)("div",{className:"flex min-w-0 grow flex-col",children:[(0,e.jsx)("div",{className:"truncate text-sm font-medium text-text-secondary",title:b.title,children:b.title}),(0,e.jsx)("div",{className:"mt-0.5 truncate text-xs text-text-tertiary",title:b.source_url,children:b.source_url})]}),(0,e.jsx)(u.default,{onClick:f,className:"right-0 top-0 hidden h-6 px-1.5 text-xs font-medium uppercase group-hover:absolute group-hover:block",children:j("stepOne.website.preview",{ns:"datasetCreation"})})]})})}),ap="stepOne.website",aq=g.memo(({className:a="",list:b,checkedList:c,onSelectedChange:d,onPreview:f,usedTime:i})=>{let{t:j}=(0,h.useTranslation)(),k=c.length===b.length,l=(0,g.useCallback)(()=>{k?d([]):d(b)},[k,b,d]),m=(0,g.useCallback)(a=>b=>{b?d([...c,a]):d(c.filter(b=>b.source_url!==a.source_url))},[c,d]),[n,o]=g.useState(-1),p=(0,g.useCallback)(a=>()=>{o(a),f(b[a])},[b,f]);return(0,e.jsxs)("div",{className:(0,D.cn)(a,"border-t-[0.5px] border-divider-regular shadow-xs shadow-shadow-shadow-3"),children:[(0,e.jsxs)("div",{className:"flex h-[34px] items-center justify-between px-4",children:[(0,e.jsx)(an.default,{isChecked:k,onChange:l,label:j(k?`${ap}.resetAll`:`${ap}.selectAll`,{ns:"datasetCreation"}),labelClassName:"system-[13px] leading-[16px] font-medium text-text-secondary",testId:"select-all"}),(0,e.jsx)("div",{className:"text-xs text-text-tertiary",children:j(`${ap}.scrapTimeInfo`,{ns:"datasetCreation",total:b.length,time:i.toFixed(1)})})]}),(0,e.jsx)("div",{className:"p-2",children:b.map((a,b)=>(0,e.jsx)(ao,{isPreview:b===n,onPreview:p(b),payload:a,isChecked:c.some(b=>b.source_url===a.source_url),onCheckChange:m(a),testId:`item-${b}`},a.source_url))})]})});a.i(735510);var ar=a.i(368454),ar=ar;let as=g.memo(({className:a="",crawledNum:b,totalNum:c})=>{let{t:d}=(0,h.useTranslation)();return(0,e.jsxs)("div",{className:a,children:[(0,e.jsxs)("div",{className:"flex h-[34px] items-center border-y-[0.5px] border-divider-regular px-4 text-xs text-text-tertiary shadow-xs shadow-shadow-shadow-3",children:[d("stepOne.website.totalPageScraped",{ns:"datasetCreation"})," ",b,"/",c]}),(0,e.jsx)("div",{className:"p-2",children:["","","",""].map((a,b)=>(0,e.jsx)("div",{className:"py-[5px]",children:(0,e.jsx)(ar.default,{className:"text-text-quaternary"})},b))})]})});a.i(955696);var at=a.i(2496);let au=g.memo(({className:a,title:b,errorMsg:c})=>(0,e.jsxs)("div",{className:(0,D.cn)(a,"border-t border-divider-subtle bg-dataset-warning-message-bg px-4 py-2 opacity-40"),children:[(0,e.jsxs)("div",{className:"flex h-5 items-center",children:[(0,e.jsx)(at.AlertTriangle,{className:"mr-2 h-4 w-4 text-text-warning-secondary"}),(0,e.jsx)("div",{className:"system-md-medium text-text-warning",children:b})]}),c&&(0,e.jsx)("div",{className:"system-xs-regular mt-1 pl-6 text-text-secondary",children:c})]}));a.i(943046);var av=a.i(782465);let aw=g.memo(({className:a="",children:b,controlFoldOptions:c})=>{let{t:d}=(0,h.useTranslation)(),[f,{toggle:i,setTrue:j}]=(0,t.useBoolean)(!1);return(0,g.useEffect)(()=>{c&&j()},[c]),(0,e.jsxs)("div",{className:(0,D.cn)(a,f?"mb-3":"mb-0"),children:[(0,e.jsxs)("div",{className:"flex h-[26px] cursor-pointer select-none items-center gap-x-1 py-1",onClick:i,children:[(0,e.jsxs)("div",{className:"flex grow items-center",children:[(0,e.jsx)(s.RiEqualizer2Line,{className:"mr-1 h-4 w-4 text-text-secondary"}),(0,e.jsx)("span",{className:"text-[13px] font-semibold uppercase leading-[16px] text-text-secondary",children:d("stepOne.website.options",{ns:"datasetCreation"})})]}),(0,e.jsx)(av.ChevronRight,{className:(0,D.cn)(!f&&"rotate-90","h-4 w-4 shrink-0 text-text-tertiary")})]}),!f&&(0,e.jsx)("div",{className:"mb-4",children:b})]})}),ax=g.memo(({value:a,onChange:b,placeholder:c="",isNumber:d=!1})=>{let f=(0,g.useCallback)(a=>{let c=a.target.value;if(d){let a=Number.parseInt(c,10);return Number.isNaN(a)?void b(""):(a<0&&(a=0),void b(a))}b(c)},[d,b]),h=d?{min:0}:{};return(0,e.jsx)("input",{type:d?"number":"text",...h,value:a,onChange:f,className:"system-xs-regular focus:bg-components-inout-border-active flex h-8 w-full rounded-lg border border-transparent bg-components-input-bg-normal p-2 text-components-input-text-filled caret-[#295eff] placeholder:text-components-input-text-placeholder hover:border hover:border-components-input-border-hover hover:bg-components-input-bg-hover focus:border focus:border-components-input-border-active focus:shadow-xs focus:shadow-shadow-shadow-3 focus-visible:outline-none",placeholder:c})}),ay=g.memo(({isRunning:a,onRun:b})=>{let{t:c}=(0,h.useTranslation)(),d=(0,af.useDocLink)(),[f,i]=(0,g.useState)(""),j=(0,g.useCallback)(a=>{i(a)},[]),k=(0,g.useCallback)(()=>{a||b(f)},[a,b,f]);return(0,e.jsxs)("div",{className:"flex items-center justify-between gap-x-2",children:[(0,e.jsx)(ax,{value:f,onChange:j,placeholder:d()}),(0,e.jsx)(u.default,{variant:"primary",onClick:k,loading:a,spinnerClassName:"!ml-0",children:a?"":c("stepOne.website.run",{ns:"datasetCreation"})})]})});var az=a.i(483664);let aA=g.memo(({className:a,label:b,labelClassName:c,value:d,onChange:f,isRequired:g=!1,placeholder:h="",isNumber:i=!1,tooltip:j})=>(0,e.jsxs)("div",{className:(0,D.cn)(a),children:[(0,e.jsxs)("div",{className:"flex py-[7px]",children:[(0,e.jsxs)("div",{className:(0,D.cn)(c,"flex h-[16px] items-center text-[13px] font-semibold text-text-secondary"),children:[b," "]}),g&&(0,e.jsx)("span",{className:"ml-0.5 text-xs font-semibold text-text-destructive",children:"*"}),j&&(0,e.jsx)(az.default,{popupContent:(0,e.jsx)("div",{className:"w-[200px]",children:j}),triggerClassName:"ml-0.5 w-4 h-4"})]}),(0,e.jsx)(ax,{value:d,onChange:f,placeholder:h,isNumber:i})]})),aB="stepOne.website",aC=g.memo(({className:a="",payload:b,onChange:c})=>{let{t:d}=(0,h.useTranslation)(),f=(0,g.useCallback)(a=>d=>{c({...b,[a]:d})},[b,c]);return(0,e.jsxs)("div",{className:(0,D.cn)(a," space-y-2"),children:[(0,e.jsx)(an.default,{label:d(`${aB}.crawlSubPage`,{ns:"datasetCreation"}),isChecked:b.crawl_sub_pages,onChange:f("crawl_sub_pages"),labelClassName:"text-[13px] leading-[16px] font-medium text-text-secondary"}),(0,e.jsxs)("div",{className:"flex justify-between space-x-4",children:[(0,e.jsx)(aA,{className:"shrink-0 grow",label:d(`${aB}.limit`,{ns:"datasetCreation"}),value:b.limit,onChange:f("limit"),isNumber:!0,isRequired:!0}),(0,e.jsx)(aA,{className:"shrink-0 grow",label:d(`${aB}.maxDepth`,{ns:"datasetCreation"}),value:b.max_depth,onChange:f("max_depth"),isNumber:!0,tooltip:d(`${aB}.maxDepthTooltip`,{ns:"datasetCreation"})})]}),(0,e.jsxs)("div",{className:"flex justify-between space-x-4",children:[(0,e.jsx)(aA,{className:"shrink-0 grow",label:d(`${aB}.excludePaths`,{ns:"datasetCreation"}),value:b.excludes,onChange:f("excludes"),placeholder:"blog/*, /about/*"}),(0,e.jsx)(aA,{className:"shrink-0 grow",label:d(`${aB}.includeOnlyPaths`,{ns:"datasetCreation"}),value:b.includes,onChange:f("includes"),placeholder:"articles/*"})]}),(0,e.jsx)(an.default,{label:d(`${aB}.extractOnlyMainContent`,{ns:"datasetCreation"}),isChecked:b.only_main_content,onChange:f("only_main_content"),labelClassName:"text-[13px] leading-[16px] font-medium text-text-secondary"})]})}),aD="errorMsg",aE="stepOne.website";var aF=((b=aF||{}).init="init",b.running="running",b.finished="finished",b);let aG=g.memo(({onPreview:a,checkedCrawlResult:b,onCheckedCrawlResultChange:c,onJobIdChange:d,crawlOptions:f,onCrawlOptionsChange:i})=>{let{t:k}=(0,h.useTranslation)(),[l,n]=(0,g.useState)("init"),[o,p]=(0,g.useState)(0);(0,g.useEffect)(()=>{"init"!==l&&p(Date.now())},[l]);let q=(0,m.useModalContextSelector)(a=>a.setShowAccountSettingModal),r=(0,g.useCallback)(()=>{q({payload:j.ACCOUNT_SETTING_TAB.DATA_SOURCE})},[q]),s=(0,g.useCallback)(a=>{let b="";return a||(b=k(`${aD}.fieldRequired`,{ns:"common",field:"url"})),b||a.startsWith("http://")||a.startsWith("https://")||(b=k(`${aD}.urlError`,{ns:"common"})),b||null!==f.limit&&void 0!==f.limit&&""!==f.limit||(b=k(`${aD}.fieldRequired`,{ns:"common",field:k(`${aE}.limit`,{ns:"datasetCreation"})})),{isValid:!b,errorMsg:b}},[f,k]),t="init"===l,u="finished"===l,v="running"===l,[w,x]=(0,g.useState)(void 0),[y,z]=(0,g.useState)(""),A=u&&y,B=(0,g.useCallback)(async a=>{try{let b=await (0,$.checkFirecrawlTaskStatus)(a);if("completed"===b.status)return{isError:!1,data:{...b,total:Math.min(b.total,Number.parseFloat(f.limit))}};if("error"===b.status||!b.status)return{isError:!0,errorMessage:b.message,data:{data:[]}};return b.data=b.data.map(a=>({...a,content:a.markdown})),x({...b,total:Math.min(b.total,Number.parseFloat(f.limit))}),c(b.data||[]),await (0,am.sleep)(2500),await B(a)}catch(a){return{isError:!0,errorMessage:(await a.json()).message,data:{data:[]}}}},[f.limit,c]),C=(0,g.useCallback)(async a=>{let{isValid:b,errorMsg:e}=s(a);if(!b)return void Z.default.notify({message:e,type:"error"});n("running");try{let b={...f};""===f.max_depth&&delete b.max_depth;let e=(await (0,$.createFirecrawlTask)({url:a,options:b})).job_id;d(e);let{isError:g,data:h,errorMessage:i}=await B(e);g?z(i||k(`${aE}.unknownError`,{ns:"datasetCreation"})):(x(h),c(h.data||[]),z(""))}catch(a){z(k(`${aE}.unknownError`,{ns:"datasetCreation"}))}finally{n("finished")}},[s,f,d,k,B,c]);return(0,e.jsxs)("div",{children:[(0,e.jsx)(E,{onClickConfiguration:r,title:k(`${aE}.firecrawlTitle`,{ns:"datasetCreation"}),buttonText:k(`${aE}.configureFirecrawl`,{ns:"datasetCreation"}),docTitle:k(`${aE}.firecrawlDoc`,{ns:"datasetCreation"}),docLink:"https://docs.firecrawl.dev/introduction"}),(0,e.jsxs)("div",{className:"mt-2 rounded-xl border border-components-panel-border bg-background-default-subtle p-4 pb-0",children:[(0,e.jsx)(ay,{onRun:C,isRunning:v}),(0,e.jsx)(aw,{className:"mt-4",controlFoldOptions:o,children:(0,e.jsx)(aC,{className:"mt-2",payload:f,onChange:i})}),!t&&(0,e.jsxs)("div",{className:"relative left-[-16px] mt-3 w-[calc(100%_+_32px)] rounded-b-xl",children:[v&&(0,e.jsx)(as,{className:"mt-2",crawledNum:w?.current||0,totalNum:w?.total||Number.parseFloat(f.limit)||0}),A&&(0,e.jsx)(au,{className:"rounded-b-xl",title:k(`${aE}.exceptionErrorTitle`,{ns:"datasetCreation"}),errorMsg:y}),u&&!A&&(0,e.jsx)(aq,{className:"mb-2",list:w?.data||[],checkedList:b,onSelectedChange:c,onPreview:a,usedTime:Number.parseFloat(w?.time_consuming)||0})]})]})]})});var aH=a.i(852718);let aI="stepOne.website",aJ=g.memo(({className:a="",payload:b,onChange:c})=>{let{t:d}=(0,h.useTranslation)(),f=(0,g.useCallback)(a=>d=>{c({...b,[a]:d})},[b,c]);return(0,e.jsxs)("div",{className:(0,D.cn)(a," space-y-2"),children:[(0,e.jsx)(an.default,{label:d(`${aI}.crawlSubPage`,{ns:"datasetCreation"}),isChecked:b.crawl_sub_pages,onChange:f("crawl_sub_pages"),labelClassName:"text-[13px] leading-[16px] font-medium text-text-secondary",testId:"crawl-sub-pages"}),(0,e.jsx)(an.default,{label:d(`${aI}.useSitemap`,{ns:"datasetCreation"}),isChecked:b.use_sitemap,onChange:f("use_sitemap"),tooltip:d(`${aI}.useSitemapTooltip`,{ns:"datasetCreation"}),labelClassName:"text-[13px] leading-[16px] font-medium text-text-secondary",testId:"use-sitemap"}),(0,e.jsx)("div",{className:"flex justify-between space-x-4",children:(0,e.jsx)(aA,{className:"shrink-0 grow",label:d(`${aI}.limit`,{ns:"datasetCreation"}),value:b.limit,onChange:f("limit"),isNumber:!0,isRequired:!0})})]})}),aK="errorMsg",aL="stepOne.website";var aM=((c=aM||{}).init="init",c.running="running",c.finished="finished",c);let aN=g.memo(({onPreview:a,checkedCrawlResult:b,onCheckedCrawlResultChange:c,onJobIdChange:d,crawlOptions:f,onCrawlOptionsChange:i})=>{let{t:k}=(0,h.useTranslation)(),[l,n]=(0,g.useState)("init"),[o,p]=(0,g.useState)(0);(0,g.useEffect)(()=>{"init"!==l&&p(Date.now())},[l]);let{setShowAccountSettingModal:q}=(0,m.useModalContext)(),r=(0,g.useCallback)(()=>{q({payload:j.ACCOUNT_SETTING_TAB.DATA_SOURCE})},[q]),s=(0,g.useCallback)(a=>{let b="";return a||(b=k(`${aK}.fieldRequired`,{ns:"common",field:"url"})),b||a.startsWith("http://")||a.startsWith("https://")||(b=k(`${aK}.urlError`,{ns:"common"})),b||null!==f.limit&&void 0!==f.limit&&""!==f.limit||(b=k(`${aK}.fieldRequired`,{ns:"common",field:k(`${aL}.limit`,{ns:"datasetCreation"})})),{isValid:!b,errorMsg:b}},[f,k]),t="init"===l,u="finished"===l,v="running"===l,[w,x]=(0,g.useState)(void 0),[y,z]=(0,g.useState)(""),A=u&&y,B=(0,g.useCallback)(async a=>{try{let b=await (0,$.checkJinaReaderTaskStatus)(a);if("completed"===b.status)return{isError:!1,data:{...b,total:Math.min(b.total,Number.parseFloat(f.limit))}};if("failed"===b.status||!b.status)return{isError:!0,errorMessage:b.message,data:{data:[]}};return x({...b,total:Math.min(b.total,Number.parseFloat(f.limit))}),c(b.data||[]),await (0,am.sleep)(2500),await B(a)}catch(a){return{isError:!0,errorMessage:(await a.json()).message,data:{data:[]}}}},[f.limit,c]),C=(0,g.useCallback)(async a=>{let{isValid:b,errorMsg:e}=s(a);if(!b)return void Z.default.notify({message:e,type:"error"});n("running");try{let b=Date.now(),e=await (0,$.createJinaReaderTask)({url:a,options:f});if(e.data){let{title:a,content:d,description:f,url:g}=e.data,h={current:1,total:1,data:[{title:a,markdown:d,description:f,source_url:g}],time_consuming:(Date.now()-b)/1e3};x(h),c(h.data||[]),z("")}else if(e.job_id){let a=e.job_id;d(a);let{isError:b,data:f,errorMessage:g}=await B(a);b?z(g||k(`${aL}.unknownError`,{ns:"datasetCreation"})):(x(f),c(f.data||[]),z(""))}}catch(a){z(k(`${aL}.unknownError`,{ns:"datasetCreation"}))}finally{n("finished")}},[s,f,c,d,k,B]);return(0,e.jsxs)("div",{children:[(0,e.jsx)(E,{onClickConfiguration:r,title:k(`${aL}.jinaReaderTitle`,{ns:"datasetCreation"}),buttonText:k(`${aL}.configureJinaReader`,{ns:"datasetCreation"}),docTitle:k(`${aL}.jinaReaderDoc`,{ns:"datasetCreation"}),docLink:"https://jina.ai/reader"}),(0,e.jsxs)("div",{className:"mt-2 rounded-xl border border-components-panel-border bg-background-default-subtle p-4 pb-0",children:[(0,e.jsx)(ay,{onRun:C,isRunning:v}),(0,e.jsx)(aw,{className:"mt-4",controlFoldOptions:o,children:(0,e.jsx)(aJ,{className:"mt-2",payload:f,onChange:i})}),!t&&(0,e.jsxs)("div",{className:"relative left-[-16px] mt-3 w-[calc(100%_+_32px)] rounded-b-xl",children:[v&&(0,e.jsx)(as,{className:"mt-2",crawledNum:w?.current||0,totalNum:w?.total||Number.parseFloat(f.limit)||0}),A&&(0,e.jsx)(au,{className:"rounded-b-xl",title:k(`${aL}.exceptionErrorTitle`,{ns:"datasetCreation"}),errorMsg:y}),u&&!A&&(0,e.jsx)(aq,{className:"mb-2",list:w?.data||[],checkedList:b,onSelectedChange:c,onPreview:a,usedTime:Number.parseFloat(w?.time_consuming)||0})]})]})]})});var w=w;let aO="stepOne.website",aP=g.memo(({onConfig:a,provider:b})=>{let{t:c}=(0,h.useTranslation)(),d={[n.DataSourceProvider.jinaReader]:ae.ENABLE_WEBSITE_JINAREADER?{emoji:(0,e.jsx)("span",{className:aH.default.jinaLogo}),title:c(`${aO}.jinaReaderNotConfigured`,{ns:"datasetCreation"}),description:c(`${aO}.jinaReaderNotConfiguredDescription`,{ns:"datasetCreation"})}:null,[n.DataSourceProvider.fireCrawl]:ae.ENABLE_WEBSITE_FIRECRAWL?{emoji:"ðŸ”¥",title:c(`${aO}.fireCrawlNotConfigured`,{ns:"datasetCreation"}),description:c(`${aO}.fireCrawlNotConfiguredDescription`,{ns:"datasetCreation"})}:null,[n.DataSourceProvider.waterCrawl]:ae.ENABLE_WEBSITE_WATERCRAWL?{emoji:"ðŸ’§",title:c(`${aO}.waterCrawlNotConfigured`,{ns:"datasetCreation"}),description:c(`${aO}.waterCrawlNotConfiguredDescription`,{ns:"datasetCreation"})}:null},f=d[b]||d.jinareader;return f?(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"mt-4 max-w-[640px] rounded-2xl bg-workflow-process-bg p-6",children:[(0,e.jsx)("div",{className:"flex h-12 w-12 items-center justify-center rounded-[10px] border-[0.5px] border-components-card-border bg-components-card-bg shadow-lg shadow-shadow-shadow-5 backdrop-blur-[5px]",children:f.emoji}),(0,e.jsxs)("div",{className:"mb-1 mt-2 flex flex-col gap-y-1 pb-3 pt-1",children:[(0,e.jsxs)("span",{className:"system-md-semibold text-text-secondary",children:[f.title,(0,e.jsx)(w.default,{className:"relative -left-1.5 -top-2.5 inline"})]}),(0,e.jsx)("div",{className:"system-sm-regular text-text-tertiary",children:f.description})]}),(0,e.jsx)(u.default,{variant:"primary",onClick:a,children:c(`${aO}.configure`,{ns:"datasetCreation"})})]})}):null}),aQ="stepOne.website",aR=g.memo(({className:a="",payload:b,onChange:c})=>{let{t:d}=(0,h.useTranslation)(),f=(0,g.useCallback)(a=>d=>{c({...b,[a]:d})},[b,c]);return(0,e.jsxs)("div",{className:(0,D.cn)(a," space-y-2"),children:[(0,e.jsx)(an.default,{label:d(`${aQ}.crawlSubPage`,{ns:"datasetCreation"}),isChecked:b.crawl_sub_pages,onChange:f("crawl_sub_pages"),labelClassName:"text-[13px] leading-[16px] font-medium text-text-secondary",testId:"crawl-sub-pages"}),(0,e.jsxs)("div",{className:"flex justify-between space-x-4",children:[(0,e.jsx)(aA,{className:"shrink-0 grow",label:d(`${aQ}.limit`,{ns:"datasetCreation"}),value:b.limit,onChange:f("limit"),isNumber:!0,isRequired:!0}),(0,e.jsx)(aA,{className:"shrink-0 grow",label:d(`${aQ}.maxDepth`,{ns:"datasetCreation"}),value:b.max_depth,onChange:f("max_depth"),isNumber:!0,tooltip:d(`${aQ}.maxDepthTooltip`,{ns:"datasetCreation"})})]}),(0,e.jsxs)("div",{className:"flex justify-between space-x-4",children:[(0,e.jsx)(aA,{className:"shrink-0 grow",label:d(`${aQ}.excludePaths`,{ns:"datasetCreation"}),value:b.excludes,onChange:f("excludes"),placeholder:"blog/*, /about/*"}),(0,e.jsx)(aA,{className:"shrink-0 grow",label:d(`${aQ}.includeOnlyPaths`,{ns:"datasetCreation"}),value:b.includes,onChange:f("includes"),placeholder:"articles/*"})]}),(0,e.jsx)(an.default,{label:d(`${aQ}.extractOnlyMainContent`,{ns:"datasetCreation"}),isChecked:b.only_main_content,onChange:f("only_main_content"),labelClassName:"text-[13px] leading-[16px] font-medium text-text-secondary",testId:"only-main-content"})]})}),aS="errorMsg",aT="stepOne.website";var aU=((d=aU||{}).init="init",d.running="running",d.finished="finished",d);let aV=g.memo(({onPreview:a,checkedCrawlResult:b,onCheckedCrawlResultChange:c,onJobIdChange:d,crawlOptions:f,onCrawlOptionsChange:i})=>{let{t:k}=(0,h.useTranslation)(),[l,n]=(0,g.useState)("init"),[o,p]=(0,g.useState)(0);(0,g.useEffect)(()=>{"init"!==l&&p(Date.now())},[l]);let{setShowAccountSettingModal:q}=(0,m.useModalContext)(),r=(0,g.useCallback)(()=>{q({payload:j.ACCOUNT_SETTING_TAB.DATA_SOURCE})},[q]),s=(0,g.useCallback)(a=>{let b="";return a||(b=k(`${aS}.fieldRequired`,{ns:"common",field:"url"})),b||a.startsWith("http://")||a.startsWith("https://")||(b=k(`${aS}.urlError`,{ns:"common"})),b||null!==f.limit&&void 0!==f.limit&&""!==f.limit||(b=k(`${aS}.fieldRequired`,{ns:"common",field:k(`${aT}.limit`,{ns:"datasetCreation"})})),{isValid:!b,errorMsg:b}},[f,k]),t="init"===l,u="finished"===l,v="running"===l,[w,x]=(0,g.useState)(void 0),[y,z]=(0,g.useState)(""),A=u&&y,B=(0,g.useCallback)(async a=>{try{let b=await (0,$.checkWatercrawlTaskStatus)(a);if("completed"===b.status)return{isError:!1,data:{...b,total:Math.min(b.total,Number.parseFloat(f.limit))}};if("error"===b.status||!b.status)return{isError:!0,errorMessage:b.message,data:{data:[]}};return x({...b,total:Math.min(b.total,Number.parseFloat(f.limit))}),c(b.data||[]),await (0,am.sleep)(2500),await B(a)}catch(b){let a="";if(b?.json)try{let c=await b.json();"string"==typeof c?.message&&(a=c.message)}catch{}return a||"string"!=typeof b?.message||(a=b.message),{isError:!0,errorMessage:a,data:{data:[]}}}},[f.limit,c]),C=(0,g.useCallback)(async a=>{let{isValid:b,errorMsg:e}=s(a);if(!b)return void Z.default.notify({message:e,type:"error"});n("running");try{let b={...f};""===f.max_depth&&delete b.max_depth;let e=(await (0,$.createWatercrawlTask)({url:a,options:b})).job_id;d(e);let{isError:g,data:h,errorMessage:i}=await B(e);g?z(i||k(`${aT}.unknownError`,{ns:"datasetCreation"})):(x(h),c(h.data||[]),z(""))}catch(a){z(k(`${aT}.unknownError`,{ns:"datasetCreation"}))}finally{n("finished")}},[s,f,c,d,k,B]);return(0,e.jsxs)("div",{children:[(0,e.jsx)(E,{onClickConfiguration:r,title:k(`${aT}.watercrawlTitle`,{ns:"datasetCreation"}),buttonText:k(`${aT}.configureWatercrawl`,{ns:"datasetCreation"}),docTitle:k(`${aT}.watercrawlDoc`,{ns:"datasetCreation"}),docLink:"https://docs.watercrawl.dev/"}),(0,e.jsxs)("div",{className:"mt-2 rounded-xl border border-components-panel-border bg-background-default-subtle p-4 pb-0",children:[(0,e.jsx)(ay,{onRun:C,isRunning:v}),(0,e.jsx)(aw,{className:"mt-4",controlFoldOptions:o,children:(0,e.jsx)(aR,{className:"mt-2",payload:f,onChange:i})}),!t&&(0,e.jsxs)("div",{className:"relative left-[-16px] mt-3 w-[calc(100%_+_32px)] rounded-b-xl",children:[v&&(0,e.jsx)(as,{className:"mt-2",crawledNum:w?.current||0,totalNum:w?.total||Number.parseFloat(f.limit)||0}),A&&(0,e.jsx)(au,{className:"rounded-b-xl",title:k(`${aT}.exceptionErrorTitle`,{ns:"datasetCreation"}),errorMsg:y}),u&&!A&&(0,e.jsx)(aq,{className:"mb-2",list:w?.data||[],checkedList:b,onSelectedChange:c,onPreview:a,usedTime:Number.parseFloat(w?.time_consuming)||0})]})]})]})}),aW=g.memo(({onPreview:a,checkedCrawlResult:b,onCheckedCrawlResultChange:c,onCrawlProviderChange:d,onJobIdChange:f,crawlOptions:i,onCrawlOptionsChange:k,authedDataSourceList:l})=>{let{t:o}=(0,h.useTranslation)(),{setShowAccountSettingModal:p}=(0,m.useModalContext)(),[q,r]=(0,g.useState)(n.DataSourceProvider.jinaReader),s=(0,g.useMemo)(()=>l.filter(a=>[n.DataSourceProvider.jinaReader,n.DataSourceProvider.fireCrawl,n.DataSourceProvider.waterCrawl].includes(a.provider)&&a.credentials_list.length>0),[l]),t=(0,g.useCallback)(()=>{p({payload:j.ACCOUNT_SETTING_TAB.DATA_SOURCE})},[p]),u=s.find(a=>a.provider===q);return(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"mb-4",children:[(0,e.jsx)("div",{className:"system-md-medium mb-2 text-text-secondary",children:o("stepOne.website.chooseProvider",{ns:"datasetCreation"})}),(0,e.jsxs)("div",{className:"flex space-x-2",children:[ae.ENABLE_WEBSITE_JINAREADER&&(0,e.jsxs)("button",{type:"button",className:(0,D.cn)("flex items-center justify-center rounded-lg px-4 py-2",q===n.DataSourceProvider.jinaReader?"system-sm-medium border-[1.5px] border-components-option-card-option-selected-border bg-components-option-card-option-selected-bg text-text-primary":`system-sm-regular border border-components-option-card-option-border bg-components-option-card-option-bg text-text-secondary
                hover:border-components-option-card-option-border-hover hover:bg-components-option-card-option-bg-hover hover:shadow-xs hover:shadow-shadow-shadow-3`),onClick:()=>{r(n.DataSourceProvider.jinaReader),d(n.DataSourceProvider.jinaReader)},children:[(0,e.jsx)("span",{className:(0,D.cn)(aH.default.jinaLogo,"mr-2")}),(0,e.jsx)("span",{children:"Jina Reader"})]}),ae.ENABLE_WEBSITE_FIRECRAWL&&(0,e.jsx)("button",{type:"button",className:(0,D.cn)("rounded-lg px-4 py-2",q===n.DataSourceProvider.fireCrawl?"system-sm-medium border-[1.5px] border-components-option-card-option-selected-border bg-components-option-card-option-selected-bg text-text-primary":`system-sm-regular border border-components-option-card-option-border bg-components-option-card-option-bg text-text-secondary
                hover:border-components-option-card-option-border-hover hover:bg-components-option-card-option-bg-hover hover:shadow-xs hover:shadow-shadow-shadow-3`),onClick:()=>{r(n.DataSourceProvider.fireCrawl),d(n.DataSourceProvider.fireCrawl)},children:"ðŸ”¥ Firecrawl"}),ae.ENABLE_WEBSITE_WATERCRAWL&&(0,e.jsxs)("button",{type:"button",className:(0,D.cn)("flex items-center justify-center rounded-lg px-4 py-2",q===n.DataSourceProvider.waterCrawl?"system-sm-medium border-[1.5px] border-components-option-card-option-selected-border bg-components-option-card-option-selected-bg text-text-primary":`system-sm-regular border border-components-option-card-option-border bg-components-option-card-option-bg text-text-secondary
                hover:border-components-option-card-option-border-hover hover:bg-components-option-card-option-bg-hover hover:shadow-xs hover:shadow-shadow-shadow-3`),onClick:()=>{r(n.DataSourceProvider.waterCrawl),d(n.DataSourceProvider.waterCrawl)},children:[(0,e.jsx)("span",{className:(0,D.cn)(aH.default.watercrawlLogo,"mr-2")}),(0,e.jsx)("span",{children:"WaterCrawl"})]})]})]}),u&&q===n.DataSourceProvider.fireCrawl&&(0,e.jsx)(aG,{onPreview:a,checkedCrawlResult:b,onCheckedCrawlResultChange:c,onJobIdChange:f,crawlOptions:i,onCrawlOptionsChange:k}),u&&q===n.DataSourceProvider.waterCrawl&&(0,e.jsx)(aV,{onPreview:a,checkedCrawlResult:b,onCheckedCrawlResultChange:c,onJobIdChange:f,crawlOptions:i,onCrawlOptionsChange:k}),u&&q===n.DataSourceProvider.jinaReader&&(0,e.jsx)(aN,{onPreview:a,checkedCrawlResult:b,onCheckedCrawlResultChange:c,onJobIdChange:f,crawlOptions:i,onCrawlOptionsChange:k}),!u&&(0,e.jsx)(aP,{onConfig:t,provider:q})]})});var aX=a.i(706088);let aY=[{type:o.DataSourceType.FILE,labelKey:"stepOne.dataSourceType.file"},{type:o.DataSourceType.NOTION,iconClass:aX.default.notion,labelKey:"stepOne.dataSourceType.notion"},{type:o.DataSourceType.WEB,iconClass:aX.default.web,labelKey:"stepOne.dataSourceType.web"}],aZ=function({currentType:a,disabled:b,onChange:c,onClearPreviews:d}){let{t:f}=(0,h.useTranslation)(),i=ae.ENABLE_WEBSITE_FIRECRAWL||ae.ENABLE_WEBSITE_JINAREADER||ae.ENABLE_WEBSITE_WATERCRAWL,j=(0,g.useCallback)(a=>{b||(c(a),d(a))},[b,c,d]),k=(0,g.useMemo)(()=>aY.filter(a=>a.type!==o.DataSourceType.WEB||i),[i]);return(0,e.jsx)("div",{className:"mb-8 grid grid-cols-3 gap-4",children:k.map(c=>(0,e.jsxs)("div",{className:(0,D.cn)(aX.default.dataSourceItem,"system-sm-medium",a===c.type&&aX.default.active,b&&a!==c.type&&aX.default.disabled),onClick:()=>j(c.type),children:[(0,e.jsx)("span",{className:(0,D.cn)(aX.default.datasetIcon,c.iconClass)}),(0,e.jsx)("span",{title:f(c.labelKey,{ns:"datasetCreation"})||void 0,className:"truncate",children:f(c.labelKey,{ns:"datasetCreation"})})]},c.type))})},a$=function({disabled:a,onClick:b}){let{t:c}=(0,h.useTranslation)();return(0,e.jsx)("div",{className:"flex max-w-[640px] justify-end gap-2",children:(0,e.jsx)(u.default,{disabled:a,variant:"primary",onClick:b,children:(0,e.jsxs)("span",{className:"flex gap-0.5 px-[10px]",children:[(0,e.jsx)("span",{className:"px-0.5",children:c("stepOne.button",{ns:"datasetCreation"})}),(0,e.jsx)(s.RiArrowRightLine,{className:"size-4"})]})})})};var a_=a.i(681073),a0=a.i(893500),a1=a.i(9575),a2=a.i(16199);let a3=({file:a,hidePreview:b})=>{let{t:c}=(0,h.useTranslation)(),[d,f]=(0,g.useState)(""),[j,k]=(0,g.useState)(!0),l=async a=>{try{let b=await (0,a1.fetchFilePreview)({fileID:a});f(b.content),k(!1)}catch{}};return(0,g.useEffect)(()=>{a?.id&&(k(!0),l(a.id))},[a]),(0,e.jsxs)("div",{className:(0,D.cn)(a2.default.filePreview,"h-full"),children:[(0,e.jsxs)("div",{className:(0,D.cn)(a2.default.previewHeader),children:[(0,e.jsxs)("div",{className:(0,D.cn)(a2.default.title,"title-md-semi-bold"),children:[(0,e.jsx)("span",{children:c("stepOne.filePreview",{ns:"datasetCreation"})}),(0,e.jsx)("div",{className:"flex h-6 w-6 cursor-pointer items-center justify-center",onClick:b,children:(0,e.jsx)(a0.XMarkIcon,{className:"h-4 w-4"})})]}),(0,e.jsxs)("div",{className:(0,D.cn)(a2.default.fileName,"system-xs-medium"),children:[(0,e.jsx)("span",{children:a?a.name.split(".").slice(0,-1).join():""}),(0,e.jsxs)("span",{className:(0,D.cn)(a2.default.filetype),children:[".",a?.extension]})]})]}),(0,e.jsxs)("div",{className:(0,D.cn)(a2.default.previewContent),children:[j&&(0,e.jsx)(i.default,{type:"area"}),!j&&(0,e.jsx)("div",{className:(0,D.cn)(a2.default.fileContent,"body-md-regular"),children:d})]})]})};var a4=a.i(742136);let a5=({currentPage:a,notionCredentialId:b,hidePreview:c})=>{let{t:d}=(0,h.useTranslation)(),[f,j]=(0,g.useState)(""),[k,l]=(0,g.useState)(!0),m=async()=>{if(a)try{let c=await (0,$.fetchNotionPagePreview)({pageID:a.page_id,pageType:a.type,credentialID:b});j(c.content),l(!1)}catch{}};return(0,g.useEffect)(()=>{a&&(l(!0),m())},[a]),(0,e.jsxs)("div",{className:(0,D.cn)(a4.default.filePreview,"h-full"),children:[(0,e.jsxs)("div",{className:(0,D.cn)(a4.default.previewHeader),children:[(0,e.jsxs)("div",{className:(0,D.cn)(a4.default.title,"title-md-semi-bold"),children:[(0,e.jsx)("span",{children:d("stepOne.pagePreview",{ns:"datasetCreation"})}),(0,e.jsx)("div",{className:"flex h-6 w-6 cursor-pointer items-center justify-center",onClick:c,children:(0,e.jsx)(a0.XMarkIcon,{className:"h-4 w-4"})})]}),(0,e.jsxs)("div",{className:(0,D.cn)(a4.default.fileName,"system-xs-medium"),children:[(0,e.jsx)(L.default,{className:"mr-1 shrink-0",type:"page",src:a?.page_icon}),a?.page_name]})]}),(0,e.jsxs)("div",{className:(0,D.cn)(a4.default.previewContent,"body-md-regular"),children:[k&&(0,e.jsx)(i.default,{type:"area"}),!k&&(0,e.jsx)("div",{className:(0,D.cn)(a4.default.fileContent,"body-md-regular"),children:f})]})]})},a6=({payload:a,hidePreview:b})=>{let{t:c}=(0,h.useTranslation)();return(0,e.jsxs)("div",{className:(0,D.cn)(a2.default.filePreview,"h-full"),children:[(0,e.jsxs)("div",{className:(0,D.cn)(a2.default.previewHeader),children:[(0,e.jsxs)("div",{className:(0,D.cn)(a2.default.title,"title-md-semi-bold"),children:[(0,e.jsx)("span",{children:c("stepOne.pagePreview",{ns:"datasetCreation"})}),(0,e.jsx)("div",{className:"flex h-6 w-6 cursor-pointer items-center justify-center",onClick:b,children:(0,e.jsx)(a0.XMarkIcon,{className:"h-4 w-4"})})]}),(0,e.jsx)("div",{className:"title-sm-semi-bold break-words text-text-primary",children:a.title}),(0,e.jsx)("div",{className:"system-xs-medium truncate text-text-tertiary",title:a.source_url,children:a.source_url})]}),(0,e.jsx)("div",{className:(0,D.cn)(a2.default.previewContent,"body-md-regular"),children:(0,e.jsx)("div",{className:(0,D.cn)(a2.default.fileContent),children:a.markdown})})]})},a7=function({currentFile:a,currentNotionPage:b,currentWebsite:c,notionCredentialId:d,isShowPlanUpgradeModal:f,hideFilePreview:g,hideNotionPagePreview:i,hideWebsitePreview:j,hidePlanUpgradeModal:k}){let{t:l}=(0,h.useTranslation)();return(0,e.jsxs)("div",{className:"h-full w-1/2 overflow-y-auto",children:[a&&(0,e.jsx)(a3,{file:a,hidePreview:g}),b&&(0,e.jsx)(a5,{currentPage:b,hidePreview:i,notionCredentialId:d}),c&&(0,e.jsx)(a6,{payload:c,hidePreview:j}),f&&(0,e.jsx)(a_.default,{show:!0,onClose:k,title:l("upgrade.uploadMultiplePages.title",{ns:"billing"}),description:l("upgrade.uploadMultiplePages.description",{ns:"billing"})})]})},a8=function(){let[a,b]=(0,g.useState)(),[c,d]=(0,g.useState)(),[e,f]=(0,g.useState)(),h=(0,g.useCallback)(a=>{b(a)},[]),i=(0,g.useCallback)(()=>{b(void 0)},[]),j=(0,g.useCallback)(a=>{d(a)},[]),k=(0,g.useCallback)(()=>{d(void 0)},[]);return{currentFile:a,currentNotionPage:c,currentWebsite:e,showFilePreview:h,hideFilePreview:i,showNotionPagePreview:j,hideNotionPagePreview:k,showWebsitePreview:(0,g.useCallback)(a=>{f(a)},[]),hideWebsitePreview:(0,g.useCallback)(()=>{f(void 0)},[])}};var a9=a.i(377349);let ba={[o.DataSourceType.FILE]:({files:a})=>a.length>1,[o.DataSourceType.NOTION]:({notionPages:a})=>a.length>1,[o.DataSourceType.WEB]:({websitePages:a})=>a.length>1},bb=({datasetId:a,dataSourceType:b,dataSourceTypeDisable:c,changeType:d,onSetting:f,onStepChange:i,files:j,updateFileList:k,updateFile:m,notionPages:n=[],notionCredentialId:p,updateNotionPages:q,updateNotionCredentialId:r,websitePages:u=[],updateWebsitePages:v,onWebsiteCrawlProviderChange:w,onWebsiteCrawlJobIdChange:y,crawlOptions:z,onCrawlOptionsChange:A,authedDataSourceList:B})=>{let{t:C}=(0,h.useTranslation)(),E=(0,l.useDatasetDetailContextWithSelector)(a=>a.dataset),{plan:F,enableBilling:G}=(0,T.useProviderContext)(),{currentFile:H,currentNotionPage:I,currentWebsite:J,showFilePreview:K,hideFilePreview:L,showNotionPagePreview:M,hideNotionPagePreview:N,showWebsitePreview:O,hideWebsitePreview:P}=a8(),[U,{setTrue:V,setFalse:W}]=(0,t.useBoolean)(!1),[X,{setTrue:Y,setFalse:Z}]=(0,t.useBoolean)(!1),$=!a||a&&!E?.data_source_type,_=$?b??o.DataSourceType.FILE:E?.data_source_type??o.DataSourceType.FILE,aa=j.length>0&&j.every(a=>a.file.id),ac=n.length>0,ad=F.usage.vectorSpace>=F.total.vectorSpace,ae=(aa||ac)&&ad&&G,af=!G||F.type!==R.Plan.sandbox,ag=(0,g.useMemo)(()=>{let a;return!!((a=B.find(a=>"notion_datasource"===a.provider))&&a.credentials_list.length>0)},[B]),ah=(0,g.useMemo)(()=>B.find(a=>"notion_datasource"===a.provider)?.credentials_list||[],[B]),ai=(0,g.useMemo)(()=>!!(!j.length||j.some(a=>!a.file.id))||ae,[j,ae]),aj=(0,g.useCallback)(a=>{a!==o.DataSourceType.FILE&&L(),a!==o.DataSourceType.NOTION&&N(),a!==o.DataSourceType.WEB&&P()},[L,N,P]),ak=(0,g.useCallback)(()=>{if(!af&&_){let a=ba[_];if(a?.({files:j,notionPages:n,websitePages:u}))return void Y()}i()},[_,i,j,af,n,Y,u]);return(0,e.jsx)("div",{className:"h-full w-full overflow-x-auto",children:(0,e.jsxs)("div",{className:"flex h-full w-full min-w-[1440px]",children:[(0,e.jsx)("div",{className:"relative h-full w-1/2 overflow-y-auto",children:(0,e.jsxs)("div",{className:"flex justify-end",children:[(0,e.jsxs)("div",{className:(0,D.cn)(aX.default.form),children:[$&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:(0,D.cn)(aX.default.stepHeader,"system-md-semibold text-text-secondary"),children:C("steps.one",{ns:"datasetCreation"})}),(0,e.jsx)(aZ,{currentType:_,disabled:c,onChange:d,onClearPreviews:aj})]}),_===o.DataSourceType.FILE&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(al,{fileList:j,titleClassName:$?void 0:"mt-[30px] !mb-[44px] !text-lg",prepareFileList:k,onFileListUpdate:k,onFileUpdate:m,onPreview:K,supportBatchUpload:af}),ae&&(0,e.jsx)("div",{className:"mb-4 max-w-[640px]",children:(0,e.jsx)(S.default,{})}),(0,e.jsx)(a$,{disabled:ai,onClick:ak}),G&&F.type===R.Plan.sandbox&&j.length>0&&(0,e.jsxs)("div",{className:"mt-5",children:[(0,e.jsx)("div",{className:"mb-4 h-px bg-divider-subtle"}),(0,e.jsx)(a9.default,{})]})]}),_===o.DataSourceType.NOTION&&(0,e.jsxs)(e.Fragment,{children:[!ag&&(0,e.jsx)(x,{onSetting:f}),ag&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"mb-8 w-[640px]",children:(0,e.jsx)(Q,{value:n.map(a=>a.page_id),onSelect:q,onPreview:M,credentialList:ah,onSelectCredential:r,datasetId:a})}),ae&&(0,e.jsx)("div",{className:"mb-4 max-w-[640px]",children:(0,e.jsx)(S.default,{})}),(0,e.jsx)(a$,{disabled:ae||!n.length,onClick:ak})]})]}),_===o.DataSourceType.WEB&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:(0,D.cn)("mb-8 w-[640px]",!$&&"mt-12"),children:(0,e.jsx)(aW,{onPreview:O,checkedCrawlResult:u,onCheckedCrawlResultChange:v,onCrawlProviderChange:w,onJobIdChange:y,crawlOptions:z,onCrawlOptionsChange:A,authedDataSourceList:B})}),ae&&(0,e.jsx)("div",{className:"mb-4 max-w-[640px]",children:(0,e.jsx)(S.default,{})}),(0,e.jsx)(a$,{disabled:ae||!u.length,onClick:ak})]}),!a&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"my-8 h-px max-w-[640px] bg-divider-regular"}),(0,e.jsxs)("span",{className:"inline-flex cursor-pointer items-center text-[13px] leading-4 text-text-accent",onClick:V,children:[(0,e.jsx)(s.RiFolder6Line,{className:"mr-1 size-4"}),C("stepOne.emptyDatasetCreation",{ns:"datasetCreation"})]})]})]}),(0,e.jsx)(ab,{show:U,onHide:W})]})}),(0,e.jsx)(a7,{currentFile:H,currentNotionPage:I,currentWebsite:J,notionCredentialId:p,isShowPlanUpgradeModal:X,hideFilePreview:L,hideNotionPagePreview:N,hideWebsitePreview:P,hidePlanUpgradeModal:Z})]})})};var bc=a.i(355968),bd=a.i(585124),be=a.i(413192),bf=a.i(61500),bg=a.i(820051),bh=a.i(906055);let bi=["indexing","splitting","parsing","cleaning","waiting"],bj=({status:a,error:b})=>"completed"===a?(0,e.jsx)(s.RiCheckboxCircleFill,{className:"size-4 shrink-0 text-text-success"}):"error"===a?(0,e.jsx)(az.default,{popupClassName:"px-4 py-[14px] max-w-60 body-xs-regular text-text-secondary border-[0.5px] border-components-panel-border rounded-xl",offset:4,popupContent:b,children:(0,e.jsx)("span",{children:(0,e.jsx)(s.RiErrorWarningFill,{className:"size-4 shrink-0 text-text-destructive"})})}):null,bk=({sourceType:a,name:b,notionIcon:c})=>{if(a===o.DataSourceType.FILE)return(0,e.jsx)(ak.default,{size:"sm",className:"shrink-0",name:b,extension:b?.split(".").pop()||"txt"});return a===o.DataSourceType.NOTION?(0,e.jsx)(L.default,{className:"shrink-0",type:"page",src:c}):null},bl=({detail:a,name:b,sourceType:c,notionIcon:d,enableBilling:f})=>{let g,h,i=bi.includes(a.indexing_status),j=(g=a.completed_segments||0,0===(h=a.total_segments||0)?0:Math.min(Math.round(100*g/h),100)),k="error"===a.indexing_status;return(0,e.jsxs)("div",{className:(0,D.cn)("relative h-[26px] overflow-hidden rounded-md bg-components-progress-bar-bg",k&&"bg-state-destructive-hover-alt"),children:[i&&(0,e.jsx)("div",{className:"absolute left-0 top-0 h-full min-w-0.5 border-r-[2px] border-r-components-progress-bar-progress-highlight bg-components-progress-bar-progress",style:{width:`${j}%`}}),(0,e.jsxs)("div",{className:"z-[1] flex h-full items-center gap-1 pl-[6px] pr-2",children:[(0,e.jsx)(bk,{sourceType:c,name:b,notionIcon:d}),(0,e.jsxs)("div",{className:"flex w-0 grow items-center gap-1",title:b,children:[(0,e.jsx)("div",{className:"system-xs-medium truncate text-text-secondary",children:b}),f&&(0,e.jsx)(bh.default,{className:"ml-0"})]}),i&&(0,e.jsx)("div",{className:"shrink-0 text-xs text-text-secondary",children:`${j}%`}),(0,e.jsx)(bj,{status:a.indexing_status,error:a.error})]})]})};var bm=a.i(682541),bn=a.i(867385),bo=a.i(958887),bp=a.i(387799),bq=a.i(944054);let br={remove_extra_spaces:"stepTwo.removeExtraSpaces",remove_urls_emails:"stepTwo.removeUrlEmails",remove_stopwords:"stepTwo.removeStopwords"},bs={[aj.RETRIEVE_METHOD.fullText]:bo.retrievalIcon.fullText,[aj.RETRIEVE_METHOD.hybrid]:bo.retrievalIcon.hybrid,[aj.RETRIEVE_METHOD.semantic]:bo.retrievalIcon.vector,[aj.RETRIEVE_METHOD.invertedIndex]:bo.retrievalIcon.fullText,[aj.RETRIEVE_METHOD.keywordSearch]:bo.retrievalIcon.fullText},bt=({sourceData:a,indexingType:b,retrievalMethod:c})=>{let{t:d}=(0,h.useTranslation)(),f={mode:d("embedding.mode",{ns:"datasetDocuments"}),segmentLength:d("embedding.segmentLength",{ns:"datasetDocuments"}),textCleaning:d("embedding.textCleaning",{ns:"datasetDocuments"})},i=(0,g.useCallback)(a=>{let b=br[a];return b?d(b,{ns:"datasetCreation"}):void 0},[d]),j={mode:(0,g.useCallback)(()=>{if(!a?.mode)return"-";if(a.mode===o.ProcessMode.general)return d("embedding.custom",{ns:"datasetDocuments"});let b=a.rules?.parent_mode==="paragraph"?d("parentMode.paragraph",{ns:"dataset"}):d("parentMode.fullDoc",{ns:"dataset"});return`${d("embedding.hierarchical",{ns:"datasetDocuments"})} \xb7 ${b}`},[a,d]),segmentLength:(0,g.useCallback)(()=>{if(!a?.mode)return"-";let b="number"==typeof a.rules?.segmentation?.max_tokens?a.rules.segmentation.max_tokens:"-";if(a.mode===o.ProcessMode.general)return b;let c="number"==typeof a.rules?.subchunk_segmentation?.max_tokens?a.rules.subchunk_segmentation.max_tokens:"-";return`${d("embedding.parentMaxTokens",{ns:"datasetDocuments"})} ${b}; ${d("embedding.childMaxTokens",{ns:"datasetDocuments"})} ${c}`},[a,d]),textCleaning:(0,g.useCallback)(()=>{if(!a?.mode)return"-";let b=(a.rules?.pre_processing_rules?.filter(a=>a.enabled)||[]).map(a=>{let b=i(a.id);return"string"==typeof b?b:""}).filter(a=>a);return b.length>0?b.join(","):"-"},[a,i])},k=b===bq.IndexingType.ECONOMICAL,l=k?bo.indexMethodIcon.economical:bo.indexMethodIcon.high_quality,m=d(`stepTwo.${k?"economical":"qualified"}`,{ns:"datasetCreation"}),n=d(`retrieval.${k?"keyword_search":c??"semantic_search"}.title`,{ns:"dataset"}),p=bs[c]??bo.retrievalIcon.vector;return(0,e.jsxs)("div",{className:"flex flex-col gap-1",children:[Object.keys(f).map(a=>(0,e.jsx)(bn.FieldInfo,{label:f[a],displayedValue:String(j[a]())},a)),(0,e.jsx)(bn.FieldInfo,{label:d("stepTwo.indexMode",{ns:"datasetCreation"}),displayedValue:m,valueIcon:(0,e.jsx)(bm.default,{className:"size-4",src:l,alt:""})}),(0,e.jsx)(bn.FieldInfo,{label:d("form.retrievalSetting.title",{ns:"datasetSettings"}),displayedValue:n,valueIcon:(0,e.jsx)(bm.default,{className:"size-4",src:p,alt:""})})]})};a.i(658335);var bu=a.i(581127),bu=bu,bv=a.i(747104);let bw=()=>{let{t:a}=(0,h.useTranslation)();return(0,e.jsxs)("div",{className:"flex h-14 items-center rounded-xl border-[0.5px] border-black/5 bg-white p-3 shadow-md",children:[(0,e.jsx)("div",{className:"flex h-8 w-8 shrink-0 items-center justify-center rounded-lg bg-[#FFF6ED]",children:(0,e.jsx)(bu.default,{className:"h-4 w-4 text-[#FB6514]"})}),(0,e.jsx)("div",{className:"mx-3 grow text-[13px] font-medium text-gray-700",children:a("plansCommon.documentProcessingPriorityUpgrade",{ns:"billing"})}),(0,e.jsx)(bv.default,{loc:"knowledge-speed-up"})]})},bx=["completed","error","paused"],by=["indexing","splitting","parsing","cleaning","waiting"],bz=a=>a.every(a=>{let b;return b=a.indexing_status,bx.includes(b)}),bA=({isEmbedding:a,isCompleted:b})=>{let{t:c}=(0,h.useTranslation)();return(0,e.jsxs)("div",{className:"system-md-semibold-uppercase flex items-center gap-x-1 text-text-secondary",children:[a&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(s.RiLoader2Fill,{className:"size-4 animate-spin"}),(0,e.jsx)("span",{children:c("embedding.processing",{ns:"datasetDocuments"})})]}),b&&c("embedding.completed",{ns:"datasetDocuments"})]})},bB=({apiReferenceUrl:a,onNavToDocuments:b})=>{let{t:c}=(0,h.useTranslation)();return(0,e.jsxs)("div",{className:"mt-6 flex items-center gap-x-2 py-2",children:[(0,e.jsx)(be.default,{href:a,target:"_blank",rel:"noopener noreferrer",children:(0,e.jsxs)(u.default,{className:"w-fit gap-x-0.5 px-3",children:[(0,e.jsx)(s.RiTerminalBoxLine,{className:"size-4"}),(0,e.jsx)("span",{className:"px-0.5",children:"Access the API"})]})}),(0,e.jsxs)(u.default,{className:"w-fit gap-x-0.5 px-3",variant:"primary",onClick:b,children:[(0,e.jsx)("span",{className:"px-0.5",children:c("stepThree.navTo",{ns:"datasetCreation"})}),(0,e.jsx)(s.RiArrowRightLine,{className:"size-4 stroke-current stroke-1"})]})]})},bC=({datasetId:a,batchId:b,documents:c=[],indexingType:d,retrievalMethod:f})=>{let{enableBilling:h,plan:i}=(0,T.useProviderContext)(),j=(0,U.useRouter)(),k=(0,bg.useInvalidDocumentList)(),l=(0,bf.useDatasetApiAccessUrl)(),{statusList:m,isEmbedding:n,isEmbeddingCompleted:o}=(({datasetId:a,batchId:b})=>{let[c,d]=(0,g.useState)([]),e=(0,g.useRef)(!1);(0,g.useEffect)(()=>{e.current=!1;let c=null,f=async()=>{let c=await (0,$.fetchIndexingStatusBatch)({datasetId:a,batchId:b});return d(c.data),c.data},g=async()=>{if(!e.current){try{let a=await f();if(bz(a)){e.current=!0;return}}catch{}e.current||(c=setTimeout(()=>{g()},2500))}};return g(),()=>{e.current=!0,c&&clearTimeout(c)}},[a,b]);let f=c.some(a=>by.includes(a?.indexing_status)),h=c.length>0&&bz(c);return{statusList:c,isEmbedding:f,isEmbeddingCompleted:h}})({datasetId:a,batchId:b}),p=c[0]?.id,{data:q}=(0,_.useProcessRule)(p),r=(0,g.useMemo)(()=>{let a;return a=new Map(c.map(a=>[a.id,a])),{getDocument:b=>a.get(b),getName:b=>a.get(b)?.name,getSourceType:b=>a.get(b)?.data_source_type,getNotionIcon:b=>{let c=a.get(b)?.data_source_info;if(c&&null!=c&&"object"==typeof c.upload_file)return c.notion_page_icon}}},[c]),s=h&&i.type!==R.Plan.team;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"flex flex-col gap-y-3",children:[(0,e.jsx)(bA,{isEmbedding:n,isCompleted:o}),s&&(0,e.jsx)(bw,{}),(0,e.jsx)("div",{className:"flex flex-col gap-0.5 pb-2",children:m.map(a=>(0,e.jsx)(bl,{detail:a,name:r.getName(a.id),sourceType:r.getSourceType(a.id),notionIcon:r.getNotionIcon(a.id),enableBilling:h},a.id))}),(0,e.jsx)(C.default,{type:"horizontal",className:"my-0 bg-divider-subtle"}),(0,e.jsx)(bt,{sourceData:q,indexingType:d,retrievalMethod:f})]}),(0,e.jsx)(bB,{apiReferenceUrl:l,onNavToDocuments:()=>{k(),j.push(`/datasets/${a}/documents`)}})]})},bD=({datasetId:a,datasetName:b,indexingType:c,creationCache:d,retrievalMethod:f})=>{let{t:g}=(0,h.useTranslation)(),i=(0,af.useDocLink)(),j=(0,bd.default)()===bd.MediaType.mobile,k=d?.dataset?.icon_info||{icon:"ðŸ“™",icon_type:"emoji",icon_background:"#FFF4ED",icon_url:""};return(0,e.jsxs)("div",{className:"flex h-full max-h-full w-full justify-center overflow-y-auto",children:[(0,e.jsx)("div",{className:"h-full max-w-[960px] shrink-0 grow overflow-y-auto px-14 sm:px-16",children:(0,e.jsxs)("div",{className:"mx-auto max-w-[640px] pb-8 pt-10",children:[!a&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"flex flex-col gap-y-1 pb-3",children:[(0,e.jsx)("div",{className:"title-2xl-semi-bold text-text-primary",children:g("stepThree.creationTitle",{ns:"datasetCreation"})}),(0,e.jsx)("div",{className:"system-sm-regular text-text-tertiary",children:g("stepThree.creationContent",{ns:"datasetCreation"})})]}),(0,e.jsxs)("div",{className:"flex items-center gap-x-4",children:[(0,e.jsx)(bc.default,{size:"xxl",iconType:k.icon_type,icon:k.icon,background:k.icon_background,imageUrl:k.icon_url,className:"shrink-0"}),(0,e.jsxs)("div",{className:"flex grow flex-col gap-y-1",children:[(0,e.jsx)("div",{className:"system-sm-semibold flex h-6 items-center text-text-secondary",children:g("stepThree.label",{ns:"datasetCreation"})}),(0,e.jsx)("div",{className:"system-sm-regular w-full truncate rounded-lg bg-components-input-bg-normal p-2 text-components-input-text-filled",children:(0,e.jsx)("span",{className:"px-1",children:b||d?.dataset?.name})})]})]}),(0,e.jsx)(C.default,{type:"horizontal",className:"my-6 bg-divider-subtle"})]}),a&&(0,e.jsxs)("div",{className:"flex flex-col gap-y-1 pb-3",children:[(0,e.jsx)("div",{className:"title-2xl-semi-bold text-text-primary",children:g("stepThree.additionTitle",{ns:"datasetCreation"})}),(0,e.jsx)("div",{className:"system-sm-regular text-text-tertiary",children:`${g("stepThree.additionP1",{ns:"datasetCreation"})} ${b||d?.dataset?.name} ${g("stepThree.additionP2",{ns:"datasetCreation"})}`})]}),(0,e.jsx)(bC,{datasetId:a||d?.dataset?.id||"",batchId:d?.batch||"",documents:d?.documents,indexingType:d?.dataset?.indexing_technique||c,retrievalMethod:d?.dataset?.retrieval_model_dict?.search_method||f})]})}),!j&&(0,e.jsx)("div",{className:"shrink-0 pr-8 pt-[88px] text-xs",children:(0,e.jsxs)("div",{className:"flex w-[328px] flex-col gap-3 rounded-xl bg-background-section p-6 text-text-tertiary",children:[(0,e.jsx)("div",{className:"flex size-10 items-center justify-center rounded-[10px] bg-components-card-bg shadow-lg",children:(0,e.jsx)(s.RiBookOpenLine,{className:"size-5 text-text-accent"})}),(0,e.jsx)("div",{className:"text-base font-semibold text-text-secondary",children:g("stepThree.sideTipTitle",{ns:"datasetCreation"})}),(0,e.jsx)("div",{className:"text-text-tertiary",children:g("stepThree.sideTipContent",{ns:"datasetCreation"})}),(0,e.jsx)("a",{href:i("/use-dify/knowledge/integrate-knowledge-within-application"),target:"_blank",rel:"noreferrer noopener",className:"system-sm-regular text-text-accent",children:g("addDocuments.stepThree.learnMore",{ns:"datasetPipeline"})})]})})]})},bE=a=>{let{name:b,activeIndex:c,index:d}=a,f=d===c,g=c<d,h=f?`STEP ${d+1}`:`${d+1}`;return(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)("div",{className:(0,D.cn)("inline-flex h-5 flex-col items-center justify-center gap-2 rounded-3xl py-1",f?"bg-state-accent-solid px-2":g?"w-5 border border-divider-deep":"w-5 border border-text-quaternary"),children:(0,e.jsx)("div",{className:(0,D.cn)("system-2xs-semibold-uppercase text-center",f?"text-text-primary-on-surface":g?"text-text-quaternary":"text-text-tertiary"),children:h})}),(0,e.jsx)("div",{className:(0,D.cn)("system-xs-medium-uppercase",f?"system-xs-semibold-uppercase text-text-accent":g?"text-text-quaternary":"text-text-tertiary"),children:b})]})},bF=a=>{let{steps:b,activeIndex:c}=a;return(0,e.jsx)("div",{className:"flex items-center gap-3",children:b.map((a,d)=>{let f=d===b.length-1;return(0,e.jsxs)(g.Fragment,{children:[(0,e.jsx)(bE,{...a,activeIndex:c,index:d}),!f&&(0,e.jsx)("div",{className:"h-px w-4 bg-divider-deep"})]},d)})})},bG={1:"steps.one",2:"steps.two",3:"steps.three"},bH=a=>{let{className:b,datasetId:c,...d}=a,{t:f}=(0,h.useTranslation)(),i=(0,g.useMemo)(()=>c?`/datasets/${c}/documents`:"/datasets",[c]);return(0,e.jsxs)("div",{className:(0,D.cn)("relative flex h-[52px] shrink-0 items-center justify-between border-b border-b-divider-subtle",b),children:[(0,e.jsxs)(be.default,{href:i,replace:!0,className:"inline-flex h-12 items-center justify-start gap-1 py-2 pl-2 pr-6",children:[(0,e.jsx)("div",{className:"p-2",children:(0,e.jsx)(s.RiArrowLeftLine,{className:"size-4 text-text-primary"})}),(0,e.jsx)("p",{className:"system-sm-semibold-uppercase text-text-primary",children:f("steps.header.fallbackRoute",{ns:"datasetCreation"})})]}),(0,e.jsx)("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:(0,e.jsx)(bF,{steps:Array.from({length:3},(a,b)=>({name:f(bG[b+1],{ns:"datasetCreation"})})),...d})})]})},bI={crawl_sub_pages:!0,only_main_content:!0,includes:"",excludes:"",limit:10,max_depth:"",use_sitemap:!0};a.s(["default",0,({datasetId:a})=>{let{t:b}=(0,h.useTranslation)(),c=(0,m.useModalContextSelector)(a=>a.setShowAccountSettingModal),d=(0,l.useDatasetDetailContextWithSelector)(a=>a.dataset),{data:s}=(0,k.useDefaultModel)(r.ModelTypeEnum.textEmbedding),[t,u]=(0,g.useState)(o.DataSourceType.FILE),[v,w]=(0,g.useState)(1),[x,y]=(0,g.useState)(""),[z,A]=(0,g.useState)(""),[B,C]=(0,g.useState)([]),[D,E]=(0,g.useState)(),[F,G]=(0,g.useState)([]),[H,I]=(0,g.useState)(""),[J,K]=(0,g.useState)([]),[L,M]=(0,g.useState)(bI),[N,O]=(0,g.useState)(n.DataSourceProvider.jinaReader),[P,Q]=(0,g.useState)(""),{data:R,isLoading:S,isError:T}=(0,p.useGetDefaultDataSourceListAuth)(),U=(0,g.useCallback)(a=>{G(a)},[]),V=(0,g.useCallback)(a=>{I(a)},[]),W=(0,g.useCallback)(a=>{C(a)},[]),X=(0,g.useCallback)((a,b,c)=>{let d=c.findIndex(b=>b.fileID===a.fileID);C((0,f.produce)(c,a=>{a[d]={...a[d],progress:b}}))},[]),Y=(0,g.useCallback)(a=>{y(a)},[]),Z=(0,g.useCallback)(a=>{E(a)},[]),$=(0,g.useCallback)(a=>{A(a)},[]),_=(0,g.useCallback)(()=>{w(v+1)},[v,w]),aa=(0,g.useCallback)(a=>{w(v+a)},[v,w]);return T?(0,e.jsx)(q.default,{code:500,unknownReason:b("error.unavailable",{ns:"datasetCreation"})}):(0,e.jsxs)("div",{className:"flex flex-col overflow-hidden bg-components-panel-bg",style:{height:"calc(100vh - 56px)"},children:[(0,e.jsx)(bH,{activeIndex:v-1,datasetId:a}),(0,e.jsxs)("div",{style:{height:"calc(100% - 52px)"},children:[S&&(0,e.jsx)(i.default,{type:"app"}),!S&&(0,e.jsxs)(e.Fragment,{children:[1===v&&(0,e.jsx)(bb,{authedDataSourceList:R?.result||[],onSetting:()=>c({payload:j.ACCOUNT_SETTING_TAB.DATA_SOURCE}),datasetId:a,dataSourceType:t,dataSourceTypeDisable:!!d?.data_source_type,changeType:u,files:B,updateFile:X,updateFileList:W,notionPages:F,notionCredentialId:H,updateNotionPages:U,updateNotionCredentialId:V,onStepChange:_,websitePages:J,updateWebsitePages:K,onWebsiteCrawlProviderChange:O,onWebsiteCrawlJobIdChange:Q,crawlOptions:L,onCrawlOptionsChange:M}),2===v&&(!a||a&&!!d)&&(0,e.jsx)(bp.default,{isAPIKeySet:!!s,onSetting:()=>c({payload:j.ACCOUNT_SETTING_TAB.PROVIDER}),indexingType:d?.indexing_technique,datasetId:a,dataSourceType:t,files:B.map(a=>a.file),notionPages:F,notionCredentialId:H,websitePages:J,websiteCrawlProvider:N,websiteCrawlJobId:P,onStepChange:aa,updateIndexingTypeCache:Y,updateRetrievalMethodCache:$,updateResultCache:Z,crawlOptions:L}),3===v&&(0,e.jsx)(bD,{datasetId:a,datasetName:d?.name,indexingType:d?.indexing_technique||x,retrievalMethod:d?.retrieval_model_dict?.search_method||z||void 0,creationCache:D})]})]})]})}],168132)}];

//# sourceMappingURL=app_components_datasets_create_7adab680._.js.map
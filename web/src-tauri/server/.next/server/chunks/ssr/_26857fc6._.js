module.exports=[28981,(a,b,c)=>{let d=/[ .,;!?'‘’“”\-–—]+$/;b.exports=function(a,b,c){a.style.cssText+="overflow:hidden;overflow-wrap:break-word;word-wrap:break-word";let e=(b||1)*parseInt(window.getComputedStyle(a).lineHeight,10);return!(a.scrollHeight<=e)&&function a(b,c,e,f){let g=b.childNodes,h=g.length-1;for(;h>-1;){let i=g[h--];if(1===i.nodeType&&a(i,c,e,f)||3===i.nodeType&&function(a,b,c,e){let f,g=a.textContent;for(;g.length>1&&-1!==(f=g.lastIndexOf(" "));){if(a.textContent=g.substring(0,f),b.scrollHeight<=c){a.textContent=g;break}g=a.textContent}return function(a,b,c,e){let f=a.textContent,g=f.length;for(;g>1;)if(g=(f=f.substring(0,g-1).replace(d,"")).length,a.textContent=f+e,b.scrollHeight<=c)return!0;return!1}(a,b,c,e)}(i,c,e,f))return!0;b.removeChild(i)}return!1}(a,a,e,c&&c.ellipsis||"…")}},91199,a=>{a.v({layoutRightIcon:"style-module__ZLeS9G__layoutRightIcon",titleIcon:"style-module__ZLeS9G__titleIcon"})},944191,a=>{"use strict";var b,c=a.i(608061),d=a.i(429150),e=a.i(533306),f=a.i(57843);a.i(752298);var g=a.i(693025),h=a.i(757801),i=a.i(136156),j=a.i(105249),k=a.i(114715),l=a.i(909795),m=a.i(527344),n=a.i(516793),o=a.i(698636),p=a.i(710504),q=a.i(585447),r=a.i(803506),s=a.i(820703),t=a.i(483664),u=a.i(98654),v=a.i(127349),w=a.i(625963),x=a.i(220809);let y=f.memo(({label:a,children:b})=>(0,c.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,c.jsx)("div",{className:"system-xs-medium w-[128px] shrink-0 items-center truncate py-1 text-text-tertiary",children:a}),(0,c.jsx)("div",{className:"w-[244px] shrink-0",children:b})]})),z=f.memo(({dataSetId:a,className:b,noHeader:f,title:i,uppercaseTitle:j=!0,titleTooltip:k,headerRight:l,contentClassName:n,list:o,isEdit:p,onChange:q,onDelete:s,onSelect:z,onAdd:A})=>{let B=(0,e.useRouter)(),{t:C}=(0,g.useTranslation)(),{formatTime:D}=(0,u.default)();return(0,c.jsxs)("div",{className:(0,m.cn)(b),children:[!f&&(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,c.jsx)("div",{className:(0,m.cn)("text-text-secondary",j?"system-xs-semibold-uppercase":"system-md-semibold"),children:i}),k&&(0,c.jsx)(t.default,{popupContent:(0,c.jsx)("div",{className:"max-w-[240px]",children:k}),children:(0,c.jsx)("div",{children:(0,c.jsx)(d.RiQuestionLine,{className:"size-3.5 text-text-tertiary"})})})]}),l]}),(0,c.jsxs)("div",{className:(0,m.cn)("mt-3 space-y-1",n),children:[p&&(0,c.jsxs)("div",{children:[(0,c.jsx)(x.default,{datasetId:a,trigger:(0,c.jsx)(v.default,{}),onSelect:a=>z?.(a),onSave:a=>A?.(a),onManage:()=>{localStorage.setItem(r.isShowManageMetadataLocalStorageKey,"true"),B.push(`/datasets/${a}/documents`)}}),o.length>0&&(0,c.jsx)(h.default,{className:"my-3 ",bgStyle:"gradient"})]}),o.map((a,b)=>(0,c.jsx)(y,{label:a.name,children:p?(0,c.jsxs)("div",{className:"flex items-center space-x-0.5",children:[(0,c.jsx)(w.default,{className:"h-6",type:a.type,value:a.value,onChange:b=>q?.({...a,value:b})}),(0,c.jsx)("div",{className:"shrink-0 cursor-pointer rounded-md p-1  text-text-tertiary hover:bg-state-destructive-hover hover:text-text-destructive",children:(0,c.jsx)(d.RiDeleteBinLine,{className:"size-4",onClick:()=>s?.(a)})})]}):(0,c.jsx)("div",{className:"system-xs-regular py-1 text-text-secondary",children:a.value&&a.type===r.DataType.time?D(a.value,C("metadata.dateTimeFormat",{ns:"datasetDocuments"})):a.value})},a.id&&"built-in"!==a.id?a.id:`${b}`))]})]})}),A=f.memo(({onStart:a})=>{let{t:b}=(0,g.useTranslation)();return(0,c.jsxs)("div",{className:"rounded-xl bg-gradient-to-r from-workflow-workflow-progress-bg-1 to-workflow-workflow-progress-bg-2 p-4 pt-3",children:[(0,c.jsx)("div",{className:"text-xs font-semibold leading-5 text-text-secondary",children:b("metadata.metadata",{ns:"dataset"})}),(0,c.jsx)("div",{className:"system-xs-regular mt-1 text-text-tertiary",children:b("metadata.documentMetadata.metadataToolTip",{ns:"dataset"})}),(0,c.jsxs)(l.default,{variant:"primary",className:"mt-2",onClick:a,children:[(0,c.jsx)("div",{children:b("metadata.documentMetadata.startLabeling",{ns:"dataset"})}),(0,c.jsx)(d.RiArrowRightLine,{className:"ml-1 size-4"})]})]})}),B="metadata.documentMetadata",C=f.memo(({datasetId:a,documentId:b,className:e,docDetail:i})=>{let{t:j}=(0,g.useTranslation)(),{embeddingAvailable:t,isEdit:u,setIsEdit:v,list:w,tempList:x,setTempList:y,handleSelectMetaData:C,handleAddMetaData:D,hasData:E,builtList:F,builtInEnabled:G,startToEdit:H,handleSave:I,handleCancel:J,originInfo:K,technicalParameters:L}=(({datasetId:a,documentId:b,docDetail:c})=>{let{t:d}=(0,g.useTranslation)(),{dataset:e}=(0,o.useDatasetDetailContext)(),h=!!e?.embedding_available,{mutateAsync:i}=(0,q.useBatchUpdateDocMetadata)(),{checkName:j}=(0,s.default)(),[l,m]=(0,f.useState)(!1),{data:t}=(0,q.useDocumentMetaData)({datasetId:a,documentId:b}),u=t?.doc_metadata||[],v=u.filter(a=>"built-in"!==a.id),w=u.filter(a=>"built-in"===a.id),[x,y]=(0,f.useState)(v),{mutateAsync:z}=(0,q.useCreateMetaData)(a),A=(0,f.useCallback)(a=>{y(b=>-1===b.findIndex(b=>b.id===a.id)?[...b,a]:b)},[]),B=(0,f.useCallback)(async a=>{let b=j(a.name).errorMsg;if(b)return k.default.notify({message:b,type:"error"}),Promise.reject(Error(b));await z(a),k.default.notify({type:"success",message:d("api.actionSuccess",{ns:"common"})})},[j,z,d]),C=v.length>0,D=async()=>{await i({dataset_id:a,metadata_list:[{document_id:b,metadata_list:x}]}),m(!1),k.default.notify({type:"success",message:d("api.actionSuccess",{ns:"common"})})},{data:E}=(0,q.useDatasetMetaData)(a),F=E?.built_in_field_enabled,G=(0,p.useMetadataMap)(),H=(0,p.useLanguages)(),I=a=>{let b=G[a]?.subFieldsMap;return Object.keys(b).map(a=>{var d;let e,f=b[a];return{id:f?.label,type:r.DataType.string,name:f?.label,value:(d=a,(e=(0,n.get)(c,d,""))||0===e?b[d]?.inputType==="select"?("language"===d?H:{})[e]:b[d]?.render?b[d]?.render?.(e,"hit_count"===d?(0,n.get)(c,"segment_count",0):void 0):e:"-")}})};return{embeddingAvailable:h,isEdit:l,setIsEdit:m,list:v,tempList:x,setTempList:y,handleSelectMetaData:A,handleAddMetaData:B,hasData:C,builtList:w,builtInEnabled:F,startToEdit:()=>{y(v),m(!0)},handleSave:D,handleCancel:()=>{y(v),m(!1)},originInfo:I("originInfo"),technicalParameters:I("technicalParameters")}})({datasetId:a,documentId:b,docDetail:i});return(0,c.jsxs)("div",{className:(0,m.cn)("w-[388px] space-y-4",e),children:[E||u?(0,c.jsx)("div",{className:"pl-2",children:(0,c.jsx)(z,{title:j("metadata.metadata",{ns:"dataset"}),uppercaseTitle:!1,titleTooltip:j(`${B}.metadataToolTip`,{ns:"dataset"}),list:u?x:w,dataSetId:a,headerRight:t&&(u?(0,c.jsxs)("div",{className:"flex space-x-1",children:[(0,c.jsx)(l.default,{variant:"ghost",size:"small",onClick:J,children:(0,c.jsx)("div",{children:j("operation.cancel",{ns:"common"})})}),(0,c.jsx)(l.default,{variant:"primary",size:"small",onClick:I,children:(0,c.jsx)("div",{children:j("operation.save",{ns:"common"})})})]}):(0,c.jsxs)(l.default,{variant:"ghost",size:"small",onClick:H,children:[(0,c.jsx)(d.RiEditLine,{className:"mr-1 size-3.5 cursor-pointer text-text-tertiary"}),(0,c.jsx)("div",{children:j("operation.edit",{ns:"common"})})]})),isEdit:u,contentClassName:"mt-5",onChange:a=>{y(x.map(b=>b.name===a.name?a:b))},onDelete:a=>{y(x.filter(b=>b.name!==a.name))},onAdd:D,onSelect:C})}):t&&(0,c.jsx)(A,{onStart:()=>v(!0)}),G&&(0,c.jsxs)("div",{className:"pl-2",children:[(0,c.jsx)(h.default,{className:"my-3",bgStyle:"gradient"}),(0,c.jsx)(z,{noHeader:!0,titleTooltip:"Built-in metadata is system-generated metadata that is automatically added to the document. You can enable or disable built-in metadata here.",list:F,dataSetId:a})]}),(0,c.jsx)(z,{className:"pl-2",title:j(`${B}.documentInformation`,{ns:"dataset"}),list:K,dataSetId:a}),(0,c.jsx)(z,{className:"pl-2",title:j(`${B}.technicalParameters`,{ns:"dataset"}),list:L,dataSetId:a})]})});var D=a.i(585124),E=a.i(986431),F=a.i(820051),G=a.i(470759),H=a.i(425282),I=a.i(380794),J=a.i(322927),K=a.i(111089),L=a.i(940272),M=a.i(240928);a.i(658335);var N=a.i(350295),O=a.i(252813),P=a.i(136403);let Q=[["question","answer"],["question1","answer1"],["question2","answer2"]],R=[["问题","答案"],["问题 1","答案 1"],["问题 2","答案 2"]],S=[["segment content"],["content1"],["content2"]],T=[["分段内容"],["内容 1"],["内容 2"]],U=f.memo(({docForm:a})=>{let{t:b}=(0,g.useTranslation)(),d=(0,O.useLocale)(),{CSVDownloader:e,Type:f}=(0,M.useCSVDownloader)();return(0,c.jsxs)("div",{className:"mt-6",children:[(0,c.jsx)("div",{className:"text-sm font-medium text-text-primary",children:b("generation.csvStructureTitle",{ns:"share"})}),(0,c.jsxs)("div",{className:"mt-2 max-h-[500px] overflow-auto",children:[a===E.ChunkingMode.qa&&(0,c.jsxs)("table",{className:"w-full table-fixed border-separate border-spacing-0 rounded-lg border border-divider-subtle text-xs",children:[(0,c.jsx)("thead",{className:"text-text-secondary",children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("td",{className:"h-9 border-b border-divider-subtle pl-3 pr-2",children:b("list.batchModal.question",{ns:"datasetDocuments"})}),(0,c.jsx)("td",{className:"h-9 border-b border-divider-subtle pl-3 pr-2",children:b("list.batchModal.answer",{ns:"datasetDocuments"})})]})}),(0,c.jsxs)("tbody",{className:"text-text-tertiary",children:[(0,c.jsxs)("tr",{children:[(0,c.jsxs)("td",{className:"h-9 border-b border-divider-subtle pl-3 pr-2 text-[13px]",children:[b("list.batchModal.question",{ns:"datasetDocuments"})," ","1"]}),(0,c.jsxs)("td",{className:"h-9 border-b border-divider-subtle pl-3 pr-2 text-[13px]",children:[b("list.batchModal.answer",{ns:"datasetDocuments"})," ","1"]})]}),(0,c.jsxs)("tr",{children:[(0,c.jsxs)("td",{className:"h-9 pl-3 pr-2 text-[13px]",children:[b("list.batchModal.question",{ns:"datasetDocuments"})," ","2"]}),(0,c.jsxs)("td",{className:"h-9 pl-3 pr-2 text-[13px]",children:[b("list.batchModal.answer",{ns:"datasetDocuments"})," ","2"]})]})]})]}),a===E.ChunkingMode.text&&(0,c.jsxs)("table",{className:"w-full table-fixed border-separate border-spacing-0 rounded-lg border border-divider-subtle text-xs",children:[(0,c.jsx)("thead",{className:"text-text-secondary",children:(0,c.jsx)("tr",{children:(0,c.jsx)("td",{className:"h-9 border-b border-divider-subtle pl-3 pr-2",children:b("list.batchModal.contentTitle",{ns:"datasetDocuments"})})})}),(0,c.jsxs)("tbody",{className:"text-text-tertiary",children:[(0,c.jsx)("tr",{children:(0,c.jsxs)("td",{className:"h-9 border-b border-divider-subtle pl-3 pr-2 text-[13px]",children:[b("list.batchModal.content",{ns:"datasetDocuments"})," ","1"]})}),(0,c.jsx)("tr",{children:(0,c.jsxs)("td",{className:"h-9 pl-3 pr-2 text-[13px]",children:[b("list.batchModal.content",{ns:"datasetDocuments"})," ","2"]})})]})]})]}),(0,c.jsx)(e,{className:"mt-2 block cursor-pointer",type:f.Link,filename:"template",bom:!0,data:d===P.LanguagesSupported[1]?a===E.ChunkingMode.qa?R:T:a===E.ChunkingMode.qa?Q:S,children:(0,c.jsxs)("div",{className:"flex h-[18px] items-center space-x-1 text-xs font-medium text-text-accent",children:[(0,c.jsx)(N.Download02,{className:"mr-1 h-3 w-3"}),b("list.batchModal.template",{ns:"datasetDocuments"})]})})]})});var V=a.i(639378),W=a.i(818386);a.i(836482);var X=a.i(979492),Y=a.i(971748),Z=a.i(730357),$=a.i(41511),_=a.i(763539),aa=a.i(954200);let ab=f.memo(({file:a,updateFile:b})=>{let{t:e}=(0,g.useTranslation)(),{notify:h}=(0,V.useContext)(k.ToastContext),[i,j]=(0,f.useState)(!1),n=(0,f.useRef)(null),o=(0,f.useRef)(null),p=(0,f.useRef)(null),{data:q}=(0,_.useFileUploadConfig)(),r=(0,f.useMemo)(()=>q??{file_size_limit:15},[q]),s=(0,f.useCallback)(async a=>{a.progress=0;let c=new FormData;return c.append("file",a.file),(0,$.upload)({xhr:new XMLHttpRequest,data:c,onprogress:c=>{if(c.lengthComputable){let d=Math.floor(c.loaded/c.total*100);b({...a,progress:d})}}},!1,void 0,"?source=datasets").then(c=>{let d=Object.assign({},a.file,{id:c.id,...c}),e={fileID:a.fileID,file:d,progress:100};return b(e),Promise.resolve({...e})}).catch(c=>{h({type:"error",message:(0,W.getFileUploadErrorMessage)(c,e("stepOne.uploader.failed",{ns:"datasetCreation"}),e)});let d={...a,progress:-2};return b(d),Promise.resolve({...d})}).finally()},[h,e,b]),t=(0,f.useCallback)(async a=>{await s(a)},[s]),u=(0,f.useCallback)(a=>{if(!a)return!1;let c={fileID:`file0-${Date.now()}`,file:a,progress:-1};b(c),t(c)},[b,t]),v=a=>{a.preventDefault(),a.stopPropagation(),a.target!==o.current&&j(!0)},w=a=>{a.preventDefault(),a.stopPropagation()},x=a=>{a.preventDefault(),a.stopPropagation(),a.target===o.current&&j(!1)},y=a=>{if(a.preventDefault(),a.stopPropagation(),j(!1),!a.dataTransfer)return;let b=Array.from(a.dataTransfer.files);b.length>1?h({type:"error",message:e("stepOne.uploader.validation.count",{ns:"datasetCreation"})}):u(b[0])},z=()=>{p.current&&p.current.click()},A=(0,f.useCallback)(a=>{if(!a)return!1;let{size:b}=a,c=".csv"===`.${(a=>{if(!a)return"";let b=a.name.split(".");return b[b.length-1]})(a)}`.toLowerCase();c||h({type:"error",message:e("stepOne.uploader.validation.typeError",{ns:"datasetCreation"})});let d=b<=1024*r.file_size_limit*1024;return d||h({type:"error",message:e("stepOne.uploader.validation.size",{ns:"datasetCreation",size:r.file_size_limit})}),c&&d},[r,h,e]),{theme:B}=(0,Z.default)(),C=(0,f.useMemo)(()=>B===aa.Theme.dark?"#5289ff":"#296dff",[B]);return(0,f.useEffect)(()=>(n.current?.addEventListener("dragenter",v),n.current?.addEventListener("dragover",w),n.current?.addEventListener("dragleave",x),n.current?.addEventListener("drop",y),()=>{n.current?.removeEventListener("dragenter",v),n.current?.removeEventListener("dragover",w),n.current?.removeEventListener("dragleave",x),n.current?.removeEventListener("drop",y)}),[]),(0,c.jsxs)("div",{className:"mt-6",children:[(0,c.jsx)("input",{ref:p,style:{display:"none"},type:"file",id:"fileUploader",accept:".csv",onChange:a=>{let b=a.target.files?.[0];A(b)&&u(b)}}),(0,c.jsxs)("div",{ref:n,children:[!a&&(0,c.jsxs)("div",{className:(0,m.cn)("flex h-20 items-center rounded-xl border border-dashed border-components-panel-border bg-components-panel-bg-blur text-sm font-normal",i&&"border border-divider-subtle  bg-components-panel-on-panel-item-bg-hover"),children:[(0,c.jsxs)("div",{className:"flex w-full items-center justify-center space-x-2",children:[(0,c.jsx)(X.Csv,{className:"shrink-0"}),(0,c.jsxs)("div",{className:"text-text-secondary",children:[e("list.batchModal.csvUploadTitle",{ns:"datasetDocuments"}),(0,c.jsx)("span",{className:"cursor-pointer text-text-accent",onClick:z,children:e("list.batchModal.browse",{ns:"datasetDocuments"})})]})]}),i&&(0,c.jsx)("div",{ref:o,className:"absolute left-0 top-0 h-full w-full"})]}),a&&(0,c.jsxs)("div",{className:(0,m.cn)("group flex h-20 items-center rounded-xl border border-components-panel-border bg-components-panel-bg-blur px-6 text-sm font-normal","hover:border-divider-subtle hover:bg-components-panel-on-panel-item-bg-hover"),children:[(0,c.jsx)(X.Csv,{className:"shrink-0"}),(0,c.jsxs)("div",{className:"ml-2 flex w-0 grow",children:[(0,c.jsx)("span",{className:"max-w-[calc(100%_-_30px)] overflow-hidden text-ellipsis whitespace-nowrap text-text-primary",children:a.file.name.replace(/.csv$/,"")}),(0,c.jsx)("span",{className:"shrink-0 text-text-secondary",children:".csv"})]}),(0,c.jsxs)("div",{className:"hidden items-center group-hover:flex",children:[a.progress<100&&a.progress>=0&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(Y.default,{percentage:a.progress,stroke:C,fill:C,animationDuration:0}),(0,c.jsx)("div",{className:"mx-2 h-4 w-px bg-text-secondary"})]}),(0,c.jsx)(l.default,{onClick:z,children:e("stepOne.uploader.change",{ns:"datasetCreation"})}),(0,c.jsx)("div",{className:"mx-2 h-4 w-px bg-text-secondary"}),(0,c.jsx)("div",{className:"cursor-pointer p-2",onClick:()=>{p.current&&(p.current.value=""),b()},children:(0,c.jsx)(d.RiDeleteBinLine,{className:"h-4 w-4 text-text-secondary"})})]})]})]})]})}),ac=f.memo(({isShow:a,docForm:b,onCancel:e,onConfirm:h})=>{let{t:i}=(0,g.useTranslation)(),[j,k]=(0,f.useState)();return(0,f.useEffect)(()=>{a||k(void 0)},[a]),(0,c.jsxs)(L.default,{isShow:a,onClose:K.noop,className:"!max-w-[520px] !rounded-xl px-8 py-6",children:[(0,c.jsx)("div",{className:"relative pb-1 text-xl font-medium leading-[30px] text-text-primary",children:i("list.batchModal.title",{ns:"datasetDocuments"})}),(0,c.jsx)("div",{className:"absolute right-4 top-4 cursor-pointer p-2",onClick:e,children:(0,c.jsx)(d.RiCloseLine,{className:"h-4 w-4 text-text-secondary"})}),(0,c.jsx)(ab,{file:j,updateFile:a=>k(a)}),(0,c.jsx)(U,{docForm:b}),(0,c.jsxs)("div",{className:"mt-[28px] flex justify-end pt-6",children:[(0,c.jsx)(l.default,{className:"mr-2",onClick:e,children:i("list.batchModal.cancel",{ns:"datasetDocuments"})}),(0,c.jsx)(l.default,{variant:"primary",onClick:()=>{j&&(e(),h(j))},disabled:!j||!j.file||!j.file.id,children:i("list.batchModal.run",{ns:"datasetDocuments"})})]})]})});var ad=a.i(796499),ae=a.i(680237),af=a.i(301128),ag=a.i(388206),ah=a.i(243103),ai=a.i(693137),aj=a.i(614157),ak=a.i(115357),al=a.i(294524);let am=f.memo(()=>{let{t:a}=(0,g.useTranslation)(),{dragging:b,fileUploadConfig:e,dragRef:f,dropRef:h,uploaderRef:i,fileChangeHandle:j,selectHandle:k}=(0,aj.useUpload)();return(0,c.jsxs)("div",{className:"w-full",children:[(0,c.jsx)("input",{ref:i,id:"fileUploader",className:"hidden",type:"file",multiple:!0,accept:al.ACCEPT_TYPES.map(a=>`.${a}`).join(","),onChange:j}),(0,c.jsxs)("div",{ref:h,className:(0,m.cn)("relative flex h-16 flex-col items-center justify-center gap-1 rounded-[10px] border border-dashed border-components-dropzone-border bg-components-dropzone-bg px-4 py-3 text-text-tertiary",b&&"border-components-dropzone-border-accent bg-components-dropzone-bg-accent"),children:[(0,c.jsxs)("div",{className:"system-sm-medium flex items-center justify-center gap-x-2 text-text-secondary",children:[(0,c.jsx)(d.RiUploadCloud2Line,{className:"size-5 text-text-tertiary"}),(0,c.jsxs)("div",{children:[(0,c.jsx)("span",{children:a("imageUploader.button",{ns:"dataset"})}),(0,c.jsx)("span",{className:"ml-1 cursor-pointer text-text-accent",onClick:k,children:a("imageUploader.browse",{ns:"dataset"})})]})]}),(0,c.jsx)("div",{className:"system-xs-regular",children:a("imageUploader.tip",{ns:"dataset",size:e.imageFileSizeLimit,supportTypes:al.ACCEPT_TYPES.join(", "),batchCount:e.imageFileBatchLimit})}),b&&(0,c.jsx)("div",{ref:f,className:"absolute inset-0"})]})]})});var an=a.i(527858);a.i(10035);var ao=a.i(734766),ap=a.i(744383),aq=a.i(244044);let ar=(0,f.memo)(({file:a,showDeleteAction:b,onRemove:e,onReUpload:g,onPreview:h})=>{let{id:i,progress:j,base64Url:k,sourceUrl:m}=a,n=(0,f.useCallback)(a=>{a.stopPropagation(),a.preventDefault(),h?.(i)},[h,i]),o=(0,f.useCallback)(a=>{a.stopPropagation(),a.preventDefault(),e?.(i)},[e,i]),p=(0,f.useCallback)(a=>{a.stopPropagation(),a.preventDefault(),g?.(i)},[g,i]);return(0,c.jsxs)("div",{className:"group/file-image relative cursor-pointer",onClick:n,children:[b&&(0,c.jsx)(l.default,{className:"absolute -right-1.5 -top-1.5 z-[11] hidden h-5 w-5 rounded-full p-0 group-hover/file-image:flex",onClick:o,children:(0,c.jsx)(d.RiCloseLine,{className:"h-4 w-4 text-components-button-secondary-text"})}),(0,c.jsx)(an.default,{className:"h-[68px] w-[68px] shadow-md",imageUrl:k||m||""}),j>=0&&!(0,aq.fileIsUploaded)(a)&&(0,c.jsx)("div",{className:"absolute inset-0 z-10 flex items-center justify-center border-[2px] border-effects-image-frame bg-background-overlay-alt",children:(0,c.jsx)(ap.default,{percentage:j,size:12,circleStrokeColor:"stroke-components-progress-white-border",circleFillColor:"fill-transparent",sectorFillColor:"fill-components-progress-white-progress"})}),-1===j&&(0,c.jsx)("div",{className:"absolute inset-0 z-10 flex items-center justify-center border-[2px] border-state-destructive-border bg-background-overlay-destructive",onClick:p,children:(0,c.jsx)(ao.ReplayLine,{className:"size-5 text-text-primary-on-surface"})})]})}),as=({disabled:a,className:b})=>{let d=(0,ak.useFileStoreWithSelector)(a=>a.files),[e,g]=(0,f.useState)(0),[h,i]=(0,f.useState)([]),j=(0,f.useCallback)(a=>{let b=d.findIndex(b=>b.id===a);-1!==b&&(g(b),i(d.map(a=>({url:a.base64Url||a.sourceUrl||"",name:a.name,size:a.size}))))},[d]),k=(0,f.useCallback)(()=>{i([])},[]),{handleRemoveFile:l,handleReUploadFile:n}=(0,aj.useUpload)();return(0,c.jsxs)("div",{className:(0,m.cn)("w-full",b),children:[!a&&(0,c.jsx)(am,{}),(0,c.jsx)("div",{className:"flex flex-wrap gap-2 py-1",children:d.map(b=>(0,c.jsx)(ar,{file:b,showDeleteAction:!a,onRemove:l,onReUpload:n,onPreview:j},b.id))}),h.length>0&&(0,c.jsx)(ai.default,{images:h,initialIndex:e,onClose:k})]})},at=({value:a,onChange:b,...d})=>(0,c.jsx)(ak.FileContextProvider,{value:a,onChange:b,children:(0,c.jsx)(as,{...d})});var au=a.i(573912);a.i(387799);var av=a.i(944054);let aw=(0,V.createContext)({isCollapsed:!0,fullScreen:!1,toggleFullScreen:K.noop,currSegment:{showModal:!1},currChildChunk:{showModal:!1}}),ax=a=>(0,V.useContextSelector)(aw,a);var ay=a.i(261574),az=a.i(56328);a.i(713310);var aA=a.i(128972);let aB=({handleCancel:a,handleSave:b,loading:d,actionType:e="edit",handleRegeneration:h,isChildChunk:i=!1,showRegenerationButton:j=!0})=>{let{t:k}=(0,g.useTranslation)(),m=(0,ae.useDocumentContext)(a=>a.docForm),n=(0,ae.useDocumentContext)(a=>a.parentMode);(0,ay.useKeyPress)(["esc"],b=>{b.preventDefault(),a()}),(0,ay.useKeyPress)(`${(0,aA.getKeyboardKeyCodeBySystem)("ctrl")}.s`,a=>{a.preventDefault(),d||b()},{exactMatch:!0,useCapture:!0});let o=(0,f.useMemo)(()=>m===E.ChunkingMode.parentChild&&"paragraph"===n,[m,n]);return(0,c.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,c.jsx)(l.default,{onClick:a,children:(0,c.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,c.jsx)("span",{className:"system-sm-medium text-components-button-secondary-text",children:k("operation.cancel",{ns:"common"})}),(0,c.jsx)(az.default,{keys:["ESC"],textColor:"secondary"})]})}),o&&"edit"===e&&!i&&j?(0,c.jsx)(l.default,{onClick:h,disabled:d,children:(0,c.jsx)("span",{className:"system-sm-medium text-components-button-secondary-text",children:k("operation.saveAndRegenerate",{ns:"common"})})}):null,(0,c.jsx)(l.default,{variant:"primary",onClick:b,disabled:d,children:(0,c.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,c.jsx)("span",{className:"text-components-button-primary-text",children:k("operation.save",{ns:"common"})}),(0,c.jsx)(az.default,{keys:["ctrl","S"],bgColor:"white"})]})})]})};aB.displayName="ActionButtons";let aC=f.memo(aB);var aD=a.i(168799);let aE=f.memo(({className:a,isChecked:b,onCheck:d})=>{let{t:e}=(0,g.useTranslation)();return(0,c.jsxs)("div",{className:(0,m.cn)("flex items-center gap-x-1 pl-1",a),children:[(0,c.jsx)(aD.default,{className:"shrink-0",checked:b,onCheck:d},"add-another-checkbox"),(0,c.jsx)("span",{className:"system-xs-medium text-text-tertiary",children:e("segment.addAnother",{ns:"datasetDocuments"})})]})});var aF=a.i(189583);let aG=f.memo(({value:a,placeholder:b,className:d,disabled:e,...f})=>(0,c.jsx)("textarea",{className:(0,m.cn)("inset-0 w-full resize-none appearance-none overflow-y-auto border-none bg-transparent outline-none",d),placeholder:b,value:a,disabled:e,...f}));aG.displayName="Textarea";let aH=f.memo(({className:a,placeholder:b,value:d,disabled:e,containerRef:g,labelRef:h,...i})=>{let j=(0,f.useRef)(null),k=(0,f.useRef)(null),[l,n]=(0,f.useState)(0);return(0,f.useEffect)(()=>{let a=j.current;if(!a)return;a.style.height="auto";let b=Number.parseInt(getComputedStyle(a).lineHeight),c=Math.max(a.scrollHeight,b);a.style.height=`${c}px`},[d]),(0,f.useEffect)(()=>{let a=g.current,b=h.current;if(!a||!b)return;let c=()=>{n(Math.floor((a.clientHeight-2*b.clientHeight-32-12)/2))};return c(),k.current=new ResizeObserver(c),k.current.observe(a),()=>{k.current?.disconnect()}},[]),(0,c.jsx)("textarea",{ref:j,className:(0,m.cn)("inset-0 w-full resize-none appearance-none border-none bg-transparent outline-none",a),style:{maxHeight:l},placeholder:b,value:d,disabled:e,...i})});aH.displayName="AutoResizeTextArea";let aI=f.memo(({question:a,answer:b,onQuestionChange:d,onAnswerChange:e,isEditMode:h=!0})=>{let{t:i}=(0,g.useTranslation)(),j=(0,f.useRef)(null),k=(0,f.useRef)(null);return(0,c.jsxs)("div",{ref:j,className:"h-full overflow-hidden",children:[(0,c.jsx)("div",{ref:k,className:"mb-1 text-xs font-medium text-text-tertiary",children:"QUESTION"}),(0,c.jsx)(aH,{className:"text-sm tracking-[-0.07px] text-text-secondary caret-[#295EFF]",value:a,placeholder:i("segment.questionPlaceholder",{ns:"datasetDocuments"})||"",onChange:a=>d(a.target.value),disabled:!h,containerRef:j,labelRef:k}),(0,c.jsx)("div",{className:"mb-1 mt-6 text-xs font-medium text-text-tertiary",children:"ANSWER"}),(0,c.jsx)(aH,{className:"text-sm tracking-[-0.07px] text-text-secondary caret-[#295EFF]",value:b,placeholder:i("segment.answerPlaceholder",{ns:"datasetDocuments"})||"",onChange:a=>e?.(a.target.value),disabled:!h,autoFocus:!0,containerRef:j,labelRef:k})]})});aI.displayName="QATextArea";let aJ=({question:a,answer:b,onQuestionChange:d,onAnswerChange:e,isEditMode:f,docForm:h})=>{let{t:i}=(0,g.useTranslation)();return h===E.ChunkingMode.qa?(0,c.jsx)(aI,{question:a,answer:b,onQuestionChange:d,onAnswerChange:e,isEditMode:f}):f?(0,c.jsx)(aG,{className:"body-md-regular h-full w-full pb-6 tracking-[-0.07px] text-text-secondary caret-[#295EFF]",value:a,placeholder:i("segment.contentPlaceholder",{ns:"datasetDocuments"})||"",onChange:a=>d(a.target.value),disabled:!f,autoFocus:!0}):(0,c.jsx)(aF.Markdown,{className:"h-full w-full !text-text-secondary",content:a,customDisallowedElements:["input"]})};aJ.displayName="ChunkContent";let aK=f.memo(aJ);var aL=a.i(687700),aM=a.i(144244);let aN=({segInfo:a,className:b,keywords:d,onKeywordsChange:e,isEditMode:f,actionType:h="view"})=>{let{t:i}=(0,g.useTranslation)();return(0,c.jsxs)("div",{className:(0,m.cn)("flex flex-col",b),children:[(0,c.jsx)("div",{className:"system-xs-medium-uppercase text-text-tertiary",children:i("segment.keywords",{ns:"datasetDocuments"})}),(0,c.jsx)("div",{className:"flex max-h-[200px] w-full flex-wrap gap-1 overflow-auto text-text-tertiary",children:a?.keywords?.length||"view"!==h?(0,c.jsx)(aM.default,{items:d,onChange:a=>e(a),disableAdd:!f,disableRemove:!f||1===d.length}):"-"})]})};aN.displayName="Keywords";let aO=f.memo(aN);var aP=a.i(388025);let aQ=(0,f.memo)(({onCancel:a,docForm:b,onSave:i,viewNewlyAddedChunk:j})=>{let{t:l}=(0,g.useTranslation)(),{notify:n}=(0,V.useContext)(k.ToastContext),[p,q]=(0,f.useState)(""),[r,s]=(0,f.useState)(""),[t,u]=(0,f.useState)([]),{datasetId:v,documentId:w}=(0,e.useParams)(),[x,y]=(0,f.useState)([]),[z,A]=(0,f.useState)(!1),[B,C]=(0,f.useState)(!0),D=ax(a=>a.fullScreen),F=ax(a=>a.toggleFullScreen),H=(0,o.useDatasetDetailContextWithSelector)(a=>a.dataset?.indexing_technique),{appSidebarExpand:I}=(0,ah.useStore)((0,ag.useShallow)(a=>({appSidebarExpand:a.appSidebarExpand}))),[J,K]=(0,f.useState)(Date.now()),L=(0,f.useRef)(null),M=(0,f.useMemo)(()=>(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(h.default,{type:"vertical",className:"mx-1 h-3 bg-divider-regular"}),(0,c.jsx)("button",{type:"button",className:"system-xs-semibold text-text-accent",onClick:()=>{clearTimeout(L.current),j()},children:l("operation.view",{ns:"common"})})]}),[j,l]),N=(0,f.useCallback)((b="esc")=>{"esc"!==b&&B||a()},[a,B]),O=(0,f.useCallback)(a=>{u(a)},[]),{mutateAsync:P}=(0,G.useAddSegment)(),Q=(0,f.useCallback)(async()=>{let a={content:"",attachment_ids:[]};if(b===E.ChunkingMode.qa){if(!p.trim())return n({type:"error",message:l("segment.questionEmpty",{ns:"datasetDocuments"})});if(!r.trim())return n({type:"error",message:l("segment.answerEmpty",{ns:"datasetDocuments"})});a.content=p,a.answer=r}else{if(!p.trim())return n({type:"error",message:l("segment.contentEmpty",{ns:"datasetDocuments"})});a.content=p}x?.length&&(a.keywords=x),t.length&&(a.attachment_ids=t.filter(a=>!!a.uploadedId).map(a=>a.uploadedId)),A(!0),await P({datasetId:v,documentId:w,body:a},{onSuccess(){n({type:"success",message:l("segment.chunkAdded",{ns:"datasetDocuments"}),className:`!w-[296px] !bottom-0 ${"expand"===I?"!left-[216px]":"!left-14"}
          !top-auto !right-auto !mb-[52px] !ml-11`,customComponent:M}),N("add"),q(""),s(""),u([]),K(Date.now()),y([]),L.current=setTimeout(()=>{i()},3e3)},onSettled(){A(!1)}})},[b,x,P,v,w,p,r,t,n,l,I,M,N,i]),R=(0,f.useMemo)(()=>{let a=b===E.ChunkingMode.qa?p.length+r.length:p.length;return`${(0,au.formatNumber)(a)} ${l("segment.characters",{ns:"datasetDocuments",count:a})}`},[p.length,r.length,b,l]),S=H===av.IndexingType.ECONOMICAL;return(0,c.jsxs)("div",{className:"flex h-full flex-col",children:[(0,c.jsxs)("div",{className:(0,m.cn)("flex items-center justify-between",D?"border border-divider-subtle py-3 pl-6 pr-4":"pl-4 pr-3 pt-3"),children:[(0,c.jsxs)("div",{className:"flex flex-col",children:[(0,c.jsx)("div",{className:"system-xl-semibold text-text-primary",children:l("segment.addChunk",{ns:"datasetDocuments"})}),(0,c.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,c.jsx)(aP.SegmentIndexTag,{label:l("segment.newChunk",{ns:"datasetDocuments"})}),(0,c.jsx)(aL.default,{}),(0,c.jsx)("span",{className:"system-xs-medium text-text-tertiary",children:R})]})]}),(0,c.jsxs)("div",{className:"flex items-center",children:[D&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(aE,{className:"mr-3",isChecked:B,onCheck:()=>C(!B)}),(0,c.jsx)(aC,{handleCancel:N.bind(null,"esc"),handleSave:Q,loading:z,actionType:"add"}),(0,c.jsx)(h.default,{type:"vertical",className:"ml-4 mr-2 h-3.5 bg-divider-regular"})]}),(0,c.jsx)("div",{className:"mr-1 flex h-8 w-8 cursor-pointer items-center justify-center p-1.5",onClick:F,children:(0,c.jsx)(d.RiExpandDiagonalLine,{className:"h-4 w-4 text-text-tertiary"})}),(0,c.jsx)("div",{className:"flex h-8 w-8 cursor-pointer items-center justify-center p-1.5",onClick:N.bind(null,"esc"),children:(0,c.jsx)(d.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})})]})]}),(0,c.jsxs)("div",{className:(0,m.cn)("flex grow",D?"w-full flex-row justify-center gap-x-8 px-6 pt-6":"flex-col gap-y-1 px-4 py-3"),children:[(0,c.jsx)("div",{className:(0,m.cn)("overflow-hidden whitespace-pre-line break-all",D?"w-1/2":"grow"),children:(0,c.jsx)(aK,{docForm:b,question:p,answer:r,onQuestionChange:a=>q(a),onAnswerChange:a=>s(a),isEditMode:!0})}),(0,c.jsxs)("div",{className:(0,m.cn)("flex flex-col",D?"w-[320px] gap-y-2":"w-full gap-y-1"),children:[(0,c.jsx)(at,{value:t,onChange:O},J),S&&(0,c.jsx)(aO,{className:D?"w-1/5":"",actionType:"add",keywords:x,isEditMode:!0,onKeywordsChange:a=>y(a)})]})]}),!D&&(0,c.jsxs)("div",{className:"flex items-center justify-between border-t-[1px] border-t-divider-subtle p-4 pt-3",children:[(0,c.jsx)(aE,{isChecked:B,onCheck:()=>C(!B)}),(0,c.jsx)(aC,{handleCancel:N.bind(null,"esc"),handleSave:Q,loading:z,actionType:"add"})]})]})});var aR=a.i(124116),aS=a.i(415464);let aT=f.memo(({chunkId:a,childChunkInfo:b,onUpdate:e,onCancel:i,docForm:j})=>{let{t:k}=(0,g.useTranslation)(),[l,n]=(0,f.useState)(b?.content||""),{eventEmitter:o}=(0,aR.useEventEmitterContextContext)(),[p,q]=(0,f.useState)(!1),r=ax(a=>a.fullScreen),s=ax(a=>a.toggleFullScreen);o?.useSubscription(a=>{"update-child-segment"===a&&q(!0),"update-child-segment-done"===a&&q(!1)});let t=()=>{i()},u=()=>{e(a,b?.id||"",l)},v=(0,f.useMemo)(()=>{let a=l.length;return`${(0,au.formatNumber)(a)} ${k("segment.characters",{ns:"datasetDocuments",count:a})}`},[l.length]),w=(0,f.useMemo)(()=>{let a=(0,aS.formatTime)({date:(b?.updated_at??0)*1e3,dateFormat:`${k("segment.dateTimeFormat",{ns:"datasetDocuments"})}`});return`${k("segment.editedAt",{ns:"datasetDocuments"})} ${a}`},[b?.updated_at]);return(0,c.jsxs)("div",{className:"flex h-full flex-col",children:[(0,c.jsxs)("div",{className:(0,m.cn)("flex items-center justify-between",r?"border border-divider-subtle py-3 pl-6 pr-4":"pl-4 pr-3 pt-3"),children:[(0,c.jsxs)("div",{className:"flex flex-col",children:[(0,c.jsx)("div",{className:"system-xl-semibold text-text-primary",children:k("segment.editChildChunk",{ns:"datasetDocuments"})}),(0,c.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,c.jsx)(aP.SegmentIndexTag,{positionId:b?.position||"",labelPrefix:k("segment.childChunk",{ns:"datasetDocuments"})}),(0,c.jsx)(aL.default,{}),(0,c.jsx)("span",{className:"system-xs-medium text-text-tertiary",children:v}),(0,c.jsx)(aL.default,{}),(0,c.jsx)("span",{className:"system-xs-medium text-text-tertiary",children:w})]})]}),(0,c.jsxs)("div",{className:"flex items-center",children:[r&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(aC,{handleCancel:t,handleSave:u,loading:p,isChildChunk:!0}),(0,c.jsx)(h.default,{type:"vertical",className:"ml-4 mr-2 h-3.5 bg-divider-regular"})]}),(0,c.jsx)("div",{className:"mr-1 flex h-8 w-8 cursor-pointer items-center justify-center p-1.5",onClick:s,children:r?(0,c.jsx)(d.RiCollapseDiagonalLine,{className:"h-4 w-4 text-text-tertiary"}):(0,c.jsx)(d.RiExpandDiagonalLine,{className:"h-4 w-4 text-text-tertiary"})}),(0,c.jsx)("div",{className:"flex h-8 w-8 cursor-pointer items-center justify-center p-1.5",onClick:i,children:(0,c.jsx)(d.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})})]})]}),(0,c.jsx)("div",{className:(0,m.cn)("flex w-full grow",r?"flex-row justify-center px-6 pt-6":"px-4 py-3"),children:(0,c.jsx)("div",{className:(0,m.cn)("h-full overflow-hidden whitespace-pre-line break-all",r?"w-1/2":"w-full"),children:(0,c.jsx)(aK,{docForm:j,question:l,onQuestionChange:a=>n(a),isEditMode:!0})})}),!r&&(0,c.jsx)("div",{className:"flex items-center justify-end border-t-[1px] border-t-divider-subtle p-4 pt-3",children:(0,c.jsx)(aC,{handleCancel:t,handleSave:u,loading:p,isChildChunk:!0})})]})});var aU=K,aV=a.i(555237);let aW={right:"right-0",left:"left-0",bottom:"bottom-0",top:"top-0"};function aX(a,b){return Array.from(document.querySelectorAll(a)).some(a=>a?.contains(b))}let aY=({open:a,onClose:b,side:d="right",showOverlay:e=!0,modal:g=!1,needCheckChunks:h=!1,children:i,panelClassName:j,panelContentClassName:k})=>{let l=(0,f.useRef)(null),n=ax(a=>a.currSegment),o=ax(a=>a.currChildChunk);(0,ay.useKeyPress)("esc",c=>{a&&(c.preventDefault(),b())},{exactMatch:!0,useCapture:!0});let p=(0,f.useCallback)(a=>{var b,c;let d=l.current;if(!d||!a||d.contains(a)||aX(".image-previewer",a))return!1;if(!h)return!0;let e=aX(".chunk-card",a),f=aX(".child-chunk",a);return b=n.showModal,c=o.showModal,!!b&&!!f||!!c&&!!e&&!f||!e&&!f},[n.showModal,o.showModal,h]),q=(0,f.useCallback)(c=>{!a||g||!l.current||p(c.target)&&queueMicrotask(b)},[p,b,a,g]);(0,f.useEffect)(()=>(window.addEventListener("pointerdown",q,{capture:!0}),()=>window.removeEventListener("pointerdown",q,{capture:!0})),[q]);let r=g&&a?"pointer-events-auto":"pointer-events-none",s=(0,c.jsxs)("div",{className:"pointer-events-none fixed inset-0 z-[9999]",children:[e&&(0,c.jsx)("div",{onClick:g?b:void 0,"aria-hidden":"true",className:(0,m.cn)("fixed inset-0 bg-black/30 opacity-0 transition-opacity duration-200 ease-in",a&&"opacity-100",r)}),(0,c.jsx)("div",{role:"dialog","aria-modal":g?"true":"false",className:(0,m.cn)("pointer-events-auto fixed flex flex-col",aW[d],"left"===d||"right"===d?"h-screen":"w-screen",j),children:(0,c.jsx)("div",{ref:l,className:(0,m.cn)("flex grow flex-col",k),children:i})})]});return a?(0,aV.createPortal)(s,document.body):null},aZ=({isOpen:a,onClose:b=aU.noop,fullScreen:d,children:e,showOverlay:f=!0,needCheckChunks:g=!1,modal:h=!1})=>(0,c.jsx)(aY,{open:a,onClose:b,panelClassName:(0,m.cn)(d?"w-full":"w-[568px] pb-2 pr-2 pt-16"),panelContentClassName:(0,m.cn)("bg-components-panel-bg",!d&&"rounded-xl border-[0.5px] border-components-panel-border"),showOverlay:f,needCheckChunks:g,modal:h,children:e}),a$=(0,f.memo)(({chunkId:a,onCancel:b,onSave:i,viewNewlyAddedChildChunk:j})=>{let{t:l}=(0,g.useTranslation)(),{notify:n}=(0,V.useContext)(k.ToastContext),[o,p]=(0,f.useState)(""),{datasetId:q,documentId:r}=(0,e.useParams)(),[s,t]=(0,f.useState)(!1),[u,v]=(0,f.useState)(!0),w=ax(a=>a.fullScreen),x=ax(a=>a.toggleFullScreen),{appSidebarExpand:y}=(0,ah.useStore)((0,ag.useShallow)(a=>({appSidebarExpand:a.appSidebarExpand}))),z=(0,ae.useDocumentContext)(a=>a.parentMode),A=(0,f.useRef)(null),B=(0,f.useMemo)(()=>"full-doc"===z,[z]),C=(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(h.default,{type:"vertical",className:"mx-1 h-3 bg-divider-regular"}),(0,c.jsx)("button",{type:"button",className:"system-xs-semibold text-text-accent",onClick:()=>{clearTimeout(A.current),j?.()},children:l("operation.view",{ns:"common"})})]}),D=(a="esc")=>{"esc"!==a&&u||b()},{mutateAsync:F}=(0,G.useAddChildSegment)(),H=async()=>{let b={content:""};if(!o.trim())return n({type:"error",message:l("segment.contentEmpty",{ns:"datasetDocuments"})});b.content=o,t(!0),await F({datasetId:q,documentId:r,segmentId:a,body:b},{onSuccess(a){n({type:"success",message:l("segment.childChunkAdded",{ns:"datasetDocuments"}),className:`!w-[296px] !bottom-0 ${"expand"===y?"!left-[216px]":"!left-14"}
          !top-auto !right-auto !mb-[52px] !ml-11`,customComponent:B&&C}),D("add"),p(""),B?A.current=setTimeout(()=>{i()},3e3):i(a.data)},onSettled(){t(!1)}})},I=(0,f.useMemo)(()=>{let a=o.length;return`${(0,au.formatNumber)(a)} ${l("segment.characters",{ns:"datasetDocuments",count:a})}`},[o.length]);return(0,c.jsxs)("div",{className:"flex h-full flex-col",children:[(0,c.jsxs)("div",{className:(0,m.cn)("flex items-center justify-between",w?"border border-divider-subtle py-3 pl-6 pr-4":"pl-4 pr-3 pt-3"),children:[(0,c.jsxs)("div",{className:"flex flex-col",children:[(0,c.jsx)("div",{className:"system-xl-semibold text-text-primary",children:l("segment.addChildChunk",{ns:"datasetDocuments"})}),(0,c.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,c.jsx)(aP.SegmentIndexTag,{label:l("segment.newChildChunk",{ns:"datasetDocuments"})}),(0,c.jsx)(aL.default,{}),(0,c.jsx)("span",{className:"system-xs-medium text-text-tertiary",children:I})]})]}),(0,c.jsxs)("div",{className:"flex items-center",children:[w&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(aE,{className:"mr-3",isChecked:u,onCheck:()=>v(!u)}),(0,c.jsx)(aC,{handleCancel:D.bind(null,"esc"),handleSave:H,loading:s,actionType:"add",isChildChunk:!0}),(0,c.jsx)(h.default,{type:"vertical",className:"ml-4 mr-2 h-3.5 bg-divider-regular"})]}),(0,c.jsx)("div",{className:"mr-1 flex h-8 w-8 cursor-pointer items-center justify-center p-1.5",onClick:x,children:(0,c.jsx)(d.RiExpandDiagonalLine,{className:"h-4 w-4 text-text-tertiary"})}),(0,c.jsx)("div",{className:"flex h-8 w-8 cursor-pointer items-center justify-center p-1.5",onClick:D.bind(null,"esc"),children:(0,c.jsx)(d.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})})]})]}),(0,c.jsx)("div",{className:(0,m.cn)("flex w-full grow",w?"flex-row justify-center px-6 pt-6":"px-4 py-3"),children:(0,c.jsx)("div",{className:(0,m.cn)("h-full overflow-hidden whitespace-pre-line break-all",w?"w-1/2":"w-full"),children:(0,c.jsx)(aK,{docForm:E.ChunkingMode.parentChild,question:o,onQuestionChange:a=>p(a),isEditMode:!0})})}),!w&&(0,c.jsxs)("div",{className:"flex items-center justify-between border-t-[1px] border-t-divider-subtle p-4 pt-3",children:[(0,c.jsx)(aE,{isChecked:u,onCheck:()=>v(!u)}),(0,c.jsx)(aC,{handleCancel:D.bind(null,"esc"),handleSave:H,loading:s,actionType:"add",isChildChunk:!0})]})]})});var a_=a.i(44348),a0=a.i(903173);let a1=f.memo(({onCancel:a,onConfirm:b})=>{let{t:d}=(0,g.useTranslation)();return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("div",{className:"pb-4",children:[(0,c.jsx)("span",{className:"title-2xl-semi-bold text-text-primary",children:d("segment.regenerationConfirmTitle",{ns:"datasetDocuments"})}),(0,c.jsx)("p",{className:"system-md-regular text-text-secondary",children:d("segment.regenerationConfirmMessage",{ns:"datasetDocuments"})})]}),(0,c.jsxs)("div",{className:"flex justify-end gap-x-2 pt-6",children:[(0,c.jsx)(l.default,{onClick:a,children:d("operation.cancel",{ns:"common"})}),(0,c.jsx)(l.default,{variant:"warning",destructive:!0,onClick:b,children:d("operation.regenerate",{ns:"common"})})]})]})});a1.displayName="DefaultContent";let a2=f.memo(()=>{let{t:a}=(0,g.useTranslation)();return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("div",{className:"pb-4",children:[(0,c.jsx)("span",{className:"title-2xl-semi-bold text-text-primary",children:a("segment.regeneratingTitle",{ns:"datasetDocuments"})}),(0,c.jsx)("p",{className:"system-md-regular text-text-secondary",children:a("segment.regeneratingMessage",{ns:"datasetDocuments"})})]}),(0,c.jsx)("div",{className:"flex justify-end pt-6",children:(0,c.jsxs)(l.default,{variant:"warning",destructive:!0,disabled:!0,className:"inline-flex items-center gap-x-0.5",children:[(0,c.jsx)(d.RiLoader2Line,{className:"h-4 w-4 animate-spin text-components-button-destructive-primary-text-disabled"}),(0,c.jsx)("span",{children:a("operation.regenerate",{ns:"common"})})]})})]})});a2.displayName="RegeneratingContent";let a3=f.memo(({onClose:a})=>{let{t:b}=(0,g.useTranslation)(),d=(0,f.useRef)(Date.now()+5e3),[e]=(0,a0.useCountDown)({targetDate:d.current,onEnd:()=>{a()}});return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("div",{className:"pb-4",children:[(0,c.jsx)("span",{className:"title-2xl-semi-bold text-text-primary",children:b("segment.regenerationSuccessTitle",{ns:"datasetDocuments"})}),(0,c.jsx)("p",{className:"system-md-regular text-text-secondary",children:b("segment.regenerationSuccessMessage",{ns:"datasetDocuments"})})]}),(0,c.jsx)("div",{className:"flex justify-end pt-6",children:(0,c.jsx)(l.default,{variant:"primary",onClick:a,children:`${b("operation.close",{ns:"common"})}${0===e?"":`(${Math.round(e/1e3)})`}`})})]})});a3.displayName="RegenerationCompletedContent";let a4=({isShow:a,onConfirm:b,onCancel:d,onClose:e})=>{let[g,h]=(0,f.useState)(!1),[i,j]=(0,f.useState)(!1),{eventEmitter:k}=(0,aR.useEventEmitterContextContext)();return k?.useSubscription(a=>{"update-segment"===a&&(h(!0),j(!1)),"update-segment-success"===a&&j(!0),"update-segment-done"===a&&h(!1)}),(0,c.jsxs)(L.default,{isShow:a,onClose:K.noop,className:"!max-w-[480px] !rounded-2xl",wrapperClassName:"!z-[10000]",children:[!g&&!i&&(0,c.jsx)(a1,{onCancel:d,onConfirm:b}),g&&!i&&(0,c.jsx)(a2,{}),!g&&i&&(0,c.jsx)(a3,{onClose:e})]})};var a5=a.i(948972);let a6=f.memo(({segInfo:a,onUpdate:b,onCancel:e,isEditMode:i,docForm:j,onModalStateChange:k})=>{let{t:l}=(0,g.useTranslation)(),[n,p]=(0,f.useState)(i?a?.content||"":a?.sign_content||""),[q,r]=(0,f.useState)(a?.answer||""),[s,t]=(0,f.useState)(a?.summary||""),[u,v]=(0,f.useState)(()=>a?.attachments?.map(a=>({id:(0,a_.v4)(),name:a.name,size:a.size,mimeType:a.mime_type,extension:a.extension,sourceUrl:a.source_url,uploadedId:a.id,progress:100}))||[]),[w,x]=(0,f.useState)(a?.keywords||[]),{eventEmitter:y}=(0,aR.useEventEmitterContextContext)(),[z,A]=(0,f.useState)(!1),[B,C]=(0,f.useState)(!1),D=ax(a=>a.fullScreen),F=ax(a=>a.toggleFullScreen),G=(0,ae.useDocumentContext)(a=>a.parentMode),H=(0,o.useDatasetDetailContextWithSelector)(a=>a.dataset?.indexing_technique),I=(0,o.useDatasetDetailContextWithSelector)(a=>a.dataset?.runtime_mode);y?.useSubscription(a=>{"update-segment"===a&&A(!0),"update-segment-done"===a&&A(!1)});let J=(0,f.useCallback)(()=>{e()},[e]),K=(0,f.useCallback)(()=>{b(a?.id||"",n,q,w,u,s,!1)},[b,a?.id,n,q,w,u,s]),L=(0,f.useCallback)(()=>{C(!0),k?.(!0)},[k]),M=(0,f.useCallback)(()=>{C(!1),k?.(!1)},[k]),N=(0,f.useCallback)(()=>{C(!1),k?.(!1),e()},[e,k]),O=(0,f.useCallback)(()=>{b(a?.id||"",n,q,w,u,s,!0)},[b,a?.id,n,q,w,u,s]),P=(0,f.useCallback)(a=>{v(a)},[]),Q=(0,f.useMemo)(()=>{let b=j===E.ChunkingMode.qa?n.length+q.length:n.length,c=(0,au.formatNumber)(i?b:a.word_count),d=i?b:a.word_count;return`${c} ${l("segment.characters",{ns:"datasetDocuments",count:d})}`},[i,n.length,q.length,j,a,l]),R=j===E.ChunkingMode.parentChild&&"full-doc"===G,S=i?l("segment.editChunk",{ns:"datasetDocuments"}):l("segment.chunkDetail",{ns:"datasetDocuments"}),T=j===E.ChunkingMode.parentChild?l("segment.parentChunk",{ns:"datasetDocuments"}):l("segment.chunk",{ns:"datasetDocuments"}),U=H===av.IndexingType.ECONOMICAL;return(0,c.jsxs)("div",{className:"flex h-full flex-col",children:[(0,c.jsxs)("div",{className:(0,m.cn)("flex shrink-0 items-center justify-between",D?"border border-divider-subtle py-3 pl-6 pr-4":"pl-4 pr-3 pt-3"),children:[(0,c.jsxs)("div",{className:"flex flex-col",children:[(0,c.jsx)("div",{className:"system-xl-semibold text-text-primary",children:S}),(0,c.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,c.jsx)(aP.SegmentIndexTag,{positionId:a?.position||"",label:R?T:"",labelPrefix:T}),(0,c.jsx)(aL.default,{}),(0,c.jsx)("span",{className:"system-xs-medium text-text-tertiary",children:Q})]})]}),(0,c.jsxs)("div",{className:"flex items-center",children:[i&&D&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(aC,{handleCancel:J,handleRegeneration:L,handleSave:K,loading:z,showRegenerationButton:"general"===I}),(0,c.jsx)(h.default,{type:"vertical",className:"ml-4 mr-2 h-3.5 bg-divider-regular"})]}),(0,c.jsx)("div",{className:"mr-1 flex h-8 w-8 cursor-pointer items-center justify-center p-1.5",onClick:F,children:D?(0,c.jsx)(d.RiCollapseDiagonalLine,{className:"h-4 w-4 text-text-tertiary"}):(0,c.jsx)(d.RiExpandDiagonalLine,{className:"h-4 w-4 text-text-tertiary"})}),(0,c.jsx)("div",{className:"flex h-8 w-8 cursor-pointer items-center justify-center p-1.5",onClick:e,children:(0,c.jsx)(d.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})})]})]}),(0,c.jsxs)("div",{className:(0,m.cn)("flex h-0 grow",D?"w-full flex-row justify-center gap-x-8 px-6 pt-6":"flex-col gap-y-1 px-4 py-3",!i&&"pb-0"),children:[(0,c.jsx)("div",{className:(0,m.cn)(i?"overflow-hidden whitespace-pre-line break-all":"overflow-y-auto",D?"w-1/2":"h-0 grow"),children:(0,c.jsx)(aK,{docForm:j,question:n,answer:q,onQuestionChange:a=>p(a),onAnswerChange:a=>r(a),isEditMode:i})}),(0,c.jsxs)("div",{className:(0,m.cn)("flex shrink-0 flex-col",D?"w-[320px] gap-y-2":"w-full gap-y-1"),children:[(0,c.jsx)(at,{disabled:!i,value:u,onChange:P}),(0,c.jsx)(a5.default,{value:s,onChange:a=>t(a),disabled:!i}),U&&(0,c.jsx)(aO,{className:"w-full",actionType:i?"edit":"view",segInfo:a,keywords:w,isEditMode:i,onKeywordsChange:a=>x(a)})]})]}),i&&!D&&(0,c.jsx)("div",{className:"flex items-center justify-end border-t-[1px] border-t-divider-subtle p-4 pt-3",children:(0,c.jsx)(aC,{handleCancel:J,handleRegeneration:L,handleSave:K,loading:z,showRegenerationButton:"general"===I})}),B&&(0,c.jsx)(a4,{isShow:B,onConfirm:O,onCancel:M,onClose:N})]})}),a7=({currSegment:a,onCloseSegmentDetail:b,onUpdateSegment:d,isRegenerationModalOpen:e,setIsRegenerationModalOpen:f,showNewSegmentModal:g,onCloseNewSegmentModal:h,onSaveNewSegment:i,viewNewlyAddedChunk:j,currChildChunk:k,currChunkId:l,onCloseChildSegmentDetail:m,onUpdateChildChunk:n,showNewChildSegmentModal:o,onCloseNewChildChunkModal:p,onSaveNewChildChunk:q,viewNewlyAddedChildChunk:r,fullScreen:s,docForm:t})=>(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(aZ,{isOpen:a.showModal,fullScreen:s,onClose:b,showOverlay:!1,needCheckChunks:!0,modal:e,children:(0,c.jsx)(a6,{segInfo:a.segInfo??{id:""},docForm:t,isEditMode:a.isEditMode,onUpdate:d,onCancel:b,onModalStateChange:f},a.segInfo?.id)}),(0,c.jsx)(aZ,{isOpen:g,fullScreen:s,onClose:h,modal:!0,children:(0,c.jsx)(aQ,{docForm:t,onCancel:h,onSave:i,viewNewlyAddedChunk:j})}),(0,c.jsx)(aZ,{isOpen:k.showModal,fullScreen:s,onClose:m,showOverlay:!1,needCheckChunks:!0,children:(0,c.jsx)(aT,{chunkId:l,childChunkInfo:k.childChunkInfo??{id:""},docForm:t,onUpdate:n,onCancel:m},k.childChunkInfo?.id)}),(0,c.jsx)(aZ,{isOpen:o,fullScreen:s,onClose:p,modal:!0,children:(0,c.jsx)(a$,{chunkId:l,onCancel:p,onSave:q,viewNewlyAddedChildChunk:r})})]});var a8=a.i(816134),a9=a.i(805611);a.i(224256);var ba=a.i(200363),ba=ba;let bb=f.memo(({isCollapsed:a,toggleCollapsed:b})=>{let{t:e}=(0,g.useTranslation)();return(0,c.jsx)(t.default,{popupContent:e(a?"segment.expandChunks":"segment.collapseChunks",{ns:"datasetDocuments"}),popupClassName:"text-text-secondary system-xs-medium border-[0.5px] border-components-panel-border",children:(0,c.jsx)("button",{type:"button",className:"flex items-center justify-center rounded-lg border-[0.5px] border-components-button-secondary-border bg-components-button-secondary-bg p-2 shadow-xs shadow-shadow-shadow-3 backdrop-blur-[5px]",onClick:b,children:a?(0,c.jsx)(d.RiLineHeight,{className:"h-4 w-4 text-components-button-secondary-text"}):(0,c.jsx)(ba.default,{className:"h-4 w-4 text-components-button-secondary-text"})})})}),bc=f.memo(({item:a,selected:b})=>(0,c.jsxs)("div",{className:"flex items-center justify-between px-2 py-1.5",children:[(0,c.jsx)("span",{className:"system-md-regular",children:a.name}),b&&(0,c.jsx)(d.RiCheckLine,{className:"h-4 w-4 text-text-accent"})]}));var bd=a.i(708406);let be=({isAllSelected:a,isSomeSelected:b,onSelectedAll:d,isLoading:e,totalText:f,statusList:g,selectDefaultValue:i,onChangeStatus:j,inputValue:k,onInputChange:l,isCollapsed:m,toggleCollapsed:n})=>(0,c.jsxs)("div",{className:bd.default.docSearchWrapper,children:[(0,c.jsx)(aD.default,{className:"shrink-0",checked:a,indeterminate:!a&&b,onCheck:d,disabled:e}),(0,c.jsx)("div",{className:"system-sm-semibold-uppercase flex-1 pl-5 text-text-secondary",children:f}),(0,c.jsx)(a9.SimpleSelect,{onSelect:j,items:g,defaultValue:i,className:bd.default.select,wrapperClassName:"h-fit mr-2",optionWrapClassName:"w-[160px]",optionClassName:"p-0",renderOption:({item:a,selected:b})=>(0,c.jsx)(bc,{item:a,selected:b}),notClearable:!0}),(0,c.jsx)(a8.default,{showLeftIcon:!0,showClearIcon:!0,wrapperClassName:"!w-52",value:k,onChange:a=>l(a.target.value),onClear:()=>l("")}),(0,c.jsx)(h.default,{type:"vertical",className:"mx-3 h-3.5"}),(0,c.jsx)(bb,{isCollapsed:m,toggleCollapsed:n})]});var bf=a.i(249730),bg=a.i(909698),bh=a.i(591143),bi=a.i(28981),bj=a.i(175809),bk=a.i(502594);let bl=a=>{let{label:b,className:e,text:g,onDelete:h,labelClassName:i,labelInnerClassName:j,contentClassName:k,showDivider:l=!0,offsetOptions:n,...o}=a,[p,q]=(0,f.useState)(!1),[r,s]=(0,f.useState)(!1),{refs:t,floatingStyles:u,context:v}=(0,bh.useFloating)({open:p,onOpenChange:q,placement:"right-start",whileElementsMounted:bf.autoUpdate,middleware:[(0,bg.flip)(),(0,bg.shift)(),(0,bg.offset)(n)]}),w=(0,bh.useHover)(v,{}),x=(0,bh.useDismiss)(v),y=(0,bh.useRole)(v),{getReferenceProps:z,getFloatingProps:A}=(0,bh.useInteractions)([w,x,y]),B=p&&r;return(0,c.jsx)(c.Fragment,{children:(0,c.jsxs)(bk.SliceContainer,{...o,className:(0,m.cn)("mr-0 block",e),ref:a=>{t.setReference(a),a&&(0,bi.default)(a,4)},...z(),children:[(0,c.jsx)(bk.SliceLabel,{className:(0,m.cn)(B&&"!bg-state-destructive-solid !text-text-primary-on-surface",i),labelInnerClassName:j,children:b}),(0,c.jsx)(bk.SliceContent,{className:(0,m.cn)(B&&"!bg-state-destructive-hover-alt",k),children:g}),l&&(0,c.jsx)(bk.SliceDivider,{className:(0,m.cn)(B&&"!bg-state-destructive-hover-alt")}),p&&(0,c.jsx)(bh.FloatingFocusManager,{context:v,children:(0,c.jsx)("span",{ref:t.setFloating,style:u,...A(),className:"inline-flex items-center justify-center rounded-lg bg-components-actionbar-bg p-1 shadow",onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),children:(0,c.jsx)(bj.default,{onClick:a=>{a.stopPropagation(),h(),q(!1)},state:bj.ActionButtonState.Destructive,children:(0,c.jsx)(d.RiDeleteBinLine,{className:"h-4 w-4"})})})})]})})};var bm=a.i(460183);let bn=f.memo(()=>(0,c.jsx)("div",{className:"h-32 w-full shrink-0 rounded-xl bg-background-section-burn opacity-30"}));bn.displayName="EmptyCard";let bo=f.memo(({className:a})=>(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"2",height:"241",viewBox:"0 0 2 241",fill:"none",className:a,children:[(0,c.jsx)("path",{d:"M1 0.5L1 240.5",stroke:"url(#paint0_linear_1989_74474)"}),(0,c.jsx)("defs",{children:(0,c.jsxs)("linearGradient",{id:"paint0_linear_1989_74474",x1:"-7.99584",y1:"240.5",x2:"-7.88094",y2:"0.50004",gradientUnits:"userSpaceOnUse",children:[(0,c.jsx)("stop",{stopColor:"white",stopOpacity:"0.01"}),(0,c.jsx)("stop",{offset:"0.503965",stopColor:"#101828",stopOpacity:"0.08"}),(0,c.jsx)("stop",{offset:"1",stopColor:"white",stopOpacity:"0.01"})]})})]}));bo.displayName="Line";let bp=f.memo(({onClearFilter:a})=>{let{t:b}=(0,g.useTranslation)();return(0,c.jsxs)("div",{className:"relative z-0 flex h-full items-center justify-center",children:[(0,c.jsxs)("div",{className:"flex flex-col items-center",children:[(0,c.jsxs)("div",{className:"relative z-10 flex h-14 w-14 items-center justify-center rounded-xl border border-divider-subtle bg-components-card-bg shadow-lg shadow-shadow-shadow-5",children:[(0,c.jsx)(d.RiFileList2Line,{className:"h-6 w-6 text-text-secondary"}),(0,c.jsx)(bo,{className:"absolute -right-px top-1/2 -translate-y-1/2"}),(0,c.jsx)(bo,{className:"absolute -left-px top-1/2 -translate-y-1/2"}),(0,c.jsx)(bo,{className:"absolute left-1/2 top-0 -translate-x-1/2 -translate-y-1/2 rotate-90"}),(0,c.jsx)(bo,{className:"absolute left-1/2 top-full -translate-x-1/2 -translate-y-1/2 rotate-90"})]}),(0,c.jsx)("div",{className:"system-md-regular mt-3 text-text-tertiary",children:b("segment.empty",{ns:"datasetDocuments"})}),(0,c.jsx)("button",{type:"button",className:"system-sm-medium mt-1 text-text-accent",onClick:a,children:b("segment.clearFilter",{ns:"datasetDocuments"})})]}),(0,c.jsx)("div",{className:"absolute left-0 top-0 -z-20 flex h-full w-full flex-col gap-y-3 overflow-hidden",children:Array.from({length:10}).map((a,b)=>(0,c.jsx)(bn,{},b))}),(0,c.jsx)("div",{className:"absolute left-0 top-0 -z-10 h-full w-full bg-dataset-chunk-list-mask-bg"})]})}),bq=f.memo(()=>(0,c.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,c.jsx)("div",{className:"flex h-5 w-full items-center bg-state-base-hover",children:(0,c.jsx)("span",{className:"h-5 w-[30px] bg-state-base-hover-alt"})}),(0,c.jsx)("div",{className:"h-5 w-2/3 bg-state-base-hover"})]}));bq.displayName="Slice";let br=f.memo(()=>(0,c.jsxs)("div",{className:"relative z-10 flex w-full grow flex-col gap-y-3 overflow-y-hidden",children:[(0,c.jsx)("div",{className:"absolute bottom-14 left-0 top-0 z-20 h-full w-full bg-dataset-chunk-list-mask-bg"}),Array.from({length:15}).map((a,b)=>(0,c.jsx)(bq,{},b))]})),bs=({childChunks:a,parentChunkId:b,handleInputChange:e,handleAddNewChildChunk:i,enabled:j,onDelete:k,onClickSlice:l,total:n,inputValue:o,onClearFilter:p,isLoading:q,focused:r=!1})=>{let{t:s}=(0,g.useTranslation)(),t=(0,ae.useDocumentContext)(a=>a.parentMode),u=ax(a=>a.currChildChunk),[v,w]=(0,f.useState)(!0),x="paragraph"===t,y="full-doc"===t,z=""!==o&&y,{displayText:A,count:B,translationKey:C}=function(a,b,c,d){if(b){let a=c??0;return{displayText:0===a?"--":String((0,au.formatNumber)(a)),count:a,translationKey:"segment.searchResults"}}if(a){let a=c??0;return{displayText:0===a?"--":String((0,au.formatNumber)(a)),count:a,translationKey:"segment.childChunks"}}return{displayText:String((0,au.formatNumber)(d)),count:d,translationKey:"segment.childChunks"}}(y,z,n,a.length),D=`${A} ${s(C,{ns:"datasetDocuments",count:B})}`,E=y&&!q||!v,F=x?"hidden group-hover/card:inline-block":"";return(0,c.jsxs)("div",{className:(0,m.cn)("flex flex-col",j||r?"":"opacity-50 group-hover/card:opacity-100",x?"pb-2 pt-1":"grow px-3",y&&q&&"overflow-y-hidden"),children:[y&&(0,c.jsx)(h.default,{type:"horizontal",className:"my-1 h-px bg-divider-subtle"}),(0,c.jsxs)("div",{className:(0,m.cn)("flex items-center justify-between",y&&"sticky -top-2 left-0 bg-background-default pb-3 pt-2"),children:[(0,c.jsxs)("div",{className:(0,m.cn)("flex h-7 items-center rounded-lg pl-1 pr-3",x&&"cursor-pointer",x&&v&&"bg-dataset-child-chunk-expand-btn-bg",y&&"pl-0"),onClick:a=>{a.stopPropagation(),w(a=>!a)},children:[(()=>{if(!x)return null;let a=v?d.RiArrowRightSLine:d.RiArrowDownSLine;return(0,c.jsx)(a,{className:(0,m.cn)("mr-0.5 h-4 w-4 text-text-secondary",v&&"opacity-50")})})(),(0,c.jsx)("span",{className:"system-sm-semibold-uppercase text-text-secondary",children:D}),(0,c.jsx)("span",{className:(0,m.cn)("pl-1.5 text-xs font-medium text-text-quaternary",F),children:"·"}),(0,c.jsx)("button",{type:"button",className:(0,m.cn)("system-xs-semibold-uppercase px-1.5 py-1 text-components-button-secondary-accent-text",F,y&&q&&"text-components-button-secondary-accent-text-disabled"),onClick:a=>{a.stopPropagation(),i?.(b)},disabled:q,children:s("operation.add",{ns:"common"})})]}),y&&(0,c.jsx)(a8.default,{showLeftIcon:!0,showClearIcon:!0,wrapperClassName:"!w-52",value:o,onChange:a=>e?.(a.target.value),onClear:()=>e?.("")})]}),q&&(0,c.jsx)(br,{}),E&&(0,c.jsxs)("div",{className:(0,m.cn)("flex gap-x-0.5",y?"mb-6 grow":"items-center"),children:[x&&(0,c.jsx)("div",{className:"self-stretch",children:(0,c.jsx)(h.default,{type:"vertical",className:"mx-[7px] w-[2px] bg-text-accent-secondary"})}),a.length>0?(0,c.jsx)(bm.FormattedText,{className:(0,m.cn)("flex w-full flex-col !leading-6",x?"gap-y-2":"gap-y-3"),children:a.map(a=>{let b=a.updated_at!==a.created_at,d=u?.childChunkInfo?.id===a.id,e=b?`C-${a.position} \xb7 ${s("segment.edited",{ns:"datasetDocuments"})}`:`C-${a.position}`;return(0,c.jsx)(bl,{label:e,text:a.content,onDelete:()=>k?.(a.segment_id,a.id),className:"child-chunk",labelClassName:d?"bg-state-accent-solid text-text-primary-on-surface":"",labelInnerClassName:"text-[10px] font-semibold align-bottom leading-6",contentClassName:(0,m.cn)("!leading-6",d?"bg-state-accent-hover-alt text-text-primary":"text-text-secondary"),showDivider:!1,onClick:b=>{b.stopPropagation(),l?.(a)},offsetOptions:({rects:a})=>({mainAxis:y?-a.floating.width:12-a.floating.width,crossAxis:(20-a.floating.height)/2})},a.id)})}):""!==o?(0,c.jsx)("div",{className:"h-full w-full",children:(0,c.jsx)(bp,{onClearFilter:p})}):null]})]})};var bt=a.i(218865),bu=a.i(42550),bv=a.i(81492),bw=a.i(806686),bx=a.i(368206),by=a.i(829001),bz=a.i(192875);let bA=()=>{let{t:a}=(0,g.useTranslation)();return(0,c.jsxs)("div",{"data-testid":"parent-chunk-card-skeleton",className:"flex flex-col pb-2",children:[(0,c.jsx)(bz.SkeletonContainer,{className:"gap-y-0 p-1 pb-0",children:(0,c.jsxs)(bz.SkeletonContainer,{className:"gap-y-0.5 px-2 pt-1.5",children:[(0,c.jsxs)(bz.SkeletonRow,{className:"py-0.5",children:[(0,c.jsx)(bz.SkeletonRectangle,{className:"w-[72px] bg-text-quaternary"}),(0,c.jsx)(bz.SkeletonPoint,{className:"opacity-20"}),(0,c.jsx)(bz.SkeletonRectangle,{className:"w-24 bg-text-quaternary"}),(0,c.jsx)(bz.SkeletonPoint,{className:"opacity-20"}),(0,c.jsx)(bz.SkeletonRectangle,{className:"w-24 bg-text-quaternary"})]}),(0,c.jsx)(bz.SkeletonRow,{className:"py-0.5",children:(0,c.jsx)(bz.SkeletonRectangle,{className:"w-full bg-text-quaternary"})}),(0,c.jsx)(bz.SkeletonRow,{className:"py-0.5",children:(0,c.jsx)(bz.SkeletonRectangle,{className:"w-full bg-text-quaternary"})}),(0,c.jsx)(bz.SkeletonRow,{className:"py-0.5",children:(0,c.jsx)(bz.SkeletonRectangle,{className:"w-2/3 bg-text-quaternary"})})]})}),(0,c.jsx)("div",{className:"mt-0.5 flex items-center px-3",children:(0,c.jsx)("button",{type:"button",className:"system-xs-semibold-uppercase pt-0.5 text-components-button-secondary-accent-text-disabled",disabled:!0,children:a("operation.viewMore",{ns:"common"})})})]})};bA.displayName="ParentChunkCardSkelton";let bB=f.memo(bA),bC=a=>a.isCollapsed,bD=f.memo(({detail:a,isFullDocMode:b,className:d})=>{let{answer:e,content:f,sign_content:g}=a,h=ax(bC);return e?(0,c.jsxs)("div",{className:d,children:[(0,c.jsxs)("div",{className:"flex gap-x-1",children:[(0,c.jsx)("div",{className:"w-4 shrink-0 text-[13px] font-medium leading-[20px] text-text-tertiary",children:"Q"}),(0,c.jsx)(aF.Markdown,{className:(0,m.cn)("body-md-regular text-text-secondary",h?"line-clamp-2":"line-clamp-20"),content:f,customDisallowedElements:["input"]})]}),(0,c.jsxs)("div",{className:"flex gap-x-1",children:[(0,c.jsx)("div",{className:"w-4 shrink-0 text-[13px] font-medium leading-[20px] text-text-tertiary",children:"A"}),(0,c.jsx)(aF.Markdown,{className:(0,m.cn)("body-md-regular text-text-secondary",h?"line-clamp-2":"line-clamp-20"),content:e,customDisallowedElements:["input"]})]})]}):(0,c.jsx)(aF.Markdown,{className:(0,m.cn)("!mt-0.5 !text-text-secondary",b?"line-clamp-3":h?"line-clamp-2":"line-clamp-20",d),content:g||f||"",customDisallowedElements:["input"]})}),bE=f.memo(({detail:a={status:""},onClick:b,onChangeSwitch:e,onDelete:i,onDeleteChildChunk:j,handleAddNewChildChunk:k,onClickSlice:l,onClickEdit:n,loading:o=!0,className:p="",archived:q,embeddingAvailable:r,focused:s})=>{let{t:u}=(0,g.useTranslation)(),{id:v,position:w,enabled:x,content:y,sign_content:z,word_count:A,hit_count:B,answer:C,summary:D,keywords:F,child_chunks:G=[],created_at:H,updated_at:I,attachments:K=[]}=a,[L,M]=(0,f.useState)(!1),N=(0,ae.useDocumentContext)(a=>a.docForm),O=(0,ae.useDocumentContext)(a=>a.parentMode),P=(0,f.useMemo)(()=>N===E.ChunkingMode.text,[N]),Q=(0,f.useMemo)(()=>N===E.ChunkingMode.parentChild,[N]),R=(0,f.useMemo)(()=>N===E.ChunkingMode.parentChild&&"paragraph"===O,[N,O]),S=(0,f.useMemo)(()=>N===E.ChunkingMode.parentChild&&"full-doc"===O,[N,O]),T=(0,f.useMemo)(()=>(N!==E.ChunkingMode.parentChild||"full-doc"!==O)&&(0,aS.isAfter)(1e3*I,1e3*H),[N,O,I,H]),U=(0,f.useMemo)(()=>x||s.segmentContent?"":"opacity-50 group-hover/card:opacity-100",[x,s.segmentContent]),V=(0,f.useCallback)(()=>{(N!==E.ChunkingMode.parentChild||"full-doc"!==O)&&b?.()},[N,O,b]),W=(0,f.useMemo)(()=>{let a=(0,au.formatNumber)(A);return`${a} ${u("segment.characters",{ns:"datasetDocuments",count:A})}`},[A,u]),X=(0,f.useMemo)(()=>Q?u("segment.parentChunk",{ns:"datasetDocuments"}):u("segment.chunk",{ns:"datasetDocuments"}),[Q,u]),Y=(0,f.useMemo)(()=>K.map(a=>({name:a.name,mimeType:a.mime_type,sourceUrl:a.source_url,size:a.size,extension:a.extension})),[K]);return o?(0,c.jsx)(bB,{}):(0,c.jsxs)("div",{"data-testid":"segment-card",className:(0,m.cn)("chunk-card group/card w-full rounded-xl px-3",S?"":"pb-2 pt-2.5 hover:bg-dataset-chunk-detail-card-hover-bg",s.segmentContent?"bg-dataset-chunk-detail-card-hover-bg":"",p),onClick:V,children:[(0,c.jsx)("div",{className:"relative flex h-5 items-center justify-between",children:(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,c.jsx)(aP.SegmentIndexTag,{className:(0,m.cn)(U),iconClassName:s.segmentIndex?"text-text-accent":"",labelClassName:s.segmentIndex?"text-text-accent":"",positionId:w,label:S?X:"",labelPrefix:X}),(0,c.jsx)(aL.default,{}),(0,c.jsx)("div",{className:(0,m.cn)("system-xs-medium text-text-tertiary",U),children:W}),(0,c.jsx)(aL.default,{}),(0,c.jsx)("div",{className:(0,m.cn)("system-xs-medium text-text-tertiary",U),children:`${(0,au.formatNumber)(B)} ${u("segment.hitCount",{ns:"datasetDocuments"})}`}),T&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(aL.default,{}),(0,c.jsx)(bt.default,{text:u("segment.edited",{ns:"datasetDocuments"}),uppercase:!0,className:U})]})]}),S?null:(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsx)(J.default,{status:x?"enabled":"disabled",reverse:!0,textCls:"text-text-tertiary system-xs-regular"}),r&&(0,c.jsxs)("div",{className:"absolute -right-2.5 -top-2 z-20 hidden items-center gap-x-0.5 rounded-[10px] border-[0.5px] border-components-actionbar-border bg-components-actionbar-bg p-1 shadow-md backdrop-blur-[5px] group-hover/card:flex",children:[!q&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(t.default,{popupContent:"Edit",popupClassName:"text-text-secondary system-xs-medium",children:(0,c.jsx)("div",{"data-testid":"segment-edit-button",className:"flex h-6 w-6 shrink-0 cursor-pointer items-center justify-center rounded-lg hover:bg-state-base-hover",onClick:a=>{a.stopPropagation(),n?.()},children:(0,c.jsx)(d.RiEditLine,{className:"h-4 w-4 text-text-tertiary"})})}),(0,c.jsx)(t.default,{popupContent:"Delete",popupClassName:"text-text-secondary system-xs-medium",children:(0,c.jsx)("div",{"data-testid":"segment-delete-button",className:"group/delete flex h-6 w-6 shrink-0 cursor-pointer items-center justify-center rounded-lg hover:bg-state-destructive-hover",onClick:a=>{a.stopPropagation(),M(!0)},children:(0,c.jsx)(d.RiDeleteBinLine,{className:"h-4 w-4 text-text-tertiary group-hover/delete:text-text-destructive"})})}),(0,c.jsx)(h.default,{type:"vertical",className:"h-3.5 bg-divider-regular"})]}),(0,c.jsx)("div",{onClick:a=>a.stopPropagation(),className:"flex items-center",children:(0,c.jsx)(bv.default,{size:"md",disabled:q||a?.status!=="completed",defaultValue:x,onChange:async a=>{await e?.(a,v)}})})]})]})]})}),(0,c.jsx)(bD,{detail:{answer:C,content:y,sign_content:z},isFullDocMode:S,className:U}),Y.length>0&&(0,c.jsx)(bw.default,{images:Y,size:"md",className:"py-1"}),D&&(0,c.jsx)(bx.default,{summary:D,className:"mt-2"}),P&&(0,c.jsx)("div",{className:(0,m.cn)("flex flex-wrap items-center gap-2 py-1.5",U),children:F?.map(a=>(0,c.jsx)(by.default,{text:a},a))}),S?(0,c.jsx)("button",{type:"button",className:"system-xs-semibold-uppercase mb-2 mt-0.5 text-text-accent",onClick:()=>b?.(),children:u("operation.viewMore",{ns:"common"})}):null,R&&G.length>0&&(0,c.jsx)(bs,{parentChunkId:v,childChunks:G,enabled:x,onDelete:j,handleAddNewChildChunk:k,onClickSlice:l,focused:s.segmentContent}),L&&(0,c.jsx)(bu.default,{isShow:L,title:u("segment.delete",{ns:"datasetDocuments"}),confirmText:u("operation.sure",{ns:"common"}),onConfirm:async()=>{await i?.(v)},onCancel:()=>M(!1)})]})});var bF=a.i(817681);let bG=f.memo(()=>(0,c.jsxs)(bz.SkeletonContainer,{className:"gap-y-0 p-1 pb-2",children:[(0,c.jsxs)(bz.SkeletonContainer,{className:"gap-y-0.5 px-2 pt-1.5",children:[(0,c.jsxs)(bz.SkeletonRow,{className:"py-0.5",children:[(0,c.jsx)(bz.SkeletonRectangle,{className:"w-[72px] bg-text-quaternary"}),(0,c.jsx)(bz.SkeletonPoint,{className:"opacity-20"}),(0,c.jsx)(bz.SkeletonRectangle,{className:"w-24 bg-text-quaternary"}),(0,c.jsx)(bz.SkeletonPoint,{className:"opacity-20"}),(0,c.jsx)(bz.SkeletonRectangle,{className:"w-24 bg-text-quaternary"}),(0,c.jsxs)(bz.SkeletonRow,{className:"grow justify-end gap-1",children:[(0,c.jsx)(bz.SkeletonRectangle,{className:"w-12 bg-text-quaternary"}),(0,c.jsx)(bz.SkeletonRectangle,{className:"mx-1 w-2 bg-text-quaternary"})]})]}),(0,c.jsx)(bz.SkeletonRow,{className:"py-0.5",children:(0,c.jsx)(bz.SkeletonRectangle,{className:"w-full bg-text-quaternary"})}),(0,c.jsx)(bz.SkeletonRow,{className:"py-0.5",children:(0,c.jsx)(bz.SkeletonRectangle,{className:"w-full bg-text-quaternary"})}),(0,c.jsx)(bz.SkeletonRow,{className:"py-0.5",children:(0,c.jsx)(bz.SkeletonRectangle,{className:"w-2/3 bg-text-quaternary"})})]}),(0,c.jsx)(bz.SkeletonContainer,{className:"p-1 pb-2",children:(0,c.jsx)(bz.SkeletonRow,{children:(0,c.jsxs)(bz.SkeletonRow,{className:"h-7 gap-x-0.5 rounded-lg bg-dataset-child-chunk-expand-btn-bg pl-1 pr-3",children:[(0,c.jsx)(d.RiArrowRightSLine,{className:"h-4 w-4 text-text-secondary opacity-20"}),(0,c.jsx)(bz.SkeletonRectangle,{className:"w-32 bg-text-quaternary"})]})})})]}));bG.displayName="CardSkelton";let bH=f.memo(()=>(0,c.jsxs)("div",{className:"relative z-10 flex h-full flex-col overflow-y-hidden",children:[(0,c.jsx)("div",{className:"absolute left-0 top-0 z-20 h-full w-full bg-dataset-chunk-list-mask-bg"}),Array.from({length:10}).map((a,b)=>(0,c.jsxs)("div",{className:"flex items-start gap-x-2",children:[(0,c.jsx)(aD.default,{className:"mt-3.5 shrink-0",disabled:!0},`${b}-checkbox`),(0,c.jsxs)("div",{className:"grow",children:[(0,c.jsx)(bG,{}),9!==b&&(0,c.jsx)("div",{className:"w-full px-3",children:(0,c.jsx)(h.default,{type:"horizontal",className:"my-1 bg-divider-subtle"})})]})]},b))]})),bI=({ref:a,isLoading:b,items:d,selectedSegmentIds:e,onSelected:g,onClick:i,onChangeSwitch:j,onDelete:k,onDeleteChildChunk:l,handleAddNewChildChunk:m,onClickSlice:n,archived:o,embeddingAvailable:p,onClearFilter:q})=>{let r=(0,ae.useDocumentContext)(a=>a.docForm),s=(0,ae.useDocumentContext)(a=>a.parentMode),t=ax(a=>a.currSegment),u=ax(a=>a.currChildChunk),v=(0,f.useMemo)(()=>r===E.ChunkingMode.parentChild&&"paragraph"===s?bH:bF.default,[r,s]);return b?(0,c.jsx)(v,{}):0===d.length?(0,c.jsx)("div",{className:"h-full pl-6",children:(0,c.jsx)(bp,{onClearFilter:q})}):(0,c.jsx)("div",{ref:a,className:"flex grow flex-col overflow-y-auto",children:d.map(a=>{let b=d[d.length-1].id===a.id,f=t?.segInfo?.id===a.id||!t&&u?.childChunkInfo?.segment_id===a.id,q=t?.segInfo?.id===a.id||u?.childChunkInfo?.segment_id===a.id;return(0,c.jsxs)("div",{className:"flex items-start gap-x-2",children:[(0,c.jsx)(aD.default,{className:"mt-3.5 shrink-0",checked:e.includes(a.id),onCheck:()=>g(a.id)},`${a.id}-checkbox`),(0,c.jsxs)("div",{className:"min-w-0 grow",children:[(0,c.jsx)(bE,{detail:a,onClick:()=>i(a,!0),onChangeSwitch:j,onClickEdit:()=>i(a,!0),onDelete:k,onDeleteChildChunk:l,handleAddNewChildChunk:m,onClickSlice:n,loading:!1,archived:o,embeddingAvailable:p,focused:{segmentIndex:f,segmentContent:q}},`${a.id}-card`),!b&&(0,c.jsx)("div",{className:"w-full px-3",children:(0,c.jsx)(h.default,{type:"horizontal",className:"my-1 bg-divider-subtle"})})]})]},a.id)})})};bI.displayName="SegmentList";let bJ=({segments:a,childSegments:b,isLoadingSegmentList:d,isLoadingChildSegmentList:e,currSegmentId:f,onClickCard:g,onDeleteChildChunk:h,handleInputChange:i,handleAddNewChildChunk:j,onClickSlice:k,archived:l,childChunkTotal:n,inputValue:o,onClearFilter:p})=>{let q=a[0];return(0,c.jsxs)("div",{className:(0,m.cn)("flex grow flex-col overflow-x-hidden",d||e?"overflow-y-hidden":"overflow-y-auto"),children:[(0,c.jsx)(bE,{detail:q,onClick:()=>g(q),loading:d,focused:{segmentIndex:f===q?.id,segmentContent:f===q?.id}}),(0,c.jsx)(bs,{parentChunkId:q?.id,onDelete:h,childChunks:b,handleInputChange:i,handleAddNewChildChunk:j,onClickSlice:k,enabled:!l,total:n,inputValue:o,onClearFilter:p,isLoading:d||e})]})},bK=({segmentListRef:a,embeddingAvailable:b,isLoadingSegmentList:d,segments:e,selectedSegmentIds:f,onSelected:g,onChangeSwitch:h,onDelete:i,onClickCard:j,archived:k,onDeleteChildChunk:l,handleAddNewChildChunk:m,onClickSlice:n,onClearFilter:o})=>(0,c.jsx)(bI,{ref:a,embeddingAvailable:b,isLoading:d,items:e,selectedSegmentIds:f,onSelected:g,onChangeSwitch:h,onDelete:i,onClick:j,archived:k,onDeleteChildChunk:l,handleAddNewChildChunk:m,onClickSlice:n,onClearFilter:o});var bL=a.i(749249),bM=a.i(981133),bN=a.i(497746),bO=a.i(205628),bP=a.i(234782),bQ=a.i(681073),bR=a.i(931164),bS=a.i(375616),bT=((b={}).WAITING="waiting",b.PROCESSING="processing",b.COMPLETED="completed",b.ERROR="error",b);let bU=f.memo(({importStatus:a,clearProcessStatus:b,showNewSegmentModal:e,showBatchModal:h,embedding:i})=>{let{t:j}=(0,g.useTranslation)(),[k,{setTrue:l,setFalse:n}]=(0,bN.useBoolean)(!1),{plan:o,enableBilling:p}=(0,bS.useProviderContext)(),{type:q}=o,r=!p||q!==bR.Plan.sandbox,s=(0,f.useCallback)(a=>()=>{r?a():l()},[r,l]),t=(0,f.useMemo)(()=>i?"text-components-button-secondary-accent-text-disabled":"text-components-button-secondary-accent-text",[i]);return a?(0,c.jsxs)(c.Fragment,{children:[("waiting"===a||"processing"===a)&&(0,c.jsxs)("div",{className:"relative mr-2 inline-flex items-center overflow-hidden rounded-lg border-[0.5px] border-components-progress-bar-border bg-components-progress-bar-border px-2.5 py-2 text-components-button-secondary-accent-text shadow-xs shadow-shadow-shadow-3 backdrop-blur-[5px]",children:[(0,c.jsx)("div",{className:(0,m.cn)("absolute left-0 top-0 z-0 h-full border-r-[1.5px] border-r-components-progress-bar-progress-highlight bg-components-progress-bar-progress","waiting"===a?"w-3/12":"w-2/3")}),(0,c.jsx)(d.RiLoader2Line,{className:"mr-1 h-4 w-4 animate-spin"}),(0,c.jsx)("span",{className:"system-sm-medium z-10 pr-0.5",children:j("list.batchModal.processing",{ns:"datasetDocuments"})})]}),"completed"===a&&(0,c.jsxs)("div",{className:"relative mr-2 inline-flex items-center overflow-hidden rounded-lg border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-xs shadow-shadow-shadow-3 backdrop-blur-[5px]",children:[(0,c.jsxs)("div",{className:"inline-flex items-center border-r border-r-divider-subtle px-2.5 py-2 text-text-success",children:[(0,c.jsx)(bO.CheckCircle,{className:"mr-1 h-4 w-4"}),(0,c.jsx)("span",{className:"system-sm-medium pr-0.5",children:j("list.batchModal.completed",{ns:"datasetDocuments"})})]}),(0,c.jsx)("div",{className:"m-1 inline-flex items-center",children:(0,c.jsx)("span",{className:"system-xs-medium cursor-pointer rounded-md px-1.5 py-1 text-components-button-ghost-text hover:bg-components-button-ghost-bg-hover",onClick:b,children:j("list.batchModal.ok",{ns:"datasetDocuments"})})}),(0,c.jsx)("div",{className:"absolute left-0 top-0 -z-10 h-full w-full bg-dataset-chunk-process-success-bg opacity-40"})]}),"error"===a&&(0,c.jsxs)("div",{className:"relative mr-2 inline-flex items-center overflow-hidden rounded-lg border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-xs shadow-shadow-shadow-3 backdrop-blur-[5px]",children:[(0,c.jsxs)("div",{className:"inline-flex items-center border-r border-r-divider-subtle px-2.5 py-2 text-text-destructive",children:[(0,c.jsx)(d.RiErrorWarningFill,{className:"mr-1 h-4 w-4"}),(0,c.jsx)("span",{className:"system-sm-medium pr-0.5",children:j("list.batchModal.error",{ns:"datasetDocuments"})})]}),(0,c.jsx)("div",{className:"m-1 inline-flex items-center",children:(0,c.jsx)("span",{className:"system-xs-medium cursor-pointer rounded-md px-1.5 py-1 text-components-button-ghost-text hover:bg-components-button-ghost-bg-hover",onClick:b,children:j("list.batchModal.ok",{ns:"datasetDocuments"})})}),(0,c.jsx)("div",{className:"absolute left-0 top-0 -z-10 h-full w-full bg-dataset-chunk-process-error-bg opacity-40"})]})]}):(0,c.jsxs)("div",{className:(0,m.cn)("relative z-20 flex items-center rounded-lg border-[0.5px] border-components-button-secondary-border bg-components-button-secondary-bg shadow-xs shadow-shadow-shadow-3 backdrop-blur-[5px]",i&&"border-components-button-secondary-border-disabled bg-components-button-secondary-bg-disabled"),children:[(0,c.jsxs)("button",{type:"button",className:`inline-flex items-center rounded-l-lg border-r-[1px] border-r-divider-subtle px-2.5 py-2
          hover:bg-state-base-hover disabled:cursor-not-allowed disabled:hover:bg-transparent`,onClick:s(e),disabled:i,children:[(0,c.jsx)(d.RiAddLine,{className:(0,m.cn)("h-4 w-4",t)}),(0,c.jsx)("span",{className:(0,m.cn)("ml-0.5 px-0.5 text-[13px] font-medium capitalize leading-[16px]",t),children:j("list.action.addButton",{ns:"datasetDocuments"})})]}),(0,c.jsx)(bP.default,{position:"br",manualClose:!0,trigger:"click",htmlContent:(0,c.jsx)("div",{className:"w-full p-1",children:(0,c.jsx)("button",{type:"button",className:"system-md-regular flex w-full items-center rounded-lg px-2 py-1.5 text-text-secondary",onClick:s(h),children:j("list.action.batchAdd",{ns:"datasetDocuments"})})}),btnElement:(0,c.jsx)("div",{className:"flex items-center justify-center",children:(0,c.jsx)(d.RiArrowDownSLine,{className:(0,m.cn)("h-4 w-4",t)})}),btnClassName:a=>(0,m.cn)(`!hover:bg-state-base-hover !rounded-l-none !rounded-r-lg !border-0 !p-2 backdrop-blur-[5px]
          disabled:cursor-not-allowed disabled:bg-transparent disabled:hover:bg-transparent`,a?"!bg-state-base-hover":""),popupClassName:"!min-w-[128px] !bg-components-panel-bg-blur !rounded-xl border-[0.5px] !ring-0 border-components-panel-border !shadow-xl !shadow-shadow-shadow-5 backdrop-blur-[5px]",className:"h-fit min-w-[128px]",disabled:i}),k&&(0,c.jsx)(bQ.default,{show:!0,onClose:n,title:j("upgrade.addChunks.title",{ns:"billing"}),description:j("upgrade.addChunks.description",{ns:"billing"})})]})}),bV=({embeddingAvailable:a,showNewSegmentModal:b,onNewSegmentModalChange:d,importStatus:i,archived:j})=>{let l=(0,ae.useDocumentContext)(a=>a.docForm),[m,n]=(0,f.useState)(1),[o,p]=(0,f.useState)(10),q=(a=>{let{t:b}=(0,g.useTranslation)(),{onPageChange:c}=a,[d,e]=(0,f.useState)(""),[h,i]=(0,f.useState)(""),[j,k]=(0,f.useState)("all"),l=(0,f.useRef)([{value:"all",name:b("list.index.all",{ns:"datasetDocuments"})},{value:0,name:b("list.status.disabled",{ns:"datasetDocuments"})},{value:1,name:b("list.status.enabled",{ns:"datasetDocuments"})}]),{run:m}=(0,bM.useDebounceFn)(()=>{i(d),c(1)},{wait:500}),n=(0,f.useCallback)(a=>{e(a),m()},[m]),o=(0,f.useCallback)(({value:a})=>{k("all"===a?"all":!!a),c(1)},[c]),p=(0,f.useCallback)(()=>{e(""),i(""),k("all"),c(1)},[c]),q=(0,f.useCallback)(()=>{c(1)},[c]),r=(0,f.useMemo)(()=>"all"===j?"all":+!!j,[j]);return{inputValue:d,searchValue:h,selectedStatus:j,statusList:l.current,selectDefaultValue:r,handleInputChange:n,onChangeStatus:o,onClearFilter:p,resetPage:q}})({onPageChange:n}),r=(a=>{let{onNewSegmentModalChange:b}=a,[c,d]=(0,f.useState)({showModal:!1}),[e,g]=(0,f.useState)({showModal:!1}),[h,i]=(0,f.useState)(""),[j,k]=(0,f.useState)(!1),[l,m]=(0,f.useState)(!1),[n,o]=(0,f.useState)(!1),[p,q]=(0,f.useState)(!0),r=(0,f.useCallback)((a,b=!1)=>{d({segInfo:a,showModal:!0,isEditMode:b})},[]),s=(0,f.useCallback)(()=>{d({showModal:!1}),o(!1)},[]),t=(0,f.useCallback)(a=>{g({childChunkInfo:a,showModal:!0}),i(a.segment_id)},[]),u=(0,f.useCallback)(()=>{g({showModal:!1}),o(!1)},[]),v=(0,f.useCallback)(()=>{b(!1),o(!1)},[b]),w=(0,f.useCallback)(a=>{k(!0),i(a)},[]),x=(0,f.useCallback)(()=>{k(!1),o(!1)},[]);return{currSegment:c,onClickCard:r,onCloseSegmentDetail:s,currChildChunk:e,currChunkId:h,onClickSlice:t,onCloseChildSegmentDetail:u,onCloseNewSegmentModal:v,showNewChildSegmentModal:j,handleAddNewChildChunk:w,onCloseNewChildChunkModal:x,isRegenerationModalOpen:l,setIsRegenerationModalOpen:m,fullScreen:n,toggleFullScreen:(0,f.useCallback)(()=>{o(a=>!a)},[]),setFullScreen:o,isCollapsed:p,toggleCollapsed:(0,f.useCallback)(()=>{q(a=>!a)},[])}})({onNewSegmentModalChange:d}),[s,t]=(0,f.useState)([]),u=(0,H.useInvalid)(G.useChunkListAllKey),v=(0,H.useInvalid)(G.useChunkListEnabledKey),w=(0,H.useInvalid)(G.useChunkListDisabledKey),x=(0,f.useCallback)(()=>{({all:()=>{w(),v()},true:()=>{u(),w()},false:()=>{u(),v()}})[String(q.selectedStatus)]?.()},[q.selectedStatus,w,v,u]),y=(a=>{let{searchValue:b,selectedStatus:c,selectedSegmentIds:d,importStatus:h,currentPage:i,limit:j,onCloseSegmentDetail:l,clearSelection:m}=a,{t:n}=(0,g.useTranslation)(),{notify:o}=(0,k.useToastContext)(),p=(0,e.usePathname)(),{eventEmitter:q}=(0,aR.useEventEmitterContextContext)(),r=(0,bL.useQueryClient)(),s=(0,ae.useDocumentContext)(a=>a.datasetId)||"",t=(0,ae.useDocumentContext)(a=>a.documentId)||"",u=(0,ae.useDocumentContext)(a=>a.docForm),v=(0,ae.useDocumentContext)(a=>a.parentMode),w=(0,f.useRef)(null),x=(0,f.useRef)(!1),y=(0,f.useMemo)(()=>u===E.ChunkingMode.parentChild&&"full-doc"===v,[u,v]),z=(0,f.useMemo)(()=>({page:y?1:i,limit:y?10:j,keyword:y?"":b,enabled:c}),[y,i,j,b,c]),A=(0,f.useMemo)(()=>[...G.useSegmentListKey,s,t,z],[s,t,z]),{isLoading:B,data:C}=(0,G.useSegmentList)({datasetId:s,documentId:t,params:z}),D=(0,f.useMemo)(()=>C?.data||[],[C]),F=(0,H.useInvalid)(G.useSegmentListKey),I=(0,H.useInvalid)(G.useChunkListAllKey),J=(0,H.useInvalid)(G.useChunkListEnabledKey),K=(0,H.useInvalid)(G.useChunkListDisabledKey);(0,f.useEffect)(()=>{w.current&&x.current&&(w.current.scrollTo({top:w.current.scrollHeight,behavior:"smooth"}),x.current=!1)},[D]),(0,f.useEffect)(()=>{m(),F()},[p]),(0,f.useEffect)(()=>{h===bT.COMPLETED&&(m(),F())},[h]);let L=(0,f.useCallback)(()=>{m(),F()},[m,F]),M=(0,f.useCallback)(()=>{"all"===c?(K(),J()):F()},[c,K,J,F]),N=(0,f.useCallback)(()=>{({all:()=>{K(),J()},true:()=>{I(),K()},false:()=>{I(),J()}})[String(c)]?.()},[c,K,J,I]),O=(0,f.useCallback)((a,b)=>{r.setQueryData(A,c=>c?{...c,data:c.data.map(c=>c.id===a?b(c):c)}:c)},[r,A]),P=(0,f.useCallback)((a,b)=>{r.setQueryData(A,c=>c?{...c,data:c.data.map(c=>a.includes(c.id)?b(c):c)}:c)},[r,A]),{mutateAsync:Q}=(0,G.useEnableSegment)(),{mutateAsync:R}=(0,G.useDisableSegment)(),{mutateAsync:S}=(0,G.useDeleteSegment)(),{mutateAsync:T}=(0,G.useUpdateSegment)(),U=(0,f.useCallback)(async(a,b)=>{let c=a?Q:R,e=b?[b]:d;await c({datasetId:s,documentId:t,segmentIds:e},{onSuccess:()=>{o({type:"success",message:n("actionMsg.modifiedSuccessfully",{ns:"common"})}),P(e,b=>({...b,enabled:a})),M()},onError:()=>{o({type:"error",message:n("actionMsg.modifiedUnsuccessfully",{ns:"common"})})}})},[s,t,d,R,Q,n,o,P,M]),V=(0,f.useCallback)(async a=>{let b=a?[a]:d;await S({datasetId:s,documentId:t,segmentIds:b},{onSuccess:()=>{o({type:"success",message:n("actionMsg.modifiedSuccessfully",{ns:"common"})}),L(),a||m()},onError:()=>{o({type:"error",message:n("actionMsg.modifiedUnsuccessfully",{ns:"common"})})}})},[s,t,d,S,L,m,n,o]),W=(0,f.useCallback)(async(a,b,c,d,e,f,g=!1)=>{let h={content:"",attachment_ids:[]};if(u===E.ChunkingMode.qa){if(!b.trim())return void o({type:"error",message:n("segment.questionEmpty",{ns:"datasetDocuments"})});if(!c.trim())return void o({type:"error",message:n("segment.answerEmpty",{ns:"datasetDocuments"})});h.content=b,h.answer=c}else{if(!b.trim())return void o({type:"error",message:n("segment.contentEmpty",{ns:"datasetDocuments"})});h.content=b}if(d.length&&(h.keywords=d),e.length){if(e.some(a=>!a.uploadedId))return void o({type:"error",message:n("segment.allFilesUploaded",{ns:"datasetDocuments"})});h.attachment_ids=e.map(a=>a.uploadedId)}h.summary=f??"",g&&(h.regenerate_child_chunks=g),q?.emit("update-segment"),await T({datasetId:s,documentId:t,segmentId:a,body:h},{onSuccess(b){o({type:"success",message:n("actionMsg.modifiedSuccessfully",{ns:"common"})}),g||l(),O(a,a=>({...a,answer:b.data.answer,content:b.data.content,sign_content:b.data.sign_content,keywords:b.data.keywords,attachments:b.data.attachments,summary:b.data.summary,word_count:b.data.word_count,hit_count:b.data.hit_count,enabled:b.data.enabled,updated_at:b.data.updated_at,child_chunks:b.data.child_chunks})),N(),q?.emit("update-segment-success")},onSettled(){q?.emit("update-segment-done")}})},[s,t,u,T,o,q,l,O,N,n]),X=(0,f.useCallback)(()=>{let a=C?.total_pages||0,b=Math.ceil(((C?.total||0)+1)/j);x.current=!0,b>a||L()},[C,j,L]),Y=(0,f.useMemo)(()=>{if(""===b&&"all"===c){let a=C?.total?(0,au.formatNumber)(C.total):"--",b="--"===a?0:C.total,c=u===E.ChunkingMode.parentChild&&"paragraph"===v?"segment.parentChunks":"segment.chunks";return`${a} ${n(c,{ns:"datasetDocuments",count:b})}`}let a="number"==typeof C?.total?(0,au.formatNumber)(C.total):0,d=C?.total||0;return`${a} ${n("segment.searchResults",{ns:"datasetDocuments",count:d})}`},[C,u,v,b,c,n]);return{segments:D,isLoadingSegmentList:B,segmentListData:C,totalText:Y,isFullDocMode:y,segmentListRef:w,needScrollToBottom:x,onChangeSwitch:U,onDelete:V,handleUpdateSegment:W,resetList:L,viewNewlyAddedChunk:X,invalidSegmentList:F,updateSegmentInCache:O}})({searchValue:q.searchValue,selectedStatus:q.selectedStatus,selectedSegmentIds:s,importStatus:i,currentPage:m,limit:o,onCloseSegmentDetail:r.onCloseSegmentDetail,clearSelection:()=>t([])}),z=(a=>{let[b,c]=(0,f.useState)([]),d=(0,f.useCallback)(a=>{c(b=>b.includes(a)?b.filter(b=>b!==a):[...b,a])},[]),e=(0,f.useMemo)(()=>a.length>0&&a.every(a=>b.includes(a.id)),[a,b]),g=(0,f.useMemo)(()=>a.some(a=>b.includes(a.id)),[a,b]),h=(0,f.useCallback)(()=>{c(b=>{let c=a.map(a=>a.id);return[...b.filter(a=>!c.includes(a)),...e?[]:c]})},[a,e]);return{selectedSegmentIds:b,isAllSelected:e,isSomeSelected:g,onSelected:d,onSelectedAll:h,onCancelBatchOperation:(0,f.useCallback)(()=>{c([])},[]),clearSelection:(0,f.useCallback)(()=>{c([])},[])}})(y.segments);(0,f.useMemo)(()=>{t(z.selectedSegmentIds)},[z.selectedSegmentIds]);let A=(a=>{let{searchValue:b,currentPage:c,limit:d,segments:e,currChunkId:h,isFullDocMode:i,onCloseChildSegmentDetail:j,refreshChunkListDataWithDetailChanged:l,updateSegmentInCache:m}=a,{t:n}=(0,g.useTranslation)(),{notify:o}=(0,k.useToastContext)(),{eventEmitter:p}=(0,aR.useEventEmitterContextContext)(),q=(0,bL.useQueryClient)(),r=(0,ae.useDocumentContext)(a=>a.datasetId)||"",s=(0,ae.useDocumentContext)(a=>a.documentId)||"",t=(0,ae.useDocumentContext)(a=>a.parentMode),u=(0,f.useRef)(null),v=(0,f.useRef)(!1),w=(0,f.useMemo)(()=>({page:0===c?1:c,limit:d,keyword:b}),[c,d,b]),x=e[0]?.id||"",y=(0,f.useMemo)(()=>[...G.useChildSegmentListKey,r,s,x,w],[r,s,x,w]),{isLoading:z,data:A}=(0,G.useChildSegmentList)({datasetId:r,documentId:s,segmentId:x,params:w},!i||0===e.length),B=(0,f.useMemo)(()=>A?.data||[],[A]),C=(0,H.useInvalid)(G.useChildSegmentListKey);(0,f.useEffect)(()=>{u.current&&v.current&&(u.current.scrollTo({top:u.current.scrollHeight,behavior:"smooth"}),v.current=!1)},[B]);let D=(0,f.useCallback)(()=>{C()},[C]),E=(0,f.useCallback)((a,b)=>{q.setQueryData(y,c=>c?{...c,data:c.data.map(c=>c.id===a?b(c):c)}:c)},[q,y]),{mutateAsync:F}=(0,G.useDeleteChildSegment)(),{mutateAsync:I}=(0,G.useUpdateChildSegment)(),J=(0,f.useCallback)(async(a,b)=>{await F({datasetId:r,documentId:s,segmentId:a,childChunkId:b},{onSuccess:()=>{o({type:"success",message:n("actionMsg.modifiedSuccessfully",{ns:"common"})}),"paragraph"===t?m(a,a=>({...a,child_chunks:a.child_chunks?.filter(a=>a.id!==b)})):D()},onError:()=>{o({type:"error",message:n("actionMsg.modifiedUnsuccessfully",{ns:"common"})})}})},[r,s,t,F,m,D,n,o]),K=(0,f.useCallback)(async(a,b,c)=>{let d={content:""};c.trim()?(d.content=c,p?.emit("update-child-segment"),await I({datasetId:r,documentId:s,segmentId:a,childChunkId:b,body:d},{onSuccess:c=>{o({type:"success",message:n("actionMsg.modifiedSuccessfully",{ns:"common"})}),j(),"paragraph"===t?(m(a,a=>({...a,child_chunks:a.child_chunks?.map(a=>a.id===b?{...a,content:c.data.content,type:c.data.type,word_count:c.data.word_count,updated_at:c.data.updated_at}:a)})),l()):E(b,a=>({...a,content:c.data.content,type:c.data.type,word_count:c.data.word_count,updated_at:c.data.updated_at}))},onSettled:()=>{p?.emit("update-child-segment-done")}})):o({type:"error",message:n("segment.contentEmpty",{ns:"datasetDocuments"})})},[r,s,t,I,o,p,j,m,E,l,n]),L=(0,f.useCallback)(a=>{"paragraph"===t?(m(h,b=>({...b,child_chunks:[...b.child_chunks||[],a]})),l()):D()},[t,h,m,l,D]),M=(0,f.useCallback)(()=>{let a=A?.total_pages||0,b=Math.ceil(((A?.total||0)+1)/d);v.current=!0,b>a||D()},[A,d,D]);return{childSegments:B,isLoadingChildSegmentList:z,childChunkListData:A,childSegmentListRef:u,needScrollToBottom:v,onDeleteChildChunk:J,handleUpdateChildChunk:K,onSaveNewChildChunk:L,resetChildList:D,viewNewlyAddedChildChunk:M}})({searchValue:q.searchValue,currentPage:m,limit:o,segments:y.segments,currChunkId:r.currChunkId,isFullDocMode:y.isFullDocMode,onCloseChildSegmentDetail:r.onCloseChildSegmentDetail,refreshChunkListDataWithDetailChanged:x,updateSegmentInCache:y.updateSegmentInCache}),B=(0,f.useMemo)(()=>y.isFullDocMode?A.childChunkListData?.total||0:y.segmentListData?.total||0,[y.isFullDocMode,A.childChunkListData,y.segmentListData]),C=(0,f.useCallback)(a=>{n(a+1)},[]),D=(0,f.useMemo)(()=>({isCollapsed:r.isCollapsed,fullScreen:r.fullScreen,toggleFullScreen:r.toggleFullScreen,currSegment:r.currSegment,currChildChunk:r.currChildChunk}),[r.isCollapsed,r.fullScreen,r.toggleFullScreen,r.currSegment,r.currChildChunk]);return(0,c.jsxs)(aw.Provider,{value:D,children:[!y.isFullDocMode&&(0,c.jsx)(be,{isAllSelected:z.isAllSelected,isSomeSelected:z.isSomeSelected,onSelectedAll:z.onSelectedAll,isLoading:y.isLoadingSegmentList,totalText:y.totalText,statusList:q.statusList,selectDefaultValue:q.selectDefaultValue,onChangeStatus:q.onChangeStatus,inputValue:q.inputValue,onInputChange:q.handleInputChange,isCollapsed:r.isCollapsed,toggleCollapsed:r.toggleCollapsed}),y.isFullDocMode?(0,c.jsx)(bJ,{segments:y.segments,childSegments:A.childSegments,isLoadingSegmentList:y.isLoadingSegmentList,isLoadingChildSegmentList:A.isLoadingChildSegmentList,currSegmentId:r.currSegment?.segInfo?.id,onClickCard:r.onClickCard,onDeleteChildChunk:A.onDeleteChildChunk,handleInputChange:q.handleInputChange,handleAddNewChildChunk:r.handleAddNewChildChunk,onClickSlice:r.onClickSlice,archived:j,childChunkTotal:A.childChunkListData?.total||0,inputValue:q.inputValue,onClearFilter:q.onClearFilter}):(0,c.jsx)(bK,{segmentListRef:y.segmentListRef,embeddingAvailable:a,isLoadingSegmentList:y.isLoadingSegmentList,segments:y.segments,selectedSegmentIds:z.selectedSegmentIds,onSelected:z.onSelected,onChangeSwitch:y.onChangeSwitch,onDelete:y.onDelete,onClickCard:r.onClickCard,archived:j,onDeleteChildChunk:A.onDeleteChildChunk,handleAddNewChildChunk:r.handleAddNewChildChunk,onClickSlice:r.onClickSlice,onClearFilter:q.onClearFilter}),(0,c.jsx)(h.default,{type:"horizontal",className:"mx-6 my-0 h-px w-auto bg-divider-subtle"}),(0,c.jsx)(ad.default,{current:m-1,onChange:C,total:B,limit:o,onLimitChange:p,className:y.isFullDocMode?"px-3":""}),l&&(0,c.jsx)(a7,{currSegment:r.currSegment,onCloseSegmentDetail:r.onCloseSegmentDetail,onUpdateSegment:y.handleUpdateSegment,isRegenerationModalOpen:r.isRegenerationModalOpen,setIsRegenerationModalOpen:r.setIsRegenerationModalOpen,showNewSegmentModal:b,onCloseNewSegmentModal:r.onCloseNewSegmentModal,onSaveNewSegment:y.resetList,viewNewlyAddedChunk:y.viewNewlyAddedChunk,currChildChunk:r.currChildChunk,currChunkId:r.currChunkId,onCloseChildSegmentDetail:r.onCloseChildSegmentDetail,onUpdateChildChunk:A.handleUpdateChildChunk,showNewChildSegmentModal:r.showNewChildSegmentModal,onCloseNewChildChunkModal:r.onCloseNewChildChunkModal,onSaveNewChildChunk:A.onSaveNewChildChunk,viewNewlyAddedChildChunk:A.viewNewlyAddedChildChunk,fullScreen:r.fullScreen,docForm:l}),z.selectedSegmentIds.length>0&&(0,c.jsx)(af.default,{className:"absolute bottom-16 left-0 z-20",selectedIds:z.selectedSegmentIds,onBatchEnable:()=>y.onChangeSwitch(!0,""),onBatchDisable:()=>y.onChangeSwitch(!1,""),onBatchDelete:()=>y.onDelete(""),onCancel:z.onCancelBatchOperation})]})};var bW=a.i(463561),bX=a.i(12588),bY=a.i(825319),bZ=a.i(260208),b$=a.i(42521),b_=a.i(429625);let b0=f.memo(({datasetId:a,value:b,onChange:e})=>{let{t:h}=(0,g.useTranslation)(),{name:i,extension:k,chunkingMode:l,parentMode:n}=b,[o,p]=(0,f.useState)(""),{data:q}=(0,F.useDocumentList)({datasetId:a,query:{keyword:o,page:1,limit:20}}),r=q?.data,s=l===E.ChunkingMode.text,t=l===E.ChunkingMode.parentChild,u=l===E.ChunkingMode.qa,v=t?bX.ParentChildChunk:bW.GeneralChunk,[w,{set:x,toggle:y}]=(0,bN.useBoolean)(!1),z=d.RiArrowDownSLine,A=(0,f.useCallback)(({id:a})=>{e(r?.find(b=>b.id===a)),x(!1)},[r,e,x]),B=(0,f.useMemo)(()=>n?"paragraph"===n?h("parentMode.paragraph",{ns:"dataset"}):h("parentMode.fullDoc",{ns:"dataset"}):"--",[n,h]);return(0,c.jsxs)(bY.PortalToFollowElem,{open:w,onOpenChange:x,placement:"bottom-start",children:[(0,c.jsx)(bY.PortalToFollowElemTrigger,{onClick:y,children:(0,c.jsxs)("div",{className:(0,m.cn)("ml-1 flex cursor-pointer select-none items-center rounded-lg px-2 py-0.5 hover:bg-state-base-hover",w&&"bg-state-base-hover"),children:[(0,c.jsx)(b$.default,{name:i,extension:k,size:"xl"}),(0,c.jsxs)("div",{className:"ml-1 mr-0.5 flex flex-col items-start",children:[(0,c.jsxs)("div",{className:"flex items-center space-x-0.5",children:[(0,c.jsxs)("span",{className:(0,m.cn)("system-md-semibold text-text-primary"),children:[" ",i||"--"]}),(0,c.jsx)(z,{className:"h-4 w-4 text-text-primary"})]}),(0,c.jsxs)("div",{className:"flex h-3 items-center space-x-0.5 text-text-tertiary",children:[(0,c.jsx)(v,{className:"h-3 w-3"}),(0,c.jsxs)("span",{className:(0,m.cn)("system-2xs-medium-uppercase",t&&"mt-0.5"),children:[s&&h("chunkingMode.general",{ns:"dataset"}),u&&h("chunkingMode.qa",{ns:"dataset"}),t&&`${h("chunkingMode.parentChild",{ns:"dataset"})} \xb7 ${B}`]})]})]})]})}),(0,c.jsx)(bY.PortalToFollowElemContent,{className:"z-[11]",children:(0,c.jsxs)("div",{className:"w-[360px] rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur p-1 pt-2 shadow-lg backdrop-blur-[5px]",children:[(0,c.jsx)(bZ.default,{value:o,onChange:p,className:"mx-1"}),r?(0,c.jsx)(b_.default,{className:"mt-2",list:r.map(a=>({id:a.id,name:a.name,extension:a.data_source_detail_dict?.upload_file?.extension||""})),onChange:A}):(0,c.jsx)("div",{className:"mt-2 flex h-[100px] w-[360px] items-center justify-center",children:(0,c.jsx)(j.default,{})})]})})]})}),b1=({datasetId:a,extension:b,name:d,chunkingMode:f,parent_mode:g,wrapperCls:h})=>{let i=(0,e.useRouter)();return(0,c.jsx)("div",{className:(0,m.cn)("flex flex-1 items-center justify-start",h),children:(0,c.jsx)(b0,{datasetId:a,value:{name:d,extension:b,chunkingMode:f,parentMode:g||"paragraph"},onChange:b=>{i.push(`/datasets/${a}/documents/${b.id}`)}})})};var b2=a.i(682541),b3=a.i(218257),b4=a.i(847733),b5=a.i(459858),b6=a.i(958887),b7=a.i(867385);let b8=f.memo(()=>(0,c.jsxs)(bz.SkeletonContainer,{className:"gap-y-0 p-1 pb-2",children:[(0,c.jsxs)(bz.SkeletonContainer,{className:"gap-y-0.5 px-2 pt-1.5",children:[(0,c.jsxs)(bz.SkeletonRow,{className:"py-0.5",children:[(0,c.jsx)(bz.SkeletonRectangle,{className:"w-[72px] bg-text-quaternary"}),(0,c.jsx)(bz.SkeletonPoint,{className:"opacity-20"}),(0,c.jsx)(bz.SkeletonRectangle,{className:"w-24 bg-text-quaternary"}),(0,c.jsx)(bz.SkeletonPoint,{className:"opacity-20"}),(0,c.jsx)(bz.SkeletonRectangle,{className:"w-24 bg-text-quaternary"}),(0,c.jsxs)(bz.SkeletonRow,{className:"grow justify-end gap-1",children:[(0,c.jsx)(bz.SkeletonRectangle,{className:"w-12 bg-text-quaternary"}),(0,c.jsx)(bz.SkeletonRectangle,{className:"mx-1 w-2 bg-text-quaternary"})]})]}),(0,c.jsx)(bz.SkeletonRow,{className:"py-0.5",children:(0,c.jsx)(bz.SkeletonRectangle,{className:"w-full bg-text-quaternary"})}),(0,c.jsx)(bz.SkeletonRow,{className:"py-0.5",children:(0,c.jsx)(bz.SkeletonRectangle,{className:"w-full bg-text-quaternary"})}),(0,c.jsx)(bz.SkeletonRow,{className:"py-0.5",children:(0,c.jsx)(bz.SkeletonRectangle,{className:"w-2/3 bg-text-quaternary"})})]}),(0,c.jsx)(bz.SkeletonContainer,{className:"px-2 py-1.5",children:(0,c.jsxs)(bz.SkeletonRow,{children:[(0,c.jsx)(bz.SkeletonRectangle,{className:"w-14 bg-text-quaternary"}),(0,c.jsx)(bz.SkeletonRectangle,{className:"w-[88px] bg-text-quaternary"}),(0,c.jsx)(bz.SkeletonRectangle,{className:"w-14 bg-text-quaternary"})]})})]}));b8.displayName="CardSkelton";let b9=f.memo(()=>(0,c.jsxs)("div",{className:"relative z-10 flex grow flex-col overflow-y-hidden",children:[(0,c.jsx)("div",{className:"absolute left-0 top-0 z-20 h-full w-full bg-dataset-chunk-list-mask-bg"}),Array.from({length:5}).map((a,b)=>(0,c.jsxs)("div",{className:"w-full px-11",children:[(0,c.jsx)(b8,{}),9!==b&&(0,c.jsx)("div",{className:"w-full px-3",children:(0,c.jsx)(h.default,{type:"horizontal",className:"my-1 bg-divider-subtle"})})]},b))]})),ca=f.memo(({sourceData:a,indexingType:b,retrievalMethod:d})=>{let{t:e}=(0,g.useTranslation)(),i={mode:e("embedding.mode",{ns:"datasetDocuments"}),segmentLength:e("embedding.segmentLength",{ns:"datasetDocuments"}),textCleaning:e("embedding.textCleaning",{ns:"datasetDocuments"})},j=(0,f.useCallback)(b=>{let c="-",d="number"==typeof a?.rules?.segmentation?.max_tokens?a.rules.segmentation.max_tokens:c,f="number"==typeof a?.rules?.subchunk_segmentation?.max_tokens?a.rules.subchunk_segmentation.max_tokens:c;switch(b){case"mode":c=a?.mode?a.mode===E.ProcessMode.general?e("embedding.custom",{ns:"datasetDocuments"}):`${e("embedding.hierarchical",{ns:"datasetDocuments"})} \xb7 ${a?.rules?.parent_mode==="paragraph"?e("parentMode.paragraph",{ns:"dataset"}):e("parentMode.fullDoc",{ns:"dataset"})}`:c;break;case"segmentLength":c=a?.mode?a.mode===E.ProcessMode.general?d:`${e("embedding.parentMaxTokens",{ns:"datasetDocuments"})} ${d}; ${e("embedding.childMaxTokens",{ns:"datasetDocuments"})} ${f}`:c;break;default:c=a?.mode?a?.rules?.pre_processing_rules?.filter(a=>a.enabled).map(a=>{var b;return"remove_extra_spaces"===(b=a.id)?e("stepTwo.removeExtraSpaces",{ns:"datasetCreation"}):"remove_urls_emails"===b?e("stepTwo.removeUrlEmails",{ns:"datasetCreation"}):"remove_stopwords"===b?e("stepTwo.removeStopwords",{ns:"datasetCreation"}):void 0}).join(","):c}return c},[a]);return(0,c.jsxs)("div",{className:"py-3",children:[(0,c.jsx)("div",{className:"flex flex-col gap-y-1",children:Object.keys(i).map(a=>(0,c.jsx)(b7.FieldInfo,{label:i[a],displayedValue:String(j(a))},a))}),(0,c.jsx)(h.default,{type:"horizontal",className:"bg-divider-subtle"}),(0,c.jsx)(b7.FieldInfo,{label:e("stepTwo.indexMode",{ns:"datasetCreation"}),displayedValue:e(`stepTwo.${b===av.IndexingType.ECONOMICAL?"economical":"qualified"}`,{ns:"datasetCreation"}),valueIcon:(0,c.jsx)(b2.default,{className:"size-4",src:b===av.IndexingType.ECONOMICAL?b6.indexMethodIcon.economical:b6.indexMethodIcon.high_quality,alt:""})}),(0,c.jsx)(b7.FieldInfo,{label:e("form.retrievalSetting.title",{ns:"datasetSettings"}),displayedValue:e(`retrieval.${b===av.IndexingType.ECONOMICAL?"keyword_search":d??"semantic_search"}.title`,{ns:"dataset"}),valueIcon:(0,c.jsx)(b2.default,{className:"size-4",src:d===aa.RETRIEVE_METHOD.fullText?b6.retrievalIcon.fullText:d===aa.RETRIEVE_METHOD.hybrid?b6.retrievalIcon.hybrid:b6.retrievalIcon.vector,alt:""})})]})});ca.displayName="RuleDetail";let cb=f.memo(({datasetId:a,documentId:b,detailUpdate:e,indexingType:h,retrievalMethod:i})=>{let{t:j}=(0,g.useTranslation)(),{notify:l}=(0,V.useContext)(k.ToastContext),n=(0,ae.useDocumentContext)(a=>a.datasetId),o=(0,ae.useDocumentContext)(a=>a.documentId),p=a??n,q=b??o,[r,s]=(0,f.useState)(null),t=async()=>{let a=await (0,b3.fetchIndexingStatus)({datasetId:p,documentId:q});return s(a),a},u=(0,f.useRef)(!1),v=(0,f.useCallback)(()=>{u.current=!0},[]),w=(0,f.useCallback)(async()=>{if(!u.current)try{let a=await t();if(["completed","error","paused"].includes(a?.indexing_status)){v(),e();return}await (0,b5.sleep)(2500),await w()}catch{await (0,b5.sleep)(2500),await w()}},[v]);(0,f.useEffect)(()=>(u.current=!1,w(),()=>{v()}),[w,v]);let{data:x}=(0,b4.useProcessRule)(q),y=(0,f.useMemo)(()=>["indexing","splitting","parsing","cleaning"].includes(r?.indexing_status||""),[r]),z=(0,f.useMemo)(()=>["completed"].includes(r?.indexing_status||""),[r]),A=(0,f.useMemo)(()=>["paused"].includes(r?.indexing_status||""),[r]),B=(0,f.useMemo)(()=>["error"].includes(r?.indexing_status||""),[r]),C=(0,f.useMemo)(()=>{let a=r?.completed_segments||0,b=r?.total_segments||0;if(0===b)return 0;let c=Math.round(100*a/b);return c>100?100:c},[r]),D=async()=>{let a=y?b3.pauseDocIndexing:b3.resumeDocIndexing,[b]=await (0,b5.asyncRunSafe)(a({datasetId:p,documentId:q}));b?l({type:"error",message:j("actionMsg.modifiedUnsuccessfully",{ns:"common"})}):(l({type:"success",message:j("actionMsg.modifiedSuccessfully",{ns:"common"})}),A&&(u.current=!1,w(),e()),s(null))};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("div",{className:"flex flex-col gap-y-2 px-16 py-12",children:[(0,c.jsxs)("div",{className:"flex h-6 items-center gap-x-1",children:[y&&(0,c.jsx)(d.RiLoader2Line,{className:"h-4 w-4 animate-spin text-text-secondary"}),(0,c.jsxs)("span",{className:"system-md-semibold-uppercase grow text-text-secondary",children:[y&&j("embedding.processing",{ns:"datasetDocuments"}),z&&j("embedding.completed",{ns:"datasetDocuments"}),A&&j("embedding.paused",{ns:"datasetDocuments"}),B&&j("embedding.error",{ns:"datasetDocuments"})]}),y&&(0,c.jsxs)("button",{type:"button",className:`flex items-center gap-x-1 rounded-md border-[0.5px]
              border-components-button-secondary-border bg-components-button-secondary-bg px-1.5 py-1 shadow-xs shadow-shadow-shadow-3 backdrop-blur-[5px]`,onClick:D,children:[(0,c.jsx)(d.RiPauseCircleLine,{className:"h-3.5 w-3.5 text-components-button-secondary-text"}),(0,c.jsx)("span",{className:"system-xs-medium pr-[3px] text-components-button-secondary-text",children:j("embedding.pause",{ns:"datasetDocuments"})})]}),A&&(0,c.jsxs)("button",{type:"button",className:`flex items-center gap-x-1 rounded-md border-[0.5px]
              border-components-button-secondary-border bg-components-button-secondary-bg px-1.5 py-1 shadow-xs shadow-shadow-shadow-3 backdrop-blur-[5px]`,onClick:D,children:[(0,c.jsx)(d.RiPlayCircleLine,{className:"h-3.5 w-3.5 text-components-button-secondary-text"}),(0,c.jsx)("span",{className:"system-xs-medium pr-[3px] text-components-button-secondary-text",children:j("embedding.resume",{ns:"datasetDocuments"})})]})]}),(0,c.jsx)("div",{className:(0,m.cn)("flex h-2 w-full items-center overflow-hidden rounded-md border border-components-progress-bar-border",y?"bg-components-progress-bar-bg/50":"bg-components-progress-bar-bg"),children:(0,c.jsx)("div",{className:(0,m.cn)("h-full",(y||z)&&"bg-components-progress-bar-progress-solid",(A||B)&&"bg-components-progress-bar-progress-highlight"),style:{width:`${C}%`}})}),(0,c.jsx)("div",{className:"flex w-full items-center",children:(0,c.jsx)("span",{className:"system-xs-medium text-text-secondary",children:`${j("embedding.segments",{ns:"datasetDocuments"})} ${r?.completed_segments||"--"}/${r?.total_segments||"--"} \xb7 ${C}%`})}),(0,c.jsx)(ca,{sourceData:x,indexingType:h,retrievalMethod:i})]}),(0,c.jsx)(b9,{})]})});var cc=a.i(91199);a.s(["default",0,({datasetId:a,documentId:b})=>{let l=(0,e.useRouter)(),{t:n}=(0,g.useTranslation)(),p=(0,D.default)()===D.MediaType.mobile,q=(0,o.useDatasetDetailContextWithSelector)(a=>a.dataset),r=!!q?.embedding_available,[s,t]=(0,f.useState)(!p),[u,v]=(0,f.useState)(!1),[w,x]=(0,f.useState)(!1),[y,z]=(0,f.useState)(),{mutateAsync:A}=(0,G.useCheckSegmentBatchImportProgress)(),B=async a=>{await A({jobID:a},{onSuccess:a=>{z(a.job_status),(a.job_status===bT.WAITING||a.job_status===bT.PROCESSING)&&setTimeout(()=>B(a.job_id),2500),a.job_status===bT.ERROR&&k.default.notify({type:"error",message:`${n("list.batchModal.runError",{ns:"datasetDocuments"})}`})},onError:a=>{let b="message"in a?`: ${a.message}`:"";k.default.notify({type:"error",message:`${n("list.batchModal.runError",{ns:"datasetDocuments"})}${b}`})}})},{mutateAsync:K}=(0,G.useSegmentBatchImport)(),L=async c=>{await K({url:`/datasets/${a}/documents/${b}/segments/batch_import`,body:{upload_file_id:c.file.id}},{onSuccess:a=>{z(a.job_status),B(a.job_id)},onError:a=>{let b="message"in a?`: ${a.message}`:"";k.default.notify({type:"error",message:`${n("list.batchModal.runError",{ns:"datasetDocuments"})}${b}`})}})},{data:M,error:N,refetch:O}=(0,F.useDocumentDetail)({datasetId:a,documentId:b,params:{metadata:"without"}}),{data:P}=(0,F.useDocumentMetadata)({datasetId:a,documentId:b,params:{metadata:"only"}}),Q=()=>{let b=new URLSearchParams(window.location.search).toString(),c=`/datasets/${a}/documents${b?"?":""}${b}`;l.push(c)},R=!M&&!N,S=["queuing","indexing","paused"].includes((M?.display_status||"").toLowerCase()),T=(0,f.useMemo)(()=>{if(M?.data_source_info){let a;if((a=M.data_source_info)&&"upload_file"in a)return M.data_source_info.upload_file}},[M?.data_source_info]),U=(0,H.useInvalid)(G.useSegmentListKey),V=(0,H.useInvalid)(G.useChildSegmentListKey),W=(0,F.useInvalidDocumentList)(a),X=a=>{W(),"delete"===a?Q():(O(),a&&setTimeout(()=>{U(),V()},5e3))},Y=(0,f.useMemo)(()=>M?.document_process_rule?.rules?.parent_mode||M?.dataset_process_rule?.rules?.parent_mode||"paragraph",[M?.document_process_rule?.rules?.parent_mode,M?.dataset_process_rule?.rules?.parent_mode]),Z=(0,f.useMemo)(()=>M?.doc_form===E.ChunkingMode.parentChild&&"full-doc"===Y,[M?.doc_form,Y]);return(0,c.jsx)(ae.DocumentContext.Provider,{value:{datasetId:a,documentId:b,docForm:M?.doc_form,parentMode:Y},children:(0,c.jsxs)("div",{className:"flex h-full flex-col bg-background-default",children:[(0,c.jsxs)("div",{className:"flex min-h-16 flex-wrap items-center justify-between border-b border-b-divider-subtle py-2.5 pl-3 pr-4",children:[(0,c.jsx)("div",{onClick:Q,className:"flex h-8 w-8 shrink-0 cursor-pointer items-center justify-center rounded-full hover:bg-components-button-tertiary-bg",children:(0,c.jsx)(d.RiArrowLeftLine,{className:"h-4 w-4 text-components-button-ghost-text hover:text-text-tertiary"})}),(0,c.jsx)(b1,{datasetId:a,extension:T?.extension,name:M?.name,wrapperCls:"mr-2",parent_mode:Y,chunkingMode:M?.doc_form}),(0,c.jsxs)("div",{className:"flex flex-wrap items-center",children:[r&&M&&!M.archived&&!Z&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(bU,{importStatus:y,clearProcessStatus:()=>z(""),showNewSegmentModal:()=>v(!0),showBatchModal:()=>x(!0),embedding:S}),(0,c.jsx)(h.default,{type:"vertical",className:"!mx-3 !h-[14px] !bg-divider-regular"})]}),(0,c.jsx)(J.default,{status:M?.display_status||"available",scene:"detail",errorMessage:M?.error||"",textCls:"font-semibold text-xs uppercase",detail:{enabled:M?.enabled||!1,archived:M?.archived||!1,id:b},datasetId:a,onUpdate:X}),(0,c.jsx)(I.default,{scene:"detail",embeddingAvailable:r,detail:{name:M?.name||"",enabled:M?.enabled||!1,archived:M?.archived||!1,id:b,data_source_type:M?.data_source_type||"",doc_form:M?.doc_form||""},datasetId:a,onUpdate:X,className:"!w-[200px]"}),(0,c.jsx)("button",{type:"button",className:cc.default.layoutRightIcon,onClick:()=>t(!s),children:s?(0,c.jsx)(d.RiLayoutLeft2Line,{className:"h-4 w-4 text-components-button-secondary-text"}):(0,c.jsx)(d.RiLayoutRight2Line,{className:"h-4 w-4 text-components-button-secondary-text"})})]})]}),(0,c.jsxs)("div",{className:"flex flex-1 flex-row",style:{height:"calc(100% - 4rem)"},children:[R?(0,c.jsx)(j.default,{type:"app"}):(0,c.jsx)("div",{className:(0,m.cn)("flex h-full min-w-0 grow flex-col",!S&&Z&&"relative pl-11 pr-11 pt-4",!S&&!Z&&"relative pl-5 pr-11 pt-3"),children:S?(0,c.jsx)(cb,{detailUpdate:O,indexingType:q?.indexing_technique,retrievalMethod:q?.retrieval_model_dict?.search_method}):(0,c.jsx)(bV,{embeddingAvailable:r,showNewSegmentModal:u,onNewSegmentModalChange:v,importStatus:y,archived:M?.archived})}),(0,c.jsx)(i.default,{showClose:!0,isOpen:s,onClose:()=>t(!1),isMobile:p,panelClassName:"!justify-start",footer:null,children:(0,c.jsx)(C,{className:"mr-2 mt-3",datasetId:a,documentId:b,docDetail:{...M,...P,doc_type:P?.doc_type==="others"?"":P?.doc_type}})})]}),(0,c.jsx)(ac,{isShow:w,onCancel:()=>x(!1),onConfirm:L,docForm:M?.doc_form})]})})}],944191)}];

//# sourceMappingURL=_26857fc6._.js.map
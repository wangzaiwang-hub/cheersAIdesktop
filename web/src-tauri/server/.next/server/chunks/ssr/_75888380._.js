module.exports=[774500,118451,a=>{"use strict";a.s(["default",()=>g],774500);var b=a.i(608061),c=a.i(57843);a.i(658335);var d=a.i(586478),e=a.i(527344);a.s(["default",()=>f],118451);let f=({title:a,children:c,collapsed:d,onCollapse:e,operations:f})=>(0,b.jsx)("div",{className:"py-4",children:(0,b.jsx)(g,{trigger:(0,b.jsx)("div",{className:"system-sm-semibold-uppercase flex h-6 cursor-pointer items-center text-text-secondary",children:a}),operations:f,collapsed:d,onCollapse:e,children:(0,b.jsx)("div",{className:"px-4",children:c})})}),g=({disabled:a,trigger:f,children:g,collapsed:h,onCollapse:i,operations:j,hideCollapseIcon:k})=>{let[l,m]=(0,c.useState)(!0),n=void 0!==h?h:l,o=(0,c.useMemo)(()=>a?null:(0,b.jsx)(d.ArrowDownRoundFill,{className:(0,e.cn)("h-4 w-4 cursor-pointer text-text-quaternary group-hover/collapse:text-text-secondary",n&&"rotate-[270deg]")}),[n,a]);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"group/collapse flex items-center",children:[(0,b.jsxs)("div",{className:"ml-4 flex grow items-center",onClick:()=>{a||(m(!n),i?.(!n))},children:["function"==typeof f?f(o):f,!k&&(0,b.jsx)("div",{className:"h-4 w-4 shrink-0",children:o})]}),j]}),!n&&g]})}},90654,a=>{"use strict";function b(a){return a[a.length-1]}a.s(["last",()=>b])},81807,791805,999120,a=>{"use strict";var b=a.i(90654),c=a.i(336836);function d(a){if((0,c.isArrayLike)(a))return(0,b.last)(Array.isArray(a)?a:Array.from(a))}a.s(["last",()=>d],791805);var e=a.i(515323);function f(a){let b=[];for(let c=0;c<a.length;c++){let d=a[c];if((0,e.isArrayLikeObject)(d))for(let a=0;a<d.length;a++)b.push(d[a])}return b}a.s(["flattenArrayLike",()=>f],999120);var g=a.i(932096);function h(a,...b){var c,i,j;let k;if(!(0,e.isArrayLikeObject)(a))return[];let l=d(b),m=f(b);if((0,e.isArrayLikeObject)(l)){let b;return c=Array.from(a),b=new Set(m),c.filter(a=>!b.has(a))}return i=Array.from(a),j=(0,g.iteratee)(l),k=new Set(m.map(a=>j(a))),i.filter(a=>!k.has(j(a)))}a.s(["differenceBy",()=>h],81807)},224702,a=>{"use strict";function b(a,b,c){let d=[],e=new Set(b.map(c));for(let b=0;b<a.length;b++){let f=a[b],g=c(f);e.has(g)&&(d.push(f),e.delete(g))}return d}a.s(["intersectionBy",()=>b])},46898,a=>{"use strict";var b=a.i(224702),c=a.i(90654),d=a.i(562168),e=a.i(169145),f=a.i(143982),g=a.i(515323);function h(a,...i){if(!(0,g.isArrayLikeObject)(a))return[];let j=(0,c.last)(i);if(void 0===j)return Array.from(a);let k=(0,d.uniq)(Array.from(a)),l=(0,g.isArrayLikeObject)(j)?i.length:i.length-1;for(let a=0;a<l;++a){let c=i[a];if(!(0,g.isArrayLikeObject)(c))return[];(0,g.isArrayLikeObject)(j)?k=(0,b.intersectionBy)(k,Array.from(c),e.identity):"function"==typeof j?k=(0,b.intersectionBy)(k,Array.from(c),a=>j(a)):"string"==typeof j&&(k=(0,b.intersectionBy)(k,Array.from(c),(0,f.property)(j)))}return k}a.s(["intersectionBy",()=>h])},29936,122709,a=>{"use strict";var b=a.i(562168),c=a.i(81807),d=a.i(46898),e=a.i(791805),f=a.i(90654),g=a.i(531228),h=a.i(999120),i=a.i(515323),j=a.i(932096);function k(...a){let c=(0,f.last)(a),d=(0,h.flattenArrayLike)(a);return(0,i.isArrayLikeObject)(c)||null==c?(0,b.uniq)(d):(0,g.uniqBy)(d,(0,j.iteratee)(c))}a.s(["unionBy",()=>k],122709);var l=a.i(169145),m=a.i(18039),n=a.i(986431),o=a.i(954200);let p=(a=[])=>{null===a&&(a=[]);let c=!0,d=!0,e=!0,f=!0,g=!0,h=!0,i=!0,j=!0,k=!1;return a.length||(c=!1,d=!1,e=!1,f=!1,g=!1,h=!1,i=!1,j=!1),a.forEach(a=>{"economy"===a.indexing_technique&&(c=!1,d=!1,e=!1),"high_quality"===a.indexing_technique&&(f=!1,a.retrieval_model_dict.search_method!==o.RETRIEVE_METHOD.semantic&&(d=!1),a.retrieval_model_dict.search_method!==o.RETRIEVE_METHOD.fullText&&(e=!1)),"external"!==a.provider?h=!1:(i=!1,c=!1,d=!1,e=!1,g=!1)}),(h||i)&&(j=!1),(c||f)&&(g=!1),c&&(k=(0,b.uniq)(a.map(a=>a.embedding_model)).length>1),{allHighQuality:c,allHighQualityVectorSearch:d,allHighQualityFullTextSearch:e,allEconomic:f,mixtureHighQualityAndEconomic:g,allInternal:i,allExternal:h,mixtureInternalAndExternal:j,inconsistentEmbeddingModel:k}};a.s(["checkoutRerankModelConfiguredInRetrievalSettings",0,(a,b)=>{if(!b)return!0;let{allEconomic:c,allExternal:d,allInternal:e}=p(a),{reranking_enable:f,reranking_mode:g,reranking_model:h}=b;return g!==n.RerankingModeEnum.RerankingModel||!!h?.provider&&!!h?.model||(c&&e||d)&&!f},"getMultipleRetrievalConfig",0,(a,b,f,g)=>{let h=function(...a){let b=(0,e.last)(a),f=l.identity;(0,i.isArrayLikeObject)(b)||null==b||(f=(0,j.iteratee)(b),a=a.slice(0,-1));let g=a.filter(i.isArrayLikeObject),h=k(...g,f),m=(function(a,b,c=1,{partialWindows:d=!1}={}){if(!Number.isInteger(2))throw Error("Size must be a positive integer.");if(c<=0||!Number.isInteger(c))throw Error("Step must be a positive integer.");let e=[],f=d?a.length:a.length-2+1;for(let b=0;b<f;b+=c)e.push(a.slice(b,b+2));return e})(g,0).map(([a,b])=>(0,d.intersectionBy)(a,b,f));return(0,c.differenceBy)(h,k(...m,f),f)}(b,f,"id").length>0,o=!!(g?.provider&&g?.model),{allHighQuality:q,allHighQualityVectorSearch:r,allHighQualityFullTextSearch:s,allEconomic:t,mixtureHighQualityAndEconomic:u,allInternal:v,allExternal:w,mixtureInternalAndExternal:x,inconsistentEmbeddingModel:y}=p(b),{top_k:z=m.DATASET_DEFAULT.top_k,score_threshold:A,reranking_mode:B,reranking_model:C,weights:D,reranking_enable:E}=a||{top_k:m.DATASET_DEFAULT.top_k},F={top_k:z,score_threshold:A,reranking_mode:B,reranking_model:C,weights:D,reranking_enable:E},G=()=>{F.weights={weight_type:n.WeightedScoreEnum.Customized,vector_setting:{vector_weight:r?n.DEFAULT_WEIGHTED_SCORE.allHighQualityVectorSearch.semantic:s?n.DEFAULT_WEIGHTED_SCORE.allHighQualityFullTextSearch.semantic:n.DEFAULT_WEIGHTED_SCORE.other.semantic,embedding_provider_name:b[0].embedding_model_provider,embedding_model_name:b[0].embedding_model},keyword_setting:{keyword_weight:r?n.DEFAULT_WEIGHTED_SCORE.allHighQualityVectorSearch.keyword:s?n.DEFAULT_WEIGHTED_SCORE.allHighQualityFullTextSearch.keyword:n.DEFAULT_WEIGHTED_SCORE.other.keyword}}};return(t&&v||w)&&(F.reranking_mode=n.RerankingModeEnum.RerankingModel,F.reranking_model?.provider&&F.reranking_model?.model||!o||(F.reranking_model={provider:g.provider||"",model:g.model||""}),F.reranking_enable=E),(u||y||x)&&(F.reranking_mode=n.RerankingModeEnum.RerankingModel,F.reranking_model?.provider&&F.reranking_model?.model||!o||(F.reranking_model={provider:g.provider||"",model:g.model||""}),F.reranking_enable=!0),q&&!y&&v&&(B||(o?(F.reranking_mode=n.RerankingModeEnum.RerankingModel,F.reranking_enable=!0,F.reranking_model={provider:g.provider||"",model:g.model||""}):(F.reranking_mode=n.RerankingModeEnum.WeightedScore,F.reranking_enable=!1,G())),B===n.RerankingModeEnum.WeightedScore&&(F.reranking_enable=!1,D||G()),B===n.RerankingModeEnum.RerankingModel&&(F.reranking_model?.provider&&F.reranking_model?.model||!o||(F.reranking_model={provider:g.provider||"",model:g.model||""}),F.reranking_enable=!0),B===n.RerankingModeEnum.WeightedScore&&D&&h&&(F.reranking_model?.provider&&F.reranking_model?.model||o?(F.reranking_mode=n.RerankingModeEnum.RerankingModel,F.reranking_enable=!0,F.reranking_model?.provider&&F.reranking_model?.model||!o||(F.reranking_model={provider:g.provider||"",model:g.model||""})):G()),B!==n.RerankingModeEnum.RerankingModel||F.reranking_model?.provider&&F.reranking_model?.model||o||!h||(F.reranking_mode=n.RerankingModeEnum.WeightedScore,F.reranking_enable=!1,G())),F},"getSelectedDatasetsMode",0,p],29936)},359058,a=>{"use strict";var b=a.i(608061),c=a.i(429150),d=a.i(497746),e=a.i(638599),f=a.i(57843);a.i(752298);var g=a.i(693025),h=a.i(909795),i=a.i(42550);a.i(10035);var j=a.i(901088),k=a.i(105249),l=a.i(940272),m=a.i(114715),n=a.i(933988),o=a.i(701458),p=a.i(962800),q=a.i(721647),r=a.i(926261),s=a.i(783296),t=a.i(82371),u=a.i(404662),v=a.i(737767),w=a.i(60005),x=a.i(493397),y=a.i(992090),z=a.i(101169);let A=({Icon:a,text:c,onClick:d})=>(0,b.jsxs)("div",{className:"mr-1 mt-2 flex h-7 shrink-0 cursor-pointer items-center rounded-lg bg-components-button-secondary-bg px-2",onClick:d,children:[(0,b.jsx)(a,{className:"h-4 w-4 text-text-tertiary"}),(0,b.jsx)("div",{className:"ml-1 text-xs font-medium text-text-secondary",children:c})]}),B=f.memo(({mode:a,isShow:B,onClose:C,flowId:D,nodeId:E,editorId:F,currentPrompt:G,isBasicMode:H,onFinished:I})=>{let{t:J}=(0,g.useTranslation)(),K=localStorage.getItem("auto-gen-model")?JSON.parse(localStorage.getItem("auto-gen-model")):null,[L,M]=f.useState(K||{name:"",provider:"",mode:a,completion_params:{}}),{defaultModel:N}=(0,o.useModelListAndDefaultModelAndCurrentProviderAndModel)(n.ModelTypeEnum.textGeneration),O=[{icon:c.RiTerminalBoxLine,key:"pythonDebugger"},{icon:c.RiTranslate,key:"translation"},{icon:c.RiPresentationLine,key:"meetingTakeaways"},{icon:c.RiNewspaperLine,key:"writingsPolisher"},{icon:c.RiUser2Line,key:"professionalAnalyst"},{icon:c.RiFileExcel2Line,key:"excelFormulaExpert"},{icon:c.RiRoadMapLine,key:"travelPlanning"},{icon:c.RiDatabase2Line,key:"SQLSorcerer"},{icon:c.RiGitCommitLine,key:"GitGud"}],[P,Q]=(0,e.useSessionStorageState)(`improve-instruction-${D}${H?"":`-${E}${F?`-${F}`:""}`}`),R=P||"",[S,T]=(0,f.useState)(""),[U,V]=(0,f.useState)(`${D}-0`),W=(0,f.useCallback)(a=>()=>{Q(J(`generate.template.${a}.instruction`,{ns:"appDebug"})),V(`${D}-${Date.now()}`)},[J]),{data:X}=(0,r.useGenerateRuleTemplate)(y.GeneratorType.prompt,H);(0,f.useEffect)(()=>{!R&&X&&Q(X.data),V(`${D}-${Date.now()}`)},[X]);let[Y,{setTrue:Z,setFalse:$}]=(0,d.useBoolean)(!1),_=`${D}${H?"":`-${E}${F?`-${F}`:""}`}`,{addVersion:aa,current:ab,currentVersionIndex:ac,setCurrentVersionIndex:ad,versions:ae}=(0,z.default)({storageKey:_});(0,f.useEffect)(()=>{if(N){let a=localStorage.getItem("auto-gen-model")?JSON.parse(localStorage.getItem("auto-gen-model")||""):null;a?M(a):M(a=>({...a,name:N.model,provider:N.provider.provider}))}},[N]);let af=(0,b.jsxs)("div",{className:"flex h-full w-0 grow flex-col items-center justify-center space-y-3",children:[(0,b.jsx)(k.default,{}),(0,b.jsx)("div",{className:"text-[13px] text-text-tertiary",children:J("generate.loading",{ns:"appDebug"})})]}),ag=(0,f.useCallback)(a=>{let b={...L,provider:a.provider,name:a.modelId,mode:a.mode};M(b),localStorage.setItem("auto-gen-model",JSON.stringify(b))},[L,M]),ah=(0,f.useCallback)(a=>{let b={...L,completion_params:a};M(b),localStorage.setItem("auto-gen-model",JSON.stringify(b))},[L,M]),ai=async()=>{if((""!==R.trim()||(m.default.notify({type:"error",message:J("errorMsg.fieldRequired",{ns:"common",field:J("generate.instruction",{ns:"appDebug"})})}),0))&&!Y){Z();try{let a,b=!1;if(H||!G){let{error:c,...d}=await (0,q.generateBasicAppFirstTimeRule)({instruction:R,model_config:L,no_variable:!1});a={...d,modified:d.prompt},c&&(b=!0,m.default.notify({type:"error",message:c}))}else{let{error:c,...d}=await (0,q.generateRule)({flow_id:D,node_id:E,current:G,instruction:R,ideal_output:S,model_config:L});a=d,c&&(b=!0,m.default.notify({type:"error",message:c}))}b||aa(a)}finally{$()}}},[aj,{setTrue:ak,setFalse:al}]=(0,d.useBoolean)(!1);return(0,b.jsx)(l.default,{isShow:B,onClose:C,className:"min-w-[1140px] !p-0",children:(0,b.jsxs)("div",{className:"flex h-[680px] flex-wrap",children:[(0,b.jsxs)("div",{className:"h-full w-[570px] shrink-0 overflow-y-auto border-r border-divider-regular p-6",children:[(0,b.jsxs)("div",{className:"mb-5",children:[(0,b.jsx)("div",{className:`text-lg font-bold leading-[28px] ${x.default.textGradient}`,children:J("generate.title",{ns:"appDebug"})}),(0,b.jsx)("div",{className:"mt-1 text-[13px] font-normal text-text-tertiary",children:J("generate.description",{ns:"appDebug"})})]}),(0,b.jsx)("div",{children:(0,b.jsx)(p.default,{popupClassName:"!w-[520px]",portalToFollowElemContentClassName:"z-[1000]",isAdvancedMode:!0,provider:L.provider,completionParams:L.completion_params,modelId:L.name,setModel:ag,onCompletionParamsChange:ah,hideDebugWithMultipleModel:!0})}),H&&(0,b.jsxs)("div",{className:"mt-4",children:[(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)("div",{className:"mr-3 shrink-0 text-xs font-semibold uppercase leading-[18px] text-text-tertiary",children:J("generate.tryIt",{ns:"appDebug"})}),(0,b.jsx)("div",{className:"h-px grow",style:{background:"linear-gradient(to right, rgba(243, 244, 246, 1), rgba(243, 244, 246, 0))"}})]}),(0,b.jsx)("div",{className:"flex flex-wrap",children:O.map(a=>(0,b.jsx)(A,{Icon:a.icon,text:J(`generate.template.${a.key}.name`,{ns:"appDebug"}),onClick:W(a.key)},a.key))})]}),(0,b.jsxs)("div",{className:"mt-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"system-sm-semibold-uppercase mb-1.5 text-text-secondary",children:J("generate.instruction",{ns:"appDebug"})}),H?(0,b.jsx)(t.default,{editorKey:U,generatorType:y.GeneratorType.prompt,value:R,onChange:Q,availableVars:[],availableNodes:[],isShowCurrentBlock:!!G,isShowLastRunBlock:!1}):(0,b.jsx)(u.default,{editorKey:U,generatorType:y.GeneratorType.prompt,value:R,onChange:Q,nodeId:E||"",isShowCurrentBlock:!!G})]}),(0,b.jsx)(s.default,{value:S,onChange:T}),(0,b.jsxs)("div",{className:"mt-7 flex justify-end space-x-2",children:[(0,b.jsx)(h.default,{onClick:C,children:J("generate.dismiss",{ns:"appDebug"})}),(0,b.jsxs)(h.default,{className:"flex space-x-1",variant:"primary",onClick:ai,disabled:Y,children:[(0,b.jsx)(j.Generator,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"text-xs font-semibold",children:J("generate.generate",{ns:"appDebug"})})]})]})]})]}),!Y&&ab&&(0,b.jsx)("div",{className:"h-full w-0 grow bg-background-default-subtle p-6 pb-0",children:(0,b.jsx)(w.default,{current:ab,isBasicMode:H,nodeId:E,currentVersionIndex:ac||0,setCurrentVersionIndex:ad,versions:ae||[],onApply:ak,generatorType:y.GeneratorType.prompt})}),Y&&af,!Y&&!ab&&(0,b.jsx)(v.default,{}),aj&&(0,b.jsx)(i.default,{title:J("generate.overwriteTitle",{ns:"appDebug"}),content:J("generate.overwriteMessage",{ns:"appDebug"}),isShow:!0,onConfirm:()=>{al(),I(ab)},onCancel:al})]})})});a.s(["default",0,B])},368044,a=>{"use strict";var b=a.i(608061),c=a.i(57843);a.i(752298);var d=a.i(693025),e=a.i(970502),f=a.i(986963);a.i(963284);var g=a.i(61820),g=g,h=a.i(735310);a.i(713310);var i=a.i(81862);a.s(["default",0,({valueSelector:a,varType:j,isShort:k,availableNodes:l})=>{let m=(0,e.useNodes)(),n=(0,f.isRagVariableVar)(a),o=(0,c.useMemo)(()=>{if((0,f.isSystemVar)(a)){let a=l?.find(a=>a.data.type===h.BlockEnum.Start);if(a)return a}return(0,f.getNodeInfoById)(l||m,n?a[1]:a[0])},[m,a,l,n]),p=(0,f.isENV)(a),q=(0,f.isConversationVar)(a),r=(0,f.isGlobalVar)(a),s=!!o||p||q||n||r,t=(0,f.isSystemVar)(a)?a.slice(0).join("."):a.slice(1).join("."),u=(0,i.isExceptionVariable)(t,o?.data.type),v=(0,e.useReactFlow)(),w=(0,e.useStoreApi)(),x=(0,c.useCallback)(()=>{let{clientWidth:a,clientHeight:b}=document.getElementById("workflow-container"),{setViewport:c}=v,{transform:d}=w.getState(),e=d[2],f=o.position;c({x:(a-400-o.width*e)/2-f.x*e,y:(b-o.height*e)/2-f.y*e,zoom:d[2]})},[o,v,w]),{t:y}=(0,d.useTranslation)();return(0,b.jsx)(g.default,{variables:a,nodeType:o?.data.type,nodeTitle:o?.data.title,variableType:k?void 0:j,onClick:a=>{(a.metaKey||a.ctrlKey)&&(a.stopPropagation(),x())},errorMsg:s?void 0:y("errorMsg.invalidVariable",{ns:"workflow"}),isExceptionVariable:u})}],368044)},38567,970439,a=>{"use strict";var b=a.i(986431);a.s(["hasEditPermissionForDataset",0,(a,c)=>{let{createdBy:d,partialMemberList:e,permission:f}=c;return f===b.DatasetPermission.onlyMe?a===d:f===b.DatasetPermission.allTeamMembers||f===b.DatasetPermission.partialMembers&&e.includes(a)}],38567);var c=a.i(608061),d=a.i(429150),e=a.i(217553),f=a.i(57843);a.i(752298);var g=a.i(693025),h=a.i(909795),i=a.i(816134),j=a.i(146172),k=a.i(114715),l=a.i(798418);a.i(387799);var m=a.i(944054),n=a.i(188509),o=a.i(794712),p=a.i(516877),q=a.i(933887),r=a.i(933988),s=a.i(701458),t=a.i(403473),u=a.i(705134),v=a.i(252813),w=a.i(29255),x=a.i(218257),y=a.i(763539),z=a.i(527344),A=a.i(757801);a.i(955696);var B=a.i(2496);a.i(805980);var C=a.i(122745),D=a.i(916443),E=a.i(721298),F=a.i(821820);let G=({rowClass:a,labelClass:b,t:d,topK:e,scoreThreshold:f,scoreThresholdEnabled:g,onExternalSettingChange:h,currentDataset:i})=>(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{className:a,children:(0,c.jsx)(A.default,{})}),(0,c.jsxs)("div",{className:a,children:[(0,c.jsx)("div",{className:b,children:(0,c.jsx)("div",{className:"system-sm-semibold text-text-secondary",children:d("form.retrievalSetting.title",{ns:"datasetSettings"})})}),(0,c.jsx)(F.default,{topK:e,scoreThreshold:f,scoreThresholdEnabled:g,onChange:h,isInRetrievalSetting:!0})]}),(0,c.jsx)("div",{className:a,children:(0,c.jsx)(A.default,{})}),(0,c.jsxs)("div",{className:a,children:[(0,c.jsx)("div",{className:b,children:(0,c.jsx)("div",{className:"system-sm-semibold text-text-secondary",children:d("form.externalKnowledgeAPI",{ns:"datasetSettings"})})}),(0,c.jsx)("div",{className:"w-full max-w-[480px]",children:(0,c.jsxs)("div",{className:"flex h-full items-center gap-1 rounded-lg bg-components-input-bg-normal px-3 py-2",children:[(0,c.jsx)(C.ApiConnectionMod,{className:"h-4 w-4 text-text-secondary"}),(0,c.jsx)("div",{className:"system-sm-medium overflow-hidden text-ellipsis text-text-secondary",children:i?.external_knowledge_info.external_knowledge_api_name}),(0,c.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:"·"}),(0,c.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:i?.external_knowledge_info.external_knowledge_api_endpoint})]})})]}),(0,c.jsxs)("div",{className:a,children:[(0,c.jsx)("div",{className:b,children:(0,c.jsx)("div",{className:"system-sm-semibold text-text-secondary",children:d("form.externalKnowledgeID",{ns:"datasetSettings"})})}),(0,c.jsx)("div",{className:"w-full max-w-[480px]",children:(0,c.jsx)("div",{className:"flex h-full items-center gap-1 rounded-lg bg-components-input-bg-normal px-3 py-2",children:(0,c.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:i?.external_knowledge_info.external_knowledge_id})})})]}),(0,c.jsx)("div",{className:a,children:(0,c.jsx)(A.default,{})})]}),H=({rowClass:a,labelClass:b,t:d,indexMethod:e,retrievalConfig:f,showMultiModalTip:g,onRetrievalConfigChange:h,docLink:i})=>(0,c.jsxs)("div",{className:a,children:[(0,c.jsx)("div",{className:(0,z.cn)(b,"w-auto min-w-[168px]"),children:(0,c.jsxs)("div",{children:[(0,c.jsx)("div",{className:"system-sm-semibold text-text-secondary",children:d("form.retrievalSetting.title",{ns:"datasetSettings"})}),(0,c.jsxs)("div",{className:"text-xs font-normal leading-[18px] text-text-tertiary",children:[(0,c.jsx)("a",{target:"_blank",rel:"noopener noreferrer",href:i("/use-dify/knowledge/create-knowledge/setting-indexing-methods"),className:"text-text-accent",children:d("form.retrievalSetting.learnMore",{ns:"datasetSettings"})}),d("form.retrievalSetting.description",{ns:"datasetSettings"})]})]})}),(0,c.jsx)("div",{children:e===m.IndexingType.QUALIFIED?(0,c.jsx)(E.default,{value:f,onChange:h,showMultiModalTip:g}):(0,c.jsx)(D.default,{value:f,onChange:h})})]}),I=a=>{if(a.isExternal){let{rowClass:b,labelClass:d,t:e,topK:f,scoreThreshold:g,scoreThresholdEnabled:h,onExternalSettingChange:i,currentDataset:j}=a;return(0,c.jsx)(G,{rowClass:b,labelClass:d,t:e,topK:f,scoreThreshold:g,scoreThresholdEnabled:h,onExternalSettingChange:i,currentDataset:j})}let{rowClass:b,labelClass:d,t:e,indexMethod:f,retrievalConfig:g,showMultiModalTip:h,onRetrievalConfigChange:i,docLink:j}=a;return(0,c.jsx)(H,{rowClass:b,labelClass:d,t:e,indexMethod:f,retrievalConfig:g,showMultiModalTip:h,onRetrievalConfigChange:i,docLink:j})},J=({visible:a,message:b,onDismiss:e})=>a?(0,c.jsxs)("div",{className:"absolute bottom-[76px] left-[30px] right-[30px] z-10 flex h-10 items-center justify-between rounded-lg border border-[#FEF0C7] bg-[#FFFAEB] px-3 shadow-lg",children:[(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsx)(B.AlertTriangle,{className:"mr-1 h-3 w-3 text-[#F79009]"}),(0,c.jsx)("div",{className:"text-xs font-medium leading-[18px] text-gray-700",children:b})]}),(0,c.jsx)("button",{type:"button",className:"cursor-pointer p-1",onClick:a=>{e(),a.stopPropagation()},"aria-label":"close-retrieval-change-tip",children:(0,c.jsx)(d.RiCloseLine,{className:"h-4 w-4 text-gray-500"})})]}):null,K=`
  flex justify-between py-4 flex-wrap gap-y-2
`,L=`
  flex w-[168px] shrink-0
`;a.s(["default",0,({currentDataset:a,onCancel:A,onSave:B})=>{let{data:C}=(0,s.useModelList)(r.ModelTypeEnum.textEmbedding),{data:D}=(0,s.useModelList)(r.ModelTypeEnum.rerank),{t:E}=(0,g.useTranslation)(),F=(0,v.useDocLink)(),{notify:G}=(0,k.useToastContext)(),H=(0,f.useRef)(null),M="external"===a.provider,{setShowAccountSettingModal:N}=(0,w.useModalContext)(),[O,P]=(0,f.useState)(!1),{isCurrentWorkspaceDatasetOperator:Q}=(0,u.useAppContext)(),[R,S]=(0,f.useState)({...a}),[T,U]=(0,f.useState)(R?.external_retrieval_model.top_k??2),[V,W]=(0,f.useState)(R?.external_retrieval_model.score_threshold??.5),[X,Y]=(0,f.useState)(R?.external_retrieval_model.score_threshold_enabled??!1),[Z,$]=(0,f.useState)(a.partial_member_list||[]),[_,aa]=(0,f.useState)([]),{data:ab}=(0,y.useMembers)(),[ac,ad]=(0,f.useState)(a.indexing_technique),[ae,af]=(0,f.useState)(R?.retrieval_model_dict),[ag,ah]=(0,f.useState)(a.keyword_number??10),ai=(a,b)=>{S({...R,[a]:b})},[aj,ak]=(0,f.useState)(!1),al=!(0,e.isEqual)(ae,R?.retrieval_model_dict)||ac!==R?.indexing_technique,am=async()=>{if(!O){if(!R.name?.trim())return void G({type:"error",message:E("form.nameError",{ns:"datasetSettings"})});if(!(0,l.isReRankModelSelected)({rerankModelList:D,retrievalConfig:ae,indexMethod:ac}))return void G({type:"error",message:E("datasetConfig.rerankModelRequired",{ns:"appDebug"})});try{P(!0);let{id:c,name:d,description:e,permission:f}=R,g={datasetId:c,body:{name:d,description:e,permission:f,indexing_technique:ac,keyword_number:ag,retrieval_model:{...ae,score_threshold:ae.score_threshold_enabled?ae.score_threshold:0},embedding_model:R.embedding_model,embedding_model_provider:R.embedding_model_provider,...M&&{external_knowledge_id:a.external_knowledge_info.external_knowledge_id,external_knowledge_api_id:a.external_knowledge_info.external_knowledge_api_id,external_retrieval_model:{top_k:T,score_threshold:V,score_threshold_enabled:X}}}};f===b.DatasetPermission.partialMembers&&(g.body.partial_member_list=Z.map(a=>({user_id:a,role:_.find(b=>b.id===a)?.role}))),await (0,x.updateDatasetSetting)(g),G({type:"success",message:E("actionMsg.modifiedSuccessfully",{ns:"common"})}),B({...R,indexing_technique:ac,retrieval_model_dict:ae})}catch{G({type:"error",message:E("actionMsg.modifiedUnsuccessfully",{ns:"common"})})}finally{P(!1)}}};(0,f.useEffect)(()=>{ab?.accounts?aa(ab.accounts):aa([])},[ab]);let an=(0,f.useMemo)(()=>(0,p.checkShowMultiModalTip)({embeddingModel:{provider:R.embedding_model_provider,model:R.embedding_model},rerankingEnable:ae.reranking_enable,rerankModel:{rerankingProviderName:ae.reranking_model.reranking_provider_name,rerankingModelName:ae.reranking_model.reranking_model_name},indexMethod:ac,embeddingModelList:C,rerankModelList:D}),[R.embedding_model,R.embedding_model_provider,ae.reranking_enable,ae.reranking_model,ac,C,D]);return(0,c.jsxs)("div",{className:"flex w-full flex-col overflow-hidden rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-xl",style:{height:"calc(100vh - 72px)"},ref:H,children:[(0,c.jsxs)("div",{className:"flex h-14 shrink-0 items-center justify-between border-b border-divider-regular pl-6 pr-5",children:[(0,c.jsx)("div",{className:"flex flex-col text-base font-semibold text-text-primary",children:(0,c.jsx)("div",{className:"leading-6",children:E("title",{ns:"datasetSettings"})})}),(0,c.jsx)("div",{className:"flex items-center",children:(0,c.jsx)("div",{onClick:A,className:"flex h-6 w-6 cursor-pointer items-center justify-center",children:(0,c.jsx)(d.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})})})]}),(0,c.jsxs)("div",{className:"overflow-y-auto border-b border-divider-regular p-6 pb-[68px] pt-5",children:[(0,c.jsxs)("div",{className:(0,z.cn)(K,"items-center"),children:[(0,c.jsx)("div",{className:L,children:(0,c.jsx)("div",{className:"system-sm-semibold text-text-secondary",children:E("form.name",{ns:"datasetSettings"})})}),(0,c.jsx)(i.default,{value:R.name,onChange:a=>ai("name",a.target.value),className:"block h-9",placeholder:E("form.namePlaceholder",{ns:"datasetSettings"})||""})]}),(0,c.jsxs)("div",{className:(0,z.cn)(K),children:[(0,c.jsx)("div",{className:L,children:(0,c.jsx)("div",{className:"system-sm-semibold text-text-secondary",children:E("form.desc",{ns:"datasetSettings"})})}),(0,c.jsx)("div",{className:"w-full",children:(0,c.jsx)(j.default,{value:R.description||"",onChange:a=>ai("description",a.target.value),className:"resize-none",placeholder:E("form.descPlaceholder",{ns:"datasetSettings"})||""})})]}),(0,c.jsxs)("div",{className:K,children:[(0,c.jsx)("div",{className:L,children:(0,c.jsx)("div",{className:"system-sm-semibold text-text-secondary",children:E("form.permissions",{ns:"datasetSettings"})})}),(0,c.jsx)("div",{className:"w-full",children:(0,c.jsx)(o.default,{disabled:!R?.embedding_available||Q,permission:R.permission,value:Z,onChange:a=>ai("permission",a),onMemberSelect:$,memberList:_})})]}),!!(a&&a.indexing_technique)&&(0,c.jsxs)("div",{className:(0,z.cn)(K),children:[(0,c.jsx)("div",{className:L,children:(0,c.jsx)("div",{className:"system-sm-semibold text-text-secondary",children:E("form.indexMethod",{ns:"datasetSettings"})})}),(0,c.jsx)("div",{className:"grow",children:(0,c.jsx)(n.default,{disabled:!R?.embedding_available,value:ac,onChange:ad,currentValue:a.indexing_technique,keywordNumber:ag,onKeywordNumberChange:ah})})]}),ac===m.IndexingType.QUALIFIED&&(0,c.jsxs)("div",{className:(0,z.cn)(K),children:[(0,c.jsx)("div",{className:L,children:(0,c.jsx)("div",{className:"system-sm-semibold text-text-secondary",children:E("form.embeddingModel",{ns:"datasetSettings"})})}),(0,c.jsxs)("div",{className:"w-full",children:[(0,c.jsx)("div",{className:"h-8 w-full rounded-lg bg-components-input-bg-normal opacity-60",children:(0,c.jsx)(t.default,{readonly:!0,defaultModel:{provider:R.embedding_model_provider,model:R.embedding_model},modelList:C})}),(0,c.jsxs)("div",{className:"mt-2 w-full text-xs leading-6 text-text-tertiary",children:[E("form.embeddingModelTip",{ns:"datasetSettings"}),(0,c.jsx)("span",{className:"cursor-pointer text-text-accent",onClick:()=>N({payload:q.ACCOUNT_SETTING_TAB.PROVIDER}),children:E("form.embeddingModelTipLink",{ns:"datasetSettings"})})]})]})]}),M?(0,c.jsx)(I,{isExternal:!0,rowClass:K,labelClass:L,t:E,topK:T,scoreThreshold:V,scoreThresholdEnabled:X,onExternalSettingChange:a=>{void 0!==a.top_k&&U(a.top_k),void 0!==a.score_threshold&&W(a.score_threshold),void 0!==a.score_threshold_enabled&&Y(a.score_threshold_enabled),S({...R,external_retrieval_model:{...R?.external_retrieval_model,...a}})},currentDataset:a}):(0,c.jsx)(I,{isExternal:!1,rowClass:K,labelClass:L,t:E,indexMethod:ac,retrievalConfig:ae,showMultiModalTip:an,onRetrievalConfigChange:af,docLink:F})]}),(0,c.jsx)(J,{visible:al&&!aj,message:E("datasetConfig.retrieveChangeTip",{ns:"appDebug"}),onDismiss:()=>ak(!0)}),(0,c.jsxs)("div",{className:"sticky bottom-0 z-[5] flex w-full justify-end border-t border-divider-regular bg-background-section px-6 py-4",children:[(0,c.jsx)(h.default,{onClick:A,className:"mr-2",children:E("operation.cancel",{ns:"common"})}),(0,c.jsx)(h.default,{variant:"primary",disabled:O,onClick:am,children:E("operation.save",{ns:"common"})})]})]})}],970439)},211824,882937,512306,258070,985229,694133,a=>{"use strict";var b,c,d,e,f=((b={}).and="and",b.or="or",b),g=((c={}).contains="contains",c.notContains="not contains",c.startWith="start with",c.endWith="end with",c.is="is",c.isNot="is not",c.empty="empty",c.notEmpty="not empty",c.equal="=",c.notEqual="≠",c.largerThan=">",c.lessThan="<",c.largerThanOrEqual="≥",c.lessThanOrEqual="≤",c.isNull="is null",c.isNotNull="is not null",c.in="in",c.notIn="not in",c.allOf="all of",c.exists="exists",c.notExists="not exists",c.before="before",c.after="after",c),h=((d={}).disabled="disabled",d.automatic="automatic",d.manual="manual",d),i=((e={}).string="string",e.number="number",e.time="time",e.select="select",e);a.s(["ComparisonOperator",()=>g,"LogicalOperator",()=>f,"MetadataFilteringModeEnum",()=>h,"MetadataFilteringVariableType",()=>i],211824);var j=a.i(608061),k=a.i(429150),l=a.i(57843);a.i(752298);var m=a.i(693025),n=a.i(909795),o=a.i(816134),p=a.i(825319),q=a.i(527344);let r=(0,l.memo)(({type:a,className:b})=>(0,j.jsxs)(j.Fragment,{children:[(a===i.string||a===i.select)&&(0,j.jsx)(k.RiTextSnippet,{className:(0,q.cn)("h-3.5 w-3.5",b)}),a===i.number&&(0,j.jsx)(k.RiHashtag,{className:(0,q.cn)("h-3.5 w-3.5",b)}),a===i.time&&(0,j.jsx)(k.RiTimeLine,{className:(0,q.cn)("h-3.5 w-3.5",b)})]}));a.s(["default",0,r],882937),a.s(["default",0,({metadataList:a,handleAddCondition:b})=>{let{t:c}=(0,m.useTranslation)(),[d,e]=(0,l.useState)(!1),[f,g]=(0,l.useState)(""),h=(0,l.useMemo)(()=>a?.filter(a=>a.name.includes(f)),[a,f]),i=(0,l.useCallback)(a=>{b?.(a),e(!1)},[b]);return(0,j.jsxs)(p.PortalToFollowElem,{open:d,onOpenChange:e,placement:"bottom-start",offset:{mainAxis:3,crossAxis:0},children:[(0,j.jsx)(p.PortalToFollowElemTrigger,{onClick:()=>e(!d),children:(0,j.jsxs)(n.default,{size:"small",variant:"secondary",children:[(0,j.jsx)(k.RiAddLine,{className:"h-3.5 w-3.5"}),c("nodes.knowledgeRetrieval.metadata.panel.add",{ns:"workflow"})]})}),(0,j.jsx)(p.PortalToFollowElemContent,{className:"z-10",children:(0,j.jsxs)("div",{className:"w-[320px] rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur shadow-lg",children:[(0,j.jsx)("div",{className:"p-2 pb-1",children:(0,j.jsx)(o.default,{showLeftIcon:!0,placeholder:c("nodes.knowledgeRetrieval.metadata.panel.search",{ns:"workflow"}),value:f,onChange:a=>g(a.target.value)})}),(0,j.jsx)("div",{className:"p-1",children:h?.map(a=>(0,j.jsxs)("div",{className:"system-sm-medium flex h-6 cursor-pointer items-center rounded-md px-3 text-text-secondary hover:bg-state-base-hover",children:[(0,j.jsx)("div",{className:"mr-1 p-[1px]",children:(0,j.jsx)(r,{type:a.type})}),(0,j.jsx)("div",{className:"grow truncate",title:a.name,onClick:()=>i(a),children:a.name}),(0,j.jsx)("div",{className:"system-xs-regular shrink-0 text-text-tertiary",children:a.type})]},a.name))})]})})]})}],512306);var s=a.i(435133),t=a.i(368988),u=a.i(705134);a.s(["default",0,({value:a,onChange:b})=>{let{t:c}=(0,m.useTranslation)(),{userProfile:{timezone:d}}=(0,u.useAppContext)(),e=(0,l.useCallback)(a=>{a?b(a.unix()):b()},[b]),f=(0,l.useCallback)(({handleClickTrigger:b})=>(0,j.jsxs)("div",{className:"group flex items-center",onClick:b,children:[(0,j.jsx)("div",{className:(0,q.cn)("system-sm-regular mr-0.5 flex h-6 grow cursor-pointer items-center px-1",a?"text-text-secondary":"text-text-tertiary"),children:a?(0,s.default)(1e3*a).tz(d).format("MMMM DD YYYY HH:mm A"):c("nodes.knowledgeRetrieval.metadata.panel.datePlaceholder",{ns:"workflow"})}),!!a&&(0,j.jsx)(k.RiCloseCircleFill,{className:(0,q.cn)("hidden h-4 w-4 shrink-0 cursor-pointer hover:text-components-input-text-filled group-hover:block",a&&"text-text-quaternary"),onClick:a=>{a.stopPropagation(),e()}}),(0,j.jsx)(k.RiCalendarLine,{className:(0,q.cn)("block h-4 w-4 shrink-0",a?"text-text-quaternary":"text-text-tertiary",a&&"group-hover:hidden")})]}),[a,e,d,c]);return(0,j.jsx)("div",{className:"h-8 px-2 py-1",children:(0,j.jsx)(t.default,{timezone:d,value:a?(0,s.default)(1e3*a):void 0,onChange:e,onClear:e,renderTrigger:f})})}],258070),a.i(805980);var v=a.i(634919);a.s(["default",0,({variables:a=[],value:b,onChange:c,varType:d})=>{let{t:e}=(0,m.useTranslation)(),[f,g]=(0,l.useState)(!1),h=a.find(a=>a.value===b),i=(0,l.useCallback)(a=>{c(a),g(!1)},[c]);return(0,j.jsxs)(p.PortalToFollowElem,{open:f,onOpenChange:g,placement:"bottom-start",offset:{mainAxis:4,crossAxis:0},children:[(0,j.jsx)(p.PortalToFollowElemTrigger,{asChild:!0,onClick:()=>{a.length&&g(!f)},children:(0,j.jsxs)("div",{className:"flex h-6 grow cursor-pointer items-center",children:[h&&(0,j.jsxs)("div",{className:"system-xs-medium inline-flex h-6 items-center rounded-md border-[0.5px] border-components-panel-border-subtle bg-components-badge-white-to-dark pl-[5px] pr-1.5 text-text-secondary shadow-xs",children:[(0,j.jsx)(v.Variable02,{className:"mr-1 h-3.5 w-3.5 text-text-accent"}),h.value]}),!h&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)("div",{className:"system-sm-regular flex grow items-center text-components-input-text-placeholder",children:[(0,j.jsx)(v.Variable02,{className:"mr-1 h-4 w-4"}),e("nodes.knowledgeRetrieval.metadata.panel.select",{ns:"workflow"})]}),(0,j.jsx)("div",{className:"system-2xs-medium flex h-5 shrink-0 items-center rounded-[5px] border border-divider-deep px-[5px] text-text-tertiary",children:d})]})]})}),(0,j.jsx)(p.PortalToFollowElemContent,{className:"z-[1000]",children:(0,j.jsx)("div",{className:"w-[200px] rounded-lg border-[0.5px] border-components-panel-border bg-components-panel-bg-blur p-1 shadow-lg",children:a.map(a=>(0,j.jsxs)("div",{className:"system-xs-medium flex h-6 cursor-pointer items-center rounded-md px-2 text-text-secondary hover:bg-state-base-hover",onClick:()=>i(a.value),children:[(0,j.jsx)(v.Variable02,{className:"mr-1 h-4 w-4 text-text-accent"}),a.value]},a.value))})})]})}],985229);var w=a.i(732078);let x=["variable","constant"];a.s(["default",0,({valueMethod:a="variable",onValueMethodChange:b})=>{let[c,d]=(0,l.useState)(!1);return(0,j.jsxs)(p.PortalToFollowElem,{open:c,onOpenChange:d,placement:"bottom-start",offset:{mainAxis:4,crossAxis:0},children:[(0,j.jsx)(p.PortalToFollowElemTrigger,{asChild:!0,onClick:()=>d(a=>!a),children:(0,j.jsxs)(n.default,{className:"shrink-0",variant:"ghost",size:"small",children:[(0,w.capitalize)(a),(0,j.jsx)(k.RiArrowDownSLine,{className:"ml-[1px] h-3.5 w-3.5"})]})}),(0,j.jsx)(p.PortalToFollowElemContent,{className:"z-[1000]",children:(0,j.jsx)("div",{className:"w-[112px] rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur p-1 shadow-lg",children:x.map(c=>(0,j.jsx)("div",{className:(0,q.cn)("flex h-7 cursor-pointer items-center rounded-md px-3 hover:bg-state-base-hover","text-[13px] font-medium text-text-secondary",a===c&&"bg-state-base-hover"),onClick:()=>{a!==c&&(b(c),d(!1))},children:(0,w.capitalize)(c)},c))})})]})}],694133)},658584,a=>{"use strict";var b=a.i(608061),c=a.i(111089),d=a.i(57843);a.i(752298);var e=a.i(693025),f=a.i(483664),g=a.i(962800),h=a.i(774500),i=a.i(211824),j=a.i(429150),k=a.i(909795),l=a.i(825319),m=a.i(512306),n=i,o=a.i(527344),p=a.i(882937),q=a.i(258070),r=a.i(816134),s=a.i(735310),t=a.i(985229),u=a.i(694133);a.i(805980);var v=a.i(634919),w=a.i(368044),x=a.i(697638),y=s;let z=({valueSelector:a=[],varType:c=y.VarType.string,availableNodes:f=[],nodesOutputVars:g=[],onChange:h})=>{let{t:i}=(0,e.useTranslation)(),[j,k]=(0,d.useState)(!1),m=(0,d.useCallback)((a,b)=>{h(a,b),k(!1)},[h]);return(0,b.jsxs)(l.PortalToFollowElem,{open:j,onOpenChange:k,placement:"bottom-start",offset:{mainAxis:4,crossAxis:0},children:[(0,b.jsx)(l.PortalToFollowElemTrigger,{asChild:!0,onClick:()=>k(!j),children:(0,b.jsxs)("div",{className:"flex h-6 grow cursor-pointer items-center",children:[!!a.length&&(0,b.jsx)(w.default,{valueSelector:a,varType:c,availableNodes:f,isShort:!0}),!a.length&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"system-sm-regular flex grow items-center text-components-input-text-placeholder",children:[(0,b.jsx)(v.Variable02,{className:"mr-1 h-4 w-4"}),i("nodes.knowledgeRetrieval.metadata.panel.select",{ns:"workflow"})]}),(0,b.jsx)("div",{className:"system-2xs-medium flex h-5 shrink-0 items-center rounded-[5px] border border-divider-deep px-[5px] text-text-tertiary",children:c})]})]})}),(0,b.jsx)(l.PortalToFollowElemContent,{className:"z-[1000]",children:(0,b.jsx)("div",{className:"w-[296px] rounded-lg border-[0.5px] border-components-panel-border bg-components-panel-bg-blur shadow-lg",children:(0,b.jsx)(x.default,{vars:g,isSupportFileVar:!0,onChange:m})})})]})},A=({value:a,onChange:c,valueMethod:f,onValueMethodChange:g,nodesOutputVars:h,availableNodes:i,isCommonVariable:j,commonVariables:k})=>{let{t:l}=(0,e.useTranslation)(),m=(0,d.useCallback)(a=>{c(`{{#${a.join(".")}#}}`)},[c]),n=(0,d.useCallback)(a=>{c(`{{${a}}}`)},[c]);return(0,b.jsxs)("div",{className:"flex h-8 items-center pl-1 pr-2",children:[(0,b.jsx)(u.default,{valueMethod:f,onValueMethodChange:g}),(0,b.jsx)("div",{className:"ml-1 mr-1.5 h-4 w-[1px] bg-divider-regular"}),"variable"===f&&!j&&(0,b.jsx)(z,{valueSelector:a?a.split("."):[],onChange:m,nodesOutputVars:h,availableNodes:i,varType:s.VarType.number}),"variable"===f&&j&&(0,b.jsx)(t.default,{variables:k,value:a,onChange:n,varType:s.VarType.number}),"constant"===f&&(0,b.jsx)(r.default,{className:"border-none bg-transparent outline-none hover:bg-transparent focus:bg-transparent focus:shadow-none",value:a,onChange:a=>{c(a.target.value?Number(a.target.value):void 0)},placeholder:l("nodes.knowledgeRetrieval.metadata.panel.placeholder",{ns:"workflow"}),type:"number"})]})},B=[i.ComparisonOperator.equal,i.ComparisonOperator.notEqual,i.ComparisonOperator.largerThan,i.ComparisonOperator.largerThanOrEqual,i.ComparisonOperator.lessThan,i.ComparisonOperator.lessThanOrEqual],C=a=>!!a&&[i.ComparisonOperator.empty,i.ComparisonOperator.notEmpty,i.ComparisonOperator.isNull,i.ComparisonOperator.isNotNull,i.ComparisonOperator.exists,i.ComparisonOperator.notExists].includes(a),D=/\{\{(#[\w-]{1,50}(\.[a-z_]\w{0,29}){1,10}#)\}\}/gi,E=/\{\{([\w-]{1,50})\}\}/g,F="nodes.ifElse",G=({className:a,disabled:c,variableType:f,value:g,onSelect:h})=>{let{t:m}=(0,e.useTranslation)(),[n,p]=(0,d.useState)(!1),q=(0,d.useMemo)(()=>(a=>{switch(a){case i.MetadataFilteringVariableType.string:case i.MetadataFilteringVariableType.select:return[i.ComparisonOperator.is,i.ComparisonOperator.isNot,i.ComparisonOperator.contains,i.ComparisonOperator.notContains,i.ComparisonOperator.startWith,i.ComparisonOperator.endWith,i.ComparisonOperator.empty,i.ComparisonOperator.notEmpty,i.ComparisonOperator.in,i.ComparisonOperator.notIn];case i.MetadataFilteringVariableType.number:return[i.ComparisonOperator.equal,i.ComparisonOperator.notEqual,i.ComparisonOperator.largerThan,i.ComparisonOperator.lessThan,i.ComparisonOperator.largerThanOrEqual,i.ComparisonOperator.lessThanOrEqual,i.ComparisonOperator.empty,i.ComparisonOperator.notEmpty];default:return[i.ComparisonOperator.is,i.ComparisonOperator.before,i.ComparisonOperator.after,i.ComparisonOperator.empty,i.ComparisonOperator.notEmpty]}})(f).map(a=>({label:a&&!B.includes(a)?m(`${F}.comparisonOperator.${a}`,{ns:"workflow"}):a,value:a})),[m,f]),r=q.find(a=>Array.isArray(g)?a.value===g[0]:a.value===g);return(0,b.jsxs)(l.PortalToFollowElem,{open:n,onOpenChange:p,placement:"bottom-end",offset:{mainAxis:4,crossAxis:0},children:[(0,b.jsx)(l.PortalToFollowElemTrigger,{onClick:()=>p(a=>!a),children:(0,b.jsxs)(k.default,{className:(0,o.cn)("shrink-0",!r&&"opacity-50",a),size:"small",variant:"ghost",disabled:c,children:[r?r.label:m(`${F}.select`,{ns:"workflow"}),(0,b.jsx)(j.RiArrowDownSLine,{className:"ml-1 h-3.5 w-3.5"})]})}),(0,b.jsx)(l.PortalToFollowElemContent,{className:"z-10",children:(0,b.jsx)("div",{className:"rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur p-1 shadow-lg",children:q.map(a=>(0,b.jsx)("div",{className:"flex h-7 cursor-pointer items-center rounded-lg px-3 py-1.5 text-[13px] font-medium text-text-secondary hover:bg-state-base-hover",onClick:()=>{h(a.value),p(!1)},children:a.label},a.value))})})]})},H=({value:a,onChange:c,valueMethod:f="constant",onValueMethodChange:g,nodesOutputVars:h,availableNodes:i,isCommonVariable:j,commonVariables:k})=>{let{t:l}=(0,e.useTranslation)(),m=(0,d.useCallback)(a=>{c(`{{#${a.join(".")}#}}`)},[c]),n=(0,d.useCallback)(a=>{c(`{{${a}}}`)},[c]);return(0,b.jsxs)("div",{className:"flex h-8 items-center pl-1 pr-2",children:[(0,b.jsx)(u.default,{valueMethod:f,onValueMethodChange:g}),(0,b.jsx)("div",{className:"ml-1 mr-1.5 h-4 w-[1px] bg-divider-regular"}),"variable"===f&&!j&&(0,b.jsx)(z,{valueSelector:a?a.split("."):[],onChange:m,nodesOutputVars:h,availableNodes:i,varType:s.VarType.string}),"variable"===f&&j&&(0,b.jsx)(t.default,{variables:k,value:a,onChange:n,varType:s.VarType.string}),"constant"===f&&(0,b.jsx)(r.default,{className:"border-none bg-transparent outline-none hover:bg-transparent focus:bg-transparent focus:shadow-none",value:a,onChange:a=>c(a.target.value),placeholder:l("nodes.knowledgeRetrieval.metadata.panel.placeholder",{ns:"workflow"})})]})},I=({className:a,disabled:c,condition:e,onRemoveCondition:f,onUpdateCondition:g,metadataList:h=[],availableStringVars:k=[],availableStringNodesWithParent:l=[],availableNumberVars:m=[],availableNumberNodesWithParent:n=[],isCommonVariable:r,availableCommonStringVars:s=[],availableCommonNumberVars:t=[]})=>{let[u,v]=(0,d.useState)(!1),w=(0,d.useMemo)(()=>!c,[c]),x=(0,d.useCallback)(()=>{f?.(e.id)},[f,e.id]),y=(0,d.useMemo)(()=>{if(e.metadata_id){let a=h.find(a=>a.id===e.metadata_id);if(a)return a}return h.find(a=>a.name===e.name)},[h,e.metadata_id,e.name]),z=(0,d.useCallback)(a=>{g?.(e.id,{...e,value:C(e.comparison_operator)?void 0:e.value,comparison_operator:a})},[g,e]),B=(0,d.useMemo)(()=>{if((y?.type===i.MetadataFilteringVariableType.string||y?.type===i.MetadataFilteringVariableType.number||y?.type===i.MetadataFilteringVariableType.select)&&"string"==typeof e.value){let a=r?E:D,b=r?2:3,c=e.value.match(a);if(c?.length)return{value:c[0].slice(b,-b),valueMethod:"variable"}}return{value:e.value,valueMethod:"constant"}},[y,e.value,r]),[F,I]=(0,d.useState)(B.valueMethod),J=(0,d.useCallback)(a=>{I(a),g?.(e.id,{...e,value:void 0})},[e,g]),K=(0,d.useCallback)(a=>{g?.(e.id,{...e,value:a})},[e,g]);return(0,b.jsxs)("div",{className:(0,o.cn)("mb-1 flex last-of-type:mb-0",a),children:[(0,b.jsxs)("div",{className:(0,o.cn)("grow rounded-lg bg-components-input-bg-normal",u&&"bg-state-destructive-hover"),children:[(0,b.jsxs)("div",{className:"flex items-center p-1",children:[(0,b.jsx)("div",{className:"w-0 grow",children:(0,b.jsxs)("div",{className:"flex h-6 min-w-0 items-center rounded-md border-[0.5px] border-components-panel-border-subtle bg-components-badge-white-to-dark pl-1 pr-1.5 shadow-xs",children:[(0,b.jsx)("div",{className:"mr-0.5 p-[1px]",children:(0,b.jsx)(p.default,{type:y?.type,className:"h-3 w-3"})}),(0,b.jsx)("div",{className:"system-xs-medium mr-0.5 min-w-0 flex-1 truncate text-text-secondary",children:y?.name}),(0,b.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:y?.type})]})}),(0,b.jsx)("div",{className:"mx-1 h-3 w-[1px] bg-divider-regular"}),(0,b.jsx)(G,{disabled:!w,variableType:y?.type||i.MetadataFilteringVariableType.string,value:e.comparison_operator,onSelect:z})]}),(0,b.jsxs)("div",{className:"border-t border-t-divider-subtle",children:[!C(e.comparison_operator)&&(y?.type===i.MetadataFilteringVariableType.string||y?.type===i.MetadataFilteringVariableType.select)&&(0,b.jsx)(H,{valueMethod:F,onValueMethodChange:J,nodesOutputVars:k,availableNodes:l,value:B.value,onChange:K,isCommonVariable:r,commonVariables:s}),!C(e.comparison_operator)&&y?.type===i.MetadataFilteringVariableType.number&&(0,b.jsx)(A,{valueMethod:F,onValueMethodChange:J,nodesOutputVars:m,availableNodes:n,value:B.value,onChange:K,isCommonVariable:r,commonVariables:t}),!C(e.comparison_operator)&&y?.type===i.MetadataFilteringVariableType.time&&(0,b.jsx)(q.default,{value:e.value,onChange:K})]})]}),(0,b.jsx)("div",{className:"ml-1 mt-1 flex h-6 w-6 shrink-0 cursor-pointer items-center justify-center rounded-lg text-text-tertiary hover:bg-state-destructive-hover hover:text-text-destructive",onMouseEnter:()=>v(!0),onMouseLeave:()=>v(!1),onClick:x,children:(0,b.jsx)(j.RiDeleteBinLine,{className:"h-4 w-4"})})]})},J=({disabled:a,metadataList:c=[],metadataFilteringConditions:d={conditions:[],logical_operator:n.LogicalOperator.and},handleRemoveCondition:e,handleToggleConditionLogicalOperator:f,handleUpdateCondition:g,availableStringVars:h,availableStringNodesWithParent:i,availableNumberVars:k,availableNumberNodesWithParent:l,isCommonVariable:m,availableCommonNumberVars:p,availableCommonStringVars:q})=>{let{conditions:r,logical_operator:s}=d;return(0,b.jsxs)("div",{className:(0,o.cn)("relative"),children:[r.length>1&&(0,b.jsxs)("div",{className:(0,o.cn)("absolute bottom-0 left-0 top-0 w-[44px]"),children:[(0,b.jsx)("div",{className:"absolute bottom-4 right-1 top-4 w-2.5 rounded-l-[8px] border border-r-0 border-divider-deep"}),(0,b.jsx)("div",{className:"absolute right-0 top-1/2 h-[29px] w-4 -translate-y-1/2 bg-components-panel-bg"}),(0,b.jsxs)("div",{className:"absolute right-1 top-1/2 flex h-[21px] -translate-y-1/2 cursor-pointer select-none items-center rounded-md border-[0.5px] border-components-button-secondary-border bg-components-button-secondary-bg px-1 text-[10px] font-semibold text-text-accent-secondary shadow-xs",onClick:()=>f(),children:[s.toUpperCase(),(0,b.jsx)(j.RiLoopLeftLine,{className:"ml-0.5 h-3 w-3"})]})]}),(0,b.jsx)("div",{className:(0,o.cn)(r.length>1&&"pl-[44px]"),children:r.map(d=>(0,b.jsx)(I,{disabled:a,condition:d,onUpdateCondition:g,onRemoveCondition:e,metadataList:c,availableStringVars:h,availableStringNodesWithParent:i,availableNumberVars:k,availableNumberNodesWithParent:l,isCommonVariable:m,availableCommonStringVars:q,availableCommonNumberVars:p},`${d.id}`))})]})},K=({metadataFilteringConditions:a,metadataList:c,onCancel:d,handleAddCondition:f,...g})=>{let{t:h}=(0,e.useTranslation)();return(0,b.jsxs)("div",{className:"w-[420px] rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-2xl",children:[(0,b.jsxs)("div",{className:"relative px-3 pt-3.5",children:[(0,b.jsx)("div",{className:"system-xl-semibold text-text-primary",children:h("nodes.knowledgeRetrieval.metadata.panel.title",{ns:"workflow"})}),(0,b.jsx)("div",{className:"absolute bottom-0 right-2.5 flex h-8 w-8 cursor-pointer items-center justify-center",onClick:d,children:(0,b.jsx)(j.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})})]}),(0,b.jsx)("div",{className:"px-1 py-2",children:(0,b.jsxs)("div",{className:"px-3 py-1",children:[(0,b.jsx)("div",{className:"pb-2",children:(0,b.jsx)(J,{metadataList:c,metadataFilteringConditions:a,...g})}),(0,b.jsx)(m.default,{metadataList:c,handleAddCondition:f})]})})]})},L=({metadataFilteringConditions:a,metadataList:c=[],handleRemoveCondition:f,selectedDatasetsLoaded:g,...h})=>{let{t:i}=(0,e.useTranslation)(),[m,n]=(0,d.useState)(!1),o=a?.conditions||[];return(0,d.useEffect)(()=>{g&&o.forEach(a=>{let b=a.metadata_id&&c.find(b=>b.id===a.metadata_id),d=!a.metadata_id&&c.find(b=>b.name===a.name);b||d||f(a.id)})},[a,c,f,g]),(0,b.jsxs)(l.PortalToFollowElem,{placement:"left",offset:4,open:m,onOpenChange:n,children:[(0,b.jsx)(l.PortalToFollowElemTrigger,{onClick:()=>n(!m),children:(0,b.jsxs)(k.default,{variant:"secondary-accent",size:"small",children:[(0,b.jsx)(j.RiFilter3Line,{className:"mr-1 h-3.5 w-3.5"}),i("nodes.knowledgeRetrieval.metadata.panel.conditions",{ns:"workflow"}),(0,b.jsx)("div",{className:"system-2xs-medium-uppercase ml-1 flex items-center rounded-[5px] border border-divider-deep px-1 text-text-tertiary",children:a?.conditions.length||0})]})}),(0,b.jsx)(l.PortalToFollowElemContent,{className:"z-10",children:(0,b.jsx)(K,{metadataFilteringConditions:a,onCancel:()=>n(!1),metadataList:c,handleRemoveCondition:f,...h})})]})};var M=i;let N=({value:a=M.MetadataFilteringModeEnum.disabled,onSelect:c})=>{let{t:f}=(0,e.useTranslation)(),[g,h]=(0,d.useState)(!1),i=[{key:M.MetadataFilteringModeEnum.disabled,value:f("nodes.knowledgeRetrieval.metadata.options.disabled.title",{ns:"workflow"}),desc:f("nodes.knowledgeRetrieval.metadata.options.disabled.subTitle",{ns:"workflow"})},{key:M.MetadataFilteringModeEnum.automatic,value:f("nodes.knowledgeRetrieval.metadata.options.automatic.title",{ns:"workflow"}),desc:f("nodes.knowledgeRetrieval.metadata.options.automatic.subTitle",{ns:"workflow"})},{key:M.MetadataFilteringModeEnum.manual,value:f("nodes.knowledgeRetrieval.metadata.options.manual.title",{ns:"workflow"}),desc:f("nodes.knowledgeRetrieval.metadata.options.manual.subTitle",{ns:"workflow"})}],m=i.find(b=>b.key===a);return(0,b.jsxs)(l.PortalToFollowElem,{placement:"bottom-end",offset:{mainAxis:4,crossAxis:0},open:g,onOpenChange:h,children:[(0,b.jsx)(l.PortalToFollowElemTrigger,{onClick:a=>{a.stopPropagation(),h(!g)},asChild:!0,children:(0,b.jsxs)(k.default,{variant:"secondary",size:"small",children:[m.value,(0,b.jsx)(j.RiArrowDownSLine,{className:"h-3.5 w-3.5"})]})}),(0,b.jsx)(l.PortalToFollowElemContent,{className:"z-10",children:(0,b.jsx)("div",{className:"w-[280px] rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur p-1 shadow-lg",children:i.map(d=>(0,b.jsxs)("div",{className:"flex cursor-pointer rounded-lg p-2 pr-3 hover:bg-state-base-hover",onClick:()=>{c(d.key),h(!1)},children:[(0,b.jsx)("div",{className:"w-4 shrink-0",children:d.key===a&&(0,b.jsx)(j.RiCheckLine,{className:"h-4 w-4 text-text-accent"})}),(0,b.jsxs)("div",{className:"grow",children:[(0,b.jsx)("div",{className:"system-sm-semibold text-text-secondary",children:d.value}),(0,b.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:d.desc})]})]},d.key))})})]})};a.s(["default",0,({metadataFilterMode:a=i.MetadataFilteringModeEnum.disabled,handleMetadataFilterModeChange:j,metadataModelConfig:k,handleMetadataModelChange:l,handleMetadataCompletionParamsChange:m,...n})=>{let{t:o}=(0,e.useTranslation)(),[p,q]=(0,d.useState)(!0),r=(0,d.useCallback)(a=>{a===i.MetadataFilteringModeEnum.automatic&&q(!1),j(a)},[j]);return(0,b.jsx)(h.default,{disabled:a===i.MetadataFilteringModeEnum.disabled||a===i.MetadataFilteringModeEnum.manual,collapsed:p,onCollapse:q,hideCollapseIcon:!0,trigger:c=>(0,b.jsxs)("div",{className:"flex grow items-center justify-between pr-4",children:[(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)("div",{className:"system-sm-semibold-uppercase mr-0.5 text-text-secondary",children:o("nodes.knowledgeRetrieval.metadata.title",{ns:"workflow"})}),(0,b.jsx)(f.default,{popupContent:(0,b.jsx)("div",{className:"w-[200px]",children:o("nodes.knowledgeRetrieval.metadata.tip",{ns:"workflow"})})}),c]}),(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)(N,{value:a,onSelect:r}),a===i.MetadataFilteringModeEnum.manual&&(0,b.jsx)("div",{className:"ml-1",children:(0,b.jsx)(L,{...n})})]})]}),children:(0,b.jsx)(b.Fragment,{children:a===i.MetadataFilteringModeEnum.automatic&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"body-xs-regular px-4 text-text-tertiary",children:o("nodes.knowledgeRetrieval.metadata.options.automatic.desc",{ns:"workflow"})}),(0,b.jsx)("div",{className:"mt-1 px-4",children:(0,b.jsx)(g.default,{portalToFollowElemContentClassName:"z-[50]",popupClassName:"!w-[387px]",isInWorkflow:!0,isAdvancedMode:!0,provider:k?.provider||"",completionParams:k?.completion_params||{temperature:.7},modelId:k?.name||"",setModel:l||c.noop,onCompletionParamsChange:m||c.noop,hideDebugWithMultipleModel:!0,debugWithMultipleModel:!1})})]})})})}],658584)},866838,a=>{"use strict";var b=a.i(608061),c=a.i(57843);a.i(752298);var d=a.i(693025),e=a.i(757801),f=a.i(416985),g=a.i(102170),h=a.i(81492),i=a.i(114715),j=a.i(483664),k=a.i(933988),l=a.i(701458),m=a.i(962800),n=a.i(403473),o=a.i(29936),p=a.i(986431),q=a.i(954200),r=a.i(527344),s=a.i(295932);let t=()=>{},u=()=>{},v=(0,c.memo)(({datasetConfigs:a,onChange:v,isInWorkflow:w,singleRetrievalModelConfig:x={},onSingleRetrievalModelChange:y=t,onSingleRetrievalModelParamsChange:z=u,selectedDatasets:A=[]})=>{let{t:B}=(0,d.useTranslation)(),C=(0,c.useMemo)(()=>(0,o.getSelectedDatasetsMode)(A),[A]),D=a.retrieval_model;(0,c.useEffect)(()=>{D===q.RETRIEVE_TYPE.oneWay&&v({...a,retrieval_model:q.RETRIEVE_TYPE.multiWay},w)},[D,a,w,v]);let{modelList:E,currentModel:F,currentProvider:G}=(0,l.useModelListAndDefaultModelAndCurrentProviderAndModel)(k.ModelTypeEnum.rerank),{currentModel:H}=(0,l.useCurrentProviderAndModel)(E,{provider:a.reranking_model?.reranking_provider_name||G?.provider||"",model:a.reranking_model?.reranking_model_name||F?.model||""}),I=(0,c.useMemo)(()=>({provider_name:a.reranking_model?.reranking_provider_name??"",model_name:a.reranking_model?.reranking_model_name??""}),[a.reranking_model]),J=(b,c)=>{"top_k"===b?v({...a,top_k:c}):"score_threshold"===b&&v({...a,score_threshold:c})},K=(b,c)=>{"top_k"!==b&&v({...a,score_threshold_enabled:c})},L=[{value:p.RerankingModeEnum.WeightedScore,label:B("weightedScore.title",{ns:"dataset"}),tips:B("weightedScore.description",{ns:"dataset"})},{value:p.RerankingModeEnum.RerankingModel,label:B("modelProvider.rerankModel.key",{ns:"common"}),tips:B("modelProvider.rerankModel.tip",{ns:"common"})}],M=C.allHighQuality&&!C.inconsistentEmbeddingModel,N=M&&a.reranking_mode===p.RerankingModeEnum.WeightedScore&&a.weights,O=a.reranking_mode||p.RerankingModeEnum.RerankingModel,P=(0,c.useMemo)(()=>C.allInternal&&C.allEconomic||C.allExternal,[C.allEconomic,C.allExternal,C.allInternal]),Q=(0,c.useMemo)(()=>!P||a.reranking_enable,[a.reranking_enable,P]),R=(0,c.useCallback)(b=>{!H&&b&&i.default.notify({type:"error",message:B("errorMsg.rerankModelRequired",{ns:"workflow"})}),v({...a,reranking_enable:b})},[H,a,v]);return(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"system-xl-semibold text-text-primary",children:B("retrievalSettings",{ns:"dataset"})}),(0,b.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:B("defaultRetrievalTip",{ns:"dataset"})}),D===q.RETRIEVE_TYPE.multiWay&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"my-2 flex h-6 items-center py-1",children:[(0,b.jsx)("div",{className:"system-xs-semibold-uppercase mr-2 shrink-0 text-text-secondary",children:B("rerankSettings",{ns:"dataset"})}),(0,b.jsx)(e.default,{bgStyle:"gradient",className:"mx-0 !h-px"})]}),C.inconsistentEmbeddingModel&&(0,b.jsx)("div",{className:"system-xs-medium mt-4 text-text-warning",children:B("inconsistentEmbeddingModelTip",{ns:"dataset"})}),C.mixtureInternalAndExternal&&(0,b.jsx)("div",{className:"system-xs-medium mt-4 text-text-warning",children:B("mixtureInternalAndExternalTip",{ns:"dataset"})}),C.allExternal&&(0,b.jsx)("div",{className:"system-xs-medium mt-4 text-text-warning",children:B("allExternalTip",{ns:"dataset"})}),C.mixtureHighQualityAndEconomic&&(0,b.jsx)("div",{className:"system-xs-medium mt-4 text-text-warning",children:B("mixtureHighQualityAndEconomicTip",{ns:"dataset"})}),M&&(0,b.jsx)("div",{className:"flex items-center justify-between",children:L.map(c=>(0,b.jsxs)("div",{className:(0,r.cn)("system-sm-medium flex h-8 w-[calc((100%-8px)/2)] cursor-pointer items-center justify-center rounded-lg border border-components-option-card-option-border bg-components-option-card-option-bg text-text-secondary",O===c.value&&"border-[1.5px] border-components-option-card-option-selected-border bg-components-option-card-option-selected-bg text-text-primary"),onClick:()=>{var b;(b=c.value)!==a.reranking_mode&&(b!==p.RerankingModeEnum.RerankingModel||H||i.default.notify({type:"error",message:B("errorMsg.rerankModelRequired",{ns:"workflow"})}),v({...a,reranking_mode:b}))},children:[(0,b.jsx)("div",{className:"truncate",children:c.label}),(0,b.jsx)(j.default,{popupContent:(0,b.jsx)("div",{className:"w-[200px]",children:c.tips}),popupClassName:"ml-0.5",triggerClassName:"ml-0.5 w-3.5 h-3.5"})]},c.value))}),!N&&(0,b.jsxs)("div",{className:"mt-2",children:[(0,b.jsxs)("div",{className:"flex items-center",children:[P&&(0,b.jsx)(h.default,{size:"md",defaultValue:Q,onChange:R}),(0,b.jsx)("div",{className:"system-sm-semibold ml-1 leading-[32px] text-text-secondary",children:B("modelProvider.rerankModel.key",{ns:"common"})}),(0,b.jsx)(j.default,{popupContent:(0,b.jsx)("div",{className:"w-[200px]",children:B("modelProvider.rerankModel.tip",{ns:"common"})}),popupClassName:"ml-1",triggerClassName:"ml-1 w-4 h-4"})]}),Q&&(0,b.jsx)("div",{children:(0,b.jsx)(n.default,{defaultModel:I&&{provider:I?.provider_name,model:I?.model_name},onSelect:b=>{v({...a,reranking_model:{reranking_provider_name:b.provider,reranking_model_name:b.model}})},modelList:E})})]}),N&&(0,b.jsxs)("div",{className:"mt-2 space-y-4",children:[(0,b.jsx)(s.default,{value:{value:[a.weights.vector_setting.vector_weight,a.weights.keyword_setting.keyword_weight]},onChange:b=>{v({...a,weights:{...a.weights,vector_setting:{...a.weights.vector_setting,vector_weight:b.value[0]},keyword_setting:{keyword_weight:b.value[1]}}})}}),(0,b.jsx)(g.default,{value:a.top_k,onChange:J,enable:!0}),(0,b.jsx)(f.default,{value:a.score_threshold,onChange:J,enable:a.score_threshold_enabled,hasSwitch:!0,onSwitchChange:K})]}),!N&&(0,b.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,b.jsx)(g.default,{value:a.top_k,onChange:J,enable:!0}),Q&&(0,b.jsx)(f.default,{value:a.score_threshold,onChange:J,enable:a.score_threshold_enabled,hasSwitch:!0,onSwitchChange:K})]})]}),w&&D===q.RETRIEVE_TYPE.oneWay&&(0,b.jsxs)("div",{className:"mt-4",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-0.5",children:[(0,b.jsx)("div",{className:"text-[13px] font-medium leading-[32px] text-text-primary",children:B("modelProvider.systemReasoningModel.key",{ns:"common"})}),(0,b.jsx)(j.default,{popupContent:B("modelProvider.systemReasoningModel.tip",{ns:"common"})})]}),(0,b.jsx)(m.default,{isInWorkflow:w,popupClassName:"!w-[387px]",portalToFollowElemContentClassName:"!z-[1002]",isAdvancedMode:!0,provider:x?.provider,completionParams:x?.completion_params,modelId:x?.name,setModel:y,onCompletionParamsChange:z,hideDebugWithMultipleModel:!0,debugWithMultipleModel:!1})]})]})});a.s(["default",0,v],866838)},589905,a=>{"use strict";var b=a.i(608061),c=a.i(57843);a.i(752298);var d=a.i(693025),e=a.i(527344);let f=c.memo(({className:a,title:c,isOptional:f,children:g})=>{let{t:h}=(0,d.useTranslation)();return(0,b.jsxs)("div",{className:(0,e.cn)(a),children:[(0,b.jsxs)("div",{className:"system-sm-semibold leading-8 text-text-secondary",children:[c,f&&(0,b.jsxs)("span",{className:"system-xs-regular ml-1 text-text-tertiary",children:["(",h("variableConfig.optional",{ns:"appDebug"}),")"]})]}),(0,b.jsx)("div",{children:g})]})});a.s(["default",0,f])},492010,a=>{"use strict";var b=a.i(608061),c=a.i(429150),d=a.i(57843),e=a.i(735310);let f=d.memo(({className:a,type:d})=>{let f={[e.InputVarType.textInput]:c.RiTextSnippet,[e.InputVarType.paragraph]:c.RiAlignLeft,[e.InputVarType.select]:c.RiCheckboxMultipleLine,[e.InputVarType.number]:c.RiHashtag,[e.InputVarType.checkbox]:c.RiCheckboxLine,[e.InputVarType.jsonObject]:c.RiBracesLine,[e.InputVarType.singleFile]:c.RiFileList2Line,[e.InputVarType.multiFiles]:c.RiFileCopy2Line}[d]||c.RiTextSnippet;return(0,b.jsx)(f,{className:a})});a.s(["default",0,f])},709656,a=>{"use strict";var b=a.i(608061),c=a.i(494261),d=a.i(57843);a.i(752298);var e=a.i(693025),f=a.i(589905),g=a.i(220583),h=a.i(763539),i=a.i(954200),j=a.i(573912),k=a.i(735310),l=a.i(583252),m=a.i(294318),n=a.i(335913);let o=d.memo(({payload:a,isMultiple:o,inFeaturePanel:p=!1,hideSupportFileType:q=!1,onChange:r})=>{let{t:s}=(0,e.useTranslation)(),{allowed_file_upload_methods:t,max_length:u,allowed_file_types:v,allowed_file_extensions:w}=a,{data:x}=(0,h.useFileUploadConfig)(),{imgSizeLimit:y,docSizeLimit:z,audioSizeLimit:A,videoSizeLimit:B,maxFileUploadLimit:C}=(0,g.useFileSizeLimit)(x),D=(0,d.useCallback)(b=>{r((0,c.produce)(a,a=>{b===k.SupportUploadFileTypes.custom?a.allowed_file_types.includes(k.SupportUploadFileTypes.custom)?a.allowed_file_types=a.allowed_file_types.filter(a=>a!==b):a.allowed_file_types=[k.SupportUploadFileTypes.custom]:(a.allowed_file_types=a.allowed_file_types.filter(a=>a!==k.SupportUploadFileTypes.custom),a.allowed_file_types.includes(b)?a.allowed_file_types=a.allowed_file_types.filter(a=>a!==b):a.allowed_file_types.push(b))}))},[r,a]),E=(0,d.useCallback)(b=>()=>{r((0,c.produce)(a,a=>{b===i.TransferMethod.all?a.allowed_file_upload_methods=[i.TransferMethod.local_file,i.TransferMethod.remote_url]:a.allowed_file_upload_methods=[b]}))},[r,a]),F=(0,d.useCallback)(b=>{r((0,c.produce)(a,a=>{a.allowed_file_extensions=b.map(a=>a)}))},[r,a]),G=(0,d.useCallback)(b=>{r((0,c.produce)(a,a=>{a.max_length=b}))},[r,a]);return(0,b.jsxs)("div",{children:[!p&&(0,b.jsx)(f.default,{title:s("variableConfig.file.supportFileTypes",{ns:"appDebug"}),children:(0,b.jsxs)("div",{className:"space-y-1",children:[[k.SupportUploadFileTypes.document,k.SupportUploadFileTypes.image,k.SupportUploadFileTypes.audio,k.SupportUploadFileTypes.video].map(a=>(0,b.jsx)(l.default,{type:a,selected:v.includes(a),onToggle:D},a)),(0,b.jsx)(l.default,{type:k.SupportUploadFileTypes.custom,selected:v.includes(k.SupportUploadFileTypes.custom),onToggle:D,customFileTypes:w,onCustomFileTypesChange:F})]})}),(0,b.jsx)(f.default,{title:s("variableConfig.uploadFileTypes",{ns:"appDebug"}),className:"mt-4",children:(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,b.jsx)(n.default,{title:s("variableConfig.localUpload",{ns:"appDebug"}),selected:1===t.length&&t.includes(i.TransferMethod.local_file),onSelect:E(i.TransferMethod.local_file)}),(0,b.jsx)(n.default,{title:"URL",selected:1===t.length&&t.includes(i.TransferMethod.remote_url),onSelect:E(i.TransferMethod.remote_url)}),(0,b.jsx)(n.default,{title:s("variableConfig.both",{ns:"appDebug"}),selected:t.includes(i.TransferMethod.local_file)&&t.includes(i.TransferMethod.remote_url),onSelect:E(i.TransferMethod.all)})]})}),o&&(0,b.jsx)(f.default,{className:"mt-4",title:s("variableConfig.maxNumberOfUploads",{ns:"appDebug"}),children:(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"body-xs-regular mb-1.5 text-text-tertiary",children:s("variableConfig.maxNumberTip",{ns:"appDebug",imgLimit:(0,j.formatFileSize)(y),docLimit:(0,j.formatFileSize)(z),audioLimit:(0,j.formatFileSize)(A),videoLimit:(0,j.formatFileSize)(B)})}),(0,b.jsx)(m.default,{value:u,min:1,max:C,onChange:G})]})}),p&&!q&&(0,b.jsx)(f.default,{title:s("variableConfig.file.supportFileTypes",{ns:"appDebug"}),className:"mt-4",children:(0,b.jsxs)("div",{className:"space-y-1",children:[[k.SupportUploadFileTypes.document,k.SupportUploadFileTypes.image,k.SupportUploadFileTypes.audio,k.SupportUploadFileTypes.video].map(a=>(0,b.jsx)(l.default,{type:a,selected:v.includes(a),onToggle:D},a)),(0,b.jsx)(l.default,{type:k.SupportUploadFileTypes.custom,selected:v.includes(k.SupportUploadFileTypes.custom),onToggle:D,customFileTypes:w,onCustomFileTypesChange:F})]})})]})});a.s(["default",0,o])},120179,a=>{"use strict";var b=a.i(111089),c=a.i(639378),d=a.i(18039),e=a.i(158873),f=a.i(954200);let g=(0,c.createContext)({readonly:!1,appId:"",isAPIKeySet:!1,isTrailFinished:!1,mode:f.AppModeEnum.CHAT,modelModeType:f.ModelModeType.chat,promptMode:e.PromptMode.simple,setPromptMode:b.noop,isAdvancedMode:!1,isAgent:!1,isFunctionCall:!1,isOpenAI:!1,collectionList:[],canReturnToSimpleMode:!1,setCanReturnToSimpleMode:b.noop,chatPromptConfig:d.DEFAULT_CHAT_PROMPT_CONFIG,completionPromptConfig:d.DEFAULT_COMPLETION_PROMPT_CONFIG,currentAdvancedPrompt:[],showHistoryModal:b.noop,conversationHistoriesRole:{user_prefix:"user",assistant_prefix:"assistant"},setConversationHistoriesRole:b.noop,setCurrentAdvancedPrompt:b.noop,hasSetBlockStatus:{context:!1,history:!1,query:!1},conversationId:"",setConversationId:b.noop,introduction:"",setIntroduction:b.noop,suggestedQuestions:[],setSuggestedQuestions:b.noop,controlClearChatMessage:0,setControlClearChatMessage:b.noop,prevPromptConfig:{prompt_template:"",prompt_variables:[]},setPrevPromptConfig:b.noop,moreLikeThisConfig:{enabled:!1},setMoreLikeThisConfig:b.noop,suggestedQuestionsAfterAnswerConfig:{enabled:!1},setSuggestedQuestionsAfterAnswerConfig:b.noop,speechToTextConfig:{enabled:!1},setSpeechToTextConfig:b.noop,textToSpeechConfig:{enabled:!1,voice:"",language:""},setTextToSpeechConfig:b.noop,citationConfig:{enabled:!1},setCitationConfig:b.noop,moderationConfig:{enabled:!1},annotationConfig:{id:"",enabled:!1,score_threshold:d.ANNOTATION_DEFAULT.score_threshold,embedding_model:{embedding_model_name:"",embedding_provider_name:""}},setAnnotationConfig:b.noop,setModerationConfig:b.noop,externalDataToolsConfig:[],setExternalDataToolsConfig:b.noop,formattingChanged:!1,setFormattingChanged:b.noop,inputs:{},setInputs:b.noop,query:"",setQuery:b.noop,completionParams:{max_tokens:16,temperature:1,top_p:1,presence_penalty:1,frequency_penalty:1},setCompletionParams:b.noop,modelConfig:{provider:"OPENAI",model_id:"gpt-3.5-turbo",mode:f.ModelModeType.unset,configs:{prompt_template:"",prompt_variables:[]},chat_prompt_config:d.DEFAULT_CHAT_PROMPT_CONFIG,completion_prompt_config:d.DEFAULT_COMPLETION_PROMPT_CONFIG,more_like_this:null,opening_statement:"",suggested_questions:[],sensitive_word_avoidance:null,speech_to_text:null,text_to_speech:null,file_upload:null,suggested_questions_after_answer:null,retriever_resource:null,annotation_reply:null,external_data_tools:[],system_parameters:{audio_file_size_limit:0,file_size_limit:0,image_file_size_limit:0,video_file_size_limit:0,workflow_file_upload_limit:0},dataSets:[],agentConfig:d.DEFAULT_AGENT_SETTING},setModelConfig:b.noop,dataSets:[],showSelectDataSet:b.noop,setDataSets:b.noop,datasetConfigs:{retrieval_model:f.RETRIEVE_TYPE.multiWay,reranking_model:{reranking_provider_name:"",reranking_model_name:""},top_k:4,score_threshold_enabled:!1,score_threshold:.7,datasets:{datasets:[]}},datasetConfigsRef:{current:null},setDatasetConfigs:b.noop,hasSetContextVar:!1,isShowVisionConfig:!1,visionConfig:{enabled:!1,number_limits:2,detail:f.Resolution.low,transfer_methods:[f.TransferMethod.remote_url]},setVisionConfig:b.noop,isAllowVideoUpload:!1,isShowDocumentConfig:!1,isShowAudioConfig:!1,rerankSettingModalOpen:!1,setRerankSettingModalOpen:b.noop});a.s(["default",0,g,"useDebugConfigurationContext",0,()=>(0,c.useContext)(g)])},732248,931280,172921,a=>{"use strict";var b=a.i(608061),c=a.i(57843),d=a.i(816134);let e=c.memo(({value:a,onChange:e,maxLength:f})=>((0,c.useEffect)(()=>{a&&a>f&&e(f)},[a,f,e]),(0,b.jsx)("div",{children:(0,b.jsx)(d.default,{type:"number",max:f,min:1,value:a||"",onChange:a=>{let b=Number.parseInt(a.target.value,10);b>f?b=f:b<1&&(b=1),e(b)}})})));a.s(["default",0,e],732248),a.i(752298);var f=a.i(693025),g=a.i(909795);let h=c.memo(({onConfirm:a,onCancel:c})=>{let{t:d}=(0,f.useTranslation)();return(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,b.jsx)(g.default,{onClick:c,children:d("operation.cancel",{ns:"common"})}),(0,b.jsx)(g.default,{variant:"primary",onClick:a,children:d("operation.save",{ns:"common"})})]})});a.s(["default",0,h],931280);let i=JSON.stringify({type:"object",properties:{foo:{type:"string"},bar:{type:"object",properties:{sub:{type:"number"}},required:[],additionalProperties:!0}},required:[],additionalProperties:!0},null,2);a.s(["jsonConfigPlaceHolder",0,i],172921)},414622,a=>{"use strict";var b=a.i(608061),c=a.i(494261),d=a.i(57843);a.i(752298);var e=a.i(693025),f=a.i(639378),g=a.i(243103),h=a.i(168799);a.i(3626);var i=a.i(684714),j=a.i(816134),k=a.i(940272),l=a.i(805611),m=a.i(146172),n=a.i(114715),o=a.i(252613),p=a.i(373178),q=a.i(709656),r=a.i(787405),s=a.i(735310),t=a.i(120179),u=a.i(954200),v=a.i(499257),w=a.i(138464),x=a.i(732248),y=a.i(931280),z=a.i(172921),A=a.i(589905),B=a.i(121434),C=a.i(218865),D=a.i(825319),E=a.i(492010),F=a.i(986963),G=a.i(527344);let H=({value:a,onSelect:c,items:e,popupInnerClassName:f,readonly:g})=>{let[h,i]=(0,d.useState)(!1),j=a?e.find(b=>b.value===a):void 0;return(0,b.jsxs)(D.PortalToFollowElem,{open:h,onOpenChange:i,placement:"bottom-start",offset:4,children:[(0,b.jsx)(D.PortalToFollowElemTrigger,{onClick:()=>!g&&i(a=>!a),className:"w-full",children:(0,b.jsxs)("div",{className:(0,G.cn)(`group flex h-9 items-center justify-between rounded-lg border-0 bg-components-input-bg-normal px-2 text-sm hover:bg-state-base-hover-alt ${g?"cursor-not-allowed":"cursor-pointer"}`),title:j?.name,children:[(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)(E.default,{type:j?.value,className:"size-4 shrink-0 text-text-secondary"}),(0,b.jsx)("span",{className:`
              ml-1.5 text-components-input-text-filled ${!j?.name&&"text-components-input-text-placeholder"}
            `,children:j?.name})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,b.jsx)(C.default,{uppercase:!1,children:(0,F.inputVarTypeToVarType)(j?.value)}),(0,b.jsx)(B.ChevronDownIcon,{className:(0,G.cn)("h-4 w-4 shrink-0 text-text-quaternary group-hover:text-text-secondary",h&&"text-text-secondary")})]})]})}),(0,b.jsx)(D.PortalToFollowElemContent,{className:"z-[61]",children:(0,b.jsx)("div",{className:(0,G.cn)("w-[432px] rounded-md border-[0.5px] border-components-panel-border bg-components-panel-bg px-1 py-1 text-base shadow-lg focus:outline-none sm:text-sm",f),children:e.map(a=>(0,b.jsxs)("div",{className:"flex h-9 cursor-pointer items-center justify-between rounded-lg px-2 text-text-secondary hover:bg-state-base-hover",title:a.name,onClick:()=>{c(a),i(!1)},children:[(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(E.default,{type:a.value,className:"size-4 shrink-0 text-text-secondary"}),(0,b.jsx)("span",{title:a.name,children:a.name})]}),(0,b.jsx)(C.default,{uppercase:!1,children:(0,F.inputVarTypeToVarType)(a.value)})]},a.value))})})]})},I="true",J="false",K=d.memo(({isCreate:a,payload:B,isShow:C,onClose:D,onConfirm:E,supportFile:F})=>{let{modelConfig:G}=(0,f.useContext)(t.default),{t:K}=(0,e.useTranslation)(),[L,M]=(0,d.useState)(()=>{var a;return(a=B||(0,v.getNewVarInWorkflow)("")).type===s.InputVarType.select&&""===a.default?{...a,default:void 0}:a}),{type:N,label:O,variable:P,options:Q,max_length:R}=L,S=(0,d.useRef)(null),T=(0,g.useStore)(a=>a.appDetail),U=T?.mode!==u.AppModeEnum.ADVANCED_CHAT&&T?.mode!==u.AppModeEnum.WORKFLOW,V=(0,d.useMemo)(()=>{if(N!==s.InputVarType.jsonObject||!L.json_schema)return"";try{return L.json_schema}catch{return""}},[L.json_schema]);(0,d.useEffect)(()=>{C&&S.current?.focus()},[C]);let W=N===s.InputVarType.textInput||N===s.InputVarType.paragraph,X=(0,d.useCallback)((a,b)=>{let{isValid:c,errorMessageKey:d}=(0,v.checkKeys)([a],b);return!!c||(n.default.notify({type:"error",message:K(`varKeyError.${d}`,{ns:"appDebug",key:K("variableConfig.varName",{ns:"appDebug"})})}),!1)},[K]),Y=(0,d.useCallback)(a=>b=>{M(c=>{let d={...c,[a]:b};return"options"===a&&c.default&&((Array.isArray(b)?b:[]).includes(c.default)||(d.default=void 0)),d})},[]),Z=(0,d.useCallback)(a=>{if(null==a||""===a.trim())return Y("json_schema")(void 0),null;try{let b=JSON.parse(a);Y("json_schema")(JSON.stringify(b,null,2))}catch{return null}},[Y]),$=[{name:K("variableConfig.text-input",{ns:"appDebug"}),value:s.InputVarType.textInput},{name:K("variableConfig.paragraph",{ns:"appDebug"}),value:s.InputVarType.paragraph},{name:K("variableConfig.select",{ns:"appDebug"}),value:s.InputVarType.select},{name:K("variableConfig.number",{ns:"appDebug"}),value:s.InputVarType.number},{name:K("variableConfig.checkbox",{ns:"appDebug"}),value:s.InputVarType.checkbox},...F?[{name:K("variableConfig.single-file",{ns:"appDebug"}),value:s.InputVarType.singleFile},{name:K("variableConfig.multi-files",{ns:"appDebug"}),value:s.InputVarType.multiFiles}]:[],...U?[]:[{name:K("variableConfig.json",{ns:"appDebug"}),value:s.InputVarType.jsonObject}]],_=(0,d.useCallback)(a=>{let b=a.value;M((0,c.produce)(L,a=>{a.type=b,b===s.InputVarType.select&&(a.default=void 0),[s.InputVarType.singleFile,s.InputVarType.multiFiles].includes(b)&&(Object.keys(o.DEFAULT_FILE_UPLOAD_SETTING).forEach(b=>{"max_length"!==b&&(a[b]=o.DEFAULT_FILE_UPLOAD_SETTING[b])}),b===s.InputVarType.multiFiles&&(a.max_length=o.DEFAULT_FILE_UPLOAD_SETTING.max_length))}))},[L]),aa=(0,d.useCallback)(a=>{let b=a.target.value;X(b,!0)&&!L.label&&M(a=>({...a,label:b}))},[X,L.label]),ab=(0,d.useCallback)(a=>{(0,v.replaceSpaceWithUnderscoreInVarNameInput)(a.target);let b=a.target.value,{isValid:c,errorKey:d,errorMessageKey:e}=(0,v.checkKeys)([b],!0);c?Y("variable")(a.target.value):n.default.notify({type:"error",message:K(`varKeyError.${e}`,{ns:"appDebug",key:d})})},[Y,K]),ac=(0,d.useMemo)(()=>{var a;return"boolean"==typeof(a=L.default)?a?I:J:"string"==typeof a&&a.toLowerCase()===I?I:J},[L.default]);return(0,b.jsxs)(k.default,{title:K(`variableConfig.${a?"addModalTitle":"editModalTitle"}`,{ns:"appDebug"}),isShow:C,onClose:D,children:[(0,b.jsx)("div",{className:"mb-8",ref:S,tabIndex:-1,children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(A.default,{title:K("variableConfig.fieldType",{ns:"appDebug"}),children:(0,b.jsx)(H,{value:N,items:$,onSelect:_})}),(0,b.jsx)(A.default,{title:K("variableConfig.varName",{ns:"appDebug"}),children:(0,b.jsx)(j.default,{value:P,onChange:ab,onBlur:aa,placeholder:K("variableConfig.inputPlaceholder",{ns:"appDebug"})})}),(0,b.jsx)(A.default,{title:K("variableConfig.labelName",{ns:"appDebug"}),children:(0,b.jsx)(j.default,{value:O,onChange:a=>Y("label")(a.target.value),placeholder:K("variableConfig.inputPlaceholder",{ns:"appDebug"})})}),W&&(0,b.jsx)(A.default,{title:K("variableConfig.maxLength",{ns:"appDebug"}),children:(0,b.jsx)(x.default,{maxLength:N===s.InputVarType.textInput?256:1/0,modelId:G.model_id,value:R,onChange:Y("max_length")})}),N===s.InputVarType.textInput&&(0,b.jsx)(A.default,{title:K("variableConfig.defaultValue",{ns:"appDebug"}),children:(0,b.jsx)(j.default,{value:L.default||"",onChange:a=>Y("default")(a.target.value||void 0),placeholder:K("variableConfig.inputPlaceholder",{ns:"appDebug"})})}),N===s.InputVarType.paragraph&&(0,b.jsx)(A.default,{title:K("variableConfig.defaultValue",{ns:"appDebug"}),children:(0,b.jsx)(m.default,{value:String(L.default??""),onChange:a=>Y("default")(a.target.value||void 0),placeholder:K("variableConfig.inputPlaceholder",{ns:"appDebug"})})}),N===s.InputVarType.number&&(0,b.jsx)(A.default,{title:K("variableConfig.defaultValue",{ns:"appDebug"}),children:(0,b.jsx)(j.default,{type:"number",value:L.default||"",onChange:a=>Y("default")(a.target.value||void 0),placeholder:K("variableConfig.inputPlaceholder",{ns:"appDebug"})})}),N===s.InputVarType.checkbox&&(0,b.jsx)(A.default,{title:K("variableConfig.defaultValue",{ns:"appDebug"}),children:(0,b.jsx)(l.SimpleSelect,{className:"w-full",optionWrapClassName:"max-h-[140px] overflow-y-auto",items:[{value:I,name:K("variableConfig.startChecked",{ns:"appDebug"})},{value:J,name:K("variableConfig.noDefaultSelected",{ns:"appDebug"})}],defaultValue:ac,onSelect:a=>Y("default")(String(a.value)===I),placeholder:K("variableConfig.selectDefaultValue",{ns:"appDebug"}),allowSearch:!1})}),N===s.InputVarType.select&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(A.default,{title:K("variableConfig.options",{ns:"appDebug"}),children:(0,b.jsx)(w.default,{options:Q||[],onChange:Y("options")})}),Q&&Q.length>0&&(0,b.jsx)(A.default,{title:K("variableConfig.defaultValue",{ns:"appDebug"}),children:(0,b.jsx)(l.SimpleSelect,{className:"w-full",optionWrapClassName:"max-h-[140px] overflow-y-auto",items:[{value:"",name:K("variableConfig.noDefaultValue",{ns:"appDebug"})},...Q.filter(a=>""!==a.trim()).map(a=>({value:a,name:a}))],defaultValue:L.default||"",onSelect:a=>Y("default")(""===a.value?void 0:a.value),placeholder:K("variableConfig.selectDefaultValue",{ns:"appDebug"}),allowSearch:!1},`default-select-${Q.join("-")}`)})]}),[s.InputVarType.singleFile,s.InputVarType.multiFiles].includes(N)&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(q.default,{payload:L,onChange:a=>M(a),isMultiple:N===s.InputVarType.multiFiles}),(0,b.jsx)(A.default,{title:K("variableConfig.defaultValue",{ns:"appDebug"}),children:(0,b.jsx)(i.FileUploaderInAttachmentWrapper,{value:N===s.InputVarType.singleFile?L.default?[L.default]:[]:L.default||[],onChange:a=>{N===s.InputVarType.singleFile?Y("default")(a?.[0]||void 0):Y("default")(a||void 0)},fileConfig:{allowed_file_types:L.allowed_file_types||[s.SupportUploadFileTypes.document],allowed_file_extensions:L.allowed_file_extensions||[],allowed_file_upload_methods:L.allowed_file_upload_methods||[u.TransferMethod.remote_url],number_limits:N===s.InputVarType.singleFile?1:L.max_length||5}})})]}),N===s.InputVarType.jsonObject&&(0,b.jsx)(A.default,{title:K("variableConfig.jsonSchema",{ns:"appDebug"}),isOptional:!0,children:(0,b.jsx)(p.default,{language:r.CodeLanguage.json,value:V,onChange:Z,noWrapper:!0,className:"bg h-[80px] overflow-y-auto rounded-[10px] bg-components-input-bg-normal p-1",placeholder:(0,b.jsx)("div",{className:"whitespace-pre",children:z.jsonConfigPlaceHolder})})}),(0,b.jsxs)("div",{className:"!mt-5 flex h-6 items-center space-x-2",children:[(0,b.jsx)(h.default,{checked:L.required,disabled:L.hide,onCheck:()=>Y("required")(!L.required)}),(0,b.jsx)("span",{className:"system-sm-semibold text-text-secondary",children:K("variableConfig.required",{ns:"appDebug"})})]}),(0,b.jsxs)("div",{className:"!mt-5 flex h-6 items-center space-x-2",children:[(0,b.jsx)(h.default,{checked:L.hide,disabled:L.required,onCheck:()=>Y("hide")(!L.hide)}),(0,b.jsx)("span",{className:"system-sm-semibold text-text-secondary",children:K("variableConfig.hide",{ns:"appDebug"})})]})]})}),(0,b.jsx)(y.default,{onConfirm:()=>{let a=L.json_schema,b=null==a||"string"==typeof a&&""===a.trim(),c=b?void 0:a,d=L.type===s.InputVarType.jsonObject&&b?{...L,json_schema:void 0}:L,e=L.variable===B?.variable?void 0:{type:s.ChangeType.changeVarName,payload:{beforeKey:B?.variable||"",afterKey:L.variable}};if(X(L.variable)){if(!L.label)return void n.default.notify({type:"error",message:K("variableConfig.errorMsg.labelNameRequired",{ns:"appDebug"})});if(W||N===s.InputVarType.number)E(d,e);else if(N===s.InputVarType.select){if(Q?.length===0)return void n.default.notify({type:"error",message:K("variableConfig.errorMsg.atLeastOneOption",{ns:"appDebug"})});let a={},b=!1;if(Q?.forEach(c=>{if(a[c]){b=!0;return}a[c]=!0}),b)return void n.default.notify({type:"error",message:K("variableConfig.errorMsg.optionRepeat",{ns:"appDebug"})});E(d,e)}else if([s.InputVarType.singleFile,s.InputVarType.multiFiles].includes(N)){if(L.allowed_file_types?.length===0){let a=K("errorMsg.fieldRequired",{ns:"workflow",field:K("variableConfig.file.supportFileTypes",{ns:"appDebug"})});n.default.notify({type:"error",message:a});return}if(L.allowed_file_types?.includes(s.SupportUploadFileTypes.custom)&&!L.allowed_file_extensions?.length){let a=K("errorMsg.fieldRequired",{ns:"workflow",field:K("variableConfig.file.custom.name",{ns:"appDebug"})});n.default.notify({type:"error",message:a});return}E(d,e)}else if(N===s.InputVarType.jsonObject){if(!b&&"string"==typeof c)try{let a=JSON.parse(c);if(a?.type!=="object")return void n.default.notify({type:"error",message:K("variableConfig.errorMsg.jsonSchemaMustBeObject",{ns:"appDebug"})})}catch{n.default.notify({type:"error",message:K("variableConfig.errorMsg.jsonSchemaInvalid",{ns:"appDebug"})});return}E(d,e)}else E(d,e)}},onCancel:D})]})});a.s(["default",0,K],414622)}];

//# sourceMappingURL=_75888380._.js.map
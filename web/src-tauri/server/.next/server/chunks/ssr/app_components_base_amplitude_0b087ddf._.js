module.exports=[298442,295474,178865,a=>{"use strict";let b,c,d,e,f;var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ab,ac,ad,ae,af,ag,ah=a.i(314875);(g=K||(K={}))[g.None=0]="None",g[g.Error=1]="Error",g[g.Warn=2]="Warn",g[g.Verbose=3]="Verbose",g[g.Debug=4]="Debug";var ai=function(a){return void 0===a&&(a=0),(Error().stack||"").split("\n").slice(2+a).map(function(a){return a.trim()})},aj=function(a){return function(){var b=(0,ah.__assign)({},a.config);return{logger:b.loggerProvider,logLevel:b.logLevel}}},ak=function(a,b){var c,d;b=(b=b.replace(/\[(\w+)\]/g,".$1")).replace(/^\./,"");try{for(var e=(0,ah.__values)(b.split(".")),f=e.next();!f.done;f=e.next()){var g=f.value;if(!(g in a))return;a=a[g]}}catch(a){c={error:a}}finally{try{f&&!f.done&&(d=e.return)&&d.call(e)}finally{if(c)throw c.error}}return a},al=function(a,b){return function(){var c,d,e={};try{for(var f=(0,ah.__values)(b),g=f.next();!g.done;g=f.next()){var h=g.value;e[h]=ak(a,h)}}catch(a){c={error:a}}finally{try{g&&!g.done&&(d=f.return)&&d.call(f)}finally{if(c)throw c.error}}return e}},am=function(a,b,c,d,e){return void 0===e&&(e=null),function(){for(var f=[],g=0;g<arguments.length;g++)f[g]=arguments[g];var h=c(),i=h.logger,j=h.logLevel;if(j&&j<K.Debug||!j||!i)return a.apply(e,f);var k={type:"invoke public method",name:b,args:f,stacktrace:ai(1),time:{start:new Date().toISOString()},states:{}};d&&k.states&&(k.states.before=d());var l=a.apply(e,f);return l&&l.promise?l.promise.then(function(){d&&k.states&&(k.states.after=d()),k.time&&(k.time.end=new Date().toISOString()),i.debug(JSON.stringify(k,null,2))}):(d&&k.states&&(k.states.after=d()),k.time&&(k.time.end=new Date().toISOString()),i.debug(JSON.stringify(k,null,2))),l}};(h=L||(L={})).SET="$set",h.SET_ONCE="$setOnce",h.ADD="$add",h.APPEND="$append",h.PREPEND="$prepend",h.REMOVE="$remove",h.PREINSERT="$preInsert",h.POSTINSERT="$postInsert",h.UNSET="$unset",h.CLEAR_ALL="$clearAll",(i=M||(M={})).IDENTIFY="$identify",i.GROUP_IDENTIFY="$groupidentify",i.REVENUE="revenue_amount";var an="".concat("AMP","_unsent"),ao="$default_instance",ap="https://api2.amplitude.com/2/httpapi",aq="dclid",ar="fbclid",as="gbraid",at="gclid",au="ko_click_id",av="li_fat_id",aw="msclkid",ax="rdt_cid",ay="ttclid",az="twclid",aA="wbraid",aB={utm_campaign:void 0,utm_content:void 0,utm_id:void 0,utm_medium:void 0,utm_source:void 0,utm_term:void 0,referrer:void 0,referring_domain:void 0,dclid:void 0,gbraid:void 0,gclid:void 0,fbclid:void 0,ko_click_id:void 0,li_fat_id:void 0,msclkid:void 0,rdt_cid:void 0,ttclid:void 0,twclid:void 0,wbraid:void 0},aC=["access-control-allow-origin","access-control-allow-credentials","access-control-expose-headers","access-control-max-age","access-control-allow-methods","access-control-allow-headers","accept-patch","accept-ranges","age","allow","alt-svc","cache-control","connection","content-disposition","content-encoding","content-language","content-length","content-location","content-md5","content-range","content-type","date","delta-base","etag","expires","im","last-modified","link","location","permanent","p3p","pragma","proxy-authenticate","public-key-pins","retry-after","server","status","strict-transport-security","trailer","transfer-encoding","tk","upgrade","vary","via","warning","www-authenticate","x-b3-traceid","x-frame-options"],aD=["authorization","cookie","set-cookie"],aE=function(a){if(Object.keys(a).length>1e3)return!1;for(var b in a){var c=a[b];if(!aF(b,c))return!1}return!0},aF=function(a,b){var c,d;if("string"!=typeof a)return!1;if(Array.isArray(b)){var e=!0;try{for(var f=(0,ah.__values)(b),g=f.next();!g.done;g=f.next()){var h=g.value;if(Array.isArray(h))return!1;if("object"==typeof h)e=e&&aE(h);else if(!["number","string"].includes(typeof h))return!1;if(!e)return!1}}catch(a){c={error:a}}finally{try{g&&!g.done&&(d=f.return)&&d.call(f)}finally{if(c)throw c.error}}}else if(null==b)return!1;else if("object"==typeof b)return aE(b);else if(!["number","string","boolean"].includes(typeof b))return!1;return!0},aG=function(){function a(){this._propertySet=new Set,this._properties={}}return a.prototype.getUserProperties=function(){return(0,ah.__assign)({},this._properties)},a.prototype.set=function(a,b){return this._safeSet(N.SET,a,b),this},a.prototype.setOnce=function(a,b){return this._safeSet(N.SET_ONCE,a,b),this},a.prototype.append=function(a,b){return this._safeSet(N.APPEND,a,b),this},a.prototype.prepend=function(a,b){return this._safeSet(N.PREPEND,a,b),this},a.prototype.postInsert=function(a,b){return this._safeSet(N.POSTINSERT,a,b),this},a.prototype.preInsert=function(a,b){return this._safeSet(N.PREINSERT,a,b),this},a.prototype.remove=function(a,b){return this._safeSet(N.REMOVE,a,b),this},a.prototype.add=function(a,b){return this._safeSet(N.ADD,a,b),this},a.prototype.unset=function(a){return this._safeSet(N.UNSET,a,"-"),this},a.prototype.clearAll=function(){return this._properties={},this._properties[N.CLEAR_ALL]="-",this},a.prototype._safeSet=function(a,b,c){if(this._validate(a,b,c)){var d=this._properties[a];return void 0===d&&(d={},this._properties[a]=d),d[b]=c,this._propertySet.add(b),!0}return!1},a.prototype._validate=function(a,b,c){return!(void 0!==this._properties[N.CLEAR_ALL]||this._propertySet.has(b))&&(a===N.ADD?"number"==typeof c:a===N.UNSET||a===N.REMOVE||aF(b,c))},a}();(j=N||(N={})).SET="$set",j.SET_ONCE="$setOnce",j.ADD="$add",j.APPEND="$append",j.PREPEND="$prepend",j.REMOVE="$remove",j.PREINSERT="$preInsert",j.POSTINSERT="$postInsert",j.UNSET="$unset",j.CLEAR_ALL="$clearAll";var aH=[N.CLEAR_ALL,N.UNSET,N.SET,N.SET_ONCE,N.ADD,N.APPEND,N.PREPEND,N.PREINSERT,N.POSTINSERT,N.REMOVE];a.s(["Identify",()=>aG,"OrderedIdentifyOperations",()=>aH],295474),(k=O||(O={})).Unknown="unknown",k.Skipped="skipped",k.Success="success",k.RateLimit="rate_limit",k.PayloadTooLarge="payload_too_large",k.Invalid="invalid",k.Failed="failed",k.Timeout="Timeout",k.SystemError="SystemError";var aI=function(a,b,c){return void 0===b&&(b=0),void 0===c&&(c=O.Unknown),{event:a,code:b,message:c}},aJ=function(){var b="ampIntegrationContext";return"u">typeof globalThis&&void 0!==globalThis[b]?globalThis[b]:"u">typeof globalThis?globalThis:"u">typeof self?self:a.g},aK=(0,ah.__spreadArray)([],(0,ah.__read)(Array(256).keys()),!1).map(function(a){return a.toString(16).padStart(2,"0")}),aL=function(a){var b,c=aJ();if(!(null==(b=null==c?void 0:c.crypto)?void 0:b.getRandomValues))return a?(a^16*Math.random()>>a/4).toString(16):(String(1e7)+String(-1e3)+String(-4e3)+String(-8e3)+String(-1e11)).replace(/[018]/g,aL);var d=c.crypto.getRandomValues(new Uint8Array(16));return d[6]=15&d[6]|64,d[8]=63&d[8]|128,(0,ah.__spreadArray)([],(0,ah.__read)(d.entries()),!1).map(function(a){var b=(0,ah.__read)(a,2),c=b[0],d=b[1];return[4,6,8,10].includes(c)?"-".concat(aK[d]):aK[d]}).join("")},aM=function(){function a(a){this.client=a,this.queue=[],this.applying=!1,this.plugins=[]}return a.prototype.register=function(a,b){var c,d;return(0,ah.__awaiter)(this,void 0,void 0,function(){return(0,ah.__generator)(this,function(e){switch(e.label){case 0:if(this.plugins.some(function(b){return b.name===a.name}))return this.loggerProvider.warn("Plugin with name ".concat(a.name," already exists, skipping registration")),[2];return void 0===a.name&&(a.name=aL(),this.loggerProvider.warn("Plugin name is undefined. \n      Generating a random UUID for plugin name: ".concat(a.name,". \n      Set a name for the plugin to prevent it from being added multiple times."))),a.type=null!=(c=a.type)?c:"enrichment",[4,null==(d=a.setup)?void 0:d.call(a,b,this.client)];case 1:return e.sent(),this.plugins.push(a),[2]}})})},a.prototype.deregister=function(a,b){var c;return(0,ah.__awaiter)(this,void 0,void 0,function(){var d,e;return(0,ah.__generator)(this,function(f){switch(f.label){case 0:if(-1===(d=this.plugins.findIndex(function(b){return b.name===a})))return b.loggerProvider.warn("Plugin with name ".concat(a," does not exist, skipping deregistration")),[2];return e=this.plugins[d],this.plugins.splice(d,1),[4,null==(c=e.teardown)?void 0:c.call(e)];case 1:return f.sent(),[2]}})})},a.prototype.reset=function(a){this.applying=!1,this.plugins.map(function(a){var b;return null==(b=a.teardown)?void 0:b.call(a)}),this.plugins=[],this.client=a},a.prototype.push=function(a){var b=this;return new Promise(function(c){b.queue.push([a,c]),b.scheduleApply(0)})},a.prototype.scheduleApply=function(a){var b=this;this.applying||(this.applying=!0,setTimeout(function(){b.apply(b.queue.shift()).then(function(){b.applying=!1,b.queue.length>0&&b.scheduleApply(0)})},a))},a.prototype.apply=function(a){return(0,ah.__awaiter)(this,void 0,void 0,function(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;return(0,ah.__generator)(this,function(q){switch(q.label){case 0:if(!a)return[2];b=(0,ah.__read)(a,1)[0],c=(0,ah.__read)(a,2)[1],this.loggerProvider.log("Timeline.apply: Initial event",b),d=this.plugins.filter(function(a){return"before"===a.type}),q.label=1;case 1:q.trys.push([1,6,7,8]),f=(e=(0,ah.__values)(d)).next(),q.label=2;case 2:if(f.done)return[3,5];if(!(g=f.value).execute)return[3,4];return[4,g.execute((0,ah.__assign)({},b))];case 3:if(null===(h=q.sent()))return this.loggerProvider.log("Timeline.apply: Event filtered out by before plugin '".concat(String(g.name),"', event: ").concat(JSON.stringify(b))),c({event:b,code:0,message:""}),[2];b=h,this.loggerProvider.log("Timeline.apply: Event after before plugin '".concat(String(g.name),"', event: ").concat(JSON.stringify(b))),q.label=4;case 4:return f=e.next(),[3,2];case 5:return[3,8];case 6:return m={error:q.sent()},[3,8];case 7:try{f&&!f.done&&(n=e.return)&&n.call(e)}finally{if(m)throw m.error}return[7];case 8:i=this.plugins.filter(function(a){return"enrichment"===a.type||void 0===a.type}),q.label=9;case 9:q.trys.push([9,14,15,16]),k=(j=(0,ah.__values)(i)).next(),q.label=10;case 10:if(k.done)return[3,13];if(!(g=k.value).execute)return[3,12];return[4,g.execute((0,ah.__assign)({},b))];case 11:if(null===(h=q.sent()))return this.loggerProvider.log("Timeline.apply: Event filtered out by enrichment plugin '".concat(String(g.name),"', event: ").concat(JSON.stringify(b))),c({event:b,code:0,message:""}),[2];b=h,this.loggerProvider.log("Timeline.apply: Event after enrichment plugin '".concat(String(g.name),"', event: ").concat(JSON.stringify(b))),q.label=12;case 12:return k=j.next(),[3,10];case 13:return[3,16];case 14:return o={error:q.sent()},[3,16];case 15:try{k&&!k.done&&(p=j.return)&&p.call(j)}finally{if(o)throw o.error}return[7];case 16:return l=this.plugins.filter(function(a){return"destination"===a.type}),this.loggerProvider.log("Timeline.apply: Final event before destinations, event: ".concat(JSON.stringify(b))),Promise.all(l.map(function(a){var c=(0,ah.__assign)({},b);return a.execute(c).catch(function(a){return aI(c,0,String(a))})})).then(function(a){var d=(0,ah.__read)(a,1)[0]||aI(b,100,"Event not tracked, no destination plugins on the instance");c(d)}),[2]}})})},a.prototype.flush=function(){return(0,ah.__awaiter)(this,void 0,void 0,function(){var a,b=this;return(0,ah.__generator)(this,function(c){switch(c.label){case 0:return a=this.queue,this.queue=[],[4,Promise.all(a.map(function(a){return b.apply(a)}))];case 1:return c.sent(),[4,Promise.all(this.plugins.filter(function(a){return"destination"===a.type}).map(function(a){return a.flush&&a.flush()}))];case 2:return c.sent(),[2]}})})},a.prototype.onIdentityChanged=function(a){this.plugins.forEach(function(b){var c;null==(c=b.onIdentityChanged)||c.call(b,a)})},a.prototype.onSessionIdChanged=function(a){this.plugins.forEach(function(b){var c;null==(c=b.onSessionIdChanged)||c.call(b,a)})},a.prototype.onOptOutChanged=function(a){this.plugins.forEach(function(b){var c;null==(c=b.onOptOutChanged)||c.call(b,a)})},a.prototype.onReset=function(){this.plugins.forEach(function(a){var b;null==(b=a.onReset)||b.call(a)})},a}(),aN=function(a,b){return(0,ah.__assign)((0,ah.__assign)({},b),{event_type:M.IDENTIFY,user_properties:a.getUserProperties()})},aO=function(a,b,c,d){var e;return(0,ah.__assign)((0,ah.__assign)({},d),{event_type:M.GROUP_IDENTIFY,group_properties:c.getUserProperties(),groups:((e={})[a]=b,e)})},aP=function(a,b,c){var d,e=new aG;return e.set(a,b),(0,ah.__assign)((0,ah.__assign)({},c),{event_type:M.IDENTIFY,user_properties:e.getUserProperties(),groups:((d={})[a]=b,d)})},aQ=function(a){return{promise:a||Promise.resolve()}},aR=function(){function a(a){void 0===a&&(a="$default"),this.initializing=!1,this.isReady=!1,this.q=[],this.dispatchQ=[],this.logEvent=this.track.bind(this),this.timeline=new aM(this),this.name=a}return a.prototype._init=function(a){return(0,ah.__awaiter)(this,void 0,void 0,function(){return(0,ah.__generator)(this,function(b){switch(b.label){case 0:return this.config=a,this.timeline.reset(this),this.timeline.loggerProvider=this.config.loggerProvider,[4,this.runQueuedFunctions("q")];case 1:return b.sent(),this.isReady=!0,[2]}})})},a.prototype.runQueuedFunctions=function(a){return(0,ah.__awaiter)(this,void 0,void 0,function(){var b,c,d,e,f,g;return(0,ah.__generator)(this,function(h){switch(h.label){case 0:b=this[a],this[a]=[],h.label=1;case 1:h.trys.push([1,8,9,10]),d=(c=(0,ah.__values)(b)).next(),h.label=2;case 2:if(d.done)return[3,7];if(!((e=(0,d.value)())&&"promise"in e))return[3,4];return[4,e.promise];case 3:return h.sent(),[3,6];case 4:return[4,e];case 5:h.sent(),h.label=6;case 6:return d=c.next(),[3,2];case 7:return[3,10];case 8:return f={error:h.sent()},[3,10];case 9:try{d&&!d.done&&(g=c.return)&&g.call(c)}finally{if(f)throw f.error}return[7];case 10:if(!this[a].length)return[3,12];return[4,this.runQueuedFunctions(a)];case 11:h.sent(),h.label=12;case 12:return[2]}})})},a.prototype.track=function(a,b,c){var d=(0,ah.__assign)((0,ah.__assign)((0,ah.__assign)({},"string"==typeof a?{event_type:a}:a),c),b&&{event_properties:b});return aQ(this.dispatch(d))},a.prototype.identify=function(a,b){var c=aN(a,b);return aQ(this.dispatch(c))},a.prototype.groupIdentify=function(a,b,c,d){var e=aO(a,b,c,d);return aQ(this.dispatch(e))},a.prototype.setGroup=function(a,b,c){var d=aP(a,b,c);return aQ(this.dispatch(d))},a.prototype.revenue=function(a,b){var c=(0,ah.__assign)((0,ah.__assign)({},b),{event_type:M.REVENUE,event_properties:a.getEventProperties()});return aQ(this.dispatch(c))},a.prototype.add=function(a){return this.isReady?this._addPlugin(a):(this.q.push(this._addPlugin.bind(this,a)),aQ())},a.prototype._addPlugin=function(a){return aQ(this.timeline.register(a,this.config))},a.prototype.remove=function(a){return this.isReady?this._removePlugin(a):(this.q.push(this._removePlugin.bind(this,a)),aQ())},a.prototype._removePlugin=function(a){return aQ(this.timeline.deregister(a,this.config))},a.prototype.dispatchWithCallback=function(a,b){if(!this.isReady)return b(aI(a,0,"Client not initialized"));this.process(a).then(b)},a.prototype.dispatch=function(a){return(0,ah.__awaiter)(this,void 0,void 0,function(){var b=this;return(0,ah.__generator)(this,function(c){return this.isReady?[2,this.process(a)]:[2,new Promise(function(c){b.dispatchQ.push(b.dispatchWithCallback.bind(b,a,c))})]})})},a.prototype.getOperationAppliedUserProperties=function(a){var b={};if(void 0===a)return b;var c={};return Object.keys(a).forEach(function(b){Object.values(L).includes(b)||(c[b]=a[b])}),aH.forEach(function(c){if(Object.keys(a).includes(c)){var d=a[c];switch(c){case L.CLEAR_ALL:Object.keys(b).forEach(function(a){delete b[a]});break;case L.UNSET:Object.keys(d).forEach(function(a){delete b[a]});break;case L.SET:Object.assign(b,d)}}}),Object.assign(b,c),b},a.prototype.process=function(a){return(0,ah.__awaiter)(this,void 0,void 0,function(){var b,c,d;return(0,ah.__generator)(this,function(e){switch(e.label){case 0:if(e.trys.push([0,2,,3]),this.config.optOut)return[2,aI(a,0,"Event skipped due to optOut config")];return a.event_type===M.IDENTIFY&&(b=this.getOperationAppliedUserProperties(a.user_properties),this.timeline.onIdentityChanged({userProperties:b})),[4,this.timeline.push(a)];case 1:return 200===(c=e.sent()).code?this.config.loggerProvider.log(c.message):100===c.code?this.config.loggerProvider.warn(c.message):this.config.loggerProvider.error(c.message),[2,c];case 2:return d=String(e.sent()),this.config.loggerProvider.error(d),[2,c=aI(a,0,d)];case 3:return[2]}})})},a.prototype.setOptOut=function(a){this.isReady?this._setOptOut(a):this.q.push(this._setOptOut.bind(this,!!a))},a.prototype._setOptOut=function(a){this.config.optOut!==a&&(this.timeline.onOptOutChanged(a),this.config.optOut=!!a)},a.prototype.flush=function(){return aQ(this.timeline.flush())},a.prototype.plugin=function(a){var b=this.timeline.plugins.find(function(b){return b.name===a});return void 0===b?void this.config.loggerProvider.debug("Cannot find plugin with name ".concat(a)):b},a.prototype.plugins=function(a){return this.timeline.plugins.filter(function(b){return b instanceof a})},a}(),aS=function(a,b){var c=Math.max(b,1);return a.reduce(function(a,b,d){var e=Math.floor(d/c);return a[e]||(a[e]=[]),a[e].push(b),a},[])},aT="Amplitude Logger ",aU=function(){function a(){this.logLevel=K.None}return a.prototype.disable=function(){this.logLevel=K.None},a.prototype.enable=function(a){void 0===a&&(a=K.Warn),this.logLevel=a},a.prototype.log=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];this.logLevel<K.Verbose||console.log("".concat(aT,"[Log]: ").concat(a.join(" ")))},a.prototype.warn=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];this.logLevel<K.Warn||console.warn("".concat(aT,"[Warn]: ").concat(a.join(" ")))},a.prototype.error=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];this.logLevel<K.Error||console.error("".concat(aT,"[Error]: ").concat(a.join(" ")))},a.prototype.debug=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];this.logLevel<K.Debug||console.log("".concat(aT,"[Debug]: ").concat(a.join(" ")))},a}(),aV=function(){return{flushMaxRetries:12,flushQueueSize:200,flushIntervalMillis:1e4,instanceName:ao,logLevel:K.Warn,loggerProvider:new aU,offline:!1,optOut:!1,serverUrl:ap,serverZone:"US",useBatch:!1}},aW=function(){function a(a){this._optOut=!1;var b,c,d,e,f=aV();this.apiKey=a.apiKey,this.flushIntervalMillis=null!=(b=a.flushIntervalMillis)?b:f.flushIntervalMillis,this.flushMaxRetries=a.flushMaxRetries||f.flushMaxRetries,this.flushQueueSize=a.flushQueueSize||f.flushQueueSize,this.instanceName=a.instanceName||f.instanceName,this.loggerProvider=a.loggerProvider||f.loggerProvider,this.logLevel=null!=(c=a.logLevel)?c:f.logLevel,this.minIdLength=a.minIdLength,this.plan=a.plan,this.ingestionMetadata=a.ingestionMetadata,this.offline=void 0!==a.offline?a.offline:f.offline,this.optOut=null!=(d=a.optOut)?d:f.optOut,this.serverUrl=a.serverUrl,this.serverZone=a.serverZone||f.serverZone,this.storageProvider=a.storageProvider,this.transportProvider=a.transportProvider,this.useBatch=null!=(e=a.useBatch)?e:f.useBatch,this.loggerProvider.enable(this.logLevel);var g=aX(a.serverUrl,a.serverZone,a.useBatch);this.serverZone=g.serverZone,this.serverUrl=g.serverUrl}return Object.defineProperty(a.prototype,"optOut",{get:function(){return this._optOut},set:function(a){this._optOut=a},enumerable:!1,configurable:!0}),a}(),aX=function(a,b,c){if(void 0===a&&(a=""),void 0===b&&(b=aV().serverZone),void 0===c&&(c=aV().useBatch),a)return{serverUrl:a,serverZone:void 0};var d,e=["US","EU"].includes(b)?b:aV().serverZone;return{serverZone:e,serverUrl:(d=c,"EU"===e?d?"https://api.eu.amplitude.com/batch":"https://api.eu.amplitude.com/2/httpapi":d?"https://api2.amplitude.com/batch":ap)}},aY=function(){function a(){this.sdk={metrics:{histogram:{}}}}return a.prototype.recordHistogram=function(a,b){this.sdk.metrics.histogram[a]=b},a}();function aZ(a){return a>=200&&a<300}function a$(a){var b="";try{"body"in a&&(b=JSON.stringify(a.body,null,2))}catch(a){}return b}var a_=function(){function a(a){this.name="amplitude",this.type="destination",this.retryTimeout=1e3,this.throttleTimeout=3e4,this.storageKey="",this.scheduleId=null,this.scheduledTimeout=0,this.flushId=null,this.queue=[],this.diagnosticsClient=null==a?void 0:a.diagnosticsClient}return a.prototype.setup=function(a){var b;return(0,ah.__awaiter)(this,void 0,void 0,function(){var c,d=this;return(0,ah.__generator)(this,function(e){switch(e.label){case 0:return this.config=a,this.storageKey="".concat(an,"_").concat(this.config.apiKey.substring(0,10)),[4,null==(b=this.config.storageProvider)?void 0:b.get(this.storageKey)];case 1:return(c=e.sent())&&c.length>0&&Promise.all(c.map(function(a){return d.execute(a)})).catch(),[2,Promise.resolve(void 0)]}})})},a.prototype.execute=function(a){var b=this;return a.insert_id||(a.insert_id=aL()),new Promise(function(c){b.queue.push({event:a,attempts:0,callback:function(a){return c(a)},timeout:0}),b.schedule(b.config.flushIntervalMillis),b.saveEvents()})},a.prototype.removeEventsExceedFlushMaxRetries=function(a){var b=this;return a.filter(function(a){return a.attempts+=1,a.attempts<b.config.flushMaxRetries||(b.fulfillRequest([a],500,"Event rejected due to exceeded retry count"),!1)})},a.prototype.scheduleEvents=function(a){var b=this;a.forEach(function(a){b.schedule(0===a.timeout?b.config.flushIntervalMillis:a.timeout)})},a.prototype.schedule=function(a){var b=this;if(!this.config.offline&&(null===this.scheduleId||this.scheduleId&&a>this.scheduledTimeout)){this.scheduleId&&clearTimeout(this.scheduleId),this.scheduledTimeout=a,this.scheduleId=setTimeout(function(){b.queue=b.queue.map(function(a){return a.timeout=0,a}),b.flush(!0)},a);return}},a.prototype.resetSchedule=function(){this.scheduleId=null,this.scheduledTimeout=0},a.prototype.flush=function(a){return void 0===a&&(a=!1),(0,ah.__awaiter)(this,void 0,void 0,function(){var b,c,d=this;return(0,ah.__generator)(this,function(e){switch(e.label){case 0:if(this.config.offline)return this.resetSchedule(),this.config.loggerProvider.debug("Skipping flush while offline."),[2];if(this.flushId)return this.resetSchedule(),this.config.loggerProvider.debug("Skipping flush because previous flush has not resolved."),[2];return this.flushId=this.scheduleId,this.resetSchedule(),b=[],c=[],this.queue.forEach(function(a){return 0===a.timeout?b.push(a):c.push(a)}),[4,aS(b,this.config.flushQueueSize).reduce(function(b,c){return(0,ah.__awaiter)(d,void 0,void 0,function(){return(0,ah.__generator)(this,function(d){switch(d.label){case 0:return[4,b];case 1:return d.sent(),[4,this.send(c,a)];case 2:return[2,d.sent()]}})})},Promise.resolve())];case 1:return e.sent(),this.flushId=null,this.scheduleEvents(this.queue),[2]}})})},a.prototype.send=function(a,b){var c;return void 0===b&&(b=!0),(0,ah.__awaiter)(this,void 0,void 0,function(){var d,e,f,g;return(0,ah.__generator)(this,function(h){switch(h.label){case 0:if(!this.config.apiKey)return[2,this.fulfillRequest(a,400,"Event rejected due to missing API key")];d={api_key:this.config.apiKey,events:a.map(function(a){var b=a.event;return b.extra,(0,ah.__rest)(b,["extra"])}),options:{min_id_length:this.config.minIdLength},client_upload_time:new Date().toISOString(),request_metadata:this.config.requestMetadata},this.config.requestMetadata=new aY,h.label=1;case 1:return h.trys.push([1,3,,4]),e=aX(this.config.serverUrl,this.config.serverZone,this.config.useBatch).serverUrl,[4,this.config.transportProvider.send(e,d)];case 2:if(null===(f=h.sent()))return this.fulfillRequest(a,0,"Unexpected error occurred"),[2];if(!b)return"body"in f?this.fulfillRequest(a,f.statusCode,"".concat(f.status,": ").concat(a$(f))):this.fulfillRequest(a,f.statusCode,f.status),[2];return this.handleResponse(f,a),[3,4];case 3:var i;return g=(i=h.sent())instanceof Error?i.message:String(i),this.config.loggerProvider.error(g),null==(c=this.diagnosticsClient)||c.recordEvent("analytics.events.unsuccessful.from.catch.error",{events:a.map(function(a){return a.event.event_type}),message:g,stack_trace:ai()}),this.handleResponse({status:O.Failed,statusCode:0},a),[3,4];case 4:return[2]}})})},a.prototype.handleResponse=function(a,b){aZ(a.statusCode)||null==(c=this.diagnosticsClient)||c.recordEvent("analytics.events.unsuccessful",{events:b.map(function(a){return a.event.event_type}),code:a.statusCode,status:a.status,body:a$(a),stack_trace:ai()});var c,d=a.status;switch(d){case O.Success:this.handleSuccessResponse(a,b);break;case O.Invalid:this.handleInvalidResponse(a,b);break;case O.PayloadTooLarge:this.handlePayloadTooLargeResponse(a,b);break;case O.RateLimit:this.handleRateLimitResponse(a,b);break;default:this.config.loggerProvider.warn("{code: 0, error: \"Status '".concat(d,"' provided for ").concat(b.length,' events"}')),this.handleOtherResponse(b)}},a.prototype.handleSuccessResponse=function(a,b){this.fulfillRequest(b,a.statusCode,"Event tracked successfully")},a.prototype.handleInvalidResponse=function(a,b){var c=this;if(a.body.missingField||a.body.error.startsWith("Invalid API key"))return void this.fulfillRequest(b,a.statusCode,a.body.error);var d=new Set((0,ah.__spreadArray)((0,ah.__spreadArray)((0,ah.__spreadArray)((0,ah.__spreadArray)([],(0,ah.__read)(Object.values(a.body.eventsWithInvalidFields)),!1),(0,ah.__read)(Object.values(a.body.eventsWithMissingFields)),!1),(0,ah.__read)(Object.values(a.body.eventsWithInvalidIdLengths)),!1),(0,ah.__read)(a.body.silencedEvents),!1).flat()),e=b.filter(function(b,e){return!d.has(e)||void c.fulfillRequest([b],a.statusCode,a.body.error)});e.length>0&&this.config.loggerProvider.warn(a$(a));var f=this.removeEventsExceedFlushMaxRetries(e);this.scheduleEvents(f)},a.prototype.handlePayloadTooLargeResponse=function(a,b){if(1===b.length)return void this.fulfillRequest(b,a.statusCode,a.body.error);this.config.loggerProvider.warn(a$(a)),this.config.flushQueueSize/=2;var c=this.removeEventsExceedFlushMaxRetries(b);this.scheduleEvents(c)},a.prototype.handleRateLimitResponse=function(a,b){var c=this,d=Object.keys(a.body.exceededDailyQuotaUsers),e=Object.keys(a.body.exceededDailyQuotaDevices),f=a.body.throttledEvents,g=new Set(d),h=new Set(e),i=new Set(f),j=b.filter(function(b,d){return b.event.user_id&&g.has(b.event.user_id)||b.event.device_id&&h.has(b.event.device_id)?void c.fulfillRequest([b],a.statusCode,a.body.error):(i.has(d)&&(b.timeout=c.throttleTimeout),!0)});j.length>0&&this.config.loggerProvider.warn(a$(a));var k=this.removeEventsExceedFlushMaxRetries(j);this.scheduleEvents(k)},a.prototype.handleOtherResponse=function(a){var b=this,c=a.map(function(a){return a.timeout=a.attempts*b.retryTimeout,a}),d=this.removeEventsExceedFlushMaxRetries(c);this.scheduleEvents(d)},a.prototype.fulfillRequest=function(a,b,c){var d,e,f;aZ(b)?null==(f=this.diagnosticsClient)||f.increment("analytics.events.sent",a.length):(null==(d=this.diagnosticsClient)||d.increment("analytics.events.dropped",a.length),null==(e=this.diagnosticsClient)||e.recordEvent("analytics.events.dropped",{events:a.map(function(a){return a.event.event_type}),code:b,message:c,stack_trace:ai()})),this.removeEvents(a),a.forEach(function(a){return a.callback(aI(a.event,b,c))})},a.prototype.saveEvents=function(){if(this.config.storageProvider){var a=this.queue.map(function(a){return a.event});this.config.storageProvider.set(this.storageKey,a)}},a.prototype.removeEvents=function(a){this.queue=this.queue.filter(function(b){return!a.some(function(a){return a.event.insert_id===b.event.insert_id})}),this.saveEvents()},a}(),a0=function(){function a(){this.productId="",this.quantity=1,this.price=0}return a.prototype.setProductId=function(a){return this.productId=a,this},a.prototype.setQuantity=function(a){return a>0&&(this.quantity=a),this},a.prototype.setPrice=function(a){return this.price=a,this},a.prototype.setRevenueType=function(a){return this.revenueType=a,this},a.prototype.setCurrency=function(a){return this.currency=a,this},a.prototype.setRevenue=function(a){return this.revenue=a,this},a.prototype.setReceipt=function(a){return this.receipt=a,this},a.prototype.setReceiptSig=function(a){return this.receiptSig=a,this},a.prototype.setEventProperties=function(a){return aE(a)&&(this.properties=a),this},a.prototype.getEventProperties=function(){var a=this.properties?(0,ah.__assign)({},this.properties):{};return a[P.REVENUE_PRODUCT_ID]=this.productId,a[P.REVENUE_QUANTITY]=this.quantity,a[P.REVENUE_PRICE]=this.price,a[P.REVENUE_TYPE]=this.revenueType,a[P.REVENUE_CURRENCY]=this.currency,a[P.REVENUE]=this.revenue,a[P.RECEIPT]=this.receipt,a[P.RECEIPT_SIG]=this.receiptSig,a},a}();(l=P||(P={})).REVENUE_PRODUCT_ID="$productId",l.REVENUE_QUANTITY="$quantity",l.REVENUE_PRICE="$price",l.REVENUE_TYPE="$revenueType",l.REVENUE_CURRENCY="$currency",l.REVENUE="$revenue",l.RECEIPT="$receipt",l.RECEIPT_SIG="$receiptSig";var a1=function(){function a(){}return a.prototype.getApplicationContext=function(){return{versionName:this.versionName,language:a2(),platform:"Web",os:void 0,deviceModel:void 0}},a}(),a2=function(){return"u">typeof navigator&&(navigator.languages&&navigator.languages[0]||navigator.language)||""},a3=function(){function a(){this.queue=[]}return a.prototype.logEvent=function(a){this.receiver?this.receiver(a):this.queue.length<512&&this.queue.push(a)},a.prototype.setEventReceiver=function(a){this.receiver=a,this.queue.length>0&&(this.queue.forEach(function(b){a(b)}),this.queue=[])},a}(),a4=function(){return(a4=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c])Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a}).apply(this,arguments)};function a5(a){var b="function"==typeof Symbol&&Symbol.iterator,c=b&&a[b],d=0;if(c)return c.call(a);if(a&&"number"==typeof a.length)return{next:function(){return a&&d>=a.length&&(a=void 0),{value:a&&a[d++],done:!a}}};throw TypeError(b?"Object is not iterable.":"Symbol.iterator is not defined.")}function a6(a,b){var c="function"==typeof Symbol&&a[Symbol.iterator];if(!c)return a;var d,e,f=c.call(a),g=[];try{for(;(void 0===b||b-- >0)&&!(d=f.next()).done;)g.push(d.value)}catch(a){e={error:a}}finally{try{d&&!d.done&&(c=f.return)&&c.call(f)}finally{if(e)throw e.error}}return g}"function"==typeof SuppressedError&&SuppressedError;var a7=function(a,b){var c,d,e=typeof a;if(e!==typeof b)return!1;try{for(var f=a5(["string","number","boolean","undefined"]),g=f.next();!g.done;g=f.next())if(g.value===e)return a===b}catch(a){c={error:a}}finally{try{g&&!g.done&&(d=f.return)&&d.call(f)}finally{if(c)throw c.error}}if(null==a&&null==b)return!0;if(null==a||null==b||a.length!==b.length)return!1;var h=Array.isArray(a),i=Array.isArray(b);if(h!==i)return!1;if(h&&i){for(var j=0;j<a.length;j++)if(!a7(a[j],b[j]))return!1}else{if(!a7(Object.keys(a).sort(),Object.keys(b).sort()))return!1;var k=!0;return Object.keys(a).forEach(function(c){a7(a[c],b[c])||(k=!1)}),k}return!0};Object.entries||(Object.entries=function(a){for(var b=Object.keys(a),c=b.length,d=Array(c);c--;)d[c]=[b[c],a[b[c]]];return d});var a8=function(){function a(){this.identity={userProperties:{}},this.listeners=new Set}return a.prototype.editIdentity=function(){var a=this,b=a4({},this.identity.userProperties),c=a4(a4({},this.identity),{userProperties:b});return{setUserId:function(a){return c.userId=a,this},setDeviceId:function(a){return c.deviceId=a,this},setUserProperties:function(a){return c.userProperties=a,this},setOptOut:function(a){return c.optOut=a,this},updateUserProperties:function(a){var b,d,e,f,g,h,i=c.userProperties||{};try{for(var j=a5(Object.entries(a)),k=j.next();!k.done;k=j.next()){var l=a6(k.value,2),m=l[0],n=l[1];switch(m){case"$set":try{for(var o=(e=void 0,a5(Object.entries(n))),p=o.next();!p.done;p=o.next()){var q=a6(p.value,2),r=q[0],s=q[1];i[r]=s}}catch(a){e={error:a}}finally{try{p&&!p.done&&(f=o.return)&&f.call(o)}finally{if(e)throw e.error}}break;case"$unset":try{for(var t=(g=void 0,a5(Object.keys(n))),u=t.next();!u.done;u=t.next()){var r=u.value;delete i[r]}}catch(a){g={error:a}}finally{try{u&&!u.done&&(h=t.return)&&h.call(t)}finally{if(g)throw g.error}}break;case"$clearAll":i={}}}}catch(a){b={error:a}}finally{try{k&&!k.done&&(d=j.return)&&d.call(j)}finally{if(b)throw b.error}}return c.userProperties=i,this},commit:function(){return a.setIdentity(c),this}}},a.prototype.getIdentity=function(){return a4({},this.identity)},a.prototype.setIdentity=function(a){var b=a4({},this.identity);this.identity=a4({},a),a7(b,this.identity)||this.listeners.forEach(function(b){b(a)})},a.prototype.addIdentityListener=function(a){this.listeners.add(a)},a.prototype.removeIdentityListener=function(a){this.listeners.delete(a)},a}(),a9="u">typeof globalThis?globalThis:a.g,ba=function(){function a(){this.identityStore=new a8,this.eventBridge=new a3,this.applicationContextProvider=new a1}return a.getInstance=function(b){return a9.analyticsConnectorInstances||(a9.analyticsConnectorInstances={}),a9.analyticsConnectorInstances[b]||(a9.analyticsConnectorInstances[b]=new a),a9.analyticsConnectorInstances[b]},a}(),bb=function(a){return void 0===a&&(a=ao),ba.getInstance(a)},bc=function(a,b){bb(b).identityStore.editIdentity().setUserId(a).commit()},bd=function(a,b){bb(b).identityStore.editIdentity().setDeviceId(a).commit()},be=function(a,b){return void 0===b&&(b=Date.now()),Date.now()-b>a},bf=function(){function a(){this.name="identity",this.type="before",this.identityStore=bb().identityStore}return a.prototype.execute=function(a){return(0,ah.__awaiter)(this,void 0,void 0,function(){var b;return(0,ah.__generator)(this,function(c){return(b=a.user_properties)&&this.identityStore.editIdentity().updateUserProperties(b).commit(),[2,a]})})},a.prototype.setup=function(a){return(0,ah.__awaiter)(this,void 0,void 0,function(){return(0,ah.__generator)(this,function(b){return a.instanceName&&(this.identityStore=bb(a.instanceName).identityStore),[2]})})},a}(),bg=function(){var a,b=aJ();return(null==(a=null==b?void 0:b.location)?void 0:a.search)?b.location.search.substring(1).split("&").filter(Boolean).reduce(function(a,b){var c=b.split("=",2),d=bh(c[0]),e=bh(c[1]);return e&&(a[d]=e),a},{}):{}},bh=function(a){void 0===a&&(a="");try{return decodeURIComponent(a)}catch(a){return""}},bi=function(){function a(a,b){this.key="AMP_remote_config_".concat(a.substring(0,10)),this.logger=b}return a.prototype.fetchConfig=function(){var a=null,b={remoteConfig:null,lastFetch:new Date};try{a=localStorage.getItem(this.key)}catch(a){return this.logger.debug("Remote config localstorage failed to access: ",a),Promise.resolve(b)}if(null===a)return this.logger.debug("Remote config localstorage gets null because the key does not exist"),Promise.resolve(b);try{var c=JSON.parse(a);return this.logger.debug("Remote config localstorage parsed successfully: ".concat(JSON.stringify(c))),Promise.resolve({remoteConfig:c.remoteConfig,lastFetch:new Date(c.lastFetch)})}catch(a){return this.logger.debug("Remote config localstorage failed to parse: ",a),localStorage.removeItem(this.key),Promise.resolve(b)}},a.prototype.setConfig=function(a){try{return localStorage.setItem(this.key,JSON.stringify(a)),this.logger.debug("Remote config localstorage set successfully."),Promise.resolve(!0)}catch(a){this.logger.debug("Remote config localstorage failed to set: ",a)}return Promise.resolve(!1)},a}(),bj=function(){function a(a,b,c,d){void 0===c&&(c="US"),this.callbackInfos=[],this.lastSuccessfulFetch=null,this.fetchPromise=null,this.apiKey=a,this.serverUrl=d||("US"===c?"https://sr-client-cfg.amplitude.com/config":"https://sr-client-cfg.eu.amplitude.com/config"),this.logger=b,this.storage=new bi(a,b)}return a.prototype.subscribe=function(a,b,c){var d=aL(),e={id:d,key:a,deliveryMode:b,callback:c};return this.callbackInfos.push(e),"all"===b?this.subscribeAll(e):this.subscribeWaitForRemote(e,b.timeout),d},a.prototype.unsubscribe=function(a){var b=this.callbackInfos.findIndex(function(b){return b.id===a});return -1===b?(this.logger.debug("Remote config client unsubscribe failed because callback with id ".concat(a," doesn't exist.")),!1):(this.callbackInfos.splice(b,1),this.logger.debug("Remote config client unsubscribe succeeded removing callback with id ".concat(a,".")),!0)},a.prototype.updateConfigs=function(){return(0,ah.__awaiter)(this,void 0,void 0,function(){var a,b=this;return(0,ah.__generator)(this,function(c){switch(c.label){case 0:if(this.lastSuccessfulFetch&&Date.now()-this.lastSuccessfulFetch<3e5)return this.logger.debug("Remote config client skipping updateConfigs: Too recent"),[2];return[4,this.getOrCreateFetchPromise()];case 1:return a=c.sent(),this.storage.setConfig(a),this.callbackInfos.forEach(function(c){b.sendCallback(c,a,"remote")}),[2]}})})},a.prototype.getOrCreateFetchPromise=function(){var a=this;return this.fetchPromise||(this.fetchPromise=this.fetch().then(function(b){return null!==b.remoteConfig&&(a.lastSuccessfulFetch=Date.now()),b}).finally(function(){a.fetchPromise=null})),this.fetchPromise},a.prototype.subscribeAll=function(a){return(0,ah.__awaiter)(this,void 0,void 0,function(){var b,c,d,e=this;return(0,ah.__generator)(this,function(f){switch(f.label){case 0:return b=this.getOrCreateFetchPromise().then(function(b){e.logger.debug("Remote config client subscription all mode fetched from remote: ".concat(JSON.stringify(b))),e.sendCallback(a,b,"remote"),e.storage.setConfig(b)}),c=this.storage.fetchConfig().then(function(a){return a}),[4,Promise.race([b,c])];case 1:return void 0!==(d=f.sent())&&(this.logger.debug("Remote config client subscription all mode fetched from cache: ".concat(JSON.stringify(d))),null!==d.remoteConfig?this.sendCallback(a,d,"cache"):this.logger.debug("Remote config client skips sending callback because cache is empty (first time user).")),[4,b];case 2:return f.sent(),[2]}})})},a.prototype.subscribeWaitForRemote=function(a,b){return(0,ah.__awaiter)(this,void 0,void 0,function(){var c,d;return(0,ah.__generator)(this,function(e){switch(e.label){case 0:c=new Promise(function(a,c){setTimeout(function(){c("Timeout exceeded")},b)}),e.label=1;case 1:return e.trys.push([1,3,,5]),[4,Promise.race([this.getOrCreateFetchPromise(),c])];case 2:return d=e.sent(),this.logger.debug("Remote config client subscription wait for remote mode returns from remote."),this.sendCallback(a,d,"remote"),this.storage.setConfig(d),[3,5];case 3:return e.sent(),this.logger.debug("Remote config client subscription wait for remote mode exceeded timeout. Try to fetch from cache."),[4,this.storage.fetchConfig()];case 4:return null!==(d=e.sent()).remoteConfig?(this.logger.debug("Remote config client subscription wait for remote mode returns a cached copy."),this.sendCallback(a,d,"cache")):(this.logger.debug("Remote config client subscription wait for remote mode failed to fetch cache."),this.sendCallback(a,d,"remote")),[3,5];case 5:return[2]}})})},a.prototype.sendCallback=function(a,b,c){var d;a.lastCallback=new Date,d=a.key?a.key.split(".").reduce(function(a,b){return null===a?a:b in a?a[b]:null},b.remoteConfig):b.remoteConfig,a.callback(d,c,b.lastFetch)},a.prototype.fetch=function(a,b){return void 0===a&&(a=3),void 0===b&&(b=1e3),(0,ah.__awaiter)(this,void 0,void 0,function(){var c,d,e,f,g,h,i=this;return(0,ah.__generator)(this,function(j){switch(j.label){case 0:c=b/a,d={remoteConfig:null,lastFetch:new Date},e=function(d){var e,g,h,j,k;return(0,ah.__generator)(this,function(l){switch(l.label){case 0:e=new AbortController,g=setTimeout(function(){return e.abort()},b),l.label=1;case 1:return l.trys.push([1,7,8,9]),[4,fetch(f.getUrlParams(),{method:"GET",headers:{Accept:"*/*"},signal:e.signal})];case 2:if((h=l.sent()).ok)return[3,4];return[4,h.text()];case 3:return j=l.sent(),f.logger.debug("Remote config client fetch with retry time ".concat(a," failed with ").concat(h.status,": ").concat(j)),[3,6];case 4:return[4,h.json()];case 5:return[2,{value:{remoteConfig:l.sent(),lastFetch:new Date}}];case 6:return[3,9];case 7:return(k=l.sent())instanceof Error&&"AbortError"===k.name?f.logger.debug("Remote config client fetch with retry time ".concat(a," timed out after ").concat(b,"ms")):f.logger.debug("Remote config client fetch with retry time ".concat(a," is rejected because: "),k),[3,9];case 8:return clearTimeout(g),[7];case 9:if(!(d<a-1))return[3,11];return[4,new Promise(function(a){return setTimeout(a,i.getJitterDelay(c))})];case 10:l.sent(),l.label=11;case 11:return[2]}})},f=this,g=0,j.label=1;case 1:if(!(g<a))return[3,4];return[5,e(g)];case 2:if("object"==typeof(h=j.sent()))return[2,h.value];j.label=3;case 3:return g++,[3,1];case 4:return[2,d]}})})},a.prototype.getJitterDelay=function(a){return Math.floor(Math.random()*a)},a.prototype.getUrlParams=function(){var b=encodeURIComponent(this.apiKey),c=new URLSearchParams;return c.append("config_group",a.CONFIG_GROUP),"".concat(this.serverUrl,"/").concat(b,"?").concat(c.toString())},a.CONFIG_GROUP="browser",a}(),bk="tags",bl="counters",bm="histograms",bn="events",bo="internal",bp="last_flush_timestamp",bq=function(){function a(a,b){this.dbPromise=null,this.logger=b,this.dbName="AMP_diagnostics_".concat(a.substring(0,10))}return a.isSupported=function(){var a;return(null==(a=aJ())?void 0:a.indexedDB)!==void 0},a.prototype.getDB=function(){return(0,ah.__awaiter)(this,void 0,void 0,function(){return(0,ah.__generator)(this,function(a){return this.dbPromise||(this.dbPromise=this.openDB()),[2,this.dbPromise]})})},a.prototype.openDB=function(){var a=this;return new Promise(function(b,c){var d=indexedDB.open(a.dbName,1);d.onerror=function(){a.dbPromise=null,c(Error("Failed to open IndexedDB"))},d.onsuccess=function(){var c=d.result;c.onclose=function(){a.dbPromise=null,a.logger.debug("DiagnosticsStorage: DB connection closed.")},c.onerror=function(b){a.logger.debug("DiagnosticsStorage: A global database error occurred.",b),c.close()},b(c)},d.onupgradeneeded=function(b){var c=b.target.result;a.createTables(c)}})},a.prototype.createTables=function(a){a.objectStoreNames.contains(bk)||a.createObjectStore(bk,{keyPath:"key"}),a.objectStoreNames.contains(bl)||a.createObjectStore(bl,{keyPath:"key"}),a.objectStoreNames.contains(bm)||a.createObjectStore(bm,{keyPath:"key"}),a.objectStoreNames.contains(bn)||a.createObjectStore(bn,{keyPath:"id",autoIncrement:!0}).createIndex("time_idx","time",{unique:!1}),a.objectStoreNames.contains(bo)||a.createObjectStore(bo,{keyPath:"key"})},a.prototype.setTags=function(a){return(0,ah.__awaiter)(this,void 0,void 0,function(){var b,c,d,e=this;return(0,ah.__generator)(this,function(f){switch(f.label){case 0:if(f.trys.push([0,2,,3]),0===Object.entries(a).length)return[2];return[4,this.getDB()];case 1:return c=(b=f.sent().transaction([bk],"readwrite")).objectStore(bk),[2,new Promise(function(d){var f=Object.entries(a);b.oncomplete=function(){d()},b.onabort=function(a){e.logger.debug("DiagnosticsStorage: Failed to set tags",a),d()},f.forEach(function(a){var b=(0,ah.__read)(a,2),d=b[0],f=b[1];c.put({key:d,value:f}).onerror=function(a){e.logger.debug("DiagnosticsStorage: Failed to set tag",d,f,a)}})})];case 2:return d=f.sent(),this.logger.debug("DiagnosticsStorage: Failed to set tags",d),[3,3];case 3:return[2]}})})},a.prototype.incrementCounters=function(a){return(0,ah.__awaiter)(this,void 0,void 0,function(){var b,c,d,e=this;return(0,ah.__generator)(this,function(f){switch(f.label){case 0:if(f.trys.push([0,2,,3]),0===Object.entries(a).length)return[2];return[4,this.getDB()];case 1:return c=(b=f.sent().transaction([bl],"readwrite")).objectStore(bl),[2,new Promise(function(d){var f=Object.entries(a);b.oncomplete=function(){d()},b.onabort=function(a){e.logger.debug("DiagnosticsStorage: Failed to increment counters",a),d()},f.forEach(function(a){var b=(0,ah.__read)(a,2),d=b[0],f=b[1],g=c.get(d);g.onsuccess=function(){var a=g.result,b=a?a.value:0;c.put({key:d,value:b+f}).onerror=function(a){e.logger.debug("DiagnosticsStorage: Failed to update counter",d,a)}},g.onerror=function(a){e.logger.debug("DiagnosticsStorage: Failed to read existing counter",d,a)}})})];case 2:return d=f.sent(),this.logger.debug("DiagnosticsStorage: Failed to increment counters",d),[3,3];case 3:return[2]}})})},a.prototype.setHistogramStats=function(a){return(0,ah.__awaiter)(this,void 0,void 0,function(){var b,c,d,e=this;return(0,ah.__generator)(this,function(f){switch(f.label){case 0:if(f.trys.push([0,2,,3]),0===Object.entries(a).length)return[2];return[4,this.getDB()];case 1:return c=(b=f.sent().transaction([bm],"readwrite")).objectStore(bm),[2,new Promise(function(d){var f=Object.entries(a);b.oncomplete=function(){d()},b.onabort=function(a){e.logger.debug("DiagnosticsStorage: Failed to set histogram stats",a),d()},f.forEach(function(a){var b=(0,ah.__read)(a,2),d=b[0],f=b[1],g=c.get(d);g.onsuccess=function(){var a,b=g.result;a=b?{key:d,count:b.count+f.count,min:Math.min(b.min,f.min),max:Math.max(b.max,f.max),sum:b.sum+f.sum}:{key:d,count:f.count,min:f.min,max:f.max,sum:f.sum},c.put(a).onerror=function(a){e.logger.debug("DiagnosticsStorage: Failed to set histogram stats",d,a)}},g.onerror=function(a){e.logger.debug("DiagnosticsStorage: Failed to read existing histogram stats",d,a)}})})];case 2:return d=f.sent(),this.logger.debug("DiagnosticsStorage: Failed to set histogram stats",d),[3,3];case 3:return[2]}})})},a.prototype.addEventRecords=function(a){return(0,ah.__awaiter)(this,void 0,void 0,function(){var b,c,d,e=this;return(0,ah.__generator)(this,function(f){switch(f.label){case 0:if(f.trys.push([0,2,,3]),0===a.length)return[2];return[4,this.getDB()];case 1:return c=(b=f.sent().transaction([bn],"readwrite")).objectStore(bn),[2,new Promise(function(d){b.oncomplete=function(){d()},b.onabort=function(a){e.logger.debug("DiagnosticsStorage: Failed to add event records",a),d()};var f=c.count();f.onsuccess=function(){var b=Math.max(0,10-f.result);b<a.length&&e.logger.debug("DiagnosticsStorage: Only added ".concat(b," of ").concat(a.length," events due to storage limit")),a.slice(0,b).forEach(function(a){c.add(a).onerror=function(a){e.logger.debug("DiagnosticsStorage: Failed to add event record",a)}})},f.onerror=function(a){e.logger.debug("DiagnosticsStorage: Failed to count existing events",a)}})];case 2:return d=f.sent(),this.logger.debug("DiagnosticsStorage: Failed to add event records",d),[3,3];case 3:return[2]}})})},a.prototype.setInternal=function(a,b){return(0,ah.__awaiter)(this,void 0,void 0,function(){var c,d,e;return(0,ah.__generator)(this,function(f){switch(f.label){case 0:return f.trys.push([0,2,,3]),[4,this.getDB()];case 1:return d=(c=f.sent().transaction([bo],"readwrite")).objectStore(bo),[2,new Promise(function(e,f){c.onabort=function(){return f(Error("Failed to set internal value"))};var g=d.put({key:a,value:b});g.onsuccess=function(){return e()},g.onerror=function(){return f(Error("Failed to set internal value"))}})];case 2:return e=f.sent(),this.logger.debug("DiagnosticsStorage: Failed to set internal value",e),[3,3];case 3:return[2]}})})},a.prototype.getInternal=function(a){return(0,ah.__awaiter)(this,void 0,void 0,function(){var b,c,d;return(0,ah.__generator)(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.getDB()];case 1:return c=(b=e.sent().transaction([bo],"readonly")).objectStore(bo),[2,new Promise(function(d,e){b.onabort=function(){return e(Error("Failed to get internal value"))};var f=c.get(a);f.onsuccess=function(){return d(f.result)},f.onerror=function(){return e(Error("Failed to get internal value"))}})];case 2:return d=e.sent(),this.logger.debug("DiagnosticsStorage: Failed to get internal value",d),[2,void 0];case 3:return[2]}})})},a.prototype.getLastFlushTimestamp=function(){return(0,ah.__awaiter)(this,void 0,void 0,function(){var a,b;return(0,ah.__generator)(this,function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),[4,this.getInternal(bp)];case 1:return[2,(a=c.sent())?parseInt(a.value,10):void 0];case 2:return b=c.sent(),this.logger.debug("DiagnosticsStorage: Failed to get last flush timestamp",b),[2,void 0];case 3:return[2]}})})},a.prototype.setLastFlushTimestamp=function(a){return(0,ah.__awaiter)(this,void 0,void 0,function(){var b;return(0,ah.__generator)(this,function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),[4,this.setInternal(bp,a.toString())];case 1:return c.sent(),[3,3];case 2:return b=c.sent(),this.logger.debug("DiagnosticsStorage: Failed to set last flush timestamp",b),[3,3];case 3:return[2]}})})},a.prototype.clearTable=function(a,b){return new Promise(function(c,d){var e=a.objectStore(b).clear();e.onsuccess=function(){return c()},e.onerror=function(){return d(Error("Failed to clear table ".concat(b)))}})},a.prototype.getAllAndClear=function(){return(0,ah.__awaiter)(this,void 0,void 0,function(){var a,b,c,d,e,f,g;return(0,ah.__generator)(this,function(h){switch(h.label){case 0:return h.trys.push([0,4,,5]),[4,this.getDB()];case 1:return a=h.sent().transaction([bk,bl,bm,bn],"readwrite"),[4,Promise.all([this.getAllFromStore(a,bk),this.getAllFromStore(a,bl),this.getAllFromStore(a,bm),this.getAllFromStore(a,bn)])];case 2:return c=(b=ah.__read.apply(void 0,[h.sent(),4]))[0],d=b[1],e=b[2],f=b[3],[4,Promise.all([this.clearTable(a,bl),this.clearTable(a,bm),this.clearTable(a,bn)])];case 3:return h.sent(),[2,{tags:c,counters:d,histogramStats:e,events:f}];case 4:return g=h.sent(),this.logger.debug("DiagnosticsStorage: Failed to get all and clear data",g),[2,{tags:[],counters:[],histogramStats:[],events:[]}];case 5:return[2]}})})},a.prototype.getAllFromStore=function(a,b){return new Promise(function(c,d){var e=a.objectStore(b).getAll();e.onsuccess=function(){return c(e.result)},e.onerror=function(){return d(Error("Failed to get all from ".concat(b)))}})},a}(),br=function(a){var b=0;if(0===a.length)return b;for(var c=0;c<a.length;c++)b=(b<<5)-b+a.charCodeAt(c)|0;return b},bs=function(a,b){return 31*Math.abs(br(a.toString()))%1e5/1e5<b},bt=function(){var a=aJ();return null==a?void 0:a.__AMPLITUDE_SCRIPT_URL__},bu=function(a){var b=aJ();if(b&&"function"==typeof b.addEventListener){var c=function(b){a.recordEvent("sdk.error.uncaught",(0,ah.__assign)({type:b.type,message:b.message,filename:b.filename,error_name:b.errorName,stack:b.stack},b.metadata))};b.addEventListener("error",function(a){var b=a.error instanceof Error?a.error:void 0,d=null==b?void 0:b.stack,e=bv({filename:a.filename,stack:d});e&&c({type:"error",message:a.message,stack:d,filename:a.filename,errorName:null==b?void 0:b.name,metadata:{colno:a.colno,lineno:a.lineno,isTrusted:a.isTrusted,matchReason:e}})},!0),b.addEventListener("unhandledrejection",function(a){var b,d=a.reason instanceof Error?a.reason:void 0,e=null==d?void 0:d.stack,f=bw(e),g=bv({filename:f,stack:e});g&&c({type:"unhandledrejection",message:null!=(b=null==d?void 0:d.message)?b:bx(a.reason),stack:e,filename:f,errorName:null==d?void 0:d.name,metadata:{isTrusted:a.isTrusted,matchReason:g}})},!0)}},bv=function(a){var b=bt();if(b){if(a.filename&&a.filename.includes(b))return"filename";if(a.stack&&a.stack.includes(b))return"stack"}},bw=function(a){if(a){var b=a.match(/(https?:\/\/\S+?)(?=[)\s]|$)/);return b?b[1]:void 0}},bx=function(a){if("string"==typeof a)return a;try{return JSON.stringify(a)}catch(a){return"[object Object]"}},by=function(){function a(a,b,c,d){void 0===c&&(c="US"),this.inMemoryTags={},this.inMemoryCounters={},this.inMemoryHistograms={},this.inMemoryEvents=[],this.saveTimer=null,this.flushTimer=null,this.apiKey=a,this.logger=b,this.serverUrl="US"===c?"https://diagnostics.prod.us-west-2.amplitude.com/v1/capture":"https://diagnostics.prod.eu-central-1.amplitude.com/v1/capture",this.logger.debug("DiagnosticsClient: Initializing with options",JSON.stringify(d,null,2)),this.config=(0,ah.__assign)({enabled:!0,sampleRate:0},d),this.startTimestamp=Date.now(),this.shouldTrack=bs(this.startTimestamp,this.config.sampleRate)&&this.config.enabled,bq.isSupported()?this.storage=new bq(a,b):this.logger.debug("DiagnosticsClient: IndexedDB is not supported"),this.initializeFlushInterval(),this.shouldTrack&&(this.increment("sdk.diagnostics.sampled.in.and.enabled"),bu(this))}return a.prototype.isStorageAndTrackEnabled=function(){return!!this.storage&&!!this.shouldTrack},a.prototype.setTag=function(a,b){if(this.isStorageAndTrackEnabled()){if(Object.keys(this.inMemoryTags).length>=1e4)return void this.logger.debug("DiagnosticsClient: Early return setTags as reaching memory limit");this.inMemoryTags[a]=b,this.startTimersIfNeeded()}},a.prototype.increment=function(a,b){if(void 0===b&&(b=1),this.isStorageAndTrackEnabled()){if(Object.keys(this.inMemoryCounters).length>=1e4)return void this.logger.debug("DiagnosticsClient: Early return increment as reaching memory limit");this.inMemoryCounters[a]=(this.inMemoryCounters[a]||0)+b,this.startTimersIfNeeded()}},a.prototype.recordHistogram=function(a,b){if(this.isStorageAndTrackEnabled()){if(Object.keys(this.inMemoryHistograms).length>=1e4)return void this.logger.debug("DiagnosticsClient: Early return recordHistogram as reaching memory limit");var c=this.inMemoryHistograms[a];c?(c.count+=1,c.min=Math.min(c.min,b),c.max=Math.max(c.max,b),c.sum+=b):this.inMemoryHistograms[a]={count:1,min:b,max:b,sum:b},this.startTimersIfNeeded()}},a.prototype.recordEvent=function(a,b){if(this.isStorageAndTrackEnabled()){if(this.inMemoryEvents.length>=10)return void this.logger.debug("DiagnosticsClient: Early return recordEvent as reaching memory limit");this.inMemoryEvents.push({event_name:a,time:Date.now(),event_properties:b}),this.startTimersIfNeeded()}},a.prototype.startTimersIfNeeded=function(){var a=this;this.saveTimer||(this.saveTimer=setTimeout(function(){a.saveAllDataToStorage().catch(function(b){a.logger.debug("DiagnosticsClient: Failed to save all data to storage",b)}).finally(function(){a.saveTimer=null})},1e3)),this.flushTimer||(this.flushTimer=setTimeout(function(){a._flush().catch(function(b){a.logger.debug("DiagnosticsClient: Failed to flush",b)}).finally(function(){a.flushTimer=null})},3e5))},a.prototype.saveAllDataToStorage=function(){return(0,ah.__awaiter)(this,void 0,void 0,function(){var a,b,c,d;return(0,ah.__generator)(this,function(e){switch(e.label){case 0:if(!this.storage)return[2];return a=(0,ah.__assign)({},this.inMemoryTags),b=(0,ah.__assign)({},this.inMemoryCounters),c=(0,ah.__assign)({},this.inMemoryHistograms),d=(0,ah.__spreadArray)([],(0,ah.__read)(this.inMemoryEvents),!1),this.inMemoryEvents=[],this.inMemoryTags={},this.inMemoryCounters={},this.inMemoryHistograms={},[4,Promise.all([this.storage.setTags(a),this.storage.incrementCounters(b),this.storage.setHistogramStats(c),this.storage.addEventRecords(d)])];case 1:return e.sent(),[2]}})})},a.prototype._flush=function(){return(0,ah.__awaiter)(this,void 0,void 0,function(){var a,b,c,d,e,f,g,h,i,j;return(0,ah.__generator)(this,function(k){switch(k.label){case 0:if(!this.storage)return[2];return[4,this.saveAllDataToStorage()];case 1:return k.sent(),this.saveTimer=null,this.flushTimer=null,[4,this.storage.getAllAndClear()];case 2:if(b=(a=k.sent()).tags,c=a.counters,d=a.histogramStats,e=a.events,this.storage.setLastFlushTimestamp(Date.now()),f={},b.forEach(function(a){f[a.key]=a.value}),g={},c.forEach(function(a){g[a.key]=a.value}),h={},d.forEach(function(a){h[a.key]={count:a.count,min:a.min,max:a.max,avg:Math.round(a.sum/a.count*100)/100}}),i=e.map(function(a){return{event_name:a.event_name,time:a.time,event_properties:a.event_properties}}),0===Object.keys(g).length&&0===Object.keys(h).length&&0===i.length)return[2];return j={tags:f,histogram:h,counters:g,events:i},this.fetch(j),[2]}})})},a.prototype.fetch=function(a){return(0,ah.__awaiter)(this,void 0,void 0,function(){var b;return(0,ah.__generator)(this,function(c){switch(c.label){case 0:if(c.trys.push([0,2,,3]),!aJ())throw Error("DiagnosticsClient: Fetch is not supported");return[4,fetch(this.serverUrl,{method:"POST",headers:{"X-ApiKey":this.apiKey,"Content-Type":"application/json"},body:JSON.stringify(a)})];case 1:if(!c.sent().ok)return this.logger.debug("DiagnosticsClient: Failed to send diagnostics data."),[2];return this.logger.debug("DiagnosticsClient: Successfully sent diagnostics data"),[3,3];case 2:return b=c.sent(),this.logger.debug("DiagnosticsClient: Failed to send diagnostics data. ",b),[3,3];case 3:return[2]}})})},a.prototype.initializeFlushInterval=function(){return(0,ah.__awaiter)(this,void 0,void 0,function(){var a,b,c;return(0,ah.__generator)(this,function(d){switch(d.label){case 0:if(!this.storage)return[2];return a=Date.now(),[4,this.storage.getLastFlushTimestamp()];case 1:if(-1===(b=d.sent()||-1))return this.storage.setLastFlushTimestamp(a),this._setFlushTimer(3e5),[2];return(c=a-b)>=3e5?this._flush():this._setFlushTimer(3e5-c),[2]}})})},a.prototype._setFlushTimer=function(a){var b=this;this.flushTimer=setTimeout(function(){b._flush().catch(function(a){b.logger.debug("DiagnosticsClient: Failed to flush",a)}).finally(function(){b.flushTimer=null})},a)},a.prototype._setSampleRate=function(a){this.logger.debug("DiagnosticsClient: Setting sample rate to",a),this.config.sampleRate=a,this.shouldTrack=bs(this.startTimestamp,this.config.sampleRate)&&this.config.enabled,this.logger.debug("DiagnosticsClient: Should track is",this.shouldTrack)},a}(),bz=function(a,b){return"boolean"==typeof a?a:(null==a?void 0:a[b])!==!1},bA=function(a){return bz(a,"attribution")},bB=function(a){return bz(a,"pageViews")},bC=function(a){return bz(a,"sessions")},bD=function(a){return"boolean"==typeof a?a:"object"==typeof a&&(!0===a.networkTracking||"object"==typeof a.networkTracking)},bE=function(a){return"boolean"==typeof a?a:"object"==typeof a&&(!0===a.elementInteractions||"object"==typeof a.elementInteractions)},bF=function(a){return"boolean"==typeof a?a:"object"==typeof a&&(!0===a.frustrationInteractions||"object"==typeof a.frustrationInteractions)},bG=function(a){if(bE(a.autocapture)&&"object"==typeof a.autocapture&&"object"==typeof a.autocapture.elementInteractions)return a.autocapture.elementInteractions},bH=function(a){if(bF(a.autocapture)&&"object"==typeof a.autocapture&&"object"==typeof a.autocapture.frustrationInteractions)return a.autocapture.frustrationInteractions},bI=function(a){var b;if(bD(a.autocapture)){var c=void 0;return"object"==typeof a.autocapture&&"object"==typeof a.autocapture.networkTracking?c=a.autocapture.networkTracking:a.networkTrackingOptions&&(c=a.networkTrackingOptions),(0,ah.__assign)((0,ah.__assign)({},c),{captureRules:null==(b=null==c?void 0:c.captureRules)?void 0:b.map(function(b){var c,d,e;if((null==(c=b.urls)?void 0:c.length)&&(null==(d=b.hosts)?void 0:d.length)){var f=JSON.stringify(b.hosts),g=JSON.stringify(b.urls);return null==(e=a.loggerProvider)||e.warn("Found network capture rule with both urls='".concat(g,"' and hosts='").concat(f,"' set. ")+"Definition of urls takes precedence over hosts, so ignoring hosts."),(0,ah.__assign)((0,ah.__assign)({},b),{hosts:void 0})}return b})})}},bJ=function(a){var b,c=function(){return!1},d=void 0,e=a.pageCounter;return bB(a.defaultTracking)&&(c=void 0,b=void 0,a.defaultTracking&&"object"==typeof a.defaultTracking&&a.defaultTracking.pageViews&&"object"==typeof a.defaultTracking.pageViews&&("trackOn"in a.defaultTracking.pageViews&&(c=a.defaultTracking.pageViews.trackOn),"trackHistoryChanges"in a.defaultTracking.pageViews&&(d=a.defaultTracking.pageViews.trackHistoryChanges),"eventType"in a.defaultTracking.pageViews&&a.defaultTracking.pageViews.eventType&&(b=a.defaultTracking.pageViews.eventType))),{trackOn:c,trackHistoryChanges:d,eventType:b,pageCounter:e}},bK=function(a,b){for(var c=0;c<b.length;c++){var d=b[c],e=d.name,f=d.args,g=d.resolve,h=a&&a[e];if("function"==typeof h){var i=h.apply(a,f);"function"==typeof g&&g(null==i?void 0:i.promise)}}return a},bL=function(a){return a&&void 0!==a._q},bM=function(){if("u"<typeof navigator)return"";var a,b,c,d,e=navigator.userLanguage;return null!=(d=null!=(c=null!=(b=null==(a=navigator.languages)?void 0:a[0])?b:navigator.language)?c:e)?d:""},bN="2.33.1",bO="amplitude-ts",bP=function(){function a(){this.name="@amplitude/plugin-context-browser",this.type="before",this.library="".concat(bO,"/").concat(bN),"u">typeof navigator&&(this.userAgent=navigator.userAgent)}return a.prototype.setup=function(a){return this.config=a,Promise.resolve(void 0)},a.prototype.execute=function(a){var b,c;return(0,ah.__awaiter)(this,void 0,void 0,function(){var d,e,f;return(0,ah.__generator)(this,function(g){return d=new Date().getTime(),e=null!=(b=this.config.lastEventId)?b:-1,f=null!=(c=a.event_id)?c:e+1,this.config.lastEventId=f,a.time||(this.config.lastEventTime=d),[2,(0,ah.__assign)((0,ah.__assign)((0,ah.__assign)((0,ah.__assign)((0,ah.__assign)((0,ah.__assign)((0,ah.__assign)((0,ah.__assign)({user_id:this.config.userId,device_id:this.config.deviceId,session_id:this.config.sessionId,time:d},this.config.appVersion&&{app_version:this.config.appVersion}),this.config.trackingOptions.platform&&{platform:"Web"}),this.config.trackingOptions.language&&{language:bM()}),this.config.trackingOptions.ipAddress&&{ip:"$remote"}),{insert_id:aL(),partner_id:this.config.partnerId,plan:this.config.plan}),this.config.ingestionMetadata&&{ingestion_metadata:{source_name:this.config.ingestionMetadata.sourceName,source_version:this.config.ingestionMetadata.sourceVersion}}),a),{event_id:f,library:this.library,user_agent:this.userAgent})]})})},a}(),bQ=function(){function a(){this.memoryStorage=new Map}return a.prototype.isEnabled=function(){return(0,ah.__awaiter)(this,void 0,void 0,function(){return(0,ah.__generator)(this,function(a){return[2,!0]})})},a.prototype.get=function(a){return(0,ah.__awaiter)(this,void 0,void 0,function(){return(0,ah.__generator)(this,function(b){return[2,this.memoryStorage.get(a)]})})},a.prototype.getRaw=function(a){return(0,ah.__awaiter)(this,void 0,void 0,function(){var b;return(0,ah.__generator)(this,function(c){switch(c.label){case 0:return[4,this.get(a)];case 1:return[2,(b=c.sent())?JSON.stringify(b):void 0]}})})},a.prototype.set=function(a,b){return(0,ah.__awaiter)(this,void 0,void 0,function(){return(0,ah.__generator)(this,function(c){return this.memoryStorage.set(a,b),[2]})})},a.prototype.remove=function(a){return(0,ah.__awaiter)(this,void 0,void 0,function(){return(0,ah.__generator)(this,function(b){return this.memoryStorage.delete(a),[2]})})},a.prototype.reset=function(){return(0,ah.__awaiter)(this,void 0,void 0,function(){return(0,ah.__generator)(this,function(a){return this.memoryStorage.clear(),[2]})})},a}(),bR=function(){function a(a){this.options=(0,ah.__assign)({},a)}return a.prototype.isEnabled=function(){return(0,ah.__awaiter)(this,void 0,void 0,function(){var b,c;return(0,ah.__generator)(this,function(d){switch(d.label){case 0:if(!aJ())return[2,!1];a.testValue=String(Date.now()),b=new a(this.options),c="AMP_TEST",d.label=1;case 1:return d.trys.push([1,4,5,7]),[4,b.set(c,a.testValue)];case 2:return d.sent(),[4,b.get(c)];case 3:return[2,d.sent()===a.testValue];case 4:return d.sent(),[2,!1];case 5:return[4,b.remove(c)];case 6:return d.sent(),[7];case 7:return[2]}})})},a.prototype.get=function(a){var b;return(0,ah.__awaiter)(this,void 0,void 0,function(){var c,d;return(0,ah.__generator)(this,function(e){switch(e.label){case 0:return[4,this.getRaw(a)];case 1:if(!(c=e.sent()))return[2,void 0];try{if(d=null!=(b=bS(c))?b:bT(c),void 0===d)return console.error("Amplitude Logger [Error]: Failed to decode cookie value for key: ".concat(a,", value: ").concat(c)),[2,void 0];return[2,JSON.parse(d)]}catch(b){return console.error("Amplitude Logger [Error]: Failed to parse cookie value for key: ".concat(a,", value: ").concat(c)),[2,void 0]}}})})},a.prototype.getRaw=function(a){var b,c;return(0,ah.__awaiter)(this,void 0,void 0,function(){var d,e;return(0,ah.__generator)(this,function(f){return(e=(null!=(c=null==(b=null==(d=aJ())?void 0:d.document)?void 0:b.cookie.split("; "))?c:[]).find(function(b){return 0===b.indexOf(a+"=")}))?[2,e.substring(a.length+1)]:[2,void 0]})})},a.prototype.set=function(a,b){var c;return(0,ah.__awaiter)(this,void 0,void 0,function(){var d,e,f,g,h,i,j;return(0,ah.__generator)(this,function(k){try{d=null!=(c=this.options.expirationDays)?c:0,e=null!==b?d:-1,f=void 0,e&&((g=new Date).setTime(g.getTime()+24*e*36e5),f=g),h="".concat(a,"=").concat(btoa(encodeURIComponent(JSON.stringify(b)))),f&&(h+="; expires=".concat(f.toUTCString())),h+="; path=/",this.options.domain&&(h+="; domain=".concat(this.options.domain)),this.options.secure&&(h+="; Secure"),this.options.sameSite&&(h+="; SameSite=".concat(this.options.sameSite)),(i=aJ())&&(i.document.cookie=h)}catch(b){j=b instanceof Error?b.message:String(b),console.error("Amplitude Logger [Error]: Failed to set cookie for key: ".concat(a,". Error: ").concat(j))}return[2]})})},a.prototype.remove=function(a){return(0,ah.__awaiter)(this,void 0,void 0,function(){return(0,ah.__generator)(this,function(b){switch(b.label){case 0:return[4,this.set(a,null)];case 1:return b.sent(),[2]}})})},a.prototype.reset=function(){return(0,ah.__awaiter)(this,void 0,void 0,function(){return(0,ah.__generator)(this,function(a){return[2]})})},a}(),bS=function(a){try{return decodeURIComponent(atob(a))}catch(a){return}},bT=function(a){try{return decodeURIComponent(atob(decodeURIComponent(a)))}catch(a){return}},bU=function(a,b,c){return void 0===b&&(b=""),void 0===c&&(c=10),["AMP",b,a.substring(0,c)].filter(Boolean).join("_")},bV=function(){function a(){}return a.prototype.send=function(a,b){return Promise.resolve(null)},a.prototype.buildResponse=function(a){if("object"!=typeof a)return null;var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x=a.code||0,y=this.buildStatus(x);switch(y){case O.Success:return{status:y,statusCode:x,body:{eventsIngested:null!=(b=a.events_ingested)?b:0,payloadSizeBytes:null!=(c=a.payload_size_bytes)?c:0,serverUploadTime:null!=(d=a.server_upload_time)?d:0}};case O.Invalid:return{status:y,statusCode:x,body:{error:null!=(e=a.error)?e:"",missingField:null!=(f=a.missing_field)?f:"",eventsWithInvalidFields:null!=(g=a.events_with_invalid_fields)?g:{},eventsWithMissingFields:null!=(h=a.events_with_missing_fields)?h:{},eventsWithInvalidIdLengths:null!=(i=a.events_with_invalid_id_lengths)?i:{},epsThreshold:null!=(j=a.eps_threshold)?j:0,exceededDailyQuotaDevices:null!=(k=a.exceeded_daily_quota_devices)?k:{},silencedDevices:null!=(l=a.silenced_devices)?l:[],silencedEvents:null!=(m=a.silenced_events)?m:[],throttledDevices:null!=(n=a.throttled_devices)?n:{},throttledEvents:null!=(o=a.throttled_events)?o:[]}};case O.PayloadTooLarge:return{status:y,statusCode:x,body:{error:null!=(p=a.error)?p:""}};case O.RateLimit:return{status:y,statusCode:x,body:{error:null!=(q=a.error)?q:"",epsThreshold:null!=(r=a.eps_threshold)?r:0,throttledDevices:null!=(s=a.throttled_devices)?s:{},throttledUsers:null!=(t=a.throttled_users)?t:{},exceededDailyQuotaDevices:null!=(u=a.exceeded_daily_quota_devices)?u:{},exceededDailyQuotaUsers:null!=(v=a.exceeded_daily_quota_users)?v:{},throttledEvents:null!=(w=a.throttled_events)?w:[]}};case O.Timeout:default:return{status:y,statusCode:x}}},a.prototype.buildStatus=function(a){return aZ(a)?O.Success:429===a?O.RateLimit:413===a?O.PayloadTooLarge:408===a?O.Timeout:a>=400&&a<500?O.Invalid:a>=500?O.Failed:O.Unknown},a}(),bW=function(a){function b(b){void 0===b&&(b={});var c=a.call(this)||this;return c.customHeaders=b,c}return(0,ah.__extends)(b,a),b.prototype.send=function(a,b){return(0,ah.__awaiter)(this,void 0,void 0,function(){var c,d;return(0,ah.__generator)(this,function(e){switch(e.label){case 0:if("u"<typeof fetch)throw Error("FetchTransport is not supported");return[4,fetch(a,{headers:(0,ah.__assign)({"Content-Type":"application/json",Accept:"*/*"},this.customHeaders),body:JSON.stringify(b),method:"POST"})];case 1:return[4,(c=e.sent()).text()];case 2:d=e.sent();try{return[2,this.buildResponse(JSON.parse(d))]}catch(a){return[2,this.buildResponse({code:c.status})]}}})})},b}(bV),bX=function(){function a(a){this.storage=a}return a.prototype.isEnabled=function(){return(0,ah.__awaiter)(this,void 0,void 0,function(){var b,c,d;return(0,ah.__generator)(this,function(e){switch(e.label){case 0:if(!this.storage)return[2,!1];b=String(Date.now()),c=new a(this.storage),d="AMP_TEST",e.label=1;case 1:return e.trys.push([1,4,5,7]),[4,c.set(d,b)];case 2:return e.sent(),[4,c.get(d)];case 3:return[2,e.sent()===b];case 4:return e.sent(),[2,!1];case 5:return[4,c.remove(d)];case 6:return e.sent(),[7];case 7:return[2]}})})},a.prototype.get=function(a){return(0,ah.__awaiter)(this,void 0,void 0,function(){var b;return(0,ah.__generator)(this,function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),[4,this.getRaw(a)];case 1:if(!(b=c.sent()))return[2,void 0];return[2,JSON.parse(b)];case 2:return c.sent(),console.error("[Amplitude] Error: Could not get value from storage"),[2,void 0];case 3:return[2]}})})},a.prototype.getRaw=function(a){var b;return(0,ah.__awaiter)(this,void 0,void 0,function(){return(0,ah.__generator)(this,function(c){return[2,(null==(b=this.storage)?void 0:b.getItem(a))||void 0]})})},a.prototype.set=function(a,b){var c;return(0,ah.__awaiter)(this,void 0,void 0,function(){return(0,ah.__generator)(this,function(d){try{null==(c=this.storage)||c.setItem(a,JSON.stringify(b))}catch(a){}return[2]})})},a.prototype.remove=function(a){var b;return(0,ah.__awaiter)(this,void 0,void 0,function(){return(0,ah.__generator)(this,function(c){try{null==(b=this.storage)||b.removeItem(a)}catch(a){}return[2]})})},a.prototype.reset=function(){var a;return(0,ah.__awaiter)(this,void 0,void 0,function(){return(0,ah.__generator)(this,function(b){try{null==(a=this.storage)||a.clear()}catch(a){}return[2]})})},a}(),bY=function(a){function b(b){var c,d,e,f=this;try{e=null==(c=aJ())?void 0:c.localStorage}catch(a){null==(d=null==b?void 0:b.loggerProvider)||d.debug("Failed to access localStorage. error=".concat(JSON.stringify(a))),e=void 0}return(f=a.call(this,e)||this).loggerProvider=null==b?void 0:b.loggerProvider,f}return(0,ah.__extends)(b,a),b.prototype.set=function(b,c){var d;return(0,ah.__awaiter)(this,void 0,void 0,function(){var e;return(0,ah.__generator)(this,function(f){switch(f.label){case 0:if(!(Array.isArray(c)&&c.length>1e3))return[3,2];return e=c.length-1e3,[4,a.prototype.set.call(this,b,c.slice(0,1e3))];case 1:return f.sent(),null==(d=this.loggerProvider)||d.error("Failed to save ".concat(e," events because the queue length exceeded ").concat(1e3,".")),[3,4];case 2:return[4,a.prototype.set.call(this,b,c)];case 3:f.sent(),f.label=4;case 4:return[2]}})})},b}(bX),bZ=function(a){function b(){var b;return a.call(this,null==(b=aJ())?void 0:b.sessionStorage)||this}return(0,ah.__extends)(b,a),b}(bX),b$=function(a){function b(b){void 0===b&&(b={});var c=a.call(this)||this;return c.state={done:4},c.customHeaders=b,c}return(0,ah.__extends)(b,a),b.prototype.send=function(a,b){return(0,ah.__awaiter)(this,void 0,void 0,function(){var c=this;return(0,ah.__generator)(this,function(d){return[2,new Promise(function(d,e){"u"<typeof XMLHttpRequest&&e(Error("XHRTransport is not supported."));var f,g,h=new XMLHttpRequest;h.open("POST",a,!0),h.onreadystatechange=function(){if(h.readyState===c.state.done){var a=h.responseText;try{d(c.buildResponse(JSON.parse(a)))}catch(a){d(c.buildResponse({code:h.status}))}}};var i=(0,ah.__assign)({"Content-Type":"application/json",Accept:"*/*"},c.customHeaders);try{for(var j=(0,ah.__values)(Object.entries(i)),k=j.next();!k.done;k=j.next()){var l=(0,ah.__read)(k.value,2),m=l[0],n=l[1];h.setRequestHeader(m,n)}}catch(a){f={error:a}}finally{try{k&&!k.done&&(g=j.return)&&g.call(j)}finally{if(f)throw f.error}}h.send(JSON.stringify(b))})]})})},b}(bV),b_=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return(0,ah.__extends)(b,a),b.prototype.send=function(a,b){return(0,ah.__awaiter)(this,void 0,void 0,function(){var c=this;return(0,ah.__generator)(this,function(d){return[2,new Promise(function(d,e){var f=aJ();if(!(null==f?void 0:f.navigator.sendBeacon))throw Error("SendBeaconTransport is not supported");try{var g=JSON.stringify(b);if(f.navigator.sendBeacon(a,JSON.stringify(b)))return d(c.buildResponse({code:200,events_ingested:b.events.length,payload_size_bytes:g.length,server_upload_time:Date.now()}));return d(c.buildResponse({code:500}))}catch(a){e(a)}})]})})},b}(bV),b0=function(a){var b=parseInt(a,32);if(!isNaN(b))return b},b1=function(a){if(atob&&escape&&a)try{return decodeURIComponent(escape(atob(a)))}catch(a){return}},b2="[Amplitude]",b3="".concat(b2," Form Started"),b4="".concat(b2," Form Submitted"),b5="".concat(b2," File Downloaded"),b6="session_start",b7="session_end",b8="".concat(b2," File Extension"),b9="".concat(b2," File Name"),ca="".concat(b2," Link ID"),cb="".concat(b2," Link Text"),cc="".concat(b2," Link URL"),cd="".concat(b2," Form ID"),ce="".concat(b2," Form Name"),cf="".concat(b2," Form Destination"),cg="cookie",ch=function(a){function b(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,L,M,N,O,P){void 0===d&&(d=new bQ),void 0===e&&(e={domain:"",expiration:365,sameSite:"Lax",secure:!1,upgrade:!0}),void 0===i&&(i=1e3),void 0===j&&(j=5),void 0===k&&(k=30),void 0===l&&(l=cg),void 0===q&&(q=new aU),void 0===r&&(r=K.Warn),void 0===t&&(t=!1),void 0===u&&(u=!1),void 0===x&&(x=""),void 0===y&&(y="US"),void 0===A&&(A=18e5),void 0===B&&(B=new bY({loggerProvider:q})),void 0===C&&(C={ipAddress:!0,language:!0,platform:!0}),void 0===D&&(D="fetch"),void 0===E&&(E=!1),void 0===F&&(F=!0),void 0===M&&(M=!0),void 0===N&&(N=0);var Q,R=a.call(this,{apiKey:b,storageProvider:B,transportProvider:cj(D)})||this;return R.apiKey=b,R.appVersion=c,R.cookieOptions=e,R.defaultTracking=f,R.autocapture=g,R.flushIntervalMillis=i,R.flushMaxRetries=j,R.flushQueueSize=k,R.identityStorage=l,R.ingestionMetadata=m,R.instanceName=n,R.loggerProvider=q,R.logLevel=r,R.minIdLength=s,R.offline=t,R.partnerId=v,R.plan=w,R.serverUrl=x,R.serverZone=y,R.sessionTimeout=A,R.storageProvider=B,R.trackingOptions=C,R.transport=D,R.useBatch=E,R.fetchRemoteConfig=F,R.networkTrackingOptions=J,R.identify=L,R.enableDiagnostics=M,R.diagnosticsSampleRate=N,R.diagnosticsClient=O,R.remoteConfig=P,R.version=bN,R._optOut=!1,R._cookieStorage=d,R.deviceId=h,R.lastEventId=o,R.lastEventTime=p,R.optOut=u,R.sessionId=z,R.pageCounter=H,R.userId=G,R.debugLogsEnabled=I,R.loggerProvider.enable(I?K.Debug:R.logLevel),R.networkTrackingOptions=J,R.identify=L,R.enableDiagnostics=M,R.diagnosticsSampleRate=N,R.diagnosticsClient=O,Q=(null==P?void 0:P.fetchRemoteConfig)===!0||(null==P?void 0:P.fetchRemoteConfig)!==!1&&!1!==F,R.remoteConfig=R.remoteConfig||{},R.remoteConfig.fetchRemoteConfig=Q,R.fetchRemoteConfig=Q,R}return(0,ah.__extends)(b,a),Object.defineProperty(b.prototype,"cookieStorage",{get:function(){return this._cookieStorage},set:function(a){this._cookieStorage!==a&&(this._cookieStorage=a,this.updateStorage())},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"deviceId",{get:function(){return this._deviceId},set:function(a){this._deviceId!==a&&(this._deviceId=a,this.updateStorage())},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"userId",{get:function(){return this._userId},set:function(a){this._userId!==a&&(this._userId=a,this.updateStorage())},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"sessionId",{get:function(){return this._sessionId},set:function(a){this._sessionId!==a&&(this._sessionId=a,this.updateStorage())},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"optOut",{get:function(){return this._optOut},set:function(a){this._optOut!==a&&(this._optOut=a,this.updateStorage())},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"lastEventTime",{get:function(){return this._lastEventTime},set:function(a){this._lastEventTime!==a&&(this._lastEventTime=a,this.updateStorage())},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"lastEventId",{get:function(){return this._lastEventId},set:function(a){this._lastEventId!==a&&(this._lastEventId=a,this.updateStorage())},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"pageCounter",{get:function(){return this._pageCounter},set:function(a){this._pageCounter!==a&&(this._pageCounter=a,this.updateStorage())},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"debugLogsEnabled",{set:function(a){this._debugLogsEnabled!==a&&(this._debugLogsEnabled=a,this.updateStorage())},enumerable:!1,configurable:!0}),b.prototype.updateStorage=function(){var a={deviceId:this._deviceId,userId:this._userId,sessionId:this._sessionId,optOut:this._optOut,lastEventTime:this._lastEventTime,lastEventId:this._lastEventId,pageCounter:this._pageCounter,debugLogsEnabled:this._debugLogsEnabled};this.cookieStorage.set(bU(this.apiKey),a)},b}(aW),ci=function(a,b){switch(void 0===a&&(a=cg),void 0===b&&(b={}),a){case"localStorage":return new bY;case"sessionStorage":return new bZ;case"none":return new bQ;default:return new bR((0,ah.__assign)((0,ah.__assign)({},b),{expirationDays:b.expiration}))}},cj=function(a){var b="object"==typeof a?a.type:a,c="object"==typeof a?a.headers:void 0;return"xhr"===b?new b$(c):"beacon"===b?new b_:new bW(c)},ck="data-amp-mask",cl="*****",cm=/\b(?:\d[ -]*?){13,16}\b/,cn=/(\d{3}-?\d{2}-?\d{4})/g,co=/[^\s@]+@[^\s@.]+\.[^\s@]+/g,cp=function(a,b){if(void 0===b&&(b=[]),"string"!=typeof a)return"";var c,d,e=a;e=(e=(e=e.replace(cm,cl)).replace(cn,cl)).replace(co,cl);try{for(var f=(0,ah.__values)(b),g=f.next();!g.done;g=f.next()){var h=g.value;try{e=e.replace(h,cl)}catch(a){}}}catch(a){c={error:a}}finally{try{g&&!g.done&&(d=f.return)&&d.call(f)}finally{if(c)throw c.error}}return e},cq=function(a){if("u"<typeof document||!document.title)return"";var b=document.querySelector("title");return b&&b.hasAttribute(ck)?cl:a?a(document.title):document.title},cr=function(){function a(){}return a.prototype.parse=function(){return(0,ah.__awaiter)(this,void 0,void 0,function(){return(0,ah.__generator)(this,function(a){return[2,(0,ah.__assign)((0,ah.__assign)((0,ah.__assign)((0,ah.__assign)({},aB),this.getUtmParam()),this.getReferrer()),this.getClickIds())]})})},a.prototype.getUtmParam=function(){var a=bg();return{utm_campaign:a.utm_campaign,utm_content:a.utm_content,utm_id:a.utm_id,utm_medium:a.utm_medium,utm_source:a.utm_source,utm_term:a.utm_term}},a.prototype.getReferrer=function(){var a,b,c={referrer:void 0,referring_domain:void 0};try{c.referrer=document.referrer||void 0,c.referring_domain=null!=(b=null==(a=c.referrer)?void 0:a.split("/")[2])?b:void 0}catch(a){}return c},a.prototype.getClickIds=function(){var a,b=bg();return(a={})[aq]=b[aq],a[ar]=b[ar],a[as]=b[as],a[at]=b[at],a[au]=b[au],a[av]=b[av],a[aw]=b[aw],a[ax]=b[ax],a[ay]=b[ay],a[az]=b[az],a[aA]=b[aA],a},a}(),cs=function(a){var b={};for(var c in a){var d=a[c];d&&(b[c]=d)}return b},ct=function(a){void 0===a&&(a={});var b,c,d=aJ(),e=void 0,f=!1,g=a.trackOn,h=a.trackHistoryChanges,i=a.eventType,j=void 0===i?"[Amplitude] Page Viewed":i,k=function(a){var b=a;try{b=decodeURI(a)}catch(a){null==e||e.error("Malformed URI sequence: ",a)}return b},l=function(){return(0,ah.__awaiter)(void 0,void 0,void 0,function(){var a,b,c;return(0,ah.__generator)(this,function(d){switch(d.label){case 0:return a=k("u">typeof location&&location.href||""),c={event_type:j},b=[{}],[4,cu()];case 1:return[2,(c.event_properties=ah.__assign.apply(void 0,[ah.__assign.apply(void 0,b.concat([d.sent()])),{"[Amplitude] Page Domain":"u">typeof location&&location.hostname||"","[Amplitude] Page Location":a,"[Amplitude] Page Path":"u">typeof location&&k(location.pathname)||"","[Amplitude] Page Title":cq(cp),"[Amplitude] Page URL":a.split("?")[0]}]),c)]}})})},m=function(){return void 0===g||"function"==typeof g&&g()},n="u">typeof location?location.href:null,o=function(){return(0,ah.__awaiter)(void 0,void 0,void 0,function(){var a,c,d,f;return(0,ah.__generator)(this,function(g){switch(g.label){case 0:if(c=cw(h,a=location.href,n||"")&&m(),n=a,!c)return[3,4];if(null==e||e.log("Tracking page view event"),null!=b)return[3,1];return[3,3];case 1:return f=(d=b).track,[4,l()];case 2:f.apply(d,[g.sent()]),g.label=3;case 3:g.label=4;case 4:return[2]}})})},p=function(){o()};return{name:"@amplitude/plugin-page-view-tracking-browser",type:"enrichment",setup:function(a,g){return(0,ah.__awaiter)(void 0,void 0,void 0,function(){var h,i;return(0,ah.__generator)(this,function(j){switch(j.label){case 0:if(b=g,c=a,(e=a.loggerProvider).log("Installing @amplitude/plugin-page-view-tracking-browser"),f=!0,d&&(d.addEventListener("popstate",p),d.history.pushState=new Proxy(d.history.pushState,{apply:function(a,b,c){var d=(0,ah.__read)(c,3),e=d[0],g=d[1],h=d[2];a.apply(b,[e,g,h]),f&&o()}})),!m())return[3,2];return e.log("Tracking page view event"),i=(h=b).track,[4,l()];case 1:i.apply(h,[j.sent()]),j.label=2;case 2:return[2]}})})},execute:function(a){return(0,ah.__awaiter)(void 0,void 0,void 0,function(){var b;return(0,ah.__generator)(this,function(d){switch(d.label){case 0:if(!("attribution"===g&&cv(a)))return[3,2];return null==e||e.log("Enriching campaign event to page view event with campaign parameters"),[4,l()];case 1:a.event_type=(b=d.sent()).event_type,a.event_properties=(0,ah.__assign)((0,ah.__assign)({},a.event_properties),b.event_properties),d.label=2;case 2:return c&&a.event_type===j&&(c.pageCounter=c.pageCounter?c.pageCounter+1:1,a.event_properties=(0,ah.__assign)((0,ah.__assign)({},a.event_properties),{"[Amplitude] Page Counter":c.pageCounter})),[2,a]}})})},teardown:function(){return(0,ah.__awaiter)(void 0,void 0,void 0,function(){return(0,ah.__generator)(this,function(a){return d&&(d.removeEventListener("popstate",p),f=!1),[2]})})}}},cu=function(){return(0,ah.__awaiter)(void 0,void 0,void 0,function(){var a;return(0,ah.__generator)(this,function(b){switch(b.label){case 0:return a=cs,[4,new cr().parse()];case 1:return[2,a.apply(void 0,[b.sent()])]}})})},cv=function(a){if("$identify"===a.event_type&&a.user_properties){var b=a.user_properties,c=b[L.SET]||{},d=b[L.UNSET]||{},e=(0,ah.__spreadArray)((0,ah.__spreadArray)([],(0,ah.__read)(Object.keys(c)),!1),(0,ah.__read)(Object.keys(d)),!1);return Object.keys(aB).every(function(a){return e.includes(a)})}return!1},cw=function(a,b,c){if("pathOnly"!==a)return b!==c;if(""==c)return!0;var d=new URL(b),e=new URL(c);return d.origin+d.pathname!==e.origin+e.pathname},cx=function(){var a,b=[],c=function(a,c,d){a.addEventListener(c,d),b.push({element:a,type:c,handler:d})},d=function(){b.forEach(function(a){var b=a.element,c=a.type,d=a.handler;null==b||b.removeEventListener(c,d)}),b=[]};return{name:"@amplitude/plugin-form-interaction-tracking-browser",type:"enrichment",setup:function(b,d){return(0,ah.__awaiter)(void 0,void 0,void 0,function(){var e,f;return(0,ah.__generator)(this,function(g){return e=function(){if(!d)return void b.loggerProvider.warn("Form interaction tracking requires a later version of @amplitude/analytics-browser. Form interaction events are not tracked.");if("u">typeof document){var e=function(a){var b=!1;c(a,"change",function(){var c,e=cz(a);b||d.track(b3,((c={})[cd]=cy(a.id),c[ce]=cy(a.name),c[cf]=e,c)),b=!0}),c(a,"submit",function(){var c,e,f=cz(a);b||d.track(b3,((c={})[cd]=cy(a.id),c[ce]=cy(a.name),c[cf]=f,c)),d.track(b4,((e={})[cd]=cy(a.id),e[ce]=cy(a.name),e[cf]=f,e)),b=!1})};Array.from(document.getElementsByTagName("form")).forEach(e),"u">typeof MutationObserver&&(a=new MutationObserver(function(a){a.forEach(function(a){a.addedNodes.forEach(function(a){"FORM"===a.nodeName&&e(a),"querySelectorAll"in a&&"function"==typeof a.querySelectorAll&&Array.from(a.querySelectorAll("form")).map(e)})})})).observe(document.body,{subtree:!0,childList:!0})}},"complete"===document.readyState?e():(f=aJ())?f.addEventListener("load",e):b.loggerProvider.debug("Form interaction tracking is not installed because global is undefined."),[2]})})},execute:function(a){return(0,ah.__awaiter)(void 0,void 0,void 0,function(){return(0,ah.__generator)(this,function(b){return[2,a]})})},teardown:function(){return(0,ah.__awaiter)(void 0,void 0,void 0,function(){return(0,ah.__generator)(this,function(b){return null==a||a.disconnect(),d(),[2]})})}}},cy=function(a){if("string"==typeof a)return a},cz=function(a){var b=a.getAttribute("action");try{b=new URL(encodeURI(null!=b?b:""),window.location.href).href}catch(a){}return b},cA=function(){var a,b=[],c=function(a,c,d){a.addEventListener(c,d),b.push({element:a,type:c,handler:d})},d=function(){b.forEach(function(a){var b=a.element,c=a.type,d=a.handler;null==b||b.removeEventListener(c,d)}),b=[]};return{name:"@amplitude/plugin-file-download-tracking-browser",type:"enrichment",setup:function(b,d){return(0,ah.__awaiter)(void 0,void 0,void 0,function(){var e,f;return(0,ah.__generator)(this,function(g){return e=function(){if(!d)return void b.loggerProvider.warn("File download tracking requires a later version of @amplitude/analytics-browser. File download events are not tracked.");if("u">typeof document){var e=function(a){try{b=new URL(a.href,window.location.href)}catch(a){return}var b,e=f.exec(b.href),g=null==e?void 0:e[1];g&&c(a,"click",function(){var c;g&&d.track(b5,((c={})[b8]=g,c[b9]=b.pathname,c[ca]=a.id,c[cb]=a.text,c[cc]=a.href,c))})},f=/\.(pdf|xlsx?|docx?|txt|rtf|csv|exe|key|pp(s|t|tx)|7z|pkg|rar|gz|zip|avi|mov|mp4|mpe?g|wmv|midi?|mp3|wav|wma)(\?.+)?$/;Array.from(document.getElementsByTagName("a")).forEach(e),"u">typeof MutationObserver&&(a=new MutationObserver(function(a){a.forEach(function(a){a.addedNodes.forEach(function(a){"A"===a.nodeName&&e(a),"querySelectorAll"in a&&"function"==typeof a.querySelectorAll&&Array.from(a.querySelectorAll("a")).map(e)})})})).observe(document.body,{subtree:!0,childList:!0})}},"complete"===document.readyState?e():(f=aJ())?f.addEventListener("load",e):b.loggerProvider.debug("File download tracking is not installed because global is undefined."),[2]})})},execute:function(a){return(0,ah.__awaiter)(void 0,void 0,void 0,function(){return(0,ah.__generator)(this,function(b){return[2,a]})})},teardown:function(){return(0,ah.__awaiter)(void 0,void 0,void 0,function(){return(0,ah.__generator)(this,function(b){return null==a||a.disconnect(),d(),[2]})})}}},cB=!1,cC=function(a){cB||void 0!==a.defaultTracking||(a.loggerProvider.warn("`options.defaultTracking` is set to undefined. This implicitly configures your Amplitude instance to track Page Views, Sessions, File Downloads, and Form Interactions. You can suppress this warning by explicitly setting a value to `options.defaultTracking`. The value must either be a boolean, to enable and disable all default events, or an object, for advanced configuration. For example:\n\namplitude.init(<YOUR_API_KEY>, {\n  defaultTracking: true,\n});\n\nVisit https://www.docs.developers.amplitude.com/data/sdks/browser-2/#tracking-default-events for more details."),cB=!0)},cD=function(){var a=aJ(),b=[],c=function(c,d){(null==a?void 0:a.addEventListener)&&(null==a||a.addEventListener(c,d),b.push({type:c,handler:d}))},d=function(){b.forEach(function(b){var c=b.type,d=b.handler;null==a||a.removeEventListener(c,d)}),b=[]};return{name:"@amplitude/plugin-network-checker-browser",type:"before",setup:function(a,b){return(0,ah.__awaiter)(void 0,void 0,void 0,function(){return(0,ah.__generator)(this,function(d){return"u"<typeof navigator?(a.loggerProvider.debug("Network connectivity checker plugin is disabled because navigator is not available."),a.offline=!1):(a.offline=!navigator.onLine,c("online",function(){a.loggerProvider.debug("Network connectivity changed to online."),a.offline=!1,setTimeout(function(){b.flush()},a.flushIntervalMillis)}),c("offline",function(){a.loggerProvider.debug("Network connectivity changed to offline."),a.offline=!0})),[2]})})},teardown:function(){return(0,ah.__awaiter)(void 0,void 0,void 0,function(){return(0,ah.__generator)(this,function(a){return d(),[2]})})}}};function cE(a,b,c){var d,e,f=[];try{for(var g=(0,ah.__values)(null!=b?b:[]),h=g.next();!h.done;h=g.next()){var i=h.value;try{f.push(new RegExp(i))}catch(a){c.loggerProvider.warn("Invalid regex pattern: ".concat(i),a)}}}catch(a){d={error:a}}finally{try{h&&!h.done&&(e=g.return)&&e.call(g)}finally{if(d)throw d.error}}return a.concat(f)}var cF=["a","button","input","select","textarea","label","video","audio",'[contenteditable="true" i]',"[data-amp-default-track]",".amp-default-track"],cG="data-amp-track-",cH=["div","span","h1","h2","h3","h4","h5","h6"];function cI(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function cJ(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function cK(a,b,c){return b&&cJ(a.prototype,b),c&&cJ(a,c),a}var cL=function(){return"function"==typeof Symbol},cM=function(a){return cL()&&!!Symbol[a]},cN=function(a){return cM(a)?Symbol[a]:"@@"+a};cL()&&!cM("observable")&&(Symbol.observable=Symbol("observable"));var cO=cN("iterator"),cP=cN("observable"),cQ=cN("species");function cR(a,b){var c=a[b];if(null!=c){if("function"!=typeof c)throw TypeError(c+" is not a function");return c}}function cS(a){var b=a.constructor;return void 0!==b&&null===(b=b[cQ])&&(b=void 0),void 0!==b?b:c_}function cT(a){cT.log?cT.log(a):setTimeout(function(){throw a})}function cU(a){Promise.resolve().then(function(){try{a()}catch(a){cT(a)}})}function cV(a){var b=a._cleanup;if(void 0!==b&&(a._cleanup=void 0,b))try{if("function"==typeof b)b();else{var c=cR(b,"unsubscribe");c&&c.call(b)}}catch(a){cT(a)}}function cW(a){a._observer=void 0,a._queue=void 0,a._state="closed"}function cX(a,b,c){a._state="running";var d=a._observer;try{var e=cR(d,b);switch(b){case"next":e&&e.call(d,c);break;case"error":if(cW(a),e)e.call(d,c);else throw c;break;case"complete":cW(a),e&&e.call(d)}}catch(a){cT(a)}"closed"===a._state?cV(a):"running"===a._state&&(a._state="ready")}function cY(a,b,c){if("closed"!==a._state){if("buffering"===a._state)return void a._queue.push({type:b,value:c});if("ready"!==a._state){a._state="buffering",a._queue=[{type:b,value:c}],cU(function(){var b=a._queue;if(b){a._queue=void 0,a._state="ready";for(var c=0;c<b.length&&(cX(a,b[c].type,b[c].value),"closed"!==a._state);++c);}});return}cX(a,b,c)}}var cZ=function(){function a(a,b){this._cleanup=void 0,this._observer=a,this._queue=void 0,this._state="initializing";var c=new c$(this);try{this._cleanup=b.call(void 0,c)}catch(a){c.error(a)}"initializing"===this._state&&(this._state="ready")}return a.prototype.unsubscribe=function(){"closed"!==this._state&&(cW(this),cV(this))},cK(a,[{key:"closed",get:function(){return"closed"===this._state}}]),a}(),c$=function(){function a(a){this._subscription=a}var b=a.prototype;return b.next=function(a){cY(this._subscription,"next",a)},b.error=function(a){cY(this._subscription,"error",a)},b.complete=function(){cY(this._subscription,"complete")},cK(a,[{key:"closed",get:function(){return"closed"===this._subscription._state}}]),a}(),c_=function(){function a(b){if(!(this instanceof a))throw TypeError("Observable cannot be called as a function");if("function"!=typeof b)throw TypeError("Observable initializer must be a function");this._subscriber=b}var b=a.prototype;return b.subscribe=function(a){return("object"!=typeof a||null===a)&&(a={next:a,error:arguments[1],complete:arguments[2]}),new cZ(a,this._subscriber)},b.forEach=function(a){var b=this;return new Promise(function(c,d){if("function"!=typeof a)return void d(TypeError(a+" is not a function"));function e(){f.unsubscribe(),c()}var f=b.subscribe({next:function(b){try{a(b,e)}catch(a){d(a),f.unsubscribe()}},error:d,complete:c})})},b.map=function(a){var b=this;if("function"!=typeof a)throw TypeError(a+" is not a function");return new(cS(this))(function(c){return b.subscribe({next:function(b){try{b=a(b)}catch(a){return c.error(a)}c.next(b)},error:function(a){c.error(a)},complete:function(){c.complete()}})})},b.filter=function(a){var b=this;if("function"!=typeof a)throw TypeError(a+" is not a function");return new(cS(this))(function(c){return b.subscribe({next:function(b){try{if(!a(b))return}catch(a){return c.error(a)}c.next(b)},error:function(a){c.error(a)},complete:function(){c.complete()}})})},b.reduce=function(a){var b=this;if("function"!=typeof a)throw TypeError(a+" is not a function");var c=cS(this),d=arguments.length>1,e=!1,f=arguments[1],g=f;return new c(function(c){return b.subscribe({next:function(b){var f=!e;if(e=!0,!f||d)try{g=a(g,b)}catch(a){return c.error(a)}else g=b},error:function(a){c.error(a)},complete:function(){if(!e&&!d)return c.error(TypeError("Cannot reduce an empty sequence"));c.next(g),c.complete()}})})},b.concat=function(){for(var a=this,b=arguments.length,c=Array(b),d=0;d<b;d++)c[d]=arguments[d];var e=cS(this);return new e(function(b){var d,f=0;return!function a(g){d=g.subscribe({next:function(a){b.next(a)},error:function(a){b.error(a)},complete:function(){f===c.length?(d=void 0,b.complete()):a(e.from(c[f++]))}})}(a),function(){d&&(d.unsubscribe(),d=void 0)}})},b.flatMap=function(a){var b=this;if("function"!=typeof a)throw TypeError(a+" is not a function");var c=cS(this);return new c(function(d){var e=[],f=b.subscribe({next:function(b){if(a)try{b=a(b)}catch(a){return d.error(a)}var f=c.from(b).subscribe({next:function(a){d.next(a)},error:function(a){d.error(a)},complete:function(){var a=e.indexOf(f);a>=0&&e.splice(a,1),g()}});e.push(f)},error:function(a){d.error(a)},complete:function(){g()}});function g(){f.closed&&0===e.length&&d.complete()}return function(){e.forEach(function(a){return a.unsubscribe()}),f.unsubscribe()}})},b[cP]=function(){return this},a.from=function(b){var c="function"==typeof this?this:a;if(null==b)throw TypeError(b+" is not an object");var d=cR(b,cP);if(d){var e=d.call(b);if(Object(e)!==e)throw TypeError(e+" is not an object");return e instanceof c_&&e.constructor===c?e:new c(function(a){return e.subscribe(a)})}if(cM("iterator")&&(d=cR(b,cO)))return new c(function(a){cU(function(){if(!a.closed){for(var c,e=function(a,b){var c="u">typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(c)return(c=c.call(a)).next.bind(c);if(Array.isArray(a)||(c=function(a,b){if(a){if("string"==typeof a)return cI(a,void 0);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c)return Array.from(a);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return cI(a,void 0)}}(a))){c&&(a=c);var d=0;return function(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(d.call(b));!(c=e()).done;){var f=c.value;if(a.next(f),a.closed)return}a.complete()}})});if(Array.isArray(b))return new c(function(a){cU(function(){if(!a.closed){for(var c=0;c<b.length;++c)if(a.next(b[c]),a.closed)return;a.complete()}})});throw TypeError(b+" is not observable")},a.of=function(){for(var b=arguments.length,c=Array(b),d=0;d<b;d++)c[d]=arguments[d];return new("function"==typeof this?this:a)(function(a){cU(function(){if(!a.closed){for(var b=0;b<c.length;++b)if(a.next(c[b]),a.closed)return;a.complete()}})})},cK(a,null,[{key:cQ,get:function(){return this}}]),a}();function c0(a,b){return new c_(function(c){a.subscribe({next:function(a){b(a).then(function(a){return c.next(a)}).catch(function(a){return c.error(a)})},error:function(a){c.error(a)},complete:function(){c.complete()}})})}function c1(a,b){return new c_(function(c){var d=!1,e=new Set,f=function(){var a,b;d=!0;try{for(var c=(0,ah.__values)(e),f=c.next();!f.done;f=c.next()){var g=f.value;try{g.unsubscribe()}catch(a){}}}catch(b){a={error:b}}finally{try{f&&!f.done&&(b=c.return)&&b.call(c)}finally{if(a)throw a.error}}e.clear()},g=function(a){var b=a.subscribe({next:function(a){d||c.next(a)},error:function(a){d||(d=!0,c.error(a),f())},complete:function(){e.delete(b),d||0!==e.size||(c.complete(),f(),d=!0)}});e.add(b)};return g(a),g(b),f})}function c2(a){var b=new Set,c=null;function d(){null==c||c.unsubscribe(),c=null,b.clear()}return new c_(function(e){return b.add(e),null===c&&(c=a.subscribe({next:function(a){try{for(var c,d,e,f=(0,ah.__values)(b),g=f.next();!g.done;g=f.next()){var h=g.value;null==(e=h.next)||e.call(h,a)}}catch(a){c={error:a}}finally{try{g&&!g.done&&(d=f.return)&&d.call(f)}finally{if(c)throw c.error}}},error:function(a){try{for(var c,e,f,g=(0,ah.__values)(b),h=g.next();!h.done;h=g.next()){var i=h.value;null==(f=i.error)||f.call(i,a)}}catch(a){c={error:a}}finally{try{h&&!h.done&&(e=g.return)&&e.call(g)}finally{if(c)throw c.error}}d()},complete:function(){try{for(var a,c,e,f=(0,ah.__values)(b),g=f.next();!g.done;g=f.next()){var h=g.value;null==(e=h.complete)||e.call(h)}}catch(b){a={error:b}}finally{try{g&&!g.done&&(c=f.return)&&c.call(f)}finally{if(a)throw a.error}}d()}})),function(){b.delete(e),0===b.size&&c&&(c.unsubscribe(),c=null)}})}cL()&&Object.defineProperty(c_,Symbol("extensions"),{value:{symbol:cP,hostReportError:cT},configurable:!0});var c3="1.18.3",c4="[Amplitude] Element Clicked",c5="[Amplitude] Element Tag",c6="[Amplitude] Element Text",c7="[Amplitude] Page URL",c8="https://app.amplitude.com",c9={US:c8,EU:"https://app.eu.amplitude.com",STAGING:"https://apps.stag2.amplitude.com"},da="data-amp-mask-attributes",db=function(a,b){return!b||!b.length||b.some(function(b){return"string"==typeof b?a===b:a.match(b)})},dc=function(a,b){var c=a;try{c=decodeURI(a)}catch(a){null==b||b.error("Malformed URI sequence: ",a)}return c},dd=["input","select","textarea"],de=function(a,b){var c,d=null==(c=null==window?void 0:window.getComputedStyle)?void 0:c.call(window,a);return(null==d?void 0:d.getPropertyValue("cursor"))==="pointer"&&"click"===b},df=function(a,b,c){return void 0===c&&(c=!1),function(d,e){var f,g,h=a.pageUrlAllowlist,i=a.pageUrlExcludelist,j=a.shouldTrackEventResolver,k=null==(g=null==(f=null==e?void 0:e.tagName)?void 0:f.toLowerCase)?void 0:g.call(f);if(!k)return!1;if(j)return j(d,e);if(!db(window.location.href,h)||i&&i.length>0&&db(window.location.href,i))return!1;var l=String(null==e?void 0:e.getAttribute("type"))||"";if("string"==typeof l)switch(l.toLowerCase()){case"hidden":case"password":return!1}var m=de(e,d);if(c&&m)return!0;if(b&&!b.some(function(a){var b;return!!(null==(b=null==e?void 0:e.matches)?void 0:b.call(e,a))}))return!1;switch(k){case"input":case"select":case"textarea":return"change"===d||"click"===d;default:if(m)return!0;return"click"===d}}},dg=function(a){var b,c,d,e=null==(c=null==(b=null==a?void 0:a.tagName)?void 0:b.toLowerCase)?void 0:c.call(b),f=a instanceof HTMLElement&&(null==(d=a.getAttribute("contenteditable"))?void 0:d.toLowerCase())==="true";return!dd.includes(e)&&!f},dh=function(a){return Object.keys(a).reduce(function(b,c){var d=a[c];return null!=d&&("object"!=typeof d||0!==Object.keys(d).length)&&("string"!=typeof d||0!==d.trim().length)&&(b[c]=d),b},{})},di=function(a,b){return a?b.some(function(b){var c;return null==(c=null==a?void 0:a.matches)?void 0:c.call(a,b)})?a:di(null==a?void 0:a.parentElement,b):null},dj=function(a){return null!==a.event.target&&!!a.closestTrackedAncestor},dk=new Set(["id","class","style","value","onclick","onchange","oninput","onblur","onsubmit","onfocus","onkeydown","onkeyup","onkeypress","data-reactid","data-react-checksum","data-reactroot",da,ck]),dl=["type"],dm=["svg","path","g"],dn=["password","hidden"],dp=function(a,b){try{if("DOM_ELEMENT"===a.sourceType){var c=document.documentElement;if(a.scope&&b&&(c=b.closest(a.scope)),c&&a.selector)return c.querySelector(a.selector);return c}}catch(a){}},dq=function(a,b,c){a.forEach(function(a){if("string"!=typeof a&&"ATTACH_EVENT_PROPERTY"===a.actionType){var d=c.extractDataFromDataSource(a.dataSource,b.closestTrackedAncestor);b.targetElementProperties[a.destinationKey]=d}})},dr=function(a,b){var c,d,e,f=this;this.replaceSensitiveString=function(a){return cp(a,f.additionalMaskTextPatterns)},this.getHierarchy=function(a){var b,c,d,e,g=performance.now(),h=[];if(!a)return[];for(var i=function(a){var b=[];if(!a)return b;b.push(a);for(var c=a.parentElement;c&&"HTML"!==c.tagName;)b.push(c),c=c.parentElement;return b}(a),j=new Map,k=i.length-1;k>=0;k--){var l=i[k];if(l){var m,n=(m=l.getAttribute(da))?m.split(",").map(function(a){return a.trim()}).filter(function(a){return a.length>0&&"id"!==a&&"class"!==a}):[],o=k===i.length-1?[]:null!=(d=j.get(i[k+1]))?d:new Set,p=new Set((0,ah.__spreadArray)((0,ah.__spreadArray)([],(0,ah.__read)(o),!1),(0,ah.__read)(n),!1));j.set(l,p)}}h=i.map(function(a){var b;return function(a,b){if(null===a)return null;var c,d,e,f,g,h,i=String(a.tagName).toLowerCase(),j={tag:i},k=Array.from(null!=(f=null==(e=a.parentElement)?void 0:e.children)?f:[]);k.length&&(j.index=k.indexOf(a),j.indexOfType=k.filter(function(b){return b.tagName===a.tagName}).indexOf(a));var l=null==(h=null==(g=a.previousElementSibling)?void 0:g.tagName)?void 0:h.toLowerCase();l&&(j.prevSib=String(l));var m=a.getAttribute("id");m&&(j.id=String(m));var n=Array.from(a.classList);n.length&&(j.classes=n);var o={},p=Array.from(a.attributes).filter(function(a){return!dk.has(a.name)}),q=!dg(a);if(!dn.includes(String(a.getAttribute("type")))&&!dm.includes(i))try{for(var r=(0,ah.__values)(p),s=r.next();!s.done;s=r.next()){var t=s.value;if(!q||dl.includes(t.name)){if(b.has(t.name)){o[t.name]=cl;continue}o[t.name]=String(t.value).substring(0,128)}}}catch(a){c={error:a}}finally{try{s&&!s.done&&(d=r.return)&&d.call(r)}finally{if(c)throw c.error}}return Object.keys(o).length&&(j.attrs=o),j}(a,null!=(b=j.get(a))?b:new Set)});var q=function(a){(null==a?void 0:a.attrs)&&Object.entries(a.attrs).forEach(function(b){var c=(0,ah.__read)(b,2),d=c[0],e=c[1];a.attrs&&(a.attrs[d]=f.replaceSensitiveString(e))})};try{for(var r=(0,ah.__values)(h),s=r.next();!s.done;s=r.next()){var t=s.value;q(t)}}catch(a){b={error:a}}finally{try{s&&!s.done&&(c=r.return)&&c.call(r)}finally{if(b)throw b.error}}var u=performance.now();return null==(e=f.diagnosticsClient)||e.recordHistogram("autocapturePlugin.getHierarchy",u-g),h},this.getNearestLabel=function(a){var b,c=a.parentElement;if(!c)return"";try{b=c.querySelector(":scope>span,h1,h2,h3,h4,h5,h6")}catch(a){b=null}return b?f.getText(b):f.getNearestLabel(c)},this.getEventProperties=function(a,b,c){var d,e,g,h,i=null==(g=null==(e=null==b?void 0:b.tagName)?void 0:e.toLowerCase)?void 0:g.call(e),j="function"==typeof b.getBoundingClientRect?b.getBoundingClientRect():{left:null,top:null},k=f.getHierarchy(b),l=null==(h=k[0])?void 0:h.attrs,m=f.getNearestLabel(b),n=Object.entries(null!=l?l:{}).reduce(function(a,b){var d=(0,ah.__read)(b,2),e=d[0],f=d[1];if(e.startsWith(c)){var g=e.replace(c,"");g&&(a[g]=f||"")}return a},{}),o=((d={})["[Amplitude] Element Hierarchy"]=k,d[c5]=i,d[c6]=f.getText(b),d["[Amplitude] Element Position Left"]=null==j.left?null:Math.round(j.left),d["[Amplitude] Element Position Top"]=null==j.top?null:Math.round(j.top),d["[Amplitude] Element Attributes"]=n,d["[Amplitude] Element Parent Label"]=m,d[c7]=dc(window.location.href.split("?")[0]),d["[Amplitude] Page Title"]=cq(f.replaceSensitiveString),d["[Amplitude] Viewport Height"]=window.innerHeight,d["[Amplitude] Viewport Width"]=window.innerWidth,d);if(o["[Amplitude] Element ID"]=b.getAttribute("id")||"",o["[Amplitude] Element Class"]=b.getAttribute("class"),o["[Amplitude] Element Aria Label"]=null==l?void 0:l["aria-label"],"a"===i&&"click"===a&&b instanceof HTMLAnchorElement){var p=b.href.substring(0,128);o["[Amplitude] Element Href"]=f.replaceSensitiveString(p)}return dh(o)},this.addAdditionalEventProperties=function(a,b,c,d,e){void 0===e&&(e=!1);var g={event:a,timestamp:Date.now(),type:b};if(("click"===g.type||"change"===g.type)&&null!==g.event.target){if(e&&de(g.event.target,g.type))return g.closestTrackedAncestor=g.event.target,g.targetElementProperties=f.getEventProperties(g.type,g.closestTrackedAncestor,d),g;var h=di(g.event.target,c);h&&(g.closestTrackedAncestor=h,g.targetElementProperties=f.getEventProperties(g.type,h,d))}return g},this.extractDataFromDataSource=function(a,b){if("DOM_ELEMENT"===a.sourceType){var c=dp(a,b);if(c){if("TEXT"===a.elementExtractType)return f.getText(c);if("ATTRIBUTE"===a.elementExtractType&&a.attribute)return c.getAttribute(a.attribute)}}},this.getText=function(a){if(null!==a.closest("[".concat(ck,"]")))return cl;var b="";if(a.querySelector("[".concat(ck,"], [contenteditable]"))){var c=a.cloneNode(!0);c.querySelectorAll("[".concat(ck,"], [contenteditable]")).forEach(function(a){a.innerText=cl}),b=c.innerText||""}else b=a.innerText||"";return f.replaceSensitiveString(b.substring(0,255)).replace(/\s+/g," ").trim()},this.getEventTagProps=function(a){if(!a)return{};var b,c,d,e=null==(d=null==(c=null==a?void 0:a.tagName)?void 0:c.toLowerCase)?void 0:d.call(c);return dh(((b={})[c5]=e,b[c6]=f.getText(a),b[c7]=window.location.href.split("?")[0],b))},this.diagnosticsClient=null==b?void 0:b.diagnosticsClient;var g=null!=(e=a.maskTextRegex)?e:[],h=[];try{for(var i=(0,ah.__values)(g),j=i.next();!j.done;j=i.next()){var k=j.value;if(h.length>=25)break;if(k instanceof RegExp)h.push(k);else if("pattern"in k&&"string"==typeof k.pattern)try{h.push(RegExp(k.pattern,"i"))}catch(a){}}}catch(a){c={error:a}}finally{try{j&&!j.done&&(d=i.return)&&d.call(i)}finally{if(c)throw c.error}}this.additionalMaskTextPatterns=h},ds=function(){function a(a){var b=(void 0===a?{}:a).origin,c=this;this.endpoint=c8,this.requestCallbacks={},this.onSelect=function(a){c.notify({action:"element-selected",data:a})},this.onTrack=function(a,b){"selector-mode-changed"===a?c.notify({action:"track-selector-mode-changed",data:b}):"selector-moved"===a&&c.notify({action:"track-selector-moved",data:b})},this.endpoint=void 0===b?c8:b}return a.prototype.notify=function(a){var b,c,d,e;null==(c=null==(b=this.logger)?void 0:b.debug)||c.call(b,"Message sent: ",JSON.stringify(a)),null==(e=null==(d=window.opener)?void 0:d.postMessage)||e.call(d,a,this.endpoint)},a.prototype.sendRequest=function(a,b,c){var d=this;void 0===c&&(c={timeout:15e3});var e="".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),f={id:e,action:a,args:b};return new Promise(function(b,g){d.requestCallbacks[e]={resolve:b,reject:g},d.notify(f),(null==c?void 0:c.timeout)>0&&setTimeout(function(){g(Error("".concat(a," timed out (id: ").concat(e,")"))),delete d.requestCallbacks[e]},c.timeout)})},a.prototype.handleResponse=function(a){var b;if(!this.requestCallbacks[a.id]){null==(b=this.logger)||b.warn("No callback found for request id: ".concat(a.id));return}this.requestCallbacks[a.id].resolve(a.responseData),delete this.requestCallbacks[a.id]},a.prototype.setup=function(a){var b=this,c=void 0===a?{dataExtractor:new dr({})}:a,d=c.logger,e=c.endpoint,f=c.isElementSelectable,g=c.cssSelectorAllowlist,h=c.actionClickAllowlist,i=c.dataExtractor;this.logger=d,e&&this.endpoint===c8&&(this.endpoint=e);var j=null;window.addEventListener("message",function(a){if(null==(d=null==(c=b.logger)?void 0:c.debug)||d.call(c,"Message received: ",JSON.stringify(a)),b.endpoint===a.origin){var c,d,e,k,l,m=null==a?void 0:a.data,n=null==m?void 0:m.action;if(n)if("id"in m)null==(k=null==(e=b.logger)?void 0:e.debug)||k.call(e,"Received Response to previous request: ",JSON.stringify(a)),b.handleResponse(m);else if("ping"===n)b.notify({action:"pong"});else if("initialize-visual-tagging-selector"===n){var o,p=null==m?void 0:m.data;(o="https://cdn.amplitude.com/libs/visual-tagging-selector-1.0.0-alpha.js.gz",new Promise(function(a,b){var c;try{var d=document.createElement("script");d.type="text/javascript",d.async=!0,d.src=o,d.addEventListener("load",function(){a({status:!0})},{once:!0}),d.addEventListener("error",function(){b({status:!1,message:"Failed to load the script ".concat(o)})}),null==(c=document.head)||c.appendChild(d)}catch(a){b(a)}})).then(function(){var a;j=null==(a=null==window?void 0:window.amplitudeVisualTaggingSelector)?void 0:a.call(window,{getEventTagProps:i.getEventTagProps,isElementSelectable:function(a){return!f||f((null==p?void 0:p.actionType)||"click",a)},onTrack:b.onTrack,onSelect:b.onSelect,visualHighlightClass:"amp-visual-tagging-selector-highlight",messenger:b,cssSelectorAllowlist:g,actionClickAllowlist:h,extractDataFromDataSource:i.extractDataFromDataSource,dataExtractor:i,diagnostics:{autocapture:{version:c3}}}),b.notify({action:"selector-loaded"})}).catch(function(){var a;null==(a=b.logger)||a.warn("Failed to initialize visual tagging selector")})}else"close-visual-tagging-selector"===n&&(null==(l=null==j?void 0:j.close)||l.call(j))}}),this.notify({action:"page-loaded"})},a}(),dt=function(){return new c_(function(a){var b=new MutationObserver(function(b){a.next(b)});return document.body&&b.observe(document.body,{childList:!0,attributes:!0,characterData:!0,subtree:!0}),function(){return b.disconnect()}})},du=function(a){return void 0===a&&(a="click"),new c_(function(b){var c,d=function(a){b.next(a)};return null==(c=aJ())||c.document.addEventListener(a,d,{capture:!0}),function(){var b;null==(b=aJ())||b.document.removeEventListener(a,d,{capture:!0})}})},dv=function(a,b){try{if("[Amplitude] Element Text"===b.subprop_key)return"is"===b.subprop_op&&b.subprop_value.includes(a.targetElementProperties["[Amplitude] Element Text"]);if("[Amplitude] Element Hierarchy"===b.subprop_key)return"autotrack css match"===b.subprop_op&&!!a.closestTrackedAncestor.closest(b.subprop_value.toString())}catch(a){console.error("Error matching event to filter",a)}return!1},dw={"[Amplitude] Element Clicked":"click","[Amplitude] Element Changed":"change"},dx=function(a){var b,c,d,e,f=Object.values(dw).reduce(function(a,b){return a[b]=new Set,a},{});if(!a)return f;try{for(var g=(0,ah.__values)(a),h=g.next();!h.done;h=g.next()){var i=h.value;try{try{for(var j=(d=void 0,(0,ah.__values)(i.definition)),k=j.next();!k.done;k=j.next()){var l=dw[k.value.event_type];l&&f[l].add(i.id)}}catch(a){d={error:a}}finally{try{k&&!k.done&&(e=j.return)&&e.call(j)}finally{if(d)throw d.error}}}catch(a){console.warn("Skipping Labeled Event due to malformed definition",null==i?void 0:i.id,a)}}}catch(a){b={error:a}}finally{try{h&&!h.done&&(c=g.return)&&c.call(g)}finally{if(b)throw b.error}}return f},dy=function(a){var b,c,d,e,f=new Map;try{for(var g=(0,ah.__values)(a),h=g.next();!h.done;h=g.next()){var i=h.value;try{for(var j=(d=void 0,(0,ah.__values)(i.conditions)),k=j.next();!k.done;k=j.next()){var l=k.value;if("LABELED_EVENT"===l.type){var m=l.match.eventId,n=f.get(m);n||(n=[],f.set(m,n)),n.push(i)}}}catch(a){d={error:a}}finally{try{k&&!k.done&&(e=j.return)&&e.call(j)}finally{if(d)throw d.error}}}}catch(a){b={error:a}}finally{try{h&&!h.done&&(c=g.return)&&c.call(g)}finally{if(b)throw b.error}}return f},dz=function(a,b){var c,d,e,f,g=new Set;try{for(var h=(0,ah.__values)(a),i=h.next();!i.done;i=h.next()){var j=i.value,k=b.get(j.id);if(k)try{for(var l=(e=void 0,(0,ah.__values)(k)),m=l.next();!m.done;m=l.next()){var n=m.value;g.add(n)}}catch(a){e={error:a}}finally{try{m&&!m.done&&(f=l.return)&&f.call(l)}finally{if(e)throw e.error}}}}catch(a){c={error:a}}finally{try{i&&!i.done&&(d=h.return)&&d.call(h)}finally{if(c)throw c.error}}return Array.from(g)},dA=function(){function a(a,b,c,d){this.groupedLabeledEvents=a,this.labeledEventToTriggerMap=b,this.dataExtractor=c,this.options=d}return a.prototype.evaluate=function(a){var b,c,d=this.options.pageActions;if(!d)return a;var e=dz(Array.from(this.groupedLabeledEvents[a.type]).map(function(a){return d.labeledEvents[a]}).filter(function(b){return b.definition.some(function(b){return dw[b.event_type]===a.type&&b.filters.every(function(b){return dv(a,b)})})}),this.labeledEventToTriggerMap);try{for(var f=(0,ah.__values)(e),g=f.next();!g.done;g=f.next()){var h=g.value;dq(h.actions,a,this.dataExtractor)}}catch(a){b={error:a}}finally{try{g&&!g.done&&(c=f.return)&&c.call(f)}finally{if(b)throw b.error}}return a},a.prototype.update=function(a,b,c){this.groupedLabeledEvents=a,this.labeledEventToTriggerMap=b,this.options=c},a}();(m=Q||(Q={})).ClickObservable="clickObservable",m.ChangeObservable="changeObservable",m.NavigateObservable="navigateObservable",m.MutationObservable="mutationObservable";var dB=function(a,b){void 0===a&&(a={}),null==b||b.diagnosticsClient.setTag("plugin.autocapture.version",c3);var c,d,e,f,g,h,i,j,k=a.dataAttributePrefix,l=void 0===k?cG:k,m=a.visualTaggingOptions,n=void 0===m?{enabled:!0,messenger:new ds}:m;a.cssSelectorAllowlist=null!=(c=a.cssSelectorAllowlist)?c:cF,a.actionClickAllowlist=null!=(d=a.actionClickAllowlist)?d:cH,a.debounceTime=null!=(e=a.debounceTime)?e:0,a.pageUrlExcludelist=null==(f=a.pageUrlExcludelist)?void 0:f.reduce(function(a,b){if("string"==typeof b&&a.push(b),b instanceof RegExp&&a.push(b),"object"==typeof b&&null!==b&&"pattern"in b)try{a.push(new RegExp(b.pattern))}catch(a){console.warn("Invalid regex pattern: ".concat(b.pattern),a)}return a},[]);var o="@amplitude/plugin-autocapture-browser",p=[],q=new dr(a,b),r=function(){var b,c,d=c2(du().map(function(b){return q.addAdditionalEventProperties(b,"click",a.cssSelectorAllowlist,l)})),e=c2(new c_(function(b){var c,d=function(c){var d=q.addAdditionalEventProperties(c,"change",a.cssSelectorAllowlist,l);b.next(d)};return null==(c=aJ())||c.document.addEventListener("change",d,{capture:!0}),function(){var a;return null==(a=aJ())?void 0:a.document.removeEventListener("change",d)}}));window.navigation&&(c=c2(new c_(function(b){var c=function(c){var d=q.addAdditionalEventProperties(c,"navigate",a.cssSelectorAllowlist,l);b.next(d)};return window.navigation.addEventListener("navigate",c),function(){window.navigation.removeEventListener("navigate",c)}})));var f=c2(dt().map(function(b){return q.addAdditionalEventProperties(b,"mutation",a.cssSelectorAllowlist,l)}));return(b={})[Q.ChangeObservable]=e,b[Q.ClickObservable]=d,b[Q.MutationObservable]=f,b[Q.NavigateObservable]=c,b},s=dx(Object.values(null!=(h=null==(g=a.pageActions)?void 0:g.labeledEvents)?h:{})),t=dy(null!=(j=null==(i=a.pageActions)?void 0:i.triggers)?j:[]),u=new dA(s,t,q,a),v=function(b){var c,d;b&&(a.pageActions=(0,ah.__assign)((0,ah.__assign)({},a.pageActions),b),s=dx(Object.values(null!=(c=a.pageActions.labeledEvents)?c:{})),t=dy(null!=(d=a.pageActions.triggers)?d:[]),u.update(s,t,a))};return{name:o,type:"enrichment",setup:function(b,c){return(0,ah.__awaiter)(void 0,void 0,void 0,function(){var d,e,f,g,h,i,j,k,m,s;return(0,ah.__generator)(this,function(t){var w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V;return"u"<typeof document?[2]:(b.fetchRemoteConfig&&(b.remoteConfigClient?b.remoteConfigClient.subscribe("analyticsSDK.pageActions","all",function(a){v(a)}):b.loggerProvider.debug("Remote config client is not provided, skipping remote config fetch")),d=df(a,a.cssSelectorAllowlist),e=df(a,a.actionClickAllowlist),x=(w={allObservables:f=r(),amplitude:c,shouldTrackEvent:d,evaluateTriggers:u.evaluate.bind(u)}).amplitude,y=w.allObservables,z=w.shouldTrackEvent,A=w.evaluateTriggers,g=y.clickObservable.filter(dj).filter(function(a){return z("click",a.closestTrackedAncestor)}).map(function(a){return A(a)}).subscribe(function(a){null==x||x.track(c4,a.targetElementProperties)}),p.push(g),C=(B={allObservables:f,getEventProperties:function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];return q.getEventProperties.apply(q,(0,ah.__spreadArray)((0,ah.__spreadArray)([],(0,ah.__read)(a),!1),[l],!1))},amplitude:c,shouldTrackEvent:d,evaluateTriggers:u.evaluate.bind(u)}).amplitude,D=B.allObservables,E=B.getEventProperties,F=B.shouldTrackEvent,G=B.evaluateTriggers,h=D.changeObservable.filter(dj).filter(function(a){return F("change",a.closestTrackedAncestor)}).map(function(a){return G(a)}).subscribe(function(a){null==C||C.track("[Amplitude] Element Changed",E("change",a.closestTrackedAncestor))}),p.push(h),I=(H={allObservables:f,options:a,getEventProperties:function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];return q.getEventProperties.apply(q,(0,ah.__spreadArray)((0,ah.__spreadArray)([],(0,ah.__read)(a),!1),[l],!1))},amplitude:c,shouldTrackEvent:d,shouldTrackActionClick:e}).amplitude,J=H.allObservables,K=H.options,L=H.getEventProperties,M=H.shouldTrackEvent,N=H.shouldTrackActionClick,O=J.clickObservable,P=J.mutationObservable,Q=J.navigateObservable,R=O.filter(function(a){return!M("click",a.closestTrackedAncestor)}).map(function(a){var b=di(a.event.target,K.actionClickAllowlist);return a.closestTrackedAncestor=b,null!==a.closestTrackedAncestor&&(a.targetElementProperties=L(a.type,a.closestTrackedAncestor)),a}).filter(dj).filter(function(a){return N("click",a.closestTrackedAncestor)}),S=Q?c1(P,Q):P,T=c1(R,S),U=null,V=null,(i=c0(T,function(a){if(U&&(clearTimeout(U),U=null),"click"===a.type)V=a,U=setTimeout(function(){U=null,V=null},500);else if(V){var b=V;return V=null,Promise.resolve(b)}return Promise.resolve(null)}).subscribe(function(a){a&&(null==I||I.track(c4,L("click",a.closestTrackedAncestor)))}))&&p.push(i),null==(m=null==b?void 0:b.loggerProvider)||m.log("".concat(o," has been successfully added.")),window.opener&&n.enabled&&(j=a.cssSelectorAllowlist,k=a.actionClickAllowlist,null==(s=n.messenger)||s.setup((0,ah.__assign)((0,ah.__assign)({dataExtractor:q,logger:null==b?void 0:b.loggerProvider},(null==b?void 0:b.serverZone)&&{endpoint:c9[b.serverZone]}),{isElementSelectable:df(a,(0,ah.__spreadArray)((0,ah.__spreadArray)([],(0,ah.__read)(j),!1),(0,ah.__read)(k),!1)),cssSelectorAllowlist:j,actionClickAllowlist:k}))),[2])})})},execute:function(a){return(0,ah.__awaiter)(void 0,void 0,void 0,function(){return(0,ah.__generator)(this,function(b){return[2,a]})})},teardown:function(){return(0,ah.__awaiter)(void 0,void 0,void 0,function(){var a,b,c,d;return(0,ah.__generator)(this,function(e){try{for(b=(a=(0,ah.__values)(p)).next();!b.done;b=a.next())b.value.unsubscribe()}catch(a){c={error:a}}finally{try{b&&!b.done&&(d=a.return)&&d.call(a)}finally{if(c)throw c.error}}return[2]})})}}},dC=(0,ah.__spreadArray)(['input[type="button"]','input[type="submit"]','input[type="reset"]','input[type="image"]','input[type="file"]'],(0,ah.__read)(["a","button",'[role="button"]','[role="link"]','[role="menuitem"]','[role="menuitemcheckbox"]','[role="menuitemradio"]','[role="option"]','[role="tab"]','[role="treeitem"]','[contenteditable="true" i]']),!1),dD=["*"],dE=["mutation","navigate"];function dF(a,b){var c,d,e,f,g=b.event,h=g.clientX,i=g.clientY;a.yMin=Math.min(null!=(c=a.yMin)?c:i,i),a.yMax=Math.max(null!=(d=a.yMax)?d:i,i),a.xMin=Math.min(null!=(e=a.xMin)?e:h,h),a.xMax=Math.max(null!=(f=a.xMax)?f:h,h),a.isOutOfBounds=a.yMax-a.yMin>50||a.xMax-a.xMin>50}function dG(a){if(0===a.length)return null;var b=a[0],c=a[a.length-1];return{rageClickEvent:(0,ah.__assign)({"[Amplitude] Begin Time":new Date(b.timestamp).toISOString(),"[Amplitude] End Time":new Date(c.timestamp).toISOString(),"[Amplitude] Duration":c.timestamp-b.timestamp,"[Amplitude] Clicks":a.map(function(a){return{X:a.event.clientX,Y:a.event.clientY,Time:a.timestamp}}),"[Amplitude] Click Count":a.length},b.targetElementProperties),time:b.timestamp}}var dH=function(a){void 0===a&&(a={});var b,c,d,e,f,g="@amplitude/plugin-frustration-browser",h=[],i=null!=(c=null==(b=a.rageClicks)?void 0:b.cssSelectorAllowlist)?c:dD,j=null!=(e=null==(d=a.deadClicks)?void 0:d.cssSelectorAllowlist)?e:dC,k=null!=(f=a.dataAttributePrefix)?f:cG,l=new dr(a),m=(0,ah.__spreadArray)([],(0,ah.__read)(new Set((0,ah.__spreadArray)((0,ah.__spreadArray)([],(0,ah.__read)(i),!1),(0,ah.__read)(j),!1))),!1),n=function(){var a,b,c=c2(du("pointerdown").map(function(a){return l.addAdditionalEventProperties(a,"click",m,k,!0)})),d=c2(dt().map(function(a){return l.addAdditionalEventProperties(a,"mutation",m,k)}));return window.navigation&&(b=c2(new c_(function(a){var b=function(b){a.next((0,ah.__assign)((0,ah.__assign)({},b),{type:"navigate"}))};return window.navigation.addEventListener("navigate",b),function(){window.navigation.removeEventListener("navigate",b)}}).map(function(a){return l.addAdditionalEventProperties(a,"navigate",m,k)}))),(a={})[Q.ClickObservable]=c,a[Q.MutationObservable]=d,a[Q.NavigateObservable]=b,a};return{name:g,type:"enrichment",setup:function(b,c){return(0,ah.__awaiter)(void 0,void 0,void 0,function(){var d,e,f,m,o,p;return(0,ah.__generator)(this,function(q){var r,s,t,u,v,w,x,y,z,A,B,C;return"u"<typeof document?[2]:(d=df(a,i),e=df(a,j),m=function(a){var b=this,c=a.amplitude,d=a.allObservables,e=a.shouldTrackRageClick,f=d.clickObservable,g=[],h={},i=null;return c0(f.filter(function(a){return e("click",a.closestTrackedAncestor)}),function(a){return(0,ah.__awaiter)(b,void 0,void 0,function(){var b;return(0,ah.__generator)(this,function(c){var d,e,f,j;return(dF(h,a),b=null,0===g.length||(d=g).length>0&&d[d.length-1].closestTrackedAncestor!==a.closestTrackedAncestor||(f=Math.max(0,(e=g).length-4+1),j=e[f],a.timestamp-j.timestamp>=1e3)||h.isOutOfBounds)?(i&&(b=dG(g)),g=[],h={},a&&(dF(h,a),g.push(a))):g.push(a),(i&&(clearTimeout(i.timerId),i.resolve(b),i=null),g.length>=4)?[2,new Promise(function(a){i={resolve:a,timerId:setTimeout(function(){a(dG(g))},1e3)}})]:[2,null]})})}).subscribe(function(a){null!==a&&c.track("[Amplitude] Rage Click",a.rageClickEvent,{time:a.time})})}({allObservables:f=n(),amplitude:c,shouldTrackRageClick:d}),h.push(m),s=(r={amplitude:c,allObservables:f,getEventProperties:function(a,b){return l.getEventProperties(a,b,k)},shouldTrackDeadClick:e}).amplitude,t=r.allObservables,u=r.getEventProperties,v=r.shouldTrackDeadClick,w=t.clickObservable,x=t.mutationObservable,y=t.navigateObservable,z=w.filter(function(a){return dj(a)&&v("click",a.closestTrackedAncestor)&&a.event.target instanceof Element&&null===a.event.target.closest('a[target="_blank"]')}),A=y?c1(x,y):x,B=c1(z,A),C=null,o=c0(B,function(a){if(C&&dE.includes(a.type))clearTimeout(C),C=null;else if("click"===a.type)return C?Promise.resolve(null):new Promise(function(b){C=setTimeout(function(){b(a),C=null},3e3)});return Promise.resolve(null)}).subscribe(function(a){if(a){var b={"[Amplitude] X":a.event.clientX,"[Amplitude] Y":a.event.clientY};s.track("[Amplitude] Dead Click",(0,ah.__assign)((0,ah.__assign)({},u("click",a.closestTrackedAncestor)),b),{time:a.timestamp})}}),h.push(o),null==(p=null==b?void 0:b.loggerProvider)||p.log("".concat(g," has been successfully added.")),[2])})})},execute:function(a){return(0,ah.__awaiter)(void 0,void 0,void 0,function(){return(0,ah.__generator)(this,function(b){return[2,a]})})},teardown:function(){return(0,ah.__awaiter)(void 0,void 0,void 0,function(){var a,b,c,d;return(0,ah.__generator)(this,function(e){try{for(b=(a=(0,ah.__values)(h)).next();!b.done;b=a.next())b.value.unsubscribe()}catch(a){c={error:a}}finally{try{b&&!b.done&&(d=a.return)&&d.call(a)}finally{if(c)throw c.error}}return[2]})})}}};function dI(a,b,c){a&&function a(b){var c,d,e=b.json,f=b.targetObject,g=b.allowlist,h=b.excludelist,i=b.ancestors,j=b.parentObject,k=b.targetKey;f||(f=e);var l=Object.keys(f);try{for(var m=(0,ah.__values)(l),n=m.next();!n.done;n=m.next()){var o,p=n.value,q=(0,ah.__spreadArray)((0,ah.__spreadArray)([],(0,ah.__read)(i),!1),[p],!1);(o=f[p],"string"==typeof o||"number"==typeof o||"boolean"==typeof o||null==o)?(!dK(q,g)||dK(q,h))&&delete f[p]:a({json:e,targetObject:f[p],allowlist:g,excludelist:h,ancestors:q,parentObject:f,targetKey:p})}}catch(a){c={error:a}}finally{try{n&&!n.done&&(d=m.return)&&d.call(m)}finally{if(c)throw c.error}}0===Object.keys(f).length&&j&&k&&delete j[k]}({json:a,allowlist:b.map(dJ),excludelist:c.map(dJ),ancestors:[]})}function dJ(a){return a.startsWith("/")&&(a=a.slice(1)),a.split("/").map(function(a){return a.replace(/~0/g,"~").replace(/~1/g,"/")})}function dK(a,b){return b.some(function(b){return function a(b,c,d,e){if(void 0===d&&(d=0),void 0===e&&(e=0),e===c.length)return d===b.length;if(d===b.length){for(;e<c.length&&"**"===c[e];)e++;return e===c.length}var f=c[e];if("**"===f){if(e+1===c.length)return!0;for(var g=d;g<=b.length;g++)if(a(b,c,g,e+1))return!0;return!1}return("*"===f||f===b[d])&&a(b,c,d+1,e+1)}(a,b)})}var dL=function(){function a(a){this.request=a}return a.prototype.headers=function(a){void 0===a&&(a=[]);var b,c,d=this.request.headers,e={};if(Array.isArray(d))d.forEach(function(a){var b=(0,ah.__read)(a,2),c=b[0],d=b[1];e[c]=d});else if(d instanceof Headers)d.forEach(function(a,b){e[b]=a});else if("object"==typeof d&&null!==d)try{for(var f=(0,ah.__values)(Object.entries(d)),g=f.next();!g.done;g=f.next()){var h=(0,ah.__read)(g.value,2),i=h[0],j=h[1];e[i]=j}}catch(a){b={error:a}}finally{try{g&&!g.done&&(c=f.return)&&c.call(f)}finally{if(b)throw b.error}}return dS(e,{allow:a})},Object.defineProperty(a.prototype,"bodySize",{get:function(){if("number"==typeof this._bodySize)return this._bodySize;var a=aJ();if(null==a?void 0:a.TextEncoder){var b=this.request.body;return this._bodySize=dN(b,100),this._bodySize}},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"method",{get:function(){return this.request.method},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"body",{get:function(){return"string"==typeof this.request.body?this.request.body:null},enumerable:!1,configurable:!0}),a.prototype.json=function(a,b){return void 0===a&&(a=[]),void 0===b&&(b=[]),(0,ah.__awaiter)(this,void 0,void 0,function(){return(0,ah.__generator)(this,function(c){return 0===a.length?[2,null]:[2,dQ(this.body,a,b)]})})},a}(),dM=function(){function a(a,b){this.bodyRaw=a,this.requestHeaders=b}return a.prototype.headers=function(a){return void 0===a&&(a=[]),dS(this.requestHeaders,{allow:a})},Object.defineProperty(a.prototype,"bodySize",{get:function(){return dN(this.bodyRaw,100)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"body",{get:function(){return"string"==typeof this.bodyRaw?this.bodyRaw:null},enumerable:!1,configurable:!0}),a.prototype.json=function(a,b){return void 0===a&&(a=[]),void 0===b&&(b=[]),(0,ah.__awaiter)(this,void 0,void 0,function(){return(0,ah.__generator)(this,function(c){return 0===a.length?[2,null]:[2,dQ(this.body,a,b)]})})},a}();function dN(a,b){var c,d,e,f,g=aJ(),h=null==g?void 0:g.TextEncoder;if(h){if("string"==typeof a)f=a,e=new h().encode(f).length;else if(a instanceof Blob)e=(f=a).size;else if(a instanceof URLSearchParams)f=a,e=new h().encode(f.toString()).length;else if(ArrayBuffer.isView(a))e=(f=a).byteLength;else if(a instanceof ArrayBuffer)e=(f=a).byteLength;else if(a instanceof FormData){var i=0,j=0;try{for(var k=(0,ah.__values)(a.entries()),l=k.next();!l.done;l=k.next()){var m=(0,ah.__read)(l.value,2),n=m[0],o=m[1];if(i+=n.length,"string"==typeof o)i+=new h().encode(o).length;else{if(!(o instanceof Blob))return;i+=o.size}if(++j>=b)return}}catch(a){c={error:a}}finally{try{l&&!l.done&&(d=k.return)&&d.call(k)}finally{if(c)throw c.error}}e=i}else if(a instanceof ReadableStream){f=a;return}return e}}var dO=function(){function a(a){this.response=a}return a.prototype.headers=function(a){var b;if(void 0===a&&(a=[]),this.response.headers instanceof Headers){var c=this.response.headers,d={};return null==(b=null==c?void 0:c.forEach)||b.call(c,function(a,b){d[b]=a}),dS(d,{allow:a})}},Object.defineProperty(a.prototype,"bodySize",{get:function(){if(void 0!==this._bodySize)return this._bodySize;var a,b,c=null==(b=null==(a=this.response.headers)?void 0:a.get)?void 0:b.call(a,"content-length"),d=c?parseInt(c,10):void 0;return this._bodySize=d,d},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"status",{get:function(){return this.response.status},enumerable:!1,configurable:!0}),a.prototype.text=function(){return(0,ah.__awaiter)(this,void 0,void 0,function(){return(0,ah.__generator)(this,function(a){switch(a.label){case 0:this.clonedResponse||(this.clonedResponse=this.response.clone()),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,Promise.race([this.clonedResponse.text(),new Promise(function(a){return setTimeout(function(){return a(null)},500)})])];case 2:return[2,a.sent()];case 3:return a.sent(),[2,null];case 4:return[2]}})})},a.prototype.json=function(a,b){return void 0===a&&(a=[]),void 0===b&&(b=[]),(0,ah.__awaiter)(this,void 0,void 0,function(){return(0,ah.__generator)(this,function(c){switch(c.label){case 0:if(0===a.length)return[2,null];return[4,this.text()];case 1:return[2,dQ(c.sent(),a,b)]}})})},a}(),dP=function(){function a(a,b,c,d){this.statusCode=a,this.headersString=b,this.size=c,this.getJson=d}return Object.defineProperty(a.prototype,"bodySize",{get:function(){return this.size},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"status",{get:function(){return this.statusCode},enumerable:!1,configurable:!0}),a.prototype.headers=function(a){if(void 0===a&&(a=[]),!this.headersString)return{};var b,c,d={},e=this.headersString.split("\r\n");try{for(var f=(0,ah.__values)(e),g=f.next();!g.done;g=f.next()){var h=g.value,i=(0,ah.__read)(h.split(": "),2),j=i[0],k=i[1];j&&k&&(d[j]=k)}}catch(a){b={error:a}}finally{try{g&&!g.done&&(c=f.return)&&c.call(f)}finally{if(b)throw b.error}}return dS(d,{allow:a})},a.prototype.json=function(a,b){return void 0===a&&(a=[]),void 0===b&&(b=[]),(0,ah.__awaiter)(this,void 0,void 0,function(){var c;return(0,ah.__generator)(this,function(d){return 0===a.length?[2,null]:(c=this.getJson())?(dI(c,a,b),[2,c]):[2,null]})})},a}();function dQ(a,b,c){if(!a)return null;try{var d=JSON.parse(a);return dI(d,b,c),d}catch(a){return null}}(n=R||(R={})).REDACT="redact",n.REMOVE="remove";var dR="[REDACTED]",dS=function(a,b){var c,d,e=b.allow,f=void 0===e?[]:e,g=b.strategy,h=void 0===g?R.REMOVE:g,i=(0,ah.__spreadArray)([],(0,ah.__read)(aD),!1),j={};try{for(var k=(0,ah.__values)(Object.keys(a)),l=k.next();!l.done;l=k.next()){var m=l.value;!function(b){var c=b.toLowerCase();i.find(function(a){return a.toLowerCase()===c})?h===R.REDACT&&(j[b]=dR):f.find(function(a){return a.toLowerCase()===c})?j[b]=a[b]:h===R.REDACT&&(j[b]=dR)}(m)}}catch(a){c={error:a}}finally{try{l&&!l.done&&(d=k.return)&&d.call(k)}finally{if(c)throw c.error}}return j},dT=function(){function a(a,b,c,d,e,f,g,h,i,j,k){void 0===g&&(g=0),this.type=a,this.method=b,this.timestamp=c,this.startTime=d,this.url=e,this.requestWrapper=f,this.status=g,this.duration=h,this.responseWrapper=i,this.error=j,this.endTime=k}return a.prototype.toSerializable=function(){var a,b,c,d;return Object.fromEntries(Object.entries({type:this.type,method:this.method,url:this.url,timestamp:this.timestamp,status:this.status,duration:this.duration,error:this.error,startTime:this.startTime,endTime:this.endTime,requestHeaders:null==(a=this.requestWrapper)?void 0:a.headers((0,ah.__spreadArray)([],(0,ah.__read)(aC),!1)),requestBodySize:null==(b=this.requestWrapper)?void 0:b.bodySize,responseHeaders:null==(c=this.responseWrapper)?void 0:c.headers((0,ah.__spreadArray)([],(0,ah.__read)(aC),!1)),responseBodySize:null==(d=this.responseWrapper)?void 0:d.bodySize}).filter(function(a){var b=(0,ah.__read)(a,2);return void 0!==(b[0],b[1])}))},a}(),dU=function(a,b){void 0===b&&(b=aL()),this.callback=a,this.id=b},dV=new(function(){function a(b){this.eventCallbacks=new Map,this.isObserving=!1,this.logger=b;var c=aJ();a.isSupported()&&(this.globalScope=c)}return a.isSupported=function(){var a=aJ();return!!a&&!!a.fetch},a.prototype.subscribe=function(a,b){var c,d,e,f,g,h,i,j,k,l;if(this.logger||(this.logger=b),this.eventCallbacks.set(a.id,a),!this.isObserving){var m=null==(e=null==(d=null==(c=this.globalScope)?void 0:c.XMLHttpRequest)?void 0:d.prototype)?void 0:e.open,n=null==(h=null==(g=null==(f=this.globalScope)?void 0:f.XMLHttpRequest)?void 0:g.prototype)?void 0:h.send,o=null==(k=null==(j=null==(i=this.globalScope)?void 0:i.XMLHttpRequest)?void 0:j.prototype)?void 0:k.setRequestHeader;m&&n&&o&&this.observeXhr(m,n,o);var p=null==(l=this.globalScope)?void 0:l.fetch;p&&this.observeFetch(p),this.isObserving=!0}},a.prototype.unsubscribe=function(a){this.eventCallbacks.delete(a.id)},a.prototype.triggerEventCallbacks=function(a){var b=this;this.eventCallbacks.forEach(function(c){var d;try{c.callback(a)}catch(a){null==(d=b.logger)||d.debug("an unexpected error occurred while triggering event callbacks",a)}})},a.prototype.handleNetworkRequestEvent=function(a,b,c,d,e,f,g){if(void 0!==f&&void 0!==g){var h,i,j,k,l="GET";if("object"==typeof b&&null!==b&&"url"in b&&"method"in b?(i=b.url,l=b.method):i=null==(h=null==b?void 0:b.toString)?void 0:h.call(b),i)try{var m=new URL(i);i="".concat(m.protocol,"//").concat(m.host).concat(m.pathname).concat(m.search).concat(m.hash)}catch(a){}l=(null==c?void 0:c.method)||l,d&&(j=d.status),e&&(k={name:e.name||"UnknownError",message:e.message||"An unknown error occurred"},j=0);var n=Math.floor(performance.now()-g),o=Math.floor(f+n),p=new dT(a,l,f,f,i,c,j,n,d,k,o);this.triggerEventCallbacks(p)}},a.prototype.getTimestamps=function(){var a,b;return{startTime:null==(a=Date.now)?void 0:a.call(Date),durationStart:null==(b=null==performance?void 0:performance.now)?void 0:b.call(performance)}},a.prototype.observeFetch=function(a){var b=this;this.globalScope&&a&&(this.globalScope.fetch=function(c,d){return(0,ah.__awaiter)(b,void 0,void 0,function(){var b,e,f,g,h;return(0,ah.__generator)(this,function(i){switch(i.label){case 0:try{b=this.getTimestamps()}catch(a){null==(g=this.logger)||g.debug("an unexpected error occurred while retrieving timestamps",a)}i.label=1;case 1:return i.trys.push([1,3,,4]),[4,a(c,d)];case 2:return e=i.sent(),[3,4];case 3:return f=i.sent(),[3,4];case 4:try{this.handleNetworkRequestEvent("fetch",c,d?new dL(d):void 0,e?new dO(e):void 0,f,null==b?void 0:b.startTime,null==b?void 0:b.durationStart)}catch(a){null==(h=this.logger)||h.debug("an unexpected error occurred while handling fetch",a)}if(e)return[2,e];throw f}})})})},a.createXhrJsonParser=function(a,b){return function(){var c,d;try{if("json"===a.responseType){if(null==(c=b.globalScope)?void 0:c.structuredClone)return b.globalScope.structuredClone(a.response)}else if(["text",""].includes(a.responseType))return JSON.parse(a.responseText)}catch(c){c instanceof Error&&"InvalidStateError"===c.name&&(null==(d=b.logger)||d.error("unexpected error when retrieving responseText. responseType='".concat(a.responseType,"'")))}return null}},a.prototype.observeXhr=function(b,c,d){if(this.globalScope&&b&&c){var e=this.globalScope.XMLHttpRequest.prototype,f=this;e.open=function(){for(var a,c,d=[],e=0;e<arguments.length;e++)d[e]=arguments[e];var g=(0,ah.__read)(d,2),h=g[0],i=g[1];try{this.$$AmplitudeAnalyticsEvent=(0,ah.__assign)({method:h,url:null==(a=null==i?void 0:i.toString)?void 0:a.call(i),headers:{}},f.getTimestamps())}catch(a){null==(c=f.logger)||c.error("an unexpected error occurred while calling xhr open",a)}return b.apply(this,d)},e.send=function(){for(var b=[],d=0;d<arguments.length;d++)b[d]=arguments[d];var e=this,g=a.createXhrJsonParser(this,f),h=b[0],i=e.$$AmplitudeAnalyticsEvent;return e.addEventListener("loadend",function(){var a;try{var b=e.getAllResponseHeaders(),c=e.getResponseHeader("content-length"),d=new dP(e.status,b,c?parseInt(c,10):void 0,g),j=e.$$AmplitudeAnalyticsEvent.headers,k=new dM(h,j);i.status=e.status,f.handleNetworkRequestEvent("xhr",{url:i.url,method:i.method},k,d,void 0,i.startTime,i.durationStart)}catch(b){null==(a=f.logger)||a.error("an unexpected error occurred while handling xhr send",b)}}),c.apply(e,b)},e.setRequestHeader=function(a,b){var c;try{this.$$AmplitudeAnalyticsEvent.headers[a]=b}catch(a){null==(c=f.logger)||c.error("an unexpected error occurred while calling xhr setRequestHeader",a)}d.apply(this,[a,b])}}},a}()),dW="[Amplitude] Network Request",dX="500-599";function dY(a,b){return RegExp("^"+b.replace(/[-[\]{}()+?.,\\^$|#\s]/g,"\\$&").replace(/\*/g,".*")+"$").test(a)}function dZ(a,b){var c,d,e=b.split(",");try{for(var f=(0,ah.__values)(e),g=f.next();!g.done;g=f.next()){var h=g.value,i=(0,ah.__read)(h.split("-").map(Number),2),j=i[0],k=i[1];if(a===j&&void 0===k||a>=j&&a<=k)return!0}}catch(a){c={error:a}}finally{try{g&&!g.done&&(d=f.return)&&d.call(f)}finally{if(c)throw c.error}}return!1}function d$(a){var b;if(a)try{var c=null==(b=aJ())?void 0:b.location.href,d=new URL(a,c),e=d.searchParams.toString(),f=d.hash.replace("#",""),g=d.href,h=d.host;d.hash="",d.search="";var i=d.href;return{query:e,fragment:f,href:g,hrefWithoutQueryOrHash:i,host:h}}catch(a){return}}function d_(a){return"object"!=typeof a||null===a?a?(0,ah.__spreadArray)([],(0,ah.__read)(aC),!1):void 0:0!==a.length?a:void 0}function d0(a){var b,c;return!(null==(b=null==a?void 0:a.allowlist)?void 0:b.length)&&!(null==(c=null==a?void 0:a.blocklist)?void 0:c.length)}(S||(S={})).NetworkObservable="networkObservable";var d1=function(a){void 0===a&&(a={});var b,c="@amplitude/plugin-network-capture-browser",d=function(){var a,c=new c_(function(a){var c=new dU(function(b){var c={event:b,timestamp:Date.now(),type:"network"};a.next(c)});return dV.subscribe(c,b),function(){dV.unsubscribe(c)}});return(a={})[S.NetworkObservable]=c,a};return{name:c,type:"enrichment",setup:function(e,f){return(0,ah.__awaiter)(void 0,void 0,void 0,function(){var g;return(0,ah.__generator)(this,function(h){var i,j,k,l,m;return"u"<typeof document?[2]:(g=d(),b=null==e?void 0:e.loggerProvider,j=(i={allObservables:g,networkTrackingOptions:a,amplitude:f,loggerProvider:b}).allObservables,k=i.networkTrackingOptions,l=i.amplitude,m=i.loggerProvider,T=j.networkObservable.filter(function(a){return function(a,b){void 0===b&&(b={});var c,d,e=d$(a.url);if(!e)return!1;var f=e.host;return!(!1!==b.ignoreAmplitudeRequests&&(dY(f,"*.amplitude.com")||dY(f,"amplitude.com"))||(null==(c=b.ignoreHosts)?void 0:c.find(function(a){return dY(f,a)})))&&(!!b.captureRules||void 0===a.status||!!dZ(a.status,dX))&&(!b.captureRules||((0,ah.__spreadArray)([],(0,ah.__read)(b.captureRules),!1).reverse().find(function(b){if(d=function(a,b,c,d,e){if((!a.hosts||a.hosts.find(function(a){return dY(b,a)}))&&(!d||!a.urls||db(d,a.urls))&&(!e||!a.methods||a.methods.find(function(a){return e.toLowerCase()===a.toLowerCase()||"*"===a})))return(!c&&0!==c||!!dZ(c,a.statusCodeRange||dX))&&!0}(b,f,a.status,a.url,a.method)){var c=d_(b.responseHeaders);if(a.responseWrapper&&c){var e=a.responseWrapper.headers(c);e&&(a.responseHeaders=e)}var g=d_(b.requestHeaders);if(a.requestWrapper&&g){var h=a.requestWrapper.headers(g);h&&(a.requestHeaders=h)}a.responseWrapper&&b.responseBody&&!d0(b.responseBody)&&(a.responseBodyJson=a.responseWrapper.json(b.responseBody.allowlist,b.responseBody.blocklist)),a.requestWrapper&&b.requestBody&&!d0(b.requestBody)&&(a.requestBodyJson=a.requestWrapper.json(b.requestBody.allowlist,b.requestBody.blocklist))}return void 0!==d}),!!d))&&!(a.requestWrapper&&function(a,b){if(a.includes("amplitude.com"))try{var c=b.body;if("string"!=typeof c)return!1;if(JSON.parse(c).events.find(function(a){return a.event_type===dW}))return!0}catch(a){}return!1}(f,a.requestWrapper))}(a.event,k)}).subscribe(function(a){var b,c,d,e=a.event,f=d$(e.url);if(f){var g=null==(c=e.responseWrapper)?void 0:c.bodySize,h=null==(d=e.requestWrapper)?void 0:d.bodySize;!function(a,b,c,d){(0,ah.__awaiter)(this,void 0,void 0,function(){var e,f,g;return(0,ah.__generator)(this,function(h){switch(h.label){case 0:if(!(b.requestBodyJson||b.responseBodyJson))return[3,2];return[4,Promise.all([b.requestBodyJson,b.responseBodyJson])];case 1:if(f=(e=ah.__read.apply(void 0,[h.sent(),2]))[0],g=e[1],f)try{a["[Amplitude] Request Body"]=JSON.stringify(f)}catch(a){null==d||d.debug("Failed to stringify request body",a)}if(g)try{a["[Amplitude] Response Body"]=JSON.stringify(g)}catch(a){null==d||d.debug("Failed to stringify response body")}h.label=2;case 2:return null==c||c.track(dW,a),[2]}})})}(((b={})["[Amplitude] URL"]=f.hrefWithoutQueryOrHash,b["[Amplitude] URL Query"]=f.query,b["[Amplitude] URL Fragment"]=f.fragment,b["[Amplitude] Request Method"]=e.method,b["[Amplitude] Status Code"]=e.status,b["[Amplitude] Start Time"]=e.startTime,b["[Amplitude] Completion Time"]=e.endTime,b["[Amplitude] Duration"]=e.duration,b["[Amplitude] Request Body Size"]=h,b["[Amplitude] Response Body Size"]=g,b["[Amplitude] Request Type"]=e.type,b["[Amplitude] Request Headers"]=e.requestHeaders,b["[Amplitude] Response Headers"]=e.responseHeaders,b),e,l,m)}}),null==b||b.log("".concat(c," has been successfully added.")),[2])})})},execute:function(a){return(0,ah.__awaiter)(void 0,void 0,void 0,function(){return(0,ah.__generator)(this,function(b){return[2,a]})})},teardown:function(){return(0,ah.__awaiter)(void 0,void 0,void 0,function(){return(0,ah.__generator)(this,function(a){return T.unsubscribe(),[2]})})}}};let d2=-1,d3=a=>{addEventListener("pageshow",b=>{b.persisted&&(d2=b.timeStamp,a(b))},!0)},d4=(a,b,c,d)=>{let e,f;return g=>{let h;b.value>=0&&(g||d)&&((f=b.value-(e??0))||void 0===e)&&(e=b.value,b.delta=f,h=b.value,b.rating=h>c[1]?"poor":h>c[0]?"needs-improvement":"good",a(b))}},d5=a=>{requestAnimationFrame(()=>requestAnimationFrame(()=>a()))},d6=()=>{let a=performance.getEntriesByType("navigation")[0];if(a&&a.responseStart>0&&a.responseStart<performance.now())return a},d7=()=>{let a=d6();return a?.activationStart??0},d8=(a,b=-1)=>{let c=d6(),d="navigate";return d2>=0?d="back-forward-cache":c&&(document.prerendering||d7()>0?d="prerender":document.wasDiscarded?d="restore":c.type&&(d=c.type.replace(/_/g,"-"))),{name:a,value:b,rating:"good",delta:0,entries:[],id:`v5-${Date.now()}-${Math.floor(0x82f79cd8fff*Math.random())+1e12}`,navigationType:d}},d9=new WeakMap;function ea(a,b){return d9.get(a)||d9.set(a,new b),d9.get(a)}class eb{t;i=0;o=[];h(a){if(a.hadRecentInput)return;let b=this.o[0],c=this.o.at(-1);this.i&&b&&c&&a.startTime-c.startTime<1e3&&a.startTime-b.startTime<5e3?(this.i+=a.value,this.o.push(a)):(this.i=a.value,this.o=[a]),this.t?.(a)}}let ec=(a,b,c={})=>{try{if(PerformanceObserver.supportedEntryTypes.includes(a)){let d=new PerformanceObserver(a=>{Promise.resolve().then(()=>{b(a.getEntries())})});return d.observe({type:a,buffered:!0,...c}),d}}catch{}},ed=a=>{let b=!1;return()=>{b||(a(),b=!0)}},ee=-1,ef=new Set,eg=()=>"hidden"!==document.visibilityState||document.prerendering?1/0:0,eh=a=>{if("hidden"===document.visibilityState){if("visibilitychange"===a.type)for(let a of ef)a();isFinite(ee)||(ee="visibilitychange"===a.type?a.timeStamp:0,removeEventListener("prerenderingchange",eh,!0))}},ei=()=>{if(ee<0){let a=d7();ee=(document.prerendering?void 0:globalThis.performance.getEntriesByType("visibility-state").filter(b=>"hidden"===b.name&&b.startTime>a)[0]?.startTime)??eg(),addEventListener("visibilitychange",eh,!0),addEventListener("prerenderingchange",eh,!0),d3(()=>{setTimeout(()=>{ee=eg()})})}return{get firstHiddenTime(){return ee},onHidden(a){ef.add(a)}}},ej=a=>{document.prerendering?addEventListener("prerenderingchange",()=>a(),!0):a()},ek=[1800,3e3],el=(a,b={})=>{ej(()=>{let c=ei(),d,e=d8("FCP"),f=ec("paint",a=>{for(let b of a)"first-contentful-paint"===b.name&&(f.disconnect(),b.startTime<c.firstHiddenTime&&(e.value=Math.max(b.startTime-d7(),0),e.entries.push(b),d(!0)))});f&&(d=d4(a,e,ek,b.reportAllChanges),d3(c=>{d=d4(a,e=d8("FCP"),ek,b.reportAllChanges),d5(()=>{e.value=performance.now()-c.timeStamp,d(!0)})}))})},em=[.1,.25],en=0,eo=1/0,ep=0,eq=a=>{for(let b of a)b.interactionId&&(eo=Math.min(eo,b.interactionId),en=(ep=Math.max(ep,b.interactionId))?(ep-eo)/7+1:0)},er=()=>b?en:performance.interactionCount??0,es=0;class et{u=[];l=new Map;m;p;v(){es=er(),this.u.length=0,this.l.clear()}L(){let a=Math.min(this.u.length-1,Math.floor((er()-es)/50));return this.u[a]}h(a){if(this.m?.(a),!a.interactionId&&"first-input"!==a.entryType)return;let b=this.u.at(-1),c=this.l.get(a.interactionId);if(c||this.u.length<10||a.duration>b.P){if(c?a.duration>c.P?(c.entries=[a],c.P=a.duration):a.duration===c.P&&a.startTime===c.entries[0].startTime&&c.entries.push(a):(c={id:a.interactionId,entries:[a],P:a.duration},this.l.set(c.id,c),this.u.push(c)),this.u.sort((a,b)=>b.P-a.P),this.u.length>10)for(let a of this.u.splice(10))this.l.delete(a.id);this.p?.(c)}}}let eu=a=>{let b=globalThis.requestIdleCallback||setTimeout;"hidden"===document.visibilityState?a():(addEventListener("visibilitychange",a=ed(a),{once:!0,capture:!0}),b(()=>{a(),removeEventListener("visibilitychange",a,{capture:!0})}))},ev=[200,500];class ew{m;h(a){this.m?.(a)}}let ex=[2500,4e3],ey=[800,1800],ez=a=>{document.prerendering?ej(()=>ez(a)):"complete"!==document.readyState?addEventListener("load",()=>ez(a),!0):setTimeout(a)};function eA(a){var b,c;return{value:a.value,rating:a.rating,delta:a.delta,navigationType:a.navigationType,id:a.id,timestamp:Math.floor((c=(null==(b=a.entries[0])?void 0:b.startTime)||0,performance.timeOrigin+c)),navigationStart:Math.floor(performance.timeOrigin)}}var eB=function(){var a=null,c=aJ(),d=null==c?void 0:c.document,e=null==c?void 0:c.location;return{name:"web-vitals-browser",type:"enrichment",setup:function(c,f){return(0,ah.__awaiter)(void 0,void 0,void 0,function(){var g,h;return(0,ah.__generator)(this,function(i){return void 0===d||(g=dc((null==e?void 0:e.href)||"",c.loggerProvider),h={"[Amplitude] Page Domain":(null==e?void 0:e.hostname)||"","[Amplitude] Page Location":g,"[Amplitude] Page Path":dc((null==e?void 0:e.pathname)||"",c.loggerProvider),"[Amplitude] Page Title":"u">typeof document&&document.title||"","[Amplitude] Page URL":dc(g.split("?")[0],c.loggerProvider)},((a,b={})=>{ej(()=>{let c=ei(),d,e=d8("LCP"),f=ea(b,ew),g=a=>{for(let g of(b.reportAllChanges||(a=a.slice(-1)),a))f.h(g),g.startTime<c.firstHiddenTime&&(e.value=Math.max(g.startTime-d7(),0),e.entries=[g],d())},h=ec("largest-contentful-paint",g);if(h){d=d4(a,e,ex,b.reportAllChanges);let c=ed(()=>{g(h.takeRecords()),h.disconnect(),d(!0)}),f=a=>{a.isTrusted&&(eu(c),removeEventListener(a.type,f,{capture:!0}))};for(let a of["keydown","click","visibilitychange"])addEventListener(a,f,{capture:!0});d3(c=>{d=d4(a,e=d8("LCP"),ex,b.reportAllChanges),d5(()=>{e.value=performance.now()-c.timeStamp,d(!0)})})}})})(function(a){h["[Amplitude] LCP"]=eA(a)}),el(function(a){h["[Amplitude] FCP"]=eA(a)}),((a,c={})=>{if(!globalThis.PerformanceEventTiming||!("interactionId"in PerformanceEventTiming.prototype))return;let d=ei();ej(()=>{"interactionCount"in performance||b||(b=ec("event",eq,{type:"event",buffered:!0,durationThreshold:0}));let e,f=d8("INP"),g=ea(c,et),h=a=>{eu(()=>{for(let b of a)g.h(b);let b=g.L();b&&b.P!==f.value&&(f.value=b.P,f.entries=b.entries,e())})},i=ec("event",h,{durationThreshold:c.durationThreshold??40});e=d4(a,f,ev,c.reportAllChanges),i&&(i.observe({type:"first-input",buffered:!0}),d.onHidden(()=>{h(i.takeRecords()),e(!0)}),d3(()=>{g.v(),e=d4(a,f=d8("INP"),ev,c.reportAllChanges)}))})})(function(a){h["[Amplitude] INP"]=eA(a)}),((a,b={})=>{let c=ei();el(ed(()=>{let d,e=d8("CLS",0),f=ea(b,eb),g=a=>{for(let b of a)f.h(b);f.i>e.value&&(e.value=f.i,e.entries=f.o,d())},h=ec("layout-shift",g);h&&(d=d4(a,e,em,b.reportAllChanges),c.onHidden(()=>{g(h.takeRecords()),d(!0)}),d3(()=>{f.i=0,d=d4(a,e=d8("CLS",0),em,b.reportAllChanges),d5(()=>d())}),setTimeout(d))}))})(function(a){h["[Amplitude] CLS"]=eA(a)}),((a,b={})=>{let c=d8("TTFB"),d=d4(a,c,ey,b.reportAllChanges);ez(()=>{let e=d6();e&&(c.value=Math.max(e.responseStart-d7(),0),c.entries=[e],d(!0),d3(()=>{(d=d4(a,c=d8("TTFB",0),ey,b.reportAllChanges))(!0)}))})})(function(a){h["[Amplitude] TTFB"]=eA(a)}),a=function(){"hidden"===d.visibilityState&&a&&(f.track("[Amplitude] Web Vitals",h),d.removeEventListener("visibilitychange",a),a=null)},d.addEventListener("visibilitychange",a)),[2]})})},execute:function(a){return(0,ah.__awaiter)(void 0,void 0,void 0,function(){return(0,ah.__generator)(this,function(b){return[2,a]})})},teardown:function(){return(0,ah.__awaiter)(void 0,void 0,void 0,function(){return(0,ah.__generator)(this,function(b){return a&&(null==d||d.removeEventListener("visibilitychange",a)),[2]})})}}},eC=function(a,b,c){return void 0===b&&(b=""),void 0===c&&(c=10),["AMP",b,a.substring(0,c)].filter(Boolean).join("_")},eD=function(a){var b=a.split(".");return b.length<=2?a:b.slice(b.length-2,b.length).join(".")},eE=function(a,b,c,d,e){void 0===e&&(e=!0),a.referrer;var f=a.referring_domain,g=(0,ah.__rest)(a,["referrer","referring_domain"]),h=b||{},i=(h.referrer,h.referring_domain),j=(0,ah.__rest)(h,["referrer","referring_domain"]);if(eF(c.excludeReferrers,a.referring_domain))return d.debug("This is not a new campaign because ".concat(a.referring_domain," is in the exclude referrer list.")),!1;if(!e&&Object.values(a).every(function(a){return!a})&&b)return d.debug("This is not a new campaign because this is a direct traffic in the same session."),!1;var k=JSON.stringify(g)!==JSON.stringify(j),l=eD(f||"")!==eD(i||""),m=!b||k||l;return m?d.debug("This is a new campaign. An $identify event will be sent."):d.debug("This is not a new campaign because it's the same as the previous one."),m},eF=function(a,b){return void 0===a&&(a=[]),void 0===b&&(b=""),a.some(function(a){return a instanceof RegExp?a.test(b):a===b})},eG=function(a){var b=a;return b?(b.startsWith(".")&&(b=b.substring(1)),[new RegExp("".concat(b.replace(".","\\."),"$"))]):[]},eH=function(){function a(a,b){var c;this.shouldTrackNewCampaign=!1,this.options=(0,ah.__assign)({initialEmptyValue:"EMPTY",resetSessionOnNewCampaign:!1,excludeReferrers:eG(null==(c=b.cookieOptions)?void 0:c.domain)},a),this.storage=b.cookieStorage,this.storageKey=eC(b.apiKey,"MKTG"),this.webExpStorageKey=eC(b.apiKey,"MKTG_ORIGINAL"),this.currentCampaign=aB,this.sessionTimeout=b.sessionTimeout,this.lastEventTime=b.lastEventTime,this.logger=b.loggerProvider,b.loggerProvider.log("Installing web attribution tracking.")}return a.prototype.init=function(){return(0,ah.__awaiter)(this,void 0,void 0,function(){var a,b;return(0,ah.__generator)(this,function(c){switch(c.label){case 0:return[4,this.fetchCampaign()];case 1:if(b=ah.__read.apply(void 0,[c.sent(),2]),this.currentCampaign=b[0],this.previousCampaign=b[1],a=!this.lastEventTime||be(this.sessionTimeout,this.lastEventTime),!eE(this.currentCampaign,this.previousCampaign,this.options,this.logger,a))return[3,3];return this.shouldTrackNewCampaign=!0,[4,this.storage.set(this.storageKey,this.currentCampaign)];case 2:c.sent(),c.label=3;case 3:return[2]}})})},a.prototype.fetchCampaign=function(){return(0,ah.__awaiter)(this,void 0,void 0,function(){var a;return(0,ah.__generator)(this,function(b){switch(b.label){case 0:return[4,this.storage.get(this.webExpStorageKey)];case 1:if(!(a=b.sent()))return[3,3];return[4,this.storage.remove(this.webExpStorageKey)];case 2:b.sent(),b.label=3;case 3:return[4,Promise.all([a||new cr().parse(),this.storage.get(this.storageKey)])];case 4:return[2,b.sent()]}})})},a.prototype.generateCampaignEvent=function(a){this.shouldTrackNewCampaign=!1;var b,c,d=(b=this.currentCampaign,c=this.options,aN(Object.entries((0,ah.__assign)((0,ah.__assign)({},aB),b)).reduce(function(a,b){var d,e=(0,ah.__read)(b,2),f=e[0],g=e[1];return(a.setOnce("initial_".concat(f),null!=(d=null!=g?g:c.initialEmptyValue)?d:"EMPTY"),g)?a.set(f,g):a.unset(f)},new aG)));return a&&(d.event_id=a),d},a.prototype.shouldSetSessionIdOnNewCampaign=function(){return this.shouldTrackNewCampaign&&!!this.options.resetSessionOnNewCampaign},a}(),eI="AMP_CURRENT_PAGE",eJ="AMP_PREVIOUS_PAGE",eK="AMP_URL_INFO";(o=U||(U={})).Direct="direct",o.Internal="internal",o.External="external";var eL=new Set([M.IDENTIFY,M.GROUP_IDENTIFY,M.REVENUE]),eM=function(a){var b=(void 0===a?{}:a).internalDomains,c=void 0===b?[]:b,d=aJ(),e=void 0,f=!1,g=void 0,h=!1,i=!1,j=function(a){var b;try{var c=dc(a,g);b=new URL(c).hostname}catch(a){null==g||g.error("Could not parse URL: ",a)}return b},k=function(a){var b="u">typeof location&&location.hostname||"",d=a?j(a):void 0;if(!d)return U.Direct;var e=c.some(function(a){return -1!==b.indexOf(a)}),f=c.some(function(a){return -1!==d.indexOf(a)});return b===d||f&&e?U.Internal:U.External},l=function(){(0,ah.__awaiter)(void 0,void 0,void 0,function(){var a,b,c,d,g;return(0,ah.__generator)(this,function(h){switch(h.label){case 0:if(!(e&&f))return[3,3];return[4,e.get(eK)];case 1:return a=h.sent(),b=dc("u">typeof location&&location.href||""),c=(null==a?void 0:a[eI])||"",d=void 0,d=b===c?(null==a?void 0:a[eJ])||"":c||document.referrer||"",[4,e.set(eK,((g={})[eI]=b,g[eJ]=d,g))];case 2:h.sent(),h.label=3;case 3:return[2]}})})};return{name:"@amplitude/plugin-page-url-enrichment-browser",type:"enrichment",setup:function(a,b){return(0,ah.__awaiter)(void 0,void 0,void 0,function(){return(0,ah.__generator)(this,function(b){switch(b.label){case 0:if((g=a.loggerProvider).log("Installing @amplitude/plugin-page-url-enrichment-browser"),i=!0,!d)return[3,2];return[4,(e=new bX(d.sessionStorage)).isEnabled()];case 1:f=b.sent(),d.addEventListener("popstate",l),h||(d.history.pushState=new Proxy(d.history.pushState,{apply:function(a,b,c){var d=(0,ah.__read)(c,3),e=d[0],f=d[1],g=d[2];a.apply(b,[e,f,g]),i&&l()}}),d.history.replaceState=new Proxy(d.history.replaceState,{apply:function(a,b,c){var d=(0,ah.__read)(c,3),e=d[0],f=d[1],g=d[2];a.apply(b,[e,f,g]),i&&l()}}),h=!0),b.label=2;case 2:return[2]}})})},execute:function(a){return(0,ah.__awaiter)(void 0,void 0,void 0,function(){var b,c,d,g,h;return(0,ah.__generator)(this,function(i){switch(i.label){case 0:if(b=dc("u">typeof location&&location.href||""),!(e&&f))return[3,5];return[4,e.get(eK)];case 1:if(null==(c=i.sent())?void 0:c[eI])return[3,3];return[4,e.set(eK,((h={})[eI]=b,h[eJ]=document.referrer||"",h))];case 2:i.sent(),i.label=3;case 3:return[4,e.get(eK)];case 4:if(d=i.sent(),g="",d&&(g=d[eJ]||""),eL.has(a.event_type))return[2,a];a.event_properties=(0,ah.__assign)((0,ah.__assign)({},a.event_properties||{}),{"[Amplitude] Page Domain":eN(a,"[Amplitude] Page Domain","u">typeof location&&location.hostname||""),"[Amplitude] Page Location":eN(a,"[Amplitude] Page Location",b),"[Amplitude] Page Path":eN(a,"[Amplitude] Page Path","u">typeof location&&dc(location.pathname)||""),"[Amplitude] Page Title":eN(a,"[Amplitude] Page Title",cq(cp)),"[Amplitude] Page URL":eN(a,"[Amplitude] Page URL",b.split("?")[0]),"[Amplitude] Previous Page Location":g,"[Amplitude] Previous Page Type":k(g)}),i.label=5;case 5:return[2,a]}})})},teardown:function(){return(0,ah.__awaiter)(void 0,void 0,void 0,function(){return(0,ah.__generator)(this,function(a){switch(a.label){case 0:if(d&&(d.removeEventListener("popstate",l),i=!1),!(e&&f))return[3,2];return[4,e.set(eK,{})];case 1:a.sent(),a.label=2;case 2:return[2]}})})}}};function eN(a,b,c){return(a.event_properties||(a.event_properties={}),void 0===a.event_properties[b])?c:a.event_properties[b]}let eO={init:am((p=new(function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b._diagnosticsSampleRate=0,b}return(0,ah.__extends)(b,a),b.prototype.init=function(a,b,c){var d,e;return void 0===a&&(a=""),arguments.length>2?(d=b,e=c):"string"==typeof b?(d=b,e=void 0):(d=null==b?void 0:b.userId,e=b),aQ(this._init((0,ah.__assign)((0,ah.__assign)({},e),{userId:d,apiKey:a})))},b.prototype._init=function(b){var c,d,e,f;return(0,ah.__awaiter)(this,void 0,void 0,function(){var g,h,i,j,k,l,m,n,o=this;return(0,ah.__generator)(this,function(p){var q,r,s,t,u;switch(p.label){case 0:if(this.initializing)return[2];return this.initializing=!0,[4,(q=b.apiKey,r=b,s=this,void 0===r&&(r={}),(0,ah.__awaiter)(void 0,void 0,void 0,function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V;return(0,ah.__generator)(this,function(W){switch(W.label){case 0:if(a=r.identityStorage||cg,x={},a===cg)return[3,1];return c="",[3,5];case 1:if(null==(z=null==(y=r.cookieOptions)?void 0:y.domain))return[3,2];return d=z,[3,4];case 2:return[4,(0,ah.__awaiter)(void 0,void 0,void 0,function(){var a,b,c,d,e,f;return(0,ah.__generator)(this,function(g){switch(g.label){case 0:return[4,new bR().isEnabled()];case 1:if(!g.sent()||"u"<typeof location||!location.hostname)return[2,""];for(a=(0,location.hostname).split("."),b=[],c="AMP_TLDTEST",d=a.length-2;d>=0;--d)b.push(a.slice(d).join("."));d=0,g.label=2;case 2:if(!(d<b.length))return[3,7];return[4,(f=new bR({domain:"."+(e=b[d])})).set(c,1)];case 3:return g.sent(),[4,f.get(c)];case 4:if(!g.sent())return[3,6];return[4,f.remove(c)];case 5:return g.sent(),[2,"."+e];case 6:return d++,[3,2];case 7:return[2,""]}})})];case 3:d=W.sent(),W.label=4;case 4:c=d,W.label=5;case 5:var X,Y;return b=ah.__assign.apply(void 0,[(x.domain=c,x.expiration=365,x.sameSite="Lax",x.secure=!1,x.upgrade=!0,x),r.cookieOptions]),[4,(X=e=ci(r.identityStorage,b),void 0===(Y=null==(B=null==(A=r.cookieOptions)?void 0:A.upgrade)||B)&&(Y=!0),(0,ah.__awaiter)(void 0,void 0,void 0,function(){var a,b,c,d,e,f,g,h,i;return(0,ah.__generator)(this,function(j){switch(j.label){case 0:return a="".concat("amp","_").concat(q.substring(0,6)),[4,X.getRaw(a)];case 1:if(!(b=j.sent()))return[2,{optOut:!1}];if(!Y)return[3,3];return[4,X.remove(a)];case 2:j.sent(),j.label=3;case 3:return d=(c=(0,ah.__read)(b.split("."),6))[0],e=c[1],f=c[2],g=c[3],h=c[4],i=c[5],[2,{deviceId:d,userId:b1(e),sessionId:b0(g),lastEventId:b0(i),lastEventTime:b0(h),optOut:!!f}]}})}))];case 6:return f=W.sent(),[4,e.get(bU(q))];case 7:return g=W.sent(),j=!(i=(h=bg()).ampTimestamp?Number(h.ampTimestamp):void 0)||Date.now()<i,k=null!=(G=null!=(F=null!=(E=null!=(C=r.deviceId)?C:j?null!=(D=h.ampDeviceId)?D:h.deviceId:void 0)?E:null==g?void 0:g.deviceId)?F:f.deviceId)?G:aL(),l=null!=(H=null==g?void 0:g.lastEventId)?H:f.lastEventId,m=null!=(I=null==g?void 0:g.lastEventTime)?I:f.lastEventTime,n=null!=(K=null!=(J=r.optOut)?J:null==g?void 0:g.optOut)?K:f.optOut,o=null!=(L=null==g?void 0:g.sessionId)?L:f.sessionId,p=null!=(N=null!=(M=r.userId)?M:null==g?void 0:g.userId)?N:f.userId,s.previousSessionDeviceId=null!=(O=null==g?void 0:g.deviceId)?O:f.deviceId,s.previousSessionUserId=null!=(P=null==g?void 0:g.userId)?P:f.userId,t={ipAddress:null==(R=null==(Q=r.trackingOptions)?void 0:Q.ipAddress)||R,language:null==(T=null==(S=r.trackingOptions)?void 0:S.language)||T,platform:null==(V=null==(U=r.trackingOptions)?void 0:U.platform)||V},u=null==g?void 0:g.pageCounter,v=null==g?void 0:g.debugLogsEnabled,void 0!==r.autocapture&&(r.defaultTracking=r.autocapture),[4,(w=new ch(q,r.appVersion,e,b,r.defaultTracking,r.autocapture,k,r.flushIntervalMillis,r.flushMaxRetries,r.flushQueueSize,a,r.ingestionMetadata,r.instanceName,l,m,r.loggerProvider,r.logLevel,r.minIdLength,r.offline,n,r.partnerId,r.plan,r.serverUrl,r.serverZone,o,r.sessionTimeout,r.storageProvider,t,r.transport,r.useBatch,r.fetchRemoteConfig,p,u,v,r.networkTrackingOptions,r.identify,r.enableDiagnostics,s._diagnosticsSampleRate,void 0,r.remoteConfig)).storageProvider.isEnabled()];case 8:return W.sent()||(w.loggerProvider.warn("Storage provider ".concat(w.storageProvider.constructor.name," is not enabled. Falling back to MemoryStorage.")),w.storageProvider=new bQ),[2,w]}})}))];case 1:if(!((g=p.sent()).remoteConfig&&g.remoteConfig.fetchRemoteConfig))return[3,4];return h=new bj(g.apiKey,g.loggerProvider,g.serverZone,null==(c=g.remoteConfig)?void 0:c.serverUrl),[4,new Promise(function(a){null==h||h.subscribe("configs.analyticsSDK.browserSDK","all",function(b,c,d){g.loggerProvider.debug("Remote configuration received:",JSON.stringify({remoteConfig:b,source:c,lastFetch:d},null,2)),b&&function(a,b){if(a){!function a(b){if("object"==typeof b&&null!==b&&!Array.isArray(b)){var c,d,e,f,g,h,i,j,k,l,m,n=Object.keys(b);try{for(var o=(0,ah.__values)(n),p=o.next();!p.done;p=o.next()){var q=p.value;try{var r=b[q];"boolean"==typeof(null==r?void 0:r.enabled)&&(r.enabled?(delete r.enabled,0===Object.keys(r).length&&(b[q]=!0)):b[q]=!1),a(r)}catch(a){}}}catch(a){c={error:a}}finally{try{p&&!p.done&&(d=o.return)&&d.call(o)}finally{if(c)throw c.error}}try{if(null==(k=null==(j=null==(i=b.autocapture)?void 0:i.networkTracking)?void 0:j.captureRules)?void 0:k.length)try{for(var s=(0,ah.__values)(b.autocapture.networkTracking.captureRules),t=s.next();!t.done;t=s.next()){var u=t.value;try{for(var v=(g=void 0,(0,ah.__values)(["responseHeaders","requestHeaders"])),w=v.next();!w.done;w=v.next()){var x=w.value,y=null!=(l=u[x])?l:{},z=y.captureSafeHeaders,A=y.allowlist;if(z||A){if(void 0!==A&&!Array.isArray(A)){delete u[x];continue}u[x]=(0,ah.__spreadArray)((0,ah.__spreadArray)([],(0,ah.__read)(z?aC:[]),!1),(0,ah.__read)(null!=A?A:[]),!1)}}}catch(a){g={error:a}}finally{try{w&&!w.done&&(h=v.return)&&h.call(v)}finally{if(g)throw g.error}}}}catch(a){e={error:a}}finally{try{t&&!t.done&&(f=s.return)&&f.call(s)}finally{if(e)throw e.error}}}catch(a){}var B=null==(m=b.autocapture)?void 0:m.frustrationInteractions;B&&(B.rageClick&&(B.rageClicks=B.rageClick,delete B.rageClick),B.deadClick&&(B.deadClicks=B.deadClick,delete B.deadClick))}}(a);try{var c,d,e,f,g,h,i;if(b.loggerProvider.debug("Update browser config with remote configuration:",JSON.stringify(a)),a&&"autocapture"in a){if("boolean"==typeof a.autocapture&&(b.autocapture=a.autocapture),"object"==typeof a.autocapture&&null!==a.autocapture){var j=(0,ah.__assign)({},a.autocapture);if(void 0===b.autocapture&&(b.autocapture=a.autocapture),"object"==typeof a.autocapture.elementInteractions&&null!==a.autocapture.elementInteractions&&(null==(e=a.autocapture.elementInteractions.pageUrlAllowlistRegex)?void 0:e.length)){j.elementInteractions=(0,ah.__assign)({},a.autocapture.elementInteractions);var k=j.elementInteractions,l=null!=(f=k.pageUrlAllowlist)?f:[],m=a.autocapture.elementInteractions.pageUrlAllowlistRegex;k.pageUrlAllowlist=cE(l,m,b),delete k.pageUrlAllowlistRegex}if("object"==typeof a.autocapture.networkTracking&&null!==a.autocapture.networkTracking&&(null==(g=a.autocapture.networkTracking.captureRules)?void 0:g.length)){j.networkTracking=(0,ah.__assign)({},a.autocapture.networkTracking);var n=null!=(h=j.networkTracking.captureRules)?h:[];try{for(var o=(0,ah.__values)(n),p=o.next();!p.done;p=o.next()){var q=p.value;q.urls=cE(null!=(i=q.urls)?i:[],q.urlsRegex,b),delete q.urlsRegex}}catch(a){c={error:a}}finally{try{p&&!p.done&&(d=o.return)&&d.call(o)}finally{if(c)throw c.error}}}"boolean"==typeof b.autocapture&&(b.autocapture=(0,ah.__assign)({attribution:b.autocapture,fileDownloads:b.autocapture,formInteractions:b.autocapture,pageViews:b.autocapture,sessions:b.autocapture,elementInteractions:b.autocapture,webVitals:b.autocapture,frustrationInteractions:b.autocapture},j)),"object"==typeof b.autocapture&&(b.autocapture=(0,ah.__assign)((0,ah.__assign)({},b.autocapture),j))}b.defaultTracking=b.autocapture}b.loggerProvider.debug("Browser config after remote config update:",JSON.stringify(b))}catch(a){b.loggerProvider.error("Failed to apply remote configuration because of error: ",a)}}}(b,g),a()})})];case 2:return p.sent(),[4,new Promise(function(a){null==h||h.subscribe("configs.diagnostics.browserSDK","all",function(b,c,d){if(g.loggerProvider.debug("Diagnostics remote configuration received:",JSON.stringify({remoteConfig:b,source:c,lastFetch:d},null,2)),b){var e=b.sampleRate;"number"!=typeof e||isNaN(e)||(g.diagnosticsSampleRate=e);var f=b.enabled;"boolean"==typeof f&&(g.enableDiagnostics=f)}a()})})];case 3:p.sent(),p.label=4;case 4:return(i=new by(g.apiKey,g.loggerProvider,g.serverZone,{enabled:g.enableDiagnostics,sampleRate:g.diagnosticsSampleRate})).setTag("library","".concat(bO,"/").concat(bN)),i.setTag("user_agent",navigator.userAgent),[4,a.prototype._init.call(this,g)];case 5:if(p.sent(),this.logBrowserOptions(g),this.config.diagnosticsClient=i,this.config.remoteConfigClient=h,!bA(this.config.defaultTracking))return[3,7];return j=bA((t=this.config).defaultTracking)&&t.defaultTracking&&"object"==typeof t.defaultTracking&&t.defaultTracking.attribution&&"object"==typeof t.defaultTracking.attribution?(0,ah.__assign)({},t.defaultTracking.attribution):{},this.webAttribution=new eH(j,this.config),[4,this.webAttribution.init()];case 6:p.sent(),p.label=7;case 7:if(m=!(!(l=(k=bg()).ampTimestamp?Number(k.ampTimestamp):void 0)||Date.now()<l)||Number.isNaN(Number(k.ampSessionId))?void 0:Number(k.ampSessionId),this.setSessionId(null!=(f=null!=(e=null!=(d=b.sessionId)?d:m)?e:this.config.sessionId)?f:Date.now()),(n=bb(b.instanceName)).identityStore.setIdentity({userId:this.config.userId,deviceId:this.config.deviceId}),null===this.config.offline)return[3,9];return[4,this.add(cD()).promise];case 8:p.sent(),p.label=9;case 9:return[4,this.add(new a_({diagnosticsClient:i})).promise];case 10:return p.sent(),[4,this.add(new bP).promise];case 11:return p.sent(),[4,this.add(new bf).promise];case 12:if(p.sent(),cC(this.config),!bz(this.config.defaultTracking,"fileDownloads"))return[3,14];return this.config.loggerProvider.debug("Adding file download tracking plugin"),[4,this.add(cA()).promise];case 13:p.sent(),p.label=14;case 14:if(!bz(this.config.defaultTracking,"formInteractions"))return[3,16];return this.config.loggerProvider.debug("Adding form interaction plugin"),[4,this.add(cx()).promise];case 15:p.sent(),p.label=16;case 16:if(!bB(this.config.defaultTracking))return[3,18];return this.config.loggerProvider.debug("Adding page view tracking plugin"),[4,this.add(ct(bJ(this.config))).promise];case 17:p.sent(),p.label=18;case 18:if(!bE(this.config.autocapture))return[3,20];return this.config.loggerProvider.debug("Adding user interactions plugin (autocapture plugin)"),[4,this.add(dB(bG(this.config),{diagnosticsClient:i})).promise];case 19:p.sent(),p.label=20;case 20:if(!bF(this.config.autocapture))return[3,22];return this.config.loggerProvider.debug("Adding frustration interactions plugin"),[4,this.add(dH(bH(this.config))).promise];case 21:p.sent(),p.label=22;case 22:if(!bD(this.config.autocapture))return[3,24];return this.config.loggerProvider.debug("Adding network tracking plugin"),[4,this.add(d1(bI(this.config))).promise];case 23:p.sent(),p.label=24;case 24:if(!("boolean"==typeof(u=this.config.autocapture)?u:"object"==typeof u&&!0===u.webVitals))return[3,26];return this.config.loggerProvider.debug("Adding web vitals plugin"),[4,this.add(eB()).promise];case 25:p.sent(),p.label=26;case 26:if(!bz(this.config.autocapture,"pageUrlEnrichment"))return[3,28];return this.config.loggerProvider.debug("Adding referrer page url plugin"),[4,this.add(eM()).promise];case 27:p.sent(),p.label=28;case 28:return this.initializing=!1,[4,this.runQueuedFunctions("dispatchQ")];case 29:return p.sent(),n.eventBridge.setEventReceiver(function(a){var b=a.eventProperties||{},c=b.time,d=(0,ah.__rest)(b,["time"]);o.track(a.eventType,d,"number"==typeof c?{time:c}:void 0)}),[2]}})})},b.prototype.getUserId=function(){var a;return null==(a=this.config)?void 0:a.userId},b.prototype.setUserId=function(a){this.config?(this.config.loggerProvider.debug("function setUserId: ",a),(a!==this.config.userId||void 0===a)&&(this.config.userId=a,this.timeline.onIdentityChanged({userId:a}),bc(a,this.config.instanceName))):this.q.push(this.setUserId.bind(this,a))},b.prototype.getDeviceId=function(){var a;return null==(a=this.config)?void 0:a.deviceId},b.prototype.setDeviceId=function(a){this.config?(this.config.loggerProvider.debug("function setDeviceId: ",a),a!==this.config.deviceId&&(this.config.deviceId=a,this.timeline.onIdentityChanged({deviceId:a}),bd(a,this.config.instanceName))):this.q.push(this.setDeviceId.bind(this,a))},b.prototype.reset=function(){this.setDeviceId(aL()),this.setUserId(void 0),this.timeline.onReset()},b.prototype.getIdentity=function(){var a,b;return{deviceId:null==(a=this.config)?void 0:a.deviceId,userId:null==(b=this.config)?void 0:b.userId,userProperties:this.userProperties}},b.prototype.getOptOut=function(){var a;return null==(a=this.config)?void 0:a.optOut},b.prototype.getSessionId=function(){var a;return null==(a=this.config)?void 0:a.sessionId},b.prototype.setSessionId=function(a){var b,c=[];if(!this.config)return this.q.push(this.setSessionId.bind(this,a)),aQ(Promise.resolve());if(a===this.config.sessionId)return aQ(Promise.resolve());this.config.loggerProvider.debug("function setSessionId: ",a);var d=this.getSessionId();d!==a&&this.timeline.onSessionIdChanged(a);var e=this.config.lastEventTime,f=null!=(b=this.config.lastEventId)?b:-1;this.config.sessionId=a,this.config.lastEventTime=void 0,this.config.pageCounter=0,bC(this.config.defaultTracking)&&(d&&e&&c.push(this.track(b7,void 0,{device_id:this.previousSessionDeviceId,event_id:++f,session_id:d,time:e+1,user_id:this.previousSessionUserId}).promise),this.config.lastEventTime=this.config.sessionId);var g=this.trackCampaignEventIfNeeded(++f,c);return this.config.identify&&c.push(this.track(aN(this.config.identify)).promise),bC(this.config.defaultTracking)&&c.push(this.track(b6,void 0,{event_id:g?++f:f,session_id:this.config.sessionId,time:this.config.lastEventTime}).promise),this.previousSessionDeviceId=this.config.deviceId,this.previousSessionUserId=this.config.userId,aQ(Promise.all(c))},b.prototype.extendSession=function(){this.config?this.config.lastEventTime=Date.now():this.q.push(this.extendSession.bind(this))},b.prototype.setTransport=function(a){this.config?this.config.transportProvider=cj(a):this.q.push(this.setTransport.bind(this,a))},b.prototype.identify=function(b,c){if(bL(b)){var d=b._q;b._q=[],b=bK(new aG,d)}return(null==c?void 0:c.user_id)&&this.setUserId(c.user_id),(null==c?void 0:c.device_id)&&this.setDeviceId(c.device_id),a.prototype.identify.call(this,b,c)},b.prototype.groupIdentify=function(b,c,d,e){if(bL(d)){var f=d._q;d._q=[],d=bK(new aG,f)}return a.prototype.groupIdentify.call(this,b,c,d,e)},b.prototype.revenue=function(b,c){if(bL(b)){var d=b._q;b._q=[],b=bK(new a0,d)}return a.prototype.revenue.call(this,b,c)},b.prototype.trackCampaignEventIfNeeded=function(a,b){if(!this.webAttribution||!this.webAttribution.shouldTrackNewCampaign)return!1;var c=this.webAttribution.generateCampaignEvent(a);return b?b.push(this.track(c).promise):this.track(c),this.config.loggerProvider.log("Tracking attribution."),!0},b.prototype.process=function(b){return(0,ah.__awaiter)(this,void 0,void 0,function(){var c,d,e;return(0,ah.__generator)(this,function(f){return c=Date.now(),d=be(this.config.sessionTimeout,this.config.lastEventTime),e=this.webAttribution&&this.webAttribution.shouldSetSessionIdOnNewCampaign(),b.event_type!==b6&&b.event_type!==b7&&(!b.session_id||b.session_id===this.getSessionId())&&(d||e?(this.setSessionId(c),e&&this.config.loggerProvider.log("Created a new session for new campaign.")):d||this.trackCampaignEventIfNeeded()),b.event_type===M.IDENTIFY&&b.user_properties&&(this.userProperties=this.getOperationAppliedUserProperties(b.user_properties)),[2,a.prototype.process.call(this,b)]})})},b.prototype.logBrowserOptions=function(a){try{var b=(0,ah.__assign)((0,ah.__assign)({},a),{apiKey:a.apiKey.substring(0,10)+"********"});this.config.loggerProvider.debug("Initialized Amplitude with BrowserConfig:",JSON.stringify(b))}catch(a){this.config.loggerProvider.error("Error logging browser config",a)}},b.prototype._setDiagnosticsSampleRate=function(a){if(!(a>1)&&!(a<0)&&!this.config){this._diagnosticsSampleRate=a;return}},b}(aR))).init.bind(p),"init",aj(p),al(p,["config"])),add:am(p.add.bind(p),"add",aj(p),al(p,["config.apiKey","timeline.plugins"])),remove:am(p.remove.bind(p),"remove",aj(p),al(p,["config.apiKey","timeline.plugins"])),track:am(p.track.bind(p),"track",aj(p),al(p,["config.apiKey","timeline.queue.length"])),logEvent:am(p.logEvent.bind(p),"logEvent",aj(p),al(p,["config.apiKey","timeline.queue.length"])),identify:am(p.identify.bind(p),"identify",aj(p),al(p,["config.apiKey","timeline.queue.length"])),groupIdentify:am(p.groupIdentify.bind(p),"groupIdentify",aj(p),al(p,["config.apiKey","timeline.queue.length"])),setGroup:am(p.setGroup.bind(p),"setGroup",aj(p),al(p,["config.apiKey","timeline.queue.length"])),revenue:am(p.revenue.bind(p),"revenue",aj(p),al(p,["config.apiKey","timeline.queue.length"])),flush:am(p.flush.bind(p),"flush",aj(p),al(p,["config.apiKey","timeline.queue.length"])),getUserId:am(p.getUserId.bind(p),"getUserId",aj(p),al(p,["config","config.userId"])),setUserId:am(p.setUserId.bind(p),"setUserId",aj(p),al(p,["config","config.userId"])),getDeviceId:am(p.getDeviceId.bind(p),"getDeviceId",aj(p),al(p,["config","config.deviceId"])),setDeviceId:am(p.setDeviceId.bind(p),"setDeviceId",aj(p),al(p,["config","config.deviceId"])),reset:am(p.reset.bind(p),"reset",aj(p),al(p,["config","config.userId","config.deviceId"])),getSessionId:am(p.getSessionId.bind(p),"getSessionId",aj(p),al(p,["config"])),setSessionId:am(p.setSessionId.bind(p),"setSessionId",aj(p),al(p,["config"])),extendSession:am(p.extendSession.bind(p),"extendSession",aj(p),al(p,["config"])),setOptOut:am(p.setOptOut.bind(p),"setOptOut",aj(p),al(p,["config"])),setTransport:am(p.setTransport.bind(p),"setTransport",aj(p),al(p,["config"])),getIdentity:am(p.getIdentity.bind(p),"getIdentity",aj(p),al(p,["config"])),getOptOut:am(p.getOptOut.bind(p),"getOptOut",aj(p),al(p,["config"])),_setDiagnosticsSampleRate:am(p._setDiagnosticsSampleRate.bind(p),"_setDiagnosticsSampleRate",aj(p),al(p,["config"]))};a.s([],252676),a.i(252676),(q=V||(V={})).US="US",q.EU="EU",q.STAGING="STAGING",a.s(["DEFAULT_ACTION_CLICK_ALLOWLIST",()=>cH,"DEFAULT_CSS_SELECTOR_ALLOWLIST",()=>cF,"DEFAULT_DATA_ATTRIBUTE_PREFIX",()=>cG,"IdentifyOperation",()=>L,"LogLevel",()=>K,"OfflineDisabled",()=>null,"RevenueProperty",()=>P,"ServerZone",()=>V,"SpecialEventType",()=>M],374609),a.i(374609);var eP=eO.add,eQ=(eO.extendSession,eO.flush,eO.getDeviceId,eO.getIdentity,eO.getOptOut,eO.getSessionId,eO.getUserId,eO.groupIdentify,eO.identify),eR=eO.init,eS=(eO.logEvent,eO.remove,eO.reset),eT=(eO.revenue,eO.setDeviceId,eO.setGroup,eO.setOptOut,eO.setSessionId,eO.setTransport,eO.setUserId),eU=eO.track;eO._setDiagnosticsSampleRate,a.s(["add",()=>eP,"identify",()=>eQ,"init",()=>eR,"reset",()=>eS,"setUserId",()=>eT,"track",()=>eU],178865),(r=W||(W={})).SET="$set",r.SET_ONCE="$setOnce",r.ADD="$add",r.APPEND="$append",r.PREPEND="$prepend",r.REMOVE="$remove",r.PREINSERT="$preInsert",r.POSTINSERT="$postInsert",r.UNSET="$unset",r.CLEAR_ALL="$clearAll",(s=X||(X={})).IDENTIFY="$identify",s.GROUP_IDENTIFY="$groupidentify",s.REVENUE="revenue_amount",(t=Y||(Y={}))[t.None=0]="None",t[t.Error=1]="Error",t[t.Warn=2]="Warn",t[t.Verbose=3]="Verbose",t[t.Debug=4]="Debug";var eV=function(a,b,c,d,e){return void 0===e&&(e=null),function(){for(var f=[],g=0;g<arguments.length;g++)f[g]=arguments[g];var h=c(),i=h.logger,j=h.logLevel;if(j&&j<Y.Debug||!j||!i)return a.apply(e,f);var k={type:"invoke public method",name:b,args:f,stacktrace:(Error().stack||"").split("\n").slice(3).map(function(a){return a.trim()}),time:{start:new Date().toISOString()},states:{}};d&&k.states&&(k.states.before=d());var l=a.apply(e,f);return l&&l.promise?l.promise.then(function(){d&&k.states&&(k.states.after=d()),k.time&&(k.time.end=new Date().toISOString()),i.debug(JSON.stringify(k,null,2))}):(d&&k.states&&(k.states.after=d()),k.time&&(k.time.end=new Date().toISOString()),i.debug(JSON.stringify(k,null,2))),l}},eW="".concat("AMP","_unsent"),eX="$default_instance",eY="https://api2.amplitude.com/2/httpapi",eZ="Amplitude Logger ",e$=function(){function a(){this.logLevel=Y.None}return a.prototype.disable=function(){this.logLevel=Y.None},a.prototype.enable=function(a){void 0===a&&(a=Y.Warn),this.logLevel=a},a.prototype.log=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];this.logLevel<Y.Verbose||console.log("".concat(eZ,"[Log]: ").concat(a.join(" ")))},a.prototype.warn=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];this.logLevel<Y.Warn||console.warn("".concat(eZ,"[Warn]: ").concat(a.join(" ")))},a.prototype.error=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];this.logLevel<Y.Error||console.error("".concat(eZ,"[Error]: ").concat(a.join(" ")))},a.prototype.debug=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];this.logLevel<Y.Debug||console.log("".concat(eZ,"[Debug]: ").concat(a.join(" ")))},a}(),e_=function(){return{flushMaxRetries:12,flushQueueSize:200,flushIntervalMillis:1e4,instanceName:eX,logLevel:Y.Warn,loggerProvider:new e$,offline:!1,optOut:!1,serverUrl:eY,serverZone:"US",useBatch:!1}},e0=function(){function a(a){this._optOut=!1;var b,c,d,e,f=e_();this.apiKey=a.apiKey,this.flushIntervalMillis=null!=(b=a.flushIntervalMillis)?b:f.flushIntervalMillis,this.flushMaxRetries=a.flushMaxRetries||f.flushMaxRetries,this.flushQueueSize=a.flushQueueSize||f.flushQueueSize,this.instanceName=a.instanceName||f.instanceName,this.loggerProvider=a.loggerProvider||f.loggerProvider,this.logLevel=null!=(c=a.logLevel)?c:f.logLevel,this.minIdLength=a.minIdLength,this.plan=a.plan,this.ingestionMetadata=a.ingestionMetadata,this.offline=void 0!==a.offline?a.offline:f.offline,this.optOut=null!=(d=a.optOut)?d:f.optOut,this.serverUrl=a.serverUrl,this.serverZone=a.serverZone||f.serverZone,this.storageProvider=a.storageProvider,this.transportProvider=a.transportProvider,this.useBatch=null!=(e=a.useBatch)?e:f.useBatch,this.loggerProvider.enable(this.logLevel);var g=e1(a.serverUrl,a.serverZone,a.useBatch);this.serverZone=g.serverZone,this.serverUrl=g.serverUrl}return Object.defineProperty(a.prototype,"optOut",{get:function(){return this._optOut},set:function(a){this._optOut=a},enumerable:!1,configurable:!0}),a}(),e1=function(a,b,c){if(void 0===a&&(a=""),void 0===b&&(b=e_().serverZone),void 0===c&&(c=e_().useBatch),a)return{serverUrl:a,serverZone:void 0};var d,e=["US","EU"].includes(b)?b:e_().serverZone;return{serverZone:e,serverUrl:(d=c,"EU"===e?d?"https://api.eu.amplitude.com/batch":"https://api.eu.amplitude.com/2/httpapi":d?"https://api2.amplitude.com/batch":eY)}};(function(){this.sdk={metrics:{histogram:{}}}}).prototype.recordHistogram=function(a,b){this.sdk.metrics.histogram[a]=b},(u=Z||(Z={})).Unknown="unknown",u.Skipped="skipped",u.Success="success",u.RateLimit="rate_limit",u.PayloadTooLarge="payload_too_large",u.Invalid="invalid",u.Failed="failed",u.Timeout="Timeout",u.SystemError="SystemError";var e2=function(){function a(){}return a.prototype.send=function(a,b){return Promise.resolve(null)},a.prototype.buildResponse=function(a){if("object"!=typeof a)return null;var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x=a.code||0,y=this.buildStatus(x);switch(y){case Z.Success:return{status:y,statusCode:x,body:{eventsIngested:null!=(b=a.events_ingested)?b:0,payloadSizeBytes:null!=(c=a.payload_size_bytes)?c:0,serverUploadTime:null!=(d=a.server_upload_time)?d:0}};case Z.Invalid:return{status:y,statusCode:x,body:{error:null!=(e=a.error)?e:"",missingField:null!=(f=a.missing_field)?f:"",eventsWithInvalidFields:null!=(g=a.events_with_invalid_fields)?g:{},eventsWithMissingFields:null!=(h=a.events_with_missing_fields)?h:{},eventsWithInvalidIdLengths:null!=(i=a.events_with_invalid_id_lengths)?i:{},epsThreshold:null!=(j=a.eps_threshold)?j:0,exceededDailyQuotaDevices:null!=(k=a.exceeded_daily_quota_devices)?k:{},silencedDevices:null!=(l=a.silenced_devices)?l:[],silencedEvents:null!=(m=a.silenced_events)?m:[],throttledDevices:null!=(n=a.throttled_devices)?n:{},throttledEvents:null!=(o=a.throttled_events)?o:[]}};case Z.PayloadTooLarge:return{status:y,statusCode:x,body:{error:null!=(p=a.error)?p:""}};case Z.RateLimit:return{status:y,statusCode:x,body:{error:null!=(q=a.error)?q:"",epsThreshold:null!=(r=a.eps_threshold)?r:0,throttledDevices:null!=(s=a.throttled_devices)?s:{},throttledUsers:null!=(t=a.throttled_users)?t:{},exceededDailyQuotaDevices:null!=(u=a.exceeded_daily_quota_devices)?u:{},exceededDailyQuotaUsers:null!=(v=a.exceeded_daily_quota_users)?v:{},throttledEvents:null!=(w=a.throttled_events)?w:[]}};case Z.Timeout:default:return{status:y,statusCode:x}}},a.prototype.buildStatus=function(a){return a>=200&&a<300?Z.Success:429===a?Z.RateLimit:413===a?Z.PayloadTooLarge:408===a?Z.Timeout:a>=400&&a<500?Z.Invalid:a>=500?Z.Failed:Z.Unknown},a}(),e3=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return(0,ah.__extends)(b,a),b.prototype.send=function(a,b){return(0,ah.__awaiter)(this,void 0,void 0,function(){var c,d;return(0,ah.__generator)(this,function(e){switch(e.label){case 0:if("u"<typeof fetch)throw Error("FetchTransport is not supported");return[4,fetch(a,{headers:{"Content-Type":"application/json",Accept:"*/*"},body:JSON.stringify(b),method:"POST"})];case 1:return[4,(c=e.sent()).text()];case 2:d=e.sent();try{return[2,this.buildResponse(JSON.parse(d))]}catch(a){return[2,this.buildResponse({code:c.status})]}}})})},b}(e2);(v=$||($={})).US="US",v.EU="EU",v.STAGING="STAGING";var e4="[Amplitude]",e5="".concat(e4," Session Replay ID"),e6=$.US,e7={enabled:!0},e8="".concat(e4," Session Replay Debug"),e9="amp-mask";(w=_||(_={})).GET_SR_PROPS="get-sr-props",w.DEBUG_INFO="debug-info",w.FETCH_REQUEST="fetch-request",w.METADATA="metadata",w.TARGETING_DECISION="targeting-decision";var fa=function(){function a(a){this.logger=a,this.log=this.getSafeMethod("log"),this.warn=this.getSafeMethod("warn"),this.error=this.getSafeMethod("error"),this.debug=this.getSafeMethod("debug")}return a.prototype.getSafeMethod=function(a){if(!this.logger)return function(){};var b,c=this.logger[a];return"function"==typeof c?(null!=(b=c.__rrweb_original__)?b:c).bind(this.logger):function(){}},a.prototype.enable=function(a){this.logger.enable(a)},a.prototype.disable=function(){this.logger.disable()},a}(),fb=a.i(872086),fc="medium",fd=function(a,b,c){switch(b){case"light":if("input"!==a)return!0;var d,e,f=c?(e=(d=c).type,d.hasAttribute("data-rr-is-password")?"password":e?e.toLowerCase():null):"";if(!f)return!1;if(["password","hidden","email","tel"].includes(f)||c.autocomplete.startsWith("cc-"))return!0;return!1;case"medium":case"conservative":return!0;default:return fd(a,fc,c)}},fe=function(a,b,c){var d,e,f;if(void 0===b&&(b={defaultMaskLevel:fc}),c){if(c.closest("."+e9)||(null!=(d=b.maskSelector)?d:[]).some(function(a){return c.closest(a)}))return!0;if(c.closest(".amp-unmask")||(null!=(e=b.unmaskSelector)?e:[]).some(function(a){return c.closest(a)}))return!1}return fd(a,null!=(f=b.defaultMaskLevel)?f:fc,c)},ff=function(a,b){return function(c,d){return fe(a,b,d)?c.replace(/[^\s]/g,"*"):c}},fg=function(){var a=(0,fb.getGlobalScope)();return(null==a?void 0:a.location)?a.location.href:""},fh=function(a,b){return b||(a===$.STAGING?"https://api-sr.stag2.amplitude.com/sessions/v2/track":a===$.EU?"https://api-sr.eu.amplitude.com/sessions/v2/track":"https://api-sr.amplitude.com/sessions/v2/track")},fi=function(a){var b=a.replace(/[.+^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*").replace(/\?/g,".");return new RegExp("^".concat(b,"$"))},fj=function(a){if(!a.every(function(a){return"string"==typeof a.selector&&"string"==typeof a.replacement}))throw Error("ugcFilterRules must be an array of objects with selector and replacement properties");if(!a.every(function(a){var b;return"string"==typeof(b=a.selector)&&""!==b.trim()&&!!/^\/|^https?:\/\/[^\s]+$/.test(b)}))throw Error("ugcFilterRules must be an array of objects with valid globs")},fk=function(a,b){var c,d;try{for(var e=(0,ah.__values)(b),f=e.next();!f.done;f=e.next()){var g=f.value,h=fi(g.selector);if(h.test(a))return a.replace(h,g.replacement)}}catch(a){c={error:a}}finally{try{f&&!f.done&&(d=e.return)&&d.call(e)}finally{if(c)throw c.error}}return a},fl=function(){return(0,ah.__awaiter)(void 0,void 0,void 0,function(){var a,b,c,d;return(0,ah.__generator)(this,function(e){switch(e.label){case 0:if(e.trys.push([0,3,,4]),!(a=(0,fb.getGlobalScope)()))return[3,2];return[4,a.navigator.storage.estimate()];case 1:return c=(b=e.sent()).usage,d=b.quota,[2,{totalStorageSize:c?Math.round(c/1024):0,percentOfQuota:c&&d?Math.round((c/d+Number.EPSILON)*1e3)/1e3:0,usageDetails:JSON.stringify(b.usageDetails)}];case 2:return[3,4];case 3:return e.sent(),[3,4];case 4:return[2,{totalStorageSize:0,percentOfQuota:0,usageDetails:""}]}})})},fm=function(a){var b=(0,ah.__assign)({},a),c=b.apiKey;return b.apiKey="****".concat(c.substring(c.length-4)),b},fn=function(){return{flushMaxRetries:2,logLevel:Y.Warn,loggerProvider:new e$,transportProvider:new e3}},fo=function(a){function b(b,c){var d,e,f,g,h,i=this,j=fn();return(i=a.call(this,(0,ah.__assign)((0,ah.__assign)({transportProvider:j.transportProvider,loggerProvider:new fa(c.loggerProvider||j.loggerProvider)},c),{apiKey:b}))||this).flushMaxRetries=void 0!==c.flushMaxRetries&&c.flushMaxRetries<=j.flushMaxRetries?c.flushMaxRetries:j.flushMaxRetries,i.apiKey=b,i.sampleRate=c.sampleRate||0,i.serverZone=c.serverZone||e6,i.configServerUrl=c.configServerUrl,i.trackServerUrl=c.trackServerUrl,i.shouldInlineStylesheet=c.shouldInlineStylesheet,i.version=c.version,i.performanceConfig=c.performanceConfig||e7,i.storeType=null!=(d=c.storeType)?d:"idb",i.applyBackgroundColorToBlockedElements=null!=(e=c.applyBackgroundColorToBlockedElements)&&e,i.enableUrlChangePolling=null!=(f=c.enableUrlChangePolling)&&f,i.urlChangePollingInterval=null!=(g=c.urlChangePollingInterval)?g:1e3,i.captureDocumentTitle=null!=(h=c.captureDocumentTitle)&&h,c.privacyConfig&&(i.privacyConfig=c.privacyConfig),c.interactionConfig&&(i.interactionConfig=c.interactionConfig,i.interactionConfig.ugcFilterRules&&fj(i.interactionConfig.ugcFilterRules)),c.debugMode&&(i.debugMode=c.debugMode),c.experimental&&(i.experimental=c.experimental),c.omitElementTags&&(i.omitElementTags=c.omitElementTags),i}return(0,ah.__extends)(b,a),b}(e0),fp=function(a){return{promise:a||Promise.resolve()}},fq=function(a){var b=0;if(0===a.length)return b;for(var c=0;c<a.length;c++)b=(b<<5)-b+a.charCodeAt(c)|0;return b},fr=((x=fr||{})[x.DomContentLoaded=0]="DomContentLoaded",x[x.Load=1]="Load",x[x.FullSnapshot=2]="FullSnapshot",x[x.IncrementalSnapshot=3]="IncrementalSnapshot",x[x.Meta=4]="Meta",x[x.Custom=5]="Custom",x[x.Plugin=6]="Plugin",x),fs=((y=fs||{})[y.Mutation=0]="Mutation",y[y.MouseMove=1]="MouseMove",y[y.MouseInteraction=2]="MouseInteraction",y[y.Scroll=3]="Scroll",y[y.ViewportResize=4]="ViewportResize",y[y.Input=5]="Input",y[y.TouchMove=6]="TouchMove",y[y.MediaInteraction=7]="MediaInteraction",y[y.StyleSheetRule=8]="StyleSheetRule",y[y.CanvasMutation=9]="CanvasMutation",y[y.Font=10]="Font",y[y.Log=11]="Log",y[y.Drag=12]="Drag",y[y.StyleDeclaration=13]="StyleDeclaration",y[y.Selection=14]="Selection",y[y.AdoptedStyleSheet=15]="AdoptedStyleSheet",y[y.CustomElement=16]="CustomElement",y),ft=((z=ft||{})[z.MouseUp=0]="MouseUp",z[z.MouseDown=1]="MouseDown",z[z.Click=2]="Click",z[z.ContextMenu=3]="ContextMenu",z[z.DblClick=4]="DblClick",z[z.Focus=5]="Focus",z[z.Blur=6]="Blur",z[z.TouchStart=7]="TouchStart",z[z.TouchMove_Departed=8]="TouchMove_Departed",z[z.TouchEnd=9]="TouchEnd",z[z.TouchCancel=10]="TouchCancel",z),fu=((A=fu||{})[A.Mouse=0]="Mouse",A[A.Pen=1]="Pen",A[A.Touch=2]="Touch",A),fv=((B=fv||{})[B["2D"]=0]="2D",B[B.WebGL=1]="WebGL",B[B.WebGL2=2]="WebGL2",B),fw=((C=fw||{})[C.Play=0]="Play",C[C.Pause=1]="Pause",C[C.Seeked=2]="Seeked",C[C.VolumeChange=3]="VolumeChange",C[C.RateChange=4]="RateChange",C),fx=((D=fx||{}).Start="start",D.Pause="pause",D.Resume="resume",D.Resize="resize",D.Finish="finish",D.FullsnapshotRebuilded="fullsnapshot-rebuilded",D.LoadStylesheetStart="load-stylesheet-start",D.LoadStylesheetEnd="load-stylesheet-end",D.SkipStart="skip-start",D.SkipEnd="skip-end",D.MouseInteraction="mouse-interaction",D.EventCast="event-cast",D.CustomEvent="custom-event",D.Flush="flush",D.StateChange="state-change",D.PlayBack="play-back",D.Destroy="destroy",D),fy=((E=fy||{})[E.Document=0]="Document",E[E.DocumentType=1]="DocumentType",E[E.Element=2]="Element",E[E.Text=3]="Text",E[E.CDATA=4]="CDATA",E[E.Comment=5]="Comment",E),fz=function(){function a(a,b){this.key="AMP_remote_config_".concat(a.substring(0,10)),this.logger=b}return a.prototype.fetchConfig=function(){var a=null,b={remoteConfig:null,lastFetch:new Date};try{a=localStorage.getItem(this.key)}catch(a){return this.logger.debug("Remote config localstorage failed to access: ",a),Promise.resolve(b)}if(null===a)return this.logger.debug("Remote config localstorage gets null because the key does not exist"),Promise.resolve(b);try{var c=JSON.parse(a);return this.logger.debug("Remote config localstorage parsed successfully: ".concat(JSON.stringify(c))),Promise.resolve({remoteConfig:c.remoteConfig,lastFetch:new Date(c.lastFetch)})}catch(a){return this.logger.debug("Remote config localstorage failed to parse: ",a),localStorage.removeItem(this.key),Promise.resolve(b)}},a.prototype.setConfig=function(a){try{return localStorage.setItem(this.key,JSON.stringify(a)),this.logger.debug("Remote config localstorage set successfully."),Promise.resolve(!0)}catch(a){this.logger.debug("Remote config localstorage failed to set: ",a)}return Promise.resolve(!1)},a}(),fA=(0,ah.__spreadArray)([],(0,ah.__read)(Array(256).keys()),!1).map(function(a){return a.toString(16).padStart(2,"0")}),fB=function(a){var b,c=(0,fb.getGlobalScope)();if(!(null==(b=null==c?void 0:c.crypto)?void 0:b.getRandomValues))return a?(a^16*Math.random()>>a/4).toString(16):(String(1e7)+String(-1e3)+String(-4e3)+String(-8e3)+String(-1e11)).replace(/[018]/g,fB);var d=c.crypto.getRandomValues(new Uint8Array(16));return d[6]=15&d[6]|64,d[8]=63&d[8]|128,(0,ah.__spreadArray)([],(0,ah.__read)(d.entries()),!1).map(function(a){var b=(0,ah.__read)(a,2),c=b[0],d=b[1];return[4,6,8,10].includes(c)?"-".concat(fA[d]):fA[d]}).join("")},fC=function(){function a(a,b,c,d){void 0===c&&(c="US"),this.callbackInfos=[],this.lastSuccessfulFetch=null,this.fetchPromise=null,this.apiKey=a,this.serverUrl=d||("US"===c?"https://sr-client-cfg.amplitude.com/config":"https://sr-client-cfg.eu.amplitude.com/config"),this.logger=b,this.storage=new fz(a,b)}return a.prototype.subscribe=function(a,b,c){var d=fB(),e={id:d,key:a,deliveryMode:b,callback:c};return this.callbackInfos.push(e),"all"===b?this.subscribeAll(e):this.subscribeWaitForRemote(e,b.timeout),d},a.prototype.unsubscribe=function(a){var b=this.callbackInfos.findIndex(function(b){return b.id===a});return -1===b?(this.logger.debug("Remote config client unsubscribe failed because callback with id ".concat(a," doesn't exist.")),!1):(this.callbackInfos.splice(b,1),this.logger.debug("Remote config client unsubscribe succeeded removing callback with id ".concat(a,".")),!0)},a.prototype.updateConfigs=function(){return(0,ah.__awaiter)(this,void 0,void 0,function(){var a,b=this;return(0,ah.__generator)(this,function(c){switch(c.label){case 0:if(this.lastSuccessfulFetch&&Date.now()-this.lastSuccessfulFetch<3e5)return this.logger.debug("Remote config client skipping updateConfigs: Too recent"),[2];return[4,this.getOrCreateFetchPromise()];case 1:return a=c.sent(),this.storage.setConfig(a),this.callbackInfos.forEach(function(c){b.sendCallback(c,a,"remote")}),[2]}})})},a.prototype.getOrCreateFetchPromise=function(){var a=this;return this.fetchPromise||(this.fetchPromise=this.fetch().then(function(b){return null!==b.remoteConfig&&(a.lastSuccessfulFetch=Date.now()),b}).finally(function(){a.fetchPromise=null})),this.fetchPromise},a.prototype.subscribeAll=function(a){return(0,ah.__awaiter)(this,void 0,void 0,function(){var b,c,d,e=this;return(0,ah.__generator)(this,function(f){switch(f.label){case 0:return b=this.getOrCreateFetchPromise().then(function(b){e.logger.debug("Remote config client subscription all mode fetched from remote: ".concat(JSON.stringify(b))),e.sendCallback(a,b,"remote"),e.storage.setConfig(b)}),c=this.storage.fetchConfig().then(function(a){return a}),[4,Promise.race([b,c])];case 1:return void 0!==(d=f.sent())&&(this.logger.debug("Remote config client subscription all mode fetched from cache: ".concat(JSON.stringify(d))),null!==d.remoteConfig?this.sendCallback(a,d,"cache"):this.logger.debug("Remote config client skips sending callback because cache is empty (first time user).")),[4,b];case 2:return f.sent(),[2]}})})},a.prototype.subscribeWaitForRemote=function(a,b){return(0,ah.__awaiter)(this,void 0,void 0,function(){var c,d;return(0,ah.__generator)(this,function(e){switch(e.label){case 0:c=new Promise(function(a,c){setTimeout(function(){c("Timeout exceeded")},b)}),e.label=1;case 1:return e.trys.push([1,3,,5]),[4,Promise.race([this.getOrCreateFetchPromise(),c])];case 2:return d=e.sent(),this.logger.debug("Remote config client subscription wait for remote mode returns from remote."),this.sendCallback(a,d,"remote"),this.storage.setConfig(d),[3,5];case 3:return e.sent(),this.logger.debug("Remote config client subscription wait for remote mode exceeded timeout. Try to fetch from cache."),[4,this.storage.fetchConfig()];case 4:return null!==(d=e.sent()).remoteConfig?(this.logger.debug("Remote config client subscription wait for remote mode returns a cached copy."),this.sendCallback(a,d,"cache")):(this.logger.debug("Remote config client subscription wait for remote mode failed to fetch cache."),this.sendCallback(a,d,"remote")),[3,5];case 5:return[2]}})})},a.prototype.sendCallback=function(a,b,c){var d;a.lastCallback=new Date,d=a.key?a.key.split(".").reduce(function(a,b){return null===a?a:b in a?a[b]:null},b.remoteConfig):b.remoteConfig,a.callback(d,c,b.lastFetch)},a.prototype.fetch=function(a,b){return void 0===a&&(a=3),void 0===b&&(b=1e3),(0,ah.__awaiter)(this,void 0,void 0,function(){var c,d,e,f,g,h,i=this;return(0,ah.__generator)(this,function(j){switch(j.label){case 0:c=b/a,d={remoteConfig:null,lastFetch:new Date},e=function(d){var e,g,h,j,k;return(0,ah.__generator)(this,function(l){switch(l.label){case 0:e=new AbortController,g=setTimeout(function(){return e.abort()},b),l.label=1;case 1:return l.trys.push([1,7,8,9]),[4,fetch(f.getUrlParams(),{method:"GET",headers:{Accept:"*/*"},signal:e.signal})];case 2:if((h=l.sent()).ok)return[3,4];return[4,h.text()];case 3:return j=l.sent(),f.logger.debug("Remote config client fetch with retry time ".concat(a," failed with ").concat(h.status,": ").concat(j)),[3,6];case 4:return[4,h.json()];case 5:return[2,{value:{remoteConfig:l.sent(),lastFetch:new Date}}];case 6:return[3,9];case 7:return(k=l.sent())instanceof Error&&"AbortError"===k.name?f.logger.debug("Remote config client fetch with retry time ".concat(a," timed out after ").concat(b,"ms")):f.logger.debug("Remote config client fetch with retry time ".concat(a," is rejected because: "),k),[3,9];case 8:return clearTimeout(g),[7];case 9:if(!(d<a-1))return[3,11];return[4,new Promise(function(a){return setTimeout(a,i.getJitterDelay(c))})];case 10:l.sent(),l.label=11;case 11:return[2]}})},f=this,g=0,j.label=1;case 1:if(!(g<a))return[3,4];return[5,e(g)];case 2:if("object"==typeof(h=j.sent()))return[2,h.value];j.label=3;case 3:return g++,[3,1];case 4:return[2,d]}})})},a.prototype.getJitterDelay=function(a){return Math.floor(Math.random()*a)},a.prototype.getUrlParams=function(){var b=encodeURIComponent(this.apiKey),c=new URLSearchParams;return c.append("config_group",a.CONFIG_GROUP),"".concat(this.serverUrl,"/").concat(b,"?").concat(c.toString())},a.CONFIG_GROUP="browser",a}(),fD=function(a,b){var c=document.createDocumentFragment(),d=function(a){if(void 0===a&&(a=[]),"string"==typeof a&&(a=[a]),0!==(a=a.filter(function(a){try{c.querySelector(a)}catch(c){return b.warn('[session-replay-browser] omitting selector "'.concat(a,'" because it is invalid')),!1}return!0})).length)return a};return a.blockSelector=d(a.blockSelector),a.maskSelector=d(a.maskSelector),a.unmaskSelector=d(a.unmaskSelector),a},fE=function(){function a(a,b){this.localConfig=b,this.remoteConfigClient=a}return a.prototype.generateJoinedConfig=function(){var a,b,c;return(0,ah.__awaiter)(this,void 0,void 0,function(){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u=this;return(0,ah.__generator)(this,function(v){switch(v.label){case 0:(d=(0,ah.__assign)({},this.localConfig)).optOut=this.localConfig.optOut,d.captureEnabled=!0,v.label=1;case 1:return v.trys.push([1,3,,4]),[4,new Promise(function(a,b){u.remoteConfigClient.subscribe("configs.sessionReplay","all",function(c,f){if(u.localConfig.loggerProvider.debug("Session Replay remote configuration received from ".concat(f,":"),JSON.stringify(c,null,2)),!c)return void b(Error("No remote config received"));var g,h=c.sr_sampling_config,i=c.sr_privacy_config,j=c.sr_targeting_config,k=null==(g=d.interactionConfig)?void 0:g.ugcFilterRules;d.interactionConfig=c.sr_interaction_config,d.interactionConfig&&k&&(d.interactionConfig.ugcFilterRules=k),d.loggingConfig=c.sr_logging_config,(h||i||j)&&(e={},h&&(e.sr_sampling_config=h),i&&(e.sr_privacy_config=i),j&&(e.sr_targeting_config=j)),a()})})];case 2:return v.sent(),[3,4];case 3:return f=v.sent(),this.localConfig.loggerProvider.error("Failed to generate joined config: ",f),d.captureEnabled=!1,[2,{localConfig:this.localConfig,joinedConfig:d,remoteConfig:void 0}];case 4:if(!e)return[2,{localConfig:this.localConfig,joinedConfig:d,remoteConfig:e}];if(g=e.sr_sampling_config,h=e.sr_privacy_config,i=e.sr_targeting_config,g&&Object.keys(g).length>0?(Object.prototype.hasOwnProperty.call(g,"capture_enabled")?d.captureEnabled=g.capture_enabled:d.captureEnabled=!1,Object.prototype.hasOwnProperty.call(g,"sample_rate")&&(d.sampleRate=g.sample_rate)):(d.captureEnabled=!0,this.localConfig.loggerProvider.debug("Remote config successfully fetched, but no values set for project, Session Replay capture enabled.")),h){j=null!=(a=d.privacyConfig)?a:{},k={defaultMaskLevel:null!=(c=null!=(b=h.defaultMaskLevel)?b:j.defaultMaskLevel)?c:"medium",blockSelector:[],maskSelector:[],unmaskSelector:[]},l=function(a){var b,c,d,e,f,g,h,i,j,k={};"string"==typeof a.blockSelector&&(a.blockSelector=[a.blockSelector]);try{for(var l=(0,ah.__values)(null!=(h=a.blockSelector)?h:[]),m=l.next();!m.done;m=l.next()){var n=m.value;k[n]="block"}}catch(a){b={error:a}}finally{try{m&&!m.done&&(c=l.return)&&c.call(l)}finally{if(b)throw b.error}}try{for(var o=(0,ah.__values)(null!=(i=a.maskSelector)?i:[]),p=o.next();!p.done;p=o.next()){var n=p.value;k[n]="mask"}}catch(a){d={error:a}}finally{try{p&&!p.done&&(e=o.return)&&e.call(o)}finally{if(d)throw d.error}}try{for(var q=(0,ah.__values)(null!=(j=a.unmaskSelector)?j:[]),r=q.next();!r.done;r=q.next()){var n=r.value;k[n]="unmask"}}catch(a){f={error:a}}finally{try{r&&!r.done&&(g=q.return)&&g.call(q)}finally{if(f)throw f.error}}return k},m=(0,ah.__assign)((0,ah.__assign)({},l(j)),l(h));try{for(o=(n=(0,ah.__values)(Object.entries(m))).next();!o.done;o=n.next())q=(p=(0,ah.__read)(o.value,2))[0],r=p[1],"mask"===r?k.maskSelector.push(q):"block"===r?k.blockSelector.push(q):"unmask"===r&&k.unmaskSelector.push(q)}catch(a){s={error:a}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}d.privacyConfig=fD(k,this.localConfig.loggerProvider)}return i&&Object.keys(i).length>0&&(d.targetingConfig=i),this.localConfig.loggerProvider.debug(JSON.stringify({name:"session replay joined config",config:fm(d)},null,2)),[2,{localConfig:this.localConfig,joinedConfig:d,remoteConfig:e}]}})})},a}(),fF=Uint8Array,fG=Uint16Array,fH=Uint32Array,fI=new fF([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fJ=new fF([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),fK=new fF([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),fL=function(a,b){for(var c=new fG(31),d=0;d<31;++d)c[d]=b+=1<<a[d-1];for(var e=new fH(c[30]),d=1;d<30;++d)for(var f=c[d];f<c[d+1];++f)e[f]=f-c[d]<<5|d;return[c,e]},fM=fL(fI,2),fN=fM[0],fO=fM[1];fN[28]=258,fO[258]=28;for(var fP=fL(fJ,0),fQ=(fP[0],fP[1]),fR=new fG(32768),fS=0;fS<32768;++fS){var fT=(43690&fS)>>>1|(21845&fS)<<1;fT=(61680&(fT=(52428&fT)>>>2|(13107&fT)<<2))>>>4|(3855&fT)<<4,fR[fS]=((65280&fT)>>>8|(255&fT)<<8)>>>1}for(var fU=function(a,b,c){for(var d,e=a.length,f=0,g=new fG(b);f<e;++f)++g[a[f]-1];var h=new fG(b);for(f=0;f<b;++f)h[f]=h[f-1]+g[f-1]<<1;if(c){d=new fG(1<<b);var i=15-b;for(f=0;f<e;++f)if(a[f])for(var j=f<<4|a[f],k=b-a[f],l=h[a[f]-1]++<<k,m=l|(1<<k)-1;l<=m;++l)d[fR[l]>>>i]=j}else for(f=0,d=new fG(e);f<e;++f)d[f]=fR[h[a[f]-1]++]>>>15-a[f];return d},fV=new fF(288),fS=0;fS<144;++fS)fV[fS]=8;for(var fS=144;fS<256;++fS)fV[fS]=9;for(var fS=256;fS<280;++fS)fV[fS]=7;for(var fS=280;fS<288;++fS)fV[fS]=8;for(var fW=new fF(32),fS=0;fS<32;++fS)fW[fS]=5;var fX=fU(fV,9,0),fY=fU(fW,5,0),fZ=function(a){return(a/8|0)+(7&a&&1)},f$=function(a,b,c){(null==c||c>a.length)&&(c=a.length);var d=new(a instanceof fG?fG:a instanceof fH?fH:fF)(c-b);return d.set(a.subarray(b,c)),d},f_=function(a,b,c){c<<=7&b;var d=b/8|0;a[d]|=c,a[d+1]|=c>>>8},f0=function(a,b,c){c<<=7&b;var d=b/8|0;a[d]|=c,a[d+1]|=c>>>8,a[d+2]|=c>>>16},f1=function(a,b){for(var c=[],d=0;d<a.length;++d)a[d]&&c.push({s:d,f:a[d]});var e=c.length,f=c.slice();if(!e)return[new fF(0),0];if(1==e){var g=new fF(c[0].s+1);return g[c[0].s]=1,[g,1]}c.sort(function(a,b){return a.f-b.f}),c.push({s:-1,f:25001});var h=c[0],i=c[1],j=0,k=1,l=2;for(c[0]={s:-1,f:h.f+i.f,l:h,r:i};k!=e-1;)h=c[c[j].f<c[l].f?j++:l++],i=c[j!=k&&c[j].f<c[l].f?j++:l++],c[k++]={s:-1,f:h.f+i.f,l:h,r:i};for(var m=f[0].s,d=1;d<e;++d)f[d].s>m&&(m=f[d].s);var n=new fG(m+1),o=f2(c[k-1],n,0);if(o>b){var d=0,p=0,q=o-b,r=1<<q;for(f.sort(function(a,b){return n[b.s]-n[a.s]||a.f-b.f});d<e;++d){var s=f[d].s;if(n[s]>b)p+=r-(1<<o-n[s]),n[s]=b;else break}for(p>>>=q;p>0;){var t=f[d].s;n[t]<b?p-=1<<b-n[t]++-1:++d}for(;d>=0&&p;--d){var u=f[d].s;n[u]==b&&(--n[u],++p)}o=b}return[new fF(n),o]},f2=function(a,b,c){return -1==a.s?Math.max(f2(a.l,b,c+1),f2(a.r,b,c+1)):b[a.s]=c},f3=function(a){for(var b=a.length;b&&!a[--b];);for(var c=new fG(++b),d=0,e=a[0],f=1,g=function(a){c[d++]=a},h=1;h<=b;++h)if(a[h]==e&&h!=b)++f;else{if(!e&&f>2){for(;f>138;f-=138)g(32754);f>2&&(g(f>10?f-11<<5|28690:f-3<<5|12305),f=0)}else if(f>3){for(g(e),--f;f>6;f-=6)g(8304);f>2&&(g(f-3<<5|8208),f=0)}for(;f--;)g(e);f=1,e=a[h]}return[c.subarray(0,d),b]},f4=function(a,b){for(var c=0,d=0;d<b.length;++d)c+=a[d]*b[d];return c},f5=function(a,b,c){var d=c.length,e=fZ(b+2);a[e]=255&d,a[e+1]=d>>>8,a[e+2]=255^a[e],a[e+3]=255^a[e+1];for(var f=0;f<d;++f)a[e+f+4]=c[f];return(e+4+d)*8},f6=function(a,b,c,d,e,f,g,h,i,j,k){f_(b,k++,c),++e[256];for(var l,m,n,o,p=f1(e,15),q=p[0],r=p[1],s=f1(f,15),t=s[0],u=s[1],v=f3(q),w=v[0],x=v[1],y=f3(t),z=y[0],A=y[1],B=new fG(19),C=0;C<w.length;++C)B[31&w[C]]++;for(var C=0;C<z.length;++C)B[31&z[C]]++;for(var D=f1(B,7),E=D[0],F=D[1],G=19;G>4&&!E[fK[G-1]];--G);var H=j+5<<3,I=f4(e,fV)+f4(f,fW)+g,J=f4(e,q)+f4(f,t)+g+14+3*G+f4(B,E)+(2*B[16]+3*B[17]+7*B[18]);if(H<=I&&H<=J)return f5(b,k,a.subarray(i,i+j));if(f_(b,k,1+(J<I)),k+=2,J<I){l=fU(q,r,0),m=q,n=fU(t,u,0),o=t;var K=fU(E,F,0);f_(b,k,x-257),f_(b,k+5,A-1),f_(b,k+10,G-4),k+=14;for(var C=0;C<G;++C)f_(b,k+3*C,E[fK[C]]);k+=3*G;for(var L=[w,z],M=0;M<2;++M)for(var N=L[M],C=0;C<N.length;++C){var O=31&N[C];f_(b,k,K[O]),k+=E[O],O>15&&(f_(b,k,N[C]>>>5&127),k+=N[C]>>>12)}}else l=fX,m=fV,n=fY,o=fW;for(var C=0;C<h;++C)if(d[C]>255){var O=d[C]>>>18&31;f0(b,k,l[O+257]),k+=m[O+257],O>7&&(f_(b,k,d[C]>>>23&31),k+=fI[O]);var P=31&d[C];f0(b,k,n[P]),k+=o[P],P>3&&(f0(b,k,d[C]>>>5&8191),k+=fJ[P])}else f0(b,k,l[d[C]]),k+=m[d[C]];return f0(b,k,l[256]),k+m[256]},f7=new fH([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),f8=function(a,b,c,d,e,f){var g=a.length,h=new fF(d+g+5*(1+Math.floor(g/7e3))+e),i=h.subarray(d,h.length-e),j=0;if(!b||g<8)for(var k=0;k<=g;k+=65535){var l=k+65535;l<g?j=f5(i,j,a.subarray(k,l)):(i[k]=f,j=f5(i,j,a.subarray(k,g)))}else{for(var m=f7[b-1],n=m>>>13,o=8191&m,p=(1<<c)-1,q=new fG(32768),r=new fG(p+1),s=Math.ceil(c/3),t=2*s,u=function(b){return(a[b]^a[b+1]<<s^a[b+2]<<t)&p},v=new fH(25e3),w=new fG(288),x=new fG(32),y=0,z=0,k=0,A=0,B=0,C=0;k<g;++k){var D=u(k),E=32767&k,F=r[D];if(q[E]=F,r[D]=E,B<=k){var G=g-k;if((y>7e3||A>24576)&&G>423){j=f6(a,i,0,v,w,x,z,A,C,k-C,j),A=y=z=0,C=k;for(var H=0;H<286;++H)w[H]=0;for(var H=0;H<30;++H)x[H]=0}var I=2,J=0,K=o,L=E-F&32767;if(G>2&&D==u(k-L))for(var M=Math.min(n,G)-1,N=Math.min(32767,k),O=Math.min(258,G);L<=N&&--K&&E!=F;){if(a[k+I]==a[k+I-L]){for(var P=0;P<O&&a[k+P]==a[k+P-L];++P);if(P>I){if(I=P,J=L,P>M)break;for(var Q=Math.min(L,P-2),R=0,H=0;H<Q;++H){var S=k-L+H+32768&32767,T=q[S],U=S-T+32768&32767;U>R&&(R=U,F=S)}}}F=q[E=F],L+=E-F+32768&32767}if(J){v[A++]=0x10000000|fO[I]<<18|fQ[J];var V=31&fO[I],W=31&fQ[J];z+=fI[V]+fJ[W],++w[257+V],++x[W],B=k+I,++y}else v[A++]=a[k],++w[a[k]]}}j=f6(a,i,f,v,w,x,z,A,C,k-C,j)}return f$(h,0,d+fZ(j)+e)},f9=function(){var a=1,b=0;return{p:function(c){for(var d=a,e=b,f=c.length,g=0;g!=f;){for(var h=Math.min(g+5552,f);g<h;++g)d+=c[g],e+=d;d%=65521,e%=65521}a=d,b=e},d:function(){return(a>>>8<<16|(255&b)<<8|b>>>8)+((255&a)<<23)*2}}},ga=function(a,b,c){for(;c;++b)a[b]=c,c>>>=8},gb=function(a,b){var c=b.level,d=0==c?0:c<6?1:9==c?3:2;a[0]=120,a[1]=d<<6|(d?32-2*d:1)},gc=function(){function a(a,b,c,d){var e,f=this;this.taskQueue=[],this.isProcessing=!1,this.compressEvent=function(a){var b,c,d,e,f;return JSON.stringify(function(a,b){var c="";if(!b&&"u">typeof TextDecoder)return new TextDecoder().decode(a);for(var d=0;d<a.length;){var e=a[d++];e<128||b?c+=String.fromCharCode(e):e<224?c+=String.fromCharCode((31&e)<<6|63&a[d++]):e<240?c+=String.fromCharCode((15&e)<<12|(63&a[d++])<<6|63&a[d++]):c+=String.fromCharCode(55296|(e=((15&e)<<18|(63&a[d++])<<12|(63&a[d++])<<6|63&a[d++])-65536)>>10,56320|1023&e)}return c}((b=function(a,b){var c=a.length;if("u">typeof TextEncoder)return new TextEncoder().encode(a);for(var d=new fF(a.length+(a.length>>>1)),e=0,f=function(a){d[e++]=a},g=0;g<c;++g){if(e+5>d.length){var h=new fF(e+8+(c-g<<1));h.set(d),d=h}var i=a.charCodeAt(g);i<128?f(i):(i<2048?f(192|i>>>6):(i>55295&&i<57344?(f(240|(i=65536+(1047552&i)|1023&a.charCodeAt(++g))>>>18),f(128|i>>>12&63)):f(224|i>>>12),f(128|i>>>6&63)),f(128|63&i))}return f$(d,0,e)}(JSON.stringify({...a,v:"v1"})),void 0===c&&(c={}),(d=f9()).p(b),gb(f=f8(b,null==(e=c).level?6:e.level,null==e.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(b.length)))):12+e.mem,2,4,!0),c),ga(f,f.length-4,d.d()),f),!0))},this.addCompressedEventToManager=function(a,b){f.eventsManager&&f.deviceId&&f.eventsManager.addEvent({event:{type:"replay",data:a},sessionId:b,deviceId:f.deviceId})},this.addCompressedEvent=function(a,b){if(f.worker)try{f.worker.postMessage({event:a,sessionId:b})}catch(c){"DataCloneError"===c.name?f.worker.postMessage(JSON.stringify({event:a,sessionId:b})):f.config.loggerProvider.warn("Unexpected error while posting message to worker:",c)}else{var c=f.compressEvent(a);f.addCompressedEventToManager(c,b)}},this.terminate=function(){var a;null==(a=f.worker)||a.terminate()};var g=(0,fb.getGlobalScope)();if(this.canUseIdleCallback=g&&"requestIdleCallback"in g,this.eventsManager=a,this.config=b,this.deviceId=c,this.timeout=(null==(e=b.performanceConfig)?void 0:e.timeout)||2e3,d){b.loggerProvider.log("[Experimental] Enabling web worker for compression");var h=new Worker(URL.createObjectURL(new Blob([d],{type:"application/javascript"})));h.onerror=function(a){b.loggerProvider.error(a)},h.onmessage=function(a){var b=a.data,c=b.compressedEvent,d=b.sessionId;f.addCompressedEventToManager(c,d)},this.worker=h}}return a.prototype.scheduleIdleProcessing=function(){var a=this;this.isProcessing||(this.isProcessing=!0,requestIdleCallback(function(b){a.processQueue(b)},{timeout:this.timeout}))},a.prototype.enqueueEvent=function(a,b){var c;this.canUseIdleCallback&&(null==(c=this.config.performanceConfig)?void 0:c.enabled)?(this.config.loggerProvider.debug("Enqueuing event for processing during idle time."),this.taskQueue.push({event:a,sessionId:b}),this.scheduleIdleProcessing()):(this.config.loggerProvider.debug("Processing event without idle callback."),this.addCompressedEvent(a,b))},a.prototype.processQueue=function(a){for(var b=this;this.taskQueue.length>0&&(a.timeRemaining()>0||a.didTimeout);){var c=this.taskQueue.shift();if(c){var d=c.event,e=c.sessionId;this.addCompressedEvent(d,e)}}this.taskQueue.length>0?requestIdleCallback(function(a){b.processQueue(a)},{timeout:this.timeout}):this.isProcessing=!1},a}(),gd="Failed to store session replay events in IndexedDB",ge="1.29.8",gf=function(){function a(a){var b=a.trackServerUrl,c=a.loggerProvider,d=a.payloadBatcher;this.storageKey="",this.retryTimeout=1e3,this.scheduled=null,this.queue=[],this.loggerProvider=c,this.payloadBatcher=d||function(a){return a},this.trackServerUrl=b}return a.prototype.sendEventsList=function(a){this.addToQueue((0,ah.__assign)((0,ah.__assign)({},a),{attempts:0,timeout:0}))},a.prototype.addToQueue=function(){for(var a=this,b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];b.filter(function(b){return b.attempts<(b.flushMaxRetries||0)?(b.attempts+=1,!0):(a.completeRequest({context:b,err:"Session replay event batch rejected due to exceeded retry count"}),!1)}).forEach(function(b){(a.queue=a.queue.concat(b),0===b.timeout)?a.schedule(0):setTimeout(function(){b.timeout=0,a.schedule(0)},b.timeout)})},a.prototype.schedule=function(a){var b=this;this.scheduled||(this.scheduled=setTimeout(function(){b.flush(!0).then(function(){b.queue.length>0&&b.schedule(a)})},a))},a.prototype.flush=function(a){return void 0===a&&(a=!1),(0,ah.__awaiter)(this,void 0,void 0,function(){var b,c,d=this;return(0,ah.__generator)(this,function(e){switch(e.label){case 0:return b=[],c=[],this.queue.forEach(function(a){return 0===a.timeout?b.push(a):c.push(a)}),this.queue=c,this.scheduled&&(clearTimeout(this.scheduled),this.scheduled=null),[4,Promise.all(b.map(function(b){return d.send(b,a)}))];case 1:return e.sent(),[2]}})})},a.prototype.send=function(a,b){var c,d;return void 0===b&&(b=!0),(0,ah.__awaiter)(this,void 0,void 0,function(){var e,f,g,h,i,j,k,l,m,n,o,p;return(0,ah.__generator)(this,function(q){switch(q.label){case 0:if(!(e=a.apiKey))return[2,this.completeRequest({context:a,err:"Session replay event batch not sent due to missing api key"})];if(!(f=a.deviceId))return[2,this.completeRequest({context:a,err:"Session replay event batch not sent due to missing device ID"})];if(g=fg(),h=ge,i=a.sampleRate,j=new URLSearchParams({device_id:f,session_id:"".concat(a.sessionId),type:"".concat(a.type)}),k="".concat((null==(c=a.version)?void 0:c.type)||"standalone","/").concat((null==(d=a.version)?void 0:d.version)||h),0===(l=this.payloadBatcher({version:1,events:a.events})).events.length)return this.completeRequest({context:a}),[2];q.label=1;case 1:return q.trys.push([1,3,,4]),m={headers:{"Content-Type":"application/json",Accept:"*/*",Authorization:"Bearer ".concat(e),"X-Client-Version":h,"X-Client-Library":k,"X-Client-Url":g.substring(0,1e3),"X-Client-Sample-Rate":"".concat(i)},body:JSON.stringify(l),method:"POST"},[4,fetch("".concat(fh(a.serverZone,this.trackServerUrl),"?").concat(j.toString()),m)];case 2:if(null===(n=q.sent()))return this.completeRequest({context:a,err:"Unexpected error occurred"}),[2];if(b)this.handleReponse(n.status,a);else{o="";try{o=JSON.stringify(n.body,null,2)}catch(a){}this.completeRequest({context:a,success:"".concat(n.status,": ").concat(o)})}return[3,4];case 3:return p=q.sent(),this.completeRequest({context:a,err:p}),[3,4];case 4:return[2]}})})},a.prototype.handleReponse=function(a,b){switch(new e2().buildStatus(a)){case Z.Success:this.handleSuccessResponse(b);break;case Z.Failed:this.handleOtherResponse(b);break;default:this.completeRequest({context:b,err:"Network error occurred, event batch rejected"})}},a.prototype.handleSuccessResponse=function(a){var b=Math.round(new Blob(a.events).size/1024);this.completeRequest({context:a,success:"Session replay event batch tracked successfully for session id ".concat(a.sessionId,", size of events: ").concat(b," KB")})},a.prototype.handleOtherResponse=function(a){this.addToQueue((0,ah.__assign)((0,ah.__assign)({},a),{timeout:a.attempts*this.retryTimeout}))},a.prototype.completeRequest=function(a){var b=a.context,c=a.err,d=a.success;b.onComplete(),c?this.loggerProvider.warn(c):d&&this.loggerProvider.log(d)},a}();let gg=(a,b)=>b.some(b=>a instanceof b),gh=new WeakMap,gi=new WeakMap,gj=new WeakMap,gk={get(a,b,c){if(a instanceof IDBTransaction){if("done"===b)return gh.get(a);if("store"===b)return c.objectStoreNames[1]?void 0:c.objectStore(c.objectStoreNames[0])}return gl(a[b])},set:(a,b,c)=>(a[b]=c,!0),has:(a,b)=>a instanceof IDBTransaction&&("done"===b||"store"===b)||b in a};function gl(a){if(a instanceof IDBRequest){let b;return b=new Promise((b,c)=>{let d=()=>{a.removeEventListener("success",e),a.removeEventListener("error",f)},e=()=>{b(gl(a.result)),d()},f=()=>{c(a.error),d()};a.addEventListener("success",e),a.addEventListener("error",f)}),gj.set(b,a),b}if(gi.has(a))return gi.get(a);let b=function(a){if("function"==typeof a)return(d||(d=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(a)?function(...b){return a.apply(gm(this),b),gl(this.request)}:function(...b){return gl(a.apply(gm(this),b))};return(a instanceof IDBTransaction&&function(a){if(gh.has(a))return;let b=new Promise((b,c)=>{let d=()=>{a.removeEventListener("complete",e),a.removeEventListener("error",f),a.removeEventListener("abort",f)},e=()=>{b(),d()},f=()=>{c(a.error||new DOMException("AbortError","AbortError")),d()};a.addEventListener("complete",e),a.addEventListener("error",f),a.addEventListener("abort",f)});gh.set(a,b)}(a),gg(a,c||(c=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(a,gk):a}(a);return b!==a&&(gi.set(a,b),gj.set(b,a)),b}let gm=a=>gj.get(a);function gn(a,b,{blocked:c,upgrade:d,blocking:e,terminated:f}={}){let g=indexedDB.open(a,b),h=gl(g);return d&&g.addEventListener("upgradeneeded",a=>{d(gl(g.result),a.oldVersion,a.newVersion,gl(g.transaction),a)}),c&&g.addEventListener("blocked",a=>c(a.oldVersion,a.newVersion,a)),h.then(a=>{f&&a.addEventListener("close",()=>f()),e&&a.addEventListener("versionchange",a=>e(a.oldVersion,a.newVersion,a))}).catch(()=>{}),h}let go=["get","getKey","getAll","getAllKeys","count"],gp=["put","add","delete","clear"],gq=new Map;function gr(a,b){if(!(a instanceof IDBDatabase&&!(b in a)&&"string"==typeof b))return;if(gq.get(b))return gq.get(b);let c=b.replace(/FromIndex$/,""),d=b!==c,e=gp.includes(c);if(!(c in(d?IDBIndex:IDBObjectStore).prototype)||!(e||go.includes(c)))return;let f=async function(a,...b){let f=this.transaction(a,e?"readwrite":"readonly"),g=f.store;return d&&(g=g.index(b.shift())),(await Promise.all([g[c](...b),e&&f.done]))[0]};return gq.set(b,f),f}gk={...e=gk,get:(a,b,c)=>gr(a,b)||e.get(a,b,c),has:(a,b)=>!!gr(a,b)||e.has(a,b)};let gs=["continue","continuePrimaryKey","advance"],gt={},gu=new WeakMap,gv=new WeakMap,gw={get(a,b){if(!gs.includes(b))return a[b];let c=gt[b];return c||(c=gt[b]=function(...a){gu.set(this,gv.get(this)[b](...a))}),c}};async function*gx(...a){let b=this;if(b instanceof IDBCursor||(b=await b.openCursor(...a)),!b)return;let c=new Proxy(b,gw);for(gv.set(c,b),gj.set(c,gm(b));b;)yield c,b=await (gu.get(c)||b.continue()),gu.delete(c)}function gy(a,b){return b===Symbol.asyncIterator&&gg(a,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===b&&gg(a,[IDBIndex,IDBObjectStore])}gk={...f=gk,get:(a,b,c)=>gy(a,b)?gx:f.get(a,b,c),has:(a,b)=>gy(a,b)||f.has(a,b)};var gz=function(){function a(a){var b,c,d,e=this;this.minInterval=500,this.maxInterval=1e4,this.maxPersistedEventsSize=1e6,this.interval=this.minInterval,this._timeAtLastSplit=Date.now(),this.shouldSplitEventsList=function(a,b){var c=e.getStringSize(b);return e.getEventsArraySize(a)+c>=e.maxPersistedEventsSize||Date.now()-e.timeAtLastSplit>e.interval&&!!a.length&&(e.interval=Math.min(e.maxInterval,e.interval+e.minInterval),e._timeAtLastSplit=Date.now(),!0)},this.loggerProvider=a.loggerProvider,this.minInterval=null!=(b=a.minInterval)?b:this.minInterval,this.maxInterval=null!=(c=a.maxInterval)?c:this.maxInterval,this.maxPersistedEventsSize=null!=(d=a.maxPersistedEventsSize)?d:this.maxPersistedEventsSize}return Object.defineProperty(a.prototype,"timeAtLastSplit",{get:function(){return this._timeAtLastSplit},enumerable:!1,configurable:!0}),a.prototype.getStringSize=function(a){return a.length},a.prototype.getEventsArraySize=function(a){var b,c,d=0;try{for(var e=(0,ah.__values)(a),f=e.next();!f.done;f=e.next()){var g=f.value;d+=this.getStringSize(g)}}catch(a){b={error:a}}finally{try{f&&!f.done&&(c=e.return)&&c.call(e)}finally{if(b)throw b.error}}return d+(2+Math.max(0,a.length-1)+2*a.length)},a}();(F=aa||(aa={})).RECORDING="recording",F.SENT="sent";var gA="sessionCurrentSequence",gB="sequencesToSend",gC=function(){var a=(0,fb.getGlobalScope)();return new Promise(function(b,c){if(!a)return c(Error("Global scope not found"));if(!a.indexedDB)return c(Error("Session Replay: cannot find indexedDB"));try{var d=a.indexedDB.open("keyval-store");d.onupgradeneeded=function(){1===d.result.version&&(d.result.close(),d.transaction&&d.transaction.abort(),a.indexedDB.deleteDatabase("keyval-store"),b())},d.onsuccess=function(){b(d.result)},d.onerror=function(){c(d.error)}}catch(a){c(a)}})},gD=function(a){return(0,ah.__awaiter)(void 0,void 0,void 0,function(){return(0,ah.__generator)(this,function(b){switch(b.label){case 0:if(!(a.length>0))return[3,2];return[4,Promise.all(a.splice(0,10))];case 1:return b.sent(),[3,0];case 2:return[2]}})})},gE=function(a){var b,c;return a.objectStoreNames.contains(gA)||(c=a.createObjectStore(gA,{keyPath:"sessionId"})),a.objectStoreNames.contains(gB)||(b=a.createObjectStore(gB,{keyPath:"sequenceId",autoIncrement:!0})).createIndex("sessionId","sessionId"),{sequencesStore:b,currentSequenceStore:c}},gF=function(a){function b(b){var c=a.call(this,b)||this;return c.getSequencesToSend=function(){return(0,ah.__awaiter)(c,void 0,void 0,function(){var a,b,c,d,e,f;return(0,ah.__generator)(this,function(g){switch(g.label){case 0:return g.trys.push([0,5,,6]),a=[],[4,this.db.transaction("sequencesToSend").store.openCursor()];case 1:b=g.sent(),g.label=2;case 2:if(!b)return[3,4];return d=(c=b.value).sessionId,e=c.events,a.push({events:e,sequenceId:b.key,sessionId:d}),[4,b.continue()];case 3:return b=g.sent(),[3,2];case 4:return[2,a];case 5:return f=g.sent(),this.loggerProvider.warn("".concat(gd,": ").concat(f)),[3,6];case 6:return[2,void 0]}})})},c.storeCurrentSequence=function(a){return(0,ah.__awaiter)(c,void 0,void 0,function(){var b,c,d;return(0,ah.__generator)(this,function(e){switch(e.label){case 0:return e.trys.push([0,4,,5]),[4,this.db.get(gA,a)];case 1:if(!(b=e.sent()))return[2,void 0];return[4,this.db.put(gB,{sessionId:a,events:b.events})];case 2:return c=e.sent(),[4,this.db.put(gA,{sessionId:a,events:[]})];case 3:return e.sent(),[2,(0,ah.__assign)((0,ah.__assign)({},b),{sessionId:a,sequenceId:c})];case 4:return d=e.sent(),this.loggerProvider.warn("".concat(gd,": ").concat(d)),[3,5];case 5:return[2,void 0]}})})},c.addEventToCurrentSequence=function(a,b){return(0,ah.__awaiter)(c,void 0,void 0,function(){var c,d,e,f,g,h;return(0,ah.__generator)(this,function(i){switch(i.label){case 0:return i.trys.push([0,10,,11]),[4,(c=this.db.transaction(gA,"readwrite")).store.get(a)];case 1:if(d=i.sent())return[3,3];return[4,c.store.put({sessionId:a,events:[b]})];case 2:return i.sent(),[2];case 3:if(e=void 0,!this.shouldSplitEventsList(d.events,b))return[3,5];return e=d.events,[4,c.store.put({sessionId:a,events:[b]})];case 4:return i.sent(),[3,7];case 5:return f=d.events.concat(b),[4,c.store.put({sessionId:a,events:f})];case 6:i.sent(),i.label=7;case 7:return[4,c.done];case 8:if(i.sent(),!e)return[2,void 0];return[4,this.storeSendingEvents(a,e)];case 9:if(!(g=i.sent()))return[2,void 0];return[2,{events:e,sessionId:a,sequenceId:g}];case 10:return h=i.sent(),this.loggerProvider.warn("".concat(gd,": ").concat(h)),[3,11];case 11:return[2,void 0]}})})},c.storeSendingEvents=function(a,b){return(0,ah.__awaiter)(c,void 0,void 0,function(){var c;return(0,ah.__generator)(this,function(d){switch(d.label){case 0:return d.trys.push([0,2,,3]),[4,this.db.put(gB,{sessionId:a,events:b})];case 1:return[2,d.sent()];case 2:return c=d.sent(),this.loggerProvider.warn("".concat(gd,": ").concat(c)),[3,3];case 3:return[2,void 0]}})})},c.cleanUpSessionEventsStore=function(a,b){return(0,ah.__awaiter)(c,void 0,void 0,function(){var a;return(0,ah.__generator)(this,function(c){switch(c.label){case 0:if(!b)return[2];c.label=1;case 1:return c.trys.push([1,3,,4]),[4,this.db.delete(gB,b)];case 2:return c.sent(),[3,4];case 3:return a=c.sent(),this.loggerProvider.warn("".concat(gd,": ").concat(a)),[3,4];case 4:return[2]}})})},c.transitionFromKeyValStore=function(a){return(0,ah.__awaiter)(c,void 0,void 0,function(){var b,c,d,e,f,g,h,i=this;return(0,ah.__generator)(this,function(j){switch(j.label){case 0:return j.trys.push([0,6,,7]),[4,gC()];case 1:if(!(b=j.sent()))return[2];c=function(a,b){return(0,ah.__awaiter)(i,void 0,void 0,function(){var c,d,e=this;return(0,ah.__generator)(this,function(f){switch(f.label){case 0:return c=b.sessionSequences,d=[],Object.keys(c).forEach(function(f){var g=parseInt(f,10),h=c[g];if(g===b.currentSequenceId){var i=h.events.map(function(b){return(0,ah.__awaiter)(e,void 0,void 0,function(){return(0,ah.__generator)(this,function(c){return[2,this.addEventToCurrentSequence(a,b)]})})});d.push.apply(d,(0,ah.__spreadArray)([],(0,ah.__read)(i),!1))}else h.status!==aa.SENT&&d.push(e.storeSendingEvents(a,h.events))}),[4,gD(d)];case 1:return f.sent(),[2]}})})},d="".concat(eW,"_").concat(this.apiKey.substring(0,10)),j.label=2;case 2:return j.trys.push([2,4,,5]),e=b.transaction("keyval").objectStore("keyval").getAll(d),[4,new Promise(function(b){e.onsuccess=function(d){return(0,ah.__awaiter)(i,void 0,void 0,function(){var e,f,g,h=this;return(0,ah.__generator)(this,function(i){switch(i.label){case 0:if(!(f=(e=d&&d.target.result)&&e[0]))return[3,2];return g=[],Object.keys(f).forEach(function(b){var d=parseInt(b,10),e=f[d];if(a===d)g.push(c(d,e));else{var i=e.sessionSequences;Object.keys(i).forEach(function(a){var b=parseInt(a,10);i[b].status!==aa.SENT&&g.push(h.storeSendingEvents(d,i[b].events))})}}),[4,gD(g)];case 1:i.sent(),i.label=2;case 2:return b(),[2]}})})}})];case 3:return j.sent(),(f=(0,fb.getGlobalScope)())&&f.indexedDB.deleteDatabase("keyval-store"),[3,5];case 4:return g=j.sent(),this.loggerProvider.warn("Failed to transition session replay events from keyval to new store: ".concat(g)),[3,5];case 5:return[3,7];case 6:return h=j.sent(),this.loggerProvider.warn("Failed to access keyval store: ".concat(h,". For more information, visit: https://www.docs.developers.amplitude.com/session-replay/sdks/standalone/#indexeddb-best-practices")),[3,7];case 7:return[2]}})})},c.apiKey=b.apiKey,c.db=b.db,c}return(0,ah.__extends)(b,a),b.new=function(a,c,d){return(0,ah.__awaiter)(this,void 0,void 0,function(){var e,f,g,h;return(0,ah.__generator)(this,function(i){switch(i.label){case 0:var j;return i.trys.push([0,3,,4]),e="replay"===a?"":"_".concat(a),[4,(j="".concat(c.apiKey.substring(0,10),"_amp_session_replay_events").concat(e),(0,ah.__awaiter)(void 0,void 0,void 0,function(){return(0,ah.__generator)(this,function(a){switch(a.label){case 0:return[4,gn(j,1,{upgrade:gE})];case 1:return[2,a.sent()]}})}))];case 1:return f=i.sent(),[4,(g=new b((0,ah.__assign)((0,ah.__assign)({},c),{db:f}))).transitionFromKeyValStore(d)];case 2:return i.sent(),[2,g];case 3:return h=i.sent(),c.loggerProvider.warn("".concat(gd,": ").concat(h)),[3,4];case 4:return[2]}})})},b.prototype.getCurrentSequenceEvents=function(a){return(0,ah.__awaiter)(this,void 0,void 0,function(){var b,c,d,e,f,g;return(0,ah.__generator)(this,function(h){switch(h.label){case 0:if(!a)return[3,2];return[4,this.db.get("sessionCurrentSequence",a)];case 1:if(!(b=h.sent()))return[2,void 0];return[2,[b]];case 2:c=[],h.label=3;case 3:return h.trys.push([3,8,9,10]),[4,this.db.getAll("sessionCurrentSequence")];case 4:e=(d=ah.__values.apply(void 0,[h.sent()])).next(),h.label=5;case 5:if(e.done)return[3,7];b=e.value,c.push(b),h.label=6;case 6:return e=d.next(),[3,5];case 7:return[3,10];case 8:return f={error:h.sent()},[3,10];case 9:try{e&&!e.done&&(g=d.return)&&g.call(d)}finally{if(f)throw f.error}return[7];case 10:return[2,c]}})})},b}(gz),gG=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.finalizedSequences={},b.sequences={},b.sequenceId=0,b}return(0,ah.__extends)(b,a),b.prototype.resetCurrentSequence=function(a){this.sequences[a]=[]},b.prototype.addSequence=function(a){var b=this.sequenceId++,c=(0,ah.__spreadArray)([],(0,ah.__read)(this.sequences[a]),!1);return this.finalizedSequences[b]={sessionId:a,events:c},this.resetCurrentSequence(a),{sequenceId:b,events:c,sessionId:a}},b.prototype.getSequencesToSend=function(){return(0,ah.__awaiter)(this,void 0,void 0,function(){return(0,ah.__generator)(this,function(a){return[2,Object.entries(this.finalizedSequences).map(function(a){var b=(0,ah.__read)(a,2),c=b[0],d=b[1],e=d.sessionId,f=d.events;return{sequenceId:Number(c),sessionId:e,events:f}})]})})},b.prototype.storeCurrentSequence=function(a){return(0,ah.__awaiter)(this,void 0,void 0,function(){return(0,ah.__generator)(this,function(b){return this.sequences[a]?[2,this.addSequence(a)]:[2,void 0]})})},b.prototype.addEventToCurrentSequence=function(a,b){return(0,ah.__awaiter)(this,void 0,void 0,function(){var c;return(0,ah.__generator)(this,function(d){return this.sequences[a]||this.resetCurrentSequence(a),this.shouldSplitEventsList(this.sequences[a],b)&&(c=this.addSequence(a)),this.sequences[a].push(b),[2,c]})})},b.prototype.storeSendingEvents=function(a,b){return(0,ah.__awaiter)(this,void 0,void 0,function(){return(0,ah.__generator)(this,function(c){return this.finalizedSequences[this.sequenceId]={sessionId:a,events:b},[2,this.sequenceId++]})})},b.prototype.cleanUpSessionEventsStore=function(a,b){return(0,ah.__awaiter)(this,void 0,void 0,function(){return(0,ah.__generator)(this,function(a){return void 0!==b&&delete this.finalizedSequences[b],[2]})})},b}(gz),gH=function(a){var b=a.config,c=a.sessionId,d=a.minInterval,e=a.maxInterval,f=a.type,g=a.payloadBatcher,h=a.storeType;return(0,ah.__awaiter)(void 0,void 0,void 0,function(){var a,i,j,k,l;function m(b){return void 0===b&&(b=!1),(0,ah.__awaiter)(this,void 0,void 0,function(){return(0,ah.__generator)(this,function(c){return[2,a.flush(b)]})})}return(0,ah.__generator)(this,function(n){switch(n.label){case 0:if(a=new gf((0,ah.__assign)((0,ah.__assign)({},b),{loggerProvider:b.loggerProvider,payloadBatcher:g})),i=function(){return new gG({loggerProvider:b.loggerProvider,maxInterval:e,minInterval:d})},"idb"!==h)return[3,2];return[4,(0,ah.__awaiter)(void 0,void 0,void 0,function(){var a;return(0,ah.__generator)(this,function(g){switch(g.label){case 0:return[4,gF.new(f,{loggerProvider:b.loggerProvider,minInterval:d,maxInterval:e,apiKey:b.apiKey},c)];case 1:return a=g.sent(),b.loggerProvider.log("Failed to initialize idb store, falling back to memory store."),[2,null!=a?a:i()]}})})];case 1:return k=n.sent(),[3,3];case 2:k=i(),n.label=3;case 3:return j=k,l=function(c){var d=c.events,e=c.sessionId,g=c.deviceId,h=c.sequenceId;b.debugMode&&fl().then(function(a){var c=a.totalStorageSize,d=a.percentOfQuota,e=a.usageDetails;b.loggerProvider.debug("Total storage size: ".concat(c," KB, percentage of quota: ").concat(d,"%, usage details: ").concat(e))}).catch(function(){}),a.sendEventsList({events:d,sessionId:e,flushMaxRetries:b.flushMaxRetries,apiKey:b.apiKey,deviceId:g,sampleRate:b.sampleRate,serverZone:b.serverZone,version:b.version,type:f,onComplete:function(){return(0,ah.__awaiter)(void 0,void 0,void 0,function(){return(0,ah.__generator)(this,function(a){switch(a.label){case 0:return[4,j.cleanUpSessionEventsStore(e,h)];case 1:return a.sent(),[2]}})})}})},[2,{sendCurrentSequenceEvents:function(a){var c=a.sessionId,d=a.deviceId;j.storeCurrentSequence(c).then(function(a){a&&l({sequenceId:a.sequenceId,events:a.events,sessionId:a.sessionId,deviceId:d})}).catch(function(a){b.loggerProvider.warn("Failed to get current sequence of session replay events for session:",a)})},addEvent:function(a){var c=a.event,d=a.sessionId,e=a.deviceId;j.addEventToCurrentSequence(d,c.data).then(function(a){return a&&l({sequenceId:a.sequenceId,events:a.events,sessionId:a.sessionId,deviceId:e})}).catch(function(a){b.loggerProvider.warn("Failed to add event to session replay capture:",a)})},sendStoredEvents:function(a){var b=a.deviceId;return(0,ah.__awaiter)(void 0,void 0,void 0,function(){var a;return(0,ah.__generator)(this,function(c){switch(c.label){case 0:return[4,j.getSequencesToSend()];case 1:return(a=c.sent())&&a.forEach(function(a){l({sequenceId:a.sequenceId,events:a.events,sessionId:a.sessionId,deviceId:b})}),[2]}})})},flush:m}]}})})},gI=function(){function a(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];var c=new Map;a.forEach(function(a){c.set(a.name,a.manager)}),this.managers=c}return a.prototype.sendStoredEvents=function(a){return(0,ah.__awaiter)(this,void 0,void 0,function(){var b;return(0,ah.__generator)(this,function(c){switch(c.label){case 0:return b=[],this.managers.forEach(function(c){b.push(c.sendStoredEvents(a))}),[4,Promise.all(b)];case 1:return c.sent(),[2]}})})},a.prototype.addEvent=function(a){var b,c=a.sessionId,d=a.event,e=a.deviceId;null==(b=this.managers.get(d.type))||b.addEvent({sessionId:c,event:d,deviceId:e})},a.prototype.sendCurrentSequenceEvents=function(a){var b=a.sessionId,c=a.deviceId;this.managers.forEach(function(a){a.sendCurrentSequenceEvents({sessionId:b,deviceId:c})})},a.prototype.flush=function(a){return(0,ah.__awaiter)(this,void 0,void 0,function(){var b;return(0,ah.__generator)(this,function(c){switch(c.label){case 0:return b=[],this.managers.forEach(function(c){b.push(c.flush(a))}),[4,Promise.all(b)];case 1:return c.sent(),[2]}})})},a}();function gJ(a,b,c){for(var d=null,e=[],f=a,g=0;f&&"break"!==function(){var a,h,i,j,k=new Date().getTime()-ad.getTime();if(void 0!==ab.timeoutMs&&k>ab.timeoutMs)throw Error("Timeout: Can't find a unique selector after ".concat(k,"ms"));var l=gR((a=f.getAttribute("id"))&&ab.idName(a)?{name:"#"+CSS.escape(a),penalty:0}:null)||gR.apply(void 0,(0,ah.__spreadArray)([],(0,ah.__read)(Array.from(f.attributes).filter(function(a){return ab.attr(a.name,a.value)}).map(function(a){return{name:"[".concat(CSS.escape(a.name),'="').concat(CSS.escape(a.value),'"]'),penalty:.5}})),!1))||gR.apply(void 0,(0,ah.__spreadArray)([],(0,ah.__read)(Array.from(f.classList).filter(ab.className).map(function(a){return{name:"."+CSS.escape(a),penalty:1}})),!1))||gR((h=f.tagName.toLowerCase(),ab.tagName(h)?{name:h,penalty:2}:null))||[gO()],m=function(a){var b=a.parentNode;if(!b)return null;var c=b.firstChild;if(!c)return null;for(var d=0;c&&(c.nodeType===Node.ELEMENT_NODE&&d++,c!==a);)c=c.nextSibling;return d}(f);if("all"==b)m&&(l=l.concat(l.filter(gQ).map(function(a){return gP(a,m)})));else if("two"==b)l=l.slice(0,1),m&&(l=l.concat(l.filter(gQ).map(function(a){return gP(a,m)})));else if("one"==b){var n=(0,ah.__read)(l=l.slice(0,1),1)[0];m&&gQ(n)&&(l=[gP(n,m)])}else"none"==b&&(l=[gO()],m&&(l=[gP(l[0],m)]));try{for(var o=(i=void 0,(0,ah.__values)(l)),p=o.next();!p.done;p=o.next()){var n=p.value;n.level=g}}catch(a){i={error:a}}finally{try{p&&!p.done&&(j=o.return)&&j.call(o)}finally{if(i)throw i.error}}if(e.push(l),e.length>=ab.seedMinLength&&(d=gK(e,c)))return"break";f=f.parentElement,g++}(););return(d||(d=gK(e,c)),!d&&c)?c():d}function gK(a,b){var c,d,e=gT(function a(b,c){var d,e,f,g,h;return void 0===c&&(c=[]),(0,ah.__generator)(this,function(i){switch(i.label){case 0:if(!(b.length>0))return[3,9];i.label=1;case 1:i.trys.push([1,6,7,8]),e=(d=(0,ah.__values)(b[0])).next(),i.label=2;case 2:if(e.done)return[3,5];return f=e.value,[5,(0,ah.__values)(a(b.slice(1,b.length),c.concat(f)))];case 3:i.sent(),i.label=4;case 4:return e=d.next(),[3,2];case 5:return[3,8];case 6:return g={error:i.sent()},[3,8];case 7:try{e&&!e.done&&(h=d.return)&&h.call(d)}finally{if(g)throw g.error}return[7];case 8:return[3,11];case 9:return[4,c];case 10:i.sent(),i.label=11;case 11:return[2]}})}(a));if(e.length>ab.threshold)return b?b():null;try{for(var f=(0,ah.__values)(e),g=f.next();!g.done;g=f.next()){var h=g.value;if(gN(h))return h}}catch(a){c={error:a}}finally{try{g&&!g.done&&(d=f.return)&&d.call(f)}finally{if(c)throw c.error}}return null}function gL(a){for(var b=a[0],c=b.name,d=1;d<a.length;d++){var e=a[d].level||0;c=b.level===e-1?"".concat(a[d].name," > ").concat(c):"".concat(a[d].name," ").concat(c),b=a[d]}return c}function gM(a){return a.map(function(a){return a.penalty}).reduce(function(a,b){return a+b},0)}function gN(a){var b=gL(a);switch(ac.querySelectorAll(b).length){case 0:throw Error("Can't select any node with this selector: ".concat(b));case 1:return!0;default:return!1}}function gO(){return{name:"*",penalty:3}}function gP(a,b){return{name:a.name+":nth-child(".concat(b,")"),penalty:a.penalty+1}}function gQ(a){return"html"!==a.name&&!a.name.startsWith("#")}function gR(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];var c=a.filter(gS);return c.length>0?c:null}function gS(a){return null!=a}function gT(a){return(0,ah.__spreadArray)([],(0,ah.__read)(a),!1).sort(function(a,b){return gM(a)-gM(b)})}var gU=function(a){var b=a.version,c=a.events,d=[];return c.forEach(function(a){var b=JSON.parse(a);b.count=1,"click"===b.type&&d.push(b)}),{version:b,events:d}},gV=function(a){var b=a.version,c=a.events,d=[];return c.forEach(function(a){var b=JSON.parse(a);"click"===b.type&&d.push(b)}),{version:b,events:Object.values(d.reduce(function(a,b){var c=b.x,d=b.y,e=b.selector,f=b.timestamp,g=f-f%36e5,h="".concat(c,":").concat(d,":").concat(null!=e?e:"",":").concat(g);return a[h]?a[h].count+=1:a[h]=(0,ah.__assign)((0,ah.__assign)({},b),{timestamp:g,count:1}),a},{}))}},gW=function(a,b){var c=this;this.createHook=function(a){var b=a.eventsManager,d=a.sessionId,e=a.deviceIdFn,f=a.mirror,g=a.ugcFilterRules;return function(a){if(a.type!==ft.Click)return;var h,i=(0,fb.getGlobalScope)();if(i){var j=i.location,k=i.innerHeight,l=i.innerWidth;if(j){var m=a.x,n=a.y;if(void 0!==m&&void 0!==n){var o=f.getNode(a.id);if(o)try{h=function(a,b){if(ad=new Date,a.nodeType!==Node.ELEMENT_NODE)throw Error("Can't generate CSS selector for non-element node type.");if("html"===a.tagName.toLowerCase())return"html";var c,d,e={root:document.body,idName:function(a){return!0},className:function(a){return!0},tagName:function(a){return!0},attr:function(a,b){return!1},seedMinLength:1,optimizedMinLength:2,threshold:1e3,maxNumberOfTries:1e4,timeoutMs:void 0};c=(ab=(0,ah.__assign)((0,ah.__assign)({},e),void 0)).root,d=e,ac=c.nodeType===Node.DOCUMENT_NODE?c:c===d.root?c.ownerDocument:c;var f=gJ(a,"all",function(){return gJ(a,"two",function(){return gJ(a,"one",function(){return gJ(a,"none")})})});if(f){var g=gT(function a(b,c,d){var e,f,g;return void 0===d&&(d={counter:0,visited:new Map}),(0,ah.__generator)(this,function(h){switch(h.label){case 0:if(!(b.length>2&&b.length>ab.optimizedMinLength))return[3,5];e=1,h.label=1;case 1:var i,j;if(!(e<b.length-1))return[3,5];if(d.counter>ab.maxNumberOfTries||(d.counter+=1,(f=(0,ah.__spreadArray)([],(0,ah.__read)(b),!1)).splice(e,1),g=gL(f),d.visited.has(g)))return[2];if(!(gN(f)&&(i=f,j=c,ac.querySelector(gL(i))===j)))return[3,4];return[4,f];case 2:return h.sent(),d.visited.set(g,!0),[5,(0,ah.__values)(a(f,c,d))];case 3:h.sent(),h.label=4;case 4:return e++,[3,1];case 5:return[2]}})}(f,a));return g.length>0&&(f=g[0]),gL(f)}throw Error("Selector was not found.")}(o)}catch(a){c.logger.debug("error resolving selector from finder")}var p=fk(j.href,g),q={x:m+c.scrollWatcher.currentScrollX,y:n+c.scrollWatcher.currentScrollY,selector:h,viewportHeight:k,viewportWidth:l,pageUrl:p,timestamp:Date.now(),type:"click"},r=e();r&&b.addEvent({sessionId:d,event:{type:"interaction",data:JSON.stringify(q)},deviceId:r})}}}}},this.logger=a,this.scrollWatcher=b};function gX(){var a=(0,fb.getGlobalScope)();return(null==a?void 0:a.innerHeight)||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight||0}function gY(){var a=(0,fb.getGlobalScope)();return(null==a?void 0:a.innerWidth)||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth||0}var gZ=function(){function a(a,b){var c=(0,fb.getGlobalScope)();c&&c.navigator&&"function"==typeof c.navigator.sendBeacon?this.sendBeacon=function(a,b){try{if(c.navigator.sendBeacon(a,JSON.stringify(b)))return!0}catch(a){}return!1}:this.sendBeacon=function(){return!1},this.sendXhr=function(a,b){var c=new XMLHttpRequest;return c.open("POST",a,!0),c.setRequestHeader("Accept","*/*"),c.send(JSON.stringify(b)),!0},this.basePageUrl=fh(b.serverZone,b.trackServerUrl),this.apiKey=b.apiKey,this.context=a}return a.prototype.send=function(a,b){var c=this.context,d=c.sessionId,e=c.type,f=new URLSearchParams({device_id:a,session_id:String(d),type:String(e),api_key:this.apiKey}),g="".concat(this.basePageUrl,"?").concat(f.toString());this.sendBeacon(g,b)||this.sendXhr(g,b)},a}(),g$=function(){function a(a,b){var c=this;this.timestamp=Date.now(),this.hook=function(a){c.update(a)},this.send=function(a){return function(b){var d,e,f=a(),g=(0,fb.getGlobalScope)();g&&f&&c.transport.send(f,{version:1,events:[{maxScrollX:c._maxScrollX,maxScrollY:c._maxScrollY,maxScrollWidth:c._maxScrollWidth,maxScrollHeight:c._maxScrollHeight,viewportHeight:gX(),viewportWidth:gY(),pageUrl:fk(g.location.href,null!=(e=null==(d=c.config.interactionConfig)?void 0:d.ugcFilterRules)?e:[]),timestamp:c.timestamp,type:"scroll"}]})}},this._maxScrollX=0,this._maxScrollY=0,this._currentScrollX=0,this._currentScrollY=0,this._maxScrollWidth=gY(),this._maxScrollHeight=gX(),this.config=b,this.transport=a}return a.default=function(b,c){return new a(new gZ(b,c),c)},Object.defineProperty(a.prototype,"maxScrollX",{get:function(){return this._maxScrollX},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"maxScrollY",{get:function(){return this._maxScrollY},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"maxScrollWidth",{get:function(){return this._maxScrollWidth},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"maxScrollHeight",{get:function(){return this._maxScrollHeight},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"currentScrollX",{get:function(){return this._currentScrollX},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"currentScrollY",{get:function(){return this._currentScrollY},enumerable:!1,configurable:!0}),a.prototype.update=function(a){var b=Date.now();if(this._currentScrollX=a.x,this._currentScrollY=a.y,a.x>this._maxScrollX){var c=gY();this._maxScrollX=a.x;var d=a.x+c;d>this._maxScrollWidth&&(this._maxScrollWidth=d),this.timestamp=b}if(a.y>this._maxScrollY){var e=gX();this._maxScrollY=a.y;var f=a.y+e;f>this._maxScrollHeight&&(this._maxScrollHeight=f),this.timestamp=b}},a}(),g_=function(a){var b=a.sessionId,c=a.deviceId;this.deviceId=c,this.sessionId=b,b&&c&&(this.sessionReplayId="".concat(c,"/").concat(b))},g0=new function(){var a=this;this.dbs={},this.createStore=function(b){return(0,ah.__awaiter)(a,void 0,void 0,function(){return(0,ah.__generator)(this,function(a){switch(a.label){case 0:return[4,gn(b,1,{upgrade:function(a){a.objectStoreNames.contains("sessionTargetingMatch")||a.createObjectStore("sessionTargetingMatch",{keyPath:"sessionId"})}})];case 1:return[2,a.sent()]}})})},this.openOrCreateDB=function(b){return(0,ah.__awaiter)(a,void 0,void 0,function(){var a,c;return(0,ah.__generator)(this,function(d){switch(d.label){case 0:if(this.dbs&&this.dbs[b])return[2,this.dbs[b]];return a="".concat(b.substring(0,10),"_amp_session_replay_targeting"),[4,this.createStore(a)];case 1:return c=d.sent(),this.dbs[b]=c,[2,c]}})})},this.getTargetingMatchForSession=function(b){var c=b.loggerProvider,d=b.apiKey,e=b.sessionId;return(0,ah.__awaiter)(a,void 0,void 0,function(){var a,b,f,g;return(0,ah.__generator)(this,function(h){switch(h.label){case 0:return h.trys.push([0,3,,4]),[4,this.openOrCreateDB(d)];case 1:return a=h.sent(),b=String(e),[4,a.get("sessionTargetingMatch",b)];case 2:return[2,null==(f=h.sent())?void 0:f.targetingMatch];case 3:return g=h.sent(),c.warn("Failed to get targeting match for session id ".concat(e,": ").concat(g)),[3,4];case 4:return[2,void 0]}})})},this.storeTargetingMatchForSession=function(b){var c=b.loggerProvider,d=b.apiKey,e=b.sessionId,f=b.targetingMatch;return(0,ah.__awaiter)(a,void 0,void 0,function(){var a,b,g;return(0,ah.__generator)(this,function(h){switch(h.label){case 0:return h.trys.push([0,3,,4]),[4,this.openOrCreateDB(d)];case 1:return a=h.sent(),b=String(e),[4,a.put("sessionTargetingMatch",{targetingMatch:f,sessionId:b,lastUpdated:Date.now()})];case 2:return[2,h.sent()];case 3:return g=h.sent(),c.warn("Failed to store targeting match for session id ".concat(e,": ").concat(g)),[3,4];case 4:return[2,void 0]}})})},this.clearStoreOfOldSessions=function(b){var c=b.loggerProvider,d=b.apiKey,e=b.currentSessionId;return(0,ah.__awaiter)(a,void 0,void 0,function(){var a,b,f,g,h,i,j,k;return(0,ah.__generator)(this,function(l){switch(l.label){case 0:return l.trys.push([0,8,,9]),[4,this.openOrCreateDB(d)];case 1:return a=l.sent(),b=String(e),[4,(f=a.transaction("sessionTargetingMatch","readwrite")).store.getAll()];case 2:g=l.sent(),h=0,l.label=3;case 3:if(!(h<g.length))return[3,6];if(i=g[h],j=Date.now()-i.lastUpdated,!(i.sessionId!==b&&j>1728e5))return[3,5];return[4,f.store.delete(i.sessionId)];case 4:l.sent(),l.label=5;case 5:return h++,[3,3];case 6:return[4,f.done];case 7:return l.sent(),[3,9];case 8:return k=l.sent(),c.warn("Failed to clear old targeting matches for sessions: ".concat(k)),[3,9];case 9:return[2]}})})}},g1=function(b){var c=b.sessionId,d=b.targetingConfig,e=b.loggerProvider,f=b.apiKey,g=b.targetingParams;return(0,ah.__awaiter)(void 0,void 0,void 0,function(){var b,h,i;return(0,ah.__generator)(this,function(j){switch(j.label){case 0:return[4,g0.clearStoreOfOldSessions({loggerProvider:e,apiKey:f,currentSessionId:c})];case 1:return j.sent(),[4,g0.getTargetingMatchForSession({loggerProvider:e,apiKey:f,sessionId:c})];case 2:if(!0===j.sent())return[2,!0];b=!0,j.label=3;case 3:return j.trys.push([3,6,,7]),[4,a.A(626319)];case 4:return[4,(0,j.sent().evaluateTargeting)((0,ah.__assign)((0,ah.__assign)({},g),{flag:d,sessionId:c,apiKey:f,loggerProvider:e}))];case 5:return(h=j.sent())&&h.sr_targeting_config&&(b="on"===h.sr_targeting_config.key),g0.storeTargetingMatchForSession({loggerProvider:e,apiKey:f,sessionId:c,targetingMatch:b}),[3,7];case 6:return i=j.sent(),e.warn(i.message),[3,7];case 7:return[2,b]}})})};function g2(a){return void 0===a&&(a={}),{name:"amplitude/url-tracking@1",observer:function(b,c,d){var e,f,g,h=(0,ah.__assign)((0,ah.__assign)({},a),d),i=h.ugcFilterRules||[],j=null!=(e=h.enablePolling)&&e,k=null!=(f=h.pollingInterval)?f:1e3,l=null!=(g=h.captureDocumentTitle)&&g;if(!c)return function(){};var m=void 0,n="__amplitude_url_tracking_patched__",o="__amplitude_url_tracking_reset__",p=function(){return c.location&&c.location.href||""},q=function(){var a=c.innerHeight,b=c.innerWidth,d=c.document,e=p(),f="";return l&&(f=(null==d?void 0:d.title)||""),{href:i.length>0?fk(e,i):e,title:f,viewportHeight:a,viewportWidth:b,type:"url-change-event"}},r=function(){var a=p();(void 0===m||a!==m)&&(m=a,b(q()))},s=function(a){var b=function(){for(var b=[],d=0;d<arguments.length;d++)b[d]=arguments[d];var e=a.apply(this,b);return c[o]||r(),e};return b[n]=!0,b},t=function(){r()};if(j){var u=c.setInterval(function(){r()},k);return r(),function(){u&&c.clearInterval(u)}}if(c.history){var v=c.history.pushState.bind(c.history),w=c.history.replaceState.bind(c.history);return c.history.pushState[n]||(c.history.pushState=s(v),c.history.replaceState=s(w)),c.addEventListener("popstate",r),c.addEventListener("hashchange",t),r(),function(){c[o]=!0,c.removeEventListener("popstate",r),c.removeEventListener("hashchange",t)}}return c.addEventListener("hashchange",t),r(),function(){c.removeEventListener("hashchange",t)}},options:a}}g2();var g3=function(){function b(){var a=this;this.name="@amplitude/session-replay-browser",this.recordCancelCallback=null,this.eventCount=0,this.sessionTargetingMatch=!1,this.pageLeaveFns=[],this.recordFunction=null,this.teardownEventListeners=function(b){var c=(0,fb.getGlobalScope)();c&&(c.removeEventListener("blur",a.blurListener),c.removeEventListener("focus",a.focusListener),b||c.addEventListener("blur",a.blurListener),b||c.addEventListener("focus",a.focusListener),c.self&&"onpagehide"in c.self?(c.removeEventListener("pagehide",a.pageLeaveListener),b||c.addEventListener("pagehide",a.pageLeaveListener)):(c.removeEventListener("beforeunload",a.pageLeaveListener),b||c.addEventListener("beforeunload",a.pageLeaveListener)))},this.blurListener=function(){a.sendEvents()},this.focusListener=function(){a.recordEvents(!1)},this.pageLeaveListener=function(b){a.pageLeaveFns.forEach(function(a){a(b)})},this.evaluateTargetingAndCapture=function(b,c,d){return void 0===c&&(c=!1),void 0===d&&(d=!1),(0,ah.__awaiter)(a,void 0,void 0,function(){var a,e;return(0,ah.__generator)(this,function(f){switch(f.label){case 0:if(!this.identifiers||!this.identifiers.sessionId||!this.config)return this.identifiers&&!this.identifiers.sessionId?this.loggerProvider.log("Session ID has not been set yet, cannot evaluate targeting for Session Replay."):this.loggerProvider.warn("Session replay init has not been called, cannot evaluate targeting."),[2];if(!this.config.targetingConfig)if(!c)return this.loggerProvider.log("No targeting config set, skipping initialization/recording for event."),[2];else this.loggerProvider.log("Targeting config has not been set yet, cannot evaluate targeting.");if(this.lastTargetingParams=b,!(this.config.targetingConfig&&!this.sessionTargetingMatch))return[3,2];return(a=b.event)&&Object.values(X).includes(a.event_type)&&(a=void 0),e=this,[4,g1({sessionId:this.identifiers.sessionId,targetingConfig:this.config.targetingConfig,loggerProvider:this.loggerProvider,apiKey:this.config.apiKey,targetingParams:{userProperties:b.userProperties,event:a}})];case 1:e.sessionTargetingMatch=f.sent(),this.loggerProvider.debug(JSON.stringify({name:"targeted replay capture config",sessionTargetingMatch:this.sessionTargetingMatch,event:a,targetingParams:b},null,2)),f.label=2;case 2:if(!c)return[3,3];return this.initialize(!0),[3,5];case 3:if(!(d||!this.recordCancelCallback))return[3,5];return this.loggerProvider.log("Recording events for session due to forceRestart or no ongoing recording."),[4,this.recordEvents()];case 4:f.sent(),f.label=5;case 5:return[2]}})})},this.addCustomRRWebEvent=function(b,c,d){return void 0===c&&(c={}),void 0===d&&(d=!0),(0,ah.__awaiter)(a,void 0,void 0,function(){var a,e,f,g;return(0,ah.__generator)(this,function(h){switch(h.label){case 0:if(h.trys.push([0,3,,4]),a=void 0,!((e=this.config)&&b!==_.METADATA)||(a={config:fm(e),version:ge},!d))return[3,2];return[4,fl()];case 1:f=h.sent(),a=(0,ah.__assign)((0,ah.__assign)({},f),a),h.label=2;case 2:return this.recordCancelCallback&&this.recordFunction?this.recordFunction.addCustomEvent(b,(0,ah.__assign)((0,ah.__assign)({},c),a)):this.loggerProvider.debug("Not able to add custom replay capture event ".concat(b," due to no ongoing recording.")),[3,4];case 3:return g=h.sent(),this.loggerProvider.debug("Error while adding custom replay capture event: ",g),[3,4];case 4:return[2]}})})},this.stopRecordingEvents=function(){var b;try{a.loggerProvider.log("Session Replay capture stopping."),a.recordCancelCallback&&a.recordCancelCallback(),a.recordCancelCallback=null,null==(b=a.networkObservers)||b.stop()}catch(b){a.loggerProvider.warn("Error occurred while stopping replay capture: ".concat(b.toString()))}},this.loggerProvider=new fa(new e$)}return b.prototype.init=function(a,b){return fp(this._init(a,b))},b.prototype._init=function(b,c){var d,e,f,g,h,i,j;return(0,ah.__awaiter)(this,void 0,void 0,function(){var k,l,m,n,o,p,q,r,s,t,u,v,w,x;return(0,ah.__generator)(this,function(y){switch(y.label){case 0:return this.loggerProvider=new fa(c.loggerProvider||new e$),Object.prototype.hasOwnProperty.call(c,"logLevel")&&this.loggerProvider.enable(c.logLevel),this.identifiers=new g_({sessionId:c.sessionId,deviceId:c.deviceId}),k=this,[4,(0,ah.__awaiter)(void 0,void 0,void 0,function(){var a;return(0,ah.__generator)(this,function(d){return a=new fo(b,c),[2,new fE(new fC(b,a.loggerProvider,a.serverZone,c.configServerUrl),a)]})})];case 1:return k.joinedConfigGenerator=y.sent(),[4,this.joinedConfigGenerator.generateJoinedConfig()];case 2:m=(l=y.sent()).joinedConfig,n=l.localConfig,o=l.remoteConfig,this.config=m,this.setMetadata(c.sessionId,m,n,o,null==(d=c.version)?void 0:d.version,ge,null==(e=c.version)?void 0:e.type),c.sessionId&&(null==(f=this.config.interactionConfig)?void 0:f.enabled)&&(p=g$.default({sessionId:c.sessionId,type:"interaction"},this.config),this.pageLeaveFns=[p.send(this.getDeviceId.bind(this)).bind(p)],this.scrollHook=p.hook.bind(p),this.clickHandler=new gW(this.loggerProvider,p)),q=[],"idb"!==(r=this.config.storeType)||(null==(g=(0,fb.getGlobalScope)())?void 0:g.indexedDB)||(r="memory",this.loggerProvider.warn("Could not use preferred indexedDB storage, reverting to in memory option.")),this.loggerProvider.log("Using ".concat(r," for event storage.")),y.label=3;case 3:return y.trys.push([3,5,,6]),[4,gH({config:this.config,sessionId:this.identifiers.sessionId,type:"replay",storeType:r})];case 4:return s=y.sent(),q.push({name:"replay",manager:s}),[3,6];case 5:return t=y.sent(),this.loggerProvider.warn("Error occurred while creating replay events manager: ".concat(t.toString())),[3,6];case 6:if(!(null==(h=this.config.interactionConfig)?void 0:h.enabled))return[3,10];u=this.config.interactionConfig.batch?gV:gU,y.label=7;case 7:return y.trys.push([7,9,,10]),[4,gH({config:this.config,sessionId:this.identifiers.sessionId,type:"interaction",minInterval:null!=(i=this.config.interactionConfig.trackEveryNms)?i:3e4,maxInterval:6e4,payloadBatcher:u,storeType:r})];case 8:return v=y.sent(),q.push({name:"interaction",manager:v}),[3,10];case 9:return t=y.sent(),this.loggerProvider.warn("Error occurred while creating interaction events manager: ".concat(t.toString())),[3,10];case 10:if(this.eventsManager=new(gI.bind.apply(gI,(0,ah.__spreadArray)([void 0],(0,ah.__read)(q),!1))),this.eventCompressor&&this.eventCompressor.terminate(),w=void 0,x=(0,fb.getGlobalScope)(),!((null==(j=this.config.experimental)?void 0:j.useWebWorker)&&x&&x.Worker))return[3,12];return[4,a.A(988202)];case 11:w=y.sent().compressionScript,y.label=12;case 12:return this.eventCompressor=new gc(this.eventsManager,this.config,this.getDeviceId(),w),[4,this.initializeNetworkObservers()];case 13:return y.sent(),this.loggerProvider.log("Installing @amplitude/session-replay-browser."),this.teardownEventListeners(!1),[4,this.evaluateTargetingAndCapture({userProperties:c.userProperties},!0)];case 14:return y.sent(),[2]}})})},b.prototype.setSessionId=function(a,b){return fp(this.asyncSetSessionId(a,b))},b.prototype.asyncSetSessionId=function(a,b,c){var d;return(0,ah.__awaiter)(this,void 0,void 0,function(){var e,f,g;return(0,ah.__generator)(this,function(h){switch(h.label){case 0:if(this.sessionTargetingMatch=!1,this.lastShouldRecordDecision=void 0,(e=this.identifiers&&this.identifiers.sessionId)&&this.sendEvents(e),f=b||this.getDeviceId(),this.identifiers=new g_({sessionId:a,deviceId:f}),!(this.joinedConfigGenerator&&e))return[3,2];return[4,this.joinedConfigGenerator.generateJoinedConfig()];case 1:g=h.sent().joinedConfig,this.config=g,h.label=2;case 2:if(!(null==(d=this.config)?void 0:d.targetingConfig))return[3,4];return[4,this.evaluateTargetingAndCapture({userProperties:null==c?void 0:c.userProperties},!1,!0)];case 3:return h.sent(),[3,6];case 4:return[4,this.recordEvents()];case 5:h.sent(),h.label=6;case 6:return[2]}})})},b.prototype.getSessionReplayProperties=function(){var a,b=this.config,c=this.identifiers;if(!b||!c)return this.loggerProvider.warn("Session replay init has not been called, cannot get session replay properties."),{};var d=this.getShouldRecord(),e={};return d&&((a={})[e5]=c.sessionReplayId?c.sessionReplayId:null,e=a,b.debugMode&&(e[e8]=JSON.stringify({appHash:fq(b.apiKey).toString()}))),this.addCustomRRWebEvent(_.GET_SR_PROPS,{shouldRecord:d,eventProperties:e},10===this.eventCount),10===this.eventCount&&(this.eventCount=0),this.eventCount++,e},b.prototype.sendEvents=function(a){var b,c=a||(null==(b=this.identifiers)?void 0:b.sessionId),d=this.getDeviceId();this.eventsManager&&c&&d&&this.eventsManager.sendCurrentSequenceEvents({sessionId:c,deviceId:d})},b.prototype.initialize=function(a){var b;return void 0===a&&(a=!1),(0,ah.__awaiter)(this,void 0,void 0,function(){var c;return(0,ah.__generator)(this,function(d){return(null==(b=this.identifiers)?void 0:b.sessionId)?(c=this.getDeviceId())?(this.eventsManager&&a&&this.eventsManager.sendStoredEvents({deviceId:c}),[2,this.recordEvents()]):(this.loggerProvider.log("Session is not being recorded due to lack of device id."),[2,Promise.resolve()]):(this.loggerProvider.log("Session is not being recorded due to lack of session id."),[2,Promise.resolve()])})})},b.prototype.shouldOptOut=function(){if(null==(b=this.config)?void 0:b.instanceName){var a,b,c,d;d=(void 0===(a=this.config.instanceName)&&(a=eX),ba.getInstance(a)).identityStore.getIdentity().optOut}return void 0!==d?d:null==(c=this.config)?void 0:c.optOut},b.prototype.getShouldRecord=function(){if(!this.identifiers||!this.config||!this.identifiers.sessionId)return this.loggerProvider.warn("Session is not being recorded due to lack of config, please call sessionReplay.init."),!1;if(!this.config.captureEnabled)return this.loggerProvider.log("Session ".concat(this.identifiers.sessionId," not being captured due to capture being disabled for project or because the remote config could not be fetched.")),!1;if(this.shouldOptOut())return this.loggerProvider.log("Opting session ".concat(this.identifiers.sessionId," out of recording due to optOut config.")),!1;var a,b,c=!1,d="",e=!1;return this.config.targetingConfig?this.sessionTargetingMatch?(d="Capturing replays for session ".concat(this.identifiers.sessionId," due to matching targeting conditions."),this.loggerProvider.log(d),c=!0,e=!0):(d="Not capturing replays for session ".concat(this.identifiers.sessionId," due to not matching targeting conditions."),this.loggerProvider.log(d),c=!1,e=!1):(a=this.identifiers.sessionId,b=this.config.sampleRate,31*Math.abs(fq(a.toString()))%1e6/1e6<b)?(c=!0,e=!0):(d="Opting session ".concat(this.identifiers.sessionId," out of recording due to sample rate."),this.loggerProvider.log(d),c=!1,e=!1),this.lastShouldRecordDecision!==c&&this.config.targetingConfig&&(this.addCustomRRWebEvent(_.TARGETING_DECISION,{message:d,sessionId:this.identifiers.sessionId,matched:e,targetingParams:this.lastTargetingParams}),this.lastShouldRecordDecision=c),c},b.prototype.getBlockSelectors=function(){var a,b,c,d=null!=(c=null==(b=null==(a=this.config)?void 0:a.privacyConfig)?void 0:b.blockSelector)?c:[];if(0!==d.length)return d},b.prototype.getMaskTextSelectors=function(){if((null==(b=null==(a=this.config)?void 0:a.privacyConfig)?void 0:b.defaultMaskLevel)==="conservative")return"*";var a,b,c,d,e=null==(d=null==(c=this.config)?void 0:c.privacyConfig)?void 0:d.maskSelector;if(e)return e},b.prototype.getRecordingPlugins=function(b){var c,d,e,f,g,h;return(0,ah.__awaiter)(this,void 0,void 0,function(){var i,j,k,l;return(0,ah.__generator)(this,function(m){switch(m.label){case 0:i=[];try{j=g2({ugcFilterRules:(null==(d=null==(c=this.config)?void 0:c.interactionConfig)?void 0:d.ugcFilterRules)||[],enablePolling:(null==(e=this.config)?void 0:e.enableUrlChangePolling)||!1,pollingInterval:null==(f=this.config)?void 0:f.urlChangePollingInterval,captureDocumentTitle:null==(g=this.config)?void 0:g.captureDocumentTitle}),i.push(j)}catch(a){this.loggerProvider.warn("Failed to create URL tracking plugin:",a)}if(!(null==(h=null==b?void 0:b.console)?void 0:h.enabled))return[3,4];m.label=1;case 1:return m.trys.push([1,3,,4]),[4,a.A(439156)];case 2:return k=m.sent().getRecordConsolePlugin,i.push(k({level:b.console.levels})),[3,4];case 3:return l=m.sent(),this.loggerProvider.warn("Failed to load console plugin:",l),[3,4];case 4:return[2,i.length>0?i:void 0]}})})},b.prototype.getRecordFunction=function(){return(0,ah.__awaiter)(this,void 0,void 0,function(){var b,c;return(0,ah.__generator)(this,function(d){switch(d.label){case 0:if(this.recordFunction)return[2,this.recordFunction];d.label=1;case 1:return d.trys.push([1,3,,4]),[4,a.A(160037)];case 2:return b=d.sent().record,this.recordFunction=b,[2,b];case 3:return c=d.sent(),this.loggerProvider.warn("Failed to load rrweb-record module:",c),[2,null];case 4:return[2]}})})},b.prototype.recordEvents=function(a){var b,c,d,e,f,g;return void 0===a&&(a=!0),(0,ah.__awaiter)(this,void 0,void 0,function(){var h,i,j,k,l,m,n,o,p,q,r,s,t,u=this;return(0,ah.__generator)(this,function(v){switch(v.label){case 0:if(h=this.config,i=this.getShouldRecord(),j=null==(b=this.identifiers)?void 0:b.sessionId,!i||!j||!h)return[2];return this.stopRecordingEvents(),[4,this.getRecordFunction()];case 1:if(!(k=v.sent()))return[2];return[4,this.initializeNetworkObservers()];case 2:v.sent(),null==(c=this.networkObservers)||c.start(function(a){u.addCustomRRWebEvent(_.FETCH_REQUEST,a)}),l=h.privacyConfig,m=h.interactionConfig,n=h.loggingConfig,o=(null==m?void 0:m.enabled)?{mouseInteraction:this.eventsManager&&(null==(d=this.clickHandler)?void 0:d.createHook({eventsManager:this.eventsManager,sessionId:j,deviceIdFn:this.getDeviceId.bind(this),mirror:k.mirror,ugcFilterRules:null!=(e=m.ugcFilterRules)?e:[]})),scroll:this.scrollHook}:{},p=(null==m?void 0:m.enabled)&&m.ugcFilterRules?m.ugcFilterRules:[],this.loggerProvider.log("Session Replay capture beginning for ".concat(j,".")),v.label=3;case 3:return v.trys.push([3,5,,6]),q=this,r=k,t={emit:function(a){if(u.shouldOptOut()){u.loggerProvider.log("Opting session ".concat(j," out of recording due to optOut config.")),u.stopRecordingEvents(),u.sendEvents();return}a.type===fr.Meta&&(a.data.href=fk(a.data.href,p)),u.eventCompressor&&u.eventCompressor.enqueueEvent(a,j)},inlineStylesheet:h.shouldInlineStylesheet,hooks:o,maskAllInputs:!0,maskTextClass:e9,blockClass:"amp-block",blockSelector:this.getBlockSelectors(),applyBackgroundColorToBlockedElements:h.applyBackgroundColorToBlockedElements,maskInputFn:ff("input",l),maskTextFn:ff("text",l),maskTextSelector:this.getMaskTextSelectors(),recordCanvas:!1,slimDOMOptions:{script:null==(f=h.omitElementTags)?void 0:f.script,comment:null==(g=h.omitElementTags)?void 0:g.comment},errorHandler:function(a){if(a.message.includes("insertRule")&&a.message.includes("CSSStyleSheet")||a._external_)throw a;return u.loggerProvider.warn("Error while capturing replay: ",a.toString()),!0}},[4,this.getRecordingPlugins(n)];case 4:return q.recordCancelCallback=r.apply(void 0,[(t.plugins=v.sent(),t)]),this.addCustomRRWebEvent(_.DEBUG_INFO),a&&this.addCustomRRWebEvent(_.METADATA,this.metadata),[3,6];case 5:return s=v.sent(),this.loggerProvider.warn("Failed to initialize session replay:",s),[3,6];case 6:return[2]}})})},b.prototype.getDeviceId=function(){var a;return null==(a=this.identifiers)?void 0:a.deviceId},b.prototype.getSessionId=function(){var a;return null==(a=this.identifiers)?void 0:a.sessionId},b.prototype.flush=function(a){var b;return void 0===a&&(a=!1),(0,ah.__awaiter)(this,void 0,void 0,function(){return(0,ah.__generator)(this,function(c){return[2,null==(b=this.eventsManager)?void 0:b.flush(a)]})})},b.prototype.shutdown=function(){this.teardownEventListeners(!0),this.stopRecordingEvents(),this.sendEvents()},b.prototype.mapSDKType=function(a){return"plugin"===a?"@amplitude/plugin-session-replay-browser":"segment"===a?"@amplitude/segment-session-replay-plugin":null},b.prototype.setMetadata=function(a,b,c,d,e,f,g){var h=(null==a?void 0:a.toString())?fq(a.toString()):void 0;this.metadata={joinedConfig:b,localConfig:c,remoteConfig:d,sessionId:a,hashValue:h,sampleRate:b.sampleRate,replaySDKType:this.mapSDKType(g),replaySDKVersion:e,standaloneSDKType:"@amplitude/session-replay-browser",standaloneSDKVersion:f}},b.prototype.initializeNetworkObservers=function(){var b,c,d;return(0,ah.__awaiter)(this,void 0,void 0,function(){var e,f;return(0,ah.__generator)(this,function(g){switch(g.label){case 0:if(!((null==(d=null==(c=null==(b=this.config)?void 0:b.loggingConfig)?void 0:c.network)?void 0:d.enabled)&&!this.networkObservers))return[3,4];g.label=1;case 1:return g.trys.push([1,3,,4]),[4,a.A(425380)];case 2:return e=g.sent().NetworkObservers,this.networkObservers=new e,[3,4];case 3:return f=g.sent(),this.loggerProvider.warn("Failed to import or instantiate NetworkObservers:",f),[3,4];case 4:return[2]}})})},b}(),g4=function(a){return function(){var b=a.config||fn();return{logger:b.loggerProvider,logLevel:b.logLevel}}};let g5={init:eV((G=new g3).init.bind(G),"init",g4(G)),evaluateTargetingAndCapture:eV(G.evaluateTargetingAndCapture.bind(G),"evaluateTargetingAndRecord",g4(G)),setSessionId:eV(G.setSessionId.bind(G),"setSessionId",g4(G)),getSessionId:eV(G.getSessionId.bind(G),"getSessionId",g4(G)),getSessionReplayProperties:eV(G.getSessionReplayProperties.bind(G),"getSessionReplayProperties",g4(G)),flush:eV(G.flush.bind(G),"flush",g4(G)),shutdown:eV(G.shutdown.bind(G),"shutdown",g4(G))};var g6=g5.init,g7=g5.setSessionId,g8=g5.getSessionId,g9=g5.getSessionReplayProperties,ha=g5.flush,hb=g5.shutdown,hc=g5.evaluateTargetingAndCapture;(H=ae||(ae={})).SET="$set",H.SET_ONCE="$setOnce",H.ADD="$add",H.APPEND="$append",H.PREPEND="$prepend",H.REMOVE="$remove",H.PREINSERT="$preInsert",H.POSTINSERT="$postInsert",H.UNSET="$unset",H.CLEAR_ALL="$clearAll",(I=af||(af={})).REVENUE_PRODUCT_ID="$productId",I.REVENUE_QUANTITY="$quantity",I.REVENUE_PRICE="$price",I.REVENUE_TYPE="$revenueType",I.REVENUE_CURRENCY="$currency",I.REVENUE="$revenue",(J=ag||(ag={})).IDENTIFY="$identify",J.GROUP_IDENTIFY="$groupidentify",J.REVENUE="revenue_amount";var hd=[ae.SET,ae.SET_ONCE,ae.ADD,ae.APPEND,ae.PREPEND,ae.POSTINSERT],he=function(a){if(a.user_properties){var b={};return Object.keys(a.user_properties).forEach(function(c){if(hd.includes(c)){var d=a.user_properties&&a.user_properties[c];b=(0,ah.__assign)((0,ah.__assign)({},b),d)}}),b}},hf="1.23.6",hg=function(){function a(b){this.name=a.pluginName,this.type="enrichment",this.config=null,this.sessionReplay={flush:ha,getSessionId:g8,getSessionReplayProperties:g9,init:g6,setSessionId:g7,shutdown:hb,evaluateTargetingAndCapture:hc},this.options=(0,ah.__assign)({forceSessionTracking:!1},b),this.srInitOptions=this.options}return a.prototype.setup=function(a,b){var c,d,e,f,g,h;return(0,ah.__awaiter)(this,void 0,void 0,function(){var b,i;return(0,ah.__generator)(this,function(j){switch(j.label){case 0:var k;return j.trys.push([0,2,,3]),null==a||a.loggerProvider.log("Installing @amplitude/plugin-session-replay, version ".concat(hf,".")),this.config=a,this.options.forceSessionTracking&&("boolean"==typeof a.defaultTracking?!1===a.defaultTracking&&(a.defaultTracking={pageViews:!1,formInteractions:!1,fileDownloads:!1,sessions:!0}):a.defaultTracking=(0,ah.__assign)((0,ah.__assign)({},a.defaultTracking),{sessions:!0})),b=(void 0===(k=this.config.instanceName)&&(k="$default_instance"),ba.getInstance(k)).identityStore.getIdentity().userProperties,this.srInitOptions={instanceName:this.config.instanceName,deviceId:null!=(c=this.options.deviceId)?c:this.config.deviceId,optOut:this.config.optOut,sessionId:this.options.customSessionId?void 0:this.config.sessionId,loggerProvider:this.config.loggerProvider,logLevel:this.config.logLevel,flushMaxRetries:this.config.flushMaxRetries,serverZone:this.config.serverZone,configServerUrl:this.options.configServerUrl||(null==(d=this.config.remoteConfig)?void 0:d.serverUrl),trackServerUrl:this.options.trackServerUrl,sampleRate:this.options.sampleRate,privacyConfig:{blockSelector:null==(e=this.options.privacyConfig)?void 0:e.blockSelector,maskSelector:null==(f=this.options.privacyConfig)?void 0:f.maskSelector,unmaskSelector:null==(g=this.options.privacyConfig)?void 0:g.unmaskSelector,defaultMaskLevel:null==(h=this.options.privacyConfig)?void 0:h.defaultMaskLevel},debugMode:this.options.debugMode,shouldInlineStylesheet:this.options.shouldInlineStylesheet,version:{type:"plugin",version:hf},performanceConfig:this.options.performanceConfig,storeType:this.options.storeType,experimental:this.options.experimental,userProperties:b,omitElementTags:this.options.omitElementTags,applyBackgroundColorToBlockedElements:this.options.applyBackgroundColorToBlockedElements,interactionConfig:this.options.interactionConfig,captureDocumentTitle:this.options.captureDocumentTitle,enableUrlChangePolling:this.options.enableUrlChangePolling,urlChangePollingInterval:this.options.urlChangePollingInterval},[4,this.sessionReplay.init(a.apiKey,this.srInitOptions).promise];case 1:return j.sent(),[3,3];case 2:return i=j.sent(),null==a||a.loggerProvider.error("Session Replay: Failed to initialize due to ".concat(i.message)),[3,3];case 3:return[2]}})})},a.prototype.onSessionIdChanged=function(a){var b;return(0,ah.__awaiter)(this,void 0,void 0,function(){return(0,ah.__generator)(this,function(c){switch(c.label){case 0:return null==(b=this.config)||b.loggerProvider.debug("Analytics session id is changed to ".concat(a,", SR session id is ").concat(String(this.sessionReplay.getSessionId()),".")),[4,this.sessionReplay.setSessionId(a).promise];case 1:return c.sent(),[2]}})})},a.prototype.onOptOutChanged=function(a){var b;return(0,ah.__awaiter)(this,void 0,void 0,function(){return(0,ah.__generator)(this,function(c){switch(c.label){case 0:if(null==(b=this.config)||b.loggerProvider.debug("optOut is changed to ".concat(String(a),", calling ").concat(a?"sessionReplay.shutdown()":"sessionReplay.init()",".")),!a)return[3,1];return this.sessionReplay.shutdown(),[3,4];case 1:if(null==this.config)return[3,3];return[4,this.sessionReplay.init(this.config.apiKey,this.srInitOptions).promise];case 2:c.sent(),c.label=3;case 3:c.label=4;case 4:return[2]}})})},a.prototype.execute=function(a){var b,c;return(0,ah.__awaiter)(this,void 0,void 0,function(){var d,e,f,g;return(0,ah.__generator)(this,function(h){switch(h.label){case 0:if(h.trys.push([0,9,,10]),!this.options.customSessionId)return[3,4];if(!(d=this.options.customSessionId(a)))return[3,3];if(d===this.sessionReplay.getSessionId())return[3,2];return[4,this.sessionReplay.setSessionId(d).promise];case 1:h.sent(),h.label=2;case 2:e=this.sessionReplay.getSessionReplayProperties(),a.event_properties=(0,ah.__assign)((0,ah.__assign)({},a.event_properties),e),h.label=3;case 3:return[3,8];case 4:if(!((d=null==(b=this.config)?void 0:b.sessionId)&&d!==this.sessionReplay.getSessionId()))return[3,6];return[4,this.sessionReplay.setSessionId(d).promise];case 5:h.sent(),h.label=6;case 6:if(!(d&&d===a.session_id))return[3,8];return f=void 0,a.event_type===X.IDENTIFY&&(f=he(a)),[4,this.sessionReplay.evaluateTargetingAndCapture({event:a,userProperties:f})];case 7:h.sent(),e=this.sessionReplay.getSessionReplayProperties(),a.event_properties=(0,ah.__assign)((0,ah.__assign)({},a.event_properties),e),h.label=8;case 8:return[2,Promise.resolve(a)];case 9:return g=h.sent(),null==(c=this.config)||c.loggerProvider.error("Session Replay: Failed to enrich event due to ".concat(g.message)),[2,Promise.resolve(a)];case 10:return[2]}})})},a.prototype.teardown=function(){var a;return(0,ah.__awaiter)(this,void 0,void 0,function(){return(0,ah.__generator)(this,function(b){try{this.sessionReplay.shutdown(),this.config=null}catch(b){null==(a=this.config)||a.loggerProvider.error("Session Replay: teardown failed due to ".concat(b.message))}return[2]})})},a.prototype.getSessionReplayProperties=function(){return this.sessionReplay.getSessionReplayProperties()},a.pluginName="@amplitude/plugin-session-replay-browser",a}(),hh=a.i(57843),hi=a.i(18039);let hj=()=>hi.IS_CLOUD_EDITION&&!!hi.AMPLITUDE_API_KEY,hk=hh.memo(({sessionReplaySampleRate:a=.5})=>((0,hh.useEffect)(()=>{hj()&&(eR(hi.AMPLITUDE_API_KEY,{defaultTracking:{sessions:!0,pageViews:!0,formInteractions:!0,fileDownloads:!0,attribution:!0}}),eP({name:"page-name-enrichment",type:"enrichment",setup:async()=>void 0,execute:async a=>{if("[Amplitude] Page Viewed"===a.event_type&&a.event_properties){let b;a.event_properties["[Amplitude] Page Title"]=({"":"Home",apps:"Studio",datasets:"Knowledge",explore:"Explore",tools:"Tools",account:"Account",signin:"Sign In",signup:"Sign Up"})[b="".replace(/^\//,"").split("/")[0]||"home"]||b.charAt(0).toUpperCase()+b.slice(1)}return a}}),eP(new hg({sampleRate:a})))},[]),null));a.s(["default",0,hk,"isAmplitudeEnabled",0,hj],298442)},60796,55282,a=>{"use strict";var b=a.i(298442),c=a.i(178865),d=a.i(295474);a.s(["resetUser",0,()=>{(0,b.isAmplitudeEnabled)()&&c.reset()},"setUserId",0,a=>{(0,b.isAmplitudeEnabled)()&&c.setUserId(a)},"setUserProperties",0,a=>{if(!(0,b.isAmplitudeEnabled)())return;let e=new d.Identify;Object.entries(a).forEach(([a,b])=>{e.set(a,b)}),c.identify(e)},"trackEvent",0,(a,d)=>{(0,b.isAmplitudeEnabled)()&&c.track(a,d)}],55282),a.s([],60796)}];

//# sourceMappingURL=app_components_base_amplitude_0b087ddf._.js.map
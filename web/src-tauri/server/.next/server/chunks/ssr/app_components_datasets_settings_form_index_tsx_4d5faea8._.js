module.exports=[606573,a=>{"use strict";var b=a.i(608061),c=a.i(429150),d=a.i(57843);a.i(752298);var e=a.i(693025),f=a.i(355968),g=a.i(429178),h=a.i(909795),i=a.i(757801);a.i(805980);var j=a.i(122745),k=a.i(816134),l=a.i(146172),m=a.i(114715),n=a.i(798418),o=a.i(916443),p=a.i(721298),q=a.i(933988),r=a.i(701458),s=a.i(403473),t=a.i(705134),u=a.i(698636),v=a.i(252813),w=a.i(986431),x=a.i(218257),y=a.i(847733),z=a.i(763539);a.i(387799);var A=a.i(944054),B=a.i(821820),C=a.i(543945);a.i(224256);var D=a.i(463561),E=a.i(12588),F=a.i(765239),G=a.i(736188);let H=d.memo(({chunkStructure:a})=>{let{options:c}=(()=>{let{t:a}=(0,e.useTranslation)();return{options:[{id:w.ChunkingMode.text,icon:(0,b.jsx)(D.GeneralChunk,{className:"size-[18px]"}),iconActiveColor:"text-util-colors-indigo-indigo-600",title:"General",description:a("stepTwo.generalTip",{ns:"datasetCreation"}),effectColor:G.EffectColor.indigo,showEffectColor:!0},{id:w.ChunkingMode.parentChild,icon:(0,b.jsx)(E.ParentChildChunk,{className:"size-[18px]"}),iconActiveColor:"text-util-colors-blue-light-blue-light-500",title:"Parent-Child",description:a("stepTwo.parentChildTip",{ns:"datasetCreation"}),effectColor:G.EffectColor.blueLight,showEffectColor:!0},{id:w.ChunkingMode.qa,icon:(0,b.jsx)(F.QuestionAndAnswer,{className:"size-[18px]"}),title:"Q&A",description:a("stepTwo.qaTip",{ns:"datasetCreation"})}]}})();return(0,b.jsx)("div",{className:"flex flex-col gap-y-1",children:c.map(c=>(0,b.jsx)(C.default,{id:c.id,icon:c.icon,iconActiveColor:c.iconActiveColor,title:c.title,description:c.description,isActive:a===c.id,effectColor:c.effectColor,showEffectColor:!0,className:"gap-x-1.5 p-3 pr-4",disabled:!0},c.id))})});var I=a.i(188509),J=a.i(794712),K=a.i(322715),L=a.i(516877);let M="flex gap-x-1",N="flex items-center shrink-0 w-[180px] h-7 pt-1",O={icon_type:"emoji",icon:"ðŸ“™",icon_background:"#FFF4ED",icon_url:""};a.s(["default",0,()=>{let{t:a}=(0,e.useTranslation)(),C=(0,v.useDocLink)(),D=(0,t.useSelector)(a=>a.isCurrentWorkspaceDatasetOperator),E=(0,u.useDatasetDetailContextWithSelector)(a=>a.dataset),F=(0,u.useDatasetDetailContextWithSelector)(a=>a.mutateDatasetRes),[G,P]=(0,d.useState)(!1),[Q,R]=(0,d.useState)(E?.name??""),[S,T]=(0,d.useState)(E?.icon_info||O),[U,V]=(0,d.useState)(!1),[W,X]=(0,d.useState)(E?.description??""),[Y,Z]=(0,d.useState)(E?.permission),[$,_]=(0,d.useState)(E?.external_retrieval_model.top_k??2),[aa,ab]=(0,d.useState)(E?.external_retrieval_model.score_threshold??.5),[ac,ad]=(0,d.useState)(E?.external_retrieval_model.score_threshold_enabled??!1),[ae,af]=(0,d.useState)(E?.partial_member_list||[]),[ag,ah]=(0,d.useState)([]),[ai,aj]=(0,d.useState)(E?.indexing_technique),[ak,al]=(0,d.useState)(E?.keyword_number??10),[am,an]=(0,d.useState)(E?.retrieval_model_dict),[ao,ap]=(0,d.useState)(E?.embedding_model?{provider:E.embedding_model_provider,model:E.embedding_model}:{provider:"",model:""}),[aq,ar]=(0,d.useState)(E?.summary_index_setting),as=(0,d.useCallback)(a=>{ar(b=>({...b,...a}))},[]),{data:at}=(0,r.useModelList)(q.ModelTypeEnum.rerank),{data:au}=(0,r.useModelList)(q.ModelTypeEnum.textEmbedding),{data:av}=(0,z.useMembers)(),aw=(0,d.useRef)(O),ax=(0,d.useCallback)(()=>{V(!0),aw.current=S},[S]),ay=(0,d.useCallback)(a=>{T({icon_type:a.type,icon:"emoji"===a.type?a.icon:a.fileId,icon_background:"emoji"===a.type?a.background:void 0,icon_url:"emoji"===a.type?void 0:a.url}),V(!1)},[]),az=(0,d.useCallback)(()=>{T(aw.current),V(!1)},[]),aA=(0,d.useCallback)(a=>{void 0!==a.top_k&&_(a.top_k),void 0!==a.score_threshold&&ab(a.score_threshold),void 0!==a.score_threshold_enabled&&ad(a.score_threshold_enabled)},[]);(0,d.useEffect)(()=>{av?.accounts?ah(av.accounts):ah([])},[av]);let aB=(0,y.useInvalidDatasetList)(),aC=async()=>{if(!G){if(!Q?.trim())return void m.default.notify({type:"error",message:a("form.nameError",{ns:"datasetSettings"})});if(!(0,n.isReRankModelSelected)({rerankModelList:at,retrievalConfig:am,indexMethod:ai}))return void m.default.notify({type:"error",message:a("datasetConfig.rerankModelRequired",{ns:"appDebug"})});am.weights&&(am.weights.vector_setting.embedding_provider_name=ao.provider||"",am.weights.vector_setting.embedding_model_name=ao.model||"");try{P(!0);let b={datasetId:E.id,body:{name:Q,icon_info:S,doc_form:E?.doc_form,description:W,permission:Y,indexing_technique:ai,retrieval_model:{...am,score_threshold:am.score_threshold_enabled?am.score_threshold:0},embedding_model:ao.model,embedding_model_provider:ao.provider,..."external"===E.provider&&{external_knowledge_id:E.external_knowledge_info.external_knowledge_id,external_knowledge_api_id:E.external_knowledge_info.external_knowledge_api_id,external_retrieval_model:{top_k:$,score_threshold:aa,score_threshold_enabled:ac}},keyword_number:ak,summary_index_setting:aq}};Y===w.DatasetPermission.partialMembers&&(b.body.partial_member_list=ae.map(a=>({user_id:a,role:ag.find(b=>b.id===a)?.role}))),await (0,x.updateDatasetSetting)(b),m.default.notify({type:"success",message:a("actionMsg.modifiedSuccessfully",{ns:"common"})}),F&&(await F(),aB())}catch{m.default.notify({type:"error",message:a("actionMsg.modifiedUnsuccessfully",{ns:"common"})})}finally{P(!1)}}},aD=E&&E.doc_form!==w.ChunkingMode.parentChild&&E.indexing_technique&&ai,aE=(0,d.useMemo)(()=>(0,L.checkShowMultiModalTip)({embeddingModel:ao,rerankingEnable:am.reranking_enable,rerankModel:{rerankingProviderName:am.reranking_model.reranking_provider_name,rerankingModelName:am.reranking_model.reranking_model_name},indexMethod:ai,embeddingModelList:au,rerankModelList:at}),[ao,at,am.reranking_enable,am.reranking_model,au,ai]);return(0,b.jsxs)("div",{className:"flex w-full flex-col gap-y-4 px-20 py-8 sm:w-[960px]",children:[(0,b.jsxs)("div",{className:M,children:[(0,b.jsx)("div",{className:N,children:(0,b.jsx)("div",{className:"system-sm-semibold text-text-secondary",children:a("form.nameAndIcon",{ns:"datasetSettings"})})}),(0,b.jsxs)("div",{className:"flex grow items-center gap-x-2",children:[(0,b.jsx)(f.default,{size:"small",onClick:ax,className:"cursor-pointer",iconType:S.icon_type,icon:S.icon,background:S.icon_background,imageUrl:S.icon_url,showEditIcon:!0}),(0,b.jsx)(k.default,{disabled:!E?.embedding_available,value:Q,onChange:a=>R(a.target.value)})]})]}),(0,b.jsxs)("div",{className:M,children:[(0,b.jsx)("div",{className:N,children:(0,b.jsx)("div",{className:"system-sm-semibold text-text-secondary",children:a("form.desc",{ns:"datasetSettings"})})}),(0,b.jsx)("div",{className:"grow",children:(0,b.jsx)(l.default,{disabled:!E?.embedding_available,className:"resize-none",placeholder:a("form.descPlaceholder",{ns:"datasetSettings"})||"",value:W,onChange:a=>X(a.target.value)})})]}),(0,b.jsxs)("div",{className:M,children:[(0,b.jsx)("div",{className:N,children:(0,b.jsx)("div",{className:"system-sm-semibold text-text-secondary",children:a("form.permissions",{ns:"datasetSettings"})})}),(0,b.jsx)("div",{className:"grow",children:(0,b.jsx)(J.default,{disabled:!E?.embedding_available||D,permission:Y,value:ae,onChange:a=>Z(a),onMemberSelect:af,memberList:ag})})]}),!!E?.doc_form&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(i.default,{type:"horizontal",className:"my-1 h-px bg-divider-subtle"}),(0,b.jsxs)("div",{className:M,children:[(0,b.jsxs)("div",{className:"flex w-[180px] shrink-0 flex-col",children:[(0,b.jsx)("div",{className:"system-sm-semibold flex h-8 items-center text-text-secondary",children:a("form.chunkStructure.title",{ns:"datasetSettings"})}),(0,b.jsxs)("div",{className:"body-xs-regular text-text-tertiary",children:[(0,b.jsx)("a",{target:"_blank",rel:"noopener noreferrer",href:C("/use-dify/knowledge/create-knowledge/chunking-and-cleaning-text"),className:"text-text-accent",children:a("form.chunkStructure.learnMore",{ns:"datasetSettings"})}),a("form.chunkStructure.description",{ns:"datasetSettings"})]})]}),(0,b.jsx)("div",{className:"grow",children:(0,b.jsx)(H,{chunkStructure:E?.doc_form})})]})]}),!!(aD||"high_quality"===ai)&&(0,b.jsx)(i.default,{type:"horizontal",className:"my-1 h-px bg-divider-subtle"}),!!aD&&(0,b.jsxs)("div",{className:M,children:[(0,b.jsx)("div",{className:N,children:(0,b.jsx)("div",{className:"system-sm-semibold text-text-secondary",children:a("form.indexMethod",{ns:"datasetSettings"})})}),(0,b.jsxs)("div",{className:"grow",children:[(0,b.jsx)(I.default,{value:ai,disabled:!E?.embedding_available,onChange:a=>aj(a),currentValue:E.indexing_technique,keywordNumber:ak,onKeywordNumberChange:al}),E.indexing_technique===A.IndexingType.ECONOMICAL&&ai===A.IndexingType.QUALIFIED&&(0,b.jsxs)("div",{className:"relative mt-2 flex h-10 items-center gap-x-0.5 overflow-hidden rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur px-2 shadow-xs shadow-shadow-shadow-3",children:[(0,b.jsx)("div",{className:"absolute left-0 top-0 flex h-full w-full items-center bg-toast-warning-bg opacity-40"}),(0,b.jsx)("div",{className:"p-1",children:(0,b.jsx)(c.RiAlertFill,{className:"size-4 text-text-warning-secondary"})}),(0,b.jsx)("span",{className:"system-xs-medium text-text-primary",children:a("form.upgradeHighQualityTip",{ns:"datasetSettings"})})]})]})]}),ai===A.IndexingType.QUALIFIED&&(0,b.jsxs)("div",{className:M,children:[(0,b.jsx)("div",{className:N,children:(0,b.jsx)("div",{className:"system-sm-semibold text-text-secondary",children:a("form.embeddingModel",{ns:"datasetSettings"})})}),(0,b.jsx)("div",{className:"grow",children:(0,b.jsx)(s.default,{defaultModel:ao,modelList:au,onSelect:ap})})]}),ai===A.IndexingType.QUALIFIED&&[w.ChunkingMode.text,w.ChunkingMode.parentChild].includes(E?.doc_form)&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(i.default,{type:"horizontal",className:"my-1 h-px bg-divider-subtle"}),(0,b.jsx)(K.default,{entry:"dataset-settings",summaryIndexSetting:aq,onSummaryIndexSettingChange:as})]}),E?.provider==="external"?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(i.default,{type:"horizontal",className:"my-1 h-px bg-divider-subtle"}),(0,b.jsxs)("div",{className:M,children:[(0,b.jsx)("div",{className:N,children:(0,b.jsx)("div",{className:"system-sm-semibold text-text-secondary",children:a("form.retrievalSetting.title",{ns:"datasetSettings"})})}),(0,b.jsx)(B.default,{topK:$,scoreThreshold:aa,scoreThresholdEnabled:ac,onChange:aA,isInRetrievalSetting:!0})]}),(0,b.jsx)(i.default,{type:"horizontal",className:"my-1 h-px bg-divider-subtle"}),(0,b.jsxs)("div",{className:M,children:[(0,b.jsx)("div",{className:N,children:(0,b.jsx)("div",{className:"system-sm-semibold text-text-secondary",children:a("form.externalKnowledgeAPI",{ns:"datasetSettings"})})}),(0,b.jsx)("div",{className:"w-full",children:(0,b.jsxs)("div",{className:"flex h-full items-center gap-1 rounded-lg bg-components-input-bg-normal px-3 py-2",children:[(0,b.jsx)(j.ApiConnectionMod,{className:"h-4 w-4 text-text-secondary"}),(0,b.jsx)("div",{className:"system-sm-medium overflow-hidden text-ellipsis text-text-secondary",children:E?.external_knowledge_info.external_knowledge_api_name}),(0,b.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:"Â·"}),(0,b.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:E?.external_knowledge_info.external_knowledge_api_endpoint})]})})]}),(0,b.jsxs)("div",{className:M,children:[(0,b.jsx)("div",{className:N,children:(0,b.jsx)("div",{className:"system-sm-semibold text-text-secondary",children:a("form.externalKnowledgeID",{ns:"datasetSettings"})})}),(0,b.jsx)("div",{className:"w-full",children:(0,b.jsx)("div",{className:"flex h-full items-center gap-1 rounded-lg bg-components-input-bg-normal px-3 py-2",children:(0,b.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:E?.external_knowledge_info.external_knowledge_id})})})]})]}):ai?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(i.default,{type:"horizontal",className:"my-1 h-px bg-divider-subtle"}),(0,b.jsxs)("div",{className:M,children:[(0,b.jsx)("div",{className:N,children:(0,b.jsxs)("div",{className:"flex w-[180px] shrink-0 flex-col",children:[(0,b.jsx)("div",{className:"system-sm-semibold flex h-7 items-center pt-1 text-text-secondary",children:a("form.retrievalSetting.title",{ns:"datasetSettings"})}),(0,b.jsxs)("div",{className:"body-xs-regular text-text-tertiary",children:[(0,b.jsx)("a",{target:"_blank",rel:"noopener noreferrer",href:C("/use-dify/knowledge/create-knowledge/setting-indexing-methods"),className:"text-text-accent",children:a("form.retrievalSetting.learnMore",{ns:"datasetSettings"})}),a("form.retrievalSetting.description",{ns:"datasetSettings"})]})]})}),(0,b.jsx)("div",{className:"grow",children:ai===A.IndexingType.QUALIFIED?(0,b.jsx)(p.default,{value:am,onChange:an,showMultiModalTip:aE}):(0,b.jsx)(o.default,{value:am,onChange:an})})]})]}):null,(0,b.jsx)(i.default,{type:"horizontal",className:"my-1 h-px bg-divider-subtle"}),(0,b.jsxs)("div",{className:M,children:[(0,b.jsx)("div",{className:N}),(0,b.jsx)("div",{className:"grow",children:(0,b.jsx)(h.default,{className:"min-w-24",variant:"primary",loading:G,disabled:G,onClick:aC,children:a("form.save",{ns:"datasetSettings"})})})]}),U&&(0,b.jsx)(g.default,{onSelect:ay,onClose:az})]})}],606573)}];

//# sourceMappingURL=app_components_datasets_settings_form_index_tsx_4d5faea8._.js.map
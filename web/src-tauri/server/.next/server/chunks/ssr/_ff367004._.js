module.exports=[104383,a=>{"use strict";var b=a.i(608061);a.i(752298);var c=a.i(693025),d=a.i(909795),e=a.i(940272);a.s(["default",0,({versions:a={importedVersion:"",systemVersion:""},onCancel:f,onConfirm:g,confirmDisabled:h=!1})=>{let{t:i}=(0,c.useTranslation)();return(0,b.jsxs)(e.default,{isShow:!0,onClose:()=>f(),className:"w-[480px]",children:[(0,b.jsxs)("div",{className:"flex flex-col items-start gap-2 self-stretch pb-4",children:[(0,b.jsx)("div",{className:"title-2xl-semi-bold text-text-primary",children:i("newApp.appCreateDSLErrorTitle",{ns:"app"})}),(0,b.jsxs)("div",{className:"system-md-regular flex grow flex-col text-text-secondary",children:[(0,b.jsx)("div",{children:i("newApp.appCreateDSLErrorPart1",{ns:"app"})}),(0,b.jsx)("div",{children:i("newApp.appCreateDSLErrorPart2",{ns:"app"})}),(0,b.jsx)("br",{}),(0,b.jsxs)("div",{children:[i("newApp.appCreateDSLErrorPart3",{ns:"app"}),(0,b.jsx)("span",{className:"system-md-medium",children:a.importedVersion})]}),(0,b.jsxs)("div",{children:[i("newApp.appCreateDSLErrorPart4",{ns:"app"}),(0,b.jsx)("span",{className:"system-md-medium",children:a.systemVersion})]})]})]}),(0,b.jsxs)("div",{className:"flex items-start justify-end gap-2 self-stretch pt-6",children:[(0,b.jsx)(d.default,{variant:"secondary",onClick:()=>f(),children:i("newApp.Cancel",{ns:"app"})}),(0,b.jsx)(d.default,{variant:"primary",destructive:!0,onClick:g,disabled:h,children:i("newApp.Confirm",{ns:"app"})})]})]})}])},374734,a=>{"use strict";var b=a.i(533306),c=a.i(57843);a.i(752298);var d=a.i(693025),e=a.i(114715),f=a.i(422335),g=a.i(18039),h=a.i(705134),i=a.i(343837),j=a.i(802066),k=a.i(297392);a.s(["useImportDSL",0,()=>{let{t:a}=(0,d.useTranslation)(),{notify:l}=(0,e.useToastContext)(),[m,n]=(0,c.useState)(!1),{handleCheckPluginDependencies:o}=(0,f.usePluginDependencies)(),p=(0,h.useSelector)(a=>a.isCurrentWorkspaceEditor),{push:q}=(0,b.useRouter)(),[r,s]=(0,c.useState)(),t=(0,c.useRef)("");return{handleImportDSL:(0,c.useCallback)(async(b,{onSuccess:c,onPending:d,onFailed:e})=>{if(!m){n(!0);try{let f=await (0,j.importDSL)(b);if(!f)return;let{id:h,status:m,app_id:n,app_mode:r,imported_dsl_version:u,current_dsl_version:v}=f;if(m===i.DSLImportStatus.COMPLETED||m===i.DSLImportStatus.COMPLETED_WITH_WARNINGS){if(!n)return;l({type:m===i.DSLImportStatus.COMPLETED?"success":"warning",message:a(m===i.DSLImportStatus.COMPLETED?"newApp.appCreated":"newApp.caution",{ns:"app"}),children:m===i.DSLImportStatus.COMPLETED_WITH_WARNINGS&&a("newApp.appCreateDSLWarning",{ns:"app"})}),c?.(),localStorage.setItem(g.NEED_REFRESH_APP_LIST_KEY,"1"),await o(n),(0,k.getRedirection)(p,{id:n,mode:r},q)}else m===i.DSLImportStatus.PENDING?(s({importedVersion:u??"",systemVersion:v??""}),t.current=h,d?.(f)):(l({type:"error",message:a("newApp.appCreateFailed",{ns:"app"})}),e?.())}catch{l({type:"error",message:a("newApp.appCreateFailed",{ns:"app"})}),e?.()}finally{n(!1)}}},[a,l,o,p,q,m]),handleImportDSLConfirm:(0,c.useCallback)(async({onSuccess:b,onFailed:c})=>{if(!m&&(n(!0),t.current))try{let{status:d,app_id:e,app_mode:f}=await (0,j.importDSLConfirm)({import_id:t.current});if(!e)return;d===i.DSLImportStatus.COMPLETED?(b?.(),l({type:"success",message:a("newApp.appCreated",{ns:"app"})}),await o(e),localStorage.setItem(g.NEED_REFRESH_APP_LIST_KEY,"1"),(0,k.getRedirection)(p,{id:e,mode:f},q)):d===i.DSLImportStatus.FAILED&&(l({type:"error",message:a("newApp.appCreateFailed",{ns:"app"})}),c?.())}catch{l({type:"error",message:a("newApp.appCreateFailed",{ns:"app"})}),c?.()}finally{n(!1)}},[a,l,o,p,q,m]),versions:r,isFetching:m}}])},116507,a=>{"use strict";var b,c,d=a.i(608061),e=a.i(429150),f=a.i(57843),g=a.i(105249),h=a.i(940272),i=a.i(724423),j=a.i(528698),k=a.i(187864);let l=a=>(0,j.useQuery)({queryKey:k.consoleQuery.trialApps.info.queryKey({input:{params:{appId:a}}}),queryFn:()=>k.consoleClient.trialApps.info({params:{appId:a}}),enabled:!!a}),m=a=>(0,j.useQuery)({queryKey:k.consoleQuery.trialApps.parameters.queryKey({input:{params:{appId:a}}}),queryFn:()=>k.consoleClient.trialApps.parameters({params:{appId:a}}),enabled:!!a}),n=(a,b)=>(0,j.useQuery)({queryKey:k.consoleQuery.trialApps.workflows.queryKey({input:{params:{appId:a}}}),enabled:!b,queryFn:()=>k.consoleClient.trialApps.workflows({params:{appId:a}}).then(a=>a)});var o=a.i(909795),p=a.i(280342),q=a.i(497746);a.i(752298);var r=a.i(693025),s=a.i(175809),t=a.i(142261),u=a.i(527344);let v=(0,t.cva)("",{variants:{type:{info:"from-components-badge-status-light-normal-halo to-background-gradient-mask-transparent"}}}),w=(0,f.memo)(({type:a="info",message:b,onHide:c,className:f})=>(0,d.jsx)("div",{className:(0,u.cn)("pointer-events-none w-full",f),children:(0,d.jsxs)("div",{className:"relative flex space-x-1 overflow-hidden rounded-xl border border-components-panel-border bg-components-panel-bg-blur p-3 shadow-lg",children:[(0,d.jsx)("div",{className:(0,u.cn)("pointer-events-none absolute inset-0 bg-gradient-to-r  opacity-[0.4]",v({type:a}))}),(0,d.jsx)("div",{className:"flex h-6 w-6 items-center justify-center",children:(0,d.jsx)(e.RiInformation2Fill,{className:"text-text-accent"})}),(0,d.jsx)("div",{className:"p-1",children:(0,d.jsx)("div",{className:"system-xs-regular text-text-secondary",children:b})}),(0,d.jsx)("div",{className:"pointer-events-auto flex h-6 w-6 cursor-pointer items-center justify-center",onClick:c,children:(0,d.jsx)(e.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})})]})}));var x=a.i(355968),y=a.i(627001),z=a.i(246378);a.i(3626);var A=a.i(684714),B=a.i(816134),C=a.i(805611),D=a.i(146172),E=a.i(532655),F=a.i(373178),G=a.i(787405),H=a.i(735310),I=a.i(111089),J=a.i(639378),K=a.i(692520);let L=(0,J.createContext)({appData:null,appMeta:null,appParams:null,appChatListDataLoading:!1,currentConversationId:"",appPrevChatList:[],pinnedConversationList:[],conversationList:[],newConversationInputs:{},newConversationInputsRef:{current:{}},handleNewConversationInputsChange:I.noop,inputsForms:[],handleNewConversation:I.noop,handleStartChat:I.noop,handleChangeConversation:I.noop,handleNewConversationCompleted:I.noop,chatShouldReloadKey:"",isMobile:!1,appSourceType:K.AppSourceType.webApp,isInstalledApp:!1,allowResetChat:!0,handleFeedback:I.noop,currentChatInstanceRef:{current:{handleStop:I.noop}},clearChatList:!1,setClearChatList:I.noop,isResponding:!1,setIsResponding:I.noop,currentConversationInputs:{},setCurrentConversationInputs:I.noop,allInputsHidden:!1,initUserVariables:{}}),M=()=>(0,J.useContext)(L),N=(0,f.memo)(({showTip:a})=>{let{t:b}=(0,r.useTranslation)(),{appParams:c,inputsForms:e,currentConversationId:g,currentConversationInputs:h,setCurrentConversationInputs:i,newConversationInputs:j,newConversationInputsRef:k,handleNewConversationInputsChange:l}=M(),m=g?h:j,n=(0,f.useCallback)((a,b)=>{i({...h,[a]:b}),l({...k.current,[a]:b})},[k,l,h,i]),o=e.filter(a=>!0!==a.hide);return(0,d.jsxs)("div",{className:"space-y-4",children:[o.map(a=>(0,d.jsxs)("div",{className:"space-y-1",children:[a.type!==H.InputVarType.checkbox&&(0,d.jsxs)("div",{className:"flex h-6 items-center gap-1",children:[(0,d.jsx)("div",{className:"system-md-semibold text-text-secondary",children:a.label}),!a.required&&(0,d.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:b("panel.optional",{ns:"workflow"})})]}),a.type===H.InputVarType.textInput&&(0,d.jsx)(B.default,{value:m?.[a.variable]||"",onChange:b=>n(a.variable,b.target.value),placeholder:a.label}),a.type===H.InputVarType.number&&(0,d.jsx)(B.default,{type:"number",value:m?.[a.variable]||"",onChange:b=>n(a.variable,b.target.value),placeholder:a.label}),a.type===H.InputVarType.paragraph&&(0,d.jsx)(D.default,{value:m?.[a.variable]||"",onChange:b=>n(a.variable,b.target.value),placeholder:a.label}),a.type===H.InputVarType.checkbox&&(0,d.jsx)(E.default,{name:a.label,value:m?.[a.variable],required:a.required,onChange:b=>n(a.variable,b)}),a.type===H.InputVarType.select&&(0,d.jsx)(C.PortalSelect,{popupClassName:"w-[200px]",value:m?.[a.variable]??a.default??"",items:a.options.map(a=>({value:a,name:a})),onSelect:b=>n(a.variable,b.value),placeholder:a.label}),a.type===H.InputVarType.singleFile&&(0,d.jsx)(A.FileUploaderInAttachmentWrapper,{value:m?.[a.variable]?[m?.[a.variable]]:[],onChange:b=>n(a.variable,b[0]),fileConfig:{allowed_file_types:a.allowed_file_types,allowed_file_extensions:a.allowed_file_extensions,allowed_file_upload_methods:a.allowed_file_upload_methods,number_limits:1,fileUploadConfig:c.system_parameters}}),a.type===H.InputVarType.multiFiles&&(0,d.jsx)(A.FileUploaderInAttachmentWrapper,{value:m?.[a.variable]||[],onChange:b=>n(a.variable,b),fileConfig:{allowed_file_types:a.allowed_file_types,allowed_file_extensions:a.allowed_file_extensions,allowed_file_upload_methods:a.allowed_file_upload_methods,number_limits:a.max_length,fileUploadConfig:c.system_parameters}}),a.type===H.InputVarType.jsonObject&&(0,d.jsx)(F.default,{language:G.CodeLanguage.json,value:m?.[a.variable]||"",onChange:b=>n(a.variable,b),noWrapper:!0,className:"bg h-[80px] overflow-y-auto rounded-[10px] bg-components-input-bg-normal p-1",placeholder:(0,d.jsx)("div",{className:"whitespace-pre",children:a.json_schema})})]},a.variable)),a&&(0,d.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:b("chat.chatFormTip",{ns:"share"})})]})});var O=a.i(757801);a.i(735510);var P=a.i(492507);let Q=({collapsed:a,setCollapsed:b})=>{let{t:c}=(0,r.useTranslation)(),{appSourceType:e,isMobile:f,currentConversationId:g,themeBuilder:h,handleStartChat:i,allInputsHidden:j,inputsForms:k}=M(),l=e===K.AppSourceType.tryApp;return j||0===k.length?null:(0,d.jsxs)("div",{className:(0,u.cn)("mb-6 flex flex-col items-center px-4 pt-6",f&&"mb-4 pt-4",l&&"mb-0 px-0"),children:[(0,d.jsxs)("div",{className:(0,u.cn)("w-full max-w-[672px] rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-md",a&&"border border-components-card-border bg-components-card-bg shadow-none",l&&"max-w-[auto]"),children:[(0,d.jsxs)("div",{className:(0,u.cn)("flex items-center gap-3 rounded-t-2xl px-6 py-4",!a&&"border-b border-divider-subtle",f&&"px-4 py-3"),children:[(0,d.jsx)(P.Message3Fill,{className:"h-6 w-6 shrink-0"}),(0,d.jsx)("div",{className:"system-xl-semibold grow text-text-secondary",children:c("chat.chatSettingsTitle",{ns:"share"})}),a&&(0,d.jsx)(o.default,{className:"uppercase text-text-tertiary",size:"small",variant:"ghost",onClick:()=>b(!1),children:c("operation.edit",{ns:"common"})}),!a&&g&&(0,d.jsx)(o.default,{className:"uppercase text-text-tertiary",size:"small",variant:"ghost",onClick:()=>b(!0),children:c("operation.close",{ns:"common"})})]}),!a&&(0,d.jsx)("div",{className:(0,u.cn)("p-6",f&&"p-4"),children:(0,d.jsx)(N,{})}),!a&&!g&&(0,d.jsx)("div",{className:(0,u.cn)("p-6",f&&"p-4"),children:(0,d.jsx)(o.default,{variant:"primary",className:"w-full",onClick:()=>i(()=>b(!0)),style:h?.theme?{backgroundColor:h?.theme.primaryColor}:{},children:c("chat.startChat",{ns:"share"})})})]}),a&&(0,d.jsxs)("div",{className:"flex w-full max-w-[720px] items-center py-4",children:[(0,d.jsx)(O.default,{bgStyle:"gradient",className:"h-px basis-1/2 rotate-180"}),(0,d.jsx)(O.default,{bgStyle:"gradient",className:"h-px basis-1/2"})]})]})};var R=a.i(499257);let S=({className:a})=>(0,d.jsx)("img",{src:`${R.basePath}/logo/logo-embedded-chat-avatar.png`,className:`block h-10 w-10 ${a}`,alt:"logo"});var T=a.i(189583),U=a.i(954200),V=a.i(892839),W=a.i(992602),X=a.i(847118),Y=a.i(546107);let Z=()=>{let{appData:a,appParams:b,appPrevChatList:c,currentConversationId:e,currentConversationItem:g,currentConversationInputs:h,inputsForms:i,newConversationInputs:j,newConversationInputsRef:k,handleNewConversationCompleted:l,isMobile:m,isInstalledApp:n,appId:o,appMeta:p,disableFeedback:q,handleFeedback:r,currentChatInstanceRef:s,themeBuilder:t,clearChatList:v,setClearChatList:w,setIsResponding:A,allInputsHidden:B,initUserVariables:C,appSourceType:D}=M(),E=(0,f.useMemo)(()=>{let a=b||{};return{...a,file_upload:{...a.file_upload,fileUploadConfig:a.system_parameters},supportFeedback:!0,opening_statement:g?.introduction||a.opening_statement}},[b,g?.introduction]),{chatList:F,setTargetMessageId:G,handleSend:I,handleStop:J,isResponding:L,suggestedQuestions:N}=(0,X.useChat)(E,{inputs:e?h:j,inputsForm:i},c,a=>(0,K.stopChatMessageResponding)("",a,D,o),v,w),O=e?h:k?.current,P=(0,f.useMemo)(()=>{if(B)return!1;let a="",b=!1,c=i.filter(({required:a,type:b})=>a&&b!==H.InputVarType.checkbox);return c.length&&c.forEach(({variable:c,label:d,type:e})=>{if(!a&&!b&&(O?.[c]||(a=d),(e===H.InputVarType.singleFile||e===H.InputVarType.multiFiles)&&O?.[c])){let a=O[c];b=Array.isArray(a)?a.find(a=>a.transferMethod===U.TransferMethod.local_file&&!a.uploadedId):a.transferMethod===U.TransferMethod.local_file&&!a.uploadedId}}),!!a||!!b},[O,i,B]);(0,f.useEffect)(()=>{s.current&&(s.current.handleStop=J)},[s,J]),(0,f.useEffect)(()=>{A(L)},[L,A]);let R=(0,f.useCallback)((a,b,c=!1,d=null)=>{let f={query:a,files:b,inputs:e?h:j,conversation_id:e,parent_message_id:(c?d?.id:(0,Y.getLastAnswer)(F)?.id)||null};I((0,K.getUrl)("chat-messages",D,o||""),f,{onGetSuggestedQuestions:a=>(0,K.fetchSuggestedQuestions)(a,D,o),onConversationComplete:e?void 0:l,isPublicAPI:D===K.AppSourceType.webApp})},[e,h,j,F,I,n,o,l]),Z=(0,f.useCallback)((a,b)=>{let c=b?a:F.find(b=>b.id===a.parentMessageId),d=F.find(a=>a.id===c.parentMessageId);R(b?b.message:c.content,b?b.files:c.message_files,!0,(0,Y.isValidGeneratedAnswer)(d)?d:null)},[F,R]),$=(0,f.useMemo)(()=>e||F.length>1?F:F.filter(a=>!a.isOpeningStatement),[F,e]),_=D===K.AppSourceType.tryApp,[aa,ab]=(0,f.useState)(!!e&&!_),ac=(0,f.useMemo)(()=>B||!i.length?null:m&&e?(0,d.jsx)("div",{className:"mb-4"}):(0,d.jsx)(Q,{collapsed:aa,setCollapsed:ab}),[i.length,m,e,aa,B]),ad=(0,f.useMemo)(()=>{let b=F.find(a=>a.isOpeningStatement);return!L&&!e&&b&&(aa||!(i.length>0)||B)&&a?.site?b.suggestedQuestions&&b.suggestedQuestions?.length>0?(0,d.jsx)("div",{className:(0,u.cn)("flex items-center justify-center px-4 py-12",m?"min-h-[30vh] py-0":"h-[50vh]"),children:(0,d.jsxs)("div",{className:"flex max-w-[720px] grow gap-4",children:[(0,d.jsx)(x.default,{size:"xl",iconType:a?.site.icon_type,icon:a?.site.icon,background:a?.site.icon_background,imageUrl:a?.site.icon_url}),(0,d.jsxs)("div",{className:"body-lg-regular grow rounded-2xl bg-chat-bubble-bg px-4 py-3 text-text-primary",children:[(0,d.jsx)(T.Markdown,{content:b.content}),(0,d.jsx)(z.default,{item:b})]})]})}):(0,d.jsxs)("div",{className:(0,u.cn)("flex min-h-[50vh] flex-col items-center justify-center gap-3 py-12",m?"min-h-[30vh] py-0":"h-[50vh]"),children:[(0,d.jsx)(x.default,{size:"xl",iconType:a?.site.icon_type,icon:a?.site.icon,background:a?.site.icon_background,imageUrl:a?.site.icon_url}),(0,d.jsx)("div",{className:"max-w-[768px] px-4",children:(0,d.jsx)(T.Markdown,{className:"!body-2xl-regular !text-text-tertiary",content:b.content})})]}):null},[a?.site,F,aa,e,i.length,L,B]),ae=document.referrer.includes("dify.ai")?(0,d.jsx)(S,{className:"relative shrink-0"}):a?.site&&a.site.use_icon_as_answer_icon?(0,d.jsx)(y.default,{iconType:a.site.icon_type,icon:a.site.icon,background:a.site.icon_background,imageUrl:a.site.icon_url}):null;return(0,d.jsx)(W.default,{isTryApp:_,appData:a||void 0,config:E,chatList:$,isResponding:L,chatContainerInnerClassName:(0,u.cn)("mx-auto w-full max-w-full px-4",$.length&&"pt-4"),chatFooterClassName:(0,u.cn)("pb-4",!m&&"rounded-b-2xl"),chatFooterInnerClassName:(0,u.cn)("mx-auto w-full max-w-full px-4",m&&"px-2"),onSend:R,inputs:e?h:j,inputsForm:i,onRegenerate:Z,onStopResponding:J,chatNode:(0,d.jsxs)(d.Fragment,{children:[ac,ad]}),allToolIcons:p?.tool_icons||{},disableFeedback:q,onFeedback:r,suggestedQuestions:N,answerIcon:ae,hideProcessDetail:!0,themeBuilder:t,switchSibling:a=>G(a),inputDisabled:P,questionIcon:C?.avatar_url?(0,d.jsx)(V.default,{avatar:C.avatar_url,name:C.name||"user",size:40}):void 0})};var $=a.i(411171),_=a.i(494261),aa=a.i(114715),ab=a.i(858877),ac=a.i(726951),ad=a.i(783098),ae=a.i(325111),af=a.i(818386),ag=a.i(788022),ah=a.i(825319);let ai=({iconColor:a})=>{let{t:b}=(0,r.useTranslation)(),[c,g]=(0,f.useState)(!1);return(0,d.jsxs)(ah.PortalToFollowElem,{open:c,onOpenChange:g,placement:"bottom-end",offset:{mainAxis:4,crossAxis:4},children:[(0,d.jsx)(ah.PortalToFollowElemTrigger,{onClick:()=>g(a=>!a),children:(0,d.jsx)(s.default,{size:"l",state:c?s.ActionButtonState.Hover:s.ActionButtonState.Default,children:(0,d.jsx)(e.RiChatSettingsLine,{className:(0,u.cn)("h-[18px] w-[18px]",a)})})}),(0,d.jsx)(ah.PortalToFollowElemContent,{className:"z-[99]",children:(0,d.jsxs)("div",{className:"w-[400px] rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-lg backdrop-blur-sm",children:[(0,d.jsxs)("div",{className:"flex items-center gap-3 rounded-t-2xl border-b border-divider-subtle px-6 py-4",children:[(0,d.jsx)(P.Message3Fill,{className:"h-6 w-6 shrink-0"}),(0,d.jsx)("div",{className:"system-xl-semibold grow text-text-secondary",children:b("chat.chatSettingsTitle",{ns:"share"})})]}),(0,d.jsx)("div",{className:"p-6",children:(0,d.jsx)(N,{})})]})})]})};var aj=a.i(483664),ak=a.i(585124),al=a.i(463963);let am=f.memo(({appId:a,appDetail:b,className:c})=>{let{t:g}=(0,r.useTranslation)(),h=(0,ak.default)()===ak.MediaType.mobile,i=(0,al.useThemeContext)(),{removeConversationIdInfo:j,...k}=((a,b)=>{let c=a===K.AppSourceType.tryApp,{data:d}=l(c?b:""),e=(0,ac.useWebAppStore)(a=>a.appInfo),g=c?d:e,h=(0,ac.useWebAppStore)(a=>a.appMeta),{data:i}=m(c?b:""),j=(0,ac.useWebAppStore)(a=>a.appParams),k=c?i:j,n=(0,f.useMemo)(()=>c?b:g?.app_id,[g,c,b]),o=(0,ac.useWebAppStore)(a=>a.embeddedConversationId),p=(0,ac.useWebAppStore)(a=>a.embeddedUserId),[q,s]=(0,f.useState)(),[t,u]=(0,f.useState)();(0,f.useEffect)(()=>{c||(0,Y.getProcessedSystemVariablesFromUrlParams)().then(({user_id:a,conversation_id:b})=>{s(a),u(b)})},[]),(0,f.useEffect)(()=>{s(p||void 0)},[p]),(0,f.useEffect)(()=>{u(o||void 0)},[o]),(0,f.useEffect)(()=>{c||(async()=>{let a=new URLSearchParams(window.location.search).get("locale"),b=(await (0,Y.getProcessedSystemVariablesFromUrlParams)()).locale;a?await (0,ad.changeLanguage)(a):b?await (0,ad.changeLanguage)(b):g?.site?.default_language&&await (0,ad.changeLanguage)(g.site?.default_language)})()},[g]);let[v,w]=(0,$.useLocalStorageState)(ag.CONVERSATION_ID_INFO,{defaultValue:{}}),x=(0,f.useCallback)(a=>{w(b=>{let c={...b};return delete c[a],c})},[w]),y=!t,z=(0,f.useMemo)(()=>v?.[n||""]?.[q||"DEFAULT"]||t||"",[n,v,q,t]),A=(0,f.useCallback)(a=>{if(n){let b=v?.[n||""];"string"==typeof b&&(b={}),w({...v,[n||""]:{...b,[q||"DEFAULT"]:a}})}},[n,v,w,q]),[B,C]=(0,f.useState)(""),D=(0,f.useMemo)(()=>z===B?"":z,[z,B]),{data:E}=(0,ae.useShareConversations)({appSourceType:a,appId:n,pinned:!0,limit:100}),{data:F,isLoading:G}=(0,ae.useShareConversations)({appSourceType:a,appId:n,pinned:!1,limit:100}),{data:J,isLoading:L}=(0,ae.useShareChatList)({conversationId:D,appSourceType:a,appId:n}),M=(0,ae.useInvalidateShareConversations)(),[N,O]=(0,f.useState)(!1),[P,Q]=(0,f.useState)(!1),R=(0,f.useMemo)(()=>{var a;let b;return z&&J?.data.length?(0,Y.buildChatItemTree)((a=J.data,b=[],a.forEach(a=>{let c=a.message_files?.filter(a=>"user"===a.belongs_to)||[];b.push({id:`question-${a.id}`,content:a.query,isAnswer:!1,message_files:(0,af.getProcessedFilesFromResponse)(c.map(a=>({...a,related_id:a.id}))),parentMessageId:a.parent_message_id||void 0});let d=a.message_files?.filter(a=>"assistant"===a.belongs_to)||[];b.push({id:a.id,content:a.answer,agent_thoughts:(0,ab.addFileInfos)(a.agent_thoughts?(0,ab.sortAgentSorts)(a.agent_thoughts):a.agent_thoughts,a.message_files),feedback:a.feedback,isAnswer:!0,citation:a.retriever_resources,message_files:(0,af.getProcessedFilesFromResponse)(d.map(a=>({...a,related_id:a.id}))),parentMessageId:`question-${a.id}`})}),b)):[]},[J,z]),[S,T]=(0,f.useState)(!1),V=(0,f.useMemo)(()=>E?.data||[],[E]),{t:W}=(0,r.useTranslation)(),X=(0,f.useRef)({}),[Z,ah]=(0,f.useState)({}),[ai,aj]=(0,f.useState)({}),[ak,al]=(0,f.useState)({}),am=(0,f.useCallback)(a=>{X.current=a,ah(a)},[]),an=(0,f.useMemo)(()=>(k?.user_input_form||[]).filter(a=>!a.external_data_tool).map(a=>{if(a.paragraph){let b=ai[a.paragraph.variable];return b&&a.paragraph.max_length&&b.length>a.paragraph.max_length&&(b=b.slice(0,a.paragraph.max_length)),{...a.paragraph,default:b||a.default||a.paragraph.default,type:"paragraph"}}if(a.number){let b=Number(ai[a.number.variable]);return{...a.number,default:b||a.default||a.number.default,type:"number"}}if(a.checkbox){let b=!0===ai[a.checkbox.variable];return{...a.checkbox,default:b||a.default||a.checkbox.default,type:"checkbox"}}if(a.select){let b=a.select.options.includes(ai[a.select.variable]);return{...a.select,default:(b?ai[a.select.variable]:void 0)||a.select.default,type:"select"}}if(a["file-list"])return{...a["file-list"],type:"file-list"};if(a.file)return{...a.file,type:"file"};if(a.json_object)return{...a.json_object,type:"json_object"};let b=ai[a["text-input"].variable];return b&&a["text-input"].max_length&&b.length>a["text-input"].max_length&&(b=b.slice(0,a["text-input"].max_length)),{...a["text-input"],default:b||a.default||a["text-input"].default,type:"text-input"}}),[ai,k]),ao=(0,f.useMemo)(()=>an.length>0&&an.every(a=>!0===a.hide),[an]);(0,f.useEffect)(()=>{(async()=>{if(c)return;let a=await (0,Y.getProcessedInputsFromUrlParams)(),b=await (0,Y.getProcessedUserVariablesFromUrlParams)();aj(a),al(b)})()},[]),(0,f.useEffect)(()=>{let a={};an.forEach(b=>{a[b.variable]=b.default||null}),am(a)},[am,an]);let{data:ap}=(0,ae.useShareConversationName)({conversationId:B,appSourceType:a,appId:n},{refetchOnWindowFocus:!1,enabled:!c}),[aq,ar]=(0,f.useState)([]);(0,f.useEffect)(()=>{F?.data&&!G&&ar(F?.data)},[F,G]);let as=(0,f.useMemo)(()=>{let a=aq.slice();return S&&a[0]?.id!==""&&a.unshift({id:"",name:W("chat.newChatDefaultName",{ns:"share"}),inputs:{},introduction:""}),a},[aq,S,W]);(0,f.useEffect)(()=>{ap&&ar((0,_.produce)(a=>{let b=a.findIndex(a=>a.id===ap.id);b>-1?a[b]=ap:a.unshift(ap)}))},[ap]);let at=(0,f.useMemo)(()=>{let a=as.find(a=>a.id===z);return!a&&V.length&&(a=V.find(a=>a.id===z)),a},[as,z,V]),au=(0,f.useMemo)(()=>z&&J?.data.length?J.data.slice().pop().inputs||{}:X.current||{},[J,z]),[av,aw]=(0,f.useState)(au||{});(0,f.useEffect)(()=>{at&&!c&&aw(au||{})},[at,au]);let{notify:ax}=(0,aa.useToastContext)(),ay=(0,f.useCallback)(a=>{if(ao)return!0;let b="",c=!1,d=an.filter(({required:a,type:b})=>a&&b!==H.InputVarType.checkbox);return(d.length&&d.forEach(({variable:d,label:e,type:f})=>{if(!b&&!c&&(X.current[d]||a||(b=e),(f===H.InputVarType.singleFile||f===H.InputVarType.multiFiles)&&X.current[d]&&!a)){let a=X.current[d];c=Array.isArray(a)?a.find(a=>a.transferMethod===U.TransferMethod.local_file&&!a.uploadedId):a.transferMethod===U.TransferMethod.local_file&&!a.uploadedId}}),b)?(ax({type:"error",message:W("errorMessage.valueOfVarRequired",{ns:"appDebug",key:b})}),!1):!c||void ax({type:"info",message:W("errorMessage.waitForFileUpload",{ns:"appDebug"})})},[an,ax,W,ao]),az=(0,f.useCallback)(a=>{ay()&&(T(!0),a?.())},[T,ay]),aA=(0,f.useRef)({handleStop:I.noop}),aB=(0,f.useCallback)(a=>{aA.current.handleStop(),C(""),A(a),a&&O(!1)},[A,O]),aC=(0,f.useCallback)(async()=>{c||(aA.current.handleStop(),T(!0),aB(""),am(await (0,Y.getProcessedInputsFromUrlParams)())),O(!0)},[c,T,am,O]),aD=(0,f.useCallback)(a=>{C(a),A(a),T(!1),M()},[A,M]),aE=(0,f.useCallback)(async(b,c)=>{await (0,K.updateFeedback)({url:`/messages/${b}/feedbacks`,body:{rating:c.rating,content:c.content}},a,n),ax({type:"success",message:W("api.success",{ns:"common"})})},[a,n,W,ax]);return{appSourceType:a,isInstalledApp:!1,allowResetChat:y,appId:n,currentConversationId:z,currentConversationItem:at,removeConversationIdInfo:x,handleConversationIdInfoChange:A,appData:g,appParams:k||{},appMeta:h,appPinnedConversationData:E,appConversationData:F,appConversationDataLoading:G,appChatListData:J,appChatListDataLoading:L,appPrevChatList:R,pinnedConversationList:V,conversationList:as,setShowNewConversationItemInList:T,newConversationInputs:Z,newConversationInputsRef:X,handleNewConversationInputsChange:am,inputsForms:an,handleNewConversation:aC,handleStartChat:az,handleChangeConversation:aB,handleNewConversationCompleted:aD,newConversationId:B,chatShouldReloadKey:D,handleFeedback:aE,currentChatInstanceRef:aA,clearChatList:N,setClearChatList:O,isResponding:P,setIsResponding:Q,currentConversationInputs:av,setCurrentConversationInputs:aw,allInputsHidden:ao,initUserVariables:ak}})(K.AppSourceType.tryApp,a),n=k.currentConversationId,o=k.inputsForms;(0,f.useEffect)(()=>{a&&j(a)},[a]);let[p,{setTrue:t}]=(0,q.useBoolean)(!1);return(0,d.jsx)(L.Provider,{value:{...k,disableFeedback:!0,isMobile:h,themeBuilder:i},children:(0,d.jsxs)("div",{className:(0,u.cn)("flex h-full flex-col rounded-2xl bg-background-section-burn",c),children:[(0,d.jsxs)("div",{className:"flex shrink-0 justify-between p-3",children:[(0,d.jsxs)("div",{className:"flex grow items-center space-x-2",children:[(0,d.jsx)(x.default,{size:"large",iconType:b.site.icon_type,icon:b.site.icon,background:b.site.icon_background,imageUrl:b.site.icon_url}),(0,d.jsx)("div",{className:"system-md-semibold grow truncate text-text-primary",title:b.name,children:b.name})]}),(0,d.jsxs)("div",{className:"flex items-center gap-1",children:[n&&(0,d.jsx)(aj.default,{popupContent:g("chat.resetChat",{ns:"share"}),children:(0,d.jsx)(s.default,{size:"l",onClick:()=>{j(a),k.handleNewConversation()},children:(0,d.jsx)(e.RiResetLeftLine,{className:"h-[18px] w-[18px]"})})}),n&&o.length>0&&(0,d.jsx)(ai,{})]})]}),(0,d.jsxs)("div",{className:"mx-auto mt-4 flex h-[0] w-[769px] grow flex-col",children:[!p&&(0,d.jsx)(w,{className:"mb-4 shrink-0",message:g("tryApp.tryInfo",{ns:"explore"}),onHide:t}),(0,d.jsx)(Z,{})]})]})})});var an=a.i(75959),ao=((b={}).pending="pending",b.running="running",b.completed="completed",b.failed="failed",b),ap=a.i(18039),aq=a.i(653822),ar=a.i(800963);let as=f.memo(({appId:a,className:b,isWorkflow:c,appData:e})=>{let{t:h}=(0,r.useTranslation)(),i=(0,ak.default)()===ak.MediaType.pc,[j,k]=(0,f.useState)({}),l=(0,f.useRef)(j),n=(0,f.useCallback)(a=>{k(a),l.current=a},[]),o=(0,ac.useWebAppStore)(a=>a.updateAppInfo),{data:p}=m(a),s=(0,ac.useWebAppStore)(a=>a.updateAppParams),t=(0,ac.useWebAppStore)(a=>a.appParams),[v,y]=(0,f.useState)(null),[z,A]=(0,f.useState)(null),[B,C]=(0,f.useState)(null),[D,E]=(0,f.useState)(null),[F,G]=(0,f.useState)(null),[H,J]=(0,f.useState)(0),[L,M]=(0,f.useState)({enabled:!1,number_limits:2,detail:U.Resolution.low,transfer_methods:[U.TransferMethod.local_file]}),[N,O]=(0,f.useState)([]),[P,{setTrue:Q,setFalse:R}]=(0,q.useBoolean)(!1),S=()=>{setTimeout(()=>{Q()},0)},[T,V]=(0,f.useState)(!1);(0,f.useEffect)(()=>{e&&o(e)},[e,o]),(0,f.useEffect)(()=>{p&&s(p)},[p,s]),(0,f.useEffect)(()=>{(async()=>{if(!e||!t)return;let{site:a,custom_config:b}=e;y(a),C(b);let{user_input_form:c,more_like_this:d,file_upload:f,text_to_speech:g}=t;M({...f,transfer_methods:f?.allowed_file_upload_methods||f?.allowed_upload_methods,image_file_size_limit:t?.system_parameters.image_file_size_limit,fileUploadConfig:t?.system_parameters}),A({prompt_template:"",prompt_variables:(0,aq.userInputsFormToPromptVariables)(c)}),E(d),G(g)})()},[e,t]);let[W,X]=(0,f.useState)(!1),Y=(0,f.useCallback)(()=>{X(!0)},[]),[Z,{setTrue:$}]=(0,q.useBoolean)(!1),_=(0,d.jsx)("div",{className:(0,u.cn)("relative flex h-full flex-col","rounded-r-2xl bg-chatbot-bg"),children:(0,d.jsxs)("div",{className:(0,u.cn)("flex h-0 grow flex-col overflow-y-auto p-6"),children:[W&&!Z&&(0,d.jsx)(w,{className:"mb-3 shrink-0",message:h("tryApp.tryInfo",{ns:"explore"}),onHide:$}),(0,d.jsx)(an.default,{isWorkflow:!!c,isCallBatchAPI:!1,isPC:i,isMobile:!i,appSourceType:K.AppSourceType.tryApp,appId:a,isError:void 0===ao.failed,promptConfig:z,moreLikeThisEnabled:!!D?.enabled,inputs:j,controlSend:H,onShowRes:S,handleSaveMessage:I.noop,taskId:void 0,onCompleted:Y,visionConfig:L,completionFiles:N,isShowTextToSpeech:!!F?.enabled,siteInfo:v,onRunStart:()=>V(!0)},void 0)]})});return v&&z?(0,d.jsxs)("div",{className:(0,u.cn)("rounded-2xl border border-components-panel-border bg-background-section-burn",i&&"flex",!i&&"flex-col","h-full rounded-2xl shadow-md",b),children:[(0,d.jsxs)("div",{className:(0,u.cn)("relative flex h-full shrink-0 flex-col",i&&"w-[600px] max-w-[50%]","rounded-l-2xl bg-components-panel-bg"),children:[(0,d.jsxs)("div",{className:(0,u.cn)("shrink-0 space-y-4 pb-2",i?" p-8 pb-0":"p-4 pb-0"),children:[(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[(0,d.jsx)(x.default,{size:i?"large":"small",iconType:v.icon_type,icon:v.icon,background:v.icon_background||ap.appDefaultIconBackground,imageUrl:v.icon_url}),(0,d.jsx)("div",{className:"system-md-semibold grow truncate text-text-secondary",children:v.title})]}),v.description&&(0,d.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:v.description})]}),(0,d.jsx)("div",{className:(0,u.cn)("h-0 grow overflow-y-auto",i?"px-8":"px-4",!i&&T&&B?.remove_webapp_brand&&"rounded-b-2xl border-b-[0.5px] border-divider-regular"),children:(0,d.jsx)(ar.default,{siteInfo:v,inputs:j,inputsRef:l,onInputsChange:n,promptConfig:z,onSend:()=>{J(Date.now()),S()},visionConfig:L,onVisionFilesChange:O})})]}),(0,d.jsxs)("div",{className:(0,u.cn)("h-full w-0 grow"),children:[!i&&(0,d.jsx)("div",{className:(0,u.cn)(P?"flex items-center justify-center p-2 pt-6":"absolute left-0 top-0 z-10 flex w-full items-center justify-center px-2 pb-[57px] pt-[3px]"),onClick:()=>{P?R():S()},children:(0,d.jsx)("div",{className:"h-1 w-8 cursor-grab rounded bg-divider-solid"})}),_]})]}):(0,d.jsx)("div",{className:(0,u.cn)("flex h-screen items-center",b),children:(0,d.jsx)(g.default,{type:"app"})})}),at=f.memo(({appId:a,appDetail:b})=>{let c=b?.mode,e=["chat","advanced-chat","agent-chat"].includes(c);return(0,p.default)(b?.site?.title||""),(0,d.jsxs)("div",{className:"flex h-full w-full",children:[e&&(0,d.jsx)(am,{appId:a,appDetail:b,className:"h-full grow"}),!e&&(0,d.jsx)(as,{appId:a,className:"h-full grow",isWorkflow:"workflow"===c,appData:{app_id:a,custom_config:{},...b}})]})});var au=a.i(272510),av=a.i(20177);let aw=(a,b)=>`${ap.MARKETPLACE_API_PREFIX}/plugins/${a}/${b}/icon`,ax="system-sm-semibold-uppercase text-text-secondary mb-3",ay=f.memo(({appId:a,className:b,category:c,appDetail:f,onCreate:g})=>{let{t:h}=(0,r.useTranslation)(),i=f?.mode,{requirements:j}=(({appDetail:a,appId:b})=>{let c=["chat","completion","agent-chat"].includes(a.mode),d="agent-chat"===a.mode,e=!c,{data:f}=n(b,c),g=[];if(c){let b=a.model_config.model.provider.split("/"),c=a.model_config.model.provider.split("/").pop()||"";g.push({name:c,iconUrl:aw(b[0],b[1])})}if(d&&g.push(...a.model_config.agent_mode.tools.filter(a=>a.enabled).map(a=>{let b=a.provider_id.split("/");return{name:a.tool_label,iconUrl:aw(b[0],b[1])}})),e&&f&&f?.graph?.nodes?.length>0){let a=f.graph.nodes,b=a.filter(a=>a.data.type===H.BlockEnum.LLM);g.push(...b.map(a=>{let b=a.data,c=b.model.provider.split("/");return{name:b.model.name,iconUrl:aw(c[0],c[1])}}));let c=a.filter(a=>a.data.type===H.BlockEnum.Tool);g.push(...c.map(a=>{let b=a.data,c=b.provider_id.split("/");return{name:b.tool_label,iconUrl:aw(c[0],c[1])}}))}return{requirements:(0,av.uniqBy)(g,"name")}})({appDetail:f,appId:a});return(0,d.jsxs)("div",{className:(0,u.cn)("flex h-full flex-col px-4 pt-2",b),children:[(0,d.jsxs)("div",{className:"flex shrink-0 grow-0 items-center gap-3",children:[(0,d.jsxs)("div",{className:"relative shrink-0",children:[(0,d.jsx)(x.default,{size:"large",iconType:f.site.icon_type,icon:f.site.icon,background:f.site.icon_background,imageUrl:f.site.icon_url}),(0,d.jsx)(au.AppTypeIcon,{wrapperClassName:"absolute -bottom-0.5 -right-0.5 w-4 h-4 shadow-sm",className:"h-3 w-3",type:i})]}),(0,d.jsxs)("div",{className:"w-0 grow py-[1px]",children:[(0,d.jsx)("div",{className:"flex items-center text-sm font-semibold leading-5 text-text-secondary",children:(0,d.jsx)("div",{className:"truncate",title:f.name,children:f.name})}),(0,d.jsxs)("div",{className:"flex items-center text-[10px] font-medium leading-[18px] text-text-tertiary",children:["advanced-chat"===i&&(0,d.jsx)("div",{className:"truncate",children:h("types.advanced",{ns:"app"}).toUpperCase()}),"chat"===i&&(0,d.jsx)("div",{className:"truncate",children:h("types.chatbot",{ns:"app"}).toUpperCase()}),"agent-chat"===i&&(0,d.jsx)("div",{className:"truncate",children:h("types.agent",{ns:"app"}).toUpperCase()}),"workflow"===i&&(0,d.jsx)("div",{className:"truncate",children:h("types.workflow",{ns:"app"}).toUpperCase()}),"completion"===i&&(0,d.jsx)("div",{className:"truncate",children:h("types.completion",{ns:"app"}).toUpperCase()})]})]})]}),f.description&&(0,d.jsx)("div",{className:"system-sm-regular mt-[14px] shrink-0 text-text-secondary",children:f.description}),(0,d.jsxs)(o.default,{variant:"primary",className:"mt-3 flex w-full max-w-full",onClick:g,children:[(0,d.jsx)(e.RiAddLine,{className:"mr-1 size-4 shrink-0"}),(0,d.jsx)("span",{className:"truncate",children:h("tryApp.createFromSampleApp",{ns:"explore"})})]}),c&&(0,d.jsxs)("div",{className:"mt-6 shrink-0",children:[(0,d.jsx)("div",{className:ax,children:h("tryApp.category",{ns:"explore"})}),(0,d.jsx)("div",{className:"system-md-regular text-text-secondary",children:c})]}),j.length>0&&(0,d.jsxs)("div",{className:"mt-5 grow overflow-y-auto",children:[(0,d.jsx)("div",{className:ax,children:h("tryApp.requirements",{ns:"explore"})}),(0,d.jsx)("div",{className:"space-y-0.5",children:j.map(a=>(0,d.jsxs)("div",{className:"flex items-center space-x-2 py-1",children:[(0,d.jsx)("div",{className:"size-5 rounded-md bg-cover shadow-xs",style:{backgroundImage:`url(${a.iconUrl})`}}),(0,d.jsx)("div",{className:"system-md-regular w-0 grow truncate text-text-secondary",children:a.name})]},a.name))})]})]})});var az=a.i(351117),aA=a.i(536799),aB=a.i(55465);a.i(26354);var aC=a.i(858364),aD=a.i(938409),aE=a.i(933988),aF=a.i(120179),aG=a.i(158873),aH=a.i(844137),aI=a.i(459858),aJ=a.i(701458);let aK={provider:"langgenius/openai/openai",model_id:"gpt-3.5-turbo",mode:U.ModelModeType.unset,configs:{prompt_template:"",prompt_variables:[]},more_like_this:null,opening_statement:"",suggested_questions:[],sensitive_word_avoidance:null,speech_to_text:null,text_to_speech:null,file_upload:null,suggested_questions_after_answer:null,retriever_resource:null,annotation_reply:null,dataSets:[],agentConfig:ap.DEFAULT_AGENT_SETTING},aL=f.memo(({appId:a})=>{let b=(0,ak.default)()===ak.MediaType.mobile,{data:c,isLoading:e}=l(a),{data:h,isLoading:i}=(0,aH.useAllToolProviders)(),m=h?.map(a=>({...a,icon:R.basePath&&"string"==typeof a.icon&&!a.icon.includes(R.basePath)?`${R.basePath}${a.icon}`:a.icon})),n=(()=>{if(e)return[];let a=c?.model_config;if(!a)return[];let b=null;return(a.agent_mode?.tools?.find(({dataset:a})=>a?.enabled)?b=a.agent_mode?.tools.filter(({dataset:a})=>a?.enabled):a.dataset_configs.datasets?.datasets?.length>0&&(b=a.dataset_configs?.datasets?.datasets),b?.length&&b?.length>0)?b.map(({dataset:a})=>a.id):[]})(),{data:o,isLoading:p}=(0,j.useQuery)({queryKey:k.consoleQuery.trialApps.datasets.queryKey({input:{params:{appId:a},query:{ids:n}}}),queryFn:()=>k.consoleClient.trialApps.datasets({params:{appId:a},query:{ids:n}}),enabled:n.length>0}),q=o?.data||[],r=e||p||i,s=(a=>{if(r||!a)return aK;let b=a.model;return{provider:(0,aI.correctModelProvider)(b.provider),model_id:b.name,mode:b.mode,configs:{prompt_template:a.pre_prompt||"",prompt_variables:(0,aq.userInputsFormToPromptVariables)([...a.user_input_form,...a.external_data_tools?.length?a.external_data_tools.map(a=>({external_data_tool:{variable:a.variable,label:a.label,enabled:a.enabled,type:a.type,config:a.config,required:!0,icon:a.icon,icon_background:a.icon_background}})):[]],a.dataset_query_variable)},more_like_this:a.more_like_this,opening_statement:a.opening_statement,suggested_questions:a.suggested_questions,sensitive_word_avoidance:a.sensitive_word_avoidance,speech_to_text:a.speech_to_text,text_to_speech:a.text_to_speech,file_upload:a.file_upload,suggested_questions_after_answer:a.suggested_questions_after_answer,retriever_resource:a.retriever_resource,annotation_reply:a.annotation_reply,external_data_tools:a.external_data_tools,dataSets:q,agentConfig:c?.mode==="agent-chat"?{max_iteration:ap.DEFAULT_AGENT_SETTING.max_iteration,...a.agent_mode,enabled:!0,tools:a.agent_mode?.tools.filter(a=>!a.dataset).map(a=>{let b=m?.find(b=>a.provider_id===b.id);return{...a,isDeleted:c?.deleted_tools?.some(b=>b.id===a.id&&b.tool_name===a.tool_name),notAuthor:b?.is_team_authorization===!1,..."builtin"===a.provider_type?{provider_id:(0,aI.correctToolProvider)(a.provider_name,!!b),provider_name:(0,aI.correctToolProvider)(a.provider_name,!!b)}:{}}})}:ap.DEFAULT_AGENT_SETTING}})(c?.model_config),t=c?.mode,u=s?.prompt_type===aG.PromptMode.advanced?aG.PromptMode.advanced:aG.PromptMode.simple,v=u===aG.PromptMode.advanced,w=v?s?.chat_prompt_config||(0,az.clone)(ap.DEFAULT_CHAT_PROMPT_CONFIG):void 0,x=s?.suggested_questions||[],y=s?.more_like_this||{enabled:!1},z=s?.suggested_questions_after_answer||{enabled:!1},A=s?.speech_to_text||{enabled:!1},B=s?.text_to_speech||{enabled:!1,voice:"",language:""},C=s?.retriever_resource||{enabled:!1},D=s?.annotation_reply||{id:"",enabled:!1,score_threshold:ap.ANNOTATION_DEFAULT.score_threshold,embedding_model:{embedding_provider_name:"",embedding_model_name:""}},E=s?.sensitive_word_avoidance||{enabled:!1},F=s?.completion_prompt_config||(0,az.clone)(ap.DEFAULT_COMPLETION_PROMPT_CONFIG),G={},J=(0,f.useState)({}),{currentModel:K}=(0,aJ.useTextGenerationCurrentProviderAndModelAndModelList)({provider:s.provider,model:s.model_id}),L=!!K?.features?.includes(aE.ModelFeatureEnum.vision),M=!!K?.features?.includes(aE.ModelFeatureEnum.document),N=!!K?.features?.includes(aE.ModelFeatureEnum.audio),O=!!K?.features?.includes(aE.ModelFeatureEnum.video),P={enabled:!1,number_limits:2,detail:U.Resolution.low,transfer_methods:[U.TransferMethod.local_file]},Q=(0,f.useMemo)(()=>({moreLikeThis:s.more_like_this||{enabled:!1},opening:{enabled:!!s.opening_statement,opening_statement:s.opening_statement||"",suggested_questions:s.suggested_questions||[]},moderation:s.sensitive_word_avoidance||{enabled:!1},speech2text:s.speech_to_text||{enabled:!1},text2speech:s.text_to_speech||{enabled:!1},file:{image:{detail:s.file_upload?.image?.detail||U.Resolution.high,enabled:!!s.file_upload?.image?.enabled,number_limits:s.file_upload?.image?.number_limits||3,transfer_methods:s.file_upload?.image?.transfer_methods||["local_file","remote_url"]},enabled:!!(s.file_upload?.enabled||s.file_upload?.image?.enabled),allowed_file_types:s.file_upload?.allowed_file_types||[],allowed_file_extensions:s.file_upload?.allowed_file_extensions||[...aD.FILE_EXTS[H.SupportUploadFileTypes.image],...aD.FILE_EXTS[H.SupportUploadFileTypes.video]].map(a=>`.${a}`),allowed_file_upload_methods:s.file_upload?.allowed_file_upload_methods||s.file_upload?.image?.transfer_methods||["local_file","remote_url"],number_limits:s.file_upload?.number_limits||s.file_upload?.image?.number_limits||3,fileUploadConfig:{}},suggested:s.suggested_questions_after_answer||{enabled:!1},citation:s.retriever_resource||{enabled:!1},annotationReply:s.annotation_reply||{enabled:!1}}),[s]);if(r)return(0,d.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,d.jsx)(g.default,{type:"area"})});let S={readonly:!0,appId:a,isAPIKeySet:!0,isTrailFinished:!1,mode:t,modelModeType:"",promptMode:u,isAdvancedMode:v,isAgent:"agent-chat"===t,isOpenAI:!1,isFunctionCall:!1,collectionList:[],setPromptMode:I.noop,canReturnToSimpleMode:!1,setCanReturnToSimpleMode:I.noop,chatPromptConfig:w,completionPromptConfig:F,currentAdvancedPrompt:"",setCurrentAdvancedPrompt:I.noop,conversationHistoriesRole:F.conversation_histories_role,showHistoryModal:!1,setConversationHistoriesRole:I.noop,hasSetBlockStatus:!0,conversationId:"",introduction:"",setIntroduction:I.noop,suggestedQuestions:x,setSuggestedQuestions:I.noop,setConversationId:I.noop,controlClearChatMessage:!1,setControlClearChatMessage:I.noop,prevPromptConfig:{},setPrevPromptConfig:I.noop,moreLikeThisConfig:y,setMoreLikeThisConfig:I.noop,suggestedQuestionsAfterAnswerConfig:z,setSuggestedQuestionsAfterAnswerConfig:I.noop,speechToTextConfig:A,setSpeechToTextConfig:I.noop,textToSpeechConfig:B,setTextToSpeechConfig:I.noop,citationConfig:C,setCitationConfig:I.noop,annotationConfig:D,setAnnotationConfig:I.noop,moderationConfig:E,setModerationConfig:I.noop,externalDataToolsConfig:{},setExternalDataToolsConfig:I.noop,formattingChanged:!1,setFormattingChanged:I.noop,inputs:G,setInputs:I.noop,query:"",setQuery:I.noop,completionParams:J,setCompletionParams:I.noop,modelConfig:s,setModelConfig:I.noop,showSelectDataSet:I.noop,dataSets:q,setDataSets:I.noop,datasetConfigs:[],datasetConfigsRef:{},setDatasetConfigs:I.noop,hasSetContextVar:!0,isShowVisionConfig:L,visionConfig:P,setVisionConfig:I.noop,isAllowVideoUpload:O,isShowDocumentConfig:M,isShowAudioConfig:N,rerankSettingModalOpen:!1,setRerankSettingModalOpen:I.noop};return(0,d.jsx)(aF.default.Provider,{value:S,children:(0,d.jsx)(aC.FeaturesProvider,{features:Q,children:(0,d.jsx)("div",{className:"flex h-full w-full flex-col bg-components-panel-on-panel-item-bg",children:(0,d.jsxs)("div",{className:"relative flex h-[200px] grow",children:[(0,d.jsx)("div",{className:"flex h-full w-full shrink-0 flex-col sm:w-1/2",children:(0,d.jsx)(aA.default,{})}),!b&&(0,d.jsx)("div",{className:"relative flex h-full w-1/2 grow flex-col overflow-y-auto ",style:{borderColor:"rgba(0, 0, 0, 0.02)"},children:(0,d.jsx)("div",{className:"flex grow flex-col rounded-tl-2xl border-l-[0.5px] border-t-[0.5px] border-components-panel-border bg-chatbot-bg ",children:(0,d.jsx)(aB.default,{isAPIKeySet:!0,onSetting:I.noop,inputs:G,modelParameterParams:{setModel:I.noop,onCompletionParamsChange:I.noop},debugWithMultipleModel:!1,multipleModelConfigs:[],onMultipleModelConfigsChange:I.noop})})})]})})})})});var aM=a.i(653621);let aN=f.memo(({appId:a,className:b})=>{let{data:c,isLoading:e}=n(a);return e?(0,d.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,d.jsx)(g.default,{type:"area"})}):c?(0,d.jsx)("div",{className:"h-full w-full",children:(0,d.jsx)(aM.default,{...c.graph,className:(0,u.cn)(b),miniMapToRight:!0})}):null}),aO=f.memo(({appId:a,appDetail:b})=>{let c=["agent-chat","chat","completion"].includes(b.mode);return(0,d.jsx)("div",{className:"h-full w-full",children:c?(0,d.jsx)(aL,{appId:a}):(0,d.jsx)(aN,{appId:a,className:"h-full"})})});var aP=a.i(213228),aQ=((c={}).TRY="try",c.DETAIL="detail",c);let aR=f.memo(({value:a,onChange:b,disableTry:c})=>{let{t:e}=(0,r.useTranslation)(),g=f.useMemo(()=>[ap.IS_CLOUD_EDITION?{id:"try",name:e("tryApp.tabHeader.try",{ns:"explore"}),disabled:c}:null,{id:"detail",name:e("tryApp.tabHeader.detail",{ns:"explore"})}].filter(a=>null!==a),[e,c]);return(0,d.jsx)(aP.default,{items:g,value:a,onChange:b,itemClassName:"ml-0 system-md-semibold-uppercase",itemWrapClassName:"pt-2",activeItemClassName:"border-util-colors-blue-brand-blue-brand-500"})}),aS=f.memo(({appId:a,app:b,category:c,onClose:j,onCreate:k})=>{let{systemFeatures:m}=(0,i.useGlobalPublicStore)(),n=!!(b&&b.can_trial&&m.enable_trial_app),[p,q]=(0,f.useState)(()=>b&&!n?aQ.DETAIL:aQ.TRY),{data:r,isLoading:s}=l(a);return f.useEffect(()=>{b&&!n&&p!==aQ.DETAIL&&q(aQ.DETAIL)},[b,n]),(0,d.jsx)(h.default,{isShow:!0,onClose:j,className:"h-[calc(100vh-32px)] min-w-[1280px] max-w-[calc(100vw-32px)] overflow-x-auto p-2",children:s?(0,d.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,d.jsx)(g.default,{type:"area"})}):(0,d.jsxs)("div",{className:"flex h-full flex-col",children:[(0,d.jsxs)("div",{className:"flex shrink-0 justify-between pl-4",children:[(0,d.jsx)(aR,{value:p,onChange:q,disableTry:!!b&&!n}),(0,d.jsx)(o.default,{size:"large",variant:"tertiary",className:"flex size-7 items-center justify-center rounded-[10px] p-0 text-components-button-tertiary-text",onClick:j,children:(0,d.jsx)(e.RiCloseLine,{className:"size-5",onClick:j})})]}),(0,d.jsxs)("div",{className:"mt-2 flex h-0 grow justify-between space-x-2",children:[p===aQ.TRY?(0,d.jsx)(at,{appId:a,appDetail:r}):(0,d.jsx)(aO,{appId:a,appDetail:r}),(0,d.jsx)(ay,{className:"w-[360px] shrink-0",appDetail:r,appId:a,category:c,onCreate:k})]})]})})});a.s(["default",0,aS],116507)}];

//# sourceMappingURL=_ff367004._.js.map
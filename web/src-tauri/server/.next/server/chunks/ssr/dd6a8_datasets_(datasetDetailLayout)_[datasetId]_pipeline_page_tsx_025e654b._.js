module.exports=[655540,a=>{"use strict";var b=a.i(608061),c=a.i(57843),d=a.i(105249),e=a.i(563667),f=a.i(547904);a.i(713310);var g=a.i(455495),h=a.i(698636),i=a.i(533306);a.i(752298);var j=a.i(693025),k=a.i(909795),l=a.i(42550),m=a.i(114715),n=a.i(847733),o=a.i(425282),p=a.i(599656),q=a.i(682541),r=a.i(730357),s=a.i(499257);let t=c.memo(()=>{let{theme:a}=(0,r.default)();return(0,b.jsxs)("picture",{children:[(0,b.jsx)("source",{media:"(resolution: 1x)",srcSet:`${s.basePath}/screenshots/${a}/Pipeline.png`}),(0,b.jsx)("source",{media:"(resolution: 2x)",srcSet:`${s.basePath}/screenshots/${a}/Pipeline@2x.png`}),(0,b.jsx)("source",{media:"(resolution: 3x)",srcSet:`${s.basePath}/screenshots/${a}/Pipeline@3x.png`}),(0,b.jsx)(q.default,{src:`${s.basePath}/screenshots/${a}/Pipeline.png`,alt:"Pipeline Screenshot",width:692,height:456})]})}),u=c.memo(()=>{let{t:a}=(0,j.useTranslation)(),{datasetId:d}=(0,i.useParams)(),[e,f]=(0,c.useState)(!1),{mutateAsync:g,isPending:h}=(0,p.useConvertDatasetToPipeline)(),q=(0,o.useInvalid)([...n.datasetDetailQueryKeyPrefix,d]),r=(0,c.useCallback)(()=>{g(d,{onSuccess:b=>{"success"===b.status?(m.default.notify({type:"success",message:a("conversion.successMessage",{ns:"datasetPipeline"})}),f(!1),q()):"failed"===b.status&&m.default.notify({type:"error",message:a("conversion.errorMessage",{ns:"datasetPipeline"})})},onError:()=>{m.default.notify({type:"error",message:a("conversion.errorMessage",{ns:"datasetPipeline"})})}})},[g,d,q,a]),s=(0,c.useCallback)(()=>{f(!0)},[]),u=(0,c.useCallback)(()=>{f(!1)},[]);return(0,b.jsxs)("div",{className:"flex h-full w-full items-center justify-center bg-background-body p-6 pb-16",children:[(0,b.jsxs)("div",{className:"flex rounded-2xl border-[0.5px] border-components-card-border bg-components-card-bg shadow-sm shadow-shadow-shadow-4",children:[(0,b.jsxs)("div",{className:"flex max-w-[480px] flex-col justify-between p-10",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-y-2.5",children:[(0,b.jsx)("div",{className:"title-4xl-semi-bold text-text-primary",children:a("conversion.title",{ns:"datasetPipeline"})}),(0,b.jsxs)("div",{className:"body-md-medium",children:[(0,b.jsx)("span",{className:"text-text-secondary",children:a("conversion.descriptionChunk1",{ns:"datasetPipeline"})}),(0,b.jsx)("span",{className:"text-text-tertiary",children:a("conversion.descriptionChunk2",{ns:"datasetPipeline"})})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-x-4",children:[(0,b.jsx)(k.default,{variant:"primary",className:"w-32",onClick:s,children:a("operations.convert",{ns:"datasetPipeline"})}),(0,b.jsx)("span",{className:"system-xs-regular text-text-warning",children:a("conversion.warning",{ns:"datasetPipeline"})})]})]}),(0,b.jsx)("div",{className:"pb-8 pl-[25px] pr-0 pt-6",children:(0,b.jsx)("div",{className:"rounded-l-xl border border-effects-highlight bg-background-default p-1 shadow-md shadow-shadow-shadow-5 backdrop-blur-[5px]",children:(0,b.jsx)("div",{className:"overflow-hidden rounded-l-lg",children:(0,b.jsx)(t,{})})})})]}),e&&(0,b.jsx)(l.default,{title:a("conversion.confirm.title",{ns:"datasetPipeline"}),content:a("conversion.confirm.content",{ns:"datasetPipeline"}),isShow:e,onConfirm:r,onCancel:u,isLoading:h,isDisabled:h})]})});var v=a.i(356616);a.i(412708);var w=a.i(851571);a.i(624825);var x=a.i(235268),y=a.i(445778),z=a.i(919915),A=a.i(13267),B=a.i(665201),C=a.i(704591),D=a.i(881771),E=a.i(954200),F=a.i(717138);let G=()=>{let a=(0,w.useStore)(a=>a.pipelineId),b=(0,w.useStore)(a=>a.fileUploadConfig);return(0,c.useMemo)(()=>({flowId:a,flowType:F.FlowType.ragPipeline,fileSettings:{image:{enabled:!1,detail:E.Resolution.high,number_limits:3,transfer_methods:[E.TransferMethod.local_file,E.TransferMethod.remote_url]},fileUploadConfig:b}}),[a])};var H=a.i(799118),I=a.i(252613),J=a.i(429150),K=a.i(111089),L=a.i(168799);a.i(73009);var M=a.i(284391),N=a.i(940272),O=a.i(527344);let P=({envList:a=[],onConfirm:d,onClose:e})=>{let{t:f}=(0,j.useTranslation)(),[g,h]=(0,c.useState)(!1);return(0,b.jsxs)(N.default,{isShow:!0,onClose:K.noop,className:(0,O.cn)("w-[480px] max-w-[480px]"),children:[(0,b.jsx)("div",{className:"title-2xl-semi-bold relative pb-6 text-text-primary",children:f("env.export.title",{ns:"workflow"})}),(0,b.jsx)("div",{className:"absolute right-4 top-4 cursor-pointer p-2",onClick:e,children:(0,b.jsx)(J.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})}),(0,b.jsx)("div",{className:"relative",children:(0,b.jsxs)("table",{className:"radius-md w-full border-separate border-spacing-0 border border-divider-regular shadow-xs",children:[(0,b.jsx)("thead",{className:"system-xs-medium-uppercase text-text-tertiary",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{width:220,className:"h-7 border-b border-r border-divider-regular pl-3",children:"NAME"}),(0,b.jsx)("td",{className:"h-7 border-b border-divider-regular pl-3",children:"VALUE"})]})}),(0,b.jsx)("tbody",{children:a.map((c,d)=>(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{className:(0,O.cn)("system-xs-medium h-7 border-r pl-3",d+1!==a.length&&"border-b"),children:(0,b.jsxs)("div",{className:"flex w-[200px] items-center gap-1",children:[(0,b.jsx)(M.Env,{className:"h-4 w-4 shrink-0 text-util-colors-violet-violet-600"}),(0,b.jsx)("div",{className:"truncate text-text-primary",children:c.name}),(0,b.jsx)("div",{className:"shrink-0 text-text-tertiary",children:"Secret"}),(0,b.jsx)(J.RiLock2Line,{className:"h-3 w-3 shrink-0 text-text-tertiary"})]})}),(0,b.jsx)("td",{className:(0,O.cn)("h-7 pl-3",d+1!==a.length&&"border-b"),children:(0,b.jsx)("div",{className:"system-xs-regular truncate text-text-secondary",children:c.value})})]},c.name))})]})}),(0,b.jsxs)("div",{className:"mt-4 flex gap-2",children:[(0,b.jsx)(L.default,{className:"shrink-0",checked:g,onCheck:()=>h(!g)}),(0,b.jsx)("div",{className:"system-sm-medium cursor-pointer text-text-primary",onClick:()=>h(!g),children:f("env.export.checkbox",{ns:"workflow"})})]}),(0,b.jsxs)("div",{className:"flex flex-row-reverse pt-6",children:[(0,b.jsx)(k.default,{className:"ml-2",variant:"primary",onClick:()=>{d(g),e()},children:f(g?"env.export.export":"env.export.ignore",{ns:"workflow"})}),(0,b.jsx)(k.default,{onClick:e,children:f("operation.cancel",{ns:"common"})})]})]})};a.i(529638);var Q=a.i(583373),R=a.i(505618),S=a.i(124116),T=a.i(438616),U=a.i(545934),V=a.i(438961),W=a.i(893463),X=a.i(926827),Y=a.i(602024),Z=a.i(735310),$=a.i(791881),_=a.i(860653),aa=a.i(129095);let ab=(0,_.default)(async()=>{},{loadableGenerated:{modules:[689516]},ssr:!1}),ac=(0,_.default)(async()=>{},{loadableGenerated:{modules:[663443]},ssr:!1}),ad=(0,_.default)(async()=>{},{loadableGenerated:{modules:[283916]},ssr:!1}),ae=(0,_.default)(async()=>{},{loadableGenerated:{modules:[883816]},ssr:!1}),af=(0,_.default)(async()=>{},{loadableGenerated:{modules:[645423]},ssr:!1}),ag=(0,_.default)(async()=>{},{loadableGenerated:{modules:[932933]},ssr:!1}),ah=()=>{let a=(0,w.useStore)(a=>a.historyWorkflowData),c=(0,w.useStore)(a=>a.showDebugAndPreviewPanel),d=(0,w.useStore)(a=>a.showGlobalVariablePanel);return(0,b.jsxs)(b.Fragment,{children:[a&&(0,b.jsx)(ab,{}),c&&(0,b.jsx)(ac,{}),d&&(0,b.jsx)(ag,{})]})},ai=()=>{let a=(0,w.useStore)(a=>a.showInputFieldPanel),c=(0,w.useStore)(a=>a.showInputFieldPreviewPanel),d=(0,w.useStore)(a=>a.inputFieldEditPanelProps);return(0,b.jsxs)(b.Fragment,{children:[c&&(0,b.jsx)(af,{}),d&&(0,b.jsx)(ae,{...d}),a&&(0,b.jsx)(ad,{})]})},aj=(0,c.memo)(()=>{let a=(0,w.useStore)(a=>a.pipelineId),d=(0,c.useMemo)(()=>({getVersionListUrl:`/rag/pipelines/${a}/workflows`,deleteVersionUrl:b=>`/rag/pipelines/${a}/workflows/${b}`,updateVersionUrl:b=>`/rag/pipelines/${a}/workflows/${b}`,latestVersionId:""}),[a]),e=(0,c.useMemo)(()=>({components:{left:(0,b.jsx)(ai,{}),right:(0,b.jsx)(ah,{})},versionHistoryPanelProps:d}),[d]);return(0,b.jsx)(aa.default,{...e})}),ak=(0,c.memo)(()=>{let{t:a}=(0,j.useTranslation)(),d=(0,w.useStore)(a=>a.publishedAt),[e,f]=(0,c.useState)(!1);return d||e?null:(0,b.jsx)("div",{className:"pointer-events-none absolute bottom-[45px] left-0 right-0 z-10 flex justify-center",children:(0,b.jsxs)("div",{className:"relative flex w-[420px] space-x-1 overflow-hidden rounded-xl border border-components-panel-border bg-components-panel-bg-blur p-3 shadow-lg",children:[(0,b.jsx)("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-r from-components-badge-status-light-normal-halo to-background-gradient-mask-transparent opacity-[0.4]"}),(0,b.jsx)("div",{className:"flex h-6 w-6 items-center justify-center",children:(0,b.jsx)(J.RiInformation2Fill,{className:"text-text-accent"})}),(0,b.jsxs)("div",{className:"p-1",children:[(0,b.jsx)("div",{className:"system-sm-semibold mb-1 text-text-primary",children:a("publishToast.title",{ns:"pipeline"})}),(0,b.jsx)("div",{className:"system-xs-regular text-text-secondary",children:a("publishToast.desc",{ns:"pipeline"})})]}),(0,b.jsx)("div",{className:"pointer-events-auto flex h-6 w-6 cursor-pointer items-center justify-center",onClick:()=>f(!0),children:(0,b.jsx)(J.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})})]})})});var al=a.i(346315);a.i(137550);var am=a.i(307558);let an=()=>{let{t:a}=(0,j.useTranslation)(),d=(0,w.useStore)(a=>a.setShowInputFieldPanel),e=(0,w.useStore)(a=>a.setShowEnvPanel),f=(0,c.useCallback)(()=>{d?.(!0),e(!1)},[d,e]);return(0,b.jsxs)(k.default,{variant:"secondary",className:"flex gap-x-0.5",onClick:f,children:[(0,b.jsx)(am.InputField,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"px-0.5",children:a("inputField",{ns:"datasetPipeline"})})]})};var ao=a.i(825319),ap=a.i(581117),aq=a.i(497746),ar=a.i(261574),as=a.i(413192),at=a.i(578652);a.i(60796);var au=a.i(55282),av=a.i(757801);a.i(916818);var aw=a.i(529335),ax=a.i(608348),ay=a.i(990693),az=a.i(56328),aA=a.i(128972),aB=a.i(252813),aC=a.i(29255),aD=a.i(375616),aE=a.i(61500),aF=a.i(204685),aG=a.i(374715),aH=a.i(355968),aI=a.i(429178),aJ=a.i(816134),aK=a.i(146172);let aL=({confirmDisabled:a,onCancel:d,onConfirm:e})=>{let{t:f}=(0,j.useTranslation)(),g=(0,w.useWorkflowStore)(),[h,i]=(0,c.useState)(()=>g.getState().knowledgeName),[l,m]=(0,c.useState)(()=>g.getState().knowledgeIcon),[n,o]=(0,c.useState)(""),[p,q]=(0,c.useState)(!1),r=(0,c.useCallback)(a=>{"image"===a.type&&m({icon_type:"image",icon_url:a.url,icon_background:"",icon:""}),"emoji"===a.type&&m({icon_type:"emoji",icon:a.icon,icon_background:a.background,icon_url:""}),q(!1)},[]),s=(0,c.useCallback)(()=>{m({icon_type:l.icon_type,icon:l.icon,icon_background:l.icon_background,icon_url:l.icon_url}),q(!1)},[l]);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(N.default,{isShow:!0,onClose:K.noop,className:"relative !w-[520px] !p-0",children:[(0,b.jsxs)("div",{className:"title-2xl-semi-bold relative flex items-center p-6 pb-3 pr-14 text-text-primary",children:[f("common.publishAs",{ns:"pipeline"}),(0,b.jsx)("div",{"data-testid":"publish-modal-close-btn",className:"absolute right-5 top-5 flex h-8 w-8 cursor-pointer items-center justify-center",onClick:d,children:(0,b.jsx)(J.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})})]}),(0,b.jsxs)("div",{className:"px-6 py-3",children:[(0,b.jsxs)("div",{className:"mb-5 flex",children:[(0,b.jsxs)("div",{className:"mr-3 grow",children:[(0,b.jsx)("div",{className:"system-sm-medium mb-1 flex h-6 items-center text-text-secondary",children:f("common.publishAsPipeline.name",{ns:"pipeline"})}),(0,b.jsx)(aJ.default,{value:h,onChange:a=>i(a.target.value),placeholder:f("common.publishAsPipeline.namePlaceholder",{ns:"pipeline"})||""})]}),(0,b.jsx)(aH.default,{size:"xxl",onClick:()=>{q(!0)},className:"mt-2 shrink-0 cursor-pointer",iconType:l?.icon_type,icon:l?.icon,background:l?.icon_background,imageUrl:l?.icon_url})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"system-sm-medium mb-1 flex h-6 items-center text-text-secondary ",children:f("common.publishAsPipeline.description",{ns:"pipeline"})}),(0,b.jsx)(aK.default,{className:"resize-none",placeholder:f("common.publishAsPipeline.descriptionPlaceholder",{ns:"pipeline"})||"",value:n,onChange:a=>o(a.target.value)})]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-end px-6 py-5",children:[(0,b.jsx)(k.default,{className:"mr-2",onClick:d,children:f("operation.cancel",{ns:"common"})}),(0,b.jsx)(k.default,{disabled:!h?.trim()||a,variant:"primary",onClick:()=>void(!a&&e(h?.trim()||"",l,n?.trim())),children:f("common.publish",{ns:"workflow"})})]})]}),p&&(0,b.jsx)(aI.default,{onSelect:r,onClose:s})]})},aM=["ctrl","⇧","P"],aN=(0,c.memo)(()=>{let{t:a}=(0,j.useTranslation)(),{datasetId:d}=(0,i.useParams)(),{push:e}=(0,i.useRouter)(),f=(0,aB.useDocLink)(),g=(0,w.useStore)(a=>a.publishedAt),q=(0,w.useStore)(a=>a.draftUpdatedAt),r=(0,w.useStore)(a=>a.pipelineId),s=(0,h.useDatasetDetailContextWithSelector)(a=>a.mutateDatasetRes),[t,u]=(0,c.useState)(!1),{formatTimeFromNow:v}=(0,aF.useFormatTimeFromNow)(),{handleCheckBeforePublish:x}=(0,ay.useChecklistBeforePublish)(),{mutateAsync:y}=(0,aG.usePublishWorkflow)(),{notify:z}=(0,m.useToastContext)(),A=(0,w.useWorkflowStore)(),{isAllowPublishAsCustomKnowledgePipelineTemplate:B}=(0,aD.useProviderContext)(),C=(0,aC.useModalContextSelector)(a=>a.setShowPricingModal),D=(0,aE.useDatasetApiAccessUrl)(),[E,{setFalse:F,setTrue:G}]=(0,aq.useBoolean)(!1),[H,{setFalse:I,setTrue:K}]=(0,aq.useBoolean)(!1),{mutateAsync:L}=(0,p.usePublishAsCustomizedPipeline)(),[M,{setFalse:N,setTrue:P}]=(0,aq.useBoolean)(!1),[Q,{setFalse:R,setTrue:S}]=(0,aq.useBoolean)(!1),T=(0,o.useInvalid)([...p.publishedPipelineInfoQueryKeyPrefix,r]),U=(0,n.useInvalidDatasetList)(),V=(0,c.useCallback)(async c=>{if(!H)try{if(await x()){if(!g&&!E)return void G();K();let e=await y({url:`/rag/pipelines/${r}/workflows/publish`,title:c?.title||"",releaseNotes:c?.releaseNotes||""});u(!0),(0,au.trackEvent)("app_published_time",{action_mode:"pipeline",app_id:d,app_name:c?.title||""}),e&&(z({type:"success",message:a("publishPipeline.success.message",{ns:"datasetPipeline"}),children:(0,b.jsx)("div",{className:"system-xs-regular text-text-secondary",children:(0,b.jsx)(at.Trans,{i18nKey:"publishPipeline.success.tip",ns:"datasetPipeline",components:{CustomLink:(0,b.jsx)(as.default,{className:"system-xs-medium text-text-accent",href:`/datasets/${d}/documents`})}})})}),A.getState().setPublishedAt(e.created_at),s?.(),T(),U())}}catch{z({type:"error",message:a("publishPipeline.error.message",{ns:"datasetPipeline"})})}finally{H&&I(),E&&F()}},[x,y,r,z,a,A,s,T,G,g,E,I,K,F,H]);(0,ar.useKeyPress)(`${(0,aA.getKeyboardKeyCodeBySystem)("ctrl")}.shift.p`,a=>{a.preventDefault(),t||V()},{exactMatch:!0,useCapture:!0});let W=(0,c.useCallback)(()=>{e(`/datasets/${d}/documents/create-from-pipeline`)},[d,e]),X=(0,p.useInvalidCustomizedTemplateList)(),Y=(0,c.useCallback)(async(c,d,e)=>{try{S(),await L({pipelineId:r||"",name:c,icon_info:d,description:e}),z({type:"success",message:a("publishTemplate.success.message",{ns:"datasetPipeline"}),children:(0,b.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,b.jsx)("span",{className:"system-xs-regular text-text-secondary",children:a("publishTemplate.success.tip",{ns:"datasetPipeline"})}),(0,b.jsx)(as.default,{href:f(),target:"_blank",className:"system-xs-medium-uppercase inline-block text-text-accent",children:a("publishTemplate.success.learnMore",{ns:"datasetPipeline"})})]})}),X()}catch{z({type:"error",message:a("publishTemplate.error.message",{ns:"datasetPipeline"})})}finally{R(),N()}},[r,L,S,R,N,z,a]),Z=(0,c.useCallback)(()=>{B?P():C()},[B,P,C]);return(0,b.jsxs)("div",{className:(0,O.cn)("rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-xl shadow-shadow-shadow-5",B?"w-[360px]":"w-[400px]"),children:[(0,b.jsxs)("div",{className:"p-4 pt-3",children:[(0,b.jsx)("div",{className:"system-xs-medium-uppercase flex h-6 items-center text-text-tertiary",children:g?a("common.latestPublished",{ns:"workflow"}):a("common.currentDraftUnpublished",{ns:"workflow"})}),g?(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsxs)("div",{className:"system-sm-medium flex items-center text-text-secondary",children:[a("common.publishedAt",{ns:"workflow"})," ",v(g)]})}):(0,b.jsxs)("div",{className:"system-sm-medium flex items-center text-text-secondary",children:[a("common.autoSaved",{ns:"workflow"})," ","·",!!q&&v(q)]}),(0,b.jsx)(k.default,{variant:"primary",className:"mt-3 w-full",onClick:()=>V(),disabled:t||H,children:t?a("common.published",{ns:"workflow"}):(0,b.jsxs)("div",{className:"flex gap-1",children:[(0,b.jsx)("span",{children:a("common.publishUpdate",{ns:"workflow"})}),(0,b.jsx)(az.default,{keys:aM,bgColor:"white"})]})})]}),(0,b.jsxs)("div",{className:"border-t-[0.5px] border-t-divider-regular p-4 pt-3",children:[(0,b.jsxs)(k.default,{className:"mb-1 w-full hover:bg-state-accent-hover hover:text-text-accent",variant:"tertiary",onClick:W,disabled:!g,children:[(0,b.jsxs)("div",{className:"flex grow items-center",children:[(0,b.jsx)(J.RiPlayCircleLine,{className:"mr-2 h-4 w-4"}),a("common.goToAddDocuments",{ns:"pipeline"})]}),(0,b.jsx)(J.RiArrowRightUpLine,{className:"ml-2 h-4 w-4 shrink-0"})]}),(0,b.jsx)(as.default,{href:D,target:"_blank",rel:"noopener noreferrer",children:(0,b.jsxs)(k.default,{className:"w-full hover:bg-state-accent-hover hover:text-text-accent",variant:"tertiary",disabled:!g,children:[(0,b.jsxs)("div",{className:"flex grow items-center",children:[(0,b.jsx)(J.RiTerminalBoxLine,{className:"mr-2 h-4 w-4"}),a("common.accessAPIReference",{ns:"workflow"})]}),(0,b.jsx)(J.RiArrowRightUpLine,{className:"ml-2 h-4 w-4 shrink-0"})]})}),(0,b.jsx)(av.default,{className:"my-2"}),(0,b.jsx)(k.default,{className:"w-full hover:bg-state-accent-hover hover:text-text-accent",variant:"tertiary",onClick:Z,disabled:!g||Q,children:(0,b.jsxs)("div",{className:"flex grow items-center gap-x-2 overflow-hidden",children:[(0,b.jsx)(J.RiHammerLine,{className:"h-4 w-4 shrink-0"}),(0,b.jsx)("span",{className:"grow truncate text-left",title:a("common.publishAs",{ns:"pipeline"}),children:a("common.publishAs",{ns:"pipeline"})}),!B&&(0,b.jsxs)(ax.default,{className:"shrink-0 cursor-pointer select-none",size:"s",color:"indigo",children:[(0,b.jsx)(aw.SparklesSoft,{className:"flex size-3 items-center text-components-premium-badge-indigo-text-stop-0"}),(0,b.jsx)("span",{className:"system-2xs-medium p-0.5",children:a("upgradeBtn.encourageShort",{ns:"billing"})})]})]})})]}),E&&(0,b.jsx)(l.default,{isShow:E,title:a("common.confirmPublish",{ns:"pipeline"}),content:a("common.confirmPublishContent",{ns:"pipeline"}),onCancel:F,onConfirm:V,isDisabled:H}),M&&(0,b.jsx)(aL,{confirmDisabled:Q,onConfirm:Y,onCancel:N})]})}),aO=(0,c.memo)(()=>{let{t:a}=(0,j.useTranslation)(),[d,e]=(0,c.useState)(!1),{handleSyncWorkflowDraft:f}=(0,ap.useNodesSyncDraft)(),g=(0,c.useCallback)(a=>{a&&f(!0),e(a)},[f]);return(0,b.jsxs)(ao.PortalToFollowElem,{open:d,onOpenChange:e,placement:"bottom-end",offset:{mainAxis:4,crossAxis:40},children:[(0,b.jsx)(ao.PortalToFollowElemTrigger,{onClick:()=>g(!d),children:(0,b.jsxs)(k.default,{className:"px-2",variant:"primary",children:[(0,b.jsx)("span",{className:"pl-1",children:a("common.publish",{ns:"workflow"})}),(0,b.jsx)(J.RiArrowDownSLine,{className:"h-4 w-4"})]})}),(0,b.jsx)(ao.PortalToFollowElemContent,{className:"z-[11]",children:(0,b.jsx)(aN,{})})]})});a.i(644726);var aP=a.i(891169),aQ=a.i(621865),aR=a.i(412795),aS=a.i(820494);let aT=c.memo(({text:a})=>{let{t:d}=(0,j.useTranslation)(),{handleWorkflowStartRunInWorkflow:e}=(0,aR.useWorkflowStartRun)(),{handleStopRun:f}=(0,aQ.useWorkflowRun)(),g=(0,w.useWorkflowStore)(),h=(0,w.useStore)(a=>a.workflowRunningData),i=(0,w.useStore)(a=>a.isPreparingDataSource),k=h?.result.status===Z.WorkflowRunningStatus.Running,l=i||k,m=(0,c.useCallback)(()=>{f(h?.task_id||"")},[f,h?.task_id]),n=(0,c.useCallback)(()=>{let{setIsPreparingDataSource:a,setShowDebugAndPreviewPanel:b}=g.getState();a?.(!1),b(!1)},[g]),{eventEmitter:o}=(0,S.useEventEmitterContextContext)();return o?.useSubscription(a=>{a.type===aS.EVENT_WORKFLOW_STOP&&m()}),(0,b.jsxs)("div",{className:"flex items-center gap-x-px",children:[(0,b.jsxs)("button",{type:"button",className:(0,O.cn)("system-xs-medium flex h-7 items-center gap-x-1 px-1.5 text-text-accent hover:bg-state-accent-hover",l&&"cursor-not-allowed bg-state-accent-hover",l?"rounded-l-md":"rounded-md"),onClick:()=>{e()},disabled:l,children:[!l&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(J.RiPlayLargeLine,{className:"mr-1 size-4"}),h?d("common.reRun",{ns:"pipeline"}):a??d("common.testRun",{ns:"pipeline"})]}),k&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(J.RiLoader2Line,{className:"mr-1 size-4 animate-spin"}),d("common.processing",{ns:"pipeline"})]}),i&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(J.RiDatabase2Line,{className:"mr-1 size-4"}),d("common.preparingDataSource",{ns:"pipeline"})]}),!l&&(0,b.jsx)(az.default,{keys:["alt","R"],textColor:"secondary"})]}),k&&(0,b.jsx)("button",{type:"button",className:(0,O.cn)("flex size-7 items-center justify-center rounded-r-md bg-state-accent-active"),onClick:m,children:(0,b.jsx)(aP.StopCircle,{className:"size-4 text-text-accent"})}),i&&(0,b.jsx)("button",{type:"button",className:(0,O.cn)("flex size-7 items-center justify-center rounded-r-md bg-state-accent-active"),onClick:n,children:(0,b.jsx)(J.RiCloseLine,{className:"size-4 text-text-accent"})})]})}),aU=(0,c.memo)(()=>{let a=(0,w.useStore)(a=>a.pipelineId),d=(0,c.useMemo)(()=>({historyUrl:`/rag/pipelines/${a}/workflow-runs`}),[a]),e=(0,c.useMemo)(()=>({normal:{components:{left:(0,b.jsx)(an,{}),middle:(0,b.jsx)(aO,{})},runAndHistoryProps:{showRunButton:!0,viewHistoryProps:d,components:{RunMode:aT}}},viewHistory:{viewHistoryProps:d}}),[d]);return(0,b.jsx)(al.default,{...e})});var aV=a.i(639378),aW=a.i(887304),aX=a.i(422335),aY=a.i(343837),aZ=a.i(24561);let a$=(0,c.memo)(({onCancel:a,onBackup:d,onImport:e})=>{let{t:f}=(0,j.useTranslation)(),{notify:h}=(0,aV.useContext)(m.ToastContext),[i,l]=(0,c.useState)(),[n,o]=(0,c.useState)(),[q,r]=(0,c.useState)(!1),{eventEmitter:s}=(0,S.useEventEmitterContextContext)(),[t,u]=(0,c.useState)(!0),[v,x]=(0,c.useState)(!1),[y,z]=(0,c.useState)(),[A,B]=(0,c.useState)(),{handleCheckPluginDependencies:C}=(0,aX.usePluginDependencies)(),{mutateAsync:D}=(0,p.useImportPipelineDSL)(),{mutateAsync:E}=(0,p.useImportPipelineDSLConfirm)(),F=(0,w.useWorkflowStore)(),G=(0,c.useCallback)(async a=>{let{graph:b,hash:c,rag_pipeline_variables:d}=await (0,aZ.fetchWorkflowDraft)(`/rag/pipelines/${a}/workflows/draft`),{nodes:e,edges:f,viewport:h}=b;s?.emit({type:I.WORKFLOW_DATA_UPDATE,payload:{nodes:(0,g.initialNodes)(e,f),edges:(0,g.initialEdges)(f,e),viewport:h,hash:c,rag_pipeline_variables:d||[]}})},[s]),H=(0,c.useRef)(!1),K=(0,c.useCallback)(async()=>{let{pipelineId:b}=F.getState();if(!H.current&&(H.current=!0,i)){try{if(b&&n){r(!0);let{id:c,status:d,pipeline_id:g,imported_dsl_version:i,current_dsl_version:j}=await D({mode:aY.DSLImportMode.YAML_CONTENT,yaml_content:n,pipeline_id:b});if(d===aY.DSLImportStatus.COMPLETED||d===aY.DSLImportStatus.COMPLETED_WITH_WARNINGS){if(!g)return void h({type:"error",message:f("common.importFailure",{ns:"workflow"})});G(g),e&&e(),h({type:d===aY.DSLImportStatus.COMPLETED?"success":"warning",message:f(d===aY.DSLImportStatus.COMPLETED?"common.importSuccess":"common.importWarning",{ns:"workflow"}),children:d===aY.DSLImportStatus.COMPLETED_WITH_WARNINGS&&f("common.importWarningDetails",{ns:"workflow"})}),await C(g,!0),r(!1),a()}else d===aY.DSLImportStatus.PENDING?(u(!1),setTimeout(()=>{x(!0)},300),z({importedVersion:i??"",systemVersion:j??""}),B(c)):(r(!1),h({type:"error",message:f("common.importFailure",{ns:"workflow"})}))}}catch(a){r(!1),h({type:"error",message:f("common.importFailure",{ns:"workflow"})})}H.current=!1}},[i,n,a,h,f,e,G,C,F,D]),L=async()=>{try{if(!A)return;let{status:b,pipeline_id:c}=await E(A);if(b===aY.DSLImportStatus.COMPLETED){if(!c)return void h({type:"error",message:f("common.importFailure",{ns:"workflow"})});G(c),await C(c,!0),e&&e(),h({type:"success",message:f("common.importSuccess",{ns:"workflow"})}),r(!1),a()}else b===aY.DSLImportStatus.FAILED&&(r(!1),h({type:"error",message:f("common.importFailure",{ns:"workflow"})}))}catch(a){r(!1),h({type:"error",message:f("common.importFailure",{ns:"workflow"})})}};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(N.default,{className:"w-[520px] rounded-2xl p-6",isShow:t,onClose:a,children:[(0,b.jsxs)("div",{className:"mb-3 flex items-center justify-between",children:[(0,b.jsx)("div",{className:"title-2xl-semi-bold text-text-primary",children:f("common.importDSL",{ns:"workflow"})}),(0,b.jsx)("div",{className:"flex h-[22px] w-[22px] cursor-pointer items-center justify-center",onClick:a,children:(0,b.jsx)(J.RiCloseLine,{className:"h-[18px] w-[18px] text-text-tertiary"})})]}),(0,b.jsxs)("div",{className:"relative mb-2 flex grow gap-0.5 overflow-hidden rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur p-2 shadow-xs",children:[(0,b.jsx)("div",{className:"absolute left-0 top-0 h-full w-full bg-toast-warning-bg opacity-40"}),(0,b.jsx)("div",{className:"flex items-start justify-center p-1",children:(0,b.jsx)(J.RiAlertFill,{className:"h-4 w-4 shrink-0 text-text-warning-secondary"})}),(0,b.jsxs)("div",{className:"flex grow flex-col items-start gap-0.5 py-1",children:[(0,b.jsx)("div",{className:"system-xs-medium whitespace-pre-line text-text-primary",children:f("common.importDSLTip",{ns:"workflow"})}),(0,b.jsx)("div",{className:"flex items-start gap-1 self-stretch pb-0.5 pt-1",children:(0,b.jsxs)(k.default,{size:"small",variant:"secondary",className:"z-[1000]",onClick:d,children:[(0,b.jsx)(J.RiFileDownloadLine,{className:"h-3.5 w-3.5 text-components-button-secondary-text"}),(0,b.jsx)("div",{className:"flex items-center justify-center gap-1 px-[3px]",children:f("common.backupCurrentDraft",{ns:"workflow"})})]})})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"system-md-semibold pt-2 text-text-primary",children:f("common.chooseDSL",{ns:"workflow"})}),(0,b.jsx)("div",{className:"flex w-full flex-col items-start justify-center gap-4 self-stretch py-4",children:(0,b.jsx)(aW.default,{file:i,updateFile:a=>{let b;l(a),a&&((b=new FileReader).onload=function(a){o(a.target?.result)},b.readAsText(a)),a||o("")},className:"!mt-0 w-full",accept:".pipeline",displayName:"PIPELINE"})})]}),(0,b.jsxs)("div",{className:"flex items-center justify-end gap-2 self-stretch pt-5",children:[(0,b.jsx)(k.default,{onClick:a,children:f("newApp.Cancel",{ns:"app"})}),(0,b.jsx)(k.default,{disabled:!i||q,variant:"warning",onClick:K,loading:q,children:f("common.overwriteAndImport",{ns:"workflow"})})]})]}),(0,b.jsxs)(N.default,{isShow:v,onClose:()=>x(!1),className:"w-[480px]",children:[(0,b.jsxs)("div",{className:"flex flex-col items-start gap-2 self-stretch pb-4",children:[(0,b.jsx)("div",{className:"title-2xl-semi-bold text-text-primary",children:f("newApp.appCreateDSLErrorTitle",{ns:"app"})}),(0,b.jsxs)("div",{className:"system-md-regular flex grow flex-col text-text-secondary",children:[(0,b.jsx)("div",{children:f("newApp.appCreateDSLErrorPart1",{ns:"app"})}),(0,b.jsx)("div",{children:f("newApp.appCreateDSLErrorPart2",{ns:"app"})}),(0,b.jsx)("br",{}),(0,b.jsxs)("div",{children:[f("newApp.appCreateDSLErrorPart3",{ns:"app"}),(0,b.jsx)("span",{className:"system-md-medium",children:y?.importedVersion})]}),(0,b.jsxs)("div",{children:[f("newApp.appCreateDSLErrorPart4",{ns:"app"}),(0,b.jsx)("span",{className:"system-md-medium",children:y?.systemVersion})]})]})]}),(0,b.jsxs)("div",{className:"flex items-start justify-end gap-2 self-stretch pt-6",children:[(0,b.jsx)(k.default,{variant:"secondary",onClick:()=>x(!1),children:f("newApp.Cancel",{ns:"app"})}),(0,b.jsx)(k.default,{variant:"primary",destructive:!0,onClick:L,children:f("newApp.Confirm",{ns:"app"})})]})]})]})}),a_=(0,c.memo)(()=>{let{eventEmitter:a}=(0,S.useEventEmitterContextContext)(),[d,e]=(0,c.useState)([]),f=(0,w.useStore)(a=>a.showImportDSLModal),g=(0,w.useStore)(a=>a.setShowImportDSLModal),{handlePaneContextmenuCancel:h}=(0,R.usePanelInteractions)(),{exportCheck:i,handleExportDSL:j}=(0,Q.useDSL)();return(()=>{let a=(0,Y.default)(),{handleNodeSelect:d}=(0,W.useNodesInteractions)(),e=(0,X.useGetToolIcon)(),f=(0,c.useMemo)(()=>a.map(a=>{let b=a.data,c=b.title||b.type||"Untitled Node",d=b.desc||"";return b.type===Z.BlockEnum.Tool&&(d=b.tool_description||b.tool_label||d),b.type===Z.BlockEnum.LLM&&b.model?.provider&&b.model?.name&&(d=`${b.model.name} (${b.model.provider}) - ${b.model.mode||d}`),b.type===Z.BlockEnum.KnowledgeRetrieval&&b.dataset_ids?.length&&(d=`Knowledge Retrieval with ${b.dataset_ids.length} datasets - ${d}`),{id:a.id,title:c,desc:d,type:b.type,blockType:b.type,nodeData:b,toolIcon:e(b),modelInfo:b.type===Z.BlockEnum.LLM?{provider:b.model?.provider,name:b.model?.name,mode:b.model?.mode}:{provider:void 0,name:void 0,mode:void 0}}}),[a,e]),g=(0,c.useCallback)((a,b)=>{if(!b)return 1;let c=0,d=b.toLowerCase();return a.title.toLowerCase().includes(d)&&(c+=10),a.type.toLowerCase().includes(d)&&(c+=8),a.desc.toLowerCase().includes(d)&&(c+=5),a.modelInfo.provider?.toLowerCase().includes(d)&&(c+=6),a.modelInfo.name?.toLowerCase().includes(d)&&(c+=6),a.modelInfo.mode?.toLowerCase().includes(d)&&(c+=4),c},[]),h=(0,c.useCallback)(a=>{if(!f.length)return[];let c=a.toLowerCase().trim();return f.map(a=>{let d=g(a,c);return d>0?{id:a.id,title:a.title,description:a.desc||a.type,type:"workflow-node",path:`#${a.id}`,icon:(0,b.jsx)(V.default,{type:a.blockType,className:"shrink-0",size:"sm",toolIcon:a.toolIcon}),metadata:{nodeId:a.id,nodeData:a.nodeData},data:a.nodeData,score:d}:null}).filter(a=>null!==a).sort((a,b)=>c?(b.score||0)-(a.score||0):a.title.localeCompare(b.title))},[f,g]);return(0,c.useEffect)(()=>(f.length>0&&(U.ragPipelineNodesAction.searchFn=h),()=>{U.ragPipelineNodesAction.searchFn=void 0}),[f,h]),(0,c.useEffect)(()=>(0,$.setupNodeSelectionListener)(d),[d])})(),a?.useSubscription(a=>{a.type===I.DSL_EXPORT_CHECK&&e(a.payload.data)}),(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(T.default,{}),f&&(0,b.jsx)(a$,{onCancel:()=>g(!1),onBackup:i,onImport:h}),d.length>0&&(0,b.jsx)(P,{envList:d,onConfirm:j,onClose:()=>e([])}),(0,b.jsx)(aU,{}),(0,b.jsx)(aj,{}),(0,b.jsx)(ak,{})]})}),a0=({nodes:a,edges:d,viewport:f})=>{let g,h=(0,w.useWorkflowStore)(),i=(0,c.useCallback)(a=>{let{rag_pipeline_variables:b,environment_variables:c}=a;if(b){let{setRagPipelineVariables:a}=h.getState();a?.(b)}if(c){let{setEnvironmentVariables:a}=h.getState();a(c)}},[h]),{doSyncWorkflowDraft:j,syncWorkflowDraftWhenPageClose:k}=(0,A.useNodesSyncDraft)(),{handleRefreshWorkflowDraft:l}=(0,B.usePipelineRefreshDraft)(),{handleBackupDraft:m,handleLoadBackupDraft:n,handleRestoreFromPublishedWorkflow:o,handleRun:p,handleStopRun:q}=(0,C.usePipelineRun)(),{handleStartWorkflowRun:r,handleWorkflowStartRunInWorkflow:s}=(0,D.usePipelineStartRun)(),t=(0,x.useAvailableNodesMetaData)(),{getWorkflowRunAndTraceUrl:u}=(0,z.useGetRunAndTraceUrl)(),{exportCheck:E,handleExportDSL:F}=(0,y.useDSL)(),I=G(),{fetchInspectVars:J}=(0,v.useSetWorkflowVarsWithValue)({...I}),{hasNodeInspectVars:K,hasSetInspectVar:L,fetchInspectVarValue:M,editInspectVarValue:N,renameInspectVarName:O,appendNodeInspectVars:P,deleteInspectVar:Q,deleteNodeInspectorVars:R,deleteAllInspectorVars:S,isInspectVarEdited:T,resetToLastRunVar:U,invalidateSysVarValues:V,resetConversationVar:W,invalidateConversationVarValues:X}=(g=G(),{...(0,H.useInspectVarsCrudCommon)({...g})}),Y=(0,c.useMemo)(()=>({availableNodesMetaData:t,syncWorkflowDraftWhenPageClose:k,doSyncWorkflowDraft:j,handleRefreshWorkflowDraft:l,handleBackupDraft:m,handleLoadBackupDraft:n,handleRestoreFromPublishedWorkflow:o,handleRun:p,handleStopRun:q,handleStartWorkflowRun:r,handleWorkflowStartRunInWorkflow:s,getWorkflowRunAndTraceUrl:u,exportCheck:E,handleExportDSL:F,fetchInspectVars:J,hasNodeInspectVars:K,hasSetInspectVar:L,fetchInspectVarValue:M,editInspectVarValue:N,renameInspectVarName:O,appendNodeInspectVars:P,deleteInspectVar:Q,deleteNodeInspectorVars:R,deleteAllInspectorVars:S,isInspectVarEdited:T,resetToLastRunVar:U,invalidateSysVarValues:V,resetConversationVar:W,invalidateConversationVarValues:X,configsMap:I}),[t,k,j,l,m,n,o,p,q,r,s,u,E,F,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,I]);return(0,b.jsx)(e.WorkflowWithInnerContext,{nodes:a,edges:d,viewport:f,hooksStore:Y,onWorkflowDataUpdate:i,children:(0,b.jsx)(a_,{})})};var a1=a.i(828531),a2=a.i(674766);let a3=a=>({pipelineId:"",knowledgeName:"",showInputFieldPanel:!1,setShowInputFieldPanel:b=>a(()=>({showInputFieldPanel:b})),showInputFieldPreviewPanel:!1,setShowInputFieldPreviewPanel:b=>a(()=>({showInputFieldPreviewPanel:b})),inputFieldEditPanelProps:null,setInputFieldEditPanelProps:b=>a(()=>({inputFieldEditPanelProps:b})),nodesDefaultConfigs:{},setNodesDefaultConfigs:b=>a(()=>({nodesDefaultConfigs:b})),ragPipelineVariables:[],setRagPipelineVariables:b=>a(()=>({ragPipelineVariables:b})),dataSourceList:[],setDataSourceList:b=>{let c=b.map(a=>(0,a2.transformDataSourceToTool)(a));a(()=>({dataSourceList:c}))},isPreparingDataSource:!1,setIsPreparingDataSource:b=>a(()=>({isPreparingDataSource:b}))});a.i(82700);var a4=a.i(413945);let a5=()=>{let{data:a,isLoading:f}=(0,a1.usePipelineInit)(),h=(0,c.useMemo)(()=>a?(0,g.initialNodes)(a.graph.nodes,a.graph.edges):[],[a]),i=(0,c.useMemo)(()=>a?(0,g.initialEdges)(a.graph.edges,a.graph.nodes):[],[a]);if(!a||f)return(0,b.jsx)("div",{className:"relative flex h-full w-full items-center justify-center",children:(0,b.jsx)(d.default,{})});let{nodes:j,viewport:k}=(0,a4.processNodesWithoutDataSource)(h,a.graph.viewport);return(0,b.jsx)(e.default,{edges:i,nodes:j,children:(0,b.jsx)(a0,{edges:i,nodes:j,viewport:k})})},a6=()=>(0,h.useDatasetDetailContextWithSelector)(a=>a.dataset?.pipeline_id)?(0,b.jsx)(f.WorkflowContextProvider,{injectWorkflowStoreSliceFn:a3,children:(0,b.jsx)(a5,{})}):(0,b.jsx)(u,{});a.s(["default",0,()=>(0,b.jsx)("div",{className:"h-full w-full overflow-x-auto",children:(0,b.jsx)(a6,{})})],655540)}];

//# sourceMappingURL=dd6a8_datasets_%28datasetDetailLayout%29_%5BdatasetId%5D_pipeline_page_tsx_025e654b._.js.map
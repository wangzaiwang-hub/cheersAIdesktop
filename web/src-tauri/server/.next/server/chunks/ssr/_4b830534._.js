module.exports=[985555,a=>{"use strict";var b=a.i(57843),c=a.i(498253),d=a.i(138296);function e(a){return a}function f(a,b,f){if("object"!=typeof b||null===b)return;let g=a.getMutationCache(),h=a.getQueryCache(),i=f?.defaultOptions?.deserializeData??a.getDefaultOptions().hydrate?.deserializeData??e,j=b.mutations||[],k=b.queries||[];j.forEach(({state:b,...c})=>{g.build(a,{...a.getDefaultOptions().hydrate?.mutations,...f?.defaultOptions?.mutations,...c},b)}),k.forEach(({queryKey:b,state:e,queryHash:g,meta:j,promise:k,dehydratedAt:l})=>{let m=k?(0,c.tryResolveSync)(k):void 0,n=void 0===e.data?m?.data:e.data,o=void 0===n?n:i(n),p=h.get(g),q=p?.state.status==="pending",r=p?.state.fetchStatus==="fetching";if(p){let a=m&&void 0!==l&&l>p.state.dataUpdatedAt;if(e.dataUpdatedAt>p.state.dataUpdatedAt||a){let{fetchStatus:a,...b}=e;p.setState({...b,data:o})}}else p=h.build(a,{...a.getDefaultOptions().hydrate?.queries,...f?.defaultOptions?.queries,queryKey:b,queryHash:g,meta:j},{...e,data:o,fetchStatus:"idle",status:void 0!==o?"success":e.status});k&&!q&&!r&&(void 0===l||l>p.state.dataUpdatedAt)&&p.fetch(void 0,{initialPromise:Promise.resolve(k).then(i)}).catch(d.noop)})}var g=a.i(749249),h=({children:a,options:c={},state:d,queryClient:e})=>{let h=(0,g.useQueryClient)(e),i=b.useRef(c);b.useEffect(()=>{i.current=c});let j=b.useMemo(()=>{if(d){if("object"!=typeof d)return;let a=h.getQueryCache(),b=d.queries||[],c=[],e=[];for(let d of b){let b=a.get(d.queryHash);b?(d.state.dataUpdatedAt>b.state.dataUpdatedAt||d.promise&&"pending"!==b.state.status&&"fetching"!==b.state.fetchStatus&&void 0!==d.dehydratedAt&&d.dehydratedAt>b.state.dataUpdatedAt)&&e.push(d):c.push(d)}if(c.length>0&&f(h,{queries:c},i.current),e.length>0)return e}},[h,d]);return b.useEffect(()=>{j&&f(h,{queries:j},i.current)},[h,j]),a};a.s(["HydrationBoundary",()=>h],985555)},101606,a=>{"use strict";var b=a.i(608061),c=a.i(245035),d=a.i(105249),e=a.i(429150),f=a.i(57843),g=a.i(825319),h=a.i(301726);let i=()=>{let{t:a}=(0,c.useTranslation)(),d=[{value:"install_count",order:"DESC",text:a("marketplace.sortOption.mostPopular",{ns:"plugin"})},{value:"version_updated_at",order:"DESC",text:a("marketplace.sortOption.recentlyUpdated",{ns:"plugin"})},{value:"created_at",order:"DESC",text:a("marketplace.sortOption.newlyReleased",{ns:"plugin"})},{value:"created_at",order:"ASC",text:a("marketplace.sortOption.firstReleased",{ns:"plugin"})}],[i,j]=(0,h.useMarketplaceSort)(),[k,l]=(0,f.useState)(!1),m=d.find(a=>a.value===i.sortBy&&a.order===i.sortOrder)??d[0];return(0,b.jsxs)(g.PortalToFollowElem,{placement:"bottom-start",offset:{mainAxis:4,crossAxis:0},open:k,onOpenChange:l,children:[(0,b.jsx)(g.PortalToFollowElemTrigger,{onClick:()=>l(a=>!a),children:(0,b.jsxs)("div",{className:"flex h-8 cursor-pointer items-center rounded-lg bg-state-base-hover-alt px-2 pr-3",children:[(0,b.jsx)("span",{className:"system-sm-regular mr-1 text-text-secondary",children:a("marketplace.sortBy",{ns:"plugin"})}),(0,b.jsx)("span",{className:"system-sm-medium mr-1 text-text-primary",children:m.text}),(0,b.jsx)(e.RiArrowDownSLine,{className:"h-4 w-4 text-text-tertiary"})]})}),(0,b.jsx)(g.PortalToFollowElemContent,{children:(0,b.jsx)("div",{className:"rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur p-1 shadow-lg backdrop-blur-sm",children:d.map(a=>(0,b.jsxs)("div",{className:"system-md-regular flex h-8 cursor-pointer items-center justify-between rounded-lg px-3 pr-2 text-text-primary hover:bg-components-panel-on-panel-item-bg-hover",onClick:()=>j({sortBy:a.value,sortOrder:a.order}),children:[a.text,i.sortBy===a.value&&i.sortOrder===a.order&&(0,b.jsx)(e.RiCheckLine,{className:"ml-2 h-4 w-4 text-text-accent"})]},`${a.value}-${a.order}`))})})]})};var j=a.i(836011),k=a.i(50084),l=a.i(239567),m=a.i(516758),n=a.i(528698),o=a.i(187864),p=a.i(947803),q=a.i(267098);a.s(["default",0,({showInstallButton:a})=>{let{t:e}=(0,c.useTranslation)(),{plugins:g,pluginsTotal:r,marketplaceCollections:s,marketplaceCollectionPluginsMap:t,isLoading:u,isFetchingNextPage:v,page:w}=function(){var a,b;let[c]=(0,h.useSearchPluginText)(),d=(0,j.useDebounce)(c,{wait:500}),[e]=(0,h.useFilterPluginTags)(),[g]=(0,h.useActivePluginType)(),i=(a=(0,p.getCollectionsParams)(g),(0,n.useQuery)({queryKey:o.marketplaceQuery.collections.queryKey({input:{query:a}}),queryFn:({signal:b})=>(0,p.getMarketplaceCollectionsAndPlugins)(a,{signal:b})})),q=(0,h.useMarketplaceSortValue)(),r=(0,h.useMarketplaceSearchMode)(),s=(b=(0,f.useMemo)(()=>{if(r)return{query:d,category:g===k.PLUGIN_TYPE_SEARCH_MAP.all?void 0:g,tags:e,sort_by:q.sortBy,sort_order:q.sortOrder,type:(0,p.getMarketplaceListFilterType)(g)}},[r,d,g,e,q]),(0,m.useInfiniteQuery)({queryKey:o.marketplaceQuery.searchAdvanced.queryKey({input:{body:b,params:{kind:b?.type==="bundle"?"bundles":"plugins"}}}),queryFn:({pageParam:a=1,signal:c})=>(0,p.getMarketplacePlugins)(b,a,c),getNextPageParam:a=>{let b=a.page+1;return a.page*a.page_size<(a.total||0)?b:void 0},initialPageParam:1,enabled:void 0!==b})),{hasNextPage:t,fetchNextPage:u,isFetching:v,isFetchingNextPage:w}=s,x=(0,f.useCallback)(()=>{t&&!v&&u()},[u,t,v]);return(0,l.useMarketplaceContainerScroll)(x),{marketplaceCollections:i.data?.marketplaceCollections,marketplaceCollectionPluginsMap:i.data?.marketplaceCollectionPluginsMap,plugins:s.data?.pages.flatMap(a=>a.plugins),pluginsTotal:s.data?.pages[0]?.total,page:s.data?.pages.length||1,isLoading:i.isLoading||s.isLoading,isFetchingNextPage:w}}();return(0,b.jsxs)("div",{style:{scrollbarGutter:"stable"},className:"relative flex grow flex-col bg-background-default-subtle px-12 py-2",children:[g&&(0,b.jsxs)("div",{className:"mb-4 flex items-center pt-3",children:[(0,b.jsx)("div",{className:"title-xl-semi-bold text-text-primary",children:e("marketplace.pluginsResult",{ns:"plugin",num:r})}),(0,b.jsx)("div",{className:"mx-3 h-3.5 w-[1px] bg-divider-regular"}),(0,b.jsx)(i,{})]}),u&&1===w&&(0,b.jsx)("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:(0,b.jsx)(d.default,{})}),(!u||w>1)&&(0,b.jsx)(q.default,{marketplaceCollections:s||[],marketplaceCollectionPluginsMap:t||{},plugins:g,showInstallButton:a}),v&&(0,b.jsx)(d.default,{className:"my-3"})]})}],101606)},26558,a=>{"use strict";var b=a.i(608061),c=a.i(527344),d=a.i(245035),e=a.i(429150),f=a.i(764112);a.i(515943);var g=a.i(377143),g=g,h=a.i(301726),i=a.i(50084);let j=({className:a})=>{let{t:j}=(0,d.useTranslation)(),[k,l]=(0,h.useActivePluginType)(),m=(0,f.useSetAtom)(h.searchModeAtom),n=[{value:i.PLUGIN_TYPE_SEARCH_MAP.all,text:j("category.all",{ns:"plugin"}),icon:null},{value:i.PLUGIN_TYPE_SEARCH_MAP.model,text:j("category.models",{ns:"plugin"}),icon:(0,b.jsx)(e.RiBrain2Line,{className:"mr-1.5 h-4 w-4"})},{value:i.PLUGIN_TYPE_SEARCH_MAP.tool,text:j("category.tools",{ns:"plugin"}),icon:(0,b.jsx)(e.RiHammerLine,{className:"mr-1.5 h-4 w-4"})},{value:i.PLUGIN_TYPE_SEARCH_MAP.datasource,text:j("category.datasources",{ns:"plugin"}),icon:(0,b.jsx)(e.RiDatabase2Line,{className:"mr-1.5 h-4 w-4"})},{value:i.PLUGIN_TYPE_SEARCH_MAP.trigger,text:j("category.triggers",{ns:"plugin"}),icon:(0,b.jsx)(g.default,{className:"mr-1.5 h-4 w-4"})},{value:i.PLUGIN_TYPE_SEARCH_MAP.agent,text:j("category.agents",{ns:"plugin"}),icon:(0,b.jsx)(e.RiSpeakAiLine,{className:"mr-1.5 h-4 w-4"})},{value:i.PLUGIN_TYPE_SEARCH_MAP.extension,text:j("category.extensions",{ns:"plugin"}),icon:(0,b.jsx)(e.RiPuzzle2Line,{className:"mr-1.5 h-4 w-4"})},{value:i.PLUGIN_TYPE_SEARCH_MAP.bundle,text:j("category.bundles",{ns:"plugin"}),icon:(0,b.jsx)(e.RiArchive2Line,{className:"mr-1.5 h-4 w-4"})}];return(0,b.jsx)("div",{className:(0,c.cn)("flex shrink-0 items-center justify-center space-x-2 bg-background-body py-3",a),children:n.map(a=>(0,b.jsxs)("div",{className:(0,c.cn)("system-md-medium flex h-8 cursor-pointer items-center rounded-xl border border-transparent px-3 text-text-tertiary hover:bg-state-base-hover hover:text-text-secondary",k===a.value&&"border-components-main-nav-nav-button-border !bg-components-main-nav-nav-button-bg-active !text-components-main-nav-nav-button-text-active shadow-xs"),onClick:()=>{l(a.value),i.PLUGIN_CATEGORY_WITH_COLLECTIONS.has(a.value)&&m(null)},children:[a.icon,a.text]},a.value))})};var k=a.i(979856);let l=()=>{let{t:a}=(0,d.useTranslation)(),[c,e]=(0,h.useSearchPluginText)(),[f,g]=(0,h.useFilterPluginTags)();return(0,b.jsx)(k.default,{wrapperClassName:"z-[11] mx-auto w-[640px] shrink-0",inputClassName:"w-full",search:c,onSearchChange:e,tags:f,onTagsChange:g,placeholder:a("searchPlugins",{ns:"plugin"}),usedInMarketplace:!0})};a.s(["default",0,({pluginTypeSwitchClassName:a})=>{let d=a?.includes("top-");return(0,b.jsxs)("div",{className:(0,c.cn)("mt-4 bg-background-body",d&&"sticky z-10",a),children:[(0,b.jsx)(l,{}),(0,b.jsx)(j,{})]})}],26558)},345291,163999,822194,718121,414460,193017,a=>{"use strict";var b=a.i(608061),c=a.i(111089),d=a.i(666115),e=a.i(57843),f=a.i(639378),g=a.i(724423),h=a.i(71905);let i=(0,f.createContext)({containerRef:{current:null},currentPluginID:void 0,setCurrentPluginID:c.noop,filters:{categories:[],tags:[],searchQuery:""},setFilters:c.noop,activeTab:"",setActiveTab:c.noop,options:[]});function j(a){return(0,f.useContextSelector)(i,a)}a.s(["PluginPageContextProvider",0,({children:a})=>{let c=(0,e.useRef)(null),[f,j]=(0,e.useState)({categories:[],tags:[],searchQuery:""}),[k,l]=(0,e.useState)(),{enable_marketplace:m}=(0,g.useGlobalPublicStore)(a=>a.systemFeatures),n=(0,h.usePluginPageTabs)(),o=(0,e.useMemo)(()=>m?n:n.filter(a=>a.value!==h.PLUGIN_PAGE_TABS_MAP.marketplace),[n,m]),[p,q]=(0,d.useQueryState)("tab",{defaultValue:o[0].value});return(0,b.jsx)(i.Provider,{value:{containerRef:c,currentPluginID:k,setCurrentPluginID:l,filters:f,setFilters:j,activeTab:p,setActiveTab:q,options:o},children:a})},"usePluginPageContext",()=>j],345291);var k=a.i(388356);a.s(["FileZip",()=>k.default],163999);var l=a.i(283856);a.s(["Github",()=>l.default],822194);var m=a.i(21878);a.s(["MagicBox",()=>m.default],718121),a.i(752298);var n=a.i(693025),o=a.i(940272),p=a.i(114715),q=a.i(302785),r=a.i(527344),s=a.i(263636),t=a.i(241101),u=a.i(875802),v=a.i(118644),w=a.i(757014),x=a.i(595879),y=a.i(429150),z=a.i(909795),A=a.i(601349),B=a.i(238387),C=a.i(781362),D=a.i(5873),E=a.i(837080),F=a.i(226181);let G="installModal",H=({updatePayload:a,uniqueIdentifier:c,payload:d,repoUrl:f,selectedVersion:g,selectedPackage:h,onBack:i,onStartToInstall:j,onInstalled:k,onFailed:l})=>{let{t:m}=(0,n.useTranslation)(),o=d.version,p=d.plugin_id,{installedInfo:q,isLoading:r}=(0,A.default)({pluginIds:[p],enabled:!!p}),t=q?.[p],u=t?.installedVersion,v=!!u,[w,H]=e.useState(!1),{mutateAsync:I}=(0,C.useInstallPackageFromGitHub)(),{handleRefetch:J}=(0,C.usePluginTaskList)(d.category),{check:K}=(0,E.default)();(0,e.useEffect)(()=>{v&&c===t.uniqueIdentifier&&k()},[v]);let L=async()=>{if(!w){H(!0),j?.();try{let b,d,{owner:e,repo:i}=(0,x.parseGitHubUrl)(f);if(a){let{all_installed:f,task_id:j}=await (0,B.updateFromGitHub)(`${e}/${i}`,g,h,a.originalPackageInfo.id,c);b=j,d=f}else if(v){let{all_installed:a,task_id:f}=await (0,B.updateFromGitHub)(`${e}/${i}`,g,h,t.uniqueIdentifier,c);b=f,d=a}else{let{all_installed:a,task_id:f}=await I({repoUrl:`${e}/${i}`,selectedVersion:g,selectedPackage:h,uniqueIdentifier:c});b=f,d=a}if(d)return void k();J();let{status:j,error:m}=await K({taskId:b,pluginUniqueIdentifier:c});if(j===s.TaskStatus.failed)return void l(m);k(!0)}catch(a){if("string"==typeof a)return void l(a);l()}finally{H(!1)}}};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"system-md-regular text-text-secondary",children:(0,b.jsx)("p",{children:m(`${G}.readyToInstall`,{ns:"plugin"})})}),(0,b.jsx)("div",{className:"flex flex-wrap content-start items-start gap-1 self-stretch rounded-2xl bg-background-section-burn p-2",children:(0,b.jsx)(D.default,{className:"w-full",payload:(0,x.pluginManifestToCardPluginProps)(d),titleLeft:!r&&(0,b.jsx)(F.default,{hasInstalled:v,installedVersion:u,toInstallVersion:o})})}),(0,b.jsxs)("div",{className:"mt-4 flex items-center justify-end gap-2 self-stretch",children:[!w&&(0,b.jsx)(z.default,{variant:"secondary",className:"min-w-[72px]",onClick:i,children:m("installModal.back",{ns:"plugin"})}),(0,b.jsxs)(z.default,{variant:"primary",className:"flex min-w-[72px] space-x-0.5",onClick:L,disabled:w||r,children:[w&&(0,b.jsx)(y.RiLoader2Line,{className:"h-4 w-4 animate-spin-slow"}),(0,b.jsx)("span",{children:m(`${G}.${w?"installing":"install"}`,{ns:"plugin"})})]})]})]})};var I=a.i(805611);let J="installFromGitHub",K=({updatePayload:a,repoUrl:c,selectedVersion:d,versions:f,onSelectVersion:g,selectedPackage:h,packages:i,onSelectPackage:j,onUploaded:k,onFailed:l,onBack:m})=>{let{t:o}=(0,n.useTranslation)(),p=!!a,[q,r]=e.useState(!1),{handleUpload:s}=(0,u.useGitHubUpload)(),t=async()=>{if(!q){r(!0);try{let a=c.replace("https://github.com/","");await s(a,d,h,a=>{k({uniqueIdentifier:a.unique_identifier,manifest:a.manifest})})}catch(a){a.response?.message?l(a.response?.message):l(o(`${J}.uploadFailed`,{ns:"plugin"}))}finally{r(!1)}}};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("label",{htmlFor:"version",className:"flex flex-col items-start justify-center self-stretch text-text-secondary",children:(0,b.jsx)("span",{className:"system-sm-semibold",children:o(`${J}.selectVersion`,{ns:"plugin"})})}),(0,b.jsx)(I.PortalSelect,{value:d,onSelect:g,items:f,installedValue:a?.originalPackageInfo.version,placeholder:o(`${J}.selectVersionPlaceholder`,{ns:"plugin"})||"",popupClassName:"w-[512px] z-[1001]",triggerClassName:"text-components-input-text-filled"}),(0,b.jsx)("label",{htmlFor:"package",className:"flex flex-col items-start justify-center self-stretch text-text-secondary",children:(0,b.jsx)("span",{className:"system-sm-semibold",children:o(`${J}.selectPackage`,{ns:"plugin"})})}),(0,b.jsx)(I.PortalSelect,{value:h,onSelect:j,items:i,readonly:!d,placeholder:o(`${J}.selectPackagePlaceholder`,{ns:"plugin"})||"",popupClassName:"w-[512px] z-[1001]",triggerClassName:"text-components-input-text-filled"}),(0,b.jsxs)("div",{className:"mt-4 flex items-center justify-end gap-2 self-stretch",children:[!p&&(0,b.jsx)(z.default,{variant:"secondary",className:"min-w-[72px]",onClick:m,disabled:q,children:o("installModal.back",{ns:"plugin"})}),(0,b.jsx)(z.default,{variant:"primary",className:"min-w-[72px]",onClick:t,disabled:!d||!h||q,children:o("installModal.next",{ns:"plugin"})})]})]})},L=({repoUrl:a,onChange:c,onNext:d,onCancel:e})=>{let{t:f}=(0,n.useTranslation)();return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("label",{htmlFor:"repoUrl",className:"flex flex-col items-start justify-center self-stretch text-text-secondary",children:(0,b.jsx)("span",{className:"system-sm-semibold",children:f("installFromGitHub.gitHubRepo",{ns:"plugin"})})}),(0,b.jsx)("input",{type:"url",id:"repoUrl",name:"repoUrl",value:a,onChange:a=>c(a.target.value),className:"shadows-shadow-xs system-sm-regular flex grow items-center gap-[2px] self-stretch overflow-hidden text-ellipsis rounded-lg border border-components-input-border-active bg-components-input-bg-active p-2 text-components-input-text-filled",placeholder:"Please enter GitHub repo URL"}),(0,b.jsxs)("div",{className:"mt-4 flex items-center justify-end gap-2 self-stretch",children:[(0,b.jsx)(z.default,{variant:"secondary",className:"min-w-[72px]",onClick:e,children:f("installModal.cancel",{ns:"plugin"})}),(0,b.jsx)(z.default,{variant:"primary",className:"min-w-[72px]",onClick:d,disabled:!a.trim(),children:f("installModal.next",{ns:"plugin"})})]})]})},M="installFromGitHub";a.s(["default",0,({updatePayload:a,onClose:c,onSuccess:d})=>{let{t:f}=(0,n.useTranslation)(),{getIconUrl:g}=(0,q.default)(),{fetchReleases:h}=(0,u.useGitHubReleases)(),{refreshPluginList:i}=(0,w.default)(),{modalClassName:j,foldAnimInto:k,setIsInstalling:l,handleStartToInstall:m}=(0,v.default)(c),[y,z]=(0,e.useState)({step:a?s.InstallStepFromGitHub.selectPackage:s.InstallStepFromGitHub.setUrl,repoUrl:a?.originalPackageInfo?.repo?(0,x.convertRepoToUrl)(a.originalPackageInfo.repo):"",selectedVersion:"",selectedPackage:"",releases:a?a.originalPackageInfo.releases:[]}),[A,B]=(0,e.useState)(null),[C,D]=(0,e.useState)(null),[E,F]=(0,e.useState)(null),G=y.releases.map(a=>({value:a.tag_name,name:a.tag_name})),I=y.selectedVersion&&y.releases.find(a=>a.tag_name===y.selectedVersion)?.assets.map(a=>({value:a.name,name:a.name}))||[],J=(0,e.useCallback)(()=>y.step===s.InstallStepFromGitHub.installed?f(`${M}.installedSuccessfully`,{ns:"plugin"}):y.step===s.InstallStepFromGitHub.installFailed?f(`${M}.installFailed`,{ns:"plugin"}):a?f(`${M}.updatePlugin`,{ns:"plugin"}):f(`${M}.installPlugin`,{ns:"plugin"}),[y.step,f,a]),N=async()=>{let{isValid:a,owner:b,repo:c}=(0,x.parseGitHubUrl)(y.repoUrl);if(!a||!b||!c)return void p.default.notify({type:"error",message:f("error.inValidGitHubUrl",{ns:"plugin"})});try{let a=await h(b,c);a.length>0?z(b=>({...b,releases:a,step:s.InstallStepFromGitHub.selectPackage})):p.default.notify({type:"error",message:f("error.noReleasesFound",{ns:"plugin"})})}catch{p.default.notify({type:"error",message:f("error.fetchReleasesError",{ns:"plugin"})})}},O=async a=>{try{let b=await g(a.manifest.icon);D({...a.manifest,icon:b}),B(a.uniqueIdentifier),z(a=>({...a,step:s.InstallStepFromGitHub.readyToInstall}))}catch(a){F(a?.response?.message||f("installModal.installFailedDesc",{ns:"plugin"})),z(a=>({...a,step:(0,s.InstallStepFromGitHub.uploadFailed)}))}},P=(0,e.useCallback)(a=>{F(a),z(a=>({...a,step:s.InstallStepFromGitHub.uploadFailed}))},[]),Q=(0,e.useCallback)(a=>{z(a=>({...a,step:s.InstallStepFromGitHub.installed})),a||i(C),l(!1),d()},[C,d,i,l]),R=(0,e.useCallback)(a=>{z(a=>({...a,step:s.InstallStepFromGitHub.installFailed})),l(!1),a&&F(a)},[l]),S=()=>{z(a=>{switch(a.step){case s.InstallStepFromGitHub.selectPackage:return{...a,step:s.InstallStepFromGitHub.setUrl};case s.InstallStepFromGitHub.readyToInstall:return{...a,step:s.InstallStepFromGitHub.selectPackage};default:return a}})};return(0,b.jsxs)(o.default,{isShow:!0,onClose:k,className:(0,r.cn)(j,`shadows-shadow-xl flex min-w-[560px] flex-col items-start rounded-2xl border-[0.5px]
        border-components-panel-border bg-components-panel-bg p-0`),closable:!0,children:[(0,b.jsx)("div",{className:"flex items-start gap-2 self-stretch pb-3 pl-6 pr-14 pt-6",children:(0,b.jsxs)("div",{className:"flex grow flex-col items-start gap-1",children:[(0,b.jsx)("div",{className:"title-2xl-semi-bold self-stretch text-text-primary",children:J()}),(0,b.jsx)("div",{className:"system-xs-regular self-stretch text-text-tertiary",children:![s.InstallStepFromGitHub.uploadFailed,s.InstallStepFromGitHub.installed,s.InstallStepFromGitHub.installFailed].includes(y.step)&&f("installFromGitHub.installNote",{ns:"plugin"})})]})}),[s.InstallStepFromGitHub.uploadFailed,s.InstallStepFromGitHub.installed,s.InstallStepFromGitHub.installFailed].includes(y.step)?(0,b.jsx)(t.default,{payload:C,isFailed:[s.InstallStepFromGitHub.uploadFailed,s.InstallStepFromGitHub.installFailed].includes(y.step),errMsg:E,onCancel:c}):(0,b.jsxs)("div",{className:`flex flex-col items-start justify-center self-stretch px-6 py-3 ${y.step===s.InstallStepFromGitHub.installed?"gap-2":"gap-4"}`,children:[y.step===s.InstallStepFromGitHub.setUrl&&(0,b.jsx)(L,{repoUrl:y.repoUrl,onChange:a=>z(b=>({...b,repoUrl:a})),onNext:N,onCancel:c}),y.step===s.InstallStepFromGitHub.selectPackage&&(0,b.jsx)(K,{updatePayload:a,repoUrl:y.repoUrl,selectedVersion:y.selectedVersion,versions:G,onSelectVersion:a=>z(b=>({...b,selectedVersion:a.value})),selectedPackage:y.selectedPackage,packages:I,onSelectPackage:a=>z(b=>({...b,selectedPackage:a.value})),onUploaded:O,onFailed:P,onBack:S}),y.step===s.InstallStepFromGitHub.readyToInstall&&(0,b.jsx)(H,{updatePayload:a,uniqueIdentifier:A,payload:C,repoUrl:y.repoUrl,selectedVersion:y.selectedVersion,selectedPackage:y.selectedPackage,onBack:S,onStartToInstall:m,onInstalled:Q,onFailed:R})]})]})}],414460);var N=a.i(782900),O=a.i(578652),P=a.i(854868),Q=a.i(705134);let R="installModal",S=e.memo(({uniqueIdentifier:a,payload:c,onCancel:d,onStartToInstall:f,onInstalled:g,onFailed:h})=>{let{t:i}=(0,n.useTranslation)(),j=c.version,k=`${c.author}/${c.name}`,{installedInfo:l,isLoading:m}=(0,A.default)({pluginIds:[k],enabled:!!k}),o=l?.[k],p=o?.installedVersion,q=!!p;(0,e.useEffect)(()=>{q&&a===o.uniqueIdentifier&&g()},[q]);let[r,t]=e.useState(!1),{mutateAsync:u}=(0,C.useInstallPackageFromLocal)(),{check:v,stop:w}=(0,E.default)(),{handleRefetch:G}=(0,C.usePluginTaskList)(c.category),H=async()=>{if(!r){t(!0),f?.();try{q&&await (0,B.uninstallPlugin)(o.installedId);let{all_installed:b,task_id:c}=await u(a);if(b)return void g();G();let{status:d,error:e}=await v({taskId:c,pluginUniqueIdentifier:a});if(d===s.TaskStatus.failed)return void h(e);g(!0)}catch(a){if("string"==typeof a)return void h(a);h()}}},{langGeniusVersionInfo:I}=(0,Q.useAppContext)(),J=(0,e.useMemo)(()=>!I.current_version||(0,P.gte)(I.current_version,c.meta.minimum_dify_version??"0.0.0"),[I.current_version,c.meta.minimum_dify_version]);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"flex flex-col items-start justify-center gap-4 self-stretch px-6 py-3",children:[(0,b.jsxs)("div",{className:"system-md-regular text-text-secondary",children:[(0,b.jsx)("p",{children:i(`${R}.readyToInstall`,{ns:"plugin"})}),(0,b.jsx)("p",{children:(0,b.jsx)(O.Trans,{i18nKey:`${R}.fromTrustSource`,ns:"plugin",components:{trustSource:(0,b.jsx)("span",{className:"system-md-semibold"})}})}),!J&&(0,b.jsx)("p",{className:"system-md-regular flex items-center gap-1 text-text-warning",children:i("difyVersionNotCompatible",{ns:"plugin",minimalDifyVersion:c.meta.minimum_dify_version})})]}),(0,b.jsx)("div",{className:"flex flex-wrap content-start items-start gap-1 self-stretch rounded-2xl bg-background-section-burn p-2",children:(0,b.jsx)(D.default,{className:"w-full",payload:(0,x.pluginManifestToCardPluginProps)(c),titleLeft:!m&&(0,b.jsx)(F.default,{hasInstalled:q,installedVersion:p,toInstallVersion:j})})})]}),(0,b.jsxs)("div",{className:"flex items-center justify-end gap-2 self-stretch p-6 pt-5",children:[!r&&(0,b.jsx)(z.default,{variant:"secondary",className:"min-w-[72px]",onClick:()=>{w(),d()},children:i("operation.cancel",{ns:"common"})}),(0,b.jsxs)(z.default,{variant:"primary",className:"flex min-w-[72px] space-x-0.5",disabled:r||m,onClick:H,children:[r&&(0,b.jsx)(y.RiLoader2Line,{className:"h-4 w-4 animate-spin-slow"}),(0,b.jsx)("span",{children:i(`${R}.${r?"installing":"install"}`,{ns:"plugin"})})]})]})]})}),T=e.memo(({step:a,onStepChange:c,onStartToInstall:d,setIsInstalling:f,onClose:g,uniqueIdentifier:h,manifest:i,errorMsg:j,onError:k})=>{let{refreshPluginList:l}=(0,w.default)(),m=(0,e.useCallback)(a=>{c(s.InstallStep.installed),a||l(i),f(!1)},[i,c,l,f]),n=(0,e.useCallback)(a=>{c(s.InstallStep.installFailed),f(!1),a&&k(a)},[k,c,f]);return(0,b.jsxs)(b.Fragment,{children:[a===s.InstallStep.readyToInstall&&(0,b.jsx)(S,{uniqueIdentifier:h,payload:i,onCancel:g,onInstalled:m,onFailed:n,onStartToInstall:d}),[s.InstallStep.uploadFailed,s.InstallStep.installed,s.InstallStep.installFailed].includes(a)&&(0,b.jsx)(t.default,{payload:i,isFailed:[s.InstallStep.uploadFailed,s.InstallStep.installFailed].includes(a),errMsg:j,onCancel:g})]})}),U="installModal",V=e.memo(({isBundle:a,file:c,onCancel:d,onPackageUploaded:f,onBundleUploaded:g,onFailed:h})=>{let{t:i}=(0,n.useTranslation)(),j=c.name,k=async()=>{try{await (0,B.uploadFile)(c,a)}catch(b){if(b.response?.message)h(b.response?.message);else{let c=b.response;if(a)return void g(c);f({uniqueIdentifier:c.unique_identifier,manifest:c.manifest})}}};return e.useEffect(()=>{k()},[]),(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"flex flex-col items-start justify-center gap-4 self-stretch px-6 py-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1 self-stretch",children:[(0,b.jsx)(y.RiLoader2Line,{className:"h-4 w-4 animate-spin-slow text-text-accent"}),(0,b.jsx)("div",{className:"system-md-regular text-text-secondary",children:i(`${U}.uploadingPackage`,{ns:"plugin",packageName:j})})]}),(0,b.jsx)("div",{className:"flex flex-wrap content-start items-start gap-1 self-stretch rounded-2xl bg-background-section-burn p-2",children:(0,b.jsx)(D.default,{className:"w-full",payload:{name:j},isLoading:!0,loadingFileName:j,installed:!1})})]}),(0,b.jsxs)("div",{className:"flex items-center justify-end gap-2 self-stretch p-6 pt-5",children:[(0,b.jsx)(z.default,{variant:"secondary",className:"min-w-[72px]",onClick:d,children:i("operation.cancel",{ns:"common"})}),(0,b.jsx)(z.default,{variant:"primary",className:"min-w-[72px]",disabled:!0,children:i(`${U}.install`,{ns:"plugin"})})]})]})}),W="installModal";a.s(["default",0,({file:a,onClose:c})=>{let{t:d}=(0,n.useTranslation)(),[f,g]=(0,e.useState)(s.InstallStep.uploading),[h,i]=(0,e.useState)(null),[j,k]=(0,e.useState)(null),[l,m]=(0,e.useState)(null),p=a.name.endsWith(".difybndl"),[t,u]=(0,e.useState)([]),{modalClassName:w,foldAnimInto:x,setIsInstalling:y,handleStartToInstall:z}=(0,v.default)(c),A=(0,e.useCallback)(()=>f===s.InstallStep.uploadFailed?d(`${W}.uploadFailed`,{ns:"plugin"}):p&&f===s.InstallStep.installed?d(`${W}.installComplete`,{ns:"plugin"}):f===s.InstallStep.installed?d(`${W}.installedSuccessfully`,{ns:"plugin"}):f===s.InstallStep.installFailed?d(`${W}.installFailed`,{ns:"plugin"}):d(`${W}.installPlugin`,{ns:"plugin"}),[p,f,d]),{getIconUrl:B}=(0,q.default)(),C=(0,e.useCallback)(async a=>{let{manifest:b,uniqueIdentifier:c}=a,d=await B(b.icon),e=b.icon_dark?await B(b.icon_dark):void 0;i(c),k({...b,icon:d,icon_dark:e}),g(s.InstallStep.readyToInstall)},[B]),D=(0,e.useCallback)(a=>{u(a),g(s.InstallStep.readyToInstall)},[]),E=(0,e.useCallback)(a=>{m(a),g(s.InstallStep.uploadFailed)},[]);return(0,b.jsxs)(o.default,{isShow:!0,onClose:x,className:(0,r.cn)(w,"shadows-shadow-xl flex min-w-[560px] flex-col items-start rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg p-0"),closable:!0,children:[(0,b.jsx)("div",{className:"flex items-start gap-2 self-stretch pb-3 pl-6 pr-14 pt-6",children:(0,b.jsx)("div",{className:"title-2xl-semi-bold self-stretch text-text-primary",children:A()})}),f===s.InstallStep.uploading&&(0,b.jsx)(V,{isBundle:p,file:a,onCancel:c,onPackageUploaded:C,onBundleUploaded:D,onFailed:E}),p?(0,b.jsx)(N.default,{step:f,onStepChange:g,onStartToInstall:z,setIsInstalling:y,onClose:c,allPlugins:t}):(0,b.jsx)(T,{step:f,onStepChange:g,onStartToInstall:z,setIsInstalling:y,onClose:c,uniqueIdentifier:h,manifest:j,errorMsg:l,onError:m})]})}],193017)},840798,a=>{"use strict";var b=a.i(608061),c=a.i(429150),d=a.i(497746),e=a.i(111089),f=a.i(413192),g=a.i(57843);a.i(752298);var h=a.i(693025),i=a.i(909795),j=a.i(2869),k=a.i(483664),l=a.i(940272),m=a.i(263636),n=a.i(335913),o=a.i(724423),p=a.i(578652),q=a.i(368425),r=a.i(346896),s=a.i(933887),t=a.i(705134),u=a.i(29255),v=a.i(527344);let w=g.memo(({label:a,description:c})=>(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:(0,v.cn)("flex h-6 items-center",c&&"h-4"),children:(0,b.jsx)("span",{className:"system-sm-semibold text-text-secondary",children:a})}),c&&(0,b.jsx)("div",{className:"body-xs-regular mt-1 text-text-tertiary",children:c})]}));var x=a.i(428279);let y=g.memo(({updateMode:a})=>{let{t:c}=(0,h.useTranslation)(),d=`${c(`autoUpdate.upgradeModePlaceholder.${a===x.AUTO_UPDATE_MODE.partial?"partial":"exclude"}`,{ns:"plugin"})}`;return(0,b.jsx)("div",{className:"system-xs-regular rounded-[10px] border border-components-option-card-option-border bg-background-section p-3 text-center text-text-tertiary",children:d})});var z=a.i(970039),A=a.i(18039);let B=g.memo(({className:a,plugins:c})=>{let d=c.length<14,e=c.slice(0,14);return(0,b.jsxs)("div",{className:(0,v.cn)("flex items-center space-x-1",a),children:[e.map(a=>(0,b.jsx)(z.default,{size:"tiny",src:`${A.MARKETPLACE_API_PREFIX}/plugins/${a}/icon`},a)),!d&&(0,b.jsxs)("div",{className:"system-xs-medium text-text-tertiary",children:["+",c.length-14]})]})});var C=a.i(105249),D=a.i(825319),E=a.i(979856),F=a.i(781362),G=a.i(50084);a.i(622666);var H=a.i(253073);a.i(10035);var I=a.i(423963);let J=g.memo(({className:a,noPlugins:c})=>{let{t:d}=(0,h.useTranslation)(),e=c?(0,b.jsx)(I.Group,{className:"size-6 text-text-quaternary"}):(0,b.jsx)(H.SearchMenu,{className:"size-8 text-text-tertiary"}),f=d(`autoUpdate.noPluginPlaceholder.${c?"noInstalled":"noFound"}`,{ns:"plugin"});return(0,b.jsx)("div",{className:(0,v.cn)("flex items-center justify-center",a),children:(0,b.jsxs)("div",{className:"flex flex-col items-center",children:[e,(0,b.jsx)("div",{className:"system-sm-regular mt-2 text-text-tertiary",children:f})]})})});var K=a.i(168799),L=a.i(252813),M=a.i(366231);let N=g.memo(({payload:a,isChecked:c,onCheckChange:d})=>{let e=(0,L.useGetLanguage)(),{plugin_id:f,declaration:g}=a,{label:h,author:i}=g;return(0,b.jsx)("div",{className:"p-1",children:(0,b.jsxs)("div",{className:"flex w-full select-none items-center rounded-lg pr-2 hover:bg-state-base-hover",children:[(0,b.jsxs)("div",{className:"flex h-8 grow items-center space-x-2 pl-3 pr-2",children:[(0,b.jsx)(z.default,{size:"tiny",src:`${A.MARKETPLACE_API_PREFIX}/plugins/${f}/icon`}),(0,b.jsx)("div",{className:"system-sm-medium max-w-[150px] shrink-0 truncate text-text-primary",children:(0,M.renderI18nObject)(h,e)}),(0,b.jsx)("div",{className:"system-xs-regular max-w-[150px] shrink-0  truncate text-text-quaternary",children:i})]}),(0,b.jsx)(K.default,{checked:c,onCheck:d,className:"shrink-0"})]})})}),O=g.memo(({trigger:a,value:c,onChange:d,isShow:e,onShowChange:f})=>{let{t:i}=(0,h.useTranslation)(),j=(0,g.useCallback)(()=>{f(!e)},[f,e]),k=[{key:G.PLUGIN_TYPE_SEARCH_MAP.all,name:i("category.all",{ns:"plugin"})},{key:G.PLUGIN_TYPE_SEARCH_MAP.model,name:i("category.models",{ns:"plugin"})},{key:G.PLUGIN_TYPE_SEARCH_MAP.tool,name:i("category.tools",{ns:"plugin"})},{key:G.PLUGIN_TYPE_SEARCH_MAP.agent,name:i("category.agents",{ns:"plugin"})},{key:G.PLUGIN_TYPE_SEARCH_MAP.extension,name:i("category.extensions",{ns:"plugin"})},{key:G.PLUGIN_TYPE_SEARCH_MAP.datasource,name:i("category.datasources",{ns:"plugin"})},{key:G.PLUGIN_TYPE_SEARCH_MAP.trigger,name:i("category.triggers",{ns:"plugin"})},{key:G.PLUGIN_TYPE_SEARCH_MAP.bundle,name:i("category.bundles",{ns:"plugin"})}],[l,n]=(0,g.useState)(G.PLUGIN_TYPE_SEARCH_MAP.all),[o,p]=(0,g.useState)(""),[q,r]=(0,g.useState)([]),{data:s,isLoading:t}=(0,F.useInstalledPluginList)(),u=(0,g.useMemo)(()=>(s?s.plugins:[]).filter(a=>a.source===m.PluginSource.marketplace&&(l===G.PLUGIN_TYPE_SEARCH_MAP.all||a.declaration.category===l)&&(0===q.length||q.some(b=>a.declaration.tags.includes(b)))&&(""===o||a.plugin_id.toLowerCase().includes(o.toLowerCase()))),[s,l,o,q]),w=(0,g.useCallback)(a=>()=>{d(c.includes(a)?c.filter(b=>b!==a):[...c,a])},[d,c]),x=(0,b.jsx)("div",{className:"max-h-[396px] overflow-y-auto",children:u.map(a=>(0,b.jsx)(N,{payload:a,isChecked:c.includes(a.plugin_id),onCheckChange:w(a.plugin_id)},a.plugin_id))}),y=(0,b.jsx)("div",{className:"flex h-[396px] items-center justify-center",children:(0,b.jsx)(C.default,{})}),z=(0,b.jsx)(J,{className:"h-[396px]",noPlugins:!o});return(0,b.jsxs)(D.PortalToFollowElem,{placement:"top",offset:0,open:e,onOpenChange:f,children:[(0,b.jsx)(D.PortalToFollowElemTrigger,{className:"block w-full",onClick:j,children:a}),(0,b.jsx)(D.PortalToFollowElemContent,{className:"z-[1000]",children:(0,b.jsxs)("div",{className:(0,v.cn)("relative min-h-20 w-full rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur pb-2 shadow-lg backdrop-blur-sm"),children:[(0,b.jsx)("div",{className:"p-2 pb-1",children:(0,b.jsx)(E.default,{search:o,onSearchChange:p,tags:q,onTagsChange:r,placeholder:i("searchTools",{ns:"plugin"}),inputClassName:"w-full"})}),(0,b.jsx)("div",{className:"flex items-center justify-between border-b-[0.5px] border-divider-subtle bg-background-default-hover px-3 shadow-xs",children:(0,b.jsx)("div",{className:"flex h-8 items-center space-x-1",children:k.map(a=>(0,b.jsx)("div",{className:(0,v.cn)("flex h-6 cursor-pointer items-center rounded-md px-2 hover:bg-state-base-hover","text-xs font-medium text-text-secondary",l===a.key&&"bg-state-base-hover-alt"),onClick:()=>n(a.key),children:a.name},a.key))})}),!t&&u.length>0&&x,!t&&0===u.length&&z,t&&y]})})]})}),P="autoUpdate",Q=g.memo(({updateMode:a,value:e,onChange:f})=>{let{t:g}=(0,h.useTranslation)(),j=e.length>0,k=a===x.AUTO_UPDATE_MODE.exclude,[l,{set:m}]=(0,d.useBoolean)(!1);return(0,b.jsxs)("div",{className:"mt-2 rounded-[10px] bg-background-section-burn p-2.5",children:[j?(0,b.jsxs)("div",{className:"flex justify-between text-text-tertiary",children:[(0,b.jsx)("div",{className:"system-xs-medium",children:g(`${P}.${k?"excludeUpdate":"partialUPdate"}`,{ns:"plugin",num:e.length})}),(0,b.jsx)("div",{className:"system-xs-medium cursor-pointer",onClick:()=>{f([])},children:g(`${P}.operation.clearAll`,{ns:"plugin"})})]}):(0,b.jsx)(y,{updateMode:a}),j&&(0,b.jsx)(B,{className:"mt-2",plugins:e}),(0,b.jsx)(O,{trigger:(0,b.jsxs)(i.default,{className:"mt-2 w-full",size:"small",variant:"secondary-accent",children:[(0,b.jsx)(c.RiAddLine,{className:"size-3.5"}),g(`${P}.operation.select`,{ns:"plugin"})]}),value:e,onChange:f,isShow:l,onShowChange:m})]})}),R="autoUpdate.strategy",S=({value:a,onChange:d})=>{let{t:e}=(0,h.useTranslation)(),[f,j]=(0,g.useState)(!1),k=[{value:x.AUTO_UPDATE_STRATEGY.disabled,label:e(`${R}.disabled.name`,{ns:"plugin"}),description:e(`${R}.disabled.description`,{ns:"plugin"})},{value:x.AUTO_UPDATE_STRATEGY.fixOnly,label:e(`${R}.fixOnly.name`,{ns:"plugin"}),description:e(`${R}.fixOnly.description`,{ns:"plugin"})},{value:x.AUTO_UPDATE_STRATEGY.latest,label:e(`${R}.latest.name`,{ns:"plugin"}),description:e(`${R}.latest.description`,{ns:"plugin"})}],l=k.find(b=>b.value===a);return(0,b.jsxs)(D.PortalToFollowElem,{open:f,onOpenChange:j,placement:"top-end",offset:4,children:[(0,b.jsx)(D.PortalToFollowElemTrigger,{onClick:a=>{a.stopPropagation(),a.nativeEvent.stopImmediatePropagation(),j(a=>!a)},children:(0,b.jsxs)(i.default,{size:"small",children:[l?.label,(0,b.jsx)(c.RiArrowDownSLine,{className:"h-3.5 w-3.5"})]})}),(0,b.jsx)(D.PortalToFollowElemContent,{className:"z-[99]",children:(0,b.jsx)("div",{className:"w-[280px] rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur p-1 shadow-lg",children:k.map(e=>(0,b.jsxs)("div",{className:"flex cursor-pointer rounded-lg p-2 pr-3 hover:bg-state-base-hover",onClick:a=>{a.stopPropagation(),a.nativeEvent.stopImmediatePropagation(),d(e.value),j(!1)},children:[(0,b.jsx)("div",{className:"mr-1 w-4 shrink-0",children:a===e.value&&(0,b.jsx)(c.RiCheckLine,{className:"h-4 w-4 text-text-accent"})}),(0,b.jsxs)("div",{className:"grow",children:[(0,b.jsx)("div",{className:"system-sm-semibold mb-0.5 text-text-secondary",children:e.label}),(0,b.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:e.description})]})]},e.value))})})]})};var T=a.i(395906);let U="autoUpdate",V=({children:a})=>{let c=(0,u.useModalContextSelector)(a=>a.setShowAccountSettingModal);return(0,b.jsx)("span",{className:"body-xs-regular cursor-pointer text-text-accent",onClick:()=>c({payload:s.ACCOUNT_SETTING_TAB.LANGUAGE}),children:a})},W=g.memo(({payload:a,onChange:d})=>{let{t:e}=(0,h.useTranslation)(),{userProfile:{timezone:f}}=(0,t.useAppContext)(),{strategy_setting:i,upgrade_time_of_day:j,upgrade_mode:k,exclude_plugins:l,include_plugins:m}=a,o=(0,g.useCallback)(a=>a.filter(a=>Number.parseInt(a,10)%15==0),[]),s=(0,g.useMemo)(()=>{switch(i){case x.AUTO_UPDATE_STRATEGY.fixOnly:return e(`${U}.strategy.fixOnly.selectedDescription`,{ns:"plugin"});case x.AUTO_UPDATE_STRATEGY.latest:return e(`${U}.strategy.latest.selectedDescription`,{ns:"plugin"});default:return""}},[i,e]),u=(0,g.useMemo)(()=>{switch(k){case x.AUTO_UPDATE_MODE.partial:return m;case x.AUTO_UPDATE_MODE.exclude:return l;default:return[]}},[k,l,m]),y=(0,g.useCallback)(b=>{k===x.AUTO_UPDATE_MODE.partial?d({...a,include_plugins:b}):k===x.AUTO_UPDATE_MODE.exclude&&d({...a,exclude_plugins:b})},[a,k,d]),z=(0,g.useCallback)(b=>c=>{d({...a,[b]:c})},[a,d]),A=(0,g.useCallback)(({inputElem:a,onClick:d,isOpen:e})=>(0,b.jsxs)("div",{className:"group float-right flex h-8 w-[160px] cursor-pointer items-center justify-between rounded-lg bg-components-input-bg-normal px-2 hover:bg-state-base-hover-alt",onClick:d,children:[(0,b.jsxs)("div",{className:"flex w-0 grow items-center gap-x-1",children:[(0,b.jsx)(c.RiTimeLine,{className:(0,v.cn)("h-4 w-4 shrink-0 text-text-tertiary",e?"text-text-secondary":"group-hover:text-text-secondary")}),a]}),(0,b.jsx)("div",{className:"system-sm-regular text-text-tertiary",children:(0,r.convertTimezoneToOffsetStr)(f)})]}),[f]);return(0,b.jsxs)("div",{className:"self-stretch px-6",children:[(0,b.jsxs)("div",{className:"my-3 flex items-center",children:[(0,b.jsx)("div",{className:"system-xs-medium-uppercase text-text-tertiary",children:e(`${U}.updateSettings`,{ns:"plugin"})}),(0,b.jsx)("div",{className:"ml-2 h-px grow bg-divider-subtle"})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(w,{label:e(`${U}.automaticUpdates`,{ns:"plugin"}),description:s}),(0,b.jsx)(S,{value:i,onChange:z("strategy_setting")})]}),i!==x.AUTO_UPDATE_STRATEGY.disabled&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(w,{label:e(`${U}.updateTime`,{ns:"plugin"})}),(0,b.jsxs)("div",{className:"flex flex-col justify-start",children:[(0,b.jsx)(q.default,{value:(0,T.timeOfDayToDayjs)((0,T.convertUTCDaySecondsToLocalSeconds)(j,f)),timezone:f,onChange:a=>z("upgrade_time_of_day")((0,T.convertLocalSecondsToUTCDaySeconds)((0,T.dayjsToTimeOfDay)(a),f)),onClear:()=>z("upgrade_time_of_day")((0,T.convertLocalSecondsToUTCDaySeconds)(0,f)),popupClassName:"z-[99]",title:e(`${U}.updateTime`,{ns:"plugin"}),minuteFilter:o,renderTrigger:A,placement:"bottom-end"}),(0,b.jsx)("div",{className:"body-xs-regular mt-1 text-right text-text-tertiary",children:(0,b.jsx)(p.Trans,{i18nKey:`${U}.changeTimezone`,ns:"plugin",components:{setTimezone:(0,b.jsx)(V,{})}})})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(w,{label:e(`${U}.specifyPluginsToUpdate`,{ns:"plugin"})}),(0,b.jsx)("div",{className:"mt-1 flex w-full items-start justify-between gap-2",children:[x.AUTO_UPDATE_MODE.update_all,x.AUTO_UPDATE_MODE.exclude,x.AUTO_UPDATE_MODE.partial].map(a=>(0,b.jsx)(n.default,{title:e(`${U}.upgradeMode.${a}`,{ns:"plugin"}),onSelect:()=>z("upgrade_mode")(a),selected:k===a,className:"flex-1"},a))}),k!==x.AUTO_UPDATE_MODE.update_all&&(0,b.jsx)(Q,{value:u,onChange:y,updateMode:k})]})]})]})]})}),X={strategy_setting:x.AUTO_UPDATE_STRATEGY.disabled,upgrade_time_of_day:0,upgrade_mode:x.AUTO_UPDATE_MODE.update_all,exclude_plugins:[],include_plugins:[]},Y="privilege",Z=g.memo(({payload:a,onHide:c,onSave:d})=>{let{t:e}=(0,h.useTranslation)(),{auto_upgrade:f,permission:j}=a||{},[k,p]=(0,g.useState)(j),[q,r]=(0,g.useState)(f||X),{enable_marketplace:s}=(0,o.useGlobalPublicStore)(a=>a.systemFeatures),t=(0,g.useCallback)(a=>b=>{p({...k,[a]:b})},[k]),u=(0,g.useCallback)(async()=>{await d({permission:k,auto_upgrade:q}),c()},[c,d,q,k]);return(0,b.jsx)(l.default,{isShow:!0,onClose:c,closable:!0,className:"w-[620px] max-w-[620px] !p-0",children:(0,b.jsxs)("div",{className:"shadows-shadow-xl flex w-full flex-col items-start rounded-2xl border border-components-panel-border bg-components-panel-bg",children:[(0,b.jsx)("div",{className:"flex items-start gap-2 self-stretch pb-3 pl-6 pr-14 pt-6",children:(0,b.jsx)("span",{className:"title-2xl-semi-bold self-stretch text-text-primary",children:e(`${Y}.title`,{ns:"plugin"})})}),(0,b.jsx)("div",{className:"flex flex-col items-start justify-center gap-4 self-stretch px-6 py-3",children:[{title:e(`${Y}.whoCanInstall`,{ns:"plugin"}),key:"install_permission",value:k?.install_permission||m.PermissionType.noOne},{title:e(`${Y}.whoCanDebug`,{ns:"plugin"}),key:"debug_permission",value:k?.debug_permission||m.PermissionType.noOne}].map(({title:a,key:c,value:d})=>(0,b.jsxs)("div",{className:"flex flex-col items-start gap-1 self-stretch",children:[(0,b.jsx)(w,{label:a}),(0,b.jsx)("div",{className:"flex w-full items-start justify-between gap-2",children:[m.PermissionType.everyone,m.PermissionType.admin,m.PermissionType.noOne].map(a=>(0,b.jsx)(n.default,{title:e(`${Y}.${a}`,{ns:"plugin"}),onSelect:()=>t(c)(a),selected:d===a,className:"flex-1"},a))})]},c))}),s&&(0,b.jsx)(W,{payload:q,onChange:r}),(0,b.jsxs)("div",{className:"flex h-[76px] items-center justify-end gap-2 self-stretch p-6 pt-5",children:[(0,b.jsx)(i.default,{className:"min-w-[72px]",onClick:c,children:e("operation.cancel",{ns:"common"})}),(0,b.jsx)(i.default,{className:"min-w-[72px]",variant:"primary",onClick:u,children:e("operation.save",{ns:"common"})})]})]})})});var $=a.i(280342),_=a.i(963542),aa=a.i(238387),ab=a.i(459858),ac=a.i(71905),ad=a.i(193017),ae=a.i(917122),af=a.i(345291),ag=a.i(845039);let ah="debugInfo",ai=g.memo(()=>{let{t:a}=(0,h.useTranslation)(),d=(0,L.useDocLink)(),{data:e,isLoading:f}=(0,F.useDebugKey)(),g=e?.key?.replace(/(.{8})(.*)(.{8})/,"$1********$3");return f?null:(0,b.jsx)(k.default,{triggerMethod:"click",disabled:!e,popupContent:(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"flex items-center gap-1 self-stretch",children:[(0,b.jsx)("span",{className:"system-sm-semibold flex shrink-0 grow basis-0 flex-col items-start justify-center text-text-secondary",children:a(`${ah}.title`,{ns:"plugin"})}),(0,b.jsxs)("a",{href:d("/develop-plugin/features-and-specs/plugin-types/remote-debug-a-plugin"),target:"_blank",className:"flex cursor-pointer items-center gap-0.5 text-text-accent-light-mode-only",children:[(0,b.jsx)("span",{className:"system-xs-medium",children:a(`${ah}.viewDocs`,{ns:"plugin"})}),(0,b.jsx)(c.RiArrowRightUpLine,{className:"h-3 w-3"})]})]}),(0,b.jsxs)("div",{className:"space-y-0.5",children:[(0,b.jsx)(ag.default,{label:"URL",value:`${e?.host}:${e?.port}`}),(0,b.jsx)(ag.default,{label:"Key",value:e?.key||"",maskedValue:g})]})]}),popupClassName:"flex flex-col items-start w-[256px] px-4 py-3.5 gap-1 border border-components-panel-border rounded-xl bg-components-tooltip-bg shadows-shadow-lg z-50",asChild:!1,position:"bottom",children:(0,b.jsx)(i.default,{className:"h-full w-full p-2 text-components-button-secondary-text",children:(0,b.jsx)(c.RiBugLine,{className:"h-4 w-4"})})})});a.i(207340);var aj=a.i(163999);a.i(658335);var ak=a.i(822194);a.i(574469);var al=a.i(718121),am=a.i(414460);let an=({onSwitchToMarketplaceTab:a})=>{let{t:d}=(0,h.useTranslation)(),f=(0,g.useRef)(null),[j,k]=(0,g.useState)(!1),[l,m]=(0,g.useState)(null),[n,p]=(0,g.useState)(null),{enable_marketplace:q,plugin_installation_permission:r}=(0,o.useGlobalPublicStore)(a=>a.systemFeatures),[s,t]=(0,g.useState)([]);return(0,g.useEffect)(()=>{let a=[];q&&a.push({icon:al.MagicBox,text:d("source.marketplace",{ns:"plugin"}),action:"marketplace"}),r.restrict_to_marketplace_only||(a.push({icon:ak.Github,text:d("source.github",{ns:"plugin"}),action:"github"}),a.push({icon:aj.FileZip,text:d("source.local",{ns:"plugin"}),action:"local"})),t(a)},[r,q,d]),(0,b.jsxs)(D.PortalToFollowElem,{open:j,onOpenChange:k,placement:"bottom-start",offset:4,children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(D.PortalToFollowElemTrigger,{onClick:()=>k(a=>!a),children:(0,b.jsxs)(i.default,{className:(0,v.cn)("h-full w-full p-2 text-components-button-secondary-text",j&&"bg-state-base-hover"),children:[(0,b.jsx)(c.RiAddLine,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"pl-1",children:d("installPlugin",{ns:"plugin"})}),(0,b.jsx)(c.RiArrowDownSLine,{className:"ml-1 h-4 w-4"})]})}),(0,b.jsx)(D.PortalToFollowElemContent,{className:"z-[1002]",children:(0,b.jsxs)("div",{className:"shadows-shadow-lg flex w-[200px] flex-col items-start rounded-xl border border-components-panel-border bg-components-panel-bg-blur p-1 pb-2",children:[(0,b.jsx)("span",{className:"system-xs-medium-uppercase flex items-start self-stretch pb-0.5 pl-2 pr-3 pt-1 text-text-tertiary",children:d("installFrom",{ns:"plugin"})}),(0,b.jsx)("input",{type:"file",ref:f,style:{display:"none"},onChange:a=>{let b=a.target.files?.[0];b&&(p(b),m("local"),k(!1))},accept:A.SUPPORT_INSTALL_LOCAL_FILE_EXTENSIONS}),(0,b.jsx)("div",{className:"w-full",children:s.map(({icon:c,text:d,action:e})=>(0,b.jsxs)("div",{className:"flex w-full !cursor-pointer items-center gap-1 rounded-lg px-2 py-1.5 hover:bg-state-base-hover",onClick:()=>{"local"===e?f.current?.click():("marketplace"===e?a():m(e),k(!1))},children:[(0,b.jsx)(c,{className:"h-4 w-4 text-text-tertiary"}),(0,b.jsx)("span",{className:"system-md-regular px-1 text-text-secondary",children:d})]},e))})]})})]}),"github"===l&&(0,b.jsx)(am.default,{onSuccess:e.noop,onClose:()=>m(null)}),"local"===l&&n&&(0,b.jsx)(ad.default,{file:n,onClose:()=>m(null),onSuccess:e.noop})]})};var ao=a.i(302785);let ap=({plugin:a,getIconUrl:c,language:d,statusIcon:e,statusText:f,statusClassName:g,action:h})=>(0,b.jsxs)("div",{className:"flex items-center rounded-lg p-2 hover:bg-state-base-hover",children:[(0,b.jsxs)("div",{className:"relative mr-2 flex h-6 w-6 items-center justify-center rounded-md border-[0.5px] border-components-panel-border-subtle bg-background-default-dodge",children:[e,(0,b.jsx)(z.default,{size:"tiny",src:c(a.icon)})]}),(0,b.jsxs)("div",{className:"grow",children:[(0,b.jsx)("div",{className:"system-md-regular truncate text-text-secondary",children:a.labels[d]}),(0,b.jsx)("div",{className:`system-xs-regular ${g||"text-text-tertiary"}`,children:f})]}),h]}),aq=({title:a,count:c,plugins:d,getIconUrl:e,language:f,statusIcon:g,defaultStatusText:h,statusClassName:i,headerAction:j,renderItemAction:k})=>0===d.length?null:(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"system-sm-semibold-uppercase sticky top-0 flex h-7 items-center justify-between px-2 pt-1 text-text-secondary",children:[a," ","(",c,")",j]}),(0,b.jsx)("div",{className:"max-h-[200px] overflow-y-auto",children:d.map(a=>(0,b.jsx)(ap,{plugin:a,getIconUrl:e,language:f,statusIcon:g,statusText:a.message||h,statusClassName:i,action:k?.(a)},a.plugin_unique_identifier))})]}),ar=({runningPlugins:a,successPlugins:d,errorPlugins:e,getIconUrl:f,onClearAll:g,onClearErrors:j,onClearSingle:k})=>{let{t:l}=(0,h.useTranslation)(),m=(0,L.useGetLanguage)();return(0,b.jsxs)("div",{className:"w-[360px] rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur p-1 shadow-lg",children:[a.length>0&&(0,b.jsx)(aq,{title:l("task.installing",{ns:"plugin"}),count:a.length,plugins:a,getIconUrl:f,language:m,statusIcon:(0,b.jsx)(c.RiLoaderLine,{className:"absolute -bottom-0.5 -right-0.5 z-10 h-3 w-3 animate-spin text-text-accent"}),defaultStatusText:l("task.installing",{ns:"plugin"})}),d.length>0&&(0,b.jsx)(aq,{title:l("task.installed",{ns:"plugin"}),count:d.length,plugins:d,getIconUrl:f,language:m,statusIcon:(0,b.jsx)(c.RiCheckboxCircleFill,{className:"absolute -bottom-0.5 -right-0.5 z-10 h-3 w-3 text-text-success"}),defaultStatusText:l("task.installed",{ns:"plugin"}),statusClassName:"text-text-success",headerAction:(0,b.jsx)(i.default,{className:"shrink-0",size:"small",variant:"ghost",onClick:g,children:l("task.clearAll",{ns:"plugin"})})}),e.length>0&&(0,b.jsx)(aq,{title:l("task.installError",{ns:"plugin",errorLength:e.length}),count:e.length,plugins:e,getIconUrl:f,language:m,statusIcon:(0,b.jsx)(c.RiErrorWarningFill,{className:"absolute -bottom-0.5 -right-0.5 z-10 h-3 w-3 text-text-destructive"}),defaultStatusText:l("task.installError",{ns:"plugin",errorLength:e.length}),statusClassName:"text-text-destructive break-all",headerAction:(0,b.jsx)(i.default,{className:"shrink-0",size:"small",variant:"ghost",onClick:j,children:l("task.clearAll",{ns:"plugin"})}),renderItemAction:a=>(0,b.jsx)(i.default,{className:"shrink-0",size:"small",variant:"ghost",onClick:()=>k(a.taskId,a.plugin_unique_identifier),children:l("operation.clear",{ns:"common"})})})]})};var as=a.i(744383),at=a.i(489463);let au=({tip:a,isInstalling:d,isInstallingWithSuccess:e,isInstallingWithError:f,isSuccess:g,isFailed:h,successPluginsLength:i,runningPluginsLength:j,totalPluginsLength:l,onClick:m})=>{let n=d||f,o=f||h,p=g||i>0&&0===j;return(0,b.jsx)(k.default,{popupContent:a,asChild:!0,offset:8,children:(0,b.jsxs)("div",{className:(0,v.cn)("relative flex h-8 w-8 items-center justify-center rounded-lg border-[0.5px] border-components-button-secondary-border bg-components-button-secondary-bg shadow-xs hover:bg-components-button-secondary-bg-hover",o&&"cursor-pointer border-components-button-destructive-secondary-border-hover bg-state-destructive-hover hover:bg-state-destructive-hover-alt",(d||e||g)&&"cursor-pointer hover:bg-components-button-secondary-bg-hover"),id:"plugin-task-trigger",onClick:m,children:[n?(0,b.jsx)(at.default,{}):(0,b.jsx)(c.RiInstallLine,{className:(0,v.cn)("h-4 w-4 text-components-button-secondary-text",o&&"text-components-button-destructive-secondary-text")}),(0,b.jsxs)("div",{className:"absolute -right-1 -top-1",children:[(d||e)&&(0,b.jsx)(as.default,{percentage:(l>0?i/l:0)*100,circleFillColor:"fill-components-progress-brand-bg"}),f&&(0,b.jsx)(as.default,{percentage:(l>0?j/l:0)*100,circleFillColor:"fill-components-progress-brand-bg",sectorFillColor:"fill-components-progress-error-border",circleStrokeColor:"stroke-components-progress-error-border"}),p&&!d&&!e&&!f&&(0,b.jsx)(c.RiCheckboxCircleFill,{className:"h-3.5 w-3.5 text-text-success"}),h&&(0,b.jsx)(c.RiErrorWarningFill,{className:"h-3.5 w-3.5 text-text-destructive"})]})]})})};var av=a.i(369396);let aw=()=>{let{t:a}=(0,h.useTranslation)(),[c,d]=(0,g.useState)(!1),{errorPlugins:e,successPlugins:f,runningPlugins:i,runningPluginsLength:j,successPluginsLength:k,errorPluginsLength:l,totalPluginsLength:m,isInstalling:n,isInstallingWithSuccess:o,isInstallingWithError:p,isSuccess:q,isFailed:r,handleClearErrorPlugin:s}=(0,av.usePluginTaskStatus)(),{getIconUrl:t}=(0,ao.default)(),u=(0,g.useMemo)(()=>p?a("task.installingWithError",{ns:"plugin",installingLength:j,successLength:k,errorLength:l}):o?a("task.installingWithSuccess",{ns:"plugin",installingLength:j,successLength:k}):n?a("task.installing",{ns:"plugin"}):r?a("task.installedError",{ns:"plugin",errorLength:l}):q?a("task.installSuccess",{ns:"plugin",successLength:k}):a("task.installed",{ns:"plugin"}),[l,r,n,p,o,q,j,k,a]),v=(0,g.useCallback)(async a=>{for(let b of a)await s(b.taskId,b.plugin_unique_identifier);0===j&&d(!1)},[s,j]),w=(0,g.useCallback)(()=>v([...f,...e]),[v,f,e]),x=(0,g.useCallback)(()=>v(e),[v,e]),y=(0,g.useCallback)((a,b)=>v([{taskId:a,plugin_unique_identifier:b}]),[v]),z=(0,g.useCallback)(()=>{(r||n||o||p||q)&&d(a=>!a)},[r,n,o,p,q]);return 0===m?null:(0,b.jsx)("div",{className:"flex items-center",children:(0,b.jsxs)(D.PortalToFollowElem,{open:c,onOpenChange:d,placement:"bottom-start",offset:{mainAxis:4,crossAxis:79},children:[(0,b.jsx)(D.PortalToFollowElemTrigger,{onClick:z,children:(0,b.jsx)(au,{tip:u,isInstalling:n,isInstallingWithSuccess:o,isInstallingWithError:p,isSuccess:q,isFailed:r,successPluginsLength:k,runningPluginsLength:j,totalPluginsLength:m,onClick:()=>{}})}),(0,b.jsx)(D.PortalToFollowElemContent,{className:"z-[11]",children:(0,b.jsx)(ar,{runningPlugins:i,successPlugins:f,errorPlugins:e,getIconUrl:t,onClearAll:w,onClearErrors:x,onClearSingle:y})})]})})};var ax=a.i(465592);let ay=({plugins:a,marketplace:l})=>{let{t:m}=(0,h.useTranslation)(),n=(0,L.useDocLink)();(0,$.default)(m("metadata.title",{ns:"plugin"}));let[{packageId:p,bundleInfo:q},r]=(0,_.usePluginInstallation)(),[s,t]=(0,g.useState)(null),[u,w]=(0,g.useState)([]),[x,{setTrue:y,setFalse:z}]=(0,d.useBoolean)(!1),B=()=>{z(),r(null)},[C,D]=(0,g.useState)(null);(0,g.useEffect)(()=>{(async()=>{if(t(null),await (0,ab.sleep)(100),p){let{data:a}=await (0,aa.fetchManifestFromMarketPlace)(encodeURIComponent(p)),{plugin:b,version:c}=a;D({...b,version:c.version,icon:`${A.MARKETPLACE_API_PREFIX}/plugins/${b.org}/${b.name}/icon`}),t(p),y();return}if(q)try{let{data:a}=await (0,aa.fetchBundleInfoFromMarketPlace)(q);w(a.version.dependencies),y()}catch(a){console.error("Failed to load bundle info:",a)}})()},[p,q,y]);let{referenceSetting:E,canManagement:F,canDebugger:H,canSetPermissions:I,setReferenceSettings:J}=(0,ax.default)(),[K,{setTrue:M,setFalse:N}]=(0,d.useBoolean)(!1),[O,P]=(0,g.useState)(null),Q=(0,af.usePluginPageContext)(a=>a.containerRef),R=(0,af.usePluginPageContext)(a=>a.options),S=(0,af.usePluginPageContext)(a=>a.activeTab),T=(0,af.usePluginPageContext)(a=>a.setActiveTab),{enable_marketplace:U}=(0,o.useGlobalPublicStore)(a=>a.systemFeatures),V=(0,g.useMemo)(()=>S===ac.PLUGIN_PAGE_TABS_MAP.plugins,[S]),W=(0,g.useMemo)(()=>{let a=Object.values(G.PLUGIN_TYPE_SEARCH_MAP);return S===ac.PLUGIN_PAGE_TABS_MAP.marketplace||a.includes(S)},[S]),{dragging:X,fileUploader:Y,fileChangeHandle:ag,removeFile:ah}=(({onFileChange:a,containerRef:b,enabled:c=!0})=>{let[d,e]=(0,g.useState)(!1),f=(0,g.useRef)(null),h=a=>{a.preventDefault(),a.stopPropagation(),a.dataTransfer?.types.includes("Files")&&e(!0)},i=a=>{a.preventDefault(),a.stopPropagation()},j=a=>{a.preventDefault(),a.stopPropagation(),null!==a.relatedTarget&&b.current?.contains(a.relatedTarget)||e(!1)},k=b=>{if(b.preventDefault(),b.stopPropagation(),e(!1),!b.dataTransfer)return;let c=Array.from(b.dataTransfer.files);c.length>0&&a(c[0])},l=c?b=>{a(b.target.files?.[0]||null)}:null,m=c?()=>{f.current&&(f.current.value=""),a(null)}:null;return(0,g.useEffect)(()=>{if(!c)return;let a=b.current;return a&&(a.addEventListener("dragenter",h),a.addEventListener("dragover",i),a.addEventListener("dragleave",j),a.addEventListener("drop",k)),()=>{a&&(a.removeEventListener("dragenter",h),a.removeEventListener("dragover",i),a.removeEventListener("dragleave",j),a.removeEventListener("drop",k))}},[b,c]),{dragging:!!c&&d,fileUploader:f,fileChangeHandle:l,removeFile:m}})({onFileChange:a=>{a&&a.name.endsWith(".difypkg")?P(a):P(null)},containerRef:Q,enabled:V&&F});return(0,b.jsxs)("div",{id:"marketplace-container",ref:Q,style:{scrollbarGutter:"stable"},className:(0,v.cn)("relative flex grow flex-col overflow-y-auto border-t border-divider-subtle",V?"rounded-t-xl bg-components-panel-bg":"bg-background-body"),children:[(0,b.jsx)("div",{className:(0,v.cn)("sticky top-0 z-10 flex min-h-[60px] items-center gap-1 self-stretch bg-components-panel-bg px-12 pb-2 pt-4",W&&"bg-background-body"),children:(0,b.jsxs)("div",{className:"flex w-full items-center justify-between",children:[(0,b.jsx)("div",{className:"flex-1",children:(0,b.jsx)(j.default,{value:V?ac.PLUGIN_PAGE_TABS_MAP.plugins:ac.PLUGIN_PAGE_TABS_MAP.marketplace,onChange:T,options:R})}),(0,b.jsxs)("div",{className:"flex shrink-0 items-center gap-1",children:[W&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(f.default,{href:"https://github.com/langgenius/dify-plugins/issues/new?template=plugin_request.yaml",target:"_blank",children:(0,b.jsx)(i.default,{variant:"ghost",className:"text-text-tertiary",children:m("requestAPlugin",{ns:"plugin"})})}),(0,b.jsx)(f.default,{href:n("/develop-plugin/publishing/marketplace-listing/release-to-dify-marketplace"),target:"_blank",children:(0,b.jsxs)(i.default,{className:"px-3",variant:"secondary-accent",children:[(0,b.jsx)(c.RiBookOpenLine,{className:"mr-1 h-4 w-4"}),m("publishPlugins",{ns:"plugin"})]})}),(0,b.jsx)("div",{className:"mx-1 h-3.5 w-[1px] shrink-0 bg-divider-regular"})]}),(0,b.jsx)(aw,{}),F&&(0,b.jsx)(an,{onSwitchToMarketplaceTab:()=>T("discover")}),H&&(0,b.jsx)(ai,{}),I&&(0,b.jsx)(k.default,{popupContent:m("privilege.title",{ns:"plugin"}),children:(0,b.jsx)(i.default,{"data-testid":"plugin-settings-button",className:"group h-full w-full p-2 text-components-button-secondary-text",onClick:M,children:(0,b.jsx)(c.RiEqualizer2Line,{className:"h-4 w-4"})})})]})]})}),V&&(0,b.jsxs)(b.Fragment,{children:[a,X&&(0,b.jsx)("div",{className:"absolute inset-0 m-0.5 rounded-2xl border-2 border-dashed border-components-dropzone-border-accent bg-[rgba(21,90,239,0.14)] p-2"}),(0,b.jsxs)("div",{className:`flex items-center justify-center gap-2 py-4 ${X?"text-text-accent":"text-text-quaternary"}`,children:[(0,b.jsx)(c.RiDragDropLine,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"system-xs-regular",children:m("installModal.dropPluginToInstall",{ns:"plugin"})})]}),O&&(0,b.jsx)(ad.default,{file:O,onClose:ah??e.noop,onSuccess:e.noop}),(0,b.jsx)("input",{ref:Y,className:"hidden",type:"file",id:"fileUploader",accept:A.SUPPORT_INSTALL_LOCAL_FILE_EXTENSIONS,onChange:ag??e.noop})]}),W&&U&&l,K&&(0,b.jsx)(Z,{payload:E,onHide:N,onSave:J}),x&&s&&(0,b.jsx)(ae.default,{manifest:C,uniqueIdentifier:s,isBundle:!!q,dependencies:u,onClose:B,onSuccess:B})]})};a.s(["default",0,a=>(0,b.jsx)(af.PluginPageContextProvider,{children:(0,b.jsx)(ay,{...a})})],840798)},516406,a=>{"use strict";var b=a.i(608061),c=a.i(981133),d=a.i(57843);a.i(752298);var e=a.i(693025),f=a.i(909795),g=a.i(105249),h=a.i(931413),i=a.i(252813),j=a.i(366231),k=a.i(781362),l=a.i(263636),m=a.i(345291),n=a.i(111089);a.i(10035);var o=a.i(423963);a.i(207340);var p=a.i(163999);a.i(658335);var q=a.i(822194);a.i(574469);var r=a.i(718121),s=a.i(414460),t=a.i(193017),u=a.i(18039),v=a.i(724423),w=a.i(234479);let x=()=>{let{t:a}=(0,e.useTranslation)(),c=(0,d.useRef)(null),[g,h]=(0,d.useState)(null),[i,j]=(0,d.useState)(null),{enable_marketplace:l,plugin_installation_permission:x}=(0,v.useGlobalPublicStore)(a=>a.systemFeatures),y=(0,m.usePluginPageContext)(a=>a.setActiveTab),z=(0,m.usePluginPageContext)(a=>a.filters),{data:A}=(0,k.useInstalledPluginList)(),B=(0,d.useMemo)(()=>A?.plugins.length===0?a("list.noInstalled",{ns:"plugin"}):z.categories.length>0||z.tags.length>0||z.searchQuery?a("list.notFound",{ns:"plugin"}):void 0,[A?.plugins.length,a,z.categories.length,z.tags.length,z.searchQuery]),[C,D]=(0,d.useState)([]);return(0,d.useEffect)(()=>{let b=[];l&&b.push({icon:r.MagicBox,text:a("source.marketplace",{ns:"plugin"}),action:"marketplace"}),x.restrict_to_marketplace_only||(b.push({icon:q.Github,text:a("source.github",{ns:"plugin"}),action:"github"}),b.push({icon:p.FileZip,text:a("source.local",{ns:"plugin"}),action:"local"})),D(b)},[x,l,a]),(0,b.jsxs)("div",{className:"relative z-0 w-full grow",children:[(0,b.jsx)("div",{className:"absolute top-0 z-10 grid h-full w-full grid-cols-2 gap-2 overflow-hidden px-12",children:Array.from({length:20}).fill(0).map((a,c)=>(0,b.jsx)("div",{className:"h-24 rounded-xl bg-components-card-bg"},c))}),(0,b.jsx)("div",{className:"absolute z-20 h-full w-full bg-gradient-to-b from-components-panel-bg-transparent to-components-panel-bg"}),(0,b.jsxs)("div",{className:"relative z-30 flex h-full items-center justify-center",children:[(0,b.jsxs)("div",{className:"flex flex-col items-center gap-y-3",children:[(0,b.jsxs)("div",{className:"relative -z-10 flex size-14 items-center justify-center rounded-xl border-[1px] border-dashed border-divider-deep bg-components-card-bg shadow-xl shadow-shadow-shadow-5",children:[(0,b.jsx)(o.Group,{className:"h-5 w-5 text-text-tertiary"}),(0,b.jsx)(w.default,{className:"absolute right-[-1px] top-1/2 -translate-y-1/2"}),(0,b.jsx)(w.default,{className:"absolute left-[-1px] top-1/2 -translate-y-1/2"}),(0,b.jsx)(w.default,{className:"absolute left-1/2 top-0 -translate-x-1/2 -translate-y-1/2 rotate-90"}),(0,b.jsx)(w.default,{className:"absolute left-1/2 top-full -translate-x-1/2 -translate-y-1/2 rotate-90"})]}),(0,b.jsx)("div",{className:"system-md-regular text-text-tertiary",children:B}),(0,b.jsxs)("div",{className:"flex w-[236px] flex-col",children:[(0,b.jsx)("input",{type:"file",ref:c,style:{display:"none"},onChange:a=>{let b=a.target.files?.[0];b&&(j(b),h("local"))},accept:u.SUPPORT_INSTALL_LOCAL_FILE_EXTENSIONS}),(0,b.jsx)("div",{className:"flex w-full flex-col gap-y-1",children:C.map(({icon:a,text:d,action:e})=>(0,b.jsxs)(f.default,{className:"justify-start gap-x-0.5 px-3",onClick:()=>{"local"===e?c.current?.click():"marketplace"===e?y("discover"):h(e)},children:[(0,b.jsx)(a,{className:"size-4"}),(0,b.jsx)("span",{className:"px-0.5",children:d})]},e))})]})]}),"github"===g&&(0,b.jsx)(s.default,{onSuccess:n.noop,onClose:()=>h(null)}),"local"===g&&i&&(0,b.jsx)(t.default,{file:i,onClose:()=>h(null),onSuccess:n.noop})]})]})};x.displayName="Empty";let y=d.memo(x);var z=a.i(429150),A=a.i(168799),B=a.i(816134),C=a.i(825319),D=a.i(527344),E=a.i(71905);let F=({value:a,onChange:c})=>{let{t:f}=(0,e.useTranslation)(),[g,h]=(0,d.useState)(!1),[i,j]=(0,d.useState)(""),{categories:k,categoriesMap:l}=(0,E.useCategories)(),m=k.filter(a=>a.name.toLowerCase().includes(i.toLowerCase())),n=a.length;return(0,b.jsxs)(C.PortalToFollowElem,{placement:"bottom-start",offset:{mainAxis:4},open:g,onOpenChange:h,children:[(0,b.jsx)(C.PortalToFollowElemTrigger,{onClick:()=>h(a=>!a),children:(0,b.jsxs)("div",{className:(0,D.cn)("flex h-8 cursor-pointer items-center rounded-lg bg-components-input-bg-normal px-2 py-1 text-text-tertiary hover:bg-state-base-hover-alt",n&&"text-text-secondary",g&&"bg-state-base-hover"),children:[(0,b.jsxs)("div",{className:(0,D.cn)("system-sm-medium flex items-center p-1"),children:[!n&&f("allCategories",{ns:"plugin"}),!!n&&a.map(a=>l[a].label).slice(0,2).join(","),n>2&&(0,b.jsxs)("div",{className:"system-xs-medium ml-1 text-text-tertiary",children:["+",n-2]})]}),!!n&&(0,b.jsx)(z.RiCloseCircleFill,{className:"h-4 w-4 cursor-pointer text-text-quaternary",onClick:a=>{a.stopPropagation(),c([])}}),!n&&(0,b.jsx)(z.RiArrowDownSLine,{className:"h-4 w-4"})]})}),(0,b.jsx)(C.PortalToFollowElemContent,{className:"z-10",children:(0,b.jsxs)("div",{className:"w-[240px] rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur shadow-lg backdrop-blur-sm",children:[(0,b.jsx)("div",{className:"p-2 pb-1",children:(0,b.jsx)(B.default,{showLeftIcon:!0,value:i,onChange:a=>j(a.target.value),placeholder:f("searchCategories",{ns:"plugin"})})}),(0,b.jsx)("div",{className:"max-h-[448px] overflow-y-auto p-1",children:m.map(d=>(0,b.jsxs)("div",{className:"flex h-7 cursor-pointer items-center rounded-lg px-2 py-1.5 hover:bg-state-base-hover",onClick:()=>{var b;return b=d.name,void(a.includes(b)?c(a.filter(a=>a!==b)):c([...a,b]))},children:[(0,b.jsx)(A.default,{className:"mr-1",checked:a.includes(d.name)}),(0,b.jsx)("div",{className:"system-sm-medium px-1 text-text-secondary",children:d.label})]},d.name))})]})})]})},G=({searchQuery:a,onChange:c})=>{let{t:d}=(0,e.useTranslation)();return(0,b.jsx)(B.default,{wrapperClassName:"flex w-[200px] items-center rounded-lg",className:"bg-components-input-bg-normal",showLeftIcon:!0,value:a,placeholder:d("search",{ns:"plugin"}),onChange:a=>{c(a.target.value)}})},H=({value:a,onChange:c})=>{let{t:f}=(0,e.useTranslation)(),[g,h]=(0,d.useState)(!1),[i,j]=(0,d.useState)(""),{tags:k,getTagLabel:l}=(0,E.useTags)(),m=k.filter(a=>a.name.toLowerCase().includes(i.toLowerCase())),n=a.length;return(0,b.jsxs)(C.PortalToFollowElem,{placement:"bottom-start",offset:{mainAxis:4},open:g,onOpenChange:h,children:[(0,b.jsx)(C.PortalToFollowElemTrigger,{onClick:()=>h(a=>!a),children:(0,b.jsxs)("div",{className:(0,D.cn)("flex h-8 cursor-pointer select-none items-center rounded-lg bg-components-input-bg-normal px-2 py-1 text-text-tertiary hover:bg-state-base-hover-alt",n&&"text-text-secondary",g&&"bg-state-base-hover"),children:[(0,b.jsxs)("div",{className:(0,D.cn)("system-sm-medium flex items-center p-1"),children:[!n&&f("allTags",{ns:"pluginTags"}),!!n&&a.map(a=>l(a)).slice(0,2).join(","),n>2&&(0,b.jsxs)("div",{className:"system-xs-medium ml-1 text-text-tertiary",children:["+",n-2]})]}),!!n&&(0,b.jsx)(z.RiCloseCircleFill,{className:"h-4 w-4 cursor-pointer text-text-quaternary",onClick:()=>c([])}),!n&&(0,b.jsx)(z.RiArrowDownSLine,{className:"h-4 w-4"})]})}),(0,b.jsx)(C.PortalToFollowElemContent,{className:"z-10",children:(0,b.jsxs)("div",{className:"w-[240px] rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur shadow-lg backdrop-blur-sm",children:[(0,b.jsx)("div",{className:"p-2 pb-1",children:(0,b.jsx)(B.default,{showLeftIcon:!0,value:i,onChange:a=>j(a.target.value),placeholder:f("searchTags",{ns:"pluginTags"})})}),(0,b.jsx)("div",{className:"max-h-[448px] overflow-y-auto p-1",children:m.map(d=>(0,b.jsxs)("div",{className:"flex h-7 cursor-pointer select-none items-center rounded-lg px-2 py-1.5 hover:bg-state-base-hover",onClick:()=>{var b;return b=d.name,void(a.includes(b)?c(a.filter(a=>a!==b)):c([...a,b]))},children:[(0,b.jsx)(A.default,{className:"mr-1",checked:a.includes(d.name)}),(0,b.jsx)("div",{className:"system-sm-medium px-1 text-text-secondary",children:d.label})]},d.name))})]})})]})},I=({onFilterChange:a})=>{let c=(0,m.usePluginPageContext)(a=>a.filters),[e,f]=(0,d.useState)(c),g=b=>{let c={...e,...b};f(c),a(c)};return(0,b.jsxs)("div",{className:"flex items-center gap-2 self-stretch",children:[(0,b.jsx)(F,{value:e.categories,onChange:a=>g({categories:a})}),(0,b.jsx)(H,{value:e.tags,onChange:a=>g({tags:a})}),(0,b.jsx)(G,{searchQuery:e.searchQuery,onChange:a=>g({searchQuery:a})})]})};var J=a.i(854868),K=a.i(483664),L=a.i(757014),M=a.i(705134),N=a.i(162807),O=a.i(730357),P=a.i(499257),Q=a.i(218865);a.i(916818);var R=a.i(784246),S=a.i(229190),T=a.i(547075),U=a.i(843990),V=a.i(28877),W=a.i(825503),X=a.i(497746),Y=a.i(114715),Z=a.i(29255),$=a.i(238387),_=a.i(175809),aa=a.i(42550),ab=a.i(875802),ac=a.i(728986);let ad="action",ae=d.memo(({author:a,installationId:c,pluginUniqueIdentifier:f,pluginName:g,category:h,isShowFetchNewVersion:i,isShowInfo:j,isShowDelete:m,onDelete:n,meta:o})=>{let{t:p}=(0,e.useTranslation)(),[q,{setTrue:r,setFalse:s}]=(0,X.useBoolean)(!1),[t,{setTrue:u,setFalse:v}]=(0,X.useBoolean)(!1),{checkForUpdates:w,fetchReleases:x}=(0,ab.useGitHubReleases)(),{setShowUpdatePluginModal:y}=(0,Z.useModalContext)(),A=(0,k.useInvalidateInstalledPluginList)(),B=async()=>{let b=o.repo.split("/")[0]||a,c=o.repo.split("/")[1]||g,d=await x(b,c);if(0===d.length)return;let{needUpdate:e,toastProps:i}=w(d,o.version);Y.default.notify(i),e&&y({onSaveCallback:()=>{A()},payload:{type:l.PluginSource.github,category:h,github:{originalPackageInfo:{id:f,repo:o.repo,version:o.version,package:o.package,releases:d}}}})},[C,{setTrue:D,setFalse:E}]=(0,X.useBoolean)(!1),F=(0,d.useCallback)(async()=>{u();try{(await (0,$.uninstallPlugin)(c)).success&&(E(),n())}catch(a){console.error("uninstallPlugin error",a)}finally{v()}},[c,n]);return(0,b.jsxs)("div",{className:"flex space-x-1",children:[i&&(0,b.jsx)(K.default,{popupContent:p(`${ad}.checkForUpdates`,{ns:"plugin"}),children:(0,b.jsx)(_.default,{onClick:B,children:(0,b.jsx)(z.RiLoopLeftLine,{className:"h-4 w-4 text-text-tertiary"})})}),j&&(0,b.jsx)(K.default,{popupContent:p(`${ad}.pluginInfo`,{ns:"plugin"}),children:(0,b.jsx)(_.default,{onClick:r,children:(0,b.jsx)(z.RiInformation2Line,{className:"h-4 w-4 text-text-tertiary"})})}),m&&(0,b.jsx)(K.default,{popupContent:p(`${ad}.delete`,{ns:"plugin"}),children:(0,b.jsx)(_.default,{className:"text-text-tertiary hover:bg-state-destructive-hover hover:text-text-destructive",onClick:D,children:(0,b.jsx)(z.RiDeleteBinLine,{className:"h-4 w-4"})})}),q&&(0,b.jsx)(ac.default,{repository:o.repo,release:o.version,packageName:o.package,onHide:s}),(0,b.jsx)(aa.default,{isShow:C,title:p(`${ad}.delete`,{ns:"plugin"}),content:(0,b.jsxs)("div",{children:[p(`${ad}.deleteContentLeft`,{ns:"plugin"}),(0,b.jsx)("span",{className:"system-md-semibold",children:g}),p(`${ad}.deleteContentRight`,{ns:"plugin"}),(0,b.jsx)("br",{})]}),onCancel:E,onConfirm:F,isLoading:t,isDisabled:t})]})}),af=d.memo(({className:a,plugin:c})=>{let{t:f}=(0,e.useTranslation)(),{theme:g}=(0,O.default)(),{categoriesMap:h}=(0,E.useCategories)(!0),i=(0,m.usePluginPageContext)(a=>a.currentPluginID),j=(0,m.usePluginPageContext)(a=>a.setCurrentPluginID),{refreshPluginList:k}=(0,L.default)(),{source:n,tenant_id:o,installation_id:p,plugin_unique_identifier:q,endpoints_active:r,meta:s,plugin_id:t,status:w,deprecated_reason:x}=c,{category:y,author:A,name:B,label:C,description:F,icon:G,icon_dark:H,verified:I,meta:X}=c.declaration,Y=(0,d.useMemo)(()=>[l.PluginSource.github,l.PluginSource.marketplace].includes(n)?A:"",[n,A]),{langGeniusVersionInfo:Z}=(0,M.useAppContext)(),$=(0,d.useMemo)(()=>!Z.current_version||(0,J.gte)(Z.current_version,X.minimum_dify_version??"0.0.0"),[X.minimum_dify_version,Z.current_version]),_=(0,d.useMemo)(()=>"deleted"===w&&!!x,[w,x]),aa=(0,d.useCallback)(()=>{k({category:y})},[y,k]),ab=(0,N.useRenderI18nObject)(),ac=ab(C),ad=ab(F),{enable_marketplace:af}=(0,v.useGlobalPublicStore)(a=>a.systemFeatures),ag="dark"===g&&H?H:G,ah=ag?ag.startsWith("http")?ag:`${u.API_PREFIX}/workspaces/current/plugin/icon?tenant_id=${o}&filename=${ag}`:"";return(0,b.jsxs)("div",{className:(0,D.cn)("relative overflow-hidden rounded-xl border-[1.5px] border-background-section-burn p-1",i===t&&"border-components-option-card-option-selected-border",n===l.PluginSource.debugging?"bg-[repeating-linear-gradient(-45deg,rgba(16,24,40,0.04),rgba(16,24,40,0.04)_5px,rgba(0,0,0,0.02)_5px,rgba(0,0,0,0.02)_10px)]":"bg-background-section-burn"),onClick:()=>{j(c.plugin_id)},children:[(0,b.jsxs)("div",{className:(0,D.cn)("hover-bg-components-panel-on-panel-item-bg relative z-10 rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-on-panel-item-bg p-4 pb-3 shadow-xs",a),children:[(0,b.jsx)(T.default,{text:h[y].label}),(0,b.jsxs)("div",{className:"flex",children:[(0,b.jsx)("div",{className:"flex h-10 w-10 items-center justify-center overflow-hidden rounded-xl border-[1px] border-components-panel-border-subtle",children:(0,b.jsx)("img",{className:"h-full w-full",src:ah,alt:`plugin-${q}-logo`})}),(0,b.jsxs)("div",{className:"ml-3 w-0 grow",children:[(0,b.jsxs)("div",{className:"flex h-5 items-center",children:[(0,b.jsx)(W.default,{title:ac}),I&&(0,b.jsx)(S.default,{className:"ml-0.5 h-4 w-4",text:f("marketplace.verifiedTip",{ns:"plugin"})}),!$&&(0,b.jsx)(K.default,{popupContent:f("difyVersionNotCompatible",{ns:"plugin",minimalDifyVersion:X.minimum_dify_version}),children:(0,b.jsx)(z.RiErrorWarningLine,{color:"red",className:"ml-0.5 h-4 w-4 shrink-0 text-text-accent"})}),(0,b.jsx)(Q.default,{className:"ml-1 shrink-0",text:n===l.PluginSource.github?c.meta.version:c.version,hasRedCornerMark:n===l.PluginSource.marketplace&&!!c.latest_version&&c.latest_version!==c.version})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(U.default,{text:ad,descriptionLineRows:1}),(0,b.jsx)("div",{onClick:a=>a.stopPropagation(),children:(0,b.jsx)(ae,{pluginUniqueIdentifier:q,installationId:p,author:A,pluginName:B,usedInApps:5,isShowFetchNewVersion:n===l.PluginSource.github,isShowInfo:n===l.PluginSource.github,isShowDelete:!0,meta:s,onDelete:aa,category:y})})]})]})]})]}),(0,b.jsxs)("div",{className:"mb-1 mt-1.5 flex h-4 items-center gap-x-2 px-4",children:[(0,b.jsxs)("div",{className:"flex grow items-center overflow-hidden",children:[(0,b.jsx)(V.default,{orgName:Y,packageName:B,packageNameClassName:"w-auto max-w-[150px]"}),y===l.PluginCategoryEnum.extension&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"system-xs-regular mx-2 text-text-quaternary",children:""}),(0,b.jsxs)("div",{className:"system-xs-regular flex items-center gap-x-1 overflow-hidden text-text-tertiary",children:[(0,b.jsx)(z.RiLoginCircleLine,{className:"size-3 shrink-0"}),(0,b.jsx)("span",{className:"truncate",title:f("endpointsEnabled",{ns:"plugin",num:r}),children:f("endpointsEnabled",{ns:"plugin",num:r})})]})]})]}),(0,b.jsxs)("div",{className:"flex shrink-0 items-center",children:[n===l.PluginSource.github&&(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)("a",{href:`https://github.com/${s.repo}`,target:"_blank",className:"flex items-center gap-1",children:[(0,b.jsx)("div",{className:"system-2xs-medium-uppercase text-text-tertiary",children:f("from",{ns:"plugin"})}),(0,b.jsxs)("div",{className:"flex items-center space-x-0.5 text-text-secondary",children:[(0,b.jsx)(R.Github,{className:"h-3 w-3"}),(0,b.jsx)("div",{className:"system-2xs-semibold-uppercase",children:"GitHub"}),(0,b.jsx)(z.RiArrowRightUpLine,{className:"h-3 w-3"})]})]})}),n===l.PluginSource.marketplace&&af&&(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)("a",{href:(0,P.getMarketplaceUrl)(`/plugins/${A}/${B}`,{theme:g}),target:"_blank",className:"flex items-center gap-0.5",children:[(0,b.jsxs)("div",{className:"system-2xs-medium-uppercase text-text-tertiary",children:[f("from",{ns:"plugin"})," ",(0,b.jsx)("span",{className:"text-text-secondary",children:"marketplace"})]}),(0,b.jsx)(z.RiArrowRightUpLine,{className:"h-3 w-3 text-text-secondary"})]})}),n===l.PluginSource.local&&(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(z.RiHardDrive3Line,{className:"h-3 w-3 text-text-tertiary"}),(0,b.jsx)("div",{className:"system-2xs-medium-uppercase text-text-tertiary",children:"Local Plugin"})]})}),n===l.PluginSource.debugging&&(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(z.RiBugLine,{className:"h-3 w-3 text-text-warning"}),(0,b.jsx)("div",{className:"system-2xs-medium-uppercase text-text-warning",children:"Debugging Plugin"})]})})]}),n===l.PluginSource.marketplace&&af&&_&&(0,b.jsxs)("div",{className:"system-2xs-medium-uppercase flex shrink-0 items-center gap-x-2",children:[(0,b.jsx)("span",{className:"text-text-tertiary",children:""}),(0,b.jsx)("span",{className:"text-text-warning",children:f("deprecated",{ns:"plugin"})})]})]}),n===l.PluginSource.marketplace&&af&&_&&(0,b.jsx)("div",{className:"absolute bottom-[-71px] right-[-45px] z-0 size-40 bg-components-badge-status-light-warning-halo opacity-60 blur-[120px]"})]})}),ag=({pluginList:a})=>(0,b.jsx)("div",{className:"pb-3",children:(0,b.jsx)("div",{className:"grid grid-cols-2 gap-3",children:a.map(a=>(0,b.jsx)(af,{plugin:a},a.plugin_id))})});a.s(["default",0,()=>{let{t:a}=(0,e.useTranslation)(),n=(0,i.useGetLanguage)(),o=(0,m.usePluginPageContext)(a=>a.filters),p=(0,m.usePluginPageContext)(a=>a.setFilters),{data:q,isLoading:r,isFetching:s,isLastPage:t,loadNextPage:u}=(0,k.useInstalledPluginList)(),{data:v}=(0,k.useInstalledLatestVersion)(q?.plugins.filter(a=>a.source===l.PluginSource.marketplace).map(a=>a.plugin_id)??[]),w=(0,k.useInvalidateInstalledPluginList)(),x=(0,m.usePluginPageContext)(a=>a.currentPluginID),z=(0,m.usePluginPageContext)(a=>a.setCurrentPluginID),{run:A}=(0,c.useDebounceFn)(a=>{p(a)},{wait:500}),B=(0,d.useMemo)(()=>q?.plugins.map(a=>({...a,latest_version:v?.versions[a.plugin_id]?.version??"",latest_unique_identifier:v?.versions[a.plugin_id]?.unique_identifier??"",status:v?.versions[a.plugin_id]?.status??"active",deprecated_reason:v?.versions[a.plugin_id]?.deprecated_reason??"",alternative_plugin_id:v?.versions[a.plugin_id]?.alternative_plugin_id??""}))||[],[q,v]),C=(0,d.useMemo)(()=>{let{categories:a,searchQuery:b,tags:c}=o;return B.filter(d=>(0===a.length||a.includes(d.declaration.category))&&(0===c.length||c.some(a=>d.declaration.tags.includes(a)))&&((a,b,c)=>{if(!b)return!0;let d=b.toLowerCase(),{declaration:e}=a;if(a.plugin_id.toLowerCase().includes(d)||a.name?.toLowerCase().includes(d)||e.name?.toLowerCase().includes(d))return!0;let f=(0,j.renderI18nObject)(e.label,c);if(f?.toLowerCase().includes(d))return!0;let g=(0,j.renderI18nObject)(e.description,c);return!!g?.toLowerCase().includes(d)})(d,b,n))},[B,o,n]),D=(0,d.useMemo)(()=>B.find(a=>a.plugin_id===x),[x,B]);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"flex flex-col items-start justify-center gap-3 self-stretch px-12 pb-3 pt-1",children:[(0,b.jsx)("div",{className:"h-px self-stretch bg-divider-subtle"}),(0,b.jsx)(I,{onFilterChange:A})]}),r&&(0,b.jsx)(g.default,{type:"app"}),!r&&(0,b.jsx)(b.Fragment,{children:(C?.length??0)>0?(0,b.jsxs)("div",{className:"flex grow flex-wrap content-start items-start justify-center gap-2 self-stretch overflow-y-auto px-12",children:[(0,b.jsx)("div",{className:"w-full",children:(0,b.jsx)(ag,{pluginList:C||[]})}),!t&&(0,b.jsx)("div",{className:"flex justify-center py-4",children:s?(0,b.jsx)(g.default,{className:"size-8"}):(0,b.jsx)(f.default,{onClick:u,children:a("common.loadMore",{ns:"workflow"})})})]}):(0,b.jsx)(y,{})}),(0,b.jsx)(h.default,{detail:D,onUpdate:()=>w(),onHide:()=>z(void 0)})]})}],516406)}];

//# sourceMappingURL=_4b830534._.js.map
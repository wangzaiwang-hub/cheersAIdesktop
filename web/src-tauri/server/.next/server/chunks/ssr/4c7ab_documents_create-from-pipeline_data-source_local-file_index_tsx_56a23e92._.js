module.exports=[726831,925415,712019,626039,640761,940233,a=>{"use strict";var b=a.i(608061),c=a.i(429150),d=a.i(494261),e=a.i(860653),f=a.i(57843);a.i(752298);var g=a.i(693025),h=a.i(639378),i=a.i(818386),j=a.i(114715),k=a.i(42521),l=a.i(18039),m=a.i(252813),n=a.i(730357),o=a.i(136403),p=a.i(41511),q=a.i(763539),r=a.i(954200),s=a.i(527344);a.s(["createDataSourceStore",()=>y,"useDataSourceStore",()=>A,"useDataSourceStoreWithSelector",()=>z],712019);var t=a.i(218050),u=a.i(282791);a.s(["DataSourceContext",()=>v,"default",()=>w],925415);let v=(0,f.createContext)(null),w=({children:a})=>{let c=(0,f.useRef)(null);return c.current||(c.current=y()),(0,b.jsx)(v.Provider,{value:c.current,children:a})};var x=a.i(986431);let y=()=>(0,t.createStore)((...a)=>({...(a=>({currentNodeIdRef:{current:""},currentCredentialId:"",setCurrentCredentialId:b=>{a({currentCredentialId:b})},currentCredentialIdRef:{current:""}}))(...a),...((a,b)=>({localFileList:[],setLocalFileList:c=>{a(()=>({localFileList:c}));let{previewLocalFileRef:d}=b();d.current=c[0]?.file},currentLocalFile:void 0,setCurrentLocalFile:b=>a(()=>({currentLocalFile:b})),previewLocalFileRef:{current:void 0}}))(...a),...((a,b)=>({documentsData:[],setDocumentsData:b=>a(()=>({documentsData:b})),searchValue:"",setSearchValue:b=>a(()=>({searchValue:b})),onlineDocuments:[],setOnlineDocuments:c=>{a(()=>({onlineDocuments:c}));let{previewOnlineDocumentRef:d}=b();d.current=c[0]},currentDocument:void 0,setCurrentDocument:b=>a(()=>({currentDocument:b})),selectedPagesId:new Set,setSelectedPagesId:b=>a(()=>({selectedPagesId:b})),previewOnlineDocumentRef:{current:void 0}}))(...a),...((a,b)=>({websitePages:[],setWebsitePages:c=>{a(()=>({websitePages:c}));let{previewWebsitePageRef:d}=b();d.current=c[0]},currentWebsite:void 0,setCurrentWebsite:b=>a(()=>({currentWebsite:b})),crawlResult:void 0,setCrawlResult:b=>a(()=>({crawlResult:b})),step:x.CrawlStep.init,setStep:b=>a(()=>({step:b})),previewIndex:-1,setPreviewIndex:b=>a(()=>({previewIndex:b})),previewWebsitePageRef:{current:void 0}}))(...a),...((a,b)=>({breadcrumbs:[],setBreadcrumbs:b=>a(()=>({breadcrumbs:b})),prefix:[],setPrefix:b=>a(()=>({prefix:b})),keywords:"",setKeywords:b=>a(()=>({keywords:b})),selectedFileIds:[],setSelectedFileIds:c=>{a(()=>({selectedFileIds:c}));let d=c[0],{onlineDriveFileList:e,previewOnlineDriveFileRef:f}=b();f.current=e.find(a=>a.id===d)},onlineDriveFileList:[],setOnlineDriveFileList:b=>a(()=>({onlineDriveFileList:b})),bucket:"",setBucket:b=>a(()=>({bucket:b})),nextPageParameters:{},currentNextPageParametersRef:{current:{}},setNextPageParameters:b=>a(()=>({nextPageParameters:b})),isTruncated:{current:!1},previewOnlineDriveFileRef:{current:void 0},hasBucket:!1,setHasBucket:b=>a(()=>({hasBucket:b}))}))(...a)})),z=a=>{let b=(0,f.useContext)(v);if(!b)throw Error("Missing DataSourceContext.Provider in the tree");return(0,u.useStore)(b,a)},A=()=>{let a=(0,f.useContext)(v);if(!a)throw Error("Missing DataSourceContext.Provider in the tree");return a},B=(0,e.default)(async()=>{},{loadableGenerated:{modules:[3871]},ssr:!1});a.s(["default",0,({allowedExtensions:a,supportBatchUpload:e=!0})=>{let{t}=(0,g.useTranslation)(),{notify:u}=(0,h.useContext)(j.ToastContext),v=(0,m.useLocale)(),w=z(a=>a.localFileList),x=A(),[y,C]=(0,f.useState)(!1),D=(0,f.useRef)(null),E=(0,f.useRef)(null),F=(0,f.useRef)(null),G=(0,f.useRef)([]),H=!e&&w.length>0,{data:I}=(0,q.useFileUploadConfig)(),J=(0,f.useMemo)(()=>{let b={md:"markdown",pptx:"pptx",htm:"html",xlsx:"xlsx",docx:"docx"};return a.map(a=>b[a]||a).map(a=>a.toLowerCase()).filter((a,b,c)=>c.indexOf(a)===b).map(a=>a.toUpperCase()).join(v!==o.LanguagesSupported[1]?", ":"、 ")},[v,a]),K=a.map(a=>`.${a}`),L=(0,f.useMemo)(()=>({file_size_limit:I?.file_size_limit??15,batch_count_limit:e?I?.batch_count_limit??5:1,file_upload_limit:e?I?.file_upload_limit??5:1}),[I,e]),M=(0,f.useCallback)((a,b,c)=>{let{setLocalFileList:e}=x.getState();e((0,d.produce)(c,c=>{let d=c.findIndex(b=>b.fileID===a.fileID);c[d]={...c[d],progress:b}}))},[x]),N=(0,f.useCallback)(a=>{let{setLocalFileList:b}=x.getState();b(a)},[x]),O=(0,f.useCallback)(a=>{let{setCurrentLocalFile:b}=x.getState();a.id&&b(a)},[x]),P=a=>{if(!a)return"";let b=a.name.split(".");return b[b.length-1]},Q=(0,f.useCallback)(a=>{let{size:b}=a,c=`.${P(a)}`,d=K.includes(c.toLowerCase());d||u({type:"error",message:t("stepOne.uploader.validation.typeError",{ns:"datasetCreation"})});let e=b<=1024*L.file_size_limit*1024;return e||u({type:"error",message:t("stepOne.uploader.validation.size",{ns:"datasetCreation",size:L.file_size_limit})}),d&&e},[u,t,K,L.file_size_limit]),R=(0,f.useCallback)(async a=>{let b=new FormData;return b.append("file",a.file),(0,p.upload)({xhr:new XMLHttpRequest,data:b,onprogress:b=>{b.lengthComputable&&M(a,Math.floor(b.loaded/b.total*100),G.current)}},!1,void 0,"?source=datasets").then(b=>{let c=Object.assign({},a.file,{id:b.id,...b}),d={fileID:a.fileID,file:c,progress:-1},e=G.current.findIndex(b=>b.fileID===a.fileID);return G.current[e]=d,M(d,100,G.current),Promise.resolve({...d})}).catch(b=>(u({type:"error",message:(0,i.getFileUploadErrorMessage)(b,t("stepOne.uploader.failed",{ns:"datasetCreation"}),t)}),M(a,-2,G.current),Promise.resolve({...a}))).finally()},[G,u,M,t]),S=(0,f.useCallback)(a=>(a.forEach(a=>a.progress=0),Promise.all(a.map(R))),[R]),T=(0,f.useCallback)(async a=>{let b=L.batch_count_limit,c=a.length,d=0,e=0;for(;d<c;){e=d+b>c?c:d+b;let f=a.slice(d,e);await S(f),d=e}},[L,S]),U=(0,f.useCallback)(a=>{let b=L.file_upload_limit;if(!a.length)return!1;if(a.length+w.length>b&&!l.IS_CE_EDITION)return u({type:"error",message:t("stepOne.uploader.validation.filesNumber",{ns:"datasetCreation",filesNumber:b})}),!1;let c=a.map((a,b)=>({fileID:`file${b}-${Date.now()}`,file:a,progress:-1})),d=[...G.current,...c];N(d),G.current=d,T(c)},[L.file_upload_limit,w.length,N,T,u,t]),V=a=>{a.preventDefault(),a.stopPropagation(),a.target!==E.current&&C(!0)},W=a=>{a.preventDefault(),a.stopPropagation()},X=a=>{a.preventDefault(),a.stopPropagation(),a.target===E.current&&C(!1)},Y=(0,f.useCallback)(a=>{if(a.preventDefault(),a.stopPropagation(),C(!1),!a.dataTransfer)return;let b=Array.from(a.dataTransfer.files);e||(b=b.slice(0,1)),U(b.filter(Q))},[U,Q,e]),Z=(0,f.useCallback)(()=>{F.current&&F.current.click()},[]),$=(0,f.useCallback)(a=>{let b=Array.from(a.target.files??[]);U((b=b.slice(0,L.batch_count_limit)).filter(Q))},[Q,U,L.batch_count_limit]),{theme:_}=(0,n.default)(),aa=(0,f.useMemo)(()=>_===r.Theme.dark?"#5289ff":"#296dff",[_]);return(0,f.useEffect)(()=>{let a=D.current;return a?.addEventListener("dragenter",V),a?.addEventListener("dragover",W),a?.addEventListener("dragleave",X),a?.addEventListener("drop",Y),()=>{a?.removeEventListener("dragenter",V),a?.removeEventListener("dragover",W),a?.removeEventListener("dragleave",X),a?.removeEventListener("drop",Y)}},[Y]),(0,b.jsxs)("div",{className:"flex flex-col",children:[!H&&(0,b.jsx)("input",{ref:F,id:"fileUploader",className:"hidden",type:"file",multiple:e,accept:K.join(","),onChange:$}),!H&&(0,b.jsxs)("div",{ref:D,className:(0,s.cn)("relative box-border flex min-h-20 flex-col items-center justify-center gap-1 rounded-xl border border-dashed border-components-dropzone-border bg-components-dropzone-bg px-4 py-3 text-xs leading-4 text-text-tertiary",y&&"border-components-dropzone-border-accent bg-components-dropzone-bg-accent"),children:[(0,b.jsxs)("div",{className:"flex min-h-5 items-center justify-center text-sm leading-4 text-text-secondary",children:[(0,b.jsx)(c.RiUploadCloud2Line,{className:"mr-2 size-5"}),(0,b.jsxs)("span",{children:[e?t("stepOne.uploader.button",{ns:"datasetCreation"}):t("stepOne.uploader.buttonSingleFile",{ns:"datasetCreation"}),a.length>0&&(0,b.jsx)("label",{className:"ml-1 cursor-pointer text-text-accent",onClick:Z,children:t("stepOne.uploader.browse",{ns:"datasetCreation"})})]})]}),(0,b.jsx)("div",{children:t("stepOne.uploader.tip",{ns:"datasetCreation",size:L.file_size_limit,supportTypes:J,batchCount:L.batch_count_limit,totalCount:L.file_upload_limit})}),y&&(0,b.jsx)("div",{ref:E,className:"absolute left-0 top-0 h-full w-full"})]}),w.length>0&&(0,b.jsx)("div",{className:"mt-1 flex flex-col gap-y-1",children:w.map((a,d)=>{var e;let f=a.progress>=0&&a.progress<100,g=-2===a.progress;return(0,b.jsxs)("div",{onClick:O.bind(null,a.file),className:(0,s.cn)("flex h-12 items-center rounded-lg border border-components-panel-border bg-components-panel-on-panel-item-bg shadow-xs shadow-shadow-shadow-4",g&&"border-state-destructive-border bg-state-destructive-hover"),children:[(0,b.jsx)("div",{className:"flex w-12 shrink-0 items-center justify-center",children:(0,b.jsx)(k.default,{size:"lg",className:"shrink-0",name:a.file.name,extension:P(a.file)})}),(0,b.jsxs)("div",{className:"flex shrink grow flex-col gap-0.5",children:[(0,b.jsx)("div",{className:"flex w-full",children:(0,b.jsx)("div",{className:"w-0 grow truncate text-xs text-text-secondary",children:a.file.name})}),(0,b.jsxs)("div",{className:"w-full truncate text-2xs leading-3 text-text-tertiary",children:[(0,b.jsx)("span",{className:"uppercase",children:P(a.file)}),(0,b.jsx)("span",{className:"px-1 text-text-quaternary",children:"·"}),(0,b.jsx)("span",{children:(e=a.file.size)/1024<10?`${(e/1024).toFixed(2)}KB`:`${(e/1024/1024).toFixed(2)}MB`})]})]}),(0,b.jsxs)("div",{className:"flex w-16 shrink-0 items-center justify-end gap-1 pr-3",children:[f&&(0,b.jsx)(B,{percentage:a.progress,stroke:aa,fill:aa,animationDuration:0}),g&&(0,b.jsx)(c.RiErrorWarningFill,{className:"size-4 text-text-destructive"}),(0,b.jsx)("span",{className:"flex h-6 w-6 cursor-pointer items-center justify-center",onClick:b=>{var c;b.stopPropagation(),c=a.fileID,F.current&&(F.current.value=""),G.current=G.current.filter(a=>a.fileID!==c),N([...G.current])},children:(0,b.jsx)(c.RiDeleteBinLine,{className:"size-4 text-text-tertiary"})})]})]},`${a.fileID}-${d}`)})})]})}],726831);var C=a.i(388206),D=a.i(105249),E=a.i(612757),F=a.i(933887),G=a.i(698636),H=a.i(29255),I=a.i(827460),J=a.i(234651),K=a.i(909795),L=a.i(757801),M=a.i(483664),N=a.i(497746),O=a.i(825319),P=a.i(313560);let Q=f.memo(({credential:a,isSelected:d,onCredentialChange:e})=>{let{avatar_url:g,name:h}=a,i=(0,f.useCallback)(()=>{e(a.id)},[a.id,e]);return(0,b.jsxs)("div",{className:"flex cursor-pointer items-center gap-x-2 rounded-lg p-2 hover:bg-state-base-hover",onClick:i,children:[(0,b.jsx)(P.CredentialIcon,{avatarUrl:g,name:h,size:20}),(0,b.jsx)("span",{className:"system-sm-medium grow truncate text-text-secondary",children:h}),d&&(0,b.jsx)(c.RiCheckLine,{className:"size-4 shrink-0 text-text-accent"})]})}),R=f.memo(({currentCredentialId:a,credentials:c,onCredentialChange:d})=>(0,b.jsx)("div",{className:"flex w-[280px] flex-col gap-y-1 rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur p-1 shadow-lg shadow-shadow-shadow-5 backdrop-blur-[5px]",children:c.map(c=>{let e=c.id===a;return(0,b.jsx)(Q,{credential:c,isSelected:e,onCredentialChange:d},c.id)})})),S=f.memo(({currentCredential:a,isOpen:d})=>{let{avatar_url:e,name:f=""}=a||{};return(0,b.jsxs)("div",{className:(0,s.cn)("flex cursor-pointer items-center gap-x-2 rounded-md p-1 pr-2",d?"bg-state-base-hover":"hover:bg-state-base-hover"),children:[(0,b.jsx)(P.CredentialIcon,{avatarUrl:e,name:f,size:20}),(0,b.jsxs)("div",{className:"flex grow items-center gap-x-1 overflow-hidden",children:[(0,b.jsx)("span",{className:"system-md-semibold grow truncate text-text-secondary",children:f}),(0,b.jsx)(c.RiArrowDownSLine,{className:"size-4 shrink-0 text-text-secondary"})]})]})}),T=f.memo(({currentCredentialId:a,onCredentialChange:c,credentials:d})=>{let[e,{toggle:g}]=(0,N.useBoolean)(!1),h=(0,f.useMemo)(()=>d.find(b=>b.id===a),[d,a]);(0,f.useEffect)(()=>{!h&&d.length&&c(d[0].id)},[h,d]);let i=(0,f.useCallback)(a=>{c(a),g()},[c,g]);return(0,b.jsxs)(O.PortalToFollowElem,{open:e,onOpenChange:g,placement:"bottom-start",offset:{mainAxis:4},children:[(0,b.jsx)(O.PortalToFollowElemTrigger,{onClick:g,className:"grow overflow-hidden",children:(0,b.jsx)(S,{currentCredential:h,isOpen:e})}),(0,b.jsx)(O.PortalToFollowElemContent,{className:"z-10",children:(0,b.jsx)(R,{currentCredentialId:a,credentials:d,onCredentialChange:i})})]})}),U=f.memo(({docTitle:a,docLink:d,onClickConfiguration:e,pluginName:f,...h})=>{let{t:i}=(0,g.useTranslation)();return(0,b.jsxs)("div",{className:"flex items-center justify-between gap-x-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-x-1 overflow-hidden",children:[(0,b.jsx)(T,{...h}),(0,b.jsx)(L.default,{type:"vertical",className:"mx-1 h-3.5 shrink-0"}),(0,b.jsx)(M.default,{popupContent:i("configurationTip",{ns:"datasetPipeline",pluginName:f}),position:"top",children:(0,b.jsx)(K.default,{variant:"ghost",size:"small",className:"size-6 shrink-0 px-1",children:(0,b.jsx)(c.RiEqualizer2Line,{className:"h-4 w-4",onClick:e})})})]}),(0,b.jsxs)("a",{className:"system-xs-medium flex shrink-0 items-center gap-x-1 text-text-accent",href:d,target:"_blank",rel:"noopener noreferrer",children:[(0,b.jsx)(c.RiBookOpenLine,{className:"size-3.5 shrink-0"}),(0,b.jsx)("span",{title:a,children:a})]})]})});var V=a.i(879859),W=a.i(168799),X=a.i(965442),Y=a.i(31736);let Z=f.memo(({index:a,style:d,data:e})=>{let{t:f}=(0,g.useTranslation)(),{dataList:h,handleToggle:i,checkedIds:j,disabledCheckedIds:k,handleCheck:l,canPreview:m,handlePreview:n,listMapWithChildrenAndDescendants:o,searchValue:p,previewPageId:q,pagesMap:r,isMultipleChoice:t}=e,u=h[a],v=o[u.page_id],w=v.descendants.size>0,x=v.ancestors,y=x.length?[...x,u.page_name]:[u.page_name],z=k.has(u.page_id);return(0,b.jsxs)("div",{className:(0,s.cn)("group flex cursor-pointer items-center rounded-md pl-2 pr-[2px] hover:bg-state-base-hover",q===u.page_id&&"bg-state-base-hover"),style:{...d,top:d.top+8,left:8,right:8,width:"calc(100% - 16px)"},children:[t?(0,b.jsx)(W.default,{className:"mr-2 shrink-0",checked:j.has(u.page_id),disabled:z,onCheck:()=>{l(a)}}):(0,b.jsx)(Y.default,{className:"mr-2 shrink-0",isChecked:j.has(u.page_id),disabled:z,onCheck:()=>{l(a)}}),!p&&(w?(0,b.jsx)("div",{className:"mr-1 flex h-5 w-5 shrink-0 items-center justify-center rounded-md hover:bg-components-button-ghost-bg-hover",style:{marginLeft:8*u.depth},onClick:()=>i(a),children:u.expand?(0,b.jsx)(c.RiArrowDownSLine,{className:"h-4 w-4 text-text-tertiary"}):(0,b.jsx)(c.RiArrowRightSLine,{className:"h-4 w-4 text-text-tertiary"})}):"root"!==u.parent_id&&r[u.parent_id]?(0,b.jsx)("div",{className:"mr-1 h-5 w-5 shrink-0",style:{marginLeft:8*u.depth}}):(0,b.jsx)("div",{})),(0,b.jsx)(X.default,{className:"mr-1 shrink-0",type:"page",src:u.page_icon}),(0,b.jsx)("div",{className:"grow truncate text-[13px] font-medium leading-4 text-text-secondary",title:u.page_name,children:u.page_name}),m&&(0,b.jsx)("div",{className:"ml-1 hidden h-6 shrink-0 cursor-pointer items-center rounded-md border-[0.5px] border-components-button-secondary-border bg-components-button-secondary-bg px-2 text-xs font-medium leading-4 text-components-button-secondary-text shadow-xs shadow-shadow-shadow-3 backdrop-blur-[10px] hover:border-components-button-secondary-border-hover hover:bg-components-button-secondary-bg-hover group-hover:flex",onClick:()=>n(a),children:f("dataSource.notion.selector.preview",{ns:"common"})}),p&&(0,b.jsx)("div",{className:"ml-1 max-w-[120px] shrink-0 truncate text-xs text-text-quaternary",title:y.join(" / "),children:y.join(" / ")})]})},V.areEqual),$=(a,b,c,d)=>{let e=c.parent_id,f=c.page_id;if(e&&f&&"root"!==e&&a[e]){if(b[e])b[e].children.add(f),b[e].descendants.add(f),b[e].descendants.add(d.page_id);else{let c=new Set([f]),g=new Set([f,d.page_id]);b[e]={...a[e],children:c,descendants:g,depth:0,ancestors:[]}}d.depth++,d.ancestors.unshift(b[e].page_name),"root"!==b[e].parent_id&&$(a,b,b[e],d)}},_=({checkedIds:a,disabledValue:c,searchValue:d,pagesMap:e,list:h,onSelect:i,canPreview:j=!0,onPreview:k,isMultipleChoice:l=!0,currentCredentialId:m})=>{let{t:n}=(0,g.useTranslation)(),[o,p]=(0,f.useState)([]),[q,r]=(0,f.useState)("");(0,f.useEffect)(()=>{p(h.filter(a=>"root"===a.parent_id||!e[a.parent_id]).map(a=>({...a,expand:!1,depth:0})))},[m]);let s=h.filter(a=>a.page_name.includes(d)).map(a=>({...a,expand:!1,depth:0})),t=d?s:o,u=(0,f.useMemo)(()=>h.reduce((a,b)=>{let c=b.page_id;return a[c]||(a[c]={...b,children:new Set,descendants:new Set,depth:0,ancestors:[]}),$(e,a,a[c],a[c]),a},{}),[h,e]),v=(0,f.useCallback)(a=>{let b=o[a],c=u[b.page_id],d=Array.from(c.descendants),f=Array.from(c.children),g=[];b.expand?(b.expand=!1,g=o.filter(a=>!d.includes(a.page_id))):(b.expand=!0,g=[...o.slice(0,a+1),...f.map(a=>({...e[a],expand:!1,depth:u[a].depth})),...o.slice(a+1)]),p(g)},[o,u,e]),w=(0,f.useCallback)(b=>{let c=new Set(a),e=t[b].page_id,f=u[e];if(c.has(e)){if(!d&&l)for(let a of f.descendants)c.delete(a);c.delete(e)}else{if(!d&&l)for(let a of f.descendants)c.add(a);!l&&c.size>0&&c.clear(),c.add(e)}i(new Set(c))},[t,l,u,i,d,a]),x=(0,f.useCallback)(a=>{let b=t[a].page_id;r(b),k&&k(b)},[t,k]);return t.length?(0,b.jsx)(V.FixedSizeList,{className:"py-2",height:296,itemCount:t.length,itemSize:28,width:"100%",itemKey:(a,b)=>b.dataList[a].page_id,itemData:{dataList:t,handleToggle:v,checkedIds:a,disabledCheckedIds:c,handleCheck:w,canPreview:j,handlePreview:x,listMapWithChildrenAndDescendants:u,searchValue:d,previewPageId:q,pagesMap:e,isMultipleChoice:l},children:Z}):(0,b.jsx)("div",{className:"flex h-[296px] items-center justify-center text-[13px] text-text-tertiary",children:n("dataSource.notion.selector.noSearchResult",{ns:"common"})})},aa=f.memo(({name:a})=>{let{t:c}=(0,g.useTranslation)();return(0,b.jsx)("div",{className:"system-sm-medium px-[5px] py-1 text-text-secondary",children:c("onlineDocument.pageSelectorTitle",{ns:"datasetPipeline",name:a})})});a.s(["default",0,({nodeId:a,nodeData:c,isInPipeline:d=!1,supportBatchUpload:e=!0,onCredentialChange:g})=>{let h=(0,m.useDocLink)(),i=(0,G.useDatasetDetailContextWithSelector)(a=>a.dataset?.pipeline_id),k=(0,H.useModalContextSelector)(a=>a.setShowAccountSettingModal),{documentsData:l,searchValue:n,selectedPagesId:o,currentCredentialId:q}=z((0,C.useShallow)(a=>({documentsData:a.documentsData,searchValue:a.searchValue,selectedPagesId:a.selectedPagesId,currentCredentialId:a.currentCredentialId}))),{data:r}=(0,J.useGetDataSourceAuth)({pluginId:c.plugin_id,provider:c.provider_name}),s=A(),t=(0,f.useMemo)(()=>(l||[]).reduce((a,b)=>(b.pages.forEach(c=>{a[c.page_id]={...c,workspace_id:b.workspace_id}}),a),{}),[l]),u=d?`/rag/pipelines/${i}/workflows/draft/datasource/nodes/${a}/run`:`/rag/pipelines/${i}/workflows/published/datasource/nodes/${a}/run`,v=(0,f.useCallback)(async()=>{let{currentCredentialId:a}=s.getState(),b=Object.entries(c.datasource_parameters||{}).reduce((a,[b,c])=>(a[b]="object"==typeof c&&null!==c&&"value"in c?c.value:c,a),{});(0,p.ssePost)(u,{body:{inputs:b,credential_id:a,datasource_type:I.DatasourceType.onlineDocument}},{onDataSourceNodeCompleted:a=>{let{setDocumentsData:b}=s.getState();b(a.data)},onDataSourceNodeError:a=>{j.default.notify({type:"error",message:a.error})}})},[s,u,c.datasource_parameters]);(0,f.useEffect)(()=>{q&&v()},[q]);let w=(0,f.useCallback)(a=>{let{setSearchValue:b}=s.getState();b(a)},[s]),x=(0,f.useCallback)(a=>{let{setSelectedPagesId:b,setOnlineDocuments:c}=s.getState(),d=Array.from(a).map(a=>t[a]);b(new Set(Array.from(a))),c(d)},[s,t]),y=(0,f.useCallback)(a=>{let{setCurrentDocument:b}=s.getState();b(t[a])},[t,s]),B=(0,f.useCallback)(()=>{k({payload:F.ACCOUNT_SETTING_TAB.DATA_SOURCE})},[k]);return(0,b.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,b.jsx)(U,{docTitle:"Docs",docLink:h("/use-dify/knowledge/knowledge-pipeline/authorize-data-source"),onClickConfiguration:B,pluginName:c.datasource_label,currentCredentialId:q,onCredentialChange:g,credentials:r?.result||[]}),(0,b.jsxs)("div",{className:"rounded-xl border border-components-panel-border bg-background-default-subtle",children:[(0,b.jsxs)("div",{className:"flex items-center gap-x-2 rounded-t-xl border-b border-b-divider-regular bg-components-panel-bg p-1 pl-3",children:[(0,b.jsx)("div",{className:"flex grow items-center",children:(0,b.jsx)(aa,{name:c.datasource_label})}),(0,b.jsx)(E.default,{value:n,onChange:w})]}),(0,b.jsx)("div",{className:"overflow-hidden rounded-b-xl",children:l?.length?(0,b.jsx)(_,{checkedIds:o,disabledValue:new Set,searchValue:n,list:l[0].pages||[],pagesMap:t,onSelect:x,canPreview:!d,onPreview:y,isMultipleChoice:e,currentCredentialId:q}):(0,b.jsx)("div",{className:"flex h-[296px] items-center justify-center",children:(0,b.jsx)(D.default,{type:"app"})})})]})]})}],626039);var ab=a.i(981133),ac=a.i(816134),ad=a.i(796807),ae=a.i(112785);let af=({ref:a,...c})=>(0,b.jsx)(ad.default,{...c,ref:a,data:ae.default});af.displayName="BucketsBlue";var ag=a.i(839789);let ah=({ref:a,...c})=>(0,b.jsx)(ad.default,{...c,ref:a,data:ag.default});ah.displayName="BucketsGray";var ai=a.i(791955);let aj=({ref:a,...c})=>(0,b.jsx)(ad.default,{...c,ref:a,data:ai.default});aj.displayName="Folder";let ak=f.memo(({bucketName:a,handleBackToBucketList:c,handleClickBucketName:d,disabled:e=!1,isActive:h=!1,showSeparator:i=!0})=>{let{t:j}=(0,g.useTranslation)(),k=(0,f.useCallback)(()=>{e||d()},[e,d]);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(M.default,{popupContent:j("onlineDrive.breadcrumbs.allBuckets",{ns:"datasetPipeline"}),children:(0,b.jsx)("button",{type:"button",className:"flex size-6 shrink-0 cursor-pointer items-center justify-center rounded-md hover:bg-state-base-hover",onClick:c,children:(0,b.jsx)(ah,{})})}),(0,b.jsx)("span",{className:"system-xs-regular text-divider-deep",children:"/"}),(0,b.jsx)("button",{type:"button",className:(0,s.cn)("max-w-full shrink truncate rounded-md px-[5px] py-1",h?"system-sm-medium text-text-secondary":"system-sm-regular text-text-tertiary",!e&&"hover:bg-state-base-hover"),disabled:e,onClick:k,title:a,children:a}),i&&(0,b.jsx)("span",{className:"system-xs-regular shrink-0 text-divider-deep",children:"/"})]})}),al=f.memo(({breadcrumbs:a,handleBackToRoot:c})=>{let{t:d}=(0,g.useTranslation)();return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("button",{type:"button",className:(0,s.cn)("max-w-full shrink truncate rounded-md px-[5px] py-1",a.length>0&&"system-sm-regular text-text-tertiary hover:bg-state-base-hover",0===a.length&&"system-sm-medium text-text-secondary"),onClick:c,disabled:0===a.length,children:d("onlineDrive.breadcrumbs.allFiles",{ns:"datasetPipeline"})}),a.length>0&&(0,b.jsx)("span",{className:"system-xs-regular text-divider-deep",children:"/"})]})}),am=f.memo(({name:a,index:c,onBreadcrumbClick:d})=>{let e=(0,f.useCallback)(()=>{d(c)},[c,d]);return(0,b.jsx)("div",{className:"system-md-regular rounded-lg px-3 py-1.5 text-text-secondary hover:bg-state-base-hover",onClick:e,children:a})}),an=f.memo(({breadcrumbs:a,startIndex:c,onBreadcrumbClick:d})=>(0,b.jsx)("div",{className:"flex w-[136px] flex-col rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur p-1 shadow-lg shadow-shadow-shadow-5 backdrop-blur-[5px]",children:a.map((a,e)=>(0,b.jsx)(am,{name:a,index:c+e,onBreadcrumbClick:d},`${a}-${e}`))})),ao=f.memo(({startIndex:a,breadcrumbs:d,onBreadcrumbClick:e})=>{let[g,h]=(0,f.useState)(!1),i=(0,f.useCallback)(()=>{h(a=>!a)},[]),j=(0,f.useCallback)(a=>{e(a),h(!1)},[e]);return(0,b.jsxs)(O.PortalToFollowElem,{open:g,onOpenChange:h,placement:"bottom-start",offset:{mainAxis:4,crossAxis:-13},children:[(0,b.jsx)(O.PortalToFollowElemTrigger,{onClick:i,children:(0,b.jsx)("button",{type:"button",className:(0,s.cn)("flex size-6 items-center justify-center rounded-md",g?"bg-state-base-hover":"hover:bg-state-base-hover"),children:(0,b.jsx)(c.RiMoreFill,{className:"size-4 text-text-tertiary"})})}),(0,b.jsx)(O.PortalToFollowElemContent,{className:"z-[11]",children:(0,b.jsx)(an,{breadcrumbs:d,startIndex:a,onBreadcrumbClick:j})}),(0,b.jsx)("span",{className:"system-xs-regular text-divider-deep",children:"/"})]})}),ap=({name:a,index:c,handleClick:d,disabled:e=!1,isActive:g=!1,showSeparator:h=!0})=>{let i=(0,f.useCallback)(()=>{e||d(c)},[e,d,c]);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("button",{type:"button",className:(0,s.cn)("max-w-full shrink truncate rounded-md px-[5px] py-1",g?"system-sm-medium text-text-secondary":"system-sm-regular text-text-tertiary",!e&&"hover:bg-state-base-hover"),disabled:e,onClick:i,title:a,children:a}),h&&(0,b.jsx)("span",{className:"system-xs-regular shrink-0 text-divider-deep",children:"/"})]})};ap.displayName="BreadcrumbItem";let aq=f.memo(ap),ar=f.memo(({breadcrumbs:a,keywords:c,bucket:d,searchResultsLength:e,isInPipeline:h})=>{let{t:i}=(0,g.useTranslation)(),j=A(),k=z(a=>a.hasBucket),l=!!c&&e>0,m=0===a.length&&k&&""===d,n=(0,f.useMemo)(()=>{let a=h?2:3;return d?a-1:a},[h,d]),o=(0,f.useMemo)(()=>{let b=a.slice(0,n-1),c=a.slice(n-1,a.length-1);return{original:a,needCollapsed:a.length>n,prefixBreadcrumbs:b,collapsedBreadcrumbs:c,lastBreadcrumb:a[a.length-1]}},[n,a]),p=(0,f.useCallback)(()=>{let{setOnlineDriveFileList:a,setSelectedFileIds:b,setBreadcrumbs:c,setPrefix:d,setBucket:e}=j.getState();a([]),b([]),e(""),c([]),d([])},[j]),q=(0,f.useCallback)(()=>{let{setOnlineDriveFileList:a,setSelectedFileIds:b,setBreadcrumbs:c,setPrefix:d}=j.getState();a([]),b([]),c([]),d([])},[j]),r=(0,f.useCallback)(()=>{let{setOnlineDriveFileList:a,setSelectedFileIds:b,setBreadcrumbs:c,setPrefix:d}=j.getState();a([]),b([]),c([]),d([])},[j]),s=(0,f.useCallback)(a=>{let{breadcrumbs:b,prefix:c,setOnlineDriveFileList:d,setSelectedFileIds:e,setBreadcrumbs:f,setPrefix:g}=j.getState(),h=b.slice(0,a+1),i=c.slice(0,a+1);d([]),e([]),f(h),g(i)},[j]);return(0,b.jsxs)("div",{className:"flex grow items-center overflow-hidden",children:[l&&(0,b.jsx)("div",{className:"system-sm-medium text-test-secondary px-[5px]",children:i("onlineDrive.breadcrumbs.searchResult",{ns:"datasetPipeline",searchResultsLength:e,folderName:a.length>0?a[a.length-1]:d})}),!l&&m&&(0,b.jsx)("div",{className:"system-sm-medium text-test-secondary px-[5px]",children:i("onlineDrive.breadcrumbs.allBuckets",{ns:"datasetPipeline"})}),!l&&!m&&(0,b.jsxs)("div",{className:"flex w-full items-center gap-x-0.5 overflow-hidden",children:[k&&d&&(0,b.jsx)(ak,{bucketName:d,handleBackToBucketList:p,handleClickBucketName:q,isActive:0===a.length,disabled:0===a.length,showSeparator:a.length>0}),!k&&(0,b.jsx)(al,{breadcrumbs:a,handleBackToRoot:r}),!o.needCollapsed&&(0,b.jsx)(b.Fragment,{children:o.original.map((a,c)=>{let d=c===o.original.length-1;return(0,b.jsx)(aq,{index:c,handleClick:s,name:a,isActive:d,showSeparator:!d,disabled:d},`${a}-${c}`)})}),o.needCollapsed&&(0,b.jsxs)(b.Fragment,{children:[o.prefixBreadcrumbs.map((a,c)=>(0,b.jsx)(aq,{index:c,handleClick:s,name:a},`${a}-${c}`)),(0,b.jsx)(ao,{startIndex:o.prefixBreadcrumbs.length,breadcrumbs:o.collapsedBreadcrumbs,onBreadcrumbClick:s}),(0,b.jsx)(aq,{index:a.length-1,handleClick:s,name:o.lastBreadcrumb,isActive:!0,disabled:!0,showSeparator:!1})]})]})]})}),as=f.memo(({breadcrumbs:a,inputValue:c,keywords:d,bucket:e,isInPipeline:f,searchResultsLength:h,handleInputChange:i,handleResetKeywords:j})=>{let{t:k}=(0,g.useTranslation)();return(0,b.jsxs)("div",{className:"flex items-center gap-x-2 bg-components-panel-bg p-1 pl-3",children:[(0,b.jsx)(ar,{breadcrumbs:a,keywords:d,bucket:e,searchResultsLength:h,isInPipeline:f}),(0,b.jsx)(ac.default,{value:c,onChange:i,onClear:j,placeholder:k("onlineDrive.breadcrumbs.searchPlaceholder",{ns:"datasetPipeline"}),showLeftIcon:!0,showClearIcon:!0,wrapperClassName:"w-[200px] h-8 shrink-0"})]})}),at=f.memo(()=>{let{t:a}=(0,g.useTranslation)();return(0,b.jsx)("div",{className:"flex size-full items-center justify-center rounded-[10px] bg-background-section px-1 py-1.5",children:(0,b.jsx)("span",{className:"system-xs-regular text-text-tertiary",children:a("onlineDrive.emptyFolder",{ns:"datasetPipeline"})})})});a.i(224256);var au=a.i(20111),au=au;let av=f.memo(({onResetKeywords:a})=>{let{t:c}=(0,g.useTranslation)();return(0,b.jsxs)("div",{className:"flex size-full flex-col items-center justify-center gap-y-2 rounded-[10px] bg-background-section p-6",children:[(0,b.jsx)(au.default,{className:"size-8 text-text-tertiary"}),(0,b.jsx)("div",{className:"system-sm-regular text-text-secondary",children:c("onlineDrive.emptySearchResult",{ns:"datasetPipeline"})}),(0,b.jsx)(K.default,{variant:"secondary-accent",size:"small",onClick:a,className:"px-1.5",children:(0,b.jsx)("span",{className:"px-[3px]",children:c("onlineDrive.resetKeywords",{ns:"datasetPipeline"})})})]})});var aw=a.i(573912),ax=a.i(780442),ay=a.i(210924);let az=f.memo(({type:a,fileName:c,size:d="md",className:e})=>{let g=(0,f.useMemo)(()=>a===I.OnlineDriveFileType.bucket||a===I.OnlineDriveFileType.folder?"custom":(0,ay.getFileType)(c),[a,c]);return a===I.OnlineDriveFileType.bucket?(0,b.jsx)(af,{className:(0,s.cn)("size-[18px]",e)}):a===I.OnlineDriveFileType.folder?(0,b.jsx)(aj,{className:(0,s.cn)("size-[18px]",e)}):(0,b.jsx)(ax.default,{size:d,type:g,className:(0,s.cn)("size-[18px]",e)})}),aA=f.memo(({file:a,isSelected:c,disabled:d=!1,isMultipleChoice:e=!0,onSelect:h,onOpen:i})=>{let{t:j}=(0,g.useTranslation)(),{id:k,name:l,type:m,size:n}=a,o="bucket"===m,p="folder"===m,q=d?M.default:f.Fragment,r=d?{popupContent:j("onlineDrive.notSupportedFileType",{ns:"datasetPipeline"}),position:"top-end",offset:{mainAxis:4,crossAxis:-104}}:{},t=(0,f.useCallback)(b=>{b.stopPropagation(),h(a)},[a,h]),u=(0,f.useCallback)(b=>{if(b.stopPropagation(),!d){if(o||p)return void i(a);h(a)}},[d,a,o,p,i,h]);return(0,b.jsxs)("div",{className:"flex cursor-pointer items-center gap-2 rounded-md px-2 py-[3px] hover:bg-state-base-hover",onClick:u,children:[!o&&e&&(0,b.jsx)(W.default,{className:"shrink-0",disabled:d,id:k,checked:c,onCheck:t}),!o&&!e&&(0,b.jsx)(Y.default,{className:"shrink-0",disabled:d,isChecked:c,onCheck:t}),(0,b.jsx)(q,{...r,children:(0,b.jsxs)("div",{className:(0,s.cn)("flex grow items-center gap-x-1 overflow-hidden py-0.5",d&&"opacity-30"),children:[(0,b.jsx)(az,{type:m,fileName:l,className:"shrink-0 transform-gpu"}),(0,b.jsx)("span",{className:"system-sm-medium grow truncate text-text-secondary",title:l,children:l}),!p&&"number"==typeof n&&(0,b.jsx)("span",{className:"system-xs-regular shrink-0 text-text-tertiary",children:(0,aw.formatFileSize)(n)})]})})]})}),aB=f.memo(({fileList:a,selectedFileIds:d,keywords:e,handleResetKeywords:h,handleSelectFile:i,handleOpenFolder:j,isLoading:k,supportBatchUpload:l})=>{let{t:m}=(0,g.useTranslation)(),n=(0,f.useRef)(null),o=(0,f.useRef)(null),p=A();(0,f.useEffect)(()=>(n.current&&(o.current=new IntersectionObserver(a=>{let{setNextPageParameters:b,currentNextPageParametersRef:c,isTruncated:d}=p.getState();a[0].isIntersecting&&d.current&&!k&&b(c.current)},{rootMargin:"100px"}),o.current.observe(n.current)),()=>o.current?.disconnect()),[n,k,p]);let q=k&&0===a.length&&0===e.length,r=k&&a.length>0,s=!k&&0===a.length&&0===e.length,t=!k&&0===a.length&&e.length>0;return(0,b.jsxs)("div",{className:"grow overflow-hidden p-1 pt-0",children:[q&&(0,b.jsx)(D.default,{type:"app"}),s&&(0,b.jsx)(at,{}),t&&(0,b.jsx)(av,{onResetKeywords:h}),a.length>0&&(0,b.jsxs)("div",{className:"flex h-full flex-col gap-y-px overflow-y-auto rounded-[10px] bg-background-section px-1 py-1.5",children:[a.map(a=>{let c=d.includes(a.id);return(0,b.jsx)(aA,{file:a,isSelected:c,onSelect:i,onOpen:j,isMultipleChoice:l},a.id)}),r&&(0,b.jsx)("div",{className:"flex items-center justify-center py-2",role:"status","aria-live":"polite","aria-label":m("loading",{ns:"appApi"}),children:(0,b.jsx)(c.RiLoader2Line,{className:"animation-spin size-4 text-text-tertiary"})}),(0,b.jsx)("div",{ref:n,className:"h-0"})]})]})}),aC=({fileList:a,selectedFileIds:c,breadcrumbs:d,keywords:e,bucket:g,resetKeywords:h,updateKeywords:i,searchResultsLength:j,handleSelectFile:k,handleOpenFolder:l,isInPipeline:m,isLoading:n,supportBatchUpload:o})=>{let[p,q]=(0,f.useState)(e),{run:r}=(0,ab.useDebounceFn)(a=>{i(a)},{wait:500}),s=()=>{q(""),h()};return(0,b.jsxs)("div",{className:"flex h-[400px] flex-col overflow-hidden rounded-xl border border-components-panel-border bg-components-panel-bg shadow-xs shadow-shadow-shadow-3",children:[(0,b.jsx)(as,{breadcrumbs:d,inputValue:p,keywords:e,bucket:g,isInPipeline:m,handleInputChange:a=>{let b=a.target.value;q(b),r(b)},searchResultsLength:j,handleResetKeywords:s}),(0,b.jsx)(aB,{fileList:a,selectedFileIds:c,keywords:e,handleResetKeywords:s,handleOpenFolder:l,handleSelectFile:k,isLoading:n,supportBatchUpload:o})]})};a.s(["default",0,({nodeId:a,nodeData:c,isInPipeline:e=!1,supportBatchUpload:g=!0,onCredentialChange:h})=>{let i=(0,m.useDocLink)(),[k,l]=(0,f.useState)(!0),n=(0,G.useDatasetDetailContextWithSelector)(a=>a.dataset?.pipeline_id),o=(0,H.useModalContextSelector)(a=>a.setShowAccountSettingModal),{nextPageParameters:q,breadcrumbs:r,prefix:s,keywords:t,bucket:u,selectedFileIds:v,onlineDriveFileList:w,currentCredentialId:x}=z((0,C.useShallow)(a=>({nextPageParameters:a.nextPageParameters,breadcrumbs:a.breadcrumbs,prefix:a.prefix,keywords:a.keywords,bucket:a.bucket,selectedFileIds:a.selectedFileIds,onlineDriveFileList:a.onlineDriveFileList,currentCredentialId:a.currentCredentialId}))),y=A(),[B,D]=(0,f.useState)(!1),E=(0,f.useRef)(!1),{data:K}=(0,J.useGetDataSourceAuth)({pluginId:c.plugin_id,provider:c.provider_name}),L=e?`/rag/pipelines/${n}/workflows/draft/datasource/nodes/${a}/run`:`/rag/pipelines/${n}/workflows/published/datasource/nodes/${a}/run`,M=(0,f.useCallback)(async()=>{if(E.current)return;let{nextPageParameters:a,prefix:b,bucket:c,onlineDriveFileList:d,currentCredentialId:e}=y.getState();D(!0),E.current=!0,(0,p.ssePost)(L,{body:{inputs:{prefix:b[b.length-1],bucket:c,next_page_parameters:a,max_keys:30},datasource_type:I.DatasourceType.onlineDrive,credential_id:e}},{onDataSourceNodeCompleted:a=>{let{setOnlineDriveFileList:b,isTruncated:e,currentNextPageParametersRef:f,setHasBucket:g}=y.getState(),{fileList:h,isTruncated:i,nextPageParameters:j,hasBucket:k}=((a,b,c)=>{let d=[],e=!1,f={},g=!1;return 0===a.length?{fileList:d,isTruncated:e,nextPageParameters:f,hasBucket:g}:(!c&&!(b.length>0)&&a.every(a=>!!a.bucket)&&(a.length>1||1===a.length&&a[0].bucket&&0===a[0].files.length)?(a.forEach(a=>{d.push({id:a.bucket,name:a.bucket,type:I.OnlineDriveFileType.bucket})}),g=!0):(a[0].files.forEach(a=>{let{id:b,name:c,size:e,type:f}=a,g="file"===f;d.push({id:b,name:c,size:g?e:void 0,type:g?I.OnlineDriveFileType.file:I.OnlineDriveFileType.folder})}),e=a[0].is_truncated??!1,f=a[0].next_page_parameters??{},g=!!a[0].bucket),{fileList:d,isTruncated:e,nextPageParameters:f,hasBucket:g})})(a.data,r,c);b([...d,...h]),e.current=i,f.current=j,g(k),D(!1),E.current=!1},onDataSourceNodeError:a=>{j.default.notify({type:"error",message:a.error}),D(!1),E.current=!1}})},[y,L,r]);(0,f.useEffect)(()=>{x&&(k?(0===w.length&&M(),l(!1)):M())},[q,s,u,x]);let N=(0,f.useMemo)(()=>t?w.filter(a=>a.name.toLowerCase().includes(t.toLowerCase())):w,[w,t]),O=(0,f.useCallback)(a=>{let{setKeywords:b}=y.getState();b(a)},[y]),P=(0,f.useCallback)(()=>{let{setKeywords:a}=y.getState();a("")},[y]),Q=(0,f.useCallback)(a=>{let{selectedFileIds:b,setSelectedFileIds:c}=y.getState();a.type===I.OnlineDriveFileType.bucket||c((0,d.produce)(b,b=>{if(b.includes(a.id)){let c=b.indexOf(a.id);b.splice(c,1)}else{if(!g&&b.length>=1)return;b.push(a.id)}}))},[y,g]),R=(0,f.useCallback)(a=>{let{breadcrumbs:b,prefix:c,setBreadcrumbs:e,setPrefix:f,setBucket:g,setOnlineDriveFileList:h,setSelectedFileIds:i}=y.getState();if(a.type!==I.OnlineDriveFileType.file)if(h([]),a.type===I.OnlineDriveFileType.bucket)g(a.name);else{i([]);let g=(0,d.produce)(b,b=>{b.push(a.name)}),h=(0,d.produce)(c,b=>{b.push(a.id)});e(g),f(h)}},[y]),S=(0,f.useCallback)(()=>{o({payload:F.ACCOUNT_SETTING_TAB.DATA_SOURCE})},[o]);return(0,b.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,b.jsx)(U,{docTitle:"Docs",docLink:i("/use-dify/knowledge/knowledge-pipeline/authorize-data-source"),onClickConfiguration:S,pluginName:c.datasource_label,currentCredentialId:x,onCredentialChange:h,credentials:K?.result||[]}),(0,b.jsx)(aC,{fileList:N,selectedFileIds:v,breadcrumbs:r,keywords:t,bucket:u,resetKeywords:P,updateKeywords:O,searchResultsLength:N.length,handleSelectFile:Q,handleOpenFolder:R,isInPipeline:e,isLoading:B,supportBatchUpload:g})]})}],640761);var aD=a.i(599656);let aE=f.memo(({className:a="",isChecked:c,onChange:d,label:e,labelClassName:f,tooltip:g})=>(0,b.jsxs)("label",{className:(0,s.cn)("flex items-center space-x-2",a),children:[(0,b.jsx)(W.default,{checked:c,onCheck:()=>d(!c)}),(0,b.jsx)("div",{className:(0,s.cn)("system-sm-medium text-text-secondary",f),children:e}),g&&(0,b.jsx)(M.default,{popupContent:(0,b.jsx)("div",{className:"w-[200px]",children:g}),triggerClassName:"ml-0.5 w-4 h-4"})]})),aF=f.memo(({payload:a,isChecked:c,onCheckChange:d,isPreview:e,onPreview:h,showPreview:i,isMultipleChoice:j=!0})=>{let{t:k}=(0,g.useTranslation)(),l=(0,f.useCallback)(()=>{d(!c)},[c,d]);return(0,b.jsxs)("div",{className:(0,s.cn)("relative flex cursor-pointer gap-x-2 rounded-lg p-2",e?"bg-state-base-active":"group hover:bg-state-base-hover"),children:[j?(0,b.jsx)(W.default,{className:"shrink-0",checked:c,onCheck:l}):(0,b.jsx)(Y.default,{className:"shrink-0",isChecked:c,onCheck:l}),(0,b.jsxs)("div",{className:"flex min-w-0 grow flex-col gap-y-0.5",children:[(0,b.jsx)("div",{className:"system-sm-medium truncate text-text-secondary",title:a.title,children:a.title}),(0,b.jsx)("div",{className:"system-xs-regular truncate text-text-tertiary",title:a.source_url,children:a.source_url})]}),i&&(0,b.jsx)(K.default,{size:"small",onClick:h,className:"system-xs-medium-uppercase right-2 top-2 hidden px-1.5 group-hover:absolute group-hover:block",children:k("stepOne.website.preview",{ns:"datasetCreation"})})]})}),aG="stepOne.website",aH=f.memo(({className:a="",previewIndex:c,list:d,checkedList:e,onSelectedChange:h,usedTime:i,onPreview:j,showPreview:k=!1,isMultipleChoice:l=!0})=>{let{t:m}=(0,g.useTranslation)(),n=e.length===d.length,o=(0,f.useCallback)(()=>{n?h([]):h(d)},[n,d,h]),p=(0,f.useCallback)(a=>b=>{b?l?h([...e,a]):h([a]):h(e.filter(b=>b.source_url!==a.source_url))},[e,h,l]),q=(0,f.useCallback)(a=>{j&&j(d[a],a)},[d,j]);return(0,b.jsxs)("div",{className:(0,s.cn)("flex flex-col gap-y-2",a),children:[(0,b.jsx)("div",{className:"system-sm-medium pt-2 text-text-primary",children:m(`${aG}.scrapTimeInfo`,{ns:"datasetCreation",total:d.length,time:i.toFixed(1)})}),(0,b.jsxs)("div",{className:"overflow-hidden rounded-xl border border-components-panel-border bg-components-panel-bg",children:[l&&(0,b.jsx)("div",{className:"flex items-center px-4 py-2",children:(0,b.jsx)(aE,{isChecked:n,onChange:o,label:m(n?`${aG}.resetAll`:`${aG}.selectAll`,{ns:"datasetCreation"})})}),(0,b.jsx)("div",{className:"flex flex-col gap-y-px border-t border-divider-subtle bg-background-default-subtle p-2",children:d.map((a,d)=>(0,b.jsx)(aF,{payload:a,isChecked:e.some(b=>b.source_url===a.source_url),onCheckChange:p(a),isPreview:d===c,onPreview:q.bind(null,d),showPreview:k,isMultipleChoice:l},a.source_url))})]})]})}),aI=f.memo(({className:a})=>(0,b.jsx)("div",{className:(0,s.cn)("bg-text-quaternary opacity-20",a)})),aJ=f.memo(({firstLineWidth:a,secondLineWidth:c})=>(0,b.jsxs)("div",{className:"flex gap-x-2 px-2 py-[5px]",children:[(0,b.jsx)("div",{className:"py-0.5",children:(0,b.jsx)(aI,{className:"size-4 rounded-[4px]"})}),(0,b.jsxs)("div",{className:"flex grow flex-col",children:[(0,b.jsx)("div",{className:"flex h-5 w-full items-center",children:(0,b.jsx)(aI,{className:(0,s.cn)("h-2.5 rounded-sm",a)})}),(0,b.jsx)("div",{className:"flex h-[18px] w-full items-center",children:(0,b.jsx)(aI,{className:(0,s.cn)("h-1.5 rounded-sm",c)})})]})]})),aK=f.memo(({className:a="",crawledNum:c,totalNum:d})=>{let{t:e}=(0,g.useTranslation)();return(0,b.jsxs)("div",{className:(0,s.cn)("mt-2 flex flex-col gap-y-2 pt-2",a),children:[(0,b.jsxs)("div",{className:"system-sm-medium text-text-primary",children:[e("stepOne.website.totalPageScraped",{ns:"datasetCreation"})," ",c,"/",d]}),(0,b.jsxs)("div",{className:"overflow-hidden rounded-xl border border-components-panel-border bg-components-panel-bg",children:[(0,b.jsxs)("div",{className:"flex items-center gap-x-2 px-4 py-2",children:[(0,b.jsx)(aI,{className:"size-4 rounded-[4px]"}),(0,b.jsx)(aI,{className:"h-2.5 w-14 rounded-sm"})]}),(0,b.jsx)("div",{className:"flex flex-col gap-px border-t border-divider-subtle bg-background-default-subtle p-2",children:[{firstLineWidth:"w-[35%]",secondLineWidth:"w-[50%]"},{firstLineWidth:"w-[40%]",secondLineWidth:"w-[45%]"},{firstLineWidth:"w-[30%]",secondLineWidth:"w-[36%]"}].map((a,c)=>(0,b.jsx)(aJ,{firstLineWidth:a.firstLineWidth,secondLineWidth:a.secondLineWidth},c))})]})]})}),aL=f.memo(({className:a,title:d,errorMsg:e})=>(0,b.jsxs)("div",{className:(0,s.cn)("flex gap-x-0.5 rounded-xl border-[0.5px] border-components-panel-border bg-opacity-40 bg-toast-error-bg p-2 shadow-xs shadow-shadow-shadow-3",a),children:[(0,b.jsx)("div",{className:"flex size-6 items-center justify-center",children:(0,b.jsx)(c.RiErrorWarningFill,{className:"h-4 w-4 text-text-destructive"})}),(0,b.jsxs)("div",{className:"flex flex-col gap-y-0.5 py-1",children:[(0,b.jsx)("div",{className:"system-xs-medium text-text-primary",children:d}),e&&(0,b.jsx)("div",{className:"system-xs-regular text-text-secondary",children:e})]})]}));var aM=a.i(433225),aN=a.i(306370),aO=a.i(518907);a.i(658335);var aP=a.i(586478),aQ=a.i(715674);let aR="stepOne.website",aS=({variables:a,step:d,runDisabled:e,onSubmit:h})=>{let{t:i}=(0,g.useTranslation)(),k=(0,aQ.useInitialData)(a),l=(0,aQ.useConfigurations)(a),m=(0,f.useMemo)(()=>(0,aO.generateZodSchema)(l),[l]),n=(0,aM.useAppForm)({defaultValues:k,validators:{onSubmit:({value:a})=>{let b=m.safeParse(a);if(!b.success){let a=b.error.issues[0],c=`"${a.path.join(".")}" ${a.message}`;return j.default.notify({type:"error",message:c}),c}}},onSubmit:({value:a})=>{h(a)}}),[o,{toggle:p,setTrue:q,setFalse:r}]=(0,N.useBoolean)(!1);(0,f.useEffect)(()=>{d!==x.CrawlStep.init?q():r()},[d]);let t=(0,f.useMemo)(()=>d===x.CrawlStep.running,[d]);return(0,b.jsxs)("form",{className:"w-full",onSubmit:a=>{a.preventDefault(),a.stopPropagation(),n.handleSubmit()},children:[(0,b.jsxs)("div",{className:"flex items-center gap-x-1 px-4 py-2",children:[(0,b.jsxs)("div",{className:"flex grow cursor-pointer select-none items-center gap-x-0.5",onClick:p,children:[(0,b.jsx)("span",{className:"system-sm-semibold-uppercase text-text-secondary",children:i(`${aR}.options`,{ns:"datasetCreation"})}),(0,b.jsx)(aP.ArrowDownRoundFill,{className:(0,s.cn)("h-4 w-4 shrink-0 text-text-quaternary",o&&"-rotate-90")})]}),(0,b.jsxs)(K.default,{variant:"primary",onClick:n.handleSubmit,disabled:e||t,loading:t,className:"shrink-0 gap-x-0.5",spinnerClassName:"!ml-0",children:[(0,b.jsx)(c.RiPlayLargeLine,{className:"size-4"}),(0,b.jsx)("span",{className:"px-0.5",children:i(t?`${aR}.running`:`${aR}.run`,{ns:"datasetCreation"})})]})]}),!o&&(0,b.jsx)("div",{className:"flex flex-col gap-3 border-t border-divider-subtle px-4 py-3",children:l.map((a,c)=>{let d=(0,aN.default)({initialData:k,config:a});return(0,b.jsx)(d,{form:n},c)})})]})},aT="stepOne.website",aU=f.memo(({nodeId:a,nodeData:c,isInPipeline:d=!1,supportBatchUpload:e=!0,onCredentialChange:h})=>{let{t:i}=(0,g.useTranslation)(),j=(0,m.useDocLink)(),[k,l]=(0,f.useState)(0),[n,o]=(0,f.useState)(0),[q,r]=(0,f.useState)(""),s=(0,G.useDatasetDetailContextWithSelector)(a=>a.dataset?.pipeline_id),t=(0,H.useModalContextSelector)(a=>a.setShowAccountSettingModal),{crawlResult:u,step:v,checkedCrawlResult:w,previewIndex:y,currentCredentialId:B}=z((0,C.useShallow)(a=>({crawlResult:a.crawlResult,step:a.step,checkedCrawlResult:a.websitePages,previewIndex:a.previewIndex,currentCredentialId:a.currentCredentialId}))),{data:D}=(0,J.useGetDataSourceAuth)({pluginId:c.plugin_id,provider:c.provider_name}),E=A(),{data:K,isFetching:L}=(0,f.useRef)(d?aD.useDraftPipelinePreProcessingParams:aD.usePublishedPipelinePreProcessingParams).current({pipeline_id:s,node_id:a},!!s&&!!a),M=v===x.CrawlStep.init,N=v===x.CrawlStep.finished,O=v===x.CrawlStep.running,P=N&&q,Q=d?`/rag/pipelines/${s}/workflows/draft/datasource/nodes/${a}/run`:`/rag/pipelines/${s}/workflows/published/datasource/nodes/${a}/run`,R=(0,f.useCallback)(a=>{let{setWebsitePages:b}=E.getState();b(a)},[E]),S=(0,f.useCallback)((a,b)=>{let{setCurrentWebsite:c,setPreviewIndex:d}=E.getState();c(a),d(b)},[E]),T=(0,f.useCallback)(async a=>{let{setStep:b,setCrawlResult:c,currentCredentialId:d}=E.getState();b(x.CrawlStep.running),(0,p.ssePost)(Q,{body:{inputs:a,datasource_type:I.DatasourceType.websiteCrawl,credential_id:d,response_mode:"streaming"}},{onDataSourceNodeProcessing:a=>{l(a.total??0),o(a.completed??0)},onDataSourceNodeCompleted:a=>{let{data:d,time_consuming:f}=a;c({data:d,time_consuming:f??0}),R(e?d:d.slice(0,1)),r(""),b(x.CrawlStep.finished)},onDataSourceNodeError:a=>{r(a.error||i(`${aT}.unknownError`,{ns:"datasetCreation"})),b(x.CrawlStep.finished)}})},[E,Q,R,e,i]),V=(0,f.useCallback)(a=>{T(a)},[T]),W=(0,f.useCallback)(()=>{t({payload:F.ACCOUNT_SETTING_TAB.DATA_SOURCE})},[t]),X=(0,f.useCallback)(a=>{o(0),l(0),r(""),h(a)},[h]);return(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)(U,{docTitle:"Docs",docLink:j("/use-dify/knowledge/knowledge-pipeline/authorize-data-source"),onClickConfiguration:W,pluginName:c.datasource_label,currentCredentialId:B,onCredentialChange:X,credentials:D?.result||[]}),(0,b.jsx)("div",{className:"mt-2 rounded-xl border border-components-panel-border bg-background-default-subtle",children:(0,b.jsx)(aS,{variables:K?.variables||[],step:v,runDisabled:!B||L,onSubmit:V})}),!M&&(0,b.jsxs)("div",{className:"relative flex flex-col",children:[O&&(0,b.jsx)(aK,{crawledNum:n,totalNum:k}),P&&(0,b.jsx)(aL,{className:"mt-2",title:i(`${aT}.exceptionErrorTitle`,{ns:"datasetCreation"}),errorMsg:q}),N&&!P&&(0,b.jsx)(aH,{className:"mt-2",list:u?.data||[],checkedList:w,onSelectedChange:R,usedTime:Number.parseFloat(u?.time_consuming)||0,previewIndex:y,onPreview:S,showPreview:!d,isMultipleChoice:e})]})]})});a.s(["default",0,aU],940233)}];

//# sourceMappingURL=4c7ab_documents_create-from-pipeline_data-source_local-file_index_tsx_56a23e92._.js.map
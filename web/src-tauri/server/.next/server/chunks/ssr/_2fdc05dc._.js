module.exports=[529638,557275,131399,521443,509681,547904,851571,412708,229017,251605,602024,301214,478874,926827,340455,595709,829781,35176,990693,583373,581117,192038,172106,894530,318952,862636,37606,622837,893463,505618,124677,380396,667756,858585,594916,737976,875474,471068,364573,621865,404740,412795,a=>{"use strict";a.s([],529638);var b=a.i(494261),c=a.i(57843),d=a.i(970502),e=a.i(243103),f=a.i(735310),g=a.i(802066);let h=()=>{let a=(0,d.useStoreApi)();return(0,c.useCallback)(async c=>{let d=e.useStore.getState().appDetail?.id;if(!d)return;let{getNodes:h}=a.getState(),i=h().find(a=>a.id===c);if(i&&i.data.type===f.BlockEnum.TriggerWebhook&&(!i.data.webhook_url||!(i.data.webhook_url.length>0)))try{let e=await (0,g.fetchWebhookUrl)({appId:d,nodeId:c}),{getNodes:h,setNodes:i}=a.getState(),j=!1,k=(0,b.produce)(h(),a=>{let b=a.find(a=>a.id===c);b&&b.data.type===f.BlockEnum.TriggerWebhook&&(b.data={...b.data,webhook_url:e.webhook_url,webhook_debug_url:e.webhook_debug_url},j=!0)});j&&i(k)}catch(a){console.error("Failed to auto-generate webhook URL:",a)}},[a])};a.s(["useAutoGenerateWebhookUrl",0,h],557275);var i=a.i(28959);a.s(["HooksStoreContext",()=>p,"HooksStoreContextProvider",()=>q],521443);var j=a.i(608061);a.s(["createHooksStore",()=>n,"useHooksStore",()=>o],131399);var k=a.i(111089),l=a.i(282791),m=a.i(218050);let n=({doSyncWorkflowDraft:a=async()=>(0,k.noop)(),syncWorkflowDraftWhenPageClose:b=k.noop,handleRefreshWorkflowDraft:c=k.noop,handleBackupDraft:d=k.noop,handleLoadBackupDraft:e=k.noop,handleRestoreFromPublishedWorkflow:f=k.noop,handleRun:g=k.noop,handleStopRun:h=k.noop,handleStartWorkflowRun:i=k.noop,handleWorkflowStartRunInWorkflow:j=k.noop,handleWorkflowStartRunInChatflow:l=k.noop,handleWorkflowTriggerScheduleRunInWorkflow:n=k.noop,handleWorkflowTriggerWebhookRunInWorkflow:o=k.noop,handleWorkflowTriggerPluginRunInWorkflow:p=k.noop,handleWorkflowRunAllTriggersInWorkflow:q=k.noop,availableNodesMetaData:r={nodes:[]},getWorkflowRunAndTraceUrl:s=()=>({runUrl:"",traceUrl:""}),exportCheck:t=async()=>(0,k.noop)(),handleExportDSL:u=async()=>(0,k.noop)(),fetchInspectVars:v=async()=>(0,k.noop)(),hasNodeInspectVars:w=()=>!1,hasSetInspectVar:x=()=>!1,fetchInspectVarValue:y=async()=>(0,k.noop)(),editInspectVarValue:z=async()=>(0,k.noop)(),renameInspectVarName:A=async()=>(0,k.noop)(),appendNodeInspectVars:B=()=>(0,k.noop)(),deleteInspectVar:C=async()=>(0,k.noop)(),deleteNodeInspectorVars:D=async()=>(0,k.noop)(),deleteAllInspectorVars:E=async()=>(0,k.noop)(),isInspectVarEdited:F=()=>!1,resetToLastRunVar:G=async()=>(0,k.noop)(),invalidateSysVarValues:H=k.noop,resetConversationVar:I=async()=>(0,k.noop)(),invalidateConversationVarValues:J=k.noop})=>(0,m.createStore)(k=>({refreshAll:a=>k(b=>({...b,...a})),doSyncWorkflowDraft:a,syncWorkflowDraftWhenPageClose:b,handleRefreshWorkflowDraft:c,handleBackupDraft:d,handleLoadBackupDraft:e,handleRestoreFromPublishedWorkflow:f,handleRun:g,handleStopRun:h,handleStartWorkflowRun:i,handleWorkflowStartRunInWorkflow:j,handleWorkflowStartRunInChatflow:l,handleWorkflowTriggerScheduleRunInWorkflow:n,handleWorkflowTriggerWebhookRunInWorkflow:o,handleWorkflowTriggerPluginRunInWorkflow:p,handleWorkflowRunAllTriggersInWorkflow:q,availableNodesMetaData:r,getWorkflowRunAndTraceUrl:s,exportCheck:t,handleExportDSL:u,fetchInspectVars:v,hasNodeInspectVars:w,hasSetInspectVar:x,fetchInspectVarValue:y,editInspectVarValue:z,renameInspectVarName:A,appendNodeInspectVars:B,deleteInspectVar:C,deleteNodeInspectorVars:D,deleteAllInspectorVars:E,isInspectVarEdited:F,resetToLastRunVar:G,invalidateSysVarValues:H,resetConversationVar:I,invalidateConversationVarValues:J}));function o(a){let b=(0,c.useContext)(p);if(!b)throw Error("Missing HooksStoreContext.Provider in the tree");return(0,l.useStore)(b,a)}let p=(0,c.createContext)(null),q=({children:a,...b})=>{let e=(0,c.useRef)(void 0),f=(0,d.useStore)(a=>a.d3Selection),g=(0,d.useStore)(a=>a.d3Zoom);return(0,c.useEffect)(()=>{e.current&&f&&g&&e.current.getState().refreshAll(b)},[f,g]),e.current||(e.current=n(b)),(0,j.jsx)(p.Provider,{value:e.current,children:a})};a.s([],509681),a.s([],412708),a.i(438890),a.s(["createWorkflowStore",()=>u,"useStore",()=>v,"useWorkflowStore",()=>w],851571),a.s(["WorkflowContext",()=>r,"WorkflowContextProvider",()=>s],547904);let r=(0,c.createContext)(null),s=({children:a,injectWorkflowStoreSliceFn:b})=>{let d=(0,c.useRef)(void 0);return d.current||(d.current=u({injectWorkflowStoreSliceFn:b})),(0,j.jsx)(r.Provider,{value:d.current,children:a})};var t=a.i(924270);let u=a=>{let{injectWorkflowStoreSliceFn:c}=a||{};return(0,m.createStore)((...a)=>({...(a=>{let b={showDebugAndPreviewPanel:!1,showEnvPanel:!1,showChatVariablePanel:!1,showGlobalVariablePanel:!1};return{showChatVariablePanel:!1,setShowChatVariablePanel:c=>a(()=>c?{...b,showChatVariablePanel:!0}:{showChatVariablePanel:!1}),showGlobalVariablePanel:!1,setShowGlobalVariablePanel:c=>a(()=>c?{...b,showGlobalVariablePanel:!0}:{showGlobalVariablePanel:!1}),conversationVariables:[],setConversationVariables:b=>a(()=>({conversationVariables:b}))}})(...a),...(a=>{let b={showDebugAndPreviewPanel:!1,showEnvPanel:!1,showChatVariablePanel:!1,showGlobalVariablePanel:!1};return{showEnvPanel:!1,setShowEnvPanel:c=>a(()=>c?{...b,showEnvPanel:!0}:{showEnvPanel:!1}),environmentVariables:[],setEnvironmentVariables:b=>a(()=>({environmentVariables:b})),envSecrets:{},setEnvSecrets:b=>a(()=>({envSecrets:b}))}})(...a),...(a=>({inputs:{},setInputs:b=>a(()=>({inputs:b})),files:[],setFiles:b=>a(()=>({files:b}))}))(...a),...(a=>({helpLineHorizontal:void 0,setHelpLineHorizontal:b=>a(()=>({helpLineHorizontal:b})),helpLineVertical:void 0,setHelpLineVertical:b=>a(()=>({helpLineVertical:b}))}))(...a),...(a=>({historyWorkflowData:void 0,setHistoryWorkflowData:b=>a(()=>({historyWorkflowData:b})),showRunHistory:!1,setShowRunHistory:b=>a(()=>({showRunHistory:b})),versionHistory:[],setVersionHistory:b=>a(()=>({versionHistory:b}))}))(...a),...(a=>({showSingleRunPanel:!1,setShowSingleRunPanel:b=>a(()=>({showSingleRunPanel:b})),nodeAnimation:!1,setNodeAnimation:b=>a(()=>({nodeAnimation:b})),candidateNode:void 0,setCandidateNode:b=>a(()=>({candidateNode:b})),nodeMenu:void 0,setNodeMenu:b=>a(()=>({nodeMenu:b})),showAssignVariablePopup:void 0,setShowAssignVariablePopup:b=>a(()=>({showAssignVariablePopup:b})),hoveringAssignVariableGroupId:void 0,setHoveringAssignVariableGroupId:b=>a(()=>({hoveringAssignVariableGroupId:b})),connectingNodePayload:void 0,setConnectingNodePayload:b=>a(()=>({connectingNodePayload:b})),enteringNodePayload:void 0,setEnteringNodePayload:b=>a(()=>({enteringNodePayload:b})),iterTimes:1,setIterTimes:b=>a(()=>({iterTimes:b})),loopTimes:1,setLoopTimes:b=>a(()=>({loopTimes:b})),iterParallelLogMap:new Map,setIterParallelLogMap:b=>a(()=>({iterParallelLogMap:b})),pendingSingleRun:void 0,setPendingSingleRun:b=>a(()=>({pendingSingleRun:b}))}))(...a),...(a=>({panelWidth:localStorage.getItem("workflow-node-panel-width")?Number.parseFloat(localStorage.getItem("workflow-node-panel-width")):420,showFeaturesPanel:!1,setShowFeaturesPanel:b=>a(()=>({showFeaturesPanel:b})),showWorkflowVersionHistoryPanel:!1,setShowWorkflowVersionHistoryPanel:b=>a(()=>({showWorkflowVersionHistoryPanel:b})),showInputsPanel:!1,setShowInputsPanel:b=>a(()=>({showInputsPanel:b})),showDebugAndPreviewPanel:!1,setShowDebugAndPreviewPanel:b=>a(()=>({showDebugAndPreviewPanel:b})),panelMenu:void 0,setPanelMenu:b=>a(()=>({panelMenu:b})),selectionMenu:void 0,setSelectionMenu:b=>a(()=>({selectionMenu:b})),showVariableInspectPanel:!1,setShowVariableInspectPanel:b=>a(()=>({showVariableInspectPanel:b})),initShowLastRunTab:!1,setInitShowLastRunTab:b=>a(()=>({initShowLastRunTab:b}))}))(...a),...(a=>({toolPublished:!1,setToolPublished:b=>a(()=>({toolPublished:b})),lastPublishedHasUserInput:!1,setLastPublishedHasUserInput:b=>a(()=>({lastPublishedHasUserInput:b})),buildInTools:void 0,customTools:void 0,workflowTools:void 0,mcpTools:void 0}))(...a),...(a=>({draftUpdatedAt:0,setDraftUpdatedAt:b=>a(()=>({draftUpdatedAt:b?1e3*b:0})),publishedAt:0,setPublishedAt:b=>a(()=>({publishedAt:b?1e3*b:0})),currentVersion:null,setCurrentVersion:b=>a(()=>({currentVersion:b})),isRestoring:!1,setIsRestoring:b=>a(()=>({isRestoring:b}))}))(...a),...(a=>{let b=(0,t.debounce)(a=>{a()},5e3);return{backupDraft:void 0,setBackupDraft:b=>a(()=>({backupDraft:b})),debouncedSyncWorkflowDraft:b,syncWorkflowDraftHash:"",setSyncWorkflowDraftHash:b=>a(()=>({syncWorkflowDraftHash:b})),isSyncingWorkflowDraft:!1,setIsSyncingWorkflowDraft:b=>a(()=>({isSyncingWorkflowDraft:b})),isWorkflowDataLoaded:!1,setIsWorkflowDataLoaded:b=>a(()=>({isWorkflowDataLoaded:b})),nodes:[],setNodes:b=>a(()=>({nodes:b})),flushPendingSync:()=>{b.flush&&b.flush()}}})(...a),...(a=>({workflowRunningData:void 0,setWorkflowRunningData:b=>a(()=>({workflowRunningData:b})),isListening:!1,setIsListening:b=>a(()=>({isListening:b})),listeningTriggerType:null,setListeningTriggerType:b=>a(()=>({listeningTriggerType:b})),listeningTriggerNodeId:null,setListeningTriggerNodeId:b=>a(()=>({listeningTriggerNodeId:b})),listeningTriggerNodeIds:[],setListeningTriggerNodeIds:b=>a(()=>({listeningTriggerNodeIds:b})),listeningTriggerIsAll:!1,setListeningTriggerIsAll:b=>a(()=>({listeningTriggerIsAll:b})),clipboardElements:[],setClipboardElements:b=>a(()=>({clipboardElements:b})),selection:null,setSelection:b=>a(()=>({selection:b})),bundleNodeSize:null,setBundleNodeSize:b=>a(()=>({bundleNodeSize:b})),controlMode:"pointer"===localStorage.getItem("workflow-operation-mode")?"pointer":"hand",setControlMode:b=>{a(()=>({controlMode:b})),localStorage.setItem("workflow-operation-mode",b)},mousePosition:{pageX:0,pageY:0,elementX:0,elementY:0},setMousePosition:b=>a(()=>({mousePosition:b})),showConfirm:void 0,setShowConfirm:b=>a(()=>({showConfirm:b})),controlPromptEditorRerenderKey:0,setControlPromptEditorRerenderKey:b=>a(()=>({controlPromptEditorRerenderKey:b})),showImportDSLModal:!1,setShowImportDSLModal:b=>a(()=>({showImportDSLModal:b})),fileUploadConfig:void 0,setFileUploadConfig:b=>a(()=>({fileUploadConfig:b}))}))(...a),...(a=>({currentFocusNodeId:null,nodesWithInspectVars:[],conversationVars:[],setCurrentFocusNodeId:b=>{a(()=>({currentFocusNodeId:b}))},setNodesWithInspectVars:b=>{a(()=>({nodesWithInspectVars:b}))},deleteAllInspectVars:()=>{a(()=>({nodesWithInspectVars:[]}))},setNodeInspectVars:(c,d)=>{a(a=>{let e=a.nodesWithInspectVars;return{nodesWithInspectVars:(0,b.produce)(e,a=>{let b=e.findIndex(a=>a.nodeId===c);-1!==b&&(a[b].vars=d,a[b].isValueFetched=!0)})}})},deleteNodeInspectVars:b=>{a(a=>({nodesWithInspectVars:a.nodesWithInspectVars.filter(a=>a.nodeId!==b)}))},setInspectVarValue:(c,d,e)=>{a(a=>({nodesWithInspectVars:(0,b.produce)(a.nodesWithInspectVars,a=>{let b=a.find(a=>a.nodeId===c);if(!b)return;let f=b.vars.find(a=>a.id===d);f&&(f.value=e,f.edited=!0)})}))},resetToLastRunVar:(c,d,e)=>{a(a=>({nodesWithInspectVars:(0,b.produce)(a.nodesWithInspectVars,a=>{let b=a.find(a=>a.nodeId===c);if(!b)return;let f=b.vars.find(a=>a.id===d);f&&(f.value=e,f.edited=!1)})}))},renameInspectVarName:(c,d,e)=>{a(a=>({nodesWithInspectVars:(0,b.produce)(a.nodesWithInspectVars,a=>{let b=a.find(a=>a.nodeId===c);if(!b)return;let f=b.vars.find(a=>a.id===d);f&&(f.name=e[1],f.selector=e)})}))},deleteInspectVar:(c,d)=>{a(a=>({nodesWithInspectVars:(0,b.produce)(a.nodesWithInspectVars,a=>{let b=a.find(a=>a.nodeId===c);if(!b)return;let e=b.vars.findIndex(a=>a.id===d);-1!==e&&b.vars.splice(e,1)})}))}}))(...a),...(a=>({workflowCanvasWidth:void 0,workflowCanvasHeight:void 0,setWorkflowCanvasWidth:b=>a(()=>({workflowCanvasWidth:b})),setWorkflowCanvasHeight:b=>a(()=>({workflowCanvasHeight:b})),rightPanelWidth:void 0,setRightPanelWidth:b=>a(()=>({rightPanelWidth:b})),nodePanelWidth:localStorage.getItem("workflow-node-panel-width")?Number.parseFloat(localStorage.getItem("workflow-node-panel-width")):400,setNodePanelWidth:b=>a(()=>({nodePanelWidth:b})),previewPanelWidth:localStorage.getItem("debug-and-preview-panel-width")?Number.parseFloat(localStorage.getItem("debug-and-preview-panel-width")):400,setPreviewPanelWidth:b=>a(()=>({previewPanelWidth:b})),otherPanelWidth:400,setOtherPanelWidth:b=>a(()=>({otherPanelWidth:b})),bottomPanelWidth:480,setBottomPanelWidth:b=>a(()=>({bottomPanelWidth:b})),bottomPanelHeight:324,setBottomPanelHeight:b=>a(()=>({bottomPanelHeight:b})),variableInspectPanelHeight:localStorage.getItem("workflow-variable-inpsect-panel-height")?Number.parseFloat(localStorage.getItem("workflow-variable-inpsect-panel-height")):320,setVariableInspectPanelHeight:b=>a(()=>({variableInspectPanelHeight:b})),maximizeCanvas:"true"===localStorage.getItem("workflow-canvas-maximize"),setMaximizeCanvas:b=>a(()=>({maximizeCanvas:b}))}))(...a),...c?.(...a)||{}}))};function v(a){let b=(0,c.useContext)(r);if(!b)throw Error("Missing WorkflowContext.Provider in the tree");return(0,l.useStore)(b,a)}let w=()=>(0,c.useContext)(r);var x=a.i(252813),y=a.i(844137),z=a.i(459858);let A=()=>{let a=o(a=>a.availableNodesMetaData);return(0,c.useMemo)(()=>({nodes:a?.nodes||[],nodesMap:a?.nodesMap||{}}),[a])};a.s(["useNodeMetaData",0,a=>{let b=(0,x.useGetLanguage)(),{data:d}=(0,y.useAllBuiltInTools)(),{data:e}=(0,y.useAllCustomTools)(),{data:g}=(0,y.useAllWorkflowTools)(),h=v(a=>a.dataSourceList),j=A(),{data:k}=a,l=j.nodesMap?.[k.type],m=(0,c.useMemo)(()=>k.type===f.BlockEnum.DataSource?h?.find(a=>a.plugin_id===k.plugin_id)?.author:k.type===f.BlockEnum.Tool?k.provider_type===i.CollectionType.builtIn?d?.find(a=>(0,z.canFindTool)(a.id,k.provider_id))?.author:k.provider_type===i.CollectionType.workflow?g?.find(a=>a.id===k.provider_id)?.author:e?.find(a=>a.id===k.provider_id)?.author:l?.metaData.author,[k,d,e,g,l,h]),n=(0,c.useMemo)(()=>k.type===f.BlockEnum.DataSource?h?.find(a=>a.plugin_id===k.plugin_id)?.description[b]:k.type===f.BlockEnum.Tool?k.provider_type===i.CollectionType.builtIn?d?.find(a=>(0,z.canFindTool)(a.id,k.provider_id))?.description[b]:k.provider_type===i.CollectionType.workflow?g?.find(a=>a.id===k.provider_id)?.description[b]:e?.find(a=>a.id===k.provider_id)?.description[b]:l?.metaData.description,[k,d,e,g,l,h,b]);return(0,c.useMemo)(()=>({...l?.metaData,author:m,description:n}),[m,l,n])},"useNodesMetaData",0,A],229017);let B=(a,b)=>(!b||a!==f.BlockEnum.Iteration&&a!==f.BlockEnum.Loop&&a!==f.BlockEnum.End&&a!==f.BlockEnum.DataSource&&a!==f.BlockEnum.KnowledgeBase)&&(!!b||a!==f.BlockEnum.LoopEnd)&&!0,C=(a,b)=>{let{nodes:d}=A(),e=(0,c.useMemo)(()=>d.map(a=>a.metaData.type),[d]),g=(0,c.useMemo)(()=>a&&a!==f.BlockEnum.Start&&a!==f.BlockEnum.DataSource&&a!==f.BlockEnum.TriggerPlugin&&a!==f.BlockEnum.TriggerWebhook&&a!==f.BlockEnum.TriggerSchedule?e:[],[e,a]),h=(0,c.useMemo)(()=>a&&a!==f.BlockEnum.End&&a!==f.BlockEnum.LoopEnd&&a!==f.BlockEnum.KnowledgeBase?e:[],[e,a]),i=(0,c.useCallback)((a,b)=>{let c=e;a&&a!==f.BlockEnum.Start&&a!==f.BlockEnum.DataSource||(c=[]);let d=e;return a&&a!==f.BlockEnum.End&&a!==f.BlockEnum.LoopEnd&&a!==f.BlockEnum.KnowledgeBase||(d=[]),{availablePrevBlocks:c.filter(a=>B(a,b)),availableNextBlocks:d.filter(a=>B(a,b))}},[e]);return(0,c.useMemo)(()=>({getAvailableBlocks:i,availablePrevBlocks:g.filter(a=>B(a,b)),availableNextBlocks:h.filter(a=>B(a,b))}),[i,g,h,b])};a.s(["useAvailableBlocks",0,C],251605),a.s(["useChecklist",()=>au,"useChecklistBeforePublish",()=>av,"useWorkflowRunValidation",()=>aw],990693),a.i(752298);var D=a.i(693025),E=a.i(114715),F=a.i(933988),G=a.i(701458);let H=()=>v(a=>a.nodes);a.s(["default",0,H],602024);var I=a.i(18039),J=a.i(218257),K=a.i(746077),L=a.i(970854),M=a.i(954200),N=a.i(252613);a.s(["createDatasetsDetailStore",()=>Q,"useDatasetsDetailStore",()=>R],478874),a.s(["DatasetsDetailContext",()=>O,"default",()=>P],301214);let O=(0,c.createContext)(void 0),P=({nodes:a,children:b})=>{let d=(0,c.useRef)(void 0);d.current||(d.current=Q());let e=(0,c.useCallback)(async a=>{let{data:b}=await (0,J.fetchDatasets)({url:"/datasets",params:{page:1,ids:a}});b&&b.length>0&&d.current.getState().updateDatasetsDetail(b)},[]);return(0,c.useEffect)(()=>{if(!d.current)return;let b=a.filter(a=>a.data.type===f.BlockEnum.KnowledgeRetrieval).reduce((a,b)=>Array.from(new Set([...a,...b.data.dataset_ids])),[]);0!==b.length&&e(b)},[]),(0,j.jsx)(O.Provider,{value:d.current,children:b})},Q=()=>(0,m.createStore)((a,c)=>({datasetsDetail:{},updateDatasetsDetail:d=>{let e=c().datasetsDetail,f=d.reduce((a,b)=>(a[b.id]=b,a),{});a({datasetsDetail:(0,b.produce)(e,a=>{Object.entries(f).forEach(([b,c])=>{a[b]=c})})})}})),R=a=>{let b=(0,c.useContext)(O);if(!b)throw Error("Missing DatasetsDetailContext.Provider in the tree");return(0,l.useStore)(b,a)};var S=a.i(730357);let T=a=>a.type===f.BlockEnum.TriggerPlugin,U=a=>a.type===f.BlockEnum.Tool,V=a=>a.type===f.BlockEnum.DataSource,W=(a,b,c)=>"dark"===a&&c?c:b,X=(a,b,c)=>{let d=b||[];for(let b of a){if(!b)continue;let a=d.find(a=>a.id===b||(0,z.canFindTool)(a.id,b));if(a)return W(c,a.icon,a.icon_dark)}},Y=()=>{let{data:a}=(0,y.useAllBuiltInTools)(),{data:b}=(0,y.useAllCustomTools)(),{data:d}=(0,y.useAllWorkflowTools)(),{data:e}=(0,y.useAllMCPTools)(),{data:f}=(0,L.useAllTriggerPlugins)(),g=w(),{theme:h}=(0,S.default)();return(0,c.useCallback)(c=>{let{buildInTools:j,customTools:k,workflowTools:l,mcpTools:m,dataSourceList:n}=g.getState();if(T(c))return X([c.plugin_id,c.provider_id,c.provider_name],f,h);if(U(c)){let f=[(()=>{switch(c.provider_type){case i.CollectionType.custom:return k??b;case i.CollectionType.mcp:return m??e;case i.CollectionType.workflow:return l??d;case i.CollectionType.builtIn:default:return j??a}})(),j??a,k??b,l??d,m??e],g=new Set;for(let a of f){if(!a||g.has(a))continue;g.add(a);let b=a.find(a=>!!(0,z.canFindTool)(a.id,c.provider_id)||!!c.plugin_id&&a.plugin_id===c.plugin_id||c.provider_name===a.name);if(b){let a=W(h,b.icon,b.icon_dark);if(a)return a}}let n=W(h,c.provider_icon,c.provider_icon_dark);return n||void 0}if(V(c))return n?.find(a=>a.plugin_id===c.plugin_id)?.icon},[g,f,a,b,d,e,h])};a.s(["useGetToolIcon",0,Y,"useToolIcon",0,a=>{let{data:b}=(0,y.useAllBuiltInTools)(),{data:d}=(0,y.useAllCustomTools)(),{data:e}=(0,y.useAllWorkflowTools)(),{data:f}=(0,y.useAllMCPTools)(),g=v(a=>a.dataSourceList),{data:h}=(0,L.useAllTriggerPlugins)(),{theme:j}=(0,S.default)();return(0,c.useMemo)(()=>{if(!a)return"";if(T(a)){let b=X([a.plugin_id,a.provider_id,a.provider_name],h,j);if(b)return b}if(U(a)){let c;switch(a.provider_type){case i.CollectionType.custom:c=d;break;case i.CollectionType.mcp:c=f;break;case i.CollectionType.workflow:c=e;break;case i.CollectionType.builtIn:default:c=b}let g=[c,b,d,e,f],h=new Set;for(let b of g){if(!b||h.has(b))continue;h.add(b);let c=b.find(b=>!!(0,z.canFindTool)(b.id,a.provider_id)||!!a.plugin_id&&b.plugin_id===a.plugin_id||a.provider_name===b.name);if(c){let a=W(j,c.icon,c.icon_dark);if(a)return a}}let k=W(j,a.provider_icon,a.provider_icon_dark);return k||""}return V(a)&&g?.find(b=>b.plugin_id===a.plugin_id)?.icon||""},[a,g,b,d,e,f,h,j])}],926827);var Z=a.i(986963);a.i(713310);var $=a.i(300371),_=a.i(997094),aa=a.i(381045);let ab=(a,b,c)=>{if(!b)return{triggerInputsSchema:[],isReadyForCheckValid:!1};let{provider_id:d,provider_name:e,event_name:f}=a,g=b.find(a=>a.name===e||a.id===d||d&&a.plugin_id===d),h=g?.events.find(a=>a.name===f);return{triggerInputsSchema:(h?.parameters||[]).map(a=>{let b=a.label?.[c]||a.label?.en_US||a.name;return{variable:a.name,label:b,required:a.required}}),isReadyForCheckValid:!0}};a.s(["getTriggerCheckParams",0,ab],340455),a.s(["useIsChatMode",()=>ai,"useIsNodeInIteration",()=>am,"useIsNodeInLoop",()=>an,"useNodesReadOnly",()=>al,"useWorkflow",()=>aj,"useWorkflowReadOnly",()=>ak],829781);var ac=a.i(20177),ad=a.i(700173),ae=a.i(778322),af=a.i(262717);function ag(a){let b=a.find(a=>(0,f.isTriggerNode)(a.data.type));return b||a.find(a=>a.data.type===f.BlockEnum.Start)}function ah(a){return a===f.BlockEnum.Start||(0,f.isTriggerNode)(a)}a.s(["getWorkflowEntryNode",()=>ag,"isWorkflowEntryNode",()=>ah],595709);let ai=()=>{let a=(0,e.useStore)(a=>a.appDetail);return a?.mode===M.AppModeEnum.ADVANCED_CHAT},aj=()=>{let a=(0,d.useStoreApi)(),{getAvailableBlocks:b}=C(),{nodesMap:e}=A(),f=(0,c.useCallback)(b=>{let{getNodes:c}=a.getState();return c().find(a=>a.id===b)},[a]),g=(0,c.useCallback)(b=>{let{getNodes:c,edges:f}=a.getState(),g=c(),h=g.find(a=>a.id===b),i=g.filter(a=>e?.[a.data.type]?.metaData.isStart)||[];if(h?.parentId){let a=g.find(a=>a.parentId===h.parentId&&(a.type===ad.CUSTOM_ITERATION_START_NODE||a.type===ae.CUSTOM_LOOP_START_NODE));a&&(i=[a])}if(!i.length)return[];let j=[],k=(a,c)=>{if(a.id===b)return;let e=(0,d.getOutgoers)(a,g,f);e.length?e.forEach(a=>{k(a,c)}):a.id!==b&&c(a)};i.forEach(a=>{k(a,a=>{j.push(a)})});let l=(0,d.getIncomers)({id:b},g,f);return j.push(...l),(0,ac.uniqBy)(j,"id").filter(a=>N.SUPPORT_OUTPUT_VARS_NODE.includes(a.data.type))},[a,e]),h=(0,c.useCallback)((b,c,e)=>{let{getNodes:f,edges:g}=a.getState(),i=c||f(),j=i.find(a=>a.id===b),k=[];if(!j)return k;if(j.parentId){let a=i.find(a=>a.id===j.parentId);if(a){let b=h(a.id);k.push(...b)}}let l=(a,b)=>{if(a){let c=(0,d.getIncomers)(a,i,e||g);c.length&&c.forEach(a=>{k.find(b=>a.id===b.id)||(b(a),l(a,b))})}};return(l(j,a=>{k.push(a)}),k.length)?(0,ac.uniqBy)(k,"id").reverse().filter(a=>N.SUPPORT_OUTPUT_VARS_NODE.includes(a.data.type)):[]},[a]),i=(0,c.useCallback)((b,c,d)=>{let e=h(b,c,d),{getNodes:f}=a.getState(),g=f(),i=g.find(a=>a.id===b),j=i?.parentId,k=g.find(a=>a.id===j);return k&&e.push(k),e},[h,a]),j=(0,c.useCallback)(b=>{let{getNodes:c,edges:e}=a.getState(),f=c(),g=f.find(a=>a.id===b);if(!g)return[];let h=[g],i=(a,b)=>{if(a){let c=(0,d.getOutgoers)(a,f,e);c.length&&c.forEach(a=>{b(a),i(a,b)})}};return i(g,a=>{h.push(a)}),(0,ac.uniqBy)(h,"id")},[a]),k=(0,c.useCallback)(b=>{let{getNodes:c,edges:e}=a.getState(),f=c(),g=f.find(a=>a.id===b);return(0,d.getIncomers)(g,f,e)},[a]),l=(0,c.useCallback)(b=>{let{getNodes:c}=a.getState();return c().filter(a=>a.parentId===b)},[a]),m=(0,c.useCallback)(b=>{let{getNodes:c}=a.getState();return c().filter(a=>a.parentId===b)},[a]),n=(0,c.useCallback)(b=>{let{getNodes:c}=a.getState(),d=c().find(a=>a.id===b);if(!d)return!1;if(ah(d.data.type))return!0;let e=a=>{for(let b of k(a.id))if(ah(b.data.type)||e(b))return!0;return!1};return e(d)},[a,k]),o=(0,c.useCallback)((b,c,d)=>{let{getNodes:e,setNodes:f}=a.getState(),g=e(),h=(0,Z.findUsedVarNodes)(c,g);h.length>0&&f(g.map(a=>h.find(b=>b.id===a.id)?(0,Z.updateNodeVars)(a,c,d):a))},[a]),p=(0,c.useCallback)(a=>{let b=j(a[0]);return(0,Z.findUsedVarNodes)(a,b).length>0},[j]),q=(0,c.useCallback)(b=>{let c=b[0],{getNodes:d,setNodes:e}=a.getState(),f=j(c),g=(0,Z.findUsedVarNodes)(b,f);g.length>0&&e(d().map(a=>g.find(b=>b.id===a.id)?(0,Z.updateNodeVars)(a,b,[]):a))},[j,a]),r=(0,c.useCallback)((a,b)=>(0,Z.getNodeOutputVars)(a,b).some(a=>p(a)),[p]),s=(0,c.useCallback)(b=>{let{getNodes:c,edges:e}=a.getState(),f=c(),g=f.find(a=>a.id===b),h=[];if(!g)return h;if(g.parentId){let a=f.find(a=>a.id===g.parentId);if(a){let b=s(a.id);h.push(...b)}}let i=(a,b)=>{if(a){let c=(0,d.getIncomers)(a,f,e);c.length?c.forEach(a=>{i(a,b)}):b(a)}};return(i(g,a=>{h.push(a)}),h.length)?(0,ac.uniqBy)(h,"id"):[]},[a]),t=(0,c.useCallback)((a,b)=>{let{id:c,parentId:d}=b||{},f=[];if(d){let b=a.find(a=>a.id===d);if(!b)throw Error("Parent node not found");let c=a.find(a=>a.id===b.data.start_node_id);c&&(f=[c])}else f=a.filter(a=>e?.[a.data.type]?.metaData.isStart)||[];return f.length||(f=s(c||"")),f},[e,s]);return{getNodeById:f,getTreeLeafNodes:g,getBeforeNodesInSameBranch:h,getBeforeNodesInSameBranchIncludeParent:i,getAfterNodesInSameBranch:j,handleOutVarRenameChange:o,isVarUsedInNodes:p,removeUsedVarInNodes:q,isNodeVarsUsedInNodes:r,isValidConnection:(0,c.useCallback)(({source:c,sourceHandle:e,target:f})=>{let{edges:g,getNodes:h}=a.getState(),i=h(),j=i.find(a=>a.id===c),k=i.find(a=>a.id===f);if(j.type===af.CUSTOM_NOTE_NODE||k.type===af.CUSTOM_NOTE_NODE||j.parentId!==k.parentId)return!1;if(j&&k){let a=b(j.data.type,!!j.parentId).availableNextBlocks,c=b(k.data.type,!!k.parentId).availablePrevBlocks;if(!a.includes(k.data.type)||!c.includes(j.data.type))return!1}let l=(a,b=new Set)=>{if(b.has(a.id))return!1;for(let e of(b.add(a.id),(0,d.getOutgoers)(a,i,g)))if(e.id===c||l(e,b))return!0};return!l(k)},[a,b]),getBeforeNodeById:k,getIterationNodeChildren:l,getLoopNodeChildren:m,getRootNodesById:s,getStartNodes:t,isFromStartNode:n,getNode:(0,c.useCallback)(b=>{let{getNodes:c}=a.getState(),d=c();return d.find(a=>a.id===b)||ag(d)},[a])}},ak=()=>{let a=w(),b=v(a=>a.workflowRunningData),d=(0,c.useCallback)(()=>a.getState().workflowRunningData?.result.status===f.WorkflowRunningStatus.Running,[a]);return{workflowReadOnly:b?.result.status===f.WorkflowRunningStatus.Running,getWorkflowReadOnly:d}},al=()=>{let a=w(),b=v(a=>a.workflowRunningData),d=v(a=>a.historyWorkflowData),e=v(a=>a.isRestoring),g=(0,c.useCallback)(()=>{let{workflowRunningData:b,historyWorkflowData:c,isRestoring:d}=a.getState();return!!(b?.result.status===f.WorkflowRunningStatus.Running||c||d)},[a]);return{nodesReadOnly:!!(b?.result.status===f.WorkflowRunningStatus.Running||d||e),getNodesReadOnly:g}},am=a=>{let b=(0,d.useStoreApi)();return{isNodeInIteration:(0,c.useCallback)(c=>{let{getNodes:d}=b.getState(),e=d().find(a=>a.id===c);return!!e&&e.parentId===a},[a,b])}},an=a=>{let b=(0,d.useStoreApi)();return{isNodeInLoop:(0,c.useCallback)(c=>{let{getNodes:d}=b.getState(),e=d().find(a=>a.id===c);return!!e&&e.parentId===a},[a,b])}};a.s(["useWorkflowVariableType",()=>aq,"useWorkflowVariables",()=>ap],35176);var ao=a.i(988526);let ap=()=>{let{t:a}=(0,D.useTranslation)(),b=w(),{schemaTypeDefinitions:d}=(0,ao.default)(),{data:e}=(0,y.useAllBuiltInTools)(),{data:f}=(0,y.useAllCustomTools)(),{data:g}=(0,y.useAllWorkflowTools)(),{data:h}=(0,y.useAllMCPTools)();return{getNodeAvailableVars:(0,c.useCallback)(({parentNode:c,beforeNodes:i,isChatMode:j,filterVar:k,hideEnv:l,hideChatVar:m})=>{let{conversationVariables:n,environmentVariables:o,ragPipelineVariables:p,dataSourceList:q}=b.getState();return(0,Z.toNodeAvailableVars)({parentNode:c,t:a,beforeNodes:i,isChatMode:j,environmentVariables:l?[]:o,conversationVariables:j&&!m?n:[],ragVariables:p,filterVar:k,allPluginInfoList:{buildInTools:e||[],customTools:f||[],workflowTools:g||[],mcpTools:h||[],dataSourceList:q||[]},schemaTypeDefinitions:d})},[a,b,d,e,f,g,h]),getCurrentVariableType:(0,c.useCallback)(({parentNode:a,valueSelector:c,isIterationItem:i,isLoopItem:j,availableNodes:k,isChatMode:l,isConstant:m,preferSchemaType:n})=>{let{conversationVariables:o,environmentVariables:p,ragPipelineVariables:q,dataSourceList:r}=b.getState();return(0,Z.getVarType)({parentNode:a,valueSelector:c,isIterationItem:i,isLoopItem:j,availableNodes:k,isChatMode:l,isConstant:m,environmentVariables:p,conversationVariables:o,ragVariables:q,allPluginInfoList:{buildInTools:e||[],customTools:f||[],workflowTools:g||[],mcpTools:h||[],dataSourceList:r??[]},schemaTypeDefinitions:d,preferSchemaType:n})},[b,Z.getVarType,d,e,f,g,h])}},aq=()=>{let{getNodes:a}=(0,d.useStoreApi)().getState(),{getCurrentVariableType:b}=ap(),c=ai();return({nodeId:d,valueSelector:e})=>{let f=a().find(a=>a.id===d);return b({parentNode:f?.data.isInIteration?a().find(a=>a.id===f.parentId):null,valueSelector:e,availableNodes:[f],isChatMode:c,isConstant:!1})}},ar=(a,b)=>{let c=b.find(b=>b.id===a),d=!!c?.data.isInIteration,e=!!c?.data.isInLoop,f=c?.parentId;return{node:c,isInIteration:d,isInLoop:e,parentNode:b.find(a=>a.id===f)}},as=[f.BlockEnum.Start,f.BlockEnum.TriggerSchedule,f.BlockEnum.TriggerWebhook,f.BlockEnum.TriggerPlugin],at=[f.BlockEnum.Tool,f.BlockEnum.DataSource,f.BlockEnum.TriggerPlugin],au=(a,b)=>{let{t:d}=(0,D.useTranslation)(),g=(0,x.useGetLanguage)(),{nodesMap:h}=A(),{data:i}=(0,y.useAllBuiltInTools)(),{data:j}=(0,y.useAllCustomTools)(),{data:k}=(0,y.useAllWorkflowTools)(),l=v(a=>a.dataSourceList),{data:m}=(0,K.useStrategyProviders)(),{data:n}=(0,L.useAllTriggerPlugins)(),o=R(a=>a.datasetsDetail),p=Y(),q=e.useStore.getState().appDetail?.mode,r=q===M.AppModeEnum.WORKFLOW||q===M.AppModeEnum.ADVANCED_CHAT,s=((a,{onlyLeafNodeVar:b,filterVar:c,hideEnv:d=!1,hideChatVar:e=!1,passedInAvailableNodes:g}={onlyLeafNodeVar:!1,filterVar:()=>!0})=>{let{getTreeLeafNodes:h,getBeforeNodesInSameBranchIncludeParent:i}=aj(),{getNodeAvailableVars:j}=ap(),k=ai(),l={};return a.forEach(m=>{let n=m.id,o=g||(b?h(n):i(n));m.data.type===f.BlockEnum.Loop&&o.push(m);let{parentNode:p}=ar(n,a),q=j({parentNode:p,beforeNodes:o,isChatMode:k,filterVar:c,hideEnv:d,hideChatVar:e});l[n]={node:m,availableVars:q,availableNodes:o}}),l})(a),{data:t}=(0,G.useModelList)(F.ModelTypeEnum.textEmbedding),{data:u}=(0,G.useModelList)(F.ModelTypeEnum.rerank),w=(0,c.useCallback)(a=>{let b=a;if(a.type===f.BlockEnum.KnowledgeRetrieval){let c=a.dataset_ids.reduce((a,b)=>(o[b]&&a.push(o[b]),a),[]);b={...a,_datasets:c}}else a.type===f.BlockEnum.KnowledgeBase&&(b={...a,_embeddingModelList:t,_rerankModelList:u});return b},[o,t,u]);return(0,c.useMemo)(()=>{let c=[],e=a.filter(a=>a.type===N.CUSTOM_NODE),{validNodes:o}=(0,aa.getValidTreeNodes)(e,b);for(let a=0;a<e.length;a++){let b,q=e[a],t=[];q.data.type===f.BlockEnum.Tool&&(b=(0,_.getToolCheckParams)(q.data,i||[],j||[],k||[],g)),q.data.type===f.BlockEnum.DataSource&&(b=(0,$.getDataSourceCheckParams)(q.data,l||[],g)),q.data.type===f.BlockEnum.TriggerPlugin&&(b=ab(q.data,n,g));let u=p(q.data);if(q.data.type===f.BlockEnum.Agent){let a=q.data,c=!!m,d=m?.find(b=>b.declaration.identity.name===a.agent_strategy_provider_name),e=d?.declaration.strategies?.find(b=>b.identity.name===a.agent_strategy_name);b={provider:d,strategy:e,language:g,isReadyForCheckValid:c}}else t=(0,Z.getNodeUsedVars)(q).filter(a=>a.length>0);if(q.type===N.CUSTOM_NODE){let a,e=w(q.data),f=h?.[q.data.type]?.checkValid,g=at.includes(q.data.type)&&q.data._pluginInstallLocked;if(g?a=d("nodes.common.pluginNotInstalled",{ns:"workflow"}):f&&(a=f(e,d,b).errorMessage),!a){let b=s[q.id].availableVars;for(let c of t)if(!(0,Z.isSpecialVar)(c[0])){let e=b.find(a=>a.nodeId===c?.[0]);e&&e.vars.find(a=>a.variable===c?.[1])||(a=d("errorMsg.invalidVariable",{ns:"workflow"}))}}let i=h?.[q.data.type]?.metaData.isStart??!1,j=!r||i,k=!o.find(a=>a.id===q.id);(a||k&&!j)&&c.push({id:q.id,type:q.data.type,title:q.data.title,toolIcon:u,unConnected:k&&!j,errorMessage:a,canNavigate:!g,disableGoTo:g})}}return r&&0===a.filter(a=>as.includes(a.data.type)).length&&c.push({id:"start-node-required",type:f.BlockEnum.Start,title:d("panel.startNode",{ns:"workflow"}),errorMessage:d("common.needStartNode",{ns:"workflow"}),canNavigate:!1}),Object.keys(h).filter(a=>h[a].metaData.isRequired).forEach(a=>{e.find(b=>b.data.type===a)||c.push({id:`${a}-need-added`,type:a,title:d(`blocks.${a}`,{ns:"workflow"}),errorMessage:d("common.needAdd",{ns:"workflow",node:d(`blocks.${a}`,{ns:"workflow"})}),canNavigate:!1})}),c},[a,h,b,i,j,k,g,l,p,m,w,d,s,r])},av=()=>{let{t:a}=(0,D.useTranslation)(),b=(0,x.useGetLanguage)(),{notify:g}=(0,E.useToastContext)(),h=(0,d.useStoreApi)(),{nodesMap:i}=A(),{data:j}=(0,K.useStrategyProviders)(),k=R(a=>a.updateDatasetsDetail),l=(0,c.useRef)(0),m=w(),{getNodesAvailableVarList:n}=(()=>{let{getTreeLeafNodes:a,getBeforeNodesInSameBranchIncludeParent:b}=aj(),{getNodeAvailableVars:d}=ap(),e=ai();return{getNodesAvailableVarList:(0,c.useCallback)((c,{onlyLeafNodeVar:g,filterVar:h,hideEnv:i,hideChatVar:j,passedInAvailableNodes:k}={onlyLeafNodeVar:!1,filterVar:()=>!0})=>{let l={};return c.forEach(m=>{let n=m.id,o=k||(g?a(n):b(n));m.data.type===f.BlockEnum.Loop&&o.push(m);let{parentNode:p}=ar(n,c),q=d({parentNode:p,beforeNodes:o,isChatMode:e,filterVar:h,hideEnv:i,hideChatVar:j});l[n]={node:m,availableVars:q,availableNodes:o}}),l},[a,b,d,e])}})(),{data:o}=(0,G.useModelList)(F.ModelTypeEnum.textEmbedding),{data:p}=(0,G.useModelList)(F.ModelTypeEnum.rerank),{data:q}=(0,y.useAllBuiltInTools)(),{data:r}=(0,y.useAllCustomTools)(),{data:s}=(0,y.useAllWorkflowTools)(),t=e.useStore.getState().appDetail?.mode,u=t===M.AppModeEnum.WORKFLOW||t===M.AppModeEnum.ADVANCED_CHAT,v=(0,c.useCallback)((a,b)=>{let c=a;if(a.type===f.BlockEnum.KnowledgeRetrieval){let d=a.dataset_ids,e=b.reduce((a,b)=>(a[b.id]=b,a),{}),f=d.reduce((a,b)=>(e[b]&&a.push(e[b]),a),[]);c={...a,_datasets:f}}else a.type===f.BlockEnum.KnowledgeBase&&(c={...a,_embeddingModelList:o,_rerankModelList:p});return c},[o,p]);return{handleCheckBeforePublish:(0,c.useCallback)(async()=>{let{getNodes:c,edges:d}=h.getState(),{dataSourceList:e}=m.getState(),o=c(),p=o.filter(a=>a.type===N.CUSTOM_NODE),{validNodes:t,maxDepth:w}=(0,aa.getValidTreeNodes)(p,d);if(w>I.MAX_TREE_DEPTH)return g({type:"error",message:a("common.maxTreeDepth",{ns:"workflow",depth:I.MAX_TREE_DEPTH})}),!1;let x=p.filter(a=>a.data.type===f.BlockEnum.KnowledgeRetrieval).reduce((a,b)=>Array.from(new Set([...a,...b.data.dataset_ids])),[]),y=[];if(x.length>0){l.current=l.current+1;let a=l.current,{data:b}=await (0,J.fetchDatasets)({url:"/datasets",params:{page:1,ids:x}});if(b&&b.length>0){if(a<l.current)return!1;y=b,k(b)}}let z=n(o);for(let c=0;c<p.length;c++){let d,h=p[c],k=[];if(h.data.type===f.BlockEnum.Tool&&(d=(0,_.getToolCheckParams)(h.data,q||[],r||[],s||[],b)),h.data.type===f.BlockEnum.DataSource&&(d=(0,$.getDataSourceCheckParams)(h.data,e||[],b)),h.data.type===f.BlockEnum.Agent){let a=h.data,c=!!j,e=j?.find(b=>b.declaration.identity.name===a.agent_strategy_provider_name),f=e?.declaration.strategies?.find(b=>b.identity.name===a.agent_strategy_name);d={provider:e,strategy:f,language:b,isReadyForCheckValid:c}}else k=(0,Z.getNodeUsedVars)(h).filter(a=>a.length>0);let l=v(h.data,y),{errorMessage:m}=i[h.data.type].checkValid(l,a,d);if(m)return g({type:"error",message:`[${h.data.title}] ${m}`}),!1;let n=z[h.id].availableVars;for(let b of k)if(!(0,Z.isSpecialVar)(b[0])){let c=n.find(a=>a.nodeId===b?.[0]);if(!c||!c.vars.find(a=>a.variable===b?.[1]))return g({type:"error",message:`[${h.data.title}] ${a("errorMsg.invalidVariable",{ns:"workflow"})}`}),!1}let o=i?.[h.data.type]?.metaData.isStart??!1,w=!u||o;if(!t.find(a=>a.id===h.id)&&!w)return g({type:"error",message:`[${h.data.title}] ${a("common.needConnectTip",{ns:"workflow"})}`}),!1}if(u&&0===o.filter(a=>as.includes(a.data.type)).length)return g({type:"error",message:a("common.needStartNode",{ns:"workflow"})}),!1;let A=Object.keys(i).filter(a=>i[a].metaData.isRequired);for(let b=0;b<A.length;b++){let c=A[b];if(!p.find(a=>a.data.type===c))return g({type:"error",message:a("common.needAdd",{ns:"workflow",node:a(`blocks.${c}`,{ns:"workflow"})})}),!1}return!0},[h,g,a,b,i,j,k,v,m,q,r,s,u])}},aw=()=>{let{t:a}=(0,D.useTranslation)(),b=au(H(),(0,d.useEdges)()),{notify:e}=(0,E.useToastContext)();return{validateBeforeRun:(0,c.useCallback)(()=>!(b.length>0)||(e({type:"error",message:a("panel.checklistTip",{ns:"workflow"})}),!1),[b,e,a]),hasValidationErrors:b.length>0,warningNodes:b}};a.s(["useDSL",0,()=>({exportCheck:o(a=>a.exportCheck),handleExportDSL:o(a=>a.handleExportDSL)})],583373),a.s(["useEdgesInteractions",()=>aG],894530),a.s(["useNodesSyncDraft",()=>ax],581117);let ax=()=>{let{getNodesReadOnly:a}=al(),b=v(a=>a.debouncedSyncWorkflowDraft),d=o(a=>a.doSyncWorkflowDraft),e=o(a=>a.syncWorkflowDraftWhenPageClose),f=(0,c.useCallback)((c,e,f)=>{a()||(c?d(e,f):b(d))},[b,d,a]);return{doSyncWorkflowDraft:d,handleSyncWorkflowDraft:f,syncWorkflowDraftWhenPageClose:e}};var ay=a.i(308225),az=(a,b,c)=>(d,e)=>({pastStates:c?.pastStates||[],futureStates:c?.futureStates||[],undo:(f=1)=>{if(e().pastStates.length){let g=c?.partialize?.(b())||b(),h=e().pastStates.splice(-f,f),i=h.shift();a(i),d({pastStates:e().pastStates,futureStates:e().futureStates.concat(c?.diff?.(g,i)||g,h.reverse())})}},redo:(f=1)=>{if(e().futureStates.length){let g=c?.partialize?.(b())||b(),h=e().futureStates.splice(-f,f),i=h.shift();a(i),d({pastStates:e().pastStates.concat(c?.diff?.(g,i)||g,h.reverse()),futureStates:e().futureStates})}},clear:()=>d({pastStates:[],futureStates:[]}),isTracking:!0,pause:()=>d({isTracking:!1}),resume:()=>d({isTracking:!0}),setOnSave:a=>d({_onSave:a}),_onSave:c?.onSave,_handleSet:(a,b,f,g)=>{c?.limit&&e().pastStates.length>=c?.limit&&e().pastStates.shift(),e()._onSave?.(a,f),d({pastStates:e().pastStates.concat(g||a),futureStates:[]})}});let aA=(0,c.createContext)({store:null,shortcutsEnabled:!0,setShortcutsEnabled:k.noop}),aB=aA.Provider;function aC({nodes:a,edges:b,children:d}){let[e,f]=(0,c.useState)(!0),[g]=(0,c.useState)(()=>(function({nodes:a,edges:b}){var c,d;return(0,l.create)((c=(c,d)=>({workflowHistoryEvent:void 0,workflowHistoryEventMeta:void 0,nodes:a,edges:b,getNodes:()=>d().nodes,setNodes:a=>c({nodes:a}),setEdges:a=>c({edges:a})}),d={equality:(a,b)=>(0,ay.default)(a,b)},(a,b,e)=>{e.temporal=(0,m.createStore)(d?.wrapTemporal?.(az(a,b,d))||az(a,b,d));let f=d?.handleSet?.(e.temporal.getState()._handleSet)||e.temporal.getState()._handleSet,g=a=>{if(!e.temporal.getState().isTracking)return;let c=d?.partialize?.(b())||b(),g=d?.diff?.(a,c);null===g||d?.equality?.(a,c)||f(a,void 0,c,g)},h=e.setState;return e.setState=(...a)=>{let c=d?.partialize?.(b())||b();h(...a),g(c)},c((...c)=>{let e=d?.partialize?.(b())||b();a(...c),g(e)},b,e)}))})({nodes:a,edges:b}));return(0,j.jsx)(aB,{value:{store:g,shortcutsEnabled:e,setShortcutsEnabled:f},children:d})}function aD(){let{store:a,shortcutsEnabled:b,setShortcutsEnabled:d}=(0,c.useContext)(aA);if(null===a)throw Error("useWorkflowHistoryStoreApi must be used within a WorkflowHistoryProvider");return{store:(0,c.useMemo)(()=>({getState:a.getState,setState:b=>{a.setState({workflowHistoryEvent:b.workflowHistoryEvent,workflowHistoryEventMeta:b.workflowHistoryEventMeta,nodes:b.nodes.map(a=>({...a,data:{...a.data,selected:!1}})),edges:b.edges.map(a=>({...a,selected:!1}))})},subscribe:a.subscribe,temporal:a.temporal}),[a]),shortcutsEnabled:b,setShortcutsEnabled:d}}a.s(["WorkflowHistoryProvider",()=>aC,"useWorkflowHistoryStore",()=>aD],192038);let aE={NodeTitleChange:"NodeTitleChange",NodeDescriptionChange:"NodeDescriptionChange",NodeDragStop:"NodeDragStop",NodeChange:"NodeChange",NodeConnect:"NodeConnect",NodePaste:"NodePaste",NodeDelete:"NodeDelete",EdgeDelete:"EdgeDelete",EdgeDeleteByDeleteBranch:"EdgeDeleteByDeleteBranch",NodeAdd:"NodeAdd",NodeResize:"NodeResize",NoteAdd:"NoteAdd",NoteChange:"NoteChange",NoteDelete:"NoteDelete",LayoutOrganize:"LayoutOrganize"},aF=()=>{let a=(0,d.useStoreApi)(),{store:b}=aD(),{t:e}=(0,D.useTranslation)(),[f,g]=(0,c.useState)([]),[h,i]=(0,c.useState)([]),j=(0,c.useCallback)(a=>(g(b=>[...b,a]),()=>g(b=>b.filter(b=>b!==a))),[]),k=(0,c.useCallback)(a=>(i(b=>[...b,a]),()=>i(b=>b.filter(b=>b!==a))),[]),l=(0,c.useCallback)(()=>{b.temporal.getState().undo(),f.forEach(a=>a())},[f,b.temporal]),m=(0,c.useCallback)(()=>{b.temporal.getState().redo(),h.forEach(a=>a())},[h,b.temporal]),n=(0,c.useRef)((0,t.debounce)((c,d)=>{b.setState({workflowHistoryEvent:c,workflowHistoryEventMeta:d,nodes:a.getState().getNodes(),edges:a.getState().edges})},500));return{store:b,saveStateToHistory:(0,c.useCallback)((a,b)=>{switch(a){case aE.NoteChange:case aE.NodeTitleChange:case aE.NodeDescriptionChange:case aE.NodeDragStop:case aE.NodeChange:case aE.NodeConnect:case aE.NodePaste:case aE.NodeDelete:case aE.EdgeDelete:case aE.EdgeDeleteByDeleteBranch:case aE.NodeAdd:case aE.NodeResize:case aE.NoteAdd:case aE.LayoutOrganize:case aE.NoteDelete:n.current(a,b)}},[]),getHistoryLabel:(0,c.useCallback)(a=>{switch(a){case aE.NodeTitleChange:return e("changeHistory.nodeTitleChange",{ns:"workflow"});case aE.NodeDescriptionChange:return e("changeHistory.nodeDescriptionChange",{ns:"workflow"});case aE.LayoutOrganize:case aE.NodeDragStop:return e("changeHistory.nodeDragStop",{ns:"workflow"});case aE.NodeChange:return e("changeHistory.nodeChange",{ns:"workflow"});case aE.NodeConnect:return e("changeHistory.nodeConnect",{ns:"workflow"});case aE.NodePaste:return e("changeHistory.nodePaste",{ns:"workflow"});case aE.NodeDelete:return e("changeHistory.nodeDelete",{ns:"workflow"});case aE.NodeAdd:return e("changeHistory.nodeAdd",{ns:"workflow"});case aE.EdgeDelete:case aE.EdgeDeleteByDeleteBranch:return e("changeHistory.edgeDelete",{ns:"workflow"});case aE.NodeResize:return e("changeHistory.nodeResize",{ns:"workflow"});case aE.NoteAdd:return e("changeHistory.noteAdd",{ns:"workflow"});case aE.NoteChange:return e("changeHistory.noteChange",{ns:"workflow"});case aE.NoteDelete:return e("changeHistory.noteDelete",{ns:"workflow"});default:return"Unknown Event"}},[e]),undo:l,redo:m,onUndo:j,onRedo:k}};a.s(["WorkflowHistoryEvent",0,aE,"useWorkflowHistory",0,aF],172106);let aG=()=>{let a=(0,d.useStoreApi)(),{handleSyncWorkflowDraft:e}=ax(),{getNodesReadOnly:f}=al(),{saveStateToHistory:g}=aF(),h=(0,c.useCallback)((c,d)=>{if(f())return;let{edges:e,setEdges:g}=a.getState();g((0,b.produce)(e,a=>{a.find(a=>a.id===d.id).data._hovering=!0}))},[a,f]),i=(0,c.useCallback)((c,d)=>{if(f())return;let{edges:e,setEdges:g}=a.getState();g((0,b.produce)(e,a=>{a.find(a=>a.id===d.id).data._hovering=!1}))},[a,f]),j=(0,c.useCallback)((c,d)=>{if(f())return;let{getNodes:h,setNodes:i,edges:j,setEdges:k}=a.getState(),l=j.filter(a=>a.source===c&&a.sourceHandle===d);if(!l.length)return;let m=h(),n=(0,aa.getNodesConnectedSourceOrTargetHandleIdsMap)(l.map(a=>({type:"remove",edge:a})),m);i((0,b.produce)(m,a=>{a.forEach(a=>{n[a.id]&&(a.data={...a.data,...n[a.id]})})})),k((0,b.produce)(j,a=>a.filter(a=>!l.find(b=>b.id===a.id)))),e(),g(aE.EdgeDeleteByDeleteBranch)},[f,a,e,g]);return{handleEdgeEnter:h,handleEdgeLeave:i,handleEdgeDeleteByDeleteBranch:j,handleEdgeDelete:(0,c.useCallback)(()=>{if(f())return;let{getNodes:c,setNodes:d,edges:h,setEdges:i}=a.getState(),j=h.findIndex(a=>a.selected);if(j<0)return;let k=h[j],l=c(),m=(0,aa.getNodesConnectedSourceOrTargetHandleIdsMap)([{type:"remove",edge:k}],l);d((0,b.produce)(l,a=>{a.forEach(a=>{m[a.id]&&(a.data={...a.data,...m[a.id]})})})),i((0,b.produce)(h,a=>{a.splice(j,1)})),e(),g(aE.EdgeDelete)},[f,a,e,g]),handleEdgesChange:(0,c.useCallback)(c=>{if(f())return;let{edges:d,setEdges:e}=a.getState();e((0,b.produce)(d,a=>{c.forEach(b=>{"select"===b.type&&(a.find(a=>a.id===b.id).selected=b.selected)})}))},[a,f])}};var aH=a.i(374715),aI=a.i(717138);let aJ=["query","files"],aK=()=>{let a=v(a=>a.nodesWithInspectVars),c=o(a=>a.configsMap),d=c?.flowType===aI.FlowType.ragPipeline,{data:e}=(0,aH.useConversationVarValues)(c?.flowType,d?"":c?.flowId),{data:g}=(0,aH.useSysVarValues)(c?.flowType,d?"":c?.flowId),{varsAppendStartNode:h,systemVars:i}=g?.length===0?{varsAppendStartNode:[],systemVars:[]}:{varsAppendStartNode:g?.filter(({name:a})=>aJ.includes(a))||[],systemVars:g?.filter(({name:a})=>!aJ.includes(a))||[]},j=a&&0!==a.length?(0,b.produce)(a,a=>{a.forEach(a=>{a.nodeType===f.BlockEnum.Start&&(a.vars=[...a.vars,...h])})}):[],k=o(a=>a.hasNodeInspectVars),l=o(a=>a.hasSetInspectVar),m=o(a=>a.fetchInspectVarValue),n=o(a=>a.editInspectVarValue),p=o(a=>a.renameInspectVarName),q=o(a=>a.appendNodeInspectVars),r=o(a=>a.deleteInspectVar),s=o(a=>a.deleteNodeInspectorVars),t=o(a=>a.deleteAllInspectorVars),u=o(a=>a.isInspectVarEdited),w=o(a=>a.resetToLastRunVar),x=o(a=>a.invalidateSysVarValues);return{conversationVars:e||[],systemVars:i||[],nodesWithInspectVars:j,hasNodeInspectVars:k,hasSetInspectVar:l,fetchInspectVarValue:m,editInspectVarValue:n,renameInspectVarName:p,appendNodeInspectVars:q,deleteInspectVar:r,deleteNodeInspectorVars:s,deleteAllInspectorVars:t,isInspectVarEdited:u,resetToLastRunVar:w,invalidateSysVarValues:x,resetConversationVar:o(a=>a.resetConversationVar),invalidateConversationVarValues:o(a=>a.invalidateConversationVarValues)}};a.s(["default",0,aK],318952),a.s(["useNodeDataUpdate",()=>aL],862636);let aL=()=>{let a=(0,d.useStoreApi)(),{handleSyncWorkflowDraft:e}=ax(),{getNodesReadOnly:f}=al(),g=(0,c.useCallback)(({id:c,data:d})=>{let{getNodes:e,setNodes:f}=a.getState();f((0,b.produce)(e(),a=>{let b=a.find(a=>a.id===c);b&&(b.data={...b.data,...d})}))},[a]),h=(0,c.useCallback)((a,b)=>{f()||(g(a),e(b?.sync,b?.notRefreshWhenSyncError,b?.callback))},[e,g,f]);return{handleNodeDataUpdate:g,handleNodeDataUpdateWithSyncDraft:h}};a.s(["useNodesInteractions",()=>aP],893463),a.s(["useNodeIterationInteractions",()=>aN],37606);var aM=a.i(363444);let aN=()=>{let{t:a}=(0,D.useTranslation)(),e=(0,d.useStoreApi)(),{nodesMap:f}=A(),g=(0,c.useCallback)(a=>{let c,d,{getNodes:f,setNodes:g}=e.getState(),h=f(),i=h.find(b=>b.id===a);h.filter(b=>b.parentId===a).forEach(a=>{c?a.position.x+a.width>c.position.x+c.width&&(c=a):c=a,d?a.position.y+a.height>d.position.y+d.height&&(d=a):d=a});let j=c&&i.width<c.position.x+c.width,k=d&&i.height<d.position.y+d.height;(j||k)&&g((0,b.produce)(h,b=>{b.forEach(b=>{b.id===a&&(j&&(b.data.width=c.position.x+c.width+N.ITERATION_PADDING.right,b.width=c.position.x+c.width+N.ITERATION_PADDING.right),k&&(b.data.height=d.position.y+d.height+N.ITERATION_PADDING.bottom,b.height=d.position.y+d.height+N.ITERATION_PADDING.bottom))})}))},[e]),h=(0,c.useCallback)(a=>{let{getNodes:b}=e.getState(),c=b(),d={x:void 0,y:void 0};if(a.data.isInIteration){let b=c.find(b=>b.id===a.parentId);b&&(a.position.y<N.ITERATION_PADDING.top&&(d.y=N.ITERATION_PADDING.top),a.position.x<N.ITERATION_PADDING.left&&(d.x=N.ITERATION_PADDING.left),a.position.x+a.width>b.width-N.ITERATION_PADDING.right&&(d.x=b.width-N.ITERATION_PADDING.right-a.width),a.position.y+a.height>b.height-N.ITERATION_PADDING.bottom&&(d.y=b.height-N.ITERATION_PADDING.bottom-a.height))}return{restrictPosition:d}},[e]),i=(0,c.useCallback)(a=>{let{getNodes:b}=e.getState(),c=b().find(b=>b.id===a).parentId;c&&g(c)},[e,g]);return{handleNodeIterationRerender:g,handleNodeIterationChildDrag:h,handleNodeIterationChildSizeChange:i,handleNodeIterationChildrenCopy:(0,c.useCallback)((b,c,d)=>{let{getNodes:g}=e.getState(),h=g(),i=h.filter(a=>a.parentId===b&&a.type!==ad.CUSTOM_ITERATION_START_NODE),j={...d},k={};return{copyChildren:i.map((b,d)=>{let e=b.data.type,g=h.filter(a=>a.data.type===e);k[e]?k[e]=k[e]+1:k[e]=g.length+1;let{newNode:i}=(0,aM.generateNewNode)({type:(0,aM.getNodeCustomTypeByNodeDataType)(e),data:{...f[e].defaultValue,...b.data,selected:!1,_isBundled:!1,_connectedSourceHandleIds:[],_connectedTargetHandleIds:[],title:g.length>0?`${a(`blocks.${e}`,{ns:"workflow"})} ${k[e]}`:a(`blocks.${e}`,{ns:"workflow"}),iteration_id:c,type:e},position:b.position,positionAbsolute:b.positionAbsolute,parentId:c,extent:b.extent,zIndex:b.zIndex});return i.id=`${c}${i.id+d}`,j[b.id]=i.id,i}),newIdMapping:j}},[e,a])}};a.s(["useNodeLoopInteractions",()=>aO],622837);let aO=()=>{let a=(0,d.useStoreApi)(),{nodesMap:e}=A(),f=(0,c.useCallback)(c=>{let d,e,{getNodes:f,setNodes:g}=a.getState(),h=f(),i=h.find(a=>a.id===c);h.filter(a=>a.parentId===c).forEach(a=>{d?a.position.x+a.width>d.position.x+d.width&&(d=a):d=a,e?a.position.y+a.height>e.position.y+e.height&&(e=a):e=a});let j=d&&i.width<d.position.x+d.width,k=e&&i.height<e.position.y+e.height;(j||k)&&g((0,b.produce)(h,a=>{a.forEach(a=>{a.id===c&&(j&&(a.data.width=d.position.x+d.width+N.LOOP_PADDING.right,a.width=d.position.x+d.width+N.LOOP_PADDING.right),k&&(a.data.height=e.position.y+e.height+N.LOOP_PADDING.bottom,a.height=e.position.y+e.height+N.LOOP_PADDING.bottom))})}))},[a]),g=(0,c.useCallback)(b=>{let{getNodes:c}=a.getState(),d=c(),e={x:void 0,y:void 0};if(b.data.isInLoop){let a=d.find(a=>a.id===b.parentId);a&&(b.position.y<N.LOOP_PADDING.top&&(e.y=N.LOOP_PADDING.top),b.position.x<N.LOOP_PADDING.left&&(e.x=N.LOOP_PADDING.left),b.position.x+b.width>a.width-N.LOOP_PADDING.right&&(e.x=a.width-N.LOOP_PADDING.right-b.width),b.position.y+b.height>a.height-N.LOOP_PADDING.bottom&&(e.y=a.height-N.LOOP_PADDING.bottom-b.height))}return{restrictPosition:e}},[a]),h=(0,c.useCallback)(b=>{let{getNodes:c}=a.getState(),d=c().find(a=>a.id===b).parentId;d&&f(d)},[a,f]);return{handleNodeLoopRerender:f,handleNodeLoopChildDrag:g,handleNodeLoopChildSizeChange:h,handleNodeLoopChildrenCopy:(0,c.useCallback)((b,c)=>{let{getNodes:d}=a.getState(),f=d();return f.filter(a=>a.parentId===b&&a.type!==ae.CUSTOM_LOOP_START_NODE).map((a,b)=>{let d=a.data.type,{defaultValue:g}=e[d],h=f.filter(a=>a.data.type===d),{newNode:i}=(0,aM.generateNewNode)({type:(0,aM.getNodeCustomTypeByNodeDataType)(d),data:{...g,...a.data,selected:!1,_isBundled:!1,_connectedSourceHandleIds:[],_connectedTargetHandleIds:[],_dimmed:!1,title:h.length>0?`${g.title} ${h.length+1}`:g.title,isInLoop:!0,loop_id:c,type:d},position:a.position,positionAbsolute:a.positionAbsolute,parentId:c,extent:a.extent,zIndex:N.LOOP_CHILDREN_Z_INDEX});return i.id=`${c}${i.id+b}`,i})},[a,e])}},aP=()=>{let a,e,g,i,{t:j}=(0,D.useTranslation)(),k=(0,d.useStoreApi)(),l=w(),m=(0,d.useReactFlow)(),{store:n}=aD(),{handleSyncWorkflowDraft:o}=ax(),{getAfterNodesInSameBranch:p}=aj(),{getNodesReadOnly:q}=al(),{getWorkflowReadOnly:r}=ak(),{handleSetHelpline:s}=(a=(0,d.useStoreApi)(),e=w(),g=(0,c.useCallback)(a=>(0,f.isTriggerNode)(a.data.type)||a.data.type===f.BlockEnum.Start,[]),i=(0,c.useCallback)(a=>g(a)?{x:a.position.x+0,y:a.position.y+21}:{x:a.position.x,y:a.position.y},[g]),{handleSetHelpline:(0,c.useCallback)(b=>{let{getNodes:c}=a.getState(),d=c(),{setHelpLineHorizontal:f,setHelpLineVertical:h}=e.getState();if(b.data.isInIteration||b.data.isInLoop)return{showHorizontalHelpLineNodes:[],showVerticalHelpLineNodes:[]};let j=i(b),k=d.filter(a=>{if(a.id===b.id||a.data.isInIteration||a.data.isInLoop)return!1;let c=Math.ceil(i(a).y),d=Math.ceil(j.y);return!!(c-d<5)&&!!(c-d>-5)}).sort((a,b)=>{let c=i(a),d=i(b);return c.x-d.x}),l=k.length;if(l>0){let a=k[0],c=k[l-1],d=i(a),e=i(c),h=g(c)?c.width-0:c.width,m={top:d.y,left:d.x,width:e.x+h-d.x};if(j.x<d.x){let b=g(a)?a.width-0:a.width;m.left=j.x,m.width=d.x+b-j.x}if(j.x>e.x){let a=g(b)?b.width-0:b.width;m.width=j.x+a-d.x}f(m)}else f();let m=d.filter(a=>{if(a.id===b.id||a.data.isInIteration||a.data.isInLoop)return!1;let c=Math.ceil(i(a).x),d=Math.ceil(j.x);return!!(c-d<5)&&!!(c-d>-5)}).sort((a,b)=>{let c=i(a),d=i(b);return c.x-d.x}),n=m.length;if(n>0){let a=m[0],c=m[n-1],d=i(a),e=i(c),f=g(c)?c.height-21:c.height,k={top:d.y,left:d.x,height:e.y+f-d.y};if(j.y<d.y){let b=g(a)?a.height-21:a.height;k.top=j.y,k.height=d.y+b-j.y}if(j.y>e.y){let a=g(b)?b.height-21:b.height;k.height=j.y+a-d.y}h(k)}else h();return{showHorizontalHelpLineNodes:k,showVerticalHelpLineNodes:m}},[a,e,i])}),{handleNodeIterationChildDrag:t,handleNodeIterationChildrenCopy:u}=aN(),{handleNodeLoopChildDrag:v,handleNodeLoopChildrenCopy:x}=aO(),y=(0,c.useRef)({x:0,y:0}),{nodesMap:z}=A(),{saveStateToHistory:B,undo:C,redo:E}=aF(),F=h(),G=(0,c.useCallback)((a,b)=>{l.setState({nodeAnimation:!1}),q()||b.type===ad.CUSTOM_ITERATION_START_NODE||b.type===af.CUSTOM_NOTE_NODE||b.type!==ae.CUSTOM_LOOP_START_NODE&&b.type!==af.CUSTOM_NOTE_NODE&&(y.current={x:b.position.x,y:b.position.y})},[l,q]),H=(0,c.useCallback)((a,c)=>{if(q()||c.type===ad.CUSTOM_ITERATION_START_NODE||c.type===ae.CUSTOM_LOOP_START_NODE)return;let{getNodes:d,setNodes:e}=k.getState();a.stopPropagation();let g=d(),{restrictPosition:h}=t(c),{restrictPosition:i}=v(c),{showHorizontalHelpLineNodes:j,showVerticalHelpLineNodes:l}=s(c),m=j.length,n=l.length;e((0,b.produce)(g,a=>{let b=a.find(a=>a.id===c.id),d=(0,f.isTriggerNode)(c.data.type)||c.data.type===f.BlockEnum.Start;if(n>0){let a=l[0],c=(0,f.isTriggerNode)(a.data.type)||a.data.type===f.BlockEnum.Start;b.position.x=a.position.x+0-0}else void 0!==h.x?b.position.x=h.x:void 0!==i.x?b.position.x=i.x:b.position.x=c.position.x;if(m>0){let a=j[0],c=(0,f.isTriggerNode)(a.data.type)||a.data.type===f.BlockEnum.Start;b.position.y=a.position.y+21*!!c-21*!!d}else void 0!==h.y?b.position.y=h.y:void 0!==i.y?b.position.y=i.y:b.position.y=c.position.y}))},[q,k,t,v,s]),I=(0,c.useCallback)((a,b)=>{let{setHelpLineHorizontal:c,setHelpLineVertical:d}=l.getState();if(q())return;let{x:e,y:f}=y.current;(e!==b.position.x||f!==b.position.y)&&(c(),d(),o(),0!==e&&0!==f&&B(aE.NodeDragStop,{nodeId:b.id}))},[l,q,B,o]),J=(0,c.useCallback)((a,c)=>{if(q()||c.type===af.CUSTOM_NOTE_NODE||c.type===ad.CUSTOM_ITERATION_START_NODE||c.type===ae.CUSTOM_LOOP_START_NODE||c.type===af.CUSTOM_NOTE_NODE)return;let{getNodes:e,setNodes:g,edges:h,setEdges:i}=k.getState(),j=e(),{connectingNodePayload:m,setEnteringNodePayload:n}=l.getState();if(m){if(m.nodeId===c.id)return;let a=j.find(a=>a.id===m.nodeId);if(a.parentId===c.parentId){n({nodeId:c.id,nodeData:c.data});let d=m.handleType;g((0,b.produce)(j,b=>{b.forEach(b=>{b.id!==c.id||"source"!==d||c.data.type!==f.BlockEnum.VariableAssigner&&c.data.type!==f.BlockEnum.VariableAggregator||c.data.advanced_settings?.group_enabled||(b.data._isEntering=!0),b.id===c.id&&"target"===d&&(a.data.type===f.BlockEnum.VariableAssigner||a.data.type===f.BlockEnum.VariableAggregator)&&c.data.type!==f.BlockEnum.IfElse&&c.data.type!==f.BlockEnum.QuestionClassifier&&(b.data._isEntering=!0)})}))}}i((0,b.produce)(h,a=>{(0,d.getConnectedEdges)([c],h).forEach(b=>{let c=a.find(a=>a.id===b.id);c&&(c.data._connectedNodeIsHovering=!0)})}))},[k,l,q]),K=(0,c.useCallback)((a,c)=>{if(q()||c.type===af.CUSTOM_NOTE_NODE||c.type===ad.CUSTOM_ITERATION_START_NODE||c.type===af.CUSTOM_NOTE_NODE||c.type===ae.CUSTOM_LOOP_START_NODE)return;let{setEnteringNodePayload:d}=l.getState();d(void 0);let{getNodes:e,setNodes:f,edges:g,setEdges:h}=k.getState();f((0,b.produce)(e(),a=>{a.forEach(a=>{a.data._isEntering=!1})})),h((0,b.produce)(g,a=>{a.forEach(a=>{a.data._connectedNodeIsHovering=!1})}))},[k,l,q]),L=(0,c.useCallback)((a,c,e)=>{e&&l.setState({initShowLastRunTab:!0});let{getNodes:f,setNodes:g,edges:h,setEdges:i}=k.getState(),j=f(),m=j.find(a=>a.data.selected);if(!c&&m?.id===a)return;g((0,b.produce)(j,b=>{b.forEach(b=>{b.id===a?b.data.selected=!c:b.data.selected=!1})}));let n=(0,d.getConnectedEdges)([{id:a}],h).map(a=>a.id);i((0,b.produce)(h,a=>{a.forEach(a=>{n.includes(a.id)?a.data={...a.data,_connectedNodeIsSelected:!c}:a.data={...a.data,_connectedNodeIsSelected:!1}})})),o()},[k,o]),M=(0,c.useCallback)((a,b)=>{b.type===ad.CUSTOM_ITERATION_START_NODE||b.type===ae.CUSTOM_LOOP_START_NODE||b.data.type===f.BlockEnum.DataSourceEmpty||b.data._pluginInstallLocked||L(b.id)},[L]),O=(0,c.useCallback)(({source:a,sourceHandle:c,target:d,targetHandle:e})=>{if(a===d||q())return;let{getNodes:g,setNodes:h,edges:i,setEdges:j}=k.getState(),l=g(),m=l.find(a=>a.id===d),n=l.find(b=>b.id===a);if(m?.parentId!==n?.parentId||n?.type===af.CUSTOM_NOTE_NODE||m?.type===af.CUSTOM_NOTE_NODE||i.find(b=>b.source===a&&b.sourceHandle===c&&b.target===d&&b.targetHandle===e))return;let p=l.find(a=>a.id===m?.parentId),r=p&&p.data.type===f.BlockEnum.Iteration,s=!!p&&p.data.type===f.BlockEnum.Loop,t={id:`${a}-${c}-${d}-${e}`,type:N.CUSTOM_EDGE,source:a,target:d,sourceHandle:c,targetHandle:e,data:{sourceType:l.find(b=>b.id===a).data.type,targetType:l.find(a=>a.id===d).data.type,isInIteration:r,iteration_id:r?m?.parentId:void 0,isInLoop:s,loop_id:s?m?.parentId:void 0},zIndex:m?.parentId?r?N.ITERATION_CHILDREN_Z_INDEX:N.LOOP_CHILDREN_Z_INDEX:0},u=(0,aa.getNodesConnectedSourceOrTargetHandleIdsMap)([{type:"add",edge:t}],l),v=(0,b.produce)(l,a=>{a.forEach(a=>{u[a.id]&&(a.data={...a.data,...u[a.id]})})}),w=(0,b.produce)(i,a=>{a.push(t)});h(v),j(w),o(),B(aE.NodeConnect,{nodeId:m?.id})},[q,k,l,o,B]),P=(0,c.useCallback)((a,{nodeId:b,handleType:c,handleId:d})=>{if(!q()&&b&&c){let{setConnectingNodePayload:a}=l.getState(),{getNodes:e}=k.getState(),g=e().find(a=>a.id===b);g.type!==af.CUSTOM_NOTE_NODE&&(g.data.type!==f.BlockEnum.VariableAggregator&&g.data.type!==f.BlockEnum.VariableAssigner||"target"!==c)&&a({nodeId:b,nodeType:g.data.type,handleType:c,handleId:d})}},[k,l,q]),Q=(0,c.useCallback)(a=>{if(q())return;let{connectingNodePayload:c,setConnectingNodePayload:d,enteringNodePayload:e,setEnteringNodePayload:g}=l.getState();if(c&&e){let{setShowAssignVariablePopup:d,hoveringAssignVariableGroupId:g}=l.getState(),{screenToFlowPosition:h}=m,{getNodes:i,setNodes:j}=k.getState(),n=i(),o=c.handleType,p=c.handleId,q=n.find(a=>a.id===c.nodeId),r=n.find(a=>a.id===e.nodeId),s=n.find(a=>a.id===r.parentId);if(q.parentId!==r.parentId)return;let{x:t,y:u}=h({x:a.x,y:a.y});if("source"===o&&(r.data.type===f.BlockEnum.VariableAssigner||r.data.type===f.BlockEnum.VariableAggregator)){let a=r.data.advanced_settings?.group_enabled,c=r.data.advanced_settings?.groups[0].groupId,e="target";a&&(e=g||c),j((0,b.produce)(n,a=>{a.forEach(a=>{a.id===r.id&&(a.data._showAddVariablePopup=!0,a.data._holdAddVariablePopup=!0)})})),d({nodeId:q.id,nodeData:q.data,variableAssignerNodeId:r.id,variableAssignerNodeData:r.data,variableAssignerNodeHandleId:e,parentNode:s,x:t-r.positionAbsolute.x,y:u-r.positionAbsolute.y}),O({source:q.id,sourceHandle:p,target:r.id,targetHandle:"target"})}}d(void 0),g(void 0)},[k,O,q,l,m]),{deleteNodeInspectorVars:R}=aK(),S=(0,c.useCallback)(a=>{if(q())return;let{getNodes:c,setNodes:e,edges:g,setEdges:h}=k.getState(),i=c(),m=i.findIndex(b=>b.id===a),n=i[m];if(!n||z?.[n.data.type]?.metaData.isUndeletable)return;if(R(a),n.data.type===f.BlockEnum.Iteration){let b=i.filter(a=>a.parentId===n.id);if(b.length)if(n.data._isBundled)return b.forEach(a=>{S(a.id)}),S(a);else{if(1===b.length){S(b[0].id),S(a);return}let{setShowConfirm:c,showConfirm:d}=l.getState();if(!d)return void c({title:j("nodes.iteration.deleteTitle",{ns:"workflow"}),desc:j("nodes.iteration.deleteDesc",{ns:"workflow"})||"",onConfirm:()=>{b.forEach(a=>{S(a.id)}),S(a),o(),c(void 0)}})}}if(n.data.type===f.BlockEnum.Loop){let b=i.filter(a=>a.parentId===n.id);if(b.length)if(n.data._isBundled)return b.forEach(a=>{S(a.id)}),S(a);else{if(1===b.length){S(b[0].id),S(a);return}let{setShowConfirm:c,showConfirm:d}=l.getState();if(!d)return void c({title:j("nodes.loop.deleteTitle",{ns:"workflow"}),desc:j("nodes.loop.deleteDesc",{ns:"workflow"})||"",onConfirm:()=>{b.forEach(a=>{S(a.id)}),S(a),o(),c(void 0)}})}}if(n.data.type===f.BlockEnum.DataSource){let{id:a}=n,{ragPipelineVariables:b,setRagPipelineVariables:c}=l.getState();if(b&&c){let d=[];b.forEach(b=>{b.belong_to_node_id!==a&&d.push(b)}),c(d)}}let p=(0,d.getConnectedEdges)([{id:a}],g),r=(0,aa.getNodesConnectedSourceOrTargetHandleIdsMap)(p.map(a=>({type:"remove",edge:a})),i);e((0,b.produce)(i,b=>{b.forEach(b=>{r[b.id]&&(b.data={...b.data,...r[b.id]}),b.id===n.parentId&&(b.data._children=b.data._children?.filter(b=>b.nodeId!==a))}),b.splice(m,1)})),h((0,b.produce)(g,a=>a.filter(a=>!p.find(b=>b.id===a.id)))),o(),n.type===af.CUSTOM_NOTE_NODE?B(aE.NoteDelete,{nodeId:n.id}):B(aE.NodeDelete,{nodeId:n.id})},[q,k,o,B,l,j,z,R]),T=(0,c.useCallback)(({nodeType:a,sourceHandle:c="source",targetHandle:e="target",pluginDefaultValue:g},{prevNodeId:h,prevNodeSourceHandle:i,nextNodeId:j,nextNodeTargetHandle:m})=>{if(q())return;let{getNodes:n,setNodes:r,edges:s,setEdges:t}=k.getState(),u=n(),v=u.filter(b=>b.data.type===a),{defaultValue:w}=z[a],{newNode:x,newIterationStartNode:y,newLoopStartNode:A}=(0,aM.generateNewNode)({type:(0,aM.getNodeCustomTypeByNodeDataType)(a),data:{...w,title:v.length>0?`${w.title} ${v.length+1}`:w.title,...g,selected:!0,_showAddVariablePopup:(a===f.BlockEnum.VariableAssigner||a===f.BlockEnum.VariableAggregator)&&!!h,_holdAddVariablePopup:!1},position:{x:0,y:0}});if(h&&!j){let c=u.findIndex(a=>a.id===h),g=u[c],j=(0,d.getOutgoers)(g,u,s).sort((a,b)=>a.position.y-b.position.y),k=j[j.length-1];x.data._connectedTargetHandleIds=a===f.BlockEnum.DataSource?[]:[e],x.data._connectedSourceHandleIds=[],x.position={x:k?k.position.x:g.position.x+g.width+N.X_OFFSET,y:k?k.position.y+k.height+N.Y_OFFSET:g.position.y},x.parentId=g.parentId,x.extent=g.extent;let m=u.find(a=>a.id===g.parentId)||null,n=!!m&&m.data.type===f.BlockEnum.Iteration,o=!!m&&m.data.type===f.BlockEnum.Loop;g.parentId&&(x.data.isInIteration=n,x.data.isInLoop=o,n&&(x.data.iteration_id=m.id,x.zIndex=N.ITERATION_CHILDREN_Z_INDEX),o&&(x.data.loop_id=m.id,x.zIndex=N.LOOP_CHILDREN_Z_INDEX),n&&(x.data.type===f.BlockEnum.Answer||x.data.type===f.BlockEnum.Tool||x.data.type===f.BlockEnum.Assigner)&&(m.data._isShowTips=!0),o&&(x.data.type===f.BlockEnum.Answer||x.data.type===f.BlockEnum.Tool||x.data.type===f.BlockEnum.Assigner)&&(m.data._isShowTips=!0));let p=null;a!==f.BlockEnum.DataSource&&(p={id:`${h}-${i}-${x.id}-${e}`,type:N.CUSTOM_EDGE,source:h,sourceHandle:i,target:x.id,targetHandle:e,data:{sourceType:g.data.type,targetType:x.data.type,isInIteration:n,isInLoop:o,iteration_id:n?g.parentId:void 0,loop_id:o?g.parentId:void 0,_connectedNodeIsSelected:!0},zIndex:g.parentId?n?N.ITERATION_CHILDREN_Z_INDEX:N.LOOP_CHILDREN_Z_INDEX:0});let q=(0,aa.getNodesConnectedSourceOrTargetHandleIdsMap)(p?[{type:"add",edge:p}]:[],u),v=(0,b.produce)(u,a=>{a.forEach(a=>{a.data.selected=!1,q[a.id]&&(a.data={...a.data,...q[a.id]}),a.data.type===f.BlockEnum.Iteration&&g.parentId===a.id&&a.data._children?.push({nodeId:x.id,nodeType:x.data.type}),a.data.type===f.BlockEnum.Loop&&g.parentId===a.id&&a.data._children?.push({nodeId:x.id,nodeType:x.data.type})}),a.push(x),y&&a.push(y),A&&a.push(A)});if(x.data.type===f.BlockEnum.VariableAssigner||x.data.type===f.BlockEnum.VariableAggregator){let{setShowAssignVariablePopup:a}=l.getState();a({nodeId:g.id,nodeData:g.data,variableAssignerNodeId:x.id,variableAssignerNodeData:x.data,variableAssignerNodeHandleId:e,parentNode:u.find(a=>a.id===x.parentId),x:-25,y:44})}let w=(0,b.produce)(s,a=>{a.forEach(a=>{a.data={...a.data,_connectedNodeIsSelected:!1}}),p&&a.push(p)});r(v),t(w)}if(!h&&j){let d,e,g=u.findIndex(a=>a.id===j),h=u[g];a!==f.BlockEnum.IfElse&&a!==f.BlockEnum.QuestionClassifier&&(x.data._connectedSourceHandleIds=[c]),x.data._connectedTargetHandleIds=[],x.position={x:h.position.x,y:h.position.y},x.parentId=h.parentId,x.extent=h.extent;let i=u.find(a=>a.id===h.parentId)||null,k=!!i&&i.data.type===f.BlockEnum.Iteration,l=!!i&&i.data.type===f.BlockEnum.Loop;i&&h.parentId&&(x.data.isInIteration=k,x.data.isInLoop=l,k&&(x.data.iteration_id=i.id,x.zIndex=N.ITERATION_CHILDREN_Z_INDEX),l&&(x.data.loop_id=i.id,x.zIndex=N.LOOP_CHILDREN_Z_INDEX)),a!==f.BlockEnum.IfElse&&a!==f.BlockEnum.QuestionClassifier&&a!==f.BlockEnum.LoopEnd&&(d={id:`${x.id}-${c}-${j}-${m}`,type:N.CUSTOM_EDGE,source:x.id,sourceHandle:c,target:j,targetHandle:m,data:{sourceType:x.data.type,targetType:h.data.type,isInIteration:k,isInLoop:l,iteration_id:k?h.parentId:void 0,loop_id:l?h.parentId:void 0,_connectedNodeIsSelected:!0},zIndex:h.parentId?k?N.ITERATION_CHILDREN_Z_INDEX:N.LOOP_CHILDREN_Z_INDEX:0}),d&&(e=(0,aa.getNodesConnectedSourceOrTargetHandleIdsMap)([{type:"add",edge:d}],u));let n=p(j).map(a=>a.id),o=(0,b.produce)(u,a=>{a.forEach(a=>{a.data.selected=!1,n.includes(a.id)&&(a.position.x+=N.NODE_WIDTH_X_OFFSET),e?.[a.id]&&(a.data={...a.data,...e[a.id]}),a.data.type===f.BlockEnum.Iteration&&h.parentId===a.id&&a.data._children?.push({nodeId:x.id,nodeType:x.data.type}),a.data.type===f.BlockEnum.Iteration&&a.data.start_node_id===j&&(a.data.start_node_id=x.id,a.data.startNodeType=x.data.type),a.data.type===f.BlockEnum.Loop&&h.parentId===a.id&&a.data._children?.push({nodeId:x.id,nodeType:x.data.type}),a.data.type===f.BlockEnum.Loop&&a.data.start_node_id===j&&(a.data.start_node_id=x.id,a.data.startNodeType=x.data.type)}),a.push(x),y&&a.push(y),A&&a.push(A)});if(d){let a=(0,b.produce)(s,a=>{a.forEach(a=>{a.data={...a.data,_connectedNodeIsSelected:!1}}),a.push(d)});r(o),t(a)}else r(o)}if(h&&j){let d=u.find(a=>a.id===h),g=u.find(a=>a.id===j);x.data._connectedTargetHandleIds=a===f.BlockEnum.DataSource?[]:[e],x.data._connectedSourceHandleIds=[c],x.position={x:g.position.x,y:g.position.y},x.parentId=d.parentId,x.extent=d.extent;let k=u.find(a=>a.id===d.parentId)||null,n=!!k&&k.data.type===f.BlockEnum.Iteration,o=!!k&&k.data.type===f.BlockEnum.Loop;k&&d.parentId&&(x.data.isInIteration=n,x.data.isInLoop=o,n&&(x.data.iteration_id=k.id,x.zIndex=N.ITERATION_CHILDREN_Z_INDEX),o&&(x.data.loop_id=k.id,x.zIndex=N.LOOP_CHILDREN_Z_INDEX));let q=s.findIndex(a=>a.source===h&&a.target===j),v=null;a!==f.BlockEnum.DataSource&&(v={id:`${h}-${i}-${x.id}-${e}`,type:N.CUSTOM_EDGE,source:h,sourceHandle:i,target:x.id,targetHandle:e,data:{sourceType:d.data.type,targetType:x.data.type,isInIteration:n,isInLoop:o,iteration_id:n?d.parentId:void 0,loop_id:o?d.parentId:void 0,_connectedNodeIsSelected:!0},zIndex:d.parentId?n?N.ITERATION_CHILDREN_Z_INDEX:N.LOOP_CHILDREN_Z_INDEX:0});let w=null,z=u.find(a=>a.id===g.parentId)||null,B=!!z&&z.data.type===f.BlockEnum.Iteration,C=!!z&&z.data.type===f.BlockEnum.Loop;a!==f.BlockEnum.IfElse&&a!==f.BlockEnum.QuestionClassifier&&a!==f.BlockEnum.LoopEnd&&(w={id:`${x.id}-${c}-${j}-${m}`,type:N.CUSTOM_EDGE,source:x.id,sourceHandle:c,target:j,targetHandle:m,data:{sourceType:x.data.type,targetType:g.data.type,isInIteration:B,isInLoop:C,iteration_id:B?g.parentId:void 0,loop_id:C?g.parentId:void 0,_connectedNodeIsSelected:!0},zIndex:g.parentId?B?N.ITERATION_CHILDREN_Z_INDEX:N.LOOP_CHILDREN_Z_INDEX:0});let D=(0,aa.getNodesConnectedSourceOrTargetHandleIdsMap)([{type:"remove",edge:s[q]},...v?[{type:"add",edge:v}]:[],...w?[{type:"add",edge:w}]:[]],[...u,x]),E=p(j).map(a=>a.id);if(r((0,b.produce)(u,a=>{a.forEach(a=>{a.data.selected=!1,D[a.id]&&(a.data={...a.data,...D[a.id]}),E.includes(a.id)&&(a.position.x+=N.NODE_WIDTH_X_OFFSET),a.data.type===f.BlockEnum.Iteration&&d.parentId===a.id&&a.data._children?.push({nodeId:x.id,nodeType:x.data.type}),a.data.type===f.BlockEnum.Loop&&d.parentId===a.id&&a.data._children?.push({nodeId:x.id,nodeType:x.data.type})}),a.push(x),y&&a.push(y),A&&a.push(A)})),x.data.type===f.BlockEnum.VariableAssigner||x.data.type===f.BlockEnum.VariableAggregator){let{setShowAssignVariablePopup:a}=l.getState();a({nodeId:d.id,nodeData:d.data,variableAssignerNodeId:x.id,variableAssignerNodeData:x.data,variableAssignerNodeHandleId:e,parentNode:u.find(a=>a.id===x.parentId),x:-25,y:44})}t((0,b.produce)(s,a=>{a.splice(q,1),a.forEach(a=>{a.data={...a.data,_connectedNodeIsSelected:!1}}),v&&a.push(v),w&&a.push(w)}))}o(),B(aE.NodeAdd,{nodeId:x.id})},[q,k,o,B,l,p,z]),U=(0,c.useCallback)((a,c,e,g)=>{if(q())return;let{getNodes:h,setNodes:i,edges:j,setEdges:l}=k.getState(),m=h(),n=m.find(b=>b.id===a),p=(0,d.getConnectedEdges)([n],j),r=m.filter(a=>a.data.type===c),{defaultValue:s}=z[c],{newNode:t,newIterationStartNode:u,newLoopStartNode:v}=(0,aM.generateNewNode)({type:(0,aM.getNodeCustomTypeByNodeDataType)(c),data:{...s,title:r.length>0?`${s.title} ${r.length+1}`:s.title,...g,_connectedSourceHandleIds:[],_connectedTargetHandleIds:[],selected:n.data.selected,isInIteration:n.data.isInIteration,isInLoop:n.data.isInLoop,iteration_id:n.data.iteration_id,loop_id:n.data.loop_id},position:{x:n.position.x,y:n.position.y},parentId:n.parentId,extent:n.extent,zIndex:n.zIndex}),w=(0,aa.getNodesConnectedSourceOrTargetHandleIdsMap)(p.map(a=>({type:"remove",edge:a})),m);i((0,b.produce)(m,b=>{b.forEach(a=>{a.data.selected=!1,w[a.id]&&(a.data={...a.data,...w[a.id]})});let c=b.findIndex(b=>b.id===a);b.splice(c,1,t),u&&b.push(u),v&&b.push(v)})),l((0,b.produce)(j,a=>a.filter(a=>!p.find(b=>b.id===a.id)))),c===f.BlockEnum.TriggerWebhook?o(!0,!0,{onSuccess:()=>F(t.id)}):o(),B(aE.NodeChange,{nodeId:a})},[q,k,o,B,z,F]),V=(0,c.useCallback)(()=>{let{getNodes:a,setNodes:c}=k.getState(),d=a();c((0,b.produce)(d,a=>{a.forEach(a=>{a.data.selected=!1})}))},[k]),W=(0,c.useCallback)((a,b)=>{if(b.type===af.CUSTOM_NOTE_NODE||b.type===ad.CUSTOM_ITERATION_START_NODE||b.type===af.CUSTOM_NOTE_NODE||b.type===ae.CUSTOM_LOOP_START_NODE)return;a.preventDefault();let{x:c,y:d}=document.querySelector("#workflow-container").getBoundingClientRect();l.setState({nodeMenu:{top:a.clientY-d,left:a.clientX-c,nodeId:b.id}}),L(b.id)},[l,L]),X=(0,c.useCallback)(a=>{if(q())return;let{setClipboardElements:b}=l.getState(),{getNodes:c}=k.getState(),d=c();if(a){let c=d.find(b=>b.id===a&&b.data.type!==f.BlockEnum.Start&&b.type!==ad.CUSTOM_ITERATION_START_NODE&&b.type!==ae.CUSTOM_LOOP_START_NODE&&b.data.type!==f.BlockEnum.LoopEnd&&b.data.type!==f.BlockEnum.KnowledgeBase&&b.data.type!==f.BlockEnum.DataSourceEmpty);c&&b([c])}else{let a=d.filter(a=>{if(!a.data._isBundled)return!1;if(a.type===af.CUSTOM_NOTE_NODE)return!0;let{metaData:b}=z[a.data.type];return!b.isSingleton&&!a.data.isInIteration&&!a.data.isInLoop});if(a.length)return void b(a);let c=d.find(a=>{if(!a.data.selected)return!1;if(a.type===af.CUSTOM_NOTE_NODE)return!0;let{metaData:b}=z[a.data.type];return!b.isSingleton});c&&b([c])}},[q,k,l]),Y=(0,c.useCallback)(()=>{if(q())return;let{clipboardElements:a,mousePosition:c}=l.getState(),{getNodes:d,setNodes:e,edges:g,setEdges:h}=k.getState(),i=[],j=[],n=d();if(a.length){let{x:d,y:k}=(0,aM.getTopLeftNodePosition)(a),{screenToFlowPosition:l}=m,p=l({x:c.pageX,y:c.pageY}),q=p.x-d,r=p.y-k,s={},t=[];a.forEach((a,b)=>{let c=a.data.type,{newNode:d,newIterationStartNode:e,newLoopStartNode:g}=(0,aM.generateNewNode)({type:a.type,data:{...a.type!==af.CUSTOM_NOTE_NODE&&z[c].defaultValue,...a.data,selected:!1,_isBundled:!1,_connectedSourceHandleIds:[],_connectedTargetHandleIds:[],_dimmed:!1,title:(0,aM.genNewNodeTitleFromOld)(a.data.title)},position:{x:a.position.x+q,y:a.position.y+r},extent:a.extent,zIndex:a.zIndex});d.id=d.id+b;let h=[];if(a.data.type===f.BlockEnum.Iteration){e.parentId=d.id,d.data.start_node_id=e.id,s[n.find(b=>b.parentId===a.id&&b.type===ad.CUSTOM_ITERATION_START_NODE).id]=e.id;let{copyChildren:b,newIdMapping:c}=u(a.id,d.id,s);h=b,s=c,h.forEach(a=>{d.data._children?.push({nodeId:a.id,nodeType:a.data.type})}),h.push(e)}else if(a.data.type===f.BlockEnum.Loop)g.parentId=d.id,d.data.start_node_id=g.id,(h=x(a.id,d.id)).forEach(a=>{d.data._children?.push({nodeId:a.id,nodeType:a.data.type})}),h.push(g);else{let b=n.find(a=>a.selected);if(b){if([f.BlockEnum.End].includes(a.data.type))return;if(b.data.type===f.BlockEnum.Iteration||b.data.type===f.BlockEnum.Loop){let a=b.data.type===f.BlockEnum.Iteration;d.data.isInIteration=a,d.data.iteration_id=a?b.id:void 0,d.data.isInLoop=!a,d.data.loop_id=a?void 0:b.id,d.parentId=b.id,d.zIndex=a?N.ITERATION_CHILDREN_Z_INDEX:N.LOOP_CHILDREN_Z_INDEX,d.positionAbsolute={x:d.position.x,y:d.position.y},d.position=(0,aM.getNestedNodePosition)(d,b),t.push({parentId:b.id,childId:d.id,childType:d.data.type})}}}i.push(d),h.length&&i.push(...h)}),g.forEach(a=>{let b=s[a.source],c=s[a.target];if(b&&c){let d={...a,id:`${b}-${a.sourceHandle}-${c}-${a.targetHandle}`,source:b,target:c,data:{...a.data,_connectedNodeIsSelected:!1}};j.push(d)}}),e((0,b.produce)(n,a=>{t.forEach(({parentId:b,childId:c,childType:d})=>{let e=a.find(a=>a.id===b);e&&e.data._children?.push({nodeId:c,nodeType:d})}),a.push(...i)})),h([...g,...j]),B(aE.NodePaste,{nodeId:i?.[0]?.id}),o()}},[q,l,k,m,B,o,u,x,z]),$=(0,c.useCallback)(a=>{q()||(X(a),Y())},[q,X,Y]),_=(0,c.useCallback)(()=>{if(q())return;let{getNodes:a,edges:b}=k.getState(),c=a(),d=c.filter(a=>a.data._isBundled);if(d.length)return void d.forEach(a=>S(a.id));if(b.some(a=>a.selected))return;let e=c.find(a=>a.data.selected);e&&S(e.id)},[k,q,S]),ab=(0,c.useCallback)((a,c)=>{let d,e;if(q())return;let{getNodes:g,setNodes:h}=k.getState(),{x:i,y:j,width:l,height:m}=c,n=g(),p=n.find(b=>b.id===a);if(n.filter(a=>p.data._children?.find(b=>b.nodeId===a.id)).forEach(a=>{d?a.position.x+a.width>d.position.x+d.width&&(d=a):d=a,e?a.position.y+a.height>e.position.y+e.height&&(e=a):e=a}),d&&e){let a=n.find(a=>a.id===d.parentId),b=a?.data.type===f.BlockEnum.Iteration?N.ITERATION_PADDING:N.LOOP_PADDING;if(l<d.position.x+d.width+b.right||m<e.position.y+e.height+b.bottom)return}h((0,b.produce)(n,b=>{b.forEach(b=>{b.id===a&&(b.data.width=l,b.data.height=m,b.width=l,b.height=m,b.position.x=i,b.position.y=j)})})),o(),B(aE.NodeResize,{nodeId:a})},[q,k,o,B]),ac=(0,c.useCallback)(a=>{if(q())return;let{getNodes:c,setNodes:e,edges:f,setEdges:g}=k.getState(),h=c(),i=h.find(b=>b.id===a),j=(0,d.getConnectedEdges)([i],f),l=(0,aa.getNodesConnectedSourceOrTargetHandleIdsMap)(j.map(a=>({type:"remove",edge:a})),h);e((0,b.produce)(h,a=>{a.forEach(a=>{l[a.id]&&(a.data={...a.data,...l[a.id]})})})),g((0,b.produce)(f,a=>a.filter(a=>!j.find(b=>b.id===a.id)))),o(),B(aE.EdgeDelete)},[k,q,o,B]),ag=(0,c.useCallback)(()=>{if(q()||r())return;let{setEdges:a,setNodes:b}=k.getState();C();let{edges:c,nodes:d}=n.getState();(0!==c.length||0!==d.length)&&(a(c),b(d))},[k,C,n,q,r]),ah=(0,c.useCallback)(()=>{if(q()||r())return;let{setEdges:a,setNodes:b}=k.getState();E();let{edges:c,nodes:d}=n.getState();(0!==c.length||0!==d.length)&&(a(c),b(d))},[E,k,n,q,r]),[ai,am]=(0,c.useState)(!1);return{handleNodeDragStart:G,handleNodeDrag:H,handleNodeDragStop:I,handleNodeEnter:J,handleNodeLeave:K,handleNodeSelect:L,handleNodeClick:M,handleNodeConnect:O,handleNodeConnectStart:P,handleNodeConnectEnd:Q,handleNodeDelete:S,handleNodeChange:U,handleNodeAdd:T,handleNodesCancelSelected:V,handleNodeContextMenu:W,handleNodesCopy:X,handleNodesPaste:Y,handleNodesDuplicate:$,handleNodesDelete:_,handleNodeResize:ab,handleNodeDisconnect:ac,handleHistoryBack:ag,handleHistoryForward:ah,dimOtherNodes:(0,c.useCallback)(()=>{if(ai)return;let{getNodes:a,setNodes:c,edges:e,setEdges:f}=k.getState(),g=a(),h=g.find(a=>a.data.selected);if(!h)return;am(!0);let i=(0,Z.getNodeUsedVars)(h),j=[];i.forEach(a=>{let b=g.find(b=>b.id===a?.[0]);b&&!j.includes(b)&&j.push(b)});let l=(0,d.getOutgoers)(h,g,e);for(let a=0;a<l.length;a++){let b=l[a];(0,d.getOutgoers)(b,g,e).forEach(a=>{l.some(b=>b.id===a.id)||l.push(a)})}let m=[];l.forEach(a=>{(0,Z.getNodeUsedVars)(a).some(a=>a?.[0]===h.id)&&(m.some(b=>b.id===a.id)||m.push(a))});let n=[...j,...m,h];c((0,b.produce)(g,a=>{a.forEach(a=>{n.find(b=>b.id===a.id)||(a.data._dimmed=!0)})}));let o=[];j.forEach(a=>{o.push({id:`tmp_${a.id}-source-${h.id}-target`,type:N.CUSTOM_EDGE,source:a.id,sourceHandle:"source_tmp",target:h.id,targetHandle:"target_tmp",animated:!0,data:{sourceType:a.data.type,targetType:h.data.type,_isTemp:!0,_connectedNodeIsHovering:!0}})}),m.forEach(a=>{o.push({id:`tmp_${h.id}-source-${a.id}-target`,type:N.CUSTOM_EDGE,source:h.id,sourceHandle:"source_tmp",target:a.id,targetHandle:"target_tmp",animated:!0,data:{sourceType:h.data.type,targetType:a.data.type,_isTemp:!0,_connectedNodeIsHovering:!0}})}),f((0,b.produce)(e,a=>{a.forEach(a=>{a.data._dimmed=!0}),a.push(...o)}))},[ai,k]),undimAllNodes:(0,c.useCallback)(()=>{let{getNodes:a,setNodes:c,edges:d,setEdges:e}=k.getState(),f=a();am(!1),c((0,b.produce)(f,a=>{a.forEach(a=>{a.data._dimmed=!1})})),e((0,b.produce)(d.filter(a=>!a.data._isTemp),a=>{a.forEach(a=>{a.data._dimmed=!1})}))},[k])}};var aQ=a.i(875682);a.i(739858),new aQ.default,a.s(["usePanelInteractions",0,()=>{let a=w(),b=(0,c.useCallback)(b=>{b.preventDefault();let{x:c,y:d}=document.querySelector("#workflow-container").getBoundingClientRect();a.setState({panelMenu:{top:b.clientY-d,left:b.clientX-c}})},[a]);return{handlePaneContextMenu:b,handlePaneContextmenuCancel:(0,c.useCallback)(()=>{a.setState({panelMenu:void 0})},[a]),handleNodeContextmenuCancel:(0,c.useCallback)(()=>{a.setState({nodeMenu:void 0})},[a])}}],505618);let aR=()=>{let a=(0,d.useStoreApi)(),e=w(),f=(0,c.useCallback)(()=>{let{getNodes:c,setNodes:d,edges:e,setEdges:f,userSelectionRect:g}=a.getState();if(!g?.width||!g?.height){let a=c();d((0,b.produce)(a,a=>{a.forEach(a=>{a.data._isBundled&&(a.data._isBundled=!1)})})),f((0,b.produce)(e,a=>{a.forEach(a=>{a.data._isBundled&&(a.data._isBundled=!1)})}))}},[a]),g=(0,c.useCallback)(({nodes:c,edges:d})=>{let{getNodes:e,setNodes:f,edges:g,setEdges:h,userSelectionRect:i}=a.getState(),j=e();i?.width&&i?.height&&(f((0,b.produce)(j,a=>{a.forEach(a=>{c.find(b=>b.id===a.id)?a.data._isBundled=!0:a.data._isBundled=!1})})),h((0,b.produce)(g,a=>{a.forEach(a=>{d.find(b=>b.id===a.id)?a.data._isBundled=!0:a.data._isBundled=!1})})))},[a]),h=(0,c.useCallback)((c,d)=>{let{getNodes:f,setNodes:g}=a.getState();e.setState({nodeAnimation:!1});let h=f();g((0,b.produce)(h,a=>{a.forEach(a=>{let b=d.find(b=>b.id===a.id);b&&(a.position=b.position)})}))},[a,e]),i=(0,c.useCallback)(()=>{let{getNodes:c,setNodes:d,edges:e,setEdges:f}=a.getState();a.setState({userSelectionRect:null,userSelectionActive:!0});let g=c();d((0,b.produce)(g,a=>{a.forEach(a=>{a.data._isBundled&&(a.data._isBundled=!1)})})),f((0,b.produce)(e,a=>{a.forEach(a=>{a.data._isBundled&&(a.data._isBundled=!1)})}))},[a]);return{handleSelectionStart:f,handleSelectionChange:g,handleSelectionDrag:h,handleSelectionCancel:i,handleSelectionContextMenu:(0,c.useCallback)(a=>{if(!a.target.classList.contains("react-flow__nodesselection-rect"))return;a.preventDefault();let{x:b,y:c}=document.querySelector("#workflow-container").getBoundingClientRect();e.setState({selectionMenu:{top:a.clientY-c,left:a.clientX-b}})},[e]),handleSelectionContextmenuCancel:(0,c.useCallback)(()=>{e.setState({selectionMenu:void 0})},[e])}};a.s(["useSelectionInteractions",0,aR],124677),a.s(["useSerialAsyncCallback",0,(a,b)=>{let d=(0,c.useRef)(Promise.resolve());return(0,c.useCallback)((...c)=>{if(b?.())return Promise.resolve(void 0);let e=d.current.catch(()=>void 0).then(()=>a(...c));return d.current=e,e},[a,b])}],380396),a.s(["useSetWorkflowVarsWithValue",0,()=>({fetchInspectVars:o(a=>a.fetchInspectVars)})],667756),a.s(["useShortcuts",()=>a3],875474);var aS=a.i(261574),aT=a.i(404606);a.s(["useWorkflowCanvasMaximize",()=>a1,"useWorkflowInteractions",()=>aZ,"useWorkflowMoveMode",()=>a$,"useWorkflowOrganize",()=>a_,"useWorkflowUpdate",()=>a0],737976);var aU=a.i(124116),aV=a.i(714470),aW=a.i(455495);let aX=()=>{let a=(0,d.useStoreApi)();return{handleEdgeCancelRunningStatus:(0,c.useCallback)(()=>{let{edges:c,setEdges:d}=a.getState();d((0,b.produce)(c,a=>{a.forEach(a=>{a.data._sourceRunningStatus=void 0,a.data._targetRunningStatus=void 0,a.data._waitingRun=!1})}))},[a])}};a.s(["useEdgesInteractionsWithoutSync",0,aX],858585);let aY=()=>{let a=(0,d.useStoreApi)(),e=(0,c.useCallback)(()=>{let{getNodes:c,setNodes:d}=a.getState(),e=c();d((0,b.produce)(e,a=>{a.forEach(a=>{a.data._runningStatus=void 0,a.data._waitingRun=!1})}))},[a]);return{handleNodeCancelRunningStatus:e,handleCancelAllNodeSuccessStatus:(0,c.useCallback)(()=>{let{getNodes:c,setNodes:d}=a.getState(),e=c();d((0,b.produce)(e,a=>{a.forEach(a=>{a.data._runningStatus===f.NodeRunningStatus.Succeeded&&(a.data._runningStatus=void 0)})}))},[a]),handleCancelNodeSuccessStatus:(0,c.useCallback)(c=>{let{getNodes:d,setNodes:e}=a.getState();e((0,b.produce)(d(),a=>{let b=a.find(a=>a.id===c);b&&b.data._runningStatus===f.NodeRunningStatus.Succeeded&&(b.data._runningStatus=void 0,b.data._waitingRun=!1)}))},[a])}};a.s(["useNodesInteractionsWithoutSync",0,aY],594916);let aZ=()=>{let a=w(),{handleNodeCancelRunningStatus:b}=aY(),{handleEdgeCancelRunningStatus:d}=aX();return{handleCancelDebugAndPreviewPanel:(0,c.useCallback)(()=>{a.setState({showDebugAndPreviewPanel:!1,workflowRunningData:void 0}),b(),d()},[a,b,d])}},a$=()=>{let a=v(a=>a.setControlMode),{getNodesReadOnly:b}=al(),{handleSelectionCancel:d}=aR();return{handleModePointer:(0,c.useCallback)(()=>{b()||a(f.ControlMode.Pointer)},[b,a]),handleModeHand:(0,c.useCallback)(()=>{b()||(a(f.ControlMode.Hand),d())},[b,a,d])}},a_=()=>{let a=w(),e=(0,d.useStoreApi)(),g=(0,d.useReactFlow)(),{getNodesReadOnly:h}=al(),{saveStateToHistory:i}=aF(),{handleSyncWorkflowDraft:j}=ax();return{handleLayout:(0,c.useCallback)(async()=>{if(h())return;a.setState({nodeAnimation:!0});let{getNodes:c,edges:d,setNodes:k}=e.getState(),{setViewport:l}=g,m=c(),n=m.filter(a=>(a.data.type===f.BlockEnum.Loop||a.data.type===f.BlockEnum.Iteration)&&!a.parentId&&a.type===N.CUSTOM_NODE),o=(await Promise.all(n.map(async a=>[a.id,await (0,aV.getLayoutForChildNodes)(a.id,m,d)]))).reduce((a,[b,c])=>(c&&(a[b]=c),a),{}),p={};n.forEach(a=>{let b=o[a.id];if(!b)return;let{bounds:c,nodes:d}=b;if(!d.size)return;let e=c.maxX-c.minX+2*N.NODE_LAYOUT_HORIZONTAL_PADDING,f=c.maxY-c.minY+2*N.NODE_LAYOUT_VERTICAL_PADDING;p[a.id]={width:Math.max(a.width||0,e),height:Math.max(a.height||0,f)}});let q=(0,b.produce)(m,a=>{a.forEach(a=>{(a.data.type===f.BlockEnum.Loop||a.data.type===f.BlockEnum.Iteration)&&p[a.id]&&(a.width=p[a.id].width,a.height=p[a.id].height,a.data.type===f.BlockEnum.Loop?(a.data.width=p[a.id].width,a.data.height=p[a.id].height):a.data.type===f.BlockEnum.Iteration&&(a.data.width=p[a.id].width,a.data.height=p[a.id].height))})}),r=await (0,aV.getLayoutByDagre)(q,d),s=new Map;r.nodes.forEach(a=>{if(void 0!==a.layer){let b=s.get(a.layer),c={minY:b?Math.min(b.minY,a.y):a.y,maxHeight:b?Math.max(b.maxHeight,a.height):a.height};s.set(a.layer,c)}}),k((0,b.produce)(q,a=>{a.forEach(a=>{if(!a.parentId&&a.type===N.CUSTOM_NODE){let b=r.nodes.get(a.id);if(!b)return;let c=b.y;if(void 0!==b.layer){let a=s.get(b.layer);a&&(c=a.minY+a.maxHeight/2-b.height/2)}a.position={x:b.x,y:c}}}),n.forEach(b=>{let c=o[b.id];if(!c)return;let d=a.filter(a=>a.parentId===b.id),{bounds:e,nodes:f}=c;d.forEach(a=>{let b=f.get(a.id);b&&(a.position={x:N.NODE_LAYOUT_HORIZONTAL_PADDING+(b.x-e.minX),y:N.NODE_LAYOUT_VERTICAL_PADDING+(b.y-e.minY)})})})})),l({x:0,y:0,zoom:.7}),i(aE.LayoutOrganize),setTimeout(()=>{j()})},[h,e,g,a,j,i])}},a0=()=>{let a=(0,d.useReactFlow)(),{eventEmitter:b}=(0,aU.useEventEmitterContextContext)();return{handleUpdateWorkflowCanvas:(0,c.useCallback)(c=>{let{nodes:d,edges:e,viewport:f}=c,{setViewport:g}=a;b?.emit({type:N.WORKFLOW_DATA_UPDATE,payload:{nodes:(0,aW.initialNodes)(d,e),edges:(0,aW.initialEdges)(e,d)}}),f&&"number"==typeof f.x&&"number"==typeof f.y&&"number"==typeof f.zoom&&g(f)},[b,a])}},a1=()=>{let{eventEmitter:a}=(0,aU.useEventEmitterContextContext)(),b=v(a=>a.maximizeCanvas),d=v(a=>a.setMaximizeCanvas),{getNodesReadOnly:e}=al();return{handleToggleMaximizeCanvas:(0,c.useCallback)(()=>{e()||(d(!b),localStorage.setItem("workflow-canvas-maximize",String(!b)),a?.emit({type:"workflow-canvas-maximize",payload:!b}))},[a,e,b,d])}};var a2=a.i(128972);let a3=()=>{let{handleNodesCopy:a,handleNodesPaste:b,handleNodesDuplicate:e,handleNodesDelete:f,handleHistoryBack:g,handleHistoryForward:h,dimOtherNodes:i,undimAllNodes:j}=aP(),{shortcutsEnabled:k}=aD(),{handleSyncWorkflowDraft:l}=ax(),{handleEdgeDelete:m}=aG(),n=w(),{handleModeHand:o,handleModePointer:p}=a$(),{handleLayout:q}=a_(),{handleToggleMaximizeCanvas:r}=a1(),{zoomTo:s,getZoom:t,fitView:u}=(0,d.useReactFlow)(),v=(0,c.useCallback)(a=>!(0,a2.isEventTargetInputArea)(a.target),[]),x=(0,c.useCallback)(()=>{let a=document.getSelection();return!a||a.isCollapsed},[]);(0,aS.useKeyPress)(["delete","backspace"],a=>{v(a)&&(a.preventDefault(),f(),m())}),(0,aS.useKeyPress)(`${(0,a2.getKeyboardKeyCodeBySystem)("ctrl")}.c`,b=>{let{showDebugAndPreviewPanel:c}=n.getState();v(b)&&x()&&!c&&(b.preventDefault(),a())},{exactMatch:!0,useCapture:!0}),(0,aS.useKeyPress)(`${(0,a2.getKeyboardKeyCodeBySystem)("ctrl")}.v`,a=>{let{showDebugAndPreviewPanel:c}=n.getState();v(a)&&!c&&(a.preventDefault(),b())},{exactMatch:!0,useCapture:!0}),(0,aS.useKeyPress)(`${(0,a2.getKeyboardKeyCodeBySystem)("ctrl")}.d`,a=>{v(a)&&(a.preventDefault(),e())},{exactMatch:!0,useCapture:!0}),(0,aS.useKeyPress)(`${(0,a2.getKeyboardKeyCodeBySystem)("alt")}.r`,a=>{v(a)&&(a.preventDefault(),window._toggleTestRunDropdown&&window._toggleTestRunDropdown())},{exactMatch:!0,useCapture:!0}),(0,aS.useKeyPress)(`${(0,a2.getKeyboardKeyCodeBySystem)("ctrl")}.z`,a=>{let{showDebugAndPreviewPanel:b}=n.getState();v(a)&&!b&&(a.preventDefault(),k&&g())},{exactMatch:!0,useCapture:!0}),(0,aS.useKeyPress)([`${(0,a2.getKeyboardKeyCodeBySystem)("ctrl")}.y`,`${(0,a2.getKeyboardKeyCodeBySystem)("ctrl")}.shift.z`],a=>{v(a)&&(a.preventDefault(),k&&h())},{exactMatch:!0,useCapture:!0}),(0,aS.useKeyPress)("h",a=>{v(a)&&(a.preventDefault(),o())},{exactMatch:!0,useCapture:!0}),(0,aS.useKeyPress)("v",a=>{v(a)&&(a.preventDefault(),p())},{exactMatch:!0,useCapture:!0}),(0,aS.useKeyPress)(`${(0,a2.getKeyboardKeyCodeBySystem)("ctrl")}.o`,a=>{v(a)&&(a.preventDefault(),q())},{exactMatch:!0,useCapture:!0}),(0,aS.useKeyPress)("f",a=>{v(a)&&(a.preventDefault(),r())},{exactMatch:!0,useCapture:!0}),(0,aS.useKeyPress)(`${(0,a2.getKeyboardKeyCodeBySystem)("ctrl")}.1`,a=>{v(a)&&(a.preventDefault(),u(),l())},{exactMatch:!0,useCapture:!0}),(0,aS.useKeyPress)("shift.1",a=>{v(a)&&(a.preventDefault(),s(1),l())},{exactMatch:!0,useCapture:!0}),(0,aS.useKeyPress)("shift.5",a=>{v(a)&&(a.preventDefault(),s(.5),l())},{exactMatch:!0,useCapture:!0}),(0,aS.useKeyPress)(`${(0,a2.getKeyboardKeyCodeBySystem)("ctrl")}.dash`,a=>{v(a)&&(a.preventDefault(),s(Math.max(t()-.1,.25)),l())},{exactMatch:!0,useCapture:!0}),(0,aS.useKeyPress)(`${(0,a2.getKeyboardKeyCodeBySystem)("ctrl")}.equalsign`,a=>{v(a)&&(a.preventDefault(),s(Math.min(t()+.1,2)),l())},{exactMatch:!0,useCapture:!0}),(0,aS.useKeyPress)("shift",a=>{v(a)&&i()},{exactMatch:!0,useCapture:!0,events:["keydown"]}),(0,aS.useKeyPress)(a=>"Shift"===a.key,a=>{v(a)&&j()},{exactMatch:!0,useCapture:!0,events:["keyup"]}),(0,c.useEffect)(()=>{let a=()=>{r()};return window.addEventListener(aT.ZEN_TOGGLE_EVENT,a),()=>{window.removeEventListener(aT.ZEN_TOGGLE_EVENT,a)}},[r])};a.s(["useWorkflowMode",0,()=>{let a=v(a=>a.historyWorkflowData),b=v(a=>a.isRestoring);return(0,c.useMemo)(()=>({normal:!a&&!b,restoring:b,viewHistory:!!a}),[a,b])}],471068),a.s(["useWorkflowRefreshDraft",0,()=>({handleRefreshWorkflowDraft:o(a=>a.handleRefreshWorkflowDraft)})],364573),a.s(["useWorkflowRun",0,()=>{let a=o(a=>a.handleBackupDraft),b=o(a=>a.handleLoadBackupDraft),c=o(a=>a.handleRestoreFromPublishedWorkflow);return{handleBackupDraft:a,handleLoadBackupDraft:b,handleRun:o(a=>a.handleRun),handleStopRun:o(a=>a.handleStopRun),handleRestoreFromPublishedWorkflow:c}}],621865),a.s(["useWorkflowSearch",()=>a7],404740);var a4=a.i(589269),a5=a.i(438961),a6=a.i(791881);let a7=()=>{let a=(0,d.useNodes)(),{handleNodeSelect:b}=aP(),{data:e}=(0,y.useAllBuiltInTools)(),{data:g}=(0,y.useAllCustomTools)(),{data:h}=(0,y.useAllWorkflowTools)(),{data:k}=(0,y.useAllMCPTools)(),l=(0,c.useCallback)(a=>{if(a?.type!==f.BlockEnum.Tool)return;let b={[i.CollectionType.builtIn]:e||[],[i.CollectionType.custom]:g||[],[i.CollectionType.mcp]:k||[]},c=a.provider_type&&b[a.provider_type]||h;return c?.find(b=>(0,z.canFindTool)(b.id,a.provider_id))?.icon},[e,g,h,k]),m=(0,c.useCallback)(a=>a?.type!==f.BlockEnum.LLM?{}:a.model?{provider:a.model.provider,name:a.model.name,mode:a.model.mode}:{},[]),n=(0,c.useMemo)(()=>a.filter(a=>{if(!a.id||!a.data||"sticky"===a.type)return!1;let b=a.data;return!["iteration-start","loop-start"].includes(b?.type)}).map(a=>{let b=a.data;return{id:a.id,title:b?.title||b?.type||"Untitled",type:b?.type||"",desc:b?.desc||"",blockType:b?.type,nodeData:b,toolIcon:l(b),modelInfo:m(b)}}),[a,l,m]),o=(0,c.useCallback)((a,b)=>{if(!b)return 1;let c=a.title.toLowerCase(),d=a.type.toLowerCase(),e=a.desc?.toLowerCase()||"",f=a.modelInfo?.provider?.toLowerCase()||"",g=a.modelInfo?.name?.toLowerCase()||"",h=a.modelInfo?.mode?.toLowerCase()||"",i=0;return c.startsWith(b)?i+=100:c.includes(b)&&(i+=50),d===b?i+=80:d.includes(b)&&(i+=30),e.includes(b)&&(i+=20),g&&g.includes(b)&&(i+=60),f&&f.includes(b)&&(i+=40),h&&h.includes(b)&&(i+=30),i},[]),p=(0,c.useCallback)(a=>{if(!n.length)return[];let b=a.toLowerCase().trim();return n.map(a=>{let c=o(a,b);return c>0?{id:a.id,title:a.title,description:a.desc||a.type,type:"workflow-node",path:`#${a.id}`,icon:(0,j.jsx)(a5.default,{type:a.blockType,className:"shrink-0",size:"sm",toolIcon:a.toolIcon}),metadata:{nodeId:a.id,nodeData:a.nodeData},data:a.nodeData,score:c}:null}).filter(a=>null!==a).sort((a,c)=>b?(c.score||0)-(a.score||0):a.title.localeCompare(c.title))},[n,o]);return(0,c.useEffect)(()=>(n.length>0&&(a4.workflowNodesAction.searchFn=p),()=>{a4.workflowNodesAction.searchFn=void 0}),[n,p]),(0,c.useEffect)(()=>(0,a6.setupNodeSelectionListener)(b),[b]),null};a.s(["useWorkflowStartRun",0,()=>{let a=o(a=>a.handleStartWorkflowRun),b=o(a=>a.handleWorkflowStartRunInWorkflow),c=o(a=>a.handleWorkflowStartRunInChatflow),d=o(a=>a.handleWorkflowTriggerScheduleRunInWorkflow),e=o(a=>a.handleWorkflowTriggerWebhookRunInWorkflow);return{handleStartWorkflowRun:a,handleWorkflowStartRunInWorkflow:b,handleWorkflowStartRunInChatflow:c,handleWorkflowTriggerScheduleRunInWorkflow:d,handleWorkflowTriggerWebhookRunInWorkflow:e,handleWorkflowTriggerPluginRunInWorkflow:o(a=>a.handleWorkflowTriggerPluginRunInWorkflow),handleWorkflowRunAllTriggersInWorkflow:o(a=>a.handleWorkflowRunAllTriggersInWorkflow)}}],412795)},849546,880808,a=>{"use strict";a.i(529638);var b=a.i(829781),c=a.i(35176);a.i(412708);var d=a.i(851571),e=a.i(735310),f=a.i(827460);let g=a=>({[f.PipelineInputVarType.number]:e.VarType.number,[f.PipelineInputVarType.singleFile]:e.VarType.file,[f.PipelineInputVarType.multiFiles]:e.VarType.arrayFile,[f.PipelineInputVarType.checkbox]:e.VarType.boolean})[a]||e.VarType.string;var h=a.i(970502);let i=a=>{let{getNodes:b}=(0,h.useStoreApi)().getState(),c=b(),d=c.find(b=>b.id===a),e=!!d?.data.isInIteration,f=!!d?.data.isInLoop,g=d?.parentId;return{node:d,isInIteration:e,isInLoop:f,parentNode:c.find(a=>a.id===g)}};a.s(["default",0,i],880808),a.s(["default",0,(a,{onlyLeafNodeVar:f,filterVar:h,hideEnv:j,hideChatVar:k,passedInAvailableNodes:l}={onlyLeafNodeVar:!1,filterVar:()=>!0})=>{let{getTreeLeafNodes:m,getNodeById:n,getBeforeNodesInSameBranchIncludeParent:o}=(0,b.useWorkflow)(),{getNodeAvailableVars:p}=(0,c.useWorkflowVariables)(),q=(0,b.useIsChatMode)(),r=l||(f?m(a):o(a)),{parentNode:s}=i(a),t=n(a),u=(0,d.useStore)(a=>a.ragPipelineVariables),v=t?.data?.type===e.BlockEnum.DataSource,w=[];if(v){let b=u?.filter(b=>b.belong_to_node_id===a),c=b?.filter(b=>h({variable:b.variable,type:g(b.type),nodeId:a,isRagVariable:!0},["rag",a,b.variable]));c?.length&&w.push({nodeId:a,title:t.data?.title,vars:c.map(b=>({variable:`rag.${a}.${b.variable}`,type:g(b.type),description:b.label,isRagVariable:!0}))})}return{availableVars:[...p({parentNode:s,beforeNodes:r,isChatMode:q,filterVar:h,hideEnv:j,hideChatVar:k}),...w],availableNodes:r,availableNodesWithParent:[...r,...v?[t]:[]]}}],849546)},33968,760581,a=>{"use strict";var b=a.i(942789);a.s(["CodeAssistant",()=>b.default],33968);var c=a.i(513437);a.s(["MagicEdit",()=>c.default],760581)},680904,a=>{"use strict";let b;a.s([],75443),a.i(75443),(bh=bk||(bk={})).assertEqual=a=>{},bh.assertIs=function(a){},bh.assertNever=function(a){throw Error()},bh.arrayToEnum=a=>{let b={};for(let c of a)b[c]=c;return b},bh.getValidEnumValues=a=>{let b=bh.objectKeys(a).filter(b=>"number"!=typeof a[a[b]]),c={};for(let d of b)c[d]=a[d];return bh.objectValues(c)},bh.objectValues=a=>bh.objectKeys(a).map(function(b){return a[b]}),bh.objectKeys="function"==typeof Object.keys?a=>Object.keys(a):a=>{let b=[];for(let c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(c);return b},bh.find=(a,b)=>{for(let c of a)if(b(c))return c},bh.isInteger="function"==typeof Number.isInteger?a=>Number.isInteger(a):a=>"number"==typeof a&&Number.isFinite(a)&&Math.floor(a)===a,bh.joinValues=function(a,b=" | "){return a.map(a=>"string"==typeof a?`'${a}'`:a).join(b)},bh.jsonStringifyReplacer=(a,b)=>"bigint"==typeof b?b.toString():b,(bl||(bl={})).mergeShapes=(a,b)=>({...a,...b});let c=bk.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),d=a=>{switch(typeof a){case"undefined":return c.undefined;case"string":return c.string;case"number":return Number.isNaN(a)?c.nan:c.number;case"boolean":return c.boolean;case"function":return c.function;case"bigint":return c.bigint;case"symbol":return c.symbol;case"object":if(Array.isArray(a))return c.array;if(null===a)return c.null;if(a.then&&"function"==typeof a.then&&a.catch&&"function"==typeof a.catch)return c.promise;if("u">typeof Map&&a instanceof Map)return c.map;if("u">typeof Set&&a instanceof Set)return c.set;if("u">typeof Date&&a instanceof Date)return c.date;return c.object;default:return c.unknown}};a.s(["ZodParsedType",0,c,"getParsedType",0,d,"objectUtil",()=>bl,"util",()=>bk],442010);let e=bk.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),f=a=>JSON.stringify(a,null,2).replace(/"([^"]+)":/g,"$1:");class g extends Error{get errors(){return this.issues}constructor(a){super(),this.issues=[],this.addIssue=a=>{this.issues=[...this.issues,a]},this.addIssues=(a=[])=>{this.issues=[...this.issues,...a]};const b=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,b):this.__proto__=b,this.name="ZodError",this.issues=a}format(a){let b=a||function(a){return a.message},c={_errors:[]},d=a=>{for(let e of a.issues)if("invalid_union"===e.code)e.unionErrors.map(d);else if("invalid_return_type"===e.code)d(e.returnTypeError);else if("invalid_arguments"===e.code)d(e.argumentsError);else if(0===e.path.length)c._errors.push(b(e));else{let a=c,d=0;for(;d<e.path.length;){let c=e.path[d];d===e.path.length-1?(a[c]=a[c]||{_errors:[]},a[c]._errors.push(b(e))):a[c]=a[c]||{_errors:[]},a=a[c],d++}}};return d(this),c}static assert(a){if(!(a instanceof g))throw Error(`Not a ZodError: ${a}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,bk.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(a=a=>a.message){let b={},c=[];for(let d of this.issues)if(d.path.length>0){let c=d.path[0];b[c]=b[c]||[],b[c].push(a(d))}else c.push(a(d));return{formErrors:c,fieldErrors:b}}get formErrors(){return this.flatten()}}g.create=a=>new g(a),a.s(["ZodError",()=>g,"ZodIssueCode",0,e,"quotelessJson",0,f],611521);let h=(a,b)=>{let d;switch(a.code){case e.invalid_type:d=a.received===c.undefined?"Required":`Expected ${a.expected}, received ${a.received}`;break;case e.invalid_literal:d=`Invalid literal value, expected ${JSON.stringify(a.expected,bk.jsonStringifyReplacer)}`;break;case e.unrecognized_keys:d=`Unrecognized key(s) in object: ${bk.joinValues(a.keys,", ")}`;break;case e.invalid_union:d="Invalid input";break;case e.invalid_union_discriminator:d=`Invalid discriminator value. Expected ${bk.joinValues(a.options)}`;break;case e.invalid_enum_value:d=`Invalid enum value. Expected ${bk.joinValues(a.options)}, received '${a.received}'`;break;case e.invalid_arguments:d="Invalid function arguments";break;case e.invalid_return_type:d="Invalid function return type";break;case e.invalid_date:d="Invalid date";break;case e.invalid_string:"object"==typeof a.validation?"includes"in a.validation?(d=`Invalid input: must include "${a.validation.includes}"`,"number"==typeof a.validation.position&&(d=`${d} at one or more positions greater than or equal to ${a.validation.position}`)):"startsWith"in a.validation?d=`Invalid input: must start with "${a.validation.startsWith}"`:"endsWith"in a.validation?d=`Invalid input: must end with "${a.validation.endsWith}"`:bk.assertNever(a.validation):d="regex"!==a.validation?`Invalid ${a.validation}`:"Invalid";break;case e.too_small:d="array"===a.type?`Array must contain ${a.exact?"exactly":a.inclusive?"at least":"more than"} ${a.minimum} element(s)`:"string"===a.type?`String must contain ${a.exact?"exactly":a.inclusive?"at least":"over"} ${a.minimum} character(s)`:"number"===a.type||"bigint"===a.type?`Number must be ${a.exact?"exactly equal to ":a.inclusive?"greater than or equal to ":"greater than "}${a.minimum}`:"date"===a.type?`Date must be ${a.exact?"exactly equal to ":a.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(a.minimum))}`:"Invalid input";break;case e.too_big:d="array"===a.type?`Array must contain ${a.exact?"exactly":a.inclusive?"at most":"less than"} ${a.maximum} element(s)`:"string"===a.type?`String must contain ${a.exact?"exactly":a.inclusive?"at most":"under"} ${a.maximum} character(s)`:"number"===a.type?`Number must be ${a.exact?"exactly":a.inclusive?"less than or equal to":"less than"} ${a.maximum}`:"bigint"===a.type?`BigInt must be ${a.exact?"exactly":a.inclusive?"less than or equal to":"less than"} ${a.maximum}`:"date"===a.type?`Date must be ${a.exact?"exactly":a.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(a.maximum))}`:"Invalid input";break;case e.custom:d="Invalid input";break;case e.invalid_intersection_types:d="Intersection results could not be merged";break;case e.not_multiple_of:d=`Number must be a multiple of ${a.multipleOf}`;break;case e.not_finite:d="Number must be finite";break;default:d=b.defaultError,bk.assertNever(a)}return{message:d}},i=h;function j(a){i=a}function k(){return i}a.s(["getErrorMap",()=>k,"setErrorMap",()=>j],292356),a.i(292356),a.s(["defaultErrorMap",0,h,"getErrorMap",()=>k,"setErrorMap",()=>j],817118),a.i(817118);let l=a=>{let{data:b,path:c,errorMaps:d,issueData:e}=a,f=[...c,...e.path||[]],g={...e,path:f};if(void 0!==e.message)return{...e,path:f,message:e.message};let h="";for(let a of d.filter(a=>!!a).slice().reverse())h=a(g,{data:b,defaultError:h}).message;return{...e,path:f,message:h}},m=[];function n(a,b){let c=i,d=l({issueData:b,data:a.data,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,c,c===h?void 0:h].filter(a=>!!a)});a.common.issues.push(d)}class o{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(a,b){let c=[];for(let d of b){if("aborted"===d.status)return p;"dirty"===d.status&&a.dirty(),c.push(d.value)}return{status:a.value,value:c}}static async mergeObjectAsync(a,b){let c=[];for(let a of b){let b=await a.key,d=await a.value;c.push({key:b,value:d})}return o.mergeObjectSync(a,c)}static mergeObjectSync(a,b){let c={};for(let d of b){let{key:b,value:e}=d;if("aborted"===b.status||"aborted"===e.status)return p;"dirty"===b.status&&a.dirty(),"dirty"===e.status&&a.dirty(),"__proto__"!==b.value&&(void 0!==e.value||d.alwaysSet)&&(c[b.value]=e.value)}return{status:a.value,value:c}}}let p=Object.freeze({status:"aborted"}),q=a=>({status:"dirty",value:a}),r=a=>({status:"valid",value:a}),s=a=>"aborted"===a.status,t=a=>"dirty"===a.status,u=a=>"valid"===a.status,v=a=>"u">typeof Promise&&a instanceof Promise;a.s(["DIRTY",0,q,"EMPTY_PATH",0,m,"INVALID",0,p,"OK",0,r,"ParseStatus",()=>o,"addIssueToContext",()=>n,"isAborted",0,s,"isAsync",0,v,"isDirty",0,t,"isValid",0,u,"makeIssue",0,l],11099),a.i(11099),a.s([],983418),a.i(983418),a.i(442010),(bi=bm||(bm={})).errToObj=a=>"string"==typeof a?{message:a}:a||{},bi.toString=a=>"string"==typeof a?a:a?.message;class w{constructor(a,b,c,d){this._cachedPath=[],this.parent=a,this.data=b,this._path=c,this._key=d}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let x=(a,b)=>{if(u(b))return{success:!0,data:b.value};if(!a.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let b=new g(a.common.issues);return this._error=b,this._error}}};function y(a){if(!a)return{};let{errorMap:b,invalid_type_error:c,required_error:d,description:e}=a;if(b&&(c||d))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return b?{errorMap:b,description:e}:{errorMap:(b,e)=>{let{message:f}=a;return"invalid_enum_value"===b.code?{message:f??e.defaultError}:void 0===e.data?{message:f??d??e.defaultError}:"invalid_type"!==b.code?{message:e.defaultError}:{message:f??c??e.defaultError}},description:e}}class z{get description(){return this._def.description}_getType(a){return d(a.data)}_getOrReturnCtx(a,b){return b||{common:a.parent.common,data:a.data,parsedType:d(a.data),schemaErrorMap:this._def.errorMap,path:a.path,parent:a.parent}}_processInputParams(a){return{status:new o,ctx:{common:a.parent.common,data:a.data,parsedType:d(a.data),schemaErrorMap:this._def.errorMap,path:a.path,parent:a.parent}}}_parseSync(a){let b=this._parse(a);if(v(b))throw Error("Synchronous parse encountered promise.");return b}_parseAsync(a){return Promise.resolve(this._parse(a))}parse(a,b){let c=this.safeParse(a,b);if(c.success)return c.data;throw c.error}safeParse(a,b){let c={common:{issues:[],async:b?.async??!1,contextualErrorMap:b?.errorMap},path:b?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:a,parsedType:d(a)},e=this._parseSync({data:a,path:c.path,parent:c});return x(c,e)}"~validate"(a){let b={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:a,parsedType:d(a)};if(!this["~standard"].async)try{let c=this._parseSync({data:a,path:[],parent:b});return u(c)?{value:c.value}:{issues:b.common.issues}}catch(a){a?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),b.common={issues:[],async:!0}}return this._parseAsync({data:a,path:[],parent:b}).then(a=>u(a)?{value:a.value}:{issues:b.common.issues})}async parseAsync(a,b){let c=await this.safeParseAsync(a,b);if(c.success)return c.data;throw c.error}async safeParseAsync(a,b){let c={common:{issues:[],contextualErrorMap:b?.errorMap,async:!0},path:b?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:a,parsedType:d(a)},e=this._parse({data:a,path:c.path,parent:c});return x(c,await (v(e)?e:Promise.resolve(e)))}refine(a,b){return this._refinement((c,d)=>{let f=a(c),g=()=>d.addIssue({code:e.custom,..."string"==typeof b||void 0===b?{message:b}:"function"==typeof b?b(c):b});return"u">typeof Promise&&f instanceof Promise?f.then(a=>!!a||(g(),!1)):!!f||(g(),!1)})}refinement(a,b){return this._refinement((c,d)=>!!a(c)||(d.addIssue("function"==typeof b?b(c,d):b),!1))}_refinement(a){return new at({schema:this,typeName:bn.ZodEffects,effect:{type:"refinement",refinement:a}})}superRefine(a){return this._refinement(a)}constructor(a){this.spa=this.safeParseAsync,this._def=a,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:a=>this["~validate"](a)}}optional(){return au.create(this,this._def)}nullable(){return av.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ac.create(this)}promise(){return as.create(this,this._def)}or(a){return ae.create([this,a],this._def)}and(a){return ah.create(this,a,this._def)}transform(a){return new at({...y(this._def),schema:this,typeName:bn.ZodEffects,effect:{type:"transform",transform:a}})}default(a){return new aw({...y(this._def),innerType:this,defaultValue:"function"==typeof a?a:()=>a,typeName:bn.ZodDefault})}brand(){return new aA({typeName:bn.ZodBranded,type:this,...y(this._def)})}catch(a){return new ax({...y(this._def),innerType:this,catchValue:"function"==typeof a?a:()=>a,typeName:bn.ZodCatch})}describe(a){return new this.constructor({...this._def,description:a})}pipe(a){return aB.create(this,a)}readonly(){return aC.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}let A=/^c[^\s-]{8,}$/i,B=/^[0-9a-z]+$/,C=/^[0-9A-HJKMNP-TV-Z]{26}$/i,D=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,E=/^[a-z0-9_-]{21}$/i,F=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,G=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,H=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,I=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,J=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,K=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,L=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,M=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,N=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,O="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",P=RegExp(`^${O}$`);function Q(a){let b="[0-5]\\d";a.precision?b=`${b}\\.\\d{${a.precision}}`:null==a.precision&&(b=`${b}(\\.\\d+)?`);let c=a.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${b})${c}`}function R(a){let b=`${O}T${Q(a)}`,c=[];return c.push(a.local?"Z?":"Z"),a.offset&&c.push("([+-]\\d{2}:?\\d{2})"),b=`${b}(${c.join("|")})`,RegExp(`^${b}$`)}class S extends z{_parse(a){var d,f,g,h;let i;if(this._def.coerce&&(a.data=String(a.data)),this._getType(a)!==c.string){let b=this._getOrReturnCtx(a);return n(b,{code:e.invalid_type,expected:c.string,received:b.parsedType}),p}let j=new o;for(let c of this._def.checks)if("min"===c.kind)a.data.length<c.value&&(n(i=this._getOrReturnCtx(a,i),{code:e.too_small,minimum:c.value,type:"string",inclusive:!0,exact:!1,message:c.message}),j.dirty());else if("max"===c.kind)a.data.length>c.value&&(n(i=this._getOrReturnCtx(a,i),{code:e.too_big,maximum:c.value,type:"string",inclusive:!0,exact:!1,message:c.message}),j.dirty());else if("length"===c.kind){let b=a.data.length>c.value,d=a.data.length<c.value;(b||d)&&(i=this._getOrReturnCtx(a,i),b?n(i,{code:e.too_big,maximum:c.value,type:"string",inclusive:!0,exact:!0,message:c.message}):d&&n(i,{code:e.too_small,minimum:c.value,type:"string",inclusive:!0,exact:!0,message:c.message}),j.dirty())}else if("email"===c.kind)H.test(a.data)||(n(i=this._getOrReturnCtx(a,i),{validation:"email",code:e.invalid_string,message:c.message}),j.dirty());else if("emoji"===c.kind)b||(b=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),b.test(a.data)||(n(i=this._getOrReturnCtx(a,i),{validation:"emoji",code:e.invalid_string,message:c.message}),j.dirty());else if("uuid"===c.kind)D.test(a.data)||(n(i=this._getOrReturnCtx(a,i),{validation:"uuid",code:e.invalid_string,message:c.message}),j.dirty());else if("nanoid"===c.kind)E.test(a.data)||(n(i=this._getOrReturnCtx(a,i),{validation:"nanoid",code:e.invalid_string,message:c.message}),j.dirty());else if("cuid"===c.kind)A.test(a.data)||(n(i=this._getOrReturnCtx(a,i),{validation:"cuid",code:e.invalid_string,message:c.message}),j.dirty());else if("cuid2"===c.kind)B.test(a.data)||(n(i=this._getOrReturnCtx(a,i),{validation:"cuid2",code:e.invalid_string,message:c.message}),j.dirty());else if("ulid"===c.kind)C.test(a.data)||(n(i=this._getOrReturnCtx(a,i),{validation:"ulid",code:e.invalid_string,message:c.message}),j.dirty());else if("url"===c.kind)try{new URL(a.data)}catch{n(i=this._getOrReturnCtx(a,i),{validation:"url",code:e.invalid_string,message:c.message}),j.dirty()}else"regex"===c.kind?(c.regex.lastIndex=0,c.regex.test(a.data)||(n(i=this._getOrReturnCtx(a,i),{validation:"regex",code:e.invalid_string,message:c.message}),j.dirty())):"trim"===c.kind?a.data=a.data.trim():"includes"===c.kind?a.data.includes(c.value,c.position)||(n(i=this._getOrReturnCtx(a,i),{code:e.invalid_string,validation:{includes:c.value,position:c.position},message:c.message}),j.dirty()):"toLowerCase"===c.kind?a.data=a.data.toLowerCase():"toUpperCase"===c.kind?a.data=a.data.toUpperCase():"startsWith"===c.kind?a.data.startsWith(c.value)||(n(i=this._getOrReturnCtx(a,i),{code:e.invalid_string,validation:{startsWith:c.value},message:c.message}),j.dirty()):"endsWith"===c.kind?a.data.endsWith(c.value)||(n(i=this._getOrReturnCtx(a,i),{code:e.invalid_string,validation:{endsWith:c.value},message:c.message}),j.dirty()):"datetime"===c.kind?R(c).test(a.data)||(n(i=this._getOrReturnCtx(a,i),{code:e.invalid_string,validation:"datetime",message:c.message}),j.dirty()):"date"===c.kind?P.test(a.data)||(n(i=this._getOrReturnCtx(a,i),{code:e.invalid_string,validation:"date",message:c.message}),j.dirty()):"time"===c.kind?RegExp(`^${Q(c)}$`).test(a.data)||(n(i=this._getOrReturnCtx(a,i),{code:e.invalid_string,validation:"time",message:c.message}),j.dirty()):"duration"===c.kind?G.test(a.data)||(n(i=this._getOrReturnCtx(a,i),{validation:"duration",code:e.invalid_string,message:c.message}),j.dirty()):"ip"===c.kind?(d=a.data,!(("v4"===(f=c.version)||!f)&&I.test(d)||("v6"===f||!f)&&K.test(d))&&1&&(n(i=this._getOrReturnCtx(a,i),{validation:"ip",code:e.invalid_string,message:c.message}),j.dirty())):"jwt"===c.kind?!function(a,b){if(!F.test(a))return!1;try{let[c]=a.split(".");if(!c)return!1;let d=c.replace(/-/g,"+").replace(/_/g,"/").padEnd(c.length+(4-c.length%4)%4,"="),e=JSON.parse(atob(d));if("object"!=typeof e||null===e||"typ"in e&&e?.typ!=="JWT"||!e.alg||b&&e.alg!==b)return!1;return!0}catch{return!1}}(a.data,c.alg)&&(n(i=this._getOrReturnCtx(a,i),{validation:"jwt",code:e.invalid_string,message:c.message}),j.dirty()):"cidr"===c.kind?(g=a.data,!(("v4"===(h=c.version)||!h)&&J.test(g)||("v6"===h||!h)&&L.test(g))&&1&&(n(i=this._getOrReturnCtx(a,i),{validation:"cidr",code:e.invalid_string,message:c.message}),j.dirty())):"base64"===c.kind?M.test(a.data)||(n(i=this._getOrReturnCtx(a,i),{validation:"base64",code:e.invalid_string,message:c.message}),j.dirty()):"base64url"===c.kind?N.test(a.data)||(n(i=this._getOrReturnCtx(a,i),{validation:"base64url",code:e.invalid_string,message:c.message}),j.dirty()):bk.assertNever(c);return{status:j.value,value:a.data}}_regex(a,b,c){return this.refinement(b=>a.test(b),{validation:b,code:e.invalid_string,...bm.errToObj(c)})}_addCheck(a){return new S({...this._def,checks:[...this._def.checks,a]})}email(a){return this._addCheck({kind:"email",...bm.errToObj(a)})}url(a){return this._addCheck({kind:"url",...bm.errToObj(a)})}emoji(a){return this._addCheck({kind:"emoji",...bm.errToObj(a)})}uuid(a){return this._addCheck({kind:"uuid",...bm.errToObj(a)})}nanoid(a){return this._addCheck({kind:"nanoid",...bm.errToObj(a)})}cuid(a){return this._addCheck({kind:"cuid",...bm.errToObj(a)})}cuid2(a){return this._addCheck({kind:"cuid2",...bm.errToObj(a)})}ulid(a){return this._addCheck({kind:"ulid",...bm.errToObj(a)})}base64(a){return this._addCheck({kind:"base64",...bm.errToObj(a)})}base64url(a){return this._addCheck({kind:"base64url",...bm.errToObj(a)})}jwt(a){return this._addCheck({kind:"jwt",...bm.errToObj(a)})}ip(a){return this._addCheck({kind:"ip",...bm.errToObj(a)})}cidr(a){return this._addCheck({kind:"cidr",...bm.errToObj(a)})}datetime(a){return"string"==typeof a?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:a}):this._addCheck({kind:"datetime",precision:void 0===a?.precision?null:a?.precision,offset:a?.offset??!1,local:a?.local??!1,...bm.errToObj(a?.message)})}date(a){return this._addCheck({kind:"date",message:a})}time(a){return"string"==typeof a?this._addCheck({kind:"time",precision:null,message:a}):this._addCheck({kind:"time",precision:void 0===a?.precision?null:a?.precision,...bm.errToObj(a?.message)})}duration(a){return this._addCheck({kind:"duration",...bm.errToObj(a)})}regex(a,b){return this._addCheck({kind:"regex",regex:a,...bm.errToObj(b)})}includes(a,b){return this._addCheck({kind:"includes",value:a,position:b?.position,...bm.errToObj(b?.message)})}startsWith(a,b){return this._addCheck({kind:"startsWith",value:a,...bm.errToObj(b)})}endsWith(a,b){return this._addCheck({kind:"endsWith",value:a,...bm.errToObj(b)})}min(a,b){return this._addCheck({kind:"min",value:a,...bm.errToObj(b)})}max(a,b){return this._addCheck({kind:"max",value:a,...bm.errToObj(b)})}length(a,b){return this._addCheck({kind:"length",value:a,...bm.errToObj(b)})}nonempty(a){return this.min(1,bm.errToObj(a))}trim(){return new S({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new S({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new S({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(a=>"datetime"===a.kind)}get isDate(){return!!this._def.checks.find(a=>"date"===a.kind)}get isTime(){return!!this._def.checks.find(a=>"time"===a.kind)}get isDuration(){return!!this._def.checks.find(a=>"duration"===a.kind)}get isEmail(){return!!this._def.checks.find(a=>"email"===a.kind)}get isURL(){return!!this._def.checks.find(a=>"url"===a.kind)}get isEmoji(){return!!this._def.checks.find(a=>"emoji"===a.kind)}get isUUID(){return!!this._def.checks.find(a=>"uuid"===a.kind)}get isNANOID(){return!!this._def.checks.find(a=>"nanoid"===a.kind)}get isCUID(){return!!this._def.checks.find(a=>"cuid"===a.kind)}get isCUID2(){return!!this._def.checks.find(a=>"cuid2"===a.kind)}get isULID(){return!!this._def.checks.find(a=>"ulid"===a.kind)}get isIP(){return!!this._def.checks.find(a=>"ip"===a.kind)}get isCIDR(){return!!this._def.checks.find(a=>"cidr"===a.kind)}get isBase64(){return!!this._def.checks.find(a=>"base64"===a.kind)}get isBase64url(){return!!this._def.checks.find(a=>"base64url"===a.kind)}get minLength(){let a=null;for(let b of this._def.checks)"min"===b.kind&&(null===a||b.value>a)&&(a=b.value);return a}get maxLength(){let a=null;for(let b of this._def.checks)"max"===b.kind&&(null===a||b.value<a)&&(a=b.value);return a}}S.create=a=>new S({checks:[],typeName:bn.ZodString,coerce:a?.coerce??!1,...y(a)});class T extends z{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(a){let b;if(this._def.coerce&&(a.data=Number(a.data)),this._getType(a)!==c.number){let b=this._getOrReturnCtx(a);return n(b,{code:e.invalid_type,expected:c.number,received:b.parsedType}),p}let d=new o;for(let c of this._def.checks)"int"===c.kind?bk.isInteger(a.data)||(n(b=this._getOrReturnCtx(a,b),{code:e.invalid_type,expected:"integer",received:"float",message:c.message}),d.dirty()):"min"===c.kind?(c.inclusive?a.data<c.value:a.data<=c.value)&&(n(b=this._getOrReturnCtx(a,b),{code:e.too_small,minimum:c.value,type:"number",inclusive:c.inclusive,exact:!1,message:c.message}),d.dirty()):"max"===c.kind?(c.inclusive?a.data>c.value:a.data>=c.value)&&(n(b=this._getOrReturnCtx(a,b),{code:e.too_big,maximum:c.value,type:"number",inclusive:c.inclusive,exact:!1,message:c.message}),d.dirty()):"multipleOf"===c.kind?0!==function(a,b){let c=(a.toString().split(".")[1]||"").length,d=(b.toString().split(".")[1]||"").length,e=c>d?c:d;return Number.parseInt(a.toFixed(e).replace(".",""))%Number.parseInt(b.toFixed(e).replace(".",""))/10**e}(a.data,c.value)&&(n(b=this._getOrReturnCtx(a,b),{code:e.not_multiple_of,multipleOf:c.value,message:c.message}),d.dirty()):"finite"===c.kind?Number.isFinite(a.data)||(n(b=this._getOrReturnCtx(a,b),{code:e.not_finite,message:c.message}),d.dirty()):bk.assertNever(c);return{status:d.value,value:a.data}}gte(a,b){return this.setLimit("min",a,!0,bm.toString(b))}gt(a,b){return this.setLimit("min",a,!1,bm.toString(b))}lte(a,b){return this.setLimit("max",a,!0,bm.toString(b))}lt(a,b){return this.setLimit("max",a,!1,bm.toString(b))}setLimit(a,b,c,d){return new T({...this._def,checks:[...this._def.checks,{kind:a,value:b,inclusive:c,message:bm.toString(d)}]})}_addCheck(a){return new T({...this._def,checks:[...this._def.checks,a]})}int(a){return this._addCheck({kind:"int",message:bm.toString(a)})}positive(a){return this._addCheck({kind:"min",value:0,inclusive:!1,message:bm.toString(a)})}negative(a){return this._addCheck({kind:"max",value:0,inclusive:!1,message:bm.toString(a)})}nonpositive(a){return this._addCheck({kind:"max",value:0,inclusive:!0,message:bm.toString(a)})}nonnegative(a){return this._addCheck({kind:"min",value:0,inclusive:!0,message:bm.toString(a)})}multipleOf(a,b){return this._addCheck({kind:"multipleOf",value:a,message:bm.toString(b)})}finite(a){return this._addCheck({kind:"finite",message:bm.toString(a)})}safe(a){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:bm.toString(a)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:bm.toString(a)})}get minValue(){let a=null;for(let b of this._def.checks)"min"===b.kind&&(null===a||b.value>a)&&(a=b.value);return a}get maxValue(){let a=null;for(let b of this._def.checks)"max"===b.kind&&(null===a||b.value<a)&&(a=b.value);return a}get isInt(){return!!this._def.checks.find(a=>"int"===a.kind||"multipleOf"===a.kind&&bk.isInteger(a.value))}get isFinite(){let a=null,b=null;for(let c of this._def.checks)if("finite"===c.kind||"int"===c.kind||"multipleOf"===c.kind)return!0;else"min"===c.kind?(null===b||c.value>b)&&(b=c.value):"max"===c.kind&&(null===a||c.value<a)&&(a=c.value);return Number.isFinite(b)&&Number.isFinite(a)}}T.create=a=>new T({checks:[],typeName:bn.ZodNumber,coerce:a?.coerce||!1,...y(a)});class U extends z{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(a){let b;if(this._def.coerce)try{a.data=BigInt(a.data)}catch{return this._getInvalidInput(a)}if(this._getType(a)!==c.bigint)return this._getInvalidInput(a);let d=new o;for(let c of this._def.checks)"min"===c.kind?(c.inclusive?a.data<c.value:a.data<=c.value)&&(n(b=this._getOrReturnCtx(a,b),{code:e.too_small,type:"bigint",minimum:c.value,inclusive:c.inclusive,message:c.message}),d.dirty()):"max"===c.kind?(c.inclusive?a.data>c.value:a.data>=c.value)&&(n(b=this._getOrReturnCtx(a,b),{code:e.too_big,type:"bigint",maximum:c.value,inclusive:c.inclusive,message:c.message}),d.dirty()):"multipleOf"===c.kind?a.data%c.value!==BigInt(0)&&(n(b=this._getOrReturnCtx(a,b),{code:e.not_multiple_of,multipleOf:c.value,message:c.message}),d.dirty()):bk.assertNever(c);return{status:d.value,value:a.data}}_getInvalidInput(a){let b=this._getOrReturnCtx(a);return n(b,{code:e.invalid_type,expected:c.bigint,received:b.parsedType}),p}gte(a,b){return this.setLimit("min",a,!0,bm.toString(b))}gt(a,b){return this.setLimit("min",a,!1,bm.toString(b))}lte(a,b){return this.setLimit("max",a,!0,bm.toString(b))}lt(a,b){return this.setLimit("max",a,!1,bm.toString(b))}setLimit(a,b,c,d){return new U({...this._def,checks:[...this._def.checks,{kind:a,value:b,inclusive:c,message:bm.toString(d)}]})}_addCheck(a){return new U({...this._def,checks:[...this._def.checks,a]})}positive(a){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:bm.toString(a)})}negative(a){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:bm.toString(a)})}nonpositive(a){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:bm.toString(a)})}nonnegative(a){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:bm.toString(a)})}multipleOf(a,b){return this._addCheck({kind:"multipleOf",value:a,message:bm.toString(b)})}get minValue(){let a=null;for(let b of this._def.checks)"min"===b.kind&&(null===a||b.value>a)&&(a=b.value);return a}get maxValue(){let a=null;for(let b of this._def.checks)"max"===b.kind&&(null===a||b.value<a)&&(a=b.value);return a}}U.create=a=>new U({checks:[],typeName:bn.ZodBigInt,coerce:a?.coerce??!1,...y(a)});class V extends z{_parse(a){if(this._def.coerce&&(a.data=!!a.data),this._getType(a)!==c.boolean){let b=this._getOrReturnCtx(a);return n(b,{code:e.invalid_type,expected:c.boolean,received:b.parsedType}),p}return r(a.data)}}V.create=a=>new V({typeName:bn.ZodBoolean,coerce:a?.coerce||!1,...y(a)});class W extends z{_parse(a){let b;if(this._def.coerce&&(a.data=new Date(a.data)),this._getType(a)!==c.date){let b=this._getOrReturnCtx(a);return n(b,{code:e.invalid_type,expected:c.date,received:b.parsedType}),p}if(Number.isNaN(a.data.getTime()))return n(this._getOrReturnCtx(a),{code:e.invalid_date}),p;let d=new o;for(let c of this._def.checks)"min"===c.kind?a.data.getTime()<c.value&&(n(b=this._getOrReturnCtx(a,b),{code:e.too_small,message:c.message,inclusive:!0,exact:!1,minimum:c.value,type:"date"}),d.dirty()):"max"===c.kind?a.data.getTime()>c.value&&(n(b=this._getOrReturnCtx(a,b),{code:e.too_big,message:c.message,inclusive:!0,exact:!1,maximum:c.value,type:"date"}),d.dirty()):bk.assertNever(c);return{status:d.value,value:new Date(a.data.getTime())}}_addCheck(a){return new W({...this._def,checks:[...this._def.checks,a]})}min(a,b){return this._addCheck({kind:"min",value:a.getTime(),message:bm.toString(b)})}max(a,b){return this._addCheck({kind:"max",value:a.getTime(),message:bm.toString(b)})}get minDate(){let a=null;for(let b of this._def.checks)"min"===b.kind&&(null===a||b.value>a)&&(a=b.value);return null!=a?new Date(a):null}get maxDate(){let a=null;for(let b of this._def.checks)"max"===b.kind&&(null===a||b.value<a)&&(a=b.value);return null!=a?new Date(a):null}}W.create=a=>new W({checks:[],coerce:a?.coerce||!1,typeName:bn.ZodDate,...y(a)});class X extends z{_parse(a){if(this._getType(a)!==c.symbol){let b=this._getOrReturnCtx(a);return n(b,{code:e.invalid_type,expected:c.symbol,received:b.parsedType}),p}return r(a.data)}}X.create=a=>new X({typeName:bn.ZodSymbol,...y(a)});class Y extends z{_parse(a){if(this._getType(a)!==c.undefined){let b=this._getOrReturnCtx(a);return n(b,{code:e.invalid_type,expected:c.undefined,received:b.parsedType}),p}return r(a.data)}}Y.create=a=>new Y({typeName:bn.ZodUndefined,...y(a)});class Z extends z{_parse(a){if(this._getType(a)!==c.null){let b=this._getOrReturnCtx(a);return n(b,{code:e.invalid_type,expected:c.null,received:b.parsedType}),p}return r(a.data)}}Z.create=a=>new Z({typeName:bn.ZodNull,...y(a)});class $ extends z{constructor(){super(...arguments),this._any=!0}_parse(a){return r(a.data)}}$.create=a=>new $({typeName:bn.ZodAny,...y(a)});class _ extends z{constructor(){super(...arguments),this._unknown=!0}_parse(a){return r(a.data)}}_.create=a=>new _({typeName:bn.ZodUnknown,...y(a)});class aa extends z{_parse(a){let b=this._getOrReturnCtx(a);return n(b,{code:e.invalid_type,expected:c.never,received:b.parsedType}),p}}aa.create=a=>new aa({typeName:bn.ZodNever,...y(a)});class ab extends z{_parse(a){if(this._getType(a)!==c.undefined){let b=this._getOrReturnCtx(a);return n(b,{code:e.invalid_type,expected:c.void,received:b.parsedType}),p}return r(a.data)}}ab.create=a=>new ab({typeName:bn.ZodVoid,...y(a)});class ac extends z{_parse(a){let{ctx:b,status:d}=this._processInputParams(a),f=this._def;if(b.parsedType!==c.array)return n(b,{code:e.invalid_type,expected:c.array,received:b.parsedType}),p;if(null!==f.exactLength){let a=b.data.length>f.exactLength.value,c=b.data.length<f.exactLength.value;(a||c)&&(n(b,{code:a?e.too_big:e.too_small,minimum:c?f.exactLength.value:void 0,maximum:a?f.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:f.exactLength.message}),d.dirty())}if(null!==f.minLength&&b.data.length<f.minLength.value&&(n(b,{code:e.too_small,minimum:f.minLength.value,type:"array",inclusive:!0,exact:!1,message:f.minLength.message}),d.dirty()),null!==f.maxLength&&b.data.length>f.maxLength.value&&(n(b,{code:e.too_big,maximum:f.maxLength.value,type:"array",inclusive:!0,exact:!1,message:f.maxLength.message}),d.dirty()),b.common.async)return Promise.all([...b.data].map((a,c)=>f.type._parseAsync(new w(b,a,b.path,c)))).then(a=>o.mergeArray(d,a));let g=[...b.data].map((a,c)=>f.type._parseSync(new w(b,a,b.path,c)));return o.mergeArray(d,g)}get element(){return this._def.type}min(a,b){return new ac({...this._def,minLength:{value:a,message:bm.toString(b)}})}max(a,b){return new ac({...this._def,maxLength:{value:a,message:bm.toString(b)}})}length(a,b){return new ac({...this._def,exactLength:{value:a,message:bm.toString(b)}})}nonempty(a){return this.min(1,a)}}ac.create=(a,b)=>new ac({type:a,minLength:null,maxLength:null,exactLength:null,typeName:bn.ZodArray,...y(b)});class ad extends z{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let a=this._def.shape(),b=bk.objectKeys(a);return this._cached={shape:a,keys:b},this._cached}_parse(a){if(this._getType(a)!==c.object){let b=this._getOrReturnCtx(a);return n(b,{code:e.invalid_type,expected:c.object,received:b.parsedType}),p}let{status:b,ctx:d}=this._processInputParams(a),{shape:f,keys:g}=this._getCached(),h=[];if(!(this._def.catchall instanceof aa&&"strip"===this._def.unknownKeys))for(let a in d.data)g.includes(a)||h.push(a);let i=[];for(let a of g){let b=f[a],c=d.data[a];i.push({key:{status:"valid",value:a},value:b._parse(new w(d,c,d.path,a)),alwaysSet:a in d.data})}if(this._def.catchall instanceof aa){let a=this._def.unknownKeys;if("passthrough"===a)for(let a of h)i.push({key:{status:"valid",value:a},value:{status:"valid",value:d.data[a]}});else if("strict"===a)h.length>0&&(n(d,{code:e.unrecognized_keys,keys:h}),b.dirty());else if("strip"===a);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let a=this._def.catchall;for(let b of h){let c=d.data[b];i.push({key:{status:"valid",value:b},value:a._parse(new w(d,c,d.path,b)),alwaysSet:b in d.data})}}return d.common.async?Promise.resolve().then(async()=>{let a=[];for(let b of i){let c=await b.key,d=await b.value;a.push({key:c,value:d,alwaysSet:b.alwaysSet})}return a}).then(a=>o.mergeObjectSync(b,a)):o.mergeObjectSync(b,i)}get shape(){return this._def.shape()}strict(a){return bm.errToObj,new ad({...this._def,unknownKeys:"strict",...void 0!==a?{errorMap:(b,c)=>{let d=this._def.errorMap?.(b,c).message??c.defaultError;return"unrecognized_keys"===b.code?{message:bm.errToObj(a).message??d}:{message:d}}}:{}})}strip(){return new ad({...this._def,unknownKeys:"strip"})}passthrough(){return new ad({...this._def,unknownKeys:"passthrough"})}extend(a){return new ad({...this._def,shape:()=>({...this._def.shape(),...a})})}merge(a){return new ad({unknownKeys:a._def.unknownKeys,catchall:a._def.catchall,shape:()=>({...this._def.shape(),...a._def.shape()}),typeName:bn.ZodObject})}setKey(a,b){return this.augment({[a]:b})}catchall(a){return new ad({...this._def,catchall:a})}pick(a){let b={};for(let c of bk.objectKeys(a))a[c]&&this.shape[c]&&(b[c]=this.shape[c]);return new ad({...this._def,shape:()=>b})}omit(a){let b={};for(let c of bk.objectKeys(this.shape))a[c]||(b[c]=this.shape[c]);return new ad({...this._def,shape:()=>b})}deepPartial(){return function a(b){if(b instanceof ad){let c={};for(let d in b.shape){let e=b.shape[d];c[d]=au.create(a(e))}return new ad({...b._def,shape:()=>c})}if(b instanceof ac)return new ac({...b._def,type:a(b.element)});if(b instanceof au)return au.create(a(b.unwrap()));if(b instanceof av)return av.create(a(b.unwrap()));if(b instanceof ai)return ai.create(b.items.map(b=>a(b)));else return b}(this)}partial(a){let b={};for(let c of bk.objectKeys(this.shape)){let d=this.shape[c];a&&!a[c]?b[c]=d:b[c]=d.optional()}return new ad({...this._def,shape:()=>b})}required(a){let b={};for(let c of bk.objectKeys(this.shape))if(a&&!a[c])b[c]=this.shape[c];else{let a=this.shape[c];for(;a instanceof au;)a=a._def.innerType;b[c]=a}return new ad({...this._def,shape:()=>b})}keyof(){return ap(bk.objectKeys(this.shape))}}ad.create=(a,b)=>new ad({shape:()=>a,unknownKeys:"strip",catchall:aa.create(),typeName:bn.ZodObject,...y(b)}),ad.strictCreate=(a,b)=>new ad({shape:()=>a,unknownKeys:"strict",catchall:aa.create(),typeName:bn.ZodObject,...y(b)}),ad.lazycreate=(a,b)=>new ad({shape:a,unknownKeys:"strip",catchall:aa.create(),typeName:bn.ZodObject,...y(b)});class ae extends z{_parse(a){let{ctx:b}=this._processInputParams(a),c=this._def.options;if(b.common.async)return Promise.all(c.map(async a=>{let c={...b,common:{...b.common,issues:[]},parent:null};return{result:await a._parseAsync({data:b.data,path:b.path,parent:c}),ctx:c}})).then(function(a){for(let b of a)if("valid"===b.result.status)return b.result;for(let c of a)if("dirty"===c.result.status)return b.common.issues.push(...c.ctx.common.issues),c.result;let c=a.map(a=>new g(a.ctx.common.issues));return n(b,{code:e.invalid_union,unionErrors:c}),p});{let a,d=[];for(let e of c){let c={...b,common:{...b.common,issues:[]},parent:null},f=e._parseSync({data:b.data,path:b.path,parent:c});if("valid"===f.status)return f;"dirty"!==f.status||a||(a={result:f,ctx:c}),c.common.issues.length&&d.push(c.common.issues)}if(a)return b.common.issues.push(...a.ctx.common.issues),a.result;let f=d.map(a=>new g(a));return n(b,{code:e.invalid_union,unionErrors:f}),p}}get options(){return this._def.options}}ae.create=(a,b)=>new ae({options:a,typeName:bn.ZodUnion,...y(b)});let af=a=>{if(a instanceof an)return af(a.schema);if(a instanceof at)return af(a.innerType());if(a instanceof ao)return[a.value];if(a instanceof aq)return a.options;if(a instanceof ar)return bk.objectValues(a.enum);else if(a instanceof aw)return af(a._def.innerType);else if(a instanceof Y)return[void 0];else if(a instanceof Z)return[null];else if(a instanceof au)return[void 0,...af(a.unwrap())];else if(a instanceof av)return[null,...af(a.unwrap())];else if(a instanceof aA)return af(a.unwrap());else if(a instanceof aC)return af(a.unwrap());else if(a instanceof ax)return af(a._def.innerType);else return[]};class ag extends z{_parse(a){let{ctx:b}=this._processInputParams(a);if(b.parsedType!==c.object)return n(b,{code:e.invalid_type,expected:c.object,received:b.parsedType}),p;let d=this.discriminator,f=b.data[d],g=this.optionsMap.get(f);return g?b.common.async?g._parseAsync({data:b.data,path:b.path,parent:b}):g._parseSync({data:b.data,path:b.path,parent:b}):(n(b,{code:e.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[d]}),p)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(a,b,c){let d=new Map;for(let c of b){let b=af(c.shape[a]);if(!b.length)throw Error(`A discriminator value for key \`${a}\` could not be extracted from all schema options`);for(let e of b){if(d.has(e))throw Error(`Discriminator property ${String(a)} has duplicate value ${String(e)}`);d.set(e,c)}}return new ag({typeName:bn.ZodDiscriminatedUnion,discriminator:a,options:b,optionsMap:d,...y(c)})}}class ah extends z{_parse(a){let{status:b,ctx:f}=this._processInputParams(a),g=(a,g)=>{if(s(a)||s(g))return p;let h=function a(b,e){let f=d(b),g=d(e);if(b===e)return{valid:!0,data:b};if(f===c.object&&g===c.object){let c=bk.objectKeys(e),d=bk.objectKeys(b).filter(a=>-1!==c.indexOf(a)),f={...b,...e};for(let c of d){let d=a(b[c],e[c]);if(!d.valid)return{valid:!1};f[c]=d.data}return{valid:!0,data:f}}if(f===c.array&&g===c.array){if(b.length!==e.length)return{valid:!1};let c=[];for(let d=0;d<b.length;d++){let f=a(b[d],e[d]);if(!f.valid)return{valid:!1};c.push(f.data)}return{valid:!0,data:c}}if(f===c.date&&g===c.date&&+b==+e)return{valid:!0,data:b};return{valid:!1}}(a.value,g.value);return h.valid?((t(a)||t(g))&&b.dirty(),{status:b.value,value:h.data}):(n(f,{code:e.invalid_intersection_types}),p)};return f.common.async?Promise.all([this._def.left._parseAsync({data:f.data,path:f.path,parent:f}),this._def.right._parseAsync({data:f.data,path:f.path,parent:f})]).then(([a,b])=>g(a,b)):g(this._def.left._parseSync({data:f.data,path:f.path,parent:f}),this._def.right._parseSync({data:f.data,path:f.path,parent:f}))}}ah.create=(a,b,c)=>new ah({left:a,right:b,typeName:bn.ZodIntersection,...y(c)});class ai extends z{_parse(a){let{status:b,ctx:d}=this._processInputParams(a);if(d.parsedType!==c.array)return n(d,{code:e.invalid_type,expected:c.array,received:d.parsedType}),p;if(d.data.length<this._def.items.length)return n(d,{code:e.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),p;!this._def.rest&&d.data.length>this._def.items.length&&(n(d,{code:e.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),b.dirty());let f=[...d.data].map((a,b)=>{let c=this._def.items[b]||this._def.rest;return c?c._parse(new w(d,a,d.path,b)):null}).filter(a=>!!a);return d.common.async?Promise.all(f).then(a=>o.mergeArray(b,a)):o.mergeArray(b,f)}get items(){return this._def.items}rest(a){return new ai({...this._def,rest:a})}}ai.create=(a,b)=>{if(!Array.isArray(a))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new ai({items:a,typeName:bn.ZodTuple,rest:null,...y(b)})};class aj extends z{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(a){let{status:b,ctx:d}=this._processInputParams(a);if(d.parsedType!==c.object)return n(d,{code:e.invalid_type,expected:c.object,received:d.parsedType}),p;let f=[],g=this._def.keyType,h=this._def.valueType;for(let a in d.data)f.push({key:g._parse(new w(d,a,d.path,a)),value:h._parse(new w(d,d.data[a],d.path,a)),alwaysSet:a in d.data});return d.common.async?o.mergeObjectAsync(b,f):o.mergeObjectSync(b,f)}get element(){return this._def.valueType}static create(a,b,c){return new aj(b instanceof z?{keyType:a,valueType:b,typeName:bn.ZodRecord,...y(c)}:{keyType:S.create(),valueType:a,typeName:bn.ZodRecord,...y(b)})}}class ak extends z{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(a){let{status:b,ctx:d}=this._processInputParams(a);if(d.parsedType!==c.map)return n(d,{code:e.invalid_type,expected:c.map,received:d.parsedType}),p;let f=this._def.keyType,g=this._def.valueType,h=[...d.data.entries()].map(([a,b],c)=>({key:f._parse(new w(d,a,d.path,[c,"key"])),value:g._parse(new w(d,b,d.path,[c,"value"]))}));if(d.common.async){let a=new Map;return Promise.resolve().then(async()=>{for(let c of h){let d=await c.key,e=await c.value;if("aborted"===d.status||"aborted"===e.status)return p;("dirty"===d.status||"dirty"===e.status)&&b.dirty(),a.set(d.value,e.value)}return{status:b.value,value:a}})}{let a=new Map;for(let c of h){let d=c.key,e=c.value;if("aborted"===d.status||"aborted"===e.status)return p;("dirty"===d.status||"dirty"===e.status)&&b.dirty(),a.set(d.value,e.value)}return{status:b.value,value:a}}}}ak.create=(a,b,c)=>new ak({valueType:b,keyType:a,typeName:bn.ZodMap,...y(c)});class al extends z{_parse(a){let{status:b,ctx:d}=this._processInputParams(a);if(d.parsedType!==c.set)return n(d,{code:e.invalid_type,expected:c.set,received:d.parsedType}),p;let f=this._def;null!==f.minSize&&d.data.size<f.minSize.value&&(n(d,{code:e.too_small,minimum:f.minSize.value,type:"set",inclusive:!0,exact:!1,message:f.minSize.message}),b.dirty()),null!==f.maxSize&&d.data.size>f.maxSize.value&&(n(d,{code:e.too_big,maximum:f.maxSize.value,type:"set",inclusive:!0,exact:!1,message:f.maxSize.message}),b.dirty());let g=this._def.valueType;function h(a){let c=new Set;for(let d of a){if("aborted"===d.status)return p;"dirty"===d.status&&b.dirty(),c.add(d.value)}return{status:b.value,value:c}}let i=[...d.data.values()].map((a,b)=>g._parse(new w(d,a,d.path,b)));return d.common.async?Promise.all(i).then(a=>h(a)):h(i)}min(a,b){return new al({...this._def,minSize:{value:a,message:bm.toString(b)}})}max(a,b){return new al({...this._def,maxSize:{value:a,message:bm.toString(b)}})}size(a,b){return this.min(a,b).max(a,b)}nonempty(a){return this.min(1,a)}}al.create=(a,b)=>new al({valueType:a,minSize:null,maxSize:null,typeName:bn.ZodSet,...y(b)});class am extends z{constructor(){super(...arguments),this.validate=this.implement}_parse(a){let{ctx:b}=this._processInputParams(a);if(b.parsedType!==c.function)return n(b,{code:e.invalid_type,expected:c.function,received:b.parsedType}),p;function d(a,c){return l({data:a,path:b.path,errorMaps:[b.common.contextualErrorMap,b.schemaErrorMap,i,h].filter(a=>!!a),issueData:{code:e.invalid_arguments,argumentsError:c}})}function f(a,c){return l({data:a,path:b.path,errorMaps:[b.common.contextualErrorMap,b.schemaErrorMap,i,h].filter(a=>!!a),issueData:{code:e.invalid_return_type,returnTypeError:c}})}let j={errorMap:b.common.contextualErrorMap},k=b.data;if(this._def.returns instanceof as){let a=this;return r(async function(...b){let c=new g([]),e=await a._def.args.parseAsync(b,j).catch(a=>{throw c.addIssue(d(b,a)),c}),h=await Reflect.apply(k,this,e);return await a._def.returns._def.type.parseAsync(h,j).catch(a=>{throw c.addIssue(f(h,a)),c})})}{let a=this;return r(function(...b){let c=a._def.args.safeParse(b,j);if(!c.success)throw new g([d(b,c.error)]);let e=Reflect.apply(k,this,c.data),h=a._def.returns.safeParse(e,j);if(!h.success)throw new g([f(e,h.error)]);return h.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...a){return new am({...this._def,args:ai.create(a).rest(_.create())})}returns(a){return new am({...this._def,returns:a})}implement(a){return this.parse(a)}strictImplement(a){return this.parse(a)}static create(a,b,c){return new am({args:a||ai.create([]).rest(_.create()),returns:b||_.create(),typeName:bn.ZodFunction,...y(c)})}}class an extends z{get schema(){return this._def.getter()}_parse(a){let{ctx:b}=this._processInputParams(a);return this._def.getter()._parse({data:b.data,path:b.path,parent:b})}}an.create=(a,b)=>new an({getter:a,typeName:bn.ZodLazy,...y(b)});class ao extends z{_parse(a){if(a.data!==this._def.value){let b=this._getOrReturnCtx(a);return n(b,{received:b.data,code:e.invalid_literal,expected:this._def.value}),p}return{status:"valid",value:a.data}}get value(){return this._def.value}}function ap(a,b){return new aq({values:a,typeName:bn.ZodEnum,...y(b)})}ao.create=(a,b)=>new ao({value:a,typeName:bn.ZodLiteral,...y(b)});class aq extends z{_parse(a){if("string"!=typeof a.data){let b=this._getOrReturnCtx(a),c=this._def.values;return n(b,{expected:bk.joinValues(c),received:b.parsedType,code:e.invalid_type}),p}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(a.data)){let b=this._getOrReturnCtx(a),c=this._def.values;return n(b,{received:b.data,code:e.invalid_enum_value,options:c}),p}return r(a.data)}get options(){return this._def.values}get enum(){let a={};for(let b of this._def.values)a[b]=b;return a}get Values(){let a={};for(let b of this._def.values)a[b]=b;return a}get Enum(){let a={};for(let b of this._def.values)a[b]=b;return a}extract(a,b=this._def){return aq.create(a,{...this._def,...b})}exclude(a,b=this._def){return aq.create(this.options.filter(b=>!a.includes(b)),{...this._def,...b})}}aq.create=ap;class ar extends z{_parse(a){let b=bk.getValidEnumValues(this._def.values),d=this._getOrReturnCtx(a);if(d.parsedType!==c.string&&d.parsedType!==c.number){let a=bk.objectValues(b);return n(d,{expected:bk.joinValues(a),received:d.parsedType,code:e.invalid_type}),p}if(this._cache||(this._cache=new Set(bk.getValidEnumValues(this._def.values))),!this._cache.has(a.data)){let a=bk.objectValues(b);return n(d,{received:d.data,code:e.invalid_enum_value,options:a}),p}return r(a.data)}get enum(){return this._def.values}}ar.create=(a,b)=>new ar({values:a,typeName:bn.ZodNativeEnum,...y(b)});class as extends z{unwrap(){return this._def.type}_parse(a){let{ctx:b}=this._processInputParams(a);return b.parsedType!==c.promise&&!1===b.common.async?(n(b,{code:e.invalid_type,expected:c.promise,received:b.parsedType}),p):r((b.parsedType===c.promise?b.data:Promise.resolve(b.data)).then(a=>this._def.type.parseAsync(a,{path:b.path,errorMap:b.common.contextualErrorMap})))}}as.create=(a,b)=>new as({type:a,typeName:bn.ZodPromise,...y(b)});class at extends z{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===bn.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(a){let{status:b,ctx:c}=this._processInputParams(a),d=this._def.effect||null,e={addIssue:a=>{n(c,a),a.fatal?b.abort():b.dirty()},get path(){return c.path}};if(e.addIssue=e.addIssue.bind(e),"preprocess"===d.type){let a=d.transform(c.data,e);if(c.common.async)return Promise.resolve(a).then(async a=>{if("aborted"===b.value)return p;let d=await this._def.schema._parseAsync({data:a,path:c.path,parent:c});return"aborted"===d.status?p:"dirty"===d.status||"dirty"===b.value?q(d.value):d});{if("aborted"===b.value)return p;let d=this._def.schema._parseSync({data:a,path:c.path,parent:c});return"aborted"===d.status?p:"dirty"===d.status||"dirty"===b.value?q(d.value):d}}if("refinement"===d.type){let a=a=>{let b=d.refinement(a,e);if(c.common.async)return Promise.resolve(b);if(b instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(!1!==c.common.async)return this._def.schema._parseAsync({data:c.data,path:c.path,parent:c}).then(c=>"aborted"===c.status?p:("dirty"===c.status&&b.dirty(),a(c.value).then(()=>({status:b.value,value:c.value}))));{let d=this._def.schema._parseSync({data:c.data,path:c.path,parent:c});return"aborted"===d.status?p:("dirty"===d.status&&b.dirty(),a(d.value),{status:b.value,value:d.value})}}if("transform"===d.type)if(!1!==c.common.async)return this._def.schema._parseAsync({data:c.data,path:c.path,parent:c}).then(a=>u(a)?Promise.resolve(d.transform(a.value,e)).then(a=>({status:b.value,value:a})):p);else{let a=this._def.schema._parseSync({data:c.data,path:c.path,parent:c});if(!u(a))return p;let f=d.transform(a.value,e);if(f instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:b.value,value:f}}bk.assertNever(d)}}at.create=(a,b,c)=>new at({schema:a,typeName:bn.ZodEffects,effect:b,...y(c)}),at.createWithPreprocess=(a,b,c)=>new at({schema:b,effect:{type:"preprocess",transform:a},typeName:bn.ZodEffects,...y(c)});class au extends z{_parse(a){return this._getType(a)===c.undefined?r(void 0):this._def.innerType._parse(a)}unwrap(){return this._def.innerType}}au.create=(a,b)=>new au({innerType:a,typeName:bn.ZodOptional,...y(b)});class av extends z{_parse(a){return this._getType(a)===c.null?r(null):this._def.innerType._parse(a)}unwrap(){return this._def.innerType}}av.create=(a,b)=>new av({innerType:a,typeName:bn.ZodNullable,...y(b)});class aw extends z{_parse(a){let{ctx:b}=this._processInputParams(a),d=b.data;return b.parsedType===c.undefined&&(d=this._def.defaultValue()),this._def.innerType._parse({data:d,path:b.path,parent:b})}removeDefault(){return this._def.innerType}}aw.create=(a,b)=>new aw({innerType:a,typeName:bn.ZodDefault,defaultValue:"function"==typeof b.default?b.default:()=>b.default,...y(b)});class ax extends z{_parse(a){let{ctx:b}=this._processInputParams(a),c={...b,common:{...b.common,issues:[]}},d=this._def.innerType._parse({data:c.data,path:c.path,parent:{...c}});return v(d)?d.then(a=>({status:"valid",value:"valid"===a.status?a.value:this._def.catchValue({get error(){return new g(c.common.issues)},input:c.data})})):{status:"valid",value:"valid"===d.status?d.value:this._def.catchValue({get error(){return new g(c.common.issues)},input:c.data})}}removeCatch(){return this._def.innerType}}ax.create=(a,b)=>new ax({innerType:a,typeName:bn.ZodCatch,catchValue:"function"==typeof b.catch?b.catch:()=>b.catch,...y(b)});class ay extends z{_parse(a){if(this._getType(a)!==c.nan){let b=this._getOrReturnCtx(a);return n(b,{code:e.invalid_type,expected:c.nan,received:b.parsedType}),p}return{status:"valid",value:a.data}}}ay.create=a=>new ay({typeName:bn.ZodNaN,...y(a)});let az=Symbol("zod_brand");class aA extends z{_parse(a){let{ctx:b}=this._processInputParams(a),c=b.data;return this._def.type._parse({data:c,path:b.path,parent:b})}unwrap(){return this._def.type}}class aB extends z{_parse(a){let{status:b,ctx:c}=this._processInputParams(a);if(c.common.async)return(async()=>{let a=await this._def.in._parseAsync({data:c.data,path:c.path,parent:c});return"aborted"===a.status?p:"dirty"===a.status?(b.dirty(),q(a.value)):this._def.out._parseAsync({data:a.value,path:c.path,parent:c})})();{let a=this._def.in._parseSync({data:c.data,path:c.path,parent:c});return"aborted"===a.status?p:"dirty"===a.status?(b.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:c.path,parent:c})}}static create(a,b){return new aB({in:a,out:b,typeName:bn.ZodPipeline})}}class aC extends z{_parse(a){let b=this._def.innerType._parse(a),c=a=>(u(a)&&(a.value=Object.freeze(a.value)),a);return v(b)?b.then(a=>c(a)):c(b)}unwrap(){return this._def.innerType}}function aD(a,b){let c="function"==typeof a?a(b):"string"==typeof a?{message:a}:a;return"string"==typeof c?{message:c}:c}function aE(a,b={},c){return a?$.create().superRefine((d,e)=>{let f=a(d);if(f instanceof Promise)return f.then(a=>{if(!a){let a=aD(b,d),f=a.fatal??c??!0;e.addIssue({code:"custom",...a,fatal:f})}});if(!f){let a=aD(b,d),f=a.fatal??c??!0;e.addIssue({code:"custom",...a,fatal:f})}}):$.create()}aC.create=(a,b)=>new aC({innerType:a,typeName:bn.ZodReadonly,...y(b)});let aF={object:ad.lazycreate};(bj=bn||(bn={})).ZodString="ZodString",bj.ZodNumber="ZodNumber",bj.ZodNaN="ZodNaN",bj.ZodBigInt="ZodBigInt",bj.ZodBoolean="ZodBoolean",bj.ZodDate="ZodDate",bj.ZodSymbol="ZodSymbol",bj.ZodUndefined="ZodUndefined",bj.ZodNull="ZodNull",bj.ZodAny="ZodAny",bj.ZodUnknown="ZodUnknown",bj.ZodNever="ZodNever",bj.ZodVoid="ZodVoid",bj.ZodArray="ZodArray",bj.ZodObject="ZodObject",bj.ZodUnion="ZodUnion",bj.ZodDiscriminatedUnion="ZodDiscriminatedUnion",bj.ZodIntersection="ZodIntersection",bj.ZodTuple="ZodTuple",bj.ZodRecord="ZodRecord",bj.ZodMap="ZodMap",bj.ZodSet="ZodSet",bj.ZodFunction="ZodFunction",bj.ZodLazy="ZodLazy",bj.ZodLiteral="ZodLiteral",bj.ZodEnum="ZodEnum",bj.ZodEffects="ZodEffects",bj.ZodNativeEnum="ZodNativeEnum",bj.ZodOptional="ZodOptional",bj.ZodNullable="ZodNullable",bj.ZodDefault="ZodDefault",bj.ZodCatch="ZodCatch",bj.ZodPromise="ZodPromise",bj.ZodBranded="ZodBranded",bj.ZodPipeline="ZodPipeline",bj.ZodReadonly="ZodReadonly";let aG=(a,b={message:`Input not instance of ${a.name}`})=>aE(b=>b instanceof a,b),aH=S.create,aI=T.create,aJ=ay.create,aK=U.create,aL=V.create,aM=W.create,aN=X.create,aO=Y.create,aP=Z.create,aQ=$.create,aR=_.create,aS=aa.create,aT=ab.create,aU=ac.create,aV=ad.create,aW=ad.strictCreate,aX=ae.create,aY=ag.create,aZ=ah.create,a$=ai.create,a_=aj.create,a0=ak.create,a1=al.create,a2=am.create,a3=an.create,a4=ao.create,a5=aq.create,a6=ar.create,a7=as.create,a8=at.create,a9=au.create,ba=av.create,bb=at.createWithPreprocess,bc=aB.create,bd=()=>aH().optional(),be=()=>aI().optional(),bf=()=>aL().optional(),bg={string:a=>S.create({...a,coerce:!0}),number:a=>T.create({...a,coerce:!0}),boolean:a=>V.create({...a,coerce:!0}),bigint:a=>U.create({...a,coerce:!0}),date:a=>W.create({...a,coerce:!0})};a.s(["BRAND",0,az,"NEVER",0,p,"Schema",()=>z,"ZodAny",()=>$,"ZodArray",()=>ac,"ZodBigInt",()=>U,"ZodBoolean",()=>V,"ZodBranded",()=>aA,"ZodCatch",()=>ax,"ZodDate",()=>W,"ZodDefault",()=>aw,"ZodDiscriminatedUnion",()=>ag,"ZodEffects",()=>at,"ZodEnum",()=>aq,"ZodFirstPartyTypeKind",()=>bn,"ZodFunction",()=>am,"ZodIntersection",()=>ah,"ZodLazy",()=>an,"ZodLiteral",()=>ao,"ZodMap",()=>ak,"ZodNaN",()=>ay,"ZodNativeEnum",()=>ar,"ZodNever",()=>aa,"ZodNull",()=>Z,"ZodNullable",()=>av,"ZodNumber",()=>T,"ZodObject",()=>ad,"ZodOptional",()=>au,"ZodPipeline",()=>aB,"ZodPromise",()=>as,"ZodReadonly",()=>aC,"ZodRecord",()=>aj,"ZodSchema",()=>z,"ZodSet",()=>al,"ZodString",()=>S,"ZodSymbol",()=>X,"ZodTransformer",()=>at,"ZodTuple",()=>ai,"ZodType",()=>z,"ZodUndefined",()=>Y,"ZodUnion",()=>ae,"ZodUnknown",()=>_,"ZodVoid",()=>ab,"any",()=>aQ,"array",()=>aU,"bigint",()=>aK,"boolean",()=>aL,"coerce",0,bg,"custom",()=>aE,"date",()=>aM,"datetimeRegex",()=>R,"discriminatedUnion",()=>aY,"effect",()=>a8,"enum",()=>a5,"function",()=>a2,"instanceof",()=>aG,"intersection",()=>aZ,"late",0,aF,"lazy",()=>a3,"literal",()=>a4,"map",()=>a0,"nan",()=>aJ,"nativeEnum",()=>a6,"never",()=>aS,"null",()=>aP,"nullable",()=>ba,"number",()=>aI,"object",()=>aV,"oboolean",()=>bf,"onumber",()=>be,"optional",()=>a9,"ostring",()=>bd,"pipeline",()=>bc,"preprocess",()=>bb,"promise",()=>a7,"record",()=>a_,"set",()=>a1,"strictObject",()=>aW,"string",()=>aH,"symbol",()=>aN,"transformer",()=>a8,"tuple",()=>a$,"undefined",()=>aO,"union",()=>aX,"unknown",()=>aR,"void",()=>aT],403703),a.i(403703),a.i(611521),a.s(["BRAND",0,az,"DIRTY",0,q,"EMPTY_PATH",0,m,"INVALID",0,p,"NEVER",0,p,"OK",0,r,"ParseStatus",()=>o,"Schema",()=>z,"ZodAny",()=>$,"ZodArray",()=>ac,"ZodBigInt",()=>U,"ZodBoolean",()=>V,"ZodBranded",()=>aA,"ZodCatch",()=>ax,"ZodDate",()=>W,"ZodDefault",()=>aw,"ZodDiscriminatedUnion",()=>ag,"ZodEffects",()=>at,"ZodEnum",()=>aq,"ZodError",()=>g,"ZodFirstPartyTypeKind",()=>bn,"ZodFunction",()=>am,"ZodIntersection",()=>ah,"ZodIssueCode",0,e,"ZodLazy",()=>an,"ZodLiteral",()=>ao,"ZodMap",()=>ak,"ZodNaN",()=>ay,"ZodNativeEnum",()=>ar,"ZodNever",()=>aa,"ZodNull",()=>Z,"ZodNullable",()=>av,"ZodNumber",()=>T,"ZodObject",()=>ad,"ZodOptional",()=>au,"ZodParsedType",0,c,"ZodPipeline",()=>aB,"ZodPromise",()=>as,"ZodReadonly",()=>aC,"ZodRecord",()=>aj,"ZodSchema",()=>z,"ZodSet",()=>al,"ZodString",()=>S,"ZodSymbol",()=>X,"ZodTransformer",()=>at,"ZodTuple",()=>ai,"ZodType",()=>z,"ZodUndefined",()=>Y,"ZodUnion",()=>ae,"ZodUnknown",()=>_,"ZodVoid",()=>ab,"addIssueToContext",()=>n,"any",()=>aQ,"array",()=>aU,"bigint",()=>aK,"boolean",()=>aL,"coerce",0,bg,"custom",()=>aE,"date",()=>aM,"datetimeRegex",()=>R,"defaultErrorMap",0,h,"discriminatedUnion",()=>aY,"effect",()=>a8,"enum",()=>a5,"function",()=>a2,"getErrorMap",()=>k,"getParsedType",0,d,"instanceof",()=>aG,"intersection",()=>aZ,"isAborted",0,s,"isAsync",0,v,"isDirty",0,t,"isValid",0,u,"late",0,aF,"lazy",()=>a3,"literal",()=>a4,"makeIssue",0,l,"map",()=>a0,"nan",()=>aJ,"nativeEnum",()=>a6,"never",()=>aS,"null",()=>aP,"nullable",()=>ba,"number",()=>aI,"object",()=>aV,"objectUtil",()=>bl,"oboolean",()=>bf,"onumber",()=>be,"optional",()=>a9,"ostring",()=>bd,"pipeline",()=>bc,"preprocess",()=>bb,"promise",()=>a7,"quotelessJson",0,f,"record",()=>a_,"set",()=>a1,"setErrorMap",()=>j,"strictObject",()=>aW,"string",()=>aH,"symbol",()=>aN,"transformer",()=>a8,"tuple",()=>a$,"undefined",()=>aO,"union",()=>aX,"unknown",()=>aR,"util",()=>bk,"void",()=>aT],902764);var bh,bi,bj,bk,bl,bm,bn,bo=a.i(902764);a.s(["z",0,bo],680904)},965569,(a,b,c)=>{"use strict";var d=c.ValidationError=function(a,b,c,d,e,f){if(Array.isArray(d)?(this.path=d,this.property=d.reduce(function(a,b){return a+k(b)},"instance")):void 0!==d&&(this.property=d),a&&(this.message=a),c){var g=c.$id||c.id;this.schema=g||c}void 0!==b&&(this.instance=b),this.name=e,this.argument=f,this.stack=this.toString()};d.prototype.toString=function(){return this.property+" "+this.message};var e=c.ValidatorResult=function(a,b,c,d){this.instance=a,this.schema=b,this.options=c,this.path=d.path,this.propertyPath=d.propertyPath,this.errors=[],this.throwError=c&&c.throwError,this.throwFirst=c&&c.throwFirst,this.throwAll=c&&c.throwAll,this.disableFormat=c&&!0===c.disableFormat};function f(a,b){return b+": "+a.toString()+"\n"}function g(a){"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,g),this.instance=a.instance,this.schema=a.schema,this.options=a.options,this.errors=a.errors}e.prototype.addError=function(a){var b;if("string"==typeof a)b=new d(a,this.instance,this.schema,this.path);else{if(!a)throw Error("Missing error detail");if(!a.message)throw Error("Missing error message");if(!a.name)throw Error("Missing validator type");b=new d(a.message,this.instance,this.schema,this.path,a.name,a.argument)}if(this.errors.push(b),this.throwFirst)throw new g(this);if(this.throwError)throw b;return b},e.prototype.importErrors=function(a){"string"==typeof a||a&&a.validatorType?this.addError(a):a&&a.errors&&(this.errors=this.errors.concat(a.errors))},e.prototype.toString=function(a){return this.errors.map(f).join("")},Object.defineProperty(e.prototype,"valid",{get:function(){return!this.errors.length}}),b.exports.ValidatorResultError=g,g.prototype=Error(),g.prototype.constructor=g,g.prototype.name="Validation Error";var h=c.SchemaError=function a(b,c){this.message=b,this.schema=c,Error.call(this,b),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,a)};h.prototype=Object.create(Error.prototype,{constructor:{value:h,enumerable:!1},name:{value:"SchemaError",enumerable:!1}});var i=c.SchemaContext=function(a,b,c,d,e){this.schema=a,this.options=b,Array.isArray(c)?(this.path=c,this.propertyPath=c.reduce(function(a,b){return a+k(b)},"instance")):this.propertyPath=c,this.base=d,this.schemas=e};i.prototype.resolve=function(a){return q(this.base,a)},i.prototype.makeChild=function(a,b){var c=void 0===b?this.path:this.path.concat([b]),d=a.$id||a.id;let e=q(this.base,d||"");var f=new i(a,this.options,c,e,Object.create(this.schemas));return d&&!f.schemas[e]&&(f.schemas[e]=a),f};var j=c.FORMAT_REGEXPS={"date-time":/^\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])[tT ](2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])(\.\d+)?([zZ]|[+-]([0-5][0-9]):(60|[0-5][0-9]))$/,date:/^\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])$/,time:/^(2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])$/,duration:/P(T\d+(H(\d+M(\d+S)?)?|M(\d+S)?|S)|\d+(D|M(\d+D)?|Y(\d+M(\d+D)?)?)(T\d+(H(\d+M(\d+S)?)?|M(\d+S)?|S))?|\d+W)/i,email:/^(?:[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+\.)*[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!\.)){0,61}[a-zA-Z0-9]?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\[(?:(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\.){3}(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\]))$/,"idn-email":/^("(?:[!#-\[\]-\u{10FFFF}]|\\[\t -\u{10FFFF}])*"|[!#-'*+\-/-9=?A-Z\^-\u{10FFFF}](?:\.?[!#-'*+\-/-9=?A-Z\^-\u{10FFFF}])*)@([!#-'*+\-/-9=?A-Z\^-\u{10FFFF}](?:\.?[!#-'*+\-/-9=?A-Z\^-\u{10FFFF}])*|\[[!-Z\^-\u{10FFFF}]*\])$/u,"ip-address":/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,ipv6:/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,uri:/^[a-zA-Z][a-zA-Z0-9+.-]*:[^\s]*$/,"uri-reference":/^(((([A-Za-z][+\-.0-9A-Za-z]*(:%[0-9A-Fa-f]{2}|:[!$&-.0-;=?-Z_a-z~]|[/?])|\?)(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|([A-Za-z][+\-.0-9A-Za-z]*:?)?)|([A-Za-z][+\-.0-9A-Za-z]*:)?\/((%[0-9A-Fa-f]{2}|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?[/?]|[!$&-.0-;=?-Z_a-z~])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|(\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?)?))#(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|(([A-Za-z][+\-.0-9A-Za-z]*)?%[0-9A-Fa-f]{2}|[!$&-.0-9;=@_~]|[A-Za-z][+\-.0-9A-Za-z]*[!$&-*,;=@_~])(%[0-9A-Fa-f]{2}|[!$&-.0-9;=@-Z_a-z~])*((([/?](%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*)?#|[/?])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*)?|([A-Za-z][+\-.0-9A-Za-z]*(:%[0-9A-Fa-f]{2}|:[!$&-.0-;=?-Z_a-z~]|[/?])|\?)(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|([A-Za-z][+\-.0-9A-Za-z]*:)?\/((%[0-9A-Fa-f]{2}|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?[/?]|[!$&-.0-;=?-Z_a-z~])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+(:\d*)?|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?:\d*|\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?)?|[A-Za-z][+\-.0-9A-Za-z]*:?)?$/,iri:/^[a-zA-Z][a-zA-Z0-9+.-]*:[^\s]*$/,"iri-reference":/^(((([A-Za-z][+\-.0-9A-Za-z]*(:%[0-9A-Fa-f]{2}|:[!$&-.0-;=?-Z_a-z~-\u{10FFFF}]|[/?])|\?)(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*|([A-Za-z][+\-.0-9A-Za-z]*:?)?)|([A-Za-z][+\-.0-9A-Za-z]*:)?\/((%[0-9A-Fa-f]{2}|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~-\u{10FFFF}])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~-\u{10FFFF}]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?[/?]|[!$&-.0-;=?-Z_a-z~-\u{10FFFF}])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*|(\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~-\u{10FFFF}])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~-\u{10FFFF}]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?)?))#(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*|(([A-Za-z][+\-.0-9A-Za-z]*)?%[0-9A-Fa-f]{2}|[!$&-.0-9;=@_~-\u{10FFFF}]|[A-Za-z][+\-.0-9A-Za-z]*[!$&-*,;=@_~-\u{10FFFF}])(%[0-9A-Fa-f]{2}|[!$&-.0-9;=@-Z_a-z~-\u{10FFFF}])*((([/?](%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*)?#|[/?])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*)?|([A-Za-z][+\-.0-9A-Za-z]*(:%[0-9A-Fa-f]{2}|:[!$&-.0-;=?-Z_a-z~-\u{10FFFF}]|[/?])|\?)(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*|([A-Za-z][+\-.0-9A-Za-z]*:)?\/((%[0-9A-Fa-f]{2}|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~-\u{10FFFF}])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~-\u{10FFFF}]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?[/?]|[!$&-.0-;=?-Z_a-z~-\u{10FFFF}])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~-\u{10FFFF}])+(:\d*)?|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~-\u{10FFFF}]+)?|[.0-:A-Fa-f]+)\])?:\d*|\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~-\u{10FFFF}]+)?|[.0-:A-Fa-f]+)\])?)?|[A-Za-z][+\-.0-9A-Za-z]*:?)?$/u,uuid:/^[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12}$/i,"uri-template":/(%[0-9a-f]{2}|[!#$&(-;=?@\[\]_a-z~]|\{[!#&+,./;=?@|]?(%[0-9a-f]{2}|[0-9_a-z])(\.?(%[0-9a-f]{2}|[0-9_a-z]))*(:[1-9]\d{0,3}|\*)?(,(%[0-9a-f]{2}|[0-9_a-z])(\.?(%[0-9a-f]{2}|[0-9_a-z]))*(:[1-9]\d{0,3}|\*)?)*\})*/iu,"json-pointer":/^(\/([\x00-\x2e0-@\[-}\x7f]|~[01])*)*$/iu,"relative-json-pointer":/^\d+(#|(\/([\x00-\x2e0-@\[-}\x7f]|~[01])*)*)$/iu,hostname:/^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\.?$/,"host-name":/^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\.?$/,"utc-millisec":function(a){return"string"==typeof a&&parseFloat(a)===parseInt(a,10)&&!isNaN(a)},regex:function(a){var b=!0;try{new RegExp(a)}catch(a){b=!1}return b},style:/[\r\n\t ]*[^\r\n\t ][^:]*:[\r\n\t ]*[^\r\n\t ;]*[\r\n\t ]*;?/,color:/^(#?([0-9A-Fa-f]{3}){1,2}\b|aqua|black|blue|fuchsia|gray|green|lime|maroon|navy|olive|orange|purple|red|silver|teal|white|yellow|(rgb\(\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*\))|(rgb\(\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*\)))$/,phone:/^\+(?:[0-9] ?){6,14}[0-9]$/,alpha:/^[a-zA-Z]+$/,alphanumeric:/^[a-zA-Z0-9]+$/};j.regexp=j.regex,j.pattern=j.regex,j.ipv4=j["ip-address"],c.isFormat=function(a,b,c){if("string"==typeof a&&void 0!==j[b]){if(j[b]instanceof RegExp)return j[b].test(a);if("function"==typeof j[b])return j[b](a)}else if(c&&c.customFormats&&"function"==typeof c.customFormats[b])return c.customFormats[b](a);return!0};var k=c.makeSuffix=function(a){return(a=a.toString()).match(/[.\s\[\]]/)||a.match(/^[\d]/)?a.match(/^\d+$/)?"["+a+"]":"["+JSON.stringify(a)+"]":"."+a};function l(a,b,c,d){"object"==typeof c?b[d]=o(a[d],c):-1===a.indexOf(c)&&b.push(c)}function m(a,b,c){b[c]=a[c]}function n(a,b,c,d){"object"==typeof b[d]&&b[d]&&a[d]?c[d]=o(a[d],b[d]):c[d]=b[d]}function o(a,b){var c=Array.isArray(b),d=c&&[]||{};return c?(a=a||[],d=d.concat(a),b.forEach(l.bind(null,a,d))):(a&&"object"==typeof a&&Object.keys(a).forEach(m.bind(null,a,d)),Object.keys(b).forEach(n.bind(null,a,b,d))),d}function p(a){return"/"+encodeURIComponent(a).replace(/~/g,"%7E")}c.deepCompareStrict=function a(b,c){if(typeof b!=typeof c)return!1;if(Array.isArray(b))return!!Array.isArray(c)&&b.length===c.length&&b.every(function(d,e){return a(b[e],c[e])});if("object"==typeof b){if(!b||!c)return b===c;var d=Object.keys(b),e=Object.keys(c);return d.length===e.length&&d.every(function(d){return a(b[d],c[d])})}return b===c},b.exports.deepMerge=o,c.objectGetPath=function(a,b){for(var c,d=b.split("/").slice(1);"string"==typeof(c=d.shift());){var e=decodeURIComponent(c.replace(/~0/,"~").replace(/~1/g,"/"));if(!(e in a))return;a=a[e]}return a},c.encodePath=function(a){return a.map(p).join("")},c.getDecimalPlaces=function(a){var b=0;if(isNaN(a))return b;"number"!=typeof a&&(a=Number(a));var c=a.toString().split("e");if(2===c.length)if("-"!==c[1][0])return b;else b=Number(c[1].slice(1));var d=c[0].split(".");return 2===d.length&&(b+=d[1].length),b},c.isSchema=function(a){return"object"==typeof a&&a||"boolean"==typeof a};var q=c.resolveUrl=function(a,b){let c=new URL(b,new URL(a,"resolve://"));if("resolve:"===c.protocol){let{pathname:a,search:b,hash:d}=c;return a+b+d}return c.toString()}},280902,(a,b,c)=>{"use strict";var d=a.r(965569),e=d.ValidatorResult,f=d.SchemaError,g={};g.ignoreProperties={id:!0,default:!0,description:!0,title:!0,additionalItems:!0,then:!0,else:!0,$schema:!0,$ref:!0,extends:!0};var h=g.validators={};function i(a,b,c,d,e){var f=b.throwError,g=b.throwAll;b.throwError=!1,b.throwAll=!1;var h=this.validateSchema(a,e,b,c);return b.throwError=f,b.throwAll=g,!h.valid&&d instanceof Function&&d(h),h.valid}function j(a,b){if(Object.hasOwnProperty.call(a,b))return a[b];if(b in a){for(;a=Object.getPrototypeOf(a);)if(Object.propertyIsEnumerable.call(a,b))return a[b]}}function k(a,b,c,d,e,f){if(this.types.object(a)&&(!b.properties||void 0===b.properties[e]))if(!1===b.additionalProperties)f.addError({name:"additionalProperties",argument:e,message:"is not allowed to have the additional property "+JSON.stringify(e)});else{var g=b.additionalProperties||{};"function"==typeof c.preValidateProperty&&c.preValidateProperty(a,e,g,c,d);var h=this.validateSchema(a[e],g,c,d.makeChild(g,e));h.instance!==f.instance[e]&&(f.instance[e]=h.instance),f.importErrors(h)}}h.type=function(a,b,c,d){if(void 0===a)return null;var f=new e(a,b,c,d),g=Array.isArray(b.type)?b.type:[b.type];if(!g.some(this.testType.bind(this,a,b,c,d))){var h=g.map(function(a){if(a){var b=a.$id||a.id;return b?"<"+b+">":a+""}});f.addError({name:"type",argument:h,message:"is not of a type(s) "+h})}return f},h.anyOf=function(a,b,c,d){if(void 0===a)return null;var g=new e(a,b,c,d),h=new e(a,b,c,d);if(!Array.isArray(b.anyOf))throw new f("anyOf must be an array");if(!b.anyOf.some(i.bind(this,a,c,d,function(a){h.importErrors(a)}))){var j=b.anyOf.map(function(a,b){var c=a.$id||a.id;return c?"<"+c+">":a.title&&JSON.stringify(a.title)||a.$ref&&"<"+a.$ref+">"||"[subschema "+b+"]"});c.nestedErrors&&g.importErrors(h),g.addError({name:"anyOf",argument:j,message:"is not any of "+j.join(",")})}return g},h.allOf=function(a,b,c,d){if(void 0===a)return null;if(!Array.isArray(b.allOf))throw new f("allOf must be an array");var g=new e(a,b,c,d),h=this;return b.allOf.forEach(function(b,e){var f=h.validateSchema(a,b,c,d);if(!f.valid){var i=b.$id||b.id||b.title&&JSON.stringify(b.title)||b.$ref&&"<"+b.$ref+">"||"[subschema "+e+"]";g.addError({name:"allOf",argument:{id:i,length:f.errors.length,valid:f},message:"does not match allOf schema "+i+" with "+f.errors.length+" error[s]:"}),g.importErrors(f)}}),g},h.oneOf=function(a,b,c,d){if(void 0===a)return null;if(!Array.isArray(b.oneOf))throw new f("oneOf must be an array");var g=new e(a,b,c,d),h=new e(a,b,c,d),j=b.oneOf.filter(i.bind(this,a,c,d,function(a){h.importErrors(a)})).length,k=b.oneOf.map(function(a,b){return a.$id||a.id||a.title&&JSON.stringify(a.title)||a.$ref&&"<"+a.$ref+">"||"[subschema "+b+"]"});return 1!==j&&(c.nestedErrors&&g.importErrors(h),g.addError({name:"oneOf",argument:k,message:"is not exactly one from "+k.join(",")})),g},h.if=function(a,b,c,f){if(void 0===a)return null;if(!d.isSchema(b.if))throw Error('Expected "if" keyword to be a schema');var g,h=i.call(this,a,c,f,null,b.if),j=new e(a,b,c,f);if(h){if(void 0===b.then)return;if(!d.isSchema(b.then))throw Error('Expected "then" keyword to be a schema');g=this.validateSchema(a,b.then,c,f.makeChild(b.then)),j.importErrors(g)}else{if(void 0===b.else)return;if(!d.isSchema(b.else))throw Error('Expected "else" keyword to be a schema');g=this.validateSchema(a,b.else,c,f.makeChild(b.else)),j.importErrors(g)}return j},h.propertyNames=function(a,b,c,g){if(this.types.object(a)){var h=new e(a,b,c,g),i=void 0!==b.propertyNames?b.propertyNames:{};if(!d.isSchema(i))throw new f('Expected "propertyNames" to be a schema (object or boolean)');for(var k in a)if(void 0!==j(a,k)){var l=this.validateSchema(k,i,c,g.makeChild(i));h.importErrors(l)}return h}},h.properties=function(a,b,c,d){if(this.types.object(a)){var g=new e(a,b,c,d),h=b.properties||{};for(var i in h){var k=h[i];if(void 0!==k){if(null===k)throw new f('Unexpected null, expected schema in "properties"');"function"==typeof c.preValidateProperty&&c.preValidateProperty(a,i,k,c,d);var l=j(a,i),m=this.validateSchema(l,k,c,d.makeChild(k,i));m.instance!==g.instance[i]&&(g.instance[i]=m.instance),g.importErrors(m)}}return g}},h.patternProperties=function(a,b,c,d){if(this.types.object(a)){var g=new e(a,b,c,d),h=b.patternProperties||{};for(var i in a){var j=!0;for(var l in h){var m=h[l];if(void 0!==m){if(null===m)throw new f('Unexpected null, expected schema in "patternProperties"');try{var n=RegExp(l,"u")}catch(a){n=new RegExp(l)}if(n.test(i)){j=!1,"function"==typeof c.preValidateProperty&&c.preValidateProperty(a,i,m,c,d);var o=this.validateSchema(a[i],m,c,d.makeChild(m,i));o.instance!==g.instance[i]&&(g.instance[i]=o.instance),g.importErrors(o)}}}j&&k.call(this,a,b,c,d,i,g)}return g}},h.additionalProperties=function(a,b,c,d){if(this.types.object(a)){if(b.patternProperties)return null;var f=new e(a,b,c,d);for(var g in a)k.call(this,a,b,c,d,g,f);return f}},h.minProperties=function(a,b,c,d){if(this.types.object(a)){var f=new e(a,b,c,d);return Object.keys(a).length>=b.minProperties||f.addError({name:"minProperties",argument:b.minProperties,message:"does not meet minimum property length of "+b.minProperties}),f}},h.maxProperties=function(a,b,c,d){if(this.types.object(a)){var f=new e(a,b,c,d);return Object.keys(a).length<=b.maxProperties||f.addError({name:"maxProperties",argument:b.maxProperties,message:"does not meet maximum property length of "+b.maxProperties}),f}},h.items=function(a,b,c,d){var f=this;if(this.types.array(a)&&void 0!==b.items){var g=new e(a,b,c,d);return a.every(function(a,e){if(Array.isArray(b.items))var h=void 0===b.items[e]?b.additionalItems:b.items[e];else var h=b.items;if(void 0===h)return!0;if(!1===h)return g.addError({name:"items",message:"additionalItems not permitted"}),!1;var i=f.validateSchema(a,h,c,d.makeChild(h,e));return i.instance!==g.instance[e]&&(g.instance[e]=i.instance),g.importErrors(i),!0}),g}},h.contains=function(a,b,c,f){var g=this;if(this.types.array(a)&&void 0!==b.contains){if(!d.isSchema(b.contains))throw Error('Expected "contains" keyword to be a schema');var h=new e(a,b,c,f);return!1===a.some(function(a,d){return 0===g.validateSchema(a,b.contains,c,f.makeChild(b.contains,d)).errors.length})&&h.addError({name:"contains",argument:b.contains,message:"must contain an item matching given schema"}),h}},h.minimum=function(a,b,c,d){if(this.types.number(a)){var f=new e(a,b,c,d);return b.exclusiveMinimum&&!0===b.exclusiveMinimum?a>b.minimum||f.addError({name:"minimum",argument:b.minimum,message:"must be greater than "+b.minimum}):a>=b.minimum||f.addError({name:"minimum",argument:b.minimum,message:"must be greater than or equal to "+b.minimum}),f}},h.maximum=function(a,b,c,d){if(this.types.number(a)){var f=new e(a,b,c,d);return b.exclusiveMaximum&&!0===b.exclusiveMaximum?a<b.maximum||f.addError({name:"maximum",argument:b.maximum,message:"must be less than "+b.maximum}):a<=b.maximum||f.addError({name:"maximum",argument:b.maximum,message:"must be less than or equal to "+b.maximum}),f}},h.exclusiveMinimum=function(a,b,c,d){if("boolean"!=typeof b.exclusiveMinimum&&this.types.number(a)){var f=new e(a,b,c,d);return a>b.exclusiveMinimum||f.addError({name:"exclusiveMinimum",argument:b.exclusiveMinimum,message:"must be strictly greater than "+b.exclusiveMinimum}),f}},h.exclusiveMaximum=function(a,b,c,d){if("boolean"!=typeof b.exclusiveMaximum&&this.types.number(a)){var f=new e(a,b,c,d);return a<b.exclusiveMaximum||f.addError({name:"exclusiveMaximum",argument:b.exclusiveMaximum,message:"must be strictly less than "+b.exclusiveMaximum}),f}};var l=function(a,b,c,g,h,i){if(this.types.number(a)){var j=b[h];if(0==j)throw new f(h+" cannot be zero");var k=new e(a,b,c,g),l=Math.pow(10,Math.max(d.getDecimalPlaces(a),d.getDecimalPlaces(j)));return Math.round(a*l)%Math.round(j*l)!=0&&k.addError({name:h,argument:j,message:i+JSON.stringify(j)}),k}};function m(a,b,c){var e,f=c.length;for(e=b+1;e<f;e++)if(d.deepCompareStrict(a,c[e]))return!1;return!0}h.multipleOf=function(a,b,c,d){return l.call(this,a,b,c,d,"multipleOf","is not a multiple of (divisible by) ")},h.divisibleBy=function(a,b,c,d){return l.call(this,a,b,c,d,"divisibleBy","is not divisible by (multiple of) ")},h.required=function(a,b,c,d){var f=new e(a,b,c,d);return void 0===a&&!0===b.required?f.addError({name:"required",message:"is required"}):this.types.object(a)&&Array.isArray(b.required)&&b.required.forEach(function(b){void 0===j(a,b)&&f.addError({name:"required",argument:b,message:"requires property "+JSON.stringify(b)})}),f},h.pattern=function(a,b,c,d){if(this.types.string(a)){var f=new e(a,b,c,d),g=b.pattern;try{var h=RegExp(g,"u")}catch(a){h=new RegExp(g)}return a.match(h)||f.addError({name:"pattern",argument:b.pattern,message:"does not match pattern "+JSON.stringify(b.pattern.toString())}),f}},h.format=function(a,b,c,f){if(void 0!==a){var g=new e(a,b,c,f);return g.disableFormat||d.isFormat(a,b.format,this)||g.addError({name:"format",argument:b.format,message:"does not conform to the "+JSON.stringify(b.format)+" format"}),g}},h.minLength=function(a,b,c,d){if(this.types.string(a)){var f=new e(a,b,c,d),g=a.match(/[\uDC00-\uDFFF]/g);return a.length-(g?g.length:0)>=b.minLength||f.addError({name:"minLength",argument:b.minLength,message:"does not meet minimum length of "+b.minLength}),f}},h.maxLength=function(a,b,c,d){if(this.types.string(a)){var f=new e(a,b,c,d),g=a.match(/[\uDC00-\uDFFF]/g);return a.length-(g?g.length:0)<=b.maxLength||f.addError({name:"maxLength",argument:b.maxLength,message:"does not meet maximum length of "+b.maxLength}),f}},h.minItems=function(a,b,c,d){if(this.types.array(a)){var f=new e(a,b,c,d);return a.length>=b.minItems||f.addError({name:"minItems",argument:b.minItems,message:"does not meet minimum length of "+b.minItems}),f}},h.maxItems=function(a,b,c,d){if(this.types.array(a)){var f=new e(a,b,c,d);return a.length<=b.maxItems||f.addError({name:"maxItems",argument:b.maxItems,message:"does not meet maximum length of "+b.maxItems}),f}},h.uniqueItems=function(a,b,c,d){if(!0===b.uniqueItems&&this.types.array(a)){var f=new e(a,b,c,d);return a.every(m)||f.addError({name:"uniqueItems",message:"contains duplicate item"}),f}},h.dependencies=function(a,b,c,d){if(this.types.object(a)){var f=new e(a,b,c,d);for(var g in b.dependencies)if(void 0!==a[g]){var h=b.dependencies[g],i=d.makeChild(h,g);if("string"==typeof h&&(h=[h]),Array.isArray(h))h.forEach(function(b){void 0===a[b]&&f.addError({name:"dependencies",argument:i.propertyPath,message:"property "+b+" not found, required by "+i.propertyPath})});else{var j=this.validateSchema(a,h,c,i);f.instance!==j.instance&&(f.instance=j.instance),j&&j.errors.length&&(f.addError({name:"dependencies",argument:i.propertyPath,message:"does not meet dependency required by "+i.propertyPath}),f.importErrors(j))}}return f}},h.enum=function(a,b,c,g){if(void 0===a)return null;if(!Array.isArray(b.enum))throw new f("enum expects an array",b);var h=new e(a,b,c,g);return b.enum.some(d.deepCompareStrict.bind(null,a))||h.addError({name:"enum",argument:b.enum,message:"is not one of enum values: "+b.enum.map(String).join(",")}),h},h.const=function(a,b,c,f){if(void 0===a)return null;var g=new e(a,b,c,f);return d.deepCompareStrict(b.const,a)||g.addError({name:"const",argument:b.const,message:"does not exactly match expected constant: "+b.const}),g},h.not=h.disallow=function(a,b,c,d){var f=this;if(void 0===a)return null;var g=new e(a,b,c,d),h=b.not||b.disallow;return h?(Array.isArray(h)||(h=[h]),h.forEach(function(e){if(f.testType(a,b,c,d,e)){var h=e&&(e.$id||e.id)||e;g.addError({name:"not",argument:h,message:"is of prohibited type "+h})}}),g):null},b.exports=g},545891,(a,b,c)=>{"use strict";var d=a.r(965569);function e(a,b){this.id=a,this.ref=b}b.exports.SchemaScanResult=e,b.exports.scan=function(a,b){function c(a,b){if(!b||"object"!=typeof b)return;if(b.$ref){let c=d.resolveUrl(a,b.$ref);i[c]=i[c]?i[c]+1:0;return}var e=b.$id||b.id;let j=d.resolveUrl(a,e);var k=e?j:a;if(k){if(0>k.indexOf("#")&&(k+="#"),h[k]){if(!d.deepCompareStrict(h[k],b))throw Error("Schema <"+k+"> already exists with different definition");return h[k]}h[k]=b,"#"==k[k.length-1]&&(h[k.substring(0,k.length-1)]=b)}f(k+"/items",Array.isArray(b.items)?b.items:[b.items]),f(k+"/extends",Array.isArray(b.extends)?b.extends:[b.extends]),c(k+"/additionalItems",b.additionalItems),g(k+"/properties",b.properties),c(k+"/additionalProperties",b.additionalProperties),g(k+"/definitions",b.definitions),g(k+"/patternProperties",b.patternProperties),g(k+"/dependencies",b.dependencies),f(k+"/disallow",b.disallow),f(k+"/allOf",b.allOf),f(k+"/anyOf",b.anyOf),f(k+"/oneOf",b.oneOf),c(k+"/not",b.not)}function f(a,b){if(Array.isArray(b))for(var d=0;d<b.length;d++)c(a+"/"+d,b[d])}function g(a,b){if(b&&"object"==typeof b)for(var d in b)c(a+"/"+d,b[d])}var h={},i={};return c(a,b),new e(h,i)}},625446,(a,b,c)=>{"use strict";var d=a.r(280902),e=a.r(965569),f=a.r(545891).scan,g=e.ValidatorResult,h=e.ValidatorResultError,i=e.SchemaError,j=e.SchemaContext,k=function a(){this.customFormats=Object.create(a.prototype.customFormats),this.schemas={},this.unresolvedRefs=[],this.types=Object.create(m),this.attributes=Object.create(d.validators)};function l(a){var b="string"==typeof a?a:a.$ref;return"string"==typeof b&&b}k.prototype.customFormats={},k.prototype.schemas=null,k.prototype.types=null,k.prototype.attributes=null,k.prototype.unresolvedRefs=null,k.prototype.addSchema=function(a,b){var c=this;if(!a)return null;var d=f(b||"/",a),e=b||a.$id||a.id;for(var g in d.id)this.schemas[g]=d.id[g];for(var g in d.ref)this.unresolvedRefs.push(g);return this.unresolvedRefs=this.unresolvedRefs.filter(function(a){return void 0===c.schemas[a]}),this.schemas[e]},k.prototype.addSubSchemaArray=function(a,b){if(Array.isArray(b))for(var c=0;c<b.length;c++)this.addSubSchema(a,b[c])},k.prototype.addSubSchemaObject=function(a,b){if(b&&"object"==typeof b)for(var c in b)this.addSubSchema(a,b[c])},k.prototype.setSchemas=function(a){this.schemas=a},k.prototype.getSchema=function(a){return this.schemas[a]},k.prototype.validate=function(a,b,c,d){if("boolean"!=typeof b&&"object"!=typeof b||null===b)throw new i("Expected `schema` to be an object or boolean");c||(c={});var k=b.$id||b.id;let l=e.resolveUrl(c.base,k||"");if(!d){(d=new j(b,c,[],l,Object.create(this.schemas))).schemas[l]||(d.schemas[l]=b);var m=f(l,b);for(var n in m.id){var o=m.id[n];d.schemas[n]=o}}if(c.required&&void 0===a){var p=new g(a,b,c,d);return p.addError("is required, but is undefined"),p}var p=this.validateSchema(a,b,c,d);if(p){if(c.throwAll&&p.errors.length)throw new h(p)}else throw Error("Result undefined");return p},k.prototype.validateSchema=function(a,b,c,f){var h=new g(a,b,c,f);if("boolean"==typeof b)!0===b?b={}:!1===b&&(b={type:[]});else if(!b)throw Error("schema is undefined");if(b.extends)if(Array.isArray(b.extends)){var k={schema:b,ctx:f};b.extends.forEach(this.schemaTraverser.bind(this,k)),b=k.schema,k.schema=null,k.ctx=null,k=null}else b=e.deepMerge(b,this.superResolve(b.extends,f));var m=l(b);if(m){var n=this.resolve(b,m,f),o=new j(n.subschema,c,f.path,n.switchSchema,f.schemas);return this.validateSchema(a,n.subschema,c,o)}var p=c&&c.skipAttributes||[];for(var q in b)if(!d.ignoreProperties[q]&&0>p.indexOf(q)){var r=null,s=this.attributes[q];if(s)r=s.call(this,a,b,c,f);else if(!1===c.allowUnknownAttributes)throw new i("Unsupported attribute: "+q,b);r&&h.importErrors(r)}return"function"==typeof c.rewrite&&(h.instance=c.rewrite.call(this,a,b,c,f)),h},k.prototype.schemaTraverser=function(a,b){a.schema=e.deepMerge(a.schema,this.superResolve(b,a.ctx))},k.prototype.superResolve=function(a,b){var c=l(a);return c?this.resolve(a,c,b).subschema:a},k.prototype.resolve=function(a,b,c){if(b=c.resolve(b),c.schemas[b])return{subschema:c.schemas[b],switchSchema:b};let d=new URL(b,"thismessage::/").hash;var f=d&&d.length&&b.substr(0,b.length-d.length);if(!f||!c.schemas[f])throw new i("no such schema <"+b+">",a);var g=e.objectGetPath(c.schemas[f],d.substr(1));if(void 0===g)throw new i("no such schema "+d+" located in <"+f+">",a);return{subschema:g,switchSchema:b}},k.prototype.testType=function(a,b,c,d,e){if(void 0!==e){if(null===e)throw new i('Unexpected null in "type" keyword');if("function"==typeof this.types[e])return this.types[e].call(this,a);if(e&&"object"==typeof e){var f=this.validateSchema(a,e,c,d);return void 0===f||!(f&&f.errors.length)}return!0}};var m=k.prototype.types={};m.string=function(a){return"string"==typeof a},m.number=function(a){return"number"==typeof a&&isFinite(a)},m.integer=function(a){return"number"==typeof a&&a%1==0},m.boolean=function(a){return"boolean"==typeof a},m.array=function(a){return Array.isArray(a)},m.null=function(a){return null===a},m.date=function(a){return a instanceof Date},m.any=function(a){return!0},m.object=function(a){return a&&"object"==typeof a&&!Array.isArray(a)&&!(a instanceof Date)},b.exports=k},12191,(a,b,c)=>{"use strict";var d=b.exports.Validator=a.r(625446);b.exports.ValidatorResult=a.r(965569).ValidatorResult,b.exports.ValidatorResultError=a.r(965569).ValidatorResultError,b.exports.ValidationError=a.r(965569).ValidationError,b.exports.SchemaError=a.r(965569).SchemaError,b.exports.SchemaScanResult=a.r(545891).SchemaScanResult,b.exports.scan=a.r(545891).scan,b.exports.validate=function(a,b,c){return new d().validate(a,b,c)}},925730,423026,983857,a=>{"use strict";var b=a.i(608061),c=a.i(292458),d=a.i(57843),e=a.i(527344),f=a.i(429150);a.i(752298);var g=a.i(693025),h=a.i(483664),i=a.i(193390),j=a.i(680904),k=a.i(12191),l=a.i(800218);let m=new k.Validator,n=(a,b=[])=>{let c=[];if(a&&"object"==typeof a&&a.properties)for(let[d,e]of Object.entries(a.properties))"boolean"==typeof e?c.push(`Error: Property '${[...b,d].join(".")}' must not be a boolean schema`):"object"==typeof e&&(c=c.concat(n(e,[...b,d])));return c},o=a=>{let{type:b,items:c,enum:d}=a;return"file"===a.schemaType?i.Type.file:d&&d.length>0?i.Type.enumType:b===i.Type.array&&c?i.ArrayType[c.type]:b},p=a=>null===a?"null":"object"!=typeof a?typeof a:Object.prototype.toString.call(a).slice(8,-1).toLocaleLowerCase(),q=a=>{let b,c={type:"array"===(b=p(a))?i.Type.array:"boolean"===b?i.Type.string:"number"===b?i.Type.number:"string"===b?i.Type.string:"object"===b?i.Type.object:i.Type.string};return c.type===i.Type.object?(c.properties={},c.required=[],c.additionalProperties=!1,Object.entries(a).forEach(([a,b])=>{c.properties[a]=q(b),c.required.push(a)})):c.type===i.Type.array&&(c.items=q(a[0])),c},r=a=>{if(!a||"object"!==p(a))return 0;let b=0;if("array"===p(a))a[0]&&"object"===p(a[0])&&(b=r(a[0]));else if("object"===p(a)){let c=Object.values(a).map(a=>r(a));b=c.length?Math.max(...c)+1:1}return b},s=a=>{if(!a||"object"!==p(a))return 0;let b=0;if(a.type===i.Type.object&&a.properties){let c=Object.values(a.properties).map(a=>s(a));b=c.length?Math.max(...c)+1:1}else a.type===i.Type.array&&a.items&&a.items.type===i.Type.object&&(b=s(a.items)+1);return b},t=j.z.object({type:j.z.literal("object"),properties:j.z.record(j.z.string(),j.z.any()),required:j.z.array(j.z.string()),additionalProperties:j.z.boolean().optional()});a.s(["checkJsonDepth",0,r,"checkJsonSchemaDepth",0,s,"findPropertyWithPath",0,(a,b)=>{let c=a;for(let a of b)c=c[a];return c},"getFieldType",0,o,"getHasChildren",0,a=>!![i.Type.object,i.Type.array].includes(a.type)&&(a.type===i.Type.object?a.properties&&Object.keys(a.properties).length>0:a.type===i.Type.array?a.items&&a.items.type===i.Type.object&&a.items.properties&&Object.keys(a.items.properties).length>0:void 0),"getValidationErrorMessage",0,a=>a.map(a=>"string"==typeof a?a:`Error: ${a.stack}
`).join(""),"jsonToSchema",0,q,"preValidateSchema",0,a=>t.safeParse(a),"validateSchemaAgainstDraft7",0,a=>{let b=m.validate(a,l.default),c=n(a);return[...b.errors,...c]}],423026);let u=d.memo(({depth:a=1,className:c})=>{let d=Array.from({length:a},(a,b)=>b);return(0,b.jsx)("div",{className:(0,e.cn)("flex",c),children:d.map(a=>(0,b.jsx)("div",{className:(0,e.cn)("ml-2.5 mr-2.5 w-px bg-divider-regular")},a))})});a.s(["default",0,u],983857);let v=({valueSelector:a,name:c,payload:d,depth:j=1,readonly:k,onSelect:l})=>{let{t:m}=(0,g.useTranslation)(),n=d.type===i.Type.object&&d.properties;return j>11?null:(0,b.jsxs)("div",{children:[(0,b.jsx)(h.default,{popupContent:m("structOutput.moreFillTip",{ns:"app"}),disabled:11!==j,children:(0,b.jsxs)("div",{className:(0,e.cn)("flex items-center justify-between rounded-md pr-2",!k&&"hover:bg-state-base-hover",11!==j&&"cursor-pointer"),onMouseDown:()=>!k&&l?.([...a,c]),children:[(0,b.jsxs)("div",{className:"flex grow items-stretch",children:[(0,b.jsx)(u,{depth:j}),11===j?(0,b.jsx)(f.RiMoreFill,{className:"h-3 w-3 text-text-tertiary"}):(0,b.jsx)("div",{className:(0,e.cn)("system-sm-medium h-6 w-0 grow truncate leading-6 text-text-secondary",k&&!n&&"text-text-accent"),children:c})]}),j<11&&(0,b.jsx)("div",{className:"system-xs-regular ml-2 shrink-0 text-text-tertiary",children:o(d)})]})}),j<=10&&d.type===i.Type.object&&d.properties&&(0,b.jsx)("div",{children:Object.keys(d.properties).map(e=>(0,b.jsx)(v,{name:e,payload:d.properties?.[e],depth:j+1,readonly:k,valueSelector:[...a,c],onSelect:l},e))})]})},w=d.memo(v),x=({className:a,root:f,payload:g,readonly:h,onHovering:i,onSelect:j})=>{let k=(0,d.useRef)(null);(0,c.useHover)(k,{onChange:a=>{a?i?.(!0):setTimeout(()=>{i?.(!1)},100)}});let l=g.schema,m=Object.keys(l.properties);return(0,b.jsxs)("div",{className:(0,e.cn)(a),ref:k,children:[(0,b.jsxs)("div",{className:"flex items-center justify-between px-2 py-1",children:[(0,b.jsxs)("div",{className:"flex",children:[f.nodeName&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"system-sm-medium max-w-[100px] truncate text-text-tertiary",children:f.nodeName}),(0,b.jsx)("div",{className:"system-sm-medium text-text-tertiary",children:"."})]}),(0,b.jsx)("div",{className:"system-sm-medium text-text-secondary",children:f.attrName})]}),(0,b.jsx)("div",{className:"system-xs-regular ml-2 truncate text-text-tertiary",title:f.attrAlias||"object",children:f.attrAlias||"object"})]}),m.map(a=>(0,b.jsx)(w,{name:a,payload:l.properties[a],readonly:h,valueSelector:[f.nodeId,f.attrName],onSelect:j},a))]})},y=d.memo(({className:a,...c})=>(0,b.jsx)("div",{className:(0,e.cn)("w-[296px] rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur p-1 shadow-lg backdrop-blur-[5px]",a),children:(0,b.jsx)(x,{...c})}));a.s(["PickerPanelMain",0,x,"default",0,y],925730)},304905,a=>{"use strict";var b=a.i(741107);a.s(["VariableIconWithColor",()=>b.default])},697638,a=>{"use strict";var b=a.i(608061),c=a.i(292458),d=a.i(111089),e=a.i(57843);a.i(752298);var f=a.i(693025);a.i(943046);var g=a.i(782465);a.i(622666);var h=a.i(33968),i=a.i(760581);a.i(805980);var j=a.i(634919),k=a.i(816134),l=a.i(825319),m=a.i(252613),n=a.i(925730);a.i(963284);var o=a.i(304905),p=a.i(735310),q=a.i(527344),r=a.i(499257),s=a.i(193390),t=a.i(429150);let u=({onManage:a})=>{let{t:c}=(0,f.useTranslation)();return(0,b.jsxs)("div",{className:"flex items-center border-t border-divider-subtle pt-1",children:[(0,b.jsxs)("div",{className:"flex h-8 grow cursor-pointer items-center px-3",onClick:a,children:[(0,b.jsx)(t.RiAddLine,{className:"mr-1 h-4 w-4 text-text-tertiary"}),(0,b.jsx)("div",{className:"system-xs-medium truncate text-text-tertiary",title:"Create user input field",children:c("inputField.create",{ns:"pipeline"})})]}),(0,b.jsx)("div",{className:"mx-1 h-3 w-[1px] shrink-0 bg-divider-regular"}),(0,b.jsx)("div",{className:"system-xs-medium flex h-8 shrink-0 cursor-pointer items-center justify-center px-3 text-text-tertiary",onClick:a,children:c("inputField.manage",{ns:"pipeline"})})]})};var v=a.i(986963);let w=({nodeId:a,title:f,objPath:k,itemData:r,onChange:t,onHovering:u,isSupportFileVar:w,isException:x,isLoopVar:y,isFlat:z,isInCodeGeneratorInstructionEditor:A,zIndex:B,className:C,preferSchemaType:D})=>{let E=r.type===p.VarType.object&&r.children?.schema?.properties,F=r.type===p.VarType.file&&!E,G=[p.VarType.object,p.VarType.file].includes(r.type)&&r.children&&r.children.length>0,H=r.variable.startsWith("sys."),I=r.variable.startsWith("env."),J=r.variable.startsWith("conversation."),K=r.isRagVariable,L=(0,e.useMemo)(()=>{let a;if(!z)return null;switch(r.variable){case"current":return a=A?h.CodeAssistant:i.MagicEdit,(0,b.jsx)(a,{className:"h-3.5 w-3.5 shrink-0 text-util-colors-violet-violet-600"});case"error_message":return(0,b.jsx)(j.Variable02,{className:"h-3.5 w-3.5 shrink-0 text-util-colors-orange-dark-orange-dark-600"});default:return(0,b.jsx)(j.Variable02,{className:"h-3.5 w-3.5 shrink-0 text-text-accent"})}},[z,A,r.variable]),M=(0,e.useMemo)(()=>m.VAR_SHOW_NAME_MAP[r.variable]?m.VAR_SHOW_NAME_MAP[r.variable]:z&&"current"===r.variable?A?"current_code":"current_prompt":r.variable,[z,A,r.variable]),N=(0,e.useMemo)(()=>{if(!G)return null;let a={};return(r.children||[]).forEach(b=>{a[b.variable]={type:(0,v.varTypeToStructType)(b.type)}}),{schema:{type:s.Type.object,properties:a,required:[],additionalProperties:!1}}},[G,r.children]),O=E?r.children:N,P=(0,e.useRef)(null),[Q,R]=(0,e.useState)(!1);(0,c.useHover)(P,{onChange:a=>{a?R(!0):G||E?setTimeout(()=>{R(!1)},100):R(!1)}});let[S,T]=(0,e.useState)(!1),U=Q||S,V=(G||E)&&U;(0,e.useEffect)(()=>{u?.(U)},[U]);let W=(0,e.useMemo)(()=>I?"environment":J?"conversation":y?"loop":K?"rag":"system",[I,J,H,y,K]);return(0,b.jsxs)(l.PortalToFollowElem,{open:V,onOpenChange:d.noop,placement:"left-start",children:[(0,b.jsx)(l.PortalToFollowElemTrigger,{className:"w-full",children:(0,b.jsxs)("div",{ref:P,className:(0,q.cn)(G||E?" pr-1":"pr-[18px]",U&&(G||E?"bg-components-panel-on-panel-item-bg-hover":"bg-state-base-hover"),"relative flex h-6 w-full cursor-pointer items-center rounded-md pl-3",C),onClick:b=>{b.stopPropagation(),(w||!F)&&(z?t([r.variable],r):H||I||J||K?t([...k,...r.variable.split(".")],r):t([a,...k,r.variable],r))},onMouseDown:a=>a.preventDefault(),children:[(0,b.jsxs)("div",{className:"flex w-0 grow items-center",children:[!z&&(0,b.jsx)(o.VariableIconWithColor,{variables:r.variable.split("."),variableCategory:W,isExceptionVariable:x}),z&&L,!I&&!J&&!K&&(0,b.jsx)("div",{title:r.variable,className:"system-sm-medium ml-1 w-0 grow truncate text-text-secondary",children:M}),I&&(0,b.jsx)("div",{title:r.variable,className:"system-sm-medium ml-1 w-0 grow truncate text-text-secondary",children:r.variable.replace("env.","")}),J&&(0,b.jsx)("div",{title:r.des,className:"system-sm-medium ml-1 w-0 grow truncate text-text-secondary",children:r.variable.replace("conversation.","")}),K&&(0,b.jsx)("div",{title:r.des,className:"system-sm-medium ml-1 w-0 grow truncate text-text-secondary",children:r.variable.split(".").slice(-1)[0]})]}),(0,b.jsx)("div",{className:"ml-1 shrink-0 text-xs font-normal capitalize text-text-tertiary",children:D&&r.schemaType?r.schemaType:r.type}),(G||E)&&(0,b.jsx)(g.ChevronRight,{className:(0,q.cn)("ml-0.5 h-3 w-3 text-text-quaternary",U&&"text-text-tertiary")})]})}),(0,b.jsx)(l.PortalToFollowElemContent,{style:{zIndex:B||100},children:(E||G)&&(0,b.jsx)(n.default,{root:{nodeId:a,nodeName:f,attrName:r.variable,attrAlias:r.schemaType},payload:O,onHovering:T,onSelect:a=>{t(a,r)}})})]})},x=e.memo(({hideSearch:a,searchBoxClassName:c,vars:g,isSupportFileVar:h,onChange:i,itemWidth:j,maxHeightClass:l,onClose:m,onBlur:n,zIndex:o,isInCodeGeneratorInstructionEditor:p,showManageInputField:s,onManageInputField:t,autoFocus:x=!0,preferSchemaType:y})=>{let{t:z}=(0,f.useTranslation)(),[A,B]=(0,e.useState)(""),C=g.filter(a=>a.vars.filter(a=>(0,r.checkKeys)([a.variable],!1).isValid||(0,v.isSpecialVar)(a.variable.split(".")[0])).length>0).filter(a=>A?a.vars.filter(b=>{let c=A.toLowerCase();return b.variable.toLowerCase().includes(c)||a.title.toLowerCase().includes(c)}).length>0:a).map(a=>{let b=a.vars.filter(a=>(0,r.checkKeys)([a.variable],!1).isValid||(0,v.isSpecialVar)(a.variable.split(".")[0]));if(A){let c=A.toLowerCase();a.title.toLowerCase().includes(c)||(b=b.filter(a=>a.variable.toLowerCase().includes(A.toLowerCase())))}return{...a,vars:b}});return(0,b.jsxs)(b.Fragment,{children:[!a&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:(0,q.cn)("var-search-input-wrapper mx-2 mb-2 mt-2",c),onClick:a=>a.stopPropagation(),children:(0,b.jsx)(k.default,{className:"var-search-input",showLeftIcon:!0,showClearIcon:!0,value:A,placeholder:z("common.searchVar",{ns:"workflow"})||"",onChange:a=>B(a.target.value),onKeyDown:a=>{"Escape"===a.key&&(a.preventDefault(),m?.())},onClear:()=>B(""),onBlur:n,autoFocus:x})}),(0,b.jsx)("div",{className:"relative left-[-4px] h-[0.5px] bg-black/5",style:{width:"calc(100% + 8px)"}})]}),C.length>0?(0,b.jsx)("div",{className:(0,q.cn)("max-h-[85vh] overflow-y-auto",l),children:C.map((a,c)=>(0,b.jsxs)("div",{className:(0,q.cn)(!a.isFlat&&"mt-3",0===c&&a.isFlat&&"mt-2"),children:[!a.isFlat&&(0,b.jsx)("div",{className:"system-xs-medium-uppercase truncate px-3 leading-[22px] text-text-tertiary",title:a.title,children:a.title}),a.vars.map((c,d)=>(0,b.jsx)(w,{title:a.title,nodeId:a.nodeId,objPath:[],itemData:c,onChange:i,itemWidth:j,isSupportFileVar:h,isException:c.isException,isLoopVar:a.isLoop,isFlat:a.isFlat,isInCodeGeneratorInstructionEditor:p,zIndex:o,preferSchemaType:y},d)),a.isFlat&&!C[c+1]?.isFlat&&!!C.find(a=>!a.isFlat)&&(0,b.jsxs)("div",{className:"relative mt-[14px] flex  items-center space-x-1",children:[(0,b.jsx)("div",{className:"h-0 w-3 shrink-0 border border-divider-subtle"}),(0,b.jsx)("div",{className:"system-2xs-semibold-uppercase text-text-tertiary",children:z("debug.lastOutput",{ns:"workflow"})}),(0,b.jsx)("div",{className:"h-0  shrink-0 grow border border-divider-subtle"})]})]},c))}):(0,b.jsx)("div",{className:"mt-2 pl-3 text-xs font-medium uppercase leading-[18px] text-gray-500",children:z("common.noVar",{ns:"workflow"})}),s&&(0,b.jsx)(u,{onManage:t||d.noop})]})});a.s(["default",0,x],697638)},294057,a=>{"use strict";var b=a.i(608061),c=a.i(57843),d=a.i(438961),e=a.i(925730),f=a.i(735310),g=a.i(193390);let h=c.memo(({nodeName:a,path:c,varType:h,nodeType:i=f.BlockEnum.LLM})=>{let j=(()=>{let a={type:g.Type.object,properties:{},required:[],additionalProperties:!1},b=a;for(let a=1;a<c.length;a++){let d=a===c.length-1,e=c[a];b.properties[e]={type:d?h:g.Type.object,properties:{}},b=b.properties[e]}return{schema:a}})();return(0,b.jsxs)("div",{className:"w-[280px] rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur pb-0 shadow-lg backdrop-blur-[5px]",children:[(0,b.jsxs)("div",{className:"flex space-x-1 border-b-[0.5px] border-divider-subtle p-3 pb-2 ",children:[(0,b.jsx)(d.default,{size:"xs",type:i}),(0,b.jsx)("div",{className:"system-xs-medium w-0 grow truncate text-text-secondary",children:a})]}),(0,b.jsx)(e.PickerPanelMain,{className:"px-1 pb-3 pt-2",root:{attrName:c[0]},payload:j,readonly:!0})]})});a.s(["default",0,h])}];

//# sourceMappingURL=_2fdc05dc._.js.map
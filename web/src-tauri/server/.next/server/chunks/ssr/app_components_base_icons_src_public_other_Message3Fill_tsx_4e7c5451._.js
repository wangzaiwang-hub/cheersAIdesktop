module.exports=[492507,325111,726951,75959,800963,a=>{"use strict";var b=a.i(425356);a.s(["Message3Fill",()=>b.default],492507);var c=a.i(608061);a.i(533306);var d=a.i(57843),e=a.i(282791);a.i(546107);var f=a.i(105249),g=a.i(179062),h=a.i(528698),i=a.i(692520),j=a.i(425282);let k="webapp",l=[k,"conversations"];a.s(["useGetWebAppAccessModeByCode",0,a=>(0,h.useQuery)({queryKey:[k,"appAccessMode",a],queryFn:()=>(0,i.getAppAccessModeByAppCode)(a),enabled:!!a,staleTime:0,gcTime:0}),"useInvalidateShareConversations",0,()=>(0,j.useInvalid)(l),"useShareChatList",0,(a,b={})=>{let{enabled:c=!0,refetchOnReconnect:d,refetchOnWindowFocus:e}=b,f=c&&a.appSourceType!==i.AppSourceType.tryApp&&(a.appSourceType!==i.AppSourceType.installedApp||!!a.appId)&&!!a.conversationId;return(0,h.useQuery)({queryKey:[k,"chatList",a],queryFn:()=>(0,i.fetchChatList)(a.conversationId,a.appSourceType,a.appId),enabled:f,refetchOnReconnect:d,refetchOnWindowFocus:e,staleTime:0})},"useShareConversationName",0,(a,b={})=>{let{enabled:c=!0,refetchOnReconnect:d,refetchOnWindowFocus:e}=b,f=c&&(a.appSourceType!==i.AppSourceType.installedApp||!!a.appId)&&!!a.conversationId;return(0,h.useQuery)({queryKey:[k,"conversationName",a],queryFn:()=>(0,i.generationConversationName)(a.appSourceType,a.appId,a.conversationId),enabled:f,refetchOnReconnect:d,refetchOnWindowFocus:e})},"useShareConversations",0,(a,b={})=>{let{enabled:c=!0,refetchOnReconnect:d,refetchOnWindowFocus:e}=b,f=c&&a.appSourceType!==i.AppSourceType.tryApp&&(a.appSourceType!==i.AppSourceType.installedApp||!!a.appId);return(0,h.useQuery)({queryKey:[k,"conversations",a],queryFn:()=>(0,i.fetchConversations)(a.appSourceType,a.appId,a.lastId,a.pinned,a.limit),enabled:f,refetchOnReconnect:d,refetchOnWindowFocus:e})}],325111),a.i(724423);let m=(0,e.create)(a=>({shareCode:null,updateShareCode:b=>a(()=>({shareCode:b})),appInfo:null,updateAppInfo:b=>a(()=>({appInfo:b})),appParams:null,updateAppParams:b=>a(()=>({appParams:b})),webAppAccessMode:g.AccessMode.SPECIFIC_GROUPS_MEMBERS,updateWebAppAccessMode:b=>a(()=>({webAppAccessMode:b})),appMeta:null,updateWebAppMeta:b=>a(()=>({appMeta:b})),userCanAccessApp:!1,updateUserCanAccessApp:b=>a(()=>({userCanAccessApp:b})),embeddedUserId:null,updateEmbeddedUserId:b=>a(()=>({embeddedUserId:b})),embeddedConversationId:null,updateEmbeddedConversationId:b=>a(()=>({embeddedConversationId:b}))}));a.s(["useWebAppStore",0,m],726951);var n=a.i(429150),o=a.i(497746),p=a.i(934402),q=a.i(494261),r=a.i(460171),s=a.i(909795),t=a.i(818386);a.i(574469);var u=a.i(709531),v=a.i(114715);a.i(752298);var w=a.i(693025);let x=d.memo(()=>{let{t:a}=(0,w.useTranslation)();return(0,c.jsxs)("div",{className:"flex h-full w-full flex-col items-center justify-center",children:[(0,c.jsx)(n.RiSparklingFill,{className:"h-12 w-12 text-text-empty-state-icon"}),(0,c.jsx)("div",{className:"system-sm-regular mt-2 text-text-quaternary",children:a("generation.noData",{ns:"share"})})]})});var y=a.i(735310),z=a.i(18039),A=a.i(954200),B=a.i(459858),C=a.i(653822);let D=d.memo(({isWorkflow:a,isCallBatchAPI:b,isPC:e,isMobile:g,appSourceType:h,appId:j,isError:k,isShowTextToSpeech:l,promptConfig:m,moreLikeThisEnabled:w,inputs:D,controlSend:E,controlRetry:F,controlStopResponding:G,onShowRes:H,handleSaveMessage:I,taskId:J,onCompleted:K,visionConfig:L,completionFiles:M,siteInfo:N,onRunStart:O,onRunControlChange:P,hideInlineStopButton:Q=!1})=>{let[R,{setTrue:S,setFalse:T}]=(0,o.useBoolean)(!1),[U,V]=(0,d.useState)(""),W=(0,d.useRef)(""),X=a=>{W.current=a,V(a)},[Y,Z]=(0,d.useState)(),$=(0,d.useRef)(void 0),_=a=>{$.current=a,Z(a)},[aa,ab]=(0,d.useState)(null),[ac,ad]=(0,d.useState)(!1),ae=(0,d.useRef)(null),af=(0,d.useCallback)(()=>{ab(null),ad(!1),ae.current=null,P?.(null)},[P]);(0,d.useEffect)(()=>{let a=()=>{ae.current?.abort()};return G&&(a(),T(),af()),a},[G,af,T]);let{notify:ag}=v.default,ah=!U,[ai,aj]=(0,d.useState)(null),[ak,al]=(0,d.useState)({rating:null}),am=async a=>{await (0,i.updateFeedback)({url:`/messages/${ai}/feedbacks`,body:{rating:a.rating,content:a.content}},h,j),al(a)},an=(0,d.useCallback)(async()=>{if(aa&&!ac){ad(!0);try{a?await (0,i.stopWorkflowMessage)(j,aa,h,j||""):await (0,i.stopChatMessageResponding)(j,aa,h,j||""),ae.current?.abort()}catch(a){ag({type:"error",message:a instanceof Error?a.message:String(a)})}finally{ad(!1)}}},[j,aa,h,j,ac,a,ag]);(0,d.useEffect)(()=>{P&&(R&&aa?P({onStop:an,isStopping:ac}):P(null))},[aa,an,R,ac,P]);let ao=async()=>{if(R)return ag({type:"info",message:(0,p.t)("errorMessage.waitForResponse",{ns:"appDebug"})}),!1;if(!(()=>{if(b)return!0;let a=m?.prompt_variables;if(!a||a?.length===0)return!M.find(a=>a.transfer_method===A.TransferMethod.local_file&&!a.upload_file_id)||(ag({type:"info",message:(0,p.t)("errorMessage.waitForFileUpload",{ns:"appDebug"})}),!1);let c="";return((a?.filter(({key:a,name:b,required:c,type:d})=>"boolean"!==d&&"checkbox"!==d&&(!a||!a.trim()||!b||!b.trim()||c||null==c))||[]).forEach(({key:a,name:b})=>{!c&&(D[a]||(c=b))}),c)?(ag({type:"error",message:(0,p.t)("errorMessage.valueOfVarRequired",{ns:"appDebug",key:c})}),!1):M.find(a=>a.transfer_method===A.TransferMethod.local_file&&!a.upload_file_id)?(ag({type:"info",message:(0,p.t)("errorMessage.waitForFileUpload",{ns:"appDebug"})}),!1):!c})())return;let c={...(0,C.formatBooleanInputs)(m?.prompt_variables,D)};m?.prompt_variables.forEach(a=>{let b=c[a.key];"file"===a.type&&b&&"object"==typeof b&&!Array.isArray(b)?c[a.key]=(0,t.getProcessedFiles)([b])[0]:"file-list"===a.type&&Array.isArray(b)&&b.length>0&&(c[a.key]=(0,t.getProcessedFiles)(b))});let d={inputs:c};L.enabled&&M&&M?.length>0&&(d.files=M.map(a=>a.transfer_method===A.TransferMethod.local_file?{...a,url:""}:a)),aj(null),al({rating:null}),X(""),af();let f=[],g="";e||(H(),O()),S();let k=!1,l=!1;(async()=>{await (0,B.sleep)(z.TEXT_GENERATION_TIMEOUT_MS),k||(T(),K(W.current,J,!1),af(),l=!0)})(),a?(0,i.sendWorkflowMessage)(d,{onWorkflowStarted:({workflow_run_id:a,task_id:b})=>{g=a,ab(b||null),ad(!1),_({status:y.WorkflowRunningStatus.Running,tracing:[],expand:!1,resultText:""})},onIterationStart:({data:a})=>{_((0,q.produce)($.current,b=>{b.expand=!0,b.tracing.push({...a,status:y.NodeRunningStatus.Running,expand:!0})}))},onIterationNext:()=>{_((0,q.produce)($.current,a=>{a.expand=!0;let b=a.tracing.find(a=>a.node_id===d.node_id&&(a.execution_metadata?.parallel_id===d.execution_metadata?.parallel_id||a.parallel_id===d.execution_metadata?.parallel_id));b?.details.push([])}))},onIterationFinish:({data:a})=>{_((0,q.produce)($.current,b=>{b.expand=!0;let c=b.tracing.findIndex(b=>b.node_id===a.node_id&&(b.execution_metadata?.parallel_id===a.execution_metadata?.parallel_id||b.parallel_id===a.execution_metadata?.parallel_id));b.tracing[c]={...a,expand:!!a.error}}))},onLoopStart:({data:a})=>{_((0,q.produce)($.current,b=>{b.expand=!0,b.tracing.push({...a,status:y.NodeRunningStatus.Running,expand:!0})}))},onLoopNext:()=>{_((0,q.produce)($.current,a=>{a.expand=!0;let b=a.tracing.find(a=>a.node_id===d.node_id&&(a.execution_metadata?.parallel_id===d.execution_metadata?.parallel_id||a.parallel_id===d.execution_metadata?.parallel_id));b?.details.push([])}))},onLoopFinish:({data:a})=>{_((0,q.produce)($.current,b=>{b.expand=!0;let c=b.tracing.findIndex(b=>b.node_id===a.node_id&&(b.execution_metadata?.parallel_id===a.execution_metadata?.parallel_id||b.parallel_id===a.execution_metadata?.parallel_id));b.tracing[c]={...a,expand:!!a.error}}))},onNodeStarted:({data:a})=>{a.iteration_id||a.loop_id||_((0,q.produce)($.current,b=>{b.expand=!0,b.tracing.push({...a,status:y.NodeRunningStatus.Running,expand:!0})}))},onNodeFinished:({data:a})=>{a.iteration_id||a.loop_id||_((0,q.produce)($.current,b=>{let c=b.tracing.findIndex(b=>b.node_id===a.node_id&&(b.execution_metadata?.parallel_id===a.execution_metadata?.parallel_id||b.parallel_id===a.execution_metadata?.parallel_id));c>-1&&b.tracing&&(b.tracing[c]={...b.tracing[c].extras?{extras:b.tracing[c].extras}:{},...a,expand:!!a.error})}))},onWorkflowFinished:({data:a})=>{if(l)return void ag({type:"warning",message:(0,p.t)("warningMessage.timeoutExceeded",{ns:"appDebug"})});let b=a.status,c=a=>{if(!a)return;let b=a=>{[y.NodeRunningStatus.Running,y.NodeRunningStatus.Waiting].includes(a.status)&&(a.status=y.NodeRunningStatus.Stopped),a.details?.forEach(a=>a.forEach(b)),a.retryDetail?.forEach(b),a.parallelDetail?.children?.forEach(b)};a.forEach(b)};if(b===y.WorkflowRunningStatus.Stopped){_((0,q.produce)($.current,a=>{a.status=y.WorkflowRunningStatus.Stopped,c(a.tracing)})),T(),af(),K(W.current,J,!1),k=!0;return}if(a.error){ag({type:"error",message:a.error}),_((0,q.produce)($.current,a=>{a.status=y.WorkflowRunningStatus.Failed,c(a.tracing)})),T(),af(),K(W.current,J,!1),k=!0;return}_((0,q.produce)($.current,b=>{b.status=y.WorkflowRunningStatus.Succeeded,b.files=(0,t.getFilesInLogs)(a.outputs||[])})),a.outputs?(X(a.outputs),1===Object.keys(a.outputs).length&&"string"==typeof a.outputs[Object.keys(a.outputs)[0]]&&_((0,q.produce)($.current,b=>{b.resultText=a.outputs[Object.keys(a.outputs)[0]]}))):X(""),T(),af(),aj(g),K(W.current,J,!0),k=!0},onTextChunk:a=>{let{data:{text:b}}=a;_((0,q.produce)($.current,a=>{a.resultText+=b}))},onTextReplace:a=>{let{data:{text:b}}=a;_((0,q.produce)($.current,a=>{a.resultText=b}))}},h,j).catch(a=>{T(),af(),ag({type:"error",message:a instanceof Error?a.message:String(a)})}):(0,i.sendCompletionMessage)(d,{onData:(a,b,{messageId:c,taskId:d})=>{g=c,d&&"string"==typeof d&&""!==d.trim()&&ab(a=>a??d),f.push(a),X(f.join(""))},onCompleted:()=>{l?ag({type:"warning",message:(0,p.t)("warningMessage.timeoutExceeded",{ns:"appDebug"})}):(T(),af(),aj(g),K(W.current,J,!0),k=!0)},onMessageReplace:a=>{X((f=[a.answer]).join(""))},onError(){l?ag({type:"warning",message:(0,p.t)("warningMessage.timeoutExceeded",{ns:"appDebug"})}):(T(),af(),K(W.current,J,!1),k=!0)},getAbortController:a=>{ae.current=a}},h,j)},[ap,aq]=(0,d.useState)(0);(0,d.useEffect)(()=>{E&&(ao(),aq(Date.now()))},[E]),(0,d.useEffect)(()=>{F&&ao()},[F]);let ar=()=>(0,c.jsxs)(c.Fragment,{children:[!Q&&R&&aa&&(0,c.jsx)("div",{className:`mb-3 flex ${e?"justify-end":"justify-center"}`,children:(0,c.jsxs)(s.default,{variant:"secondary",disabled:ac,onClick:an,children:[ac?(0,c.jsx)(n.RiLoader2Line,{className:"mr-[5px] h-3.5 w-3.5 animate-spin"}):(0,c.jsx)(u.StopCircle,{className:"mr-[5px] h-3.5 w-3.5"}),(0,c.jsx)("span",{className:"text-xs font-normal",children:(0,p.t)("operation.stopResponding",{ns:"appDebug"})})]})}),(0,c.jsx)(r.default,{isWorkflow:a,workflowProcessData:Y,isError:k,onRetry:ao,content:U,messageId:ai,isInWebApp:!0,moreLikeThis:w,onFeedback:am,feedback:ak,onSave:I,isMobile:g,appSourceType:h,installedAppId:j,isLoading:!!b&&!U&&R,taskId:b?J<10?`0${J}`:`${J}`:void 0,controlClearMoreLikeThis:ap,isShowTextToSpeech:l,hideProcessDetail:!0,siteInfo:N})]});return(0,c.jsxs)(c.Fragment,{children:[!b&&!a&&(R&&!U?(0,c.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,c.jsx)(f.default,{type:"area"})}):(0,c.jsx)(c.Fragment,{children:ah?(0,c.jsx)(x,{}):ar()})),!b&&a&&(R&&!Y?(0,c.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,c.jsx)(f.default,{type:"area"})}):Y?ar():(0,c.jsx)(x,{})),b&&ar()]})});a.s(["default",0,D],75959),a.i(3626);var E=a.i(684714),F=a.i(754457),G=a.i(816134),H=a.i(805611),I=a.i(146172),J=a.i(532655),K=a.i(373178),L=a.i(787405),M=a.i(585124),N=a.i(527344);let O=d.memo(({promptConfig:a,inputs:b,inputsRef:e,onInputsChange:f,onSend:g,visionConfig:h,onVisionFilesChange:i,runControl:j})=>{let{t:k}=(0,w.useTranslation)(),l=(0,M.default)()===M.MediaType.pc,[m,o]=(0,d.useState)(!1),p=!!j,q=k("generation.stopRun",{ns:"share",defaultValue:"Stop Run"}),r=(0,d.useCallback)(a=>{p&&(a.preventDefault(),j?.onStop?.())},[p,j]),t=(0,d.useCallback)(a=>{f(a),e.current=a},[f,e]);return(0,d.useEffect)(()=>{if(m)return;let b={};a.prompt_variables.forEach(a=>{"select"===a.type?b[a.key]=a.default:"string"===a.type||"paragraph"===a.type?b[a.key]=a.default||"":"number"===a.type?b[a.key]=a.default??"":"checkbox"===a.type?b[a.key]=a.default||!1:"file"===a.type?b[a.key]=void 0:"file-list"===a.type?b[a.key]=[]:b[a.key]=void 0}),f(b),o(!0)},[a.prompt_variables,f]),(0,c.jsx)("div",{className:"",children:(0,c.jsx)("section",{children:(0,c.jsxs)("form",{onSubmit:a=>{a.preventDefault(),g()},children:[null!=b&&0!==Object.keys(b).length&&m?a.prompt_variables.filter(a=>!0!==a.hide).map(a=>(0,c.jsxs)("div",{className:"mt-4 w-full",children:["checkbox"!==a.type&&(0,c.jsxs)("div",{className:"system-md-semibold flex h-6 items-center gap-1 text-text-secondary",children:[(0,c.jsx)("div",{className:"truncate",children:a.name}),!a.required&&(0,c.jsx)("span",{className:"system-xs-regular text-text-tertiary",children:k("panel.optional",{ns:"workflow"})})]}),(0,c.jsxs)("div",{className:"mt-1",children:["select"===a.type&&(0,c.jsx)(H.default,{className:"w-full",defaultValue:b[a.key],onSelect:b=>{t({...e.current,[a.key]:b.value})},items:(a.options||[]).map(a=>({name:a,value:a})),allowSearch:!1}),"string"===a.type&&(0,c.jsx)(G.default,{type:"text",placeholder:a.name,value:b[a.key],onChange:b=>{t({...e.current,[a.key]:b.target.value})},maxLength:a.max_length}),"paragraph"===a.type&&(0,c.jsx)(I.default,{className:"h-[104px] sm:text-xs",placeholder:a.name,value:b[a.key],onChange:b=>{t({...e.current,[a.key]:b.target.value})}}),"number"===a.type&&(0,c.jsx)(G.default,{type:"number",placeholder:a.name,value:b[a.key],onChange:b=>{t({...e.current,[a.key]:b.target.value})}}),"checkbox"===a.type&&(0,c.jsx)(J.default,{name:a.name||a.key,value:!!b[a.key],required:a.required,onChange:b=>{t({...e.current,[a.key]:b})}}),"file"===a.type&&(0,c.jsx)(E.FileUploaderInAttachmentWrapper,{value:b[a.key]&&"object"==typeof b[a.key]?[b[a.key]]:[],onChange:b=>{t({...e.current,[a.key]:b[0]})},fileConfig:{...a.config,fileUploadConfig:h.fileUploadConfig}}),"file-list"===a.type&&(0,c.jsx)(E.FileUploaderInAttachmentWrapper,{value:Array.isArray(b[a.key])?b[a.key]:[],onChange:b=>{t({...e.current,[a.key]:b})},fileConfig:{...a.config,fileUploadConfig:h.fileUploadConfig}}),"json_object"===a.type&&(0,c.jsx)(K.default,{language:L.CodeLanguage.json,value:b[a.key],onChange:b=>{t({...e.current,[a.key]:b})},noWrapper:!0,className:"bg h-[80px] overflow-y-auto rounded-[10px] bg-components-input-bg-normal p-1",placeholder:(0,c.jsx)("div",{className:"whitespace-pre",children:"string"==typeof a.json_schema?a.json_schema:JSON.stringify(a.json_schema||"",null,2)})})]})]},a.key)):null,h?.enabled&&(0,c.jsxs)("div",{className:"mt-4 w-full",children:[(0,c.jsx)("div",{className:"system-md-semibold flex h-6 items-center text-text-secondary",children:k("imageUploader.imageUpload",{ns:"common"})}),(0,c.jsx)("div",{className:"mt-1",children:(0,c.jsx)(F.default,{settings:h,onFilesChange:a=>i(a.filter(a=>-1!==a.progress).map(a=>({type:"image",transfer_method:a.type,url:a.url,upload_file_id:a.fileId})))})})]}),(0,c.jsx)("div",{className:"mb-3 mt-6 w-full",children:(0,c.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,c.jsx)(s.default,{onClick:()=>{let b={};a.prompt_variables.forEach(a=>{"string"===a.type||"paragraph"===a.type||"number"===a.type?b[a.key]="":"checkbox"===a.type?b[a.key]=!1:b[a.key]=void 0}),f(b)},disabled:!1,children:(0,c.jsx)("span",{className:"text-[13px]",children:k("operation.clear",{ns:"common"})})}),(0,c.jsx)(s.default,{className:(0,N.cn)(!l&&"grow"),type:p?"button":"submit",variant:p?"secondary":"primary",disabled:p&&j?.isStopping,onClick:r,"data-testid":p?"stop-button":"run-button",children:p?(0,c.jsxs)(c.Fragment,{children:[j?.isStopping?(0,c.jsx)(n.RiLoader2Line,{className:"mr-1 h-4 w-4 shrink-0 animate-spin","aria-hidden":"true"}):(0,c.jsx)(u.StopCircle,{className:"mr-1 h-4 w-4 shrink-0","aria-hidden":"true"}),(0,c.jsx)("span",{className:"text-[13px]",children:q})]}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.RiPlayLargeLine,{className:"mr-1 h-4 w-4 shrink-0","aria-hidden":"true"}),(0,c.jsx)("span",{className:"text-[13px]",children:k("generation.run",{ns:"share"})})]})})]})})]})})})});a.s(["default",0,O],800963)}];

//# sourceMappingURL=app_components_base_icons_src_public_other_Message3Fill_tsx_4e7c5451._.js.map
module.exports=[420338,a=>{"use strict";let b=(0,a.i(282791).create)(a=>({detail:void 0,setDetail:b=>a({detail:b})}));a.s(["usePluginStore",0,b])},480274,a=>{"use strict";var b=a.i(608061),c=a.i(57843),d=a.i(429150),e=a.i(909795),f=a.i(18039),g=a.i(527344);class h extends c.Component{constructor(a){super(a),this.state={hasError:!1,error:null,errorInfo:null,errorCount:0}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,b){f.IS_DEV&&(console.error("ErrorBoundary caught an error:",a),console.error("Error Info:",b)),this.setState(a=>({errorInfo:b,errorCount:a.errorCount+1})),this.props.onError&&this.props.onError(a,b)}componentDidUpdate(a){let{resetKeys:b,resetOnPropsChange:c}=this.props,{hasError:d}=this.state;d&&a.resetKeys!==b&&b?.some((b,c)=>b!==a.resetKeys?.[c])&&this.props.resetErrorBoundary(),d&&c&&a.children!==this.props.children&&this.props.resetErrorBoundary(),a.resetKeys!==b&&this.props.onResetKeysChange(a.resetKeys)}render(){let{hasError:a,error:c,errorInfo:f,errorCount:h}=this.state,{fallback:i,children:j,showDetails:k=!1,className:l,isolate:m=!0,enableRecovery:n=!0,customTitle:o,customMessage:p,resetErrorBoundary:q}=this.props;if(a&&c)return i?"function"==typeof i?i(c,q):i:(0,b.jsxs)("div",{className:(0,g.cn)("border-state-critical-border bg-state-critical-hover-alt flex flex-col items-center justify-center rounded-lg border p-8",m&&"min-h-[200px]",l),children:[(0,b.jsxs)("div",{className:"mb-4 flex items-center gap-2",children:[(0,b.jsx)(d.RiAlertLine,{className:"text-state-critical-solid h-8 w-8"}),(0,b.jsx)("h2",{className:"text-xl font-semibold text-text-primary",children:o||"Something went wrong"})]}),(0,b.jsx)("p",{className:"mb-6 text-center text-text-secondary",children:p||"An unexpected error occurred while rendering this component."}),k&&f&&(0,b.jsxs)("details",{className:"mb-6 w-full max-w-2xl",children:[(0,b.jsx)("summary",{className:"mb-2 cursor-pointer text-sm font-medium text-text-tertiary hover:text-text-secondary",children:(0,b.jsxs)("span",{className:"inline-flex items-center gap-1",children:[(0,b.jsx)(d.RiBugLine,{className:"h-4 w-4"}),"Error Details (Development Only)"]})}),(0,b.jsxs)("div",{className:"rounded-lg bg-gray-100 p-4",children:[(0,b.jsxs)("div",{className:"mb-2",children:[(0,b.jsx)("span",{className:"font-mono text-xs font-semibold text-gray-600",children:"Error:"}),(0,b.jsx)("pre",{className:"mt-1 overflow-auto whitespace-pre-wrap font-mono text-xs text-gray-800",children:c.toString()})]}),f&&(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"font-mono text-xs font-semibold text-gray-600",children:"Component Stack:"}),(0,b.jsx)("pre",{className:"mt-1 max-h-40 overflow-auto whitespace-pre-wrap font-mono text-xs text-gray-700",children:f.componentStack})]}),h>1&&(0,b.jsxs)("div",{className:"mt-2 text-xs text-gray-600",children:["This error has occurred"," ",h," ","times"]})]})]}),n&&(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)(e.default,{variant:"primary",size:"small",onClick:q,children:"Try Again"}),(0,b.jsx)(e.default,{variant:"secondary",size:"small",onClick:()=>window.location.reload(),children:"Reload Page"})]})]});return j}}let i=a=>{let[b,d]=(0,c.useState)(0),e=(0,c.useRef)(a.resetKeys),f=(0,c.useRef)(void 0),g=(0,c.useCallback)(()=>{d(a=>a+1),a.onReset?.()},[a]),i=(0,c.useCallback)(a=>{f.current=a},[]);return(0,c.useEffect)(()=>{f.current!==a.resetKeys&&(e.current=a.resetKeys)},[a.resetKeys]),(0,c.createElement)(h,{...a,key:b,resetErrorBoundary:g,onResetKeysChange:i})};function j(a,c){let d=d=>(0,b.jsx)(i,{...c,children:(0,b.jsx)(a,{...d})});return d.displayName=`withErrorBoundary(${a.displayName||a.name||"Component"})`,d}a.s(["withErrorBoundary",()=>j])},380546,445487,25857,a=>{"use strict";var b,c,d,e,f,g=a.i(608061),h=a.i(429150),i=a.i(497746),j=a.i(57843);a.i(752298);var k=a.i(693025),l=a.i(175809),m=a.i(218865),n=a.i(909795),o=a.i(962037),p=a.i(114715),q=a.i(483664),r=a.i(646772),s=a.i(970854),t=a.i(527344),u=a.i(263636),v=a.i(420338);let w=()=>{let a=(0,v.usePluginStore)(a=>a.detail),{data:b,isLoading:c,refetch:d}=(0,s.useTriggerSubscriptions)(a?.provider||"");return{detail:a,subscriptions:b,isLoading:c,refetch:d}};a.s(["useSubscriptionList",0,w],445487);var x=a.i(924270),y=a.i(590205);a.i(480138);var z=a.i(915006),A=a.i(478801),B=a.i(314109),C=a.i(323102);let D=async a=>{let b="";if(a instanceof Response)try{let c=await a.clone().json();b=c?.message||a.statusText||"Unknown error"}catch{b=a.statusText||"Unknown error"}else b=a?.message||a?.toString()||"Unknown error";let c=b.match(/PluginInvokeError:\s*(\{.+\})/);if(c)try{let a=JSON.parse(c[1]);if(a.message)return a.message;if(a.error_type)return a.error_type}catch(a){console.warn("Failed to parse plugin error JSON:",a)}return b};a.s(["parsePluginErrorMessage",0,D],25857);var E=a.i(28814),F=a.i(435133),G=a.i(373178),H=a.i(787405),I=((b=I||{}).REQUEST="request",b.RESPONSE="response",b);let J=({logs:a,className:b})=>{let{t:c}=(0,k.useTranslation)(),[d,e]=(0,j.useState)(new Set),f=(a,b)=>{let d="request"===b?{headers:a.headers,data:(a=>{if("string"==typeof a&&a.startsWith("payload="))try{let b=decodeURIComponent(a.substring(8));return JSON.parse(b)}catch{return a}if("object"==typeof a)return a;try{return JSON.parse(a)}catch{return a}})(a.data)}:a;return"object"==typeof d?(0,g.jsx)(G.default,{readOnly:!0,title:(0,g.jsx)("div",{className:"system-xs-semibold-uppercase text-text-secondary",children:b}),language:H.CodeLanguage.json,value:d,isJSONStringifyBeauty:!0,nodeId:""}):(0,g.jsxs)("div",{className:"rounded-md bg-components-input-bg-normal",children:[(0,g.jsxs)("div",{className:"flex items-center justify-between px-2 py-1",children:[(0,g.jsx)("div",{className:"system-xs-semibold-uppercase text-text-secondary",children:b}),(0,g.jsx)("button",{onClick:a=>{a.stopPropagation(),navigator.clipboard.writeText(String(d)),p.default.notify({type:"success",message:c("actionMsg.copySuccessfully",{ns:"common"})})},className:"rounded-md p-0.5 hover:bg-components-panel-border",children:(0,g.jsx)(h.RiFileCopyLine,{className:"h-4 w-4 text-text-tertiary"})})]}),(0,g.jsx)("div",{className:"px-2 pb-2 pt-1",children:(0,g.jsx)("pre",{className:"code-xs-regular whitespace-pre-wrap break-all text-text-secondary",children:String(d)})})]})};return a&&0!==a.length?(0,g.jsx)("div",{className:(0,t.cn)("flex flex-col gap-1",b),children:a.map((a,b)=>{let i=a.id||b.toString(),j=d.has(i),k=200===a.response.status_code,l=a.response.status_code>=400;return(0,g.jsxs)("div",{className:(0,t.cn)("relative overflow-hidden rounded-lg border bg-components-panel-on-panel-item-bg shadow-sm hover:bg-components-panel-on-panel-item-bg-hover",l&&"border-state-destructive-border",!l&&j&&"border-components-panel-border",!l&&!j&&"border-components-panel-border-subtle"),children:[l&&(0,g.jsx)("div",{className:"pointer-events-none absolute left-0 top-0 h-7 w-[179px]",children:(0,g.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"179",height:"28",viewBox:"0 0 179 28",fill:"none",className:"h-full w-full",children:[(0,g.jsx)("g",{filter:"url(#filter0_f_error_glow)",children:(0,g.jsx)("circle",{cx:"27",cy:"14",r:"32",fill:"#F04438",fillOpacity:"0.25"})}),(0,g.jsx)("defs",{children:(0,g.jsxs)("filter",{id:"filter0_f_error_glow",x:"-125",y:"-138",width:"304",height:"304",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[(0,g.jsx)("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),(0,g.jsx)("feBlend",{mode:"normal",in:"SourceGraphic",in2:"BackgroundImageFix",result:"shape"}),(0,g.jsx)("feGaussianBlur",{stdDeviation:"60",result:"effect1_foregroundBlur"})]})})]})}),(0,g.jsxs)("button",{onClick:()=>{let a;(a=new Set(d)).has(i)?a.delete(i):a.add(i),e(a)},className:(0,t.cn)("flex w-full items-center justify-between px-2 py-1.5 text-left",j?"pb-1 pt-2":"min-h-7"),children:[(0,g.jsxs)("div",{className:"flex items-center gap-0",children:[j?(0,g.jsx)(h.RiArrowDownSLine,{className:"h-4 w-4 text-text-tertiary"}):(0,g.jsx)(h.RiArrowRightSLine,{className:"h-4 w-4 text-text-tertiary"}),(0,g.jsxs)("div",{className:"system-xs-semibold-uppercase text-text-secondary",children:[c("modal.manual.logs.request",{ns:"pluginTrigger"})," ","#",b+1]})]}),(0,g.jsxs)("div",{className:"flex items-center gap-1",children:[(0,g.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:(0,F.default)(a.created_at).format("HH:mm:ss")}),(0,g.jsx)("div",{className:"h-3.5 w-3.5",children:k?(0,g.jsx)(h.RiCheckboxCircleFill,{className:"h-full w-full text-text-success"}):(0,g.jsx)(h.RiErrorWarningFill,{className:"h-full w-full text-text-destructive"})})]})]}),j&&(0,g.jsxs)("div",{className:"flex flex-col gap-1 px-1 pb-1",children:[f(a.request,"request"),f(a.response,"response")]})]},i)})}):null},K={[u.SupportedCreationMethods.APIKEY]:C.TriggerCredentialTypeEnum.ApiKey,[u.SupportedCreationMethods.OAUTH]:C.TriggerCredentialTypeEnum.Oauth2,[u.SupportedCreationMethods.MANUAL]:C.TriggerCredentialTypeEnum.Unauthorized},L={[u.SupportedCreationMethods.APIKEY]:"modal.apiKey.title",[u.SupportedCreationMethods.OAUTH]:"modal.oauth.title",[u.SupportedCreationMethods.MANUAL]:"modal.manual.title"};var M=((c=M||{}).Verify="verify",c.Configuration="configuration",c);let N={values:{},isCheckValidated:!1},O=({isActive:a,text:b})=>(0,g.jsxs)("div",{className:`system-2xs-semibold-uppercase flex items-center gap-1 ${a?"text-state-accent-solid":"text-text-tertiary"}`,children:[a&&(0,g.jsx)("div",{className:"h-1 w-1 rounded-full bg-state-accent-solid"}),b]}),P=({currentStep:a})=>{let{t:b}=(0,k.useTranslation)();return(0,g.jsxs)("div",{className:"mb-6 flex w-1/3 items-center gap-2",children:[(0,g.jsx)(O,{isActive:"verify"===a,text:b("modal.steps.verify",{ns:"pluginTrigger"})}),(0,g.jsx)("div",{className:"h-px w-3 shrink-0 bg-divider-deep"}),(0,g.jsx)(O,{isActive:"configuration"===a,text:b("modal.steps.configuration",{ns:"pluginTrigger"})})]})},Q=({onClose:a,createType:b,builder:c})=>{let{t:d}=(0,k.useTranslation)(),e=(0,v.usePluginStore)(a=>a.detail),{refetch:f}=w(),[i,l]=(0,j.useState)(b===u.SupportedCreationMethods.APIKEY?"verify":"configuration"),[m,n]=(0,j.useState)(c),o=(0,j.useRef)(!1),{mutate:q,isPending:r}=(0,s.useVerifyAndUpdateTriggerSubscriptionBuilder)(),{mutateAsync:t}=(0,s.useCreateTriggerSubscriptionBuilder)(),{mutate:C,isPending:F}=(0,s.useBuildTriggerSubscription)(),{mutate:G}=(0,s.useUpdateTriggerSubscriptionBuilder)(),H=e?.declaration?.trigger?.subscription_schema||[],I=j.useRef(null),M=j.useRef(null),O=e?.declaration.trigger?.subscription_constructor?.parameters||[],Q=j.useRef(null),R=(0,j.useMemo)(()=>(e?.declaration?.trigger?.subscription_constructor?.credentials_schema||[]).map(a=>({...a,tooltip:a.help})),[e?.declaration?.trigger?.subscription_constructor?.credentials_schema]),S=j.useRef(null),{data:T}=(0,s.useTriggerSubscriptionBuilderLogs)(e?.provider||"",m?.id||"",{enabled:b===u.SupportedCreationMethods.MANUAL,refetchInterval:3e3});(0,j.useEffect)(()=>{let a=async()=>{o.current=!0;try{let a=await t({provider:e?.provider||"",credential_type:K[b]});n(a.subscription_builder)}catch(a){console.error("createBuilder error:",a),p.default.notify({type:"error",message:d("modal.errors.createFailed",{ns:"pluginTrigger"})})}};!o.current&&!m&&e?.provider&&a()},[m,e?.provider,b,t,d]),(0,j.useEffect)(()=>{if(m?.endpoint&&M.current&&"configuration"===i){let a=M.current.getForm();a&&a.setFieldValue("callback_url",m.endpoint),(0,E.isPrivateOrLocalAddress)(m.endpoint)?(console.warn("callback_url is private or local address",m.endpoint),M.current?.setFields([{name:"callback_url",warnings:[d("modal.form.callbackUrl.privateAddressWarning",{ns:"pluginTrigger"})]}])):M.current?.setFields([{name:"callback_url",warnings:[]}])}},[m?.endpoint,i,d]);let U=(0,j.useMemo)(()=>(0,x.debounce)((a,b,c)=>{G({provider:a,subscriptionBuilderId:b,properties:c},{onError:async a=>{let b=await D(a)||d("modal.errors.updateFailed",{ns:"pluginTrigger"});console.error("Failed to update subscription builder:",a),p.default.notify({type:"error",message:b})}})},500),[G,d]),V=(0,j.useCallback)(()=>{if(!m||!e?.provider)return;let a=I.current?.getFormValues({needCheckValidatedValues:!1})||{values:{},isCheckValidated:!0};U(e.provider,m.id,a.values)},[m,e?.provider,U]);(0,j.useEffect)(()=>()=>{U.cancel()},[U]);let W=(0,j.useMemo)(()=>"verify"===i?r?d("modal.common.verifying",{ns:"pluginTrigger"}):d("modal.common.verify",{ns:"pluginTrigger"}):F?d("modal.common.creating",{ns:"pluginTrigger"}):d("modal.common.create",{ns:"pluginTrigger"}),[i,r,F,d]);return(0,g.jsxs)(B.default,{title:d(L[b],{ns:"pluginTrigger"}),confirmButtonText:W,onClose:a,onCancel:a,onConfirm:()=>{if("verify"===i){let a;Object.keys(a=(S.current?.getFormValues({})||N).values).length?(S.current?.setFields([{name:Object.keys(a)[0],errors:[]}]),q({provider:e?.provider||"",subscriptionBuilderId:m?.id||"",credentials:a},{onSuccess:()=>{p.default.notify({type:"success",message:d("modal.apiKey.verify.success",{ns:"pluginTrigger"})}),l("configuration")},onError:async b=>{let c=await D(b)||d("modal.apiKey.verify.error",{ns:"pluginTrigger"});S.current?.setFields([{name:Object.keys(a)[0],errors:[c]}])}})):p.default.notify({type:"error",message:"Please fill in all required credentials"})}else(()=>{if(!m)return p.default.notify({type:"error",message:"Subscription builder not found"});let c=M.current?.getFormValues({});if(!c?.isCheckValidated)return;let g=c?.values?.subscription_name,h={provider:e?.provider||"",subscriptionBuilderId:m.id,name:g};if(b!==u.SupportedCreationMethods.MANUAL){if(O.length>0){let a=Q.current?.getFormValues({})||N;if(!a?.isCheckValidated)return;h.parameters=a.values}}else if(H.length>0){let a=I.current?.getFormValues({})||N;if(!a?.isCheckValidated)return}C(h,{onSuccess:()=>{p.default.notify({type:"success",message:d("subscription.createSuccess",{ns:"pluginTrigger"})}),a(),f?.()},onError:async a=>{let b=await D(a)||d("subscription.createFailed",{ns:"pluginTrigger"});p.default.notify({type:"error",message:b})}})})()},disabled:r||F,bottomSlot:"verify"===i?(0,g.jsx)(y.EncryptedBottom,{}):null,size:b===u.SupportedCreationMethods.MANUAL?"md":"sm",containerClassName:"min-h-[360px]",clickOutsideNotClose:!0,children:[b===u.SupportedCreationMethods.APIKEY&&(0,g.jsx)(P,{currentStep:i}),"verify"===i&&(0,g.jsx)(g.Fragment,{children:R.length>0&&(0,g.jsx)("div",{className:"mb-4",children:(0,g.jsx)(z.BaseForm,{formSchemas:R,ref:S,labelClassName:"system-sm-medium mb-2 flex items-center gap-1 text-text-primary",preventDefaultSubmit:!0,formClassName:"space-y-4",onChange:()=>{S.current?.setFields([{name:R[0].name,errors:[]}])}})})}),"configuration"===i&&(0,g.jsxs)("div",{className:"max-h-[70vh]",children:[(0,g.jsx)(z.BaseForm,{formSchemas:[{name:"subscription_name",label:d("modal.form.subscriptionName.label",{ns:"pluginTrigger"}),placeholder:d("modal.form.subscriptionName.placeholder",{ns:"pluginTrigger"}),type:A.FormTypeEnum.textInput,required:!0},{name:"callback_url",label:d("modal.form.callbackUrl.label",{ns:"pluginTrigger"}),placeholder:d("modal.form.callbackUrl.placeholder",{ns:"pluginTrigger"}),type:A.FormTypeEnum.textInput,required:!1,default:m?.endpoint||"",disabled:!0,tooltip:d("modal.form.callbackUrl.tooltip",{ns:"pluginTrigger"}),showCopy:!0}],ref:M,labelClassName:"system-sm-medium mb-2 flex items-center gap-1 text-text-primary",formClassName:"space-y-4 mb-4"}),b!==u.SupportedCreationMethods.MANUAL&&O.length>0&&(0,g.jsx)(z.BaseForm,{formSchemas:O.map(a=>{let b=(a=>{if(Object.values(A.FormTypeEnum).includes(a))return a;switch(a){case"string":case"text":default:return A.FormTypeEnum.textInput;case"password":case"secret":return A.FormTypeEnum.secretInput;case"number":case"integer":return A.FormTypeEnum.textNumber;case"boolean":return A.FormTypeEnum.boolean}})(a.type);return{...a,tooltip:a.description,type:b,dynamicSelectParams:b===A.FormTypeEnum.dynamicSelect?{plugin_id:e?.plugin_id||"",provider:e?.provider||"",action:"provider",parameter:a.name,credential_id:m?.id||""}:void 0,fieldClassName:a.type===A.FormTypeEnum.boolean?"flex items-center justify-between":void 0,labelClassName:a.type===A.FormTypeEnum.boolean?"mb-0":void 0}}),ref:Q,labelClassName:"system-sm-medium mb-2 flex items-center gap-1 text-text-primary",formClassName:"space-y-4"}),b===u.SupportedCreationMethods.MANUAL&&(0,g.jsxs)(g.Fragment,{children:[H.length>0&&(0,g.jsx)("div",{className:"mb-6",children:(0,g.jsx)(z.BaseForm,{formSchemas:H.map(a=>({...a,tooltip:a.description})),ref:I,labelClassName:"system-sm-medium mb-2 flex items-center gap-1 text-text-primary",formClassName:"space-y-4",onChange:V})}),(0,g.jsxs)("div",{className:"mb-6",children:[(0,g.jsxs)("div",{className:"mb-3 flex items-center gap-2",children:[(0,g.jsx)("div",{className:"system-xs-medium-uppercase text-text-tertiary",children:d("modal.manual.logs.title",{ns:"pluginTrigger"})}),(0,g.jsx)("div",{className:"h-px flex-1 bg-gradient-to-r from-divider-regular to-transparent"})]}),(0,g.jsxs)("div",{className:"mb-1 flex items-center justify-center gap-1 rounded-lg bg-background-section p-3",children:[(0,g.jsx)("div",{className:"h-3.5 w-3.5",children:(0,g.jsx)(h.RiLoader2Line,{className:"h-full w-full animate-spin"})}),(0,g.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:d("modal.manual.logs.loading",{ns:"pluginTrigger",pluginName:e?.name||""})})]}),(0,g.jsx)(J,{logs:T?.logs||[]})]})]})]})]})};var R=a.i(335913),S=((d=S||{}).Pending="pending",d.Success="success",d.Failed="failed",d),T=((e=T||{}).Default="default",e.Custom="custom",e);let U=({oauthConfig:a,onClose:b,showOAuthCreateModal:c})=>{let{t:d}=(0,k.useTranslation)(),e=(0,v.usePluginStore)(a=>a.detail),{system_configured:f,params:i,oauth_client_schema:l}=a||{},[m,o]=(0,j.useState)(),[q,t]=(0,j.useState)(),[u,w]=(0,j.useState)(f?"default":"custom"),x=j.useRef(null),y=(0,j.useMemo)(()=>{if(l&&l.length>0&&i){let a=Object.keys(i||{});for(let b of l)a.includes(b.name)&&(b.default=i?.[b.name]);return l}return[]},[l,i]),A=e?.provider||"",{mutate:C}=(0,s.useInitiateTriggerOAuth)(),{mutate:D}=(0,s.useVerifyAndUpdateTriggerSubscriptionBuilder)(),{mutate:E}=(0,s.useConfigureTriggerOAuth)(),{mutate:F}=(0,s.useDeleteTriggerOAuth)(),G=(0,j.useMemo)(()=>"pending"===q?d("modal.common.authorizing",{ns:"pluginTrigger"}):"success"===q?d("modal.oauth.authorization.waitingJump",{ns:"pluginTrigger"}):d("auth.saveAndAuth",{ns:"plugin"}),[q,d]);(0,j.useEffect)(()=>{if(A&&m&&"pending"===q){let a=setInterval(()=>{D({provider:A,subscriptionBuilderId:m.id},{onSuccess:b=>{b.verified&&(t("success"),clearInterval(a))},onError:()=>{}})},3e3);return()=>clearInterval(a)}},[m,q,D,A,d]);let H=e=>{let f="custom"===u,g={provider:A,enabled:f};if(f){let b=x.current?.getFormValues({});if(!b.isCheckValidated)return;let c=b.values;c.client_id===a?.params.client_id&&(c.client_id="[__HIDDEN__]"),c.client_secret===a?.params.client_secret&&(c.client_secret="[__HIDDEN__]"),g.client_params=c}E(g,{onSuccess:()=>{e?(t("pending"),C(A,{onSuccess:a=>{o(a.subscription_builder),(0,r.openOAuthPopup)(a.authorization_url,e=>{e&&(p.default.notify({type:"success",message:d("modal.oauth.authorization.authSuccess",{ns:"pluginTrigger"})}),b(),c(a.subscription_builder))})},onError:()=>{t("failed"),p.default.notify({type:"error",message:d("modal.oauth.authorization.authFailed",{ns:"pluginTrigger"})})}})):(b(),p.default.notify({type:"success",message:d("modal.oauth.save.success",{ns:"pluginTrigger"})}))}})};return(0,g.jsxs)(B.default,{title:d("modal.oauth.title",{ns:"pluginTrigger"}),confirmButtonText:G,cancelButtonText:d("auth.saveOnly",{ns:"plugin"}),extraButtonText:d("operation.cancel",{ns:"common"}),showExtraButton:!0,clickOutsideNotClose:!0,extraButtonVariant:"secondary",onExtraButtonClick:b,onClose:b,onCancel:()=>H(!1),onConfirm:()=>H(!0),footerSlot:a?.custom_enabled&&a?.params&&"custom"===u&&(0,g.jsx)("div",{className:"grow",children:(0,g.jsx)(n.default,{variant:"secondary",className:"text-components-button-destructive-secondary-text",onClick:()=>{F(A,{onSuccess:()=>{b(),p.default.notify({type:"success",message:d("modal.oauth.remove.success",{ns:"pluginTrigger"})})},onError:a=>{p.default.notify({type:"error",message:((a,b)=>{if(a instanceof Error&&a.message)return a.message;if("object"==typeof a&&a&&"message"in a){let b=a.message;if("string"==typeof b&&b)return b}return b})(a,d("modal.oauth.remove.failed",{ns:"pluginTrigger"}))})}})},children:d("operation.remove",{ns:"common"})})}),children:[(0,g.jsx)("div",{className:"system-sm-medium mb-2 text-text-secondary",children:d("subscription.addType.options.oauth.clientTitle",{ns:"pluginTrigger"})}),a?.system_configured&&(0,g.jsx)("div",{className:"mb-4 flex w-full items-start justify-between gap-2",children:["default","custom"].map(a=>(0,g.jsx)(R.default,{title:d(`subscription.addType.options.oauth.${a}`,{ns:"pluginTrigger"}),onSelect:()=>w(a),selected:u===a,className:"flex-1"},a))}),"custom"===u&&a?.redirect_uri&&(0,g.jsxs)("div",{className:"mb-4 flex items-start gap-3 rounded-xl bg-background-section-burn p-4",children:[(0,g.jsx)("div",{className:"rounded-lg border-[0.5px] border-components-card-border bg-components-card-bg p-2 shadow-xs shadow-shadow-shadow-3",children:(0,g.jsx)(h.RiInformation2Fill,{className:"h-5 w-5 shrink-0 text-text-accent"})}),(0,g.jsxs)("div",{className:"flex-1 text-text-secondary",children:[(0,g.jsx)("div",{className:"system-sm-regular whitespace-pre-wrap leading-4",children:d("modal.oauthRedirectInfo",{ns:"pluginTrigger"})}),(0,g.jsx)("div",{className:"system-sm-medium my-1.5 break-all leading-4",children:a.redirect_uri}),(0,g.jsxs)(n.default,{variant:"secondary",size:"small",onClick:()=>{navigator.clipboard.writeText(a.redirect_uri),p.default.notify({type:"success",message:d("actionMsg.copySuccessfully",{ns:"common"})})},children:[(0,g.jsx)(h.RiClipboardLine,{className:"mr-1 h-[14px] w-[14px]"}),d("operation.copy",{ns:"common"})]})]})]}),"custom"===u&&y.length>0&&(0,g.jsx)(z.BaseForm,{formSchemas:y,ref:x,labelClassName:"system-sm-medium mb-2 block text-text-secondary",formClassName:"space-y-4"})]})};var V=((f={}).FULL_BUTTON="full-button",f.ICON_BUTTON="icon-button",f);let W="default";a.s(["CreateButtonType",()=>V,"CreateSubscriptionButton",0,({buttonType:a="full-button",shape:b="square"})=>{let{t:c}=(0,k.useTranslation)(),{subscriptions:d}=w(),e=d?.length||0,[f,x]=(0,j.useState)(null),y=(0,v.usePluginStore)(a=>a.detail),{data:z}=(0,s.useTriggerProviderInfo)(y?.provider||""),A=z?.supported_creation_methods||[],{data:B,refetch:C}=(0,s.useTriggerOAuthConfig)(y?.provider||"",A.includes(u.SupportedCreationMethods.OAUTH)),{mutate:D}=(0,s.useInitiateTriggerOAuth)(),E=1===A.length?A[0]:W,[F,{setTrue:G,setFalse:H}]=(0,i.useBoolean)(!1),I=(0,j.useMemo)(()=>({[u.SupportedCreationMethods.OAUTH]:c("subscription.createButton.oauth",{ns:"pluginTrigger"}),[u.SupportedCreationMethods.APIKEY]:c("subscription.createButton.apiKey",{ns:"pluginTrigger"}),[u.SupportedCreationMethods.MANUAL]:c("subscription.createButton.manual",{ns:"pluginTrigger"}),[W]:c("subscription.empty.button",{ns:"pluginTrigger"})}),[c]),J=a=>{a.stopPropagation(),a.preventDefault(),G()},K=(0,j.useMemo)(()=>{let a=B?.custom_enabled&&B?.custom_configured;return[{value:u.SupportedCreationMethods.OAUTH,label:c("subscription.addType.options.oauth.title",{ns:"pluginTrigger"}),tag:a?(0,g.jsx)(m.default,{className:"ml-1 mr-0.5",children:c("auth.custom",{ns:"plugin"})}):null,extra:(0,g.jsx)(q.default,{popupContent:c("subscription.addType.options.oauth.clientSettings",{ns:"pluginTrigger"}),children:(0,g.jsx)(l.ActionButton,{onClick:J,children:(0,g.jsx)(h.RiEqualizer2Line,{className:"h-4 w-4 text-text-tertiary"})})}),show:A.includes(u.SupportedCreationMethods.OAUTH)},{value:u.SupportedCreationMethods.APIKEY,label:c("subscription.addType.options.apikey.title",{ns:"pluginTrigger"}),show:A.includes(u.SupportedCreationMethods.APIKEY)},{value:u.SupportedCreationMethods.MANUAL,label:c("subscription.addType.options.manual.description",{ns:"pluginTrigger"}),extra:(0,g.jsx)(q.default,{popupContent:c("subscription.addType.options.manual.tip",{ns:"pluginTrigger"})}),show:A.includes(u.SupportedCreationMethods.MANUAL)}]},[c,B,A,E]),L=async a=>{a===u.SupportedCreationMethods.OAUTH?B?.configured?D(y?.provider||"",{onSuccess:a=>{(0,r.openOAuthPopup)(a.authorization_url,b=>{b&&(p.default.notify({type:"success",message:c("modal.oauth.authorization.authSuccess",{ns:"pluginTrigger"})}),x({type:u.SupportedCreationMethods.OAUTH,builder:a.subscription_builder}))})},onError:()=>{p.default.notify({type:"error",message:c("modal.oauth.authorization.authFailed",{ns:"pluginTrigger"})})}}):G():x({type:a})},M=a=>{e>=10?a.stopPropagation():E!==W&&(E!==u.SupportedCreationMethods.OAUTH||1!==A.length)&&(a.stopPropagation(),a.preventDefault(),L(E))};return A.length?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(o.default,{options:K.filter(a=>a.show),value:E,onChange:a=>L(a),containerProps:{open:(E===W||E===u.SupportedCreationMethods.OAUTH&&1===A.length)&&void 0,placement:"bottom-start",offset:4,triggerPopupSameWidth:"full-button"===a},triggerProps:{className:(0,t.cn)("h-8 bg-transparent px-0 hover:bg-transparent",E!==W&&A.length>1&&"pointer-events-none","full-button"===a&&"grow")},popupProps:{wrapperClassName:"z-[1000]"},CustomTrigger:()=>"full-button"===a?(0,g.jsxs)(n.Button,{variant:"primary",size:"medium",className:"flex w-full items-center justify-between px-0",onClick:M,children:[(0,g.jsxs)("div",{className:"flex flex-1 items-center justify-center",children:[(0,g.jsx)(h.RiAddLine,{className:"mr-2 size-4"}),I[E],E===u.SupportedCreationMethods.OAUTH&&B?.custom_enabled&&B?.custom_configured&&(0,g.jsx)(m.default,{className:"ml-1 mr-0.5 border-text-primary-on-surface bg-components-badge-bg-dimm text-text-primary-on-surface",children:c("auth.custom",{ns:"plugin"})})]}),E===u.SupportedCreationMethods.OAUTH&&(0,g.jsxs)("div",{className:"ml-auto flex items-center",children:[(0,g.jsx)("div",{className:"h-4 w-px bg-text-primary-on-surface opacity-15"}),(0,g.jsx)(q.default,{popupContent:c("subscription.addType.options.oauth.clientSettings",{ns:"pluginTrigger"}),children:(0,g.jsx)("div",{onClick:J,className:"p-2",children:(0,g.jsx)(h.RiEqualizer2Line,{className:"size-4 text-components-button-primary-text"})})})]})]}):(0,g.jsx)(q.default,{popupContent:e>=10?c("subscription.maxCount",{ns:"pluginTrigger",num:10}):c(`subscription.addType.options.${E.toLowerCase()}.description`,{ns:"pluginTrigger"}),disabled:!(A?.length===1||e>=10),children:(0,g.jsx)(l.ActionButton,{onClick:M,className:(0,t.cn)("float-right","circle"===b&&"!rounded-full border-[0.5px] border-components-button-secondary-border-hover bg-components-button-secondary-bg-hover text-components-button-secondary-accent-text shadow-xs hover:border-components-button-secondary-border-disabled hover:bg-components-button-secondary-bg-disabled hover:text-components-button-secondary-accent-text-disabled"),state:e>=10?l.ActionButtonState.Disabled:l.ActionButtonState.Default,children:(0,g.jsx)(h.RiAddLine,{className:"size-4"})})}),CustomOption:a=>(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("div",{className:"mr-8 flex grow items-center gap-1 truncate px-1",children:[a.label,a.tag]}),a.extra]})}),f&&(0,g.jsx)(Q,{createType:f.type,builder:f.builder,onClose:()=>x(null)}),F&&(0,g.jsx)(U,{oauthConfig:B,onClose:()=>{H(),C()},showOAuthCreateModal:a=>x({type:u.SupportedCreationMethods.OAUTH,builder:a})})]}):null}],380546)},469752,664518,761838,a=>{"use strict";var b,c,d=a.i(608061);a.i(752298);var e=a.i(693025),f=a.i(483664),g=a.i(527344),h=a.i(380546),i=a.i(429150),j=a.i(497746),k=a.i(175809),l=a.i(57843),m=a.i(42550),n=a.i(816134),o=a.i(114715),p=a.i(970854),q=a.i(445487);let r="subscription.list.item.actions.deleteConfirm",s=a=>{let{onClose:b,isShow:c,currentId:f,currentName:g,workflowsInUse:h}=a,{refetch:i}=(0,q.useSubscriptionList)(),{mutate:j,isPending:k}=(0,p.useDeleteTriggerSubscription)(),{t:s}=(0,e.useTranslation)(),[t,u]=(0,l.useState)("");return(0,d.jsx)(m.default,{title:s(`${r}.title`,{ns:"pluginTrigger",name:g}),confirmText:s(`${r}.confirm`,{ns:"pluginTrigger"}),content:h>0?(0,d.jsxs)(d.Fragment,{children:[s(`${r}.contentWithApps`,{ns:"pluginTrigger",count:h}),(0,d.jsx)("div",{className:"system-sm-medium mb-2 mt-6 text-text-secondary",children:s(`${r}.confirmInputTip`,{ns:"pluginTrigger",name:g})}),(0,d.jsx)(n.default,{value:t,onChange:a=>u(a.target.value),placeholder:s(`${r}.confirmInputPlaceholder`,{ns:"pluginTrigger",name:g})})]}):s(`${r}.content`,{ns:"pluginTrigger"}),isShow:c,isLoading:k,isDisabled:k,onConfirm:()=>{h>0&&t!==g?o.default.notify({type:"error",message:s(`${r}.confirmInputWarning`,{ns:"pluginTrigger"}),className:"z-[10000001]"}):j(f,{onSuccess:()=>{o.default.notify({type:"success",message:s(`${r}.success`,{ns:"pluginTrigger",name:g}),className:"z-[10000001]"}),i?.(),b(!0)},onError:a=>{o.default.notify({type:"error",message:a?.message||s(`${r}.error`,{ns:"pluginTrigger",name:g}),className:"z-[10000001]"})}})},onCancel:()=>b(!1),maskClosable:!1})};var t=a.i(323102),u=a.i(217553),v=a.i(590205);a.i(480138);var w=a.i(915006),x=a.i(478801),y=a.i(314109),z=a.i(481366),A=a.i(25857),B=a.i(469453),C=a.i(420338),D=((b=D||{}).EditCredentials="edit_credentials",b.EditConfiguration="edit_configuration",b);let E=a=>{switch(a){case"string":case"text":return x.FormTypeEnum.textInput;case"password":case"secret":return x.FormTypeEnum.secretInput;case"number":case"integer":return x.FormTypeEnum.textNumber;case"boolean":return x.FormTypeEnum.boolean;case"select":return x.FormTypeEnum.select;default:if(Object.values(x.FormTypeEnum).includes(a))return a;return x.FormTypeEnum.textInput}},F=({isActive:a,text:b,onClick:c,clickable:e})=>(0,d.jsxs)("div",{className:`system-2xs-semibold-uppercase flex items-center gap-1 ${a?"text-state-accent-solid":"text-text-tertiary"} ${e?"cursor-pointer hover:text-text-secondary":""}`,onClick:e?c:void 0,children:[a&&(0,d.jsx)("div",{className:"h-1 w-1 rounded-full bg-state-accent-solid"}),b]}),G=({currentStep:a,onStepClick:b})=>{let{t:c}=(0,e.useTranslation)();return(0,d.jsxs)("div",{className:"mb-6 flex w-1/3 items-center gap-2",children:[(0,d.jsx)(F,{isActive:"edit_credentials"===a,text:c("modal.steps.verify",{ns:"pluginTrigger"}),onClick:()=>b?.("edit_credentials"),clickable:"edit_configuration"===a}),(0,d.jsx)("div",{className:"h-px w-3 shrink-0 bg-divider-deep"}),(0,d.jsx)(F,{isActive:"edit_configuration"===a,text:c("modal.steps.configuration",{ns:"pluginTrigger"})})]})},H=({onClose:a,subscription:b,pluginDetail:c})=>{let{t:f}=(0,e.useTranslation)(),g=(0,C.usePluginStore)(a=>a.detail),{refetch:h}=(0,q.useSubscriptionList)(),[i,j]=(0,l.useState)("edit_credentials"),[k,m]=(0,l.useState)(null),{mutate:n,isPending:r}=(0,p.useUpdateTriggerSubscription)(),{mutate:s,isPending:t}=(0,p.useVerifyTriggerSubscription)(),D=(0,l.useMemo)(()=>g?.declaration?.trigger?.subscription_constructor?.parameters||[],[g?.declaration?.trigger?.subscription_constructor?.parameters]),F=(0,l.useMemo)(()=>(g?.declaration?.trigger?.subscription_constructor?.credentials_schema||[]).map(a=>({...a,tooltip:a.help})),[g?.declaration?.trigger?.subscription_constructor?.credentials_schema]),H=(0,l.useRef)(null),I=(0,l.useRef)(null),J=(0,l.useRef)(null),K=(0,l.useMemo)(()=>[{name:"subscription_name",label:f("modal.form.subscriptionName.label",{ns:"pluginTrigger"}),placeholder:f("modal.form.subscriptionName.placeholder",{ns:"pluginTrigger"}),type:x.FormTypeEnum.textInput,required:!0,default:b.name},{name:"callback_url",label:f("modal.form.callbackUrl.label",{ns:"pluginTrigger"}),placeholder:f("modal.form.callbackUrl.placeholder",{ns:"pluginTrigger"}),type:x.FormTypeEnum.textInput,required:!1,default:b.endpoint||"",disabled:!0,tooltip:f("modal.form.callbackUrl.tooltip",{ns:"pluginTrigger"}),showCopy:!0}],[f,b.name,b.endpoint]),L=(0,l.useMemo)(()=>F.map(a=>({...a,type:E(a.type),tooltip:a.help,default:b.credentials?.[a.name]||a.default})),[F,b.credentials]),M=(0,l.useMemo)(()=>D.map(a=>{let c=E(a.type);return{...a,type:c,tooltip:a.description,default:b.parameters?.[a.name]||a.default,dynamicSelectParams:c===x.FormTypeEnum.dynamicSelect?{plugin_id:g?.plugin_id||"",provider:g?.provider||"",action:"provider",parameter:a.name,credential_id:b.id,credentials:k||void 0}:void 0,fieldClassName:a.type===x.FormTypeEnum.boolean?"flex items-center justify-between":void 0,labelClassName:a.type===x.FormTypeEnum.boolean?"mb-0":void 0}}),[D,b.parameters,b.id,g?.plugin_id,g?.provider,k]),N=()=>{j("edit_credentials"),m(null)};return(0,d.jsxs)(y.default,{title:f("subscription.list.item.actions.edit.title",{ns:"pluginTrigger"}),confirmButtonText:"edit_credentials"===i?t?f("modal.common.verifying",{ns:"pluginTrigger"}):f("modal.common.verify",{ns:"pluginTrigger"}):r?f("operation.saving",{ns:"common"}):f("operation.save",{ns:"common"}),onClose:a,onCancel:a,onConfirm:()=>{"edit_credentials"===i?(()=>{let a=J.current?.getFormValues({needTransformWhenSecretFieldIsPristine:!0})||{values:{},isCheckValidated:!1};if(!a.isCheckValidated)return;let c=a.values;s({provider:b.provider,subscriptionId:b.id,credentials:c},{onSuccess:()=>{o.default.notify({type:"success",message:f("modal.apiKey.verify.success",{ns:"pluginTrigger"})}),m(Object.values(c).every(a=>"[__HIDDEN__]"===a)?null:c),j("edit_configuration")},onError:async a=>{let b=await (0,A.parsePluginErrorMessage)(a)||f("modal.apiKey.verify.error",{ns:"pluginTrigger"});o.default.notify({type:"error",message:b})}})})():(()=>{let c,d=H.current?.getFormValues({});if(!d?.isCheckValidated)return;let e=d.values.subscription_name;if(D.length>0){let a=I.current?.getFormValues({needTransformWhenSecretFieldIsPristine:!0});if(!a?.isCheckValidated)return;c=(0,u.isEqual)(a.values,b.parameters||{})?void 0:a.values}n({subscriptionId:b.id,name:e,parameters:c,credentials:k||void 0},{onSuccess:()=>{o.default.notify({type:"success",message:f("subscription.list.item.actions.edit.success",{ns:"pluginTrigger"})}),h?.(),a()},onError:async a=>{let b=await (0,A.parsePluginErrorMessage)(a)||f("subscription.list.item.actions.edit.error",{ns:"pluginTrigger"});o.default.notify({type:"error",message:b})}})})()},disabled:r||t,showExtraButton:"edit_configuration"===i,extraButtonText:f("modal.common.back",{ns:"pluginTrigger"}),extraButtonVariant:"secondary",onExtraButtonClick:N,clickOutsideNotClose:!0,wrapperClassName:"!z-[101]",bottomSlot:"edit_credentials"===i?(0,d.jsx)(v.EncryptedBottom,{}):null,children:[c&&(0,d.jsx)(z.ReadmeEntrance,{pluginDetail:c,showType:B.ReadmeShowType.modal}),(0,d.jsx)(G,{currentStep:i,onStepClick:N}),"edit_credentials"===i&&(0,d.jsx)("div",{className:"mb-4",children:L.length>0&&(0,d.jsx)(w.BaseForm,{formSchemas:L,ref:J,labelClassName:"system-sm-medium mb-2 flex items-center gap-1 text-text-primary",formClassName:"space-y-4",preventDefaultSubmit:!0})}),"edit_configuration"===i&&(0,d.jsxs)("div",{className:"max-h-[70vh]",children:[(0,d.jsx)(w.BaseForm,{formSchemas:K,ref:H,labelClassName:"system-sm-medium mb-2 flex items-center gap-1 text-text-primary",formClassName:"space-y-4 mb-4"}),M.length>0&&(0,d.jsx)(w.BaseForm,{formSchemas:M,ref:I,labelClassName:"system-sm-medium mb-2 flex items-center gap-1 text-text-primary",formClassName:"space-y-4"})]})]})},I=({onClose:a,subscription:b,pluginDetail:c})=>{let{t:f}=(0,e.useTranslation)(),g=(0,C.usePluginStore)(a=>a.detail),{refetch:h}=(0,q.useSubscriptionList)(),{mutate:i,isPending:j}=(0,p.useUpdateTriggerSubscription)(),k=(0,l.useMemo)(()=>g?.declaration?.trigger?.subscription_schema||[],[g?.declaration?.trigger?.subscription_schema]),m=(0,l.useRef)(null),n=(0,l.useMemo)(()=>[{name:"subscription_name",label:f("modal.form.subscriptionName.label",{ns:"pluginTrigger"}),placeholder:f("modal.form.subscriptionName.placeholder",{ns:"pluginTrigger"}),type:x.FormTypeEnum.textInput,required:!0,default:b.name},{name:"callback_url",label:f("modal.form.callbackUrl.label",{ns:"pluginTrigger"}),placeholder:f("modal.form.callbackUrl.placeholder",{ns:"pluginTrigger"}),type:x.FormTypeEnum.textInput,required:!1,default:b.endpoint||"",disabled:!0,tooltip:f("modal.form.callbackUrl.tooltip",{ns:"pluginTrigger"}),showCopy:!0},...k.map(a=>({...a,type:(a=>{switch(a){case"string":case"text":return x.FormTypeEnum.textInput;case"password":case"secret":return x.FormTypeEnum.secretInput;case"number":case"integer":return x.FormTypeEnum.textNumber;case"boolean":return x.FormTypeEnum.boolean;case"select":return x.FormTypeEnum.select;default:if(Object.values(x.FormTypeEnum).includes(a))return a;return x.FormTypeEnum.textInput}})(a.type),tooltip:a.description,default:b.properties?.[a.name]||a.default}))],[f,b.name,b.endpoint,b.properties,k]);return(0,d.jsxs)(y.default,{title:f("subscription.list.item.actions.edit.title",{ns:"pluginTrigger"}),confirmButtonText:j?f("operation.saving",{ns:"common"}):f("operation.save",{ns:"common"}),onClose:a,onCancel:a,onConfirm:()=>{let c=m.current?.getFormValues({needTransformWhenSecretFieldIsPristine:!0});if(!c?.isCheckValidated)return;let d=c.values.subscription_name,e={...c.values};delete e.subscription_name,delete e.callback_url;let g=(0,u.isEqual)(e,b.properties||{})?void 0:e;i({subscriptionId:b.id,name:d,properties:g},{onSuccess:()=>{o.default.notify({type:"success",message:f("subscription.list.item.actions.edit.success",{ns:"pluginTrigger"})}),h?.(),a()},onError:a=>{o.default.notify({type:"error",message:((a,b)=>{if(a instanceof Error&&a.message)return a.message;if("object"==typeof a&&a&&"message"in a){let b=a.message;if("string"==typeof b&&b)return b}return b})(a,f("subscription.list.item.actions.edit.error",{ns:"pluginTrigger"}))})}})},disabled:j,clickOutsideNotClose:!0,wrapperClassName:"!z-[101]",children:[c&&(0,d.jsx)(z.ReadmeEntrance,{pluginDetail:c,showType:B.ReadmeShowType.modal}),(0,d.jsx)(w.BaseForm,{formSchemas:n,ref:m,labelClassName:"system-sm-medium mb-2 flex items-center gap-1 text-text-primary",formClassName:"space-y-4"})]})},J=({onClose:a,subscription:b,pluginDetail:c})=>{let{t:f}=(0,e.useTranslation)(),g=(0,C.usePluginStore)(a=>a.detail),{refetch:h}=(0,q.useSubscriptionList)(),{mutate:i,isPending:j}=(0,p.useUpdateTriggerSubscription)(),k=(0,l.useMemo)(()=>g?.declaration?.trigger?.subscription_constructor?.parameters||[],[g?.declaration?.trigger?.subscription_constructor?.parameters]),m=(0,l.useRef)(null),n=(0,l.useMemo)(()=>[{name:"subscription_name",label:f("modal.form.subscriptionName.label",{ns:"pluginTrigger"}),placeholder:f("modal.form.subscriptionName.placeholder",{ns:"pluginTrigger"}),type:x.FormTypeEnum.textInput,required:!0,default:b.name},{name:"callback_url",label:f("modal.form.callbackUrl.label",{ns:"pluginTrigger"}),placeholder:f("modal.form.callbackUrl.placeholder",{ns:"pluginTrigger"}),type:x.FormTypeEnum.textInput,required:!1,default:b.endpoint||"",disabled:!0,tooltip:f("modal.form.callbackUrl.tooltip",{ns:"pluginTrigger"}),showCopy:!0},...k.map(a=>{let c=(a=>{switch(a){case"string":case"text":return x.FormTypeEnum.textInput;case"password":case"secret":return x.FormTypeEnum.secretInput;case"number":case"integer":return x.FormTypeEnum.textNumber;case"boolean":return x.FormTypeEnum.boolean;case"select":return x.FormTypeEnum.select;default:if(Object.values(x.FormTypeEnum).includes(a))return a;return x.FormTypeEnum.textInput}})(a.type);return{...a,type:c,tooltip:a.description,default:b.parameters?.[a.name]||a.default,dynamicSelectParams:c===x.FormTypeEnum.dynamicSelect?{plugin_id:g?.plugin_id||"",provider:g?.provider||"",action:"provider",parameter:a.name,credential_id:b.id}:void 0,fieldClassName:a.type===x.FormTypeEnum.boolean?"flex items-center justify-between":void 0,labelClassName:a.type===x.FormTypeEnum.boolean?"mb-0":void 0}})],[f,b.name,b.endpoint,b.parameters,b.id,k,g?.plugin_id,g?.provider]);return(0,d.jsxs)(y.default,{title:f("subscription.list.item.actions.edit.title",{ns:"pluginTrigger"}),confirmButtonText:j?f("operation.saving",{ns:"common"}):f("operation.save",{ns:"common"}),onClose:a,onCancel:a,onConfirm:()=>{let c=m.current?.getFormValues({needTransformWhenSecretFieldIsPristine:!0});if(!c?.isCheckValidated)return;let d=c.values.subscription_name,e={...c.values};delete e.subscription_name,delete e.callback_url;let g=(0,u.isEqual)(e,b.parameters||{})?void 0:e;i({subscriptionId:b.id,name:d,parameters:g},{onSuccess:()=>{o.default.notify({type:"success",message:f("subscription.list.item.actions.edit.success",{ns:"pluginTrigger"})}),h?.(),a()},onError:a=>{o.default.notify({type:"error",message:((a,b)=>{if(a instanceof Error&&a.message)return a.message;if("object"==typeof a&&a&&"message"in a){let b=a.message;if("string"==typeof b&&b)return b}return b})(a,f("subscription.list.item.actions.edit.error",{ns:"pluginTrigger"}))})}})},disabled:j,clickOutsideNotClose:!0,wrapperClassName:"!z-[101]",children:[c&&(0,d.jsx)(z.ReadmeEntrance,{pluginDetail:c,showType:B.ReadmeShowType.modal}),(0,d.jsx)(w.BaseForm,{formSchemas:n,ref:m,labelClassName:"system-sm-medium mb-2 flex items-center gap-1 text-text-primary",formClassName:"space-y-4"})]})},K=({onClose:a,subscription:b,pluginDetail:c})=>{switch(b.credential_type){case t.TriggerCredentialTypeEnum.Unauthorized:return(0,d.jsx)(I,{onClose:a,subscription:b,pluginDetail:c});case t.TriggerCredentialTypeEnum.Oauth2:return(0,d.jsx)(J,{onClose:a,subscription:b,pluginDetail:c});case t.TriggerCredentialTypeEnum.ApiKey:return(0,d.jsx)(H,{onClose:a,subscription:b,pluginDetail:c});default:return null}},L=({data:a,pluginDetail:b})=>{let{t:c}=(0,e.useTranslation)(),[h,{setTrue:l,setFalse:m}]=(0,j.useBoolean)(!1),[n,{setTrue:o,setFalse:p}]=(0,j.useBoolean)(!1);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:(0,g.cn)("group relative cursor-pointer rounded-lg border-[0.5px] px-4 py-3 shadow-xs transition-all","border-components-panel-border-subtle bg-components-panel-on-panel-item-bg","hover:bg-components-panel-on-panel-item-bg-hover","has-[.subscription-delete-btn:hover]:!border-state-destructive-border has-[.subscription-delete-btn:hover]:!bg-state-destructive-hover"),children:[(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex h-6 items-center gap-1",children:[(0,d.jsx)(i.RiWebhookLine,{className:"h-4 w-4 text-text-secondary"}),(0,d.jsx)("span",{className:"system-md-semibold text-text-secondary",children:a.name})]}),(0,d.jsxs)("div",{className:"hidden items-center gap-1 group-hover:flex",children:[(0,d.jsx)(k.default,{onClick:o,className:"transition-colors hover:bg-state-base-hover",children:(0,d.jsx)(i.RiEditLine,{className:"h-4 w-4"})}),(0,d.jsx)(k.default,{onClick:l,className:"subscription-delete-btn transition-colors hover:bg-state-destructive-hover hover:text-text-destructive",children:(0,d.jsx)(i.RiDeleteBinLine,{className:"h-4 w-4"})})]})]}),(0,d.jsxs)("div",{className:"mt-1 flex items-center justify-between",children:[(0,d.jsx)(f.default,{disabled:!a.endpoint,popupContent:a.endpoint&&(0,d.jsx)("div",{className:"max-w-[320px] break-all",children:a.endpoint}),position:"left",children:(0,d.jsx)("div",{className:"system-xs-regular flex-1 truncate text-text-tertiary",children:a.endpoint})}),(0,d.jsx)("div",{className:"mx-2 text-xs text-text-tertiary opacity-30",children:"Â·"}),(0,d.jsx)("div",{className:"system-xs-regular shrink-0 text-text-tertiary",children:a.workflows_in_use>0?c("subscription.list.item.usedByNum",{ns:"pluginTrigger",num:a.workflows_in_use}):c("subscription.list.item.noUsed",{ns:"pluginTrigger"})})]})]}),h&&(0,d.jsx)(s,{onClose:m,isShow:h,currentId:a.id,currentName:a.name,workflowsInUse:a.workflows_in_use}),n&&(0,d.jsx)(K,{onClose:p,subscription:a,pluginDetail:b})]})};a.s(["SubscriptionListView",0,({showTopBorder:a=!1,pluginDetail:b})=>{let{t:c}=(0,e.useTranslation)(),{subscriptions:i}=(0,q.useSubscriptionList)(),j=i?.length||0;return(0,d.jsxs)("div",{className:(0,g.cn)("border-divider-subtle px-4 py-2",a&&"border-t"),children:[(0,d.jsxs)("div",{className:"relative flex items-center justify-between",children:[j>0&&(0,d.jsxs)("div",{className:"flex h-8 shrink-0 items-center gap-1",children:[(0,d.jsx)("span",{className:"system-sm-semibold-uppercase text-text-secondary",children:c("subscription.listNum",{ns:"pluginTrigger",num:j})}),(0,d.jsx)(f.default,{popupContent:c("subscription.list.tip",{ns:"pluginTrigger"})})]}),(0,d.jsx)(h.CreateSubscriptionButton,{buttonType:j>0?h.CreateButtonType.ICON_BUTTON:h.CreateButtonType.FULL_BUTTON})]}),j>0&&(0,d.jsx)("div",{className:"flex flex-col gap-1",children:i?.map(a=>(0,d.jsx)(L,{data:a,pluginDetail:b},a.id))})]})}],469752),a.s(["SubscriptionSelectorView",0,({selectedId:a,onSelect:b})=>{let{t:c}=(0,e.useTranslation)(),{subscriptions:j}=(0,q.useSubscriptionList)(),[m,n]=(0,l.useState)(null),o=j?.length||0;return(0,d.jsxs)("div",{className:"w-[320px] p-1",children:[o>0&&(0,d.jsxs)("div",{className:"ml-7 mr-1.5 flex h-8 items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex shrink-0 items-center gap-1",children:[(0,d.jsx)("span",{className:"system-sm-semibold-uppercase text-text-secondary",children:c("subscription.listNum",{ns:"pluginTrigger",num:o})}),(0,d.jsx)(f.default,{popupContent:c("subscription.list.tip",{ns:"pluginTrigger"})})]}),(0,d.jsx)(h.CreateSubscriptionButton,{buttonType:h.CreateButtonType.ICON_BUTTON,shape:"circle"})]}),(0,d.jsx)("div",{className:"max-h-[320px] overflow-y-auto",children:j?.map(c=>(0,d.jsxs)("div",{className:(0,g.cn)("group flex w-full items-center justify-between rounded-lg p-1 text-left transition-colors","hover:bg-state-base-hover has-[.subscription-delete-btn:hover]:!bg-state-destructive-hover",a===c.id&&"bg-state-base-hover"),children:[(0,d.jsx)("button",{type:"button",className:"flex flex-1 items-center text-left",onClick:()=>b?.(c),children:(0,d.jsxs)("div",{className:"flex items-center",children:[a===c.id&&(0,d.jsx)(i.RiCheckLine,{className:"mr-2 h-4 w-4 shrink-0 text-text-accent"}),(0,d.jsx)(i.RiWebhookLine,{className:(0,g.cn)("mr-1.5 h-3.5 w-3.5 text-text-secondary",a!==c.id&&"ml-6")}),(0,d.jsx)("span",{className:"system-md-regular leading-6 text-text-secondary",children:c.name})]})}),(0,d.jsx)(k.default,{onClick:a=>{a.stopPropagation(),n(c)},className:"subscription-delete-btn hidden shrink-0 text-text-tertiary hover:bg-state-destructive-hover hover:text-text-destructive group-hover:flex",children:(0,d.jsx)(i.RiDeleteBinLine,{className:"size-4"})})]},c.id))}),m&&(0,d.jsx)(s,{onClose:a=>{a&&b?.({id:"",name:""}),n(null)},isShow:!!m,currentId:m.id,currentName:m.name,workflowsInUse:m.workflows_in_use})]})}],664518);var M=((c={}).PANEL="panel",c.SELECTOR="selector",c);a.s(["SubscriptionListMode",()=>M],761838)},735127,a=>{"use strict";a.s(["SubscriptionSelectorEntry",()=>l]);var b=a.i(608061),c=a.i(429150),d=a.i(57843);a.i(752298);var e=a.i(693025),f=a.i(825319),g=a.i(579451),h=a.i(527344),i=a.i(761838),j=a.i(445487);let k=({selectedId:a,onClick:f,isOpen:g=!1,className:i})=>{let{t:k}=(0,e.useTranslation)(),{subscriptions:l}=(0,j.useSubscriptionList)(),m=(0,d.useMemo)(()=>{if(!a)return g?{label:k("subscription.selectPlaceholder",{ns:"pluginTrigger"}),color:"yellow"}:{label:k("subscription.noSubscriptionSelected",{ns:"pluginTrigger"}),color:"red"};if(l&&l.length>0){let b=l?.find(b=>b.id===a);return b?{label:b.name,color:"green"}:{label:k("subscription.subscriptionRemoved",{ns:"pluginTrigger"}),color:"red"}}return{label:k("subscription.noSubscriptionSelected",{ns:"pluginTrigger"}),color:"red"}},[a,l,k,g]);return(0,b.jsxs)("button",{className:(0,h.cn)("flex h-8 items-center gap-1 rounded-lg px-2 transition-colors","hover:bg-state-base-hover-alt",g&&"bg-state-base-hover-alt",i),onClick:f,children:[(0,b.jsx)(c.RiWebhookLine,{className:(0,h.cn)("h-3.5 w-3.5 shrink-0 text-text-secondary","red"===m.color&&"text-components-button-destructive-secondary-text")}),(0,b.jsx)("span",{className:(0,h.cn)("system-xs-medium truncate text-components-button-ghost-text","red"===m.color&&"text-components-button-destructive-secondary-text"),children:m.label}),(0,b.jsx)(c.RiArrowDownSLine,{className:(0,h.cn)("ml-auto h-4 w-4 shrink-0 text-text-quaternary transition-transform",g&&"rotate-180","red"===m.color&&"text-components-button-destructive-secondary-text")})]})},l=({selectedId:a,onSelect:c})=>{let[e,h]=(0,d.useState)(!1);return(0,b.jsxs)(f.PortalToFollowElem,{placement:"bottom-start",offset:4,open:e,onOpenChange:h,children:[(0,b.jsx)(f.PortalToFollowElemTrigger,{asChild:!0,children:(0,b.jsx)("div",{children:(0,b.jsx)(k,{selectedId:a,onClick:()=>h(!e),isOpen:e})})}),(0,b.jsx)(f.PortalToFollowElemContent,{className:"z-[11]",children:(0,b.jsx)("div",{className:"rounded-xl border border-components-panel-border bg-components-panel-bg shadow-lg",children:(0,b.jsx)(g.SubscriptionList,{mode:i.SubscriptionListMode.SELECTOR,selectedId:a,onSelect:(...a)=>{c(...a),h(!1)}})})})]})}},579451,a=>{"use strict";a.s(["SubscriptionList",()=>i]);var b=a.i(608061),c=a.i(480274),d=a.i(105249),e=a.i(469752),f=a.i(664518),g=a.i(761838),h=a.i(445487);a.i(735127);let i=(0,c.withErrorBoundary)(({mode:a=g.SubscriptionListMode.PANEL,selectedId:c,onSelect:i,pluginDetail:j})=>{let{isLoading:k,refetch:l}=(0,h.useSubscriptionList)();return k?(0,b.jsx)("div",{className:"flex items-center justify-center py-4",children:(0,b.jsx)(d.default,{})}):a===g.SubscriptionListMode.SELECTOR?(0,b.jsx)(f.SubscriptionSelectorView,{selectedId:c,onSelect:a=>{i?.(a,l)}}):(0,b.jsx)(e.SubscriptionListView,{pluginDetail:j})})},568852,a=>{"use strict";var b=a.i(608061),c=a.i(429150),d=a.i(497746),e=a.i(57843);a.i(752298);var f=a.i(693025),g=a.i(527344),h=a.i(193390),i=a.i(423026),j=a.i(983857);let k=({name:a,payload:e,depth:l=1,required:m,rootClassName:n})=>{let{t:o}=(0,f.useTranslation)(),p=e.type===h.Type.object&&e.properties,q=e.enum&&e.enum.length>0,[r,{toggle:s}]=(0,d.useBoolean)(!1);return(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:(0,g.cn)("flex pr-2"),children:[(0,b.jsx)(j.default,{depth:l}),(0,b.jsxs)("div",{className:"w-0 grow",children:[(0,b.jsxs)("div",{className:"relative flex select-none",children:[p&&(0,b.jsx)(c.RiArrowDropDownLine,{className:(0,g.cn)("absolute left-[-18px] top-[50%] h-4 w-4 translate-y-[-50%] cursor-pointer bg-components-panel-bg text-text-tertiary",r&&"rotate-[270deg] text-text-accent"),onClick:s}),(0,b.jsx)("div",{className:(0,g.cn)("system-sm-medium ml-[7px] h-6 truncate leading-6 text-text-secondary",1===l&&n),children:a}),(0,b.jsxs)("div",{className:"system-xs-regular ml-3 shrink-0 leading-6 text-text-tertiary",children:[(0,i.getFieldType)(e),e.schemaType&&"file"!==e.schemaType&&` (${e.schemaType})`]}),m&&(0,b.jsx)("div",{className:"system-2xs-medium-uppercase ml-3 leading-6 text-text-warning",children:o("structOutput.required",{ns:"app"})})]}),e.description&&(0,b.jsx)("div",{className:"ml-[7px] flex",children:(0,b.jsx)("div",{className:"system-xs-regular w-0 grow truncate text-text-tertiary",children:e.description})}),q&&(0,b.jsx)("div",{className:"ml-[7px] flex",children:(0,b.jsx)("div",{className:"system-xs-regular w-0 grow text-text-quaternary",children:e.enum.map((a,c)=>(0,b.jsxs)("span",{children:["string"==typeof a?`"${a}"`:a,c<e.enum.length-1&&" | "]},c))})})]})]}),p&&!r&&(0,b.jsx)("div",{children:Object.keys(e.properties).map(a=>(0,b.jsx)(k,{name:a,payload:e.properties?.[a],depth:l+1,required:!!e.required?.includes(a)},a))})]})},l=e.memo(k);a.s(["default",0,l])}];

//# sourceMappingURL=app_components_34b5c23d._.js.map
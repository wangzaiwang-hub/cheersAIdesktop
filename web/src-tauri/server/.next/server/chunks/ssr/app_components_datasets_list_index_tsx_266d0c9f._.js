module.exports=[535987,a=>{"use strict";var b=a.i(608061),c=a.i(497746),d=a.i(981133),e=a.i(533306),f=a.i(57843);a.i(752298);var g=a.i(693025),h=a.i(909795);a.i(805980);var i=a.i(122745),j=a.i(816134),k=a.i(429150),l=a.i(639378),m=a.i(940272),n=a.i(114715),o=a.i(199516),p=a.i(302547),q=a.i(42550),r=a.i(483664),s=a.i(527344);let t=({tag:a})=>{let{t:c}=(0,g.useTranslation)(),{notify:e}=(0,l.useContext)(n.ToastContext),h=(0,p.useStore)(a=>a.tagList),i=(0,p.useStore)(a=>a.setTagList),[j,m]=(0,f.useState)(!1),[t,u]=(0,f.useState)(a.name),v=async(b,d)=>{if(d===a.name)return void m(!1);if(!d){e({type:"error",message:"tag name is empty"}),u(a.name),m(!1);return}try{let a=h.map(a=>a.id===b?{...a,name:d}:a);i([...a]),m(!1),await (0,o.updateTag)(b,d),e({type:"success",message:c("actionMsg.modifiedSuccessfully",{ns:"common"})}),u(d)}catch{e({type:"error",message:c("actionMsg.modifiedUnsuccessfully",{ns:"common"})}),u(a.name),i([...h.map(a=>a.id===b?{...a,name:a.name}:a)]),m(!1)}},[w,x]=(0,f.useState)(!1),[y,z]=(0,f.useState)(!1),A=async a=>{if(!y)try{z(!0),await (0,o.deleteTag)(a),e({type:"success",message:c("actionMsg.modifiedSuccessfully",{ns:"common"})});let b=h.filter(b=>b.id!==a);i([...b]),z(!1)}catch{e({type:"error",message:c("actionMsg.modifiedUnsuccessfully",{ns:"common"})}),z(!1)}},{run:B}=(0,d.useDebounceFn)(()=>{A(a.id)},{wait:200});return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:(0,s.cn)("flex shrink-0 items-center gap-0.5 rounded-lg border border-components-panel-border py-1 pl-2 pr-1 text-sm leading-5 text-text-secondary"),children:[!j&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"text-sm leading-5 text-text-secondary",children:a.name}),(0,b.jsx)(r.default,{popupContent:(0,b.jsx)("div",{children:c("common.tagBound",{ns:"workflow"})}),needsDelay:!0,children:(0,b.jsx)("div",{className:"leading-4.5 shrink-0 px-1 text-sm font-medium text-text-tertiary",children:a.binding_count})}),(0,b.jsx)("div",{className:"group/edit shrink-0 cursor-pointer rounded-md p-1 hover:bg-state-base-hover",onClick:()=>m(!0),children:(0,b.jsx)(k.RiEditLine,{className:"h-3 w-3 text-text-tertiary group-hover/edit:text-text-secondary"})}),(0,b.jsx)("div",{className:"group/remove shrink-0 cursor-pointer rounded-md p-1 hover:bg-state-base-hover",onClick:()=>{a.binding_count?x(!0):B()},children:(0,b.jsx)(k.RiDeleteBinLine,{className:"h-3 w-3 text-text-tertiary group-hover/remove:text-text-secondary"})})]}),j&&(0,b.jsx)("input",{className:"shrink-0 appearance-none caret-primary-600 outline-none placeholder:text-text-quaternary",autoFocus:!0,value:t,onChange:a=>u(a.target.value),onKeyDown:b=>"Enter"===b.key&&v(a.id,t),onBlur:()=>v(a.id,t)})]}),(0,b.jsx)(q.default,{title:`${c("tag.delete",{ns:"common"})} "${a.name}"`,isShow:w,content:c("tag.deleteTip",{ns:"common"}),onConfirm:()=>{B(),x(!1)},onCancel:()=>x(!1)})]})},u=({show:a,type:c})=>{let{t:d}=(0,g.useTranslation)(),{notify:e}=(0,l.useContext)(n.ToastContext),h=(0,p.useStore)(a=>a.tagList),i=(0,p.useStore)(a=>a.setTagList),j=(0,p.useStore)(a=>a.setShowTagManagementModal),q=async a=>{i(await (0,o.fetchTagList)(a))},[r,s]=(0,f.useState)(!1),[u,v]=(0,f.useState)(""),w=async()=>{if(u&&!r)try{s(!0);let a=await (0,o.createTag)(u,c);e({type:"success",message:d("tag.created",{ns:"common"})}),i([a,...h]),v(""),s(!1)}catch{e({type:"error",message:d("tag.failed",{ns:"common"})}),s(!1)}};return(0,f.useEffect)(()=>{q(c)},[c]),(0,b.jsxs)(m.default,{className:"!w-[600px] !max-w-[600px] rounded-xl px-8 py-6",isShow:a,onClose:()=>j(!1),children:[(0,b.jsx)("div",{className:"relative pb-2 text-xl font-semibold leading-[30px] text-text-primary",children:d("tag.manageTags",{ns:"common"})}),(0,b.jsx)("div",{className:"absolute right-4 top-4 cursor-pointer p-2",onClick:()=>j(!1),children:(0,b.jsx)(k.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})}),(0,b.jsxs)("div",{className:"mt-3 flex flex-wrap gap-2",children:[(0,b.jsx)("input",{className:"w-[100px] shrink-0 appearance-none rounded-lg border border-dashed border-divider-regular bg-transparent px-2 py-1 text-sm leading-5 text-text-secondary caret-primary-600  outline-none placeholder:text-text-quaternary focus:border-solid",placeholder:d("tag.addNew",{ns:"common"})||"",autoFocus:!0,value:u,onChange:a=>v(a.target.value),onKeyDown:a=>"Enter"===a.key&&!a.nativeEvent.isComposing&&w(),onBlur:w}),h.map(a=>(0,b.jsx)(t,{tag:a},a.id))]})]})};var v=a.i(162962),w=a.i(664358),x=a.i(705134),y=a.i(417791),z=a.i(724423),A=a.i(280342),B=a.i(847733),C=a.i(175809),D=a.i(105249),E=a.i(114077),F=a.i(252813),G=a.i(29255),H=a.i(218257);let I=({api:a})=>{let{setShowExternalKnowledgeAPIModal:c}=(0,G.useModalContext)(),[d,e]=(0,f.useState)(!1),[h,j]=(0,f.useState)(!1),[l,m]=(0,f.useState)(0),{mutateExternalKnowledgeApis:n}=(0,E.useExternalKnowledgeApi)(),{t:o}=(0,g.useTranslation)(),p=async()=>{try{let b=await (0,H.fetchExternalAPI)({apiTemplateId:a.id}),d={name:b.name,settings:{endpoint:b.settings.endpoint,api_key:b.settings.api_key}};c({payload:d,onSaveCallback:()=>{n()},onCancelCallback:()=>{n()},isEditMode:!0,datasetBindings:b.dataset_bindings,onEditCallback:async c=>{try{await (0,H.updateExternalAPI)({apiTemplateId:a.id,body:{...b,name:c.name,settings:{...b.settings,endpoint:c.settings.endpoint,api_key:c.settings.api_key}}}),n()}catch(a){console.error("Error updating external knowledge API:",a)}}})}catch(a){console.error("Error fetching external knowledge API data:",a)}},r=async()=>{try{let b=await (0,H.checkUsageExternalAPI)({apiTemplateId:a.id});b.is_using&&m(b.count),e(!0)}catch(a){console.error("Error checking external API usage:",a)}},s=async()=>{try{let b=await (0,H.deleteExternalAPI)({apiTemplateId:a.id});b&&"success"===b.result?(e(!1),n()):console.error("Failed to delete external API")}catch(a){console.error("Error deleting external knowledge API:",a)}};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:`shadows-shadow-xs flex items-start self-stretch rounded-lg border-[0.5px] border-components-panel-border-subtle
        bg-components-panel-on-panel-item-bg p-2
        pl-3 ${h?"border-state-destructive-border bg-state-destructive-hover":""}`,children:[(0,b.jsxs)("div",{className:"flex grow flex-col items-start justify-center gap-1.5 py-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1 self-stretch text-text-secondary",children:[(0,b.jsx)(i.ApiConnectionMod,{className:"h-4 w-4"}),(0,b.jsx)("div",{className:"system-sm-medium",children:a.name})]}),(0,b.jsx)("div",{className:"system-xs-regular self-stretch text-text-tertiary",children:a.settings.endpoint})]}),(0,b.jsxs)("div",{className:"flex items-start gap-1",children:[(0,b.jsx)(C.default,{onClick:p,children:(0,b.jsx)(k.RiEditLine,{className:"h-4 w-4 text-text-tertiary hover:text-text-secondary"})}),(0,b.jsx)(C.default,{className:"hover:bg-state-destructive-hover",onClick:r,onMouseEnter:()=>j(!0),onMouseLeave:()=>j(!1),children:(0,b.jsx)(k.RiDeleteBinLine,{className:"h-4 w-4 text-text-tertiary hover:text-text-destructive"})})]})]}),d&&(0,b.jsx)(q.default,{isShow:d,title:`${o("deleteExternalAPIConfirmWarningContent.title.front",{ns:"dataset"})} ${a.name}${o("deleteExternalAPIConfirmWarningContent.title.end",{ns:"dataset"})}`,content:l>0?`${o("deleteExternalAPIConfirmWarningContent.content.front",{ns:"dataset"})} ${l} ${o("deleteExternalAPIConfirmWarningContent.content.end",{ns:"dataset"})}`:o("deleteExternalAPIConfirmWarningContent.noConnectionContent",{ns:"dataset"}),type:"warning",onConfirm:s,onCancel:()=>e(!1)})]})},J=({onClose:a})=>{let{t:c}=(0,g.useTranslation)(),d=(0,F.useDocLink)(),{setShowExternalKnowledgeAPIModal:e}=(0,G.useModalContext)(),{externalKnowledgeApiList:f,mutateExternalKnowledgeApis:i,isLoading:j}=(0,E.useExternalKnowledgeApi)();return(0,b.jsx)("div",{tabIndex:-1,className:(0,s.cn)("absolute bottom-2 right-0 top-14 z-10 flex outline-none"),children:(0,b.jsxs)("div",{className:(0,s.cn)("relative flex h-full w-[420px] flex-col rounded-l-2xl border border-components-panel-border bg-components-panel-bg-alt"),children:[(0,b.jsxs)("div",{className:"flex items-start self-stretch p-4 pb-0",children:[(0,b.jsxs)("div",{className:"flex grow flex-col items-start gap-1",children:[(0,b.jsx)("div",{className:"system-xl-semibold self-stretch text-text-primary",children:c("externalAPIPanelTitle",{ns:"dataset"})}),(0,b.jsx)("div",{className:"body-xs-regular self-stretch text-text-tertiary",children:c("externalAPIPanelDescription",{ns:"dataset"})}),(0,b.jsxs)("a",{className:"flex cursor-pointer items-center justify-center gap-1 self-stretch",href:d("/use-dify/knowledge/external-knowledge-api"),target:"_blank",children:[(0,b.jsx)(k.RiBookOpenLine,{className:"h-3 w-3 text-text-accent"}),(0,b.jsx)("div",{className:"body-xs-regular grow text-text-accent",children:c("externalAPIPanelDocumentation",{ns:"dataset"})})]})]}),(0,b.jsx)("div",{className:"flex items-center",children:(0,b.jsx)(C.default,{onClick:()=>a(),children:(0,b.jsx)(k.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})})})]}),(0,b.jsx)("div",{className:"flex flex-col items-start justify-center gap-2 self-stretch px-4 py-3",children:(0,b.jsxs)(h.default,{variant:"primary",className:"flex items-center justify-center gap-0.5 px-3 py-2",onClick:()=>{e({payload:{name:"",settings:{endpoint:"",api_key:""}},datasetBindings:[],onSaveCallback:()=>{i()},onCancelCallback:()=>{i()},isEditMode:!1})},children:[(0,b.jsx)(k.RiAddLine,{className:"h-4 w-4 text-components-button-primary-text"}),(0,b.jsx)("div",{className:"system-sm-medium text-components-button-primary-text",children:c("createExternalAPI",{ns:"dataset"})})]})}),(0,b.jsx)("div",{className:"flex grow flex-col items-start gap-1 self-stretch px-4 py-0",children:j?(0,b.jsx)(D.default,{}):f.map(a=>(0,b.jsx)(I,{api:a},a.id))})]})})};var K=a.i(825319),L=a.i(854867),M=a.i(413192),N=a.i(748240);a.i(224256);var O=a.i(340527),P=a.i(972729),Q=a.i(61500);let R=f.memo(({apiBaseUrl:a})=>{let{t:c}=(0,g.useTranslation)(),[d,e]=(0,f.useState)(!1),i=(0,Q.useDatasetApiAccessUrl)(),j=(0,f.useCallback)(()=>{e(!0)},[]),l=(0,f.useCallback)(()=>{e(!1)},[]);return(0,b.jsxs)("div",{className:"flex w-[360px] flex-col rounded-xl border border-components-panel-border bg-components-panel-bg shadow-lg shadow-shadow-shadow-1",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-y-3 p-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-x-3",children:[(0,b.jsxs)("div",{className:"flex grow items-center gap-x-2",children:[(0,b.jsx)("div",{className:"flex size-6 shrink-0 items-center justify-center rounded-lg border-[0.5px] border-divider-subtle bg-util-colors-blue-brand-blue-brand-500 shadow-md shadow-shadow-shadow-5",children:(0,b.jsx)(O.ApiAggregate,{className:"size-4 text-text-primary-on-surface"})}),(0,b.jsx)("div",{className:"system-sm-semibold grow truncate text-text-secondary",children:c("serviceApi.card.title",{ns:"dataset"})})]}),(0,b.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,b.jsx)(L.default,{className:"shrink-0",color:a?"green":"yellow"}),(0,b.jsx)("div",{className:"system-xs-semibold-uppercase text-text-success",children:c("serviceApi.enabled",{ns:"dataset"})})]})]}),(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("div",{className:"system-xs-regular leading-6 text-text-tertiary",children:c("serviceApi.card.endpoint",{ns:"dataset"})}),(0,b.jsxs)("div",{className:"flex h-8 items-center gap-0.5 rounded-lg bg-components-input-bg-normal p-1 pl-2",children:[(0,b.jsx)("div",{className:"flex h-4 min-w-0 flex-1 items-start justify-start gap-2 px-1",children:(0,b.jsx)("div",{className:"system-xs-medium truncate text-text-secondary",children:a})}),(0,b.jsx)(N.default,{content:a})]})]})]}),(0,b.jsxs)("div",{className:"flex gap-x-1 border-t-[0.5px] border-divider-subtle p-4",children:[(0,b.jsxs)(h.default,{variant:"ghost",size:"small",className:"gap-x-px text-text-tertiary",onClick:j,children:[(0,b.jsx)(k.RiKey2Line,{className:"size-3.5 shrink-0"}),(0,b.jsx)("span",{className:"system-xs-medium px-[3px]",children:c("serviceApi.card.apiKey",{ns:"dataset"})})]}),(0,b.jsx)(M.default,{href:i,target:"_blank",rel:"noopener noreferrer",children:(0,b.jsxs)(h.default,{variant:"ghost",size:"small",className:"gap-x-px text-text-tertiary",children:[(0,b.jsx)(k.RiBookOpenLine,{className:"size-3.5 shrink-0"}),(0,b.jsx)("span",{className:"system-xs-medium px-[3px]",children:c("serviceApi.card.apiReference",{ns:"dataset"})})]})})]}),(0,b.jsx)(P.default,{isShow:d,onClose:l})]})}),S=f.memo(({apiBaseUrl:a})=>{let{t:c}=(0,g.useTranslation)(),[d,e]=(0,f.useState)(!1);return(0,b.jsx)("div",{children:(0,b.jsxs)(K.PortalToFollowElem,{open:d,onOpenChange:e,placement:"top-start",offset:{mainAxis:4,crossAxis:-4},children:[(0,b.jsx)(K.PortalToFollowElemTrigger,{className:"w-full",onClick:()=>{e(!d)},children:(0,b.jsxs)("div",{className:(0,s.cn)("relative flex h-8 cursor-pointer items-center gap-2 rounded-lg border-[0.5px] border-components-button-secondary-border-hover bg-components-button-secondary-bg px-3",d?"bg-components-button-secondary-bg-hover":"hover:bg-components-button-secondary-bg-hover"),children:[(0,b.jsx)(L.default,{className:(0,s.cn)("shrink-0"),color:a?"green":"yellow"}),(0,b.jsx)("div",{className:"system-sm-medium grow text-text-secondary",children:c("serviceApi.title",{ns:"dataset"})})]})}),(0,b.jsx)(K.PortalToFollowElemContent,{className:"z-[10]",children:(0,b.jsx)(R,{apiBaseUrl:a})})]})})}),T=f.memo(()=>{let{t:a}=(0,g.useTranslation)();return(0,b.jsxs)("footer",{className:"shrink-0 px-12 py-6",children:[(0,b.jsx)("h3",{className:"text-gradient text-xl font-semibold leading-tight",children:a("didYouKnow",{ns:"dataset"})}),(0,b.jsxs)("p",{className:"mt-1 text-sm font-normal leading-tight text-text-secondary",children:[a("intro1",{ns:"dataset"}),(0,b.jsx)("span",{className:"inline-flex items-center gap-1 text-text-accent",children:a("intro2",{ns:"dataset"})}),a("intro3",{ns:"dataset"}),(0,b.jsx)("br",{}),a("intro4",{ns:"dataset"}),(0,b.jsx)("span",{className:"inline-flex items-center gap-1 text-text-accent",children:a("intro5",{ns:"dataset"})}),a("intro6",{ns:"dataset"})]})]})});var U=a.i(292458);a.i(262721);var V=a.i(16988);let W=({label:a,className:c,labelClassName:d})=>(0,b.jsxs)("div",{className:(0,s.cn)("group/corner-label inline-flex items-start",c),children:[(0,b.jsx)(V.Corner,{className:"h-5 w-[13px] text-background-section-burn"}),(0,b.jsx)("div",{className:(0,s.cn)("flex items-center gap-0.5 bg-background-section-burn py-1 pr-2",d),children:(0,b.jsx)("div",{className:"system-2xs-medium-uppercase text-text-tertiary",children:a})})]}),X=f.memo(({dataset:a})=>{let{t:c}=(0,g.useTranslation)();return a.embedding_available?"rag_pipeline"===a.runtime_mode?(0,b.jsx)(W,{label:c("cornerLabel.pipeline",{ns:"dataset"}),className:"absolute right-0 top-0 z-10",labelClassName:"rounded-tr-xl"}):null:(0,b.jsx)(W,{label:c("cornerLabel.unavailable",{ns:"dataset"}),className:"absolute right-0 top-0 z-10",labelClassName:"rounded-tr-xl"})});var Y=a.i(204685);let Z=f.memo(({dataset:a})=>{let{t:c}=(0,g.useTranslation)(),{formatTimeFromNow:d}=(0,Y.useFormatTimeFromNow)(),e="external"===a.provider,h=(0,f.useMemo)(()=>{let b=a.total_available_documents??0;return b<a.document_count?`${b} / ${a.document_count}`:`${a.document_count}`},[a.document_count,a.total_available_documents]),i=(0,f.useMemo)(()=>{let b=a.total_available_documents??0;return b<a.document_count?c("partialEnabled",{ns:"dataset",count:a.document_count,num:b}):c("docAllEnabled",{ns:"dataset",count:b})},[c,a.document_count,a.total_available_documents]);return(0,b.jsxs)("div",{className:(0,s.cn)("flex items-center gap-x-3 px-4 pb-3 pt-2 text-text-tertiary",!a.embedding_available&&"opacity-30"),children:[(0,b.jsx)(r.default,{popupContent:i,children:(0,b.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,b.jsx)(k.RiFileTextFill,{className:"size-3 text-text-quaternary"}),(0,b.jsx)("span",{className:"system-xs-medium",children:h})]})}),!e&&(0,b.jsx)(r.default,{popupContent:`${a.app_count} ${c("appCount",{ns:"dataset"})}`,children:(0,b.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,b.jsx)(k.RiRobot2Fill,{className:"size-3 text-text-quaternary"}),(0,b.jsx)("span",{className:"system-xs-medium",children:a.app_count})]})}),(0,b.jsx)("span",{className:"system-xs-regular text-divider-deep",children:"/"}),(0,b.jsx)("span",{className:"system-xs-regular",children:`${c("updated",{ns:"dataset"})} ${d(1e3*a.updated_at)}`})]})});var $=a.i(355968),_=a.i(70854),aa=a.i(986431);let ab=({dataset:a,isExternalProvider:c,isShowDocModeInfo:d})=>{let{t:e}=(0,g.useTranslation)(),{formatIndexingTechniqueAndMethod:f}=(0,_.useKnowledge)();if(c)return(0,b.jsx)("div",{className:"system-2xs-medium-uppercase flex items-center gap-x-3 text-text-tertiary",children:(0,b.jsx)("span",{children:e("externalKnowledgeBase",{ns:"dataset"})})});if(!d)return null;let h=a.indexing_technique?f(a.indexing_technique,a.retrieval_model_dict?.search_method):"";return(0,b.jsxs)("div",{className:"system-2xs-medium-uppercase flex items-center gap-x-3 text-text-tertiary",children:[!!a.doc_form&&(0,b.jsx)("span",{className:"min-w-0 max-w-full truncate",title:e(`chunkingMode.${aa.DOC_FORM_TEXT[a.doc_form]}`,{ns:"dataset"}),children:e(`chunkingMode.${aa.DOC_FORM_TEXT[a.doc_form]}`,{ns:"dataset"})}),a.indexing_technique&&h&&(0,b.jsx)("span",{className:"min-w-0 max-w-full truncate",title:h,children:h}),a.is_multimodal&&(0,b.jsx)("span",{className:"min-w-0 max-w-full truncate",title:e("multimodal",{ns:"dataset"}),children:e("multimodal",{ns:"dataset"})})]})},ac=f.memo(({dataset:a})=>{let{t:c}=(0,g.useTranslation)(),{formatTimeFromNow:d}=(0,Y.useFormatTimeFromNow)(),e="external"===a.provider,h=a.doc_form&&("rag_pipeline"!==a.runtime_mode||a.is_published),i=!!(a.doc_form&&a.indexing_technique&&a.retrieval_model_dict?.search_method&&("rag_pipeline"!==a.runtime_mode||a.is_published)),j=a.doc_form?aa.DOC_FORM_ICON_WITH_BG[a.doc_form]:f.Fragment,k=e?aa.DOC_FORM_ICON_WITH_BG.external:j,l=(0,f.useMemo)(()=>a.icon_info||{icon:"ðŸ“™",icon_type:"emoji",icon_background:"#FFF4ED",icon_url:""},[a.icon_info]),m=(0,f.useMemo)(()=>`${c("segment.editedAt",{ns:"datasetDocuments"})} ${d(1e3*a.updated_at)}`,[c,a.updated_at,d]);return(0,b.jsxs)("div",{className:(0,s.cn)("flex items-center gap-x-3 px-4 pb-2 pt-4",!a.embedding_available&&"opacity-30"),children:[(0,b.jsxs)("div",{className:"relative shrink-0",children:[(0,b.jsx)($.default,{size:"large",iconType:l.icon_type,icon:l.icon,background:"image"===l.icon_type?void 0:l.icon_background,imageUrl:"image"===l.icon_type?l.icon_url:void 0}),(h||e)&&(0,b.jsx)("div",{className:"absolute -bottom-1 -right-1 z-[5]",children:(0,b.jsx)(k,{className:"size-4"})})]}),(0,b.jsxs)("div",{className:"flex grow flex-col gap-y-1 overflow-hidden py-px",children:[(0,b.jsx)("div",{className:"system-md-semibold truncate text-text-secondary",title:a.name,children:a.name}),(0,b.jsxs)("div",{className:"flex items-center gap-1 text-[10px] font-medium leading-[18px] text-text-tertiary",children:[(0,b.jsx)("div",{className:"truncate",title:a.author_name,children:a.author_name}),(0,b.jsx)("div",{children:"Â·"}),(0,b.jsx)("div",{className:"truncate",title:m,children:m})]}),(0,b.jsx)(ab,{dataset:a,isExternalProvider:e,isShowDocModeInfo:i})]})]})});var ad=a.i(556476);let ae=f.memo(({dataset:a,modalState:c,onCloseRename:d,onCloseConfirm:e,onConfirmDelete:f,onSuccess:h})=>{let{t:i}=(0,g.useTranslation)();return(0,b.jsxs)(b.Fragment,{children:[c.showRenameModal&&(0,b.jsx)(ad.default,{show:c.showRenameModal,dataset:a,onClose:d,onSuccess:h}),c.showConfirmDelete&&(0,b.jsx)(q.default,{title:i("deleteDatasetConfirmTitle",{ns:"dataset"}),content:c.confirmMessage,isShow:c.showConfirmDelete,onConfirm:f,onCancel:e})]})}),af=f.memo(({dataset:a})=>(0,b.jsx)("div",{className:(0,s.cn)("system-xs-regular line-clamp-2 h-10 px-4 py-1 text-text-tertiary",!a.embedding_available&&"opacity-30"),title:a.description,children:a.description}));var ag=a.i(234782),ah=a.i(757801);let ai=f.memo(({Icon:a,name:c,handleClick:d})=>(0,b.jsxs)("div",{className:"flex cursor-pointer items-center gap-x-1 rounded-lg px-2 py-1.5 hover:bg-state-base-hover",onClick:a=>{a.preventDefault(),a.stopPropagation(),d?.()},children:[(0,b.jsx)(a,{className:"size-4 text-text-tertiary"}),(0,b.jsx)("span",{className:"system-md-regular px-1 text-text-secondary",children:c})]})),aj=f.memo(({showDelete:a,showExportPipeline:c,openRenameModal:d,handleExportPipeline:e,detectIsUsedByApp:f})=>{let{t:h}=(0,g.useTranslation)();return(0,b.jsxs)("div",{className:"relative flex w-full flex-col rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur shadow-lg shadow-shadow-shadow-5",children:[(0,b.jsxs)("div",{className:"flex flex-col p-1",children:[(0,b.jsx)(ai,{Icon:k.RiEditLine,name:h("operation.edit",{ns:"common"}),handleClick:d}),c&&(0,b.jsx)(ai,{Icon:k.RiFileDownloadLine,name:h("operations.exportPipeline",{ns:"datasetPipeline"}),handleClick:e})]}),a&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(ah.default,{type:"horizontal",className:"my-0 bg-divider-subtle"}),(0,b.jsx)("div",{className:"flex flex-col p-1",children:(0,b.jsx)(ai,{Icon:k.RiDeleteBinLine,name:h("operation.delete",{ns:"common"}),handleClick:f})})]})]})}),ak=f.memo(({dataset:a,isCurrentWorkspaceDatasetOperator:c,openRenameModal:d,handleExportPipeline:e,detectIsUsedByApp:f})=>(0,b.jsx)("div",{className:"absolute right-2 top-2 z-[15] hidden group-hover:block",children:(0,b.jsx)(ag.default,{htmlContent:(0,b.jsx)(aj,{showDelete:!c,showExportPipeline:"rag_pipeline"===a.runtime_mode,openRenameModal:d,handleExportPipeline:e,detectIsUsedByApp:f}),className:"z-20 min-w-[186px]",popupClassName:"rounded-xl bg-none shadow-none ring-0 min-w-[186px]",position:"br",trigger:"click",btnElement:(0,b.jsx)("div",{className:"flex size-8 items-center justify-center rounded-[10px] hover:bg-state-base-hover",children:(0,b.jsx)(k.RiMoreFill,{className:"h-5 w-5 text-text-tertiary"})}),btnClassName:a=>(0,s.cn)("size-9 cursor-pointer justify-center rounded-[10px] border-[0.5px] border-components-actionbar-border bg-components-actionbar-bg p-0 shadow-lg shadow-shadow-shadow-5 ring-[2px] ring-inset ring-components-actionbar-bg hover:border-components-actionbar-border",a?"border-components-actionbar-border bg-state-base-hover":"")})}));var al=a.i(742929);let am=f.forwardRef(({dataset:a,tags:c,setTags:d,onSuccess:e,isHoveringTagSelector:f,onClick:g},h)=>(0,b.jsxs)("div",{className:(0,s.cn)("relative w-full px-3",!a.embedding_available&&"opacity-30"),onClick:g,children:[(0,b.jsx)("div",{ref:h,className:(0,s.cn)("invisible w-full group-hover:visible",c.length>0&&"visible"),children:(0,b.jsx)(al.default,{position:"bl",type:"knowledge",targetID:a.id,value:c.map(a=>a.id),selectedTags:c,onCacheUpdate:d,onChange:e})}),(0,b.jsx)("div",{className:(0,s.cn)("absolute right-0 top-0 z-[5] h-full w-20 bg-tag-selector-mask-bg group-hover:bg-tag-selector-mask-hover-bg",f&&"hidden")})]}));am.displayName="TagArea";var an=a.i(848636);let ao="dataset-card";var ap=a.i(599656),aq=a.i(760327);let ar=({dataset:a,onSuccess:c})=>{let{push:d}=(0,e.useRouter)(),h=(0,x.useSelector)(a=>a.isCurrentWorkspaceDatasetOperator),i=(0,f.useRef)(null),j=(0,U.useHover)(i),{tags:k,setTags:l,modalState:m,openRenameModal:o,closeRenameModal:p,closeConfirmDelete:q,handleExportPipeline:r,detectIsUsedByApp:s,onConfirmDelete:t}=(({dataset:a,onSuccess:b})=>{let{t:c}=(0,g.useTranslation)(),[d,e]=(0,f.useState)(a.tags);(0,f.useEffect)(()=>{e(a.tags)},[a.tags]);let[h,i]=(0,f.useState)({showRenameModal:!1,showConfirmDelete:!1,confirmMessage:""}),[j,k]=(0,f.useState)(!1),l=(0,f.useCallback)(()=>{i(a=>({...a,showRenameModal:!0}))},[]),m=(0,f.useCallback)(()=>{i(a=>({...a,showRenameModal:!1}))},[]),o=(0,f.useCallback)(()=>{i(a=>({...a,showConfirmDelete:!1}))},[]),{mutateAsync:p}=(0,an.useMutation)({mutationKey:[ao,"check-usage"],mutationFn:a=>(0,H.checkIsUsedInApp)(a)}),{mutateAsync:q}=(0,an.useMutation)({mutationKey:[ao,"delete"],mutationFn:a=>(0,H.deleteDataset)(a)}),{mutateAsync:r}=(0,ap.useExportPipelineDSL)(),s=(0,f.useCallback)(async(b=!1)=>{let{pipeline_id:d,name:e}=a;if(d&&!j)try{k(!0);let{data:a}=await r({pipelineId:d,include:b}),c=new Blob([a],{type:"application/yaml"});(0,aq.downloadBlob)({data:c,fileName:`${e}.pipeline`})}catch{n.default.notify({type:"error",message:c("exportFailed",{ns:"app"})})}finally{k(!1)}},[a,r,j,c]),t=(0,f.useCallback)(async()=>{try{let{is_using:b}=await p(a.id),d=b?c("datasetUsedByApp",{ns:"dataset"}):c("deleteDatasetConfirmContent",{ns:"dataset"});i(a=>({...a,confirmMessage:d,showConfirmDelete:!0}))}catch(a){if(a instanceof Response){let b=await a.json();n.default.notify({type:"error",message:b?.message||"Unknown error"})}else n.default.notify({type:"error",message:a?.message||"Unknown error"})}},[a.id,p,c]),u=(0,f.useCallback)(async()=>{try{await q(a.id),n.default.notify({type:"success",message:c("datasetDeleted",{ns:"dataset"})}),b?.()}finally{o()}},[a.id,q,b,c,o]);return{tags:d,setTags:e,modalState:h,openRenameModal:l,closeRenameModal:m,closeConfirmDelete:o,exporting:j,handleExportPipeline:s,detectIsUsedByApp:t,onConfirmDelete:u}})({dataset:a,onSuccess:c}),u="external"===a.provider,v=(0,f.useMemo)(()=>"rag_pipeline"===a.runtime_mode&&!a.is_published,[a.runtime_mode,a.is_published]);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"group relative col-span-1 flex h-[190px] cursor-pointer flex-col rounded-xl border-[0.5px] border-solid border-components-card-border bg-components-card-bg shadow-xs shadow-shadow-shadow-3 transition-all duration-200 ease-in-out hover:bg-components-card-bg-alt hover:shadow-md hover:shadow-shadow-shadow-5","data-disable-nprogress":!0,onClick:b=>{b.preventDefault(),u?d(`/datasets/${a.id}/hitTesting`):v?d(`/datasets/${a.id}/pipeline`):d(`/datasets/${a.id}/documents`)},children:[(0,b.jsx)(X,{dataset:a}),(0,b.jsx)(ac,{dataset:a}),(0,b.jsx)(af,{dataset:a}),(0,b.jsx)(am,{ref:i,dataset:a,tags:k,setTags:l,onSuccess:c,isHoveringTagSelector:j,onClick:a=>{a.stopPropagation(),a.preventDefault()}}),(0,b.jsx)(Z,{dataset:a}),(0,b.jsx)(ak,{dataset:a,isCurrentWorkspaceDatasetOperator:h,openRenameModal:o,handleExportPipeline:r,detectIsUsedByApp:s})]}),(0,b.jsx)(ae,{dataset:a,modalState:m,onCloseRename:p,onCloseConfirm:q,onConfirmDelete:t,onSuccess:c})]})},as=f.memo(({Icon:a,text:c,href:d})=>(0,b.jsxs)(M.default,{type:"button",className:"flex w-full items-center gap-x-2 rounded-lg bg-transparent px-4 py-2 text-text-tertiary shadow-shadow-shadow-3 hover:bg-background-default-dodge hover:text-text-secondary hover:shadow-xs",href:d,children:[(0,b.jsx)(a,{className:"h-4 w-4 shrink-0"}),(0,b.jsx)("span",{className:"system-sm-medium grow text-left",children:c})]})),at=()=>{let{t:a}=(0,g.useTranslation)();return(0,b.jsxs)("div",{className:"flex h-[190px] flex-col gap-y-0.5 rounded-xl bg-background-default-dimmed",children:[(0,b.jsxs)("div",{className:"flex grow flex-col items-center justify-center p-2",children:[(0,b.jsx)(as,{href:"/datasets/create",Icon:k.RiAddLine,text:a("createDataset",{ns:"dataset"})}),(0,b.jsx)(as,{href:"/datasets/create-from-pipeline",Icon:k.RiFunctionAddLine,text:a("createFromPipeline",{ns:"dataset"})})]}),(0,b.jsx)("div",{className:"border-t-[0.5px] border-divider-subtle p-2",children:(0,b.jsx)(as,{href:"/datasets/connect",Icon:i.ApiConnectionMod,text:a("connectDataset",{ns:"dataset"})})})]})};at.displayName="CreateAppCard";let au=({tags:a,keywords:c,includeAll:d})=>{let{t:e}=(0,g.useTranslation)(),h=(0,x.useSelector)(a=>a.isCurrentWorkspaceEditor),{data:i,fetchNextPage:j,hasNextPage:k,isFetching:l,isFetchingNextPage:m}=(0,B.useDatasetList)({initialPage:1,tag_ids:a,limit:30,include_all:d,keyword:c}),n=(0,B.useInvalidDatasetList)(),o=(0,f.useRef)(null),p=(0,f.useRef)(null);return(0,f.useEffect)(()=>{document.title=`${e("knowledge",{ns:"dataset"})} - CheersAI`},[e]),(0,f.useEffect)(()=>(o.current&&(p.current=new IntersectionObserver(a=>{a[0].isIntersecting&&k&&!l&&j()},{rootMargin:"100px"}),p.current.observe(o.current)),()=>p.current?.disconnect()),[o,k,l,j]),(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)("nav",{className:"grid grow grid-cols-1 content-start gap-3 px-12 pt-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4",children:[h&&(0,b.jsx)(at,{}),i?.pages.map(({data:a})=>a.map(a=>(0,b.jsx)(ar,{dataset:a,onSuccess:n},a.id))),m&&(0,b.jsx)(D.default,{}),(0,b.jsx)("div",{ref:o,className:"h-0"})]})})};a.s(["default",0,()=>{let{t:a}=(0,g.useTranslation)(),{systemFeatures:k}=(0,z.useGlobalPublicStore)(),l=(0,e.useRouter)(),{currentWorkspace:m,isCurrentWorkspaceOwner:n}=(0,x.useAppContext)(),o=(0,p.useStore)(a=>a.showTagManagementModal),{showExternalApiPanel:q,setShowExternalApiPanel:r}=(0,y.useExternalApiPanel)(),[s,{toggle:t}]=(0,c.useBoolean)(!1);(0,A.default)(a("knowledge",{ns:"dataset"}));let[C,D]=(0,f.useState)(""),[E,F]=(0,f.useState)(""),{run:G}=(0,d.useDebounceFn)(()=>{F(C)},{wait:500}),H=a=>{D(a),G()},[I,K]=(0,f.useState)([]),[L,M]=(0,f.useState)([]),{run:N}=(0,d.useDebounceFn)(()=>{M(I)},{wait:500});(0,f.useEffect)(()=>{if("normal"===m.role)return l.replace("/apps")},[m,l]);let O=(0,x.useSelector)(a=>a.isCurrentWorkspaceManager),{data:P}=(0,B.useDatasetApiBaseUrl)();return(0,b.jsxs)("div",{className:"scroll-container relative flex grow flex-col overflow-y-auto bg-background-body",children:[(0,b.jsx)("div",{className:"sticky top-0 z-10 flex items-center justify-end gap-x-1 bg-background-body px-12 pb-2 pt-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[n&&(0,b.jsx)(w.default,{isChecked:s,onChange:t,label:a("allKnowledge",{ns:"dataset"}),labelClassName:"system-md-regular text-text-secondary",className:"mr-2",tooltip:a("allKnowledgeDescription",{ns:"dataset"})}),(0,b.jsx)(v.default,{type:"knowledge",value:I,onChange:a=>{K(a),N()}}),(0,b.jsx)(j.default,{showLeftIcon:!0,showClearIcon:!0,wrapperClassName:"w-[200px]",value:C,onChange:a=>H(a.target.value),onClear:()=>H("")}),O&&(0,b.jsx)(S,{apiBaseUrl:P?.api_base_url??""}),(0,b.jsx)("div",{className:"h-4 w-[1px] bg-divider-regular"}),(0,b.jsxs)(h.default,{className:"shadows-shadow-xs gap-0.5",onClick:()=>r(!0),children:[(0,b.jsx)(i.ApiConnectionMod,{className:"h-4 w-4 text-components-button-secondary-text"}),(0,b.jsx)("div",{className:"system-sm-medium flex items-center justify-center gap-1 px-0.5 text-components-button-secondary-text",children:a("externalAPIPanelTitle",{ns:"dataset"})})]})]})}),(0,b.jsx)(au,{tags:L,keywords:E,includeAll:s}),!k.branding.enabled&&(0,b.jsx)(T,{}),o&&(0,b.jsx)(u,{type:"knowledge",show:o}),q&&(0,b.jsx)(J,{onClose:()=>r(!1)})]})}],535987)}];

//# sourceMappingURL=app_components_datasets_list_index_tsx_266d0c9f._.js.map
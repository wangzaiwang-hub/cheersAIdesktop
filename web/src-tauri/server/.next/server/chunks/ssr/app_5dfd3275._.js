module.exports=[892839,a=>{"use strict";var b=a.i(608061),c=a.i(57843),d=a.i(527344);a.s(["default",0,({name:a,avatar:e,size:f=30,className:g,textClassName:h,onError:i})=>{let j="shrink-0 flex items-center rounded-full bg-primary-600",k={width:`${f}px`,height:`${f}px`,fontSize:`${f}px`,lineHeight:`${f}px`},[l,m]=(0,c.useState)(!1);return((0,c.useEffect)(()=>{e&&l&&m(!1)},[e]),e&&!l)?(0,b.jsx)("img",{className:(0,d.cn)(j,g),style:k,alt:a,src:e,onError:()=>{m(!0),i?.(!0)},onLoad:()=>i?.(!1)}):(0,b.jsx)("div",{className:(0,d.cn)(j,g),style:k,children:(0,b.jsx)("div",{className:(0,d.cn)(h,"scale-[0.4] text-center text-white"),style:k,children:a&&a[0].toLocaleUpperCase()})})}])},824374,a=>{"use strict";a.s(["OAUTH_AUTHORIZE_PENDING_KEY",0,"oauth_authorize_pending","OAUTH_AUTHORIZE_PENDING_TTL",0,180,"REDIRECT_URL_KEY",0,"oauth_redirect_url"])},582776,a=>{"use strict";var b=a.i(608061),c=a.i(429150),d=a.i(435133),e=a.i(533306),f=a.i(57843);a.i(752298);var g=a.i(693025),h=a.i(892839),i=a.i(909795),j=a.i(105249),k=a.i(114715),l=a.i(701458),m=a.i(705134),n=a.i(763539),o=a.i(848636),p=a.i(528698),q=a.i(41511);let r="oauth-provider";var s=a.i(824374);function t(){let{t:a}=(0,g.useTranslation)(),t={"read:name":{icon:c.RiInfoCardLine,label:a("scopes.name",{ns:"oauth"})},"read:email":{icon:c.RiMailLine,label:a("scopes.email",{ns:"oauth"})},"read:avatar":{icon:c.RiAccountCircleLine,label:a("scopes.avatar",{ns:"oauth"})},"read:interface_language":{icon:c.RiTranslate2,label:a("scopes.languagePreference",{ns:"oauth"})},"read:timezone":{icon:c.RiGlobalLine,label:a("scopes.timezone",{ns:"oauth"})}},u=(0,e.useRouter)(),v=(0,l.useLanguage)(),w=(0,e.useSearchParams)(),x=decodeURIComponent(w.get("client_id")||""),y=decodeURIComponent(w.get("redirect_uri")||""),{userProfile:z}=(0,m.useAppContext)(),{data:A,isLoading:B,isError:C}=(0,p.useQuery)({queryKey:[r,"authAppInfo",x,y],queryFn:()=>(0,q.post)("/oauth/provider",{body:{client_id:x,redirect_uri:y}},{silent:!0}),enabled:!!(x&&y)}),{mutateAsync:D,isPending:E}=(0,o.useMutation)({mutationKey:[r,"authorize"],mutationFn:a=>(0,q.post)("/oauth/provider/authorize",{body:a})}),F=(0,f.useRef)(!1),{isLoading:G,data:H}=(0,n.useIsLogin)(),I=H?.logged_in,J=()=>{try{var a,b;let c,e=function(a,b){try{return`${globalThis.location.origin}${a}${b}`}catch{return a+b}}("/account/oauth/authorize",`?client_id=${encodeURIComponent(x)}&redirect_uri=${encodeURIComponent(y)}`);a=s.OAUTH_AUTHORIZE_PENDING_KEY,b=s.OAUTH_AUTHORIZE_PENDING_TTL,c={value:e,expiry:(0,d.default)().add(b,"seconds").unix()},localStorage.setItem(a,JSON.stringify(c)),u.push(`/signin?${s.REDIRECT_URL_KEY}=${encodeURIComponent(e)}`)}catch{u.push("/signin")}},K=async()=>{if(x&&y)try{let{code:a}=await D({client_id:x}),b=new URL(y);b.searchParams.set("code",a),globalThis.location.href=b.toString()}catch(b){k.default.notify({type:"error",message:`${a("error.authorizeFailed",{ns:"oauth"})}: ${b.message}`})}};return((0,f.useEffect)(()=>{let b=!x||!y;(b||C)&&!F.current&&(F.current=!0,k.default.notify({type:"error",message:b?a("error.invalidParams",{ns:"oauth"}):a("error.authAppInfoFetchFailed",{ns:"oauth"}),duration:0}))},[x,y,C]),B||G)?(0,b.jsx)("div",{className:"bg-background-default-subtle",children:(0,b.jsx)(j.default,{type:"app"})}):(0,b.jsxs)("div",{className:"bg-background-default-subtle",children:[A?.app_icon&&(0,b.jsx)("div",{className:"w-max rounded-2xl border-[0.5px] border-components-panel-border bg-text-primary-on-surface p-3 shadow-lg",children:(0,b.jsx)("img",{src:A.app_icon,alt:"app icon",className:"h-10 w-10 rounded"})}),(0,b.jsxs)("div",{className:`mb-4 mt-5 flex flex-col gap-2 ${I?"pb-2":""}`,children:[(0,b.jsxs)("div",{className:"title-4xl-semi-bold",children:[I&&(0,b.jsx)("div",{className:"text-text-primary",children:a("connect",{ns:"oauth"})}),(0,b.jsx)("div",{className:"text-[var(--color-saas-dify-blue-inverted)]",children:A?.app_label[v]||A?.app_label?.en_US||a("unknownApp",{ns:"oauth"})}),!I&&(0,b.jsx)("div",{className:"text-text-primary",children:a("tips.notLoggedIn",{ns:"oauth"})})]}),(0,b.jsx)("div",{className:"body-md-regular text-text-secondary",children:I?`${A?.app_label[v]||A?.app_label?.en_US||a("unknownApp",{ns:"oauth"})} ${a("tips.loggedIn",{ns:"oauth"})}`:a("tips.needLogin",{ns:"oauth"})})]}),I&&z&&(0,b.jsxs)("div",{className:"flex items-center justify-between rounded-xl bg-background-section-burn-inverted p-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,b.jsx)(h.default,{avatar:z.avatar_url,name:z.name,size:36}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"system-md-semi-bold text-text-secondary",children:z.name}),(0,b.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:z.email})]})]}),(0,b.jsx)(i.default,{variant:"tertiary",size:"small",onClick:J,children:a("switchAccount",{ns:"oauth"})})]}),I&&!!A?.scope&&(0,b.jsx)("div",{className:"mt-2 flex flex-col gap-2.5 rounded-xl bg-background-section-burn-inverted px-[22px] py-5 text-text-secondary",children:A.scope.split(/\s+/).filter(Boolean).map(a=>{let d=t[a];return(0,b.jsxs)("div",{className:"body-sm-medium flex items-center gap-2 text-text-secondary",children:[d?(0,b.jsx)(d.icon,{className:"h-4 w-4"}):(0,b.jsx)(c.RiAccountCircleLine,{className:"h-4 w-4"}),d.label]},a)})}),(0,b.jsx)("div",{className:"flex flex-col items-center gap-2 pt-4",children:I?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(i.default,{variant:"primary",size:"large",className:"w-full",onClick:K,disabled:!x||!y||C||E,loading:E,children:a("continue",{ns:"oauth"})}),(0,b.jsx)(i.default,{size:"large",className:"w-full",onClick:()=>u.push("/apps"),children:a("operation.cancel",{ns:"common"})})]}):(0,b.jsx)(i.default,{variant:"primary",size:"large",className:"w-full",onClick:J,children:a("login",{ns:"oauth"})})}),(0,b.jsx)("div",{className:"mt-4 py-2",children:(0,b.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"400",height:"1",viewBox:"0 0 400 1",fill:"none",children:[(0,b.jsx)("path",{d:"M0 0.5H400",stroke:"url(#paint0_linear_2_5904)"}),(0,b.jsx)("defs",{children:(0,b.jsxs)("linearGradient",{id:"paint0_linear_2_5904",x1:"400",y1:"9.49584",x2:"0.000228929",y2:"9.17666",gradientUnits:"userSpaceOnUse",children:[(0,b.jsx)("stop",{"stop-color":"white","stop-opacity":"0.01"}),(0,b.jsx)("stop",{offset:"0.505","stop-color":"#101828","stop-opacity":"0.08"}),(0,b.jsx)("stop",{offset:"1","stop-color":"white","stop-opacity":"0.01"})]})})]})}),(0,b.jsx)("div",{className:"system-xs-regular mt-3 text-text-tertiary",children:a("tips.common",{ns:"oauth"})})]})}a.s(["default",()=>t],582776)}];

//# sourceMappingURL=app_5dfd3275._.js.map
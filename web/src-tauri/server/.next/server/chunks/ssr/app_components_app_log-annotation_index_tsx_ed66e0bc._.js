module.exports=[595132,a=>{"use strict";var b,c,d,e,f,g=a.i(608061),h=a.i(533306),i=a.i(57843);a.i(752298);var j=a.i(693025),k=a.i(429150),l=a.i(836011),m=a.i(175809),n=a.i(501039);a.i(151730);var o=a.i(819057),o=o,p=a.i(105249),q=a.i(796499),r=a.i(81492),s=a.i(477401),t=a.i(18039),u=a.i(375616),v=a.i(202738),w=a.i(954200),x=a.i(459858),y=a.i(527344),z=a.i(114715);let A=({className:a})=>(0,g.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:a??"",children:(0,g.jsx)("path",{d:"M5 6.5V5M8.93934 7.56066L10 6.5M10.0103 11.5H11.5103",stroke:"#374151",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),B=i.memo(()=>{let{t:a}=(0,j.useTranslation)();return(0,g.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,g.jsxs)("div",{className:"box-border h-fit w-[560px] rounded-2xl bg-background-section-burn px-5 py-4",children:[(0,g.jsxs)("span",{className:"system-md-semibold text-text-secondary",children:[a("noData.title",{ns:"appAnnotation"}),(0,g.jsx)(A,{className:"relative -left-1.5 -top-3 inline"})]}),(0,g.jsx)("div",{className:"system-sm-regular mt-2 text-text-tertiary",children:a("noData.description",{ns:"appAnnotation"})})]})})});var C=a.i(816134),D=a.i(757395);let E=i.memo(({appId:a,queryParams:b,setQueryParams:c,children:d})=>{let{data:e,isLoading:f}=(0,D.useAnnotationsCount)(a),{t:h}=(0,j.useTranslation)();return f||!e?null:(0,g.jsxs)("div",{className:"mb-2 flex flex-row flex-wrap items-center justify-between gap-2",children:[(0,g.jsx)(C.default,{wrapperClassName:"w-[200px]",showLeftIcon:!0,showClearIcon:!0,value:b.keyword,placeholder:h("operation.search",{ns:"common"}),onChange:a=>{c({...b,keyword:a.target.value})},onClear:()=>c({...b,keyword:""})}),d]})});var F=a.i(318519),G=a.i(941938),H=a.i(240928);a.i(943046);var I=a.i(782465);a.i(849888);var J=a.i(91784),J=J,K=a.i(779413),L=a.i(234782),M=a.i(252813),N=a.i(136403),O=a.i(760327),P=a.i(909795),Q=a.i(168799),R=a.i(504612),S=a.i(289795);a.i(637422);var T=a.i(425846),U=a.i(973888),V=a.i(146172),W=((b={}).Query="query",b.Answer="answer",b);let X=i.memo(({type:a,content:b,onChange:c})=>{let{t:d}=(0,j.useTranslation)(),e="query"===a?(0,g.jsx)(U.User,{className:"h-6 w-6"}):(0,g.jsx)(T.Robot,{className:"h-6 w-6"}),f=d("query"===a?"addModal.queryName":"addModal.answerName",{ns:"appAnnotation"}),h=d("query"===a?"addModal.queryPlaceholder":"addModal.answerPlaceholder",{ns:"appAnnotation"});return(0,g.jsxs)("div",{className:"flex",onClick:a=>a.stopPropagation(),children:[(0,g.jsx)("div",{className:"mr-3 shrink-0",children:e}),(0,g.jsxs)("div",{className:"grow",children:[(0,g.jsx)("div",{className:"system-xs-semibold mb-1 text-text-primary",children:f}),(0,g.jsx)(V.default,{value:b,onChange:a=>c(a.target.value),placeholder:h,autoFocus:!0})]})]})}),Y=i.memo(({isShow:a,onHide:b,onAdd:c})=>{let{t:d}=(0,j.useTranslation)(),{plan:e,enableBilling:f}=(0,u.useProviderContext)(),h=f&&e.usage.annotatedResponse>=e.total.annotatedResponse,[k,l]=(0,i.useState)(""),[m,n]=(0,i.useState)(""),[o,p]=(0,i.useState)(!1),[q,r]=(0,i.useState)(!1),s=a=>a.question?!!a.answer||d("errorMessage.answerRequired",{ns:"appAnnotation"}):d("errorMessage.queryRequired",{ns:"appAnnotation"}),t=async()=>{let a={question:k,answer:m};if(!0!==s(a))return void z.default.notify({type:"error",message:s(a)});r(!0);try{await c(a)}catch{}r(!1),o?(l(""),n("")):b()};return(0,g.jsx)("div",{children:(0,g.jsx)(R.default,{isShow:a,onHide:b,maxWidthClassName:"!max-w-[480px]",title:d("addModal.title",{ns:"appAnnotation"}),body:(0,g.jsxs)("div",{className:"space-y-6 p-6 pb-4",children:[(0,g.jsx)(X,{type:W.Query,content:k,onChange:l}),(0,g.jsx)(X,{type:W.Answer,content:m,onChange:n})]}),foot:(0,g.jsxs)("div",{children:[h&&(0,g.jsx)("div",{className:"mb-4 mt-6 px-6",children:(0,g.jsx)(S.default,{})}),(0,g.jsxs)("div",{className:"system-sm-medium flex h-16 items-center justify-between rounded-bl-xl rounded-br-xl border-t border-divider-subtle bg-background-section-burn px-4 text-text-tertiary",children:[(0,g.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,g.jsx)(Q.default,{id:"create-next-checkbox",checked:o,onCheck:()=>p(!o)}),(0,g.jsx)("div",{children:d("addModal.createNext",{ns:"appAnnotation"})})]}),(0,g.jsxs)("div",{className:"mt-2 flex space-x-2",children:[(0,g.jsx)(P.default,{className:"h-7 text-xs",onClick:b,children:d("operation.cancel",{ns:"common"})}),(0,g.jsx)(P.default,{className:"h-7 text-xs",variant:"primary",onClick:t,loading:q,disabled:h,children:d("operation.add",{ns:"common"})})]})]})]})})})});var Z=a.i(111089),$=a.i(940272);a.i(658335);var _=a.i(350295);let aa=[["question","answer"],["question1","answer1"],["question2","answer2"]],ab=[["问题","答案"],["问题 1","答案 1"],["问题 2","答案 2"]],ac=i.memo(()=>{let{t:a}=(0,j.useTranslation)(),b=(0,M.useLocale)(),{CSVDownloader:c,Type:d}=(0,H.useCSVDownloader)();return(0,g.jsxs)("div",{className:"mt-6",children:[(0,g.jsx)("div",{className:"system-sm-medium text-text-primary",children:a("generation.csvStructureTitle",{ns:"share"})}),(0,g.jsx)("div",{className:"mt-2 max-h-[500px] overflow-auto",children:(0,g.jsxs)("table",{className:"w-full table-fixed border-separate border-spacing-0 rounded-lg border border-divider-regular text-xs",children:[(0,g.jsx)("thead",{className:"text-text-tertiary",children:(0,g.jsxs)("tr",{children:[(0,g.jsx)("td",{className:"h-9 border-b border-divider-regular pl-3 pr-2",children:a("batchModal.question",{ns:"appAnnotation"})}),(0,g.jsx)("td",{className:"h-9 border-b border-divider-regular pl-3 pr-2",children:a("batchModal.answer",{ns:"appAnnotation"})})]})}),(0,g.jsxs)("tbody",{className:"text-text-secondary",children:[(0,g.jsxs)("tr",{children:[(0,g.jsxs)("td",{className:"h-9 border-b border-divider-subtle pl-3 pr-2 text-[13px]",children:[a("batchModal.question",{ns:"appAnnotation"})," ","1"]}),(0,g.jsxs)("td",{className:"h-9 border-b border-divider-subtle pl-3 pr-2 text-[13px]",children:[a("batchModal.answer",{ns:"appAnnotation"})," ","1"]})]}),(0,g.jsxs)("tr",{children:[(0,g.jsxs)("td",{className:"h-9 pl-3 pr-2 text-[13px]",children:[a("batchModal.question",{ns:"appAnnotation"})," ","2"]}),(0,g.jsxs)("td",{className:"h-9 pl-3 pr-2 text-[13px]",children:[a("batchModal.answer",{ns:"appAnnotation"})," ","2"]})]})]})]})}),(0,g.jsx)(c,{className:"mt-2 block cursor-pointer",type:d.Link,filename:`template-${b}`,bom:!0,data:b!==N.LanguagesSupported[1]?aa:ab,children:(0,g.jsxs)("div",{className:"system-xs-medium flex h-[18px] items-center space-x-1 text-text-accent",children:[(0,g.jsx)(_.Download02,{className:"mr-1 h-3 w-3"}),a("batchModal.template",{ns:"appAnnotation"})]})})]})});var ad=a.i(639378);a.i(836482);var ae=a.i(979492);let af=i.memo(({file:a,updateFile:b})=>{let{t:c}=(0,j.useTranslation)(),{notify:d}=(0,ad.useContext)(z.ToastContext),[e,f]=(0,i.useState)(!1),h=(0,i.useRef)(null),l=(0,i.useRef)(null),m=(0,i.useRef)(null),n=a=>{a.preventDefault(),a.stopPropagation(),a.target!==l.current&&f(!0)},o=a=>{a.preventDefault(),a.stopPropagation()},p=a=>{a.preventDefault(),a.stopPropagation(),a.target===l.current&&f(!1)},q=a=>{if(a.preventDefault(),a.stopPropagation(),f(!1),!a.dataTransfer)return;let e=Array.from(a.dataTransfer.files);e.length>1?d({type:"error",message:c("stepOne.uploader.validation.count",{ns:"datasetCreation"})}):b(e[0])},r=()=>{m.current&&m.current.click()};return(0,i.useEffect)(()=>(h.current?.addEventListener("dragenter",n),h.current?.addEventListener("dragover",o),h.current?.addEventListener("dragleave",p),h.current?.addEventListener("drop",q),()=>{h.current?.removeEventListener("dragenter",n),h.current?.removeEventListener("dragover",o),h.current?.removeEventListener("dragleave",p),h.current?.removeEventListener("drop",q)}),[]),(0,g.jsxs)("div",{className:"mt-6",children:[(0,g.jsx)("input",{ref:m,style:{display:"none"},type:"file",id:"fileUploader",accept:".csv",onChange:a=>{b(a.target.files?.[0])}}),(0,g.jsxs)("div",{ref:h,children:[!a&&(0,g.jsxs)("div",{className:(0,y.cn)("system-sm-regular flex h-20 items-center rounded-xl border border-dashed border-components-dropzone-border bg-components-dropzone-bg",e&&"border border-components-dropzone-border-accent bg-components-dropzone-bg-accent"),children:[(0,g.jsxs)("div",{className:"flex w-full items-center justify-center space-x-2",children:[(0,g.jsx)(ae.Csv,{className:"shrink-0"}),(0,g.jsxs)("div",{className:"text-text-tertiary",children:[c("batchModal.csvUploadTitle",{ns:"appAnnotation"}),(0,g.jsx)("span",{className:"cursor-pointer text-text-accent",onClick:r,children:c("batchModal.browse",{ns:"appAnnotation"})})]})]}),e&&(0,g.jsx)("div",{ref:l,className:"absolute left-0 top-0 h-full w-full"})]}),a&&(0,g.jsxs)("div",{className:(0,y.cn)("group flex h-20 items-center rounded-xl border border-components-panel-border bg-components-panel-bg px-6 text-sm font-normal","hover:border-components-panel-bg-blur hover:bg-components-panel-bg-blur"),children:[(0,g.jsx)(ae.Csv,{className:"shrink-0"}),(0,g.jsxs)("div",{className:"ml-2 flex w-0 grow",children:[(0,g.jsx)("span",{className:"max-w-[calc(100%_-_30px)] overflow-hidden text-ellipsis whitespace-nowrap text-text-primary",children:a.name.replace(/.csv$/,"")}),(0,g.jsx)("span",{className:"shrink-0 text-text-tertiary",children:".csv"})]}),(0,g.jsxs)("div",{className:"hidden items-center group-hover:flex",children:[(0,g.jsx)(P.default,{variant:"secondary",onClick:r,children:c("stepOne.uploader.change",{ns:"datasetCreation"})}),(0,g.jsx)("div",{className:"mx-2 h-4 w-px bg-divider-regular"}),(0,g.jsx)("div",{className:"cursor-pointer p-2",onClick:()=>{m.current&&(m.current.value=""),b()},"data-testid":"remove-file-button",children:(0,g.jsx)(k.RiDeleteBinLine,{className:"h-4 w-4 text-text-tertiary"})})]})]})]})]})});(c={}).WAITING="waiting",c.PROCESSING="processing",c.COMPLETED="completed",c.ERROR="error";let ag=i.memo(({appId:a,isShow:b,onCancel:c,onAdded:d})=>{let{t:e}=(0,j.useTranslation)(),{plan:f,enableBilling:h}=(0,u.useProviderContext)(),l=h&&f.usage.annotatedResponse>=f.total.annotatedResponse,[m,n]=(0,i.useState)();(0,i.useEffect)(()=>{b||n(void 0)},[b]);let[o,p]=(0,i.useState)(),q=z.default.notify,r=async b=>{try{let f=await (0,v.checkAnnotationBatchImportProgress)({jobID:b,appId:a});p(f.job_status),("waiting"===f.job_status||"processing"===f.job_status)&&setTimeout(()=>r(f.job_id),2500),"error"===f.job_status&&q({type:"error",message:`${e("batchModal.runError",{ns:"appAnnotation"})}`}),"completed"===f.job_status&&(q({type:"success",message:`${e("batchModal.completed",{ns:"appAnnotation"})}`}),d(),c())}catch(a){q({type:"error",message:`${e("batchModal.runError",{ns:"appAnnotation"})}${"message"in a?`: ${a.message}`:""}`})}},s=async b=>{let c=new FormData;c.append("file",b);try{let b=await (0,v.annotationBatchImport)({url:`/apps/${a}/annotations/batch-import`,body:c});p(b.job_status),r(b.job_id)}catch(a){q({type:"error",message:`${e("batchModal.runError",{ns:"appAnnotation"})}${"message"in a?`: ${a.message}`:""}`})}};return(0,g.jsxs)($.default,{isShow:b,onClose:Z.noop,className:"!max-w-[520px] !rounded-xl px-8 py-6",children:[(0,g.jsx)("div",{className:"system-xl-medium relative pb-1 text-text-primary",children:e("batchModal.title",{ns:"appAnnotation"})}),(0,g.jsx)("div",{className:"absolute right-4 top-4 cursor-pointer p-2",onClick:c,children:(0,g.jsx)(k.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})}),(0,g.jsx)(af,{file:m,updateFile:a=>n(a)}),(0,g.jsx)(ac,{}),l&&(0,g.jsx)("div",{className:"mt-4",children:(0,g.jsx)(S.default,{})}),(0,g.jsxs)("div",{className:"mt-[28px] flex justify-end pt-6",children:[(0,g.jsx)(P.default,{className:"system-sm-medium mr-2 text-text-tertiary",onClick:c,children:e("batchModal.cancel",{ns:"appAnnotation"})}),(0,g.jsx)(P.default,{variant:"primary",onClick:()=>{m&&s(m)},disabled:l||!m,loading:"processing"===o||"waiting"===o,children:e("batchModal.run",{ns:"appAnnotation"})})]})]})});var ah=a.i(42550);let ai=i.memo(({isShow:a,onHide:b,onConfirm:c})=>{let{t:d}=(0,j.useTranslation)();return(0,g.jsx)(ah.default,{isShow:a,onCancel:b,onConfirm:c,type:"danger",title:d("table.header.clearAllConfirm",{ns:"appAnnotation"})})}),aj=["Question","Answer"],ak=["问题","答案"],al=i.memo(({appId:a,onAdd:b,onAdded:c,controlUpdateList:d})=>{let{t:e}=(0,j.useTranslation)(),f=(0,M.useLocale)(),{CSVDownloader:h,Type:l}=(0,H.useCSVDownloader)(),[m,n]=(0,i.useState)([]),o=0===m.length,p=()=>{let a=new Blob([m.map(a=>`{"messages": [{"role": "system", "content": ""}, {"role": "user", "content": ${JSON.stringify(a.question)}}, {"role": "assistant", "content": ${JSON.stringify(a.answer)}}]}`).join("\n")],{type:"application/jsonl"});(0,O.downloadBlob)({data:a,fileName:`annotations-${f}.jsonl`})},q=i.useCallback(async()=>{let{data:b}=await (0,v.fetchExportAnnotationList)(a);n(b)},[a]);(0,i.useEffect)(()=>{q()},[q]),(0,i.useEffect)(()=>{d&&q()},[d,q]);let[r,s]=(0,i.useState)(!1),[t,u]=(0,i.useState)(!1),w=()=>{u(!0)},x=async()=>{try{await (0,v.clearAllAnnotations)(a),c()}catch(a){console.error(`failed to clear all annotations, ${a}`)}finally{u(!1)}},[z,A]=i.useState(!1);return(0,g.jsxs)("div",{className:"flex space-x-2",children:[(0,g.jsxs)(P.default,{variant:"primary",onClick:()=>A(!0),children:[(0,g.jsx)(k.RiAddLine,{className:"mr-0.5 h-4 w-4"}),(0,g.jsx)("div",{children:e("table.header.addAnnotation",{ns:"appAnnotation"})})]}),(0,g.jsx)(L.default,{htmlContent:(0,g.jsx)(()=>(0,g.jsxs)("div",{className:"w-full py-1",children:[(0,g.jsxs)("button",{type:"button",className:"mx-1 flex h-9 w-[calc(100%_-_8px)] cursor-pointer items-center space-x-2 rounded-lg px-3 py-2 hover:bg-components-panel-on-panel-item-bg-hover disabled:opacity-50",onClick:()=>{s(!0)},children:[(0,g.jsx)(K.FilePlus02,{className:"h-4 w-4 text-text-tertiary"}),(0,g.jsx)("span",{className:"system-sm-regular grow text-left text-text-secondary",children:e("table.header.bulkImport",{ns:"appAnnotation"})})]}),(0,g.jsxs)(F.Menu,{as:"div",className:"relative h-full w-full",children:[(0,g.jsxs)(F.MenuButton,{className:"mx-1 flex h-9 w-[calc(100%_-_8px)] cursor-pointer items-center space-x-2 rounded-lg px-3 py-2 hover:bg-components-panel-on-panel-item-bg-hover disabled:opacity-50",children:[(0,g.jsx)(J.default,{className:"h-4 w-4 text-text-tertiary"}),(0,g.jsx)("span",{className:"system-sm-regular grow text-left text-text-secondary",children:e("table.header.bulkExport",{ns:"appAnnotation"})}),(0,g.jsx)(I.ChevronRight,{className:"h-[14px] w-[14px] shrink-0 text-text-tertiary"})]}),(0,g.jsx)(G.Transition,{as:i.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:(0,g.jsxs)(F.MenuItems,{className:(0,y.cn)("absolute left-1 top-[1px] z-10 min-w-[100px] origin-top-right -translate-x-full rounded-xl border-[0.5px] border-components-panel-on-panel-item-bg bg-components-panel-bg py-1 shadow-xs"),children:[(0,g.jsx)(h,{type:l.Link,filename:`annotations-${f}`,bom:!0,data:[f!==N.LanguagesSupported[1]?aj:ak,...m.map(a=>[a.question,a.answer])],children:(0,g.jsx)("button",{type:"button",disabled:o,className:"mx-1 flex h-9 w-[calc(100%_-_8px)] cursor-pointer items-center space-x-2 rounded-lg px-3 py-2 hover:bg-components-panel-on-panel-item-bg-hover disabled:opacity-50",children:(0,g.jsx)("span",{className:"system-sm-regular grow text-left text-text-secondary",children:"CSV"})})}),(0,g.jsx)("button",{type:"button",disabled:o,className:(0,y.cn)("mx-1 flex h-9 w-[calc(100%_-_8px)] cursor-pointer items-center space-x-2 rounded-lg px-3 py-2 hover:bg-components-panel-on-panel-item-bg-hover disabled:opacity-50","!border-0"),onClick:p,children:(0,g.jsx)("span",{className:"system-sm-regular grow text-left text-text-secondary",children:"JSONL"})})]})})]}),(0,g.jsxs)("button",{type:"button",onClick:w,className:"mx-1 flex h-9 w-[calc(100%_-_8px)] cursor-pointer items-center space-x-2 rounded-lg px-3 py-2 text-red-600 hover:bg-red-50 disabled:opacity-50",children:[(0,g.jsx)(k.RiDeleteBinLine,{className:"h-4 w-4"}),(0,g.jsx)("span",{className:"system-sm-regular grow text-left",children:e("table.header.clearAll",{ns:"appAnnotation"})})]})]}),{}),position:"br",trigger:"click",btnElement:(0,g.jsx)(k.RiMoreFill,{className:"h-4 w-4"}),btnClassName:"btn btn-secondary btn-medium w-8 p-0",className:"!z-20 h-fit !w-[155px]",popupClassName:"!w-full !overflow-visible",manualClose:!0}),z&&(0,g.jsx)(Y,{isShow:z,onHide:()=>A(!1),onAdd:b}),r&&(0,g.jsx)(ag,{appId:a,isShow:r,onCancel:()=>s(!1),onAdded:c}),t&&(0,g.jsx)(ai,{isShow:t,onHide:()=>u(!1),onConfirm:x})]})});var am=a.i(98654),an=a.i(497746),ao=a.i(757801);let ap=i.memo(({className:a,selectedIds:b,onBatchDelete:c,onCancel:d})=>{let{t:e}=(0,j.useTranslation)(),[f,{setTrue:h,setFalse:i}]=(0,an.useBoolean)(!1),[l,{setTrue:m,setFalse:n}]=(0,an.useBoolean)(!1),o=async()=>{m(),await c(),i(),n()};return(0,g.jsxs)("div",{className:(0,y.cn)("pointer-events-none flex w-full justify-center",a),children:[(0,g.jsxs)("div",{className:"pointer-events-auto flex items-center gap-x-1 rounded-[10px] border border-components-actionbar-border-accent bg-components-actionbar-bg-accent p-1 shadow-xl shadow-shadow-shadow-5 backdrop-blur-[5px]",children:[(0,g.jsxs)("div",{className:"inline-flex items-center gap-x-2 py-1 pl-2 pr-3",children:[(0,g.jsx)("span",{className:"flex h-5 w-5 items-center justify-center rounded-md bg-text-accent px-1 py-0.5 text-xs font-medium text-text-primary-on-surface",children:b.length}),(0,g.jsx)("span",{className:"text-[13px] font-semibold leading-[16px] text-text-accent",children:e("batchAction.selected",{ns:"appAnnotation"})})]}),(0,g.jsx)(ao.default,{type:"vertical",className:"mx-0.5 h-3.5 bg-divider-regular"}),(0,g.jsxs)("div",{className:"flex cursor-pointer items-center gap-x-0.5 px-3 py-2",onClick:h,children:[(0,g.jsx)(k.RiDeleteBinLine,{className:"h-4 w-4 text-components-button-destructive-ghost-text"}),(0,g.jsx)("button",{type:"button",className:"px-0.5 text-[13px] font-medium leading-[16px] text-components-button-destructive-ghost-text",children:e("operation.delete",{ns:"common"})})]}),(0,g.jsx)(ao.default,{type:"vertical",className:"mx-0.5 h-3.5 bg-divider-regular"}),(0,g.jsx)("button",{type:"button",className:"px-3.5 py-2 text-[13px] font-medium leading-[16px] text-components-button-ghost-text",onClick:d,children:e("operation.cancel",{ns:"common"})})]}),f&&(0,g.jsx)(ah.default,{isShow:!0,title:e("list.delete.title",{ns:"appAnnotation"}),confirmText:e("operation.delete",{ns:"common"}),onConfirm:o,onCancel:i,isLoading:l,isDisabled:l})]})}),aq=i.memo(({isShow:a,onHide:b,onRemove:c})=>{let{t:d}=(0,j.useTranslation)();return(0,g.jsx)(ah.default,{isShow:a,onCancel:b,onConfirm:c,title:d("feature.annotation.removeConfirm",{ns:"appDebug"})})}),ar=i.memo(({list:a,onView:b,onRemove:c,selectedIds:d,onSelectedIdsChange:e,onBatchDelete:f,onCancel:h})=>{let{t:l}=(0,j.useTranslation)(),{formatTime:n}=(0,am.default)(),[o,p]=i.useState(null),[q,r]=i.useState(!1),s=(0,i.useMemo)(()=>a.length>0&&a.every(a=>d.includes(a.id)),[a,d]),t=(0,i.useMemo)(()=>a.some(a=>d.includes(a.id)),[a,d]),u=(0,i.useCallback)(()=>{let b=a.map(a=>a.id),c=d.filter(a=>!b.includes(a));s?e(c):e([...c,...b])},[s,a,d,e]);return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("div",{className:"relative mt-2 grow overflow-x-auto",children:[(0,g.jsxs)("table",{className:(0,y.cn)("w-full min-w-[440px] border-collapse border-0"),children:[(0,g.jsx)("thead",{className:"system-xs-medium-uppercase text-text-tertiary",children:(0,g.jsxs)("tr",{children:[(0,g.jsx)("td",{className:"w-12 whitespace-nowrap rounded-l-lg bg-background-section-burn px-2",children:(0,g.jsx)(Q.default,{className:"mr-2",checked:s,indeterminate:!s&&t,onCheck:u})}),(0,g.jsx)("td",{className:"w-5 whitespace-nowrap bg-background-section-burn pl-2 pr-1",children:l("table.header.question",{ns:"appAnnotation"})}),(0,g.jsx)("td",{className:"whitespace-nowrap bg-background-section-burn py-1.5 pl-3",children:l("table.header.answer",{ns:"appAnnotation"})}),(0,g.jsx)("td",{className:"whitespace-nowrap bg-background-section-burn py-1.5 pl-3",children:l("table.header.createdAt",{ns:"appAnnotation"})}),(0,g.jsx)("td",{className:"whitespace-nowrap bg-background-section-burn py-1.5 pl-3",children:l("table.header.hits",{ns:"appAnnotation"})}),(0,g.jsx)("td",{className:"w-[96px] whitespace-nowrap rounded-r-lg bg-background-section-burn py-1.5 pl-3",children:l("table.header.actions",{ns:"appAnnotation"})})]})}),(0,g.jsx)("tbody",{className:"system-sm-regular text-text-secondary",children:a.map(a=>(0,g.jsxs)("tr",{className:"cursor-pointer border-b border-divider-subtle hover:bg-background-default-hover",onClick:()=>{b(a)},children:[(0,g.jsx)("td",{className:"w-12 px-2",onClick:a=>a.stopPropagation(),children:(0,g.jsx)(Q.default,{className:"mr-2",checked:d.includes(a.id),onCheck:()=>{d.includes(a.id)?e(d.filter(b=>b!==a.id)):e([...d,a.id])}})}),(0,g.jsx)("td",{className:"max-w-[250px] overflow-hidden text-ellipsis whitespace-nowrap p-3 pr-2",title:a.question,children:a.question}),(0,g.jsx)("td",{className:"max-w-[250px] overflow-hidden text-ellipsis whitespace-nowrap p-3 pr-2",title:a.answer,children:a.answer}),(0,g.jsx)("td",{className:"p-3 pr-2",children:n(a.created_at,l("dateTimeFormat",{ns:"appLog"}))}),(0,g.jsx)("td",{className:"p-3 pr-2",children:a.hit_count}),(0,g.jsx)("td",{className:"w-[96px] p-3 pr-2",onClick:a=>a.stopPropagation(),children:(0,g.jsxs)("div",{className:"flex space-x-1 text-text-tertiary",children:[(0,g.jsx)(m.default,{onClick:()=>b(a),children:(0,g.jsx)(k.RiEditLine,{className:"h-4 w-4"})}),(0,g.jsx)(m.default,{onClick:()=>{p(a.id),r(!0)},children:(0,g.jsx)(k.RiDeleteBinLine,{className:"h-4 w-4"})})]})})]},a.id))})]}),(0,g.jsx)(aq,{isShow:q,onHide:()=>r(!1),onRemove:()=>{c(o),r(!1)}})]}),d.length>0&&(0,g.jsx)(ap,{className:"absolute bottom-20 left-0 z-20",selectedIds:d,onBatchDelete:f,onCancel:h})]})});var as=a.i(456478),at=a.i(218865);a.i(121321);var au=a.i(645693),av=a.i(751161),aw=a.i(55045);a.i(669870);var ax=a.i(64553),ax=ax;let ay=i.memo(()=>{let{t:a}=(0,j.useTranslation)();return(0,g.jsxs)("div",{className:"mx-auto mt-20 w-[480px] space-y-2 rounded-2xl bg-background-section-burn p-5",children:[(0,g.jsx)("div",{className:"inline-block rounded-lg border border-divider-subtle p-3",children:(0,g.jsx)(ax.default,{className:"h-5 w-5 text-text-tertiary"})}),(0,g.jsx)("div",{className:"system-sm-regular text-text-tertiary",children:a("viewModal.noHitHistory",{ns:"appAnnotation"})})]})});var az=((d=az||{}).annotation="annotation",d.hitHistory="hitHistory",d);let aA=i.memo(({appId:a,isShow:b,onHide:c,item:d,onSave:e,onRemove:f})=>{let{id:h,question:k,answer:l,created_at:m}=d,[n,o]=(0,i.useState)(k),[p,r]=(0,i.useState)(l),{t:s}=(0,j.useTranslation)(),{formatTime:u}=(0,am.default)(),[w,x]=i.useState(0),[z,A]=(0,i.useState)(0),[B,C]=(0,i.useState)([]);(0,i.useEffect)(()=>{o(k),r(l),x(0),A(0),C([])},[k,l,h]);let D=async(b=1)=>{try{let{data:c,total:d}=await (0,v.fetchHitHistoryList)(a,h,{page:b,limit:10});C(c),A(d)}catch{}};(0,i.useEffect)(()=>{D(w+1)},[w]),(0,i.useEffect)(()=>{b&&h&&D(1)},[h,b]);let E=[{value:"annotation",text:s("viewModal.annotatedResponse",{ns:"appAnnotation"})},{value:"hitHistory",text:B.length>0?(0,g.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,g.jsx)("div",{children:s("viewModal.hitHistory",{ns:"appAnnotation"})}),(0,g.jsx)(at.default,{text:`${z} ${s(`viewModal.hit${B.length>1?"s":""}`,{ns:"appAnnotation"})}`})]}):s("viewModal.hitHistory",{ns:"appAnnotation"})}],[F,G]=(0,i.useState)("annotation"),H=async(a,b)=>{try{a===aw.EditItemType.Query?(await e(b,p),o(b)):(await e(n,b),r(b))}catch(a){console.error("Failed to save annotation:",a)}},[I,J]=(0,i.useState)(!1),K=(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(aw.default,{type:aw.EditItemType.Query,content:k,onSave:a=>H(aw.EditItemType.Query,a)}),(0,g.jsx)(aw.default,{type:aw.EditItemType.Answer,content:l,onSave:a=>H(aw.EditItemType.Answer,a)})]}),L=0===z?(0,g.jsx)(ay,{}):(0,g.jsxs)("div",{children:[(0,g.jsxs)("table",{className:(0,y.cn)("w-full min-w-[440px] border-collapse border-0"),children:[(0,g.jsx)("thead",{className:"system-xs-medium-uppercase text-text-tertiary",children:(0,g.jsxs)("tr",{children:[(0,g.jsx)("td",{className:"w-5 whitespace-nowrap rounded-l-lg bg-background-section-burn pl-2 pr-1",children:s("hitHistoryTable.query",{ns:"appAnnotation"})}),(0,g.jsx)("td",{className:"whitespace-nowrap bg-background-section-burn py-1.5 pl-3",children:s("hitHistoryTable.match",{ns:"appAnnotation"})}),(0,g.jsx)("td",{className:"whitespace-nowrap bg-background-section-burn py-1.5 pl-3",children:s("hitHistoryTable.response",{ns:"appAnnotation"})}),(0,g.jsx)("td",{className:"whitespace-nowrap bg-background-section-burn py-1.5 pl-3",children:s("hitHistoryTable.source",{ns:"appAnnotation"})}),(0,g.jsx)("td",{className:"whitespace-nowrap bg-background-section-burn py-1.5 pl-3",children:s("hitHistoryTable.score",{ns:"appAnnotation"})}),(0,g.jsx)("td",{className:"w-[160px] whitespace-nowrap rounded-r-lg bg-background-section-burn py-1.5 pl-3",children:s("hitHistoryTable.time",{ns:"appAnnotation"})})]})}),(0,g.jsx)("tbody",{className:"system-sm-regular text-text-secondary",children:B.map(a=>(0,g.jsxs)("tr",{className:"cursor-pointer border-b border-divider-subtle hover:bg-background-default-hover",children:[(0,g.jsx)("td",{className:"max-w-[250px] overflow-hidden text-ellipsis whitespace-nowrap p-3 pr-2",title:a.question,children:a.question}),(0,g.jsx)("td",{className:"max-w-[250px] overflow-hidden text-ellipsis whitespace-nowrap p-3 pr-2",title:a.match,children:a.match}),(0,g.jsx)("td",{className:"max-w-[250px] overflow-hidden text-ellipsis whitespace-nowrap p-3 pr-2",title:a.response,children:a.response}),(0,g.jsx)("td",{className:"p-3 pr-2",children:a.source}),(0,g.jsx)("td",{className:"p-3 pr-2",children:a.score?a.score.toFixed(2):"-"}),(0,g.jsx)("td",{className:"p-3 pr-2",children:u(a.created_at,s("dateTimeFormat",{ns:"appLog"}))})]},a.id))})]}),z&&z>t.APP_PAGE_LIMIT?(0,g.jsx)(q.default,{className:"px-0",current:w,onChange:x,total:z}):null]});return(0,g.jsx)("div",{children:(0,g.jsx)(R.default,{isShow:b,onHide:c,maxWidthClassName:"!max-w-[800px]",title:(0,g.jsx)(av.default,{className:"relative top-[9px] shrink-0",value:F,onChange:a=>G(a),options:E,noBorderBottom:!0,itemClassName:"!pb-3.5"}),body:(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"space-y-6 p-6 pb-4",children:"annotation"===F?K:L}),(0,g.jsx)(ah.default,{isShow:I,onCancel:()=>J(!1),onConfirm:async()=>{await f(),J(!1),c()},title:s("feature.annotation.removeConfirm",{ns:"appDebug"})})]}),foot:h?(0,g.jsxs)("div",{className:"system-sm-medium flex h-16 items-center justify-between rounded-bl-xl rounded-br-xl border-t border-divider-subtle bg-background-section-burn px-4 text-text-tertiary",children:[(0,g.jsxs)("div",{className:"flex cursor-pointer items-center space-x-2 pl-3",onClick:()=>J(!0),children:[(0,g.jsx)(au.MessageCheckRemove,{}),(0,g.jsx)("div",{children:s("editModal.removeThisCache",{ns:"appAnnotation"})})]}),(0,g.jsxs)("div",{children:[s("editModal.createdAt",{ns:"appAnnotation"})," ",u(m,s("dateTimeFormat",{ns:"appLog"}))]})]}):void 0})})}),aB=i.memo(a=>{let{appDetail:b}=a,{t:c}=(0,j.useTranslation)(),[d,e]=(0,i.useState)(!1),[f,h]=(0,i.useState)(null),[A]=(0,i.useState)(b.mode!==w.AppModeEnum.COMPLETION),[C,D]=(0,i.useState)(()=>Date.now()),{plan:F,enableBilling:G}=(0,u.useProviderContext)(),H=G&&F.usage.annotatedResponse>=F.total.annotatedResponse,[I,J]=(0,i.useState)(!1),[K,L]=(0,i.useState)({}),[M,N]=(0,i.useState)(0),[O,P]=(0,i.useState)(t.APP_PAGE_LIMIT),[Q,R]=(0,i.useState)([]),[S,T]=(0,i.useState)(0),[U,V]=(0,i.useState)(!1),[W,X]=(0,i.useState)(()=>Date.now()),[Y,Z]=(0,i.useState)(null),[$,_]=(0,i.useState)(!1),[aa,ab]=(0,i.useState)([]),ac=(0,l.useDebounce)(K,{wait:500}),ad=async()=>{let a=await (0,v.fetchAnnotationConfig)(b.id);return h(a),a.id};(0,i.useEffect)(()=>{A&&ad()},[]);let ae=async(a,c)=>{for(;(await (0,v.queryAnnotationJobStatus)(b.id,c,a)).job_status!==as.JobStatus.completed;)await (0,x.sleep)(2e3)},af=async(a=1)=>{V(!0);try{let{data:c,total:d}=await (0,v.fetchAnnotationList)(b.id,{page:a,limit:O,keyword:ac.keyword||""});R(c),T(d)}finally{V(!1)}};(0,i.useEffect)(()=>{af(M+1)},[M,O,ac]);let ag=async a=>{await (0,v.addAnnotation)(b.id,a),z.default.notify({message:c("api.actionSuccess",{ns:"common"}),type:"success"}),af(),X(Date.now())},ah=async a=>{await (0,v.delAnnotation)(b.id,a),z.default.notify({message:c("api.actionSuccess",{ns:"common"}),type:"success"}),af(),X(Date.now())},ai=async()=>{try{await (0,v.delAnnotations)(b.id,aa),z.default.notify({message:c("api.actionSuccess",{ns:"common"}),type:"success"}),af(),X(Date.now()),ab([])}catch(a){z.default.notify({type:"error",message:a.message||c("api.actionFailed",{ns:"common"})})}},aj=async(a,d)=>{Y&&(await (0,v.editAnnotation)(b.id,Y.id,{question:a,answer:d}),z.default.notify({message:c("api.actionSuccess",{ns:"common"}),type:"success"}),af(),X(Date.now()))};return(0,i.useEffect)(()=>{d||D(Date.now())},[d]),(0,g.jsxs)("div",{className:"flex h-full flex-col",children:[(0,g.jsx)("p",{className:"system-sm-regular text-text-tertiary",children:c("description",{ns:"appLog"})}),(0,g.jsxs)("div",{className:"relative flex h-full flex-1 flex-col py-4",children:[(0,g.jsx)(E,{appId:b.id,queryParams:K,setQueryParams:L,children:(0,g.jsxs)("div",{className:"flex items-center space-x-2",children:[A&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("div",{className:(0,y.cn)(!f?.enabled&&"pr-2","flex h-7 items-center space-x-1 rounded-lg border border-components-panel-border bg-components-panel-bg-blur pl-2"),children:[(0,g.jsx)(o.default,{className:"h-4 w-4 text-util-colors-indigo-indigo-600"}),(0,g.jsx)("div",{className:"system-sm-medium text-text-primary",children:c("name",{ns:"appAnnotation"})}),(0,g.jsx)(r.default,{defaultValue:f?.enabled,size:"md",onChange:async a=>{if(a){if(H){J(!0),D(Date.now());return}e(!0)}else{let{job_id:a}=await (0,v.updateAnnotationStatus)(b.id,as.AnnotationEnableStatus.disable,f?.embedding_model,f?.score_threshold);await ae(a,as.AnnotationEnableStatus.disable),await ad(),z.default.notify({message:c("api.actionSuccess",{ns:"common"}),type:"success"})}}},C),f?.enabled&&(0,g.jsxs)("div",{className:"flex items-center pl-1.5",children:[(0,g.jsx)("div",{className:"mr-1 h-3.5 w-[1px] shrink-0 bg-divider-subtle"}),(0,g.jsx)(m.default,{onClick:()=>e(!0),children:(0,g.jsx)(k.RiEqualizer2Line,{className:"h-4 w-4 text-text-tertiary"})})]})]}),(0,g.jsx)("div",{className:"mx-3 h-3.5 w-[1px] shrink-0 bg-divider-regular"})]}),(0,g.jsx)(al,{appId:b.id,controlUpdateList:W,onAdd:ag,onAdded:()=>{af()}})]})}),U?(0,g.jsx)(p.default,{type:"app"}):S>0?(0,g.jsx)(ar,{list:Q,onRemove:ah,onView:a=>{Z(a),_(!0)},selectedIds:aa,onSelectedIdsChange:ab,onBatchDelete:ai,onCancel:()=>ab([])}):(0,g.jsx)("div",{className:"flex h-full grow items-center justify-center",children:(0,g.jsx)(B,{})}),S&&S>t.APP_PAGE_LIMIT?(0,g.jsx)(q.default,{current:M,onChange:N,total:S,limit:O,onLimitChange:P}):null,$&&(0,g.jsx)(aA,{appId:b.id,isShow:$,onHide:()=>_(!1),onRemove:async()=>{await ah(Y?.id)},item:Y,onSave:aj}),d&&(0,g.jsx)(n.default,{appId:b.id,isShow:!0,isInit:!f?.enabled,onHide:()=>{e(!1)},onSave:async(a,d)=>{if(a.embedding_model_name!==f?.embedding_model?.embedding_model_name||a.embedding_provider_name!==f?.embedding_model?.embedding_provider_name){let{job_id:c}=await (0,v.updateAnnotationStatus)(b.id,as.AnnotationEnableStatus.enable,a,d);await ae(c,as.AnnotationEnableStatus.enable)}let g=await ad();d!==f?.score_threshold&&await (0,v.updateAnnotationScore)(b.id,g,d),await ad(),z.default.notify({message:c("api.actionSuccess",{ns:"common"}),type:"success"}),e(!1)},annotationConfig:f}),I&&(0,g.jsx)(s.default,{show:I,onHide:()=>J(!1)})]})]})});var aC=a.i(435133);function aD(a,b){let c={...a};for(let a=0;a<b.length;a++){let d=b[a];delete c[d]}return c}var aE=a.i(413192),aF=a.i(578652),aG=a.i(297392),aH=a.i(499257);let aI=({className:a})=>(0,g.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:a??"",children:(0,g.jsx)("path",{d:"M5 6.5V5M8.93934 7.56066L10 6.5M10.0103 11.5H11.5103",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),aJ=i.memo(({appDetail:a})=>{var b;let{t:c}=(0,j.useTranslation)();return(0,g.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,g.jsxs)("div",{className:"box-border h-fit w-[560px] rounded-2xl bg-background-section-burn px-5 py-4",children:[(0,g.jsxs)("span",{className:"system-md-semibold text-text-secondary",children:[c("table.empty.element.title",{ns:"appLog"}),(0,g.jsx)(aI,{className:"relative -left-1.5 -top-3 inline text-text-secondary"})]}),(0,g.jsx)("div",{className:"system-sm-regular mt-2 text-text-tertiary",children:(0,g.jsx)(aF.Trans,{i18nKey:"table.empty.element.content",ns:"appLog",components:{shareLink:(0,g.jsx)(aE.default,{href:`${a.site.app_base_url}${aH.basePath}/${(b=a.mode)!==w.AppModeEnum.COMPLETION&&b!==w.AppModeEnum.WORKFLOW?w.AppModeEnum.CHAT:b}/${a.site.access_token}`,className:"text-util-colors-blue-blue-600",target:"_blank",rel:"noopener noreferrer"}),testLink:(0,g.jsx)(aE.default,{href:(0,aG.getRedirectionPath)(!0,a),className:"text-util-colors-blue-blue-600"})}})})]})})});var aK=a.i(697525);let aL=i.forwardRef(function({title:a,titleId:b,...c},d){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:d,"aria-labelledby":b},c),a?i.createElement("title",{id:b},a):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.498 15.25H4.372c-1.026 0-1.945-.694-2.054-1.715a12.137 12.137 0 0 1-.068-1.285c0-2.848.992-5.464 2.649-7.521C5.287 4.247 5.886 4 6.504 4h4.016a4.5 4.5 0 0 1 1.423.23l3.114 1.04a4.5 4.5 0 0 0 1.423.23h1.294M7.498 15.25c.618 0 .991.724.725 1.282A7.471 7.471 0 0 0 7.5 19.75 2.25 2.25 0 0 0 9.75 22a.75.75 0 0 0 .75-.75v-.633c0-.573.11-1.14.322-1.672.304-.76.93-1.33 1.653-1.715a9.04 9.04 0 0 0 2.86-2.4c.498-.634 1.226-1.08 2.032-1.08h.384m-10.253 1.5H9.7m8.075-9.75c.01.05.027.1.05.148.593 1.2.925 2.55.925 3.977 0 1.487-.36 2.89-.999 4.125m.023-8.25c-.076-.365.183-.75.575-.75h.908c.889 0 1.713.518 1.972 1.368.339 1.11.521 2.287.521 3.507 0 1.553-.295 3.036-.831 4.398-.306.774-1.086 1.227-1.918 1.227h-1.053c-.472 0-.745-.556-.5-.96a8.95 8.95 0 0 0 .303-.54"}))}),aM=i.forwardRef(function({title:a,titleId:b,...c},d){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:d,"aria-labelledby":b},c),a?i.createElement("title",{id:b},a):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.633 10.25c.806 0 1.533-.446 2.031-1.08a9.041 9.041 0 0 1 2.861-2.4c.723-.384 1.35-.956 1.653-1.715a4.498 4.498 0 0 0 .322-1.672V2.75a.75.75 0 0 1 .75-.75 2.25 2.25 0 0 1 2.25 2.25c0 1.152-.26 2.243-.723 3.218-.266.558.107 1.282.725 1.282m0 0h3.126c1.026 0 1.945.694 2.054 1.715.045.422.068.85.068 1.285a11.95 11.95 0 0 1-2.649 7.521c-.388.482-.987.729-1.605.729H13.48c-.483 0-.964-.078-1.423-.23l-3.114-1.04a4.501 4.501 0 0 0-1.423-.23H5.904m10.598-9.75H14.25M5.904 18.5c.083.205.173.405.27.602.197.4-.078.898-.523.898h-.908c-.889 0-1.713-.518-1.972-1.368a12 12 0 0 1-.521-3.507c0-1.553.295-3.036.831-4.398C3.387 9.953 4.167 9.5 5 9.5h1.053c.472 0 .745.556.5.96a8.958 8.958 0 0 0-1.302 4.665c0 1.194.232 2.333.654 3.375Z"}))});var aN=a.i(971335),aO=a.i(127406),aP=a.i(516793),aQ=a.i(388206),aR=a.i(825319),aS=a.i(701458),aT=a.i(912626),aU=a.i(34976);let aV={temperature:"Temperature",top_p:"Top P",presence_penalty:"Presence Penalty",max_tokens:"Max Token",stop:"Stop",frequency_penalty:"Frequency Penalty"},aW=i.memo(({model:a})=>{let{t:b}=(0,j.useTranslation)(),c=a.name,d=a.provider,{currentModel:e,currentProvider:f}=(0,aS.useTextGenerationCurrentProviderAndModelAndModelList)({provider:d,model:c}),[h,l]=i.useState(!1);return(0,g.jsxs)("div",{className:(0,y.cn)("flex items-center rounded-lg"),children:[(0,g.jsxs)("div",{className:"mr-px flex h-8 shrink-0 items-center gap-1 rounded-l-lg bg-components-input-bg-normal pl-1.5 pr-2",children:[(0,g.jsx)(aT.default,{className:"!h-5 !w-5",provider:f,modelName:e?.model}),(0,g.jsx)(aU.default,{modelItem:e,showMode:!0})]}),(0,g.jsx)(aR.PortalToFollowElem,{open:h,onOpenChange:l,placement:"bottom-end",offset:4,children:(0,g.jsxs)("div",{className:"relative",children:[(0,g.jsx)(aR.PortalToFollowElemTrigger,{onClick:()=>l(a=>!a),className:"block",children:(0,g.jsx)("div",{className:(0,y.cn)("cursor-pointer rounded-r-lg bg-components-button-tertiary-bg p-2 hover:bg-components-button-tertiary-bg-hover",h&&"bg-components-button-tertiary-bg-hover"),children:(0,g.jsx)(k.RiInformation2Line,{className:"h-4 w-4 text-text-tertiary"})})}),(0,g.jsx)(aR.PortalToFollowElemContent,{className:"z-[1002]",children:(0,g.jsxs)("div",{className:"relative w-[280px] overflow-hidden rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg px-4 pb-2 pt-3 shadow-xl",children:[(0,g.jsx)("div",{className:"system-sm-semibold-uppercase mb-1 h-6 text-text-secondary",children:b("detail.modelParams",{ns:"appLog"})}),(0,g.jsx)("div",{className:"py-1",children:["temperature","top_p","presence_penalty","max_tokens","stop"].map((b,c)=>(0,g.jsxs)("div",{className:"flex justify-between py-1.5",children:[(0,g.jsx)("span",{className:"system-xs-medium-uppercase text-text-tertiary",children:aV[b]}),(0,g.jsx)("span",{className:"system-xs-medium-uppercase text-text-secondary",children:(b=>{let c=a.completion_params?.[b]||"-";if("stop"===b)if(Array.isArray(c))return c.join(",");else return"-";return c})(b)})]},c))})]})})]})})]})});var aX=a.i(243103),aY=a.i(460171),aZ=a.i(992602),a$=a.i(546107),a_=a.i(284057),a0=a.i(134579),a1=a.i(547252),a2=a.i(483664);let a3="overview.appInfo.embedded",a4=({content:a})=>{let{t:b}=(0,j.useTranslation)(),{copied:c,copy:d,reset:e}=(0,a_.useClipboard)(),f=(0,i.useCallback)(()=>{d(a)},[d,a]);return(0,g.jsx)(a2.default,{popupContent:b(c?`${a3}.copied`:`${a3}.copy`,{ns:"appOverview"})||"",children:(0,g.jsx)("div",{onMouseLeave:e,children:c?(0,g.jsx)(a1.CopyCheck,{className:"mx-1 h-3.5 w-3.5 text-text-tertiary"}):(0,g.jsx)(a0.Copy,{className:"mx-1 h-3.5 w-3.5 cursor-pointer text-text-tertiary",onClick:f})})})};var a5=a.i(632789),a6=a.i(818386),a7=a.i(617633),a8=a.i(735310),a9=a.i(622191);a.i(412708);var ba=a.i(851571),bb=a.i(267915);a.i(3626);var bc=a.i(236431),bd=a.i(189583),be=a.i(373178),bf=a.i(787405),bg=a.i(471430);let bh=({isRunning:a,outputs:b,error:c,height:d})=>{let e=(0,i.useMemo)(()=>{if(!b||"object"!=typeof b)return!1;let a=Object.keys(b),c=b[a[0]];return 1===a.length&&("string"==typeof c||Array.isArray(c)&&c.every(a=>"string"==typeof a))},[b]),f=(0,i.useMemo)(()=>{let a=[];if(!b||Object.keys(b).length>1)return a;for(let c in b)Array.isArray(b[c])?b[c].map(b=>(b?.dify_model_identity==="__dify__file__"&&a.push(b),null)):b[c]?.dify_model_identity==="__dify__file__"&&a.push(b[c]);return(0,a6.getProcessedFilesFromResponse)(a)},[b]);return(0,g.jsxs)("div",{className:"p-2",children:[a&&(0,g.jsx)("div",{className:"pl-[26px] pt-4",children:(0,g.jsx)(bb.default,{type:"text"})}),!a&&c&&(0,g.jsx)("div",{className:"px-4",children:(0,g.jsx)(bg.default,{status:"failed",children:c})}),!a&&!b&&(0,g.jsx)("div",{className:"px-4 py-2",children:(0,g.jsx)(bd.Markdown,{content:"No Output"})}),e&&(0,g.jsx)("div",{className:"px-4 py-2",children:(0,g.jsx)(bd.Markdown,{content:Array.isArray(b[Object.keys(b)[0]])?b[Object.keys(b)[0]].join("\n"):b[Object.keys(b)[0]]||""})}),f.length>0&&(0,g.jsx)("div",{className:"px-4 py-2",children:(0,g.jsx)(bc.FileList,{files:f,showDeleteAction:!1,showDownloadAction:!0,canPreview:!0})}),!e&&b&&Object.keys(b).length>0&&d>0&&(0,g.jsx)("div",{className:"flex flex-col gap-2",children:(0,g.jsx)(be.default,{showFileList:!0,readOnly:!0,title:(0,g.jsx)("div",{tabIndex:0,children:"Output"}),language:bf.CodeLanguage.json,value:JSON.stringify(b,null,2),isJSONStringifyBeauty:!0,height:d?(d-16)/2:void 0})})]})};var bi=a.i(41252),bj=a.i(785918),bk=a.i(813027);let bl=({hideResult:a,activeTab:b="RESULT",getResultCallback:c,runDetailUrl:d,tracingListUrl:e})=>{let{t:f}=(0,j.useTranslation)(),{notify:h}=(0,ad.useContext)(z.ToastContext),[k,l]=(0,i.useState)(b),[m,n]=(0,i.useState)(!0),[o,q]=(0,i.useState)(),[r,s]=(0,i.useState)([]),t=(0,ba.useStore)(a=>a.isListening),u=(0,i.useMemo)(()=>o?.created_by_role==="account"?o.created_by_account?.name||"":o?.created_by_role==="end_user"?o.created_by_end_user?.session_id||"":"N/A",[o]),v=(0,i.useCallback)(async()=>{try{let a=await (0,a9.fetchRunDetail)(d);q(a),c&&c(a)}catch(a){h({type:"error",message:`${a}`})}},[h,c,d]),w=(0,i.useCallback)(async()=>{try{let{data:a}=await (0,a9.fetchTracingList)({url:e});s(a)}catch(a){h({type:"error",message:`${a}`})}},[h,e]),x=(0,i.useCallback)(async()=>{n(!0),await v(),await w(),n(!1)},[v,w]),A=async a=>{l(a),"RESULT"===a&&d&&await v(),e&&await w()};(0,i.useEffect)(()=>{t&&l("DETAIL")},[t]),(0,i.useEffect)(()=>{d&&e&&x()},[d,e]);let[B,C]=(0,i.useState)(0),D=(0,i.useRef)(null);return(0,i.useEffect)(()=>{D.current&&C(D.current?.clientHeight-16-16-2-1)},[m]),(0,g.jsxs)("div",{className:"relative flex grow flex-col",children:[(0,g.jsxs)("div",{className:"flex shrink-0 items-center border-b-[0.5px] border-divider-subtle px-4",children:[!a&&(0,g.jsx)("div",{className:(0,y.cn)("system-sm-semibold-uppercase mr-6 cursor-pointer border-b-2 border-transparent py-3 text-text-tertiary","RESULT"===k&&"!border-util-colors-blue-brand-blue-brand-600 text-text-primary"),onClick:()=>A("RESULT"),children:f("result",{ns:"runLog"})}),(0,g.jsx)("div",{className:(0,y.cn)("system-sm-semibold-uppercase mr-6 cursor-pointer border-b-2 border-transparent py-3 text-text-tertiary","DETAIL"===k&&"!border-util-colors-blue-brand-blue-brand-600 text-text-primary"),onClick:()=>A("DETAIL"),children:f("detail",{ns:"runLog"})}),(0,g.jsx)("div",{className:(0,y.cn)("system-sm-semibold-uppercase mr-6 cursor-pointer border-b-2 border-transparent py-3 text-text-tertiary","TRACING"===k&&"!border-util-colors-blue-brand-blue-brand-600 text-text-primary"),onClick:()=>A("TRACING"),children:f("tracing",{ns:"runLog"})})]}),(0,g.jsxs)("div",{ref:D,className:(0,y.cn)("relative h-0 grow overflow-y-auto rounded-b-xl bg-components-panel-bg"),children:[m&&(0,g.jsx)("div",{className:"flex h-full items-center justify-center bg-components-panel-bg",children:(0,g.jsx)(p.default,{})}),!m&&"RESULT"===k&&o&&(0,g.jsx)(bh,{outputs:o.outputs,error:o.error,height:B}),!m&&"DETAIL"===k&&o&&(0,g.jsx)(bi.default,{inputs:o.inputs,inputs_truncated:o.inputs_truncated,outputs:o.outputs,outputs_truncated:o.outputs_truncated,outputs_full_content:o.outputs_full_content,status:o.status,error:o.error,elapsed_time:o.elapsed_time,total_tokens:o.total_tokens,created_at:o.created_at,created_by:u,steps:o.total_steps,exceptionCounts:o.exceptions_count,isListening:t}),!m&&"DETAIL"===k&&!o&&t&&(0,g.jsx)(bj.default,{status:a8.WorkflowRunningStatus.Running,isListening:!0}),!m&&"TRACING"===k&&(0,g.jsx)(bk.default,{className:"bg-background-section-burn",list:r})]})]})},bm=({currentLogItem:a,defaultTab:b="DETAIL",width:c,fixedWidth:d,onCancel:e})=>{let{t:f}=(0,j.useTranslation)(),h=(0,i.useRef)(null),[l,m]=(0,i.useState)(!1),n=(0,aX.useStore)(a=>a.appDetail);return((0,a7.useClickAway)(()=>{l&&e()},h),(0,i.useEffect)(()=>{m(!0)},[]),a&&a.workflow_run_id)?(0,g.jsxs)("div",{className:(0,y.cn)("relative z-10 flex flex-col rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg pt-3 shadow-xl"),style:{width:d?c:480,...!d?{position:"fixed",top:64,left:8+(c-480),bottom:16}:{marginRight:8}},ref:h,children:[(0,g.jsx)("h1",{className:"system-xl-semibold shrink-0 px-4 py-1 text-text-primary",children:f("runDetail.title",{ns:"appLog"})}),(0,g.jsx)("span",{className:"absolute right-3 top-4 z-20 cursor-pointer p-1",onClick:e,children:(0,g.jsx)(k.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})}),(0,g.jsx)(bl,{hideResult:!0,activeTab:b,runDetailUrl:`/apps/${n?.id}/workflow-runs/${a.workflow_run_id}`,tracingListUrl:`/apps/${n?.id}/workflow-runs/${a.workflow_run_id}/node-executions`})]}):null};var bn=a.i(858877),bo=a.i(547904),bp=a.i(705134),bq=a.i(585124),br=a.i(692520),bs=a.i(183107),bt=a.i(854867);a.i(805980);var bu=a.i(634919),bv=a.i(530007);let bw=i.memo(({varList:a,message_files:b})=>{let{t:c}=(0,j.useTranslation)(),[d,{toggle:e}]=(0,an.useBoolean)(!1),[f,h]=(0,i.useState)("");return(0,g.jsxs)("div",{className:"rounded-[10px] border border-divider-subtle bg-chat-bubble-bg",children:[(0,g.jsxs)("div",{className:(0,y.cn)("flex cursor-pointer items-center gap-1 border-b border-divider-subtle px-3 pb-2 pt-2.5 text-text-secondary",d&&"border-0 pb-2.5"),onClick:e,children:[(0,g.jsx)(bu.Variable02,{className:"h-4 w-4"}),(0,g.jsx)("div",{className:"system-md-medium grow",children:c("detail.variables",{ns:"appLog"})}),d?(0,g.jsx)(k.RiArrowRightSLine,{className:"h-4 w-4"}):(0,g.jsx)(k.RiArrowDownSLine,{className:"h-4 w-4"})]}),!d&&(0,g.jsxs)("div",{className:"flex max-h-[500px] flex-col gap-2 overflow-y-auto p-3",children:[a.map(({label:a,value:b},c)=>(0,g.jsxs)("div",{className:"system-xs-medium flex py-2",children:[(0,g.jsxs)("div",{className:"flex w-[128px] shrink-0 text-text-accent",children:[(0,g.jsx)("span",{className:"shrink-0 opacity-60",children:"{{"}),(0,g.jsx)("span",{className:"truncate",children:a}),(0,g.jsx)("span",{className:"shrink-0 opacity-60",children:"}}"})]}),(0,g.jsx)("div",{className:"whitespace-pre-wrap pl-2.5 text-text-secondary",children:b})]},c)),b.length>0&&(0,g.jsxs)("div",{className:"mt-1 flex py-2",children:[(0,g.jsx)("div",{className:"system-xs-medium w-[128px] shrink-0 text-text-tertiary",children:c("detail.uploadImages",{ns:"appLog"})}),(0,g.jsx)("div",{className:"flex space-x-2",children:b.map((a,b)=>(0,g.jsx)("div",{className:"ml-2.5 h-16 w-16 cursor-pointer rounded-lg bg-cover bg-center bg-no-repeat",style:{backgroundImage:`url(${a})`},onClick:()=>h(a)},b))})]})]}),f&&(0,g.jsx)(bv.default,{url:f,title:f,onCancel:()=>h("")})]})});aC.default.extend(aO.default),aC.default.extend(aN.default);let bx=(0,ad.createContext)({}),by=({count:a,iconType:b})=>(0,g.jsxs)("div",{className:`inline-flex w-fit items-center rounded-md p-1 text-xs ${"up"===b?"text-primary-600 bg-primary-50":"text-red-600 bg-red-50"} mr-1 last:mr-0`,children:[(0,g.jsx)("up"===b?aM:aL,{className:"mr-0.5 h-3 w-3 rounded-md"}),a>0?a:null]}),bz=(a,b,c,d)=>{let e=[];try{return a.forEach(a=>{let f=a.message_files?.filter(a=>"user"===a.belongs_to)||[];e.push({id:`question-${a.id}`,content:a.inputs.query||a.inputs.default_input||a.query,isAnswer:!1,message_files:(0,a6.getProcessedFilesFromResponse)(f.map(a=>({...a,related_id:a.id}))),parentMessageId:a.parent_message_id||void 0});let g=a.message_files?.filter(a=>"assistant"===a.belongs_to)||[];e.push({id:a.id,content:a.answer,agent_thoughts:(0,bn.addFileInfos)(a.agent_thoughts?(0,bn.sortAgentSorts)(a.agent_thoughts):a.agent_thoughts,a.message_files),feedback:a.feedbacks?.find(a=>"user"===a.from_source),adminFeedback:a.feedbacks?.find(a=>"admin"===a.from_source),feedbackDisabled:!1,isAnswer:!0,message_files:(0,a6.getProcessedFilesFromResponse)(g.map(a=>({...a,related_id:a.id}))),log:[...a.message??[],...a.message?.[a.message.length-1]?.role!=="assistant"?[{role:"assistant",text:a.answer,files:a.message_files?.filter(a=>"assistant"===a.belongs_to)||[]}]:[]],workflow_run_id:a.workflow_run_id,conversationId:b,input:{inputs:a.inputs,query:a.query},more:{time:aC.default.unix(a.created_at).tz(c).format(d),tokens:a.answer_tokens+a.message_tokens,latency:(a.provider_response_latency??0).toFixed(2)},citation:a.metadata?.retriever_resources,annotation:a.annotation_hit_history?{id:a.annotation_hit_history.annotation_id,authorName:a.annotation_hit_history.annotation_create_account?.name||"N/A",created_at:a.annotation_hit_history.created_at}:a.annotation?{id:a.annotation.id,authorName:a.annotation.account.name,logAnnotation:a.annotation,created_at:0}:void 0,parentMessageId:`question-${a.id}`})}),e}catch(a){throw console.error("getFormattedChatList processing failed:",a),a}};function bA({detail:b,onFeedback:c}){let{userProfile:{timezone:d}}=(0,bp.useAppContext)(),{formatTime:e}=(0,am.default)(),{onClose:f,appDetail:h}=(0,ad.useContext)(bx),{notify:l}=(0,ad.useContext)(z.ToastContext),{currentLogItem:n,setCurrentLogItem:o,showMessageLogModal:p,setShowMessageLogModal:q,showPromptLogModal:r,setShowPromptLogModal:s,currentLogModalActiveTab:t}=(0,aX.useStore)((0,aQ.useShallow)(a=>({currentLogItem:a.currentLogItem,setCurrentLogItem:a.setCurrentLogItem,showMessageLogModal:a.showMessageLogModal,setShowMessageLogModal:a.setShowMessageLogModal,showPromptLogModal:a.showPromptLogModal,setShowPromptLogModal:a.setShowPromptLogModal,currentLogModalActiveTab:a.currentLogModalActiveTab}))),{t:u}=(0,j.useTranslation)(),[v,x]=(0,i.useState)(!0),[y,A]=(0,i.useState)({}),B=(0,i.useRef)(!1),C=(0,i.useRef)(null),D=(0,i.useRef)(0),E=(0,i.useRef)(0),F=(0,i.useRef)(0),G=(0,i.useRef)(void 0),[H,I]=(0,i.useState)([]),[J,K]=(0,i.useState)([]),[L,M]=(0,i.useState)([]),N=(0,i.useCallback)(async()=>{if(B.current||!v)return;C.current&&C.current.abort();let a=new AbortController;C.current=a;let c=++D.current;try{B.current=!0;let e={conversation_id:b.id,limit:10};G.current&&(e.first_id=G.current);let f=await (0,a9.fetchChatMessages)({url:`/apps/${h?.id}/chat-messages`,params:e});if(c!==D.current||a.signal.aborted)return;if(f.data.length>0){let a=f.data.at(-1).inputs;A(a)}x(f.has_more);let g=bz(f.data,b.id,d,u("dateTimeFormat",{ns:"appLog"}));I(a=>{let b=new Set(a.map(a=>a.id));return[...g.filter(a=>!b.has(a.id)),...a]})}catch(a){if(a instanceof Error&&"AbortError"===a.name)return;console.error("fetchData execution failed:",a)}finally{B.current=!1,C.current===a&&(C.current=null)}},[b.id,v,d,u,h,b?.model_config?.configs?.introduction]);(0,i.useEffect)(()=>{if(0===H.length)return;let a=(0,a$.buildChatItemTree)(H);!v&&b?.model_config?.configs?.introduction&&(a=[{id:"introduction",isAnswer:!0,isOpeningStatement:!0,content:b?.model_config?.configs?.introduction??"hello",feedbackDisabled:!0,children:a}]),K(a);let c=H.length>0?H[H.length-1].id:void 0;M((0,a$.getThreadMessages)(a,c));let d=H.filter(a=>a.isAnswer)[0];d?.id&&(G.current=d.id)},[H,v,b?.model_config?.configs?.introduction]);let O=(0,i.useCallback)(a=>{M((0,a$.getThreadMessages)(J,a))},[J]),P=(0,i.useCallback)((a,b,c)=>{I(H.map((d,e)=>e===c-1?{...d,content:a}:e===c?{...d,annotation:{...d.annotation,logAnnotation:{...d.annotation?.logAnnotation,content:b}}}:d))},[H]),Q=(0,i.useCallback)((a,b,c,d,e)=>{I(H.map((f,g)=>g===e-1?{...f,content:c}:g===e?{...f,content:f.content,annotation:{id:a,authorName:b,logAnnotation:{content:d,account:{id:"",name:b,email:""}}}}:f))},[H]),R=(0,i.useCallback)(async b=>{let c=H[b]?.annotation;try{if(c?.id){let{delAnnotation:b}=await a.A(989108);await b(h?.id||"",c.id)}return I(H.map((a,c)=>c===b?{...a,content:a.content,annotation:void 0}:a)),l({type:"success",message:u("actionMsg.modifiedSuccessfully",{ns:"common"})}),!0}catch{return l({type:"error",message:u("actionMsg.modifiedUnsuccessfully",{ns:"common"})}),!1}},[H,h?.id,u]),S=(0,i.useRef)(!1);(0,i.useEffect)(()=>{h?.id&&b.id&&h?.mode!==w.AppModeEnum.COMPLETION&&!S.current&&(S.current=!0,N())},[h?.id,b.id,h?.mode,N]);let[T,U]=(0,i.useState)(!1),V=(0,i.useCallback)(async()=>{if(T||!v||!h?.id||!b.id)return;let a=Date.now();if(!(a-E.current<200)){E.current=a,U(!0);try{let a={conversation_id:b.id,limit:10};G.current&&(a.first_id=G.current);let c=await (0,a9.fetchChatMessages)({url:`/apps/${h.id}/chat-messages`,params:a});if(!c.data||0===c.data.length){x(!1),F.current=0;return}if(c.data.length>0){let a=c.data.at(-1).inputs;A(a)}x(c.has_more);let e=bz(c.data,b.id,d,u("dateTimeFormat",{ns:"appLog"}));I(a=>{let b=new Set(a.map(a=>a.id)),c=e.filter(a=>!b.has(a.id));if(0===c.length)if(F.current<3&&a.length>1)return F.current++,a;else return F.current=0,a;return F.current=0,[...c,...a]})}catch(a){console.error(a),x(!1),F.current=0}finally{U(!1)}}},[b.id,v,T,d,u,h,b?.model_config?.configs?.introduction]),W=(0,i.useCallback)(()=>{let a=document.getElementById("scrollableDiv");if(!a)return;let b=a.clientHeight,c=a.scrollHeight;Math.abs(a.scrollTop)>c-b-40&&v&&!T&&V()},[v,T,V]),X=h?.mode!==w.AppModeEnum.COMPLETION,Y=h?.mode===w.AppModeEnum.ADVANCED_CHAT,$=b.model_config.user_input_form?.map(a=>{let c=a[Object.keys(a)[0]];return{label:c.variable,value:y[c.variable]||b.message?.inputs?.[c.variable]}})||[],_=!X&&b.message.message_files&&b.message.message_files.length>0?b.message.message_files.map(a=>a.url):[],[aa,ab]=(0,i.useState)(0),ac=(0,i.useRef)(null),ae=()=>{ac.current&&ab(document.body.clientWidth-(ac.current?.clientWidth+16)-8)};return(0,i.useEffect)(()=>{let a=requestAnimationFrame(ae);return()=>cancelAnimationFrame(a)},[]),(0,g.jsxs)("div",{ref:ac,className:"flex h-full flex-col rounded-xl border-[0.5px] border-components-panel-border",children:[(0,g.jsxs)("div",{className:"flex shrink-0 items-center gap-2 rounded-t-xl bg-components-panel-bg pb-2 pl-4 pr-3 pt-3",children:[(0,g.jsxs)("div",{className:"shrink-0",children:[(0,g.jsx)("div",{className:"system-xs-semibold-uppercase mb-0.5 text-text-primary",children:X?u("detail.conversationId",{ns:"appLog"}):u("detail.time",{ns:"appLog"})}),X&&(0,g.jsxs)("div",{className:"system-2xs-regular-uppercase flex items-center text-text-secondary",children:[(0,g.jsx)(a2.default,{popupContent:b.id,children:(0,g.jsx)("div",{className:"truncate",children:b.id})}),(0,g.jsx)(a4,{content:b.id})]}),!X&&(0,g.jsx)("div",{className:"system-2xs-regular-uppercase text-text-secondary",children:e(b.created_at,u("dateTimeFormat",{ns:"appLog"}))})]}),(0,g.jsx)("div",{className:"flex grow flex-wrap items-center justify-end gap-y-1",children:!Y&&(0,g.jsx)(aW,{model:b.model_config.model})}),(0,g.jsx)(m.default,{size:"l",onClick:f,children:(0,g.jsx)(k.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})})]}),(0,g.jsx)("div",{className:"shrink-0 px-1 pt-1",children:(0,g.jsx)("div",{className:"rounded-t-xl bg-background-section-burn p-3 pb-2",children:($.length>0||!X&&_.length>0)&&(0,g.jsx)(bw,{varList:$,message_files:_})})}),(0,g.jsx)("div",{className:"mx-1 mb-1 grow overflow-auto rounded-b-xl bg-background-section-burn",children:X?L.length<8?(0,g.jsx)("div",{className:"mb-4 pt-4",children:(0,g.jsx)(aZ.default,{config:{appId:h?.id,text_to_speech:{enabled:!0},questionEditEnable:!1,supportAnnotation:!0,annotation_reply:{enabled:!0},supportFeedback:!0},chatList:L,onAnnotationAdded:Q,onAnnotationEdited:P,onAnnotationRemoved:R,onFeedback:c,noChatInput:!0,showPromptLog:!0,hideProcessDetail:!0,chatContainerInnerClassName:"px-3",switchSibling:O})}):(0,g.jsxs)("div",{className:"py-4",id:"scrollableDiv",style:{display:"flex",flexDirection:"column-reverse",height:"100%",overflow:"auto"},onScroll:W,children:[(0,g.jsx)("div",{className:"flex w-full flex-col-reverse",style:{position:"relative"},children:(0,g.jsx)(aZ.default,{config:{appId:h?.id,text_to_speech:{enabled:!0},questionEditEnable:!1,supportAnnotation:!0,annotation_reply:{enabled:!0},supportFeedback:!0},chatList:L,onAnnotationAdded:Q,onAnnotationEdited:P,onAnnotationRemoved:R,onFeedback:c,noChatInput:!0,showPromptLog:!0,hideProcessDetail:!0,chatContainerInnerClassName:"px-3",switchSibling:O})}),v&&(0,g.jsx)("div",{className:"py-3 text-center",children:(0,g.jsxs)("div",{className:"system-xs-regular text-text-tertiary",children:[u("detail.loading",{ns:"appLog"}),"..."]})})]}):(0,g.jsxs)("div",{className:"px-6 py-4",children:[(0,g.jsxs)("div",{className:"flex h-[18px] items-center space-x-3",children:[(0,g.jsx)("div",{className:"system-xs-semibold-uppercase text-text-tertiary",children:u("table.header.output",{ns:"appLog"})}),(0,g.jsx)("div",{className:"h-px grow",style:{background:"linear-gradient(270deg, rgba(243, 244, 246, 0) 0%, rgb(243, 244, 246) 100%)"}})]}),(0,g.jsx)(aY.default,{appSourceType:br.AppSourceType.webApp,className:"mt-2",content:b.message.answer,messageId:b.message.id,isError:!1,onRetry:Z.noop,supportFeedback:!0,feedback:b.message.feedbacks.find(a=>"admin"===a.from_source),onFeedback:a=>c(b.message.id,a),isShowTextToSpeech:!0,siteInfo:null})]})}),p&&(0,g.jsx)(bo.WorkflowContextProvider,{children:(0,g.jsx)(bm,{width:aa,currentLogItem:n,onCancel:()=>{o(),q(!1)},defaultTab:t})}),!X&&r&&(0,g.jsx)(bs.default,{width:aa,currentLogItem:n,onCancel:()=>{o(),s(!1)}})]})}let bB=({appId:a,conversationId:b})=>{let{data:c,refetch:d}=(0,D.useCompletionConversationDetail)(a,b),{notify:e}=(0,ad.useContext)(z.ToastContext),{t:f}=(0,j.useTranslation)(),h=async(b,{rating:c,content:g})=>{try{return await (0,a9.updateLogMessageFeedbacks)({url:`/apps/${a}/feedbacks`,body:{message_id:b,rating:c,content:g??void 0}}),d(),e({type:"success",message:f("actionMsg.modifiedSuccessfully",{ns:"common"})}),!0}catch{return e({type:"error",message:f("actionMsg.modifiedUnsuccessfully",{ns:"common"})}),!1}},i=async(b,c)=>{try{return await (0,a9.updateLogMessageAnnotations)({url:`/apps/${a}/annotations`,body:{message_id:b,content:c}}),d(),e({type:"success",message:f("actionMsg.modifiedSuccessfully",{ns:"common"})}),!0}catch{return e({type:"error",message:f("actionMsg.modifiedUnsuccessfully",{ns:"common"})}),!1}};return c?(0,g.jsx)(bA,{detail:c,onFeedback:h,onSubmitAnnotation:i}):null},bC=({appId:a,conversationId:b})=>{let{data:c}=(0,D.useChatConversationDetail)(a,b),{notify:d}=(0,ad.useContext)(z.ToastContext),{t:e}=(0,j.useTranslation)(),f=async(b,{rating:c,content:f})=>{try{return await (0,a9.updateLogMessageFeedbacks)({url:`/apps/${a}/feedbacks`,body:{message_id:b,rating:c,content:f??void 0}}),d({type:"success",message:e("actionMsg.modifiedSuccessfully",{ns:"common"})}),!0}catch{return d({type:"error",message:e("actionMsg.modifiedUnsuccessfully",{ns:"common"})}),!1}},h=async(b,c)=>{try{return await (0,a9.updateLogMessageAnnotations)({url:`/apps/${a}/annotations`,body:{message_id:b,content:c}}),d({type:"success",message:e("actionMsg.modifiedSuccessfully",{ns:"common"})}),!0}catch{return d({type:"error",message:e("actionMsg.modifiedUnsuccessfully",{ns:"common"})}),!1}};return c?(0,g.jsx)(bA,{detail:c,onFeedback:f,onSubmitAnnotation:h}):null},bD=({logs:a,appDetail:b,onRefresh:c})=>{let{t:d}=(0,j.useTranslation)(),{formatTime:e}=(0,am.default)(),f=(0,h.useRouter)(),l=(0,h.usePathname)(),m=(0,h.useSearchParams)(),n=m.get("conversation_id")??void 0,o=(0,bq.default)()===bq.MediaType.mobile,[q,r]=(0,i.useState)(!1),[s,t]=(0,i.useState)(),u=(0,i.useRef)(null),v=(0,i.useRef)(null),x=(0,i.useRef)(void 0),z=b.mode!==w.AppModeEnum.COMPLETION,A=b.mode===w.AppModeEnum.ADVANCED_CHAT,{setShowPromptLogModal:B,setShowAgentLogModal:C,setShowMessageLogModal:D}=(0,aX.useStore)((0,aQ.useShallow)(a=>({setShowPromptLogModal:a.setShowPromptLogModal,setShowAgentLogModal:a.setShowAgentLogModal,setShowMessageLogModal:a.setShowMessageLogModal}))),E=n??v.current??s?.id,F=(0,i.useCallback)(a=>{let b=new URLSearchParams(m.toString());a?b.set("conversation_id",a):b.delete("conversation_id");let c=b.toString();return c?`${l}?${c}`:l},[l,m]),G=(0,i.useCallback)(a=>{if(n===a.id){q||r(!0),s&&s.id===a.id||t(a);return}v.current=a.id,x.current=a,q||r(!0),s?.id!==a.id&&t(void 0),f.push(F(a.id),{scroll:!1})},[F,n,s,f,q]),H=s?.id;(0,i.useEffect)(()=>{if(!n){if(v.current)return;(q||H)&&(r(!1),t(void 0)),u.current=null,x.current=void 0;return}if(u.current===n)return;v.current===n&&(v.current=null);let b=a?.data?.find(a=>a.id===n),c=b??x.current??{id:n,isPlaceholder:!0};q||r(!0),s&&s.id===n&&("created_at"in s||!b)||t(c),(x.current?.id===n||b)&&(x.current=void 0)},[n,s,z,a?.data,q]);let I=(0,i.useCallback)(()=>{c(),r(!1),t(void 0),B(!1),C(!1),D(!1),v.current=null,x.current=void 0,u.current=n??null,n&&f.replace(F(),{scroll:!1})},[F,n,c,f,C,D,B]),J=(a,b,c=!1,f)=>(0,g.jsx)(a2.default,{popupContent:(0,g.jsxs)("span",{className:"inline-flex items-center text-xs text-text-tertiary",children:[(0,g.jsx)(k.RiEditFill,{className:"mr-1 h-3 w-3"}),`${d("detail.annotationTip",{ns:"appLog",user:f?.account?.name})} ${e(f?.created_at||(0,aC.default)().unix(),"MM-DD hh:mm A")}`]}),popupClassName:c&&!z?"":"!hidden",children:(0,g.jsx)("div",{className:(0,y.cn)(b?"text-text-quaternary":"text-text-secondary",c?"bg-orange-100":"","system-sm-regular overflow-hidden text-ellipsis whitespace-nowrap"),children:a||"-"})});return a?(0,g.jsxs)("div",{className:"relative mt-2 grow overflow-x-auto",children:[(0,g.jsxs)("table",{className:(0,y.cn)("w-full min-w-[440px] border-collapse border-0"),children:[(0,g.jsx)("thead",{className:"system-xs-medium-uppercase text-text-tertiary",children:(0,g.jsxs)("tr",{children:[(0,g.jsx)("td",{className:"w-5 whitespace-nowrap rounded-l-lg bg-background-section-burn pl-2 pr-1"}),(0,g.jsx)("td",{className:"whitespace-nowrap bg-background-section-burn py-1.5 pl-3",children:z?d("table.header.summary",{ns:"appLog"}):d("table.header.input",{ns:"appLog"})}),(0,g.jsx)("td",{className:"whitespace-nowrap bg-background-section-burn py-1.5 pl-3",children:d("table.header.endUser",{ns:"appLog"})}),A&&(0,g.jsx)("td",{className:"whitespace-nowrap bg-background-section-burn py-1.5 pl-3",children:d("table.header.status",{ns:"appLog"})}),(0,g.jsx)("td",{className:"whitespace-nowrap bg-background-section-burn py-1.5 pl-3",children:z?d("table.header.messageCount",{ns:"appLog"}):d("table.header.output",{ns:"appLog"})}),(0,g.jsx)("td",{className:"whitespace-nowrap bg-background-section-burn py-1.5 pl-3",children:d("table.header.userRate",{ns:"appLog"})}),(0,g.jsx)("td",{className:"whitespace-nowrap bg-background-section-burn py-1.5 pl-3",children:d("table.header.adminRate",{ns:"appLog"})}),(0,g.jsx)("td",{className:"whitespace-nowrap bg-background-section-burn py-1.5 pl-3",children:d("table.header.updatedTime",{ns:"appLog"})}),(0,g.jsx)("td",{className:"whitespace-nowrap rounded-r-lg bg-background-section-burn py-1.5 pl-3",children:d("table.header.time",{ns:"appLog"})})]})}),(0,g.jsx)("tbody",{className:"system-sm-regular text-text-secondary",children:a.data.map(a=>{var b;let c=a.from_end_user_session_id||a.from_account_name,f=(0,aP.get)(a,z?"name":"message.inputs.query")||(z?"":(0,aP.get)(a,"message.query")||(0,aP.get)(a,"message.inputs.default_input"))||"",h=(0,aP.get)(a,z?"message_count":"message.answer");return(0,g.jsxs)("tr",{className:(0,y.cn)("cursor-pointer border-b border-divider-subtle hover:bg-background-default-hover",E!==a.id?"":"bg-background-default-hover"),onClick:()=>G(a),children:[(0,g.jsx)("td",{className:"h-4",children:!a.read_at&&(0,g.jsx)("div",{className:"flex items-center p-3 pr-0.5",children:(0,g.jsx)("span",{className:"inline-block h-1.5 w-1.5 rounded bg-util-colors-blue-blue-500"})})}),(0,g.jsx)("td",{className:"w-[160px] p-3 pr-2",style:{maxWidth:z?300:200},children:J(f||d("table.empty.noChat",{ns:"appLog"}),!f,z&&a.annotated)}),(0,g.jsx)("td",{className:"p-3 pr-2",children:J(c||"N/A",!c)}),A&&(0,g.jsx)("td",{className:"w-[160px] p-3 pr-2",style:{maxWidth:z?300:200},children:(b=a.status_count)?b.partial_success+b.failed===0?(0,g.jsxs)("div",{className:"system-xs-semibold-uppercase inline-flex items-center gap-1",children:[(0,g.jsx)(bt.default,{color:"green"}),(0,g.jsx)("span",{className:"text-util-colors-green-green-600",children:"Success"})]}):0===b.failed?(0,g.jsxs)("div",{className:"system-xs-semibold-uppercase inline-flex items-center gap-1",children:[(0,g.jsx)(bt.default,{color:"green"}),(0,g.jsx)("span",{className:"text-util-colors-green-green-600",children:"Partial Success"})]}):(0,g.jsxs)("div",{className:"system-xs-semibold-uppercase inline-flex items-center gap-1",children:[(0,g.jsx)(bt.default,{color:"red"}),(0,g.jsxs)("span",{className:"text-util-colors-red-red-600",children:[b.failed," ",`${b.failed>1?"Failures":"Failure"}`]})]}):null}),(0,g.jsx)("td",{className:"p-3 pr-2",style:{maxWidth:z?100:200},children:J(0===h?0:h||d("table.empty.noOutput",{ns:"appLog"}),!h,!z&&!!a.annotation?.content,a.annotation)}),(0,g.jsx)("td",{className:"p-3 pr-2",children:a.user_feedback_stats.like||a.user_feedback_stats.dislike?(0,g.jsxs)(g.Fragment,{children:[!!a.user_feedback_stats.like&&(0,g.jsx)(by,{iconType:"up",count:a.user_feedback_stats.like}),!!a.user_feedback_stats.dislike&&(0,g.jsx)(by,{iconType:"down",count:a.user_feedback_stats.dislike})]}):J("N/A",!0)}),(0,g.jsx)("td",{className:"p-3 pr-2",children:a.admin_feedback_stats.like||a.admin_feedback_stats.dislike?(0,g.jsxs)(g.Fragment,{children:[!!a.admin_feedback_stats.like&&(0,g.jsx)(by,{iconType:"up",count:a.admin_feedback_stats.like}),!!a.admin_feedback_stats.dislike&&(0,g.jsx)(by,{iconType:"down",count:a.admin_feedback_stats.dislike})]}):J("N/A",!0)}),(0,g.jsx)("td",{className:"w-[160px] p-3 pr-2",children:e(a.updated_at,d("dateTimeFormat",{ns:"appLog"}))}),(0,g.jsx)("td",{className:"w-[160px] p-3 pr-2",children:e(a.created_at,d("dateTimeFormat",{ns:"appLog"}))})]},a.id)})})]}),(0,g.jsx)(a5.default,{isOpen:q,onClose:I,mask:o,footer:null,panelClassName:"mt-16 mx-2 sm:mr-2 mb-4 !p-0 !max-w-[640px] rounded-xl bg-components-panel-bg",children:(0,g.jsx)(bx.Provider,{value:{onClose:I,appDetail:b},children:z?(0,g.jsx)(bC,{appId:b.id,conversationId:s?.id}):(0,g.jsx)(bB,{appId:b.id,conversationId:s?.id})})})]}):(0,g.jsx)(p.default,{})},bE={period:"2",annotation_status:"all",sort_by:"-created_at"},bF=new Map,bG=({appDetail:a})=>{let{t:b}=(0,j.useTranslation)(),c=(0,h.useRouter)(),d=(0,h.usePathname)(),e=(0,h.useSearchParams)(),f=(0,i.useCallback)(()=>{let a=Number.parseInt(e.get("page")||"1",10);return Number.isNaN(a)||a<1?0:a-1},[e]),k=bF.get(a.id),[m,n]=(0,i.useState)(k?.queryParams??bE),[o,r]=i.useState(()=>k?.currPage??f()),[s,u]=i.useState(k?.limit??t.APP_PAGE_LIMIT),v=(0,l.useDebounce)(m,{wait:500});(0,i.useEffect)(()=>{let a=f();r(b=>b===a?b:a)},[f]),(0,i.useEffect)(()=>{bF.set(a.id,{queryParams:m,currPage:o,limit:s})},[a.id,o,s,m]);let x=a.mode!==w.AppModeEnum.COMPLETION,y={page:o+1,limit:s,..."9"!==v.period?{start:(0,aC.default)().subtract(aK.TIME_PERIOD_MAPPING[v.period].value,"day").startOf("day").format("YYYY-MM-DD HH:mm"),end:(0,aC.default)().endOf("day").format("YYYY-MM-DD HH:mm")}:{},...x?{sort_by:v.sort_by}:{},...aD(v,["period"])},{data:z,refetch:A}=(0,D.useChatConversations)({appId:x?a.id:"",params:y}),{data:B,refetch:C}=(0,D.useCompletionConversations)({appId:x?"":a.id,params:y}),E=x?z?.total:B?.total,F=(0,i.useCallback)(a=>{r(0),n(a)},[]),G=(0,i.useCallback)(a=>{r(a);let b=new URLSearchParams(e.toString()),f=a+1;1===f?b.delete("page"):b.set("page",String(f));let g=b.toString();c.replace(g?`${d}?${g}`:d,{scroll:!1})},[d,c,e]);return(0,g.jsxs)("div",{className:"flex h-full grow flex-col",children:[(0,g.jsx)("p",{className:"system-sm-regular shrink-0 text-text-tertiary",children:b("description",{ns:"appLog"})}),(0,g.jsxs)("div",{className:"flex max-h-[calc(100%-16px)] flex-1 grow flex-col py-4",children:[(0,g.jsx)(aK.default,{isChatMode:x,appId:a.id,queryParams:m,setQueryParams:F}),void 0===E?(0,g.jsx)(p.default,{type:"app"}):E>0?(0,g.jsx)(bD,{logs:x?z:B,appDetail:a,onRefresh:x?A:C}):(0,g.jsx)(aJ,{appDetail:a}),E&&E>t.APP_PAGE_LIMIT?(0,g.jsx)(q.default,{current:o,onChange:G,total:E,limit:s,onLimitChange:u}):null]})]})};var bH=a.i(568743),bI=a.i(55282),bJ=a.i(430901);aC.default.extend(bH.default);let bK=(0,aC.default)(),bL={1:{value:0,name:"today"},2:{value:7,name:"last7days"},3:{value:28,name:"last4weeks"},4:{value:bK.diff(bK.subtract(3,"month"),"day"),name:"last3months"},5:{value:bK.diff(bK.subtract(12,"month"),"day"),name:"last12months"},6:{value:bK.diff(bK.startOf("month"),"day"),name:"monthToDate"},7:{value:bK.diff(bK.startOf("quarter"),"day"),name:"quarterToDate"},8:{value:bK.diff(bK.startOf("year"),"day"),name:"yearToDate"},9:{value:-1,name:"allTime"}},bM=({queryParams:a,setQueryParams:b})=>{let{t:c}=(0,j.useTranslation)();return(0,g.jsxs)("div",{className:"mb-2 flex flex-row flex-wrap gap-2",children:[(0,g.jsx)(bJ.default,{value:a.status||"all",onSelect:c=>{b({...a,status:c.value}),(0,bI.trackEvent)("workflow_log_filter_status_selected",{workflow_log_filter_status:c.value})},onClear:()=>b({...a,status:"all"}),items:[{value:"all",name:"All"},{value:"succeeded",name:"Success"},{value:"failed",name:"Fail"},{value:"stopped",name:"Stop"},{value:"partial-succeeded",name:"Partial Success"}]}),(0,g.jsx)(bJ.default,{className:"min-w-[150px]",panelClassName:"w-[270px]",leftIcon:(0,g.jsx)(k.RiCalendarLine,{className:"h-4 w-4 text-text-secondary"}),value:a.period,onSelect:c=>{b({...a,period:c.value})},onClear:()=>b({...a,period:"9"}),items:Object.entries(bL).map(([a,b])=>({value:a,name:c(`filter.period.${b.name}`,{ns:"appLog"})}))}),(0,g.jsx)(C.default,{wrapperClassName:"w-[200px]",showLeftIcon:!0,showClearIcon:!0,value:a.keyword??"",placeholder:c("operation.search",{ns:"common"}),onChange:c=>{b({...a,keyword:c.target.value})},onClear:()=>b({...a,keyword:""})})]})},bN=i.forwardRef(function({title:a,titleId:b,...c},d){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:d,"aria-labelledby":b},c),a?i.createElement("title",{id:b},a):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 13.5 12 21m0 0-7.5-7.5M12 21V3"}))}),bO=({runID:a,onClose:b,canReplay:c=!1})=>{let{t:d}=(0,j.useTranslation)(),e=(0,aX.useStore)(a=>a.appDetail),f=(0,h.useRouter)();return(0,g.jsxs)("div",{className:"relative flex grow flex-col pt-3",children:[(0,g.jsx)("span",{className:"absolute right-3 top-4 z-20 cursor-pointer p-1",onClick:b,children:(0,g.jsx)(k.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})}),(0,g.jsxs)("div",{className:"flex items-center bg-components-panel-bg",children:[(0,g.jsx)("h1",{className:"system-xl-semibold shrink-0 px-4 py-1 text-text-primary",children:d("runDetail.workflowTitle",{ns:"appLog"})}),c&&(0,g.jsx)(a2.default,{popupContent:d("runDetail.testWithParams",{ns:"appLog"}),popupClassName:"rounded-xl",children:(0,g.jsx)("button",{type:"button",className:"mr-1 flex h-6 w-6 items-center justify-center rounded-md hover:bg-state-base-hover","aria-label":d("runDetail.testWithParams",{ns:"appLog"}),onClick:()=>{e?.id&&f.push(`/app/${e.id}/workflow?replayRunId=${a}`)},children:(0,g.jsx)(k.RiPlayLargeLine,{className:"h-4 w-4 text-text-tertiary"})})})]}),(0,g.jsx)(bo.WorkflowContextProvider,{children:(0,g.jsx)(bl,{runDetailUrl:a?`/apps/${e?.id}/workflow-runs/${a}`:"",tracingListUrl:a?`/apps/${e?.id}/workflow-runs/${a}/node-executions`:""})})]})};a.i(275560);var bP=a.i(467661),bQ=a.i(215757),bR=a.i(488416),bS=a.i(240331),bT=a.i(829655),bU=a.i(438961),bV=a.i(730357),bW=((e={}).DEBUGGING="debugging",e.APP_RUN="app-run",e.RAG_PIPELINE_RUN="rag-pipeline-run",e.RAG_PIPELINE_DEBUGGING="rag-pipeline-debugging",e.WEBHOOK="webhook",e.SCHEDULE="schedule",e.PLUGIN="plugin",e);let bX=({triggeredFrom:a,className:b="",showText:c=!0,triggerMetadata:d})=>{let{t:e}=(0,j.useTranslation)(),{theme:f}=(0,bV.default)(),h=a===bW.PLUGIN&&d?.event_name?d.event_name:({debugging:e("triggerBy.debugging",{ns:"appLog"}),"app-run":e("triggerBy.appRun",{ns:"appLog"}),webhook:e("triggerBy.webhook",{ns:"appLog"}),schedule:e("triggerBy.schedule",{ns:"appLog"}),plugin:e("triggerBy.plugin",{ns:"appLog"}),"rag-pipeline-run":e("triggerBy.ragPipelineRun",{ns:"appLog"}),"rag-pipeline-debugging":e("triggerBy.ragPipelineDebugging",{ns:"appLog"})})[a]||a,i=((a,b,c)=>{switch(a){case"webhook":return(0,g.jsx)("div",{className:"rounded-lg border-[0.5px] border-divider-subtle bg-util-colors-blue-blue-500 p-1 shadow-md",children:(0,g.jsx)(bS.WebhookLine,{className:"h-4 w-4 text-text-primary-on-surface"})});case"schedule":return(0,g.jsx)("div",{className:"rounded-lg border-[0.5px] border-divider-subtle bg-util-colors-violet-violet-500 p-1 shadow-md",children:(0,g.jsx)(bR.Schedule,{className:"h-4 w-4 text-text-primary-on-surface"})});case"plugin":return((a,b)=>{if(!a)return null;let c=b===w.Theme.dark?a.icon_dark||a.icon:a.icon||a.icon_dark;return c?(0,g.jsx)(bU.default,{type:a8.BlockEnum.TriggerPlugin,size:"md",toolIcon:c}):null})(b,c)||(0,g.jsx)(bU.default,{type:a8.BlockEnum.TriggerPlugin,size:"md"});case"debugging":return(0,g.jsx)("div",{className:"rounded-lg border-[0.5px] border-divider-subtle bg-util-colors-blue-blue-500 p-1 shadow-md",children:(0,g.jsx)(bP.Code,{className:"h-4 w-4 text-text-primary-on-surface"})});case"rag-pipeline-run":case"rag-pipeline-debugging":return(0,g.jsx)("div",{className:"rounded-lg border-[0.5px] border-divider-subtle bg-util-colors-green-green-500 p-1 shadow-md",children:(0,g.jsx)(bQ.KnowledgeRetrieval,{className:"h-4 w-4 text-text-primary-on-surface"})});default:return(0,g.jsx)("div",{className:"rounded-lg border-[0.5px] border-divider-subtle bg-util-colors-blue-brand-blue-brand-500 p-1 shadow-md",children:(0,g.jsx)(bT.WindowCursor,{className:"h-4 w-4 text-text-primary-on-surface"})})}})(a,d,f);return(0,g.jsxs)("div",{className:`flex items-center gap-1.5 ${b}`,children:[(0,g.jsx)("div",{className:"flex items-center justify-center",children:i}),c&&(0,g.jsx)("span",{className:"system-sm-regular text-text-secondary",children:h})]})},bY=({logs:a,appDetail:b,onRefresh:c})=>{let{t:d}=(0,j.useTranslation)(),{formatTime:e}=(0,am.default)(),f=(0,bq.default)()===bq.MediaType.mobile,[h,k]=(0,i.useState)(!1),[l,m]=(0,i.useState)(),[n,o]=(0,i.useState)("desc"),[q,r]=(0,i.useState)(a?.data||[]);(0,i.useEffect)(()=>{a?.data?r([...a.data].sort((a,b)=>{let c=a.created_at-b.created_at;return"asc"===n?c:-c})):r([])},[a?.data,n]);let s=b?.mode===w.AppModeEnum.WORKFLOW,t=()=>{c(),k(!1),m(void 0)};return a&&b?(0,g.jsxs)("div",{className:"overflow-x-auto",children:[(0,g.jsxs)("table",{className:(0,y.cn)("mt-2 w-full min-w-[440px] border-collapse border-0"),children:[(0,g.jsx)("thead",{className:"system-xs-medium-uppercase text-text-tertiary",children:(0,g.jsxs)("tr",{children:[(0,g.jsx)("td",{className:"w-5 whitespace-nowrap rounded-l-lg bg-background-section-burn pl-2 pr-1"}),(0,g.jsx)("td",{className:"whitespace-nowrap bg-background-section-burn py-1.5 pl-3",children:(0,g.jsxs)("div",{className:"flex cursor-pointer items-center hover:text-text-secondary",onClick:()=>{o("asc"===n?"desc":"asc")},children:[d("table.header.startTime",{ns:"appLog"}),(0,g.jsx)(bN,{className:(0,y.cn)("ml-0.5 h-3 w-3 stroke-current stroke-2 transition-all","text-text-tertiary","asc"===n?"rotate-180":"")})]})}),(0,g.jsx)("td",{className:"whitespace-nowrap bg-background-section-burn py-1.5 pl-3",children:d("table.header.status",{ns:"appLog"})}),(0,g.jsx)("td",{className:"whitespace-nowrap bg-background-section-burn py-1.5 pl-3",children:d("table.header.runtime",{ns:"appLog"})}),(0,g.jsx)("td",{className:"whitespace-nowrap bg-background-section-burn py-1.5 pl-3",children:d("table.header.tokens",{ns:"appLog"})}),(0,g.jsx)("td",{className:(0,y.cn)("whitespace-nowrap bg-background-section-burn py-1.5 pl-3",s?"":"rounded-r-lg"),children:d("table.header.user",{ns:"appLog"})}),s&&(0,g.jsx)("td",{className:"whitespace-nowrap rounded-r-lg bg-background-section-burn py-1.5 pl-3",children:d("table.header.triggered_from",{ns:"appLog"})})]})}),(0,g.jsx)("tbody",{className:"system-sm-regular text-text-secondary",children:q.map(a=>{var b;let c=a.created_by_end_user?a.created_by_end_user.session_id:a.created_by_account?a.created_by_account.name:"N/A";return(0,g.jsxs)("tr",{className:(0,y.cn)("cursor-pointer border-b border-divider-subtle hover:bg-background-default-hover",l?.id!==a.id?"":"bg-background-default-hover"),onClick:()=>{m(a),k(!0)},children:[(0,g.jsx)("td",{className:"h-4",children:!a.read_at&&(0,g.jsx)("div",{className:"flex items-center p-3 pr-0.5",children:(0,g.jsx)("span",{className:"inline-block h-1.5 w-1.5 rounded bg-util-colors-blue-blue-500"})})}),(0,g.jsx)("td",{className:"w-[180px] p-3 pr-2",children:e(a.created_at,d("dateTimeFormat",{ns:"appLog"}))}),(0,g.jsx)("td",{className:"p-3 pr-2",children:"succeeded"===(b=a.workflow_run.status)?(0,g.jsxs)("div",{className:"system-xs-semibold-uppercase inline-flex items-center gap-1",children:[(0,g.jsx)(bt.default,{color:"green"}),(0,g.jsx)("span",{className:"text-util-colors-green-green-600",children:"Success"})]}):"failed"===b?(0,g.jsxs)("div",{className:"system-xs-semibold-uppercase inline-flex items-center gap-1",children:[(0,g.jsx)(bt.default,{color:"red"}),(0,g.jsx)("span",{className:"text-util-colors-red-red-600",children:"Failure"})]}):"stopped"===b?(0,g.jsxs)("div",{className:"system-xs-semibold-uppercase inline-flex items-center gap-1",children:[(0,g.jsx)(bt.default,{color:"yellow"}),(0,g.jsx)("span",{className:"text-util-colors-warning-warning-600",children:"Stop"})]}):"running"===b?(0,g.jsxs)("div",{className:"system-xs-semibold-uppercase inline-flex items-center gap-1",children:[(0,g.jsx)(bt.default,{color:"blue"}),(0,g.jsx)("span",{className:"text-util-colors-blue-light-blue-light-600",children:"Running"})]}):"partial-succeeded"===b?(0,g.jsxs)("div",{className:"system-xs-semibold-uppercase inline-flex items-center gap-1",children:[(0,g.jsx)(bt.default,{color:"green"}),(0,g.jsx)("span",{className:"text-util-colors-green-green-600",children:"Partial Success"})]}):void 0}),(0,g.jsx)("td",{className:"p-3 pr-2",children:(0,g.jsx)("div",{className:(0,y.cn)(0===a.workflow_run.elapsed_time&&"text-text-quaternary"),children:`${a.workflow_run.elapsed_time.toFixed(3)}s`})}),(0,g.jsx)("td",{className:"p-3 pr-2",children:a.workflow_run.total_tokens}),(0,g.jsx)("td",{className:"p-3 pr-2",children:(0,g.jsx)("div",{className:(0,y.cn)("N/A"===c?"text-text-quaternary":"text-text-secondary","overflow-hidden text-ellipsis whitespace-nowrap"),children:c})}),s&&(0,g.jsx)("td",{className:"p-3 pr-2",children:(0,g.jsx)(bX,{triggeredFrom:a.workflow_run.triggered_from,triggerMetadata:a.details?.trigger_metadata})})]},a.id)})})]}),(0,g.jsx)(a5.default,{isOpen:h,onClose:t,mask:f,footer:null,panelClassName:"mt-16 mx-2 sm:mr-2 mb-3 !p-0 !max-w-[600px] rounded-xl border border-components-panel-border",children:(0,g.jsx)(bO,{onClose:t,runID:l?.workflow_run.id||"",canReplay:l?.workflow_run.triggered_from==="app-run"||l?.workflow_run.triggered_from==="debugging"})})]}):(0,g.jsx)(p.default,{})};aC.default.extend(aO.default),aC.default.extend(aN.default);let bZ=({appDetail:a})=>{let{t:b}=(0,j.useTranslation)(),{userProfile:{timezone:c}}=(0,bp.useAppContext)(),[d,e]=(0,i.useState)({status:"all",period:"2"}),[f,h]=i.useState(0),k=(0,l.useDebounce)(d,{wait:500}),[m,n]=i.useState(t.APP_PAGE_LIMIT),o={page:f+1,detail:!0,limit:m,..."all"!==k.status?{status:k.status}:{},...k.keyword?{keyword:k.keyword}:{},..."9"!==k.period?{created_at__after:(0,aC.default)().subtract(bL[k.period].value,"day").startOf("day").tz(c).format("YYYY-MM-DDTHH:mm:ssZ"),created_at__before:(0,aC.default)().endOf("day").tz(c).format("YYYY-MM-DDTHH:mm:ssZ")}:{},...aD(k,["period","status"])},{data:r,refetch:s}=(0,D.useWorkflowLogs)({appId:a.id,params:o}),u=r?.total;return(0,g.jsxs)("div",{className:"flex h-full flex-col",children:[(0,g.jsx)("h1",{className:"system-xl-semibold text-text-primary",children:b("workflowTitle",{ns:"appLog"})}),(0,g.jsx)("p",{className:"system-sm-regular text-text-tertiary",children:b("workflowSubtitle",{ns:"appLog"})}),(0,g.jsxs)("div",{className:"flex max-h-[calc(100%-16px)] flex-1 flex-col py-4",children:[(0,g.jsx)(bM,{queryParams:d,setQueryParams:e}),void 0===u?(0,g.jsx)(p.default,{type:"app"}):u>0?(0,g.jsx)(bY,{logs:r,appDetail:a,onRefresh:s}):(0,g.jsx)(aJ,{appDetail:a}),u&&u>t.APP_PAGE_LIMIT?(0,g.jsx)(q.default,{current:f,onChange:h,total:u,limit:m,onLimitChange:n}):null]})]})};var b$=((f={}).log="log",f.annotation="annotation",f);let b_=i.memo(({pageType:a})=>{let{t:b}=(0,j.useTranslation)(),c=(0,h.useRouter)(),d=(0,aX.useStore)(a=>a.appDetail),e=(0,i.useMemo)(()=>d?.mode===w.AppModeEnum.COMPLETION?[{value:b$.log,text:b("title",{ns:"appLog"})}]:[{value:b$.log,text:b("title",{ns:"appLog"})},{value:b$.annotation,text:b("title",{ns:"appAnnotation"})}],[d?.mode,b]);return d?(0,g.jsxs)("div",{className:"flex h-full flex-col px-6 pt-3",children:[d.mode!==w.AppModeEnum.WORKFLOW&&(0,g.jsx)(av.default,{className:"shrink-0",value:a,onChange:a=>{c.push(`/app/${d.id}/${a===b$.log?"logs":"annotations"}`)},options:e}),(0,g.jsxs)("div",{className:(0,y.cn)("h-0 grow",d.mode!==w.AppModeEnum.WORKFLOW&&"mt-3"),children:[a===b$.log&&d.mode!==w.AppModeEnum.WORKFLOW&&(0,g.jsx)(bG,{appDetail:d}),a===b$.annotation&&(0,g.jsx)(aB,{appDetail:d}),a===b$.log&&d.mode===w.AppModeEnum.WORKFLOW&&(0,g.jsx)(bZ,{appDetail:d})]})]}):(0,g.jsx)("div",{className:"flex h-full items-center justify-center bg-background-body",children:(0,g.jsx)(p.default,{})})});a.s(["default",0,b_],595132)}];

//# sourceMappingURL=app_components_app_log-annotation_index_tsx_ed66e0bc._.js.map
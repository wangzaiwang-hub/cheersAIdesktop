module.exports=[330196,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0})},977556,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.CronField=void 0;class d{#a=!1;#b=!1;#c=!1;#d=[];options={rawValue:""};static get min(){throw Error("min must be overridden")}static get max(){throw Error("max must be overridden")}static get chars(){return Object.freeze([])}static get validChars(){return/^[?,*\dH/-]+$|^.*H\(\d+-\d+\)\/\d+.*$|^.*H\(\d+-\d+\).*$|^.*H\/\d+.*$/}static get constraints(){return{min:this.min,max:this.max,chars:this.chars,validChars:this.validChars}}constructor(a,b={rawValue:""}){if(!Array.isArray(a))throw Error(`${this.constructor.name} Validation error, values is not an array`);if(!(a.length>0))throw Error(`${this.constructor.name} Validation error, values contains no values`);this.options={...b,rawValue:b.rawValue??""},this.#d=a.sort(d.sorter),this.#c=void 0!==this.options.wildcard?this.options.wildcard:this.#e(),this.#a=this.options.rawValue.includes("L")||a.includes("L"),this.#b=this.options.rawValue.includes("?")||a.includes("?")}get min(){return this.constructor.min}get max(){return this.constructor.max}get chars(){return this.constructor.chars}get hasLastChar(){return this.#a}get hasQuestionMarkChar(){return this.#b}get isWildcard(){return this.#c}get values(){return this.#d}static sorter(a,b){let c="number"==typeof a,d="number"==typeof b;return c&&d?a-b:c||d?c?-1:1:a.localeCompare(b)}serialize(){return{wildcard:this.#c,values:this.#d}}validate(){let a,b=this.chars.length>0?` or chars ${this.chars.join("")}`:"",c=b=>(a=b,"number"==typeof b?b>=this.min&&b<=this.max:this.chars.some(a=>RegExp(`^\\d{0,2}${a}$`).test(b)));if(!this.#d.every(c))throw Error(`${this.constructor.name} Validation error, got value ${a} expected range ${this.min}-${this.max}${b}`);let d=this.#d.find((a,b)=>this.#d.indexOf(a)!==b);if(d)throw Error(`${this.constructor.name} Validation error, duplicate values found: ${d}`)}#e(){return this.options.rawValue.length>0?["*","?"].includes(this.options.rawValue):Array.from({length:this.max-this.min+1},(a,b)=>b+this.min).every(a=>this.#d.includes(a))}}c.CronField=d},118514,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.CronDayOfMonth=void 0;let d=a.r(977556),e=Object.freeze(["L"]);class f extends d.CronField{static get min(){return 1}static get max(){return 31}static get chars(){return e}static get validChars(){return/^[?,*\dLH/-]+$|^.*H\(\d+-\d+\)\/\d+.*$|^.*H\(\d+-\d+\).*$|^.*H\/\d+.*$/}constructor(a,b){super(a,b),this.validate()}get values(){return super.values}}c.CronDayOfMonth=f},553702,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.CronDayOfWeek=void 0;let d=a.r(977556),e=Object.freeze(["L"]);class f extends d.CronField{static get min(){return 0}static get max(){return 7}static get chars(){return e}static get validChars(){return/^[?,*\dLH#/-]+$|^.*H\(\d+-\d+\)\/\d+.*$|^.*H\(\d+-\d+\).*$|^.*H\/\d+.*$/}constructor(a,b){super(a,b),this.validate()}get values(){return super.values}get nthDay(){return this.options.nthDayOfWeek??0}}c.CronDayOfWeek=f},785743,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.CronHour=void 0;let d=a.r(977556),e=Object.freeze([]);class f extends d.CronField{static get min(){return 0}static get max(){return 23}static get chars(){return e}constructor(a,b){super(a,b),this.validate()}get values(){return super.values}}c.CronHour=f},60948,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.CronMinute=void 0;let d=a.r(977556),e=Object.freeze([]);class f extends d.CronField{static get min(){return 0}static get max(){return 59}static get chars(){return e}constructor(a,b){super(a,b),this.validate()}get values(){return super.values}}c.CronMinute=f},892247,(a,b,c)=>{"use strict";let d;Object.defineProperty(c,"__esModule",{value:!0});class e extends Error{}class f extends e{constructor(a){super(`Invalid DateTime: ${a.toMessage()}`)}}class g extends e{constructor(a){super(`Invalid Interval: ${a.toMessage()}`)}}class h extends e{constructor(a){super(`Invalid Duration: ${a.toMessage()}`)}}class i extends e{}class j extends e{constructor(a){super(`Invalid unit ${a}`)}}class k extends e{}class l extends e{constructor(){super("Zone is an abstract class")}}let m="numeric",n="short",o="long",p={year:m,month:m,day:m},q={year:m,month:n,day:m},r={year:m,month:n,day:m,weekday:n},s={year:m,month:o,day:m},t={year:m,month:o,day:m,weekday:o},u={hour:m,minute:m},v={hour:m,minute:m,second:m},w={hour:m,minute:m,second:m,timeZoneName:n},x={hour:m,minute:m,second:m,timeZoneName:o},y={hour:m,minute:m,hourCycle:"h23"},z={hour:m,minute:m,second:m,hourCycle:"h23"},A={hour:m,minute:m,second:m,hourCycle:"h23",timeZoneName:n},B={hour:m,minute:m,second:m,hourCycle:"h23",timeZoneName:o},C={year:m,month:m,day:m,hour:m,minute:m},D={year:m,month:m,day:m,hour:m,minute:m,second:m},E={year:m,month:n,day:m,hour:m,minute:m},F={year:m,month:n,day:m,hour:m,minute:m,second:m},G={year:m,month:n,day:m,weekday:n,hour:m,minute:m},H={year:m,month:o,day:m,hour:m,minute:m,timeZoneName:n},I={year:m,month:o,day:m,hour:m,minute:m,second:m,timeZoneName:n},J={year:m,month:o,day:m,weekday:o,hour:m,minute:m,timeZoneName:o},K={year:m,month:o,day:m,weekday:o,hour:m,minute:m,second:m,timeZoneName:o};class L{get type(){throw new l}get name(){throw new l}get ianaName(){return this.name}get isUniversal(){throw new l}offsetName(a,b){throw new l}formatOffset(a,b){throw new l}offset(a){throw new l}equals(a){throw new l}get isValid(){throw new l}}let M=null;class N extends L{static get instance(){return null===M&&(M=new N),M}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(a,{format:b,locale:c}){return a4(a,b,c)}formatOffset(a,b){return a8(this.offset(a),b)}offset(a){return-new Date(a).getTimezoneOffset()}equals(a){return"system"===a.type}get isValid(){return!0}}let O=new Map,P={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6},Q=new Map;class R extends L{static create(a){let b=Q.get(a);return void 0===b&&Q.set(a,b=new R(a)),b}static resetCache(){Q.clear(),O.clear()}static isValidSpecifier(a){return this.isValidZone(a)}static isValidZone(a){if(!a)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:a}).format(),!0}catch(a){return!1}}constructor(a){super(),this.zoneName=a,this.valid=R.isValidZone(a)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(a,{format:b,locale:c}){return a4(a,b,c,this.name)}formatOffset(a,b){return a8(this.offset(a),b)}offset(a){var b;let c;if(!this.valid)return NaN;let d=new Date(a);if(isNaN(d))return NaN;let e=(b=this.name,void 0===(c=O.get(b))&&(c=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:b,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"}),O.set(b,c)),c),[f,g,h,i,j,k,l]=e.formatToParts?function(a,b){let c=a.formatToParts(b),d=[];for(let a=0;a<c.length;a++){let{type:b,value:e}=c[a],f=P[b];"era"===b?d[f]=e:aL(f)||(d[f]=parseInt(e,10))}return d}(e,d):function(a,b){let c=a.format(b).replace(/\u200E/g,""),[,d,e,f,g,h,i,j]=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(c);return[f,d,e,g,h,i,j]}(e,d);"BC"===i&&(f=-Math.abs(f)+1);let m=a0({year:f,month:g,day:h,hour:24===j?0:j,minute:k,second:l,millisecond:0}),n=+d,o=n%1e3;return(m-(n-=o>=0?o:1e3+o))/6e4}equals(a){return"iana"===a.type&&a.name===this.name}get isValid(){return this.valid}}let S={},T=new Map;function U(a,b={}){let c=JSON.stringify([a,b]),d=T.get(c);return void 0===d&&(d=new Intl.DateTimeFormat(a,b),T.set(c,d)),d}let V=new Map,W=new Map,X=null,Y=new Map;function Z(a){let b=Y.get(a);return void 0===b&&(b=new Intl.DateTimeFormat(a).resolvedOptions(),Y.set(a,b)),b}let $=new Map;function _(a,b,c,d){let e=a.listingMode();return"error"===e?null:"en"===e?c(b):d(b)}class aa{constructor(a,b,c){this.padTo=c.padTo||0,this.floor=c.floor||!1;const{padTo:d,floor:e,...f}=c;if(!b||Object.keys(f).length>0){const b={useGrouping:!1,...c};c.padTo>0&&(b.minimumIntegerDigits=c.padTo),this.inf=function(a,b={}){let c=JSON.stringify([a,b]),d=V.get(c);return void 0===d&&(d=new Intl.NumberFormat(a,b),V.set(c,d)),d}(a,b)}}format(a){if(!this.inf)return aU(this.floor?Math.floor(a):aY(a,3),this.padTo);{let b=this.floor?Math.floor(a):a;return this.inf.format(b)}}}class ab{constructor(a,b,c){let d;if(this.opts=c,this.originalZone=void 0,this.opts.timeZone)this.dt=a;else if("fixed"===a.zone.type){const b=-1*(a.offset/60),c=b>=0?`Etc/GMT+${b}`:`Etc/GMT${b}`;0!==a.offset&&R.create(c).valid?(d=c,this.dt=a):(d="UTC",this.dt=0===a.offset?a:a.setZone("UTC").plus({minutes:a.offset}),this.originalZone=a.zone)}else"system"===a.zone.type?this.dt=a:"iana"===a.zone.type?(this.dt=a,d=a.zone.name):(d="UTC",this.dt=a.setZone("UTC").plus({minutes:a.offset}),this.originalZone=a.zone);const e={...this.opts};e.timeZone=e.timeZone||d,this.dtf=U(b,e)}format(){return this.originalZone?this.formatToParts().map(({value:a})=>a).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){let a=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?a.map(a=>{if("timeZoneName"!==a.type)return a;{let b=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...a,value:b}}}):a}resolvedOptions(){return this.dtf.resolvedOptions()}}class ac{constructor(a,b,c){this.opts={style:"long",...c},!b&&aO()&&(this.rtf=function(a,b={}){let{base:c,...d}=b,e=JSON.stringify([a,d]),f=W.get(e);return void 0===f&&(f=new Intl.RelativeTimeFormat(a,b),W.set(e,f)),f}(a,c))}format(a,b){return this.rtf?this.rtf.format(a,b):function(a,b,c="always",d=!1){let e={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},f=-1===["hours","minutes","seconds"].indexOf(a);if("auto"===c&&f){let c="days"===a;switch(b){case 1:return c?"tomorrow":`next ${e[a][0]}`;case -1:return c?"yesterday":`last ${e[a][0]}`;case 0:return c?"today":`this ${e[a][0]}`}}let g=Object.is(b,-0)||b<0,h=Math.abs(b),i=1===h,j=e[a],k=d?i?j[1]:j[2]||j[1]:i?e[a][0]:a;return g?`${h} ${k} ago`:`in ${h} ${k}`}(b,a,this.opts.numeric,"long"!==this.opts.style)}formatToParts(a,b){return this.rtf?this.rtf.formatToParts(a,b):[]}}let ad={firstDay:1,minimalDays:4,weekend:[6,7]};class ae{static fromOpts(a){return ae.create(a.locale,a.numberingSystem,a.outputCalendar,a.weekSettings,a.defaultToEN)}static create(a,b,c,d,e=!1){let f=a||aw.defaultLocale;return new ae(f||(e?"en-US":X||(X=new Intl.DateTimeFormat().resolvedOptions().locale)),b||aw.defaultNumberingSystem,c||aw.defaultOutputCalendar,aS(d)||aw.defaultWeekSettings,f)}static resetCache(){X=null,T.clear(),V.clear(),W.clear(),Y.clear(),$.clear()}static fromObject({locale:a,numberingSystem:b,outputCalendar:c,weekSettings:d}={}){return ae.create(a,b,c,d)}constructor(a,b,c,d,e){const[f,g,h]=function(a){let b=a.indexOf("-x-");-1!==b&&(a=a.substring(0,b));let c=a.indexOf("-u-");if(-1===c)return[a];{let b,d;try{b=U(a).resolvedOptions(),d=a}catch(f){let e=a.substring(0,c);b=U(e).resolvedOptions(),d=e}let{numberingSystem:e,calendar:f}=b;return[d,e,f]}}(a);this.locale=f,this.numberingSystem=b||g||null,this.outputCalendar=c||h||null,this.weekSettings=d,this.intl=function(a,b,c){return(c||b)&&(a.includes("-u-")||(a+="-u"),c&&(a+=`-ca-${c}`),b&&(a+=`-nu-${b}`)),a}(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=e,this.fastNumbersCached=null}get fastNumbers(){return null==this.fastNumbersCached&&(this.fastNumbersCached=(!this.numberingSystem||"latn"===this.numberingSystem)&&("latn"===this.numberingSystem||!this.locale||this.locale.startsWith("en")||"latn"===Z(this.locale).numberingSystem)),this.fastNumbersCached}listingMode(){let a=this.isEnglish(),b=(null===this.numberingSystem||"latn"===this.numberingSystem)&&(null===this.outputCalendar||"gregory"===this.outputCalendar);return a&&b?"en":"intl"}clone(a){return a&&0!==Object.getOwnPropertyNames(a).length?ae.create(a.locale||this.specifiedLocale,a.numberingSystem||this.numberingSystem,a.outputCalendar||this.outputCalendar,aS(a.weekSettings)||this.weekSettings,a.defaultToEN||!1):this}redefaultToEN(a={}){return this.clone({...a,defaultToEN:!0})}redefaultToSystem(a={}){return this.clone({...a,defaultToEN:!1})}months(a,b=!1){return _(this,a,bd,()=>{let c="ja"===this.intl||this.intl.startsWith("ja-"),d=(b&=!c)?{month:a,day:"numeric"}:{month:a},e=b?"format":"standalone";if(!this.monthsCache[e][a]){let b=c?a=>this.dtFormatter(a,d).format():a=>this.extract(a,d,"month");this.monthsCache[e][a]=function(a){let b=[];for(let c=1;c<=12;c++){let d=cW.utc(2009,c,1);b.push(a(d))}return b}(b)}return this.monthsCache[e][a]})}weekdays(a,b=!1){return _(this,a,bh,()=>{let c=b?{weekday:a,year:"numeric",month:"long",day:"numeric"}:{weekday:a},d=b?"format":"standalone";return this.weekdaysCache[d][a]||(this.weekdaysCache[d][a]=function(a){let b=[];for(let c=1;c<=7;c++){let d=cW.utc(2016,11,13+c);b.push(a(d))}return b}(a=>this.extract(a,c,"weekday"))),this.weekdaysCache[d][a]})}meridiems(){return _(this,void 0,()=>bi,()=>{if(!this.meridiemCache){let a={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[cW.utc(2016,11,13,9),cW.utc(2016,11,13,19)].map(b=>this.extract(b,a,"dayperiod"))}return this.meridiemCache})}eras(a){return _(this,a,bm,()=>{let b={era:a};return this.eraCache[a]||(this.eraCache[a]=[cW.utc(-40,1,1),cW.utc(2017,1,1)].map(a=>this.extract(a,b,"era"))),this.eraCache[a]})}extract(a,b,c){let d=this.dtFormatter(a,b).formatToParts().find(a=>a.type.toLowerCase()===c);return d?d.value:null}numberFormatter(a={}){return new aa(this.intl,a.forceSimple||this.fastNumbers,a)}dtFormatter(a,b={}){return new ab(a,this.intl,b)}relFormatter(a={}){return new ac(this.intl,this.isEnglish(),a)}listFormatter(a={}){return function(a,b={}){let c=JSON.stringify([a,b]),d=S[c];return d||(d=new Intl.ListFormat(a,b),S[c]=d),d}(this.intl,a)}isEnglish(){return"en"===this.locale||"en-us"===this.locale.toLowerCase()||Z(this.intl).locale.startsWith("en-us")}getWeekSettings(){if(this.weekSettings)return this.weekSettings;if(!aP())return ad;var a=this.locale;let b=$.get(a);if(!b){let c=new Intl.Locale(a);"minimalDays"in(b="getWeekInfo"in c?c.getWeekInfo():c.weekInfo)||(b={...ad,...b}),$.set(a,b)}return b}getStartOfWeek(){return this.getWeekSettings().firstDay}getMinDaysInFirstWeek(){return this.getWeekSettings().minimalDays}getWeekendDays(){return this.getWeekSettings().weekend}equals(a){return this.locale===a.locale&&this.numberingSystem===a.numberingSystem&&this.outputCalendar===a.outputCalendar}toString(){return`Locale(${this.locale}, ${this.numberingSystem}, ${this.outputCalendar})`}}let af=null;class ag extends L{static get utcInstance(){return null===af&&(af=new ag(0)),af}static instance(a){return 0===a?ag.utcInstance:new ag(a)}static parseSpecifier(a){if(a){let b=a.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(b)return new ag(a5(b[1],b[2]))}return null}constructor(a){super(),this.fixed=a}get type(){return"fixed"}get name(){return 0===this.fixed?"UTC":`UTC${a8(this.fixed,"narrow")}`}get ianaName(){return 0===this.fixed?"Etc/UTC":`Etc/GMT${a8(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(a,b){return a8(this.fixed,b)}get isUniversal(){return!0}offset(){return this.fixed}equals(a){return"fixed"===a.type&&a.fixed===this.fixed}get isValid(){return!0}}class ah extends L{constructor(a){super(),this.zoneName=a}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function ai(a,b){if(aL(a)||null===a)return b;if(a instanceof L)return a;if("string"==typeof a){let c=a.toLowerCase();return"default"===c?b:"local"===c||"system"===c?N.instance:"utc"===c||"gmt"===c?ag.utcInstance:ag.parseSpecifier(c)||R.create(a)}if(aM(a))return ag.instance(a);if("object"==typeof a&&"offset"in a&&"function"==typeof a.offset)return a;else return new ah(a)}let aj={arab:"[٠-٩]",arabext:"[۰-۹]",bali:"[᭐-᭙]",beng:"[০-৯]",deva:"[०-९]",fullwide:"[０-９]",gujr:"[૦-૯]",hanidec:"[〇|一|二|三|四|五|六|七|八|九]",khmr:"[០-៩]",knda:"[೦-೯]",laoo:"[໐-໙]",limb:"[᥆-᥏]",mlym:"[൦-൯]",mong:"[᠐-᠙]",mymr:"[၀-၉]",orya:"[୦-୯]",tamldec:"[௦-௯]",telu:"[౦-౯]",thai:"[๐-๙]",tibt:"[༠-༩]",latn:"\\d"},ak={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},al=aj.hanidec.replace(/[\[|\]]/g,"").split(""),am=new Map;function an({numberingSystem:a},b=""){let c=a||"latn",d=am.get(c);void 0===d&&(d=new Map,am.set(c,d));let e=d.get(b);return void 0===e&&(e=RegExp(`${aj[c]}${b}`),d.set(b,e)),e}let ao=()=>Date.now(),ap="system",aq=null,ar=null,as=null,at=60,au,av=null;class aw{static get now(){return ao}static set now(a){ao=a}static set defaultZone(a){ap=a}static get defaultZone(){return ai(ap,N.instance)}static get defaultLocale(){return aq}static set defaultLocale(a){aq=a}static get defaultNumberingSystem(){return ar}static set defaultNumberingSystem(a){ar=a}static get defaultOutputCalendar(){return as}static set defaultOutputCalendar(a){as=a}static get defaultWeekSettings(){return av}static set defaultWeekSettings(a){av=aS(a)}static get twoDigitCutoffYear(){return at}static set twoDigitCutoffYear(a){at=a%100}static get throwOnInvalid(){return au}static set throwOnInvalid(a){au=a}static resetCaches(){ae.resetCache(),R.resetCache(),cW.resetCache(),am.clear()}}class ax{constructor(a,b){this.reason=a,this.explanation=b}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}let ay=[0,31,59,90,120,151,181,212,243,273,304,334],az=[0,31,60,91,121,152,182,213,244,274,305,335];function aA(a,b){return new ax("unit out of range",`you specified ${b} (of type ${typeof b}) as a ${a}, which is invalid`)}function aB(a,b,c){let d=new Date(Date.UTC(a,b-1,c));a<100&&a>=0&&d.setUTCFullYear(d.getUTCFullYear()-1900);let e=d.getUTCDay();return 0===e?7:e}function aC(a,b){let c=aZ(a)?az:ay,d=c.findIndex(a=>a<b),e=b-c[d];return{month:d+1,day:e}}function aD(a,b){return(a-b+7)%7+1}function aE(a,b=4,c=1){let{year:d,month:e,day:f}=a,g=f+(aZ(d)?az:ay)[e-1],h=aD(aB(d,e,f),c),i=Math.floor((g-h+14-b)/7),j;return i<1?i=a2(j=d-1,b,c):i>a2(d,b,c)?(j=d+1,i=1):j=d,{weekYear:j,weekNumber:i,weekday:h,...a9(a)}}function aF(a,b=4,c=1){let{weekYear:d,weekNumber:e,weekday:f}=a,g=aD(aB(d,1,b),c),h=a$(d),i=7*e+f-g-7+b,j;i<1?i+=a$(j=d-1):i>h?(j=d+1,i-=a$(d)):j=d;let{month:k,day:l}=aC(j,i);return{year:j,month:k,day:l,...a9(a)}}function aG(a){let{year:b,month:c,day:d}=a,e=d+(aZ(b)?az:ay)[c-1];return{year:b,ordinal:e,...a9(a)}}function aH(a){let{year:b,ordinal:c}=a,{month:d,day:e}=aC(b,c);return{year:b,month:d,day:e,...a9(a)}}function aI(a,b){if(!(!aL(a.localWeekday)||!aL(a.localWeekNumber)||!aL(a.localWeekYear)))return{minDaysInFirstWeek:4,startOfWeek:1};if(!aL(a.weekday)||!aL(a.weekNumber)||!aL(a.weekYear))throw new i("Cannot mix locale-based week fields with ISO-based week fields");return aL(a.localWeekday)||(a.weekday=a.localWeekday),aL(a.localWeekNumber)||(a.weekNumber=a.localWeekNumber),aL(a.localWeekYear)||(a.weekYear=a.localWeekYear),delete a.localWeekday,delete a.localWeekNumber,delete a.localWeekYear,{minDaysInFirstWeek:b.getMinDaysInFirstWeek(),startOfWeek:b.getStartOfWeek()}}function aJ(a){let b=aN(a.year),c=aT(a.month,1,12),d=aT(a.day,1,a_(a.year,a.month));return b?c?!d&&aA("day",a.day):aA("month",a.month):aA("year",a.year)}function aK(a){let{hour:b,minute:c,second:d,millisecond:e}=a,f=aT(b,0,23)||24===b&&0===c&&0===d&&0===e,g=aT(c,0,59),h=aT(d,0,59),i=aT(e,0,999);return f?g?h?!i&&aA("millisecond",e):aA("second",d):aA("minute",c):aA("hour",b)}function aL(a){return void 0===a}function aM(a){return"number"==typeof a}function aN(a){return"number"==typeof a&&a%1==0}function aO(){try{return"u">typeof Intl&&!!Intl.RelativeTimeFormat}catch(a){return!1}}function aP(){try{return"u">typeof Intl&&!!Intl.Locale&&("weekInfo"in Intl.Locale.prototype||"getWeekInfo"in Intl.Locale.prototype)}catch(a){return!1}}function aQ(a,b,c){if(0!==a.length)return a.reduce((a,d)=>{let e=[b(d),d];return a&&c(a[0],e[0])===a[0]?a:e},null)[1]}function aR(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function aS(a){if(null==a)return null;if("object"!=typeof a)throw new k("Week settings must be an object");if(!aT(a.firstDay,1,7)||!aT(a.minimalDays,1,7)||!Array.isArray(a.weekend)||a.weekend.some(a=>!aT(a,1,7)))throw new k("Invalid week settings");return{firstDay:a.firstDay,minimalDays:a.minimalDays,weekend:Array.from(a.weekend)}}function aT(a,b,c){return aN(a)&&a>=b&&a<=c}function aU(a,b=2){return a<0?"-"+(""+-a).padStart(b,"0"):(""+a).padStart(b,"0")}function aV(a){if(!aL(a)&&null!==a&&""!==a)return parseInt(a,10)}function aW(a){if(!aL(a)&&null!==a&&""!==a)return parseFloat(a)}function aX(a){if(!aL(a)&&null!==a&&""!==a)return Math.floor(1e3*parseFloat("0."+a))}function aY(a,b,c="round"){let d=10**b;switch(c){case"expand":return a>0?Math.ceil(a*d)/d:Math.floor(a*d)/d;case"trunc":return Math.trunc(a*d)/d;case"round":return Math.round(a*d)/d;case"floor":return Math.floor(a*d)/d;case"ceil":return Math.ceil(a*d)/d;default:throw RangeError(`Value rounding ${c} is out of range`)}}function aZ(a){return a%4==0&&(a%100!=0||a%400==0)}function a$(a){return aZ(a)?366:365}function a_(a,b){var c;let d=(c=b-1)-12*Math.floor(c/12)+1;return 2===d?aZ(a+(b-d)/12)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][d-1]}function a0(a){let b=Date.UTC(a.year,a.month-1,a.day,a.hour,a.minute,a.second,a.millisecond);return a.year<100&&a.year>=0&&(b=new Date(b)).setUTCFullYear(a.year,a.month-1,a.day),+b}function a1(a,b,c){return-aD(aB(a,1,b),c)+b-1}function a2(a,b=4,c=1){let d=a1(a,b,c),e=a1(a+1,b,c);return(a$(a)-d+e)/7}function a3(a){return a>99?a:a>aw.twoDigitCutoffYear?1900+a:2e3+a}function a4(a,b,c,d=null){let e=new Date(a),f={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};d&&(f.timeZone=d);let g={timeZoneName:b,...f},h=new Intl.DateTimeFormat(c,g).formatToParts(e).find(a=>"timezonename"===a.type.toLowerCase());return h?h.value:null}function a5(a,b){let c=parseInt(a,10);Number.isNaN(c)&&(c=0);let d=parseInt(b,10)||0,e=c<0||Object.is(c,-0)?-d:d;return 60*c+e}function a6(a){let b=Number(a);if("boolean"==typeof a||""===a||!Number.isFinite(b))throw new k(`Invalid unit value ${a}`);return b}function a7(a,b){let c={};for(let d in a)if(aR(a,d)){let e=a[d];if(null==e)continue;c[b(d)]=a6(e)}return c}function a8(a,b){let c=Math.trunc(Math.abs(a/60)),d=Math.trunc(Math.abs(a%60)),e=a>=0?"+":"-";switch(b){case"short":return`${e}${aU(c,2)}:${aU(d,2)}`;case"narrow":return`${e}${c}${d>0?`:${d}`:""}`;case"techie":return`${e}${aU(c,2)}${aU(d,2)}`;default:throw RangeError(`Value format ${b} is out of range for property format`)}}function a9(a){return["hour","minute","second","millisecond"].reduce((b,c)=>(b[c]=a[c],b),{})}let ba=["January","February","March","April","May","June","July","August","September","October","November","December"],bb=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],bc=["J","F","M","A","M","J","J","A","S","O","N","D"];function bd(a){switch(a){case"narrow":return[...bc];case"short":return[...bb];case"long":return[...ba];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}let be=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],bf=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],bg=["M","T","W","T","F","S","S"];function bh(a){switch(a){case"narrow":return[...bg];case"short":return[...bf];case"long":return[...be];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}let bi=["AM","PM"],bj=["Before Christ","Anno Domini"],bk=["BC","AD"],bl=["B","A"];function bm(a){switch(a){case"narrow":return[...bl];case"short":return[...bk];case"long":return[...bj];default:return null}}function bn(a,b){let c="";for(let d of a)d.literal?c+=d.val:c+=b(d.val);return c}let bo={D:p,DD:q,DDD:s,DDDD:t,t:u,tt:v,ttt:w,tttt:x,T:y,TT:z,TTT:A,TTTT:B,f:C,ff:E,fff:H,ffff:J,F:D,FF:F,FFF:I,FFFF:K};class bp{static create(a,b={}){return new bp(a,b)}static parseFormat(a){let b=null,c="",d=!1,e=[];for(let f=0;f<a.length;f++){let g=a.charAt(f);"'"===g?((c.length>0||d)&&e.push({literal:d||/^\s+$/.test(c),val:""===c?"'":c}),b=null,c="",d=!d):d||g===b?c+=g:(c.length>0&&e.push({literal:/^\s+$/.test(c),val:c}),c=g,b=g)}return c.length>0&&e.push({literal:d||/^\s+$/.test(c),val:c}),e}static macroTokenToFormatOpts(a){return bo[a]}constructor(a,b){this.opts=b,this.loc=a,this.systemLoc=null}formatWithSystemDefault(a,b){return null===this.systemLoc&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(a,{...this.opts,...b}).format()}dtFormatter(a,b={}){return this.loc.dtFormatter(a,{...this.opts,...b})}formatDateTime(a,b){return this.dtFormatter(a,b).format()}formatDateTimeParts(a,b){return this.dtFormatter(a,b).formatToParts()}formatInterval(a,b){return this.dtFormatter(a.start,b).dtf.formatRange(a.start.toJSDate(),a.end.toJSDate())}resolvedOptions(a,b){return this.dtFormatter(a,b).resolvedOptions()}num(a,b=0,c){if(this.opts.forceSimple)return aU(a,b);let d={...this.opts};return b>0&&(d.padTo=b),c&&(d.signDisplay=c),this.loc.numberFormatter(d).format(a)}formatDateTimeFromString(a,b){let c="en"===this.loc.listingMode(),d=this.loc.outputCalendar&&"gregory"!==this.loc.outputCalendar,e=(b,c)=>this.loc.extract(a,b,c),f=b=>a.isOffsetFixed&&0===a.offset&&b.allowZ?"Z":a.isValid?a.zone.formatOffset(a.ts,b.format):"",g=(b,d)=>c?bd(b)[a.month-1]:e(d?{month:b}:{month:b,day:"numeric"},"month"),h=(b,d)=>c?bh(b)[a.weekday-1]:e(d?{weekday:b}:{weekday:b,month:"long",day:"numeric"},"weekday"),i=b=>{let c=bp.macroTokenToFormatOpts(b);return c?this.formatWithSystemDefault(a,c):b},j=b=>c?bm(b)[a.year<0?0:1]:e({era:b},"era"),k=b=>{switch(b){case"S":return this.num(a.millisecond);case"u":case"SSS":return this.num(a.millisecond,3);case"s":return this.num(a.second);case"ss":return this.num(a.second,2);case"uu":return this.num(Math.floor(a.millisecond/10),2);case"uuu":return this.num(Math.floor(a.millisecond/100));case"m":return this.num(a.minute);case"mm":return this.num(a.minute,2);case"h":return this.num(a.hour%12==0?12:a.hour%12);case"hh":return this.num(a.hour%12==0?12:a.hour%12,2);case"H":return this.num(a.hour);case"HH":return this.num(a.hour,2);case"Z":return f({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return f({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return f({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return a.zone.offsetName(a.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return a.zone.offsetName(a.ts,{format:"long",locale:this.loc.locale});case"z":return a.zoneName;case"a":return c?bi[a.hour<12?0:1]:e({hour:"numeric",hourCycle:"h12"},"dayperiod");case"d":return d?e({day:"numeric"},"day"):this.num(a.day);case"dd":return d?e({day:"2-digit"},"day"):this.num(a.day,2);case"c":case"E":return this.num(a.weekday);case"ccc":return h("short",!0);case"cccc":return h("long",!0);case"ccccc":return h("narrow",!0);case"EEE":return h("short",!1);case"EEEE":return h("long",!1);case"EEEEE":return h("narrow",!1);case"L":return d?e({month:"numeric",day:"numeric"},"month"):this.num(a.month);case"LL":return d?e({month:"2-digit",day:"numeric"},"month"):this.num(a.month,2);case"LLL":return g("short",!0);case"LLLL":return g("long",!0);case"LLLLL":return g("narrow",!0);case"M":return d?e({month:"numeric"},"month"):this.num(a.month);case"MM":return d?e({month:"2-digit"},"month"):this.num(a.month,2);case"MMM":return g("short",!1);case"MMMM":return g("long",!1);case"MMMMM":return g("narrow",!1);case"y":return d?e({year:"numeric"},"year"):this.num(a.year);case"yy":return d?e({year:"2-digit"},"year"):this.num(a.year.toString().slice(-2),2);case"yyyy":return d?e({year:"numeric"},"year"):this.num(a.year,4);case"yyyyyy":return d?e({year:"numeric"},"year"):this.num(a.year,6);case"G":return j("short");case"GG":return j("long");case"GGGGG":return j("narrow");case"kk":return this.num(a.weekYear.toString().slice(-2),2);case"kkkk":return this.num(a.weekYear,4);case"W":return this.num(a.weekNumber);case"WW":return this.num(a.weekNumber,2);case"n":return this.num(a.localWeekNumber);case"nn":return this.num(a.localWeekNumber,2);case"ii":return this.num(a.localWeekYear.toString().slice(-2),2);case"iiii":return this.num(a.localWeekYear,4);case"o":return this.num(a.ordinal);case"ooo":return this.num(a.ordinal,3);case"q":return this.num(a.quarter);case"qq":return this.num(a.quarter,2);case"X":return this.num(Math.floor(a.ts/1e3));case"x":return this.num(a.ts);default:return i(b)}};return bn(bp.parseFormat(b),k)}formatDurationFromString(a,b){let c="negativeLargestOnly"===this.opts.signMode?-1:1,d=a=>{switch(a[0]){case"S":return"milliseconds";case"s":return"seconds";case"m":return"minutes";case"h":return"hours";case"d":return"days";case"w":return"weeks";case"M":return"months";case"y":return"years";default:return null}},e=(a,b)=>e=>{let f=d(e);if(!f)return e;{let d,g=b.isNegativeDuration&&f!==b.largestUnit?c:1;return d="negativeLargestOnly"===this.opts.signMode&&f!==b.largestUnit?"never":"all"===this.opts.signMode?"always":"auto",this.num(a.get(f)*g,e.length,d)}},f=bp.parseFormat(b),g=f.reduce((a,{literal:b,val:c})=>b?a:a.concat(c),[]),h=a.shiftTo(...g.map(d).filter(a=>a)),i={isNegativeDuration:h<0,largestUnit:Object.keys(h.values)[0]};return bn(f,e(h,i))}}let bq=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function br(...a){let b=a.reduce((a,b)=>a+b.source,"");return RegExp(`^${b}$`)}function bs(...a){return b=>a.reduce(([a,c,d],e)=>{let[f,g,h]=e(b,d);return[{...a,...f},g||c,h]},[{},null,1]).slice(0,2)}function bt(a,...b){if(null==a)return[null,null];for(let[c,d]of b){let b=c.exec(a);if(b)return d(b)}return[null,null]}function bu(...a){return(b,c)=>{let d,e={};for(d=0;d<a.length;d++)e[a[d]]=aV(b[c+d]);return[e,null,c+d]}}let bv=/(?:([Zz])|([+-]\d\d)(?::?(\d\d))?)/,bw=`(?:${bv.source}?(?:\\[(${bq.source})\\])?)?`,bx=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,by=RegExp(`${bx.source}${bw}`),bz=RegExp(`(?:[Tt]${by.source})?`),bA=bu("weekYear","weekNumber","weekDay"),bB=bu("year","ordinal"),bC=RegExp(`${bx.source} ?(?:${bv.source}|(${bq.source}))?`),bD=RegExp(`(?: ${bC.source})?`);function bE(a,b,c){let d=a[b];return aL(d)?c:aV(d)}function bF(a,b){return[{hours:bE(a,b,0),minutes:bE(a,b+1,0),seconds:bE(a,b+2,0),milliseconds:aX(a[b+3])},null,b+4]}function bG(a,b){let c=!a[b]&&!a[b+1],d=a5(a[b+1],a[b+2]);return[{},c?null:ag.instance(d),b+3]}function bH(a,b){return[{},a[b]?R.create(a[b]):null,b+1]}let bI=RegExp(`^T?${bx.source}$`),bJ=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function bK(a){let[b,c,d,e,f,g,h,i,j]=a,k="-"===b[0],l=i&&"-"===i[0],m=(a,b=!1)=>void 0!==a&&(b||a&&k)?-a:a;return[{years:m(aW(c)),months:m(aW(d)),weeks:m(aW(e)),days:m(aW(f)),hours:m(aW(g)),minutes:m(aW(h)),seconds:m(aW(i),"-0"===i),milliseconds:m(aX(j),l)}]}let bL={GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function bM(a,b,c,d,e,f,g){let h={year:2===b.length?a3(aV(b)):aV(b),month:bb.indexOf(c)+1,day:aV(d),hour:aV(e),minute:aV(f)};return g&&(h.second=aV(g)),a&&(h.weekday=a.length>3?be.indexOf(a)+1:bf.indexOf(a)+1),h}let bN=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function bO(a){let[,b,c,d,e,f,g,h,i,j,k,l]=a;return[bM(b,e,d,c,f,g,h),new ag(i?bL[i]:j?0:a5(k,l))]}let bP=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,bQ=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,bR=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function bS(a){let[,b,c,d,e,f,g,h]=a;return[bM(b,e,d,c,f,g,h),ag.utcInstance]}function bT(a){let[,b,c,d,e,f,g,h]=a;return[bM(b,h,c,d,e,f,g),ag.utcInstance]}let bU=br(/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,bz),bV=br(/(\d{4})-?W(\d\d)(?:-?(\d))?/,bz),bW=br(/(\d{4})-?(\d{3})/,bz),bX=br(by),bY=bs(function(a,b){return[{year:bE(a,b),month:bE(a,b+1,1),day:bE(a,b+2,1)},null,b+3]},bF,bG,bH),bZ=bs(bA,bF,bG,bH),b$=bs(bB,bF,bG,bH),b_=bs(bF,bG,bH),b0=bs(bF),b1=br(/(\d{4})-(\d\d)-(\d\d)/,bD),b2=br(bC),b3=bs(bF,bG,bH),b4="Invalid Duration",b5={weeks:{days:7,hours:168,minutes:10080,seconds:604800,milliseconds:6048e5},days:{hours:24,minutes:1440,seconds:86400,milliseconds:864e5},hours:{minutes:60,seconds:3600,milliseconds:36e5},minutes:{seconds:60,milliseconds:6e4},seconds:{milliseconds:1e3}},b6={years:{quarters:4,months:12,weeks:52,days:365,hours:8760,minutes:525600,seconds:31536e3,milliseconds:31536e6},quarters:{months:3,weeks:13,days:91,hours:2184,minutes:131040,seconds:7862400,milliseconds:78624e5},months:{weeks:4,days:30,hours:720,minutes:43200,seconds:2592e3,milliseconds:2592e6},...b5},b7={years:{quarters:4,months:12,weeks:52.1775,days:365.2425,hours:8765.82,minutes:525949.2,seconds:0x1e18558,milliseconds:31556952e3},quarters:{months:3,weeks:13.044375,days:91.310625,hours:2191.455,minutes:131487.3,seconds:7889238,milliseconds:7889238e3},months:{weeks:30.436875/7,days:30.436875,hours:730.485,minutes:43829.1,seconds:2629746,milliseconds:2629746e3},...b5},b8=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],b9=b8.slice(0).reverse();function ca(a,b,c=!1){return new ce({values:c?b.values:{...a.values,...b.values||{}},loc:a.loc.clone(b.loc),conversionAccuracy:b.conversionAccuracy||a.conversionAccuracy,matrix:b.matrix||a.matrix})}function cb(a,b){var c;let d=null!=(c=b.milliseconds)?c:0;for(let c of b9.slice(1))b[c]&&(d+=b[c]*a[c].milliseconds);return d}function cc(a,b){let c=0>cb(a,b)?-1:1;b8.reduceRight((d,e)=>{if(aL(b[e]))return d;if(d){let f=b[d]*c,g=a[e][d],h=Math.floor(f/g);b[e]+=h*c,b[d]-=h*g*c}return e},null),b8.reduce((c,d)=>{if(aL(b[d]))return c;if(c){let e=b[c]%1;b[c]-=e,b[d]+=e*a[c][d]}return d},null)}function cd(a){let b={};for(let[c,d]of Object.entries(a))0!==d&&(b[c]=d);return b}class ce{constructor(a){const b="longterm"===a.conversionAccuracy;let c=b?b7:b6;a.matrix&&(c=a.matrix),this.values=a.values,this.loc=a.loc||ae.create(),this.conversionAccuracy=b?"longterm":"casual",this.invalid=a.invalid||null,this.matrix=c,this.isLuxonDuration=!0}static fromMillis(a,b){return ce.fromObject({milliseconds:a},b)}static fromObject(a,b={}){if(null==a||"object"!=typeof a)throw new k(`Duration.fromObject: argument expected to be an object, got ${null===a?"null":typeof a}`);return new ce({values:a7(a,ce.normalizeUnit),loc:ae.fromObject(b),conversionAccuracy:b.conversionAccuracy,matrix:b.matrix})}static fromDurationLike(a){if(aM(a))return ce.fromMillis(a);if(ce.isDuration(a))return a;if("object"==typeof a)return ce.fromObject(a);throw new k(`Unknown duration argument ${a} of type ${typeof a}`)}static fromISO(a,b){let[c]=bt(a,[bJ,bK]);return c?ce.fromObject(c,b):ce.invalid("unparsable",`the input "${a}" can't be parsed as ISO 8601`)}static fromISOTime(a,b){let[c]=bt(a,[bI,b0]);return c?ce.fromObject(c,b):ce.invalid("unparsable",`the input "${a}" can't be parsed as ISO 8601`)}static invalid(a,b=null){if(!a)throw new k("need to specify a reason the Duration is invalid");let c=a instanceof ax?a:new ax(a,b);if(!aw.throwOnInvalid)return new ce({invalid:c});throw new h(c)}static normalizeUnit(a){let b={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[a?a.toLowerCase():a];if(!b)throw new j(a);return b}static isDuration(a){return a&&a.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(a,b={}){let c={...b,floor:!1!==b.round&&!1!==b.floor};return this.isValid?bp.create(this.loc,c).formatDurationFromString(this,a):b4}toHuman(a={}){if(!this.isValid)return b4;let b=!1!==a.showZeros,c=b8.map(c=>{let d=this.values[c];return aL(d)||0===d&&!b?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...a,unit:c.slice(0,-1)}).format(d)}).filter(a=>a);return this.loc.listFormatter({type:"conjunction",style:a.listStyle||"narrow",...a}).format(c)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let a="P";return 0!==this.years&&(a+=this.years+"Y"),(0!==this.months||0!==this.quarters)&&(a+=this.months+3*this.quarters+"M"),0!==this.weeks&&(a+=this.weeks+"W"),0!==this.days&&(a+=this.days+"D"),(0!==this.hours||0!==this.minutes||0!==this.seconds||0!==this.milliseconds)&&(a+="T"),0!==this.hours&&(a+=this.hours+"H"),0!==this.minutes&&(a+=this.minutes+"M"),(0!==this.seconds||0!==this.milliseconds)&&(a+=aY(this.seconds+this.milliseconds/1e3,3)+"S"),"P"===a&&(a+="T0S"),a}toISOTime(a={}){if(!this.isValid)return null;let b=this.toMillis();return b<0||b>=864e5?null:(a={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...a,includeOffset:!1},cW.fromMillis(b,{zone:"UTC"}).toISOTime(a))}toJSON(){return this.toISO()}toString(){return this.toISO()}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Duration { values: ${JSON.stringify(this.values)} }`:`Duration { Invalid, reason: ${this.invalidReason} }`}toMillis(){return this.isValid?cb(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(a){if(!this.isValid)return this;let b=ce.fromDurationLike(a),c={};for(let a of b8)(aR(b.values,a)||aR(this.values,a))&&(c[a]=b.get(a)+this.get(a));return ca(this,{values:c},!0)}minus(a){if(!this.isValid)return this;let b=ce.fromDurationLike(a);return this.plus(b.negate())}mapUnits(a){if(!this.isValid)return this;let b={};for(let c of Object.keys(this.values))b[c]=a6(a(this.values[c],c));return ca(this,{values:b},!0)}get(a){return this[ce.normalizeUnit(a)]}set(a){return this.isValid?ca(this,{values:{...this.values,...a7(a,ce.normalizeUnit)}}):this}reconfigure({locale:a,numberingSystem:b,conversionAccuracy:c,matrix:d}={}){return ca(this,{loc:this.loc.clone({locale:a,numberingSystem:b}),matrix:d,conversionAccuracy:c})}as(a){return this.isValid?this.shiftTo(a).get(a):NaN}normalize(){if(!this.isValid)return this;let a=this.toObject();return cc(this.matrix,a),ca(this,{values:a},!0)}rescale(){return this.isValid?ca(this,{values:cd(this.normalize().shiftToAll().toObject())},!0):this}shiftTo(...a){let b;if(!this.isValid||0===a.length)return this;a=a.map(a=>ce.normalizeUnit(a));let c={},d={},e=this.toObject();for(let f of b8)if(a.indexOf(f)>=0){b=f;let a=0;for(let b in d)a+=this.matrix[b][f]*d[b],d[b]=0;aM(e[f])&&(a+=e[f]);let g=Math.trunc(a);c[f]=g,d[f]=(1e3*a-1e3*g)/1e3}else aM(e[f])&&(d[f]=e[f]);for(let a in d)0!==d[a]&&(c[b]+=a===b?d[a]:d[a]/this.matrix[b][a]);return cc(this.matrix,c),ca(this,{values:c},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;let a={};for(let b of Object.keys(this.values))a[b]=0===this.values[b]?0:-this.values[b];return ca(this,{values:a},!0)}removeZeros(){return this.isValid?ca(this,{values:cd(this.values)},!0):this}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(a){if(!this.isValid||!a.isValid||!this.loc.equals(a.loc))return!1;for(let d of b8){var b,c;if(b=this.values[d],c=a.values[d],void 0===b||0===b?void 0!==c&&0!==c:b!==c)return!1}return!0}}let cf="Invalid Interval";class cg{constructor(a){this.s=a.start,this.e=a.end,this.invalid=a.invalid||null,this.isLuxonInterval=!0}static invalid(a,b=null){if(!a)throw new k("need to specify a reason the Interval is invalid");let c=a instanceof ax?a:new ax(a,b);if(!aw.throwOnInvalid)return new cg({invalid:c});throw new g(c)}static fromDateTimes(a,b){var c,d;let e=cX(a),f=cX(b),g=(c=e,d=f,c&&c.isValid?d&&d.isValid?d<c?cg.invalid("end before start",`The end of an interval must be after its start, but you had start=${c.toISO()} and end=${d.toISO()}`):null:cg.invalid("missing or invalid end"):cg.invalid("missing or invalid start"));return null==g?new cg({start:e,end:f}):g}static after(a,b){let c=ce.fromDurationLike(b),d=cX(a);return cg.fromDateTimes(d,d.plus(c))}static before(a,b){let c=ce.fromDurationLike(b),d=cX(a);return cg.fromDateTimes(d.minus(c),d)}static fromISO(a,b){let[c,d]=(a||"").split("/",2);if(c&&d){let a,e,f,g;try{e=(a=cW.fromISO(c,b)).isValid}catch(a){e=!1}try{g=(f=cW.fromISO(d,b)).isValid}catch(a){g=!1}if(e&&g)return cg.fromDateTimes(a,f);if(e){let c=ce.fromISO(d,b);if(c.isValid)return cg.after(a,c)}else if(g){let a=ce.fromISO(c,b);if(a.isValid)return cg.before(f,a)}}return cg.invalid("unparsable",`the input "${a}" can't be parsed as ISO 8601`)}static isInterval(a){return a&&a.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get lastDateTime(){return this.isValid&&this.e?this.e.minus(1):null}get isValid(){return null===this.invalidReason}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(a="milliseconds"){return this.isValid?this.toDuration(a).get(a):NaN}count(a="milliseconds",b){let c;if(!this.isValid)return NaN;let d=this.start.startOf(a,b);return Math.floor((c=(c=null!=b&&b.useLocaleWeeks?this.end.reconfigure({locale:d.locale}):this.end).startOf(a,b)).diff(d,a).get(a))+(c.valueOf()!==this.end.valueOf())}hasSame(a){return!!this.isValid&&(this.isEmpty()||this.e.minus(1).hasSame(this.s,a))}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(a){return!!this.isValid&&this.s>a}isBefore(a){return!!this.isValid&&this.e<=a}contains(a){return!!this.isValid&&this.s<=a&&this.e>a}set({start:a,end:b}={}){return this.isValid?cg.fromDateTimes(a||this.s,b||this.e):this}splitAt(...a){if(!this.isValid)return[];let b=a.map(cX).filter(a=>this.contains(a)).sort((a,b)=>a.toMillis()-b.toMillis()),c=[],{s:d}=this,e=0;for(;d<this.e;){let a=b[e]||this.e,f=+a>+this.e?this.e:a;c.push(cg.fromDateTimes(d,f)),d=f,e+=1}return c}splitBy(a){let b=ce.fromDurationLike(a);if(!this.isValid||!b.isValid||0===b.as("milliseconds"))return[];let{s:c}=this,d=1,e,f=[];for(;c<this.e;){let a=this.start.plus(b.mapUnits(a=>a*d));e=+a>+this.e?this.e:a,f.push(cg.fromDateTimes(c,e)),c=e,d+=1}return f}divideEqually(a){return this.isValid?this.splitBy(this.length()/a).slice(0,a):[]}overlaps(a){return this.e>a.s&&this.s<a.e}abutsStart(a){return!!this.isValid&&+this.e==+a.s}abutsEnd(a){return!!this.isValid&&+a.e==+this.s}engulfs(a){return!!this.isValid&&this.s<=a.s&&this.e>=a.e}equals(a){return!!this.isValid&&!!a.isValid&&this.s.equals(a.s)&&this.e.equals(a.e)}intersection(a){if(!this.isValid)return this;let b=this.s>a.s?this.s:a.s,c=this.e<a.e?this.e:a.e;return b>=c?null:cg.fromDateTimes(b,c)}union(a){if(!this.isValid)return this;let b=this.s<a.s?this.s:a.s,c=this.e>a.e?this.e:a.e;return cg.fromDateTimes(b,c)}static merge(a){let[b,c]=a.sort((a,b)=>a.s-b.s).reduce(([a,b],c)=>b?b.overlaps(c)||b.abutsStart(c)?[a,b.union(c)]:[a.concat([b]),c]:[a,c],[[],null]);return c&&b.push(c),b}static xor(a){let b=null,c=0,d=[],e=a.map(a=>[{time:a.s,type:"s"},{time:a.e,type:"e"}]);for(let a of Array.prototype.concat(...e).sort((a,b)=>a.time-b.time))1===(c+="s"===a.type?1:-1)?b=a.time:(b&&+b!=+a.time&&d.push(cg.fromDateTimes(b,a.time)),b=null);return cg.merge(d)}difference(...a){return cg.xor([this].concat(a)).map(a=>this.intersection(a)).filter(a=>a&&!a.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} – ${this.e.toISO()})`:cf}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Interval { start: ${this.s.toISO()}, end: ${this.e.toISO()} }`:`Interval { Invalid, reason: ${this.invalidReason} }`}toLocaleString(a=p,b={}){return this.isValid?bp.create(this.s.loc.clone(b),a).formatInterval(this):cf}toISO(a){return this.isValid?`${this.s.toISO(a)}/${this.e.toISO(a)}`:cf}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:cf}toISOTime(a){return this.isValid?`${this.s.toISOTime(a)}/${this.e.toISOTime(a)}`:cf}toFormat(a,{separator:b=" – "}={}){return this.isValid?`${this.s.toFormat(a)}${b}${this.e.toFormat(a)}`:cf}toDuration(a,b){return this.isValid?this.e.diff(this.s,a,b):ce.invalid(this.invalidReason)}mapEndpoints(a){return cg.fromDateTimes(a(this.s),a(this.e))}}class ch{static hasDST(a=aw.defaultZone){let b=cW.now().setZone(a).set({month:12});return!a.isUniversal&&b.offset!==b.set({month:6}).offset}static isValidIANAZone(a){return R.isValidZone(a)}static normalizeZone(a){return ai(a,aw.defaultZone)}static getStartOfWeek({locale:a=null,locObj:b=null}={}){return(b||ae.create(a)).getStartOfWeek()}static getMinimumDaysInFirstWeek({locale:a=null,locObj:b=null}={}){return(b||ae.create(a)).getMinDaysInFirstWeek()}static getWeekendWeekdays({locale:a=null,locObj:b=null}={}){return(b||ae.create(a)).getWeekendDays().slice()}static months(a="long",{locale:b=null,numberingSystem:c=null,locObj:d=null,outputCalendar:e="gregory"}={}){return(d||ae.create(b,c,e)).months(a)}static monthsFormat(a="long",{locale:b=null,numberingSystem:c=null,locObj:d=null,outputCalendar:e="gregory"}={}){return(d||ae.create(b,c,e)).months(a,!0)}static weekdays(a="long",{locale:b=null,numberingSystem:c=null,locObj:d=null}={}){return(d||ae.create(b,c,null)).weekdays(a)}static weekdaysFormat(a="long",{locale:b=null,numberingSystem:c=null,locObj:d=null}={}){return(d||ae.create(b,c,null)).weekdays(a,!0)}static meridiems({locale:a=null}={}){return ae.create(a).meridiems()}static eras(a="short",{locale:b=null}={}){return ae.create(b,null,"gregory").eras(a)}static features(){return{relative:aO(),localeWeek:aP()}}}function ci(a,b){let c=a=>a.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),d=c(b)-c(a);return Math.floor(ce.fromMillis(d).as("days"))}function cj(a,b=a=>a){return{regex:a,deser:([a])=>b(function(a){let b=parseInt(a,10);if(!isNaN(b))return b;b="";for(let c=0;c<a.length;c++){let d=a.charCodeAt(c);if(-1!==a[c].search(aj.hanidec))b+=al.indexOf(a[c]);else for(let a in ak){let[c,e]=ak[a];d>=c&&d<=e&&(b+=d-c)}}return parseInt(b,10)}(a))}}let ck=String.fromCharCode(160),cl=`[ ${ck}]`,cm=RegExp(cl,"g");function cn(a){return a.replace(/\./g,"\\.?").replace(cm,cl)}function co(a){return a.replace(/\./g,"").replace(cm," ").toLowerCase()}function cp(a,b){return null===a?null:{regex:RegExp(a.map(cn).join("|")),deser:([c])=>a.findIndex(a=>co(c)===co(a))+b}}function cq(a,b){return{regex:a,deser:([,a,b])=>a5(a,b),groups:b}}function cr(a){return{regex:a,deser:([a])=>a}}let cs={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}},ct=null;function cu(a,b){return Array.prototype.concat(...a.map(a=>(function(a,b){if(a.literal)return a;let c=cx(bp.macroTokenToFormatOpts(a.val),b);return null==c||c.includes(void 0)?a:c})(a,b)))}class cv{constructor(a,b){if(this.locale=a,this.format=b,this.tokens=cu(bp.parseFormat(b),a),this.units=this.tokens.map(b=>{let c,d,e,f,g,h,i,j,k,l,m,n,o;return c=an(a),d=an(a,"{2}"),e=an(a,"{3}"),f=an(a,"{4}"),g=an(a,"{6}"),h=an(a,"{1,2}"),i=an(a,"{1,3}"),j=an(a,"{1,6}"),k=an(a,"{1,9}"),l=an(a,"{2,4}"),m=an(a,"{4,6}"),n=a=>({regex:RegExp(a.val.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")),deser:([a])=>a,literal:!0}),(o=(o=>{if(b.literal)return n(o);switch(o.val){case"G":return cp(a.eras("short"),0);case"GG":return cp(a.eras("long"),0);case"y":return cj(j);case"yy":case"kk":return cj(l,a3);case"yyyy":case"kkkk":return cj(f);case"yyyyy":return cj(m);case"yyyyyy":return cj(g);case"M":case"L":case"d":case"H":case"h":case"m":case"q":case"s":case"W":return cj(h);case"MM":case"LL":case"dd":case"HH":case"hh":case"mm":case"qq":case"ss":case"WW":return cj(d);case"MMM":return cp(a.months("short",!0),1);case"MMMM":return cp(a.months("long",!0),1);case"LLL":return cp(a.months("short",!1),1);case"LLLL":return cp(a.months("long",!1),1);case"o":case"S":return cj(i);case"ooo":case"SSS":return cj(e);case"u":return cr(k);case"uu":return cr(h);case"uuu":case"E":case"c":return cj(c);case"a":return cp(a.meridiems(),0);case"EEE":return cp(a.weekdays("short",!1),1);case"EEEE":return cp(a.weekdays("long",!1),1);case"ccc":return cp(a.weekdays("short",!0),1);case"cccc":return cp(a.weekdays("long",!0),1);case"Z":case"ZZ":return cq(RegExp(`([+-]${h.source})(?::(${d.source}))?`),2);case"ZZZ":return cq(RegExp(`([+-]${h.source})(${d.source})?`),2);case"z":return cr(/[a-z_+-/]{1,256}?/i);case" ":return cr(/[^\S\n\r]/);default:return n(o)}})(b)||{invalidReason:"missing Intl.DateTimeFormat.formatToParts support"}).token=b,o}),this.disqualifyingUnit=this.units.find(a=>a.invalidReason),!this.disqualifyingUnit){const[a,b]=function(a){let b=a.map(a=>a.regex).reduce((a,b)=>`${a}(${b.source})`,"");return[`^${b}$`,a]}(this.units);this.regex=RegExp(a,"i"),this.handlers=b}}explainFromTokens(a){if(!this.isValid)return{input:a,tokens:this.tokens,invalidReason:this.invalidReason};{let b,c,[d,e]=function(a,b,c){let d=a.match(b);if(!d)return[d,{}];{let a={},b=1;for(let e in c)if(aR(c,e)){let f=c[e],g=f.groups?f.groups+1:1;!f.literal&&f.token&&(a[f.token.val[0]]=f.deser(d.slice(b,b+g))),b+=g}return[d,a]}}(a,this.regex,this.handlers),[f,g,h]=e?(c=null,aL(e.z)||(c=R.create(e.z)),aL(e.Z)||(c||(c=new ag(e.Z)),b=e.Z),aL(e.q)||(e.M=(e.q-1)*3+1),aL(e.h)||(e.h<12&&1===e.a?e.h+=12:12===e.h&&0===e.a&&(e.h=0)),0===e.G&&e.y&&(e.y=-e.y),aL(e.u)||(e.S=aX(e.u)),[Object.keys(e).reduce((a,b)=>{let c=(a=>{switch(a){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}})(b);return c&&(a[c]=e[b]),a},{}),c,b]):[null,null,void 0];if(aR(e,"a")&&aR(e,"H"))throw new i("Can't include meridiem when specifying 24-hour format");return{input:a,tokens:this.tokens,regex:this.regex,rawMatches:d,matches:e,result:f,zone:g,specificOffset:h}}}get isValid(){return!this.disqualifyingUnit}get invalidReason(){return this.disqualifyingUnit?this.disqualifyingUnit.invalidReason:null}}function cw(a,b,c){return new cv(a,c).explainFromTokens(b)}function cx(a,b){if(!a)return null;let c=bp.create(b,a).dtFormatter((ct||(ct=cW.fromMillis(0x16a2e5618e3)),ct)),d=c.formatToParts(),e=c.resolvedOptions();return d.map(b=>(function(a,b,c){let{type:d,value:e}=a;if("literal"===d){let a=/^\s+$/.test(e);return{literal:!a,val:a?" ":e}}let f=b[d],g=d;"hour"===d&&(g=null!=b.hour12?b.hour12?"hour12":"hour24":null!=b.hourCycle?"h11"===b.hourCycle||"h12"===b.hourCycle?"hour12":"hour24":c.hour12?"hour12":"hour24");let h=cs[g];if("object"==typeof h&&(h=h[f]),h)return{literal:!1,val:h}})(b,a,e))}let cy="Invalid DateTime";function cz(a){return new ax("unsupported zone",`the zone "${a.name}" is not supported`)}function cA(a){return null===a.weekData&&(a.weekData=aE(a.c)),a.weekData}function cB(a){return null===a.localWeekData&&(a.localWeekData=aE(a.c,a.loc.getMinDaysInFirstWeek(),a.loc.getStartOfWeek())),a.localWeekData}function cC(a,b){let c={ts:a.ts,zone:a.zone,c:a.c,o:a.o,loc:a.loc,invalid:a.invalid};return new cW({...c,...b,old:c})}function cD(a,b,c){let d=a-60*b*1e3,e=c.offset(d);if(b===e)return[d,b];d-=(e-b)*6e4;let f=c.offset(d);return e===f?[d,e]:[a-60*Math.min(e,f)*1e3,Math.max(e,f)]}function cE(a,b){let c=new Date(a+=60*b*1e3);return{year:c.getUTCFullYear(),month:c.getUTCMonth()+1,day:c.getUTCDate(),hour:c.getUTCHours(),minute:c.getUTCMinutes(),second:c.getUTCSeconds(),millisecond:c.getUTCMilliseconds()}}function cF(a,b){let c=a.o,d=a.c.year+Math.trunc(b.years),e=a.c.month+Math.trunc(b.months)+3*Math.trunc(b.quarters),f={...a.c,year:d,month:e,day:Math.min(a.c.day,a_(d,e))+Math.trunc(b.days)+7*Math.trunc(b.weeks)},g=ce.fromObject({years:b.years-Math.trunc(b.years),quarters:b.quarters-Math.trunc(b.quarters),months:b.months-Math.trunc(b.months),weeks:b.weeks-Math.trunc(b.weeks),days:b.days-Math.trunc(b.days),hours:b.hours,minutes:b.minutes,seconds:b.seconds,milliseconds:b.milliseconds}).as("milliseconds"),[h,i]=cD(a0(f),c,a.zone);return 0!==g&&(h+=g,i=a.zone.offset(h)),{ts:h,o:i}}function cG(a,b,c,d,e,f){let{setZone:g,zone:h}=c;if((!a||0===Object.keys(a).length)&&!b)return cW.invalid(new ax("unparsable",`the input "${e}" can't be parsed as ${d}`));{let d=cW.fromObject(a,{...c,zone:b||h,specificOffset:f});return g?d:d.setZone(h)}}function cH(a,b,c=!0){return a.isValid?bp.create(ae.create("en-US"),{allowZ:c,forceSimple:!0}).formatDateTimeFromString(a,b):null}function cI(a,b,c){let d=a.c.year>9999||a.c.year<0,e="";if(d&&a.c.year>=0&&(e+="+"),e+=aU(a.c.year,d?6:4),"year"===c)return e;if(b){if(e+="-",e+=aU(a.c.month),"month"===c)return e;e+="-"}else if(e+=aU(a.c.month),"month"===c)return e;return e+aU(a.c.day)}function cJ(a,b,c,d,e,f,g){let h=!c||0!==a.c.millisecond||0!==a.c.second,i="";switch(g){case"day":case"month":case"year":break;default:if(i+=aU(a.c.hour),"hour"===g)break;if(b){if(i+=":",i+=aU(a.c.minute),"minute"===g)break;h&&(i+=":",i+=aU(a.c.second))}else{if(i+=aU(a.c.minute),"minute"===g)break;h&&(i+=aU(a.c.second))}if("second"===g)break;h&&(!d||0!==a.c.millisecond)&&(i+=".",i+=aU(a.c.millisecond,3))}return e&&(a.isOffsetFixed&&0===a.offset&&!f?i+="Z":a.o<0?(i+="-",i+=aU(Math.trunc(-a.o/60)),i+=":",i+=aU(Math.trunc(-a.o%60))):(i+="+",i+=aU(Math.trunc(a.o/60)),i+=":",i+=aU(Math.trunc(a.o%60)))),f&&(i+="["+a.zone.ianaName+"]"),i}let cK={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},cL={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},cM={ordinal:1,hour:0,minute:0,second:0,millisecond:0},cN=["year","month","day","hour","minute","second","millisecond"],cO=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],cP=["year","ordinal","hour","minute","second","millisecond"];function cQ(a){let b={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[a.toLowerCase()];if(!b)throw new j(a);return b}function cR(a){switch(a.toLowerCase()){case"localweekday":case"localweekdays":return"localWeekday";case"localweeknumber":case"localweeknumbers":return"localWeekNumber";case"localweekyear":case"localweekyears":return"localWeekYear";default:return cQ(a)}}function cS(a,b){let c,e,f=ai(b.zone,aw.defaultZone);if(!f.isValid)return cW.invalid(cz(f));let g=ae.fromObject(b);if(aL(a.year))c=aw.now();else{for(let b of cN)aL(a[b])&&(a[b]=cK[b]);let b=aJ(a)||aK(a);if(b)return cW.invalid(b);let g=function(a){if(void 0===d&&(d=aw.now()),"iana"!==a.type)return a.offset(d);let b=a.name,c=cV.get(b);return void 0===c&&(c=a.offset(d),cV.set(b,c)),c}(f);[c,e]=cD(a0(a),g,f)}return new cW({ts:c,zone:f,loc:g,o:e})}function cT(a,b,c){let d=!!aL(c.round)||c.round,e=aL(c.rounding)?"trunc":c.rounding,f=(a,f)=>(a=aY(a,d||c.calendary?0:2,c.calendary?"round":e),b.loc.clone(c).relFormatter(c).format(a,f)),g=d=>c.calendary?b.hasSame(a,d)?0:b.startOf(d).diff(a.startOf(d),d).get(d):b.diff(a,d).get(d);if(c.unit)return f(g(c.unit),c.unit);for(let a of c.units){let b=g(a);if(Math.abs(b)>=1)return f(b,a)}return f(a>b?-0:0,c.units[c.units.length-1])}function cU(a){let b={},c;return a.length>0&&"object"==typeof a[a.length-1]?(b=a[a.length-1],c=Array.from(a).slice(0,a.length-1)):c=Array.from(a),[b,c]}let cV=new Map;class cW{constructor(a){const b=a.zone||aw.defaultZone;let c=a.invalid||(Number.isNaN(a.ts)?new ax("invalid input"):null)||(b.isValid?null:cz(b));this.ts=aL(a.ts)?aw.now():a.ts;let d=null,e=null;if(!c)if(a.old&&a.old.ts===this.ts&&a.old.zone.equals(b))[d,e]=[a.old.c,a.old.o];else{const f=aM(a.o)&&!a.old?a.o:b.offset(this.ts);d=(c=Number.isNaN((d=cE(this.ts,f)).year)?new ax("invalid input"):null)?null:d,e=c?null:f}this._zone=b,this.loc=a.loc||ae.create(),this.invalid=c,this.weekData=null,this.localWeekData=null,this.c=d,this.o=e,this.isLuxonDateTime=!0}static now(){return new cW({})}static local(){let[a,b]=cU(arguments),[c,d,e,f,g,h,i]=b;return cS({year:c,month:d,day:e,hour:f,minute:g,second:h,millisecond:i},a)}static utc(){let[a,b]=cU(arguments),[c,d,e,f,g,h,i]=b;return a.zone=ag.utcInstance,cS({year:c,month:d,day:e,hour:f,minute:g,second:h,millisecond:i},a)}static fromJSDate(a,b={}){let c="[object Date]"===Object.prototype.toString.call(a)?a.valueOf():NaN;if(Number.isNaN(c))return cW.invalid("invalid input");let d=ai(b.zone,aw.defaultZone);return d.isValid?new cW({ts:c,zone:d,loc:ae.fromObject(b)}):cW.invalid(cz(d))}static fromMillis(a,b={}){if(aM(a))if(a<-864e13||a>864e13)return cW.invalid("Timestamp out of range");else return new cW({ts:a,zone:ai(b.zone,aw.defaultZone),loc:ae.fromObject(b)});throw new k(`fromMillis requires a numerical input, but received a ${typeof a} with value ${a}`)}static fromSeconds(a,b={}){if(aM(a))return new cW({ts:1e3*a,zone:ai(b.zone,aw.defaultZone),loc:ae.fromObject(b)});throw new k("fromSeconds requires a numerical input")}static fromObject(a,b={}){var c;let d,e;a=a||{};let f=ai(b.zone,aw.defaultZone);if(!f.isValid)return cW.invalid(cz(f));let g=ae.fromObject(b),h=a7(a,cR),{minDaysInFirstWeek:j,startOfWeek:k}=aI(h,g),l=aw.now(),m=aL(b.specificOffset)?f.offset(l):b.specificOffset,n=!aL(h.ordinal),o=!aL(h.year),p=!aL(h.month)||!aL(h.day),q=o||p,r=h.weekYear||h.weekNumber;if((q||n)&&r)throw new i("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(p&&n)throw new i("Can't mix ordinal dates with month/day");let s=r||h.weekday&&!q,t,u,v=cE(l,m);s?(t=cO,u=cL,v=aE(v,j,k)):n?(t=cP,u=cM,v=aG(v)):(t=cN,u=cK);let w=!1;for(let a of t)aL(h[a])?w?h[a]=u[a]:h[a]=v[a]:w=!0;let x=(s?function(a,b=4,c=1){let d=aN(a.weekYear),e=aT(a.weekNumber,1,a2(a.weekYear,b,c)),f=aT(a.weekday,1,7);return d?e?!f&&aA("weekday",a.weekday):aA("week",a.weekNumber):aA("weekYear",a.weekYear)}(h,j,k):n?(d=aN(h.year),e=aT(h.ordinal,1,a$(h.year)),d?!e&&aA("ordinal",h.ordinal):aA("year",h.year)):aJ(h))||aK(h);if(x)return cW.invalid(x);let[y,z]=(c=s?aF(h,j,k):n?aH(h):h,cD(a0(c),m,f)),A=new cW({ts:y,zone:f,o:z,loc:g});return h.weekday&&q&&a.weekday!==A.weekday?cW.invalid("mismatched weekday",`you can't specify both a weekday of ${h.weekday} and a date of ${A.toISO()}`):A.isValid?A:cW.invalid(A.invalid)}static fromISO(a,b={}){let[c,d]=bt(a,[bU,bY],[bV,bZ],[bW,b$],[bX,b_]);return cG(c,d,b,"ISO 8601",a)}static fromRFC2822(a,b={}){let[c,d]=bt(a.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim(),[bN,bO]);return cG(c,d,b,"RFC 2822",a)}static fromHTTP(a,b={}){let[c,d]=bt(a,[bP,bS],[bQ,bS],[bR,bT]);return cG(c,d,b,"HTTP",b)}static fromFormat(a,b,c={}){if(aL(a)||aL(b))throw new k("fromFormat requires an input string and a format");let{locale:d=null,numberingSystem:e=null}=c,[f,g,h,i]=function(a,b,c){let{result:d,zone:e,specificOffset:f,invalidReason:g}=cw(a,b,c);return[d,e,f,g]}(ae.fromOpts({locale:d,numberingSystem:e,defaultToEN:!0}),a,b);return i?cW.invalid(i):cG(f,g,c,`format ${b}`,a,h)}static fromString(a,b,c={}){return cW.fromFormat(a,b,c)}static fromSQL(a,b={}){let[c,d]=bt(a,[b1,bY],[b2,b3]);return cG(c,d,b,"SQL",a)}static invalid(a,b=null){if(!a)throw new k("need to specify a reason the DateTime is invalid");let c=a instanceof ax?a:new ax(a,b);if(!aw.throwOnInvalid)return new cW({invalid:c});throw new f(c)}static isDateTime(a){return a&&a.isLuxonDateTime||!1}static parseFormatForOpts(a,b={}){let c=cx(a,ae.fromObject(b));return c?c.map(a=>a?a.val:null).join(""):null}static expandFormat(a,b={}){return cu(bp.parseFormat(a),ae.fromObject(b)).map(a=>a.val).join("")}static resetCache(){d=void 0,cV.clear()}get(a){return this[a]}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?cA(this).weekYear:NaN}get weekNumber(){return this.isValid?cA(this).weekNumber:NaN}get weekday(){return this.isValid?cA(this).weekday:NaN}get isWeekend(){return this.isValid&&this.loc.getWeekendDays().includes(this.weekday)}get localWeekday(){return this.isValid?cB(this).weekday:NaN}get localWeekNumber(){return this.isValid?cB(this).weekNumber:NaN}get localWeekYear(){return this.isValid?cB(this).weekYear:NaN}get ordinal(){return this.isValid?aG(this.c).ordinal:NaN}get monthShort(){return this.isValid?ch.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?ch.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?ch.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?ch.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return!this.isOffsetFixed&&(this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset)}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];let a=a0(this.c),b=this.zone.offset(a-864e5),c=this.zone.offset(a+864e5),d=this.zone.offset(a-6e4*b),e=this.zone.offset(a-6e4*c);if(d===e)return[this];let f=a-6e4*d,g=a-6e4*e,h=cE(f,d),i=cE(g,e);return h.hour===i.hour&&h.minute===i.minute&&h.second===i.second&&h.millisecond===i.millisecond?[cC(this,{ts:f}),cC(this,{ts:g})]:[this]}get isInLeapYear(){return aZ(this.year)}get daysInMonth(){return a_(this.year,this.month)}get daysInYear(){return this.isValid?a$(this.year):NaN}get weeksInWeekYear(){return this.isValid?a2(this.weekYear):NaN}get weeksInLocalWeekYear(){return this.isValid?a2(this.localWeekYear,this.loc.getMinDaysInFirstWeek(),this.loc.getStartOfWeek()):NaN}resolvedLocaleOptions(a={}){let{locale:b,numberingSystem:c,calendar:d}=bp.create(this.loc.clone(a),a).resolvedOptions(this);return{locale:b,numberingSystem:c,outputCalendar:d}}toUTC(a=0,b={}){return this.setZone(ag.instance(a),b)}toLocal(){return this.setZone(aw.defaultZone)}setZone(a,{keepLocalTime:b=!1,keepCalendarTime:c=!1}={}){if((a=ai(a,aw.defaultZone)).equals(this.zone))return this;{if(!a.isValid)return cW.invalid(cz(a));let e=this.ts;if(b||c){var d;let b=a.offset(this.ts),c=this.toObject();[e]=(d=a,cD(a0(c),b,d))}return cC(this,{ts:e,zone:a})}}reconfigure({locale:a,numberingSystem:b,outputCalendar:c}={}){return cC(this,{loc:this.loc.clone({locale:a,numberingSystem:b,outputCalendar:c})})}setLocale(a){return this.reconfigure({locale:a})}set(a){var b,c,d;let e;if(!this.isValid)return this;let f=a7(a,cR),{minDaysInFirstWeek:g,startOfWeek:h}=aI(f,this.loc),j=!aL(f.weekYear)||!aL(f.weekNumber)||!aL(f.weekday),k=!aL(f.ordinal),l=!aL(f.year),m=!aL(f.month)||!aL(f.day),n=f.weekYear||f.weekNumber;if((l||m||k)&&n)throw new i("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(m&&k)throw new i("Can't mix ordinal dates with month/day");j?e=aF({...aE(this.c,g,h),...f},g,h):aL(f.ordinal)?(e={...this.toObject(),...f},aL(f.day)&&(e.day=Math.min(a_(e.year,e.month),e.day))):e=aH({...aG(this.c),...f});let[o,p]=(b=e,c=this.o,d=this.zone,cD(a0(b),c,d));return cC(this,{ts:o,o:p})}plus(a){return this.isValid?cC(this,cF(this,ce.fromDurationLike(a))):this}minus(a){return this.isValid?cC(this,cF(this,ce.fromDurationLike(a).negate())):this}startOf(a,{useLocaleWeeks:b=!1}={}){if(!this.isValid)return this;let c={},d=ce.normalizeUnit(a);switch(d){case"years":c.month=1;case"quarters":case"months":c.day=1;case"weeks":case"days":c.hour=0;case"hours":c.minute=0;case"minutes":c.second=0;case"seconds":c.millisecond=0}if("weeks"===d)if(b){let a=this.loc.getStartOfWeek(),{weekday:b}=this;b<a&&(c.weekNumber=this.weekNumber-1),c.weekday=a}else c.weekday=1;return"quarters"===d&&(c.month=(Math.ceil(this.month/3)-1)*3+1),this.set(c)}endOf(a,b){return this.isValid?this.plus({[a]:1}).startOf(a,b).minus(1):this}toFormat(a,b={}){return this.isValid?bp.create(this.loc.redefaultToEN(b)).formatDateTimeFromString(this,a):cy}toLocaleString(a=p,b={}){return this.isValid?bp.create(this.loc.clone(b),a).formatDateTime(this):cy}toLocaleParts(a={}){return this.isValid?bp.create(this.loc.clone(a),a).formatDateTimeParts(this):[]}toISO({format:a="extended",suppressSeconds:b=!1,suppressMilliseconds:c=!1,includeOffset:d=!0,extendedZone:e=!1,precision:f="milliseconds"}={}){if(!this.isValid)return null;f=cQ(f);let g="extended"===a,h=cI(this,g,f);return cN.indexOf(f)>=3&&(h+="T"),h+=cJ(this,g,b,c,d,e,f)}toISODate({format:a="extended",precision:b="day"}={}){return this.isValid?cI(this,"extended"===a,cQ(b)):null}toISOWeekDate(){return cH(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:a=!1,suppressSeconds:b=!1,includeOffset:c=!0,includePrefix:d=!1,extendedZone:e=!1,format:f="extended",precision:g="milliseconds"}={}){return this.isValid?(g=cQ(g),(d&&cN.indexOf(g)>=3?"T":"")+cJ(this,"extended"===f,b,a,c,e,g)):null}toRFC2822(){return cH(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return cH(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?cI(this,!0):null}toSQLTime({includeOffset:a=!0,includeZone:b=!1,includeOffsetSpace:c=!0}={}){let d="HH:mm:ss.SSS";return(b||a)&&(c&&(d+=" "),b?d+="z":a&&(d+="ZZ")),cH(this,d,!0)}toSQL(a={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(a)}`:null}toString(){return this.isValid?this.toISO():cy}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`DateTime { ts: ${this.toISO()}, zone: ${this.zone.name}, locale: ${this.locale} }`:`DateTime { Invalid, reason: ${this.invalidReason} }`}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(a={}){if(!this.isValid)return{};let b={...this.c};return a.includeConfig&&(b.outputCalendar=this.outputCalendar,b.numberingSystem=this.loc.numberingSystem,b.locale=this.loc.locale),b}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(a,b="milliseconds",c={}){if(!this.isValid||!a.isValid)return ce.invalid("created by diffing an invalid DateTime");let d={locale:this.locale,numberingSystem:this.numberingSystem,...c},e=(Array.isArray(b)?b:[b]).map(ce.normalizeUnit),f=a.valueOf()>this.valueOf(),g=function(a,b,c,d){let[e,f,g,h]=function(a,b,c){let d,e,f={},g=a;for(let[h,i]of[["years",(a,b)=>b.year-a.year],["quarters",(a,b)=>b.quarter-a.quarter+(b.year-a.year)*4],["months",(a,b)=>b.month-a.month+(b.year-a.year)*12],["weeks",(a,b)=>{let c=ci(a,b);return(c-c%7)/7}],["days",ci]])c.indexOf(h)>=0&&(d=h,f[h]=i(a,b),(e=g.plus(f))>b?(f[h]--,(a=g.plus(f))>b&&(e=a,f[h]--,a=g.plus(f))):a=e);return[a,f,e,d]}(a,b,c),i=b-e,j=c.filter(a=>["hours","minutes","seconds","milliseconds"].indexOf(a)>=0);0===j.length&&(g<b&&(g=e.plus({[h]:1})),g!==e&&(f[h]=(f[h]||0)+i/(g-e)));let k=ce.fromObject(f,d);return j.length>0?ce.fromMillis(i,d).shiftTo(...j).plus(k):k}(f?this:a,f?a:this,e,d);return f?g.negate():g}diffNow(a="milliseconds",b={}){return this.diff(cW.now(),a,b)}until(a){return this.isValid?cg.fromDateTimes(this,a):this}hasSame(a,b,c){if(!this.isValid)return!1;let d=a.valueOf(),e=this.setZone(a.zone,{keepLocalTime:!0});return e.startOf(b,c)<=d&&d<=e.endOf(b,c)}equals(a){return this.isValid&&a.isValid&&this.valueOf()===a.valueOf()&&this.zone.equals(a.zone)&&this.loc.equals(a.loc)}toRelative(a={}){if(!this.isValid)return null;let b=a.base||cW.fromObject({},{zone:this.zone}),c=a.padding?this<b?-a.padding:a.padding:0,d=["years","months","days","hours","minutes","seconds"],e=a.unit;return Array.isArray(a.unit)&&(d=a.unit,e=void 0),cT(b,this.plus(c),{...a,numeric:"always",units:d,unit:e})}toRelativeCalendar(a={}){return this.isValid?cT(a.base||cW.fromObject({},{zone:this.zone}),this,{...a,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...a){if(!a.every(cW.isDateTime))throw new k("min requires all arguments be DateTimes");return aQ(a,a=>a.valueOf(),Math.min)}static max(...a){if(!a.every(cW.isDateTime))throw new k("max requires all arguments be DateTimes");return aQ(a,a=>a.valueOf(),Math.max)}static fromFormatExplain(a,b,c={}){let{locale:d=null,numberingSystem:e=null}=c;return cw(ae.fromOpts({locale:d,numberingSystem:e,defaultToEN:!0}),a,b)}static fromStringExplain(a,b,c={}){return cW.fromFormatExplain(a,b,c)}static buildFormatParser(a,b={}){let{locale:c=null,numberingSystem:d=null}=b;return new cv(ae.fromOpts({locale:c,numberingSystem:d,defaultToEN:!0}),a)}static fromFormatParser(a,b,c={}){if(aL(a)||aL(b))throw new k("fromFormatParser requires an input string and a format parser");let{locale:d=null,numberingSystem:e=null}=c,f=ae.fromOpts({locale:d,numberingSystem:e,defaultToEN:!0});if(!f.equals(b.locale))throw new k(`fromFormatParser called with a locale of ${f}, but the format parser was created for ${b.locale}`);let{result:g,zone:h,specificOffset:i,invalidReason:j}=b.explainFromTokens(a);return j?cW.invalid(j):cG(g,h,c,`format ${b.format}`,a,i)}static get DATE_SHORT(){return p}static get DATE_MED(){return q}static get DATE_MED_WITH_WEEKDAY(){return r}static get DATE_FULL(){return s}static get DATE_HUGE(){return t}static get TIME_SIMPLE(){return u}static get TIME_WITH_SECONDS(){return v}static get TIME_WITH_SHORT_OFFSET(){return w}static get TIME_WITH_LONG_OFFSET(){return x}static get TIME_24_SIMPLE(){return y}static get TIME_24_WITH_SECONDS(){return z}static get TIME_24_WITH_SHORT_OFFSET(){return A}static get TIME_24_WITH_LONG_OFFSET(){return B}static get DATETIME_SHORT(){return C}static get DATETIME_SHORT_WITH_SECONDS(){return D}static get DATETIME_MED(){return E}static get DATETIME_MED_WITH_SECONDS(){return F}static get DATETIME_MED_WITH_WEEKDAY(){return G}static get DATETIME_FULL(){return H}static get DATETIME_FULL_WITH_SECONDS(){return I}static get DATETIME_HUGE(){return J}static get DATETIME_HUGE_WITH_SECONDS(){return K}}function cX(a){if(cW.isDateTime(a))return a;if(a&&a.valueOf&&aM(a.valueOf()))return cW.fromJSDate(a);if(a&&"object"==typeof a)return cW.fromObject(a);throw new k(`Unknown datetime argument: ${a}, of type ${typeof a}`)}c.DateTime=cW,c.Duration=ce,c.FixedOffsetZone=ag,c.IANAZone=R,c.Info=ch,c.Interval=cg,c.InvalidZone=ah,c.Settings=aw,c.SystemZone=N,c.VERSION="3.7.2",c.Zone=L},893005,(a,b,c)=>{"use strict";var d,e,f,g;Object.defineProperty(c,"__esModule",{value:!0}),c.CronDate=c.DAYS_IN_MONTH=c.DateMathOp=c.TimeUnit=void 0;let h=a.r(892247);(f=d||(c.TimeUnit=d={})).Second="Second",f.Minute="Minute",f.Hour="Hour",f.Day="Day",f.Month="Month",f.Year="Year",(g=e||(c.DateMathOp=e={})).Add="Add",g.Subtract="Subtract",c.DAYS_IN_MONTH=Object.freeze([31,29,31,30,31,30,31,31,30,31,30,31]);class i{#f;#g=null;#h=null;#i={add:{[d.Year]:this.addYear.bind(this),[d.Month]:this.addMonth.bind(this),[d.Day]:this.addDay.bind(this),[d.Hour]:this.addHour.bind(this),[d.Minute]:this.addMinute.bind(this),[d.Second]:this.addSecond.bind(this)},subtract:{[d.Year]:this.subtractYear.bind(this),[d.Month]:this.subtractMonth.bind(this),[d.Day]:this.subtractDay.bind(this),[d.Hour]:this.subtractHour.bind(this),[d.Minute]:this.subtractMinute.bind(this),[d.Second]:this.subtractSecond.bind(this)}};constructor(a,b){const c={zone:b};if(a?a instanceof i?(this.#f=a.#f,this.#g=a.#g,this.#h=a.#h):a instanceof Date?this.#f=h.DateTime.fromJSDate(a,c):"number"==typeof a?this.#f=h.DateTime.fromMillis(a,c):(this.#f=h.DateTime.fromISO(a,c),this.#f.isValid||(this.#f=h.DateTime.fromRFC2822(a,c)),this.#f.isValid||(this.#f=h.DateTime.fromSQL(a,c)),this.#f.isValid||(this.#f=h.DateTime.fromFormat(a,"EEE, d MMM yyyy HH:mm:ss",c))):this.#f=h.DateTime.local(),!this.#f.isValid)throw Error(`CronDate: unhandled timestamp: ${a}`);b&&b!==this.#f.zoneName&&(this.#f=this.#f.setZone(b))}static #j(a){return a%4==0&&a%100!=0||a%400==0}get dstStart(){return this.#g}set dstStart(a){this.#g=a}get dstEnd(){return this.#h}set dstEnd(a){this.#h=a}addYear(){this.#f=this.#f.plus({years:1})}addMonth(){this.#f=this.#f.plus({months:1}).startOf("month")}addDay(){this.#f=this.#f.plus({days:1}).startOf("day")}addHour(){this.#f=this.#f.plus({hours:1}).startOf("hour")}addMinute(){this.#f=this.#f.plus({minutes:1}).startOf("minute")}addSecond(){this.#f=this.#f.plus({seconds:1})}subtractYear(){this.#f=this.#f.minus({years:1})}subtractMonth(){this.#f=this.#f.minus({months:1}).endOf("month").startOf("second")}subtractDay(){this.#f=this.#f.minus({days:1}).endOf("day").startOf("second")}subtractHour(){this.#f=this.#f.minus({hours:1}).endOf("hour").startOf("second")}subtractMinute(){this.#f=this.#f.minus({minutes:1}).endOf("minute").startOf("second")}subtractSecond(){this.#f=this.#f.minus({seconds:1})}addUnit(a){this.#i.add[a]()}subtractUnit(a){this.#i.subtract[a]()}invokeDateOperation(a,b){if(a===e.Add)return void this.addUnit(b);if(a===e.Subtract)return void this.subtractUnit(b);throw Error(`Invalid verb: ${a}`)}getDate(){return this.#f.day}getFullYear(){return this.#f.year}getDay(){let a=this.#f.weekday;return 7===a?0:a}getMonth(){return this.#f.month-1}getHours(){return this.#f.hour}getMinutes(){return this.#f.minute}getSeconds(){return this.#f.second}getMilliseconds(){return this.#f.millisecond}getTime(){return this.#f.valueOf()}getUTCDate(){return this.#k().day}getUTCFullYear(){return this.#k().year}getUTCDay(){let a=this.#k().weekday;return 7===a?0:a}getUTCMonth(){return this.#k().month-1}getUTCHours(){return this.#k().hour}getUTCMinutes(){return this.#k().minute}getUTCSeconds(){return this.#k().second}toISOString(){return this.#f.toUTC().toISO()}toJSON(){return this.#f.toJSON()}setDate(a){this.#f=this.#f.set({day:a})}setFullYear(a){this.#f=this.#f.set({year:a})}setDay(a){this.#f=this.#f.set({weekday:a})}setMonth(a){this.#f=this.#f.set({month:a+1})}setHours(a){this.#f=this.#f.set({hour:a})}setMinutes(a){this.#f=this.#f.set({minute:a})}setSeconds(a){this.#f=this.#f.set({second:a})}setMilliseconds(a){this.#f=this.#f.set({millisecond:a})}toString(){return this.toDate().toString()}toDate(){return this.#f.toJSDate()}isLastDayOfMonth(){let{day:a,month:b}=this.#f;if(2===b){let d=i.#j(this.#f.year);return a===c.DAYS_IN_MONTH[b-1]-!d}return a===c.DAYS_IN_MONTH[b-1]}isLastWeekdayOfMonth(){let{day:a,month:b}=this.#f;return a>(2===b?c.DAYS_IN_MONTH[b-1]-!i.#j(this.#f.year):c.DAYS_IN_MONTH[b-1])-7}applyDateOperation(a,b,c){if(b===d.Month||b===d.Day)return void this.invokeDateOperation(a,b);let e=this.getHours();this.invokeDateOperation(a,b);let f=this.getHours(),g=f-e;2===g?24!==c&&(this.dstStart=f):0===g&&0===this.getMinutes()&&0===this.getSeconds()&&24!==c&&(this.dstEnd=f)}#k(){return this.#f.toUTC()}}c.CronDate=i,c.default=i},593187,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.CronMonth=void 0;let d=a.r(893005),e=a.r(977556),f=Object.freeze([]);class g extends e.CronField{static get min(){return 1}static get max(){return 12}static get chars(){return f}static get daysInMonth(){return d.DAYS_IN_MONTH}constructor(a,b){super(a,b),this.validate()}get values(){return super.values}}c.CronMonth=g},743383,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.CronSecond=void 0;let d=a.r(977556),e=Object.freeze([]);class f extends d.CronField{static get min(){return 0}static get max(){return 59}static get chars(){return e}constructor(a,b){super(a,b),this.validate()}get values(){return super.values}}c.CronSecond=f},451160,(a,b,c)=>{"use strict";var d=a.e&&a.e.__createBinding||(Object.create?function(a,b,c,d){void 0===d&&(d=c);var e=Object.getOwnPropertyDescriptor(b,c);(!e||("get"in e?!b.__esModule:e.writable||e.configurable))&&(e={enumerable:!0,get:function(){return b[c]}}),Object.defineProperty(a,d,e)}:function(a,b,c,d){void 0===d&&(d=c),a[d]=b[c]}),e=a.e&&a.e.__exportStar||function(a,b){for(var c in a)"default"===c||Object.prototype.hasOwnProperty.call(b,c)||d(b,a,c)};Object.defineProperty(c,"__esModule",{value:!0}),e(a.r(330196),c),e(a.r(118514),c),e(a.r(553702),c),e(a.r(977556),c),e(a.r(785743),c),e(a.r(60948),c),e(a.r(593187),c),e(a.r(743383),c)},637958,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.CronFieldCollection=void 0;let d=a.r(451160);class e{#l;#m;#n;#o;#p;#q;static from(a,b){return new e({second:this.resolveField(d.CronSecond,a.second,b.second),minute:this.resolveField(d.CronMinute,a.minute,b.minute),hour:this.resolveField(d.CronHour,a.hour,b.hour),dayOfMonth:this.resolveField(d.CronDayOfMonth,a.dayOfMonth,b.dayOfMonth),month:this.resolveField(d.CronMonth,a.month,b.month),dayOfWeek:this.resolveField(d.CronDayOfWeek,a.dayOfWeek,b.dayOfWeek)})}static resolveField(a,b,c){return c?c instanceof d.CronField?c:new a(c):b}constructor({second:a,minute:b,hour:c,dayOfMonth:e,month:f,dayOfWeek:g}){if(!a)throw Error("Validation error, Field second is missing");if(!b)throw Error("Validation error, Field minute is missing");if(!c)throw Error("Validation error, Field hour is missing");if(!e)throw Error("Validation error, Field dayOfMonth is missing");if(!f)throw Error("Validation error, Field month is missing");if(!g)throw Error("Validation error, Field dayOfWeek is missing");if(1===f.values.length&&!e.hasLastChar&&!(parseInt(e.values[0],10)<=d.CronMonth.daysInMonth[f.values[0]-1]))throw Error("Invalid explicit day of month definition");this.#l=a,this.#m=b,this.#n=c,this.#p=f,this.#q=g,this.#o=e}get second(){return this.#l}get minute(){return this.#m}get hour(){return this.#n}get dayOfMonth(){return this.#o}get month(){return this.#p}get dayOfWeek(){return this.#q}static compactField(a){let b;if(0===a.length)return[];let c=[];return a.forEach((a,d,e)=>{if(void 0===b){b={start:a,count:1};return}let f=e[d-1]||b.start,g=e[d+1];if("L"===a||"W"===a){c.push(b),c.push({start:a,count:1}),b=void 0;return}if(void 0===b.step&&void 0!==g){let c=a-f;if(c<=g-a){b={...b,count:2,end:a,step:c};return}b.step=1}a-(b.end??0)===b.step?(b.count++,b.end=a):(1===b.count?c.push({start:b.start,count:1}):2===b.count?(c.push({start:b.start,count:1}),c.push({start:b.end??f,count:1})):c.push(b),b={start:a,count:1})}),b&&c.push(b),c}static #r(a,b,c){let d=b.step;return d?1===d&&b.start===a.min&&b.end&&b.end>=c?a.hasQuestionMarkChar?"?":"*":1!==d&&b.start===a.min&&b.end&&b.end>=c-d+1?`*/${d}`:null:null}static #s(a,b){let c=a.step;if(1===c)return`${a.start}-${a.end}`;let d=0===a.start?a.count-1:a.count;if(!c)throw Error("Unexpected range step");if(!a.end)throw Error("Unexpected range end");if(c*d>a.end){if("number"!=typeof a.start)throw Error("Unexpected range start");return Array.from({length:a.end-a.start+1},(b,d)=>{if("number"!=typeof a.start)throw Error("Unexpected range start");return d%c==0?a.start+d:null}).filter(a=>null!==a).join(",")}return a.end===b-c+1?`${a.start}/${c}`:`${a.start}-${a.end}/${c}`}stringifyField(a){let b=a.max,c=a.values;if(a instanceof d.CronDayOfWeek){b=6;let a=this.#q.values;c=7===a[a.length-1]?a.slice(0,-1):a}a instanceof d.CronDayOfMonth&&(b=1===this.#p.values.length?d.CronMonth.daysInMonth[this.#p.values[0]-1]:a.max);let f=e.compactField(c);if(1===f.length){let c=e.#r(a,f[0],b);if(c)return c}return f.map(c=>{let f=1===c.count?c.start.toString():e.#s(c,b);return a instanceof d.CronDayOfWeek&&a.nthDay>0?`${f}#${a.nthDay}`:f}).join(",")}stringify(a=!1){let b=[];return a&&b.push(this.stringifyField(this.#l)),b.push(this.stringifyField(this.#m),this.stringifyField(this.#n),this.stringifyField(this.#o),this.stringifyField(this.#p),this.stringifyField(this.#q)),b.join(" ")}serialize(){return{second:this.#l.serialize(),minute:this.#m.serialize(),hour:this.#n.serialize(),dayOfMonth:this.#o.serialize(),month:this.#p.serialize(),dayOfWeek:this.#q.serialize()}}}c.CronFieldCollection=e},244015,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.CronExpression=c.LOOPS_LIMIT_EXCEEDED_ERROR_MESSAGE=c.TIME_SPAN_OUT_OF_BOUNDS_ERROR_MESSAGE=void 0;let d=a.r(893005);c.TIME_SPAN_OUT_OF_BOUNDS_ERROR_MESSAGE="Out of the time span range",c.LOOPS_LIMIT_EXCEEDED_ERROR_MESSAGE="Invalid expression, loop limit exceeded";class e{#t;#u;#v;#w;#x;#y;constructor(a,b){this.#t=b,this.#u=b.tz,this.#w=b.startDate?new d.CronDate(b.startDate,this.#u):null,this.#x=b.endDate?new d.CronDate(b.endDate,this.#u):null;let c=b.currentDate??b.startDate;if(c){const a=new d.CronDate(c,this.#u);this.#w&&a.getTime()<this.#w.getTime()?c=this.#w:this.#x&&a.getTime()>this.#x.getTime()&&(c=this.#x)}this.#v=new d.CronDate(c,this.#u),this.#y=a}get fields(){return this.#y}static fieldsToExpression(a,b){return new e(a,b||{})}static #z(a,b){return b.some(b=>b===a)}static #A(a,b){let c=b.isLastWeekdayOfMonth();return a.some(a=>{let d=parseInt(a.toString().charAt(0),10)%7;if(Number.isNaN(d))throw Error(`Invalid last weekday of the month expression: ${a}`);return b.getDay()===d&&c})}next(){return this.#B()}prev(){return this.#B(!0)}hasNext(){let a=this.#v;try{return this.#B(),!0}catch{return!1}finally{this.#v=a}}hasPrev(){let a=this.#v;try{return this.#B(!0),!0}catch{return!1}finally{this.#v=a}}take(a){let b=[];if(a>=0)for(let c=0;c<a;c++)try{b.push(this.next())}catch{break}else for(let c=0;c>a;c--)try{b.push(this.prev())}catch{break}return b}reset(a){this.#v=new d.CronDate(a||this.#t.currentDate)}stringify(a=!1){return this.#y.stringify(a)}includesDate(a){let{second:b,minute:c,hour:e,month:f}=this.#y,g=new d.CronDate(a,this.#u);return!!b.values.includes(g.getSeconds())&&!!c.values.includes(g.getMinutes())&&!!e.values.includes(g.getHours())&&!!f.values.includes(g.getMonth()+1)&&!!this.#C(g)&&(!(this.#y.dayOfWeek.nthDay>0)||Math.ceil(g.getDate()/7)===this.#y.dayOfWeek.nthDay)&&!0}toString(){return this.#t.expression||this.stringify(!0)}#C(a){let b=this.#y.dayOfMonth.isWildcard,c=this.#y.dayOfWeek.isWildcard,d=!c,f=e.#z(a.getDate(),this.#y.dayOfMonth.values)||this.#y.dayOfMonth.hasLastChar&&a.isLastDayOfMonth(),g=e.#z(a.getDay(),this.#y.dayOfWeek.values)||this.#y.dayOfWeek.hasLastChar&&e.#A(this.#y.dayOfWeek.values,a);return!b&&!!d&&(!!f||!!g)||!!f&&!d||!!b&&!c&&!!g}#D(a,b,c){let f=a.getHours(),g=e.#z(f,this.#y.hour.values),h=a.dstStart===f,i=a.dstEnd===f;return g||h?h&&!e.#z(f-1,this.#y.hour.values)?(a.invokeDateOperation(b,d.TimeUnit.Hour),!1):!i||!!c||(a.dstEnd=null,a.applyDateOperation(d.DateMathOp.Add,d.TimeUnit.Hour,this.#y.hour.values.length),!1):(a.dstStart=null,a.applyDateOperation(b,d.TimeUnit.Hour,this.#y.hour.values.length),!1)}#E(a){if(!this.#w&&!this.#x)return;let b=a.getTime();if(this.#w&&b<this.#w.getTime()||this.#x&&b>this.#x.getTime())throw Error(c.TIME_SPAN_OUT_OF_BOUNDS_ERROR_MESSAGE)}#B(a=!1){let b=a?d.DateMathOp.Subtract:d.DateMathOp.Add,f=new d.CronDate(this.#v),g=f.getTime(),h=0;for(;++h<1e4;){if(this.#E(f),!this.#C(f)||!(this.#y.dayOfWeek.nthDay<=0||Math.ceil(f.getDate()/7)===this.#y.dayOfWeek.nthDay)){f.applyDateOperation(b,d.TimeUnit.Day,this.#y.hour.values.length);continue}if(!e.#z(f.getMonth()+1,this.#y.month.values)){f.applyDateOperation(b,d.TimeUnit.Month,this.#y.hour.values.length);continue}if(this.#D(f,b,a)){if(!e.#z(f.getMinutes(),this.#y.minute.values)){f.applyDateOperation(b,d.TimeUnit.Minute,this.#y.hour.values.length);continue}if(!e.#z(f.getSeconds(),this.#y.second.values)){f.applyDateOperation(b,d.TimeUnit.Second,this.#y.hour.values.length);continue}if(g===f.getTime()){("Add"===b||0===f.getMilliseconds())&&f.applyDateOperation(b,d.TimeUnit.Second,this.#y.hour.values.length);continue}break}}if(h>1e4)throw Error(c.LOOPS_LIMIT_EXCEEDED_ERROR_MESSAGE);return 0!==f.getMilliseconds()&&f.setMilliseconds(0),this.#v=f,f}[Symbol.iterator](){return{next:()=>({value:this.#B(),done:!this.hasNext()})}}}c.CronExpression=e,c.default=e},530395,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.seededRandom=function(a){var b;return b=a?(function(a){let b=0x811c9dc5;for(let c=0;c<a.length;c++)b^=a.charCodeAt(c),b=Math.imul(b,0x1000193);return()=>b>>>0})(a)():Math.floor(1e10*Math.random()),()=>{let a=b+=0x6d2b79f5;return a=Math.imul(a^a>>>15,1|a),(((a^=a+Math.imul(a^a>>>7,61|a))^a>>>14)>>>0)/0x100000000}}},119866,(a,b,c)=>{"use strict";var d,e,f,g,h,i,j,k;Object.defineProperty(c,"__esModule",{value:!0}),c.CronExpressionParser=c.DayOfWeek=c.Months=c.CronUnit=c.PredefinedExpressions=void 0;let l=a.r(637958),m=a.r(244015),n=a.r(530395),o=a.r(451160);(h=d||(c.PredefinedExpressions=d={}))["@yearly"]="0 0 0 1 1 *",h["@annually"]="0 0 0 1 1 *",h["@monthly"]="0 0 0 1 * *",h["@weekly"]="0 0 0 * * 0",h["@daily"]="0 0 0 * * *",h["@hourly"]="0 0 * * * *",h["@minutely"]="0 * * * * *",h["@secondly"]="* * * * * *",h["@weekdays"]="0 0 0 * * 1-5",h["@weekends"]="0 0 0 * * 0,6",(i=e||(c.CronUnit=e={})).Second="Second",i.Minute="Minute",i.Hour="Hour",i.DayOfMonth="DayOfMonth",i.Month="Month",i.DayOfWeek="DayOfWeek",(j=f||(c.Months=f={}))[j.jan=1]="jan",j[j.feb=2]="feb",j[j.mar=3]="mar",j[j.apr=4]="apr",j[j.may=5]="may",j[j.jun=6]="jun",j[j.jul=7]="jul",j[j.aug=8]="aug",j[j.sep=9]="sep",j[j.oct=10]="oct",j[j.nov=11]="nov",j[j.dec=12]="dec",(k=g||(c.DayOfWeek=g={}))[k.sun=0]="sun",k[k.mon=1]="mon",k[k.tue=2]="tue",k[k.wed=3]="wed",k[k.thu=4]="thu",k[k.fri=5]="fri",k[k.sat=6]="sat";class p{static parse(a,b={}){let{strict:c=!1,hashSeed:f}=b,g=(0,n.seededRandom)(f);a=d[a]||a;let h=p.#F(a,c);if(!("*"===h.dayOfMonth||"*"===h.dayOfWeek||!c))throw Error("Cannot use both dayOfMonth and dayOfWeek together in strict mode!");let i=p.#G(e.Second,h.second,o.CronSecond.constraints,g),j=p.#G(e.Minute,h.minute,o.CronMinute.constraints,g),k=p.#G(e.Hour,h.hour,o.CronHour.constraints,g),q=p.#G(e.Month,h.month,o.CronMonth.constraints,g),r=p.#G(e.DayOfMonth,h.dayOfMonth,o.CronDayOfMonth.constraints,g),{dayOfWeek:s,nthDayOfWeek:t}=p.#H(h.dayOfWeek),u=p.#G(e.DayOfWeek,s,o.CronDayOfWeek.constraints,g),v=new l.CronFieldCollection({second:new o.CronSecond(i,{rawValue:h.second}),minute:new o.CronMinute(j,{rawValue:h.minute}),hour:new o.CronHour(k,{rawValue:h.hour}),dayOfMonth:new o.CronDayOfMonth(r,{rawValue:h.dayOfMonth}),month:new o.CronMonth(q,{rawValue:h.month}),dayOfWeek:new o.CronDayOfWeek(u,{rawValue:h.dayOfWeek,nthDayOfWeek:t})});return new m.CronExpression(v,{...b,expression:a})}static #F(a,b){if(b&&!a.length)throw Error("Invalid cron expression");let c=(a=a||"0 * * * * *").trim().split(/\s+/);if(b&&c.length<6)throw Error("Invalid cron expression, expected 6 fields");if(c.length>6)throw Error("Invalid cron expression, too many fields");let d=["*","*","*","*","*","0"];c.length<d.length&&c.unshift(...d.slice(c.length));let[e,f,g,h,i,j]=c;return{second:e,minute:f,hour:g,dayOfMonth:h,month:i,dayOfWeek:j}}static #G(a,b,c,d){if((a===e.Month||a===e.DayOfWeek)&&(b=b.replace(/[a-z]{3}/gi,a=>{let b=f[a=a.toLowerCase()]||g[a];if(void 0===b)throw Error(`Validation error, cannot resolve alias "${a}"`);return b.toString()})),!c.validChars.test(b))throw Error(`Invalid characters, got value: ${b}`);return b=this.#I(b,c),b=this.#J(b,c,d),this.#K(a,b,c)}static #I(a,b){return a.replace(/[*?]/g,b.min+"-"+b.max)}static #J(a,b,c){let d=c();return a.replace(/H(?:\((\d+)-(\d+)\))?(?:\/(\d+))?/g,(a,c,e,f)=>{if(c&&e&&f){let a=parseInt(c,10),g=parseInt(e,10),h=parseInt(f,10);if(a>g)throw Error(`Invalid range: ${a}-${g}, min > max`);if(h<=0)throw Error(`Invalid step: ${h}, must be positive`);let i=Math.max(a,b.min),j=Math.floor(d*h),k=[];for(let a=Math.floor(i/h)*h+j;a<=g;a+=h)a>=i&&k.push(a);return k.join(",")}if(c&&e){let a=parseInt(c,10),b=parseInt(e,10);if(a>b)throw Error(`Invalid range: ${a}-${b}, min > max`);return String(Math.floor(d*(b-a+1))+a)}if(!f)return String(Math.floor(d*(b.max-b.min+1)+b.min));{let a=parseInt(f,10);if(a<=0)throw Error(`Invalid step: ${a}, must be positive`);let c=Math.floor(d*a),e=[];for(let d=Math.floor(b.min/a)*a+c;d<=b.max;d+=a)d>=b.min&&e.push(d);return e.join(",")}})}static #K(a,b,c){let d=[];return b.split(",").forEach(b=>{if(!(b.length>0))throw Error("Invalid list value format");var f=p.#L(a,b,c);if(Array.isArray(f))d.push(...f);else if(p.#M(c,f))d.push(f);else{let b=parseInt(f.toString(),10);if(!(b>=c.min&&b<=c.max))throw Error(`Constraint error, got value ${f} expected range ${c.min}-${c.max}`);d.push(a===e.DayOfWeek?b%7:f)}}),d}static #L(a,b,c){let d=b.split("/");if(d.length>2)throw Error(`Invalid repeat: ${b}`);return 2===d.length?(isNaN(parseInt(d[0],10))||(d[0]=`${d[0]}-${c.max}`),p.#N(a,d[0],parseInt(d[1],10),c)):p.#N(a,b,1,c)}static #O(a,b,c){if(!(!isNaN(a)&&!isNaN(b)&&a>=c.min&&b<=c.max))throw Error(`Constraint error, got range ${a}-${b} expected range ${c.min}-${c.max}`);if(a>b)throw Error(`Invalid range: ${a}-${b}, min(${a}) > max(${b})`)}static #P(a){if(!(!isNaN(a)&&a>0))throw Error(`Constraint error, cannot repeat at every ${a} time.`)}static #Q(a,b,c,d){let f=[];a===e.DayOfWeek&&c%7==0&&f.push(0);for(let a=b;a<=c;a+=d)-1===f.indexOf(a)&&f.push(a);return f}static #N(a,b,c,d){let e=b.split("-");if(e.length<=1)return isNaN(+b)?b:+b;let[f,g]=e.map(a=>parseInt(a,10));return this.#O(f,g,d),this.#P(c),this.#Q(a,f,g,c)}static #H(a){let b=a.split("#");if(b.length<=1)return{dayOfWeek:b[0]};let c=+b[b.length-1],d=a.match(/([,-/])/);if(null!==d)throw Error(`Constraint error, invalid dayOfWeek \`#\` and \`${d?.[0]}\` special characters are incompatible`);if(!(b.length<=2&&!isNaN(c)&&c>=1&&c<=5))throw Error("Constraint error, invalid dayOfWeek occurrence number (#)");return{dayOfWeek:b[0],nthDayOfWeek:c}}static #M(a,b){return a.chars.some(a=>b.toString().includes(a))}}c.CronExpressionParser=p},924868,(a,b,c)=>{b.exports=a.x("fs/promises",()=>require("fs/promises"))},996700,(a,b,c)=>{"use strict";var d,e=a.e&&a.e.__createBinding||(Object.create?function(a,b,c,d){void 0===d&&(d=c);var e=Object.getOwnPropertyDescriptor(b,c);(!e||("get"in e?!b.__esModule:e.writable||e.configurable))&&(e={enumerable:!0,get:function(){return b[c]}}),Object.defineProperty(a,d,e)}:function(a,b,c,d){void 0===d&&(d=c),a[d]=b[c]}),f=a.e&&a.e.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:!0,value:b})}:function(a,b){a.default=b}),g=a.e&&a.e.__importStar||(d=function(a){return(d=Object.getOwnPropertyNames||function(a){var b=[];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[b.length]=c);return b})(a)},function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c=d(a),g=0;g<c.length;g++)"default"!==c[g]&&e(b,a,c[g]);return f(b,a),b});Object.defineProperty(c,"__esModule",{value:!0}),c.CronFileParser=void 0;let h=a.r(119866);class i{static async parseFile(b){let{readFile:c}=await Promise.resolve().then(()=>g(a.r(924868))),d=await c(b,"utf8");return i.#R(d)}static parseFileSync(b){let{readFileSync:c}=a.r(522734),d=c(b,"utf8");return i.#R(d)}static #R(a){let b=a.split("\n"),c={variables:{},expressions:[],errors:{}};for(let a of b){let b=a.trim();if(0===b.length||b.startsWith("#"))continue;let d=b.match(/^(.*)=(.*)$/);if(d){let[,a,b]=d;c.variables[a]=b.replace(/["']/g,"");continue}try{let a=i.#S(b);c.expressions.push(a.interval)}catch(a){c.errors[b]=a}}return c}static #S(a){let b=a.split(" ");return{interval:h.CronExpressionParser.parse(b.slice(0,5).join(" ")),command:b.slice(5,b.length)}}}c.CronFileParser=i},759904,(a,b,c)=>{"use strict";var d=a.e&&a.e.__createBinding||(Object.create?function(a,b,c,d){void 0===d&&(d=c);var e=Object.getOwnPropertyDescriptor(b,c);(!e||("get"in e?!b.__esModule:e.writable||e.configurable))&&(e={enumerable:!0,get:function(){return b[c]}}),Object.defineProperty(a,d,e)}:function(a,b,c,d){void 0===d&&(d=c),a[d]=b[c]}),e=a.e&&a.e.__exportStar||function(a,b){for(var c in a)"default"===c||Object.prototype.hasOwnProperty.call(b,c)||d(b,a,c)};Object.defineProperty(c,"__esModule",{value:!0}),c.CronFileParser=c.CronExpressionParser=c.CronExpression=c.CronFieldCollection=c.CronDate=void 0;let f=a.r(119866);var g=a.r(893005);Object.defineProperty(c,"CronDate",{enumerable:!0,get:function(){return g.CronDate}});var h=a.r(637958);Object.defineProperty(c,"CronFieldCollection",{enumerable:!0,get:function(){return h.CronFieldCollection}});var i=a.r(244015);Object.defineProperty(c,"CronExpression",{enumerable:!0,get:function(){return i.CronExpression}});var j=a.r(119866);Object.defineProperty(c,"CronExpressionParser",{enumerable:!0,get:function(){return j.CronExpressionParser}});var k=a.r(996700);Object.defineProperty(c,"CronFileParser",{enumerable:!0,get:function(){return k.CronFileParser}}),e(a.r(451160),c),c.default=f.CronExpressionParser},630833,a=>{a.v({input:"style-module__lg-8DW__input"})},563667,356616,715381,413034,483075,671149,99296,348206,461758,799118,178812,632295,230285,927592,526897,520254,967923,820494,268830,257540,891169,235268,413945,82700,665201,13267,445778,919915,965653,828531,704591,881771,624825,a=>{"use strict";let b,c;var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F=a.i(608061),G=a.i(384141),G=G,H=a.i(217553),I=a.i(494261),J=a.i(860653),K=a.i(57843),L=a.i(628238),M=a.i(180612),N=a.i(970502),O=a.i(18039),P=a.i(124116),Q=a.i(844137),R=a.i(24561),S=a.i(527344),G=G,T=a.i(252613);a.i(529638);var U=a.i(557275),V=a.i(893463),W=a.i(581117),X=a.i(172106),Y=a.i(429150),Z=a.i(924270);a.i(752298);var $=a.i(693025),_=a.i(388206),aa=a.i(243103);a.i(644726);var ab=a.i(358407),ab=ab,ac=a.i(483664),ad=a.i(933887),ae=a.i(701458);a.i(76955);var af=a.i(257898),ag=a.i(234009),ag=ag,ah=a.i(277265),ah=ah,ai=a.i(976081),aj=a.i(612222),aj=aj,ak=a.i(420338),al=a.i(481366),am=a.i(438961),an=a.i(251605),ao=a.i(862636),ap=a.i(229017),aq=a.i(829781),ar=a.i(926827);a.i(509681);var as=a.i(131399),at=a.i(318952);let au=K.memo(({className:a})=>(0,F.jsx)("div",{className:(0,S.cn)(a,"h-[0.5px] bg-divider-subtle")}));var av=a.i(909795),aw=a.i(726831),ax=a.i(626039),ay=a.i(640761),az=a.i(712019),aA=a.i(925415),aB=a.i(940233),aC=a.i(735310),aD=a.i(986431);(d={}).dataSource="dataSource",d.documentProcessing="documentProcessing";var aE=a.i(827460);let aF=K.memo(({nodeName:a,onHide:b,children:c})=>{let{t:d}=(0,$.useTranslation)();return(0,F.jsx)("div",{className:"absolute inset-0 z-10 rounded-2xl bg-background-overlay-alt",children:(0,F.jsxs)("div",{className:"flex h-full flex-col rounded-2xl bg-components-panel-bg",children:[(0,F.jsxs)("div",{className:"flex h-8 shrink-0 items-center justify-between pl-4 pr-3 pt-3",children:[(0,F.jsxs)("div",{className:"truncate text-base font-semibold text-text-primary",children:[d("singleRun.testRun",{ns:"workflow"})," ",a]}),(0,F.jsx)("div",{className:"ml-2 shrink-0 cursor-pointer p-1",onClick:()=>{b()},children:(0,F.jsx)(Y.RiCloseLine,{className:"h-4 w-4 text-text-tertiary "})})]}),c]})})});var aG=a.i(599656),aH=a.i(374715),aI=a.i(954200),aJ=a.i(717138);let aK=a=>{let b,c,d,{nodeId:e,payload:f,onCancel:g}=a,{t:h}=(0,$.useTranslation)(),i=(0,az.useDataSourceStore)(),{isPending:j,handleRunWithSyncDraft:k,datasourceType:l,datasourceNodeData:m,startRunBtnDisabled:n}=(({nodeId:a,flowId:b,flowType:c,payload:d,setRunResult:e,isPaused:f,isRunAfterSingleRun:g,setIsRunAfterSingleRun:h,onSuccess:i,appendNodeInspectVars:j})=>{let k=(0,N.useStoreApi)(),l=(0,az.useDataSourceStore)(),m=(0,K.useRef)(f),{handleNodeDataUpdate:n}=(0,ao.useNodeDataUpdate)(),o=d.provider_type,{localFileList:p,onlineDocuments:q,websitePages:r,selectedFileIds:s}=(0,az.useDataSourceStoreWithSelector)((0,_.useShallow)(a=>({localFileList:a.localFileList,onlineDocuments:a.onlineDocuments,websitePages:a.websitePages,selectedFileIds:a.selectedFileIds}))),t=(0,K.useMemo)(()=>!!d&&(o===aE.DatasourceType.localFile?!p.length||p.some(a=>!a.file.id):o===aE.DatasourceType.onlineDocument?!q.length:o===aE.DatasourceType.websiteCrawl?!r.length:o===aE.DatasourceType.onlineDrive&&!s.length),[d,o,p,q.length,s.length,r.length]);(0,K.useEffect)(()=>{m.current=f},[f]);let u=d._singleRunningStatus||aC.NodeRunningStatus.NotStart,v=(0,aH.useInvalidLastRun)(c,b,a),w=async c=>{if(m.current)return;if(!(!g||u===aC.NodeRunningStatus.Succeeded))return void e(c);let d=await (0,R.fetchNodeInspectVars)(aJ.FlowType.ragPipeline,b,a),{getNodes:f}=k.getState();j(a,d,f()),c?.status===aC.NodeRunningStatus.Succeeded&&i()},{mutateAsync:x,isPending:y}=(0,aG.useDatasourceSingleRun)(),{handleSyncWorkflowDraft:z}=(0,W.useNodesSyncDraft)();return{isPending:y,handleRunWithSyncDraft:()=>{n({id:a,data:{...d,_singleRunningStatus:aC.NodeRunningStatus.Running}}),h(!0),z(!0,!0,{onSuccess(){(()=>{let c={},{currentCredentialId:e}=l.getState();if(o===aE.DatasourceType.localFile){let{localFileList:a}=l.getState(),{id:b,name:d,type:e,size:f,extension:g,mime_type:h}=a[0].file;c={related_id:b,name:d,type:e,size:f,extension:g,mime_type:h,url:"",transfer_method:aI.TransferMethod.local_file}}if(o===aE.DatasourceType.onlineDocument){let{onlineDocuments:a}=l.getState(),{workspace_id:b,...d}=a[0];c={workspace_id:b,page:d,credential_id:e}}if(o===aE.DatasourceType.websiteCrawl){let{websitePages:a}=l.getState();c={...a[0],credential_id:e}}if(o===aE.DatasourceType.onlineDrive){let{bucket:a,onlineDriveFileList:b,selectedFileIds:d}=l.getState(),f=b.find(a=>a.id===d[0]);c={bucket:a,id:f?.id,type:f?.type,credential_id:e}}let f=!1;x({pipeline_id:b,start_node_id:a,start_node_title:d.title,datasource_type:o,datasource_info:c},{onError:()=>{f=!0,v(),m.current||n({id:a,data:{...d,_isSingleRun:!1,_singleRunningStatus:aC.NodeRunningStatus.Failed}})},onSettled:b=>{w(b),f||m.current||n({id:a,data:{...d,_isSingleRun:!1,_singleRunningStatus:aC.NodeRunningStatus.Succeeded}})}})})()}})},datasourceType:o,datasourceNodeData:d,startRunBtnDisabled:t}})(a),{clearOnlineDocumentData:o}=(b=(0,az.useDataSourceStore)(),{clearOnlineDocumentData:(0,K.useCallback)(()=>{let{setDocumentsData:a,setSearchValue:c,setSelectedPagesId:d,setOnlineDocuments:e,setCurrentDocument:f}=b.getState();a([]),c(""),d(new Set),e([]),f(void 0)},[b])}),{clearWebsiteCrawlData:p}=(c=(0,az.useDataSourceStore)(),{clearWebsiteCrawlData:(0,K.useCallback)(()=>{let{setStep:a,setCrawlResult:b,setWebsitePages:d,setPreviewIndex:e,setCurrentWebsite:f}=c.getState();a(aD.CrawlStep.init),b(void 0),f(void 0),d([]),e(-1)},[c])}),{clearOnlineDriveData:q}=(d=(0,az.useDataSourceStore)(),{clearOnlineDriveData:(0,K.useCallback)(()=>{let{setOnlineDriveFileList:a,setBucket:b,setPrefix:c,setKeywords:e,setSelectedFileIds:f}=d.getState();a([]),b(""),c([]),e(""),f([])},[d])}),r=(0,K.useCallback)(()=>{l===aE.DatasourceType.onlineDocument?o():l===aE.DatasourceType.websiteCrawl?p():l===aE.DatasourceType.onlineDrive&&q()},[o,q,p,l]),s=(0,K.useCallback)(a=>{let{setCurrentCredentialId:b}=i.getState();r(),b(a)},[r,i]);return(0,F.jsx)(aF,{nodeName:f.title,onHide:g,children:(0,F.jsxs)("div",{className:"flex flex-col gap-y-5 px-4 pt-4",children:[l===aE.DatasourceType.localFile&&(0,F.jsx)(aw.default,{allowedExtensions:m.fileExtensions||[],supportBatchUpload:!1}),l===aE.DatasourceType.onlineDocument&&(0,F.jsx)(ax.default,{nodeId:e,nodeData:m,isInPipeline:!0,onCredentialChange:s,supportBatchUpload:!1}),l===aE.DatasourceType.websiteCrawl&&(0,F.jsx)(aB.default,{nodeId:e,nodeData:m,isInPipeline:!0,onCredentialChange:s,supportBatchUpload:!1}),l===aE.DatasourceType.onlineDrive&&(0,F.jsx)(ay.default,{nodeId:e,nodeData:m,isInPipeline:!0,onCredentialChange:s,supportBatchUpload:!1}),(0,F.jsxs)("div",{className:"flex justify-end gap-x-2",children:[(0,F.jsx)(av.default,{onClick:g,children:h("operation.cancel",{ns:"common"})}),(0,F.jsx)(av.default,{onClick:k,variant:"primary",loading:j,disabled:j||n,children:h("singleRun.startRun",{ns:"workflow"})})]})]})})},aL=K.memo(a=>(0,F.jsx)(aA.default,{children:(0,F.jsx)(aK,{...a})}));var aM=a.i(656100),aN=a.i(503309),aO=a.i(587988);a.i(412708);var aP=a.i(851571);a.i(713310);var aQ=a.i(381045),aR=a.i(363444),aS=a.i(29255),aT=a.i(970854),aU=a.i(459858);let aV=a=>{let{direction:b="both",triggerDirection:c="bottom-right",minWidth:d=-1/0,maxWidth:e=1/0,minHeight:f=-1/0,maxHeight:g=1/0,onResized:h,onResize:i}=a||{},j=(0,K.useRef)(null),k=(0,K.useRef)(null),l=(0,K.useRef)(0),m=(0,K.useRef)(0),n=(0,K.useRef)(0),o=(0,K.useRef)(0),p=(0,K.useRef)(!1),[q,r]=(0,K.useState)(()=>getComputedStyle(document.body).userSelect),s=(0,K.useCallback)(a=>{l.current=a.clientX,m.current=a.clientY,n.current=k.current?.offsetWidth||d,o.current=k.current?.offsetHeight||f,p.current=!0,r(getComputedStyle(document.body).userSelect),document.body.style.userSelect="none"},[d,f]),t=(0,K.useCallback)(a=>{if(p.current&&k.current){if("horizontal"===b||"both"===b){let b=a.clientX-l.current,f=0;"left"===c||"top-left"===c||"bottom-left"===c?f=n.current-b:("right"===c||"top-right"===c||"bottom-right"===c)&&(f=n.current+b),f<d&&(f=d),f>e&&(f=e),k.current.style.width=`${f}px`,i?.(f,0)}if("vertical"===b||"both"===b){let b=a.clientY-m.current,d=0;"top"===c||"top-left"===c||"top-right"===c?d=o.current-b:("bottom"===c||"bottom-left"===c||"bottom-right"===c)&&(d=o.current+b),d<f&&(d=f),d>g&&(d=g),k.current.style.height=`${d}px`,i?.(0,d)}}},[b,c,d,e,f,g,i]),u=(0,K.useCallback)(()=>{p.current=!1,document.body.style.userSelect=q,h&&k.current&&h(k.current.offsetWidth,k.current.offsetHeight)},[q,h]);return(0,K.useEffect)(()=>{let a=j.current;return a?.addEventListener("mousedown",s),document.addEventListener("mousemove",t),document.addEventListener("mouseup",u),()=>{a&&a.removeEventListener("mousedown",s),document.removeEventListener("mousemove",t)}},[s,t,u]),{triggerRef:j,containerRef:k}};var aW=a.i(818386),aX=a.i(114715),aY=a.i(500878);a.i(3626);var aZ=a.i(684714);a.i(916818);var a$=a.i(123009);a.i(73009);var a_=a.i(68545);a.i(805980);var a0=a.i(634919),a1=a.i(754457),a2=a.i(816134),a3=a.i(938409),a4=a.i(805611),a5=a.i(146172),a6=a.i(787405),a7=a.i(373178),a8=a.i(497746),a9=a.i(463827);let ba=K.memo(({value:a,onChange:b,title:c,headerRight:d,minHeight:e,onBlur:f,placeholder:g,readonly:h,isInNode:i})=>{let[j,{setTrue:k,setFalse:l}]=(0,a8.useBoolean)(!1),m=(0,K.useCallback)(()=>{l(),f?.()},[l,f]);return(0,F.jsx)("div",{children:(0,F.jsx)(a9.default,{title:c,value:a,headerRight:d,isFocus:j,minHeight:e,isInNode:i,children:(0,F.jsx)("textarea",{value:a,onChange:a=>b(a.target.value),onFocus:k,onBlur:m,className:"h-full w-full resize-none border-none bg-transparent px-3 text-[13px] font-normal leading-[18px] text-gray-900 placeholder:text-gray-300 focus:outline-none",placeholder:g,readOnly:h})})})});var bb=a.i(532655);let bc=K.memo(({payload:a,value:b,onChange:c,className:d,autoFocus:e,inStepRun:f=!1})=>{let{t:g}=(0,$.useTranslation)(),{type:h}=a,i=(0,as.useHooksStore)(a=>a.configsMap?.fileSettings),j=K.useMemo(()=>{let b=a?.json_schema;return b?"string"==typeof b?b:JSON.stringify(b,null,2):""},[a]),k=(0,K.useCallback)(a=>d=>{c((0,I.produce)(b,b=>{b[a]=d}))},[b,c]),l=(0,K.useCallback)(a=>()=>{c((0,I.produce)(b,b=>{b.splice(a,1)}))},[b,c]),m=(()=>{if("object"==typeof a.label){let{nodeType:b,nodeName:c,variable:d,isChatVar:e}=a.label;return(0,F.jsxs)("div",{className:"flex h-full items-center",children:[!e&&(0,F.jsxs)("div",{className:"flex items-center",children:[(0,F.jsx)("div",{className:"p-[1px]",children:(0,F.jsx)(am.VarBlockIcon,{type:b||aC.BlockEnum.Start})}),(0,F.jsx)("div",{className:"mx-0.5 max-w-[150px] truncate text-xs font-medium text-gray-700",title:c,children:c}),(0,F.jsx)(a$.Line3,{className:"mr-0.5"})]}),(0,F.jsxs)("div",{className:"flex items-center text-primary-600",children:[!e&&(0,F.jsx)(a0.Variable02,{className:"h-3.5 w-3.5"}),e&&(0,F.jsx)(a_.BubbleX,{className:"h-3.5 w-3.5 text-util-colors-teal-teal-700"}),(0,F.jsx)("div",{className:(0,S.cn)("ml-0.5 max-w-[150px] truncate text-xs font-medium",e&&"text-text-secondary"),title:d,children:d})]})]})}return""})(),n=h===aC.InputVarType.checkbox,o=[aC.InputVarType.contexts,aC.InputVarType.iterator].includes(h),p=h===aC.InputVarType.contexts,q=h===aC.InputVarType.iterator,r=q&&a.isFileItem,s=(0,K.useMemo)(()=>"#files#"===a.variable?b?.[0]||[]:b?[b]:[],[a.variable,b]),t=(0,K.useCallback)(b=>{"#files#"===a.variable?c(b):b.length?c(b[0]):c(null)},[c,a.variable]);return(0,F.jsxs)("div",{className:(0,S.cn)(d),children:[!o&&!n&&(0,F.jsxs)("div",{className:"system-sm-semibold mb-1 flex h-6 items-center gap-1 text-text-secondary",children:[(0,F.jsx)("div",{className:"truncate",children:"object"==typeof a.label?m:a.label}),!0===a.hide?(0,F.jsx)("span",{className:"system-xs-regular text-text-tertiary",children:g("panel.optional_and_hidden",{ns:"workflow"})}):!a.required&&(0,F.jsx)("span",{className:"system-xs-regular text-text-tertiary",children:g("panel.optional",{ns:"workflow"})})]}),(0,F.jsxs)("div",{className:"grow",children:[h===aC.InputVarType.textInput&&(0,F.jsx)(a2.default,{value:b||"",onChange:a=>c(a.target.value),placeholder:"object"==typeof a.label?a.label.variable:a.label,autoFocus:e}),h===aC.InputVarType.number&&(0,F.jsx)(a2.default,{type:"number",value:b||"",onChange:a=>c(a.target.value),placeholder:"object"==typeof a.label?a.label.variable:a.label,autoFocus:e}),h===aC.InputVarType.paragraph&&(0,F.jsx)(a5.default,{value:b||"",onChange:a=>c(a.target.value),placeholder:"object"==typeof a.label?a.label.variable:a.label,autoFocus:e}),h===aC.InputVarType.select&&(0,F.jsx)(a4.default,{className:"w-full",defaultValue:b||a.default||"",items:a.options?.map(a=>({name:a,value:a}))||[],onSelect:a=>c(a.value),allowSearch:!1}),n&&(0,F.jsx)(bb.default,{name:a.label,value:!!b,required:a.required,onChange:c}),h===aC.InputVarType.json&&(0,F.jsx)(a7.default,{value:b,title:(0,F.jsx)("span",{children:"JSON"}),language:a6.CodeLanguage.json,onChange:c}),h===aC.InputVarType.jsonObject&&(0,F.jsx)(a7.default,{value:b,language:a6.CodeLanguage.json,onChange:c,noWrapper:!0,className:"bg h-[80px] overflow-y-auto rounded-[10px] bg-components-input-bg-normal p-1",placeholder:(0,F.jsx)("div",{className:"whitespace-pre",children:j})}),h===aC.InputVarType.singleFile&&(0,F.jsx)(aZ.FileUploaderInAttachmentWrapper,{value:s,onChange:t,fileConfig:{allowed_file_types:f&&(!a.allowed_file_types||0===a.allowed_file_types.length)?[aC.SupportUploadFileTypes.image,aC.SupportUploadFileTypes.document,aC.SupportUploadFileTypes.audio,aC.SupportUploadFileTypes.video]:a.allowed_file_types,allowed_file_extensions:f&&(!a.allowed_file_extensions||0===a.allowed_file_extensions.length)?[...a3.FILE_EXTS[aC.SupportUploadFileTypes.image],...a3.FILE_EXTS[aC.SupportUploadFileTypes.document],...a3.FILE_EXTS[aC.SupportUploadFileTypes.audio],...a3.FILE_EXTS[aC.SupportUploadFileTypes.video]]:a.allowed_file_extensions,allowed_file_upload_methods:f?[aI.TransferMethod.local_file,aI.TransferMethod.remote_url]:a.allowed_file_upload_methods,number_limits:1,fileUploadConfig:i?.fileUploadConfig}}),(h===aC.InputVarType.multiFiles||r)&&(0,F.jsx)(aZ.FileUploaderInAttachmentWrapper,{value:b,onChange:a=>c(a),fileConfig:{allowed_file_types:(f||r)&&(!a.allowed_file_types||0===a.allowed_file_types.length)?[aC.SupportUploadFileTypes.image,aC.SupportUploadFileTypes.document,aC.SupportUploadFileTypes.audio,aC.SupportUploadFileTypes.video]:a.allowed_file_types,allowed_file_extensions:(f||r)&&(!a.allowed_file_extensions||0===a.allowed_file_extensions.length)?[...a3.FILE_EXTS[aC.SupportUploadFileTypes.image],...a3.FILE_EXTS[aC.SupportUploadFileTypes.document],...a3.FILE_EXTS[aC.SupportUploadFileTypes.audio],...a3.FILE_EXTS[aC.SupportUploadFileTypes.video]]:a.allowed_file_extensions,allowed_file_upload_methods:f||r?[aI.TransferMethod.local_file,aI.TransferMethod.remote_url]:a.allowed_file_upload_methods,number_limits:f||r?5:a.max_length,fileUploadConfig:i?.fileUploadConfig}}),h===aC.InputVarType.files&&(0,F.jsx)(a1.default,{settings:{...i,detail:i?.image?.detail||aI.Resolution.high,transfer_methods:i?.allowed_file_upload_methods||[]},onFilesChange:a=>c(a.filter(a=>-1!==a.progress).map(a=>({type:"image",transfer_method:a.type,url:a.url,upload_file_id:a.fileId})))}),p&&(0,F.jsx)("div",{className:"space-y-2",children:(b||[]).map((a,c)=>(0,F.jsx)(a7.default,{value:a,title:(0,F.jsx)("span",{children:"JSON"}),headerRight:b.length>1?(0,F.jsx)(Y.RiDeleteBinLine,{onClick:l(c),className:"mr-1 h-3.5 w-3.5 cursor-pointer text-text-tertiary"}):void 0,language:a6.CodeLanguage.json,onChange:k(c)},c))}),q&&!r&&(0,F.jsx)("div",{className:"space-y-2",children:(b||[]).map((a,c)=>(0,F.jsx)(ba,{isInNode:!0,value:a,title:(0,F.jsxs)("span",{children:[g("variableConfig.content",{ns:"appDebug"})," ",c+1," "]}),onChange:k(c),headerRight:b.length>1?(0,F.jsx)(Y.RiDeleteBinLine,{onClick:l(c),className:"mr-1 h-3.5 w-3.5 cursor-pointer text-text-tertiary"}):void 0},c))})]})]})}),bd=K.memo(({className:a,label:b,inputs:c,values:d,onChange:e})=>{let f=(0,K.useMemo)(()=>{let a=a=>{let b=c.find(b=>b.variable===a)?.value_selector;if(!b)return[a];let d=[];return c.forEach(a=>{a.value_selector?.join(".")===b.join(".")&&d.push(a.variable)}),d},b=new Map;for(let d of c)b.set(d.variable,a(d.variable));return b},[c]),g=(0,K.useRef)(d);(0,K.useEffect)(()=>{g.current=d},[d]);let h=(0,K.useCallback)(a=>{let b=f.get(a)??[a];return a=>{e((0,I.produce)(g.current,c=>{for(let d of b)c[d]=a}))}},[g,e,f]),i=[aC.InputVarType.contexts,aC.InputVarType.iterator].includes(c[0]?.type),j=c[0]?.type===aC.InputVarType.iterator&&c[0]?.isFileItem,k=c[0]?.type===aC.InputVarType.contexts,l=(0,K.useCallback)(()=>{e((0,I.produce)(d,a=>{let b=c[0].variable;a[b]||(a[b]=[]),a[b].push(k?T.RETRIEVAL_OUTPUT_STRUCT:"")}))},[d,e,c,k]);return(0,F.jsxs)("div",{className:(0,S.cn)(a,"space-y-2"),children:[b&&(0,F.jsxs)("div",{className:"mb-1 flex items-center justify-between",children:[(0,F.jsx)("div",{className:"system-xs-medium-uppercase flex h-6 items-center text-text-tertiary",children:b}),i&&!j&&(0,F.jsx)(aY.default,{onClick:l})]}),c.map((a,b)=>(0,F.jsx)(bc,{inStepRun:!0,payload:a,value:d[a.variable],onChange:h(a.variable)},b))]})}),be=K.memo(({nodeName:a,onHide:b,onRun:c,forms:d,filteredExistVarForms:e,existVarValuesInForms:f})=>{let{t:g}=(0,$.useTranslation)(),h=(()=>{if(!d||0===d.length)return!0;let a=d.find(a=>!!a.values["#files#"]);if(!a)return!0;let b=a.values["#files#"];return!b?.some(a=>a.transfer_method===aI.TransferMethod.local_file&&!a.upload_file_id)})(),i=(0,K.useRef)(!1);return((0,K.useEffect)(()=>{i.current||(i.current=!0,0===e.length&&c({}))},[e,c]),0===e.length)?null:(0,F.jsx)(aF,{nodeName:a,onHide:b,children:(0,F.jsxs)("div",{className:"h-0 grow overflow-y-auto pb-4",children:[(0,F.jsx)("div",{className:"mt-3 space-y-4 px-4",children:e.map((a,b)=>(0,F.jsxs)("div",{children:[(0,F.jsx)(bd,{className:(0,S.cn)(b<d.length-1&&"mb-4"),...a},b),b<d.length-1&&(0,F.jsx)(au,{})]},b))}),(0,F.jsx)("div",{className:"mt-4 flex justify-between space-x-2 px-4",children:(0,F.jsx)(av.default,{disabled:!h,variant:"primary",className:"w-0 grow space-x-2",onClick:()=>{let a="";if(d.forEach((b,c)=>{let d=f[c];b.inputs.forEach(c=>{let e=b.values[c.variable];(a||!c.required||c.type===aC.InputVarType.checkbox||c.variable in d||""!==e&&null!=e&&(c.type!==aC.InputVarType.files||0!==e.length)||(a=g("errorMsg.fieldRequired",{ns:"workflow",field:"object"==typeof c.label?c.label.variable:c.label})),!a&&(c.type===aC.InputVarType.singleFile||c.type===aC.InputVarType.multiFiles)&&e)&&(Array.isArray(e)?e.find(a=>a.transferMethod===aI.TransferMethod.local_file&&!a.uploadedId):e.transferMethod===aI.TransferMethod.local_file&&!e.uploadedId)&&(a=g("errorMessage.waitForFileUpload",{ns:"appDebug"}))})}),a)return void aX.default.notify({message:a,type:"error"});let b={},e="";(d.forEach(a=>{a.inputs.forEach(c=>{try{let d=function(a,b){if(b===aC.InputVarType.checkbox)return!!a;if(null==a)return a;if(b===aC.InputVarType.number)return Number.parseFloat(a);if(b===aC.InputVarType.json)return JSON.parse(a);if(b===aC.InputVarType.contexts)return a.map(a=>JSON.parse(a));if(b===aC.InputVarType.multiFiles)return(0,aW.getProcessedFiles)(a);if(b===aC.InputVarType.singleFile){if(Array.isArray(a))return(0,aW.getProcessedFiles)(a);if(!a)return;return(0,aW.getProcessedFiles)([a])[0]}return a}(a.values[c.variable],c.type);b[c.variable]=d}catch{e=c.variable}})}),e)?aX.default.notify({message:g("errorMsg.invalidJson",{ns:"workflow",field:e}),type:"error"}):c(b)},children:(0,F.jsx)("div",{children:g("singleRun.startRun",{ns:"workflow"})})})})]})})});var bf=a.i(774500);let bg=({forms:a,onFormChange:b})=>{let{t:c}=(0,$.useTranslation)(),d=(0,K.useCallback)(({key:a,type:c})=>d=>{let e;(c===aC.VarType.string||c===aC.VarType.number)&&(e=d.target.value),(c===aC.VarType.array||c===aC.VarType.arrayNumber||c===aC.VarType.arrayString||c===aC.VarType.arrayObject||c===aC.VarType.arrayFile||c===aC.VarType.object)&&(e=d),b({key:a,type:c,value:e})},[b]);return(0,F.jsxs)("div",{className:"px-4 pt-2",children:[(0,F.jsxs)("div",{className:"body-xs-regular mb-2 text-text-tertiary",children:[c("nodes.common.errorHandle.defaultValue.desc",{ns:"workflow"})," "]}),(0,F.jsx)("div",{className:"space-y-1",children:a.map((a,b)=>(0,F.jsxs)("div",{className:"py-1",children:[(0,F.jsxs)("div",{className:"mb-1 flex items-center",children:[(0,F.jsx)("div",{className:"system-sm-medium mr-1 text-text-primary",children:a.key}),(0,F.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:a.type})]}),(a.type===aC.VarType.string||a.type===aC.VarType.number)&&(0,F.jsx)(a2.default,{type:a.type,value:a.value||(a.type===aC.VarType.string?"":0),onChange:d({key:a.key,type:a.type})}),(a.type===aC.VarType.array||a.type===aC.VarType.arrayNumber||a.type===aC.VarType.arrayString||a.type===aC.VarType.arrayObject||a.type===aC.VarType.object)&&(0,F.jsx)(a7.default,{language:a6.CodeLanguage.json,value:a.value,onChange:d({key:a.key,type:a.type})})]},b))})]})};var bh=a.i(825319),bi=a.i(935533);let bj=({value:a,onSelected:b})=>{let{t:c}=(0,$.useTranslation)(),[d,e]=(0,K.useState)(!1),f=[{value:bi.ErrorHandleTypeEnum.none,label:c("nodes.common.errorHandle.none.title",{ns:"workflow"}),description:c("nodes.common.errorHandle.none.desc",{ns:"workflow"})},{value:bi.ErrorHandleTypeEnum.defaultValue,label:c("nodes.common.errorHandle.defaultValue.title",{ns:"workflow"}),description:c("nodes.common.errorHandle.defaultValue.desc",{ns:"workflow"})},{value:bi.ErrorHandleTypeEnum.failBranch,label:c("nodes.common.errorHandle.failBranch.title",{ns:"workflow"}),description:c("nodes.common.errorHandle.failBranch.desc",{ns:"workflow"})}],g=f.find(b=>b.value===a);return(0,F.jsxs)(bh.PortalToFollowElem,{open:d,onOpenChange:e,placement:"bottom-end",offset:4,children:[(0,F.jsx)(bh.PortalToFollowElemTrigger,{onClick:a=>{a.stopPropagation(),a.nativeEvent.stopImmediatePropagation(),e(a=>!a)},children:(0,F.jsxs)(av.default,{size:"small",children:[g?.label,(0,F.jsx)(Y.RiArrowDownSLine,{className:"h-3.5 w-3.5"})]})}),(0,F.jsx)(bh.PortalToFollowElemContent,{className:"z-[11]",children:(0,F.jsx)("div",{className:"w-[280px] rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur p-1 shadow-lg",children:f.map(c=>(0,F.jsxs)("div",{className:"flex cursor-pointer rounded-lg p-2 pr-3 hover:bg-state-base-hover",onClick:a=>{a.stopPropagation(),a.nativeEvent.stopImmediatePropagation(),b(c.value),e(!1)},children:[(0,F.jsx)("div",{className:"mr-1 w-4 shrink-0",children:a===c.value&&(0,F.jsx)(Y.RiCheckLine,{className:"h-4 w-4 text-text-accent"})}),(0,F.jsxs)("div",{className:"grow",children:[(0,F.jsx)("div",{className:"system-sm-semibold mb-0.5 text-text-secondary",children:c.label}),(0,F.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:c.description})]})]},c.value))})})]})};var bk=a.i(252813);let bl=()=>{let{t:a}=(0,$.useTranslation)(),b=(0,bk.useDocLink)();return(0,F.jsx)("div",{className:"px-4 pt-2",children:(0,F.jsxs)("div",{className:"rounded-[10px] bg-workflow-process-bg p-4",children:[(0,F.jsx)("div",{className:"mb-2 flex h-8 w-8 items-center justify-center rounded-[10px] border-[0.5px] border-components-card-border bg-components-card-bg shadow-lg",children:(0,F.jsx)(Y.RiMindMap,{className:"h-5 w-5 text-text-tertiary"})}),(0,F.jsx)("div",{className:"system-sm-medium mb-1 text-text-secondary",children:a("nodes.common.errorHandle.failBranch.customize",{ns:"workflow"})}),(0,F.jsxs)("div",{className:"system-xs-regular text-text-tertiary",children:[a("nodes.common.errorHandle.failBranch.customizeTip",{ns:"workflow"})," ",(0,F.jsx)("a",{href:b("/use-dify/debug/error-type"),target:"_blank",className:"text-text-accent",children:a("common.learnMore",{ns:"workflow"})})]})]})})};var bm=a.i(894530);let bn=a=>a===aC.VarType.string?"":a===aC.VarType.number?0:a===aC.VarType.object?"{}":a===aC.VarType.arrayObject||a===aC.VarType.arrayString||a===aC.VarType.arrayNumber||a===aC.VarType.arrayFile?"[]":"",bo=a=>{let{type:b}=a;if(b===aC.BlockEnum.LLM)return[{key:"text",type:aC.VarType.string,value:bn(aC.VarType.string)}];if(b===aC.BlockEnum.HttpRequest)return[{key:"body",type:aC.VarType.string,value:bn(aC.VarType.string)},{key:"status_code",type:aC.VarType.number,value:bn(aC.VarType.number)},{key:"headers",type:aC.VarType.object,value:bn(aC.VarType.object)}];if(b===aC.BlockEnum.Tool)return[{key:"text",type:aC.VarType.string,value:bn(aC.VarType.string)},{key:"json",type:aC.VarType.arrayObject,value:bn(aC.VarType.arrayObject)}];if(b===aC.BlockEnum.Code){let{outputs:b}=a;return Object.keys(b).map(a=>({key:a,type:b[a].type,value:bn(b[a].type)}))}return[]},bp=({id:a,data:b})=>{let{t:c}=(0,$.useTranslation)(),{error_strategy:d,default_value:e}=b,{collapsed:f,setCollapsed:g,handleErrorHandleTypeChange:h}=((a,b)=>{let c=(0,K.useMemo)(()=>b.error_strategy===bi.ErrorHandleTypeEnum.none,[b.error_strategy]),[d,e]=(0,K.useState)(c),{handleNodeDataUpdateWithSyncDraft:f}=(0,ao.useNodeDataUpdate)(),{handleEdgeDeleteByDeleteBranch:g}=(0,bm.useEdgesInteractions)(),h=(0,K.useCallback)((b,c)=>{c.error_strategy!==b&&(b===bi.ErrorHandleTypeEnum.none&&(f({id:a,data:{error_strategy:void 0,default_value:void 0}}),e(!0),g(a,bi.ErrorHandleTypeEnum.failBranch)),b===bi.ErrorHandleTypeEnum.failBranch&&(f({id:a,data:{error_strategy:b,default_value:void 0}}),e(!1)),b===bi.ErrorHandleTypeEnum.defaultValue&&(f({id:a,data:{error_strategy:b,default_value:bo(c)}}),e(!1),g(a,bi.ErrorHandleTypeEnum.failBranch)))},[a,f,g]);return{collapsed:d,setCollapsed:e,handleErrorHandleTypeChange:h}})(a,b),{handleFormChange:i}=(a=>{let{handleNodeDataUpdateWithSyncDraft:b}=(0,ao.useNodeDataUpdate)();return{handleFormChange:(0,K.useCallback)(({key:c,value:d,type:e},f)=>{let g=f.default_value||[],h=g.findIndex(a=>a.key===c);if(h>-1){let c=[...g];c[h].value=d,b({id:a,data:{default_value:c}});return}b({id:a,data:{default_value:[...g,{key:c,value:d,type:e}]}})},[b,a])}})(a),j=(0,K.useCallback)(a=>b=>{h(b,a)},[h]),k=(0,K.useCallback)(a=>b=>{i(b,a)},[i]);return(0,F.jsx)(F.Fragment,{children:(0,F.jsx)("div",{className:"py-4",children:(0,F.jsx)(bf.default,{disabled:!d,collapsed:f,onCollapse:g,hideCollapseIcon:!0,trigger:a=>(0,F.jsxs)("div",{className:"flex grow items-center justify-between pr-4",children:[(0,F.jsxs)("div",{className:"flex items-center",children:[(0,F.jsx)("div",{className:"system-sm-semibold-uppercase mr-0.5 text-text-secondary",children:c("nodes.common.errorHandle.title",{ns:"workflow"})}),(0,F.jsx)(ac.default,{popupContent:c("nodes.common.errorHandle.tip",{ns:"workflow"})}),a]}),(0,F.jsx)(bj,{value:d||bi.ErrorHandleTypeEnum.none,onSelected:j(b)})]}),children:(0,F.jsxs)(F.Fragment,{children:[d===bi.ErrorHandleTypeEnum.failBranch&&!f&&(0,F.jsx)(bl,{}),d===bi.ErrorHandleTypeEnum.defaultValue&&!f&&!!e?.length&&(0,F.jsx)(bg,{forms:e,onFormChange:k(b)})]})})})})},bq=a=>{let b=(0,ap.useNodesMetaData)();return(0,K.useMemo)(()=>b?.nodesMap?.[a]?.metaData.helpLinkUri||"",[b,a])},br=(0,K.memo)(({nodeType:a})=>{let{t:b}=(0,$.useTranslation)(),c=bq(a);return c?(0,F.jsx)(ac.default,{popupContent:b("userProfile.helpCenter",{ns:"common"}),children:(0,F.jsx)("a",{href:c,target:"_blank",className:"mr-1 flex h-6 w-6 items-center justify-center rounded-md hover:bg-state-base-hover",children:(0,F.jsx)(Y.RiBookOpenLine,{className:"h-4 w-4 text-gray-500"})})}):null});a.i(622666);var bs=a.i(8034),bs=bs,bt=a.i(979856),bu=a.i(602024),bv=a.i(897112),bw=a.i(724423),bx=a.i(781362),by=a.i(499257),bz=a.i(413192),bA=a.i(757801),bB=a.i(253073),bC=a.i(239567),bD=a.i(263636),bE=a.i(576157);a.i(166176);var bF=a.i(807927),bG=a.i(45678),bH=a.i(228072),bI=a.i(105249),bJ=a.i(917122),bK=a.i(726949),bL=a.i(668308),bM=a.i(573912),bN=a.i(28959),bO=a.i(730357);let bP=K.memo(({provider:a,payload:b,onSelect:c,disabled:d,isAdded:e})=>{let{t:f}=(0,$.useTranslation)(),g=(0,bk.useGetLanguage)();return(0,F.jsx)(ac.default,{position:"right",needsDelay:!1,popupClassName:"!p-0 !px-3 !py-2.5 !w-[224px] !leading-[18px] !text-xs !text-gray-700 !border-[0.5px] !border-black/5 !rounded-xl !shadow-lg",popupContent:(0,F.jsxs)("div",{children:[(0,F.jsx)(am.default,{size:"md",className:"mb-2",type:aC.BlockEnum.TriggerPlugin,toolIcon:a.icon}),(0,F.jsx)("div",{className:"mb-1 text-sm leading-5 text-text-primary",children:b.label[g]}),(0,F.jsx)("div",{className:"text-xs leading-[18px] text-text-secondary",children:b.description[g]})]}),children:(0,F.jsxs)("div",{className:"flex cursor-pointer items-center justify-between rounded-lg pl-[21px] pr-1 hover:bg-state-base-hover",onClick:()=>{if(d)return;let e={};b.parameters&&b.parameters.forEach(a=>{e[a.name]=""}),c(aC.BlockEnum.TriggerPlugin,{plugin_id:a.plugin_id,provider_id:a.name,provider_type:a.type,provider_name:a.name,event_name:b.name,event_label:b.label[g],event_description:b.description[g],plugin_unique_identifier:a.plugin_unique_identifier,title:b.label[g],is_team_authorization:a.is_team_authorization,output_schema:b.output_schema||{},paramSchemas:b.parameters,params:e,meta:a.meta})},children:[(0,F.jsx)("div",{className:(0,S.cn)("system-sm-medium h-8 truncate border-l-2 border-divider-subtle pl-4 leading-8 text-text-secondary"),children:(0,F.jsx)("span",{className:(0,S.cn)(d&&"opacity-30"),children:b.label[g]})}),e&&(0,F.jsx)("div",{className:"system-xs-regular mr-4 text-text-tertiary",children:f("addToolModal.added",{ns:"tools"})})]},b.name)},b.name)}),bQ=a=>a&&"string"==typeof a&&by.basePath&&a.startsWith("/")&&!a.startsWith(`${by.basePath}/`)?`${by.basePath}${a}`:a,bR=K.memo(({className:a,payload:b,hasSearchText:c,onSelect:d})=>{let{t:e}=(0,$.useTranslation)(),f=(0,bk.useGetLanguage)(),{theme:g}=(0,bO.default)(),h=b.type===bN.CollectionType.workflow,i=b.events,j=!h,[k,l]=K.useState(!0),m=(0,K.useRef)(null);(0,K.useEffect)(()=>{c&&k?l(!1):c||k||l(!0)},[c]);let n=k?Y.RiArrowRightSLine:Y.RiArrowDownSLine,o=(0,K.useMemo)(()=>b.type===bN.CollectionType.builtIn?b.author:b.type===bN.CollectionType.custom?e("tabs.customTool",{ns:"workflow"}):b.type===bN.CollectionType.workflow?e("tabs.workflowTool",{ns:"workflow"}):b.author||"",[b.author,b.type,e]),p=(0,K.useMemo)(()=>bQ(b.icon)??b.icon,[b.icon]),q=(0,K.useMemo)(()=>{if(b.icon_dark)return bQ(b.icon_dark)??b.icon_dark},[b.icon_dark]),r=(0,K.useMemo)(()=>g===aI.Theme.dark&&q?q:p,[p,q,g]),s=(0,K.useMemo)(()=>({...b,icon:r}),[b,r]);return(0,F.jsx)("div",{className:(0,S.cn)("mb-1 last-of-type:mb-0"),ref:m,children:(0,F.jsxs)("div",{className:(0,S.cn)(a),children:[(0,F.jsxs)("div",{className:"group/item flex w-full cursor-pointer select-none items-center justify-between rounded-lg pl-3 pr-1 hover:bg-state-base-hover",onClick:()=>{if(j)return void l(!k);let a=i[0],c={};a.parameters&&a.parameters.forEach(a=>{c[a.name]=""}),d(aC.BlockEnum.TriggerPlugin,{plugin_id:b.plugin_id,provider_id:b.name,provider_type:b.type,provider_name:b.name,event_name:a.name,event_label:a.label[f],event_description:a.description[f],title:a.label[f],plugin_unique_identifier:b.plugin_unique_identifier,is_team_authorization:b.is_team_authorization,output_schema:a.output_schema||{},paramSchemas:a.parameters,params:c})},children:[(0,F.jsxs)("div",{className:"flex h-8 grow items-center",children:[(0,F.jsx)(am.default,{className:"shrink-0",type:aC.BlockEnum.TriggerPlugin,toolIcon:r}),(0,F.jsxs)("div",{className:"ml-2 flex min-w-0 flex-1 items-center text-sm text-text-primary",children:[(0,F.jsx)("span",{className:"max-w-[200px] truncate",children:h?i[0]?.label[f]:b.label[f]}),(0,F.jsx)("span",{className:"system-xs-regular ml-2 truncate text-text-quaternary",children:o})]})]}),(0,F.jsx)("div",{className:"ml-2 flex items-center",children:j&&(0,F.jsx)(n,{className:(0,S.cn)("h-4 w-4 shrink-0 text-text-tertiary group-hover/item:text-text-tertiary",k&&"text-text-quaternary")})})]}),!h&&j&&!k&&i.map(a=>(0,F.jsx)(bP,{provider:s,payload:a,onSelect:d,disabled:!1,isAdded:!1},a.name))]})},b.id)}),bS="workflow_triggers_featured_collapsed";function bT({plugin:a,language:b,onInstallSuccess:c,t:d}){let e=a.label?.[b]||a.name,f="object"==typeof a.brief?a.brief[b]:a.brief,g=d("install",{ns:"plugin",num:(0,bM.formatNumber)(a.install_count||0)}),[h,i]=(0,K.useState)(!1),[j,k]=(0,K.useState)(!1),[l,m]=(0,K.useState)(!1);return(0,K.useEffect)(()=>{if(!h)return;let a=()=>{i(!1),k(!1)};return window.addEventListener("scroll",a,!0),()=>{window.removeEventListener("scroll",a,!0)}},[h]),(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(ac.default,{position:"right",needsDelay:!1,popupClassName:"!p-0 !px-3 !py-2.5 !w-[224px] !leading-[18px] !text-xs !text-gray-700 !border-[0.5px] !border-black/5 !rounded-xl !shadow-lg",popupContent:(0,F.jsxs)("div",{children:[(0,F.jsx)(am.default,{size:"md",className:"mb-2",type:aC.BlockEnum.TriggerPlugin,toolIcon:a.icon}),(0,F.jsx)("div",{className:"mb-1 text-sm leading-5 text-text-primary",children:e}),(0,F.jsx)("div",{className:"text-xs leading-[18px] text-text-secondary",children:f})]}),disabled:!f||j||h||l,children:(0,F.jsxs)("div",{className:"group flex h-8 w-full items-center rounded-lg pl-3 pr-1 hover:bg-state-base-hover",children:[(0,F.jsxs)("div",{className:"flex h-full min-w-0 items-center",children:[(0,F.jsx)(am.default,{type:aC.BlockEnum.TriggerPlugin,toolIcon:a.icon}),(0,F.jsx)("div",{className:"ml-2 min-w-0",children:(0,F.jsx)("div",{className:"system-sm-medium truncate text-text-secondary",children:e})})]}),(0,F.jsxs)("div",{className:"ml-auto flex h-full items-center gap-1 pl-1",children:[(0,F.jsx)("span",{className:`system-xs-regular text-text-tertiary ${h?"hidden":"group-hover:hidden"}`,children:g}),(0,F.jsxs)("div",{className:`system-xs-medium flex h-full items-center gap-1 text-components-button-secondary-accent-text [&_.action-btn]:h-6 [&_.action-btn]:min-h-0 [&_.action-btn]:w-6 [&_.action-btn]:rounded-lg [&_.action-btn]:p-0 ${h?"flex":"hidden group-hover:flex"}`,onMouseEnter:()=>k(!0),onMouseLeave:()=>{h||k(!1)},children:[(0,F.jsx)("button",{type:"button",className:"cursor-pointer rounded-md px-1.5 py-0.5 hover:bg-state-base-hover",onClick:()=>{i(!1),m(!0),k(!0)},children:d("installAction",{ns:"plugin"})}),(0,F.jsx)(bK.default,{open:h,onOpenChange:a=>{i(a),k(a)},author:a.org,name:a.name,version:a.latest_version})]})]})]})}),l&&(0,F.jsx)(bJ.default,{uniqueIdentifier:a.latest_package_identifier,manifest:a,onSuccess:async()=>{m(!1),k(!1),await c?.()},onClose:()=>{m(!1),k(!1)}})]})}let bU=({plugins:a,providerMap:b,onSelect:c,isLoading:d=!1,onInstallSuccess:e})=>{let{t:f}=(0,$.useTranslation)(),g=(0,bk.useGetLanguage)(),[h,i]=(0,K.useState)(5),[j,k]=(0,K.useState)(()=>!bL.isServer&&"true"===window.localStorage.getItem(bS));(0,K.useEffect)(()=>{if(bL.isServer)return;let a=window.localStorage.getItem(bS);null!==a&&k("true"===a)},[]),(0,K.useEffect)(()=>{bL.isServer||window.localStorage.setItem(bS,String(j))},[j]),(0,K.useEffect)(()=>{i(5)},[a]);let l=(0,K.useMemo)(()=>a.slice(0,15),[a]),{installedProviders:m,uninstalledPlugins:n}=(0,K.useMemo)(()=>{let a=[],c=[],d=new Set;return l.forEach(e=>{let f=b.get(e.plugin_id)||b.get(e.latest_package_identifier);f?d.has(f.id)||(a.push(f),d.add(f.id)):c.push(e)}),{installedProviders:a,uninstalledPlugins:c}},[l,b]),o=Math.min(h,15),p=(0,K.useMemo)(()=>m.slice(0,o),[m,o]),q=Math.max(o-p.length,0),r=(0,K.useMemo)(()=>q>0?n.slice(0,q):[],[n,q]),s=p.length+r.length,t=Math.min(15,m.length+n.length),u=t>5,v=u&&!(s<t),w=!d&&0===s;return(0,F.jsxs)("div",{className:"px-3 pb-3 pt-2",children:[(0,F.jsxs)("button",{type:"button",className:"flex w-full items-center rounded-md px-0 py-1 text-left text-text-primary",onClick:()=>k(a=>!a),children:[(0,F.jsx)("span",{className:"system-xs-medium text-text-primary",children:f("tabs.featuredTools",{ns:"workflow"})}),(0,F.jsx)(bG.ArrowDownRoundFill,{className:`ml-0.5 h-4 w-4 text-text-tertiary transition-transform ${j?"-rotate-90":"rotate-0"}`})]}),!j&&(0,F.jsxs)(F.Fragment,{children:[d&&(0,F.jsx)("div",{className:"py-3",children:(0,F.jsx)(bI.default,{type:"app"})}),w&&(0,F.jsx)("p",{className:"system-xs-regular py-2 text-text-tertiary",children:(0,F.jsx)(bz.default,{className:"text-text-accent",href:(0,by.getMarketplaceUrl)("",{category:"trigger"}),target:"_blank",rel:"noopener noreferrer",children:f("tabs.noFeaturedTriggers",{ns:"workflow"})})}),!w&&!d&&(0,F.jsxs)(F.Fragment,{children:[p.length>0&&(0,F.jsx)("div",{className:"mt-1",children:p.map(a=>(0,F.jsx)(bR,{payload:a,hasSearchText:!1,onSelect:c},a.id))}),r.length>0&&(0,F.jsx)("div",{className:"mt-1 flex flex-col gap-1",children:r.map(a=>(0,F.jsx)(bT,{plugin:a,language:g,onInstallSuccess:async()=>{await e?.()},t:f},a.plugin_id))})]}),!d&&s>0&&u&&(0,F.jsxs)("div",{className:"group mt-1 flex cursor-pointer items-center gap-x-2 rounded-lg py-1 pl-3 pr-2 text-text-tertiary transition-colors hover:bg-state-base-hover hover:text-text-secondary",onClick:()=>{i(a=>a>=t?5:Math.min(a+5,t))},children:[(0,F.jsxs)("div",{className:"flex items-center px-1 text-text-tertiary transition-colors group-hover:text-text-secondary",children:[(0,F.jsx)(Y.RiMoreLine,{className:"size-4 group-hover:hidden"}),v?(0,F.jsx)(bH.ArrowUpDoubleLine,{className:"hidden size-4 group-hover:block"}):(0,F.jsx)(bF.ArrowDownDoubleLine,{className:"hidden size-4 group-hover:block"})]}),(0,F.jsx)("div",{className:"system-xs-regular",children:f(v?"tabs.showLessFeatured":"tabs.showMoreFeatured",{ns:"workflow"})})]})]})]})};var bV=a.i(393500);a.s([],520254);var bW=a.i(594916),bX=a.i(988526),bY=a.i(986963);let bZ=({flowType:a,flowId:b})=>{let c=(0,aP.useWorkflowStore)(),d=(0,N.useStoreApi)(),e=(0,aH.useInvalidateConversationVarValues)(a,b),f=(0,aH.useInvalidateSysVarValues)(a,b),{handleCancelAllNodeSuccessStatus:g}=(0,bW.useNodesInteractionsWithoutSync)(),{schemaTypeDefinitions:h}=(0,bX.default)(),{data:i}=(0,Q.useAllBuiltInTools)(),{data:j}=(0,Q.useAllCustomTools)(),{data:k}=(0,Q.useAllWorkflowTools)(),{data:l}=(0,Q.useAllMCPTools)(),m={buildInTools:i||[],customTools:j||[],workflowTools:k||[],mcpTools:l||[],dataSourceList:(0,aP.useStore)(a=>a.dataSourceList)||[]},n=(a,b,e)=>{let{setNodesWithInspectVars:f}=c.getState(),{getNodes:g}=d.getState(),i=g(),j=(0,bY.toNodeOutputVars)(i,!1,()=>!0,[],[],[],b||m,e||h),k={};i.forEach(a=>{k[a.id]=a});let l={};a.forEach(a=>{let b=a.selector[0];k[b]&&(l[b]=!0)}),f(Object.keys(l).map(a=>k[a]).map(b=>{let c=b.id,d=a.filter(a=>a.selector[0]===c),e=j.find(a=>a.nodeId===c);return{nodeId:c,nodePayload:b.data,nodeType:b.data.type,title:b.data.title,vars:d.map(a=>{let b=e?e.vars.find(b=>b.variable===a.name)?.schemaType:"";return{...a,schemaType:b}}),isSingRunRunning:!1,isValueFetched:!1}}))};return{fetchInspectVars:(0,K.useCallback)(async c=>{let{passInVars:d,vars:h,passedInAllPluginInfoList:i,passedInSchemaTypeDefinitions:j}=c;e(),f(),n(d?h:await (0,R.fetchAllInspectVars)(a,b),i,j),g()},[e,f,a,b,n,g,h,bX.getMatchedSchemaType])}};a.s(["useSetWorkflowVarsWithValue",0,bZ],356616);var b$=a.i(933988),b_=a.i(366231),b0=a.i(34624);let b1=(0,b0.genNodeMetaData)({sort:3,type:aC.BlockEnum.Agent});var b2=a.i(323102),b3=((e={}).overwrite="over-write",e.clear="clear",e.append="append",e.extend="extend",e.set="set",e.increment="+=",e.decrement="-=",e.multiply="*=",e.divide="/=",e.removeFirst="remove-first",e.removeLast="remove-last",e),b4=((f={}).variable="variable",f.constant="constant",f);let b5=["+=","-=","*=","/="],b6="errorMsg",b7={metaData:(0,b0.genNodeMetaData)({classification:b2.BlockClassificationEnum.Transform,sort:5,type:aC.BlockEnum.Assigner,helpLinkUri:"variable-assigner"}),defaultValue:{version:"2",items:[]},checkValid(a,b){let c="",{items:d}=a;return d?.forEach(a=>{c||a.variable_selector?.length||(c=b(`${b6}.fieldRequired`,{ns:"workflow",field:b("nodes.assigner.assignedVariable",{ns:"workflow"})})),!c&&a.operation!==b3.clear&&a.operation!==b3.removeFirst&&a.operation!==b3.removeLast&&(a.operation===b3.set||a.operation===b3.increment||a.operation===b3.decrement||a.operation===b3.multiply||a.operation===b3.divide?a.value||!1===a.value||"number"==typeof a.value||(c=b(`${b6}.fieldRequired`,{ns:"workflow",field:b("nodes.assigner.variable",{ns:"workflow"})})):a.value?.length||(c=b(`${b6}.fieldRequired`,{ns:"workflow",field:b("nodes.assigner.variable",{ns:"workflow"})})))}),{isValid:!c,errorMessage:c}}},b8="errorMsg",b9={metaData:(0,b0.genNodeMetaData)({classification:b2.BlockClassificationEnum.Transform,sort:1,type:aC.BlockEnum.Code}),defaultValue:{code:"",code_language:a6.CodeLanguage.python3,variables:[],outputs:{}},checkValid(a,b){let c="",{code:d,variables:e}=a;return!c&&e.filter(a=>!a.variable).length>0&&(c=b(`${b8}.fieldRequired`,{ns:"workflow",field:b(`${b8}.fields.variable`,{ns:"workflow"})})),!c&&e.filter(a=>!a.value_selector.length).length>0&&(c=b(`${b8}.fieldRequired`,{ns:"workflow",field:b(`${b8}.fields.variableValue`,{ns:"workflow"})})),c||d||(c=b(`${b8}.fieldRequired`,{ns:"workflow",field:b(`${b8}.fields.code`,{ns:"workflow"})})),{isValid:!c,errorMessage:c}}},ca={metaData:(0,b0.genNodeMetaData)({classification:b2.BlockClassificationEnum.Transform,sort:4,type:aC.BlockEnum.DocExtractor,helpLinkUri:"doc-extractor"}),defaultValue:{variable_selector:[],is_array_file:!1},checkValid(a,b){let c="",{variable_selector:d}=a;return c||d?.length||(c=b("errorMsg.fieldRequired",{ns:"workflow",field:b("nodes.assigner.assignedVariable",{ns:"workflow"})})),{isValid:!c,errorMessage:c}}};var cb=((g={}).get="get",g.post="post",g.head="head",g.patch="patch",g.put="put",g.delete="delete",g),cc=((h={}).none="none",h.formData="form-data",h.xWwwFormUrlencoded="x-www-form-urlencoded",h.rawText="raw-text",h.json="json",h.binary="binary",h),cd=((i={}).text="text",i.file="file",i),ce=((j={}).none="no-auth",j.apiKey="api-key",j),cf=((k={}).basic="basic",k.bearer="bearer",k.custom="custom",k);let cg={metaData:(0,b0.genNodeMetaData)({classification:b2.BlockClassificationEnum.Utilities,sort:1,type:aC.BlockEnum.HttpRequest}),defaultValue:{variables:[],method:cb.get,url:"",authorization:{type:ce.none,config:null},headers:"",params:"",body:{type:cc.none,data:[]},ssl_verify:!0,timeout:{max_connect_timeout:0,max_read_timeout:0,max_write_timeout:0},retry_config:{retry_enabled:!0,max_retries:3,retry_interval:100}},checkValid(a,b){let c="";return c||a.url||(c=b("errorMsg.fieldRequired",{ns:"workflow",field:b("nodes.http.api",{ns:"workflow"})})),c||a.body.type!==cc.binary||a.body.data[0]?.file&&a.body.data[0]?.file?.length!==0||(c=b("errorMsg.fieldRequired",{ns:"workflow",field:b("nodes.http.binaryFileVariable",{ns:"workflow"})})),{isValid:!c,errorMessage:c}}};var ch=a.i(653226),ci=a.i(198536);let cj="errorMsg",ck={metaData:(0,b0.genNodeMetaData)({classification:b2.BlockClassificationEnum.Logic,sort:1,type:aC.BlockEnum.IfElse,helpLinkUri:"ifelse"}),defaultValue:{_targetBranches:[{id:"true",name:"IF"},{id:"false",name:"ELSE"}],cases:[{case_id:"true",logical_operator:ch.LogicalOperator.and,conditions:[]}]},checkValid(a,b){let c="",{cases:d}=a;return d&&0!==d.length||(c=b(`${cj}.fieldRequired`,{ns:"workflow",field:"IF"})),d.forEach((a,d)=>{a.conditions.length||(c=b(`${cj}.fieldRequired`,{ns:"workflow",field:0===d?"IF":"ELIF"})),a.conditions.forEach(a=>{c||a.variable_selector&&0!==a.variable_selector.length||(c=b(`${cj}.fieldRequired`,{ns:"workflow",field:b(`${cj}.fields.variable`,{ns:"workflow"})})),c||a.comparison_operator||(c=b(`${cj}.fieldRequired`,{ns:"workflow",field:b("nodes.ifElse.operator",{ns:"workflow"})})),!c&&(a.sub_variable_condition?a.sub_variable_condition.conditions.every(a=>!!a.comparison_operator&&(!!(0,ci.isEmptyRelatedOperator)(a.comparison_operator)||(a.varType===aC.VarType.boolean||a.varType===aC.VarType.arrayBoolean?void 0===a.value:!!a.value)))||(c=b(`${cj}.fieldRequired`,{ns:"workflow",field:b(`${cj}.fields.variableValue`,{ns:"workflow"})})):(0,ci.isEmptyRelatedOperator)(a.comparison_operator)||(a.varType===aC.VarType.boolean||a.varType===aC.VarType.arrayBoolean?void 0!==a.value:a.value)||(c=b(`${cj}.fieldRequired`,{ns:"workflow",field:b(`${cj}.fields.variableValue`,{ns:"workflow"})})))})}),{isValid:!c,errorMessage:c}}},cl=(0,b0.genNodeMetaData)({sort:-1,type:aC.BlockEnum.IterationStart}),cm={metaData:(0,b0.genNodeMetaData)({classification:b2.BlockClassificationEnum.Logic,sort:2,type:aC.BlockEnum.Iteration,isTypeFixed:!0}),defaultValue:{start_node_id:"",iterator_selector:[],output_selector:[],_children:[],_isShowTips:!1,is_parallel:!1,parallel_nums:10,error_handle_mode:aC.ErrorHandleMode.Terminated,flatten_output:!0},checkValid(a,b){let c="";return c||a.iterator_selector&&0!==a.iterator_selector.length||(c=b("errorMsg.fieldRequired",{ns:"workflow",field:b("nodes.iteration.input",{ns:"workflow"})})),c||a.output_selector&&0!==a.output_selector.length||(c=b("errorMsg.fieldRequired",{ns:"workflow",field:b("nodes.iteration.output",{ns:"workflow"})})),{isValid:!c,errorMessage:c}}};var cn=a.i(29936);let co={metaData:(0,b0.genNodeMetaData)({sort:2,type:aC.BlockEnum.KnowledgeRetrieval}),defaultValue:{query_variable_selector:[],query_attachment_selector:[],dataset_ids:[],retrieval_mode:aI.RETRIEVE_TYPE.multiWay,multiple_retrieval_config:{top_k:O.DATASET_DEFAULT.top_k,score_threshold:void 0,reranking_enable:!1}},checkValid(a,b){let c="";c||a.dataset_ids&&0!==a.dataset_ids.length||(c=b("errorMsg.fieldRequired",{ns:"workflow",field:b("nodes.knowledgeRetrieval.knowledge",{ns:"workflow"})})),c||a.retrieval_mode!==aI.RETRIEVE_TYPE.oneWay||a.single_retrieval_config?.model?.provider||(c=b("errorMsg.fieldRequired",{ns:"workflow",field:b("modelProvider.systemReasoningModel.key",{ns:"common"})}));let{_datasets:d,multiple_retrieval_config:e,retrieval_mode:f}=a;if(f===aI.RETRIEVE_TYPE.multiWay){let a=(0,cn.checkoutRerankModelConfiguredInRetrievalSettings)(d||[],e);c||a||(c=b("errorMsg.fieldRequired",{ns:"workflow",field:b("errorMsg.fields.rerankModel",{ns:"workflow"})}))}return{isValid:!c,errorMessage:c}}};var cp=((l={}).ASC="asc",l.DESC="desc",l);let cq="errorMsg",cr={metaData:(0,b0.genNodeMetaData)({classification:b2.BlockClassificationEnum.Utilities,sort:2,type:aC.BlockEnum.ListFilter}),defaultValue:{variable:[],filter_by:{enabled:!1,conditions:[]},extract_by:{enabled:!1,serial:"1"},order_by:{enabled:!1,key:"",value:cp.ASC},limit:{enabled:!1,size:10}},checkValid(a,b){let c="",{variable:d,var_type:e,filter_by:f,item_var_type:g}=a;return c||d?.length||(c=b(`${cq}.fieldRequired`,{ns:"workflow",field:b("nodes.listFilter.inputVar",{ns:"workflow"})})),!c&&f?.enabled&&(e!==aC.VarType.arrayFile||f.conditions[0]?.key||(c=b(`${cq}.fieldRequired`,{ns:"workflow",field:b("nodes.listFilter.filterConditionKey",{ns:"workflow"})})),c||f.conditions[0]?.comparison_operator||(c=b(`${cq}.fieldRequired`,{ns:"workflow",field:b("nodes.listFilter.filterConditionComparisonOperator",{ns:"workflow"})})),c||(0,ci.comparisonOperatorNotRequireValue)(f.conditions[0]?.comparison_operator)||(g===aC.VarType.boolean?f.conditions[0]?.value!==void 0:f.conditions[0]?.value)||(c=b(`${cq}.fieldRequired`,{ns:"workflow",field:b("nodes.listFilter.filterConditionComparisonValue",{ns:"workflow"})}))),{isValid:!c,errorMessage:c}}},cs=`{
  "content": "",
  "title": "",
  "url": "",
  "icon": "",
  "metadata": {
    "dataset_id": "",
    "dataset_name": "",
    "document_id": [],
    "document_name": "",
    "document_data_source_type": "",
    "segment_id": "",
    "segment_position": "",
    "segment_word_count": "",
    "segment_hit_count": "",
    "segment_index_node_hash": "",
    "score": ""
  }
}`,ct="errorMsg",cu={metaData:(0,b0.genNodeMetaData)({sort:1,type:aC.BlockEnum.LLM}),defaultValue:{model:{provider:"",name:"",mode:aI.AppModeEnum.CHAT,completion_params:{temperature:.7}},prompt_template:[{role:aC.PromptRole.system,text:""}],context:{enabled:!1,variable_selector:[]},vision:{enabled:!1}},defaultRunInputData:{"#context#":[cs],"#files#":[]},checkValid(a,b){let c="";return c||a.model.provider||(c=b(`${ct}.fieldRequired`,{ns:"workflow",field:b(`${ct}.fields.model`,{ns:"workflow"})})),c||a.memory||(a.model.mode===aI.AppModeEnum.CHAT?a.prompt_template.some(a=>a.edition_type===aC.EditionType.jinja2?""!==a.jinja2_text:""!==a.text):a.prompt_template.edition_type===aC.EditionType.jinja2?""!==a.prompt_template.jinja2_text:""!==a.prompt_template.text)||(c=b(`${ct}.fieldRequired`,{ns:"workflow",field:b("nodes.llm.prompt",{ns:"workflow"})})),!c&&a.memory&&a.model.mode===aI.AppModeEnum.CHAT&&a.memory.query_prompt_template&&!a.memory.query_prompt_template.includes("{{#sys.query#}}")&&(c=b("nodes.llm.sysQueryInUser",{ns:"workflow"})),!c&&(a.model.mode===aI.AppModeEnum.CHAT?a.prompt_template.some(a=>a.edition_type===aC.EditionType.jinja2):a.prompt_template.edition_type===aC.EditionType.jinja2)&&a.prompt_config?.jinja2_variables&&a.prompt_config?.jinja2_variables.forEach(a=>{c||a.variable||(c=b(`${ct}.fieldRequired`,{ns:"workflow",field:b(`${ct}.fields.variable`,{ns:"workflow"})})),c||a.value_selector.length||(c=b(`${ct}.fieldRequired`,{ns:"workflow",field:b(`${ct}.fields.variableValue`,{ns:"workflow"})}))}),!c&&a.vision?.enabled&&!a.vision.configs?.variable_selector?.length&&(c=b(`${ct}.fieldRequired`,{ns:"workflow",field:b(`${ct}.fields.visionVariable`,{ns:"workflow"})})),{isValid:!c,errorMessage:c}}},cv=(0,b0.genNodeMetaData)({classification:b2.BlockClassificationEnum.Logic,sort:2,type:aC.BlockEnum.LoopEnd,isSingleton:!0}),cw=(0,b0.genNodeMetaData)({sort:-1,type:aC.BlockEnum.LoopStart});var cx=((m={}).and="and",m.or="or",m),cy=((n={}).contains="contains",n.notContains="not contains",n.startWith="start with",n.endWith="end with",n.is="is",n.isNot="is not",n.empty="empty",n.notEmpty="not empty",n.equal="=",n.notEqual="≠",n.largerThan=">",n.lessThan="<",n.largerThanOrEqual="≥",n.lessThanOrEqual="≤",n.isNull="is null",n.isNotNull="is not null",n.in="in",n.notIn="not in",n.allOf="all of",n.exists="exists",n.notExists="not exists",n);let cz=a=>[cy.empty,cy.notEmpty,cy.isNull,cy.isNotNull,cy.exists,cy.notExists].includes(a),cA=[cy.equal,cy.notEqual,cy.largerThan,cy.largerThanOrEqual,cy.lessThan,cy.lessThanOrEqual],cB=(a,b)=>{if(b){let{key:a}=b;switch(a){case"name":case"mime_type":case"url":return[cy.contains,cy.notContains,cy.startWith,cy.endWith,cy.is,cy.isNot,cy.empty,cy.notEmpty];case"type":case"transfer_method":return[cy.in,cy.notIn];case"size":return[cy.largerThan,cy.largerThanOrEqual,cy.lessThan,cy.lessThanOrEqual];case"extension":return[cy.is,cy.isNot,cy.contains,cy.notContains]}return[]}switch(a){case aC.VarType.string:return[cy.contains,cy.notContains,cy.startWith,cy.endWith,cy.is,cy.isNot,cy.empty,cy.notEmpty];case aC.VarType.number:return[cy.equal,cy.notEqual,cy.largerThan,cy.lessThan,cy.largerThanOrEqual,cy.lessThanOrEqual,cy.empty,cy.notEmpty];case aC.VarType.boolean:return[cy.is,cy.isNot,cy.empty,cy.notEmpty];case aC.VarType.object:return[cy.empty,cy.notEmpty];case aC.VarType.file:return[cy.exists,cy.notExists];case aC.VarType.arrayString:case aC.VarType.arrayNumber:return[cy.contains,cy.notContains,cy.empty,cy.notEmpty];case aC.VarType.array:case aC.VarType.arrayObject:return[cy.empty,cy.notEmpty];case aC.VarType.arrayFile:return[cy.contains,cy.notContains,cy.allOf,cy.empty,cy.notEmpty];default:return[cy.is,cy.isNot,cy.empty,cy.notEmpty]}},cC=a=>!!a&&[cy.empty,cy.notEmpty,cy.isNull,cy.isNotNull,cy.exists,cy.notExists].includes(a),cD="errorMsg",cE={metaData:(0,b0.genNodeMetaData)({classification:b2.BlockClassificationEnum.Logic,sort:3,type:aC.BlockEnum.Loop,author:"AICT-Team",isTypeFixed:!0}),defaultValue:{start_node_id:"",break_conditions:[],loop_count:10,_children:[],logical_operator:cx.and},checkValid(a,b){let c="";return a.loop_variables?.forEach(a=>{a.label||(c=b(`${cD}.fieldRequired`,{ns:"workflow",field:b(`${cD}.fields.variable`,{ns:"workflow"})}))}),a.break_conditions.forEach(a=>{c||a.variable_selector&&0!==a.variable_selector.length||(c=b(`${cD}.fieldRequired`,{ns:"workflow",field:b(`${cD}.fields.variable`,{ns:"workflow"})})),c||a.comparison_operator||(c=b(`${cD}.fieldRequired`,{ns:"workflow",field:b("nodes.ifElse.operator",{ns:"workflow"})})),!c&&(a.sub_variable_condition&&![cy.empty,cy.notEmpty].includes(a.comparison_operator)?a.sub_variable_condition.conditions.every(a=>!!a.comparison_operator&&(!!cz(a.comparison_operator)||!!a.value))||(c=b(`${cD}.fieldRequired`,{ns:"workflow",field:b(`${cD}.fields.variableValue`,{ns:"workflow"})})):cz(a.comparison_operator)||(a.varType===aC.VarType.boolean?void 0!==a.value:a.value)||(c=b(`${cD}.fieldRequired`,{ns:"workflow",field:b(`${cD}.fields.variableValue`,{ns:"workflow"})})))}),!c&&(Number.isNaN(Number(a.loop_count))||!Number.isInteger(Number(a.loop_count))||a.loop_count<1||a.loop_count>O.LOOP_NODE_MAX_COUNT)&&(c=b("nodes.loop.loopMaxCountError",{ns:"workflow",maxCount:O.LOOP_NODE_MAX_COUNT})),{isValid:!c,errorMessage:c}}},cF=[{value:"image",i18nKey:"image"},{value:"document",i18nKey:"doc"},{value:"audio",i18nKey:"audio"},{value:"video",i18nKey:"video"}],cG=[{value:aI.TransferMethod.local_file,i18nKey:"localUpload"},{value:aI.TransferMethod.remote_url,i18nKey:"url"}],cH=["type","size","name","url","extension","mime_type","transfer_method","related_id"];cH.filter(a=>"transfer_method"!==a);var cI=((o={}).string="string",o.number="number",o.bool="boolean",o.select="select",o.arrayString="array[string]",o.arrayNumber="array[number]",o.arrayObject="array[object]",o.arrayBool="array[boolean]",o),cJ=((p={}).prompt="prompt",p.functionCall="function_call",p);let cK={metaData:(0,b0.genNodeMetaData)({classification:b2.BlockClassificationEnum.Transform,sort:6,type:aC.BlockEnum.ParameterExtractor}),defaultValue:{query:[],model:{provider:"",name:"",mode:aI.AppModeEnum.CHAT,completion_params:{temperature:.7}},reasoning_mode:cJ.prompt,vision:{enabled:!1}},checkValid(a,b){let c="";return c||a.query&&0!==a.query.length||(c=b("errorMsg.fieldRequired",{ns:"workflow",field:b("nodes.parameterExtractor.inputVar",{ns:"workflow"})})),c||a.model.provider||(c=b("errorMsg.fieldRequired",{ns:"workflow",field:b("nodes.parameterExtractor.model",{ns:"workflow"})})),c||a.parameters&&0!==a.parameters.length||(c=b("errorMsg.fieldRequired",{ns:"workflow",field:b("nodes.parameterExtractor.extractParameters",{ns:"workflow"})})),c||a.parameters.forEach(a=>{if(!c){if(!a.name){c=b("errorMsg.fieldRequired",{ns:"workflow",field:b("nodes.parameterExtractor.addExtractParameterContent.namePlaceholder",{ns:"workflow"})});return}if(!a.type){c=b("errorMsg.fieldRequired",{ns:"workflow",field:b("nodes.parameterExtractor.addExtractParameterContent.typePlaceholder",{ns:"workflow"})});return}a.description||(c=b("errorMsg.fieldRequired",{ns:"workflow",field:b("nodes.parameterExtractor.addExtractParameterContent.descriptionPlaceholder",{ns:"workflow"})}))}}),!c&&a.vision?.enabled&&!a.vision.configs?.variable_selector?.length&&(c=b("errorMsg.fieldRequired",{ns:"workflow",field:b("errorMsg.fields.visionVariable",{ns:"workflow"})})),{isValid:!c,errorMessage:c}}},cL={metaData:(0,b0.genNodeMetaData)({classification:b2.BlockClassificationEnum.QuestionUnderstand,sort:1,type:aC.BlockEnum.QuestionClassifier}),defaultValue:{query_variable_selector:[],model:{provider:"",name:"",mode:aI.AppModeEnum.CHAT,completion_params:{temperature:.7}},classes:[{id:"1",name:""},{id:"2",name:""}],_targetBranches:[{id:"1",name:""},{id:"2",name:""}],vision:{enabled:!1}},checkValid(a,b){let c="";return c||a.query_variable_selector&&0!==a.query_variable_selector.length||(c=b("errorMsg.fieldRequired",{ns:"workflow",field:b("nodes.questionClassifiers.inputVars",{ns:"workflow"})})),c||a.model.provider||(c=b("errorMsg.fieldRequired",{ns:"workflow",field:b("nodes.questionClassifiers.model",{ns:"workflow"})})),c||a.classes&&0!==a.classes.length||(c=b("errorMsg.fieldRequired",{ns:"workflow",field:b("nodes.questionClassifiers.class",{ns:"workflow"})})),!c&&a.classes.some(a=>!a.name)&&(c=b("errorMsg.fieldRequired",{ns:"workflow",field:b("nodes.questionClassifiers.topicName",{ns:"workflow"})})),!c&&a.vision?.enabled&&!a.vision.configs?.variable_selector?.length&&(c=b("errorMsg.fieldRequired",{ns:"workflow",field:b("errorMsg.fields.visionVariable",{ns:"workflow"})})),{isValid:!c,errorMessage:c}}},cM="errorMsg",cN={metaData:(0,b0.genNodeMetaData)({classification:b2.BlockClassificationEnum.Transform,sort:2,type:aC.BlockEnum.TemplateTransform,helpLinkUri:"template"}),defaultValue:{template:"",variables:[]},checkValid(a,b){let c="",{template:d,variables:e}=a;return!c&&e.filter(a=>!a.variable).length>0&&(c=b(`${cM}.fieldRequired`,{ns:"workflow",field:b(`${cM}.fields.variable`,{ns:"workflow"})})),!c&&e.filter(a=>!a.value_selector.length).length>0&&(c=b(`${cM}.fieldRequired`,{ns:"workflow",field:b(`${cM}.fields.variableValue`,{ns:"workflow"})})),c||d||(c=b(`${cM}.fieldRequired`,{ns:"workflow",field:b("nodes.templateTransform.code",{ns:"workflow"})})),{isValid:!c,errorMessage:c}}};var cO=a.i(782606);let cP={metaData:(0,b0.genNodeMetaData)({classification:b2.BlockClassificationEnum.Transform,sort:3,type:aC.BlockEnum.VariableAggregator}),defaultValue:{output_type:aC.VarType.any,variables:[]},checkValid(a,b){let c="",{variables:d,advanced_settings:e}=a,{group_enabled:f=!1,groups:g=[]}=e||{},h=(a,d)=>{a.forEach(a=>{a&&0!==a.length||(c=b("errorMsg.fieldRequired",{ns:"workflow",field:b(d,{ns:"workflow"})}))})};return f?g&&0!==g.length?c||g.forEach(a=>{h(a.variables||[],"errorMsg.fields.variableValue")}):c=b("errorMsg.fieldRequired",{ns:"workflow",field:b("nodes.variableAssigner.title",{ns:"workflow"})}):d&&0!==d.length?c||h(d,"errorMsg.fields.variableValue"):c=b("errorMsg.fieldRequired",{ns:"workflow",field:b("nodes.variableAssigner.title",{ns:"workflow"})}),{isValid:!c,errorMessage:c}}},cQ=[cu,co,{metaData:b1,defaultValue:{tool_node_version:"2"},checkValid(a,b,c){let{strategy:d,language:e,isReadyForCheckValid:f}=c;if(!f)return{isValid:!0,errorMessage:""};if(!d)return{isValid:!1,errorMessage:b("nodes.agent.checkList.strategyNotSelected",{ns:"workflow"})};for(let c of d.parameters){if(c.required&&c.type===b$.FormTypeEnum.toolSelector){let d=a.agent_parameters?.[c.name]?.value;if(!d)return{isValid:!1,errorMessage:b("errorMsg.fieldRequired",{ns:"workflow",field:(0,b_.renderI18nObject)(c.label,e)})};{if(!d.enabled)return{isValid:!1,errorMessage:b("errorMsg.noValidTool",{ns:"workflow",field:(0,b_.renderI18nObject)(c.label,e)})};let f=d.schemas||[],g=d.settings,h=d.parameters,i=a.version,j=a.tool_node_version,k=i||j;f.forEach(a=>{if(a?.required&&("form"===a.form&&!k&&!g[a.name]?.value||"form"===a.form&&k&&!g[a.name]?.value.value||"llm"===a.form&&!k&&0===h[a.name].auto&&!h[a.name]?.value||"llm"===a.form&&k&&0===h[a.name].auto&&!h[a.name]?.value.value))return{isValid:!1,errorMessage:b("errorMsg.toolParameterRequired",{ns:"workflow",field:(0,b_.renderI18nObject)(c.label,e),param:(0,b_.renderI18nObject)(a.label,e)})}})}}if(c.required&&c.type===b$.FormTypeEnum.multiToolSelector){let d=a.agent_parameters?.[c.name]?.value||[];if(!d.length)return{isValid:!1,errorMessage:b("errorMsg.fieldRequired",{ns:"workflow",field:(0,b_.renderI18nObject)(c.label,e)})};{if(d.every(a=>!a.enabled))return{isValid:!1,errorMessage:b("errorMsg.noValidTool",{ns:"workflow",field:(0,b_.renderI18nObject)(c.label,e)})};let a={isValid:!0,errorMessage:""};for(let a of d){let d=a.schemas||[],f=a.settings,g=a.parameters;d.forEach(a=>{if(a?.required&&("form"===a.form&&!f[a.name]?.value||"llm"===a.form&&g[a.name]?.auto===0&&!g[a.name]?.value))return{isValid:!1,errorMessage:b("errorMsg.toolParameterRequired",{ns:"workflow",field:(0,b_.renderI18nObject)(c.label,e),param:(0,b_.renderI18nObject)(a.label,e)})}})}return a}}if(c.required&&!(a.agent_parameters?.[c.name]?.value||c.default))return{isValid:!1,errorMessage:b("errorMsg.fieldRequired",{ns:"workflow",field:(0,b_.renderI18nObject)(c.label,e)})}}return{isValid:!0,errorMessage:""}}},cL,ck,cm,{metaData:cl,defaultValue:{},checkValid:()=>({isValid:!0})},cE,{metaData:cw,defaultValue:{},checkValid:()=>({isValid:!0})},{metaData:cv,defaultValue:{},checkValid:()=>({isValid:!0})},b9,cN,cP,ca,b7,cK,cg,cr,cO.default],cR={metaData:(0,b0.genNodeMetaData)({sort:2.1,type:aC.BlockEnum.Answer,isRequired:!0}),defaultValue:{variables:[],answer:""},checkValid(a,b){let c="",{answer:d}=a;return d||(c=b("errorMsg.fieldRequired",{ns:"workflow",field:b("nodes.answer.answer",{ns:"workflow"})})),{isValid:!c,errorMessage:c}}},cS={metaData:(0,b0.genNodeMetaData)({sort:2.1,type:aC.BlockEnum.End,isRequired:!1}),defaultValue:{outputs:[]},checkValid(a,b){let c=a.outputs||[],d="";return c.length?c.find(a=>{let b=a.variable?.trim(),c=Array.isArray(a.value_selector)&&a.value_selector.length>0;return!b||!c})&&(d=b("errorMsg.fieldRequired",{ns:"workflow",field:b("nodes.end.output.variable",{ns:"workflow"})})):d=b("errorMsg.fieldRequired",{ns:"workflow",field:b("nodes.end.output.variable",{ns:"workflow"})}),{isValid:!d,errorMessage:d}}},cT={metaData:(0,b0.genNodeMetaData)({sort:.1,type:aC.BlockEnum.Start,isStart:!0,isRequired:!1,isSingleton:!0,isTypeFixed:!1,helpLinkUri:"user-input"}),defaultValue:{variables:[]},checkValid:()=>({isValid:!0})};var cU=a.i(597839),cV=a.i(759904);let cW=a=>{if(!a||""===a.trim()||5!==a.trim().split(/\s+/).length&&!a.startsWith("@"))return!1;try{return cV.CronExpressionParser.parse(a),!0}catch{return!1}};var cX=a.i(346896);let cY=a=>{if(a)return a;try{return Intl.DateTimeFormat().resolvedOptions().timeZone||"UTC"}catch{return"UTC"}},cZ=a=>{let b=cY(a),[c,d]=new Date().toLocaleString("en-CA",{timeZone:b,hour12:!1}).split(", "),[e,f,g]=c.split("-").map(Number),[h,i,j]=d.split(":").map(Number);return new Date(e,f-1,g,h,i,j)},c$=(a,b=5)=>{let c=cY(a.timezone);if("cron"===a.mode)return a.cron_expression&&cW(a.cron_expression)?((a,b="UTC")=>{if(!a||""===a.trim()||5!==a.trim().split(/\s+/).length&&!a.startsWith("@"))return[];try{return cV.CronExpressionParser.parse(a,{tz:b}).take(5).map(a=>{let c=a.toDate();return((a,b)=>{let[c,d]=a.toLocaleString("en-CA",{timeZone:b,hour12:!1}).split(", "),[e,f,g]=c.split("-").map(Number),[h,i,j]=d.split(":").map(Number);return new Date(e,f-1,g,h,i,j)})(c,b)})}catch{return[]}})(a.cron_expression,c).slice(0,b):[];let d=[],e=a.visual_config?.time||"12:00 AM",[f,g,h]=new Date().toLocaleDateString("en-CA",{timeZone:c}).split("-").map(Number),i=new Date(f,g-1,h,0,0,0,0);if("hourly"===a.frequency){let e=a.visual_config?.on_minute??0,f=cZ(c),g=f.getHours();f.getMinutes()>=e&&(g+=1);for(let a=0;a<b;a++){let b=new Date(i);b.setHours(g+a,e,0,0),g+a>=24&&(b.setDate(i.getDate()+Math.floor((g+a)/24)),b.setHours((g+a)%24,e,0,0)),d.push(b)}}else if("daily"===a.frequency){let[a,f]=e.split(" "),[g,h]=a.split(":"),j=Number.parseInt(g);"PM"===f&&12!==j&&(j+=12),"AM"===f&&12===j&&(j=0);let k=new Date(i);k.setHours(j,Number.parseInt(h),0,0);let l=+(k<=cZ(c));for(let a=0;a<b;a++){let b=new Date(i);b.setDate(i.getDate()+l+a),b.setHours(j,Number.parseInt(h),0,0),d.push(b)}}else if("weekly"===a.frequency){let f=a.visual_config?.weekdays||["sun"],g={sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6},[h,j]=e.split(" "),[k,l]=h.split(":"),m=Number.parseInt(k);"PM"===j&&12!==m&&(m+=12),"AM"===j&&12===m&&(m=0);let n=cZ(c),o=0,p=0;for(;o<b;){let a=!1;for(let c of f){if(o>=b)break;let e=g[c];if(void 0===e)continue;a=!0;let f=(e-i.getDay()+7)%7,h=new Date(i);h.setHours(m,Number.parseInt(l),0,0);let j=f;0===f&&h<=n&&(j=7);let k=new Date(i);k.setDate(i.getDate()+j+7*p),k.setHours(m,Number.parseInt(l),0,0),k>n&&(d.push(k),o++)}if(!a)break;p++}d.sort((a,b)=>a.getTime()-b.getTime())}else if("monthly"===a.frequency){let f=[...new Set(a.visual_config?.monthly_days&&a.visual_config.monthly_days.length>0?a.visual_config.monthly_days:[1])],[g,h]=e.split(" "),[j,k]=g.split(":"),l=Number.parseInt(j);"PM"===h&&12!==l&&(l+=12),"AM"===h&&12===l&&(l=0);let m=cZ(c),n=0,o=0;for(;n<b;){let a=new Date(i.getFullYear(),i.getMonth()+o,1),c=new Date(a.getFullYear(),a.getMonth()+1,0).getDate(),e=[],g=new Set;for(let b of f){let d;if("last"===b)d=c;else{if(b>c)continue;d=b}if(g.has(d))continue;g.add(d);let f=new Date(a.getFullYear(),a.getMonth(),d,l,Number.parseInt(k),0,0);f>m&&e.push(f)}for(let a of(e.sort((a,b)=>a.getTime()-b.getTime()),e)){if(n>=b)break;d.push(a),n++}o++}}else for(let a=0;a<b;a++){let b=new Date(i);b.setDate(i.getDate()+a),d.push(b)}return d},c_=(a,b,c=!0,d=!0)=>((a,b,c=!0,d=!0)=>{let e={year:"numeric",month:"long",day:"numeric"};c&&(e.weekday="long");let f=a.toLocaleDateString("en-US",e),g=a.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});if(d){let a=(0,cX.convertTimezoneToOffsetStr)(b);return`${f}, ${g} (${a})`}return`${f}, ${g}`})(a,cY(b),c,d),c0=a=>{let b=cY(a.timezone);if("cron"===a.mode&&(!a.cron_expression||!cW(a.cron_expression)))return"--";let c=c$(a,1);if(0===c.length){let c=cZ(b);return c_(new Date(c.getFullYear(),c.getMonth(),c.getDate(),12,0,0,0),b,"visual"===a.mode&&"weekly"===a.frequency,!1)}let d="visual"===a.mode&&"weekly"===a.frequency;return c_(c[0],b,d,!1)},c1=(a,b)=>a.time?(a=>{if(!/^(0?\d|1[0-2]):[0-5]\d (AM|PM)$/.test(a))return!1;let[b,c]=a.split(" "),[d,e]=b.split(":"),f=Number.parseInt(d,10),g=Number.parseInt(e,10);return f>=1&&f<=12&&g>=0&&g<=59&&["AM","PM"].includes(c)})(a.time)?"":b("nodes.triggerSchedule.invalidTimeFormat",{ns:"workflow"}):b("workflow.errorMsg.fieldRequired",{ns:"workflow",field:b("nodes.triggerSchedule.time",{ns:"workflow"})}),c2={metaData:(0,b0.genNodeMetaData)({sort:2,type:aC.BlockEnum.TriggerSchedule,helpLinkUri:"trigger/schedule-trigger",isStart:!0}),defaultValue:{mode:"visual",frequency:"daily",visual_config:{time:"12:00 AM",weekdays:["sun"],on_minute:0,monthly_days:[1]},cron_expression:""},checkValid(a,b){let c="errorMsg",d="";if(d||a.mode||(d=b(`${c}.fieldRequired`,{ns:"workflow",field:b("nodes.triggerSchedule.mode",{ns:"workflow"})})),!d&&a.timezone)try{Intl.DateTimeFormat(void 0,{timeZone:a.timezone})}catch{d=b("nodes.triggerSchedule.invalidTimezone",{ns:"workflow"})}if(!d&&("cron"===a.mode?a.cron_expression&&""!==a.cron_expression.trim()?cW(a.cron_expression)||(d=b("nodes.triggerSchedule.invalidCronExpression",{ns:"workflow"})):d=b(`${c}.fieldRequired`,{ns:"workflow",field:b("nodes.triggerSchedule.cronExpression",{ns:"workflow"})}):"visual"===a.mode&&(d=a.frequency?((a,b)=>{let{visual_config:c}=a;if(!c)return b("workflow.errorMsg.fieldRequired",{ns:"workflow",field:b("nodes.triggerSchedule.visualConfig",{ns:"workflow"})});switch(a.frequency){case"hourly":return void 0===c.on_minute||c.on_minute<0||c.on_minute>59?b("nodes.triggerSchedule.invalidOnMinute",{ns:"workflow"}):"";case"daily":return c1(c,b);case"weekly":let d=c1(c,b);if(d)return d;if(!c.weekdays||0===c.weekdays.length)return b("workflow.errorMsg.fieldRequired",{ns:"workflow",field:b("nodes.triggerSchedule.weekdays",{ns:"workflow"})});let e=["sun","mon","tue","wed","thu","fri","sat"];for(let a of c.weekdays)if(!e.includes(a))return b("nodes.triggerSchedule.invalidWeekday",{ns:"workflow",weekday:a});return"";case"monthly":let f=c1(c,b);if(f)return f;let g=Array.isArray(c.monthly_days)&&c.monthly_days.length>0?c.monthly_days:[];if(0===g.length)return b("workflow.errorMsg.fieldRequired",{ns:"workflow",field:b("nodes.triggerSchedule.monthlyDay",{ns:"workflow"})});for(let a of g)if("last"!==a&&("number"!=typeof a||a<1||a>31))return b("nodes.triggerSchedule.invalidMonthlyDay",{ns:"workflow"});return"";default:return b("nodes.triggerSchedule.invalidFrequency",{ns:"workflow"})}})(a,b):b(`${c}.fieldRequired`,{ns:"workflow",field:b("nodes.triggerSchedule.frequency",{ns:"workflow"})}))),!d)try{let c=c$(a,1);0===c.length&&(d=b("nodes.triggerSchedule.noValidExecutionTime",{ns:"workflow"}))}catch{d=b("nodes.triggerSchedule.executionTimeCalculationError",{ns:"workflow"})}return{isValid:!d,errorMessage:d}}},c3=[aC.VarType.string,aC.VarType.number,aC.VarType.boolean,aC.VarType.object,aC.VarType.file],c4=[aC.VarType.arrayString,aC.VarType.arrayNumber,aC.VarType.arrayBoolean,aC.VarType.arrayObject],c5=[...c3,...c4],c6={[aC.VarType.string]:"String",[aC.VarType.number]:"Number",[aC.VarType.boolean]:"Boolean",[aC.VarType.object]:"Object",[aC.VarType.file]:"File",[aC.VarType.arrayString]:"Array[String]",[aC.VarType.arrayNumber]:"Array[Number]",[aC.VarType.arrayBoolean]:"Array[Boolean]",[aC.VarType.arrayObject]:"Array[Object]",[aC.VarType.secret]:"Secret",[aC.VarType.array]:"Array","array[file]":"Array[File]",[aC.VarType.any]:"Any","array[any]":"Array[Any]",[aC.VarType.integer]:"Integer"},c7={"application/json":{supportedTypes:[...c3.filter(a=>"file"!==a),...c4],description:"JSON supports all types including arrays"},"text/plain":{supportedTypes:[aC.VarType.string],description:"Plain text only supports string"},"application/x-www-form-urlencoded":{supportedTypes:[aC.VarType.string,aC.VarType.number,aC.VarType.boolean],description:"Form data supports basic types"},"application/octet-stream":{supportedTypes:[aC.VarType.file],description:"octet-stream supports only binary data"},"multipart/form-data":{supportedTypes:[aC.VarType.string,aC.VarType.number,aC.VarType.boolean,aC.VarType.file],description:"Multipart supports basic types plus files"}},c8=a=>c5.includes(a),c9="_webhook_raw",da={metaData:(0,b0.genNodeMetaData)({sort:3,type:aC.BlockEnum.TriggerWebhook,helpLinkUri:"trigger/webhook-trigger",isStart:!0}),defaultValue:{webhook_url:"",method:"POST",content_type:"application/json",headers:[],params:[],body:[],async_mode:!0,status_code:200,response_body:"",variables:[{variable:c9,label:"raw",value_type:aC.VarType.object,value_selector:[],required:!0}]},checkValid(a,b){if(!a.webhook_url||""===a.webhook_url.trim())return{isValid:!1,errorMessage:b("nodes.triggerWebhook.validation.webhookUrlRequired",{ns:"workflow"})};for(let c of[...a.params||[],...a.body||[]])if(!c8(c.type))return{isValid:!1,errorMessage:b("nodes.triggerWebhook.validation.invalidParameterType",{ns:"workflow",name:c.name,type:c.type})};return{isValid:!0,errorMessage:""}}},db=()=>{let a=(0,aa.useStore)(a=>a.appDetail);return a?.mode===aI.AppModeEnum.ADVANCED_CHAT};a.s(["useIsChatMode",0,db],715381);let dc=()=>{let{t:a}=(0,$.useTranslation)(),b=db(),c=(0,bk.useDocLink)(),d=(0,K.useMemo)(()=>({...cT,metaData:{...cT.metaData,isUndeletable:b}}),[b]),e=(0,K.useMemo)(()=>[...cQ,d,...b?[cR]:[cS,da,c2,cU.default]],[b,d]),f=(0,K.useMemo)(()=>e.map(b=>{let{metaData:d}=b,e=a(`blocks.${d.type}`,{ns:"workflow"}),f=a(`blocksAbout.${d.type}`,{ns:"workflow"}),g=`/use-dify/nodes/${d.helpLinkUri}`;return{...b,metaData:{...d,title:e,description:f,helpLinkUri:c(g)},defaultValue:{...b.defaultValue,type:d.type,title:e}}}),[e,a,c]),g=(0,K.useMemo)(()=>f.reduce((a,b)=>(a[b.metaData.type]=b,a),{}),[f]);return(0,K.useMemo)(()=>({nodes:f,nodesMap:{...g,[aC.BlockEnum.VariableAssigner]:g?.[aC.BlockEnum.VariableAggregator]}}),[f,g])};a.s(["useAvailableNodesMetaData",0,dc],413034);var dd=a.i(133824);let de=()=>{let a=(0,aP.useStore)(a=>a.appId),b=(0,dd.useFeatures)(a=>a.features.file);return(0,K.useMemo)(()=>({flowId:a,flowType:aJ.FlowType.appFlow,fileSettings:b}),[a])};a.s(["useConfigsMap",0,de],483075),a.s(["useDSL",()=>dl],348206);var df=a.i(802066),dg=a.i(760327);a.s(["useNodesSyncDraft",()=>dk],99296);var dh=a.i(380396),di=a.i(737976);let dj=()=>{let a=(0,aP.useWorkflowStore)(),{handleUpdateWorkflowCanvas:b}=(0,di.useWorkflowUpdate)();return{handleRefreshWorkflowDraft:(0,K.useCallback)(()=>{let{appId:c,setSyncWorkflowDraftHash:d,setIsSyncingWorkflowDraft:e,setEnvironmentVariables:f,setEnvSecrets:g,setConversationVariables:h,setIsWorkflowDataLoaded:i,isWorkflowDataLoaded:j,debouncedSyncWorkflowDraft:k}=a.getState();k&&"function"==typeof k.cancel&&k.cancel(),j&&i(!1),e(!0),(0,R.fetchWorkflowDraft)(`/apps/${c}/workflows/draft`).then(a=>{b({nodes:a.graph?.nodes||[],edges:a.graph?.edges||[],viewport:a.graph?.viewport||{x:0,y:0,zoom:1}}),d(a.hash),g((a.environment_variables||[]).filter(a=>"secret"===a.value_type).reduce((a,b)=>(a[b.id]=b.value,a),{})),f(a.environment_variables?.map(a=>"secret"===a.value_type?{...a,value:"[__HIDDEN__]"}:a)||[]),h(a.conversation_variables||[]),i(!0)}).catch(()=>{j&&i(!0)}).finally(()=>{e(!1)})},[b,a])}};a.s(["useWorkflowRefreshDraft",0,dj],671149);let dk=()=>{let a=(0,N.useStoreApi)(),b=(0,aP.useWorkflowStore)(),c=(0,dd.useFeaturesStore)(),{getNodesReadOnly:d}=(0,aq.useNodesReadOnly)(),{handleRefreshWorkflowDraft:e}=dj(),f=(0,K.useCallback)(()=>{let{getNodes:d,edges:e,transform:f}=a.getState(),g=d().filter(a=>!a.data?._isTempNode),[h,i,j]=f,{appId:k,conversationVariables:l,environmentVariables:m,syncWorkflowDraftHash:n,isWorkflowDataLoaded:o}=b.getState();if(!k||!o)return null;let p=c.getState().features;return{url:`/apps/${k}/workflows/draft`,params:{graph:{nodes:(0,I.produce)(g,a=>{a.forEach(a=>{Object.keys(a.data).forEach(b=>{b.startsWith("_")&&delete a.data[b]})})}),edges:(0,I.produce)(e.filter(a=>!a.data?._isTemp),a=>{a.forEach(a=>{Object.keys(a.data).forEach(b=>{b.startsWith("_")&&delete a.data[b]})})}),viewport:{x:h,y:i,zoom:j}},features:{opening_statement:p.opening?.enabled&&p.opening?.opening_statement||"",suggested_questions:p.opening?.enabled&&p.opening?.suggested_questions||[],suggested_questions_after_answer:p.suggested,text_to_speech:p.text2speech,speech_to_text:p.speech2text,retriever_resource:p.citation,sensitive_word_avoidance:p.moderation,file_upload:p.file},environment_variables:m,conversation_variables:l,hash:n}}},[a,c,b]),g=(0,K.useCallback)(()=>{if(d())return;let a=f();a&&navigator.sendBeacon(`${O.API_PREFIX}${a.url}`,JSON.stringify(a.params))},[f,d]),h=(0,K.useCallback)(async(a,c)=>{if(d())return;let g=f();if(g){let{setSyncWorkflowDraftHash:d,setDraftUpdatedAt:f}=b.getState();try{let a=await (0,R.syncWorkflowDraft)(g);d(a.hash),f(a.updated_at),c?.onSuccess?.()}catch(b){b&&b.json&&!b.bodyUsed&&b.json().then(b=>{"draft_workflow_not_sync"!==b.code||a||e()}),c?.onError?.()}finally{c?.onSettled?.()}}},[b,f,d,e]);return{doSyncWorkflowDraft:(0,dh.useSerialAsyncCallback)(h,d),syncWorkflowDraftWhenPageClose:g}},dl=()=>{let{t:a}=(0,$.useTranslation)(),{notify:b}=(0,aX.useToastContext)(),{eventEmitter:c}=(0,P.useEventEmitterContextContext)(),[d,e]=(0,K.useState)(!1),{doSyncWorkflowDraft:f}=dk(),g=(0,aa.useStore)(a=>a.appDetail),h=(0,K.useCallback)(async(c=!1,h)=>{if(g&&!d)try{e(!0),await f();let{data:a}=await (0,df.exportAppConfig)({appID:g.id,include:c,workflowID:h}),b=new Blob([a],{type:"application/yaml"});(0,dg.downloadBlob)({data:b,fileName:`${g.name}.yml`})}catch{b({type:"error",message:a("exportFailed",{ns:"app"})})}finally{e(!1)}},[g,b,a,f,d]);return{exportCheck:(0,K.useCallback)(async()=>{if(g)try{let a=((await (0,R.fetchWorkflowDraft)(`/apps/${g?.id}/workflows/draft`)).environment_variables||[]).filter(a=>"secret"===a.value_type);if(0===a.length)return void h();c?.emit({type:T.DSL_EXPORT_CHECK,payload:{data:a}})}catch{b({type:"error",message:a("exportFailed",{ns:"app"})})}},[g,c,h,b,a]),handleExportDSL:h}};a.s(["useGetRunAndTraceUrl",0,()=>{let a=(0,aP.useWorkflowStore)();return{getWorkflowRunAndTraceUrl:(0,K.useCallback)(b=>{let{appId:c}=a.getState();return{runUrl:`/apps/${c}/workflow-runs/${b}`,traceUrl:`/apps/${c}/workflow-runs/${b}/node-executions`}},[a])}}],461758);var dm=a.i(858585);function dn(a,b=a.length,c){(Number.isNaN(b=Number.parseInt(b=c?a.length:b,10))||b<1)&&(b=0);let d=function(...c){let e=c.filter(a=>a===dn.placeholder),f=c.length-e.length;return f<b?function a(b,c,d){function e(...f){let g=f.filter(a=>a===dn.placeholder),h=f.length-g.length;return(f=function(a,b){let c=[],d=0;for(let e=0;e<b.length;e++){let f=b[e];f===dn.placeholder&&d<a.length?c.push(a[d++]):c.push(f)}for(let b=d;b<a.length;b++)c.push(a[b]);return c}(f,d),h<c)?a(b,c-h,f):this instanceof e?new b(...f):b.apply(this,f)}return e.placeholder=dp,e}(a,b-f,c):this instanceof d?new a(...c):a.apply(this,c)};return d.placeholder=dp,d}let dp=Symbol("curry.placeholder");dn.placeholder=dp;var dq=a.i(203187);let dr=({flowId:a,flowType:b})=>{let c=(0,aP.useWorkflowStore)(),d=(0,N.useStoreApi)(),{useInvalidateConversationVarValues:e,useInvalidateSysVarValues:f,useResetConversationVar:g,useResetToLastRunValue:h,useDeleteAllInspectorVars:i,useDeleteNodeInspectorVars:j,useDeleteInspectVar:k,useEditInspectorVar:l}=(({flowType:a})=>({useInvalidateConversationVarValues:dn(aH.useInvalidateConversationVarValues)(a),useInvalidateSysVarValues:dn(aH.useInvalidateSysVarValues)(a),useResetConversationVar:dn(aH.useResetConversationVar)(a),useResetToLastRunValue:dn(aH.useResetToLastRunValue)(a),useDeleteAllInspectorVars:dn(aH.useDeleteAllInspectorVars)(a),useDeleteNodeInspectorVars:dn(aH.useDeleteNodeInspectorVars)(a),useDeleteInspectVar:dn(aH.useDeleteInspectVar)(a),useEditInspectorVar:dn(aH.useEditInspectorVar)(a)}))({flowType:b}),m=e(a),{mutateAsync:n}=g(a),{mutateAsync:o}=h(a),p=f(a),{mutateAsync:q}=i(a),{mutate:r}=j(a),{mutate:s}=k(a),{mutateAsync:t}=l(a),{handleCancelNodeSuccessStatus:u}=(0,bW.useNodesInteractionsWithoutSync)(),{handleEdgeCancelRunningStatus:v}=(0,dm.useEdgesInteractionsWithoutSync)(),{data:w}=(0,Q.useAllBuiltInTools)(),{data:x}=(0,Q.useAllCustomTools)(),{data:y}=(0,Q.useAllWorkflowTools)(),{data:z}=(0,Q.useAllMCPTools)(),A=(0,K.useCallback)(a=>{let{nodesWithInspectVars:b}=c.getState();return b.find(b=>b.nodeId===a)},[c]),B=(0,K.useCallback)((a,b)=>{let c=A(a);if(c)return c.vars.find(a=>a.selector[1]===b)?.id},[A]),C=(0,K.useCallback)((a,b)=>{let c=A(a);if(c)return c.vars.find(a=>a.name===b)},[A]),D=(0,K.useCallback)((a,b,c,d)=>!!(0,bY.isENV)([a])||((0,bY.isSystemVar)([a])?c.some(a=>a.selector?.[1]?.replace("sys.","")===b):(0,bY.isConversationVar)([a])?d.some(a=>a.selector?.[1]===b):void 0!==C(a,b)),[C]),E=(0,K.useCallback)(a=>!!A(a),[A]),F=(0,K.useCallback)(async(e,f)=>{let{setNodeInspectVars:g,dataSourceList:h}=c.getState(),i=e[0],j="sys"===i,k="conversation"===i;if(j)return void p();if(k)return void m();let{getNodes:l}=d.getState(),n=l().find(a=>a.id===i),o=(0,bY.toNodeOutputVars)([n],!1,()=>!0,[],[],[],{buildInTools:w||[],customTools:x||[],workflowTools:y||[],mcpTools:z||[],dataSourceList:h||[]},f),q=(await (0,R.fetchNodeInspectVars)(b,a,i)).map(a=>{let b=o[0]?.vars.find(b=>b.variable===a.name)?.schemaType||"";return{...a,schemaType:b}});g(i,q)},[c,b,a,p,m,w,x,y,z]),G=(0,K.useCallback)((a,b,d)=>{let{nodesWithInspectVars:e,setNodesWithInspectVars:f}=c.getState();f((0,I.produce)(e,c=>{let e=d.find(b=>b.id===a);if(e){let d=c.findIndex(b=>b.nodeId===a);-1===d?c.unshift({nodeId:a,nodeType:e.data.type,title:e.data.title,vars:b,nodePayload:e.data}):(c[d].vars=b,c.unshift(c.splice(d,1)[0]))}})),u(a)},[c,u]),H=(0,K.useCallback)((a,b)=>{let{nodesWithInspectVars:d}=c.getState(),e=d.find(b=>b.nodeId===a);return!!e&&!!e.vars&&e.vars.some(a=>a.id===b)},[c]),J=(0,K.useCallback)(async(a,b)=>{let{deleteInspectVar:d}=c.getState();H(a,b)&&(await s(b),d(a,b))},[s,c,H]),L=(0,K.useCallback)(async a=>{await n(a),m()},[n,m]),M=(0,K.useCallback)(async a=>{let{deleteNodeInspectVars:b}=c.getState();E(a)&&(await r(a),b(a))},[r,c,E]),O=(0,K.useCallback)(async()=>{let{deleteAllInspectVars:a}=c.getState();await q(),await m(),await p(),a(),v()},[q,m,p,c,v]),P=(0,K.useCallback)(async(a,b,d)=>{let{setInspectVarValue:e}=c.getState();await t({varId:b,value:d}),e(a,b,d),a===dq.VarInInspectType.conversation&&m(),a===dq.VarInInspectType.system&&p()},[t,m,p,c]),S=(0,K.useCallback)(async(a,b,d)=>{let{renameInspectVarName:e}=c.getState(),f=B(a,b);if(!f)return;let g=[a,d];await t({varId:f,name:d}),e(a,f,g)},[t,B,c]);return{hasNodeInspectVars:E,hasSetInspectVar:D,fetchInspectVarValue:F,editInspectVarValue:P,renameInspectVarName:S,appendNodeInspectVars:G,deleteInspectVar:J,deleteNodeInspectorVars:M,deleteAllInspectorVars:O,isInspectVarEdited:(0,K.useCallback)((a,b)=>{let c=C(a,b);return!!c&&c.edited},[C]),resetToLastRunVar:(0,K.useCallback)(async(a,b)=>{let{resetToLastRunVar:d}=c.getState(),e="sys"===a,f=await o(b);e?p():d(a,b,f.value)},[o,p,c]),invalidateSysVarValues:p,resetConversationVar:L,invalidateConversationVarValues:m}};a.s(["useInspectVarsCrudCommon",0,dr],799118),a.s(["useInspectVarsCrud",0,()=>({...dr({...de()})})],178812),a.s(["useWorkflowInit",0,()=>{let a=(0,aP.useWorkflowStore)(),{nodes:b,edges:c}=(()=>{let a=db(),{t:b}=(0,$.useTranslation)(),{newNode:c}=(0,aR.generateNewNode)({data:{...cT.defaultValue,type:cT.metaData.type,title:b(`blocks.${cT.metaData.type}`,{ns:"workflow"})},position:T.START_INITIAL_POSITION});if(!a)return{nodes:[c],edges:[]};{let{newNode:a}=(0,aR.generateNewNode)({id:"llm",data:{...cu.defaultValue,memory:{window:{enabled:!1,size:10},query_prompt_template:"{{#sys.query#}}\n\n{{#sys.files#}}"},selected:!0,type:cu.metaData.type,title:b(`blocks.${cu.metaData.type}`,{ns:"workflow"})},position:{x:T.START_INITIAL_POSITION.x+T.NODE_WIDTH_X_OFFSET,y:T.START_INITIAL_POSITION.y}}),{newNode:d}=(0,aR.generateNewNode)({id:"answer",data:{...cR.defaultValue,answer:`{{#${a.id}.text#}}`,type:cR.metaData.type,title:b(`blocks.${cR.metaData.type}`,{ns:"workflow"})},position:{x:T.START_INITIAL_POSITION.x+2*T.NODE_WIDTH_X_OFFSET,y:T.START_INITIAL_POSITION.y}}),e={id:`${c.id}-${a.id}`,source:c.id,sourceHandle:"source",target:a.id,targetHandle:"target"},f={id:`${a.id}-${d.id}`,source:a.id,sourceHandle:"source",target:d.id,targetHandle:"target"};return{nodes:[c,a,d],edges:[e,f]}}})(),d=(0,aa.useStore)(a=>a.appDetail),e=(0,aP.useStore)(a=>a.setSyncWorkflowDraftHash),[f,g]=(0,K.useState)(),[h,i]=(0,K.useState)(!0);(0,K.useEffect)(()=>{a.setState({appId:d.id,appName:d.name})},[d.id,a]);let j=(0,K.useCallback)(b=>{let{setFileUploadConfig:c}=a.getState();c(b)},[a]),{data:k,isLoading:l}=(0,aH.useWorkflowConfig)("/files/upload",j),m=(0,K.useCallback)(async()=>{try{let b=await (0,R.fetchWorkflowDraft)(`/apps/${d.id}/workflows/draft`);g(b),a.setState({envSecrets:(b.environment_variables||[]).filter(a=>"secret"===a.value_type).reduce((a,b)=>(a[b.id]=b.value,a),{}),environmentVariables:b.environment_variables?.map(a=>"secret"===a.value_type?{...a,value:"[__HIDDEN__]"}:a)||[],conversationVariables:b.conversation_variables||[],isWorkflowDataLoaded:!0}),e(b.hash),i(!1)}catch(e){e&&e.json&&!e.bodyUsed&&d&&e.json().then(e=>{if("draft_workflow_not_exist"===e.code){let e=d.mode===aI.AppModeEnum.ADVANCED_CHAT;a.setState({notInitialWorkflow:!0,showOnboarding:!e,shouldAutoOpenStartNodeSelector:!e,hasShownOnboarding:!1});let f=e?b:[],g=e?c:[];(0,R.syncWorkflowDraft)({url:`/apps/${d.id}/workflows/draft`,params:{graph:{nodes:f,edges:g},features:{retriever_resource:{enabled:!0}},environment_variables:[],conversation_variables:[]}}).then(b=>{a.getState().setDraftUpdatedAt(b.updated_at),m()})}})}},[d,b,c,a,e]);(0,K.useEffect)(()=>{m()},[]);let n=(0,K.useCallback)(async()=>{try{let b=await (0,R.fetchNodesDefaultConfigs)(`/apps/${d?.id}/workflows/default-workflow-block-configs`),c=await (0,R.fetchPublishedWorkflow)(`/apps/${d?.id}/workflows/publish`);a.setState({nodesDefaultConfigs:b.reduce((a,b)=>(a[b.type]||(a[b.type]={...b.config}),a),{})}),a.getState().setPublishedAt(c?.created_at);let e=c?.graph;a.getState().setLastPublishedHasUserInput(((a=[],b=[])=>{let c=a.filter(a=>a?.data?.type===aC.BlockEnum.Start).map(a=>a.id);return!!c.length&&b.some(a=>c.includes(a.source))})(e?.nodes,e?.edges))}catch(b){console.error(b),a.getState().setLastPublishedHasUserInput(!1)}},[a,d]);return(0,K.useEffect)(()=>{n()},[n]),(0,K.useEffect)(()=>{f&&(a.getState().setDraftUpdatedAt(f.updated_at),a.getState().setToolPublished(f.tool_published))},[f,a]),{data:f,isLoading:h||l,fileUploadConfigResponse:k}}],632295),a.s(["useWorkflowRun",()=>dF],927592);var ds=a.i(111089),dt=a.i(533306),du=a.i(44348);a.i(60796);var dv=a.i(55282),dw=a.i(41548),dx=a.i(56328),dy=((q={}).UserInput="user_input",q.Schedule="schedule",q.Webhook="webhook",q.Plugin="plugin",q.All="all",q);let dz=(0,K.forwardRef)(({options:a,onSelect:b,children:c},d)=>{let{t:e}=(0,$.useTranslation)(),[f,g]=(0,K.useState)(!1),h=(0,K.useMemo)(()=>{let b,c;return b=[],a.userInput&&!1!==a.userInput.enabled&&b.push({option:a.userInput,shortcutKey:"~"}),c=0,a.runAll&&!1!==a.runAll.enabled&&b.push({option:a.runAll,shortcutKey:String(c++)}),a.triggers.forEach(a=>{!1!==a.enabled&&b.push({option:a,shortcutKey:String(c++)})}),b},[a]),i=(0,K.useMemo)(()=>{let a=new Map;return h.forEach(({option:b,shortcutKey:c})=>{a.set(b.id,c)}),a},[h]),j=(0,K.useCallback)(a=>{b(a),g(!1)},[b]),k=(0,K.useMemo)(()=>{let b=[];return a.userInput&&b.push(a.userInput),a.runAll&&b.push(a.runAll),b.push(...a.triggers),b.filter(a=>!1!==a.enabled)},[a]),l=1===k.length,m=l?k[0]:void 0,n=(0,K.useCallback)(()=>{m&&j(m)},[j,m]);(0,K.useImperativeHandle)(d,()=>({toggle:()=>{l?n():g(a=>!a)}}),[l,n]),(0,K.useEffect)(()=>{if(!f)return;let a=a=>{if(a.defaultPrevented||a.repeat||a.altKey||a.ctrlKey||a.metaKey)return;let b="`"===a.key?"~":a.key,c=h.find(({shortcutKey:a})=>a===b);c&&(a.preventDefault(),j(c.option))};return window.addEventListener("keydown",a),()=>{window.removeEventListener("keydown",a)}},[j,f,h]);let o=a=>{let b=i.get(a.id);return(0,F.jsxs)("div",{className:"system-md-regular flex cursor-pointer items-center rounded-lg px-3 py-1.5 text-text-secondary hover:bg-state-base-hover",onClick:()=>j(a),children:[(0,F.jsxs)("div",{className:"flex min-w-0 flex-1 items-center",children:[(0,F.jsx)("div",{className:"flex h-6 w-6 shrink-0 items-center justify-center",children:a.icon}),(0,F.jsx)("span",{className:"ml-2 truncate",children:a.name})]}),b&&(0,F.jsx)(dx.default,{keys:[b],className:"ml-2",textColor:"secondary"})]},a.id)},p=!!a.userInput&&!1!==a.userInput.enabled,q=a.triggers.some(a=>!1!==a.enabled),r=!!a.runAll&&!1!==a.runAll.enabled;if(l&&m){if((0,K.isValidElement)(c)){let a=c.props?.onClick;return(0,K.cloneElement)(c,{onClick:b=>{"function"==typeof a&&a(b),b?.defaultPrevented||n()}})}return(0,F.jsx)("span",{onClick:a=>{a?.defaultPrevented||n()},children:c})}return(0,F.jsxs)(bh.PortalToFollowElem,{open:f,onOpenChange:g,placement:"bottom-start",offset:{mainAxis:8,crossAxis:-4},children:[(0,F.jsx)(bh.PortalToFollowElemTrigger,{asChild:!0,onClick:()=>g(!f),children:(0,F.jsx)("div",{style:{userSelect:"none"},children:c})}),(0,F.jsx)(bh.PortalToFollowElemContent,{className:"z-[12]",children:(0,F.jsxs)("div",{className:"w-[284px] rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg p-1 shadow-lg",children:[(0,F.jsx)("div",{className:"mb-2 px-3 pt-2 text-sm font-medium text-text-primary",children:e("common.chooseStartNodeToRun",{ns:"workflow"})}),(0,F.jsxs)("div",{children:[p&&o(a.userInput),(q||r)&&p&&(0,F.jsx)("div",{className:"mx-3 my-1 h-px bg-divider-subtle"}),r&&o(a.runAll),q&&a.triggers.filter(a=>!1!==a.enabled).map(a=>o(a))]})]})})]})});dz.displayName="TestRunMenu",a.s(["TriggerType",()=>dy,"default",0,dz],230285);let dA=()=>{let a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,{handleWorkflowStarted:B}=(a=(0,N.useStoreApi)(),b=(0,aP.useWorkflowStore)(),{handleWorkflowStarted:(0,K.useCallback)(c=>{let{task_id:d,data:e}=c,{workflowRunningData:f,setWorkflowRunningData:g,setIterParallelLogMap:h}=b.getState(),{getNodes:i,setNodes:j,edges:k,setEdges:l}=a.getState();h(new Map),g((0,I.produce)(f,a=>{a.task_id=d,a.result={...a?.result,...e,status:aC.WorkflowRunningStatus.Running}}));let m=i();j((0,I.produce)(m,a=>{a.forEach(a=>{a.data._waitingRun=!0,a.data._runningBranchId=void 0})})),l((0,I.produce)(k,a=>{a.forEach(a=>{a.data={...a.data,_sourceRunningStatus:void 0,_targetRunningStatus:void 0,_waitingRun:!0}})}))},[b,a])}),{handleWorkflowFinished:C}=(c=(0,aP.useWorkflowStore)(),{handleWorkflowFinished:(0,K.useCallback)(a=>{let{data:b}=a,{workflowRunningData:d,setWorkflowRunningData:e}=c.getState(),f=b.outputs&&1===Object.keys(b.outputs).length&&"string"==typeof b.outputs[Object.keys(b.outputs)[0]];e((0,I.produce)(d,a=>{a.result={...a.result,...b,files:(0,aW.getFilesInLogs)(b.outputs)},f&&(a.resultTabActive=!0,a.resultText=b.outputs[Object.keys(b.outputs)[0]])}))},[c])}),{handleWorkflowFailed:D}=(d=(0,aP.useWorkflowStore)(),{handleWorkflowFailed:(0,K.useCallback)(()=>{let{workflowRunningData:a,setWorkflowRunningData:b}=d.getState();b((0,I.produce)(a,a=>{a.result={...a.result,status:aC.WorkflowRunningStatus.Failed}}))},[d])}),{handleWorkflowNodeStarted:E}=(e=(0,N.useStoreApi)(),f=(0,aP.useWorkflowStore)(),g=(0,N.useReactFlow)(),{handleWorkflowNodeStarted:(0,K.useCallback)((a,b)=>{let{data:c}=a,{workflowRunningData:d,setWorkflowRunningData:h}=f.getState(),{getNodes:i,setNodes:j,edges:k,setEdges:l,transform:m}=e.getState(),n=i();h((0,I.produce)(d,a=>{a.tracing.push({...c,status:aC.NodeRunningStatus.Running})}));let{setViewport:o}=g,p=n.findIndex(a=>a.id===c.node_id),q=n[p],r=q.position,s=m[2];q.parentId||o({x:(b.clientWidth-400-q.width*s)/2-r.x*s,y:(b.clientHeight-q.height*s)/2-r.y*s,zoom:m[2]}),j((0,I.produce)(n,a=>{a[p].data._runningStatus=aC.NodeRunningStatus.Running,a[p].data._waitingRun=!1})),l((0,I.produce)(k,a=>{a.filter(a=>a.target===c.node_id).forEach(a=>{let b=n.find(b=>b.id===a.source);b&&"data"in b&&(!b.data._runningBranchId&&"source"===a.sourceHandle||b.data._runningBranchId&&a.sourceHandle===b.data._runningBranchId)&&(a.data={...a.data,_sourceRunningStatus:b.data._runningStatus,_targetRunningStatus:aC.NodeRunningStatus.Running,_waitingRun:!1})})}))},[f,e,g])}),{handleWorkflowNodeFinished:F}=(h=(0,N.useStoreApi)(),i=(0,aP.useWorkflowStore)(),{handleWorkflowNodeFinished:(0,K.useCallback)(a=>{let{data:b}=a,{workflowRunningData:c,setWorkflowRunningData:d}=i.getState(),{getNodes:e,setNodes:f,edges:g,setEdges:j}=h.getState(),k=e();d((0,I.produce)(c,a=>{let c=a.tracing.findIndex(a=>a.id===b.id);c>-1&&(a.tracing[c]={...a.tracing[c],...b})})),f((0,I.produce)(k,a=>{let c=a.find(a=>a.id===b.node_id);c.data._runningStatus=b.status,b.status===aC.NodeRunningStatus.Exception?b.execution_metadata?.error_strategy===bi.ErrorHandleTypeEnum.failBranch&&(c.data._runningBranchId=bi.ErrorHandleTypeEnum.failBranch):(b.node_type===aC.BlockEnum.IfElse&&(c.data._runningBranchId=b?.outputs?.selected_case_id),b.node_type===aC.BlockEnum.QuestionClassifier&&(c.data._runningBranchId=b?.outputs?.class_id))})),j((0,I.produce)(g,a=>{a.filter(a=>a.target===b.node_id).forEach(a=>{a.data={...a.data,_targetRunningStatus:b.status}})}))},[h,i])}),{handleWorkflowNodeIterationStarted:G}=(j=(0,N.useStoreApi)(),k=(0,N.useReactFlow)(),l=(0,aP.useWorkflowStore)(),{handleWorkflowNodeIterationStarted:(0,K.useCallback)((a,b)=>{let{data:c}=a,{workflowRunningData:d,setWorkflowRunningData:e,setIterTimes:f}=l.getState(),{getNodes:g,setNodes:h,edges:i,setEdges:m,transform:n}=j.getState(),o=g();e((0,I.produce)(d,a=>{a.tracing.push({...c,status:aC.NodeRunningStatus.Running})})),f(T.DEFAULT_ITER_TIMES);let{setViewport:p}=k,q=o.findIndex(a=>a.id===c.node_id),r=o[q],s=r.position,t=n[2];r.parentId||p({x:(b.clientWidth-400-r.width*t)/2-s.x*t,y:(b.clientHeight-r.height*t)/2-s.y*t,zoom:n[2]}),h((0,I.produce)(o,a=>{a[q].data._runningStatus=aC.NodeRunningStatus.Running,a[q].data._iterationLength=c.metadata.iterator_length,a[q].data._waitingRun=!1})),m((0,I.produce)(i,a=>{a.filter(a=>a.target===c.node_id).forEach(a=>{a.data={...a.data,_sourceRunningStatus:o.find(b=>b.id===a.source).data._runningStatus,_targetRunningStatus:aC.NodeRunningStatus.Running,_waitingRun:!1}})}))},[l,j,k])}),{handleWorkflowNodeIterationNext:H}=(m=(0,N.useStoreApi)(),n=(0,aP.useWorkflowStore)(),{handleWorkflowNodeIterationNext:(0,K.useCallback)(a=>{let{iterTimes:b,setIterTimes:c}=n.getState(),{data:d}=a,{getNodes:e,setNodes:f}=m.getState(),g=e();f((0,I.produce)(g,a=>{a.find(a=>a.id===d.node_id).data._iterationIndex=b,c(b+1)}))},[n,m])}),{handleWorkflowNodeIterationFinished:J}=(o=(0,N.useStoreApi)(),p=(0,aP.useWorkflowStore)(),{handleWorkflowNodeIterationFinished:(0,K.useCallback)(a=>{let{data:b}=a,{workflowRunningData:c,setWorkflowRunningData:d,setIterTimes:e}=p.getState(),{getNodes:f,setNodes:g,edges:h,setEdges:i}=o.getState(),j=f();d((0,I.produce)(c,a=>{let c=a.tracing.findIndex(a=>a.id===b.id);c>-1&&(a.tracing[c]={...a.tracing[c],...b})})),e(T.DEFAULT_ITER_TIMES),g((0,I.produce)(j,a=>{a.find(a=>a.id===b.node_id).data._runningStatus=b.status})),i((0,I.produce)(h,a=>{a.filter(a=>a.target===b.node_id).forEach(a=>{a.data={...a.data,_targetRunningStatus:b.status}})}))},[p,o])}),{handleWorkflowNodeLoopStarted:L}=(q=(0,N.useStoreApi)(),r=(0,N.useReactFlow)(),s=(0,aP.useWorkflowStore)(),{handleWorkflowNodeLoopStarted:(0,K.useCallback)((a,b)=>{let{data:c}=a,{workflowRunningData:d,setWorkflowRunningData:e}=s.getState(),{getNodes:f,setNodes:g,edges:h,setEdges:i,transform:j}=q.getState(),k=f();e((0,I.produce)(d,a=>{a.tracing.push({...c,status:aC.NodeRunningStatus.Running})}));let{setViewport:l}=r,m=k.findIndex(a=>a.id===c.node_id),n=k[m],o=n.position,p=j[2];n.parentId||l({x:(b.clientWidth-400-n.width*p)/2-o.x*p,y:(b.clientHeight-n.height*p)/2-o.y*p,zoom:j[2]}),g((0,I.produce)(k,a=>{a[m].data._runningStatus=aC.NodeRunningStatus.Running,a[m].data._loopLength=c.metadata.loop_length,a[m].data._waitingRun=!1})),i((0,I.produce)(h,a=>{a.filter(a=>a.target===c.node_id).forEach(a=>{a.data={...a.data,_sourceRunningStatus:k.find(b=>b.id===a.source).data._runningStatus,_targetRunningStatus:aC.NodeRunningStatus.Running,_waitingRun:!1}})}))},[s,q,r])}),{handleWorkflowNodeLoopNext:M}=(t=(0,N.useStoreApi)(),{handleWorkflowNodeLoopNext:(0,K.useCallback)(a=>{let{data:b}=a,{getNodes:c,setNodes:d}=t.getState(),e=c();d((0,I.produce)(e,a=>{a.find(a=>a.id===b.node_id).data._loopIndex=b.index,a.forEach(a=>{a.parentId===b.node_id&&(a.data._waitingRun=!0,a.data._runningStatus=aC.NodeRunningStatus.Waiting)})}))},[t])}),{handleWorkflowNodeLoopFinished:O}=(u=(0,N.useStoreApi)(),v=(0,aP.useWorkflowStore)(),{handleWorkflowNodeLoopFinished:(0,K.useCallback)(a=>{let{data:b}=a,{workflowRunningData:c,setWorkflowRunningData:d}=v.getState(),{getNodes:e,setNodes:f,edges:g,setEdges:h}=u.getState(),i=e();d((0,I.produce)(c,a=>{let c=a.tracing.findIndex(a=>a.id===b.id);c>-1&&(a.tracing[c]={...a.tracing[c],...b})})),f((0,I.produce)(i,a=>{a.find(a=>a.id===b.node_id).data._runningStatus=b.status})),h((0,I.produce)(g,a=>{a.filter(a=>a.target===b.node_id).forEach(a=>{a.data={...a.data,_targetRunningStatus:b.status}})}))},[v,u])}),{handleWorkflowNodeRetry:P}=(w=(0,N.useStoreApi)(),x=(0,aP.useWorkflowStore)(),{handleWorkflowNodeRetry:(0,K.useCallback)(a=>{let{data:b}=a,{workflowRunningData:c,setWorkflowRunningData:d}=x.getState(),{getNodes:e,setNodes:f}=w.getState(),g=e();d((0,I.produce)(c,a=>{a.tracing.push(b)})),f((0,I.produce)(g,a=>{a.find(a=>a.id===b.node_id).data._retryIndex=b.retry_index}))},[x,w])}),{handleWorkflowTextChunk:Q}=(y=(0,aP.useWorkflowStore)(),{handleWorkflowTextChunk:(0,K.useCallback)(a=>{let{data:{text:b}}=a,{workflowRunningData:c,setWorkflowRunningData:d}=y.getState();d((0,I.produce)(c,a=>{a.resultTabActive=!0,a.resultText+=b}))},[y])}),{handleWorkflowTextReplace:R}=(z=(0,aP.useWorkflowStore)(),{handleWorkflowTextReplace:(0,K.useCallback)(a=>{let{data:{text:b}}=a,{workflowRunningData:c,setWorkflowRunningData:d}=z.getState();d((0,I.produce)(c,a=>{a.resultText=b}))},[z])}),{handleWorkflowAgentLog:S}=(A=(0,aP.useWorkflowStore)(),{handleWorkflowAgentLog:(0,K.useCallback)(a=>{let{data:b}=a,{workflowRunningData:c,setWorkflowRunningData:d}=A.getState();d((0,I.produce)(c,a=>{let c=a.tracing.findIndex(a=>a.node_id===b.node_id);if(c>-1){let d=a.tracing[c];if(d.execution_metadata)if(d.execution_metadata.agent_log){let a=d.execution_metadata.agent_log.findIndex(a=>a.message_id===b.message_id);a>-1?d.execution_metadata.agent_log[a]={...d.execution_metadata.agent_log[a],...b}:d.execution_metadata.agent_log.push(b)}else d.execution_metadata.agent_log=[b];else d.execution_metadata={agent_log:[b]}}}))},[A])});return{handleWorkflowStarted:B,handleWorkflowFinished:C,handleWorkflowFailed:D,handleWorkflowNodeStarted:E,handleWorkflowNodeFinished:F,handleWorkflowNodeIterationStarted:G,handleWorkflowNodeIterationNext:H,handleWorkflowNodeIterationFinished:J,handleWorkflowNodeLoopStarted:L,handleWorkflowNodeLoopNext:M,handleWorkflowNodeLoopFinished:O,handleWorkflowNodeRetry:P,handleWorkflowTextChunk:Q,handleWorkflowTextReplace:R,handleWorkflowAgentLog:S}};var dB=a.i(41511),dC=a.i(32358);let dD={[dy.Webhook]:"__webhookDebugAbortController",[dy.Plugin]:"__pluginDebugAbortController",[dy.All]:"__allTriggersDebugAbortController",[dy.Schedule]:"__scheduleDebugAbortController"},dE={[dy.Webhook]:"Webhook",[dy.Plugin]:"Plugin",[dy.All]:"All",[dy.Schedule]:"Schedule"},dF=()=>{let a=(0,N.useStoreApi)(),b=(0,aP.useWorkflowStore)(),c=(0,N.useReactFlow)(),d=(0,dd.useFeaturesStore)(),{doSyncWorkflowDraft:e}=dk(),{handleUpdateWorkflowCanvas:f}=(0,di.useWorkflowUpdate)(),g=(0,dt.usePathname)(),h=de(),{flowId:i,flowType:j}=h,k=(0,aH.useInvalidAllLastRun)(j,i),{fetchInspectVars:l}=bZ({...h}),m=(0,K.useRef)(null),{handleWorkflowStarted:n,handleWorkflowFinished:o,handleWorkflowFailed:p,handleWorkflowNodeStarted:q,handleWorkflowNodeFinished:r,handleWorkflowNodeIterationStarted:s,handleWorkflowNodeIterationNext:t,handleWorkflowNodeIterationFinished:u,handleWorkflowNodeLoopStarted:v,handleWorkflowNodeLoopNext:w,handleWorkflowNodeLoopFinished:x,handleWorkflowNodeRetry:y,handleWorkflowAgentLog:z,handleWorkflowTextChunk:A,handleWorkflowTextReplace:B}=dA(),C=(0,K.useCallback)(()=>{let{getNodes:f,edges:g}=a.getState(),{getViewport:h}=c,{backupDraft:i,setBackupDraft:j,environmentVariables:k}=b.getState(),{features:l}=d.getState();i||(j({nodes:f(),edges:g,viewport:h(),features:l,environmentVariables:k}),e())},[c,b,a,d,e]),D=(0,K.useCallback)(()=>{let{backupDraft:a,setBackupDraft:c,setEnvironmentVariables:e}=b.getState();if(a){let{nodes:b,edges:g,viewport:h,features:i,environmentVariables:j}=a;f({nodes:b,edges:g,viewport:h}),e(j),d.setState({features:i}),c(void 0)}},[f,b,d]),E=(0,K.useCallback)(async(c,d,f)=>{let h=f?.mode??dy.UserInput,j=c??{},{getNodes:C,setNodes:D}=a.getState();D((0,I.produce)(C(),a=>{a.forEach(a=>{a.data.selected=!1,a.data._runningStatus=void 0})})),await e();let{onWorkflowStarted:E,onWorkflowFinished:F,onNodeStarted:G,onNodeFinished:H,onIterationStart:J,onIterationNext:K,onIterationFinish:L,onLoopStart:M,onLoopNext:N,onLoopFinish:O,onNodeRetry:P,onAgentLog:Q,onError:R,onCompleted:S,...T}=d||{};b.setState({historyWorkflowData:void 0});let U=aa.useStore.getState().appDetail,{clientWidth:V,clientHeight:W}=document.getElementById("workflow-container"),X=U?.mode===aI.AppModeEnum.WORKFLOW,Y="";if(h===dy.Plugin||h===dy.Webhook||h===dy.Schedule){if(!U?.id)return void console.error("handleRun: missing app id for trigger plugin run");Y=`/apps/${U.id}/workflows/draft/trigger/run`}else if(h===dy.All){if(!U?.id)return void console.error("handleRun: missing app id for trigger run all");Y=`/apps/${U.id}/workflows/draft/trigger/run-all`}else U?.mode===aI.AppModeEnum.ADVANCED_CHAT?Y=`/apps/${U.id}/advanced-chat/workflows/draft/run`:X&&U?.id&&(Y=`/apps/${U.id}/workflows/draft/run`);let Z={};if(Z=h===dy.Schedule?{node_id:f?.scheduleNodeId}:h===dy.Webhook?{node_id:f?.webhookNodeId}:h===dy.Plugin?{node_id:f?.pluginNodeId}:h===dy.All?{node_ids:f?.allNodeIds}:j,!Y)return;if(h===dy.Schedule&&!f?.scheduleNodeId)return void console.error("handleRun: schedule trigger run requires node id");if(h===dy.Webhook&&!f?.webhookNodeId)return void console.error("handleRun: webhook trigger run requires node id");if(h===dy.Plugin&&!f?.pluginNodeId)return void console.error("handleRun: plugin trigger run requires node id");if(h===dy.All&&!f?.allNodeIds&&f?.allNodeIds?.length===0)return void console.error("handleRun: all trigger run requires node ids");m.current?.abort(),m.current=null;let{setWorkflowRunningData:$,setIsListening:_,setShowVariableInspectPanel:ab,setListeningTriggerType:ac,setListeningTriggerNodeIds:ad,setListeningTriggerIsAll:ae,setListeningTriggerNodeId:af}=b.getState();h===dy.Webhook||h===dy.Plugin||h===dy.All||h===dy.Schedule?(_(!0),ab(!0),ae(h===dy.All),ad(h===dy.All?f?.allNodeIds??[]:h===dy.Webhook&&f?.webhookNodeId?[f.webhookNodeId]:h===dy.Schedule&&f?.scheduleNodeId?[f.scheduleNodeId]:h===dy.Plugin&&f?.pluginNodeId?[f.pluginNodeId]:[])):(_(!1),ac(null),af(null),ad([]),ae(!1)),$({result:{status:aC.WorkflowRunningStatus.Running,inputs_truncated:!1,process_data_truncated:!1,outputs_truncated:!1},tracing:[],resultText:""});let ag="",ah=!1;j.token?(ag="/text-to-audio",ah=!0):j.appId&&(ag=g.search("explore/installed")>-1?`/installed-apps/${j.appId}/text-to-audio`:`/apps/${j.appId}/text-to-audio`);let ai=null,aj=()=>(ai||(ai=dw.AudioPlayerManager.getInstance().getAudioPlayer(ag,ah,(0,du.v4)(),"none","none",ds.noop)),ai),ak=()=>{m.current=null,delete window.__webhookDebugAbortController,delete window.__pluginDebugAbortController,delete window.__scheduleDebugAbortController,delete window.__allTriggersDebugAbortController},al=()=>{let a=b.getState();a.setIsListening(!1),a.setListeningTriggerType(null),a.setListeningTriggerNodeId(null),a.setListeningTriggerNodeIds([]),a.setListeningTriggerIsAll(!1)},am=async(a,b)=>{ak(),al(),S&&S(a,b)},an={...T,onWorkflowStarted:a=>{let c=b.getState();c.workflowRunningData&&c.setWorkflowRunningData((0,I.produce)(c.workflowRunningData,a=>{a.resultText=""})),n(a),E&&E(a)},onWorkflowFinished:a=>{al(),o(a),F&&F(a),X&&(l({}),k())},onNodeStarted:a=>{q(a,{clientWidth:V,clientHeight:W}),G&&G(a)},onNodeFinished:a=>{r(a),H&&H(a)},onIterationStart:a=>{s(a,{clientWidth:V,clientHeight:W}),J&&J(a)},onIterationNext:a=>{t(a),K&&K(a)},onIterationFinish:a=>{u(a),L&&L(a)},onLoopStart:a=>{v(a,{clientWidth:V,clientHeight:W}),M&&M(a)},onLoopNext:a=>{w(a),N&&N(a)},onLoopFinish:a=>{x(a),O&&O(a)},onNodeRetry:a=>{y(a),P&&P(a)},onAgentLog:a=>{z(a),Q&&Q(a)},onTextChunk:a=>{A(a)},onTextReplace:a=>{B(a)},onTTSChunk:(a,b)=>{if(!b||""===b)return;let c=aj();c&&(c.playAudioWithAudio(b,!0),dw.AudioPlayerManager.getInstance().resetMsgId(a))},onTTSEnd:(a,b)=>{let c=aj();c&&c.playAudioWithAudio(b,!1)},onError:a=>{ak(),p(),al(),R&&R(a),(0,dv.trackEvent)("workflow_run_failed",{workflow_id:i,reason:a.error,node_type:a.node_type})},onCompleted:am},ao=async a=>{let b=new AbortController;m.current=b;let c=dD[a];window[c]=b;let d=dE[a],e=async()=>{try{let a=await (0,dB.post)(Y,{body:Z,signal:b.signal},{needAllResponseContent:!0});if(b.signal.aborted)return;if(!a){let a=`${d} debug request failed`;aX.default.notify({type:"error",message:a}),ak();return}if((a.headers.get("content-type")||"").includes(dC.ContentType.json)){let c=null;try{c=await a.json()}catch(a){console.error(`handleRun: ${d.toLowerCase()} debug response parse error`,a),aX.default.notify({type:"error",message:`${d} debug request failed`}),ak(),al();return}if(b.signal.aborted)return;if(c?.status==="waiting"){let a,d=Number(c.retry_in)||2e3;if(await (a=b.signal,new Promise(b=>{let c=window.setTimeout(b,d);a.addEventListener("abort",()=>{clearTimeout(c),b()},{once:!0})})),b.signal.aborted)return;await e();return}let f=c?.message||`${d} debug failed`;aX.default.notify({type:"error",message:f}),ak(),$({result:{status:aC.WorkflowRunningStatus.Failed,error:f,inputs_truncated:!1,process_data_truncated:!1,outputs_truncated:!1},tracing:[]}),al();return}al(),(0,dB.handleStream)(a,an.onData??ds.noop,an.onCompleted,an.onThought,an.onMessageEnd,an.onMessageReplace,an.onFile,an.onWorkflowStarted,an.onWorkflowFinished,an.onNodeStarted,an.onNodeFinished,an.onIterationStart,an.onIterationNext,an.onIterationFinish,an.onLoopStart,an.onLoopNext,an.onLoopFinish,an.onNodeRetry,an.onParallelBranchStarted,an.onParallelBranchFinished,an.onTextChunk,an.onTTSChunk,an.onTTSEnd,an.onTextReplace,an.onAgentLog,an.onDataSourceNodeProcessing,an.onDataSourceNodeCompleted,an.onDataSourceNodeError)}catch(a){if(b.signal.aborted)return;if(a instanceof Response){let{error:b}=await a.clone().json()||{};aX.default.notify({type:"error",message:b}),ak(),$({result:{status:aC.WorkflowRunningStatus.Failed,error:b,inputs_truncated:!1,process_data_truncated:!1,outputs_truncated:!1},tracing:[]})}al()}};await e()};h===dy.Schedule?await ao(dy.Schedule):h===dy.Webhook?await ao(dy.Webhook):h===dy.Plugin?await ao(dy.Plugin):h===dy.All?await ao(dy.All):(0,dB.ssePost)(Y,{body:Z},{...an,getAbortController:a=>{m.current=a}})},[a,e,b,g,n,o,l,k,p,q,r,s,t,u,v,w,x,y,z,A,B]);return{handleBackupDraft:C,handleLoadBackupDraft:D,handleRun:E,handleStopRun:(0,K.useCallback)(a=>{let c=()=>{let{setWorkflowRunningData:a,setIsListening:c,setShowVariableInspectPanel:d,setListeningTriggerType:e,setListeningTriggerNodeId:f}=b.getState();a({result:{status:aC.WorkflowRunningStatus.Stopped,inputs_truncated:!1,process_data_truncated:!1,outputs_truncated:!1},tracing:[],resultText:""}),c(!1),e(null),f(null),d(!0)};if(a){let b=aa.useStore.getState().appDetail?.id;(0,R.stopWorkflowRun)(`/apps/${b}/workflow-runs/tasks/${a}/stop`),c();return}let d=window.__webhookDebugAbortController;d&&d.abort();let e=window.__pluginDebugAbortController;e&&e.abort();let f=window.__scheduleDebugAbortController;f&&f.abort();let g=window.__allTriggersDebugAbortController;g&&g.abort(),m.current&&m.current.abort(),m.current=null,c()},[b]),handleRestoreFromPublishedWorkflow:(0,K.useCallback)(a=>{let c=a.graph.nodes.map(a=>({...a,selected:!1,data:{...a.data,selected:!1}}));f({nodes:c,edges:a.graph.edges,viewport:a.graph.viewport});let e={opening:{enabled:!!a.features.opening_statement||!!a.features.suggested_questions.length,opening_statement:a.features.opening_statement,suggested_questions:a.features.suggested_questions},suggested:a.features.suggested_questions_after_answer,text2speech:a.features.text_to_speech,speech2text:a.features.speech_to_text,citation:a.features.retriever_resource,moderation:a.features.sensitive_word_avoidance,file:a.features.file_upload};d?.setState({features:e}),b.getState().setEnvironmentVariables(a.environment_variables||[])},[d,f,b])}};a.s(["useWorkflowStartRun",()=>dG],526897);let dG=()=>{let a=(0,N.useStoreApi)(),b=(0,aP.useWorkflowStore)(),c=(0,dd.useFeaturesStore)(),d=db(),{handleCancelDebugAndPreviewPanel:e}=(0,di.useWorkflowInteractions)(),{handleRun:f}=dF(),{doSyncWorkflowDraft:g}=dk(),h=(0,K.useCallback)(async()=>{let{workflowRunningData:d}=b.getState();if(d?.result.status===aC.WorkflowRunningStatus.Running)return;let{getNodes:h}=a.getState(),i=h().find(a=>a.data.type===aC.BlockEnum.Start),j=i?.data.variables||[],k=c.getState().features.file,{showDebugAndPreviewPanel:l,setShowDebugAndPreviewPanel:m,setShowInputsPanel:n,setShowEnvPanel:o,setShowGlobalVariablePanel:p}=b.getState();(o(!1),p(!1),l)?e():j.length||k?.image?.enabled?(m(!0),n(!0)):(await g(),f({inputs:{},files:[]}),m(!0),n(!1))},[a,b,c,e,f,g]),i=(0,K.useCallback)(async c=>{if(!c)return;let{workflowRunningData:d,showDebugAndPreviewPanel:h,setShowDebugAndPreviewPanel:i,setShowInputsPanel:j,setShowEnvPanel:k,setShowGlobalVariablePanel:l,setListeningTriggerType:m,setListeningTriggerNodeId:n,setListeningTriggerNodeIds:o,setListeningTriggerIsAll:p}=b.getState();if(d?.result.status===aC.WorkflowRunningStatus.Running)return;let{getNodes:q}=a.getState();q().find(a=>a.id===c&&a.data.type===aC.BlockEnum.TriggerSchedule)?(k(!1),l(!1),h)?e():(m(aC.BlockEnum.TriggerSchedule),n(c),o([c]),p(!1),await g(),f({},void 0,{mode:dy.Schedule,scheduleNodeId:c}),i(!0),j(!1)):console.warn("handleWorkflowTriggerScheduleRunInWorkflow: schedule node not found",c)},[a,b,e,f,g]),j=(0,K.useCallback)(async({nodeId:c})=>{if(!c)return;let{workflowRunningData:d,showDebugAndPreviewPanel:e,setShowDebugAndPreviewPanel:h,setShowInputsPanel:i,setShowEnvPanel:j,setShowGlobalVariablePanel:k,setListeningTriggerType:l,setListeningTriggerNodeId:m,setListeningTriggerNodeIds:n,setListeningTriggerIsAll:o}=b.getState();if(d?.result.status===aC.WorkflowRunningStatus.Running)return;let{getNodes:p}=a.getState();p().find(a=>a.id===c&&a.data.type===aC.BlockEnum.TriggerWebhook)?(j(!1),k(!1),e||h(!0),i(!1),l(aC.BlockEnum.TriggerWebhook),m(c),n([c]),o(!1),await g(),f({node_id:c},void 0,{mode:dy.Webhook,webhookNodeId:c})):console.warn("handleWorkflowTriggerWebhookRunInWorkflow: webhook node not found",c)},[a,b,f,g]),k=(0,K.useCallback)(async c=>{if(!c)return;let{workflowRunningData:d,showDebugAndPreviewPanel:e,setShowDebugAndPreviewPanel:h,setShowInputsPanel:i,setShowEnvPanel:j,setShowGlobalVariablePanel:k,setListeningTriggerType:l,setListeningTriggerNodeId:m,setListeningTriggerNodeIds:n,setListeningTriggerIsAll:o}=b.getState();if(d?.result.status===aC.WorkflowRunningStatus.Running)return;let{getNodes:p}=a.getState();p().find(a=>a.id===c&&a.data.type===aC.BlockEnum.TriggerPlugin)?(j(!1),k(!1),e||h(!0),i(!1),l(aC.BlockEnum.TriggerPlugin),m(c),n([c]),o(!1),await g(),f({node_id:c},void 0,{mode:dy.Plugin,pluginNodeId:c})):console.warn("handleWorkflowTriggerPluginRunInWorkflow: plugin node not found",c)},[a,b,f,g]),l=(0,K.useCallback)(async a=>{if(!a.length)return;let{workflowRunningData:c,showDebugAndPreviewPanel:d,setShowDebugAndPreviewPanel:e,setShowInputsPanel:h,setShowEnvPanel:i,setShowGlobalVariablePanel:j,setListeningTriggerIsAll:k,setListeningTriggerNodeIds:l,setListeningTriggerNodeId:m}=b.getState();c?.result.status!==aC.WorkflowRunningStatus.Running&&(i(!1),j(!1),h(!1),k(!0),l(a),m(null),d||e(!0),await g(),f({node_ids:a},void 0,{mode:dy.All,allNodeIds:a}))},[a,b,f,g]),m=(0,K.useCallback)(async()=>{let{showDebugAndPreviewPanel:a,setShowDebugAndPreviewPanel:c,setHistoryWorkflowData:d,setShowEnvPanel:f,setShowChatVariablePanel:g,setShowGlobalVariablePanel:h}=b.getState();f(!1),g(!1),h(!1),a?e():c(!0),d(void 0)},[b,e]);return{handleStartWorkflowRun:(0,K.useCallback)(()=>{d?m():h()},[d,h,m]),handleWorkflowStartRunInWorkflow:h,handleWorkflowStartRunInChatflow:m,handleWorkflowTriggerScheduleRunInWorkflow:i,handleWorkflowTriggerWebhookRunInWorkflow:j,handleWorkflowTriggerPluginRunInWorkflow:k,handleWorkflowRunAllTriggersInWorkflow:l}},dH=(0,K.memo)(({searchText:a,onSelect:b,availableBlocksTypes:c=[],onContentStateChange:d,hideUserInput:e=!1})=>{let{t:f}=(0,$.useTranslation)(),g=(0,bu.default)(),h=dc(),i=(0,K.useMemo)(()=>{let b=g.some(a=>a.data?.type===aC.BlockEnum.Start),d=a.toLowerCase();return bE.START_BLOCKS.filter(a=>{var g;return(a.type!==aC.BlockEnum.Start||!b&&!e)&&(!!((g=a.type)===aC.BlockEnum.TriggerWebhook?f("customWebhook",{ns:"workflow"}):f(`blocks.${g}`,{ns:"workflow"})).toLowerCase().includes(d)||!!a.title.toLowerCase().includes(d))&&c.includes(a.type)})},[a,c,g,f,e]),j=0===i.length;(0,K.useEffect)(()=>{d?.(!j)},[j,d]);let k=(0,K.useCallback)(a=>(0,F.jsx)(ac.default,{position:"right",popupClassName:"w-[224px] rounded-xl",needsDelay:!1,popupContent:(0,F.jsxs)("div",{children:[(0,F.jsx)(am.default,{size:"md",className:"mb-2",type:a.type}),(0,F.jsx)("div",{className:"system-md-medium mb-1 text-text-primary",children:a.type===aC.BlockEnum.TriggerWebhook?f("customWebhook",{ns:"workflow"}):f(`blocks.${a.type}`,{ns:"workflow"})}),(0,F.jsx)("div",{className:"system-xs-regular text-text-secondary",children:f(`blocksAbout.${a.type}`,{ns:"workflow"})}),(a.type===aC.BlockEnum.TriggerWebhook||a.type===aC.BlockEnum.TriggerSchedule)&&(0,F.jsxs)("div",{className:"system-xs-regular mb-1 mt-1 text-text-tertiary",children:[f("author",{ns:"tools"})," ",f("difyTeam",{ns:"workflow"})]})]}),children:(0,F.jsxs)("div",{className:"flex h-8 w-full cursor-pointer items-center rounded-lg px-3 hover:bg-state-base-hover",onClick:()=>b(a.type),children:[(0,F.jsx)(am.default,{className:"mr-2 shrink-0",type:a.type}),(0,F.jsxs)("div",{className:"flex w-0 grow items-center justify-between text-sm text-text-secondary",children:[(0,F.jsx)("span",{className:"truncate",children:f(`blocks.${a.type}`,{ns:"workflow"})}),a.type===aC.BlockEnum.Start&&(0,F.jsx)("span",{className:"system-xs-regular ml-2 shrink-0 text-text-quaternary",children:f("blocks.originalStartNode",{ns:"workflow"})})]})]})},a.type),[h,b,f]);return j?null:(0,F.jsx)("div",{className:"p-1",children:(0,F.jsx)("div",{className:"mb-1",children:i.map((a,b)=>(0,F.jsxs)("div",{children:[k(a),a.type===aC.BlockEnum.Start&&b<i.length-1&&(0,F.jsx)("div",{className:"my-1 px-3",children:(0,F.jsx)("div",{className:"border-t border-divider-subtle"})})]},a.type))})})}),dI=(0,K.memo)(({onSelect:a,searchText:b,onContentStateChange:c})=>{let{data:d}=(0,aT.useAllTriggerPlugins)(),e=(0,bk.useGetLanguage)(),f=b.trim().toLowerCase(),g=(0,K.useMemo)(()=>{let a=d||[],b=(a,b)=>{let c=[(a=>{if(!a)return"";if(a[e])return a[e];if(a["en-US"])return a["en-US"];let b=Object.values(a).find(Boolean);return"string"==typeof b?b:""})(b),a].filter(Boolean);return c.length>0?c:[""]},c=a=>a.toLowerCase().includes(f);return f?a.reduce((a,d)=>{if(0===d.events.length)return a;if(b(d.name,d.label).some(a=>c(a)))return a.push(d),a;let e=d.events.filter(a=>b(a.name,a.label).some(a=>c(a)));return e.length>0&&a.push({...d,events:e}),a},[]):a.filter(a=>a.events.length>0)},[d,f,e]),h=g.length>0;return((0,K.useEffect)(()=>{c?.(h)},[h,c]),h)?(0,F.jsx)("div",{className:"p-1",children:g.map(c=>(0,F.jsx)(bR,{payload:c,onSelect:a,hasSearchText:!!b},c.id))}):null}),dJ=({className:a,searchText:b,onSelect:c,availableBlocksTypes:d,tags:e=[],allowUserInputSelection:f=!1})=>{let{t:g}=(0,$.useTranslation)(),[h,i]=(0,K.useState)(!1),[j,k]=(0,K.useState)(!1),{enable_marketplace:l}=(0,bw.useGlobalPublicStore)(a=>a.systemFeatures),m=(0,K.useRef)(null),n=(0,K.useRef)(null),o=d?.length?d:bE.ENTRY_NODE_TYPES,p=o.includes(aC.BlockEnum.TriggerPlugin),{data:q=[]}=(0,aT.useAllTriggerPlugins)(p),r=(0,K.useMemo)(()=>{let a=new Map;return q.forEach(b=>{[b.plugin_id,b.plugin_unique_identifier,b.id].filter(Boolean).forEach(c=>{a.has(c)||a.set(c,b)})}),a},[q]),s=(0,aT.useInvalidateAllTriggerPlugins)(),t=b.trim(),u=t.length>0||e.length>0,{plugins:v=[],isLoading:w}=(0,bx.useFeaturedTriggersRecommendations)(p&&l&&!u),{queryPluginsWithDebounced:x,plugins:y=[]}=(0,bC.useMarketplacePlugins)(),z=p&&l&&!u,A=h||j,B=l&&!u,C=(0,K.useCallback)(a=>{i(a)},[]),D=(0,K.useCallback)(a=>{k(a)},[]),E=p&&l&&y.length>0,G=h||j||z||E,H=u&&!G;return(0,K.useEffect)(()=>{!p&&j&&k(!1)},[p,j]),(0,K.useEffect)(()=>{p&&l&&u&&x({query:b,tags:e,category:bD.PluginCategoryEnum.trigger})},[p,l,u,x,b,e]),(0,F.jsx)("div",{className:(0,S.cn)("min-w-[400px] max-w-[500px]",a),children:(0,F.jsxs)("div",{className:"flex max-h-[640px] flex-col",children:[(0,F.jsxs)("div",{ref:n,className:"flex-1 overflow-y-auto",onScroll:()=>m.current?.handleScroll(),children:[(0,F.jsxs)("div",{className:(0,S.cn)(H&&"hidden"),children:[z&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(bU,{plugins:v,providerMap:r,onSelect:c,isLoading:w,onInstallSuccess:async()=>{s()}}),(0,F.jsx)("div",{className:"px-3",children:(0,F.jsx)(bA.default,{className:"!h-px"})})]}),A&&(0,F.jsx)("div",{className:"px-3 pb-1 pt-2",children:(0,F.jsx)("span",{className:"system-xs-medium text-text-primary",children:g("tabs.allTriggers",{ns:"workflow"})})}),(0,F.jsx)(dH,{searchText:t,onSelect:c,availableBlocksTypes:o,hideUserInput:!f,onContentStateChange:C}),p&&(0,F.jsx)(dI,{onSelect:c,searchText:t,onContentStateChange:D,tags:e}),p&&l&&(0,F.jsx)(bV.default,{ref:m,wrapElemRef:n,list:y,searchText:t,category:bD.PluginCategoryEnum.trigger,tags:e,hideFindMoreFooter:!0})]}),H&&(0,F.jsxs)("div",{className:"flex h-full flex-col items-center justify-center gap-3 py-12 text-center",children:[(0,F.jsx)(bB.SearchMenu,{className:"h-8 w-8 text-text-quaternary"}),(0,F.jsx)("div",{className:"text-sm font-medium text-text-secondary",children:g("tabs.noPluginsFound",{ns:"workflow"})}),(0,F.jsx)(bz.default,{href:"https://github.com/langgenius/dify-plugins/issues/new?template=plugin_request.yaml",target:"_blank",children:(0,F.jsx)(av.default,{size:"small",variant:"secondary-accent",className:"h-6 cursor-pointer px-3 text-xs",children:g("tabs.requestToCommunity",{ns:"workflow"})})})]})]}),B&&!H&&(0,F.jsxs)(bz.default,{className:"system-sm-medium z-10 flex h-8 flex-none cursor-pointer items-center rounded-b-lg border-[0.5px] border-t border-components-panel-border bg-components-panel-bg-blur px-4 py-1 text-text-accent-light-mode-only shadow-lg",href:(0,by.getMarketplaceUrl)("",{category:bD.PluginCategoryEnum.trigger}),target:"_blank",children:[(0,F.jsx)("span",{children:g("findMoreInMarketplace",{ns:"plugin"})}),(0,F.jsx)(Y.RiArrowRightUpLine,{className:"ml-0.5 h-3 w-3"})]})]})})};var dK=a.i(719638),dL=a.i(741195),dM=a.i(218865);let dN=(0,K.memo)(({searchText:a,onSelect:b,availableBlocksTypes:c=[],blocks:d})=>{let{t:e}=(0,$.useTranslation)(),f=(0,N.useStoreApi)(),g=(0,bv.useBlocks)(),h=d||g.map(a=>({metaData:{classification:a.classification,sort:0,type:a.type,title:a.title,author:"Dify",description:a.description},defaultValue:{},checkValid:()=>({isValid:!0})})),i=(0,K.useMemo)(()=>bE.BLOCK_CLASSIFICATIONS.reduce((b,d)=>{let e=((0,dL.groupBy)(h,"metaData.classification")[d]||[]).filter(b=>b.metaData.type!==aC.BlockEnum.TriggerWebhook&&b.metaData.type!==aC.BlockEnum.TriggerSchedule&&b.metaData.type!==aC.BlockEnum.TriggerPlugin&&b.metaData.title.toLowerCase().includes(a.toLowerCase())&&c.includes(b.metaData.type));return{...b,[d]:e}},{}),[h,a,c]),j=Object.values(i).every(a=>!a.length),k=(0,K.useCallback)(a=>{let c=i[a].sort((a,b)=>(a.metaData.sort||0)-(b.metaData.sort||0)),{getNodes:d}=f.getState(),g=d().some(a=>a.data.type===aC.BlockEnum.KnowledgeBase),h=c.filter(a=>!g||a.metaData.type!==aC.BlockEnum.KnowledgeBase);return(0,F.jsxs)("div",{className:"mb-1 last-of-type:mb-0",children:["-"!==a&&!!h.length&&(0,F.jsx)("div",{className:"flex h-[22px] items-start px-3 text-xs font-medium text-text-tertiary",children:e(`tabs.${a}`,{ns:"workflow"})}),h.map(a=>(0,F.jsx)(ac.default,{position:"right",popupClassName:"w-[200px] rounded-xl",needsDelay:!1,popupContent:(0,F.jsxs)("div",{children:[(0,F.jsx)(am.default,{size:"md",className:"mb-2",type:a.metaData.type}),(0,F.jsx)("div",{className:"system-md-medium mb-1 text-text-primary",children:a.metaData.title}),(0,F.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:a.metaData.description})]}),children:(0,F.jsxs)("div",{className:"flex h-8 w-full cursor-pointer items-center rounded-lg px-3 hover:bg-state-base-hover",onClick:()=>b(a.metaData.type),children:[(0,F.jsx)(am.default,{className:"mr-2 shrink-0",type:a.metaData.type}),(0,F.jsx)("div",{className:"grow text-sm text-text-secondary",children:a.metaData.title}),a.metaData.type===aC.BlockEnum.LoopEnd&&(0,F.jsx)(dM.default,{text:e("nodes.loop.loopNode",{ns:"workflow"}),className:"ml-2 shrink-0"})]},a.metaData.type)},a.metaData.type))]},a)},[i,b,e,f]);return(0,F.jsxs)("div",{className:"max-h-[480px] max-w-[500px] overflow-y-auto p-1",children:[j&&(0,F.jsx)("div",{className:"flex h-[22px] items-center px-3 text-xs font-medium text-text-tertiary",children:e("tabs.noResult",{ns:"workflow"})}),!j&&bE.BLOCK_CLASSIFICATIONS.map(k)]})});var dO=a.i(493193),dP=a.i(547918);let dQ=({className:a,toolContentClassName:b,searchText:c,onSelect:d,dataSources:e})=>{let f=(0,bk.useGetLanguage)(),g=(0,K.useRef)(null),h=(0,K.useRef)(null),i=(0,K.useMemo)(()=>c?e.filter(a=>{let b;return b=a.name,b.toLowerCase().includes(c.toLowerCase())||a.tools.some(a=>a.label[f].toLowerCase().includes(c.toLowerCase())||a.name.toLowerCase().includes(c.toLowerCase()))}):e.filter(a=>a.tools.length>0),[c,e,f]),j=(0,K.useCallback)((a,b)=>{let c={plugin_id:b?.provider_id,provider_type:b?.provider_type,provider_name:b?.provider_name,datasource_name:b?.tool_name,datasource_label:b?.tool_label,title:b?.title,plugin_unique_identifier:b?.plugin_unique_identifier};b?.provider_id==="langgenius/file"&&b?.provider_name==="file"&&(c={...c,fileExtensions:bE.DEFAULT_FILE_EXTENSIONS_IN_LOCAL_FILE_DATA_SOURCE}),d(aC.BlockEnum.DataSource,b&&c)},[d]),{enable_marketplace:k}=(0,bw.useGlobalPublicStore)(a=>a.systemFeatures),{queryPluginsWithDebounced:l,plugins:m=[]}=(0,bC.useMarketplacePlugins)();return(0,K.useEffect)(()=>{k&&c&&l({query:c,category:bD.PluginCategoryEnum.datasource})},[c,k]),(0,F.jsx)("div",{className:(0,S.cn)("w-[400px] min-w-0 max-w-full",a),children:(0,F.jsxs)("div",{ref:h,className:"max-h-[464px] overflow-y-auto overflow-x-hidden",onScroll:g.current?.handleScroll,children:[(0,F.jsx)(dO.default,{className:b,tools:i,onSelect:j,viewType:dP.ViewType.flat,hasSearchText:!!c,canNotSelectMultiple:!0}),k&&(0,F.jsx)(bV.default,{ref:g,wrapElemRef:h,list:m,tags:[],searchText:c,category:bD.PluginCategoryEnum.datasource,toolContentClassName:b})]})})},dR=(0,K.memo)(({activeTab:a,onActiveTabChange:b,tags:c,onTagsChange:d,searchText:e,onSelect:f,availableBlocksTypes:g,blocks:h,dataSources:i=[],tabs:j=[],filterElem:k,noBlocks:l,noTools:m,forceShowStartContent:n=!1,allowStartNodeSelection:o=!1})=>{let{t:p}=(0,$.useTranslation)(),{data:q}=(0,Q.useAllBuiltInTools)(),{data:r}=(0,Q.useAllCustomTools)(),{data:s}=(0,Q.useAllWorkflowTools)(),{data:t}=(0,Q.useAllMCPTools)(),u=(0,Q.useInvalidateAllBuiltInTools)(),{enable_marketplace:v}=(0,bw.useGlobalPublicStore)(a=>a.systemFeatures),w=(0,aP.useWorkflowStore)(),x=i.length>0,{plugins:y=[],isLoading:z}=(0,bx.useFeaturedToolsRecommendations)(v&&!x),A=(0,K.useMemo)(()=>a=>{if(!a||!by.basePath)return a;let b=!1,c=a.map(a=>{if("string"==typeof a.icon){let c=a.icon;if(by.basePath&&c.startsWith("/")&&!c.startsWith(`${by.basePath}/`))return b=!0,{...a,icon:`${by.basePath}${c}`}}return a});return b?c:a},[by.basePath]);return(0,K.useEffect)(()=>{w.setState(a=>{let b={},c=A(q),d=A(r),e=A(s),f=A(t);return(void 0!==c&&a.buildInTools!==c&&(b.buildInTools=c),void 0!==d&&a.customTools!==d&&(b.customTools=d),void 0!==e&&a.workflowTools!==e&&(b.workflowTools=e),void 0!==f&&a.mcpTools!==f&&(b.mcpTools=f),Object.keys(b).length)?{...a,...b}:a})},[w,A,q,r,s,t]),(0,F.jsxs)("div",{onClick:a=>a.stopPropagation(),children:[!l&&(0,F.jsx)("div",{className:"relative flex bg-background-section-burn pl-1 pt-1",children:j.map(c=>{let d={className:(0,S.cn)("system-sm-medium relative mr-0.5 flex h-8 items-center rounded-t-lg px-3",c.disabled?"cursor-not-allowed text-text-disabled opacity-60":a===c.key?"sm-no-bottom cursor-default bg-components-panel-bg text-text-accent":"cursor-pointer text-text-tertiary"),"aria-disabled":c.disabled,onClick:()=>{c.disabled||a===c.key||b(c.key)}};return c.disabled?(0,F.jsx)(ac.default,{position:"top",popupClassName:"max-w-[200px]",popupContent:p("tabs.startDisabledTip",{ns:"workflow"}),children:(0,F.jsx)("div",{...d,children:c.name})},c.key):(0,F.jsx)("div",{...d,children:c.name},c.key)})}),k,a===b2.TabsEnum.Start&&(!l||n)&&(0,F.jsx)("div",{className:"border-t border-divider-subtle",children:(0,F.jsx)(dJ,{allowUserInputSelection:o,searchText:e,onSelect:f,availableBlocksTypes:g,tags:c})}),a===b2.TabsEnum.Blocks&&!l&&(0,F.jsx)("div",{className:"border-t border-divider-subtle",children:(0,F.jsx)(dN,{searchText:e,onSelect:f,availableBlocksTypes:g,blocks:h})}),a===b2.TabsEnum.Sources&&!!i.length&&(0,F.jsx)("div",{className:"border-t border-divider-subtle",children:(0,F.jsx)(dQ,{searchText:e,onSelect:f,dataSources:i})}),a===b2.TabsEnum.Tools&&!m&&(0,F.jsx)(dK.default,{searchText:e,onSelect:f,tags:c,canNotSelectMultiple:!0,buildInTools:q||[],customTools:r||[],workflowTools:s||[],mcpTools:t||[],onTagsChange:d,isInRAGPipeline:x,featuredPlugins:y,featuredLoading:z,showFeatured:v&&!x,onFeaturedInstallSuccess:async()=>{u()}})]})}),dS=(0,K.memo)(({open:a,onOpenChange:b,onSelect:c,trigger:d,placement:e="right",offset:f=6,triggerClassName:g,triggerInnerClassName:h,triggerStyle:i,popupClassName:j,asChild:k,availableBlocksTypes:l,disabled:m,blocks:n=[],dataSources:o=[],noBlocks:p=!1,noTools:q=!1,showStartTab:r=!1,defaultActiveTab:s,forceShowStartContent:t=!1,ignoreNodeIds:u=[],forceEnableStartTab:v=!1,allowUserInputSelection:w})=>{let{t:x}=(0,$.useTranslation)(),y=(0,bu.default)(),[z,A]=(0,K.useState)(""),[B,C]=(0,K.useState)([]),[D,E]=(0,K.useState)(!1),G=(0,K.useMemo)(()=>{if(!u.length)return y;let a=new Set(u);return y.filter(b=>!a.has(b.id))},[y,u]),{hasTriggerNode:H,hasUserInputNode:I}=(0,K.useMemo)(()=>{let a={hasTriggerNode:!1,hasUserInputNode:!1};for(let b of G){let c=b.data?.type;if(c&&(c===aC.BlockEnum.Start&&(a.hasUserInputNode=!0),(0,aC.isTriggerNode)(c)&&(a.hasTriggerNode=!0),a.hasTriggerNode&&a.hasUserInputNode))break}return a},[G]),J=void 0===a?D:a,L=(0,K.useCallback)(a=>{E(a),a||A(""),b&&b(a)},[b]),M=(0,K.useCallback)(a=>{m||(a.stopPropagation(),L(!J))},[L,J,m]),N=(0,K.useCallback)((a,b)=>{L(!1),c(a,b)},[L,c]),{activeTab:O,setActiveTab:P,tabs:Q}=(0,bv.useTabs)({noBlocks:p,noSources:!o.length,noTools:q,noStart:!r,defaultActiveTab:s,hasUserInputNode:I,forceEnableStartTab:v}),R=(0,K.useCallback)(a=>{P(a)},[P]),S=(0,K.useMemo)(()=>O===b2.TabsEnum.Start?x("tabs.searchTrigger",{ns:"workflow"}):O===b2.TabsEnum.Blocks?x("tabs.searchBlock",{ns:"workflow"}):O===b2.TabsEnum.Tools?x("tabs.searchTool",{ns:"workflow"}):O===b2.TabsEnum.Sources?x("tabs.searchDataSource",{ns:"workflow"}):"",[O,x]);return(0,F.jsxs)(bh.PortalToFollowElem,{placement:e,offset:f,open:J,onOpenChange:L,children:[(0,F.jsx)(bh.PortalToFollowElemTrigger,{asChild:k,onClick:M,className:h,children:d?d(J):(0,F.jsx)("div",{className:`
                  z-10 flex h-4
                  w-4 cursor-pointer items-center justify-center rounded-full bg-components-button-primary-bg text-text-primary-on-surface hover:bg-components-button-primary-bg-hover
                  ${g?.(J)}
                `,style:i,children:(0,F.jsx)(bs.default,{className:"h-2.5 w-2.5"})})}),(0,F.jsx)(bh.PortalToFollowElemContent,{className:"z-[1000]",children:(0,F.jsx)("div",{className:`rounded-lg border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-lg ${j}`,children:(0,F.jsx)(dR,{tabs:Q,activeTab:O,blocks:n,allowStartNodeSelection:w??(!I&&!H),onActiveTabChange:R,filterElem:(0,F.jsxs)("div",{className:"relative m-2",onClick:a=>a.stopPropagation(),children:[O===b2.TabsEnum.Start&&(0,F.jsx)(bt.default,{autoFocus:!0,search:z,onSearchChange:A,tags:B,onTagsChange:C,placeholder:S,inputClassName:"grow"}),O===b2.TabsEnum.Blocks&&(0,F.jsx)(a2.default,{showLeftIcon:!0,showClearIcon:!0,autoFocus:!0,value:z,placeholder:S,onChange:a=>A(a.target.value),onClear:()=>A("")}),O===b2.TabsEnum.Sources&&(0,F.jsx)(a2.default,{showLeftIcon:!0,showClearIcon:!0,autoFocus:!0,value:z,placeholder:S,onChange:a=>A(a.target.value),onClear:()=>A("")}),O===b2.TabsEnum.Tools&&(0,F.jsx)(bt.default,{autoFocus:!0,search:z,onSearchChange:A,tags:B,onTagsChange:C,placeholder:x("searchTools",{ns:"plugin"}),inputClassName:"grow"})]}),onSelect:N,searchText:z,tags:B,availableBlocksTypes:l,noBlocks:p,dataSources:o,noTools:q,onTagsChange:C,forceShowStartContent:t})})})]})}),dT=a=>{let b=(0,as.useHooksStore)(a=>a.availableNodesMetaData),c=(0,aP.useStore)(a=>a.dataSourceList),d=(0,K.useMemo)(()=>(b?.nodes||[]).filter(a=>a.metaData.type!==aC.BlockEnum.Start&&a.metaData.type!==aC.BlockEnum.DataSource&&a.metaData.type!==aC.BlockEnum.Tool&&a.metaData.type!==aC.BlockEnum.IterationStart&&a.metaData.type!==aC.BlockEnum.LoopStart&&a.metaData.type!==aC.BlockEnum.DataSourceEmpty),[b?.nodes]);return(0,F.jsx)(dS,{...a,blocks:a.blocks||d,dataSources:a.dataSources||c||[]})},dU=(0,K.memo)(({nodeId:a,nodeData:b,sourceHandle:c,isParallel:d,isFailBranch:e})=>{let{t:f}=(0,$.useTranslation)(),[g,h]=(0,K.useState)(!1),{handleNodeAdd:i}=(0,V.useNodesInteractions)(),{nodesReadOnly:j}=(0,aq.useNodesReadOnly)(),{availableNextBlocks:k}=(0,an.useAvailableBlocks)(b.type,b.isInIteration||b.isInLoop),l=(0,K.useCallback)((b,d)=>{i({nodeType:b,pluginDefaultValue:d},{prevNodeId:a,prevNodeSourceHandle:c})},[i]),m=(0,K.useCallback)(a=>{h(a)},[]),n=(0,K.useMemo)(()=>e?f("common.addFailureBranch",{ns:"workflow"}):d?f("common.addParallelNode",{ns:"workflow"}):f("panel.selectNextStep",{ns:"workflow"}),[e,d,f]),o=(0,K.useCallback)(a=>(0,F.jsxs)("div",{className:`
          bg-dropzone-bg hover:bg-dropzone-bg-hover relative flex h-9 cursor-pointer items-center rounded-lg border border-dashed
          border-divider-regular px-2 text-xs text-text-placeholder
          ${a&&"!bg-components-dropzone-bg-alt"}
          ${j&&"!cursor-not-allowed"}
        `,children:[(0,F.jsx)("div",{className:"mr-1.5 flex h-5 w-5 items-center justify-center rounded-[5px] bg-background-default-dimmed",children:(0,F.jsx)(Y.RiAddLine,{className:"h-3 w-3"})}),(0,F.jsx)("div",{className:"flex items-center uppercase",children:n})]}),[j,n]);return(0,F.jsx)(dT,{open:g,onOpenChange:m,disabled:j,onSelect:l,placement:"top",offset:0,trigger:o,popupClassName:"!w-[328px]",availableBlocksTypes:k})});function dV(a,b){let c=new Set(b);return a.filter(a=>c.has(a))}let dW=({data:a,nodeId:b,sourceHandle:c})=>{let{t:d}=(0,$.useTranslation)(),{handleNodeChange:e}=(0,V.useNodesInteractions)(),{availablePrevBlocks:f,availableNextBlocks:g}=(0,an.useAvailableBlocks)(a.type,a.isInIteration||a.isInLoop),h=(0,K.useCallback)((a,d)=>{e(b,a,c,d)},[b,c,e]),i=(0,K.useCallback)(()=>(0,F.jsx)("div",{className:"flex h-8 cursor-pointer items-center rounded-lg px-2 hover:bg-state-base-hover",children:d("panel.change",{ns:"workflow"})}),[d]);return(0,F.jsx)(dT,{onSelect:h,placement:"top-end",offset:{mainAxis:6,crossAxis:8},trigger:i,popupClassName:"!w-[328px]",availableBlocksTypes:dV(f,g).filter(b=>b!==a.type)})},dX=({open:a,onOpenChange:b,data:c,nodeId:d,sourceHandle:e})=>{let{t:f}=(0,$.useTranslation)(),{handleNodeDelete:g,handleNodeDisconnect:h}=(0,V.useNodesInteractions)();return(0,F.jsxs)(bh.PortalToFollowElem,{placement:"bottom-end",offset:{mainAxis:4,crossAxis:-4},open:a,onOpenChange:b,children:[(0,F.jsx)(bh.PortalToFollowElemTrigger,{onClick:()=>b(!a),children:(0,F.jsx)(av.default,{className:"h-6 w-6 p-0",children:(0,F.jsx)(Y.RiMoreFill,{className:"h-4 w-4"})})}),(0,F.jsx)(bh.PortalToFollowElemContent,{className:"z-10",children:(0,F.jsxs)("div",{className:"system-md-regular min-w-[120px] rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur text-text-secondary shadow-lg",children:[(0,F.jsxs)("div",{className:"p-1",children:[(0,F.jsx)(dW,{data:c,nodeId:d,sourceHandle:e}),(0,F.jsx)("div",{className:"flex h-8 cursor-pointer items-center rounded-lg px-2 hover:bg-state-base-hover",onClick:()=>h(d),children:f("common.disconnect",{ns:"workflow"})})]}),(0,F.jsx)("div",{className:"p-1",children:(0,F.jsx)("div",{className:"flex h-8 cursor-pointer items-center rounded-lg px-2 hover:bg-state-base-hover",onClick:()=>g(d),children:f("operation.delete",{ns:"common"})})})]})})]})},dY=(0,K.memo)(({nodeId:a,sourceHandle:b,data:c})=>{let{t:d}=(0,$.useTranslation)(),[e,f]=(0,K.useState)(!1),{nodesReadOnly:g}=(0,aq.useNodesReadOnly)(),{handleNodeSelect:h}=(0,V.useNodesInteractions)(),i=(0,ar.useToolIcon)(c),j=(0,K.useCallback)(a=>{f(a)},[]);return(0,F.jsxs)("div",{className:"group relative flex h-9 cursor-pointer items-center rounded-lg border-[0.5px] border-divider-regular bg-background-default px-2 text-xs text-text-secondary shadow-xs last-of-type:mb-0 hover:bg-background-default-hover",children:[(0,F.jsx)(am.default,{type:c.type,toolIcon:i,className:"mr-1.5 shrink-0"}),(0,F.jsx)("div",{className:"system-xs-medium grow truncate text-text-secondary",title:c.title,children:c.title}),!g&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(av.default,{className:"mr-1 hidden shrink-0 group-hover:flex",size:"small",onClick:()=>h(a),children:d("common.jumpToNode",{ns:"workflow"})}),(0,F.jsx)("div",{className:(0,S.cn)("hidden shrink-0 items-center group-hover:flex",e&&"flex"),children:(0,F.jsx)(dX,{data:c,nodeId:a,sourceHandle:b,open:e,onOpenChange:j})})]})]})}),dZ=({nodeId:a,nodeData:b,sourceHandle:c,nextNodes:d,branchName:e,isFailBranch:f})=>(0,F.jsxs)("div",{className:(0,S.cn)("space-y-0.5 rounded-[10px] bg-background-section-burn p-0.5",f&&"border-[0.5px] border-state-warning-hover-alt bg-state-warning-hover"),children:[e&&(0,F.jsx)("div",{className:(0,S.cn)("system-2xs-semibold-uppercase flex items-center truncate px-2 text-text-tertiary",f&&"text-text-warning"),title:e,children:e}),d.map(a=>(0,F.jsx)(dY,{nodeId:a.id,data:a.data,sourceHandle:"source"},a.id)),(0,F.jsx)(dU,{isParallel:!!d.length,isFailBranch:f,nodeId:a,nodeData:b,sourceHandle:c})]}),d$=(0,K.memo)(({list:a})=>{let b=a.map(a=>36*a+(a-1)*2+12+6),c=b.map((a,c)=>0===c?a:b.slice(0,c).reduce((a,b)=>a+b,0)+a),d=c.length,e=c[d-1]+(d-1)*8;return(0,F.jsx)("svg",{className:"w-6 shrink-0",style:{height:e},children:c.map((a,b)=>{let d=(b>0?c[b-1]:0)+8*b+16;return(0,F.jsxs)("g",{children:[0===b&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)("path",{d:"M0,18 L24,18",strokeWidth:1,fill:"none",className:"stroke-divider-solid"}),(0,F.jsx)("rect",{x:0,y:16,width:1,height:4,className:"fill-divider-solid-alt"})]}),b>0&&(0,F.jsx)("path",{d:`M0,18 Q12,18 12,28 L12,${d-10+2} Q12,${d+2} 24,${d+2}`,strokeWidth:1,fill:"none",className:"stroke-divider-solid"}),(0,F.jsx)("rect",{x:23,y:d,width:1,height:4,className:"fill-divider-solid-alt"})]},b)})})}),d_=(0,K.memo)(({selectedNode:a})=>{let{t:b}=(0,$.useTranslation)(),c=a.data,d=(0,ar.useToolIcon)(c),e=(0,K.useMemo)(()=>c._targetBranches||[],[c]),f=(0,N.useStore)(a=>a.edges.map(a=>({id:a.id,source:a.source,sourceHandle:a.sourceHandle,target:a.target,targetHandle:a.targetHandle})),H.isEqual),g=(0,N.useStore)(a=>a.getNodes().map(a=>({id:a.id,data:a.data})),H.isEqual),h=(0,N.getOutgoers)(a,g,f),i=(0,N.getConnectedEdges)([a],f).filter(b=>b.source===a.id),j=(0,K.useMemo)(()=>{let a=a=>a.reduce((a,b)=>{let c=h.find(a=>a.id===b.target);return c&&a.push(c),a},[]),d=[];if(e?.length)d=e.map((d,e)=>{let f=a(i.filter(a=>a.sourceHandle===d.id));return{branch:{...d,name:c.type===aC.BlockEnum.QuestionClassifier?`${b("nodes.questionClassifiers.class",{ns:"workflow"})} ${e+1}`:d.name},nextNodes:f}});else if(d=[{branch:{id:"",name:""},nextNodes:a(i.filter(a=>"source"===a.sourceHandle))}],c.error_strategy===bi.ErrorHandleTypeEnum.failBranch&&(0,aQ.hasErrorHandleNode)(c.type)){let c=a(i.filter(a=>a.sourceHandle===bi.ErrorHandleTypeEnum.failBranch));d.push({branch:{id:bi.ErrorHandleTypeEnum.failBranch,name:b("common.onFailure",{ns:"workflow"})},nextNodes:c})}return d},[e,i,c.error_strategy,c.type,h,b]);return(0,F.jsxs)("div",{className:"flex py-1",children:[(0,F.jsx)("div",{className:"relative flex h-9 w-9 shrink-0 items-center justify-center rounded-lg border-[0.5px] border-divider-regular bg-background-default shadow-xs",children:(0,F.jsx)(am.default,{type:a.data.type,toolIcon:d})}),(0,F.jsx)(d$,{list:j.length?j.map(a=>a.nextNodes.length+1):[1]}),(0,F.jsx)("div",{className:"grow space-y-2",children:j.map((b,c)=>(0,F.jsx)(dZ,{nodeId:a.id,nodeData:a.data,sourceHandle:b.branch.id,nextNodes:b.nextNodes,branchName:b.branch.name,isFailBranch:b.branch.id===bi.ErrorHandleTypeEnum.failBranch},c))})]})}),d0=(0,K.memo)(({nodeId:a,nodeData:b,sourceHandle:c})=>{let{t:d}=(0,$.useTranslation)(),{handleNodeChange:e}=(0,V.useNodesInteractions)(),{availablePrevBlocks:f,availableNextBlocks:g}=(0,an.useAvailableBlocks)(b.type,b.isInIteration||b.isInLoop),h=(0,aq.useIsChatMode)(),i=(0,as.useHooksStore)(a=>a.configsMap?.flowType)!==aJ.FlowType.ragPipeline&&!h,j=(0,K.useMemo)(()=>{if((0,aC.isTriggerNode)(b.type))return[a]},[b.type,a]),k=(0,K.useMemo)(()=>f.length&&g.length?dV(f,g):f.length?f:g,[f,g]),l=(0,K.useCallback)((b,d)=>{e(a,b,c,d)},[e,a,c]),m=(0,K.useCallback)(()=>(0,F.jsx)("div",{className:"flex h-8 w-[232px] cursor-pointer items-center rounded-lg px-3 text-sm text-text-secondary hover:bg-state-base-hover",children:d("panel.changeBlock",{ns:"workflow"})}),[d]);return(0,F.jsx)(dT,{placement:"bottom-end",offset:{mainAxis:-36,crossAxis:4},onSelect:l,trigger:m,popupClassName:"min-w-[240px]",availableBlocksTypes:k,showStartTab:i,ignoreNodeIds:j,forceEnableStartTab:b.type===aC.BlockEnum.Start})}),d1=(0,K.memo)(({id:a,data:b,onClosePopup:c,showHelpLink:d})=>{let{t:e}=(0,$.useTranslation)(),f=(0,N.useEdges)(),{handleNodeDelete:g,handleNodesDuplicate:h,handleNodeSelect:i,handleNodesCopy:j}=(0,V.useNodesInteractions)(),{handleNodeDataUpdate:k}=(0,ao.useNodeDataUpdate)(),{handleSyncWorkflowDraft:l}=(0,W.useNodesSyncDraft)(),{nodesReadOnly:m}=(0,aq.useNodesReadOnly)(),n=f.find(b=>b.target===a),o=(0,ap.useNodeMetaData)({id:a,data:b}),p=!o.isTypeFixed&&!m,q=!!(b.isInIteration||b.isInLoop),{data:r}=(0,Q.useAllWorkflowTools)(),s=b.type===aC.BlockEnum.Tool&&b.provider_type===bN.CollectionType.workflow,t=(0,K.useMemo)(()=>{if(!s||!r||!b.provider_id)return;let a=r.find(a=>(0,aU.canFindTool)(a.id,b.provider_id));return a?.workflow_app_id},[s,r,b.provider_id]);return(0,F.jsxs)("div",{className:"w-[240px] rounded-lg border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-xl",children:[(p||(0,aQ.canRunBySingle)(b.type,q))&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)("div",{className:"p-1",children:[(0,aQ.canRunBySingle)(b.type,q)&&(0,F.jsx)("div",{className:`
                      flex h-8 cursor-pointer items-center rounded-lg px-3 text-sm text-text-secondary
                      hover:bg-state-base-hover
                    `,onClick:()=>{i(a),k({id:a,data:{_isSingleRun:!0}}),l(!0),c()},children:e("panel.runThisStep",{ns:"workflow"})}),p&&(0,F.jsx)(d0,{nodeId:a,nodeData:b,sourceHandle:n?.sourceHandle||"source"})]}),(0,F.jsx)("div",{className:"h-px bg-divider-regular"})]}),!m&&(0,F.jsxs)(F.Fragment,{children:[!o.isSingleton&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)("div",{className:"p-1",children:[(0,F.jsxs)("div",{className:"flex h-8 cursor-pointer items-center justify-between rounded-lg px-3 text-sm text-text-secondary hover:bg-state-base-hover",onClick:()=>{c(),j(a)},children:[e("common.copy",{ns:"workflow"}),(0,F.jsx)(dx.default,{keys:["ctrl","c"]})]}),(0,F.jsxs)("div",{className:"flex h-8 cursor-pointer items-center justify-between rounded-lg px-3 text-sm text-text-secondary hover:bg-state-base-hover",onClick:()=>{c(),h(a)},children:[e("common.duplicate",{ns:"workflow"}),(0,F.jsx)(dx.default,{keys:["ctrl","d"]})]})]}),(0,F.jsx)("div",{className:"h-px bg-divider-regular"})]}),!o.isUndeletable&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)("div",{className:"p-1",children:(0,F.jsxs)("div",{className:`
                      flex h-8 cursor-pointer items-center justify-between rounded-lg px-3 text-sm text-text-secondary
                      hover:bg-state-destructive-hover hover:text-text-destructive
                      `,onClick:()=>g(a),children:[e("operation.delete",{ns:"common"}),(0,F.jsx)(dx.default,{keys:["del"]})]})}),(0,F.jsx)("div",{className:"h-px bg-divider-regular"})]})]}),s&&t&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)("div",{className:"p-1",children:(0,F.jsx)("a",{href:`/app/${t}/workflow`,target:"_blank",className:"flex h-8 cursor-pointer items-center rounded-lg px-3 text-sm text-text-secondary hover:bg-state-base-hover",children:e("panel.openWorkflow",{ns:"workflow"})})}),(0,F.jsx)("div",{className:"h-px bg-divider-regular"})]}),d&&o.helpLinkUri&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)("div",{className:"p-1",children:(0,F.jsx)("a",{href:o.helpLinkUri,target:"_blank",className:"flex h-8 cursor-pointer items-center rounded-lg px-3 text-sm text-text-secondary hover:bg-state-base-hover",children:e("panel.helpLink",{ns:"workflow"})})}),(0,F.jsx)("div",{className:"h-px bg-divider-regular"})]}),(0,F.jsx)("div",{className:"p-1",children:(0,F.jsxs)("div",{className:"px-3 py-2 text-xs text-text-tertiary",children:[(0,F.jsx)("div",{className:"mb-1 flex h-[22px] items-center font-medium",children:e("panel.about",{ns:"workflow"}).toLocaleUpperCase()}),(0,F.jsx)("div",{className:"mb-1 leading-[18px] text-text-secondary",children:o.description}),(0,F.jsxs)("div",{className:"leading-[18px]",children:[e("panel.createdBy",{ns:"workflow"})," ",o.author]})]})})]})}),d2=(0,K.memo)(({id:a,data:b,triggerClassName:c,offset:d={mainAxis:4,crossAxis:53},onOpenChange:e,showHelpLink:f=!0})=>{let[g,h]=(0,K.useState)(!1),i=(0,K.useCallback)(a=>{h(a),e&&e(a)},[e]);return(0,F.jsxs)(bh.PortalToFollowElem,{placement:"bottom-end",offset:d,open:g,onOpenChange:i,children:[(0,F.jsx)(bh.PortalToFollowElemTrigger,{onClick:()=>i(!g),children:(0,F.jsx)("div",{className:`
            flex h-6 w-6 cursor-pointer items-center justify-center rounded-md
            hover:bg-state-base-hover
            ${g&&"bg-state-base-hover"}
            ${c}
          `,children:(0,F.jsx)(Y.RiMoreFill,{className:"h-4 w-4 text-text-tertiary"})})}),(0,F.jsx)(bh.PortalToFollowElemContent,{className:"z-[11]",children:(0,F.jsx)(d1,{id:a,data:b,onClosePopup:()=>h(!1),showHelpLink:f})})]})});var d3=a.i(703298),d4=a.i(81492),d5=a.i(630833);let d6=({id:a,data:b})=>{let{t:c}=(0,$.useTranslation)(),{handleRetryConfigChange:d}=(a=>{let{handleNodeDataUpdateWithSyncDraft:b}=(0,ao.useNodeDataUpdate)();return{handleRetryConfigChange:(0,K.useCallback)(c=>{b({id:a,data:{retry_config:c}})},[a,b])}})(a),{retry_config:e}=b,f=a=>{a>10?a=10:a<1&&(a=1),d({retry_enabled:!0,max_retries:a,retry_interval:e?.retry_interval||1e3})},g=a=>{a>5e3?a=5e3:a<100&&(a=100),d({retry_enabled:!0,max_retries:e?.max_retries||3,retry_interval:a})};return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)("div",{className:"pt-2",children:[(0,F.jsxs)("div",{className:"flex h-10 items-center justify-between px-4 py-2",children:[(0,F.jsx)("div",{className:"flex items-center",children:(0,F.jsx)("div",{className:"system-sm-semibold-uppercase mr-0.5 text-text-secondary",children:c("nodes.common.retry.retryOnFailure",{ns:"workflow"})})}),(0,F.jsx)(d4.default,{defaultValue:e?.retry_enabled,onChange:a=>{d({retry_enabled:a,max_retries:e?.max_retries||3,retry_interval:e?.retry_interval||1e3})}})]}),e?.retry_enabled&&(0,F.jsxs)("div",{className:"px-4 pb-2",children:[(0,F.jsxs)("div",{className:"mb-1 flex w-full items-center",children:[(0,F.jsx)("div",{className:"system-xs-medium-uppercase mr-2 grow text-text-secondary",children:c("nodes.common.retry.maxRetries",{ns:"workflow"})}),(0,F.jsx)(d3.default,{className:"mr-3 w-[108px]",value:e?.max_retries||3,onChange:f,min:1,max:10}),(0,F.jsx)(a2.default,{type:"number",wrapperClassName:"w-[100px]",value:e?.max_retries||3,onChange:a=>f(Number.parseInt(a.currentTarget.value,10)||3),min:1,max:10,unit:c("nodes.common.retry.times",{ns:"workflow"})||"",className:d5.default.input})]}),(0,F.jsxs)("div",{className:"flex items-center",children:[(0,F.jsx)("div",{className:"system-xs-medium-uppercase mr-2 grow text-text-secondary",children:c("nodes.common.retry.retryInterval",{ns:"workflow"})}),(0,F.jsx)(d3.default,{className:"mr-3 w-[108px]",value:e?.retry_interval||1e3,onChange:g,min:100,max:5e3}),(0,F.jsx)(a2.default,{type:"number",wrapperClassName:"w-[100px]",value:e?.retry_interval||1e3,onChange:a=>g(Number.parseInt(a.currentTarget.value,10)||1e3),min:100,max:5e3,unit:c("nodes.common.retry.ms",{ns:"workflow"})||"",className:d5.default.input})]})]})]}),(0,F.jsx)(au,{className:"mx-4 mt-2"})]})};var d7=a.i(714580);let d8=(0,K.memo)(({value:a,onBlur:b})=>{let{t:c}=(0,$.useTranslation)(),[d,e]=(0,K.useState)(a);return(0,F.jsx)("input",{value:d,onChange:a=>e(a.target.value),className:`
        system-xl-semibold mr-2 h-7 min-w-0 grow appearance-none rounded-md border border-transparent bg-transparent px-1 text-text-primary
        outline-none focus:shadow-xs
      `,placeholder:c("common.addTitle",{ns:"workflow"})||"",onBlur:()=>{if(!d){e(a),b(a);return}b(d)}})});d8.displayName="TitleInput";let d9=(0,K.memo)(({value:a,onChange:b})=>{let{t:c}=(0,$.useTranslation)(),[d,e]=(0,K.useState)(!1),f=(0,K.useCallback)(()=>{e(!0)},[]),g=(0,K.useCallback)(()=>{e(!1)},[]);return(0,F.jsx)("div",{className:`
        leading-0 group flex max-h-[60px] overflow-y-auto rounded-lg bg-components-panel-bg
        px-2 py-[5px]
        ${d&&"!shadow-xs"}
      `,children:(0,F.jsx)(d7.default,{value:a,onChange:a=>b(a.target.value),minRows:1,onFocus:f,onBlur:g,className:`
          w-full resize-none appearance-none bg-transparent text-xs
          leading-[18px] text-text-primary caret-[#295EFF]
          outline-none placeholder:text-text-quaternary
        `,placeholder:c("common.addDescription",{ns:"workflow"})||""})})});d9.displayName="DescriptionInput";var ea=a.i(41252);a.i(669870);var eb=a.i(872091);a.s(["ClockPlay",()=>eb.default],967923);var eb=eb;let ec=K.memo(({canSingleRun:a,onSingleRun:b})=>{let{t:c}=(0,$.useTranslation)();return(0,F.jsxs)("div",{className:"flex h-0 grow flex-col items-center justify-center",children:[(0,F.jsx)(eb.default,{className:"h-8 w-8 text-text-quaternary"}),(0,F.jsx)("div",{className:"system-xs-regular my-2 text-text-tertiary",children:c("debug.noData.description",{ns:"workflow"})}),a&&(0,F.jsxs)(av.default,{className:"flex",size:"small",onClick:b,children:[(0,F.jsx)(Y.RiPlayLine,{className:"mr-1 h-3.5 w-3.5"}),(0,F.jsx)("div",{children:c("debug.noData.runThisNode",{ns:"workflow"})})]})]})}),ed=K.memo(({appId:a,nodeId:b,canSingleRun:c,isRunAfterSingleRun:d,updateNodeRunningStatus:e,nodeInfo:f,runningStatus:g,onSingleRunClicked:h,singleRunResult:i,isPaused:j,...k})=>{let l=(0,as.useHooksStore)(a=>a.configsMap),m=g===aC.NodeRunningStatus.Succeeded,n=g===aC.NodeRunningStatus.Failed,[o,p]=K.useState(null),[q,r]=(0,K.useState)(!1),[s,t]=(0,K.useState)(!1),u=[aC.NodeRunningStatus.Succeeded,aC.NodeRunningStatus.Failed].includes(o),v=!d||m||n||q&&u,{data:w,isFetching:x,error:y}=(0,aH.useLastRun)(l?.flowType||aJ.FlowType.appFlow,l?.flowId||"",b,v),z=(0,K.useMemo)(()=>!j&&(d?[aC.NodeRunningStatus.Running,aC.NodeRunningStatus.NotStart].includes(g):x),[x,j,d,g]),A=y?.status===404,B=(v?w:i)||w||{},C=(0,K.useMemo)(()=>j||g===aC.NodeRunningStatus.Stopped?aC.NodeRunningStatus.Stopped:g===aC.NodeRunningStatus.Listening?aC.NodeRunningStatus.Listening:B.status||k.status,[j,g,B,k.status]),D=(0,K.useCallback)(()=>{r(!1),t(!1),p(null)},[]);(0,K.useEffect)(()=>{s&&o&&(!g||g===aC.NodeRunningStatus.NotStart)&&(e(o),D())},[m,n,g]),(0,K.useEffect)(()=>{[aC.NodeRunningStatus.Succeeded,aC.NodeRunningStatus.Failed].includes(g)&&p(g)},[g]),(0,K.useEffect)(()=>{D()},[b]);let E=(0,K.useCallback)(()=>{"hidden"===document.visibilityState?r(!0):t(!0)},[]);return((0,K.useEffect)(()=>(document.addEventListener("visibilitychange",E),()=>{document.removeEventListener("visibilitychange",E)}),[E]),x&&!d)?(0,F.jsx)("div",{className:"flex h-0 grow flex-col items-center justify-center",children:(0,F.jsx)(Y.RiLoader2Line,{className:"size-4 animate-spin text-text-tertiary"})}):z?(0,F.jsx)(ea.default,{status:"running",showSteps:!1}):j||!A&&B?(0,F.jsx)("div",{children:(0,F.jsx)(ea.default,{...B,...k,status:C,total_tokens:B?.execution_metadata?.total_tokens||k?.total_tokens,created_by:B?.created_by_account?.created_by||k?.created_by,nodeInfo:B,showSteps:!1})}):(0,F.jsx)(ec,{canSingleRun:c,onSingleRun:h})});var ee=a.i(990693),ef=a.i(122709);let eg="WORKFLOW_STOP",eh=["general_structure","parent_child_structure","qa_structure"];var ei=((r={}).Code="code",r.Preview="preview",r),ej=((s={}).Markdown="markdown",s.Chunks="chunks",s);a.s(["CHUNK_SCHEMA_TYPES",0,eh,"EVENT_WORKFLOW_STOP",0,eg,"PreviewType",()=>ej,"ViewMode",()=>ei],820494);let{checkValid:ek}=cu,{checkValid:el}=co,{checkValid:em}=ck,{checkValid:en}=b9,{checkValid:eo}=cN,{checkValid:ep}=cL,{checkValid:eq}=cg,{checkValid:er}=cO.default,{checkValid:es}=cP,{checkValid:et}=b7,{checkValid:eu}=cK,{checkValid:ev}=cm,{checkValid:ew}=ca,{checkValid:ex}=cE,ey={[aC.BlockEnum.LLM]:ek,[aC.BlockEnum.KnowledgeRetrieval]:el,[aC.BlockEnum.IfElse]:em,[aC.BlockEnum.Code]:en,[aC.BlockEnum.TemplateTransform]:eo,[aC.BlockEnum.QuestionClassifier]:ep,[aC.BlockEnum.HttpRequest]:eq,[aC.BlockEnum.Tool]:er,[aC.BlockEnum.VariableAssigner]:et,[aC.BlockEnum.VariableAggregator]:es,[aC.BlockEnum.ParameterExtractor]:eu,[aC.BlockEnum.Iteration]:ev,[aC.BlockEnum.DocExtractor]:ew,[aC.BlockEnum.Loop]:ex};var ez=a.i(399450);let eA=(a,b)=>{let{handleNodeDataUpdateWithSyncDraft:c}=(0,ao.useNodeDataUpdate)();return{inputs:b,setInputs:b=>{c({id:a,data:b})}}};var eB=a.i(997472),eC=a.i(746077),eD=a.i(849546);let eE=function({inputs:a,setInputs:b,varKey:c="variables"}){return{handleVarListChange:(0,K.useCallback)(d=>{b((0,I.produce)(a,a=>{a[c]=d}))},[a,b,c]),handleAddVariable:(0,K.useCallback)(()=>{b((0,I.produce)(a,a=>{a[c].push({variable:"",value_selector:[]})}))},[a,b,c])}};a.i(207642);var eF=a.i(315680);let eG=(a,b)=>{let c=(0,eC.useStrategyProviderDetail)(a||"",{retry:!1}),d=c.data?.declaration.strategies.find(a=>a.identity.name===b),e=(0,bx.useFetchPluginsInMarketPlaceByIds)([a],{retry:!1}),f=(0,K.useMemo)(()=>{if(c.isLoading||e.isLoading)return;let a=!!d,b=!c.isError;return{plugin:{source:e.data?.data.plugins.at(0)?"marketplace":"external",installed:b},isExistInPlugin:a}},[d,e,c.isError,c.isLoading]),g=(0,K.useCallback)(()=>{c.refetch(),e.refetch()},[e,c]);return{strategyProvider:c,strategy:d,strategyStatus:f,refetch:g}},eH=(a,b)=>{let{nodesReadOnly:c}=(0,aq.useNodesReadOnly)(),{inputs:d,setInputs:e}=eA(a,b),{handleVarListChange:f,handleAddVariable:g}=eE({inputs:d,setInputs:e}),{strategyStatus:h,strategy:i,strategyProvider:j}=eG(d.agent_strategy_provider_name,d.agent_strategy_name),k=d.agent_strategy_provider_name?.split("/").splice(0,2).join("/"),l=(0,bx.useCheckInstalled)({pluginIds:[k],enabled:!!k}),m=(0,K.useMemo)(()=>{let a=(i?.parameters||[]).map(a=>a.name);return Object.fromEntries(Object.entries(d.agent_parameters||{}).filter(([b])=>a.includes(b)).map(([a,b])=>[a,b.value]))},[d.agent_parameters,i?.parameters]),n=(0,K.useCallback)(a=>i?.parameters.some(b=>b.name===a&&b.type===b$.FormTypeEnum.any)?eF.VarType.variable:eF.VarType.constant,[i?.parameters]),o=a=>{let b=(0,eB.generateAgentToolValue)(a.settings,(0,eB.toolParametersToFormSchemas)(a.schemas.filter(a=>"llm"!==a.form))),c=(0,eB.generateAgentToolValue)(a.parameters,(0,eB.toolParametersToFormSchemas)(a.schemas.filter(a=>"llm"===a.form)),!0);return(0,I.produce)(a,a=>{a.settings=b,a.parameters=c})};(0,K.useEffect)(()=>{i&&e(d.version||d.tool_node_version?d:(0,I.produce)(d,a=>{let b=i?.parameters||[];Object.keys(a.agent_parameters||{}).forEach(c=>{let d=b.find(a=>a.name===c);d?.type===b$.FormTypeEnum.toolSelector&&(a.agent_parameters[c].value=o(a.agent_parameters[c].value)),d?.type===b$.FormTypeEnum.multiToolSelector&&(a.agent_parameters[c].value=a.agent_parameters[c].value.map(a=>o(a)))}),a.tool_node_version="2"}))},[i]);let p=(0,K.useCallback)(a=>[aC.VarType.arrayObject,aC.VarType.array,aC.VarType.number,aC.VarType.string,aC.VarType.secret,aC.VarType.arrayString,aC.VarType.arrayNumber,aC.VarType.file,aC.VarType.arrayFile].includes(a.type),[]),{availableVars:q,availableNodesWithParent:r}=(0,eD.default)(a,{onlyLeafNodeVar:!1,filterVar:p}),s=(0,K.useMemo)(()=>{let a=[];return d.output_schema&&d.output_schema.properties?(Object.keys(d.output_schema.properties).forEach(b=>{let c=d.output_schema.properties[b];a.push({name:b,type:"array"===c.type?`Array[${c.items?.type?c.items.type.slice(0,1).toLocaleUpperCase()+c.items.type.slice(1):"Unknown"}]`:`${c.type?c.type.slice(0,1).toLocaleUpperCase()+c.type.slice(1):"Unknown"}`,description:c.description})}),a):[]},[d.output_schema]),t=(0,K.useCallback)(a=>{e((0,I.produce)(d,b=>{b.memory=a}))},[d,e]),u=(0,aq.useIsChatMode)();return{readOnly:c,inputs:d,setInputs:e,handleVarListChange:f,handleAddVariable:g,currentStrategy:i,formData:m,onFormChange:a=>{let b={};Object.entries(a).forEach(([a,c])=>{b[a]={type:n(a),value:c}}),e({...d,agent_parameters:b})},currentStrategyStatus:h,strategyProvider:j.data,pluginDetail:l.data?.plugins.at(0),availableVars:q,availableNodesWithParent:r,outputSchema:s,handleMemoryChange:t,isChatMode:u}};var eI=a.i(478874);let eJ=(a,b)=>{let c=b.find(b=>"sys"===a[0]&&!!b.isStartNode||a[0]===b.nodeId),d=c?.vars.find(b=>"sys"===a[0]&&b.variable===`sys.${a[1]}`||b.variable===a[1]),e="";return d?.type==="array[file]"&&(e=aC.InputVarType.multiFiles),d?.type==="file"&&(e=aC.InputVarType.singleFile),d&&{...d,formType:e}},eK=a=>Array.isArray(a.value)?a.value[0]??"":"number"==typeof a.value?String(a.value):a.value??"",eL="nodes.knowledgeRetrieval",eM=(a,{payload:b={enabled:!1},onChange:c})=>{let{currentModel:d}=(0,ae.useTextGenerationCurrentProviderAndModelAndModelList)({provider:a.provider,model:a.name}),e=(0,aq.useIsChatMode)(),f=(0,K.useCallback)(()=>!!d?.features?.includes(b$.ModelFeatureEnum.vision),[d]),g=f(),h=(0,K.useCallback)(a=>{c((0,I.produce)(b,b=>{b.enabled=a,a&&e?b.configs={detail:aI.Resolution.high,variable_selector:["sys","files"]}:a||delete b.configs}))},[e,c,b]),i=(0,K.useCallback)(a=>{c((0,I.produce)(b,b=>{b.configs=a}))},[c,b]),j=(0,K.useCallback)(()=>{f()?b.enabled&&c({enabled:!0,configs:{detail:aI.Resolution.high,variable_selector:[]}}):h(!1)},[f,h,c,b.enabled]);return{isVisionModel:g,handleVisionResolutionEnabledChange:h,handleVisionResolutionChange:i,handleModelChanged:j}},eN="nodes.llm";var eO=a.i(844299);let eP=(a,b)=>{let c=(0,aP.useWorkflowStore)(),{nodesReadOnly:d}=(0,aq.useNodesReadOnly)(),{t:e}=(0,$.useTranslation)(),f=(0,ae.useLanguage)(),{inputs:g,setInputs:h}=eA(a,b),{provider_id:i,provider_type:j,tool_name:k,tool_configurations:l,tool_parameters:m}=g,n=j===bN.CollectionType.builtIn,{data:o}=(0,Q.useAllBuiltInTools)(),{data:p}=(0,Q.useAllCustomTools)(),{data:q}=(0,Q.useAllWorkflowTools)(),{data:r}=(0,Q.useAllMCPTools)(),s=(0,K.useMemo)(()=>{switch(j){case bN.CollectionType.builtIn:return o||[];case bN.CollectionType.custom:return p||[];case bN.CollectionType.workflow:return q||[];case bN.CollectionType.mcp:return r||[];default:return[]}},[o,p,r,j,q]),t=(0,K.useMemo)(()=>s.find(a=>(0,aU.canFindTool)(a.id,i)),[s,i]),u=!!t?.allow_delete,v=!!t?.is_team_authorization,w=n&&u&&!v,[x,{setTrue:y,setFalse:z}]=(0,a8.useBoolean)(!1),A=(0,Q.useInvalidToolsByType)(j),B=(0,K.useCallback)(async a=>{await (0,eO.updateBuiltInToolCredential)(t?.name,a),aX.default.notify({type:"success",message:e("api.actionSuccess",{ns:"common"})}),A(),z()},[t?.name,z,e,A,j]),C=(0,K.useMemo)(()=>t?.tools.find(a=>a.name===k),[t,k]),D=(0,K.useMemo)(()=>C?(0,eB.toolParametersToFormSchemas)(C.parameters):[],[C]),E=(0,K.useMemo)(()=>D.filter(a=>"llm"===a.form),[D]),F=(0,K.useMemo)(()=>D.filter(a=>"llm"!==a.form),[D]),G=F.some(a=>"boolean"===a.type||"number-input"===a.type),H=(0,K.useCallback)(a=>{G?h((0,I.produce)(a,a=>{let b={...a.tool_configurations};Object.keys(a.tool_configurations).forEach(a=>{let c=D.find(b=>b.variable===a),d=b[a];c?.type==="boolean"&&("string"==typeof d&&(b[a]="true"===d||"1"===d),"number"==typeof d&&(b[a]=1===d)),c?.type==="number-input"&&"string"==typeof d&&""!==d&&(b[a]=Number.parseFloat(d))}),a.tool_configurations=b})):h(a)},[h,D,G]),[J,L]=(0,K.useState)(!1),M=(0,K.useMemo)(()=>J?l:(0,eB.getConfiguredValue)(l,F),[J,F,l]),N=(0,K.useCallback)(a=>{L(!0),H({...g,tool_configurations:a})},[g,H]);(0,K.useEffect)(()=>{if(!C)return;let a=(0,I.produce)(g,a=>{a.tool_configurations&&0!==Object.keys(a.tool_configurations).length||(a.tool_configurations=(0,eB.getConfiguredValue)(l,F)),a.tool_parameters&&0!==Object.keys(a.tool_parameters).length||(a.tool_parameters=(0,eB.getConfiguredValue)(m,E))}),{setControlPromptEditorRerenderKey:b}=c.getState();H(a),setTimeout(()=>b(Date.now()))},[C]);let O=(0,K.useCallback)(a=>{H({...g,tool_parameters:a})},[g,H]),P=C&&!!n&&!t,R=(0,K.useMemo)(()=>{let a=[],b=C?.output_schema;return b&&b.properties&&Object.keys(b.properties).forEach(c=>{let d=b.properties[c];"object"===d.type?a.push({name:c,value:d}):a.push({name:c,type:"array"===d.type?`Array[${d.items?.type?d.items.type.slice(0,1).toLocaleUpperCase()+d.items.type.slice(1):"Unknown"}]`:`${d.type?d.type.slice(0,1).toLocaleUpperCase()+d.type.slice(1):"Unknown"}`,description:d.description})}),a},[C]),S=(0,K.useMemo)(()=>{let a=C?.output_schema;if(!a||!a.properties)return!1;let b=a.properties;return Object.keys(b).some(a=>"object"===b[a].type)},[C]);return{readOnly:d,inputs:g,currTool:C,toolSettingSchema:F,toolSettingValue:M,setToolSettingValue:N,toolInputVarSchema:E,setInputVar:O,currCollection:t,isShowAuthBtn:w,showSetAuth:x,showSetAuthModal:y,hideSetAuthModal:z,handleSaveAuth:B,isLoading:P,outputSchema:R,hasObjectOutput:S,getMoreDataForCheckValid:()=>{let a;return{toolInputsSchema:(a=[],E.forEach(b=>{a.push({label:b.label[f]||b.label.en_US,variable:b.variable,type:b.type,required:b.required})}),a),notAuthed:w,toolSettingSchema:F,language:f}}}};var eQ=a.i(340455),eR=a.i(213228),eS=((t={}).settings="settings",t.lastRun="lastRun",t.relations="relations",t);let eT=K.memo(({value:a,onChange:b})=>{let{t:c}=(0,$.useTranslation)();return(0,F.jsx)(eR.default,{items:[{id:"settings",name:c("debug.settingsTab",{ns:"workflow"}).toLocaleUpperCase()},{id:"lastRun",name:c("debug.lastRunTab",{ns:"workflow"}).toLocaleUpperCase()}],itemClassName:"ml-0",value:a,onChange:b})}),eU={[aC.BlockEnum.LLM]:({id:a,payload:b,runInputData:c,runInputDataRef:d,getInputVars:e,setRunInputData:f,toVarInputs:g})=>{let h,i,j,{t:k}=(0,$.useTranslation)(),{inputs:l}=eA(a,b),m=(0,aq.useIsChatMode)(),n=c["#context#"],o=(0,K.useCallback)(a=>{f?.({...d.current,"#context#":a})},[d,f]),p=c["#files#"],q=(0,K.useCallback)(a=>{f?.({...d.current,"#files#":a})},[d,f]),r=l.model,s=l.model?.mode===aI.AppModeEnum.CHAT,{isVisionModel:t}=eM(r,{payload:l.vision,onChange:ds.noop}),u=s?l.prompt_template.some(a=>a.edition_type===aC.EditionType.jinja2):l.prompt_template.edition_type===aC.EditionType.jinja2,v=(0,K.useCallback)(a=>[aC.VarType.arrayObject,aC.VarType.array,aC.VarType.number,aC.VarType.string,aC.VarType.secret,aC.VarType.arrayString,aC.VarType.arrayNumber,aC.VarType.file,aC.VarType.arrayFile].includes(a.type),[]),{availableVars:w}=(0,eD.default)(a,{onlyLeafNodeVar:!1,filterVar:v}),x=(i=e((h=s?l.prompt_template.filter(a=>a.edition_type!==aC.EditionType.jinja2).map(a=>a.text):[l.prompt_template.text],m&&s&&l.memory&&(h.push("{{#sys.query#}}"),h.push(l.memory.query_prompt_template)),h))||[],u?[...i,...g?g(l.prompt_config?.jinja2_variables||[]):[]]:i),y=(j={},Object.keys(c).filter(a=>!["#context#","#files#"].includes(a)).forEach(a=>{j[a]=c[a]}),j),z=(0,K.useCallback)(a=>{let b={...a,"#context#":d.current["#context#"],"#files#":d.current["#files#"]};f?.(b)},[d,f]);return{forms:(()=>{let a=[];if(x.length>0&&a.push({label:k(`${eN}.singleRun.variable`,{ns:"workflow"}),inputs:x,values:y,onChange:z}),l.context?.variable_selector&&l.context?.variable_selector.length>0&&a.push({label:k(`${eN}.context`,{ns:"workflow"}),inputs:[{label:"",variable:"#context#",type:aC.InputVarType.contexts,required:!1}],values:{"#context#":n},onChange:a=>o(a["#context#"])}),t&&b.vision?.enabled&&b.vision?.configs?.variable_selector){let c=eJ(b.vision.configs.variable_selector,w);a.push({label:k(`${eN}.vision`,{ns:"workflow"}),inputs:[{label:c?.variable,variable:"#files#",type:c?.formType,required:!1}],values:{"#files#":p},onChange:a=>q(a["#files#"])})}return a})(),getDependentVars:()=>{let a=[...x.map(a=>a.variable&&"string"==typeof a.variable?a.variable.slice(1,-1).split("."):[]).filter(a=>a.length>0),b.context.variable_selector];if(t&&b.vision?.enabled&&b.vision?.configs?.variable_selector){let c=b.vision.configs.variable_selector;a.push(c)}return a},getDependentVar:a=>"#context#"===a?b.context.variable_selector:"#files#"===a&&b.vision.configs?.variable_selector}},[aC.BlockEnum.KnowledgeRetrieval]:({id:a,payload:b,runInputData:c,runInputDataRef:d,setRunInputData:e})=>{let{t:f}=(0,$.useTranslation)(),g=(0,eI.useDatasetsDetailStore)(a=>a.datasetsDetail),h=c.query,i=c.queryAttachment,j=(0,K.useCallback)(a=>{e({...d.current,query:a})},[d,e]),k=(0,K.useCallback)(a=>{e({...d.current,queryAttachment:a})},[d,e]),l=(0,K.useCallback)(a=>[aC.VarType.file,aC.VarType.arrayFile].includes(a.type),[]),{availableVars:m}=(0,eD.default)(a,{onlyLeafNodeVar:!1,filterVar:l});return{forms:(0,K.useMemo)(()=>{let a=b.dataset_ids.reduce((a,b)=>(g[b]&&a.push(g[b]),a),[]).some(a=>a.is_multimodal),c=[{inputs:[{label:f(`${eL}.queryText`,{ns:"workflow"}),variable:"query",type:aC.InputVarType.paragraph,required:!1}],values:{query:h},onChange:a=>j(a.query)}];if(a){let a=eJ(b.query_attachment_selector||[],m);c.push({inputs:[{label:f(`${eL}.queryAttachment`,{ns:"workflow"}),variable:"queryAttachment",type:a?.formType,required:!1}],values:{queryAttachment:i},onChange:a=>k(a.queryAttachment)})}return c},[h,j,f,g,b.dataset_ids,b.query_attachment_selector,m,i,k]),getDependentVars:()=>[b.query_variable_selector,b.query_attachment_selector||[]],getDependentVar:a=>"query"===a?b.query_variable_selector:"queryAttachment"===a?b.query_attachment_selector||[]:void 0}},[aC.BlockEnum.Code]:({id:a,payload:b,runInputData:c,toVarInputs:d,setRunInputData:e})=>{let f,{inputs:g}=eA(a,b),h=d(g.variables),i=(0,K.useCallback)(a=>{e(a)},[e]),j=(f={},Object.keys(c).forEach(a=>{f[a]=c[a]}),f);return{forms:(0,K.useMemo)(()=>[{inputs:h,values:j,onChange:i}],[j,i,h]),getDependentVars:()=>b.variables.map(a=>a.value_selector),getDependentVar:a=>{let c=b.variables.find(b=>b.variable===a);if(c)return c.value_selector}}},[aC.BlockEnum.TemplateTransform]:({id:a,payload:b,runInputData:c,toVarInputs:d,setRunInputData:e})=>{let f,{inputs:g}=eA(a,b),h=d(g.variables),i=(0,K.useCallback)(a=>{e(a)},[e]),j=(f={},Object.keys(c).forEach(a=>{f[a]=c[a]}),f);return{forms:(0,K.useMemo)(()=>[{inputs:h,values:j,onChange:i}],[j,i,h]),getDependentVars:()=>b.variables.map(a=>a.value_selector),getDependentVar:a=>{let c=b.variables.find(b=>b.variable===a);if(c)return c.value_selector}}},[aC.BlockEnum.QuestionClassifier]:({id:a,payload:b,runInputData:c,runInputDataRef:d,getInputVars:e,setRunInputData:f})=>{let g,{t:h}=(0,$.useTranslation)(),{inputs:i}=eA(a,b),{isVisionModel:j}=eM(i.model,{payload:i.vision,onChange:ds.noop}),k=c["#files#"],l=(0,K.useCallback)(a=>{f?.({...d.current,"#files#":a})},[d,f]),m=e([i.instruction]),n=(g={},Object.keys(c).filter(a=>!["#files#"].includes(a)).forEach(a=>{g[a]=c[a]}),g),o=(0,K.useCallback)(a=>{let b={...a,"#files#":d.current["#files#"]};f?.(b)},[d,f]),p=(0,K.useCallback)(a=>[aC.VarType.file,aC.VarType.arrayFile].includes(a.type),[]),{availableVars:q}=(0,eD.default)(a,{onlyLeafNodeVar:!1,filterVar:p});return{forms:(()=>{let a=[];if(a.push({label:h("nodes.llm.singleRun.variable",{ns:"workflow"}),inputs:[{label:h("nodes.questionClassifiers.inputVars",{ns:"workflow"}),variable:"query",type:aC.InputVarType.paragraph,required:!0},...m],values:n,onChange:o}),j&&b.vision?.enabled&&b.vision?.configs?.variable_selector){let c=eJ(b.vision.configs.variable_selector,q);a.push({label:h("nodes.llm.vision",{ns:"workflow"}),inputs:[{label:c?.variable,variable:"#files#",type:c?.formType,required:!1}],values:{"#files#":k},onChange:a=>l(a["#files#"])})}return a})(),getDependentVars:()=>{let a=m.map(a=>a.variable&&"string"==typeof a.variable?a.variable.slice(1,-1).split("."):[]).filter(a=>a.length>0),c=[b.query_variable_selector,...a];if(j&&b.vision?.enabled&&b.vision?.configs?.variable_selector){let a=b.vision.configs.variable_selector;c.push(a)}return c},getDependentVar:a=>"query"===a?b.query_variable_selector:"#files#"===a&&b.vision.configs?.variable_selector}},[aC.BlockEnum.HttpRequest]:({id:a,payload:b,runInputData:c,getInputVars:d,setRunInputData:e})=>{let f,{inputs:g}=eA(a,b),h=(0,K.useMemo)(()=>Array.isArray(g.body.data)?g.body.data.filter(a=>a.file?.length).map(a=>a.file?`{{#${a.file.join(".")}#}}`:"").join(" "):"",[g.body.data]),i=d([g.url,g.headers,g.params,"string"==typeof g.body.data?g.body.data:g.body.data?.map(a=>a.value).join(""),h]),j=(0,K.useCallback)(a=>{e(a)},[e]),k=(f={},Object.keys(c).forEach(a=>{f[a]=c[a]}),f);return{forms:(0,K.useMemo)(()=>[{inputs:i,values:k,onChange:j}],[k,j,i]),getDependentVars:()=>i.map(a=>a.variable&&"string"==typeof a.variable?a.variable.slice(1,-1).split("."):[]).filter(a=>a.length>0)}},[aC.BlockEnum.Tool]:({id:a,payload:b,getInputVars:c,setRunInputData:d,runResult:e})=>{let{t:f}=(0,$.useTranslation)(),{inputs:g}=eA(a,b),h=c([...Object.keys(g.tool_parameters).filter(a=>g.tool_parameters[a].type!==eF.VarType.constant).map(a=>g.tool_parameters[a]),...Object.keys(g.tool_configurations).filter(a=>"object"==typeof g.tool_configurations[a]&&g.tool_configurations[a].type&&g.tool_configurations[a].type!==eF.VarType.constant).map(a=>g.tool_configurations[a])].map(a=>a.type===eF.VarType.variable?a.value.join?`{{#${a.value.join(".")}#}}`:`{{#${a.value}#}}`:a.value)),[i,j]=(0,K.useState)({}),k=(0,K.useCallback)(a=>{j(a),d(a)},[d]),l=(0,K.useCallback)(()=>(0,I.produce)(i,a=>{Object.keys(g.tool_parameters).forEach(b=>{let{type:c,value:d}=g.tool_parameters[b];if(c===eF.VarType.constant&&null==d){if(!a.tool_parameters||!a.tool_parameters[b])return;a[b]=d}})}),[g.tool_parameters,i]),m=(0,K.useMemo)(()=>[{inputs:h,values:l(),onChange:k}],[l,k,h]);return{forms:m,nodeInfo:(0,K.useMemo)(()=>e?(0,ez.default)([e],f)[0]:null,[e,f]),toolIcon:(0,ar.useToolIcon)(b),getDependentVars:()=>h.map(a=>a.variable&&"string"==typeof a.variable?a.variable.slice(1,-1).split("."):[]).filter(a=>a.length>0)}},[aC.BlockEnum.ParameterExtractor]:({id:a,payload:b,runInputData:c,runInputDataRef:d,getInputVars:e,setRunInputData:f})=>{let g,{t:h}=(0,$.useTranslation)(),{inputs:i}=eA(a,b),{isVisionModel:j}=eM(i.model,{payload:i.vision,onChange:ds.noop}),k=c["#files#"],l=(0,K.useCallback)(a=>{f?.({...d.current,"#files#":a})},[d,f]),m=e([i.instruction]),n=(g={},Object.keys(c).filter(a=>!["#context#","#files#"].includes(a)).forEach(a=>{g[a]=c[a]}),g),o=(0,K.useCallback)(a=>{let b={...a,"#context#":d.current["#context#"],"#files#":d.current["#files#"]};f?.(b)},[d,f]),p=(0,K.useCallback)(a=>[aC.VarType.file,aC.VarType.arrayFile].includes(a.type),[]),{availableVars:q}=(0,eD.default)(a,{onlyLeafNodeVar:!1,filterVar:p});return{forms:(()=>{let a=[];if(a.push({label:h("nodes.llm.singleRun.variable",{ns:"workflow"}),inputs:[{label:h("nodes.parameterExtractor.inputVar",{ns:"workflow"}),variable:"query",type:aC.InputVarType.paragraph,required:!0},...m],values:n,onChange:o}),j&&b.vision?.enabled&&b.vision?.configs?.variable_selector){let c=eJ(b.vision.configs.variable_selector,q);a.push({label:h("nodes.llm.vision",{ns:"workflow"}),inputs:[{label:c?.variable,variable:"#files#",type:c?.formType,required:!1}],values:{"#files#":k},onChange:a=>l(a["#files#"])})}return a})(),getDependentVars:()=>{let a=m.map(a=>a.variable&&"string"==typeof a.variable?a.variable.slice(1,-1).split("."):[]).filter(a=>a.length>0),c=[b.query,...a];if(j&&b.vision?.enabled&&b.vision?.configs?.variable_selector){let a=b.vision.configs.variable_selector;c.push(a)}return c},getDependentVar:a=>"query"===a?b.query:"#files#"===a&&b.vision.configs?.variable_selector}},[aC.BlockEnum.Iteration]:({id:a,payload:b,runInputData:c,toVarInputs:d,setRunInputData:e,iterationRunResult:f})=>{let g,h,i,j,{t:k}=(0,$.useTranslation)(),{isNodeInIteration:l}=(0,aq.useIsNodeInIteration)(a),{getIterationNodeChildren:m,getBeforeNodesInSameBranch:n}=(0,aq.useWorkflow)(),o=m(a),p=[...n(a),...o],q=`${a}.input_selector`,r=c[q],s=(0,K.useCallback)(a=>{e({...c,[q]:a})},[q,c,e]),{usedOutVars:t,allVarObject:u}=(g=[],h={},i={},o.forEach(b=>{(0,bY.getNodeUsedVars)(b).filter(a=>a&&a.length>0).forEach(c=>{if(c[0]===a||l(c[0]))return;let d=c.join(".");h[d]||(h[d]=!0,g.push(c));let e=(0,bY.getNodeUsedVarPassToServerKey)(b,c);"string"==typeof e&&(e=[e]),e.forEach((a,c)=>{i[[d,b.id,c].join(O.VALUE_SELECTOR_DELIMITER)]={inSingleRunPassedKey:a}})})}),{usedOutVars:d(g.map(a=>{let b=(0,bY.getNodeInfoById)(p,a[0]);return{label:{nodeType:b?.data.type,nodeName:b?.data.title||p[0]?.data.title,variable:(0,bY.isSystemVar)(a)?a.join("."):a[a.length-1]},variable:`${a.join(".")}`,value_selector:a}})),allVarObject:i}),v=(0,K.useCallback)(a=>{e(a)},[e]),w=(j={},Object.keys(c).forEach(a=>{j[a]=c[a]}),j),x=(0,K.useMemo)(()=>[{inputs:[...t],values:w,onChange:v},{label:k("nodes.iteration.input",{ns:"workflow"}),inputs:[{label:"",variable:q,type:aC.InputVarType.iterator,required:!1,getVarValueFromDependent:!0,isFileItem:b.iterator_input_type===aC.VarType.arrayFile}],values:{[q]:r},onChange:a=>s(a[q])}],[w,r,q,b.iterator_input_type,v,s,k,t]);return{forms:x,nodeInfo:(0,ez.default)(f,k)[0],allVarObject:u,getDependentVars:()=>[b.iterator_selector],getDependentVar:a=>{if(a===q)return b.iterator_selector}}},[aC.BlockEnum.Agent]:({id:a,payload:b,runInputData:c,getInputVars:d,setRunInputData:e,runResult:f})=>{let{t:g}=(0,$.useTranslation)(),{inputs:h}=eA(a,b),i=(0,K.useMemo)(()=>Object.fromEntries(Object.entries(h.agent_parameters||{}).map(([a,b])=>[a,b.value])),[h.agent_parameters]),{strategy:j}=eG(h.agent_strategy_provider_name,h.agent_strategy_name),k=j?.parameters.filter(a=>"string"===a.type).map(a=>i[a.name])||[],l=d?.(k),m=(0,K.useMemo)(()=>{let a=[];return l.length>0&&a.push({label:g("nodes.llm.singleRun.variable",{ns:"workflow"}),inputs:l,values:c,onChange:e}),a},[c,e,g,l]);return{forms:m,nodeInfo:(0,K.useMemo)(()=>{if(f)return(0,ez.default)([f],g)[0]},[f,g]),getDependentVars:()=>l.map(a=>a.variable&&"string"==typeof a.variable?a.variable.slice(1,-1).split("."):[]).filter(a=>a.length>0)}},[aC.BlockEnum.DocExtractor]:({payload:a,runInputData:b,setRunInputData:c})=>{let{t:d}=(0,$.useTranslation)(),e=b.files,f=(0,K.useCallback)(a=>{c({...b,files:a})},[b,c]);return{forms:(0,K.useMemo)(()=>[{inputs:[{label:d("nodes.docExtractor.inputVar",{ns:"workflow"}),variable:"files",type:aC.InputVarType.multiFiles,required:!0}],values:{files:e},onChange:a=>f(a.files)}],[e,f,d]),getDependentVars:()=>[a.variable_selector],getDependentVar:b=>{if("files"===b)return a.variable_selector}}},[aC.BlockEnum.Loop]:({id:a,payload:b,runInputData:c,runResult:d,loopRunResult:e,setRunInputData:f,toVarInputs:g,varSelectorsToVarInputs:h})=>{let i,j,k,l,m,n,o,p,{t:q}=(0,$.useTranslation)(),{isNodeInLoop:r}=(0,aq.useIsNodeInLoop)(a),{getLoopNodeChildren:s,getBeforeNodesInSameBranch:t}=(0,aq.useWorkflow)(),u=s(a),v=[...t(a),...u],{usedOutVars:w,allVarObject:x}=(i=[],j={},k={},u.forEach(b=>{(0,bY.getNodeUsedVars)(b).filter(a=>a&&a.length>0).forEach(c=>{if(c[0]===a||r(c[0]))return;let d=c.join(".");j[d]||(j[d]=!0,i.push(c));let e=(0,bY.getNodeUsedVarPassToServerKey)(b,c);"string"==typeof e&&(e=[e]),e.forEach((a,c)=>{k[[d,b.id,c].join(O.VALUE_SELECTOR_DELIMITER)]={inSingleRunPassedKey:a}})})}),{usedOutVars:g(i.map(a=>{let b=(0,bY.getNodeInfoById)(v,a[0]);return{label:{nodeType:b?.data.type,nodeName:b?.data.title||v[0]?.data.title,variable:(0,bY.isSystemVar)(a)?a.join("."):a[a.length-1]},variable:`${a.join(".")}`,value_selector:a}})),allVarObject:k}),y=(0,K.useMemo)(()=>{let a=(0,ez.default)(e,q)[0];return d&&a?{...a,execution_metadata:{...d.execution_metadata,...a.execution_metadata}}:a},[d,e,q]),z=(0,K.useCallback)(a=>{f(a)},[f]),A=(l={},Object.keys(c).forEach(a=>{l[a]=c[a]}),l),B=a=>{var b;let c,d=[];return a.variable_selector&&d.push(a.variable_selector),a.sub_variable_condition&&a.sub_variable_condition.conditions?.length&&d.push(...(b=a.sub_variable_condition,c=[],b.conditions&&b.conditions.length&&b.conditions.forEach(a=>{let b=B(a);c.push(...b)}),c)),d},C=(m=[],b.break_conditions?.forEach(a=>{let b=B(a);m.push(...b)}),b.loop_variables?.forEach(a=>{a.value_type===aC.ValueType.variable&&m.push(a.value)}),n=[...h(m)],o={},p=[],n.forEach(a=>{a&&(o[a.variable]||(o[a.variable]=!0,p.push(a)))}),[{inputs:[...w,...p],values:A,onChange:z}]),D=a=>{var b;let c,d=[];return a.variable_selector&&d.push(a.variable_selector),a.sub_variable_condition&&a.sub_variable_condition.conditions?.length&&d.push(...(b=a.sub_variable_condition,c=[],b.conditions&&b.conditions.length&&b.conditions.forEach(a=>{let b=D(a);c.push(...b)}),c)),d};return{forms:C,nodeInfo:y,allVarObject:x,getDependentVars:()=>{let c=w.map(a=>a.variable.split("."));return b.break_conditions?.forEach(a=>{let b=D(a);c.push(...b)}),b.loop_variables?.forEach(a=>{a.value_type===aC.ValueType.variable&&c.push(a.value)}),c.filter(b=>b[0]!==a)}}},[aC.BlockEnum.Start]:({id:a,payload:b,runInputData:c,setRunInputData:d})=>{let e,f,{t:g}=(0,$.useTranslation)(),h=(0,aq.useIsChatMode)();return{forms:(e=[],f=b.variables.map(a=>({...a,getVarValueFromDependent:!0})),h&&f.push({label:"sys.query",variable:"#sys.query#",type:aC.InputVarType.textInput,required:!0}),f.push({label:"sys.files",variable:"#sys.files#",type:aC.InputVarType.multiFiles,required:!1}),e.push({label:g("nodes.llm.singleRun.variable",{ns:"workflow"}),inputs:f,values:c,onChange:d}),e),getDependentVars:()=>{let c=[...b.variables.map(b=>[a,b.variable]),["sys","files"]];return h&&c.push(["sys","query"]),c},getDependentVar:b=>[a,b]}},[aC.BlockEnum.IfElse]:({payload:a,runInputData:b,setRunInputData:c,getInputVars:d,varSelectorsToVarInputs:e})=>{let f,g,h,i,j,k,l=(0,K.useCallback)(a=>{c(a)},[c]),m=(f={},Object.keys(b).forEach(a=>{f[a]=b[a]}),f),n=a=>{let b=[];return a.conditions&&a.conditions.length&&a.conditions.forEach(a=>{let c=o(a);b.push(...c)}),b},o=a=>{let b=[];return a.variable_selector&&b.push(a.variable_selector),a.sub_variable_condition&&a.sub_variable_condition.conditions?.length&&b.push(...n(a.sub_variable_condition)),b},p=a=>{let b=[];return a.conditions&&a.conditions.length&&a.conditions.forEach(a=>{let c=q(a);b.push(...c)}),b},q=a=>{let b=[];if(a.value&&"string"==typeof a.value){let c=d([a.value]);b.push(...c)}return a.sub_variable_condition&&a.sub_variable_condition.conditions?.length&&b.push(...p(a.sub_variable_condition)),b},r=(g=[],h=[],a.cases&&a.cases.length&&a.cases.forEach(a=>{let b=n(a);g.push(...b),h.push(...p(a))}),i=[...e(g),...h],j={},k=[],i.forEach(a=>{a&&(j[a.variable]||(j[a.variable]=!0,k.push(a)))}),[{inputs:k,values:m,onChange:l}]),s=a=>{let b=[];return a.conditions&&a.conditions.length&&a.conditions.forEach(a=>{let c=t(a);b.push(...c)}),b},t=a=>{let b=[];return a.variable_selector&&b.push(a.variable_selector),a.sub_variable_condition&&a.sub_variable_condition.conditions?.length&&b.push(...s(a.sub_variable_condition)),b};return{forms:r,getDependentVars:()=>{let b=[];return a.cases&&a.cases.length&&a.cases.forEach(a=>{let c=s(a);b.push(...c)}),b}}},[aC.BlockEnum.VariableAggregator]:({payload:a,runInputData:b,setRunInputData:c,varSelectorsToVarInputs:d})=>{let e,f,g,h,i,j,k=(0,K.useCallback)(a=>{c(a)},[c]),l=(e={},Object.keys(b).forEach(a=>{e[a]=b[a]}),e);return{forms:(f=[],(g=!!a.advanced_settings?.group_enabled)||!a.variables||!a.variables.length||a.variables.forEach(a=>{f.push(a)}),g&&a.advanced_settings&&a.advanced_settings.groups&&a.advanced_settings.groups.length&&a.advanced_settings.groups.forEach(a=>{a.variables?.forEach(a=>{f.push(a)})}),h=d(f),i={},j=[],h.forEach(a=>{a&&(i[a.variable]||(i[a.variable]=!0,j.push({...a,required:!1})))}),[{inputs:j,values:l,onChange:k}]),getDependentVars:()=>{if(a.advanced_settings?.group_enabled){let b=[];return a.advanced_settings.groups.forEach(a=>{a.variables&&b.push([...a.variables])}),b}return[a.variables]}}},[aC.BlockEnum.Assigner]:({id:a,payload:b,runInputData:c,setRunInputData:d,varSelectorsToVarInputs:e})=>{let{inputs:f}=eA(a,b),g=(f.items??[]).filter(a=>a.operation!==b3.clear&&a.operation!==b3.set&&a.operation!==b3.removeFirst&&a.operation!==b3.removeLast&&!b5.includes(a.operation)).map(a=>a.value);return{forms:(0,K.useMemo)(()=>[{inputs:e(g),values:c,onChange:d}],[c,d,e,g]),getDependentVars:()=>g}},[aC.BlockEnum.KnowledgeBase]:({payload:a,runInputData:b,setRunInputData:c})=>{let{t:d}=(0,$.useTranslation)(),e=b.query,f=(0,K.useCallback)(a=>{c({...b,query:a})},[b,c]);return{forms:(0,K.useMemo)(()=>[{inputs:[{label:d("nodes.common.inputVars",{ns:"workflow"}),variable:"query",type:aC.InputVarType.paragraph,required:!0}],values:{query:e},onChange:a=>f(a.query)}],[e,f,d]),getDependentVars:()=>[a.index_chunk_variable_selector],getDependentVar:b=>{if("query"===b)return a.index_chunk_variable_selector}}},[aC.BlockEnum.VariableAssigner]:void 0,[aC.BlockEnum.End]:void 0,[aC.BlockEnum.Answer]:void 0,[aC.BlockEnum.ListFilter]:void 0,[aC.BlockEnum.IterationStart]:void 0,[aC.BlockEnum.LoopStart]:void 0,[aC.BlockEnum.LoopEnd]:void 0,[aC.BlockEnum.DataSource]:void 0,[aC.BlockEnum.DataSourceEmpty]:void 0,[aC.BlockEnum.TriggerWebhook]:void 0,[aC.BlockEnum.TriggerSchedule]:void 0,[aC.BlockEnum.TriggerPlugin]:void 0},eV={[aC.BlockEnum.Tool]:({id:a,payload:b})=>{let{getMoreDataForCheckValid:c}=eP(a,b);return{getData:c}},[aC.BlockEnum.LLM]:void 0,[aC.BlockEnum.KnowledgeRetrieval]:void 0,[aC.BlockEnum.Code]:void 0,[aC.BlockEnum.TemplateTransform]:void 0,[aC.BlockEnum.QuestionClassifier]:void 0,[aC.BlockEnum.HttpRequest]:void 0,[aC.BlockEnum.ParameterExtractor]:void 0,[aC.BlockEnum.Iteration]:void 0,[aC.BlockEnum.Agent]:void 0,[aC.BlockEnum.DocExtractor]:void 0,[aC.BlockEnum.Loop]:void 0,[aC.BlockEnum.Start]:void 0,[aC.BlockEnum.IfElse]:void 0,[aC.BlockEnum.VariableAggregator]:void 0,[aC.BlockEnum.End]:void 0,[aC.BlockEnum.Answer]:void 0,[aC.BlockEnum.VariableAssigner]:void 0,[aC.BlockEnum.ListFilter]:void 0,[aC.BlockEnum.IterationStart]:void 0,[aC.BlockEnum.Assigner]:void 0,[aC.BlockEnum.LoopStart]:void 0,[aC.BlockEnum.LoopEnd]:void 0,[aC.BlockEnum.DataSource]:void 0,[aC.BlockEnum.DataSourceEmpty]:void 0,[aC.BlockEnum.KnowledgeBase]:void 0,[aC.BlockEnum.TriggerWebhook]:void 0,[aC.BlockEnum.TriggerSchedule]:void 0,[aC.BlockEnum.TriggerPlugin]:({payload:a})=>{let{data:b}=(0,aT.useAllTriggerPlugins)(),c=(0,bk.useGetLanguage)();return{getData:(0,K.useCallback)(()=>(0,eQ.getTriggerCheckParams)(a,b,c),[a,b,c])}}};var eW=a.i(380546),eX=a.i(735127),eY=a.i(445487);let eZ=({subscriptionIdSelected:a,onSubscriptionChange:b,children:c})=>{let{subscriptions:d}=(0,eY.useSubscriptionList)(),e=d?.length||0;return(0,F.jsxs)("div",{className:(0,S.cn)("px-4",e>0&&"flex items-center justify-between pr-3"),children:[!e&&(0,F.jsx)(eW.CreateSubscriptionButton,{buttonType:eW.CreateButtonType.FULL_BUTTON}),c,e>0&&(0,F.jsx)(eX.SubscriptionSelectorEntry,{selectedId:a,onSelect:b})]})},e$=(0,K.memo)(({id:a,data:b,children:c})=>{let{t:d}=(0,$.useTranslation)(),e=(0,ae.useLanguage)(),{showMessageLogModal:f}=(0,aa.useStore)((0,_.useShallow)(a=>({showMessageLogModal:a.showMessageLogModal}))),g=b._singleRunningStatus===aC.NodeRunningStatus.Running,h=(0,aP.useStore)(a=>a.showSingleRunPanel),i=(0,aP.useStore)(a=>a.workflowCanvasWidth),j=(0,aP.useStore)(a=>a.nodePanelWidth),k=(0,aP.useStore)(a=>a.otherPanelWidth),l=(0,aP.useStore)(a=>a.setNodePanelWidth),m=(0,aP.useStore)(a=>a.pendingSingleRun),n=(0,aP.useStore)(a=>a.setPendingSingleRun),o=(0,K.useMemo)(()=>i?Math.max(i-(k||0)-400,400):720,[i,k]),p=(0,K.useCallback)((a,b="user")=>{let c=Math.max(400,Math.min(a,o));"user"===b&&localStorage.setItem("workflow-node-panel-width",`${c}`),l(c)},[o,l]),q=(0,K.useCallback)(a=>{p(a,"user")},[p]),{triggerRef:r,containerRef:s}=aV({direction:"horizontal",triggerDirection:"left",minWidth:400,maxWidth:o,onResize:(0,Z.debounce)(q)}),t=(0,Z.debounce)(a=>{p(a,"system")});(0,K.useEffect)(()=>{!i||j+k+400>i&&t(Math.max(i-k-400,400))},[j,k,i,t]);let{handleNodeSelect:u}=(0,V.useNodesInteractions)(),{nodesReadOnly:v}=(0,aq.useNodesReadOnly)(),{availableNextBlocks:w}=(0,an.useAvailableBlocks)(b.type,b.isInIteration||b.isInLoop),x=(0,ar.useToolIcon)(b),{saveStateToHistory:y}=(0,X.useWorkflowHistory)(),{handleNodeDataUpdate:z,handleNodeDataUpdateWithSyncDraft:A}=(0,ao.useNodeDataUpdate)(),B=(0,K.useCallback)(b=>{A({id:a,data:{title:b}}),y(X.WorkflowHistoryEvent.NodeTitleChange,{nodeId:a})},[A,a,y]),C=(0,K.useCallback)(b=>{A({id:a,data:{desc:b}}),y(X.WorkflowHistoryEvent.NodeDescriptionChange,{nodeId:a})},[A,a,y]),D=!!(b.isInIteration||b.isInLoop),E=(0,aQ.canRunBySingle)(b.type,D),G=(0,aa.useStore)(a=>a.appDetail),H=(0,K.useRef)(!1),[J,L]=(0,K.useState)(!1);(0,K.useEffect)(()=>{b._singleRunningStatus===aC.NodeRunningStatus.Running?(H.current=!0,L(!1)):b._isSingleRun&&void 0===b._singleRunningStatus&&H&&(L(!0),H.current=!1)},[b]);let M=(0,K.useCallback)(c=>{z({id:a,data:{...b,_singleRunningStatus:c}})},[z,a,b]);(0,K.useEffect)(()=>{H.current=!1},[a]);let{nodesMap:T}=(0,ap.useNodesMetaData)(),U=(0,as.useHooksStore)(a=>a.configsMap),{isShowSingleRun:av,hideSingleRun:aw,runningStatus:ax,runInputData:ay,runInputDataRef:az,runResult:aA,setRunResult:aB,getInputVars:aD,toVarInputs:aE,tabType:aG,isRunAfterSingleRun:aI,setIsRunAfterSingleRun:aK,setTabType:aW,handleAfterCustomSingleRun:aY,singleRunParams:aZ,nodeInfo:a$,setRunInputData:a_,handleStop:a0,handleSingleRun:a1,handleRunWithParams:a2,getExistVarValuesInForms:a4,getFilteredExistVarForms:a5}=(({...a})=>{let{conversationVars:b,systemVars:c,hasSetInspectVar:d}=(0,at.default)(),e=a.data.type,f=e===aC.BlockEnum.Start,g=e===aC.BlockEnum.Iteration,h=e===aC.BlockEnum.Loop,i=e===aC.BlockEnum.VariableAggregator,j=(0,aQ.isSupportCustomRunForm)(e),{handleSyncWorkflowDraft:k}=(0,W.useNodesSyncDraft)(),{getData:l}=((a,b)=>eV[e]?.({id:a,payload:b})||{getData:()=>({})})(a.id,a.data),[m,n]=(0,K.useState)(!1),{id:o,flowId:p,flowType:q,data:r}=a,s=(({id:a,flowId:b,flowType:c,data:d,defaultRunInputData:e,moreDataForCheckValid:f,iteratorInputKey:g,loopInputKey:h,isRunAfterSingleRun:i,isPaused:j})=>{let{t:k}=(0,$.useTranslation)(),{getBeforeNodesInSameBranch:l,getBeforeNodesInSameBranchIncludeParent:m}=(0,aq.useWorkflow)(),n=(0,aP.useStore)(a=>a.conversationVariables),o=(0,aq.useIsChatMode)(),p=d.type===aC.BlockEnum.Iteration,q=d.type===aC.BlockEnum.Loop,r=d.type===aC.BlockEnum.Start,s=l(a),t=m(a),u=(0,aP.useWorkflowStore)(),{schemaTypeDefinitions:v}=(0,bX.default)(),{data:w}=(0,Q.useAllBuiltInTools)(),{data:x}=(0,Q.useAllCustomTools)(),{data:y}=(0,Q.useAllWorkflowTools)(),{data:z}=(0,Q.useAllMCPTools)(),A=ey[d.type],[B,C]=(0,K.useState)(e||{}),D=(0,K.useRef)(B),E=(0,K.useCallback)(a=>{D.current=a,C(a)},[]),F=g?B[g]?.length:0,G=h?B[h]?.length:0,H=(0,N.useStoreApi)(),{setShowSingleRunPanel:J,setIsListening:L,setListeningTriggerType:M,setListeningTriggerNodeId:O,setListeningTriggerNodeIds:S,setListeningTriggerIsAll:T,setShowVariableInspectPanel:U}=u.getState(),V=(0,K.useCallback)((a,b)=>{let{nodesWithInspectVars:c,setNodesWithInspectVars:d}=u.getState(),e=!1,f=(0,I.produce)(c,c=>{let d=c.findIndex(b=>b.nodeId===a);if(-1!==d){let a=c[d];a.isSingRunRunning!==b&&(a.isSingRunRunning=b,b&&(a.isValueFetched=!1),e=!0)}else if(b){let{getNodes:b}=H.getState(),d=b().find(b=>b.id===a);d&&(c.unshift({nodeId:a,nodeType:d.data.type,title:d.data.title,vars:[],nodePayload:d.data,isSingRunRunning:!0,isValueFetched:!1}),e=!0)}});e&&d(f)},[u,H]),W=(0,aH.useInvalidLastRun)(c,b,a),[X,Y]=(0,K.useState)(null),{appendNodeInspectVars:Z,invalidateSysVarValues:_,invalidateConversationVarValues:aa}=(0,at.default)(),ab=d._singleRunningStatus||aC.NodeRunningStatus.NotStart,ac=(0,K.useRef)(!1),ad=(0,K.useRef)(null),ae=(0,K.useRef)(void 0),af=(0,K.useRef)(0),ag=(0,K.useRef)(null),ah=(0,K.useRef)(!1),ai=(0,K.useRef)(null),aj=(0,K.useRef)(void 0),ak=(0,K.useRef)(0),al=(0,K.useRef)(null),am=(0,K.useRef)(j);(0,K.useEffect)(()=>{am.current=j},[j]);let{eventEmitter:an}=(0,P.useEventEmitterContextContext)(),ap=d.type===aC.BlockEnum.TriggerSchedule,ar=d.type===aC.BlockEnum.TriggerWebhook,as=d.type===aC.BlockEnum.TriggerPlugin,au=ar||as||ap,av=(0,K.useCallback)(async d=>{if(am.current)return;if(!(!i||ab===aC.NodeRunningStatus.Succeeded))return void Y(d);let e=await (0,R.fetchNodeInspectVars)(c,b,a),{getNodes:f}=H.getState();Z(a,e,f()),V(a,!1),d?.status===aC.NodeRunningStatus.Succeeded&&(W(),(r||au)&&_(),aa())},[i,ab,b,a,H,Z,V,W,r,au,_,aa]),{handleNodeDataUpdate:aw}=(0,ao.useNodeDataUpdate)(),ax=(0,K.useCallback)(()=>{ac.current=!1,af.current+=1,ad.current&&ad.current.abort(),ad.current=null,void 0!==ae.current&&(window.clearTimeout(ae.current),ae.current=void 0),ag.current&&(ag.current(),ag.current=null)},[]),ay=(0,K.useCallback)(()=>{ah.current=!1,ak.current+=1,ai.current&&ai.current.abort(),ai.current=null,void 0!==aj.current&&(window.clearTimeout(aj.current),aj.current=void 0),al.current&&(al.current(),al.current=null)},[]),az=(0,K.useCallback)(()=>{au&&(L(!0),U(!0),M(d.type),O(a),S([a]),T(!1))},[au,L,U,M,d.type,O,a,S,T]),aA=(0,K.useCallback)(()=>{au&&(L(!1),M(null),O(null),S([]),T(!1))},[au,L,M,O,S,T]),aB=(0,K.useCallback)(async()=>{let c=`/apps/${b}/workflows/draft/nodes/${a}/trigger/run`;try{let b=await (0,dB.post)(c,{body:JSON.stringify({})});if(!b){let a="Schedule trigger run failed";throw aX.default.notify({type:"error",message:a}),Error(a)}if(b?.status==="error"){let a=b?.message||"Schedule trigger run failed";throw aX.default.notify({type:"error",message:a}),Error(a)}return aw({id:a,data:{...d,_isSingleRun:!1,_singleRunningStatus:aC.NodeRunningStatus.Succeeded}}),b}catch(b){throw console.error("handleRun: schedule trigger single run error",b),aw({id:a,data:{...d,_isSingleRun:!1,_singleRunningStatus:aC.NodeRunningStatus.Failed}}),aX.default.notify({type:"error",message:"Schedule trigger run failed"}),b}},[b,a,aw,d]),aD=(0,K.useCallback)(async()=>{let c=`/apps/${b}/workflows/draft/nodes/${a}/trigger/run`;ac.current=!0;let e=++af.current;for(;ac.current&&e===af.current;){let b=new AbortController;ad.current=b;try{let f=await (0,dB.post)(c,{body:JSON.stringify({}),signal:b.signal});if(!ac.current||e!==af.current)return null;if(!f){let a=f?.message||"Webhook debug failed";throw aX.default.notify({type:"error",message:a}),ax(),Error(a)}if(f?.status==="waiting"){let a=Number(f.retry_in)||2e3;if(ad.current=null,!ac.current||e!==af.current)return null;await new Promise(c=>{let d=window.setTimeout(c,a);ae.current=d,ag.current=c,b.signal.addEventListener("abort",()=>{window.clearTimeout(d),c()},{once:!0})}),ae.current=void 0,ag.current=null;continue}if(f?.status==="error"){let a=f.message||"Webhook debug failed";throw aX.default.notify({type:"error",message:a}),ax(),Error(a)}return aw({id:a,data:{...d,_isSingleRun:!1,_singleRunningStatus:aC.NodeRunningStatus.Listening}}),ax(),f}catch(a){if(b.signal.aborted&&(!ac.current||e!==af.current)||b.signal.aborted)return null;if(aX.default.notify({type:"error",message:"Webhook debug request failed"}),ax(),a instanceof Error)throw a;throw Error(String(a))}finally{ad.current=null}}return null},[b,a,d,aw,ax]),aE=(0,K.useCallback)(async()=>{let c=`/apps/${b}/workflows/draft/nodes/${a}/trigger/run`;ah.current=!0;let e=++ak.current;for(;ah.current&&e===ak.current;){let b,f=new AbortController;ai.current=f;let g=await (0,dB.post)(c,{body:JSON.stringify({}),signal:f.signal}).catch(async a=>{let{error:c,status:d}=await a.clone().json()||{};return b={message:c,status:d},null}).finally(()=>{ai.current=null});if(!ah.current||e!==ak.current)break;if(b){if(f.signal.aborted)return null;throw aX.default.notify({type:"error",message:b.message}),ay(),b}if(!g){let a="Plugin debug failed";throw aX.default.notify({type:"error",message:a}),ay(),Error(a)}if(g?.status==="waiting"){let a=Number(g.retry_in)||2e3;if(!ah.current||e!==ak.current)return null;await new Promise(b=>{let c=window.setTimeout(b,a);aj.current=c,al.current=b,f.signal.addEventListener("abort",()=>{window.clearTimeout(c),b()},{once:!0})}),aj.current=void 0,al.current=null;continue}if(g?.status==="error"){let a=g.message||"Plugin debug failed";throw aX.default.notify({type:"error",message:a}),ay(),Error(a)}return aw({id:a,data:{...d,_isSingleRun:!1,_singleRunningStatus:aC.NodeRunningStatus.Listening}}),ay(),g}return null},[b,a,d,aw,ay]),aF=()=>{if(!A)return{isValid:!0,errorMessage:""};let b=A(d,k,f);return b.isValid||(aw({id:a,data:{...d,_isSingleRun:!1}}),aX.default.notify({type:"error",message:b.errorMessage||""})),b},[aG,aI]=(0,K.useState)(!1),aJ=d._isSingleRun&&aG,[aK,aL]=(0,K.useState)([]),[aM,aN]=(0,K.useState)([]);(0,K.useEffect)(()=>{if(!A)return void aI(!0);if(d._isSingleRun){let{isValid:a}=aF();aI(a)}},[d._isSingleRun]),(0,K.useEffect)(()=>{J(!!aJ)},[aJ,J]);let aO=ab===aC.NodeRunningStatus.Succeeded||ab===aC.NodeRunningStatus.Failed,aQ=async e=>{let f;ar&&ax(),as&&ay(),V(a,!0),au?az():aA(),aw({id:a,data:{...d,_isSingleRun:!1,_singleRunningStatus:au?aC.NodeRunningStatus.Listening:aC.NodeRunningStatus.Running}});let g=!1;try{if(p||q){if(p){aL([]);let f=[],g=null;(0,dB.ssePost)((0,R.getIterationSingleNodeRunUrl)(c,o,b,a),{body:{inputs:e}},{onWorkflowStarted:ds.noop,onWorkflowFinished:b=>{if(am.current)return;aw({id:a,data:{...d,_isSingleRun:!1,_singleRunningStatus:aC.NodeRunningStatus.Succeeded}});let{data:c}=b;g.created_by=c.created_by.name,av(g)},onIterationStart:a=>{let b=(0,I.produce)(f,b=>{b.push({...a.data,status:aC.NodeRunningStatus.Running})});f=b,aL(b)},onIterationNext:()=>{if(f.length>=F)return f.length>=F},onIterationFinish:a=>{g=a.data,av(g);let b=f,c=b.findIndex(b=>b.id===a.data.id),e=(0,I.produce)(b,a=>{c>-1&&(a[c]={...a[c],...d})});f=e,aL(e)},onNodeStarted:a=>{let b=(0,I.produce)(f,b=>{b.push({...a.data,status:aC.NodeRunningStatus.Running})});f=b,aL(b)},onNodeFinished:a=>{let b=f,{data:c}=a,d=b.findIndex(a=>a.id===c.id),e=(0,I.produce)(b,a=>{d>-1&&(a[d]={...a[d],...c})});f=e,aL(e)},onNodeRetry:a=>{let b=(0,I.produce)(f,b=>{b.push(a.data)});f=b,aL(b)},onError:()=>{am.current||aw({id:a,data:{...d,_isSingleRun:!1,_singleRunningStatus:aC.NodeRunningStatus.Failed}})}})}else if(q){aN([]);let g=[],h=null;(0,dB.ssePost)((0,R.getLoopSingleNodeRunUrl)(c,o,b,a),{body:{inputs:e}},{onWorkflowStarted:ds.noop,onWorkflowFinished:b=>{if(am.current)return;aw({id:a,data:{...d,_isSingleRun:!1,_singleRunningStatus:aC.NodeRunningStatus.Succeeded}});let{data:c}=b;h.created_by=c.created_by.name,av(h)},onLoopStart:a=>{let b=(0,I.produce)(g,b=>{b.push({...a.data,status:aC.NodeRunningStatus.Running})});g=b,aN(b)},onLoopNext:()=>{if(g.length>=G)return g.length>=G},onLoopFinish:a=>{h=a.data,av(h);let b=g,c=b.findIndex(b=>b.id===a.data.id),e=(0,I.produce)(b,a=>{c>-1&&(a[c]={...a[c],...d})});g=e,aN(e)},onNodeStarted:a=>{let b=(0,I.produce)(g,b=>{b.push({...a.data,status:aC.NodeRunningStatus.Running})});g=b,aN(b)},onNodeFinished:a=>{let b=g,{data:c}=a,d=b.findIndex(a=>a.id===c.id),e=(0,I.produce)(b,a=>{d>-1&&(a[d]={...a[d],...c})});g=e,aN(e)},onNodeRetry:a=>{let b=(0,I.produce)(g,b=>{b.push(a.data)});g=b,aN(b)},onError:()=>{am.current||(aw({id:a,data:{...d,_isSingleRun:!1,_singleRunningStatus:aC.NodeRunningStatus.Failed}}),(0,dv.trackEvent)("workflow_run_failed",{workflow_id:b,node_id:a,reason:f.error,node_type:d?.type}))}})}}else if(ap)f=await aB();else if(ar){if(!(f=await aD()))return ac.current&&aw({id:a,data:{...d,_isSingleRun:!1,_singleRunningStatus:aC.NodeRunningStatus.Stopped}}),!1}else if(as){if(!(f=await aE()))return ah.current&&aw({id:a,data:{...d,_isSingleRun:!1,_singleRunningStatus:aC.NodeRunningStatus.Stopped}}),!1}else{let g=d.type===aC.BlockEnum.Start,h={};if(g){let{"#sys.query#":a,"#sys.files#":b,...c}=e;o&&(h.conversation_id=""),h.inputs=c,h.query=a,h.files=b||[]}else h.inputs=e;f=await (0,R.singleNodeRun)(c,b,a,h)}if(f&&f.error)throw Error(f.error)}catch(b){if(console.error(b),g=!0,W(),!p&&!q){if(am.current)return;return aw({id:a,data:{...d,_isSingleRun:!1,_singleRunningStatus:aC.NodeRunningStatus.Failed}}),!1}}finally{ar&&ax(),as&&ay(),au&&aA(),p||q||V(a,!1),am.current||p||q||!f||av({...f,total_tokens:f.execution_metadata?.total_tokens||0,created_by:f.created_by_account?.name||""})}if(!am.current&&!p&&!q&&!g){if(am.current)return;aw({id:a,data:{...d,_isSingleRun:!1,_singleRunningStatus:aC.NodeRunningStatus.Succeeded}})}},aR=(0,K.useCallback)(()=>{if(au){if(!(ab===aC.NodeRunningStatus.Listening||ac.current||ah.current))return}else if(ab!==aC.NodeRunningStatus.Running)return;ax(),ay(),aw({id:a,data:{_isSingleRun:!1,_singleRunningStatus:aC.NodeRunningStatus.Stopped}}),aA(),V(a,!1);let{workflowRunningData:b,setWorkflowRunningData:c,nodesWithInspectVars:d,deleteNodeInspectVars:e}=u.getState();b&&c((0,I.produce)(b,a=>{a.result.status=aC.WorkflowRunningStatus.Stopped}));let f=d.find(b=>b.nodeId===a);!f||f.isValueFetched||f.vars&&0!==f.vars.length||e(a)},[au,ab,ax,ay,aw,a,aA,V,u]),aS=a=>a?a.filter(a=>!(0,bY.isENV)(a.value_selector)).map(a=>{let b=(a=>{let b="sys"===a[0],{dataSourceList:c}=u.getState(),d=(0,bY.toNodeOutputVars)(s,o,void 0,void 0,n,[],{buildInTools:w||[],customTools:x||[],workflowTools:y||[],mcpTools:z||[],dataSourceList:c||[]},v).find(c=>b?!!c.isStartNode:c.nodeId===a[0]);if(!d)return;if(b)return d.vars.find(b=>b.variable.split(".")[1]===a[1]);let e=d.vars;for(let b=1;b<a.length;b++){let c=a[b],d=b===a.length-1;if(Array.isArray(e)&&(e=e.find(a=>a.variable.replace("conversation.","")===c)),d)return e;(e?.type===aC.VarType.object||e?.type===aC.VarType.file)&&(e=e.children)}})(a.value_selector);return b?{label:("object"==typeof a.label?a.label.variable:a.label)||a.variable,variable:a.variable,type:((a,{isSelect:b,isParagraph:c})=>b?aC.InputVarType.select:c?aC.InputVarType.paragraph:a===aC.VarType.number?aC.InputVarType.number:a===aC.VarType.boolean?aC.InputVarType.checkbox:[aC.VarType.object,aC.VarType.array,aC.VarType.arrayNumber,aC.VarType.arrayString,aC.VarType.arrayObject].includes(a)?aC.InputVarType.json:a===aC.VarType.file?aC.InputVarType.singleFile:a===aC.VarType.arrayFile?aC.InputVarType.multiFiles:aC.InputVarType.textInput)(b.type,{isSelect:!!b.isSelect,isParagraph:!!b.isParagraph}),required:!1!==a.required,options:b.options}:{label:a.label||a.variable,variable:a.variable,type:aC.InputVarType.textInput,required:!0,value_selector:a.value_selector}}):[],aT=a=>{let b=[];return a.forEach(a=>{b.push(...(0,a3.getInputVars)(a))}),aS((0,ef.unionBy)(b,a=>a.join(".")).map(a=>{let b=(0,bY.getNodeInfoById)(t,a[0])?.data;return{label:{nodeType:b?.type,nodeName:b?.title||t[0]?.data.title,variable:(0,bY.isSystemVar)(a)?a.join("."):a[a.length-1],isChatVar:(0,bY.isConversationVar)(a)},variable:`#${a.join(".")}#`,value_selector:a}}))};return an?.useSubscription(a=>{a.type===eg&&aR()}),{isShowSingleRun:aJ,hideSingleRun:()=>{aw({id:a,data:{...d,_isSingleRun:!1}})},showSingleRun:()=>{aw({id:a,data:{...d,_isSingleRun:!0}})},toVarInputs:aS,varSelectorsToVarInputs:a=>a.filter(a=>!!a).map(a=>aT([`{{#${"string"==typeof a?a:a.join(".")}#}}`])[0]),getInputVars:aT,runningStatus:ab,isCompleted:aO,handleRun:aQ,handleStop:aR,runInputData:B,runInputDataRef:D,setRunInputData:E,runResult:X,setRunResult:Y,iterationRunResult:aK,loopRunResult:aM,setNodeRunning:()=>{aw({id:a,data:{...d,_singleRunningStatus:aC.NodeRunningStatus.Running}})},checkValid:aF}})({...a,iteratorInputKey:e===aC.BlockEnum.Iteration?`${o}.input_selector`:"",moreDataForCheckValid:l(),isRunAfterSingleRun:m}),{warningNodes:t}=(0,ee.useWorkflowRunValidation)(),u=(0,K.useCallback)(()=>{let a=t.find(a=>a.id===o);if(!a)return!1;let b=a.errorMessage||"This node has unresolved checklist issues";return aX.default.notify({type:"error",message:b}),!0},[t,o]),{hideSingleRun:v,handleRun:w,getInputVars:x,toVarInputs:y,varSelectorsToVarInputs:z,runInputData:A,runInputDataRef:B,setRunInputData:C,showSingleRun:D,runResult:E,iterationRunResult:F,loopRunResult:G,setNodeRunning:H,checkValid:J}=s,{...L}=(a=>eU[e]?.(a)||{})({id:o,payload:r,runInputData:A,runInputDataRef:B,getInputVars:x,setRunInputData:C,toVarInputs:y,varSelectorsToVarInputs:z,runResult:E,iterationRunResult:F,loopRunResult:G}),M=(0,K.useCallback)(a=>{if(!g&&!h)return a;let b=L?.allVarObject||{},c={};if(Object.keys(b).forEach(d=>{let[e,f]=d.split(O.VALUE_SELECTOR_DELIMITER);c[`${f}.${b[d].inSingleRunPassedKey}`]=a[e]}),g){let b=`${o}.input_selector`;c[b]=a[b]}return c},[g,h,L?.allVarObject,o]),S=(a,b)=>{k(!0,!0,{onSuccess(){w(M(a)),b?.()}})},{setInitShowLastRunTab:T,setShowVariableInspectPanel:U}=(0,aP.useWorkflowStore)().getState(),V=(0,aP.useStore)(a=>a.initShowLastRunTab),[X,Y]=(0,K.useState)(V?eS.lastRun:eS.settings);(0,K.useEffect)(()=>{V&&Y(eS.lastRun),T(!1)},[V]);let Z=(0,aH.useInvalidLastRun)(q,p,o),_=async a=>{if(u())return;let{isValid:b}=J();b&&(H(),n(!0),Y(eS.lastRun),S(a,()=>{Z()}),v())},aa=(0,K.useCallback)(a=>{n(!1),Y(a)},[]),ab=a=>a&&0!==a.length?a.map(a=>{let e={};return a.inputs.forEach(({variable:a,getVarValueFromDependent:g})=>{let h=g||!a.includes(".");if(h&&!L?.getDependentVar)return;let i=h?L?.getDependentVar(a)||[]:a.slice(1,-1).split(".");if(!i||0===i.length)return;let[j,k]=i.slice(0,2);if(!f&&j===o){e[a]=!0;return}d(j,k,c,b)&&(e[a]=!0)}),e}):[];return{...s,tabType:X,isRunAfterSingleRun:m,setIsRunAfterSingleRun:n,setTabType:aa,handleAfterCustomSingleRun:()=>{Z(),Y(eS.lastRun),v()},singleRunParams:L,nodeInfo:E,setRunInputData:C,handleSingleRun:()=>{if(u())return;let{isValid:a}=J();if(!a)return;if((e===aC.BlockEnum.TriggerWebhook||e===aC.BlockEnum.TriggerPlugin||e===aC.BlockEnum.TriggerSchedule)&&U(!0),j)return void D();let f=L?.getDependentVars?.();(i?!f||0===f.length||f.every(a=>!a||0===a.length||a.some(a=>{let[e,f]=a.slice(0,2);return d(e,f,c,b)})):!f||0===f.length||f.every(a=>{let[e,f]=a.slice(0,2);return d(e,f,c,b)}))?S({},async()=>{n(!0),H(),Z(),Y(eS.lastRun)}):D()},handleRunWithParams:_,getExistVarValuesInForms:ab,getFilteredExistVarForms:a=>{if(!a||0===a.length)return[];let b=ab(a);return a.map((a,c)=>{let d=b[c],e={...a};return e.inputs=a.inputs.filter(a=>!(a.variable in d)),e}).filter(a=>a.inputs.length>0)}}})({id:a,flowId:U?.flowId||"",flowType:U?.flowType||aJ.FlowType.appFlow,data:b,defaultRunInputData:T?.[b.type]?.defaultRunInputData||{},isPaused:J});(0,K.useEffect)(()=>{L(!1)},[aG]),(0,K.useEffect)(()=>{m&&m.nodeId===a&&("run"===m.action?a1():a0(),n(void 0))},[m,a,a1,a0,n]);let a6=(0,aN.useLogs)(),a7=(0,K.useMemo)(()=>[aC.BlockEnum.Tool,aC.BlockEnum.Agent,aC.BlockEnum.Iteration,aC.BlockEnum.Loop].includes(b.type)?a6:{},[b.type,a6]),a8=(0,aP.useStore)(a=>a.buildInTools),{data:a9}=(0,Q.useAllBuiltInTools)(),ba=(0,K.useMemo)(()=>{let a=a9??a8;return a?.find(a=>(0,aU.canFindTool)(a.id,b.provider_id))},[a9,a8,b.provider_id]),bb=(0,K.useMemo)(()=>b.type===aC.BlockEnum.Tool&&ba?.allow_delete,[b.type,ba?.allow_delete]),{data:bc=[]}=(0,aT.useAllTriggerPlugins)(b.type===aC.BlockEnum.TriggerPlugin),bd=(0,K.useMemo)(()=>{if(b.type===aC.BlockEnum.TriggerPlugin&&b.plugin_id&&bc?.length)return bc?.find(a=>a.plugin_id===b.plugin_id)},[b.type,b.plugin_id,bc]),{setDetail:bf}=(0,ak.usePluginStore)();(0,K.useEffect)(()=>{bd&&bf({name:bd.label[e],plugin_id:bd.plugin_id||"",plugin_unique_identifier:bd.plugin_unique_identifier||"",id:bd.id,provider:bd.name,declaration:{trigger:{subscription_schema:bd.subscription_schema||[],subscription_constructor:bd.subscription_constructor}}})},[bd,e,bf]);let bg=(0,aP.useStore)(a=>a.dataSourceList),bh=(0,K.useMemo)(()=>{if(b.type===aC.BlockEnum.DataSource&&b.provider_type!==aM.DataSourceClassification.localFile)return bg?.find(a=>a.plugin_id===b.plugin_id)},[bg,b.provider_id,b.type,b.provider_type]),bi=(0,K.useCallback)(b=>{A({id:a,data:{credential_id:b}})},[A,a]),{setShowAccountSettingModal:bj}=(0,aS.useModalContext)(),bk=(0,K.useCallback)(()=>{bj({payload:ad.ACCOUNT_SETTING_TAB.DATA_SOURCE})},[bj]),{appendNodeInspectVars:bl}=(0,at.default)(),bm=(0,K.useCallback)((b,c)=>{A({id:a,data:{subscription_id:b.id}},{sync:!0,callback:{onSettled:c}})},[A,a]),bn=(0,K.useMemo)(()=>{let a;switch(b.type){case aC.BlockEnum.Tool:a=ba;break;case aC.BlockEnum.DataSource:a=bh;break;case aC.BlockEnum.TriggerPlugin:a=bd}return a?(0,F.jsx)(al.ReadmeEntrance,{pluginDetail:a,className:"mt-auto"}):null},[b.type,ba,bh,bd]),bo=(0,K.useMemo)(()=>({id:a,data:b}),[a,b]);if(a6.showSpecialResultPanel)return(0,F.jsx)("div",{className:(0,S.cn)("relative mr-1  h-full"),children:(0,F.jsx)("div",{ref:s,className:(0,S.cn)("flex h-full flex-col rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-lg",h?"overflow-hidden":"overflow-y-auto"),style:{width:`${j}px`},children:(0,F.jsx)(aF,{nodeName:b.title,onHide:aw,children:(0,F.jsx)("div",{className:"h-0 grow overflow-y-auto pb-4",children:(0,F.jsx)(aO.default,{...a7})})})})});if(av){var bq;let c,d=(c=(bq={nodeId:a,flowId:U?.flowId||"",flowType:U?.flowType||aJ.FlowType.appFlow,payload:b,setRunResult:aB,setIsRunAfterSingleRun:aK,isPaused:J,isRunAfterSingleRun:aI,onSuccess:aY,onCancel:aw,appendNodeInspectVars:bl}).payload.type)===aC.BlockEnum.DataSource?(0,F.jsx)(aL,{...bq}):(0,F.jsxs)("div",{children:["Custom Run Form:",c," ","not found"]});return(0,F.jsx)("div",{className:(0,S.cn)("relative mr-1  h-full"),children:(0,F.jsx)("div",{ref:s,className:(0,S.cn)("flex h-full flex-col rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-lg",h?"overflow-hidden":"overflow-y-auto"),style:{width:`${j}px`},children:(0,aQ.isSupportCustomRunForm)(b.type)?d:(0,F.jsx)(be,{nodeName:b.title,nodeType:b.type,onHide:aw,onRun:a2,...aZ,...a7,existVarValuesInForms:a4(aZ?.forms),filteredExistVarForms:a5(aZ?.forms)})})})}return(0,F.jsxs)("div",{className:(0,S.cn)("relative mr-1 h-full",f&&"absolute z-0 mr-2 w-[400px] overflow-hidden rounded-2xl border-[0.5px] border-components-panel-border shadow-lg transition-all"),style:{right:f?`${k}px`:"0"},children:[(0,F.jsx)("div",{ref:r,className:"absolute -left-1 top-0 flex h-full w-1 cursor-col-resize resize-x items-center justify-center",children:(0,F.jsx)("div",{className:"h-10 w-0.5 rounded-sm bg-state-base-handle hover:h-full hover:bg-state-accent-solid active:h-full active:bg-state-accent-solid"})}),(0,F.jsxs)("div",{ref:s,className:(0,S.cn)("flex h-full flex-col rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-lg transition-[width] ease-linear",h?"overflow-hidden":"overflow-y-auto"),style:{width:`${j}px`},children:[(0,F.jsxs)("div",{className:"sticky top-0 z-10 shrink-0 border-b-[0.5px] border-divider-regular bg-components-panel-bg",children:[(0,F.jsxs)("div",{className:"flex items-center px-4 pb-1 pt-4",children:[(0,F.jsx)(am.default,{className:"mr-1 shrink-0",type:b.type,toolIcon:x,size:"md"}),(0,F.jsx)(d8,{value:b.title||"",onBlur:B}),(0,F.jsxs)("div",{className:"flex shrink-0 items-center text-text-tertiary",children:[E&&!v&&(0,F.jsx)(ac.default,{popupContent:d("panel.runThisStep",{ns:"workflow"}),popupClassName:"mr-1",disabled:g,children:(0,F.jsx)("div",{className:"mr-1 flex h-6 w-6 cursor-pointer items-center justify-center rounded-md hover:bg-state-base-hover",onClick:()=>{g?a0():a1()},children:g?(0,F.jsx)(ab.default,{className:"h-4 w-4 text-text-tertiary"}):(0,F.jsx)(Y.RiPlayLargeLine,{className:"h-4 w-4 text-text-tertiary"})})}),(0,F.jsx)(br,{nodeType:b.type}),(0,F.jsx)(d2,{id:a,data:b,showHelpLink:!1}),(0,F.jsx)("div",{className:"mx-3 h-3.5 w-[1px] bg-divider-regular"}),(0,F.jsx)("div",{className:"flex h-6 w-6 cursor-pointer items-center justify-center",onClick:()=>u(a,!0),children:(0,F.jsx)(Y.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})})]})]}),(0,F.jsx)("div",{className:"p-2",children:(0,F.jsx)(d9,{value:b.desc||"",onChange:C})}),bb&&(0,F.jsx)(ai.PluginAuth,{className:"px-4 pb-2",pluginPayload:{provider:ba?.name||"",providerType:ba?.type||"",category:af.AuthCategory.tool,detail:ba},children:(0,F.jsxs)("div",{className:"flex items-center justify-between pl-4 pr-3",children:[(0,F.jsx)(eT,{value:aG,onChange:aW}),(0,F.jsx)(ah.default,{pluginPayload:{provider:ba?.name||"",providerType:ba?.type||"",category:af.AuthCategory.tool,detail:ba},onAuthorizationItemClick:bi,credentialId:b.credential_id})]})}),!!bh&&(0,F.jsx)(aj.default,{onJumpToDataSourcePage:bk,isAuthorized:bh.is_authorized,children:(0,F.jsxs)("div",{className:"flex items-center justify-between pl-4 pr-3",children:[(0,F.jsx)(eT,{value:aG,onChange:aW}),(0,F.jsx)(ag.default,{onJumpToDataSourcePage:bk,authorizationsNum:3})]})}),bd&&(0,F.jsx)(eZ,{subscriptionIdSelected:b.subscription_id,onSubscriptionChange:bm,children:(0,F.jsx)(eT,{value:aG,onChange:aW})}),!bb&&!bh&&!bd&&(0,F.jsx)("div",{className:"flex items-center justify-between pl-4 pr-3",children:(0,F.jsx)(eT,{value:aG,onChange:aW})}),(0,F.jsx)(au,{})]}),aG===eS.settings&&(0,F.jsxs)("div",{className:"flex flex-1 flex-col overflow-y-auto",children:[(0,F.jsx)("div",{children:(0,K.cloneElement)(c,{id:a,data:b,panelProps:{getInputVars:aD,toVarInputs:aE,runInputData:ay,setRunInputData:a_,runResult:aA,runInputDataRef:az}})}),(0,F.jsx)(au,{}),(0,aR.hasRetryNode)(b.type)&&(0,F.jsx)(d6,{id:a,data:b}),(0,aQ.hasErrorHandleNode)(b.type)&&(0,F.jsx)(bp,{id:a,data:b}),!!w.length&&(0,F.jsxs)("div",{className:"border-t-[0.5px] border-divider-regular p-4",children:[(0,F.jsx)("div",{className:"system-sm-semibold-uppercase mb-1 flex items-center text-text-secondary",children:d("panel.nextStep",{ns:"workflow"}).toLocaleUpperCase()}),(0,F.jsx)("div",{className:"system-xs-regular mb-2 text-text-tertiary",children:d("panel.addNextStep",{ns:"workflow"})}),(0,F.jsx)(d_,{selectedNode:bo})]}),bn]}),aG===eS.lastRun&&(0,F.jsx)(ed,{appId:G?.id||"",nodeId:a,canSingleRun:E,runningStatus:ax,isRunAfterSingleRun:aI,updateNodeRunningStatus:M,onSingleRunClicked:a1,nodeInfo:a$,singleRunResult:aA,isPaused:J,...a7})]})]})});var e_=a.i(37606),e0=a.i(622837),e1=a.i(875067);let e2="overview.appInfo.embedded",e3=({content:a})=>{let{t:b}=(0,$.useTranslation)(),[c,d]=(0,K.useState)(!1),e=(0,Z.debounce)(()=>{(0,e1.default)(a),d(!0)},100),f=(0,Z.debounce)(()=>{d(!1)},100);return(0,F.jsx)("div",{className:"inline-flex w-full pb-0.5",onClick:a=>a.stopPropagation(),onMouseLeave:f,children:(0,F.jsx)(ac.default,{popupContent:b(c?`${e2}.copied`:`${e2}.copy`,{ns:"appOverview"})||"",children:(0,F.jsxs)("div",{className:"group/copy flex w-full items-center gap-0.5 ",onClick:e,children:[(0,F.jsx)("div",{className:"system-2xs-regular w-0 grow cursor-pointer truncate text-text-quaternary group-hover:text-text-tertiary",children:a}),(0,F.jsx)(Y.RiFileCopyLine,{className:"h-3 w-3 shrink-0 text-text-tertiary opacity-0 group-hover/copy:opacity-100"})]})})})};var e4=a.i(617633),e5=a.i(35176),e6=a.i(20177);let e7=()=>{let a=(0,N.useStoreApi)(),b=(0,aP.useWorkflowStore)(),{handleNodeDataUpdate:c}=(0,ao.useNodeDataUpdate)(),d=(0,K.useCallback)((b,d,e,f)=>{let g,{getNodes:h}=a.getState(),i=h().find(a=>a.id===b);if(f&&"target"!==f)g={advanced_settings:{...i.data.advanced_settings,groups:i.data.advanced_settings?.groups.map(a=>a.groupId!==f||a.variables.some(a=>a.join(".")===d.join("."))?a:{...a,variables:[...a.variables,d],output_type:e.type})}};else{if(i.data.variables.some(a=>a.join(".")===d.join(".")))return;g={variables:[...i.data.variables,d],output_type:e.type}}c({id:b,data:g})},[a,c]),e=(0,K.useCallback)((c,e,f,g,h)=>{let{getNodes:i,setNodes:j}=a.getState(),{setShowAssignVariablePopup:k}=b.getState();j((0,I.produce)(i(),a=>{a.forEach(a=>{(a.id===c||a.id===e)&&(a.data={...a.data,_showAddVariablePopup:!1,_holdAddVariablePopup:!1})})})),k(void 0),d(e,g,h,f)},[a,b,d]);return{handleAddVariableInAddVariablePopupWithPosition:e,handleGroupItemMouseEnter:(0,K.useCallback)(a=>{let{setHoveringAssignVariableGroupId:c}=b.getState();c(a)},[b]),handleGroupItemMouseLeave:(0,K.useCallback)(()=>{let{connectingNodePayload:a,setHoveringAssignVariableGroupId:c}=b.getState();a&&c(void 0)},[b]),handleAssignVariableValueChange:d}},e8=()=>{let a=(0,N.useNodes)(),{getBeforeNodesInSameBranchIncludeParent:b}=(0,aq.useWorkflow)(),{getNodeAvailableVars:c}=(0,e5.useWorkflowVariables)(),d=(0,aq.useIsChatMode)();return(0,K.useCallback)((e,f,g,h=!1)=>{let i=[],j=a.find(a=>a.id===e);if(!j)return[];let k=b(e);i.push(...k);let l=a.find(a=>a.id===j.parentId);return h?c({parentNode:l,beforeNodes:(0,e6.uniqBy)(i,"id").filter(a=>a.id!==e),isChatMode:d,hideEnv:h,hideChatVar:!1,filterVar:g}).map(a=>({...a,vars:a.isStartNode?a.vars.filter(a=>!a.variable.startsWith("sys.")):a.vars})).filter(a=>a.vars.length>0):c({parentNode:l,beforeNodes:(0,e6.uniqBy)(i,"id").filter(a=>a.id!==e),isChatMode:d,filterVar:g})},[a,b,c,d])},e9=a=>b=>a===aC.VarType.any||b.type===aC.VarType.any||b.type===a;var fa=a.i(697638);let fb=(0,K.memo)(({availableVars:a,onSelect:b})=>{let{t:c}=(0,$.useTranslation)();return(0,F.jsxs)("div",{className:"w-[240px] rounded-lg border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-lg",children:[(0,F.jsx)("div",{className:"flex h-[34px] items-center border-b-[0.5px] border-b-divider-regular px-4 text-[13px] font-semibold text-text-secondary",children:c("nodes.variableAssigner.setAssignVariable",{ns:"workflow"})}),(0,F.jsx)("div",{className:"p-1",children:(0,F.jsx)(fa.default,{hideSearch:!0,vars:a,onChange:b,isSupportFileVar:!0})})]})}),fc=(0,K.memo)(({nodeId:a,nodeData:b})=>{let c=(0,K.useRef)(null),d=(0,aP.useStore)(a=>a.showAssignVariablePopup),e=(0,aP.useStore)(a=>a.setShowAssignVariablePopup),{handleNodeDataUpdate:f}=(0,ao.useNodeDataUpdate)(),{handleAddVariableInAddVariablePopupWithPosition:g}=e7(),h=(0,aq.useIsChatMode)(),{getBeforeNodesInSameBranch:i}=(0,aq.useWorkflow)(),{getNodeAvailableVars:j}=(0,e5.useWorkflowVariables)(),k=(0,K.useMemo)(()=>{if(!d)return"";if(!d.variableAssignerNodeData.advanced_settings?.group_enabled)return d.variableAssignerNodeData.output_type;let a=d.variableAssignerNodeData.advanced_settings?.groups.find(a=>a.groupId===d.variableAssignerNodeHandleId);return a?.output_type||""},[d]),l=(0,K.useMemo)(()=>d?j({parentNode:d.parentNode,beforeNodes:[...i(d.nodeId),{id:d.nodeId,data:d.nodeData}],hideEnv:!0,hideChatVar:!h,isChatMode:h,filterVar:e9(k)}).map(a=>({...a,vars:a.isStartNode?a.vars.filter(a=>!a.variable.startsWith("sys.")):a.vars})).filter(a=>a.vars.length>0):[],[d,j,i,h,k]);(0,e4.useClickAway)(()=>{b._holdAddVariablePopup?f({id:a,data:{_holdAddVariablePopup:!1}}):(f({id:a,data:{_showAddVariablePopup:!1}}),e(void 0))},c);let m=(0,K.useCallback)((a,b)=>{d&&g(d.nodeId,d.variableAssignerNodeId,d.variableAssignerNodeHandleId,a,b)},[d,g]);return d?(0,F.jsx)("div",{className:"absolute z-10",style:{left:d.x,top:d.y},ref:c,children:(0,F.jsx)(fb,{availableVars:l,onSelect:m})}):null});var fd=((u={}).Start="start",u.Trigger="trigger",u);let fe=({children:a,customLabel:b,nodeType:c="trigger"})=>{let{t:d}=(0,$.useTranslation)(),e=(0,K.useMemo)(()=>{let a="start"===c?"entryNodeStatus":"triggerStatus";return b||d(`${a}.enabled`,{ns:"workflow"})},[b,c,d]);return(0,F.jsxs)("div",{className:"w-fit min-w-[242px] rounded-2xl bg-workflow-block-wrapper-bg-1 px-0 pb-0 pt-0.5",children:[(0,F.jsx)("div",{className:"mb-0.5 flex items-center px-2.5 pt-0.5",children:(0,F.jsx)("span",{className:"text-2xs font-semibold uppercase text-text-tertiary",children:e})}),a]})},ff=(0,K.memo)(({id:a,data:b,handleId:c,handleClassName:d,nodeSelectorClassName:e})=>{let[f,g]=(0,K.useState)(!1),{handleNodeAdd:h}=(0,V.useNodesInteractions)(),{getNodesReadOnly:i}=(0,aq.useNodesReadOnly)(),j=b._connectedTargetHandleIds?.includes(c),{availablePrevBlocks:k}=(0,an.useAvailableBlocks)(b.type,b.isInIteration||b.isInLoop),l=!!k.length,m=(0,K.useCallback)(a=>{g(a)},[]),n=(0,K.useCallback)(a=>{a.stopPropagation(),j||g(a=>!a)},[j]),o=(0,K.useCallback)((b,d)=>{h({nodeType:b,pluginDefaultValue:d},{nextNodeId:a,nextNodeTargetHandle:c})},[h,a,c]);return(0,F.jsx)(F.Fragment,{children:(0,F.jsx)(N.Handle,{id:c,type:"target",position:N.Position.Left,className:(0,S.cn)("z-[1] !h-4 !w-4 !rounded-none !border-none !bg-transparent !outline-none","after:absolute after:left-1.5 after:top-1 after:h-2 after:w-0.5 after:bg-workflow-link-line-handle","transition-all hover:scale-125",b._runningStatus===aC.NodeRunningStatus.Succeeded&&"after:bg-workflow-link-line-success-handle",b._runningStatus===aC.NodeRunningStatus.Failed&&"after:bg-workflow-link-line-error-handle",b._runningStatus===aC.NodeRunningStatus.Exception&&"after:bg-workflow-link-line-failure-handle",!j&&"after:opacity-0",(b.type===aC.BlockEnum.Start||b.type===aC.BlockEnum.TriggerWebhook||b.type===aC.BlockEnum.TriggerSchedule||b.type===aC.BlockEnum.TriggerPlugin)&&"opacity-0",d),isConnectable:l,onClick:n,children:!j&&l&&!i()&&(0,F.jsx)(dT,{open:f,onOpenChange:m,onSelect:o,asChild:!0,placement:"left",triggerClassName:a=>`
                hidden absolute left-0 top-0 pointer-events-none
                ${e}
                group-hover:!flex
                ${b.selected&&"!flex"}
                ${a&&"!flex"}
              `,availableBlocksTypes:k})})})});ff.displayName="NodeTargetHandle";let fg=(0,K.memo)(({id:a,data:b,handleId:c,handleClassName:d,nodeSelectorClassName:e,showExceptionStatus:f})=>{let{t:g}=(0,$.useTranslation)(),h=(0,aP.useStore)(a=>a.shouldAutoOpenStartNodeSelector),i=(0,aP.useStore)(a=>a.setShouldAutoOpenStartNodeSelector),j=(0,aP.useStore)(a=>a.setHasSelectedStartNode),k=(0,aP.useWorkflowStore)(),[l,m]=(0,K.useState)(!1),{handleNodeAdd:n}=(0,V.useNodesInteractions)(),{getNodesReadOnly:o}=(0,aq.useNodesReadOnly)(),{availableNextBlocks:p}=(0,an.useAvailableBlocks)(b.type,b.isInIteration||b.isInLoop),q=!!p.length,r=(0,aq.useIsChatMode)(),s=b._connectedSourceHandleIds?.includes(c),t=(0,K.useCallback)(a=>{m(a)},[]),u=(0,K.useCallback)(a=>{a.stopPropagation(),m(a=>!a)},[]),v=(0,K.useCallback)((b,d)=>{n({nodeType:b,pluginDefaultValue:d},{prevNodeId:a,prevNodeSourceHandle:c})},[n,a,c]);return(0,K.useEffect)(()=>{if(h){if(r)return void i?.(!1);(b.type===aC.BlockEnum.Start||b.type===aC.BlockEnum.TriggerSchedule||b.type===aC.BlockEnum.TriggerWebhook||b.type===aC.BlockEnum.TriggerPlugin)&&(m(!0),i?i(!1):k?.setState?.({shouldAutoOpenStartNodeSelector:!1}),j?j(!1):k?.setState?.({hasSelectedStartNode:!1}))}},[h,b.type,r,i,j,k]),(0,F.jsxs)(N.Handle,{id:c,type:"source",position:N.Position.Right,className:(0,S.cn)("group/handle z-[1] !h-4 !w-4 !rounded-none !border-none !bg-transparent !outline-none","after:absolute after:right-1.5 after:top-1 after:h-2 after:w-0.5 after:bg-workflow-link-line-handle","transition-all hover:scale-125",b._runningStatus===aC.NodeRunningStatus.Succeeded&&"after:bg-workflow-link-line-success-handle",b._runningStatus===aC.NodeRunningStatus.Failed&&"after:bg-workflow-link-line-error-handle",f&&b._runningStatus===aC.NodeRunningStatus.Exception&&"after:bg-workflow-link-line-failure-handle",!s&&"after:opacity-0",d),isConnectable:q,onClick:u,children:[(0,F.jsx)("div",{className:"absolute -top-1 left-1/2 hidden -translate-x-1/2 -translate-y-full rounded-lg border-[0.5px] border-components-panel-border bg-components-tooltip-bg p-1.5 shadow-lg group-hover/handle:block",children:(0,F.jsxs)("div",{className:"system-xs-regular text-text-tertiary",children:[(0,F.jsxs)("div",{className:" whitespace-nowrap",children:[(0,F.jsx)("span",{className:"system-xs-medium text-text-secondary",children:g("common.parallelTip.click.title",{ns:"workflow"})}),g("common.parallelTip.click.desc",{ns:"workflow"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("span",{className:"system-xs-medium text-text-secondary",children:g("common.parallelTip.drag.title",{ns:"workflow"})}),g("common.parallelTip.drag.desc",{ns:"workflow"})]})]})}),q&&!o()&&(0,F.jsx)(dT,{open:l,onOpenChange:t,onSelect:v,asChild:!0,triggerClassName:a=>`
              hidden absolute top-0 left-0 pointer-events-none
              ${e}
              group-hover:!flex
              ${b.selected&&"!flex"}
              ${a&&"!flex"}
            `,availableBlocksTypes:p})]})});fg.displayName="NodeSourceHandle";let fh=({id:a,data:b})=>{let{t:c}=(0,$.useTranslation)(),{error_strategy:d}=b,e=(0,N.useUpdateNodeInternals)();return((0,K.useEffect)(()=>{d===bi.ErrorHandleTypeEnum.failBranch&&e(a)},[d,a,e]),d)?(0,F.jsx)("div",{className:"relative px-3 pb-2 pt-1",children:(0,F.jsxs)("div",{className:(0,S.cn)("relative flex h-6 items-center justify-between rounded-md bg-workflow-block-parma-bg px-[5px]",b._runningStatus===aC.NodeRunningStatus.Exception&&"border-[0.5px] border-components-badge-status-light-warning-halo bg-state-warning-hover"),children:[(0,F.jsx)("div",{className:"system-xs-medium-uppercase text-text-tertiary",children:c("common.onFailure",{ns:"workflow"})}),(0,F.jsxs)("div",{className:(0,S.cn)("system-xs-medium text-text-secondary",b._runningStatus===aC.NodeRunningStatus.Exception&&"text-text-warning"),children:[d===bi.ErrorHandleTypeEnum.defaultValue&&c("nodes.common.errorHandle.defaultValue.output",{ns:"workflow"}),d===bi.ErrorHandleTypeEnum.failBranch&&c("nodes.common.errorHandle.failBranch.title",{ns:"workflow"})]}),d===bi.ErrorHandleTypeEnum.failBranch&&(0,F.jsx)(fg,{id:a,data:b,handleId:bi.ErrorHandleTypeEnum.failBranch,handleClassName:"!top-1/2 !-right-[21px] !-translate-y-1/2 after:!bg-workflow-link-line-failure-button-bg",nodeSelectorClassName:"!bg-workflow-link-line-failure-button-bg"})]})}):null};var ab=ab;let fi=(0,K.memo)(({id:a,data:b})=>{let{t:c}=(0,$.useTranslation)(),[d,e]=(0,K.useState)(!1),{handleNodeSelect:f}=(0,V.useNodesInteractions)(),g=(0,aP.useWorkflowStore)(),h=b._singleRunningStatus===aC.NodeRunningStatus.Running,i=(0,K.useCallback)(a=>{e(a)},[]),j=!!(b.isInIteration||b.isInLoop);return(0,F.jsx)("div",{className:`
      absolute -top-7 right-0 hidden h-7 pb-1
      ${!b._pluginInstallLocked&&"group-hover:flex"}
      ${b.selected&&"!flex"}
      ${d&&"!flex"}
      `,children:(0,F.jsxs)("div",{className:"flex h-6 items-center rounded-lg border-[0.5px] border-components-actionbar-border bg-components-actionbar-bg px-0.5 text-text-tertiary shadow-md backdrop-blur-[5px]",onClick:a=>a.stopPropagation(),children:[(0,aQ.canRunBySingle)(b.type,j)&&(0,F.jsx)("div",{className:`flex h-5 w-5 items-center justify-center rounded-md ${h&&"cursor-pointer hover:bg-state-base-hover"}`,onClick:()=>{let b=g.getState();b.setInitShowLastRunTab(!0),b.setPendingSingleRun({nodeId:a,action:h?"stop":"run"}),f(a)},children:h?(0,F.jsx)(ab.default,{className:"h-3 w-3"}):(0,F.jsx)(ac.default,{popupContent:c("panel.runThisStep",{ns:"workflow"}),asChild:!1,children:(0,F.jsx)(Y.RiPlayLargeLine,{className:"h-3 w-3"})})}),(0,F.jsx)(d2,{id:a,data:b,offset:0,onOpenChange:i,triggerClassName:"!w-5 !h-5"})]})})});var fj=F,fk=a.i(517817),fl=a.i(345580),fm=a.i(455784);(v=E||(E={})).Line="line",v.Handle="handle";let fn={width:0,height:0,x:0,y:0},fo={...fn,pointerX:0,pointerY:0,aspectRatio:1};var fp=(0,K.memo)(function({nodeId:a,position:b,variant:c=E.Handle,className:d,style:e={},children:f,color:g,minWidth:h=10,minHeight:i=10,maxWidth:j=Number.MAX_VALUE,maxHeight:k=Number.MAX_VALUE,keepAspectRatio:l=!1,shouldResize:m,onResizeStart:n,onResize:o,onResizeEnd:p}){let q=(0,N.useNodeId)(),r="string"==typeof a?a:q,s=(0,N.useStoreApi)(),t=(0,K.useRef)(null),u=(0,K.useRef)(fo),v=(0,K.useRef)(fn),w=(0,N.useGetPointerPosition)(),x=c===E.Line?"right":"bottom-right",y=b??x;(0,K.useEffect)(()=>{if(!t.current||!r)return;let a=(0,fm.select)(t.current),b=y.includes("right")||y.includes("left"),c=y.includes("bottom")||y.includes("top"),d=y.includes("left"),e=y.includes("top"),f=(0,fl.drag)().on("start",a=>{let b=s.getState().nodeInternals.get(r),{xSnapped:c,ySnapped:d}=w(a);v.current={width:b?.width??0,height:b?.height??0,x:b?.position.x??0,y:b?.position.y??0},u.current={...v.current,pointerX:c,pointerY:d,aspectRatio:v.current.width/v.current.height},n?.(a,{...v.current})}).on("drag",a=>{let{nodeInternals:f,triggerNodeChanges:g}=s.getState(),{xSnapped:n,ySnapped:p}=w(a),q=f.get(r);if(q){let f=[],{pointerX:s,pointerY:t,width:w,height:x,x:y,y:z,aspectRatio:A}=u.current,{x:B,y:C,width:D,height:E}=v.current,F=Math.floor(b?n-s:0),G=Math.floor(c?p-t:0),H=(0,N.clamp)(w+(d?-F:F),h,j),I=(0,N.clamp)(x+(e?-G:G),i,k);if(l){let a=H/I,d=b&&c;H=a<=A&&d||c&&!b?I*A:H,I=a>A&&d||b&&!c?H/A:I,H>=j?(H=j,I=j/A):H<=h&&(H=h,I=h/A),I>=k?(I=k,H=k*A):I<=i&&(I=i,H=i*A)}let J=H!==D,K=I!==E;if(d||e){let a=d?y-(H-w):y,b=e?z-(I-x):z,c=a!==B&&J,g=b!==C&&K;if(c||g){let d={id:q.id,type:"position",position:{x:c?a:B,y:g?b:C}};f.push(d),v.current.x=d.position.x,v.current.y=d.position.y}}if(J||K){let a={id:r,type:"dimensions",updateStyle:!0,resizing:!0,dimensions:{width:H,height:I}};f.push(a),v.current.width=H,v.current.height=I}if(0===f.length)return;let L=function({width:a,prevWidth:b,height:c,prevHeight:d,invertX:e,invertY:f}){let g=a-b,h=c-d,i=[g>0?1:g<0?-1:0,h>0?1:h<0?-1:0];return g&&e&&(i[0]=-1*i[0]),h&&f&&(i[1]=-1*i[1]),i}({width:v.current.width,prevWidth:D,height:v.current.height,prevHeight:E,invertX:d,invertY:e}),M={...v.current,direction:L};if(!1===m?.(a,M))return;o?.(a,M),g(f)}}).on("end",a=>{p?.(a,{...v.current}),s.getState().triggerNodeChanges([{id:r,type:"dimensions",resizing:!1}])});return a.call(f),()=>{a.on(".drag",null)}},[r,y,h,i,j,k,l,w,n,o,p]);let z=y.split("-"),A=c===E.Line?"borderColor":"backgroundColor",B=g?{...e,[A]:g}:e;return K.default.createElement("div",{className:(0,fk.default)(["react-flow__resize-control","nodrag",...z,c,d]),ref:t,style:B},f)});let fq=()=>(0,fj.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:(0,fj.jsx)("path",{d:"M5.19009 11.8398C8.26416 10.6196 10.7144 8.16562 11.9297 5.08904",stroke:"black",strokeOpacity:"0.16",strokeWidth:"2",strokeLinecap:"round"})}),fr=(0,K.memo)(({nodeId:a,nodeData:b,icon:c=(0,fj.jsx)(fq,{}),minWidth:d=258,minHeight:e=152,maxWidth:f})=>{let{handleNodeResize:g}=(0,V.useNodesInteractions)(),h=(0,K.useCallback)((b,c)=>{g(a,c)},[a,g]);return(0,fj.jsx)("div",{className:(0,S.cn)("hidden group-hover:block",b.selected&&"!block"),children:(0,fj.jsx)(fp,{position:"bottom-right",className:"!border-none !bg-transparent",onResize:h,minWidth:d,minHeight:e,maxWidth:f,children:(0,fj.jsx)("div",{className:"absolute bottom-[1px] right-[1px]",children:c})})})}),fs=({data:a})=>{let{t:b}=(0,$.useTranslation)(),{retry_config:c}=a,d=a.selected||a._isBundled||a._isEntering,{isRunning:e,isSuccessful:f,isException:g,isFailed:h}=(0,K.useMemo)(()=>({isRunning:a._runningStatus===aC.NodeRunningStatus.Running&&!d,isSuccessful:a._runningStatus===aC.NodeRunningStatus.Succeeded&&!d,isFailed:a._runningStatus===aC.NodeRunningStatus.Failed&&!d,isException:a._runningStatus===aC.NodeRunningStatus.Exception&&!d}),[a._runningStatus,d]),i=!e&&!f&&!g&&!h;return c?.retry_enabled&&(i||a._retryIndex)?(0,F.jsx)("div",{className:"mb-1 px-3",children:(0,F.jsxs)("div",{className:(0,S.cn)("system-xs-medium-uppercase flex items-center justify-between rounded-md border-[0.5px] border-transparent bg-workflow-block-parma-bg px-[5px] py-1 text-text-tertiary",e&&"border-state-accent-active bg-state-accent-hover text-text-accent",f&&"border-state-success-active bg-state-success-hover text-text-success",(g||h)&&"border-state-warning-active bg-state-warning-hover text-text-warning"),children:[(0,F.jsxs)("div",{className:"flex items-center",children:[i&&b("nodes.common.retry.retryTimes",{ns:"workflow",times:c.max_retries}),e&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(Y.RiLoader2Line,{className:"mr-1 h-3.5 w-3.5 animate-spin"}),b("nodes.common.retry.retrying",{ns:"workflow"})]}),f&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(Y.RiCheckboxCircleFill,{className:"mr-1 h-3.5 w-3.5"}),b("nodes.common.retry.retrySuccessful",{ns:"workflow"})]}),(h||g)&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(Y.RiAlertFill,{className:"mr-1 h-3.5 w-3.5"}),b("nodes.common.retry.retryFailed",{ns:"workflow"})]})]}),!i&&!!a._retryIndex&&(0,F.jsxs)("div",{children:[a._retryIndex,"/",a.retry_config?.max_retries]})]})}):null},ft=(0,K.memo)(({id:a,data:b,children:c})=>{let{t:d}=(0,$.useTranslation)(),e=(0,K.useRef)(null),{nodesReadOnly:f}=(0,aq.useNodesReadOnly)(),{handleNodeIterationChildSizeChange:g}=(0,e_.useNodeIterationInteractions)(),{handleNodeLoopChildSizeChange:h}=(0,e0.useNodeLoopInteractions)(),i=(0,ar.useToolIcon)(b);(0,K.useEffect)(()=>{if(e.current&&b.selected&&b.isInIteration){let b=new ResizeObserver(()=>{g(a)});return b.observe(e.current),()=>{b.disconnect()}}},[b.isInIteration,b.selected,a,g]),(0,K.useEffect)(()=>{if(e.current&&b.selected&&b.isInLoop){let b=new ResizeObserver(()=>{h(a)});return b.observe(e.current),()=>{b.disconnect()}}},[b.isInLoop,b.selected,a,h]);let{hasNodeInspectVars:j}=(0,at.default)(),k=b._runningStatus===aC.NodeRunningStatus.Running||b._singleRunningStatus===aC.NodeRunningStatus.Running,l=j(a),m=b.selected||b._isBundled||b._isEntering,{showRunningBorder:n,showSuccessBorder:o,showFailedBorder:p,showExceptionBorder:q}=(0,K.useMemo)(()=>({showRunningBorder:b._runningStatus===aC.NodeRunningStatus.Running&&!m,showSuccessBorder:(b._runningStatus===aC.NodeRunningStatus.Succeeded||l)&&!m,showFailedBorder:b._runningStatus===aC.NodeRunningStatus.Failed&&!m,showExceptionBorder:b._runningStatus===aC.NodeRunningStatus.Exception&&!m}),[b._runningStatus,l,m]),r=(0,K.useMemo)(()=>{let a="";return(b._runningStatus===aC.NodeRunningStatus.Running&&(a=d("nodes.loop.currentLoopCount",{ns:"workflow",count:b._loopIndex})),(b._runningStatus===aC.NodeRunningStatus.Succeeded||b._runningStatus===aC.NodeRunningStatus.Failed)&&(a=d("nodes.loop.totalLoopCount",{ns:"workflow",count:b._loopIndex})),a)?(0,F.jsx)("div",{className:(0,S.cn)("system-xs-medium mr-2 text-text-tertiary",b._runningStatus===aC.NodeRunningStatus.Running&&"text-text-accent"),children:a}):null},[b._loopIndex,b._runningStatus,d]),s=(0,F.jsxs)("div",{className:(0,S.cn)("relative flex rounded-2xl border",m?"border-components-option-card-option-selected-border":"border-transparent",b._waitingRun&&"opacity-70",b._pluginInstallLocked&&"cursor-not-allowed"),ref:e,style:{width:b.type===aC.BlockEnum.Iteration||b.type===aC.BlockEnum.Loop?b.width:"auto",height:b.type===aC.BlockEnum.Iteration||b.type===aC.BlockEnum.Loop?b.height:"auto"},children:[(b._dimmed||b._pluginInstallLocked)&&(0,F.jsx)("div",{className:(0,S.cn)("absolute inset-0 rounded-2xl transition-opacity",b._pluginInstallLocked?"pointer-events-auto z-30 bg-workflow-block-parma-bg opacity-80 backdrop-blur-[2px]":"pointer-events-none z-20 bg-workflow-block-parma-bg opacity-50"),"data-testid":"workflow-node-install-overlay"}),b.type===aC.BlockEnum.DataSource&&(0,F.jsx)("div",{className:"absolute inset-[-2px] top-[-22px] z-[-1] rounded-[18px] bg-node-data-source-bg p-0.5 backdrop-blur-[6px]",children:(0,F.jsx)("div",{className:"system-2xs-semibold-uppercase flex h-5 items-center px-2.5 text-text-tertiary",children:d("blocks.datasource",{ns:"workflow"})})}),(0,F.jsxs)("div",{className:(0,S.cn)("group relative pb-1 shadow-xs","rounded-[15px] border border-transparent",b.type!==aC.BlockEnum.Iteration&&b.type!==aC.BlockEnum.Loop&&"w-[240px] bg-workflow-block-bg",(b.type===aC.BlockEnum.Iteration||b.type===aC.BlockEnum.Loop)&&"flex h-full w-full flex-col border-workflow-block-border bg-workflow-block-bg-transparent",!b._runningStatus&&"hover:shadow-lg",n&&"!border-state-accent-solid",o&&"!border-state-success-solid",p&&"!border-state-destructive-solid",q&&"!border-state-warning-solid",b._isBundled&&"!shadow-lg"),children:[b._showAddVariablePopup&&(0,F.jsx)(fc,{nodeId:a,nodeData:b}),b.type===aC.BlockEnum.Iteration&&(0,F.jsx)(fr,{nodeId:a,nodeData:b}),b.type===aC.BlockEnum.Loop&&(0,F.jsx)(fr,{nodeId:a,nodeData:b}),!b._isCandidate&&(0,F.jsx)(ff,{id:a,data:b,handleClassName:"!top-4 !-left-[9px] !translate-y-0",handleId:"target"}),b.type!==aC.BlockEnum.IfElse&&b.type!==aC.BlockEnum.QuestionClassifier&&!b._isCandidate&&(0,F.jsx)(fg,{id:a,data:b,handleClassName:"!top-4 !-right-[9px] !translate-y-0",handleId:"source"}),!b._runningStatus&&!f&&!b._isCandidate&&(0,F.jsx)(fi,{id:a,data:b}),(0,F.jsxs)("div",{className:(0,S.cn)("flex items-center rounded-t-2xl px-3 pb-2 pt-3",(b.type===aC.BlockEnum.Iteration||b.type===aC.BlockEnum.Loop)&&"bg-transparent"),children:[(0,F.jsx)(am.default,{className:"mr-2 shrink-0",type:b.type,size:"md",toolIcon:i}),(0,F.jsxs)("div",{title:b.title,className:"system-sm-semibold-uppercase mr-1 flex grow items-center truncate text-text-primary",children:[(0,F.jsx)("div",{children:b.title}),b.type===aC.BlockEnum.Iteration&&b.is_parallel&&(0,F.jsx)(ac.default,{popupContent:(0,F.jsxs)("div",{className:"w-[180px]",children:[(0,F.jsx)("div",{className:"font-extrabold",children:d("nodes.iteration.parallelModeEnableTitle",{ns:"workflow"})}),d("nodes.iteration.parallelModeEnableDesc",{ns:"workflow"})]}),children:(0,F.jsx)("div",{className:"system-2xs-medium-uppercase ml-1 flex items-center justify-center rounded-[5px] border-[1px] border-text-warning px-[5px] py-[3px] text-text-warning ",children:d("nodes.iteration.parallelModeUpper",{ns:"workflow"})})})]}),!!(b._iterationLength&&b._iterationIndex&&b._runningStatus===aC.NodeRunningStatus.Running)&&(0,F.jsxs)("div",{className:"mr-1.5 text-xs font-medium text-text-accent",children:[b._iterationIndex>b._iterationLength?b._iterationLength:b._iterationIndex,"/",b._iterationLength]}),!!(b.type===aC.BlockEnum.Loop&&b._loopIndex)&&r,k?(0,F.jsx)(Y.RiLoader2Line,{className:"h-3.5 w-3.5 animate-spin text-text-accent"}):b._runningStatus===aC.NodeRunningStatus.Failed?(0,F.jsx)(Y.RiErrorWarningFill,{className:"h-3.5 w-3.5 text-text-destructive"}):b._runningStatus===aC.NodeRunningStatus.Exception?(0,F.jsx)(Y.RiAlertFill,{className:"h-3.5 w-3.5 text-text-warning-secondary"}):b._runningStatus===aC.NodeRunningStatus.Succeeded||l?(0,F.jsx)(Y.RiCheckboxCircleFill,{className:"h-3.5 w-3.5 text-text-success"}):null]}),b.type!==aC.BlockEnum.Iteration&&b.type!==aC.BlockEnum.Loop&&(0,K.cloneElement)(c,{id:a,data:b}),(b.type===aC.BlockEnum.Iteration||b.type===aC.BlockEnum.Loop)&&(0,F.jsx)("div",{className:"grow pb-1 pl-1 pr-1",children:(0,K.cloneElement)(c,{id:a,data:b})}),(0,aR.hasRetryNode)(b.type)&&(0,F.jsx)(fs,{id:a,data:b}),(0,aQ.hasErrorHandleNode)(b.type)&&(0,F.jsx)(fh,{id:a,data:b}),!!(b.desc&&b.type!==aC.BlockEnum.Iteration&&b.type!==aC.BlockEnum.Loop)&&(0,F.jsx)("div",{className:"system-xs-regular whitespace-pre-line break-words px-3 pb-2 pt-1 text-text-tertiary",children:b.desc}),b.type===aC.BlockEnum.Tool&&b.provider_type===b2.ToolTypeEnum.MCP&&(0,F.jsx)("div",{className:"px-3 pb-2",children:(0,F.jsx)(e3,{content:b.provider_id||""})})]})]}),t=b.type===aC.BlockEnum.Start;return(0,aC.isTriggerNode)(b.type)||t?(0,F.jsx)(fe,{nodeType:t?fd.Start:fd.Trigger,children:s}):s});var fu=a.i(162807);let fv=a=>{let{children:b,className:c,...d}=a;return(0,F.jsx)("div",{...d,className:(0,S.cn)("system-2xs-medium-uppercase mb-1 text-text-tertiary",c),children:b})},fw=a=>{let{children:b,label:c}=a;return(0,F.jsxs)("div",{className:(0,S.cn)("py-1"),children:[c,(0,F.jsx)("div",{className:"space-y-0.5",children:b})]})};var fx=a.i(854867);let fy=(0,K.memo)(({label:a,children:b,status:c,tooltip:d})=>{let e="error"===c?"red":"warning"===c?"yellow":void 0,f=["error","warning"].includes(c);return(0,F.jsxs)("div",{className:"relative flex items-center justify-between space-x-1 rounded-md bg-workflow-block-parma-bg px-1.5 py-1 text-xs font-normal",children:[(0,F.jsx)("div",{className:(0,S.cn)("system-xs-medium-uppercase max-w-full shrink-0 truncate text-text-tertiary",!!b&&"max-w-[100px]"),children:a}),(0,F.jsx)(ac.default,{popupContent:d,disabled:!f,children:(0,F.jsx)("div",{className:"system-xs-medium truncate text-right text-text-secondary",children:b})}),e&&(0,F.jsx)(fx.default,{color:e,className:"absolute -right-0.5 -top-0.5"})]})});fy.displayName="SettingItem";var fz=a.i(403473);let fA=a=>{let{t:b}=(0,$.useTranslation)(),c=(()=>{let{data:a}=(0,ae.useModelList)(b$.ModelTypeEnum.textGeneration),{data:b}=(0,ae.useModelList)(b$.ModelTypeEnum.moderation),{data:c}=(0,ae.useModelList)(b$.ModelTypeEnum.rerank),{data:d}=(0,ae.useModelList)(b$.ModelTypeEnum.speech2text),{data:e}=(0,ae.useModelList)(b$.ModelTypeEnum.textEmbedding),{data:f}=(0,ae.useModelList)(b$.ModelTypeEnum.tts),g=(0,K.useMemo)(()=>a.concat(b).concat(c).concat(d).concat(e).concat(f),[a,b,c,d,e,f]);if(a&&b&&c&&d&&e&&f)return g})();if(!("provider"in a))return(0,F.jsx)(ac.default,{popupContent:b("nodes.agent.modelNotSelected",{ns:"workflow"}),triggerMethod:"hover",children:(0,F.jsxs)("div",{className:"relative",children:[(0,F.jsx)(fz.default,{modelList:[],triggerClassName:"bg-workflow-block-parma-bg !h-6 !rounded-md",defaultModel:void 0,showDeprecatedWarnIcon:!1,readonly:!0,deprecatedClassName:"opacity-50"}),(0,F.jsx)(fx.default,{color:"red",className:"absolute -right-0.5 -top-0.5"})]})});let d=c?.some(b=>b.provider===a.provider&&b.models.some(b=>b.model===a.model)),e=c&&!d;return c&&(0,F.jsx)(ac.default,{popupContent:b("nodes.agent.modelNotInstallTooltip",{ns:"workflow"}),triggerMethod:"hover",disabled:!c||d,children:(0,F.jsxs)("div",{className:"relative",children:[(0,F.jsx)(fz.default,{modelList:c,triggerClassName:"bg-workflow-block-parma-bg !h-6 !rounded-md",defaultModel:a,showDeprecatedWarnIcon:!1,readonly:!0,deprecatedClassName:"opacity-50"}),e&&(0,F.jsx)(fx.default,{color:"red",className:"absolute -right-0.5 -top-0.5"})]})})};var fB=a.i(355968);a.i(10035);var fC=a.i(423963),fD=a.i(127327);let fE=(0,K.memo)(({providerName:a})=>{let b=(0,K.useRef)(null),{data:c}=(0,Q.useAllBuiltInTools)(),{data:d}=(0,Q.useAllCustomTools)(),{data:e}=(0,Q.useAllWorkflowTools)(),{data:f}=(0,Q.useAllMCPTools)(),g=!!c&&!!d&&!!e&&!!f,h=(0,K.useMemo)(()=>[...c||[],...d||[],...e||[],...f||[]].find(b=>b.name===a||b.id===a),[c,d,a,e,f]),i=a.split("/"),j=i[0],k=i[1],l=(0,K.useMemo)(()=>g?h?h.icon:(0,fD.getIconFromMarketPlace)(`${j}/${k}`):"",[j,h,k,g]),m=(0,K.useMemo)(()=>{if(g){if(!h)return"not-installed";if(!1===h.is_team_authorization)return"not-authorized"}},[h,g]),n="not-installed"===m?"red":"not-authorized"===m?"yellow":void 0,o=["not-installed","not-authorized"].includes(m),{t:p}=(0,$.useTranslation)(),q=(0,K.useMemo)(()=>{if(o){if("not-installed"===m)return p("nodes.agent.toolNotInstallTooltip",{ns:"workflow",tool:k});if("not-authorized"===m)return p("nodes.agent.toolNotAuthorizedTooltip",{ns:"workflow",tool:k});throw Error("Unknown status")}},[k,o,m,p]),[r,s]=(0,K.useState)(!1);return(0,F.jsx)(ac.default,{triggerMethod:"hover",popupContent:q,disabled:!o,children:(0,F.jsxs)("div",{className:(0,S.cn)("relative"),ref:b,children:[(0,F.jsx)("div",{className:"flex size-5 items-center justify-center overflow-hidden rounded-[6px] border-[0.5px] border-components-panel-border-subtle bg-background-default-dodge",children:r||!l?(0,F.jsx)(fC.Group,{className:"h-3 w-3 opacity-35"}):"string"==typeof l?(0,F.jsx)("img",{src:l,alt:"tool icon",className:(0,S.cn)("size-3.5 h-full w-full object-cover",o&&"opacity-50"),onError:()=>s(!0)}):"object"==typeof l?(0,F.jsx)(fB.default,{className:(0,S.cn)("size-3.5 h-full w-full object-cover",o&&"opacity-50"),icon:l?.content,background:l?.background}):(0,F.jsx)(fC.Group,{className:"h-3 w-3 opacity-35"})}),n&&(0,F.jsx)(fx.default,{color:n,className:"absolute -right-[1px] -top-[1px]"})]})})});fE.displayName="ToolIcon";let fF=a=>{let{inputs:b,currentStrategy:c,currentStrategyStatus:d,pluginDetail:e}=eH(a.id,a.data),f=(0,fu.useRenderI18nObject)(),{t:g}=(0,$.useTranslation)(),h=(0,K.useMemo)(()=>b&&c?.parameters.filter(a=>a.type===b$.FormTypeEnum.modelSelector).reduce((a,c)=>{let d=b.agent_parameters?.[c.name]?.value;if(!d)if(c.required)return a.push({param:c.name}),a;else return a;return a.push({provider:d.provider,model:d.model,param:c.name}),a},[])||[],[c,b]),i=(0,K.useMemo)(()=>{let a=[];return c?.parameters.forEach((c,d)=>{if(c.type===b$.FormTypeEnum.toolSelector){let e=c.name,f=b.agent_parameters?.[e]?.value;f&&a.push({id:`${c.name}-${d}`,providerName:f.provider_name})}if(c.type===b$.FormTypeEnum.multiToolSelector){let d=c.name,e=b.agent_parameters?.[d]?.value;e&&e.forEach((b,d)=>{a.push({id:`${c.name}-${d}`,providerName:b.provider_name})})}}),a},[c?.parameters,b.agent_parameters]);return(0,F.jsxs)("div",{className:"mb-1 space-y-1 px-3",children:[b.agent_strategy_name?(0,F.jsx)(fy,{label:g("nodes.agent.strategy.shortLabel",{ns:"workflow"}),status:d&&!d.isExistInPlugin?"error":void 0,tooltip:d&&!d.isExistInPlugin?g("nodes.agent.strategyNotInstallTooltip",{ns:"workflow",plugin:e?.declaration.label?f(e?.declaration.label):void 0,strategy:b.agent_strategy_label}):void 0,children:b.agent_strategy_label}):(0,F.jsx)(fy,{label:g("nodes.agent.strategyNotSet",{ns:"workflow"})}),h.length>0&&(0,F.jsx)(fw,{label:(0,F.jsx)(fv,{className:"mt-1",children:g("nodes.agent.model",{ns:"workflow"})}),children:h.map(a=>(0,K.createElement)(fA,{...a,key:a.param}))}),i.length>0&&(0,F.jsx)(fw,{label:(0,F.jsx)(fv,{className:"mt-1",children:g("nodes.agent.toolbox",{ns:"workflow"})}),children:(0,F.jsx)("div",{className:"grid grid-cols-10 gap-0.5",children:i.map((a,b)=>(0,K.createElement)(fE,{...a,key:a.id+b}))})})]})};fF.displayName="AgentNode";let fG=(0,K.memo)(fF);var fH=a.i(721734);a.i(275560);var fI=a.i(318545),fJ=a.i(644734),fK=a.i(325586),fL=a.i(524526),fM=a.i(847011),fN=a.i(802022),fO=a.i(260208),fP=a.i(7474),fQ=a.i(302785),fR=a.i(516452),fS=a.i(638150);let fT=[],fU=a=>{let{title:b,description:c}=a,{t:d}=(0,$.useTranslation)();return(0,F.jsx)(ac.default,{popupContent:(0,F.jsxs)("div",{className:"space-y-1 text-xs",children:[(0,F.jsx)("h3",{className:"font-semibold text-text-primary",children:b}),(0,F.jsx)("p",{className:"tracking-tight text-text-secondary",children:c}),(0,F.jsx)("p",{children:(0,F.jsx)(bz.default,{href:"/plugins",className:"tracking-tight text-text-accent",children:d("nodes.agent.linkToPlugin",{ns:"workflow"})})})]}),children:(0,F.jsx)("div",{children:(0,F.jsx)(Y.RiErrorWarningFill,{className:"size-4 text-text-destructive"})})})},fV=(0,K.memo)(a=>{var b;let{enable_marketplace:c}=(0,bw.useGlobalPublicStore)(a=>a.systemFeatures),{value:d,onChange:e}=a,[f,g]=(0,K.useState)(!1),[h,i]=(0,K.useState)(dP.ViewType.flat),[j,k]=(0,K.useState)(""),l=(0,eC.useStrategyProviders)(),{getIconUrl:m}=(0,fQ.default)(),n=l.data?(b=l.data,b.map(a=>({id:a.plugin_unique_identifier,author:a.declaration.identity.author,name:a.declaration.identity.name,description:a.declaration.identity.description,plugin_id:a.plugin_id,icon:m(a.declaration.identity.icon),label:a.declaration.identity.label,type:bN.CollectionType.all,meta:a.meta,tools:a.declaration.strategies.map(a=>({name:a.identity.name,author:a.identity.author,label:a.identity.label,description:a.description,parameters:a.parameters,output_schema:a.output_schema,labels:[]})),team_credentials:{},is_team_authorization:!0,allow_delete:!1,labels:[]}))):void 0,o=(0,K.useMemo)(()=>n?n.filter(a=>a.name.toLowerCase().includes(j.toLowerCase())):[],[j,n]),{strategyStatus:p,refetch:q}=eG(d?.agent_strategy_provider_name,d?.agent_strategy_name),r=p?.plugin?.source==="external"&&!p.plugin.installed&&!!d,s=p?.plugin.source==="external"&&!p?.isExistInPlugin&&!!d,t=!p?.isExistInPlugin&&p?.plugin.source==="marketplace"&&p.plugin.installed&&!!d,u=!p?.isExistInPlugin&&p?.plugin.source==="marketplace"&&!p.plugin.installed&&!!d,v=n?.find(a=>a.tools?.find(a=>a.name===d?.agent_strategy_name))?.icon,{t:w}=(0,$.useTranslation)(),x=(0,K.useRef)(null),{queryPluginsWithDebounced:y,plugins:z=[]}=(0,bC.useMarketplacePlugins)();(0,K.useEffect)(()=>{c&&j&&y({query:j,category:bD.PluginCategoryEnum.agent})},[j]);let A=(0,K.useRef)(null);return(0,F.jsxs)(bh.PortalToFollowElem,{open:f,onOpenChange:g,placement:"bottom",children:[(0,F.jsx)(bh.PortalToFollowElemTrigger,{className:"w-full",children:(0,F.jsxs)("div",{className:"flex h-8 w-full select-none items-center gap-0.5 rounded-lg bg-components-input-bg-normal p-1 hover:bg-state-base-hover-alt",onClick:()=>g(a=>!a),children:[v&&(0,F.jsx)("div",{className:"flex h-6 w-6 items-center justify-center",children:(0,F.jsx)("img",{src:v,width:20,height:20,className:"rounded-md border-[0.5px] border-components-panel-border-subtle bg-background-default-dodge",alt:"icon"})}),(0,F.jsx)("p",{className:(0,S.cn)(d?"text-components-input-text-filled":"text-components-input-text-placeholder","px-1 text-xs"),children:d?.agent_strategy_label||w("nodes.agent.strategy.selectTip",{ns:"workflow"})}),(0,F.jsxs)("div",{className:"ml-auto flex items-center gap-1",children:[u&&d&&(0,F.jsx)(fR.InstallPluginButton,{onClick:a=>a.stopPropagation(),size:"small",uniqueIdentifier:d.plugin_unique_identifier}),r?(0,F.jsx)(fU,{title:w("nodes.agent.pluginNotInstalled",{ns:"workflow"}),description:w("nodes.agent.pluginNotInstalledDesc",{ns:"workflow"})}):s?(0,F.jsx)(fU,{title:w("nodes.agent.unsupportedStrategy",{ns:"workflow"}),description:w("nodes.agent.strategyNotFoundDesc",{ns:"workflow"})}):(0,F.jsx)(Y.RiArrowDownSLine,{className:"size-4 text-text-tertiary"}),t&&(0,F.jsx)(fS.SwitchPluginVersion,{uniqueIdentifier:d.plugin_unique_identifier,tooltip:(0,F.jsx)(fP.ToolTipContent,{title:w("nodes.agent.unsupportedStrategy",{ns:"workflow"}),children:w("nodes.agent.strategyNotFoundDescAndSwitchVersion",{ns:"workflow"})}),onChange:()=>{q()}})]})]})}),(0,F.jsx)(bh.PortalToFollowElemContent,{className:"z-10",children:(0,F.jsxs)("div",{className:"w-[388px] overflow-hidden rounded-md border-[0.5px] border-components-panel-border bg-components-panel-bg-blur shadow",children:[(0,F.jsxs)("header",{className:"flex gap-1 p-2",children:[(0,F.jsx)(fO.default,{placeholder:w("nodes.agent.strategy.searchPlaceholder",{ns:"workflow"}),value:j,onChange:k,className:"w-full"}),(0,F.jsx)(dP.default,{viewType:h,onChange:i})]}),(0,F.jsxs)("main",{className:"relative flex w-full flex-col overflow-hidden md:max-h-[300px] xl:max-h-[400px] 2xl:max-h-[564px]",ref:x,children:[(0,F.jsx)(dO.default,{tools:o,viewType:h,onSelect:(a,b)=>{e({agent_strategy_name:b.tool_name,agent_strategy_provider_name:b.provider_name,agent_strategy_label:b.tool_label,agent_output_schema:b.output_schema||{},plugin_unique_identifier:b.provider_id,meta:b.meta}),g(!1)},className:"h-full max-h-full max-w-none overflow-y-auto",indexBarClassName:"top-0 xl:top-36",hasSearchText:!1,canNotSelectMultiple:!0,isAgent:!0}),c&&(0,F.jsx)(bV.default,{ref:A,wrapElemRef:x,list:z,searchText:j,tags:fT,category:bD.PluginCategoryEnum.agent,disableMaxWidth:!0})]})]})})]})});fV.displayName="AgentStrategySelector";let fW=K.memo(({className:a,title:b,isSubTitle:c,tooltip:d,children:e,operations:f,inline:g,supportFold:h,required:i})=>{let[j,{toggle:k}]=(0,a8.useBoolean)(!0);return(0,F.jsxs)("div",{className:(0,S.cn)(a,g&&"flex w-full items-center justify-between"),children:[(0,F.jsxs)("div",{onClick:()=>h&&k(),className:(0,S.cn)("flex items-center justify-between",h&&"cursor-pointer"),children:[(0,F.jsxs)("div",{className:"flex h-6 items-center",children:[(0,F.jsxs)("div",{className:(0,S.cn)(c?"system-xs-medium-uppercase text-text-tertiary":"system-sm-semibold-uppercase text-text-secondary"),children:[b," ",i&&(0,F.jsx)("span",{className:"text-text-destructive",children:"*"})]}),!!d&&(0,F.jsx)(ac.default,{popupContent:d,popupClassName:"ml-1",triggerClassName:"w-4 h-4 ml-1"})]}),(0,F.jsxs)("div",{className:"flex",children:[!!f&&(0,F.jsx)("div",{children:f}),h&&(0,F.jsx)(Y.RiArrowDownSLine,{className:"h-4 w-4 cursor-pointer text-text-tertiary transition-transform",style:{transform:j?"rotate(-90deg)":"rotate(0deg)"}})]})]}),!!(e&&(!h||h&&!j))&&(0,F.jsx)("div",{className:(0,S.cn)(!g&&"mt-1"),children:e})]})});var fX=a.i(175809);a.i(849888);var fY=a.i(134579),fZ=a.i(547252),f$=a.i(75732),f$=f$,f_=a.i(76284),f0=a.i(507131),f1=a.i(555237);let f2=K.memo(({availableVars:a,varList:b,onAddVar:c,...d})=>{let{t:e}=(0,$.useTranslation)(),f=(0,K.useRef)(!1),g=(0,K.useRef)(null),h=(0,K.useRef)(null),i=(0,K.useRef)(null),[j,{setTrue:k,setFalse:l}]=(0,a8.useBoolean)(!1),[m,n]=(0,K.useState)({x:0,y:0}),o=a=>{let b=g.current,{position:c}=a,d=b.getModel().getLineContent(c.lineNumber)[c.column-2];if(["/","{"].includes(d)){f.current="{"===d;let a=b.getDomNode().getBoundingClientRect(),e=b.getScrolledVisiblePosition(c);n({x:a.left+e.left,y:a.top+e.top+20}),k()}else l()};(0,K.useEffect)(()=>{if(j&&i.current){let a=window.innerWidth,{width:b,height:c}=i.current.getBoundingClientRect(),d={...m};m.x+b>a-8&&(d.x=a-b-8),m.y+c>window.innerHeight-8&&(d.y=window.innerHeight-c-8),(d.x!==m.x||d.y!==m.y)&&n(d)}},[j,m]);let p=a=>{if(b.find(b=>b.variable===a)){let b=/_(\d+)$/.exec(a),c=b?Number.parseInt(b[1])+1:1;return p(`${a.replace(/_(\d+)$/,"")}_${c}`)}return a};return(0,F.jsxs)("div",{className:(0,S.cn)(d.isExpand&&"h-full"),children:[(0,F.jsx)(a7.default,{...d,onMount:(a,b)=>{g.current=a,h.current=b,a.onDidChangeCursorPosition(o)},placeholder:e("common.jinjaEditorPlaceholder",{ns:"workflow"})}),j&&(0,f1.createPortal)((0,F.jsx)("div",{ref:i,className:"w-[228px] space-y-1 rounded-lg border border-components-panel-border bg-components-panel-bg p-1 shadow-lg",style:{position:"fixed",top:m.y,left:m.x,zIndex:100},children:(0,F.jsx)(fa.default,{hideSearch:!0,vars:a,onChange:a=>{let d,{name:e,isExist:i}=(d=b.find(b=>Array.isArray(b.value_selector)&&b.value_selector.join("@@@")===a.join("@@@")))?{name:d.variable,isExist:!0}:{name:p(a.slice(-1)[0]),isExist:!1};i||c?.({variable:e,value_selector:a});let j=g.current,k=h.current,m=j?.getPosition();j?.executeEdits("",[{range:new k.Range(m.lineNumber,m.column-1,m.lineNumber,m.column),text:`{{ ${e} }${!f.current?"}":""}`}]),l()},isSupportFileVar:!1})}),document.body)]})});var f3=a.i(491666),f4=a.i(220343),f5=a.i(359058),f6=a.i(901088);let f7=K.memo(({className:a,onGenerated:b,nodeId:c,editorId:d,currentPrompt:e})=>{let[f,{setTrue:g,setFalse:h}]=(0,a8.useBoolean)(!1),i=(0,K.useCallback)(a=>{b?.(a.modified),h()},[b,h]),j=(0,as.useHooksStore)(a=>a.configsMap);return(0,F.jsxs)("div",{className:(0,S.cn)(a),children:[(0,F.jsx)(fX.ActionButton,{className:"hover:bg-[#155EFF]/8",onClick:g,children:(0,F.jsx)(f6.Generator,{className:"h-4 w-4 text-primary-600"})}),f&&(0,F.jsx)(f5.default,{mode:aI.AppModeEnum.CHAT,isShow:f,onClose:h,onFinished:i,flowId:j?.flowId||"",nodeId:c,editorId:d,currentPrompt:e})]})});var f8=a.i(909742);let f9=K.memo(({className:a,headerClassName:b,instanceId:c,nodeId:d,editorId:e,title:f,value:g,onChange:h,readOnly:i,showRemove:j,onRemove:k,justVar:l,isChatModel:m,isChatApp:n,isShowContext:o,hasSetBlockStatus:p,nodesOutputVars:q,availableNodes:r=[],isSupportFileVar:s,isSupportPromptGenerator:t,isSupportJinja:u,editionType:v,onEditionTypeChange:w,varList:x=[],handleAddVariable:y,onGenerated:z,modelConfig:A,containerBackgroundClassName:B,gradientBorder:C=!0,titleTooltip:D,inputClassName:E,placeholder:G,placeholderClassName:H,titleClassName:I,editorContainerClassName:J,required:L})=>{let{t:M}=(0,$.useTranslation)(),{eventEmitter:N}=(0,P.useEventEmitterContextContext)(),O=(0,aP.useStore)(a=>a.controlPromptEditorRerenderKey),Q=(0,K.useRef)(null),{wrapClassName:R,wrapStyle:T,isExpand:U,setIsExpand:V,editorExpandHeight:W}=(0,f4.default)({ref:Q,isInNode:!0}),[X,Z]=K.useState(!1),_=(0,K.useCallback)(()=>{(0,e1.default)(g),Z(!0)},[g]),[aa,{setTrue:ab,setFalse:ad}]=(0,a8.useBoolean)(!1),ae=(0,e5.useWorkflowVariableType)(),af=(0,aP.useStore)(a=>a.pipelineId),ag=(0,aP.useStore)(a=>a.setShowInputFieldPanel);return(0,F.jsx)(f8.default,{className:(0,S.cn)(a,R),style:T,isInNode:!0,isExpand:U,children:(0,F.jsx)("div",{ref:Q,className:(0,S.cn)(aa?C&&"bg-gradient-to-r from-components-input-border-active-prompt-1 to-components-input-border-active-prompt-2":"bg-transparent",U&&"h-full","!rounded-[9px] p-0.5",B),children:(0,F.jsxs)("div",{className:(0,S.cn)(aa?"bg-background-default":"bg-components-input-bg-normal",U&&"flex h-full flex-col","rounded-lg",B),children:[(0,F.jsxs)("div",{className:(0,S.cn)("flex items-center justify-between pl-3 pr-2 pt-1",b),children:[(0,F.jsxs)("div",{className:"flex gap-2",children:[(0,F.jsxs)("div",{className:(0,S.cn)("text-xs font-semibold uppercase leading-4 text-text-secondary",I),children:[f," ",L&&(0,F.jsx)("span",{className:"text-text-destructive",children:"*"})]}),!!D&&(0,F.jsx)(ac.default,{popupContent:D})]}),(0,F.jsxs)("div",{className:"flex items-center",children:[(0,F.jsx)("div",{className:"text-xs font-medium leading-[18px] text-text-tertiary",children:g?.length||0}),t&&(0,F.jsx)(f7,{nodeId:d,editorId:e,className:"ml-[5px]",onGenerated:z,modelConfig:A,currentPrompt:g}),(0,F.jsx)("div",{className:"ml-2 mr-2 h-3 w-px bg-divider-regular"}),(0,F.jsxs)("div",{className:"flex items-center space-x-[2px]",children:[u&&(0,F.jsx)(ac.default,{popupContent:(0,F.jsxs)("div",{children:[(0,F.jsx)("div",{children:M("common.enableJinja",{ns:"workflow"})}),(0,F.jsx)("a",{className:"text-text-accent",target:"_blank",href:"https://jinja.palletsprojects.com/en/2.10.x/",children:M("common.learnMore",{ns:"workflow"})})]}),children:(0,F.jsxs)("div",{className:(0,S.cn)(v===aC.EditionType.jinja2&&"border-components-button-ghost-bg-hover bg-components-button-ghost-bg-hover","flex h-[22px] items-center space-x-0.5 rounded-[5px] border border-transparent px-1.5 hover:border-components-button-ghost-bg-hover"),children:[(0,F.jsx)(f$.default,{className:"h-3 w-6 text-text-quaternary"}),(0,F.jsx)(d4.default,{size:"sm",defaultValue:v===aC.EditionType.jinja2,onChange:a=>{w?.(a?aC.EditionType.jinja2:aC.EditionType.basic)}})]})}),!i&&(0,F.jsx)(ac.default,{popupContent:`${M("common.insertVarTip",{ns:"workflow"})}`,children:(0,F.jsx)(fX.default,{onClick:()=>{ab(),N?.emit({type:f0.PROMPT_EDITOR_INSERT_QUICKLY,instanceId:c})},children:(0,F.jsx)(a0.Variable02,{className:"h-4 w-4"})})}),j&&(0,F.jsx)(fX.default,{onClick:k,children:(0,F.jsx)(Y.RiDeleteBinLine,{className:"h-4 w-4"})}),X?(0,F.jsx)(fX.default,{children:(0,F.jsx)(fZ.CopyCheck,{className:"h-4 w-4"})}):(0,F.jsx)(fX.default,{onClick:_,children:(0,F.jsx)(fY.Copy,{className:"h-4 w-4"})}),(0,F.jsx)(f3.default,{isExpand:U,onExpandChange:V})]})]})]}),(0,F.jsx)("div",{className:(0,S.cn)("pb-2",U&&"flex grow flex-col"),children:u&&v===aC.EditionType.jinja2?(0,F.jsx)("div",{className:(0,S.cn)(U?"grow":"max-h-[536px]","relative min-h-[56px] overflow-y-auto  px-3",J),children:(0,F.jsx)(f2,{availableVars:q||[],varList:x,onAddVar:y,isInNode:!0,readOnly:i,language:a6.CodeLanguage.python3,value:g,onChange:h,noWrapper:!0,isExpand:U,className:E})}):(0,F.jsxs)("div",{className:(0,S.cn)(U?"grow":"max-h-[536px]","relative min-h-[56px] overflow-y-auto  px-3",J),children:[(0,F.jsx)(f_.default,{placeholder:G,placeholderClassName:H,instanceId:c,compact:!0,className:(0,S.cn)("min-h-[56px]",E),style:U?{height:W-5}:{},value:g,contextBlock:{show:!l&&o,selectable:!p?.context,canNotAddContext:!0},historyBlock:{show:!l&&!m&&n,selectable:!p?.history,history:{user:"Human",assistant:"Assistant"}},queryBlock:{show:!1,selectable:!1},workflowVariableBlock:{show:!0,variables:q||[],getVarType:ae,workflowNodesMap:r.reduce((a,b)=>(a[b.id]={title:b.data.title,type:b.data.type,width:b.width,height:b.height,position:b.position},b.data.type===aC.BlockEnum.Start&&(a.sys={title:M("blocks.start",{ns:"workflow"}),type:aC.BlockEnum.Start}),a),{}),showManageInputField:!!af,onManageInputField:()=>ag?.(!0)},onChange:h,onBlur:ad,onFocus:ab,editable:!i,isSupportFileVar:s},O),i&&(0,F.jsx)("div",{className:"absolute inset-0 z-10"})]})})]})})})}),ga=(0,K.memo)(a=>{let{strategy:b,onStrategyChange:c,formSchema:d,formValue:e,onFormValueChange:f,nodeOutputVars:g,availableNodes:h,nodeId:i}=a,{t:j}=(0,$.useTranslation)(),k=(0,bk.useDocLink)(),l=(0,ae.useDefaultModel)(b$.ModelTypeEnum.textGeneration),m=(0,fu.useRenderI18nObject)(),{setControlPromptEditorRerenderKey:n}=(0,aP.useWorkflowStore)().getState(),o=[[b$.FormTypeEnum.textNumber,b$.FormTypeEnum.textInput],(a,b)=>{switch(a.type){case b$.FormTypeEnum.textInput:{let c=b.value[a.variable]||a.default,d=a.variable,e=c=>{b.onChange({...b.value,[a.variable]:c})};return(0,F.jsx)(f9,{value:c,onChange:e,onGenerated:a=>{e(a),n(Math.random())},instanceId:d,title:m(a.label),headerClassName:"bg-transparent px-0 text-text-secondary system-sm-semibold-uppercase",containerBackgroundClassName:"bg-transparent",gradientBorder:!1,nodeId:i,isSupportPromptGenerator:!!a.auto_generate?.type,titleTooltip:a.tooltip&&m(a.tooltip),editorContainerClassName:"px-0 bg-components-input-bg-normal focus-within:bg-components-input-bg-active rounded-lg",availableNodes:h,nodesOutputVars:g,isSupportJinja:a.template?.enabled,required:a.required,varList:[],modelConfig:l.data?{mode:aI.AppModeEnum.CHAT,name:l.data.model,provider:l.data.provider.provider,completion_params:{}}:void 0,placeholderClassName:"px-2 py-1",titleClassName:"system-sm-semibold-uppercase text-text-secondary text-[13px]",inputClassName:"px-2 py-1"},d)}case b$.FormTypeEnum.textNumber:{if(!a.max||!a.min)return!1;let c=a.default?Number.parseInt(a.default):1,d=b.value[a.variable]||c,e=c=>{b.onChange({...b.value,[a.variable]:c})};return(0,F.jsx)(fW,{title:(0,F.jsxs)(F.Fragment,{children:[m(a.label)," ",a.required&&(0,F.jsx)("span",{className:"text-red-500",children:"*"})]}),tooltip:a.tooltip&&m(a.tooltip),inline:!0,children:(0,F.jsxs)("div",{className:"flex w-[200px] items-center gap-3",children:[(0,F.jsx)(d3.default,{value:d,onChange:e,className:"w-full",min:a.min,max:a.max}),(0,F.jsx)(fJ.InputNumber,{value:d,onChange:e,defaultValue:c,size:"regular",min:a.min,max:a.max,className:"w-12"})]})},a.variable)}}}];return(0,F.jsxs)("div",{className:"space-y-2",children:[(0,F.jsx)(fV,{value:b,onChange:c}),b?(0,F.jsx)("div",{children:(0,F.jsx)(fL.default,{formSchemas:[...d],value:e,onChange:f,validating:!1,showOnVariableMap:{},isEditMode:!0,isAgentStrategy:!0,fieldLabelClassName:"uppercase",customRenderField:(a,b)=>{switch(a.type){case b$.FormTypeEnum.toolSelector:{let c=b.value[a.variable],d=c=>{b.onChange({...b.value,[a.variable]:c})};return(0,F.jsx)(fW,{title:(0,F.jsxs)(F.Fragment,{children:[m(a.label)," ",a.required&&(0,F.jsx)("span",{className:"text-red-500",children:"*"})]}),tooltip:a.tooltip&&m(a.tooltip),children:(0,F.jsx)(fN.default,{nodeId:b.nodeId||"",nodeOutputVars:b.nodeOutputVars||[],availableNodes:b.availableNodes||[],scope:a.scope,value:c,onSelect:a=>d(a),onDelete:()=>d(null),onSelectMultiple:ds.noop})})}case b$.FormTypeEnum.multiToolSelector:{let c=b.value[a.variable];return(0,F.jsx)(fM.default,{nodeId:b.nodeId||"",nodeOutputVars:b.nodeOutputVars||[],availableNodes:b.availableNodes||[],scope:a.scope,value:c||[],label:m(a.label),tooltip:a.tooltip&&m(a.tooltip),onChange:c=>{b.onChange({...b.value,[a.variable]:c})},supportCollapse:!0,required:a.required})}}},override:o,nodeId:i,nodeOutputVars:g||[],availableNodes:h||[]})}):(0,F.jsx)(fK.default,{icon:(0,F.jsx)(fI.Agent,{className:"h-5 w-5 shrink-0 text-text-accent"}),title:j("nodes.agent.strategy.configureTip",{ns:"workflow"}),description:(0,F.jsxs)("div",{className:"text-xs text-text-tertiary",children:[j("nodes.agent.strategy.configureTipDesc",{ns:"workflow"})," ",(0,F.jsx)("br",{}),(0,F.jsx)(bz.default,{href:k("/use-dify/nodes/agent"),className:"text-text-accent-secondary",target:"_blank",children:j("nodes.agent.learnMore",{ns:"workflow"})})]})})]})});ga.displayName="AgentStrategy";var gb=a.i(100358);let gc="nodes.common.memory",gd=({readonly:a,title:b,value:c,onChange:d})=>{let e=(0,K.useCallback)(a=>{d(a.target.value)},[d]);return(0,F.jsxs)("div",{className:"flex items-center justify-between",children:[(0,F.jsx)("div",{className:"text-[13px] font-normal text-text-secondary",children:b}),(0,F.jsx)(a2.default,{readOnly:a,value:c,onChange:e,className:"h-8 w-[200px]",type:"text"})]})},ge={window:{enabled:!1,size:50},query_prompt_template:"{{#sys.query#}}\n\n{{#sys.files#}}"},gf=K.memo(({className:a,readonly:b,config:c={data:ge},onChange:d,canSetRoleName:e=!1})=>{let{t:f}=(0,$.useTranslation)(),g=c.data,h=(0,K.useCallback)(a=>{d(a?ge:void 0)},[d]),i=(0,K.useCallback)(a=>{d((0,I.produce)(c.data||ge,b=>{b.window||(b.window={enabled:!1,size:50}),b.window.enabled=a}))},[c,d]),j=(0,K.useCallback)(a=>{d((0,I.produce)(g||ge,b=>{b.window||(b.window={enabled:!0,size:50});let c=a;""===c?c=null:(isNaN(c=Number.parseInt(c,10))&&(c=50),c<1&&(c=1),c>100&&(c=100)),b.window.size=c}))},[g,d]),k=(0,K.useCallback)(()=>{let a=c.data;a&&(""===a.window.size||null===a.window.size)&&j(50)},[j,c]),l=(0,K.useCallback)(a=>b=>{d((0,I.produce)(c.data||ge,c=>{c.role_prefix||(c.role_prefix={user:"",assistant:""}),c.role_prefix[a]=b}))},[c,d]);return(0,F.jsx)("div",{className:(0,S.cn)(a),children:(0,F.jsx)(fW,{title:f(`${gc}.memory`,{ns:"workflow"}),tooltip:f(`${gc}.memoryTip`,{ns:"workflow"}),operations:(0,F.jsx)(d4.default,{defaultValue:!!g,onChange:h,size:"md",disabled:b}),children:g&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)("div",{className:"flex justify-between",children:[(0,F.jsxs)("div",{className:"flex h-8 items-center space-x-2",children:[(0,F.jsx)(d4.default,{defaultValue:g?.window?.enabled,onChange:i,size:"md",disabled:b}),(0,F.jsx)("div",{className:"system-xs-medium-uppercase text-text-tertiary",children:f(`${gc}.windowSize`,{ns:"workflow"})})]}),(0,F.jsxs)("div",{className:"flex h-8 items-center space-x-2",children:[(0,F.jsx)(d3.default,{className:"w-[144px]",value:g.window?.size||50,min:1,max:100,step:1,onChange:j,disabled:b||!g.window?.enabled}),(0,F.jsx)(a2.default,{value:g.window?.size||50,wrapperClassName:"w-12",className:"appearance-none pr-0",type:"number",min:1,max:100,step:1,onChange:a=>j(a.target.value),onBlur:k,disabled:b||!g.window?.enabled})]})]}),e&&(0,F.jsxs)("div",{className:"mt-4",children:[(0,F.jsx)("div",{className:"text-xs font-medium uppercase leading-6 text-text-tertiary",children:f(`${gc}.conversationRoleName`,{ns:"workflow"})}),(0,F.jsxs)("div",{className:"mt-1 space-y-2",children:[(0,F.jsx)(gd,{readonly:b,title:f(`${gc}.user`,{ns:"workflow"}),value:g.role_prefix?.user||"",onChange:l(aC.MemoryRole.user)}),(0,F.jsx)(gd,{readonly:b,title:f(`${gc}.assistant`,{ns:"workflow"}),value:g.role_prefix?.assistant||"",onChange:l(aC.MemoryRole.assistant)})]})]})]})})})});var gg=a.i(118451),gg=gg,gh=a.i(983857);let gi=({name:a,type:b,description:c,subItems:d,isIndent:e})=>(0,F.jsxs)("div",{className:(0,S.cn)("flex",e&&"relative left-[-7px]"),children:[e&&(0,F.jsx)(gh.default,{depth:1}),(0,F.jsxs)("div",{className:"py-1",children:[(0,F.jsx)("div",{className:"flex",children:(0,F.jsxs)("div",{className:"flex items-center leading-[18px]",children:[(0,F.jsx)("div",{className:"code-sm-semibold text-text-secondary",children:a}),(0,F.jsx)("div",{className:"system-xs-regular ml-2 text-text-tertiary",children:b})]})}),(0,F.jsxs)("div",{className:"system-xs-regular mt-0.5 text-text-tertiary",children:[c,d&&(0,F.jsx)("div",{className:"ml-2 border-l border-gray-200 pl-2",children:d.map((a,b)=>(0,F.jsx)(gi,{name:a.name,type:a.type,description:a.description},b))})]})]})]}),gj=K.memo(({title:a,children:b,operations:c,collapsed:d,onCollapse:e})=>{let{t:f}=(0,$.useTranslation)();return(0,F.jsx)(gg.default,{title:a||f("nodes.common.outputVars",{ns:"workflow"}),operations:c,collapsed:d,onCollapse:e,children:b})});var gk=((w={}).HISTORY_MESSAGES="history-messages",w);let gl="nodes.agent";function gm(a){return{...a,variable:a.name,show_on:[],type:(0,eB.toType)(a.type),tooltip:a.help}}let gn=a=>{var b;let{inputs:c,setInputs:d,currentStrategy:e,formData:f,onFormChange:g,isChatMode:h,availableNodesWithParent:i,availableVars:j,readOnly:k,outputSchema:l,handleMemoryChange:m}=eH(a.id,a.data),{t:n}=(0,$.useTranslation)(),o=!!(b=c.meta?.version)&&(0,fH.isEqualOrLaterThanVersion)(b,"0.0.2"),p=(0,aP.useStore)(a=>a.setControlPromptEditorRerenderKey);return(0,F.jsxs)("div",{className:"my-2",children:[(0,F.jsx)(fW,{required:!0,title:n("nodes.agent.strategy.label",{ns:"workflow"}),className:"px-4 py-2",tooltip:n("nodes.agent.strategy.tooltip",{ns:"workflow"}),children:(0,F.jsx)(gb.MCPToolAvailabilityProvider,{versionSupported:o,children:(0,F.jsx)(ga,{strategy:c.agent_strategy_name?{agent_strategy_provider_name:c.agent_strategy_provider_name,agent_strategy_name:c.agent_strategy_name,agent_strategy_label:c.agent_strategy_label,agent_output_schema:c.output_schema,plugin_unique_identifier:c.plugin_unique_identifier,meta:c.meta}:void 0,onStrategyChange:a=>{d({...c,agent_strategy_provider_name:a?.agent_strategy_provider_name,agent_strategy_name:a?.agent_strategy_name,agent_strategy_label:a?.agent_strategy_label,output_schema:a.agent_output_schema,plugin_unique_identifier:a.plugin_unique_identifier,meta:a?.meta}),p(Date.now())},formSchema:e?.parameters?.map(gm)||[],formValue:f,onFormValueChange:g,nodeOutputVars:j,availableNodes:i,nodeId:a.id})})}),(0,F.jsx)("div",{className:"px-4 py-2",children:h&&e?.features?.includes(gk.HISTORY_MESSAGES)&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(au,{}),(0,F.jsx)(gf,{className:"mt-4",readonly:k,config:{data:c.memory},onChange:m,canSetRoleName:!1})]})}),(0,F.jsx)("div",{children:(0,F.jsxs)(gj,{children:[(0,F.jsx)(gi,{name:"text",type:"String",description:n(`${gl}.outputVars.text`,{ns:"workflow"})}),(0,F.jsx)(gi,{name:"usage",type:"object",description:n(`${gl}.outputVars.usage`,{ns:"workflow"})}),(0,F.jsx)(gi,{name:"files",type:"Array[File]",description:n(`${gl}.outputVars.files.title`,{ns:"workflow"})}),(0,F.jsx)(gi,{name:"json",type:"Array[Object]",description:n(`${gl}.outputVars.json`,{ns:"workflow"})}),l.map(({name:a,type:b,description:c})=>(0,F.jsx)(gi,{name:a,type:b,description:c},a))]})})]})};gn.displayName="AgentPanel";let go=(0,K.memo)(gn);var gp=a.i(7855);a.i(963284);var gq=a.i(339791);let gr="@#!@#!",gs=K.memo(({nodeId:a,value:b,className:c})=>{let d,{getBeforeNodesInSameBranchIncludeParent:e}=(0,aq.useWorkflow)(),f=e(a),g=f.find(a=>a.data.type===aC.BlockEnum.Start),h=(d=[],b.replaceAll(/\{\{#([^#]*)#\}\}/g,(a,b)=>(d.push(b),gr)).split(gr).map((a,b)=>{if(!d[b])return(0,F.jsx)("span",{className:"relative top-[-3px] leading-[16px]",children:a},b);let c=d[b].split("."),e=(0,bY.isSystemVar)(c),h=(e?g:(0,bY.getNodeInfoById)(f,c[0]))?.data,i=c.length>2;return(0,F.jsxs)("span",{children:[(0,F.jsx)("span",{className:"relative top-[-3px] leading-[16px]",children:a}),(0,F.jsx)(gq.VariableLabelInText,{nodeTitle:h?.title,nodeType:h?.type,notShowFullPath:i,variables:c})]},b)}));return(0,F.jsx)("div",{className:(0,S.cn)("break-all text-xs",c),children:h})}),gt=K.memo(({id:a,data:b})=>{let{t:c}=(0,$.useTranslation)();return(0,F.jsx)("div",{className:"mb-1 px-3 py-1",children:(0,F.jsx)(gp.default,{title:c("nodes.answer.answer",{ns:"workflow"}),content:(0,F.jsx)(gs,{value:b.answer,nodeId:a})})})}),gu=K.memo(({id:a,data:b})=>{let{t:c}=(0,$.useTranslation)(),{readOnly:d,inputs:e,handleAnswerChange:f,filterVar:g}=((a,b)=>{let{nodesReadOnly:c}=(0,aq.useNodesReadOnly)(),{inputs:d,setInputs:e}=eA(a,b),{handleVarListChange:f,handleAddVariable:g}=eE({inputs:d,setInputs:e}),h=(0,K.useCallback)(a=>{e((0,I.produce)(d,b=>{b.answer=a}))},[d,e]);return{readOnly:c,inputs:d,handleVarListChange:f,handleAddVariable:g,handleAnswerChange:h,filterVar:(0,K.useCallback)(a=>a.type!==aC.VarType.arrayObject,[])}})(a,b),{availableVars:h,availableNodesWithParent:i}=(0,eD.default)(a,{onlyLeafNodeVar:!1,hideChatVar:!1,hideEnv:!1,filterVar:g});return(0,F.jsx)("div",{className:"mb-2 mt-2 space-y-4 px-4",children:(0,F.jsx)(f9,{readOnly:d,justVar:!0,title:c("nodes.answer.answer",{ns:"workflow"}),value:e.answer,onChange:f,nodesOutputVars:h,availableNodes:i,isSupportFileVar:!0})})});var gv=a.i(6208);let gw="nodes.assigner",gx=K.memo(({data:a})=>{let{t:b}=(0,$.useTranslation)(),c=(0,N.useNodes)();if("2"===a.version){let{items:d}=a;return 0===(d?.filter(a=>a.variable_selector&&a.variable_selector.length>0)||[]).length?(0,F.jsx)("div",{className:"relative flex flex-col items-start gap-0.5 self-stretch px-3 py-1",children:(0,F.jsx)("div",{className:"flex flex-col items-start gap-1 self-stretch",children:(0,F.jsx)("div",{className:"flex items-center gap-1 self-stretch rounded-md bg-workflow-block-parma-bg px-[5px] py-1",children:(0,F.jsx)("div",{className:"system-xs-medium flex-1 text-text-tertiary",children:b(`${gw}.varNotSet`,{ns:"workflow"})})})})}):(0,F.jsx)("div",{className:"relative flex flex-col items-start gap-0.5 self-stretch px-3 py-1",children:d.map((a,d)=>{let e=a.variable_selector;if(!e||0===e.length)return null;let f=(0,bY.isSystemVar)(e)?c.find(a=>a.data.type===aC.BlockEnum.Start):c.find(a=>a.id===e[0]);return(0,F.jsx)(gv.VariableLabelInNode,{variables:e,nodeType:f?.data.type,nodeTitle:f?.data.title,rightSlot:!!a.operation&&(0,F.jsx)(dM.default,{className:"!ml-auto shrink-0",text:b(`${gw}.operations.${a.operation}`,{ns:"workflow"})})},d)})})}let{assigned_variable_selector:d,write_mode:e}=a;if(!d||0===d.length)return null;let f=(0,bY.isSystemVar)(d)?c.find(a=>a.data.type===aC.BlockEnum.Start):c.find(a=>a.id===d[0]);return(0,F.jsx)("div",{className:"relative flex flex-col items-start gap-0.5 self-stretch px-3 py-1",children:(0,F.jsx)(gv.VariableLabelInNode,{variables:d,nodeType:f?.data.type,nodeTitle:f?.data.title,rightSlot:e&&(0,F.jsx)(dM.default,{className:"!ml-auto shrink-0",text:b(`nodes.assigner.operations.${e}`,{ns:"workflow"})})})})});var gy=ds;let gz=K.memo(({children:a})=>(0,F.jsx)("div",{className:"system-xs-regular flex min-h-[42px] w-full items-center justify-center rounded-[10px] bg-background-section text-text-tertiary",children:a}));var gA=a.i(597209),gB=a.i(335913);let gC=K.memo(({value:a,onChange:b})=>{let c=(0,K.useCallback)(a=>()=>{b(a)},[b]);return(0,F.jsxs)("div",{className:"flex w-full space-x-1",children:[(0,F.jsx)(gB.default,{className:"grow",selected:a,title:"True",onSelect:c(!0)}),(0,F.jsx)(gB.default,{className:"grow",selected:!a,title:"False",onSelect:c(!1)})]})});function gD(a){return"divider"!==a.value}let gE=({value:a,onSelect:b,disabled:c=!1,className:d,popupClassName:e,assignedVarType:f,writeModeTypes:g,writeModeTypesArr:h,writeModeTypesNum:i})=>{let{t:j}=(0,$.useTranslation)(),[k,l]=(0,K.useState)(!1),m=f?.startsWith("array")&&h?h.map(a=>({value:a,name:a})):"number"===f&&g&&i?[...g.map(a=>({value:a,name:a})),{value:"divider",name:"divider"},...i.map(a=>({value:a,name:a}))]:g&&["string","boolean","object"].includes(f||"")?g.map(a=>({value:a,name:a})):[],n=m.find(b=>b.value===a);return(0,F.jsxs)(bh.PortalToFollowElem,{open:k,onOpenChange:l,placement:"bottom-start",offset:4,children:[(0,F.jsx)(bh.PortalToFollowElemTrigger,{onClick:()=>!c&&l(a=>!a),children:(0,F.jsxs)("div",{className:(0,S.cn)("flex items-center gap-0.5 rounded-lg bg-components-input-bg-normal px-2 py-1",c?"cursor-not-allowed !bg-components-input-bg-disabled":"cursor-pointer hover:bg-state-base-hover-alt",k&&"bg-state-base-hover-alt",d),children:[(0,F.jsx)("div",{className:"flex items-center p-1",children:(0,F.jsx)("span",{className:`system-sm-regular overflow-hidden truncate text-ellipsis
                ${n?"text-components-input-text-filled":"text-components-input-text-disabled"}`,children:n&&gD(n)?j(`nodes.assigner.operations.${n.name}`,{ns:"workflow"}):j("nodes.assigner.operations.title",{ns:"workflow"})})}),(0,F.jsx)(Y.RiArrowDownSLine,{className:`h-4 w-4 text-text-quaternary ${c&&"text-components-input-text-placeholder"} ${k&&"text-text-secondary"}`})]})}),(0,F.jsx)(bh.PortalToFollowElemContent,{className:`z-20 ${e}`,children:(0,F.jsx)("div",{className:"flex w-[140px] flex-col items-start rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur shadow-lg",children:(0,F.jsxs)("div",{className:"flex flex-col items-start self-stretch p-1",children:[(0,F.jsx)("div",{className:"flex items-start self-stretch px-3 pb-0.5 pt-1",children:(0,F.jsx)("div",{className:"system-xs-medium-uppercase flex grow text-text-tertiary",children:j("nodes.assigner.operations.title",{ns:"workflow"})})}),m.map(c=>gD(c)?(0,F.jsxs)("div",{className:(0,S.cn)("flex items-center gap-1 self-stretch rounded-lg px-2 py-1","cursor-pointer hover:bg-state-base-hover"),onClick:()=>{b(c),l(!1)},children:[(0,F.jsx)("div",{className:"flex min-h-5 grow items-center gap-1 px-1",children:(0,F.jsx)("span",{className:"system-sm-medium flex grow text-text-secondary",children:j(`nodes.assigner.operations.${c.name}`,{ns:"workflow"})})}),c.value===a&&(0,F.jsx)("div",{className:"flex items-center justify-center",children:(0,F.jsx)(Y.RiCheckLine,{className:"h-4 w-4 text-text-accent"})})]},c.value):(0,F.jsx)(bA.default,{className:"my-1"},"divider"))]})})})]})},gF=K.memo(({readonly:a,nodeId:b,list:c,onChange:d,onOpen:e=gy.noop,filterVar:f,filterToAssignedVar:g,getAssignedVarType:h,getToAssignedVarType:i,writeModeTypes:j,writeModeTypesArr:k,writeModeTypesNum:l})=>{let{t:m}=(0,$.useTranslation)(),n=(0,K.useCallback)(a=>b=>{d((0,I.produce)(c,c=>{c[a].variable_selector=b,c[a].operation=b3.overwrite,c[a].input_type=b4.variable,c[a].value=void 0}),b)},[c,d]),o=(0,K.useCallback)((a,b)=>e=>{d((0,I.produce)(c,c=>{c[a].operation=e.value,c[a].value="",e.value===b3.set||e.value===b3.increment||e.value===b3.decrement||e.value===b3.multiply||e.value===b3.divide?(b===aC.VarType.boolean&&(c[a].value=!1),c[a].input_type=b4.constant):c[a].input_type=b4.variable}))},[c,d]),p=(0,K.useCallback)(a=>b=>{d((0,I.produce)(c,c=>{c[a].value=b}),b)},[c,d]),q=(0,K.useCallback)(a=>()=>{d((0,I.produce)(c,b=>{b.splice(a,1)}))},[c,d]),r=(0,K.useCallback)(a=>()=>e(a),[e]),s=(0,K.useCallback)(a=>b=>{let{variable_selector:d,operation:e}=c[a];if(!d||!e||!g)return!0;let f=h?.(d);return!(Array.isArray(d)&&d.join(".")===`${b.nodeId}.${b.variable}`)&&(!f||g(b,f,e))},[c,g,h]);return 0===c.length?(0,F.jsx)(gz,{children:m("nodes.assigner.noVarTip",{ns:"workflow"})}):(0,F.jsx)("div",{className:"flex flex-col items-start gap-4 self-stretch",children:c.map((c,d)=>{let e=c.variable_selector?h?.(c.variable_selector):void 0,g=e&&c.operation&&i?i(e,c.operation):void 0;return(0,F.jsxs)("div",{className:"flex items-start gap-1 self-stretch",children:[(0,F.jsxs)("div",{className:"flex grow flex-col items-start gap-1",children:[(0,F.jsxs)("div",{className:"flex items-center gap-1 self-stretch",children:[(0,F.jsx)(gA.default,{readonly:a,nodeId:b,isShowNodeName:!0,value:c.variable_selector||[],onChange:n(d),onOpen:r(d),filterVar:f,placeholder:m("nodes.assigner.selectAssignedVariable",{ns:"workflow"}),minWidth:352,popupFor:"assigned",className:"w-full"}),(0,F.jsx)(gE,{value:c.operation,placeholder:"Operation",disabled:!c.variable_selector||0===c.variable_selector.length,onSelect:o(d,e),assignedVarType:e,writeModeTypes:j,writeModeTypesArr:k,writeModeTypesNum:l})]}),c.operation!==b3.clear&&c.operation!==b3.set&&c.operation!==b3.removeFirst&&c.operation!==b3.removeLast&&!l?.includes(c.operation)&&(0,F.jsx)(gA.default,{readonly:a||!c.variable_selector||!c.operation,nodeId:b,isShowNodeName:!0,value:c.value,onChange:p(d),filterVar:s(d),valueTypePlaceHolder:g,placeholder:m("nodes.assigner.setParameter",{ns:"workflow"}),minWidth:352,popupFor:"toAssigned",className:"w-full"}),!!(c.operation===b3.set&&e)&&(0,F.jsxs)(F.Fragment,{children:["number"===e&&(0,F.jsx)(a2.default,{type:"number",value:c.value,onChange:a=>p(d)(Number(a.target.value)),className:"w-full"}),"string"===e&&(0,F.jsx)(a5.default,{value:c.value,onChange:a=>p(d)(a.target.value),className:"w-full"}),"boolean"===e&&(0,F.jsx)(gC,{value:c.value,onChange:a=>p(d)(a)}),"object"===e&&(0,F.jsx)(a7.default,{value:c.value,language:a6.CodeLanguage.json,onChange:a=>p(d)(a),className:"w-full",readOnly:a})]}),l?.includes(c.operation)&&(0,F.jsx)(a2.default,{type:"number",value:c.value,onChange:a=>p(d)(Number(a.target.value)),placeholder:"Enter number value...",className:"w-full"})]}),(0,F.jsx)(fX.default,{size:"l",className:"group shrink-0 hover:!bg-state-destructive-hover",onClick:q(d),children:(0,F.jsx)(Y.RiDeleteBinLine,{className:"h-4 w-4 text-text-tertiary group-hover:text-text-destructive"})})]},d)})})}),gG=K.memo(({id:a,data:b})=>{let{t:c}=(0,$.useTranslation)(),d=(0,K.useCallback)(a=>[...a,{variable_selector:[],write_mode:b3.overwrite,input_type:b4.variable,value:""}],[]),{readOnly:e,inputs:f,handleOperationListChanges:g,getAssignedVarType:h,getToAssignedVarType:i,writeModeTypesNum:j,writeModeTypesArr:k,writeModeTypes:l,filterAssignedVar:m,filterToAssignedVar:n}=((a,b)=>{let c=(0,K.useMemo)(()=>"2"===b.version&&b.items?b:{version:"2",items:[{variable_selector:b.assigned_variable_selector||[],input_type:b4.variable,operation:(a=>{switch(a){case"over-write":default:return b3.overwrite;case"append":return b3.append;case"clear":return b3.clear}})(b.write_mode),value:b.input_variable_selector||[]}],...b},[b]),{nodesReadOnly:d}=(0,aq.useNodesReadOnly)(),e=(0,aq.useIsChatMode)(),f=(()=>{let a=(0,N.useNodes)(),{getBeforeNodesInSameBranchIncludeParent:b}=(0,aq.useWorkflow)(),{getNodeAvailableVars:c}=(0,e5.useWorkflowVariables)(),d=(0,aq.useIsChatMode)();return(0,K.useCallback)((e,f,g,h=!1)=>{let i=[],j=a.find(a=>a.id===e);if(!j)return[];let k=b(e);i.push(...k);let l=a.find(a=>a.id===j.parentId);return h?c({parentNode:l,beforeNodes:(0,e6.uniqBy)(i,"id").filter(a=>a.id!==e),isChatMode:d,hideEnv:h,hideChatVar:h,filterVar:g}).map(a=>({...a,vars:a.isStartNode?a.vars.filter(a=>!a.variable.startsWith("sys.")):a.vars})).filter(a=>a.vars.length>0):c({parentNode:l,beforeNodes:(0,e6.uniqBy)(i,"id").filter(a=>a.id!==e),isChatMode:d,filterVar:g})},[a,b,c,d])})(),g=(0,N.useStoreApi)(),{getBeforeNodesInSameBranchIncludeParent:h}=(0,aq.useWorkflow)(),{getNodes:i}=g.getState(),j=i().find(b=>b.id===a),k=c.isInIteration,l=k?i().find(a=>a.id===j.parentId):null,m=(0,K.useMemo)(()=>h(a),[h,a]),{inputs:n,setInputs:o}=eA(a,c),p=(0,K.useCallback)(a=>{o((0,I.produce)(a,a=>{"2"!==a.version&&(a.version="2")}))},[o]),{getCurrentVariableType:q}=(0,e5.useWorkflowVariables)(),r=(0,K.useCallback)(a=>q({parentNode:k?l:null,valueSelector:a||[],availableNodes:m,isChatMode:e,isConstant:!1}),[q,k,l,m,e]),s=(0,K.useCallback)(a=>{p((0,I.produce)(n,b=>{b.items=[...a]}))},[n,p]),t=[b3.overwrite,b3.clear,b3.append,b3.extend,b3.removeFirst,b3.removeLast],u=[b3.overwrite,b3.clear,b3.set],v=(0,K.useCallback)((a,b)=>{if(b===b3.overwrite||b===b3.increment||b===b3.decrement||b===b3.multiply||b===b3.divide||b===b3.extend)return a;if(b===b3.append){if(a===aC.VarType.arrayString)return aC.VarType.string;if(a===aC.VarType.arrayNumber)return aC.VarType.number;if(a===aC.VarType.arrayObject)return aC.VarType.object}return aC.VarType.string},[]);return{readOnly:d,inputs:n,handleOperationListChanges:s,getAssignedVarType:r,getToAssignedVarType:v,writeModeTypes:u,writeModeTypesArr:t,writeModeTypesNum:b5,filterAssignedVar:(0,K.useCallback)((a,b)=>!!a.isLoopVariable||b.join(".").startsWith("conversation"),[]),filterToAssignedVar:(0,K.useCallback)((a,b,c)=>{if(c===b3.overwrite||c===b3.extend||c===b3.increment||c===b3.decrement||c===b3.multiply||c===b3.divide)return a.type===b;if(c===b3.append)switch(b){case aC.VarType.arrayString:return a.type===aC.VarType.string;case aC.VarType.arrayNumber:return a.type===aC.VarType.number;case aC.VarType.arrayObject:return a.type===aC.VarType.object;default:return!1}return!0},[]),getAvailableVars:f,filterVar:a=>b=>a===aC.VarType.any||b.type===aC.VarType.any||b.type===a}})(a,b);return(0,F.jsx)("div",{className:"flex flex-col items-start self-stretch py-2",children:(0,F.jsxs)("div",{className:"flex w-full flex-col items-start justify-center gap-1 self-stretch px-4 py-2",children:[(0,F.jsxs)("div",{className:"flex items-start gap-2 self-stretch",children:[(0,F.jsx)("div",{className:"system-sm-semibold-uppercase flex grow flex-col items-start justify-center text-text-secondary",children:c("nodes.assigner.variables",{ns:"workflow"})}),(0,F.jsx)(fX.default,{onClick:()=>{g(d(f.items||[]))},children:(0,F.jsx)(Y.RiAddLine,{className:"h-4 w-4 shrink-0 text-text-tertiary"})})]}),(0,F.jsx)(gF,{readonly:e,nodeId:a,list:f.items||[],onChange:a=>{g(a)},filterVar:m,filterToAssignedVar:n,getAssignedVarType:h,writeModeTypes:l,writeModeTypesArr:k,writeModeTypesNum:j,getToAssignedVarType:i})]})})}),gH=K.memo(()=>(0,F.jsx)("div",{})),gI=K.memo(({className:a,popupContent:b="",onClick:c})=>(0,F.jsx)(ac.default,{popupContent:b,children:(0,F.jsx)("div",{className:(0,S.cn)(a,"cursor-pointer select-none rounded-md p-1 hover:bg-state-base-hover"),onClick:c,children:(0,F.jsx)(Y.RiRefreshLine,{className:"h-4 w-4 text-text-tertiary"})})}));var gJ=a.i(60732),gK=a.i(981133),gL=a.i(253102),gM=a.i(332945);let gN=[aC.VarType.string,aC.VarType.number,aC.VarType.boolean,aC.VarType.arrayNumber,aC.VarType.arrayString,aC.VarType.arrayBoolean,aC.VarType.arrayObject,aC.VarType.object],gO=K.memo(({readonly:a,className:b,value:c,onChange:d})=>{let[e,f]=(0,K.useState)(!1),g=(0,K.useCallback)(a=>()=>{f(!1),d(a)},[d]);return(0,F.jsx)("div",{className:(0,S.cn)(b,!a&&"cursor-pointer select-none"),children:(0,F.jsxs)(bh.PortalToFollowElem,{open:e,onOpenChange:f,placement:"bottom-start",offset:4,children:[(0,F.jsx)(bh.PortalToFollowElemTrigger,{onClick:()=>f(!e),className:"w-[120px] cursor-pointer",children:(0,F.jsxs)("div",{className:"flex h-8 items-center justify-between rounded-lg border-0 bg-components-input-bg-normal px-2.5 text-[13px] text-text-primary",children:[(0,F.jsx)("div",{className:"w-0 grow truncate capitalize",title:c,children:c}),(0,F.jsx)(Y.RiArrowDownSLine,{className:"h-3.5 w-3.5 shrink-0 text-text-secondary"})]})}),(0,F.jsx)(bh.PortalToFollowElemContent,{style:{zIndex:100},children:(0,F.jsx)("div",{className:"w-[120px] rounded-lg bg-components-panel-bg p-1 shadow-sm",children:gN.map(a=>(0,F.jsxs)("div",{className:"flex h-[30px] cursor-pointer items-center justify-between rounded-lg pl-3 pr-2 text-[13px] text-text-primary hover:bg-state-base-hover",onClick:g(a),children:[(0,F.jsx)("div",{className:"w-0 grow truncate capitalize",children:a}),a===c&&(0,F.jsx)(gM.Check,{className:"h-4 w-4 shrink-0 text-text-accent"})]},a))})})]})})}),gP=K.memo(({readonly:a,outputs:b,outputKeyOrders:c,onChange:d,onRemove:e})=>{let{t:f}=(0,$.useTranslation)(),[g,h]=(0,K.useState)(),i=c.map(a=>({variable:a,variable_type:b[a]?.type})),{run:j}=(0,gK.useDebounceFn)((a,b)=>{let c=(0,by.checkKeys)([b],!0);c.isValid?a.some(a=>a.variable?.trim()===b.trim())?h(aX.default.notify({type:"error",message:f("varKeyError.keyAlreadyExists",{ns:"appDebug",key:b})})):g?.clear?.():h(aX.default.notify({type:"error",message:f(`varKeyError.${c.errorMessageKey}`,{ns:"appDebug",key:c.errorKey})}))},{wait:500}),k=(0,K.useCallback)(a=>c=>{let e=i[a].variable;(0,by.replaceSpaceWithUnderscoreInVarNameInput)(c.target);let f=c.target.value;g?.clear?.(),j(i.toSpliced(a,1),f),d((0,I.produce)(b,a=>{a[f]=a[e],delete a[e]}),a,f)},[i,d,b,c,j]),l=(0,K.useCallback)(a=>c=>{let e=i[a].variable;d((0,I.produce)(b,a=>{a[e].type=c}))},[i,d,b,c]),m=(0,K.useCallback)(a=>()=>{e(a)},[e]);return(0,F.jsx)("div",{className:"space-y-2",children:i.map((b,c)=>(0,F.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,F.jsx)(a2.default,{readOnly:a,value:b.variable,onChange:k(c),wrapperClassName:"grow"}),(0,F.jsx)(gO,{readonly:a,value:b.variable_type,onChange:l(c)}),(0,F.jsx)(gL.default,{className:"!bg-gray-100 !p-2 hover:!bg-gray-200",onClick:m(c)})]},c))})});var gQ=a.i(188405);let gR=K.memo(({nodeId:a,readonly:b,list:c,onChange:d,onVarNameChange:e,isSupportConstantValue:f,onlyLeafNodeVar:g,filterVar:h,isSupportFileVar:i=!0})=>{let{t:j}=(0,$.useTranslation)(),[k,l]=(0,K.useState)(),m=(0,K.useMemo)(()=>c.map(a=>({id:(0,du.v4)(),variable:{...a}})),[c]),{run:n}=(0,gK.useDebounceFn)((a,b)=>{let c=(0,by.checkKeys)([b],!0);c.isValid?a.some(a=>a.variable?.trim()===b.trim())?l(aX.default.notify({type:"error",message:j("varKeyError.keyAlreadyExists",{ns:"appDebug",key:b})})):k?.clear?.():l(aX.default.notify({type:"error",message:j(`varKeyError.${c.errorMessageKey}`,{ns:"appDebug",key:c.errorKey})}))},{wait:500}),o=(0,K.useCallback)(a=>b=>{(0,by.replaceSpaceWithUnderscoreInVarNameInput)(b.target);let f=b.target.value;k?.clear?.(),n(c.toSpliced(a,1),f),e?.(c[a].variable,f),d((0,I.produce)(c,b=>{b[a].variable=f}))},[c,e,d,n]),p=(0,K.useCallback)(a=>(b,e,g)=>{d((0,I.produce)(c,c=>{if(f&&e!==eF.VarType.variable)c[a].variable_type=eF.VarType.constant,c[a].value_selector=b,c[a].value=b;else if(c[a].value_selector=b,c[a].value_type=g?.type,f&&(c[a].variable_type=eF.VarType.variable),!c[a].variable){let d=c.map(a=>a.variable),e=b[b.length-1],f=1;for(;d.includes(e);)e=`${b[b.length-1]}_${f}`,f++;c[a].variable=e}}))},[f,c,d]),q=(0,K.useCallback)(a=>()=>{d((0,I.produce)(c,b=>{b.splice(a,1)}))},[c,d]),r=c.length;return(0,F.jsx)(gQ.ReactSortable,{className:"space-y-2",list:m,setList:a=>{d(a.map(a=>a.variable))},handle:".handle",ghostClass:"opacity-50",animation:150,children:c.map((c,d)=>{let e=!b&&r>1;return(0,F.jsxs)("div",{className:(0,S.cn)("flex items-center space-x-1","group relative"),children:[(0,F.jsx)(a2.default,{wrapperClassName:"w-[120px]",disabled:b,value:c.variable,onChange:o(d),placeholder:j("common.variableNamePlaceholder",{ns:"workflow"})}),(0,F.jsx)(gA.default,{nodeId:a,readonly:b,isShowNodeName:!0,className:"grow",value:c.variable_type===eF.VarType.constant?c.value||"":c.value_selector||[],isSupportConstantValue:f,onChange:p(d),defaultVarKindType:c.variable_type,onlyLeafNodeVar:g,filterVar:h,isSupportFileVar:i}),!b&&(0,F.jsx)(gL.default,{onClick:q(d)}),e&&(0,F.jsx)(Y.RiDraggable,{className:(0,S.cn)("handle absolute -left-4 top-2.5 hidden h-3 w-3 cursor-pointer text-text-quaternary","group-hover:block")})]},d)})})});var gS=a.i(42550);let gT="common.effectVarConfirm",gU=K.memo(({isShow:a,onConfirm:b,onCancel:c})=>{let{t:d}=(0,$.useTranslation)();return(0,F.jsx)(gS.default,{isShow:a,title:d(`${gT}.title`,{ns:"workflow"}),content:d(`${gT}.content`,{ns:"workflow"}),onConfirm:b,onCancel:c})});a.s(["default",0,gU],268830);let gV=function({id:a,inputs:b,setInputs:c,varKey:d="outputs",outputKeyOrders:e=[],onOutputKeyOrdersChange:f}){let{renameInspectVarName:g,deleteInspectVar:h,nodesWithInspectVars:i}=(0,at.default)(),{handleOutVarRenameChange:j,isVarUsedInNodes:k,removeUsedVarInNodes:l}=(0,aq.useWorkflow)(),m=(0,K.useRef)({}),{run:n}=(0,gK.useDebounceFn)((a,b)=>{let c=m.current[a];g(a,c,b),delete m.current[a]},{wait:500}),o=(0,K.useCallback)((g,k,l)=>{if(c((0,I.produce)(b,a=>{a[d]=g,b.type===aC.BlockEnum.Code&&b.error_strategy===bi.ErrorHandleTypeEnum.defaultValue&&"outputs"===d&&(a.default_value=bo(a))})),void 0!==k&&f((0,I.produce)(e,a=>{a[k]=l})),l)j(a,[a,e[k]],[a,l]),a in m.current||(m.current[a]=e[k]),n(a,l);else if(void 0===k){let b=i.find(b=>b.nodeId===a)?.vars.find(a=>a.name===Object.keys(g)[0])?.id;b&&h(a,b)}},[b,c,d,e,f,j,a,n,i,h]),p=(0,K.useCallback)(()=>{let a=Object.keys(b[d]).length+1;for(;b[d][`var_${a}`];)a++;return`var_${a}`},[b,d]),q=(0,K.useCallback)(()=>{let a=p();c((0,I.produce)(b,c=>{c[d]={...c[d],[a]:{type:aC.VarType.string,children:null}},b.type===aC.BlockEnum.Code&&b.error_strategy===bi.ErrorHandleTypeEnum.defaultValue&&"outputs"===d&&(c.default_value=bo(c))})),f([...e,a])},[p,b,c,f,e,d]),[r,{setTrue:s,setFalse:t}]=(0,a8.useBoolean)(!1),[u,v]=(0,K.useState)([]),w=(0,K.useCallback)(()=>{let b=i.find(b=>b.nodeId===a)?.vars.find(a=>a.name===u[1])?.id;b&&h(a,b),l(u),t()},[h,t,a,i,l,u]);return{handleVarsChange:o,handleAddVariable:q,handleRemoveVariable:(0,K.useCallback)(g=>{let j=e[g];if(k([a,j])){s(),v([a,j]);return}c((0,I.produce)(b,a=>{delete a[d][j],b.type===aC.BlockEnum.Code&&b.error_strategy===bi.ErrorHandleTypeEnum.defaultValue&&"outputs"===d&&(a.default_value=bo(a))})),f(e.filter((a,b)=>b!==g));let l=i.find(b=>b.nodeId===a)?.vars.find(a=>a.name===j)?.id;l&&h(a,l)},[e,k,a,b,c,f,i,h,s,d]),isShowRemoveVarConfirm:r,hideRemoveVarConfirm:t,onRemoveVarConfirm:w}},gW="nodes.code",gX=[{label:"Python3",value:a6.CodeLanguage.python3},{label:"JavaScript",value:a6.CodeLanguage.javascript}],gY=K.memo(({id:a,data:b})=>{let{t:c}=(0,$.useTranslation)(),{readOnly:d,inputs:e,outputKeyOrders:f,handleCodeAndVarsChange:g,handleVarListChange:h,handleAddVariable:i,handleRemoveVariable:j,handleSyncFunctionSignature:k,handleCodeChange:l,handleCodeLanguageChange:m,handleVarsChange:n,handleAddOutputVariable:o,filterVar:p,isShowRemoveVarConfirm:q,hideRemoveVarConfirm:r,onRemoveVarConfirm:s}=((a,b)=>{let{nodesReadOnly:c}=(0,aq.useNodesReadOnly)(),d=(0,aP.useStore)(a=>a.appId),e=(0,aP.useStore)(a=>a.pipelineId),[f,g]=(0,K.useState)(null);(0,K.useEffect)(()=>{d&&(async()=>{let{config:a}=await (0,R.fetchNodeDefault)(d,aC.BlockEnum.Code,{code_language:a6.CodeLanguage.javascript}),{config:b}=await (0,R.fetchNodeDefault)(d,aC.BlockEnum.Code,{code_language:a6.CodeLanguage.python3});g({[a6.CodeLanguage.javascript]:a,[a6.CodeLanguage.python3]:b})})()},[d]),(0,K.useEffect)(()=>{e&&(async()=>{let{config:a}=await (0,R.fetchPipelineNodeDefault)(e,aC.BlockEnum.Code,{code_language:a6.CodeLanguage.javascript}),{config:b}=await (0,R.fetchPipelineNodeDefault)(e,aC.BlockEnum.Code,{code_language:a6.CodeLanguage.python3});g({[a6.CodeLanguage.javascript]:a,[a6.CodeLanguage.python3]:b})})()},[e]);let h=(0,aP.useStore)(a=>a.nodesDefaultConfigs)?.[b.type],{inputs:i,setInputs:j}=eA(a,b),{handleVarListChange:k,handleAddVariable:l}=eE({inputs:i,setInputs:j}),[m,n]=(0,K.useState)([]),o=(0,K.useCallback)(a=>{n(Object.keys(a))},[]);(0,K.useEffect)(()=>{if(i.code){i.outputs&&Object.keys(i.outputs).length>0&&o(i.outputs);return}h&&Object.keys(h).length>0&&(j({...i,...h}),o(h.outputs))},[h]);let p=(0,K.useCallback)(a=>{j((0,I.produce)(i,b=>{b.code=a}))},[i,j]),q=(0,K.useCallback)(a=>{let b=f?.[a];j((0,I.produce)(i,c=>{c.code_language=a,b&&(c.code=b.code,c.variables=b.variables,c.outputs=b.outputs)}))},[f,i,j]),r=(0,K.useCallback)(()=>{j((0,I.produce)(i,a=>{a.code=(a=>{let b,c;if(i.code_language===a6.CodeLanguage.javascript){b=/function\s+main\b\s*\([\s\S]*?\)/g,c="function main({{var_list}})";let a=i.variables?.map(a=>a.variable).join(", ")||"";a=a?`{${a}}`:"",c=c.replace("{{var_list}}",a)}else{if(i.code_language!==a6.CodeLanguage.python3)return a;b=/def\s+main\b\s*\([\s\S]*?\)/g;let d=[];for(let a of i.variables){let b=a.variable,c="";switch(a.value_type){case aC.VarType.string:c=": str";break;case aC.VarType.number:c=": float";break;case aC.VarType.object:c=": dict";break;case aC.VarType.array:c=": list";break;case aC.VarType.arrayNumber:c=": list[float]";break;case aC.VarType.arrayString:c=": list[str]";break;case aC.VarType.arrayObject:c=": list[dict]"}b+=c,d.push(`${b}`)}c=`def main(${d.join(", ")})`}return a.replace(b,c)})(a.code)}))},[i,j]),{handleVarsChange:s,handleAddVariable:t,handleRemoveVariable:u,isShowRemoveVarConfirm:v,hideRemoveVarConfirm:w,onRemoveVarConfirm:x}=gV({id:a,inputs:i,setInputs:j,outputKeyOrders:m,onOutputKeyOrdersChange:n}),y=(0,K.useCallback)(a=>[aC.VarType.string,aC.VarType.number,aC.VarType.boolean,aC.VarType.secret,aC.VarType.object,aC.VarType.array,aC.VarType.arrayNumber,aC.VarType.arrayString,aC.VarType.arrayObject,aC.VarType.arrayBoolean,aC.VarType.file,aC.VarType.arrayFile].includes(a.type),[]),z=(0,K.useCallback)((a,b,c)=>{j((0,I.produce)(i,d=>{d.code=a,d.variables=b,d.outputs=c})),o(c)},[i,j,o]);return{readOnly:c,inputs:i,outputKeyOrders:m,handleVarListChange:k,handleAddVariable:l,handleRemoveVariable:u,handleSyncFunctionSignature:r,handleCodeChange:p,handleCodeLanguageChange:q,handleVarsChange:s,filterVar:y,handleAddOutputVariable:t,isShowRemoveVarConfirm:v,hideRemoveVarConfirm:w,onRemoveVarConfirm:x,handleCodeAndVarsChange:z}})(a,b);return(0,F.jsxs)("div",{className:"mt-2",children:[(0,F.jsxs)("div",{className:"space-y-4 px-4 pb-4",children:[(0,F.jsx)(fW,{title:c(`${gW}.inputVars`,{ns:"workflow"}),operations:d?void 0:(0,F.jsxs)("div",{className:"flex gap-2",children:[(0,F.jsx)(gI,{popupContent:c(`${gW}.syncFunctionSignature`,{ns:"workflow"}),onClick:k}),(0,F.jsx)(aY.default,{onClick:i})]}),children:(0,F.jsx)(gR,{readonly:d,nodeId:a,list:e.variables,onChange:h,filterVar:p,isSupportFileVar:!1})}),(0,F.jsx)(au,{}),(0,F.jsx)(a7.default,{nodeId:a,isInNode:!0,readOnly:d,title:(0,F.jsx)(gJ.default,{options:gX,value:e.code_language,onChange:m}),language:e.code_language,value:e.code,onChange:l,onGenerated:a=>{let b=((a,b)=>{if(b===a6.CodeLanguage.json)return[];let c=({[a6.CodeLanguage.python3]:/def\s+main\s*\((.*?)\)/,[a6.CodeLanguage.javascript]:/function\s+main\s*\((.*?)\)/})[b].exec(a),d=[];return c?.[1]&&d.push(...c[1].split(",").map(a=>a.trim()).filter(Boolean).map(a=>a.split(":")[0].trim())),d})(a,e.code_language).map(a=>({variable:a,value_selector:[]})),c=((a,b)=>{let c=a.replace(/\/\*\*[\s\S]*?\*\//,""),d=c.indexOf("return");if(-1===d)return{};let e=c.slice(d),f=0,g=e.indexOf("{");if(b===a6.CodeLanguage.javascript&&-1===g){let a=e.indexOf("(");-1!==a&&(g=e.indexOf("{",a))}if(-1===g)return{};let h=-1;for(let a=g;a<e.length;a++)if("{"===e[a]&&f++,"}"===e[a]&&0==--f){h=a+1;break}if(-1===h)return{};let i=e.slice(g+1,h-1),j={};for(let a of i.matchAll(/['"]?(\w+)['"]?\s*:(?![^{]*\})/g))j[a[1]]={type:aC.VarType.string,children:null};return j})(a,e.code_language);g(a,b,c)},showCodeGenerator:!0})]}),(0,F.jsx)(au,{}),(0,F.jsx)("div",{className:"px-4 pb-2 pt-4",children:(0,F.jsx)(fW,{title:c(`${gW}.outputVars`,{ns:"workflow"}),operations:(0,F.jsx)(aY.default,{onClick:o}),required:!0,children:(0,F.jsx)(gP,{readonly:d,outputs:e.outputs,outputKeyOrders:f,onChange:n,onRemove:j})})}),(0,F.jsx)(gU,{isShow:q,onCancel:r,onConfirm:s})]})}),gZ=a=>{let b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F=(b=(0,Q.useAllBuiltInTools)(),c=(0,Q.useAllCustomTools)(),d=(0,Q.useAllWorkflowTools)(),e=(0,Q.useAllMCPTools)(),f=(0,Q.useInvalidToolsByType)(a.provider_type),g=(0,K.useMemo)(()=>{switch(a.provider_type){case bN.CollectionType.builtIn:return{list:b.data,isLoading:b.isLoading};case bN.CollectionType.custom:return{list:c.data,isLoading:c.isLoading};case bN.CollectionType.workflow:return{list:d.data,isLoading:d.isLoading};case bN.CollectionType.mcp:return{list:e.data,isLoading:e.isLoading};default:return}},[b.data,b.isLoading,c.data,c.isLoading,a.provider_type,e.data,e.isLoading,d.data,d.isLoading]),h=g?.list,i=g?.isLoading??!1,j=!!g&&!i,k=(0,K.useMemo)(()=>{if(h&&h.length)return h.find(b=>!!(a.plugin_id&&b.plugin_id===a.plugin_id||(0,aU.canFindTool)(b.id,a.provider_id))||b.name===a.provider_name)},[h,a.plugin_id,a.provider_id,a.provider_name]),l=a.plugin_unique_identifier||a.plugin_id||a.provider_id,m=!!a.plugin_unique_identifier,n=(0,K.useCallback)(()=>{f&&f()},[f]),o=!!g&&!j||j&&!k,{isChecking:!!g&&!j,isMissing:j&&!k,uniqueIdentifier:l,canInstall:m,onInstallSuccess:n,shouldDim:o}),G=(p=(0,aT.useAllTriggerPlugins)(),q=(0,aT.useInvalidateAllTriggerPlugins)(),r=p.data,s=p.isLoading,t=(0,K.useMemo)(()=>{if(r&&r.length)return r.find(b=>b.name===a.provider_name||b.id===a.provider_id||a.plugin_id&&b.plugin_id===a.plugin_id)},[a.plugin_id,a.provider_id,a.provider_name,r]),u=a.plugin_unique_identifier||a.plugin_id||a.provider_id,v=!!a.plugin_unique_identifier,w=(0,K.useCallback)(()=>{q()},[q]),x=s||!s&&!!r&&!t,{isChecking:s,isMissing:!s&&!!r&&!t,uniqueIdentifier:u,canInstall:v,onInstallSuccess:w,shouldDim:x}),H=(y=(0,aP.useStore)(a=>a.dataSourceList),z=(0,aG.useInvalidDataSourceList)(),A=(0,K.useMemo)(()=>{if(y&&y.length)return y.find(b=>!!a.plugin_unique_identifier&&b.plugin_unique_identifier===a.plugin_unique_identifier||!!a.plugin_id&&b.plugin_id===a.plugin_id||!!a.provider_name&&b.provider===a.provider_name)},[a.plugin_id,a.plugin_unique_identifier,a.provider_name,y]),B=a.plugin_unique_identifier||a.plugin_id,C=!!a.plugin_unique_identifier,D=(0,K.useCallback)(()=>{z()},[z]),{isChecking:!(E=void 0!==y),isMissing:E&&!A,uniqueIdentifier:B,canInstall:C,onInstallSuccess:D,shouldDim:!E||E&&!A});switch(a.type){case aC.BlockEnum.Tool:return F;case aC.BlockEnum.TriggerPlugin:return G;case aC.BlockEnum.DataSource:return H;default:return{isChecking:!1,isMissing:!1,uniqueIdentifier:void 0,canInstall:!1,onInstallSuccess:()=>void 0,shouldDim:!1}}},g$=(0,K.memo)(({id:a,data:b})=>{let{isChecking:c,isMissing:d,uniqueIdentifier:e,canInstall:f,onInstallSuccess:g,shouldDim:h}=gZ(b),{handleNodeDataUpdate:i}=(0,ao.useNodeDataUpdate)(),j=!c&&d&&f&&!!e;return((0,K.useEffect)(()=>{(b._pluginInstallLocked!==j||b._dimmed!==h)&&i({id:a,data:{_pluginInstallLocked:j,_dimmed:h}})},[b._pluginInstallLocked,b._dimmed,i,a,h,j]),!c&&d&&f&&e)?(0,F.jsx)("div",{className:"relative mb-1 px-3 py-1",children:(0,F.jsx)("div",{className:"pointer-events-auto absolute right-3 top-[-32px] z-40",children:(0,F.jsx)(fR.InstallPluginButton,{size:"small",extraIdentifiers:[b.plugin_id,b.provider_name].filter(Boolean),className:"!font-medium !text-text-accent",uniqueIdentifier:e,onSuccess:g})})}):null});var g_=a.i(144244);let g0=(0,K.memo)(({className:a,children:b,withBorderBottom:c})=>(0,F.jsx)("div",{className:(0,S.cn)("py-2",c&&"border-b border-divider-subtle",a),children:b})),g1=(0,K.memo)(({className:a,children:b,withBorderBottom:c})=>(0,F.jsx)("div",{className:(0,S.cn)("px-4 py-2",c&&"border-b border-divider-subtle",a),children:b})),g2=(0,K.memo)(({children:a,boxProps:b,groupProps:c})=>(0,F.jsx)(g0,{...b,children:(0,F.jsx)(g1,{...c,children:a})}));a.i(658335);var g3=a.i(586478);let g4=(0,K.memo)(({title:a,operation:b,subTitle:c,tooltip:d,showArrow:e,disabled:f,collapsed:g,onCollapse:h})=>{let[i,j]=(0,K.useState)(!0),k=void 0!==g?g:i;return(0,F.jsxs)("div",{className:(0,S.cn)("mb-0.5",!!c&&"mb-1"),children:[(0,F.jsxs)("div",{className:"group/collapse flex items-center justify-between py-1",onClick:()=>{f||(j(!k),h?.(!k))},children:[(0,F.jsxs)("div",{className:"system-sm-semibold-uppercase flex items-center text-text-secondary",children:[a,e&&(0,F.jsx)(g3.ArrowDownRoundFill,{className:(0,S.cn)("h-4 w-4 cursor-pointer text-text-quaternary group-hover/collapse:text-text-secondary",k&&"rotate-[270deg]")}),d&&(0,F.jsx)(ac.default,{popupContent:d,triggerClassName:"w-4 h-4 ml-1"})]}),b]}),c]})}),g5=(0,K.memo)(({fieldTitleProps:a,children:b,supportCollapse:c,disabled:d})=>{let[e,f]=(0,K.useState)(!1);return(0,F.jsxs)("div",{children:[(0,F.jsx)(g4,{...a,collapsed:e,onCollapse:f,showArrow:c,disabled:d}),c&&!e&&b,!c&&b]})}),g6=(0,K.memo)(({children:a,fieldProps:b,boxGroupProps:c})=>(0,F.jsx)(g2,{...c,children:(0,F.jsx)(g5,{...b,children:a})}));var g7=a.i(568852);let g8=K.memo(({payload:a,rootClassName:b})=>{let{t:c}=(0,$.useTranslation)(),d={...a,schema:{...a.schema,description:c("structOutput.LLMResponse",{ns:"app"})}};return(0,F.jsx)("div",{className:"relative left-[-7px]",children:Object.keys(d.schema.properties).map(a=>(0,F.jsx)(g7.default,{name:a,payload:d.schema.properties[a],required:!!d.schema.required?.includes(a),rootClassName:b},a))})});var g9=a.i(997094),ha=a.i(538865),hb=a.i(752370);let hc=(0,K.memo)(({id:a,data:b})=>{let{t:c}=(0,$.useTranslation)(),{nodesReadOnly:d}=(0,aq.useNodesReadOnly)(),e=(0,aP.useStore)(a=>a.dataSourceList),{provider_type:f,plugin_id:g,fileExtensions:h=[],datasource_parameters:i}=b,{handleFileExtensionsChange:j,handleParametersChange:k,outputSchema:l,hasObjectOutput:m}=((a,b)=>{let c=(0,N.useStoreApi)(),{handleNodeDataUpdateWithSyncDraft:d}=(0,ao.useNodeDataUpdate)(),e=(0,K.useCallback)(()=>{let{getNodes:b}=c.getState();return b().find(b=>b.id===a)},[c,a]),f=(0,K.useCallback)(b=>{d({id:a,data:b})},[a,d]),g=(0,K.useCallback)(()=>{let a=e();a?.data._dataSourceStartToAdd&&a?.data.provider_type==="local_file"&&f({...a.data,_dataSourceStartToAdd:!1})},[e,f]);(0,K.useEffect)(()=>{g()},[g]);let h=(0,K.useCallback)(a=>{let b=e();f({...b?.data,fileExtensions:a})},[f,e]),i=(0,K.useCallback)(a=>{let b=e();f({...b?.data,datasource_parameters:a})},[f,e]);return{handleFileExtensionsChange:h,handleParametersChange:i,outputSchema:(0,K.useMemo)(()=>{let a=e();if(!a?.data||!b)return[];let c=b.find(b=>b.plugin_id===a.data.plugin_id),d=c?.tools?.find(b=>b.name===a.data.datasource_name),f=d?.output_schema,g=[];return f&&f.properties&&Object.keys(f.properties).forEach(a=>{let b=f.properties[a];"object"===b.type?g.push({name:a,value:b}):g.push({name:a,type:"array"===b.type?`Array[${b.items?.type.slice(0,1).toLocaleUpperCase()}${b.items?.type.slice(1)}]`:`${b.type.slice(0,1).toLocaleUpperCase()}${b.type.slice(1)}`,description:b.description})}),g},[e,b]),hasObjectOutput:(0,K.useMemo)(()=>{let a=e();if(!a?.data||!b)return!1;let c=b.find(b=>b.plugin_id===a.data.plugin_id),d=c?.tools?.find(b=>b.name===a.data.datasource_name),f=d?.output_schema;if(!f||!f.properties)return!1;let g=f.properties;return Object.keys(g).some(a=>"object"===g[a].type)},[e,b])}})(a,e),n=f===aM.DataSourceClassification.localFile,o=e?.find(a=>a.plugin_id===g),p=o?.tools?.find(a=>a.name===b.datasource_name),q=(0,K.useMemo)(()=>p?(0,eB.toolParametersToFormSchemas)(p.parameters):[],[p]),r=(0,aP.useStore)(a=>a.pipelineId),s=(0,aP.useStore)(a=>a.setShowInputFieldPanel),{schemaTypeDefinitions:t}=(0,bX.default)();return(0,F.jsxs)("div",{children:[o?.is_authorized&&!n&&!!q?.length&&(0,F.jsx)(g6,{boxGroupProps:{boxProps:{withBorderBottom:!0}},fieldProps:{fieldTitleProps:{title:c("nodes.tool.inputVars",{ns:"workflow"})},supportCollapse:!0},children:q.length>0&&(0,F.jsx)(ha.default,{readOnly:d,nodeId:a,schema:q,value:i,onChange:k,currentProvider:o,currentTool:p,showManageInputField:!!r,onManageInputField:()=>s?.(!0)})}),n&&(0,F.jsx)(g6,{boxGroupProps:{boxProps:{withBorderBottom:!0}},fieldProps:{fieldTitleProps:{title:c("nodes.dataSource.supportedFileFormats",{ns:"workflow"})}},children:(0,F.jsx)("div",{className:"rounded-lg bg-components-input-bg-normal p-1 pt-0",children:(0,F.jsx)(g_.default,{items:h,onChange:j,placeholder:c("nodes.dataSource.supportedFileFormatsPlaceholder",{ns:"workflow"}),inputClassName:"bg-transparent",disableAdd:d,disableRemove:d})})}),(0,F.jsxs)(gj,{children:[hb.COMMON_OUTPUT.map((a,b)=>(0,F.jsx)(gi,{name:a.name,type:a.type,description:a.description,isIndent:m},b)),n&&hb.LOCAL_FILE_OUTPUT.map((a,b)=>(0,F.jsx)(gi,{name:a.name,type:a.type,description:a.description,subItems:a.subItems.map(a=>({name:a.name,type:a.type,description:a.description}))},b)),l.map(a=>{let b=(0,bX.getMatchedSchemaType)(a.value,t);return(0,F.jsx)("div",{children:a.value?.type==="object"?(0,F.jsx)(g8,{rootClassName:"code-sm-semibold text-text-secondary",payload:(0,g9.wrapStructuredVarItem)(a,b)}):(0,F.jsx)(gi,{name:a.name,type:`${a.type.toLocaleLowerCase()}${b?` (${b})`:""}`,description:a.description,isIndent:m})},a.name)})]})]})}),hd=K.memo(({data:a})=>{let{t:b}=(0,$.useTranslation)(),c=(0,N.useNodes)(),{variable_selector:d}=a;if(!d||0===d.length)return null;let e=(0,bY.isSystemVar)(d)?c.find(a=>a.data.type===aC.BlockEnum.Start):c.find(a=>a.id===d[0]);return(0,F.jsxs)("div",{className:"relative mb-1 px-3 py-1",children:[(0,F.jsx)("div",{className:"system-2xs-medium-uppercase mb-1 text-text-tertiary",children:b("nodes.docExtractor.inputVar",{ns:"workflow"})}),(0,F.jsx)(gv.VariableLabelInNode,{variables:d,nodeType:e?.data.type,nodeTitle:e?.data.title})]})});var he=a.i(136403),hf=a.i(763539);let hg="nodes.docExtractor",hh=K.memo(({id:a,data:b})=>{let c,{t:d}=(0,$.useTranslation)(),e=(0,bk.useLocale)(),f=bq(aC.BlockEnum.DocExtractor),{data:g}=(0,hf.useFileSupportTypes)(),h=(c={md:"markdown",pptx:"pptx",htm:"html",xlsx:"xlsx",docx:"docx"},[...g?.allowed_extensions||[]].map(a=>c[a]||a).map(a=>a.toLowerCase()).filter((a,b,c)=>c.indexOf(a)===b).join(e!==he.LanguagesSupported[1]?", ":"、 ")),{readOnly:i,inputs:j,handleVarChanges:k,filterVar:l}=((a,b)=>{let{nodesReadOnly:c}=(0,aq.useNodesReadOnly)(),{inputs:d,setInputs:e}=eA(a,b),f=(0,K.useCallback)(a=>a.type===aC.VarType.file||a.type===aC.VarType.arrayFile,[]),g=(0,aq.useIsChatMode)(),h=(0,N.useStoreApi)(),{getBeforeNodesInSameBranch:i}=(0,aq.useWorkflow)(),{getNodes:j}=h.getState(),k=j().find(b=>b.id===a),l=b.isInIteration,m=l?j().find(a=>a.id===k.parentId):null,n=b.isInLoop?j().find(a=>a.id===k.parentId):null,o=(0,K.useMemo)(()=>i(a),[i,a]),{getCurrentVariableType:p}=(0,e5.useWorkflowVariables)(),q=(0,K.useCallback)(a=>p({parentNode:l?m:n,valueSelector:a||[],availableNodes:o,isChatMode:g,isConstant:!1}),[p,l,o,g,m,n]),r=(0,K.useCallback)(a=>{e((0,I.produce)(d,b=>{b.variable_selector=a,b.is_array_file=q(b.variable_selector)===aC.VarType.arrayFile}))},[q,d,e]);return{readOnly:c,inputs:d,filterVar:f,handleVarChanges:r}})(a,b);return(0,F.jsxs)("div",{className:"mt-2",children:[(0,F.jsx)("div",{className:"space-y-4 px-4 pb-4",children:(0,F.jsx)(fW,{title:d(`${hg}.inputVar`,{ns:"workflow"}),required:!0,children:(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(gA.default,{readonly:i,nodeId:a,isShowNodeName:!0,value:j.variable_selector||[],onChange:k,filterVar:l,typePlaceHolder:"File | Array[File]"}),(0,F.jsxs)("div",{className:"body-xs-regular mt-1 py-0.5 text-text-tertiary",children:[d(`${hg}.supportFileTypes`,{ns:"workflow",types:h}),(0,F.jsx)("a",{className:"text-text-accent",href:f,target:"_blank",children:d(`${hg}.learnMore`,{ns:"workflow"})})]})]})})}),(0,F.jsx)(au,{}),(0,F.jsx)("div",{children:(0,F.jsx)(gj,{children:(0,F.jsx)(gi,{name:"text",type:j.is_array_file?"array[string]":"string",description:d(`${hg}.outputVars.text`,{ns:"workflow"})})})})]})}),hi=K.memo(({id:a,data:b})=>{let{getBeforeNodesInSameBranch:c}=(0,aq.useWorkflow)(),d=c(a),{getCurrentVariableType:e}=(0,e5.useWorkflowVariables)(),f=(0,aq.useIsChatMode)(),g=d.find(a=>a.data.type===aC.BlockEnum.Start),{outputs:h}=b,i=h.filter(({value_selector:a})=>a.length>0);return i.length?(0,F.jsx)("div",{className:"mb-1 space-y-0.5 px-3 py-1",children:i.map(({value_selector:a},b)=>{let c,h=(c=a[0],d.find(a=>a.id===c)||g),i=e({valueSelector:a,availableNodes:d,isChatMode:f});return(0,F.jsx)(gv.VariableLabelInNode,{variables:a,nodeType:h?.data.type,nodeTitle:h?.data.title,variableType:i},b)})}):null}),hj=K.memo(({id:a,data:b})=>{let{t:c}=(0,$.useTranslation)(),{readOnly:d,inputs:e,handleVarListChange:f,handleAddVariable:g}=((a,b)=>{let{nodesReadOnly:c}=(0,aq.useNodesReadOnly)(),{inputs:d,setInputs:e}=eA(a,b),{handleVarListChange:f,handleAddVariable:g}=eE({inputs:d,setInputs:a=>{e(a)},varKey:"outputs"});return{readOnly:c,inputs:d,handleVarListChange:f,handleAddVariable:g}})(a,b),h=e.outputs;return(0,F.jsx)("div",{className:"mt-2",children:(0,F.jsx)("div",{className:"space-y-4 px-4 pb-4",children:(0,F.jsx)(fW,{title:c("nodes.end.output.variable",{ns:"workflow"}),required:!0,operations:d?void 0:(0,F.jsx)(aY.default,{onClick:g}),children:(0,F.jsx)(gR,{nodeId:a,readonly:d,list:h,onChange:f})})})})}),hk=K.memo(({id:a,data:b})=>{let{method:c,url:d}=b;return d?(0,F.jsx)("div",{className:"mb-1 px-3 py-1",children:(0,F.jsxs)("div",{className:"flex items-center justify-start rounded-md bg-workflow-block-parma-bg p-1",children:[(0,F.jsx)("div",{className:"flex h-4 shrink-0 items-center rounded bg-components-badge-white-to-dark px-1 text-xs font-semibold uppercase text-text-secondary",children:c}),(0,F.jsx)("div",{className:"w-0 grow pl-1 pt-1",children:(0,F.jsx)(gs,{className:"text-text-secondary",value:d,nodeId:a})})]})}):null});var hl=a.i(945577),hm=a.i(777100);let hn=K.memo(({instanceId:a,className:b,placeholder:c,placeholderClassName:d,promptMinHeightClassName:e="min-h-[20px]",value:f,onChange:g,onFocusChange:h,readOnly:i,nodesOutputVars:j,availableNodes:k=[],insertVarTipToLeft:l})=>{let{t:m}=(0,$.useTranslation)(),[n,{setTrue:o,setFalse:p}]=(0,a8.useBoolean)(!1);(0,K.useEffect)(()=>{h?.(n)},[n]);let q=(0,aP.useStore)(a=>a.pipelineId),r=(0,aP.useStore)(a=>a.setShowInputFieldPanel);return(0,F.jsx)("div",{className:(0,S.cn)(b,"relative"),children:(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(f_.default,{instanceId:a,className:(0,S.cn)(e,"!leading-[18px]"),placeholder:c,placeholderClassName:d,value:f,contextBlock:{show:!1,selectable:!1,datasets:[],onAddContext:ds.noop},historyBlock:{show:!1,selectable:!1,history:{user:"Human",assistant:"Assistant"},onEditRole:ds.noop},queryBlock:{show:!1,selectable:!1},workflowVariableBlock:{show:!0,variables:j||[],workflowNodesMap:k.reduce((a,b)=>(a[b.id]={title:b.data.title,type:b.data.type,width:b.width,height:b.height,position:b.position},b.data.type===aC.BlockEnum.Start&&(a.sys={title:m("blocks.start",{ns:"workflow"}),type:aC.BlockEnum.Start}),a),{}),showManageInputField:!!q,onManageInputField:()=>r?.(!0)},onChange:g,editable:!i,onBlur:p,onFocus:o}),i&&(0,F.jsx)("div",{className:"absolute inset-0 z-10"}),n&&(0,F.jsx)("div",{className:(0,S.cn)("absolute z-10",l?"left-[-12px] top-1.5":" right-1 top-[-9px]"),children:(0,F.jsx)(ac.default,{popupContent:`${m("common.insertVarTip",{ns:"workflow"})}`,children:(0,F.jsx)("div",{className:"cursor-pointer rounded-[5px] border-[0.5px] border-divider-regular bg-components-badge-white-to-dark p-0.5 shadow-lg",children:(0,F.jsx)(a0.Variable02,{className:"h-3.5 w-3.5 text-components-button-secondary-accent-text"})})})})]})})}),ho=[{label:"GET",value:cb.get},{label:"POST",value:cb.post},{label:"HEAD",value:cb.head},{label:"PATCH",value:cb.patch},{label:"PUT",value:cb.put},{label:"DELETE",value:cb.delete}],hp=K.memo(({nodeId:a,readonly:b,method:c,onMethodChange:d,url:e,onUrlChange:f})=>{let{t:g}=(0,$.useTranslation)(),[h,i]=(0,K.useState)(!1),{availableVars:j,availableNodesWithParent:k}=(0,eD.default)(a,{onlyLeafNodeVar:!1,filterVar:a=>[aC.VarType.string,aC.VarType.number,aC.VarType.secret].includes(a.type)});return(0,F.jsxs)("div",{className:"flex items-start  space-x-1",children:[(0,F.jsx)(gJ.default,{value:c,onChange:d,options:ho,trigger:(0,F.jsxs)("div",{className:(0,S.cn)(b&&"cursor-pointer","flex h-8 shrink-0 items-center rounded-lg border border-components-button-secondary-border bg-components-button-secondary-bg px-2.5"),children:[(0,F.jsx)("div",{className:"w-12 pl-0.5 text-xs font-medium uppercase leading-[18px] text-text-primary",children:c}),!b&&(0,F.jsx)(Y.RiArrowDownSLine,{className:"ml-1 h-3.5 w-3.5 text-text-secondary"})]}),popupClassName:"top-[34px] w-[108px]",showChecked:!0,readonly:b}),(0,F.jsx)(hn,{instanceId:"http-api-url",className:(0,S.cn)(h?"border-components-input-border-active bg-components-input-bg-active shadow-xs":"border-components-input-border-hover bg-components-input-bg-normal","w-0 grow rounded-lg border px-3 py-[6px]"),value:e,onChange:f,readOnly:b,nodesOutputVars:j,availableNodes:k,onFocusChange:i,placeholder:b?"":g("nodes.http.apiPlaceholder",{ns:"workflow"}),placeholderClassName:"!leading-[21px]"})]})});var hq=a.i(940272);let hr=({title:a,onClick:b,isSelected:c})=>(0,F.jsx)("div",{className:(0,S.cn)("system-sm-regular flex h-8 grow cursor-default items-center rounded-md border border-components-option-card-option-border bg-components-option-card-option-bg px-2 text-text-secondary",!c&&"cursor-pointer hover:border-components-option-card-option-border-hover hover:bg-components-option-card-option-bg-hover hover:shadow-xs",c&&"system-sm-medium border-[1.5px] border-components-option-card-option-selected-border bg-components-option-card-option-selected-bg shadow-xs"),onClick:b,children:a}),hs=K.memo(({options:a,value:b,onChange:c})=>{let d=(0,K.useCallback)(a=>()=>c(a),[c]);return(0,F.jsx)("div",{className:"flex space-x-2",children:a.map(a=>(0,F.jsx)(hr,{title:a.label,onClick:d(a.value),isSelected:a.value===b},a.value))})}),ht="nodes.http.authorization",hu=({title:a,isRequired:b,children:c})=>(0,F.jsxs)("div",{children:[(0,F.jsxs)("div",{className:"text-[13px] font-medium leading-8 text-text-secondary",children:[a,b&&(0,F.jsx)("span",{className:"ml-0.5 text-text-destructive",children:"*"})]}),(0,F.jsx)("div",{children:c})]}),hv=K.memo(({nodeId:a,payload:b,onChange:c,isShow:d,onHide:e})=>{let{t:f}=(0,$.useTranslation)(),[g,h]=(0,K.useState)(!1),{availableVars:i,availableNodesWithParent:j}=(0,eD.default)(a,{onlyLeafNodeVar:!1,filterVar:a=>[aC.VarType.string,aC.VarType.number,aC.VarType.secret].includes(a.type)}),[k,l]=K.useState(b),m=(0,K.useCallback)(a=>{l((0,I.produce)(k,b=>{b.type=a,b.type!==ce.apiKey||b.config||(b.config={type:cf.basic,api_key:""})}))},[k,l]),n=(0,K.useCallback)(a=>{l((0,I.produce)(k,b=>{b.config||(b.config={type:cf.basic,api_key:""}),b.config.type=a}))},[k,l]),o=(0,K.useCallback)(a=>b=>{l((0,I.produce)(k,c=>{c.config||(c.config={type:cf.basic,api_key:""}),c.config[a]=b.target.value}))},[k,l]),p=(0,K.useCallback)(a=>{l((0,I.produce)(k,b=>{b.config||(b.config={type:cf.basic,api_key:""}),b.config.api_key=a}))},[k,l]),q=(0,K.useCallback)(()=>{c(k),e()},[k,c,e]);return(0,F.jsx)(hq.default,{title:f(`${ht}.authorization`,{ns:"workflow"}),isShow:d,onClose:e,children:(0,F.jsxs)("div",{children:[(0,F.jsxs)("div",{className:"space-y-2",children:[(0,F.jsx)(hu,{title:f(`${ht}.authorizationType`,{ns:"workflow"}),children:(0,F.jsx)(hs,{options:[{value:ce.none,label:f(`${ht}.no-auth`,{ns:"workflow"})},{value:ce.apiKey,label:f(`${ht}.api-key`,{ns:"workflow"})}],value:k.type,onChange:m})}),k.type===ce.apiKey&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(hu,{title:f(`${ht}.auth-type`,{ns:"workflow"}),children:(0,F.jsx)(hs,{options:[{value:cf.basic,label:f(`${ht}.basic`,{ns:"workflow"})},{value:cf.bearer,label:f(`${ht}.bearer`,{ns:"workflow"})},{value:cf.custom,label:f(`${ht}.custom`,{ns:"workflow"})}],value:k.config?.type||cf.basic,onChange:n})}),k.config?.type===cf.custom&&(0,F.jsx)(hu,{title:f(`${ht}.header`,{ns:"workflow"}),isRequired:!0,children:(0,F.jsx)(a2.default,{value:k.config?.header||"",onChange:o("header")})}),(0,F.jsx)(hu,{title:f(`${ht}.api-key-title`,{ns:"workflow"}),isRequired:!0,children:(0,F.jsx)("div",{className:"flex",children:(0,F.jsx)(hn,{instanceId:"http-api-key",className:(0,S.cn)(g?"border-components-input-border-active bg-components-input-bg-active shadow-xs":"border-components-input-border-hover bg-components-input-bg-normal","w-0 grow rounded-lg border px-3 py-[6px]"),value:k.config?.api_key||"",onChange:p,nodesOutputVars:i,availableNodes:j,onFocusChange:h,placeholder:" ",placeholderClassName:"!leading-[21px]"})})})]})]}),(0,F.jsxs)("div",{className:"mt-6 flex justify-end space-x-2",children:[(0,F.jsx)(av.default,{onClick:e,children:f("operation.cancel",{ns:"common"})}),(0,F.jsx)(av.default,{variant:"primary",onClick:q,children:f("operation.save",{ns:"common"})})]})]})})}),hw=K.memo(({nodeId:a,isShow:b,onHide:c,handleCurlImport:d})=>{let[e,f]=(0,K.useState)(""),{handleNodeSelect:g}=(0,V.useNodesInteractions)(),{t:h}=(0,$.useTranslation)(),i=(0,K.useCallback)(()=>{let{node:b,error:f}=(a=>{if(!a.trim().toLowerCase().startsWith("curl"))return{node:null,error:'Invalid cURL command. Command must start with "curl".'};let b={title:"HTTP Request",desc:"Imported from cURL",method:void 0,url:"",headers:"",params:"",body:{type:cc.none,data:""}},c=a.match(/(?:[^\s"']|"[^"]*"|'[^']*')+/g)||[],d=!1;for(let a=1;a<c.length;a++){let e=c[a].replace(/^['"]|['"]$/g,"");switch(e){case"-X":case"--request":if(a+1>=c.length)return{node:null,error:"Missing HTTP method after -X or --request."};b.method=c[++a].replace(/^['"]|['"]$/g,"").toLowerCase()||cb.get,d=!0;break;case"-H":case"--header":if(a+1>=c.length)return{node:null,error:"Missing header value after -H or --header."};b.headers+=(b.headers?"\n":"")+c[++a].replace(/^['"]|['"]$/g,"");break;case"-d":case"--data":case"--data-raw":case"--data-binary":{if(a+1>=c.length)return{node:null,error:"Missing data value after -d, --data, --data-raw, or --data-binary."};let d=[{type:cd.text,value:c[++a].replace(/^['"]|['"]$/g,"")}];b.body={type:cc.rawText,data:d};break}case"-F":case"--form":{if(a+1>=c.length)return{node:null,error:"Missing form data after -F or --form."};b.body?.type!==cc.formData&&(b.body={type:cc.formData,data:""});let[d,...e]=c[++a].replace(/^['"]|['"]$/g,"").split("=");if(!d)return{node:null,error:"Invalid form data format."};let f=e.join("="),g=/^(.+?);type=(.+)$/.exec(f);if(g){let[,a,c]=g;f=a,b.headers+=`${b.headers?"\n":""}Content-Type: ${c}`}b.body.data+=`${b.body.data?"\n":""}${d}:${f}`;break}case"--json":if(a+1>=c.length)return{node:null,error:"Missing JSON data after --json."};b.body={type:cc.json,data:c[++a].replace(/^['"]|['"]$/g,"")};break;default:e.startsWith("http")&&!b.url&&(b.url=e)}}if(b.method=b.method||(d?cb.post:cb.get),!b.url)return{node:null,error:"Missing URL or url not start with http."};let e=b.url?.split("?")||[];return e.length>1&&(b.url=e[0],b.params=e[1].replace(/&/g,"\n").replace(/=/g,": ")),{node:b,error:null}})(e);f?aX.default.notify({type:"error",message:f}):b&&(c(),d(b),g(a,!0),setTimeout(()=>{g(a)},0))},[c,a,e,g,d]);return(0,F.jsxs)(hq.default,{title:h("nodes.http.curl.title",{ns:"workflow"}),isShow:b,onClose:c,className:"!w-[400px] !max-w-[400px] !p-4",children:[(0,F.jsx)("div",{children:(0,F.jsx)(a5.default,{value:e,className:"my-3 h-40 w-full grow",onChange:a=>f(a.target.value),placeholder:h("nodes.http.curl.placeholder",{ns:"workflow"})})}),(0,F.jsxs)("div",{className:"mt-4 flex justify-end space-x-2",children:[(0,F.jsx)(av.default,{className:"!w-[95px]",onClick:c,children:h("operation.cancel",{ns:"common"})}),(0,F.jsxs)(av.default,{className:"!w-[95px]",variant:"primary",onClick:i,children:[" ",h("operation.save",{ns:"common"})]})]})]})}),hx=0;function hy(a=""){let b=++hx;return`${a}${b}`}let hz=K.memo(({className:a,instanceId:b,nodeId:c,value:d,onChange:e,hasRemove:f,onRemove:g,placeholder:h,readOnly:i,isSupportFile:j,insertVarTipToLeft:k})=>{let{t:l}=(0,$.useTranslation)(),m=!!d,[n,o]=(0,K.useState)(!1),{availableVars:p,availableNodesWithParent:q}=(0,eD.default)(c,{onlyLeafNodeVar:!1,filterVar:a=>{let b=[aC.VarType.string,aC.VarType.number,aC.VarType.secret];return j&&b.push(aC.VarType.file,aC.VarType.arrayFile),b.includes(a.type)}}),r=(0,K.useCallback)(a=>{a.stopPropagation(),g?.()},[g]);return(0,F.jsxs)("div",{className:(0,S.cn)(a,"hover:cursor-text hover:bg-state-base-hover","relative flex !h-[30px] items-center"),children:[i?(0,F.jsxs)("div",{className:"h-full w-full pl-0.5 leading-[18px]",children:[!m&&(0,F.jsx)("div",{className:"text-xs font-normal text-text-quaternary",children:h}),m&&(0,F.jsx)(hn,{instanceId:b,className:(0,S.cn)(n?"border-components-input-border-active bg-components-input-bg-active shadow-xs":"border-components-input-border-hover bg-components-input-bg-normal","h-full w-0 grow rounded-lg border px-3 py-[6px]"),value:d,onChange:e,readOnly:i,nodesOutputVars:p,availableNodes:q,onFocusChange:o,placeholder:l("nodes.http.insertVarPlaceholder",{ns:"workflow"}),placeholderClassName:"!leading-[21px]",promptMinHeightClassName:"h-full",insertVarTipToLeft:k})]}):(0,F.jsx)(hn,{instanceId:b,className:(0,S.cn)(n?"bg-components-input-bg-active":"bg-width","h-full w-0 grow px-3 py-1"),value:d,onChange:e,readOnly:i,nodesOutputVars:p,availableNodes:q,onFocusChange:o,placeholder:l("nodes.http.insertVarPlaceholder",{ns:"workflow"}),placeholderClassName:"!leading-[21px]",promptMinHeightClassName:"h-full",insertVarTipToLeft:k}),f&&!n&&(0,F.jsx)(gL.default,{className:"absolute right-1 top-0.5 hidden group-hover:block",onClick:r})]})}),hA="nodes.http",hB=K.memo(({instanceId:a,className:b,nodeId:c,readonly:d,canRemove:e,payload:f,onChange:g,onRemove:h,isLastItem:i,onAdd:j,isSupportFile:k,keyNotSupportVar:l,insertVarTipToLeft:m})=>{let{t:n}=(0,$.useTranslation)(),o=(0,K.useCallback)(a=>b=>{g((0,I.produce)(f,c=>{c[a]=b}))},[g,f]);return(0,F.jsxs)("div",{className:(0,S.cn)(b,"h-min-7 group flex border-t border-divider-regular"),children:[(0,F.jsx)("div",{className:(0,S.cn)("shrink-0 border-r border-divider-regular",k?"w-[140px]":"w-1/2"),children:l?(0,F.jsx)("input",{className:"system-sm-regular focus:bg-gray-100! appearance-none rounded-none border-none bg-transparent outline-none hover:bg-components-input-bg-hover focus:ring-0",value:f.key,onChange:a=>o("key")(a.target.value)}):(0,F.jsx)(hz,{instanceId:`http-key-${a}`,nodeId:c,value:f.key,onChange:o("key"),hasRemove:!1,placeholder:n(`${hA}.key`,{ns:"workflow"}),readOnly:d,insertVarTipToLeft:m})}),k&&(0,F.jsx)("div",{className:"w-[70px] shrink-0 border-r border-divider-regular",children:(0,F.jsx)(a4.PortalSelect,{value:f.type,onSelect:a=>o("type")(a.value),items:[{name:"text",value:"text"},{name:"file",value:"file"}],readonly:d,triggerClassName:"rounded-none h-7 text-text-primary",triggerClassNameFn:a=>a?"bg-state-base-hover":"bg-transparent",popupClassName:"w-[80px] h-7"})}),(0,F.jsx)("div",{className:(0,S.cn)(k?"grow":"w-1/2"),onClick:()=>i&&j(),children:k&&"file"===f.type?(0,F.jsx)(gA.default,{nodeId:c,readonly:d,value:f.file||[],onChange:o("file"),filterVar:a=>[aC.VarType.file,aC.VarType.arrayFile].includes(a.type),isInTable:!0,onRemove:h}):(0,F.jsx)(hz,{instanceId:`http-value-${a}`,nodeId:c,value:f.value,onChange:o("value"),hasRemove:!d&&e,onRemove:h,placeholder:n(`${hA}.value`,{ns:"workflow"}),readOnly:d,isSupportFile:k,insertVarTipToLeft:m})})]})}),hC="nodes.http",hD=K.memo(({readonly:a,nodeId:b,list:c,onChange:d,onAdd:e,isSupportFile:f,keyNotSupportVar:g,insertVarTipToLeft:h})=>{let{t:i}=(0,$.useTranslation)(),j=(0,K.useCallback)(a=>b=>{d((0,I.produce)(c,c=>{c[a]=b}))},[c,d]),k=(0,K.useCallback)(a=>()=>{d((0,I.produce)(c,b=>{b.splice(a,1)}))},[c,d]);return Array.isArray(c)?(0,F.jsxs)("div",{className:"overflow-hidden rounded-lg border border-divider-regular",children:[(0,F.jsxs)("div",{className:(0,S.cn)("system-xs-medium-uppercase flex h-7 items-center leading-7 text-text-tertiary"),children:[(0,F.jsx)("div",{className:(0,S.cn)("h-full border-r border-divider-regular pl-3",f?"w-[140px]":"w-1/2"),children:i(`${hC}.key`,{ns:"workflow"})}),f&&(0,F.jsx)("div",{className:"h-full w-[70px] shrink-0 border-r border-divider-regular pl-3",children:i(`${hC}.type`,{ns:"workflow"})}),(0,F.jsx)("div",{className:(0,S.cn)("h-full items-center justify-between pl-3 pr-1",f?"grow":"w-1/2"),children:i(`${hC}.value`,{ns:"workflow"})})]}),c.map((d,i)=>(0,F.jsx)(hB,{instanceId:d.id,nodeId:b,payload:d,onChange:j(i),onRemove:k(i),isLastItem:i===c.length-1,onAdd:e,readonly:a,canRemove:c.length>1,isSupportFile:f,keyNotSupportVar:g,insertVarTipToLeft:h},d.id))]}):null}),hE=K.memo(({readonly:a,nodeId:b,list:c,onChange:d,onAdd:e,isSupportFile:f})=>(0,F.jsx)(hD,{readonly:a,nodeId:b,list:c,onChange:d,onAdd:e,isSupportFile:f})),hF="key-value-",hG=[cc.none,cc.formData,cc.xWwwFormUrlencoded,cc.json,cc.rawText,cc.binary],hH={[cc.none]:"none",[cc.formData]:"form-data",[cc.xWwwFormUrlencoded]:"x-www-form-urlencoded",[cc.rawText]:"raw",[cc.json]:"JSON",[cc.binary]:"binary"},hI=K.memo(({readonly:a,nodeId:b,payload:c,onChange:d})=>{let{type:e,data:f}=c,g=(0,K.useMemo)(()=>"string"==typeof f?[]:f,[f]),h=[cc.formData,cc.xWwwFormUrlencoded].includes(e)?"":g[0]?.value||"",{availableVars:i,availableNodes:j}=(0,eD.default)(b,{onlyLeafNodeVar:!1,filterVar:a=>[aC.VarType.string,aC.VarType.number,aC.VarType.secret,aC.VarType.arrayNumber,aC.VarType.arrayString].includes(a.type)}),k=(0,K.useCallback)(a=>{let b=a.target.value,c=[cc.formData,cc.xWwwFormUrlencoded].includes(b);d({type:b,data:c?[{id:hy(hF),type:cd.text,key:"",value:""}]:[]})},[d]),l=(0,K.useCallback)(()=>{d((0,I.produce)(c,a=>{a.data.push({id:hy(hF),type:cd.text,key:"",value:""})}))},[d,c]),m=(0,K.useCallback)(a=>{d((0,I.produce)(c,b=>{b.data=a}))},[d,c]),n=(0,K.useCallback)(a=>{d((0,I.produce)(c,b=>{0===b.data.length&&b.data.push({id:hy(hF),type:cd.text,key:"",value:""}),b.data[0].value=a}))},[d,c]),o=(0,K.useCallback)(a=>{d((0,I.produce)(c,b=>{0===b.data.length&&b.data.push({id:hy(hF),type:cd.file}),b.data[0].file=a}))},[d,c]);return(0,F.jsxs)("div",{children:[(0,F.jsx)("div",{className:"flex flex-wrap",children:hG.map(b=>(0,F.jsxs)("label",{htmlFor:`body-type-${b}`,className:"mr-4 flex h-7 items-center space-x-2",children:[(0,F.jsx)("input",{type:"radio",id:`body-type-${b}`,value:b,checked:e===b,onChange:k,disabled:a}),(0,F.jsx)("div",{className:"text-[13px] font-normal leading-[18px] text-text-secondary",children:hH[b]})]},b))}),(0,F.jsxs)("div",{className:(0,S.cn)(e!==cc.none&&"mt-1"),children:[e===cc.none&&null,(e===cc.formData||e===cc.xWwwFormUrlencoded)&&(0,F.jsx)(hE,{readonly:a,nodeId:b,list:g,onChange:m,onAdd:l,isSupportFile:e===cc.formData}),e===cc.rawText&&(0,F.jsx)(f9,{instanceId:"http-body-raw",title:(0,F.jsx)("div",{className:"uppercase",children:"Raw text"}),onChange:n,value:h,justVar:!0,nodesOutputVars:i,availableNodes:j,readOnly:a}),e===cc.json&&(0,F.jsx)(f9,{instanceId:"http-body-json",title:"JSON",value:h,onChange:n,justVar:!0,nodesOutputVars:i,availableNodes:j,readOnly:a}),e===cc.binary&&(0,F.jsx)(gA.default,{nodeId:b,readonly:a,value:g[0]?.file||[],onChange:o,filterVar:a=>[aC.VarType.file,aC.VarType.arrayFile].includes(a.type)})]})]})});var gg=gg;let hJ=({title:a,description:b,placeholder:c,value:d,onChange:e,readOnly:f,min:g,max:h})=>(0,F.jsxs)("div",{className:"space-y-1",children:[(0,F.jsxs)("div",{className:"flex h-[18px] items-center space-x-2",children:[(0,F.jsx)("span",{className:"text-[13px] font-medium text-text-primary",children:a}),(0,F.jsx)("span",{className:"text-xs font-normal text-text-tertiary",children:b})]}),(0,F.jsx)(a2.default,{type:"number",value:d,onChange:a=>{let b=a.target.value;if(""===b)e(void 0);else{let a=Number.parseInt(b,10);Number.isNaN(a)||e(Math.max(g,Math.min(h,a)))}},placeholder:c,readOnly:f,min:g,max:h})]}),hK=K.memo(({readonly:a,payload:b,onChange:c})=>{let{t:d}=(0,$.useTranslation)(),{connect:e,read:f,write:g,max_connect_timeout:h,max_read_timeout:i,max_write_timeout:j}=b??{},k=(0,aP.useStore)(a=>a.nodesDefaultConfigs),l=k?.[aC.BlockEnum.HttpRequest],m=l?.timeout||{};return(0,F.jsx)(gg.default,{title:d("nodes.http.timeout.title",{ns:"workflow"}),children:(0,F.jsx)("div",{className:"mt-2 space-y-1",children:(0,F.jsxs)("div",{className:"space-y-3",children:[(0,F.jsx)(hJ,{title:d("nodes.http.timeout.connectLabel",{ns:"workflow"}),description:d("nodes.http.timeout.connectPlaceholder",{ns:"workflow"}),placeholder:d("nodes.http.timeout.connectPlaceholder",{ns:"workflow"}),readOnly:a,value:e,onChange:a=>c?.({...b,connect:a}),min:1,max:h||m.max_connect_timeout||10}),(0,F.jsx)(hJ,{title:d("nodes.http.timeout.readLabel",{ns:"workflow"}),description:d("nodes.http.timeout.readPlaceholder",{ns:"workflow"}),placeholder:d("nodes.http.timeout.readPlaceholder",{ns:"workflow"}),readOnly:a,value:f,onChange:a=>c?.({...b,read:a}),min:1,max:i||m.max_read_timeout||600}),(0,F.jsx)(hJ,{title:d("nodes.http.timeout.writeLabel",{ns:"workflow"}),description:d("nodes.http.timeout.writePlaceholder",{ns:"workflow"}),placeholder:d("nodes.http.timeout.writePlaceholder",{ns:"workflow"}),readOnly:a,value:g,onChange:a=>c?.({...b,write:a}),min:1,max:j||m.max_write_timeout||600})]})})})}),hL="key-value-",hM=(a,b,c)=>{let[d,e]=(0,K.useState)(()=>a?a.split("\n").map(a=>{let[b,...c]=a.split(":");return{id:hy(hL),key:b.trim(),value:c.join(":").trim()}}):[]),f=a=>{e(a.map(a=>({...a,id:a.id||hy(hL)})))};(0,K.useEffect)(()=>{if(c)return;let e=d.filter(a=>a.key&&a.value).map(a=>`${a.key}:${a.value}`).join("\n");e!==a&&b(e)},[d,c]);let g=(0,K.useCallback)(()=>{f([...d,{id:hy(hL),key:"",value:""}])},[d]),[h,{toggle:i}]=(0,a8.useBoolean)(!0);return{list:0===d.length?[{id:hy(hL),key:"",value:""}]:d,setList:f,addItem:g,isKeyValueEdit:h,toggleIsKeyValueEdit:i}},hN="nodes.http",hO=(0,K.memo)(({id:a,data:b})=>{let{t:c}=(0,$.useTranslation)(),{readOnly:d,isDataReady:e,inputs:f,handleMethodChange:g,handleUrlChange:h,headers:i,setHeaders:j,addHeader:k,params:l,setParams:m,addParam:n,setBody:o,isShowAuthorization:p,showAuthorization:q,hideAuthorization:r,setAuthorization:s,setTimeout:t,isShowCurlPanel:u,showCurlPanel:v,hideCurlPanel:w,handleCurlImport:x,handleSSLVerifyChange:y}=((a,b)=>{let{nodesReadOnly:c}=(0,aq.useNodesReadOnly)(),d=(0,aP.useStore)(a=>a.nodesDefaultConfigs?.[b.type]),{inputs:e,setInputs:f}=eA(a,b),{handleVarListChange:g,handleAddVariable:h}=eE({inputs:e,setInputs:f}),[i,j]=(0,K.useState)(!1);(0,K.useEffect)(()=>{if(d&&Object.keys(d).length>0){let a={...d,...e},b=a.body.data;if("string"==typeof b)a.body={...a.body,data:[cc.formData,cc.xWwwFormUrlencoded].includes(a.body.type)?b.split("\n").map(a=>{let[b,c]=a.split(":");return{key:b||"",type:cd.text,value:c||""}}):[{type:cd.text,value:b}]};else b||(a.body={...a.body,data:[]});f(a),j(!0)}},[d]);let k=(0,K.useCallback)(a=>{f((0,I.produce)(e,b=>{b.method=a}))},[e,f]),l=(0,K.useCallback)(a=>{f((0,I.produce)(e,b=>{b.url=a}))},[e,f]),m=(0,K.useCallback)(a=>b=>{f((0,I.produce)(e,c=>{c[a]=b}))},[e,f]),{list:n,setList:o,addItem:p,isKeyValueEdit:q,toggleIsKeyValueEdit:r}=hM(e.headers,m("headers")),{list:s,setList:t,addItem:u,isKeyValueEdit:v,toggleIsKeyValueEdit:w}=hM(e.params,m("params")),x=(0,K.useCallback)(a=>{f((0,I.produce)(e,b=>{b.body=a}))},[e,f]),[y,{setTrue:z,setFalse:A}]=(0,a8.useBoolean)(!1),B=(0,K.useCallback)(a=>{f((0,I.produce)(e,b=>{b.authorization=a}))},[e,f]),C=(0,K.useCallback)(a=>{f((0,I.produce)(e,b=>{b.timeout=a}))},[e,f]),D=(0,K.useCallback)(a=>[aC.VarType.string,aC.VarType.number,aC.VarType.secret].includes(a.type),[]),[E,{setTrue:F,setFalse:G}]=(0,a8.useBoolean)(!1),H=(0,K.useCallback)(a=>{f((0,I.produce)(e,b=>{b.method=a.method,b.url=a.url,b.headers=a.headers,b.params=a.params,b.body=a.body}))},[e,f]),J=(0,K.useCallback)(a=>{f((0,I.produce)(e,b=>{b.ssl_verify=a}))},[e,f]);return{readOnly:c,isDataReady:i,inputs:e,handleVarListChange:g,handleAddVariable:h,filterVar:D,handleMethodChange:k,handleUrlChange:l,headers:n,setHeaders:o,addHeader:p,isHeaderKeyValueEdit:q,toggleIsHeaderKeyValueEdit:r,params:s,setParams:t,addParam:u,isParamKeyValueEdit:v,toggleIsParamKeyValueEdit:w,setBody:x,handleSSLVerifyChange:J,isShowAuthorization:y,showAuthorization:z,hideAuthorization:A,setAuthorization:B,setTimeout:C,isShowCurlPanel:E,showCurlPanel:F,hideCurlPanel:G,handleCurlImport:H}})(a,b);return e?(0,F.jsxs)("div",{className:"pt-2",children:[(0,F.jsxs)("div",{className:"space-y-4 px-4 pb-4",children:[(0,F.jsx)(fW,{title:c(`${hN}.api`,{ns:"workflow"}),required:!0,operations:(0,F.jsxs)("div",{className:"flex",children:[(0,F.jsxs)("div",{onClick:q,className:(0,S.cn)(!d&&"cursor-pointer hover:bg-state-base-hover","flex h-6 items-center space-x-1 rounded-md px-2 "),children:[!d&&(0,F.jsx)(hm.Settings01,{className:"h-3 w-3 text-text-tertiary"}),(0,F.jsxs)("div",{className:"text-xs font-medium text-text-tertiary",children:[c(`${hN}.authorization.authorization`,{ns:"workflow"}),(0,F.jsx)("span",{className:"ml-1 text-text-secondary",children:c(`${hN}.authorization.${f.authorization.type}`,{ns:"workflow"})})]})]}),(0,F.jsxs)("div",{onClick:v,className:(0,S.cn)(!d&&"cursor-pointer hover:bg-state-base-hover","flex h-6 items-center space-x-1 rounded-md px-2 "),children:[!d&&(0,F.jsx)(hl.FileArrow01,{className:"h-3 w-3 text-text-tertiary"}),(0,F.jsx)("div",{className:"text-xs font-medium text-text-tertiary",children:c(`${hN}.curl.title`,{ns:"workflow"})})]})]}),children:(0,F.jsx)(hp,{nodeId:a,readonly:d,method:f.method,onMethodChange:g,url:f.url,onUrlChange:h})}),(0,F.jsx)(fW,{title:c(`${hN}.headers`,{ns:"workflow"}),children:(0,F.jsx)(hE,{nodeId:a,list:i,onChange:j,onAdd:k,readonly:d})}),(0,F.jsx)(fW,{title:c(`${hN}.params`,{ns:"workflow"}),children:(0,F.jsx)(hE,{nodeId:a,list:l,onChange:m,onAdd:n,readonly:d})}),(0,F.jsx)(fW,{title:c(`${hN}.body`,{ns:"workflow"}),required:!0,children:(0,F.jsx)(hI,{nodeId:a,readonly:d,payload:f.body,onChange:o})}),(0,F.jsx)(fW,{title:c(`${hN}.verifySSL.title`,{ns:"workflow"}),tooltip:c(`${hN}.verifySSL.warningTooltip`,{ns:"workflow"}),operations:(0,F.jsx)(d4.default,{defaultValue:!!f.ssl_verify,onChange:y,size:"md",disabled:d})})]}),(0,F.jsx)(au,{}),(0,F.jsx)(hK,{nodeId:a,readonly:d,payload:f.timeout,onChange:t}),p&&!d&&(0,F.jsx)(hv,{nodeId:a,isShow:!0,onHide:r,payload:f.authorization,onChange:s}),(0,F.jsx)(au,{}),(0,F.jsx)("div",{className:"",children:(0,F.jsx)(gj,{children:(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(gi,{name:"body",type:"string",description:c(`${hN}.outputVars.body`,{ns:"workflow"})}),(0,F.jsx)(gi,{name:"status_code",type:"number",description:c(`${hN}.outputVars.statusCode`,{ns:"workflow"})}),(0,F.jsx)(gi,{name:"headers",type:"object",description:c(`${hN}.outputVars.headers`,{ns:"workflow"})}),(0,F.jsx)(gi,{name:"files",type:"Array[File]",description:c(`${hN}.outputVars.files`,{ns:"workflow"})})]})})}),u&&!d&&(0,F.jsx)(hw,{nodeId:a,isShow:!0,onHide:w,handleCurlImport:x})]}):null});var hP=a.i(54362),hQ=a.i(482646);let hR="nodes.ifElse",hS=K.memo(a=>{let{data:b}=a,{t:c}=(0,$.useTranslation)(),{cases:d}=b,e=d.length,f=(0,K.useCallback)(a=>!!a.variable_selector&&0!==a.variable_selector.length&&(a.sub_variable_condition?a.sub_variable_condition.conditions.every(a=>!!a.comparison_operator&&(a.varType===aC.VarType.boolean||a.varType===aC.VarType.arrayBoolean||!!a.value)):!!(0,ci.isEmptyRelatedOperator)(a.comparison_operator)||a.varType===aC.VarType.boolean||a.varType===aC.VarType.arrayBoolean||!!a.value),[]),g=(0,F.jsx)("div",{className:"flex h-6 items-center space-x-1 rounded-md bg-workflow-block-parma-bg px-1 text-xs font-normal text-text-secondary",children:c(`${hR}.conditionNotSetup`,{ns:"workflow"})});return(0,F.jsxs)("div",{className:"px-3",children:[d.map((b,d)=>(0,F.jsxs)("div",{children:[(0,F.jsxs)("div",{className:"relative flex h-6 items-center px-1",children:[(0,F.jsxs)("div",{className:"flex w-full items-center justify-between",children:[(0,F.jsx)("div",{className:"text-[10px] font-semibold text-text-tertiary",children:e>1&&`CASE ${d+1}`}),(0,F.jsx)("div",{className:"text-[12px] font-semibold text-text-secondary",children:0===d?"IF":"ELIF"})]}),(0,F.jsx)(fg,{...a,handleId:b.case_id,handleClassName:"!top-1/2 !-right-[21px] !-translate-y-1/2"})]}),(0,F.jsx)("div",{className:"space-y-0.5",children:b.conditions.map((a,d)=>(0,F.jsxs)("div",{className:"relative",children:[f(a)?!(0,ci.isEmptyRelatedOperator)(a.comparison_operator)&&a.sub_variable_condition?(0,F.jsx)(hP.default,{condition:a}):(0,F.jsx)(hQ.default,{variableSelector:a.variable_selector,operator:a.comparison_operator,value:a.varType===aC.VarType.boolean?a.value?a.value:"False":a.value}):g,d!==b.conditions.length-1&&(0,F.jsx)("div",{className:"absolute bottom-[-10px] right-1 z-10 text-[10px] font-medium uppercase leading-4 text-text-accent",children:c(`${hR}.${b.logical_operator}`,{ns:"workflow"})})]},a.id))})]},b.case_id)),(0,F.jsxs)("div",{className:"relative flex h-6 items-center px-1",children:[(0,F.jsx)("div",{className:"w-full text-right text-xs font-semibold text-text-secondary",children:"ELSE"}),(0,F.jsx)(fg,{...a,handleId:"false",handleClassName:"!top-1/2 !-right-[21px] !-translate-y-1/2"})]})]})});var hT=ds,hU=a.i(284284);let hV=({className:a,caseId:b,variables:c,onSelectVariable:d,disabled:e})=>{let{t:f}=(0,$.useTranslation)(),[g,h]=(0,K.useState)(!1),i=(0,K.useCallback)((a,c)=>{d(b,a,c),h(!1)},[b,d,h]);return(0,F.jsxs)(bh.PortalToFollowElem,{open:g,onOpenChange:h,placement:"bottom-start",offset:{mainAxis:4,crossAxis:0},children:[(0,F.jsx)(bh.PortalToFollowElemTrigger,{onClick:()=>h(!g),children:(0,F.jsxs)(av.default,{size:"small",className:a,disabled:e,children:[(0,F.jsx)(Y.RiAddLine,{className:"mr-1 h-3.5 w-3.5"}),f("nodes.ifElse.addCondition",{ns:"workflow"})]})}),(0,F.jsx)(bh.PortalToFollowElemContent,{className:"z-[1000]",children:(0,F.jsx)("div",{className:"w-[296px] rounded-lg border-[0.5px] border-components-panel-border bg-components-panel-bg-blur shadow-lg",children:(0,F.jsx)(fa.default,{vars:c,isSupportFileVar:!0,onChange:i})})})]})};var hW=a.i(732078),hX=a.i(81862),hY=a.i(368044),hZ=eF;let h$=[hZ.VarType.variable,hZ.VarType.constant],h_=(0,K.memo)(({numberVarType:a=hZ.VarType.constant,onNumberVarTypeChange:b,value:c,onValueChange:d,variables:e,isShort:f,unit:g})=>{let{t:h}=(0,$.useTranslation)(),[i,j]=(0,K.useState)(!1),[k,l]=(0,K.useState)(!1),[m,{setTrue:n,setFalse:o}]=(0,a8.useBoolean)(),p=(0,K.useCallback)(a=>{d((0,hX.variableTransformer)(a)),l(!1)},[d]);return(0,F.jsxs)("div",{className:"flex cursor-pointer items-center",children:[(0,F.jsxs)(bh.PortalToFollowElem,{open:i,onOpenChange:j,placement:"bottom-start",offset:{mainAxis:2,crossAxis:0},children:[(0,F.jsx)(bh.PortalToFollowElemTrigger,{onClick:()=>j(a=>!a),children:(0,F.jsxs)(av.default,{className:"shrink-0",variant:"ghost",size:"small",children:[(0,hW.capitalize)(a),(0,F.jsx)(Y.RiArrowDownSLine,{className:"ml-[1px] h-3.5 w-3.5"})]})}),(0,F.jsx)(bh.PortalToFollowElemContent,{className:"z-[1000]",children:(0,F.jsx)("div",{className:"w-[112px] rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur p-1 shadow-lg",children:h$.map(c=>(0,F.jsx)("div",{className:(0,S.cn)("flex h-7 cursor-pointer items-center rounded-md px-3 hover:bg-state-base-hover","text-[13px] font-medium text-text-secondary",a===c&&"bg-state-base-hover"),onClick:()=>{b(c),j(!1)},children:(0,hW.capitalize)(c)},c))})})]}),(0,F.jsx)("div",{className:"mx-1 h-4 w-[1px] bg-divider-regular"}),(0,F.jsxs)("div",{className:"ml-0.5 w-0 grow",children:[a===hZ.VarType.variable&&(0,F.jsxs)(bh.PortalToFollowElem,{open:k,onOpenChange:l,placement:"bottom-start",offset:{mainAxis:2,crossAxis:0},children:[(0,F.jsxs)(bh.PortalToFollowElemTrigger,{className:"w-full",onClick:()=>l(a=>!a),children:[c&&(0,F.jsx)(hY.default,{valueSelector:(0,hX.variableTransformer)(c),varType:aC.VarType.number,isShort:f}),!c&&(0,F.jsxs)("div",{className:"flex h-6 items-center p-1 text-[13px] text-components-input-text-placeholder",children:[(0,F.jsx)(a0.Variable02,{className:"mr-1 h-4 w-4 shrink-0"}),(0,F.jsx)("div",{className:"w-0 grow truncate",children:h("nodes.ifElse.selectVariable",{ns:"workflow"})})]})]}),(0,F.jsx)(bh.PortalToFollowElemContent,{className:"z-[1000]",children:(0,F.jsx)("div",{className:(0,S.cn)("w-[296px] rounded-lg border-[0.5px] border-components-panel-border bg-components-panel-bg-blur pt-1 shadow-lg",f&&"w-[200px]"),children:(0,F.jsx)(fa.default,{vars:e,onChange:p})})})]}),a===hZ.VarType.constant&&(0,F.jsxs)("div",{className:" relative",children:[(0,F.jsx)("input",{className:(0,S.cn)("block w-full appearance-none bg-transparent px-2 text-[13px] text-components-input-text-filled outline-none placeholder:text-components-input-text-placeholder",g&&"pr-6"),type:"number",value:c,onChange:a=>d(a.target.value),placeholder:h("nodes.ifElse.enterValue",{ns:"workflow"})||"",onFocus:n,onBlur:o}),!m&&g&&(0,F.jsx)("div",{className:"system-sm-regular absolute right-2 top-[50%] translate-y-[-50%] text-text-tertiary",children:g})]})]})]})}),h0=({value:a,onChange:b,disabled:c,nodesOutputVars:d,availableNodes:e})=>{let{t:f}=(0,$.useTranslation)(),g=(0,aP.useStore)(a=>a.controlPromptEditorRerenderKey),h=(0,aP.useStore)(a=>a.pipelineId),i=(0,aP.useStore)(a=>a.setShowInputFieldPanel);return(0,F.jsx)(f_.default,{compact:!0,value:a,placeholder:f("nodes.ifElse.enterValue",{ns:"workflow"})||"",workflowVariableBlock:{show:!0,variables:d||[],workflowNodesMap:e.reduce((a,b)=>(a[b.id]={title:b.data.title,type:b.data.type,width:b.width,height:b.height,position:b.position},b.data.type===aC.BlockEnum.Start&&(a.sys={title:f("blocks.start",{ns:"workflow"}),type:aC.BlockEnum.Start}),a),{}),showManageInputField:!!h,onManageInputField:()=>i?.(!0)},onChange:b,editable:!c},g)},h1="nodes.ifElse",h2=({className:a,disabled:b,varType:c,file:d,value:e,onSelect:f})=>{let{t:g}=(0,$.useTranslation)(),[h,i]=(0,K.useState)(!1),j=(0,K.useMemo)(()=>(0,ci.getOperators)(c,d).map(a=>({label:(0,ci.isComparisonOperatorNeedTranslate)(a)?g(`${h1}.comparisonOperator.${a}`,{ns:"workflow"}):a,value:a})),[g,c,d]),k=j.find(a=>Array.isArray(e)?a.value===e[0]:a.value===e);return(0,F.jsxs)(bh.PortalToFollowElem,{open:h,onOpenChange:i,placement:"bottom-end",offset:{mainAxis:4,crossAxis:0},children:[(0,F.jsx)(bh.PortalToFollowElemTrigger,{onClick:()=>i(a=>!a),children:(0,F.jsxs)(av.default,{className:(0,S.cn)("shrink-0",!k&&"opacity-50",a),size:"small",variant:"ghost",disabled:b,children:[k?k.label:g(`${h1}.select`,{ns:"workflow"}),(0,F.jsx)(Y.RiArrowDownSLine,{className:"ml-1 h-3.5 w-3.5"})]})}),(0,F.jsx)(bh.PortalToFollowElemContent,{className:"z-[11]",children:(0,F.jsx)("div",{className:"rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur p-1 shadow-lg",children:j.map(a=>(0,F.jsx)("div",{className:"flex h-7 cursor-pointer items-center rounded-lg px-3 py-1.5 text-[13px] font-medium text-text-secondary hover:bg-state-base-hover",onClick:()=>{f(a.value),i(!1)},children:a.label},a.value))})})]})},h3=({open:a,onOpenChange:b,valueSelector:c,varType:d,availableNodes:e,nodesOutputVars:f,onChange:g})=>(0,F.jsxs)(bh.PortalToFollowElem,{open:a,onOpenChange:b,placement:"bottom-start",offset:{mainAxis:4,crossAxis:0},children:[(0,F.jsx)(bh.PortalToFollowElemTrigger,{asChild:!0,onClick:()=>b(!a),children:(0,F.jsx)("div",{className:"w-full cursor-pointer",children:(0,F.jsx)(hY.default,{valueSelector:c,varType:d,availableNodes:e,isShort:!0})})}),(0,F.jsx)(bh.PortalToFollowElemContent,{className:"z-[1000]",children:(0,F.jsx)("div",{className:"w-[296px] rounded-lg border-[0.5px] border-components-panel-border bg-components-panel-bg-blur shadow-lg",children:(0,F.jsx)(fa.default,{vars:f,isSupportFileVar:!0,onChange:g})})})]}),h4="nodes.ifElse.optionName",h5=({className:a,disabled:b,caseId:c,conditionId:d,condition:e,file:f,isSubVariableKey:g,isValueFieldShort:h,onRemoveCondition:i,onUpdateCondition:j,onAddSubVariableCondition:k,onRemoveSubVariableCondition:l,onUpdateSubVariableCondition:m,onToggleSubVariableConditionLogicalOperator:n,nodeId:o,nodesOutputVars:p,availableNodes:q,numberVariables:r,filterVar:s})=>{let{t}=(0,$.useTranslation)(),u=(0,aq.useIsChatMode)(),[v,w]=(0,K.useState)(!1),[x,y]=(0,K.useState)(!1),{data:z}=(0,Q.useAllBuiltInTools)(),{data:A}=(0,Q.useAllCustomTools)(),{data:B}=(0,Q.useAllWorkflowTools)(),{data:C}=(0,Q.useAllMCPTools)(),D=(0,aP.useWorkflowStore)(),E=(0,K.useCallback)(a=>{g?m?.(c,d,e.id,a):j?.(c,e.id,a)},[c,e,d,g,j,m]),G=(0,K.useMemo)(()=>!b&&(!g||!!e.key),[e.key,b,g]),H=(0,K.useCallback)(a=>{E({...e,comparison_operator:a})},[e,E]),J=(0,K.useCallback)(a=>{E({...e,numberVarType:a,value:""})},[e,E]),L=e.varType===aC.VarType.arrayFile&&[ch.ComparisonOperator.contains,ch.ComparisonOperator.notContains,ch.ComparisonOperator.allOf].includes(e.comparison_operator),M=(0,K.useMemo)(()=>f||(g?{key:e.key}:void 0),[e.key,f,g]),N=M?.key==="transfer_method"||M?.key==="type",O=(0,K.useCallback)(a=>{a===e.value||N&&a===e.value?.[0]||E({...e,value:N?[a]:a})},[e,E,N]),P=e.comparison_operator&&[ch.ComparisonOperator.in,ch.ComparisonOperator.notIn].includes(e.comparison_operator),R=(0,K.useMemo)(()=>{if(P){if(M?.key==="type"||e.comparison_operator===ch.ComparisonOperator.allOf)return hU.FILE_TYPE_OPTIONS.map(a=>({name:t(`${h4}.${a.i18nKey}`,{ns:"workflow"}),value:a.value}));if(M?.key==="transfer_method")return hU.TRANSFER_METHOD.map(a=>({name:t(`${h4}.${a.i18nKey}`,{ns:"workflow"}),value:a.value}))}return[]},[e.comparison_operator,M?.key,P,t]),T=P||L,U=hU.SUB_VARIABLES.map(a=>({name:a,value:a})),V=(0,K.useCallback)(a=>{let b=(0,I.produce)(e,b=>{b.key=a,"size"===a?b.varType=aC.VarType.number:b.varType=aC.VarType.string,b.value="",b.comparison_operator=(0,ci.getOperators)(void 0,{key:a})[0]});m?.(c,d,e.id,b)},[c,e,d,m]),W=(0,K.useCallback)(()=>{g?l?.(c,d,e.id):i?.(c,e.id)},[c,e,d,g,i,l]),{schemaTypeDefinitions:X}=(0,bX.default)(),Z=(0,K.useCallback)((a,b)=>{let{conversationVariables:c,setControlPromptEditorRerenderKey:d,dataSourceList:f}=D.getState(),g=(0,bY.getVarType)({valueSelector:a,conversationVariables:c,availableNodes:q,isChatMode:u,allPluginInfoList:{buildInTools:z||[],customTools:A||[],mcpTools:C||[],workflowTools:B||[],dataSourceList:f||[]},schemaTypeDefinitions:X});E((0,I.produce)(e,b=>{b.variable_selector=a,b.varType=g,b.value=g!==aC.VarType.boolean&&"",b.comparison_operator=(0,ci.getOperators)(g)[0],delete b.key,delete b.sub_variable_condition,delete b.numberVarType,setTimeout(()=>d(Date.now()))})),y(!1)},[e,E,q,u,X,z,A,C,B]),_=(0,K.useMemo)(()=>!!(e.varType===aC.VarType.boolean||e.varType===aC.VarType.arrayBoolean&&[ch.ComparisonOperator.contains,ch.ComparisonOperator.notContains].includes(e.comparison_operator)),[e]);return(0,F.jsxs)("div",{className:(0,S.cn)("mb-1 flex last-of-type:mb-0",a),children:[(0,F.jsxs)("div",{className:(0,S.cn)("grow rounded-lg bg-components-input-bg-normal",v&&"bg-state-destructive-hover"),children:[(0,F.jsxs)("div",{className:"flex items-center p-1",children:[(0,F.jsx)("div",{className:"w-0 grow",children:g?(0,F.jsx)(a4.SimpleSelect,{wrapperClassName:"h-6",className:"pl-0 text-xs",optionWrapClassName:"w-[165px] max-h-none",defaultValue:e.key,items:U,onSelect:a=>V(a.value),renderTrigger:a=>a?(0,F.jsx)("div",{className:"flex cursor-pointer justify-start",children:(0,F.jsxs)("div",{className:"inline-flex h-6 max-w-full items-center rounded-md border-[0.5px] border-components-panel-border-subtle bg-components-badge-white-to-dark px-1.5 text-text-accent shadow-xs",children:[(0,F.jsx)(a0.Variable02,{className:"h-3.5 w-3.5 shrink-0 text-text-accent"}),(0,F.jsx)("div",{className:"system-xs-medium ml-0.5 truncate",children:a?.name})]})}):(0,F.jsx)("div",{className:"system-sm-regular text-left text-components-input-text-placeholder",children:t("placeholder.select",{ns:"common"})}),hideChecked:!0}):(0,F.jsx)(h3,{open:x,onOpenChange:y,valueSelector:e.variable_selector||[],varType:e.varType,availableNodes:q,nodesOutputVars:p,onChange:Z})}),(0,F.jsx)("div",{className:"mx-1 h-3 w-[1px] bg-divider-regular"}),(0,F.jsx)(h2,{disabled:!G,varType:e.varType,value:e.comparison_operator,onSelect:H,file:M})]}),!(0,ci.comparisonOperatorNotRequireValue)(e.comparison_operator)&&!T&&e.varType!==aC.VarType.number&&!_&&(0,F.jsx)("div",{className:"max-h-[100px] overflow-y-auto border-t border-t-divider-subtle px-2 py-1",children:(0,F.jsx)(h0,{disabled:b,value:e.value,onChange:O,nodesOutputVars:p,availableNodes:q})}),!(0,ci.comparisonOperatorNotRequireValue)(e.comparison_operator)&&!T&&_&&(0,F.jsx)("div",{className:"p-1",children:(0,F.jsx)(gC,{value:e.value,onChange:O})}),!(0,ci.comparisonOperatorNotRequireValue)(e.comparison_operator)&&!T&&e.varType===aC.VarType.number&&(0,F.jsx)("div",{className:"border-t border-t-divider-subtle px-2 py-1 pt-[3px]",children:(0,F.jsx)(h_,{numberVarType:e.numberVarType,onNumberVarTypeChange:J,value:e.value,onValueChange:O,variables:r,isShort:h,unit:M?.key==="size"?"Byte":void 0})}),!(0,ci.comparisonOperatorNotRequireValue)(e.comparison_operator)&&P&&(0,F.jsx)("div",{className:"border-t border-t-divider-subtle",children:(0,F.jsx)(a4.SimpleSelect,{wrapperClassName:"h-8",className:"rounded-t-none px-2 text-xs",defaultValue:N?e.value?.[0]:e.value,items:R,onSelect:a=>O(a.value),hideChecked:!0,notClearable:!0})}),!(0,ci.comparisonOperatorNotRequireValue)(e.comparison_operator)&&L&&(0,F.jsx)("div",{className:"p-1",children:(0,F.jsx)(h7,{isSubVariable:!0,caseId:c,conditionId:d,readOnly:!!b,cases:e.sub_variable_condition?[e.sub_variable_condition]:[],handleAddSubVariableCondition:k,handleRemoveSubVariableCondition:l,handleUpdateSubVariableCondition:m,handleToggleSubVariableConditionLogicalOperator:n,nodeId:o,nodesOutputVars:p,availableNodes:q,filterVar:s})})]}),(0,F.jsx)("div",{className:"ml-1 mt-1 flex h-6 w-6 shrink-0 cursor-pointer items-center justify-center rounded-lg text-text-tertiary hover:bg-state-destructive-hover hover:text-text-destructive",onMouseEnter:()=>w(!0),onMouseLeave:()=>w(!1),onClick:W,children:(0,F.jsx)(Y.RiDeleteBinLine,{className:"h-4 w-4"})})]})},h6=({isSubVariable:a,disabled:b,caseId:c,conditionId:d,caseItem:e,onUpdateCondition:f,onRemoveCondition:g,onToggleConditionLogicalOperator:h,onAddSubVariableCondition:i,onRemoveSubVariableCondition:j,onUpdateSubVariableCondition:k,onToggleSubVariableConditionLogicalOperator:l,nodeId:m,nodesOutputVars:n,availableNodes:o,numberVariables:p,varsIsVarFileAttribute:q,filterVar:r})=>{let{conditions:s,logical_operator:t}=e,u=(0,K.useCallback)(()=>{a?l?.(c,d):h?.(c)},[c,d,a,h,l]),v=(0,K.useMemo)(()=>!!a&&!!(s.length>1),[s.length,a]),w=(0,K.useMemo)(()=>!a||s.length<2?"":t===ch.LogicalOperator.and?"pl-[51px]":"pl-[42px]",[s.length,a,t]);return(0,F.jsxs)("div",{className:(0,S.cn)("relative",!a&&"pl-[60px]"),children:[s.length>1&&(0,F.jsxs)("div",{className:(0,S.cn)("absolute bottom-0 left-0 top-0 w-[60px]",a&&t===ch.LogicalOperator.and&&"left-[-10px]",a&&t===ch.LogicalOperator.or&&"left-[-18px]"),children:[(0,F.jsx)("div",{className:"absolute bottom-4 left-[46px] top-4 w-2.5 rounded-l-[8px] border border-r-0 border-divider-deep"}),(0,F.jsx)("div",{className:"absolute right-0 top-1/2 h-[29px] w-4 -translate-y-1/2 bg-components-panel-bg"}),(0,F.jsxs)("div",{className:"absolute right-1 top-1/2 flex h-[21px] -translate-y-1/2 cursor-pointer select-none items-center rounded-md border-[0.5px] border-components-button-secondary-border bg-components-button-secondary-bg px-1 text-[10px] font-semibold text-text-accent-secondary shadow-xs",onClick:u,children:[t.toUpperCase(),(0,F.jsx)(Y.RiLoopLeftLine,{className:"ml-0.5 h-3 w-3"})]})]}),e.conditions.map(e=>(0,F.jsx)(h5,{className:w,disabled:b,caseId:c,conditionId:a?d:e.id,condition:e,isValueFieldShort:v,onUpdateCondition:f,onRemoveCondition:g,onAddSubVariableCondition:i,onRemoveSubVariableCondition:j,onUpdateSubVariableCondition:k,onToggleSubVariableConditionLogicalOperator:l,nodeId:m,nodesOutputVars:n,availableNodes:o,filterVar:r,numberVariables:p,file:q[e.id]?{key:(e.variable_selector||[]).slice(-1)[0]}:void 0,isSubVariableKey:a},e.id))]})},h7=K.memo(({isSubVariable:a,caseId:b,conditionId:c,nodeId:d="",cases:e=[],readOnly:f,handleSortCase:g=hT.noop,handleRemoveCase:h,handleUpdateCondition:i,handleAddCondition:j,handleRemoveCondition:k,handleToggleConditionLogicalOperator:l,handleAddSubVariableCondition:m,handleRemoveSubVariableCondition:n,handleUpdateSubVariableCondition:o,handleToggleSubVariableConditionLogicalOperator:p,nodesOutputVars:q=[],availableNodes:r=[],varsIsVarFileAttribute:s={},filterVar:t=()=>!0})=>{let{t:u}=(0,$.useTranslation)(),v=e8(),[w,x]=(0,K.useState)(""),y=e.length,z=(0,K.useCallback)(a=>a.type===aC.VarType.number,[]),A=hU.SUB_VARIABLES.map(a=>({name:a,value:a}));return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(gQ.ReactSortable,{list:e.map(a=>({...a,id:a.case_id})),setList:g,handle:".handle",ghostClass:"bg-components-panel-bg",animation:150,disabled:f||a,children:e.map((e,g)=>(0,F.jsxs)("div",{children:[(0,F.jsxs)("div",{className:(0,S.cn)("group relative rounded-[10px] bg-components-panel-bg",w===e.case_id&&"bg-state-destructive-hover",!a&&"min-h-[40px] px-3 py-1 ",a&&"px-1 py-2"),children:[!a&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(Y.RiDraggable,{className:(0,S.cn)("handle absolute left-1 top-2 hidden h-3 w-3 cursor-pointer text-text-quaternary",y>1&&"group-hover:block")}),(0,F.jsxs)("div",{className:(0,S.cn)("absolute left-4 text-[13px] font-semibold leading-4 text-text-secondary",1===y?"top-2.5":"top-1"),children:[0===g?"IF":"ELIF",y>1&&(0,F.jsxs)("div",{className:"text-[10px] font-medium text-text-tertiary",children:["CASE",g+1]})]})]}),!!e.conditions.length&&(0,F.jsx)("div",{className:"mb-2",children:(0,F.jsx)(h6,{disabled:f,caseItem:e,caseId:a?b:e.case_id,conditionId:c,onUpdateCondition:i,onRemoveCondition:k,onToggleConditionLogicalOperator:l,nodeId:d,nodesOutputVars:q,availableNodes:r,filterVar:t,numberVariables:v(d,"",z),varsIsVarFileAttribute:s,onAddSubVariableCondition:m,onRemoveSubVariableCondition:n,onUpdateSubVariableCondition:o,onToggleSubVariableConditionLogicalOperator:p,isSubVariable:a})}),(0,F.jsxs)("div",{className:(0,S.cn)("flex items-center justify-between pr-[30px]",!e.conditions.length&&!a&&"mt-1",!e.conditions.length&&a&&"mt-2",!a&&" pl-[60px]"),children:[a?(0,F.jsx)(a4.PortalSelect,{popupInnerClassName:"w-[165px] max-h-none",onSelect:a=>m?.(b,c,a.value),items:A,value:"",renderTrigger:()=>(0,F.jsxs)(av.default,{size:"small",disabled:f,children:[(0,F.jsx)(Y.RiAddLine,{className:"mr-1 h-3.5 w-3.5"}),u("nodes.ifElse.addSubVariable",{ns:"workflow"})]}),hideChecked:!0}):(0,F.jsx)(hV,{disabled:f,caseId:e.case_id,variables:v(d,"",t),onSelectVariable:j}),(0===g&&y>1||g>0)&&(0,F.jsxs)(av.default,{className:"hover:bg-components-button-destructive-ghost-bg-hover hover:text-components-button-destructive-ghost-text",size:"small",variant:"ghost",disabled:f,onClick:()=>h?.(e.case_id),onMouseEnter:()=>x(e.case_id),onMouseLeave:()=>x(""),children:[(0,F.jsx)(Y.RiDeleteBinLine,{className:"mr-1 h-3.5 w-3.5"}),u("operation.remove",{ns:"common"})]})]})]}),!a&&(0,F.jsx)("div",{className:"mx-3 my-2 h-px bg-divider-subtle"})]},e.case_id))}),0===e.length&&(0,F.jsxs)(av.default,{size:"small",disabled:f,onClick:()=>m?.(b,c),children:[(0,F.jsx)(Y.RiAddLine,{className:"mr-1 h-3.5 w-3.5"}),u("nodes.ifElse.addSubVariable",{ns:"workflow"})]})]})}),h8="nodes.ifElse",h9=(0,K.memo)(({id:a,data:b})=>{let{t:c}=(0,$.useTranslation)(),{readOnly:d,inputs:e,filterVar:f,handleAddCase:g,handleRemoveCase:h,handleSortCase:i,handleAddCondition:j,handleUpdateCondition:k,handleRemoveCondition:l,handleToggleConditionLogicalOperator:m,handleAddSubVariableCondition:n,handleRemoveSubVariableCondition:o,handleUpdateSubVariableCondition:p,handleToggleSubVariableConditionLogicalOperator:q,nodesOutputVars:r,availableNodes:s,varsIsVarFileAttribute:t}=((a,b)=>{let c=(0,N.useUpdateNodeInternals)(),{nodesReadOnly:d}=(0,aq.useNodesReadOnly)(),{handleEdgeDeleteByDeleteBranch:e}=(0,bm.useEdgesInteractions)(),{inputs:f,setInputs:g}=eA(a,b),h=(0,K.useCallback)(()=>!0,[]),{availableVars:i,availableNodesWithParent:j}=(0,eD.default)(a,{onlyLeafNodeVar:!1,filterVar:h}),k=(0,K.useCallback)(a=>a.type===aC.VarType.number,[]),{getIsVarFileAttribute:l}=(({nodeId:a,isInIteration:b,isInLoop:c})=>{let d=(0,aq.useIsChatMode)(),e=(0,N.useStoreApi)(),{getBeforeNodesInSameBranch:f}=(0,aq.useWorkflow)(),{getNodes:g}=e.getState(),h=g().find(b=>b.id===a),i=b?g().find(a=>a.id===h.parentId):null,j=c?g().find(a=>a.id===h.parentId):null,k=(0,K.useMemo)(()=>f(a),[f,a]),{getCurrentVariableType:l}=(0,e5.useWorkflowVariables)();return{getIsVarFileAttribute:a=>3===a.length&&l({parentNode:b?i:j,valueSelector:a.slice(0,2),availableNodes:k,isChatMode:d,isConstant:!1})===aC.VarType.file}})({nodeId:a,isInIteration:b.isInIteration,isInLoop:b.isInLoop}),m=(0,K.useMemo)(()=>{let a={};return f.cases?.forEach(b=>{b.conditions.forEach(b=>{a[b.id]=l(b.variable_selector)})}),a},[f.cases,l]),{availableVars:n,availableNodesWithParent:o}=(0,eD.default)(a,{onlyLeafNodeVar:!1,filterVar:k}),p=(0,K.useCallback)(()=>{g((0,I.produce)(f,a=>{if(a.cases){let b=(0,du.v4)();if(a.cases.push({case_id:b,logical_operator:ch.LogicalOperator.and,conditions:[]}),a._targetBranches){let c=a._targetBranches.findIndex(a=>"false"===a.id);c>-1&&(a._targetBranches=(0,ci.branchNameCorrect)([...a._targetBranches.slice(0,c),{id:b,name:""},...a._targetBranches.slice(c)]))}}}))},[f,g]),q=(0,K.useCallback)(b=>{g((0,I.produce)(f,c=>{c.cases=c.cases?.filter(a=>a.case_id!==b),c._targetBranches&&(c._targetBranches=(0,ci.branchNameCorrect)(c._targetBranches.filter(a=>a.id!==b))),e(a,b)}))},[f,g,a,e]),r=(0,K.useCallback)(b=>{g((0,I.produce)(f,a=>{a.cases=b.filter(Boolean).map(a=>({id:a.id,case_id:a.case_id,logical_operator:a.logical_operator,conditions:a.conditions})),a._targetBranches=(0,ci.branchNameCorrect)([...b.filter(Boolean).map(a=>({id:a.case_id,name:""})),{id:"false",name:""}])})),c(a)},[a,f,g,c]),s=(0,K.useCallback)((a,b,c)=>{g((0,I.produce)(f,d=>{let e=d.cases?.find(b=>b.case_id===a);e&&e.conditions.push({id:(0,du.v4)(),varType:c.type,variable_selector:b,comparison_operator:(0,ci.getOperators)(c.type,l(b)?{key:b.slice(-1)[0]}:void 0)[0],value:c.type!==aC.VarType.boolean&&c.type!==aC.VarType.arrayBoolean&&""})}))},[l,f,g]),t=(0,K.useCallback)((a,b)=>{g((0,I.produce)(f,c=>{let d=c.cases?.find(b=>b.case_id===a);d&&(d.conditions=d.conditions.filter(a=>a.id!==b))}))},[f,g]),u=(0,K.useCallback)((a,b,c)=>{g((0,I.produce)(f,d=>{let e=d.cases?.find(b=>b.case_id===a);if(e){let a=e.conditions.find(a=>a.id===b);a&&Object.assign(a,c)}}))},[f,g]),v=(0,K.useCallback)(a=>{g((0,I.produce)(f,b=>{let c=b.cases?.find(b=>b.case_id===a);c&&(c.logical_operator=c.logical_operator===ch.LogicalOperator.and?ch.LogicalOperator.or:ch.LogicalOperator.and)}))},[f,g]),w=(0,K.useCallback)((a,b,c)=>{g((0,I.produce)(f,d=>{let e=d.cases?.find(b=>b.case_id===a)?.conditions.find(a=>a.id===b);if(!e)return;e?.sub_variable_condition||(e.sub_variable_condition={case_id:(0,du.v4)(),logical_operator:ch.LogicalOperator.and,conditions:[]});let f=e.sub_variable_condition;f&&(f.conditions||(f.conditions=[]),f.conditions.push({id:(0,du.v4)(),key:c||"",varType:aC.VarType.string,comparison_operator:void 0,value:""}))}))},[f,g]),x=(0,K.useCallback)((a,b,c)=>{g((0,I.produce)(f,d=>{let e=d.cases?.find(b=>b.case_id===a)?.conditions.find(a=>a.id===b);if(!e||!e?.sub_variable_condition)return;let f=e.sub_variable_condition;f&&(f.conditions=f.conditions.filter(a=>a.id!==c))}))},[f,g]),y=(0,K.useCallback)((a,b,c,d)=>{g((0,I.produce)(f,e=>{let f=e.cases?.find(b=>b.case_id===a);if(f){let a=f.conditions.find(a=>a.id===b);if(a&&a.sub_variable_condition){let b=a.sub_variable_condition.conditions.find(a=>a.id===c);b&&Object.assign(b,d)}}}))},[f,g]),z=(0,K.useCallback)((a,b)=>{g((0,I.produce)(f,c=>{let d=c.cases?.find(b=>b.case_id===a);if(d){let a=d.conditions.find(a=>a.id===b);a&&a.sub_variable_condition&&(a.sub_variable_condition.logical_operator=a.sub_variable_condition.logical_operator===ch.LogicalOperator.and?ch.LogicalOperator.or:ch.LogicalOperator.and)}}))},[f,g]);return{readOnly:d,inputs:f,filterVar:h,filterNumberVar:k,handleAddCase:p,handleRemoveCase:q,handleSortCase:r,handleAddCondition:s,handleRemoveCondition:t,handleUpdateCondition:u,handleToggleConditionLogicalOperator:v,handleAddSubVariableCondition:w,handleUpdateSubVariableCondition:y,handleRemoveSubVariableCondition:x,handleToggleSubVariableConditionLogicalOperator:z,nodesOutputVars:i,availableNodes:j,nodesOutputNumberVars:n,availableNumberNodes:o,varsIsVarFileAttribute:m}})(a,b),u=e.cases||[];return(0,F.jsxs)("div",{className:"p-1",children:[(0,F.jsx)(h7,{nodeId:a,cases:u,readOnly:d,handleSortCase:i,handleRemoveCase:h,handleAddCondition:j,handleRemoveCondition:l,handleUpdateCondition:k,handleToggleConditionLogicalOperator:m,handleAddSubVariableCondition:n,handleRemoveSubVariableCondition:o,handleUpdateSubVariableCondition:p,handleToggleSubVariableConditionLogicalOperator:q,nodesOutputVars:r,availableNodes:s,varsIsVarFileAttribute:t,filterVar:f}),(0,F.jsx)("div",{className:"px-4 py-2",children:(0,F.jsxs)(av.default,{className:"w-full",variant:"tertiary",onClick:()=>g(),disabled:d,children:[(0,F.jsx)(Y.RiAddLine,{className:"mr-1 h-4 w-4"}),"ELIF"]})}),(0,F.jsx)("div",{className:"mx-3 my-2 h-px bg-divider-subtle"}),(0,F.jsx)(fW,{title:c(`${h8}.else`,{ns:"workflow"}),className:"px-4 py-2",children:(0,F.jsx)("div",{className:"text-xs font-normal leading-[18px] text-text-tertiary",children:c(`${h8}.elseDescription`,{ns:"workflow"})})})]})}),ia=()=>{let{t:a}=(0,$.useTranslation)();return(0,F.jsx)("div",{className:"nodrag relative left-[17px] top-[21px] z-[11] flex h-11 w-11 items-center justify-center rounded-2xl border border-workflow-block-border bg-workflow-block-bg",children:(0,F.jsx)(ac.default,{popupContent:a("blocks.iteration-start",{ns:"workflow"}),asChild:!1,children:(0,F.jsx)("div",{className:"flex h-6 w-6 items-center justify-center rounded-full border-[0.5px] border-components-panel-border-subtle bg-util-colors-blue-brand-blue-brand-500",children:(0,F.jsx)(Y.RiHome5Fill,{className:"h-3 w-3 text-text-primary-on-surface"})})})})},ib=(0,K.memo)(({id:a,data:b})=>{let{t:c}=(0,$.useTranslation)();return(0,F.jsxs)("div",{className:"nodrag group mt-1 flex h-11 w-11 items-center justify-center rounded-2xl border border-workflow-block-border bg-workflow-block-bg shadow-xs",children:[(0,F.jsx)(ac.default,{popupContent:c("blocks.iteration-start",{ns:"workflow"}),asChild:!1,children:(0,F.jsx)("div",{className:"flex h-6 w-6 items-center justify-center rounded-full border-[0.5px] border-components-panel-border-subtle bg-util-colors-blue-brand-blue-brand-500",children:(0,F.jsx)(Y.RiHome5Fill,{className:"h-3 w-3 text-text-primary-on-surface"})})}),(0,F.jsx)(fg,{id:a,data:b,handleClassName:"!top-1/2 !-right-[9px] !-translate-y-1/2",handleId:"source"})]})}),ic=(0,K.memo)(({iterationNodeData:a})=>{let{t:b}=(0,$.useTranslation)(),{nodesReadOnly:c}=(0,aq.useNodesReadOnly)(),{handleNodeAdd:d}=(0,V.useNodesInteractions)(),{availableNextBlocks:e}=(0,an.useAvailableBlocks)(aC.BlockEnum.Start,!0),f=(0,K.useCallback)((b,c)=>{d({nodeType:b,pluginDefaultValue:c},{prevNodeId:a.start_node_id,prevNodeSourceHandle:"source"})},[d,a.start_node_id]),g=(0,K.useCallback)(a=>(0,F.jsxs)("div",{className:(0,S.cn)("system-sm-medium relative inline-flex h-8 cursor-pointer items-center rounded-lg border-[0.5px] border-components-button-secondary-border bg-components-button-secondary-bg px-3 text-components-button-secondary-text shadow-xs backdrop-blur-[5px] hover:bg-components-button-secondary-bg-hover",`${c&&"!cursor-not-allowed bg-components-button-secondary-bg-disabled"}`,a&&"bg-components-button-secondary-bg-hover"),children:[(0,F.jsx)(Y.RiAddLine,{className:"mr-1 h-4 w-4"}),b("common.addBlock",{ns:"workflow"})]}),[c,b]);return(0,F.jsxs)("div",{className:"absolute left-14 top-7 z-10 flex h-8 items-center",children:[(0,F.jsx)("div",{className:"group/insert relative h-0.5 w-16 bg-gray-300",children:(0,F.jsx)("div",{className:"absolute right-0 top-1/2 h-2 w-0.5 -translate-y-1/2 bg-primary-500"})}),(0,F.jsx)(dT,{disabled:c,onSelect:f,trigger:g,triggerInnerClassName:"inline-flex",popupClassName:"!min-w-[256px]",availableBlocksTypes:e})]})}),id=(0,K.memo)(({id:a,data:b})=>{let{zoom:c}=(0,N.useViewport)(),d=(0,N.useNodesInitialized)(),{handleNodeIterationRerender:e}=(0,e_.useNodeIterationInteractions)(),{t:f}=(0,$.useTranslation)(),[g,h]=(0,K.useState)(b._isShowTips);return(0,K.useEffect)(()=>{d&&e(a),b.is_parallel&&g&&(aX.default.notify({type:"warning",message:f("nodes.iteration.answerNodeWarningDesc",{ns:"workflow"}),duration:5e3}),h(!1))},[d,a,e,b.is_parallel,g,f]),(0,F.jsxs)("div",{className:(0,S.cn)("relative h-full min-h-[90px] w-full min-w-[240px] rounded-2xl bg-workflow-canvas-workflow-bg"),children:[(0,F.jsx)(M.Background,{id:`iteration-background-${a}`,className:"!z-0 rounded-2xl",gap:[14/c,14/c],size:2/c,color:"var(--color-workflow-canvas-workflow-dot-color)"}),b._isCandidate&&(0,F.jsx)(ia,{}),1===b._children.length&&(0,F.jsx)(ic,{iterationNodeId:a,iterationNodeData:b})]})}),ie="nodes.iteration",ig=K.memo(({id:a,data:b})=>{let{t:c}=(0,$.useTranslation)(),d=[{value:aC.ErrorHandleMode.Terminated,name:c(`${ie}.ErrorMethod.operationTerminated`,{ns:"workflow"})},{value:aC.ErrorHandleMode.ContinueOnError,name:c(`${ie}.ErrorMethod.continueOnError`,{ns:"workflow"})},{value:aC.ErrorHandleMode.RemoveAbnormalOutput,name:c(`${ie}.ErrorMethod.removeAbnormalOutput`,{ns:"workflow"})}],{readOnly:e,inputs:f,filterInputVar:g,handleInputChange:h,childrenNodeVars:i,iterationChildrenNodes:j,handleOutputVarChange:k,changeParallel:l,changeErrorResponseMode:m,changeParallelNums:n,changeFlattenOutput:o}=((a,b)=>{let{deleteNodeInspectorVars:c}=(0,at.default)(),{nodesReadOnly:d}=(0,aq.useNodesReadOnly)(),e=(0,aq.useIsChatMode)(),{inputs:f,setInputs:g}=eA(a,b),h=(0,K.useCallback)(a=>[aC.VarType.array,aC.VarType.arrayString,aC.VarType.arrayBoolean,aC.VarType.arrayNumber,aC.VarType.arrayObject,aC.VarType.arrayFile].includes(a.type),[]),i=(0,K.useCallback)((a,b,c)=>{g((0,I.produce)(f,b=>{b.iterator_selector=a||[],b.iterator_input_type=c?.type||aC.VarType.arrayString}))},[f,g]),{getIterationNodeChildren:j}=(0,aq.useWorkflow)(),k=j(a),{data:l}=(0,Q.useAllBuiltInTools)(),{data:m}=(0,Q.useAllCustomTools)(),{data:n}=(0,Q.useAllWorkflowTools)(),{data:o}=(0,Q.useAllMCPTools)(),p=(0,aP.useStore)(a=>a.dataSourceList),q=(0,bY.toNodeOutputVars)(k,e,void 0,[],[],[],{buildInTools:l||[],customTools:m||[],workflowTools:n||[],mcpTools:o||[],dataSourceList:p||[]}),r=(0,K.useCallback)((b,d,e)=>{(0,H.isEqual)(f.output_selector,b)||(g((0,I.produce)(f,a=>{a.output_selector=b||[];let c=e?.type||aC.VarType.string;a.output_type=({[aC.VarType.string]:aC.VarType.arrayString,[aC.VarType.number]:aC.VarType.arrayNumber,[aC.VarType.object]:aC.VarType.arrayObject,[aC.VarType.file]:aC.VarType.arrayFile,[aC.VarType.array]:aC.VarType.array,[aC.VarType.arrayFile]:aC.VarType.arrayFile,[aC.VarType.arrayString]:aC.VarType.arrayString,[aC.VarType.arrayNumber]:aC.VarType.arrayNumber,[aC.VarType.arrayObject]:aC.VarType.arrayObject})[c]||aC.VarType.arrayString})),c(a))},[c,a,f,g]),s=(0,K.useCallback)(a=>{g((0,I.produce)(f,b=>{b.is_parallel=a}))},[f,g]),t=(0,K.useCallback)(a=>{g((0,I.produce)(f,b=>{b.error_handle_mode=a.value}))},[f,g]),u=(0,K.useCallback)(a=>{g((0,I.produce)(f,b=>{b.parallel_nums=a}))},[f,g]),v=(0,K.useCallback)(a=>{g((0,I.produce)(f,b=>{b.flatten_output=a}))},[f,g]);return{readOnly:d,inputs:f,filterInputVar:h,handleInputChange:i,childrenNodeVars:q,iterationChildrenNodes:k,handleOutputVarChange:r,changeParallel:s,changeErrorResponseMode:t,changeParallelNums:u,changeFlattenOutput:v}})(a,b);return(0,F.jsxs)("div",{className:"pb-2 pt-2",children:[(0,F.jsx)("div",{className:"space-y-4 px-4 pb-4",children:(0,F.jsx)(fW,{title:c(`${ie}.input`,{ns:"workflow"}),required:!0,operations:(0,F.jsx)("div",{className:"system-2xs-medium-uppercase flex h-[18px] items-center rounded-[5px] border border-divider-deep px-1 capitalize text-text-tertiary",children:"Array"}),children:(0,F.jsx)(gA.default,{readonly:e,nodeId:a,isShowNodeName:!0,value:f.iterator_selector||[],onChange:h,filterVar:g})})}),(0,F.jsx)(au,{}),(0,F.jsx)("div",{className:"mt-2 space-y-4 px-4 pb-4",children:(0,F.jsx)(fW,{title:c(`${ie}.output`,{ns:"workflow"}),required:!0,operations:(0,F.jsx)("div",{className:"system-2xs-medium-uppercase flex h-[18px] items-center rounded-[5px] border border-divider-deep px-1 capitalize text-text-tertiary",children:"Array"}),children:(0,F.jsx)(gA.default,{readonly:e,nodeId:a,isShowNodeName:!0,value:f.output_selector||[],onChange:k,availableNodes:j,availableVars:i})})}),(0,F.jsx)("div",{className:"px-4 pb-2",children:(0,F.jsx)(fW,{title:c(`${ie}.parallelMode`,{ns:"workflow"}),tooltip:(0,F.jsx)("div",{className:"w-[230px]",children:c(`${ie}.parallelPanelDesc`,{ns:"workflow"})}),inline:!0,children:(0,F.jsx)(d4.default,{defaultValue:f.is_parallel,onChange:l})})}),f.is_parallel&&(0,F.jsx)("div",{className:"px-4 pb-2",children:(0,F.jsx)(fW,{title:c(`${ie}.MaxParallelismTitle`,{ns:"workflow"}),isSubTitle:!0,tooltip:(0,F.jsx)("div",{className:"w-[230px]",children:c(`${ie}.MaxParallelismDesc`,{ns:"workflow"})}),children:(0,F.jsxs)("div",{className:"row flex",children:[(0,F.jsx)(a2.default,{type:"number",wrapperClassName:"w-18 mr-4 ",max:O.MAX_PARALLEL_LIMIT,min:T.MIN_ITERATION_PARALLEL_NUM,value:f.parallel_nums,onChange:a=>{n(Number(a.target.value))}}),(0,F.jsx)(d3.default,{value:f.parallel_nums,onChange:n,max:O.MAX_PARALLEL_LIMIT,min:T.MIN_ITERATION_PARALLEL_NUM,className:" mt-4 flex-1 shrink-0"})]})})}),(0,F.jsx)(au,{}),(0,F.jsx)("div",{className:"px-4 py-2",children:(0,F.jsx)(fW,{title:c(`${ie}.errorResponseMethod`,{ns:"workflow"}),children:(0,F.jsx)(a4.default,{items:d,defaultValue:f.error_handle_mode,onSelect:m,allowSearch:!1})})}),(0,F.jsx)(au,{}),(0,F.jsx)("div",{className:"px-4 py-2",children:(0,F.jsx)(fW,{title:c(`${ie}.flattenOutput`,{ns:"workflow"}),tooltip:(0,F.jsx)("div",{className:"w-[230px]",children:c(`${ie}.flattenOutputDesc`,{ns:"workflow"})}),inline:!0,children:(0,F.jsx)(d4.default,{defaultValue:f.flatten_output,onChange:o})})})]})});a.i(387799);var ih=((x={}).general="text_model",x.parent_child="hierarchical_model",x.question_answer="qa_model",x),ii=a.i(944054),ii=ii,ij=aI;let ik=(0,K.memo)(({data:a})=>{let{t:b}=(0,$.useTranslation)(),c=(()=>{let{t:a}=(0,$.useTranslation)();return{[ii.IndexingType.QUALIFIED]:a("stepTwo.qualified",{ns:"datasetCreation"}),[ii.IndexingType.ECONOMICAL]:a("form.indexMethodEconomy",{ns:"datasetSettings"}),[ij.RETRIEVE_METHOD.semantic]:a("retrieval.semantic_search.title",{ns:"dataset"}),[ij.RETRIEVE_METHOD.fullText]:a("retrieval.full_text_search.title",{ns:"dataset"}),[ij.RETRIEVE_METHOD.hybrid]:a("retrieval.hybrid_search.title",{ns:"dataset"}),[ij.RETRIEVE_METHOD.keywordSearch]:a("retrieval.keyword_search.title",{ns:"dataset"})}})();return(0,F.jsxs)("div",{className:"mb-1 space-y-0.5 px-3 py-1",children:[(0,F.jsxs)("div",{className:"flex h-6 items-center rounded-md bg-workflow-block-parma-bg px-1.5",children:[(0,F.jsx)("div",{className:"system-xs-medium-uppercase mr-2 shrink-0 text-text-tertiary",children:b("stepTwo.indexMode",{ns:"datasetCreation"})}),(0,F.jsx)("div",{className:"system-xs-medium grow truncate text-right text-text-secondary",title:a.indexing_technique,children:c[a.indexing_technique]})]}),(0,F.jsxs)("div",{className:"flex h-6 items-center rounded-md bg-workflow-block-parma-bg px-1.5",children:[(0,F.jsx)("div",{className:"system-xs-medium-uppercase mr-2 shrink-0 text-text-tertiary",children:b("form.retrievalSetting.title",{ns:"datasetSettings"})}),(0,F.jsx)("div",{className:"system-xs-medium grow truncate text-right text-text-secondary",title:a.retrieval_model?.search_method,children:c[a.retrieval_model?.search_method]})]})]})});var il=a.i(322715),im=a.i(516877);a.i(97847);var io=a.i(519292),io=io,ip=a.i(485907),ip=ip,iq=a.i(716369),iq=iq,ir=a.i(472253),ir=ir,is=a.i(538328),is=is;a.i(224256);var it=a.i(654118);let iu={blue:(0,F.jsx)(io.default,{}),"blue-light":(0,F.jsx)(ip.default,{}),orange:(0,F.jsx)(iq.default,{}),purple:(0,F.jsx)(ir.default,{}),teal:(0,F.jsx)(is.default,{})},iv=(0,K.memo)(({id:a,selectedId:b,enableSelect:c=!0,enableHighlightBorder:d=!0,enableRadio:e,wrapperClassName:f,className:g,icon:h,title:i,description:j,isRecommended:k,children:l,effectColor:m,onClick:n,readonly:o})=>{let{t:p}=(0,$.useTranslation)(),q=(0,K.useMemo)(()=>a===b,[a,b]),r=(0,K.useMemo)(()=>m?(0,F.jsx)("div",{className:(0,S.cn)("absolute left-[-2px] top-[-2px] hidden h-14 w-14 rounded-full","group-hover:block",q&&"block"),children:iu[m]}):null,[m,q]);return(0,F.jsxs)("div",{className:(0,S.cn)("group overflow-hidden rounded-xl border border-components-option-card-option-border bg-components-option-card-option-bg",q&&d&&"border-[1.5px] border-components-option-card-option-selected-border",c&&"cursor-pointer hover:shadow-xs",o&&"cursor-not-allowed",f&&("function"==typeof f?f(q):f)),onClick:b=>{b.stopPropagation(),!o&&c&&a&&n?.(a)},children:[(0,F.jsxs)("div",{className:(0,S.cn)("relative flex rounded-t-xl p-2",g&&("function"==typeof g?g(q):g)),children:[r,!!h&&(0,F.jsx)("div",{className:"mr-1 flex h-[18px] w-[18px] shrink-0 items-center justify-center",children:"function"==typeof h?h(q):h}),(0,F.jsxs)("div",{className:"grow py-1 pt-[1px]",children:[(0,F.jsxs)("div",{className:"flex items-center",children:[(0,F.jsxs)("div",{className:"system-sm-medium flex grow items-center text-text-secondary",children:[i,k&&(0,F.jsx)(dM.default,{className:"ml-1 h-4 border-text-accent-secondary text-text-accent-secondary",children:p("stepTwo.recommend",{ns:"datasetCreation"})})]}),e&&(0,F.jsx)("div",{className:(0,S.cn)("ml-2 h-4 w-4 shrink-0 rounded-full border border-components-radio-border bg-components-radio-bg",q&&"border-[5px] border-components-radio-border-checked")})]}),j&&(0,F.jsx)("div",{className:"system-xs-regular mt-1 text-text-tertiary",children:j})]})]}),!!(l&&q)&&(0,F.jsxs)("div",{className:"relative rounded-b-xl bg-components-panel-bg p-3",children:[(0,F.jsx)(it.ArrowShape,{className:"absolute left-[14px] top-[-11px] h-4 w-4 text-components-panel-bg"}),l]})]})});var iw=a.i(463561),ix=a.i(12588),iy=a.i(765239),iz=a.i(211827),iz=iz;let iA=K.memo(({type:a="vertical",className:b})=>"vertical"===a?(0,F.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"2",height:"132",viewBox:"0 0 2 132",fill:"none",className:b,children:[(0,F.jsx)("path",{d:"M1 0L1 132",stroke:"url(#paint0_linear_10882_18766)"}),(0,F.jsx)("defs",{children:(0,F.jsxs)("linearGradient",{id:"paint0_linear_10882_18766",x1:"-7.99584",y1:"132",x2:"-7.96108",y2:"6.4974e-07",gradientUnits:"userSpaceOnUse",children:[(0,F.jsx)("stop",{stopColor:"var(--color-background-gradient-mask-transparent)"}),(0,F.jsx)("stop",{offset:"0.877606",stopColor:"var(--color-divider-subtle)"}),(0,F.jsx)("stop",{offset:"1",stopColor:"var(--color-background-gradient-mask-transparent)"})]})})]}):(0,F.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"240",height:"2",viewBox:"0 0 240 2",fill:"none",className:b,children:[(0,F.jsx)("path",{d:"M0 1H240",stroke:"url(#paint0_linear_10882_18763)"}),(0,F.jsx)("defs",{children:(0,F.jsxs)("linearGradient",{id:"paint0_linear_10882_18763",x1:"240",y1:"9.99584",x2:"3.95539e-05",y2:"9.88094",gradientUnits:"userSpaceOnUse",children:[(0,F.jsx)("stop",{stopColor:"var(--color-background-gradient-mask-transparent)"}),(0,F.jsx)("stop",{offset:"0.9031",stopColor:"var(--color-divider-subtle)"}),(0,F.jsx)("stop",{offset:"1",stopColor:"var(--color-background-gradient-mask-transparent)"})]})})]})),iB=K.memo(({className:a})=>{let{t:b}=(0,$.useTranslation)(),c=(0,bk.useDocLink)();return(0,F.jsxs)("div",{className:(0,S.cn)("flex flex-col gap-y-2 overflow-hidden rounded-[10px] bg-workflow-process-bg p-4",a),children:[(0,F.jsxs)("div",{className:"relative flex size-10 items-center justify-center rounded-[10px] border-[0.5px] border-components-card-border bg-components-card-bg shadow-lg backdrop-blur-[5px]",children:[(0,F.jsx)(iz.default,{className:"size-5 text-text-accent"}),(0,F.jsx)(iA,{className:"absolute -left-px bottom-[-76px]",type:"vertical"}),(0,F.jsx)(iA,{className:"absolute -right-px bottom-[-76px]",type:"vertical"}),(0,F.jsx)(iA,{className:"absolute -top-px right-[-184px]",type:"horizontal"}),(0,F.jsx)(iA,{className:"absolute -bottom-px right-[-184px]",type:"horizontal"})]}),(0,F.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,F.jsx)("div",{className:"system-sm-medium text-text-secondary",children:b("nodes.knowledgeBase.chunkStructureTip.title",{ns:"workflow"})}),(0,F.jsxs)("div",{className:"system-xs-regular",children:[(0,F.jsx)("p",{className:"text-text-tertiary",children:b("nodes.knowledgeBase.chunkStructureTip.message",{ns:"workflow"})}),(0,F.jsx)("a",{href:c("/use-dify/knowledge/create-knowledge/chunking-and-cleaning-text"),target:"_blank",rel:"noopener noreferrer",className:"text-text-accent",children:b("nodes.knowledgeBase.chunkStructureTip.learnMore",{ns:"workflow"})})]})]})]})}),iC=({options:a,value:b,onChange:c,readonly:d,trigger:e})=>{let{t:f}=(0,$.useTranslation)(),[g,h]=(0,K.useState)(!1),i=(0,K.useCallback)(a=>{c(a),h(!1)},[c]);return(0,F.jsxs)(bh.PortalToFollowElem,{placement:"bottom-end",offset:{mainAxis:0,crossAxis:-8},open:g,onOpenChange:h,children:[(0,F.jsx)(bh.PortalToFollowElemTrigger,{asChild:!0,onClick:()=>{d||h(!g)},children:e||(0,F.jsx)(av.default,{size:"small",variant:"ghost-accent",children:f("panel.change",{ns:"workflow"})})}),(0,F.jsx)(bh.PortalToFollowElemContent,{className:"z-10",children:(0,F.jsxs)("div",{className:"w-[404px] rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur shadow-xl backdrop-blur-[5px]",children:[(0,F.jsx)("div",{className:"system-sm-semibold px-3 pt-3.5 text-text-primary",children:f("nodes.knowledgeBase.changeChunkStructure",{ns:"workflow"})}),(0,F.jsx)("div",{className:"space-y-1 p-3 pt-2",children:a.map(a=>(0,F.jsx)(iv,{id:a.id,selectedId:b,icon:a.icon,title:a.title,description:a.description,readonly:d,onClick:i,effectColor:a.effectColor},a.id))})]})})]})},iD=(0,K.memo)(({chunkStructure:a,onChunkStructureChange:b,readonly:c=!1})=>{let{t:d}=(0,$.useTranslation)(),{options:e,optionMap:f}=(()=>{let{t:a}=(0,$.useTranslation)(),b={id:ih.general,icon:a=>(0,F.jsx)(iw.GeneralChunk,{className:(0,S.cn)("h-[18px] w-[18px] text-text-tertiary group-hover:text-util-colors-indigo-indigo-600",a&&"text-util-colors-indigo-indigo-600")}),title:a("stepTwo.general",{ns:"datasetCreation"}),description:a("stepTwo.generalTip",{ns:"datasetCreation"}),effectColor:"blue"},c={id:ih.parent_child,icon:a=>(0,F.jsx)(ix.ParentChildChunk,{className:(0,S.cn)("h-[18px] w-[18px] text-text-tertiary group-hover:text-util-colors-blue-light-blue-light-500",a&&"text-util-colors-blue-light-blue-light-500")}),title:a("stepTwo.parentChild",{ns:"datasetCreation"}),description:a("stepTwo.parentChildTip",{ns:"datasetCreation"}),effectColor:"blue-light"},d={id:ih.question_answer,icon:a=>(0,F.jsx)(iy.QuestionAndAnswer,{className:(0,S.cn)("h-[18px] w-[18px] text-text-tertiary group-hover:text-util-colors-teal-teal-600",a&&"text-util-colors-teal-teal-600")}),title:"Q&A",description:a("stepTwo.qaTip",{ns:"datasetCreation"}),effectColor:"teal"},e={[ih.general]:b,[ih.parent_child]:c,[ih.question_answer]:d};return{options:[b,c,d],optionMap:e}})();return(0,F.jsxs)(g5,{fieldTitleProps:{title:d("nodes.knowledgeBase.chunkStructure",{ns:"workflow"}),tooltip:d("nodes.knowledgeBase.chunkStructureTip.message",{ns:"workflow"}),operation:a&&(0,F.jsx)(iC,{options:e,value:a,onChange:b,readonly:c})},children:[!!a&&(0,F.jsx)(iv,{...f[a],selectedId:a,enableSelect:!1,enableHighlightBorder:!1}),!a&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(iC,{options:e,onChange:b,readonly:c,trigger:(0,F.jsxs)(av.default,{className:"w-full",variant:"secondary-accent",children:[(0,F.jsx)(Y.RiAddLine,{className:"mr-1 h-4 w-4"}),d("nodes.knowledgeBase.chooseChunkStructure",{ns:"workflow"})]})}),(0,F.jsx)(iB,{className:"mt-2"})]})]})}),iE=(0,K.memo)(({embeddingModel:a,embeddingModelProvider:b,onEmbeddingModelChange:c,readonly:d=!1})=>{let{t:e}=(0,$.useTranslation)(),{data:f}=(0,ae.useModelList)(b$.ModelTypeEnum.textEmbedding),g=(0,K.useMemo)(()=>{if(a&&b)return{providerName:b,modelName:a}},[a,b]),h=(0,K.useCallback)(a=>{c?.({embeddingModelProvider:a.provider,embeddingModel:a.model})},[c]);return(0,F.jsx)(g5,{fieldTitleProps:{title:e("form.embeddingModel",{ns:"datasetSettings"})},children:(0,F.jsx)(fz.default,{defaultModel:g&&{provider:g.providerName,model:g.modelName},modelList:f,onSelect:h,readonly:d,showDeprecatedWarnIcon:!0})})});var iF=a.i(792937),iG=a.i(841318),ii=ii;let iH=(0,K.memo)(({chunkStructure:a,indexMethod:b,onIndexMethodChange:c,keywordNumber:d,onKeywordNumberChange:e,readonly:f=!1})=>{let{t:g}=(0,$.useTranslation)(),h=b===ii.IndexingType.QUALIFIED,i=b===ii.IndexingType.ECONOMICAL,j=(0,K.useCallback)(a=>{c(a)},[c]),k=(0,K.useCallback)(a=>{let b=Number(a.target.value);Number.isNaN(b)||e(b)},[e]);return(0,F.jsx)(g5,{fieldTitleProps:{title:g("stepTwo.indexMode",{ns:"datasetCreation"})},children:(0,F.jsxs)("div",{className:"space-y-1",children:[(0,F.jsx)(iv,{id:ii.IndexingType.QUALIFIED,selectedId:b,icon:(0,F.jsx)(iG.HighQuality,{className:(0,S.cn)("h-[15px] w-[15px] text-text-tertiary group-hover:text-util-colors-orange-orange-500",h&&"text-util-colors-orange-orange-500")}),title:g("stepTwo.qualified",{ns:"datasetCreation"}),description:g("form.indexMethodHighQualityTip",{ns:"datasetSettings"}),onClick:j,isRecommended:!0,effectColor:"orange"}),a===ih.general&&(0,F.jsx)(iv,{id:ii.IndexingType.ECONOMICAL,selectedId:b,icon:(0,F.jsx)(iF.Economic,{className:(0,S.cn)("h-[15px] w-[15px] text-text-tertiary group-hover:text-util-colors-indigo-indigo-500",i&&"text-util-colors-indigo-indigo-500")}),title:g("form.indexMethodEconomy",{ns:"datasetSettings"}),description:g("form.indexMethodEconomyTip",{ns:"datasetSettings",count:d}),onClick:j,effectColor:"blue",children:(0,F.jsxs)("div",{className:"flex items-center",children:[(0,F.jsxs)("div",{className:"flex grow items-center",children:[(0,F.jsx)("div",{className:"system-xs-medium truncate text-text-secondary",children:g("form.numberOfKeywords",{ns:"datasetSettings"})}),(0,F.jsx)(ac.default,{popupContent:"number of keywords",children:(0,F.jsx)(Y.RiQuestionLine,{className:"ml-0.5 h-3.5 w-3.5 text-text-quaternary"})})]}),(0,F.jsx)(d3.default,{disabled:f,className:"mr-3 w-24 shrink-0",value:d,onChange:e}),(0,F.jsx)(a2.default,{disabled:f,className:"shrink-0",wrapperClassName:"shrink-0 w-[72px]",type:"number",value:d,onChange:k})]})})]})})});var iI=a.i(985226),iJ=a.i(479873),iK=a.i(382605),iL=aD,ii=ii,ij=aI,iM=a.i(295932);a.i(955696);var iN=a.i(2496),iL=aD,ij=aI;let iO=(0,K.memo)(({rerankingModel:a,onRerankingModelChange:b,readonly:c=!1})=>{let{modelList:d}=(0,ae.useModelListAndDefaultModel)(b$.ModelTypeEnum.rerank),e=(0,K.useMemo)(()=>{if(a)return{providerName:a.reranking_provider_name,modelName:a.reranking_model_name}},[a]);return(0,F.jsx)(fz.default,{defaultModel:e&&{provider:e.providerName,model:e.modelName},modelList:d,onSelect:a=>{b?.({reranking_provider_name:a.provider,reranking_model_name:a.model})},readonly:c,showDeprecatedWarnIcon:!0})}),iP={amount:1,min:1,max:(b=Number.parseInt(globalThis.document?.body?.getAttribute("data-public-top-k-max-value")||"",10))&&!isNaN(b)?b:10},iQ={step:.01,min:0,max:1},iR=(0,K.memo)(({topK:a,onTopKChange:b,scoreThreshold:c,onScoreThresholdChange:d,isScoreThresholdEnabled:e,onScoreThresholdEnabledChange:f,readonly:g,hiddenScoreThreshold:h})=>{let{t:i}=(0,$.useTranslation)(),j=(0,K.useCallback)(a=>{let c=Number.parseInt(a.toFixed(0));c=Math.max(iP.min,c),c=Math.min(iP.max,c),b?.(c)},[b]);return(0,F.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsxs)("div",{className:"system-xs-medium mb-0.5 flex h-6 items-center text-text-secondary",children:[i("datasetConfig.top_k",{ns:"appDebug"}),(0,F.jsx)(ac.default,{triggerClassName:"ml-0.5 shrink-0 w-3.5 h-3.5",popupContent:i("datasetConfig.top_kTip",{ns:"appDebug"})})]}),(0,F.jsx)(fJ.InputNumber,{disabled:g,type:"number",...iP,size:"regular",value:a,onChange:j})]}),!h&&(0,F.jsxs)("div",{children:[(0,F.jsxs)("div",{className:"mb-0.5 flex h-6 items-center",children:[(0,F.jsx)(d4.default,{className:"mr-2",defaultValue:e,onChange:f,disabled:g}),(0,F.jsx)("div",{className:"system-sm-medium grow truncate text-text-secondary",children:i("datasetConfig.score_threshold",{ns:"appDebug"})}),(0,F.jsx)(ac.default,{triggerClassName:"shrink-0 ml-0.5 w-3.5 h-3.5",popupContent:i("datasetConfig.score_thresholdTip",{ns:"appDebug"})})]}),(0,F.jsx)(fJ.InputNumber,{disabled:g||!e,type:"number",...iQ,size:"regular",value:c,onChange:a=>{let b=Number.parseFloat(a.toFixed(2));b=Math.max(iQ.min,b),b=Math.min(iQ.max,b),d?.(b)}})]})]})}),iS=(0,K.memo)(({readonly:a,option:b,hybridSearchModeOptions:c,searchMethod:d,onRetrievalSearchMethodChange:e,hybridSearchMode:f,onHybridSearchModeChange:g,weightedScore:h,onWeightedScoreChange:i,rerankingModelEnabled:j,onRerankingModelEnabledChange:k,rerankingModel:l,onRerankingModelChange:m,topK:n,onTopKChange:o,scoreThreshold:p,onScoreThresholdChange:q,isScoreThresholdEnabled:r,onScoreThresholdEnabledChange:s,showMultiModalTip:t=!1})=>{let{t:u}=(0,$.useTranslation)(),v=b.icon,w=b.id===ij.RETRIEVE_METHOD.hybrid,x=f===iL.RerankingModeEnum.WeightedScore,y=(0,K.useMemo)(()=>({value:[h?.vector_setting.vector_weight??aD.DEFAULT_WEIGHTED_SCORE.other.semantic,h?.keyword_setting.keyword_weight??aD.DEFAULT_WEIGHTED_SCORE.other.keyword]}),[h]),z=(0,K.useCallback)(a=>(0,F.jsx)(v,{className:(0,S.cn)("h-[15px] w-[15px] text-text-tertiary group-hover:text-util-colors-purple-purple-600",a&&"text-util-colors-purple-purple-600")}),[v]),A=(0,K.useCallback)(a=>a?"border-[1.5px] bg-components-option-card-option-selected-bg":"",[]),B=(0,K.useMemo)(()=>d===ij.RETRIEVE_METHOD.semantic||d===ij.RETRIEVE_METHOD.fullText,[d]),C=(0,K.useMemo)(()=>d===ij.RETRIEVE_METHOD.semantic||d===ij.RETRIEVE_METHOD.fullText||d===ij.RETRIEVE_METHOD.hybrid&&f!==iL.RerankingModeEnum.WeightedScore,[f,d]);return(0,F.jsx)(iv,{id:b.id,selectedId:d,icon:z,title:b.title,description:b.description,effectColor:b.effectColor,isRecommended:b.id===ij.RETRIEVE_METHOD.hybrid,onClick:e,readonly:a,children:(0,F.jsxs)("div",{className:"space-y-3",children:[w&&(0,F.jsx)("div",{className:"space-y-1",children:c.map(b=>(0,F.jsx)(iv,{id:b.id,selectedId:f,enableHighlightBorder:!1,enableRadio:!0,wrapperClassName:A,className:"p-3",title:b.title,description:b.description,onClick:g,readonly:a},b.id))}),w&&x&&(0,F.jsx)(iM.default,{value:y,onChange:i,readonly:a}),C&&(0,F.jsxs)("div",{children:[B&&(0,F.jsxs)("div",{className:"system-sm-semibold mb-1 flex items-center text-text-secondary",children:[(0,F.jsx)(d4.default,{className:"mr-1",defaultValue:j,onChange:k,disabled:a}),u("modelProvider.rerankModel.key",{ns:"common"}),(0,F.jsx)(ac.default,{triggerClassName:"ml-0.5 shrink-0 w-3.5 h-3.5",popupContent:u("modelProvider.rerankModel.tip",{ns:"common"})})]}),(0,F.jsx)(iO,{rerankingModel:l,onRerankingModelChange:m,readonly:a}),t&&(0,F.jsxs)("div",{className:"mt-2 flex h-10 items-center gap-x-0.5 overflow-hidden rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur p-2 shadow-xs backdrop-blur-[5px]",children:[(0,F.jsx)("div",{className:"absolute bottom-0 left-0 right-0 top-0 bg-dataset-warning-message-bg opacity-40"}),(0,F.jsx)("div",{className:"p-1",children:(0,F.jsx)(iN.AlertTriangle,{className:"size-4 text-text-warning-secondary"})}),(0,F.jsx)("span",{className:"system-xs-medium text-text-primary",children:u("form.retrievalSetting.multiModalTip",{ns:"datasetSettings"})})]})]}),(0,F.jsx)(iR,{topK:n,onTopKChange:o,scoreThreshold:p,onScoreThresholdChange:q,isScoreThresholdEnabled:r,onScoreThresholdEnabledChange:s,readonly:a,hiddenScoreThreshold:d===ij.RETRIEVE_METHOD.keywordSearch})]})},b.id)}),iT=(0,K.memo)(({indexMethod:a,readonly:b,searchMethod:c,onRetrievalSearchMethodChange:d,hybridSearchMode:e,onHybridSearchModeChange:f,weightedScore:g,onWeightedScoreChange:h,rerankingModelEnabled:i,onRerankingModelEnabledChange:j,rerankingModel:k,onRerankingModelChange:l,topK:m,onTopKChange:n,scoreThreshold:o,onScoreThresholdChange:p,isScoreThresholdEnabled:q,onScoreThresholdEnabledChange:r,showMultiModalTip:s})=>{let{t}=(0,$.useTranslation)(),u=(0,bk.useDocLink)(),{options:v,hybridSearchModeOptions:w}=(a=>{let{t:b}=(0,$.useTranslation)(),c=(0,K.useMemo)(()=>({id:ij.RETRIEVE_METHOD.semantic,icon:iK.VectorSearch,title:b("retrieval.semantic_search.title",{ns:"dataset"}),description:b("retrieval.semantic_search.description",{ns:"dataset"}),effectColor:"purple"}),[b]),d=(0,K.useMemo)(()=>({id:ij.RETRIEVE_METHOD.fullText,icon:iI.FullTextSearch,title:b("retrieval.full_text_search.title",{ns:"dataset"}),description:b("retrieval.full_text_search.description",{ns:"dataset"}),effectColor:"purple"}),[b]),e=(0,K.useMemo)(()=>({id:ij.RETRIEVE_METHOD.hybrid,icon:iJ.HybridSearch,title:b("retrieval.hybrid_search.title",{ns:"dataset"}),description:b("retrieval.hybrid_search.description",{ns:"dataset"}),effectColor:"purple"}),[b]),f=(0,K.useMemo)(()=>({id:ij.RETRIEVE_METHOD.keywordSearch,icon:iJ.HybridSearch,title:b("retrieval.keyword_search.title",{ns:"dataset"}),description:b("retrieval.keyword_search.description",{ns:"dataset"}),effectColor:"purple"}),[b]),g=(0,K.useMemo)(()=>({id:iL.RerankingModeEnum.WeightedScore,title:b("weightedScore.title",{ns:"dataset"}),description:b("weightedScore.description",{ns:"dataset"})}),[b]),h=(0,K.useMemo)(()=>({id:iL.RerankingModeEnum.RerankingModel,title:b("modelProvider.rerankModel.key",{ns:"common"}),description:b("modelProvider.rerankModel.tip",{ns:"common"})}),[b]);return(0,K.useMemo)(()=>({options:a===ii.IndexingType.ECONOMICAL?[f]:[c,d,e],hybridSearchModeOptions:[g,h]}),[c,d,e,f,a,g,h])})(a);return(0,F.jsx)(g5,{fieldTitleProps:{title:t("form.retrievalSetting.title",{ns:"datasetSettings"}),subTitle:(0,F.jsxs)("div",{className:"body-xs-regular flex items-center text-text-tertiary",children:[(0,F.jsx)("a",{target:"_blank",rel:"noopener noreferrer",href:u("/use-dify/knowledge/create-knowledge/setting-indexing-methods"),className:"text-text-accent",children:t("form.retrievalSetting.learnMore",{ns:"datasetSettings"})})," ",t("nodes.knowledgeBase.aboutRetrieval",{ns:"workflow"})]})},children:(0,F.jsx)("div",{className:"space-y-1",children:v.map(a=>(0,F.jsx)(iS,{option:a,hybridSearchModeOptions:w,searchMethod:c,onRetrievalSearchMethodChange:d,hybridSearchMode:e,onHybridSearchModeChange:f,weightedScore:g,onWeightedScoreChange:h,topK:m,onTopKChange:n,scoreThreshold:o,onScoreThresholdChange:p,isScoreThresholdEnabled:q,onScoreThresholdEnabledChange:r,rerankingModelEnabled:i,onRerankingModelEnabledChange:j,rerankingModel:k,onRerankingModelChange:l,readonly:b,showMultiModalTip:s},a.id))})})});var iL=aD,ii=ii,ij=aI,ii=ii;let iU=(0,K.memo)(({id:a,data:b})=>{let{t:c}=(0,$.useTranslation)(),{nodesReadOnly:d}=(0,aq.useNodesReadOnly)(),{data:e}=(0,ae.useModelList)(b$.ModelTypeEnum.textEmbedding),{data:f}=(0,ae.useModelList)(b$.ModelTypeEnum.rerank),{handleChunkStructureChange:g,handleIndexMethodChange:h,handleKeywordNumberChange:i,handleEmbeddingModelChange:j,handleRetrievalSearchMethodChange:k,handleHybridSearchModeChange:l,handleRerankingModelEnabledChange:m,handleWeighedScoreChange:n,handleRerankingModelChange:o,handleTopKChange:p,handleScoreThresholdChange:q,handleScoreThresholdEnabledChange:r,handleInputVariableChange:s,handleSummaryIndexSettingChange:t}=(a=>{let b=(0,N.useStoreApi)(),{handleNodeDataUpdateWithSyncDraft:c}=(0,ao.useNodeDataUpdate)(),d=(0,K.useCallback)(()=>{let{getNodes:c}=b.getState();return c().find(b=>b.id===a)},[b,a]),e=(0,K.useCallback)(b=>{c({id:a,data:b})},[a,c]),f=(0,K.useCallback)(({embeddingModel:a,embeddingModelProvider:b})=>({vector_setting:{vector_weight:aD.DEFAULT_WEIGHTED_SCORE.other.semantic,embedding_provider_name:b||"",embedding_model_name:a},keyword_setting:{keyword_weight:aD.DEFAULT_WEIGHTED_SCORE.other.keyword}}),[]),g=(0,K.useCallback)(a=>{let b=d(),{indexing_technique:c,retrieval_model:f,chunk_structure:g,index_chunk_variable_selector:h}=b?.data||{},{search_method:i}=f||{};e({chunk_structure:a,indexing_technique:a===ih.parent_child||a===ih.question_answer?ii.IndexingType.QUALIFIED:c,retrieval_model:{...f,search_method:a!==ih.parent_child&&a!==ih.question_answer||i===ij.RETRIEVE_METHOD.semantic||i===ij.RETRIEVE_METHOD.hybrid||i===ij.RETRIEVE_METHOD.fullText?i:ij.RETRIEVE_METHOD.keywordSearch},index_chunk_variable_selector:a===g?h:[]})},[e,d]),h=(0,K.useCallback)(a=>{let b=d();e((0,I.produce)(b?.data,b=>{b.indexing_technique=a,a===ii.IndexingType.ECONOMICAL?b.retrieval_model.search_method=ij.RETRIEVE_METHOD.keywordSearch:a===ii.IndexingType.QUALIFIED&&(b.retrieval_model.search_method=ij.RETRIEVE_METHOD.semantic)}))},[e,d]),i=(0,K.useCallback)(a=>{e({keyword_number:a})},[e]),j=(0,K.useCallback)(({embeddingModel:a,embeddingModelProvider:b})=>{let c=d(),g=f({embeddingModel:a,embeddingModelProvider:b}),h={embedding_model:a,embedding_model_provider:b,retrieval_model:{...c?.data.retrieval_model}};h.retrieval_model.weights?h.retrieval_model={...h.retrieval_model,weights:{...h.retrieval_model.weights,vector_setting:{...h.retrieval_model.weights.vector_setting,embedding_provider_name:b,embedding_model_name:a}}}:h.retrieval_model={...h.retrieval_model,weights:g},e(h)},[d,f,e]),k=(0,K.useCallback)(a=>{let b=d(),c={retrieval_model:{...b?.data.retrieval_model,search_method:a,reranking_mode:b?.data.retrieval_model.reranking_mode||aD.RerankingModeEnum.RerankingModel}};a===ij.RETRIEVE_METHOD.hybrid&&(c.retrieval_model={...c.retrieval_model,reranking_enable:c.retrieval_model.reranking_mode===aD.RerankingModeEnum.RerankingModel}),e(c)},[d,e]),l=(0,K.useCallback)(a=>{let b=d(),c=f({embeddingModel:b?.data.embedding_model||"",embeddingModelProvider:b?.data.embedding_model_provider||""});e({retrieval_model:{...b?.data.retrieval_model,reranking_mode:a,reranking_enable:a===iL.RerankingModeEnum.RerankingModel,weights:b?.data.retrieval_model.weights||c}})},[d,f,e]),m=(0,K.useCallback)(a=>{let b=d();e({retrieval_model:{...b?.data.retrieval_model,reranking_enable:a}})},[d,e]),n=(0,K.useCallback)(a=>{let b=d();e({retrieval_model:{...b?.data.retrieval_model,weights:{weight_type:aD.WeightedScoreEnum.Customized,vector_setting:{...b?.data.retrieval_model.weights?.vector_setting,vector_weight:a.value[0]},keyword_setting:{keyword_weight:a.value[1]}}}})},[d,e]),o=(0,K.useCallback)(a=>{let b=d();e({retrieval_model:{...b?.data.retrieval_model,reranking_model:{reranking_provider_name:a.reranking_provider_name,reranking_model_name:a.reranking_model_name}}})},[d,e]),p=(0,K.useCallback)(a=>{let b=d();e({retrieval_model:{...b?.data.retrieval_model,top_k:a}})},[d,e]),q=(0,K.useCallback)(a=>{let b=d();e({retrieval_model:{...b?.data.retrieval_model,score_threshold:a}})},[d,e]),r=(0,K.useCallback)(a=>{let b=d();e({retrieval_model:{...b?.data.retrieval_model,score_threshold_enabled:a}})},[d,e]);return{handleChunkStructureChange:g,handleIndexMethodChange:h,handleKeywordNumberChange:i,handleEmbeddingModelChange:j,handleRetrievalSearchMethodChange:k,handleHybridSearchModeChange:l,handleRerankingModelEnabledChange:m,handleWeighedScoreChange:n,handleRerankingModelChange:o,handleTopKChange:p,handleScoreThresholdChange:q,handleScoreThresholdEnabledChange:r,handleInputVariableChange:(0,K.useCallback)(a=>{e({index_chunk_variable_selector:Array.isArray(a)?a:[]})},[e]),handleSummaryIndexSettingChange:(0,K.useCallback)(a=>{let b=d();e({summary_index_setting:{...b?.data.summary_index_setting,...a}})},[e,d])}})(a),u=(0,K.useCallback)(a=>{if(!b.chunk_structure)return!1;switch(b.chunk_structure){case ih.general:return"general_structure"===a.schemaType||"multimodal_general_structure"===a.schemaType;case ih.parent_child:return"parent_child_structure"===a.schemaType||"multimodal_parent_child_structure"===a.schemaType;case ih.question_answer:return"qa_structure"===a.schemaType;default:return!1}},[b.chunk_structure]),v=(0,K.useMemo)(()=>{if(!b.chunk_structure)return"";let a="";switch(b.chunk_structure){case ih.general:a="(multimodal_)general_structure";break;case ih.parent_child:a="(multimodal_)parent_child_structure";break;case ih.question_answer:a="qa_structure";break;default:return""}return a.charAt(0).toUpperCase()+a.slice(1)},[b.chunk_structure]),w=(0,K.useMemo)(()=>(0,im.checkShowMultiModalTip)({embeddingModel:{provider:b.embedding_model_provider??"",model:b.embedding_model??""},rerankingEnable:!!b.retrieval_model?.reranking_enable,rerankModel:{rerankingProviderName:b.retrieval_model?.reranking_model?.reranking_provider_name??"",rerankingModelName:b.retrieval_model?.reranking_model?.reranking_model_name??""},indexMethod:b.indexing_technique,embeddingModelList:e,rerankModelList:f}),[b.embedding_model_provider,b.embedding_model,b.retrieval_model?.reranking_enable,b.retrieval_model?.reranking_model,b.indexing_technique,e,f]);return(0,F.jsxs)("div",{children:[(0,F.jsx)(g1,{className:"py-3",withBorderBottom:!!b.chunk_structure,children:(0,F.jsx)(iD,{chunkStructure:b.chunk_structure,onChunkStructureChange:g,readonly:d})}),!!b.chunk_structure&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(g6,{boxGroupProps:{boxProps:{withBorderBottom:!0}},fieldProps:{fieldTitleProps:{title:c("nodes.knowledgeBase.chunksInput",{ns:"workflow"}),tooltip:c("nodes.knowledgeBase.chunksInputTip",{ns:"workflow"})}},children:(0,F.jsx)(gA.default,{nodeId:a,isShowNodeName:!0,value:b.index_chunk_variable_selector,onChange:s,readonly:d,filterVar:u,isFilterFileVar:!0,isSupportFileVar:!1,preferSchemaType:!0,typePlaceHolder:v})}),(0,F.jsx)(g2,{children:(0,F.jsxs)("div",{className:"space-y-3",children:[(0,F.jsx)(iH,{chunkStructure:b.chunk_structure,indexMethod:b.indexing_technique,onIndexMethodChange:h,keywordNumber:b.keyword_number,onKeywordNumberChange:i,readonly:d}),b.indexing_technique===ii.IndexingType.QUALIFIED&&(0,F.jsx)(iE,{embeddingModel:b.embedding_model,embeddingModelProvider:b.embedding_model_provider,onEmbeddingModelChange:j,readonly:d}),(0,F.jsx)("div",{className:"pt-1",children:(0,F.jsx)(au,{className:"h-[1px]"})}),b.indexing_technique===ii.IndexingType.QUALIFIED&&[ih.general,ih.parent_child].includes(b.chunk_structure)&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(il.default,{summaryIndexSetting:b.summary_index_setting,onSummaryIndexSettingChange:t,readonly:d}),(0,F.jsx)("div",{className:"pt-1",children:(0,F.jsx)(au,{className:"h-[1px]"})})]}),(0,F.jsx)(iT,{indexMethod:b.indexing_technique,searchMethod:b.retrieval_model.search_method,onRetrievalSearchMethodChange:k,hybridSearchMode:b.retrieval_model.reranking_mode,onHybridSearchModeChange:l,weightedScore:b.retrieval_model.weights,onWeightedScoreChange:n,rerankingModelEnabled:b.retrieval_model.reranking_enable,onRerankingModelEnabledChange:m,rerankingModel:b.retrieval_model.reranking_model,onRerankingModelChange:o,topK:b.retrieval_model.top_k,onTopKChange:p,scoreThreshold:b.retrieval_model.score_threshold,onScoreThresholdChange:q,isScoreThresholdEnabled:b.retrieval_model.score_threshold_enabled,onScoreThresholdEnabledChange:r,showMultiModalTip:w,readonly:d})]})})]})]})}),iV=K.memo(({data:a})=>{let[b,c]=(0,K.useState)([]),d=(0,eI.useDatasetsDetailStore)(a=>a.datasetsDetail);return((0,K.useEffect)(()=>{a.dataset_ids?.length>0?c(a.dataset_ids.reduce((a,b)=>(d[b]&&a.push(d[b]),a),[])):c([])},[a.dataset_ids,d]),b.length)?(0,F.jsx)("div",{className:"mb-1 px-3 py-1",children:(0,F.jsx)("div",{className:"space-y-0.5",children:b.map(({id:a,name:b,icon_info:c})=>(0,F.jsxs)("div",{className:"flex h-[26px] items-center gap-x-1 rounded-md bg-workflow-block-parma-bg px-1",children:[(0,F.jsx)(fB.default,{size:"xs",iconType:c.icon_type,icon:c.icon,background:"image"===c.icon_type?void 0:c.icon_background,imageUrl:"image"===c.icon_type?c.icon_url:void 0,className:"shrink-0"}),(0,F.jsx)("div",{className:"system-xs-regular w-0 grow truncate text-text-secondary",children:b})]},a))})}):null});var iW=a.i(46898),iX=a.i(884184);let iY=K.memo(({selectedIds:a,onChange:b})=>{let[c,{setTrue:d,setFalse:e}]=(0,a8.useBoolean)(!1),f=(0,K.useCallback)(a=>{b(a),e()},[b,e]);return(0,F.jsxs)("div",{children:[(0,F.jsx)(aY.default,{onClick:d}),c&&(0,F.jsx)(iX.default,{isShow:c,onClose:e,selectedIds:a,onSelect:f})]})});var iZ=a.i(705134),i$=a.i(38567),i_=a.i(970439),i0=a.i(632789),i1=a.i(998068),i2=a.i(585124),i3=a.i(70854);let i4=K.memo(({payload:a,onRemove:b,onChange:c,readonly:d,editable:e=!0})=>{let f=(0,i2.default)(),{t:g}=(0,$.useTranslation)(),h=f===i2.MediaType.mobile,{formatIndexingTechniqueAndMethod:i}=(0,i3.useKnowledge)(),[j,k]=(0,K.useState)(!1),[l,{setTrue:m,setFalse:n}]=(0,a8.useBoolean)(!1),o=(0,K.useCallback)(a=>{c(a),n()},[n,c]),p=(0,K.useCallback)(a=>{a.stopPropagation(),b()},[b]),q=a.icon_info||{icon:"📙",icon_type:"emoji",icon_background:"#FFF4ED",icon_url:""};return(0,F.jsxs)("div",{className:`group/dataset-item flex h-10 cursor-pointer items-center justify-between rounded-lg
      border-[0.5px] border-components-panel-border-subtle px-2
      ${j?"border-state-destructive-border bg-state-destructive-hover":"bg-components-panel-on-panel-item-bg hover:bg-components-panel-on-panel-item-bg-hover"}`,children:[(0,F.jsxs)("div",{className:"flex w-0 grow items-center space-x-1.5",children:[(0,F.jsx)(fB.default,{size:"tiny",iconType:q.icon_type,icon:q.icon,background:"image"===q.icon_type?void 0:q.icon_background,imageUrl:"image"===q.icon_type?q.icon_url:void 0}),(0,F.jsx)("div",{className:"system-sm-medium w-0 grow truncate text-text-secondary",children:a.name})]}),!d&&(0,F.jsxs)("div",{className:"ml-2 hidden shrink-0 items-center  space-x-1 group-hover/dataset-item:flex",children:[e&&(0,F.jsx)(fX.default,{onClick:a=>{a.stopPropagation(),m()},children:(0,F.jsx)(Y.RiEditLine,{className:"h-4 w-4 shrink-0 text-text-tertiary"})}),(0,F.jsx)(fX.default,{onClick:p,state:j?fX.ActionButtonState.Destructive:fX.ActionButtonState.Default,onMouseEnter:()=>k(!0),onMouseLeave:()=>k(!1),children:(0,F.jsx)(Y.RiDeleteBinLine,{className:`h-4 w-4 shrink-0 ${j?"text-text-destructive":"text-text-tertiary"}`})})]}),a.is_multimodal&&(0,F.jsx)("div",{className:"mr-1 shrink-0 group-hover/dataset-item:hidden",children:(0,F.jsx)(i1.default,{feature:b$.ModelFeatureEnum.vision})}),!!a.indexing_technique&&(0,F.jsx)(dM.default,{className:"shrink-0 group-hover/dataset-item:hidden",text:i(a.indexing_technique,a.retrieval_model_dict?.search_method)}),"external"===a.provider&&(0,F.jsx)(dM.default,{className:"shrink-0 group-hover/dataset-item:hidden",text:g("externalTag",{ns:"dataset"})}),l&&(0,F.jsx)(i0.default,{isOpen:l,onClose:n,footer:null,mask:h,panelClassName:"mt-16 mx-2 sm:mr-2 mb-3 !p-0 !max-w-[640px] rounded-xl",children:(0,F.jsx)(i_.default,{currentDataset:a,onCancel:n,onSave:o})})]})}),i5=K.memo(({list:a,onChange:b,readonly:c})=>{let{t:d}=(0,$.useTranslation)(),e=(0,iZ.useSelector)(a=>a.userProfile),f=(0,K.useCallback)(c=>()=>{b((0,I.produce)(a,a=>{a.splice(c,1)}))},[a,b]),g=(0,K.useCallback)(c=>d=>{b((0,I.produce)(a,a=>{a[c]=d}))},[a,b]),h=(0,K.useMemo)(()=>a.map(a=>{let b={createdBy:a.created_by,partialMemberList:a.partial_member_list||[],permission:a.permission};return{...a,editable:(0,i$.hasEditPermissionForDataset)(e?.id||"",b)}}),[a,e?.id]);return(0,F.jsx)("div",{className:"space-y-1",children:h.length?h.map((a,b)=>(0,F.jsx)(i4,{payload:a,onRemove:f(b),onChange:g(b),readonly:c,editable:a.editable},b)):(0,F.jsx)("div",{className:"cursor-default select-none rounded-lg bg-background-section p-3 text-center text-xs text-text-tertiary",children:d("datasetConfig.knowledgeTip",{ns:"appDebug"})})})});var i6=a.i(658584),i7=a.i(866838);let i8=K.memo(({payload:a,onRetrievalModeChange:b,onMultipleRetrievalConfigChange:c,singleRetrievalModelConfig:d,onSingleRetrievalModelChange:e,onSingleRetrievalModelParamsChange:f,readonly:g,rerankModalOpen:h,onRerankModelOpenChange:i,selectedDatasets:j})=>{let{t:k}=(0,$.useTranslation)(),{retrieval_mode:l,multiple_retrieval_config:m}=a,n=(0,K.useCallback)(a=>{i(a)},[i]),o=(0,K.useMemo)(()=>{let{reranking_model:a,top_k:b,score_threshold:c,reranking_mode:d,weights:e,reranking_enable:f}=m||{};return{retrieval_model:l,reranking_model:a?.provider&&a?.model?{reranking_provider_name:a?.provider,reranking_model_name:a?.model}:{reranking_provider_name:"",reranking_model_name:""},top_k:b||O.DATASET_DEFAULT.top_k,score_threshold_enabled:null!=c,score_threshold:c,datasets:{datasets:[]},reranking_mode:d,weights:e,reranking_enable:f}},[l,m]),p=(0,K.useCallback)((a,d)=>{d?b(a.retrieval_model):c({top_k:a.top_k,score_threshold:a.score_threshold_enabled?a.score_threshold??O.DATASET_DEFAULT.score_threshold:null,reranking_model:l===aI.RETRIEVE_TYPE.oneWay?void 0:a.reranking_model?.reranking_provider_name?{provider:a.reranking_model?.reranking_provider_name,model:a.reranking_model?.reranking_model_name}:void 0,reranking_mode:a.reranking_mode,weights:a.weights,reranking_enable:a.reranking_enable})},[c,l,b]);return(0,F.jsxs)(bh.PortalToFollowElem,{open:h,onOpenChange:n,placement:"bottom-end",offset:{crossAxis:-2},children:[(0,F.jsx)(bh.PortalToFollowElemTrigger,{onClick:()=>{g||n(!h)},children:(0,F.jsxs)(av.default,{variant:"ghost",size:"small",disabled:g,className:(0,S.cn)(h&&"bg-components-button-ghost-bg-hover"),children:[(0,F.jsx)(Y.RiEqualizer2Line,{className:"mr-1 h-3.5 w-3.5"}),k("retrievalSettings",{ns:"dataset"})]})}),(0,F.jsx)(bh.PortalToFollowElemContent,{style:{zIndex:1001},children:(0,F.jsx)("div",{className:"w-[404px] rounded-2xl border border-components-panel-border bg-components-panel-bg  px-4 pb-4 pt-3  shadow-xl",children:(0,F.jsx)(i7.default,{datasetConfigs:o,onChange:p,selectedDatasets:j,isInWorkflow:!0,singleRetrievalModelConfig:d,onSingleRetrievalModelChange:e,onSingleRetrievalModelParamsChange:f})})})]})});var i9=a.i(218257),ja=a.i(211824);let jb="nodes.knowledgeRetrieval",jc=(0,K.memo)(({id:a,data:b})=>{let{t:c}=(0,$.useTranslation)(),{readOnly:d,inputs:e,handleQueryVarChange:f,handleQueryAttachmentChange:g,filterStringVar:h,filterFileVar:i,handleModelChanged:j,handleCompletionParamsChange:k,handleRetrievalModeChange:l,handleMultipleRetrievalConfigChange:m,selectedDatasets:n,selectedDatasetsLoaded:o,handleOnDatasetsChange:p,rerankModelOpen:q,setRerankModelOpen:r,handleAddCondition:s,handleMetadataFilterModeChange:t,handleRemoveCondition:u,handleToggleConditionLogicalOperator:v,handleUpdateCondition:w,handleMetadataModelChange:x,handleMetadataCompletionParamsChange:y,availableStringVars:z,availableStringNodesWithParent:A,availableNumberVars:B,availableNumberNodesWithParent:C,showImageQueryVarSelector:D}=((a,b)=>{let{nodesReadOnly:c}=(0,aq.useNodesReadOnly)(),d=(0,aq.useIsChatMode)(),{getBeforeNodesInSameBranch:e}=(0,aq.useWorkflow)(),f=e(a).find(a=>a.data.type===aC.BlockEnum.Start),g=f?.id,{inputs:h,setInputs:i}=eA(a,b),j=(0,eI.useDatasetsDetailStore)(a=>a.updateDatasetsDetail),k=(0,K.useRef)(h),l=(0,K.useCallback)(a=>{let b=(0,I.produce)(a,b=>{a.retrieval_mode===aI.RETRIEVE_TYPE.multiWay?delete b.single_retrieval_config:delete b.multiple_retrieval_config});i(b),k.current=b},[i]),m=(0,K.useCallback)(a=>{l((0,I.produce)(h,b=>{b.query_variable_selector=a}))},[h,l]),n=(0,K.useCallback)(a=>{l((0,I.produce)(h,b=>{b.query_attachment_selector=a}))},[h,l]),{currentProvider:o,currentModel:p}=(0,ae.useModelListAndDefaultModelAndCurrentProviderAndModel)(b$.ModelTypeEnum.textGeneration),{modelList:q,defaultModel:r}=(0,ae.useModelListAndDefaultModelAndCurrentProviderAndModel)(b$.ModelTypeEnum.rerank),{currentModel:s,currentProvider:t}=(0,ae.useCurrentProviderAndModel)(q,r?{...r,provider:r.provider.provider}:void 0),u=(0,K.useCallback)(a=>{l((0,I.produce)(k.current,b=>{b.single_retrieval_config||(b.single_retrieval_config={model:{provider:"",name:"",mode:"",completion_params:{}}});let c=b.single_retrieval_config?.model;c.provider=a.provider,c.name=a.modelId,c.mode=a.mode}))},[l]),v=(0,K.useCallback)(a=>{(0,H.isEqual)(a,k.current.single_retrieval_config?.model.completion_params)||l((0,I.produce)(k.current,b=>{b.single_retrieval_config||(b.single_retrieval_config={model:{provider:"",name:"",mode:"",completion_params:{}}}),b.single_retrieval_config.model.completion_params=a}))},[l]);(0,K.useEffect)(()=>{let a=k.current;a.retrieval_mode===aI.RETRIEVE_TYPE.multiWay&&a.multiple_retrieval_config?.reranking_model?.provider&&s&&r||a.retrieval_mode===aI.RETRIEVE_TYPE.oneWay&&a.single_retrieval_config?.model?.provider||l((0,I.produce)(a,a=>{o?.provider&&p?.model&&(a.single_retrieval_config?.model?.provider||(a.single_retrieval_config={model:{provider:o?.provider,name:p?.model,mode:p?.model_properties?.mode,completion_params:{}}}));let b=a.multiple_retrieval_config;a.multiple_retrieval_config={top_k:b?.top_k||O.DATASET_DEFAULT.top_k,score_threshold:b?.score_threshold,reranking_model:b?.reranking_model,reranking_mode:b?.reranking_mode,weights:b?.weights,reranking_enable:b?.reranking_enable!==void 0?b.reranking_enable:!!(s&&r)}}))},[o?.provider,p,s,r]);let[w,x]=(0,K.useState)([]),[y,z]=(0,K.useState)(!1),A=(0,K.useCallback)(a=>{l((0,I.produce)(h,b=>{if(b.retrieval_mode=a,a===aI.RETRIEVE_TYPE.multiWay){let a=b.multiple_retrieval_config;b.multiple_retrieval_config=(0,cn.getMultipleRetrievalConfig)(a,w,w,{provider:t?.provider,model:s?.model})}else b.single_retrieval_config?.model?.provider||(b.single_retrieval_config={model:{provider:o?.provider||"",name:p?.model||"",mode:p?.model_properties?.mode,completion_params:{}}})}))},[p?.model,p?.model_properties?.mode,o?.provider,h,l,w,s,t]),B=(0,K.useCallback)(a=>{l((0,I.produce)(h,b=>{b.multiple_retrieval_config=(0,cn.getMultipleRetrievalConfig)(a,w,w,{provider:t?.provider,model:s?.model})}))},[h,l,w,s,t]),[C,D]=(0,K.useState)(!1);(0,K.useEffect)(()=>{(async()=>{let a=k.current,b=a.dataset_ids;if(b?.length>0){let{data:a}=await (0,i9.fetchDatasets)({url:"/datasets",params:{page:1,ids:b}});x(a)}l((0,I.produce)(a,a=>{a.dataset_ids=b})),D(!0)})()},[]),(0,K.useEffect)(()=>{let a=k.current,b=a.query_variable_selector;d&&0===a.query_variable_selector.length&&g&&(b=[g,"sys.query"]),l((0,I.produce)(a,a=>{a.query_variable_selector=b}))},[]);let E=(0,K.useCallback)(a=>{let{mixtureHighQualityAndEconomic:c,mixtureInternalAndExternal:d,inconsistentEmbeddingModel:e,allInternal:f,allExternal:g}=(0,cn.getSelectedDatasetsMode)(a),i=a.every(a=>!a.is_multimodal),k=(0,I.produce)(h,c=>{if(c.dataset_ids=a.map(a=>a.id),b.retrieval_mode===aI.RETRIEVE_TYPE.multiWay&&a.length>0){let b=c.multiple_retrieval_config;c.multiple_retrieval_config=(0,cn.getMultipleRetrievalConfig)(b,a,w,{provider:t?.provider,model:s?.model})}i&&(c.query_attachment_selector=[])});j(a),l(k),x(a),(f&&(c||e)||d||g)&&z(!0)},[h,l,b.retrieval_mode,w,s,t,j]),F=(0,K.useCallback)(a=>a.type===aC.VarType.string,[]),G=(0,K.useCallback)(a=>a.type===aC.VarType.number,[]),J=(0,K.useCallback)(a=>a.type===aC.VarType.file||a.type===aC.VarType.arrayFile,[]),L=(0,K.useCallback)(a=>{l((0,I.produce)(k.current,b=>{b.metadata_filtering_mode=a}))},[l]),M=(0,K.useCallback)(({id:a,name:b,type:c})=>{let d=ja.ComparisonOperator.is;c===ja.MetadataFilteringVariableType.number&&(d=ja.ComparisonOperator.equal);let e={id:(0,du.v4)(),metadata_id:a,name:b,comparison_operator:d};l((0,I.produce)(k.current,a=>{a.metadata_filtering_conditions?a.metadata_filtering_conditions.conditions.push(e):a.metadata_filtering_conditions={logical_operator:ja.LogicalOperator.and,conditions:[e]}}))},[l]),N=(0,K.useCallback)(a=>{let b=(k.current.metadata_filtering_conditions?.conditions||[]).findIndex(b=>b.id===a);l((0,I.produce)(k.current,a=>{b>-1&&a.metadata_filtering_conditions?.conditions.splice(b,1)}))},[l]),P=(0,K.useCallback)((a,b)=>{let c=(k.current.metadata_filtering_conditions?.conditions||[]).findIndex(b=>b.id===a);l((0,I.produce)(k.current,a=>{c>-1&&(a.metadata_filtering_conditions.conditions[c]=b)}))},[l]),Q=(0,K.useCallback)(()=>{let a=k.current.metadata_filtering_conditions?.logical_operator===ja.LogicalOperator.and?ja.LogicalOperator.or:ja.LogicalOperator.and;l((0,I.produce)(k.current,b=>{b.metadata_filtering_conditions.logical_operator=a}))},[l]),R=(0,K.useCallback)(a=>{l((0,I.produce)(k.current,b=>{b.metadata_model_config={provider:a.provider,name:a.modelId,mode:a.mode||aI.AppModeEnum.CHAT,completion_params:b.metadata_model_config?.completion_params||{temperature:.7}}}))},[l]),S=(0,K.useCallback)(a=>{l((0,I.produce)(k.current,b=>{b.metadata_model_config={...b.metadata_model_config,completion_params:a}}))},[l]),{availableVars:T,availableNodesWithParent:U}=(0,eD.default)(a,{onlyLeafNodeVar:!1,filterVar:F}),{availableVars:V,availableNodesWithParent:W}=(0,eD.default)(a,{onlyLeafNodeVar:!1,filterVar:G}),X=(0,K.useMemo)(()=>w.some(a=>a.is_multimodal),[w]);return{readOnly:c,inputs:h,handleQueryVarChange:m,handleQueryAttachmentChange:n,filterStringVar:F,filterFileVar:J,handleRetrievalModeChange:A,handleMultipleRetrievalConfigChange:B,handleModelChanged:u,handleCompletionParamsChange:v,selectedDatasets:w.filter(a=>a.name),selectedDatasetsLoaded:C,handleOnDatasetsChange:E,rerankModelOpen:y,setRerankModelOpen:z,handleMetadataFilterModeChange:L,handleUpdateCondition:P,handleAddCondition:M,handleRemoveCondition:N,handleToggleConditionLogicalOperator:Q,handleMetadataModelChange:R,handleMetadataCompletionParamsChange:S,availableStringVars:T,availableStringNodesWithParent:U,availableNumberVars:V,availableNumberNodesWithParent:W,showImageQueryVarSelector:X}})(a,b),E=(0,K.useMemo)(()=>(0,iW.intersectionBy)(...n.filter(a=>!!a.doc_metadata).map(a=>a.doc_metadata),"name"),[n]);return(0,F.jsxs)("div",{className:"pt-2",children:[(0,F.jsxs)("div",{className:"space-y-4 px-4 pb-2",children:[(0,F.jsx)(fW,{title:c(`${jb}.queryText`,{ns:"workflow"}),children:(0,F.jsx)(gA.default,{nodeId:a,readonly:d,isShowNodeName:!0,value:e.query_variable_selector,onChange:f,filterVar:h})}),D&&(0,F.jsx)(fW,{title:c(`${jb}.queryAttachment`,{ns:"workflow"}),children:(0,F.jsx)(gA.default,{nodeId:a,readonly:d,isShowNodeName:!0,value:e.query_attachment_selector,onChange:g,filterVar:i})}),(0,F.jsx)(fW,{title:c(`${jb}.knowledge`,{ns:"workflow"}),required:!0,operations:(0,F.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,F.jsx)(i8,{payload:{retrieval_mode:e.retrieval_mode,multiple_retrieval_config:e.multiple_retrieval_config,single_retrieval_config:e.single_retrieval_config},onRetrievalModeChange:l,onMultipleRetrievalConfigChange:m,singleRetrievalModelConfig:e.single_retrieval_config?.model,onSingleRetrievalModelChange:j,onSingleRetrievalModelParamsChange:k,readonly:d||!n.length,rerankModalOpen:q,onRerankModelOpenChange:r,selectedDatasets:n}),!d&&(0,F.jsx)("div",{className:"h-3 w-px bg-divider-regular"}),!d&&(0,F.jsx)(iY,{selectedIds:e.dataset_ids,onChange:p})]}),children:(0,F.jsx)(i5,{list:n,onChange:p,readonly:d})})]}),(0,F.jsx)("div",{className:"mb-2 py-2",children:(0,F.jsx)(i6.default,{metadataList:E,selectedDatasetsLoaded:o,metadataFilterMode:e.metadata_filtering_mode,metadataFilteringConditions:e.metadata_filtering_conditions,handleAddCondition:s,handleMetadataFilterModeChange:t,handleRemoveCondition:u,handleToggleConditionLogicalOperator:v,handleUpdateCondition:w,metadataModelConfig:e.metadata_model_config,handleMetadataModelChange:x,handleMetadataCompletionParamsChange:y,availableStringVars:z,availableStringNodesWithParent:A,availableNumberVars:B,availableNumberNodesWithParent:C})}),(0,F.jsx)(au,{}),(0,F.jsx)("div",{children:(0,F.jsx)(gj,{children:(0,F.jsx)(F.Fragment,{children:(0,F.jsx)(gi,{name:"result",type:"Array[Object]",description:c(`${jb}.outputVars.output`,{ns:"workflow"}),subItems:[{name:"content",type:"string",description:c(`${jb}.outputVars.content`,{ns:"workflow"})},{name:"title",type:"string",description:c(`${jb}.outputVars.title`,{ns:"workflow"})},{name:"url",type:"string",description:c(`${jb}.outputVars.url`,{ns:"workflow"})},{name:"icon",type:"string",description:c(`${jb}.outputVars.icon`,{ns:"workflow"})},{name:"metadata",type:"object",description:c(`${jb}.outputVars.metadata`,{ns:"workflow"})},{name:"files",type:"Array[File]",description:c(`${jb}.outputVars.files`,{ns:"workflow"})}]})})})})]})}),jd=K.memo(({data:a})=>{let{t:b}=(0,$.useTranslation)(),c=(0,N.useNodes)(),{variable:d}=a;if(!d||0===d.length)return null;let e=(0,bY.isSystemVar)(d)?c.find(a=>a.data.type===aC.BlockEnum.Start):c.find(a=>a.id===d[0]);return(0,F.jsxs)("div",{className:"relative px-3",children:[(0,F.jsx)("div",{className:"system-2xs-medium-uppercase mb-1 text-text-tertiary",children:b("nodes.listFilter.inputVar",{ns:"workflow"})}),(0,F.jsx)(gv.VariableLabelInNode,{variables:d,nodeType:e?.data.type,nodeTitle:e?.data.title})]})}),je=K.memo(({nodeId:a,readOnly:b,value:c,onChange:d})=>{let{t:e}=(0,$.useTranslation)(),[f,g]=(0,K.useState)(!1),{availableVars:h,availableNodesWithParent:i}=(0,eD.default)(a,{onlyLeafNodeVar:!1,filterVar:a=>[aC.VarType.number].includes(a.type)});return(0,F.jsx)("div",{className:"flex items-start  space-x-1",children:(0,F.jsx)(hn,{instanceId:"http-extract-number",className:(0,S.cn)(f?"border-components-input-border-active bg-components-input-bg-active shadow-xs":"border-components-input-border-hover bg-components-input-bg-normal","w-0 grow rounded-lg border px-3 py-[6px]"),value:c,onChange:d,readOnly:b,nodesOutputVars:h,availableNodes:i,onFocusChange:g,placeholder:b?"":e("nodes.http.extractListPlaceholder",{ns:"workflow"}),placeholderClassName:"!leading-[21px]"})})});var jf=ch;let jg=K.memo(({value:a,onChange:b,className:c})=>{let{t:d}=(0,$.useTranslation)(),e=hU.SUB_VARIABLES.map(a=>({value:a,name:a})),f=(0,K.useCallback)(({value:a})=>{b(a)},[b]);return(0,F.jsx)("div",{className:(0,S.cn)(c),children:(0,F.jsx)(a4.SimpleSelect,{items:e,defaultValue:a,onSelect:f,className:"!text-[13px]",placeholder:d("nodes.listFilter.selectVariableKeyPlaceholder",{ns:"workflow"}),optionClassName:"pl-1 pr-5 py-0",renderOption:({item:a})=>(0,F.jsxs)("div",{className:"flex h-6 items-center justify-between",children:[(0,F.jsxs)("div",{className:"flex h-full items-center",children:[(0,F.jsx)(a0.Variable02,{className:"mr-[5px] h-3.5 w-3.5 text-text-accent"}),(0,F.jsx)("span",{className:"system-sm-medium text-text-secondary",children:a.name})]}),(0,F.jsx)("span",{className:"system-xs-regular text-text-tertiary",children:a.type})]}),renderTrigger:a=>(0,F.jsx)("div",{className:"group/sub-variable-picker flex h-8 items-center rounded-lg bg-components-input-bg-normal pl-1 hover:bg-state-base-hover-alt",children:a?(0,F.jsx)("div",{className:"flex cursor-pointer justify-start",children:(0,F.jsxs)("div",{className:"inline-flex h-6 max-w-full items-center rounded-md border-[0.5px] border-components-panel-border-subtle bg-components-badge-white-to-dark px-1.5 text-text-accent shadow-xs",children:[(0,F.jsx)(a0.Variable02,{className:"h-3.5 w-3.5 shrink-0 text-text-accent"}),(0,F.jsx)("div",{className:"system-xs-medium ml-0.5 truncate",children:a?.name})]})}):(0,F.jsxs)("div",{className:"system-sm-regular flex pl-1 text-components-input-text-placeholder  group-hover/sub-variable-picker:text-text-tertiary",children:[(0,F.jsx)(a0.Variable02,{className:"mr-1 h-4 w-4 shrink-0"}),(0,F.jsx)("span",{children:d("placeholder.select",{ns:"common"})})]})})})})}),jh="nodes.ifElse.optionName",ji={name:aC.VarType.string,url:aC.VarType.string,extension:aC.VarType.string,mime_type:aC.VarType.string,related_id:aC.VarType.string,size:aC.VarType.number},jj=K.memo(({condition:a={key:"",comparison_operator:jf.ComparisonOperator.equal,value:""},varType:b,onChange:c,hasSubVariable:d,readOnly:e,nodeId:f})=>{let{t:g}=(0,$.useTranslation)(),[h,i]=(0,K.useState)(!1),j=a.key?ji[a.key]:b,k=!!j,{availableVars:l,availableNodesWithParent:m}=(0,eD.default)(f,{onlyLeafNodeVar:!1,filterVar:a=>!j||a.type===j}),n=[jf.ComparisonOperator.in,jf.ComparisonOperator.notIn,jf.ComparisonOperator.allOf].includes(a.comparison_operator),o="transfer_method"===a.key||"type"===a.key,p=b===aC.VarType.boolean,q=(0,K.useMemo)(()=>{if(n){if("type"===a.key||a.comparison_operator===jf.ComparisonOperator.allOf)return hU.FILE_TYPE_OPTIONS.map(a=>({name:g(`${jh}.${a.i18nKey}`,{ns:"workflow"}),value:a.value}));if("transfer_method"===a.key)return hU.TRANSFER_METHOD.map(a=>({name:g(`${jh}.${a.i18nKey}`,{ns:"workflow"}),value:a.value}))}return[]},[a.comparison_operator,a.key,n,g]),r=(0,K.useCallback)(b=>d=>{c({...a,[b]:o&&"value"===b?[d]:d})},[a,c,o]),s=(0,K.useCallback)(a=>{let b=(0,ci.getOperators)(j??aC.VarType.string,{key:a});c({key:a,comparison_operator:b.length>0?b[0]:jf.ComparisonOperator.equal,value:""})},[c,j]),t=null;return(0,ci.comparisonOperatorNotRequireValue)(a.comparison_operator)||(t=n?(0,F.jsx)(a4.SimpleSelect,{items:q,defaultValue:o?a.value[0]:a.value,onSelect:a=>r("value")(a.value),className:"!text-[13px]",wrapperClassName:"grow h-8",placeholder:"Select value"}):p?(0,F.jsx)(gC,{value:a.value,onChange:r("value")}):k?(0,F.jsx)(hn,{instanceId:"filter-condition-input",className:(0,S.cn)(h?"border-components-input-border-active bg-components-input-bg-active shadow-xs":"border-components-input-border-hover bg-components-input-bg-normal","w-0 grow rounded-lg border px-3 py-[6px]"),value:eK(a),onChange:r("value"),readOnly:e,nodesOutputVars:l,availableNodes:m,onFocusChange:i,placeholder:e?"":g("nodes.http.insertVarPlaceholder",{ns:"workflow"}),placeholderClassName:"!leading-[21px]"}):(0,F.jsx)("input",{type:d&&"size"===a.key||!d&&b===aC.VarType.number?"number":"text",className:"grow rounded-lg border border-components-input-border-hover bg-components-input-bg-normal px-3 py-[6px]",value:eK(a),onChange:a=>r("value")(a.target.value),readOnly:e})),(0,F.jsxs)("div",{children:[d&&(0,F.jsx)(jg,{className:"mb-2",value:a.key,onChange:s}),(0,F.jsxs)("div",{className:"flex space-x-1",children:[(0,F.jsx)(h2,{className:"h-8 bg-components-input-bg-normal",varType:j??b??aC.VarType.string,value:a.comparison_operator,onSelect:r("comparison_operator"),file:d?{key:a.key}:void 0,disabled:e}),t]})]})});var jk=a.i(294318);let jl={enabled:!1,size:10},jm=K.memo(({className:a,readonly:b,config:c=jl,onChange:d})=>{let{t:e}=(0,$.useTranslation)(),f=(0,K.useCallback)(a=>{d({...c,enabled:a})},[c,d]),g=(0,K.useCallback)(a=>{d({...c,size:Number.parseInt(a)})},[d,c]);return(0,F.jsx)("div",{className:(0,S.cn)(a),children:(0,F.jsx)(fW,{title:e("nodes.listFilter.limit",{ns:"workflow"}),operations:(0,F.jsx)(d4.default,{defaultValue:c.enabled,onChange:f,size:"md",disabled:b}),children:c?.enabled?(0,F.jsx)(jk.default,{value:c?.size||10,min:1,max:20,onChange:g,readonly:b||!c?.enabled}):null})})}),jn="nodes.listFilter",jo=K.memo(({id:a,data:b})=>{let{t:c}=(0,$.useTranslation)(),{readOnly:d,inputs:e,itemVarType:f,itemVarTypeShowName:g,hasSubVariable:h,handleVarChanges:i,filterVar:j,handleFilterEnabledChange:k,handleFilterChange:l,handleExtractsEnabledChange:m,handleExtractsChange:n,handleLimitChange:o,handleOrderByEnabledChange:p,handleOrderByKeyChange:q,handleOrderByTypeChange:r}=((a,b)=>{let{nodesReadOnly:c}=(0,aq.useNodesReadOnly)(),d=(0,aq.useIsChatMode)(),e=(0,N.useStoreApi)(),{getBeforeNodesInSameBranch:f}=(0,aq.useWorkflow)(),{getNodes:g}=e.getState(),h=g().find(b=>b.id===a),i=b.isInIteration,j=i?g().find(a=>a.id===h.parentId):null,k=b.isInLoop?g().find(a=>a.id===h.parentId):null,l=(0,K.useMemo)(()=>f(a),[f,a]),{inputs:m,setInputs:n}=eA(a,b),{getCurrentVariableType:o}=(0,e5.useWorkflowVariables)(),p=(0,K.useCallback)(a=>{let b,c=o({parentNode:i?j:k,valueSelector:a||m.variable||[],availableNodes:l,isChatMode:d,isConstant:!1});switch(c){case aC.VarType.arrayNumber:b=aC.VarType.number;break;case aC.VarType.arrayString:b=aC.VarType.string;break;case aC.VarType.arrayFile:b=aC.VarType.file;break;case aC.VarType.arrayObject:b=aC.VarType.object;break;case aC.VarType.arrayBoolean:b=aC.VarType.boolean;break;default:b=c}return{varType:c,itemVarType:b}},[l,o,m.variable,d,i,j,k]),{varType:q,itemVarType:r}=p(),s=(0,K.useMemo)(()=>m.variable?[(r||aC.VarType.string).substring(0,1).toUpperCase(),(r||aC.VarType.string).substring(1)].join(""):"?",[m.variable,r]),t=[aC.VarType.arrayFile].includes(q),u=(0,K.useCallback)(a=>{n((0,I.produce)(m,b=>{b.variable=a;let{varType:c,itemVarType:d}=p(b.variable),e=c===aC.VarType.arrayFile;b.var_type=c,b.item_var_type=d,b.filter_by.conditions=[{key:e&&!b.filter_by.conditions[0]?.key?"name":"",comparison_operator:(0,ci.getOperators)(d,e?{key:"name"}:void 0)[0],value:d!==aC.VarType.boolean&&""}],e&&b.order_by.enabled&&!b.order_by.key&&(b.order_by.key="name")}))},[p,m,n]),v=(0,K.useCallback)(a=>[aC.VarType.arrayNumber,aC.VarType.arrayString,aC.VarType.arrayBoolean,aC.VarType.arrayFile].includes(a.type),[]),w=(0,K.useCallback)(a=>{n((0,I.produce)(m,b=>{b.filter_by.enabled=a,a&&!b.filter_by.conditions&&(b.filter_by.conditions=[])}))},[t,m,n]),x=(0,K.useCallback)(a=>{n((0,I.produce)(m,b=>{b.filter_by.conditions[0]=a}))},[m,n]),y=(0,K.useCallback)(a=>{n((0,I.produce)(m,b=>{b.limit=a}))},[m,n]),z=(0,K.useCallback)(a=>{n((0,I.produce)(m,b=>{b.extract_by.enabled=a,a&&(b.extract_by.serial="1")}))},[m,n]),A=(0,K.useCallback)(a=>{n((0,I.produce)(m,b=>{b.extract_by.serial=a}))},[m,n]),B=(0,K.useCallback)(a=>{n((0,I.produce)(m,b=>{b.order_by.enabled=a,a&&(b.order_by.value=cp.ASC,t&&!b.order_by.key&&(b.order_by.key="name"))}))},[t,m,n]),C=(0,K.useCallback)(a=>{n((0,I.produce)(m,b=>{b.order_by.key=a}))},[m,n]),D=(0,K.useCallback)(a=>()=>{n((0,I.produce)(m,b=>{b.order_by.value=a}))},[m,n]);return{readOnly:c,inputs:m,filterVar:v,varType:q,itemVarType:r,itemVarTypeShowName:s,hasSubVariable:t,handleVarChanges:u,handleFilterEnabledChange:w,handleFilterChange:x,handleLimitChange:y,handleOrderByEnabledChange:B,handleOrderByKeyChange:C,handleOrderByTypeChange:D,handleExtractsEnabledChange:z,handleExtractsChange:A}})(a,b);return(0,F.jsxs)("div",{className:"pt-2",children:[(0,F.jsxs)("div",{className:"space-y-4 px-4",children:[(0,F.jsx)(fW,{title:c(`${jn}.inputVar`,{ns:"workflow"}),required:!0,children:(0,F.jsx)(gA.default,{readonly:d,nodeId:a,isShowNodeName:!0,value:e.variable||[],onChange:i,filterVar:j,isSupportFileVar:!1,typePlaceHolder:"Array"})}),(0,F.jsx)(fW,{title:c(`${jn}.filterCondition`,{ns:"workflow"}),operations:(0,F.jsx)(d4.default,{defaultValue:e.filter_by?.enabled,onChange:k,size:"md",disabled:d}),children:e.filter_by?.enabled?(0,F.jsx)(jj,{condition:e.filter_by.conditions[0],onChange:l,varType:f,hasSubVariable:h,readOnly:d,nodeId:a}):null}),(0,F.jsx)(au,{}),(0,F.jsx)(fW,{title:c(`${jn}.extractsCondition`,{ns:"workflow"}),operations:(0,F.jsx)(d4.default,{defaultValue:e.extract_by?.enabled,onChange:m,size:"md",disabled:d}),children:e.extract_by?.enabled?(0,F.jsx)("div",{className:"flex items-center justify-between",children:(0,F.jsx)("div",{className:"mr-2 grow",children:(0,F.jsx)(je,{value:e.extract_by.serial,onChange:n,readOnly:d,nodeId:a})})}):null}),(0,F.jsx)(au,{}),(0,F.jsx)(jm,{config:e.limit,onChange:o,readonly:d}),(0,F.jsx)(au,{}),(0,F.jsx)(fW,{title:c(`${jn}.orderBy`,{ns:"workflow"}),operations:(0,F.jsx)(d4.default,{defaultValue:e.order_by?.enabled,onChange:p,size:"md",disabled:d}),children:e.order_by?.enabled?(0,F.jsxs)("div",{className:"flex items-center justify-between",children:[h&&(0,F.jsx)("div",{className:"mr-2 grow",children:(0,F.jsx)(jg,{value:e.order_by.key,onChange:q})}),(0,F.jsxs)("div",{className:h?"flex shrink-0 space-x-1":"grid w-full grid-cols-2 gap-1",children:[(0,F.jsx)(gB.default,{title:c(`${jn}.asc`,{ns:"workflow"}),onSelect:r(cp.ASC),selected:e.order_by.value===cp.ASC}),(0,F.jsx)(gB.default,{title:c(`${jn}.desc`,{ns:"workflow"}),onSelect:r(cp.DESC),selected:e.order_by.value===cp.DESC})]})]}):null}),(0,F.jsx)(au,{})]}),(0,F.jsx)("div",{children:(0,F.jsx)(gj,{children:(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(gi,{name:"result",type:`Array[${g}]`,description:c(`${jn}.outputVars.result`,{ns:"workflow"})}),(0,F.jsx)(gi,{name:"first_record",type:g,description:c(`${jn}.outputVars.first_record`,{ns:"workflow"})}),(0,F.jsx)(gi,{name:"last_record",type:g,description:c(`${jn}.outputVars.last_record`,{ns:"workflow"})})]})})})]})}),jp=K.memo(({data:a})=>{let{provider:b,name:c}=a.model||{},{textGenerationModelList:d}=(0,ae.useTextGenerationCurrentProviderAndModelAndModelList)(),e=b&&c;return e?(0,F.jsx)("div",{className:"mb-1 px-3 py-1",children:e&&(0,F.jsx)(fz.default,{defaultModel:{provider:b,model:c},modelList:d,triggerClassName:"!h-6 !rounded-md",readonly:!0})}):null});var jq=a.i(962800),jr=a.i(862359);let js="nodes.llm",jt=K.memo(({value:a,onChange:b})=>{let{t:c}=(0,$.useTranslation)(),d=(0,K.useCallback)(a=>()=>{b(a)},[b]);return(0,F.jsxs)("div",{className:"flex items-center justify-between",children:[(0,F.jsx)("div",{className:"mr-2 text-xs font-medium uppercase text-text-secondary",children:c(`${js}.resolution.name`,{ns:"workflow"})}),(0,F.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,F.jsx)(gB.default,{title:c(`${js}.resolution.high`,{ns:"workflow"}),onSelect:d(aI.Resolution.high),selected:a===aI.Resolution.high}),(0,F.jsx)(gB.default,{title:c(`${js}.resolution.low`,{ns:"workflow"}),onSelect:d(aI.Resolution.low),selected:a===aI.Resolution.low})]})]})});var ju=aI;let jv=K.memo(({isVisionModel:a,readOnly:b,enabled:c,onEnabledChange:d,nodeId:e,config:f={detail:ju.Resolution.high,variable_selector:[]},onConfigChange:g})=>{let{t:h}=(0,$.useTranslation)(),i=(0,K.useCallback)(a=>[aC.VarType.file,aC.VarType.arrayFile].includes(a.type),[]),j=(0,K.useCallback)(a=>{g((0,I.produce)(f,b=>{b.detail=a}))},[f,g]),k=(0,K.useCallback)(a=>{g((0,I.produce)(f,b=>{b.variable_selector=a}))},[f,g]);return(0,F.jsx)(fW,{title:h("nodes.llm.vision",{ns:"workflow"}),tooltip:h("vision.description",{ns:"appDebug"}),operations:(0,F.jsx)(ac.default,{popupContent:h("vision.onlySupportVisionModelTip",{ns:"appDebug"}),disabled:a,children:(0,F.jsx)(d4.default,{disabled:b||!a,size:"md",defaultValue:!!a&&c,onChange:d})}),children:c&&a?(0,F.jsxs)("div",{children:[(0,F.jsx)(gA.default,{className:"mb-4",filterVar:i,nodeId:e,value:f.variable_selector||[],onChange:k,readonly:b}),(0,F.jsx)(jt,{value:f.detail,onChange:j})]}):null})});var jw=a.i(876120),jw=jw;let jx=K.memo(({className:a,text:b,onClick:c})=>(0,F.jsxs)(av.default,{className:(0,S.cn)("w-full",a),variant:"tertiary",size:"medium",onClick:c,children:[(0,F.jsx)(Y.RiAddLine,{className:"mr-1 h-3.5 w-3.5"}),(0,F.jsx)("div",{children:b})]}));var jy=a.i(158873);let jz=[{label:"system",value:jy.PromptRole.system},{label:"user",value:jy.PromptRole.user},{label:"assistant",value:jy.PromptRole.assistant}],jA=jz.filter(a=>a.value!==jy.PromptRole.system),jB=K.memo(({instanceId:a,className:b,headerClassName:c,canNotChooseSystemRole:d,readOnly:e,id:f,nodeId:g,canRemove:h,handleChatModeMessageRoleChange:i,isChatModel:j,isChatApp:k,payload:l,onPromptChange:m,onEditionTypeChange:n,onRemove:o,isShowContext:p,hasSetBlockStatus:q,availableVars:r,availableNodes:s,varList:t,handleAddVariable:u,modelConfig:v})=>{let{t:w}=(0,$.useTranslation)(),{setControlPromptEditorRerenderKey:x}=(0,aP.useWorkflowStore)().getState(),y=(0,K.useCallback)(a=>{m(a),setTimeout(()=>x(Date.now()))},[m,x]);return(0,F.jsx)(f9,{className:b,headerClassName:c,instanceId:a,title:(0,F.jsxs)("div",{className:"relative left-1 flex items-center",children:[l.role===jy.PromptRole.system?(0,F.jsx)("div",{className:"relative left-[-4px] text-xs font-semibold uppercase text-text-secondary",children:"SYSTEM"}):(0,F.jsx)(gJ.default,{value:l.role,allOptions:jz,options:d?jA:jz,onChange:i,triggerClassName:"text-xs font-semibold text-text-secondary uppercase",itemClassName:"text-[13px] font-medium text-text-secondary"}),(0,F.jsx)(ac.default,{popupContent:(0,F.jsx)("div",{className:"max-w-[180px]",children:!!l.role&&w(`nodes.llm.roleDescription.${l.role}`,{ns:"workflow"})}),triggerClassName:"w-4 h-4"})]}),value:l.edition_type===aC.EditionType.jinja2?l.jinja2_text||"":l.text,onChange:m,readOnly:e,showRemove:h,onRemove:o,isChatModel:j,isChatApp:k,isShowContext:p,hasSetBlockStatus:q,nodesOutputVars:r,availableNodes:s,nodeId:g,editorId:f,isSupportPromptGenerator:!0,onGenerated:y,modelConfig:v,isSupportJinja:!0,editionType:l.edition_type,onEditionTypeChange:n,varList:t,handleAddVariable:u,isSupportFileVar:!0},a)}),jC="nodes.llm",jD=K.memo(({readOnly:a,nodeId:b,filterVar:c,isChatModel:d,isChatApp:e,payload:f,onChange:g,isShowContext:h,hasSetBlockStatus:i,varList:j=[],handleAddVariable:k,modelConfig:l})=>{let{t:m}=(0,$.useTranslation)(),{setControlPromptEditorRerenderKey:n}=(0,aP.useWorkflowStore)().getState(),o=d&&Array.isArray(f)?f.map(a=>{let b=(0,du.v4)();return{id:a.id||b,p:{...a,id:a.id||b}}}):[],{availableVars:p,availableNodesWithParent:q}=(0,eD.default)(b,{onlyLeafNodeVar:!1,filterVar:c}),r=(0,K.useCallback)(a=>b=>{g((0,I.produce)(f,c=>{c[a][c[a].edition_type===aC.EditionType.jinja2?"jinja2_text":"text"]=b}))},[g,f]),s=(0,K.useCallback)(a=>b=>{g((0,I.produce)(f,c=>{c[a].edition_type=b}))},[g,f]),t=(0,K.useCallback)(a=>b=>{g((0,I.produce)(f,c=>{c[a].role=b}))},[g,f]),u=(0,K.useCallback)(()=>{g((0,I.produce)(f,a=>{if(0===a.length)return void a.push({role:aC.PromptRole.system,text:"",id:(0,du.v4)()});let b=a[a.length-1].role===aC.PromptRole.user;a.push({role:b?aC.PromptRole.assistant:aC.PromptRole.user,text:"",id:(0,du.v4)()})}))},[g,f]),v=(0,K.useCallback)(a=>()=>{g((0,I.produce)(f,b=>{b.splice(a,1)}))},[g,f]),w=(0,K.useCallback)(a=>{g((0,I.produce)(f,b=>{b[b.edition_type===aC.EditionType.jinja2?"jinja2_text":"text"]=a}))},[g,f]),x=(0,K.useCallback)(a=>{w(a),setTimeout(()=>n(Date.now()))},[w,n]),y=(0,K.useCallback)(a=>{g((0,I.produce)(f,b=>{b.edition_type=a}))},[g,f]),z=!!(d&&Array.isArray(f))&&!f.find(a=>a.role===aC.PromptRole.system);return(0,F.jsx)("div",{children:d&&Array.isArray(f)?(0,F.jsxs)("div",{children:[(0,F.jsx)("div",{className:"space-y-2",children:(0,F.jsx)(gQ.ReactSortable,{className:"space-y-1",list:o,setList:a=>{(f?.[0]?.role!==aC.PromptRole.system||a[0].p?.role===aC.PromptRole.system)&&g(a.map(a=>a.p))},handle:".handle",ghostClass:"opacity-50",animation:150,children:f.map((c,g)=>{let m=!a&&(0!==g||c.role!==aC.PromptRole.system);return(0,F.jsxs)("div",{className:"group relative",children:[m&&(0,F.jsx)(jw.default,{className:"absolute left-[-14px] top-2 hidden h-3.5 w-3.5 text-text-quaternary group-hover:block"}),(0,F.jsx)(jB,{instanceId:c.role===aC.PromptRole.system?`${b}-chat-workflow-llm-prompt-editor`:`${b}-chat-workflow-llm-prompt-editor-${g}`,className:(0,S.cn)(m&&"handle"),headerClassName:(0,S.cn)(m&&"cursor-grab"),canNotChooseSystemRole:!z,canRemove:f.length>1&&(0!==g||c.role!==aC.PromptRole.system),readOnly:a,id:c.id,nodeId:b,handleChatModeMessageRoleChange:t(g),isChatModel:d,isChatApp:e,payload:c,onPromptChange:r(g),onEditionTypeChange:s(g),onRemove:v(g),isShowContext:h,hasSetBlockStatus:i,availableVars:p,availableNodes:q,varList:j,handleAddVariable:k,modelConfig:l})]},c.id||g)})})}),(0,F.jsx)(jx,{className:"mt-2",text:m(`${jC}.addMessage`,{ns:"workflow"}),onClick:u})]}):(0,F.jsx)("div",{children:(0,F.jsx)(f9,{instanceId:`${b}-chat-workflow-llm-prompt-editor`,title:(0,F.jsx)("span",{className:"capitalize",children:m(`${jC}.prompt`,{ns:"workflow"})}),value:f.edition_type!==aC.EditionType.basic&&f.edition_type?f.jinja2_text||"":f.text,onChange:w,readOnly:a,isChatModel:d,isChatApp:e,isShowContext:h,hasSetBlockStatus:i,nodesOutputVars:p,availableNodes:q,isSupportPromptGenerator:!0,isSupportJinja:!0,editionType:f.edition_type,varList:j,onEditionTypeChange:y,handleAddVariable:k,onGenerated:x,modelConfig:l})})})}),jE=({value:a="tagged",onChange:b,readonly:c=!1})=>{let{t:d}=(0,$.useTranslation)();return(0,F.jsx)(fW,{title:d("nodes.llm.reasoningFormat.title",{ns:"workflow"}),tooltip:d("nodes.llm.reasoningFormat.tooltip",{ns:"workflow"}),operations:(0,F.jsx)(d4.default,{defaultValue:"separated"===a,onChange:a=>b(a?"separated":"tagged"),size:"md",disabled:c},a),children:(0,F.jsx)("div",{})})};var jF=a.i(193390),jG=a.i(142261);let jH=(0,jG.cva)("segmented-control",{variants:{size:{regular:"segmented-control-regular",small:"segmented-control-small",large:"segmented-control-large"},padding:{none:"no-padding",with:"padding"}},defaultVariants:{size:"regular",padding:"with"}}),jI=(0,jG.cva)("segmented-control-item disabled:segmented-control-item-disabled",{variants:{size:{regular:["segmented-control-item-regular","system-sm-medium"],small:["segmented-control-item-small","system-xs-medium"],large:["segmented-control-item-large","system-md-semibold"]},activeState:{default:"",accent:"accent",accentLight:"accent-light"}},defaultVariants:{size:"regular",activeState:"default"}}),jJ=(0,jG.cva)("item-text",{variants:{size:{regular:"item-text-regular",small:"item-text-small",large:"item-text-large"}},defaultVariants:{size:"regular"}}),jK=({options:a,value:b,onChange:c,className:d,size:e,padding:f,activeState:g,activeClassName:h,btnClassName:i})=>{let j=a.findIndex(a=>a.value===b);return(0,F.jsx)("div",{className:(0,S.cn)(jH({size:e,padding:f}),d),children:a.map((b,d)=>{let{Icon:f,text:k,count:l,disabled:m}=b,n=d===j,o=d===a.length-1;return(0,F.jsxs)("button",{type:"button",className:(0,S.cn)(n?"active":"default",jI({size:e,activeState:n?g:"default"}),n&&h,m&&"disabled",i),onClick:()=>{n||c(b.value)},disabled:m,children:[f&&(0,F.jsx)(f,{className:"size-4 shrink-0"}),k&&(0,F.jsxs)("div",{className:(0,S.cn)("inline-flex items-center gap-x-1",jJ({size:e})),children:[(0,F.jsx)("span",{children:k}),!!(l&&"large"===e)&&(0,F.jsx)("div",{className:"system-2xs-medium-uppercase inline-flex h-[18px] min-w-[18px] items-center justify-center rounded-[5px] border border-divider-deep bg-components-badge-bg-dimm px-[5px] text-text-tertiary",children:l})]}),!o&&!n&&d!==j-1&&(0,F.jsx)("div",{"data-testid":`segmented-control-divider-${d}`,className:"absolute right-[-1px] top-0 flex h-full items-center",children:(0,F.jsx)(bA.default,{type:"vertical",className:"mx-0 h-3.5"})})]},String(b.value))})})};var jL=a.i(423026);let jM=K.memo(({message:a,className:b})=>(0,F.jsxs)("div",{className:(0,S.cn)("mt-1 flex gap-x-1 rounded-lg border-[0.5px] border-components-panel-border bg-toast-error-bg p-2",b),children:[(0,F.jsx)(Y.RiErrorWarningFill,{className:"h-4 w-4 shrink-0 text-text-destructive"}),(0,F.jsx)("div",{className:"system-xs-medium max-h-12 grow overflow-y-auto whitespace-pre-line break-words text-text-primary",children:a})]}));var jN=a.i(428864),jO=a.i(548628),jP=a.i(20069);let jQ=({onSubmit:a,updateBtnWidth:b})=>{let{t:c}=(0,$.useTranslation)(),[d,e]=(0,K.useState)(!1),[f,g]=(0,K.useState)(""),[h,i]=(0,K.useState)(null),j=(0,K.useRef)(null),k=(0,jP.useVisualEditorStore)(a=>a.advancedEditing),l=(0,jP.useVisualEditorStore)(a=>a.isAddingNewField),{emit:m}=(0,jO.useMittContext)();(0,K.useEffect)(()=>{j.current&&b(j.current.getBoundingClientRect().width)},[]);let n=(0,K.useCallback)(a=>{a.stopPropagation(),(k||l)&&m("quitEditing",{}),e(!d)},[d,k,l,m]),o=(0,K.useCallback)(()=>{e(!1)},[]),p=(0,K.useCallback)(()=>{try{let b=JSON.parse(f);if("object"!=typeof b||Array.isArray(b))return void i(Error("Root must be an object, not an array or primitive value."));if((0,jL.checkJsonDepth)(b)>O.JSON_SCHEMA_MAX_DEPTH)return void i({type:"error",message:`Schema exceeds maximum depth of ${O.JSON_SCHEMA_MAX_DEPTH}.`});a(b),i(null),e(!1)}catch(a){a instanceof Error?i(a):i(Error("Invalid JSON"))}},[a,f]);return(0,F.jsxs)(bh.PortalToFollowElem,{open:d,onOpenChange:e,placement:"bottom-end",offset:{mainAxis:4,crossAxis:16},children:[(0,F.jsx)(bh.PortalToFollowElemTrigger,{ref:j,onClick:n,children:(0,F.jsx)("button",{type:"button",className:(0,S.cn)("system-xs-medium flex shrink-0 rounded-md px-1.5 py-1 text-text-tertiary hover:bg-components-button-ghost-bg-hover",d&&"bg-components-button-ghost-bg-hover"),children:(0,F.jsx)("span",{className:"px-0.5",children:c("nodes.llm.jsonSchema.import",{ns:"workflow"})})})}),(0,F.jsx)(bh.PortalToFollowElemContent,{className:"z-[100]",children:(0,F.jsxs)("div",{className:"flex w-[400px] flex-col rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-2xl shadow-shadow-shadow-9",children:[(0,F.jsxs)("div",{className:"relative px-3 pb-1 pt-3.5",children:[(0,F.jsx)("div",{className:"absolute bottom-0 right-2.5 flex h-8 w-8 items-center justify-center",onClick:o,children:(0,F.jsx)(Y.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})}),(0,F.jsx)("div",{className:"system-xl-semibold flex pl-1 pr-8 text-text-primary",children:c("nodes.llm.jsonSchema.import",{ns:"workflow"})})]}),(0,F.jsxs)("div",{className:"px-4 py-2",children:[(0,F.jsx)(jN.default,{className:"rounded-lg",editorWrapperClassName:"h-[340px]",value:f,onUpdate:g,showFormatButton:!1}),h&&(0,F.jsx)(jM,{message:h.message})]}),(0,F.jsxs)("div",{className:"flex items-center justify-end gap-x-2 p-4 pt-2",children:[(0,F.jsx)(av.default,{variant:"secondary",onClick:o,children:c("operation.cancel",{ns:"common"})}),(0,F.jsx)(av.default,{variant:"primary",onClick:p,children:c("operation.submit",{ns:"common"})})]})]})})]})},jR=()=>(0,F.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:[(0,F.jsx)("path",{d:"M9.33329 2.95825C10.2308 2.95825 10.9583 2.23071 10.9583 1.33325H11.7083C11.7083 2.23071 12.4358 2.95825 13.3333 2.95825V3.70825C12.4358 3.70825 11.7083 4.43579 11.7083 5.33325H10.9583C10.9583 4.43579 10.2308 3.70825 9.33329 3.70825V2.95825ZM0.666626 7.33325C2.87577 7.33325 4.66663 5.54239 4.66663 3.33325H5.99996C5.99996 5.54239 7.79083 7.33325 9.99996 7.33325V8.66659C7.79083 8.66659 5.99996 10.4575 5.99996 12.6666H4.66663C4.66663 10.4575 2.87577 8.66659 0.666626 8.66659V7.33325ZM11.5 9.33325C11.5 10.5299 10.5299 11.4999 9.33329 11.4999V12.4999C10.5299 12.4999 11.5 13.47 11.5 14.6666H12.5C12.5 13.47 13.47 12.4999 14.6666 12.4999V11.4999C13.47 11.4999 12.5 10.5299 12.5 9.33325H11.5Z",fill:"url(#paint0_linear_13059_32065)",fillOpacity:"0.95"}),(0,F.jsx)("defs",{children:(0,F.jsxs)("linearGradient",{id:"paint0_linear_13059_32065",x1:"14.9996",y1:"15",x2:"-2.55847",y2:"16.6207",gradientUnits:"userSpaceOnUse",children:[(0,F.jsx)("stop",{stopColor:"#36BFFA"}),(0,F.jsx)("stop",{offset:"1",stopColor:"#296DFF"})]})})]}),jS=()=>(0,F.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:[(0,F.jsx)("path",{d:"M9.33329 2.95837C10.2308 2.95837 10.9583 2.23083 10.9583 1.33337H11.7083C11.7083 2.23083 12.4358 2.95837 13.3333 2.95837V3.70837C12.4358 3.70837 11.7083 4.43591 11.7083 5.33337H10.9583C10.9583 4.43591 10.2308 3.70837 9.33329 3.70837V2.95837ZM0.666626 7.33337C2.87577 7.33337 4.66663 5.54251 4.66663 3.33337H5.99996C5.99996 5.54251 7.79083 7.33337 9.99996 7.33337V8.66671C7.79083 8.66671 5.99996 10.4576 5.99996 12.6667H4.66663C4.66663 10.4576 2.87577 8.66671 0.666626 8.66671V7.33337ZM11.5 9.33337C11.5 10.53 10.5299 11.5 9.33329 11.5V12.5C10.5299 12.5 11.5 13.4701 11.5 14.6667H12.5C12.5 13.4701 13.47 12.5 14.6666 12.5V11.5C13.47 11.5 12.5 10.53 12.5 9.33337H11.5Z",fill:"url(#paint0_linear_13059_18704)",fillOpacity:"0.95"}),(0,F.jsx)("defs",{children:(0,F.jsxs)("linearGradient",{id:"paint0_linear_13059_18704",x1:"14.9996",y1:"15.0001",x2:"-2.55847",y2:"16.6209",gradientUnits:"userSpaceOnUse",children:[(0,F.jsx)("stop",{stopColor:"#0BA5EC"}),(0,F.jsx)("stop",{offset:"1",stopColor:"#155AEF"})]})})]}),jT=K.memo(({schema:a,isGenerating:b,onBack:c,onRegenerate:d,onClose:e,onApply:f})=>{let{t:g}=(0,$.useTranslation)(),[h,i]=(0,K.useState)(null),[j,k]=(0,K.useState)(""),l=(0,K.useMemo)(()=>(a=>{try{let b=JSON.stringify(a,null,2);return i(null),b}catch(a){return a instanceof Error?i(a):i(Error("Invalid JSON")),""}})(a),[a]),m=(0,K.useCallback)(()=>{let b=(0,jL.validateSchemaAgainstDraft7)(a);b.length>0?k((0,jL.getValidationErrorMessage)(b)):(f(),k(""))},[a,f]);return(0,F.jsx)("div",{className:"flex w-[480px] flex-col rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-2xl shadow-shadow-shadow-9",children:b?(0,F.jsxs)("div",{className:"flex h-[600px] flex-col items-center justify-center gap-y-3",children:[(0,F.jsx)(bI.default,{type:"area"}),(0,F.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:g("nodes.llm.jsonSchema.generating",{ns:"workflow"})})]}):(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)("div",{className:"absolute right-2.5 top-2.5 flex h-8 w-8 items-center justify-center",onClick:e,children:(0,F.jsx)(Y.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})}),(0,F.jsxs)("div",{className:"flex flex-col gap-y-[0.5px] px-3 pb-1 pt-3.5",children:[(0,F.jsx)("div",{className:"system-xl-semibold flex pl-1 pr-8 text-text-primary",children:g("nodes.llm.jsonSchema.generatedResult",{ns:"workflow"})}),(0,F.jsx)("div",{className:"system-xs-regular flex px-1 text-text-tertiary",children:g("nodes.llm.jsonSchema.resultTip",{ns:"workflow"})})]}),(0,F.jsxs)("div",{className:"px-4 py-2",children:[(0,F.jsx)(jN.default,{className:"rounded-lg",editorWrapperClassName:"h-[424px]",value:l,readOnly:!0,showFormatButton:!1}),h&&(0,F.jsx)(jM,{message:h.message}),j&&(0,F.jsx)(jM,{message:j})]}),(0,F.jsxs)("div",{className:"flex items-center justify-between p-4 pt-2",children:[(0,F.jsxs)(av.default,{variant:"secondary",className:"flex items-center gap-x-0.5",onClick:c,children:[(0,F.jsx)(Y.RiArrowLeftLine,{className:"h-4 w-4"}),(0,F.jsx)("span",{children:g("nodes.llm.jsonSchema.back",{ns:"workflow"})})]}),(0,F.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,F.jsxs)(av.default,{variant:"secondary",className:"flex items-center gap-x-0.5",onClick:d,children:[(0,F.jsx)(Y.RiSparklingLine,{className:"h-4 w-4"}),(0,F.jsx)("span",{children:g("nodes.llm.jsonSchema.regenerate",{ns:"workflow"})})]}),(0,F.jsx)(av.default,{variant:"primary",onClick:m,children:g("nodes.llm.jsonSchema.apply",{ns:"workflow"})})]})]})]})})}),jU=K.memo(({instruction:a,model:b,onInstructionChange:c,onCompletionParamsChange:d,onClose:e,onGenerate:f,onModelChange:g})=>{let{t:h}=(0,$.useTranslation)(),i=(0,K.useCallback)(a=>{c(a.target.value)},[c]);return(0,F.jsxs)("div",{className:"relative flex w-[480px] flex-col rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-2xl shadow-shadow-shadow-9",children:[(0,F.jsx)("div",{className:"absolute right-2.5 top-2.5 flex h-8 w-8 items-center justify-center",onClick:e,children:(0,F.jsx)(Y.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})}),(0,F.jsxs)("div",{className:"flex flex-col gap-y-[0.5px] px-3 pb-1 pt-3.5",children:[(0,F.jsx)("div",{className:"system-xl-semibold flex pl-1 pr-8 text-text-primary",children:h("nodes.llm.jsonSchema.generateJsonSchema",{ns:"workflow"})}),(0,F.jsx)("div",{className:"system-xs-regular flex px-1 text-text-tertiary",children:h("nodes.llm.jsonSchema.generationTip",{ns:"workflow"})})]}),(0,F.jsxs)("div",{className:"flex flex-col gap-y-1 px-4 py-2",children:[(0,F.jsx)("div",{className:"system-sm-semibold-uppercase flex h-6 items-center text-text-secondary",children:h("modelProvider.model",{ns:"common"})}),(0,F.jsx)(jq.default,{popupClassName:"!w-[448px]",portalToFollowElemContentClassName:"z-[1000]",isAdvancedMode:!0,provider:b.provider,completionParams:b.completion_params,modelId:b.name,setModel:g,onCompletionParamsChange:d,hideDebugWithMultipleModel:!0})]}),(0,F.jsxs)("div",{className:"flex flex-col gap-y-1 px-4 py-2",children:[(0,F.jsxs)("div",{className:"system-sm-semibold-uppercase flex h-6 items-center text-text-secondary",children:[(0,F.jsx)("span",{children:h("nodes.llm.jsonSchema.instruction",{ns:"workflow"})}),(0,F.jsx)(ac.default,{popupContent:h("nodes.llm.jsonSchema.promptTooltip",{ns:"workflow"})})]}),(0,F.jsx)("div",{className:"flex items-center",children:(0,F.jsx)(a5.default,{className:"h-[364px] resize-none px-2 py-1",value:a,placeholder:h("nodes.llm.jsonSchema.promptPlaceholder",{ns:"workflow"}),onChange:i})})]}),(0,F.jsxs)("div",{className:"flex justify-end gap-x-2 p-4 pt-2",children:[(0,F.jsx)(av.default,{variant:"secondary",onClick:e,children:h("operation.cancel",{ns:"common"})}),(0,F.jsxs)(av.default,{variant:"primary",className:"flex items-center gap-x-0.5",onClick:f,children:[(0,F.jsx)(Y.RiSparklingFill,{className:"h-4 w-4"}),(0,F.jsx)("span",{children:h("nodes.llm.jsonSchema.generate",{ns:"workflow"})})]})]})]})});var jV=((y=jV||{}).promptEditor="promptEditor",y.result="result",y);let jW=({onApply:a,crossAxisOffset:b})=>{let c=localStorage.getItem("auto-gen-model")?JSON.parse(localStorage.getItem("auto-gen-model")):null,[d,e]=(0,K.useState)(!1),[f,g]=(0,K.useState)("promptEditor"),[h,i]=(0,K.useState)(c||{name:"",provider:"",mode:aI.ModelModeType.completion,completion_params:{}}),[j,k]=(0,K.useState)(""),[l,m]=(0,K.useState)(null),{theme:n}=(0,bO.default)(),{defaultModel:o}=(0,ae.useModelListAndDefaultModelAndCurrentProviderAndModel)(b$.ModelTypeEnum.textGeneration),p=(0,jP.useVisualEditorStore)(a=>a.advancedEditing),q=(0,jP.useVisualEditorStore)(a=>a.isAddingNewField),{emit:r}=(0,jO.useMittContext)(),s=n===aI.Theme.light?jS:jR;(0,K.useEffect)(()=>{if(o){let a=localStorage.getItem("auto-gen-model")?JSON.parse(localStorage.getItem("auto-gen-model")||""):null;a?i(a):i(a=>({...a,name:o.model,provider:o.provider.provider}))}},[o]);let t=(0,K.useCallback)(a=>{a.stopPropagation(),(p||q)&&r("quitEditing",{}),e(!d)},[d,p,q,r]),u=(0,K.useCallback)(()=>{e(!1)},[]),v=(0,K.useCallback)(a=>{let b={...h,provider:a.provider,name:a.modelId,mode:a.mode};i(b),localStorage.setItem("auto-gen-model",JSON.stringify(b))},[h,i]),w=(0,K.useCallback)(a=>{let b={...h,completion_params:a};i(b),localStorage.setItem("auto-gen-model",JSON.stringify(b))},[h,i]),{mutateAsync:x,isPending:y}=(0,hf.useGenerateStructuredOutputRules)(),z=(0,K.useCallback)(async()=>{let{output:a,error:b}=await x({instruction:j,model_config:h});if(b){aX.default.notify({type:"error",message:b}),m(null),g("promptEditor");return}return a},[j,h,x]),A=(0,K.useCallback)(async()=>{g("result");let a=await z();void 0!==a&&m(JSON.parse(a))},[z]),B=(0,K.useCallback)(async()=>{let a=await z();void 0!==a&&m(JSON.parse(a))},[z]);return(0,F.jsxs)(bh.PortalToFollowElem,{open:d,onOpenChange:e,placement:"bottom-end",offset:{mainAxis:4,crossAxis:b??0},children:[(0,F.jsx)(bh.PortalToFollowElemTrigger,{onClick:t,children:(0,F.jsx)("button",{type:"button",className:(0,S.cn)("flex h-6 w-6 items-center justify-center rounded-md p-0.5 hover:bg-state-accent-hover",d&&"bg-state-accent-active"),children:(0,F.jsx)(s,{})})}),(0,F.jsxs)(bh.PortalToFollowElemContent,{className:"z-[100]",children:["promptEditor"===f&&(0,F.jsx)(jU,{instruction:j,model:h,onInstructionChange:k,onCompletionParamsChange:w,onGenerate:A,onClose:u,onModelChange:v}),"result"===f&&(0,F.jsx)(jT,{schema:l,isGenerating:y,onBack:()=>{g("promptEditor")},onRegenerate:B,onApply:()=>{a(l),e(!1)},onClose:u})]})]})};var jX=a.i(351993);let jY=({schema:a,onUpdate:b,hideTopMenu:c,className:d,readonly:e=!1,onFocus:f,onBlur:g,isTruncated:h})=>(0,F.jsx)(jN.default,{readOnly:e,className:(0,S.cn)("grow rounded-xl",d),editorWrapperClassName:"grow",value:a,onUpdate:b,hideTopMenu:c,onFocus:f,onBlur:g,topContent:h&&(0,F.jsx)(jX.default,{className:"mx-1 mb-3 mt-[-4px]"})});var jZ=a.i(752484),j$=((z=j$||{}).VisualEditor="visualEditor",z.JsonSchema="jsonSchema",z);let j_=[{Icon:Y.RiTimelineView,text:"Visual Editor",value:"visualEditor"},{Icon:Y.RiBracesLine,text:"JSON Schema",value:"jsonSchema"}],j0={type:jF.Type.object,properties:{},required:[],additionalProperties:!1},j1=({defaultSchema:a,onSave:b,onClose:c})=>{let{t:d}=(0,$.useTranslation)(),[e,f]=(0,K.useState)("visualEditor"),[g,h]=(0,K.useState)(a||j0),[i,j]=(0,K.useState)(()=>JSON.stringify(g,null,2)),[k,l]=(0,K.useState)(0),[m,n]=(0,K.useState)(null),[o,p]=(0,K.useState)(""),q=(0,jP.useVisualEditorStore)(a=>a.advancedEditing),r=(0,jP.useVisualEditorStore)(a=>a.setAdvancedEditing),s=(0,jP.useVisualEditorStore)(a=>a.isAddingNewField),t=(0,jP.useVisualEditorStore)(a=>a.setIsAddingNewField),u=(0,jP.useVisualEditorStore)(a=>a.setHoveringProperty),{emit:v}=(0,jO.useMittContext)(),w=(0,K.useCallback)(a=>{l(a+32)},[]),x=(0,K.useCallback)(a=>{if(e!==a){if("jsonSchema"===e)try{let a=JSON.parse(i);n(null);let b=(0,jL.preValidateSchema)(a);if(!b.success)return void p(b.error.message);if((0,jL.checkJsonSchemaDepth)(a)>O.JSON_SCHEMA_MAX_DEPTH)return void p(`Schema exceeds maximum depth of ${O.JSON_SCHEMA_MAX_DEPTH}.`);let c=(0,jL.validateSchemaAgainstDraft7)(a);if(c.length>0)return void p((0,jL.getValidationErrorMessage)(c));h(a),p("")}catch(a){p(""),a instanceof Error?n(a):n(Error("Invalid JSON"));return}else"visualEditor"===e&&(q||s?v("quitEditing",{callback:a=>j(JSON.stringify(a||g,null,2))}):j(JSON.stringify(g,null,2)));f(a)}},[e,g,i,q,s,v]),y=(0,K.useCallback)(a=>{"visualEditor"===e?h(a):"jsonSchema"===e&&j(JSON.stringify(a,null,2))},[e]),z=(0,K.useCallback)(a=>{let b=(0,jL.jsonToSchema)(a);"visualEditor"===e?h(b):"jsonSchema"===e&&j(JSON.stringify(b,null,2))},[e]),A=(0,K.useCallback)(a=>{h(a)},[]),B=(0,K.useCallback)(a=>{j(a)},[]),C=(0,K.useCallback)(()=>{"visualEditor"===e&&(u(null),q&&r(!1),s&&t(!1)),h(j0),j(JSON.stringify(j0,null,2))},[e,q,s,r,t,u]),D=(0,K.useCallback)(()=>{c()},[c]),E=(0,K.useCallback)(()=>{let a=g;if("jsonSchema"===e)try{a=JSON.parse(i),n(null);let b=(0,jL.preValidateSchema)(a);if(!b.success)return void p(b.error.message);if((0,jL.checkJsonSchemaDepth)(a)>O.JSON_SCHEMA_MAX_DEPTH)return void p(`Schema exceeds maximum depth of ${O.JSON_SCHEMA_MAX_DEPTH}.`);let c=(0,jL.validateSchemaAgainstDraft7)(a);if(c.length>0)return void p((0,jL.getValidationErrorMessage)(c));h(a),p("")}catch(a){p(""),a instanceof Error?n(a):n(Error("Invalid JSON"));return}else if("visualEditor"===e&&(q||s))return void aX.default.notify({type:"warning",message:d("nodes.llm.jsonSchema.warningTips.saveSchema",{ns:"workflow"})});b(a),c()},[e,g,i,b,c,q,s,d]);return(0,F.jsxs)("div",{className:"flex h-full flex-col",children:[(0,F.jsxs)("div",{className:"relative flex p-6 pb-3 pr-14",children:[(0,F.jsx)("div",{className:"title-2xl-semi-bold grow truncate text-text-primary",children:d("nodes.llm.jsonSchema.title",{ns:"workflow"})}),(0,F.jsx)("div",{className:"absolute right-5 top-5 flex h-8 w-8 items-center justify-center p-1.5",onClick:c,children:(0,F.jsx)(Y.RiCloseLine,{className:"h-[18px] w-[18px] text-text-tertiary"})})]}),(0,F.jsxs)("div",{className:"flex items-center justify-between px-6 py-2",children:[(0,F.jsx)(jK,{options:j_,value:e,onChange:x}),(0,F.jsxs)("div",{className:"flex items-center gap-x-0.5",children:[(0,F.jsx)(jW,{crossAxisOffset:k,onApply:y}),(0,F.jsx)(bA.default,{type:"vertical",className:"h-3"}),(0,F.jsx)(jQ,{updateBtnWidth:w,onSubmit:z})]})]}),(0,F.jsxs)("div",{className:"flex grow flex-col gap-y-1 overflow-hidden px-6",children:["visualEditor"===e&&(0,F.jsx)(jZ.default,{schema:g,onChange:A}),"jsonSchema"===e&&(0,F.jsx)(jY,{schema:i,onUpdate:B}),m&&(0,F.jsx)(jM,{message:m.message}),o&&(0,F.jsx)(jM,{message:o})]}),(0,F.jsx)("div",{className:"flex items-center gap-x-2 p-6 pt-5",children:(0,F.jsxs)("div",{className:"flex items-center gap-x-3",children:[(0,F.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,F.jsx)(av.default,{variant:"secondary",onClick:C,children:d("nodes.llm.jsonSchema.resetDefaults",{ns:"workflow"})}),(0,F.jsx)(bA.default,{type:"vertical",className:"ml-1 mr-0 h-4"})]}),(0,F.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,F.jsx)(av.default,{variant:"secondary",onClick:D,children:d("operation.cancel",{ns:"common"})}),(0,F.jsx)(av.default,{variant:"primary",onClick:E,children:d("operation.save",{ns:"common"})})]})]})})]})},j2=a=>(0,F.jsx)(jO.MittProvider,{children:(0,F.jsx)(jO.VisualEditorContextProvider,{children:(0,F.jsx)(j1,{...a})})}),j3=({isShow:a,defaultSchema:b,onSave:c,onClose:d})=>(0,F.jsx)(hq.default,{isShow:a,onClose:d,className:"h-[800px] max-w-[960px] p-0",children:(0,F.jsx)(j2,{defaultSchema:b,onSave:c,onClose:d})}),j4=K.memo(({className:a,value:b,onChange:c})=>{let{t:d}=(0,$.useTranslation)(),[e,{setTrue:f,setFalse:g}]=(0,a8.useBoolean)(!1),h=(0,K.useCallback)(a=>{c({schema:a})},[c]);return(0,F.jsxs)("div",{className:(0,S.cn)(a),children:[(0,F.jsxs)("div",{className:"flex justify-between",children:[(0,F.jsxs)("div",{className:"flex items-center leading-[18px]",children:[(0,F.jsx)("div",{className:"code-sm-semibold text-text-secondary",children:"structured_output"}),(0,F.jsx)("div",{className:"system-xs-regular ml-2 text-text-tertiary",children:"object"})]}),(0,F.jsxs)(av.default,{size:"small",variant:"secondary",className:"flex",onClick:f,children:[(0,F.jsx)(Y.RiEditLine,{className:"mr-1 size-3.5"}),(0,F.jsx)("div",{className:"system-xs-medium text-components-button-secondary-text",children:d("structOutput.configure",{ns:"app"})})]})]}),b?.schema&&b.schema.properties&&Object.keys(b.schema.properties).length>0?(0,F.jsx)(g8,{payload:b}):(0,F.jsx)("div",{className:"system-xs-regular mt-1.5 flex h-10 cursor-pointer items-center justify-center rounded-[10px] bg-background-section text-text-tertiary",onClick:f,children:d("structOutput.notConfiguredTip",{ns:"app"})}),e&&(0,F.jsx)(j3,{isShow:!0,defaultSchema:b?.schema||{type:jF.Type.object,properties:{},required:[],additionalProperties:!1},onSave:h,onClose:g})]})}),j5="nodes.llm",j6=K.memo(({id:a,data:b})=>{let{t:c}=(0,$.useTranslation)(),{readOnly:d,inputs:e,isChatModel:f,isChatMode:g,isCompletionModel:h,shouldShowContextTip:i,isVisionModel:j,handleModelChanged:k,hasSetBlockStatus:l,handleCompletionParamsChange:m,handleContextVarChange:n,filterInputVar:o,filterVar:p,availableVars:q,availableNodesWithParent:r,isShowVars:s,handlePromptChange:t,handleAddEmptyVariable:u,handleAddVariable:v,handleVarListChange:w,handleVarNameChange:x,handleSyeQueryChange:y,handleMemoryChange:z,handleVisionResolutionEnabledChange:A,handleVisionResolutionChange:B,isModelSupportStructuredOutput:C,structuredOutputCollapsed:D,setStructuredOutputCollapsed:E,handleStructureOutputEnableChange:G,handleStructureOutputChange:H,filterJinja2InputVar:J,handleReasoningFormatChange:L}=((a,b)=>{let c,d,{nodesReadOnly:e}=(0,aq.useNodesReadOnly)(),f=(0,aq.useIsChatMode)(),g=(0,aP.useStore)(a=>a.nodesDefaultConfigs)?.[b.type],[h,i]=(0,K.useState)({user:"",assistant:""}),{inputs:j,setInputs:k}=eA(a,b),l=(0,K.useRef)(j);(0,K.useEffect)(()=>{l.current=j},[j]);let{deleteNodeInspectorVars:m}=(0,at.default)(),n=(0,K.useCallback)(a=>{if(a.memory&&!a.memory.role_prefix){let b=(0,I.produce)(a,a=>{a.memory.role_prefix=h});k(b),l.current=b;return}k(a),l.current=a},[k,h]),o=j.model,p=j.model?.mode===aI.AppModeEnum.CHAT,q=!p,r=(c=j.prompt_template,d=p?c.some(a=>(0,a3.checkHasContextBlock)(a.text)):(0,a3.checkHasContextBlock)(c.text),f?p?{history:!1,query:c.some(a=>(0,a3.checkHasQueryBlock)(a.text)),context:d}:{history:(0,a3.checkHasHistoryBlock)(c.text),query:(0,a3.checkHasQueryBlock)(c.text),context:d}:{history:!1,query:!1,context:d}),s=!r.context&&j.context.enabled,t=(0,K.useCallback)((a,b,c)=>{let d=b.prompt_templates;(void 0===c?p:c)?a.prompt_template=d.chat_model.prompts:(a.prompt_template=d.completion_model.prompt,i({user:d.completion_model.conversation_histories_role.user_prefix,assistant:d.completion_model.conversation_histories_role.assistant_prefix}))},[p]);(0,K.useEffect)(()=>{g&&Object.keys(g).length>0&&!j.prompt_template&&n((0,I.produce)(j,a=>{t(a,g)}))},[g,p]);let[u,v]=(0,K.useState)(!1),{currentProvider:w,currentModel:x}=(0,ae.useModelListAndDefaultModelAndCurrentProviderAndModel)(b$.ModelTypeEnum.textGeneration),{isVisionModel:y,handleVisionResolutionEnabledChange:z,handleVisionResolutionChange:A,handleModelChanged:B}=eM(o,{payload:j.vision,onChange:a=>{n((0,I.produce)(l.current,b=>{b.vision=a}))}}),C=(0,K.useCallback)(a=>{n((0,I.produce)(l.current,b=>{b.model.provider=a.provider,b.model.name=a.modelId,b.model.mode=a.mode,a.mode!==l.current.model.mode&&g&&Object.keys(g).length>0&&t(b,g,a.mode===aI.AppModeEnum.CHAT)})),v(!0)},[n,g,t]);(0,K.useEffect)(()=>{w?.provider&&x?.model&&!o.provider&&C({provider:w?.provider,modelId:x?.model,mode:x?.model_properties?.mode})},[o.provider,w,x,C]);let D=(0,K.useCallback)(a=>{n((0,I.produce)(l.current,b=>{b.model.completion_params=a}))},[n]);(0,K.useEffect)(()=>{u&&(v(!1),B())},[y,u]);let E=p?j.prompt_template.some(a=>a.edition_type===aC.EditionType.jinja2):j.prompt_template.edition_type===aC.EditionType.jinja2,F=(0,K.useCallback)(()=>{n((0,I.produce)(l.current,a=>{a.prompt_config||(a.prompt_config={jinja2_variables:[]}),a.prompt_config.jinja2_variables||(a.prompt_config.jinja2_variables=[]),a.prompt_config.jinja2_variables.push({variable:"",value_selector:[]})}))},[n]),G=(0,K.useCallback)(a=>{n((0,I.produce)(l.current,b=>{b.prompt_config||(b.prompt_config={jinja2_variables:[]}),b.prompt_config.jinja2_variables||(b.prompt_config.jinja2_variables=[]),b.prompt_config.jinja2_variables.push(a)}))},[n]),H=(0,K.useCallback)(a=>{n((0,I.produce)(l.current,b=>{b.prompt_config||(b.prompt_config={jinja2_variables:[]}),b.prompt_config.jinja2_variables||(b.prompt_config.jinja2_variables=[]),b.prompt_config.jinja2_variables=a}))},[n]),J=(0,K.useCallback)((a,b)=>{n((0,I.produce)(l.current,c=>{if(p)c.prompt_template.filter(a=>a.edition_type===aC.EditionType.jinja2).forEach(c=>{c.jinja2_text=(c.jinja2_text||"").replaceAll(`{{ ${a} }}`,`{{ ${b} }}`)});else{if(c.prompt_template.edition_type!==aC.EditionType.jinja2)return;let d=c.prompt_template;d.jinja2_text=(d.jinja2_text||"").replaceAll(`{{ ${a} }}`,`{{ ${b} }}`)}}))},[p,n]),L=(0,K.useCallback)(a=>{n((0,I.produce)(l.current,b=>{b.context.variable_selector=a||[],b.context.enabled=!!(a&&a.length>0)}))},[n]),M=(0,K.useCallback)(a=>{n((0,I.produce)(l.current,b=>{b.prompt_template=a}))},[n]),N=(0,K.useCallback)(a=>{n((0,I.produce)(l.current,b=>{b.memory=a}))},[n]),O=(0,K.useCallback)(a=>{n((0,I.produce)(l.current,b=>{b.memory?b.memory.query_prompt_template=a:b.memory={window:{enabled:!1,size:10},query_prompt_template:a}}))},[n]),{data:P}=(0,ae.useModelList)(b$.ModelTypeEnum.textGeneration),Q=P?.find(a=>a.provider===o?.provider)?.models.find(a=>a.model===o?.name)?.features?.includes(b$.ModelFeatureEnum.StructuredOutput),[R,S]=(0,K.useState)(!0),T=(0,K.useCallback)(b=>{n((0,I.produce)(l.current,a=>{a.structured_output_enabled=b})),b&&S(!1),m(a)},[n,m,a]),U=(0,K.useCallback)(b=>{n((0,I.produce)(l.current,a=>{a.structured_output=b})),m(a)},[n,m,a]),V=(0,K.useCallback)(a=>[aC.VarType.number,aC.VarType.string,aC.VarType.secret,aC.VarType.arrayString,aC.VarType.arrayNumber,aC.VarType.file,aC.VarType.arrayFile].includes(a.type),[]),W=(0,K.useCallback)(a=>[aC.VarType.number,aC.VarType.string,aC.VarType.secret,aC.VarType.arrayString,aC.VarType.arrayNumber,aC.VarType.arrayBoolean,aC.VarType.arrayObject,aC.VarType.object,aC.VarType.array,aC.VarType.boolean].includes(a.type),[]),X=(0,K.useCallback)(a=>[aC.VarType.arrayObject,aC.VarType.array,aC.VarType.number,aC.VarType.string,aC.VarType.secret,aC.VarType.arrayString,aC.VarType.arrayNumber,aC.VarType.file,aC.VarType.arrayFile].includes(a.type),[]),Y=(0,K.useCallback)(a=>{n((0,I.produce)(l.current,b=>{b.reasoning_format=a}))},[n]),{availableVars:Z,availableNodesWithParent:$}=(0,eD.default)(a,{onlyLeafNodeVar:!1,filterVar:X});return{readOnly:e,isChatMode:f,inputs:j,isChatModel:p,isCompletionModel:q,hasSetBlockStatus:r,shouldShowContextTip:s,isVisionModel:y,handleModelChanged:C,handleCompletionParamsChange:D,isShowVars:E,handleVarListChange:H,handleVarNameChange:J,handleAddVariable:G,handleAddEmptyVariable:F,handleContextVarChange:L,filterInputVar:V,filterVar:X,availableVars:Z,availableNodesWithParent:$,handlePromptChange:M,handleMemoryChange:N,handleSyeQueryChange:O,handleVisionResolutionEnabledChange:z,handleVisionResolutionChange:A,isModelSupportStructuredOutput:Q,handleStructureOutputChange:U,structuredOutputCollapsed:R,setStructuredOutputCollapsed:S,handleStructureOutputEnableChange:T,filterJinja2InputVar:W,handleReasoningFormatChange:Y}})(a,b),M=e.model,N=(0,K.useCallback)(a=>{(async()=>{try{let{params:b,removedDetails:d}=await (0,jr.fetchAndMergeValidCompletionParams)(a.provider,a.modelId,e.model.completion_params,!0),f=Object.keys(d);f.length&&aX.default.notify({type:"warning",message:`${c("modelProvider.parametersInvalidRemoved",{ns:"common"})}: ${f.map(a=>`${a} (${d[a]})`).join(", ")}`}),m(b)}catch{aX.default.notify({type:"error",message:c("error",{ns:"common"})}),m({})}finally{k(a)}})()},[e.model.completion_params]);return(0,F.jsxs)("div",{className:"mt-2",children:[(0,F.jsxs)("div",{className:"space-y-4 px-4 pb-4",children:[(0,F.jsx)(fW,{title:c(`${j5}.model`,{ns:"workflow"}),required:!0,children:(0,F.jsx)(jq.default,{popupClassName:"!w-[387px]",isInWorkflow:!0,isAdvancedMode:!0,provider:M?.provider,completionParams:M?.completion_params,modelId:M?.name,setModel:N,onCompletionParamsChange:m,hideDebugWithMultipleModel:!0,debugWithMultipleModel:!1,readonly:d})}),(0,F.jsx)(fW,{title:c(`${j5}.context`,{ns:"workflow"}),tooltip:c(`${j5}.contextTooltip`,{ns:"workflow"}),children:(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(gA.default,{readonly:d,nodeId:a,isShowNodeName:!0,value:e.context?.variable_selector||[],onChange:n,filterVar:p}),i&&(0,F.jsx)("div",{className:"text-xs font-normal leading-[18px] text-[#DC6803]",children:c(`${j5}.notSetContextInPromptTip`,{ns:"workflow"})})]})}),M.name&&(0,F.jsx)(jD,{readOnly:d,nodeId:a,filterVar:s?J:o,isChatModel:f,isChatApp:g,isShowContext:!0,payload:e.prompt_template,onChange:t,hasSetBlockStatus:l,varList:e.prompt_config?.jinja2_variables||[],handleAddVariable:v,modelConfig:M}),s&&(0,F.jsx)(fW,{title:c("nodes.templateTransform.inputVars",{ns:"workflow"}),operations:d?void 0:(0,F.jsx)(aY.default,{onClick:u}),children:(0,F.jsx)(gR,{nodeId:a,readonly:d,list:e.prompt_config?.jinja2_variables||[],onChange:w,onVarNameChange:x,filterVar:J,isSupportFileVar:!1})}),g&&f&&!!e.memory&&(0,F.jsxs)("div",{className:"mt-4",children:[(0,F.jsxs)("div",{className:"flex h-8 items-center justify-between rounded-lg bg-components-input-bg-normal pl-3 pr-2",children:[(0,F.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,F.jsx)("div",{className:"text-xs font-semibold uppercase text-text-secondary",children:c("nodes.common.memories.title",{ns:"workflow"})}),(0,F.jsx)(ac.default,{popupContent:c("nodes.common.memories.tip",{ns:"workflow"}),triggerClassName:"w-4 h-4"})]}),(0,F.jsx)("div",{className:"flex h-[18px] items-center rounded-[5px] border border-divider-deep bg-components-badge-bg-dimm px-1 text-xs font-semibold uppercase text-text-tertiary",children:c("nodes.common.memories.builtIn",{ns:"workflow"})})]}),(0,F.jsxs)("div",{className:"mt-4",children:[(0,F.jsx)(f9,{title:(0,F.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,F.jsx)("div",{className:"text-xs font-semibold uppercase text-text-secondary",children:"user"}),(0,F.jsx)(ac.default,{popupContent:(0,F.jsx)("div",{className:"max-w-[180px]",children:c("nodes.llm.roleDescription.user",{ns:"workflow"})}),triggerClassName:"w-4 h-4"})]}),value:e.memory.query_prompt_template||"{{#sys.query#}}",onChange:y,readOnly:d,isShowContext:!1,isChatApp:!0,isChatModel:!0,hasSetBlockStatus:l,nodesOutputVars:q,availableNodes:r,isSupportFileVar:!0}),e.memory.query_prompt_template&&!e.memory.query_prompt_template.includes("{{#sys.query#}}")&&(0,F.jsx)("div",{className:"text-xs font-normal leading-[18px] text-[#DC6803]",children:c(`${j5}.sysQueryInUser`,{ns:"workflow"})})]})]}),g&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(au,{}),(0,F.jsx)(gf,{readonly:d,config:{data:e.memory},onChange:z,canSetRoleName:h})]}),(0,F.jsx)(jv,{nodeId:a,readOnly:d,isVisionModel:j,enabled:e.vision?.enabled,onEnabledChange:A,config:e.vision?.configs,onConfigChange:B}),(0,F.jsx)(jE,{value:e.reasoning_format||"tagged",onChange:L,readonly:d})]}),(0,F.jsx)(au,{}),(0,F.jsx)(gj,{collapsed:D,onCollapse:E,operations:(0,F.jsxs)("div",{className:"mr-4 flex shrink-0 items-center",children:[!C&&!!e.structured_output_enabled&&(0,F.jsx)(ac.default,{noDecoration:!0,popupContent:(0,F.jsxs)("div",{className:"w-[232px] rounded-xl border-[0.5px] border-components-panel-border bg-components-tooltip-bg px-4 py-3.5 shadow-lg backdrop-blur-[5px]",children:[(0,F.jsx)("div",{className:"title-xs-semi-bold text-text-primary",children:c("structOutput.modelNotSupported",{ns:"app"})}),(0,F.jsx)("div",{className:"body-xs-regular mt-1 text-text-secondary",children:c("structOutput.modelNotSupportedTip",{ns:"app"})})]}),children:(0,F.jsx)("div",{children:(0,F.jsx)(Y.RiAlertFill,{className:"mr-1 size-4 text-text-warning-secondary"})})}),(0,F.jsx)("div",{className:"system-xs-medium-uppercase mr-0.5 text-text-tertiary",children:c("structOutput.structured",{ns:"app"})}),(0,F.jsx)(ac.default,{popupContent:(0,F.jsx)("div",{className:"max-w-[150px]",children:c("structOutput.structuredTip",{ns:"app"})}),children:(0,F.jsx)("div",{children:(0,F.jsx)(Y.RiQuestionLine,{className:"size-3.5 text-text-quaternary"})})}),(0,F.jsx)(d4.default,{className:"ml-2",defaultValue:!!e.structured_output_enabled,onChange:G,size:"md",disabled:d})]}),children:(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(gi,{name:"text",type:"string",description:c(`${j5}.outputVars.output`,{ns:"workflow"})}),(0,F.jsx)(gi,{name:"reasoning_content",type:"string",description:c(`${j5}.outputVars.reasoning_content`,{ns:"workflow"})}),(0,F.jsx)(gi,{name:"usage",type:"object",description:c(`${j5}.outputVars.usage`,{ns:"workflow"})}),e.structured_output_enabled&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(au,{className:"mt-3"}),(0,F.jsx)(j4,{className:"mt-4",value:e.structured_output,onChange:H})]})]})})]})}),j7=()=>{let{t:a}=(0,$.useTranslation)();return(0,F.jsx)("div",{className:"nodrag relative left-[17px] top-[21px] z-[11] flex h-11 w-11 items-center justify-center rounded-2xl border border-workflow-block-border bg-workflow-block-bg",children:(0,F.jsx)(ac.default,{popupContent:a("blocks.loop-start",{ns:"workflow"}),asChild:!1,children:(0,F.jsx)("div",{className:"flex h-6 w-6 items-center justify-center rounded-full border-[0.5px] border-components-panel-border-subtle bg-util-colors-blue-brand-blue-brand-500",children:(0,F.jsx)(Y.RiHome5Fill,{className:"h-3 w-3 text-text-primary-on-surface"})})})})},j8=(0,K.memo)(({id:a,data:b})=>{let{t:c}=(0,$.useTranslation)();return(0,F.jsxs)("div",{className:"nodrag group mt-1 flex h-11 w-11 items-center justify-center rounded-2xl border border-workflow-block-border bg-workflow-block-bg",children:[(0,F.jsx)(ac.default,{popupContent:c("blocks.loop-start",{ns:"workflow"}),asChild:!1,children:(0,F.jsx)("div",{className:"flex h-6 w-6 items-center justify-center rounded-full border-[0.5px] border-components-panel-border-subtle bg-util-colors-blue-brand-blue-brand-500",children:(0,F.jsx)(Y.RiHome5Fill,{className:"h-3 w-3 text-text-primary-on-surface"})})}),(0,F.jsx)(fg,{id:a,data:b,handleClassName:"!top-1/2 !-right-[9px] !-translate-y-1/2",handleId:"source"})]})}),j9=(0,K.memo)(({loopNodeData:a})=>{let{t:b}=(0,$.useTranslation)(),{nodesReadOnly:c}=(0,aq.useNodesReadOnly)(),{handleNodeAdd:d}=(0,V.useNodesInteractions)(),{availableNextBlocks:e}=(0,an.useAvailableBlocks)(aC.BlockEnum.Start,!0),f=(0,K.useCallback)((b,c)=>{d({nodeType:b,pluginDefaultValue:c},{prevNodeId:a.start_node_id,prevNodeSourceHandle:"source"})},[d,a.start_node_id]),g=(0,K.useCallback)(a=>(0,F.jsxs)("div",{className:(0,S.cn)("system-sm-medium relative inline-flex h-8 cursor-pointer items-center rounded-lg border-[0.5px] border-components-button-secondary-border bg-components-button-secondary-bg px-3 text-components-button-secondary-text shadow-xs backdrop-blur-[5px] hover:bg-components-button-secondary-bg-hover",`${c&&"!cursor-not-allowed bg-components-button-secondary-bg-disabled"}`,a&&"bg-components-button-secondary-bg-hover"),children:[(0,F.jsx)(Y.RiAddLine,{className:"mr-1 h-4 w-4"}),b("common.addBlock",{ns:"workflow"})]}),[c,b]);return(0,F.jsxs)("div",{className:"absolute left-14 top-7 z-10 flex h-8 items-center",children:[(0,F.jsx)("div",{className:"group/insert relative h-0.5 w-16 bg-gray-300",children:(0,F.jsx)("div",{className:"absolute right-0 top-1/2 h-2 w-0.5 -translate-y-1/2 bg-primary-500"})}),(0,F.jsx)(dT,{disabled:c,onSelect:f,trigger:g,triggerInnerClassName:"inline-flex",popupClassName:"!min-w-[256px]",availableBlocksTypes:e})]})}),ka=(0,K.memo)(({id:a,data:b})=>{let{zoom:c}=(0,N.useViewport)(),d=(0,N.useNodesInitialized)(),{handleNodeLoopRerender:e}=(0,e0.useNodeLoopInteractions)();return(0,K.useEffect)(()=>{d&&e(a)},[d,a,e]),(0,F.jsxs)("div",{className:(0,S.cn)("relative h-full min-h-[90px] w-full min-w-[240px] rounded-2xl bg-workflow-canvas-workflow-bg"),children:[(0,F.jsx)(M.Background,{id:`loop-background-${a}`,className:"!z-0 rounded-2xl",gap:[14/c,14/c],size:2/c,color:"var(--color-workflow-canvas-workflow-dot-color)"}),b._isCandidate&&(0,F.jsx)(j7,{}),1===b._children.length&&(0,F.jsx)(j9,{loopNodeId:a,loopNodeData:b})]})}),kb=({className:a,variables:b,onSelectVariable:c,disabled:d})=>{let{t:e}=(0,$.useTranslation)(),[f,g]=(0,K.useState)(!1),h=(0,K.useCallback)((a,b)=>{c(a,b),g(!1)},[c,g]);return(0,F.jsxs)(bh.PortalToFollowElem,{open:f,onOpenChange:g,placement:"bottom-start",offset:{mainAxis:4,crossAxis:0},children:[(0,F.jsx)(bh.PortalToFollowElemTrigger,{onClick:()=>g(!f),children:(0,F.jsxs)(av.default,{size:"small",className:a,disabled:d,children:[(0,F.jsx)(Y.RiAddLine,{className:"mr-1 h-3.5 w-3.5"}),e("nodes.ifElse.addCondition",{ns:"workflow"})]})}),(0,F.jsx)(bh.PortalToFollowElemContent,{className:"z-[1000]",children:(0,F.jsx)("div",{className:"w-[296px] rounded-lg border-[0.5px] border-components-panel-border bg-components-panel-bg-blur shadow-lg",children:(0,F.jsx)(fa.default,{vars:b,isSupportFileVar:!0,onChange:h})})})]})};var kc=eF;let kd=[kc.VarType.variable,kc.VarType.constant],ke=(0,K.memo)(({numberVarType:a=kc.VarType.constant,onNumberVarTypeChange:b,value:c,onValueChange:d,variables:e,isShort:f,unit:g})=>{let{t:h}=(0,$.useTranslation)(),[i,j]=(0,K.useState)(!1),[k,l]=(0,K.useState)(!1),[m,{setTrue:n,setFalse:o}]=(0,a8.useBoolean)(),p=(0,K.useCallback)(a=>{d((0,hX.variableTransformer)(a)),l(!1)},[d]);return(0,F.jsxs)("div",{className:"flex cursor-pointer items-center",children:[(0,F.jsxs)(bh.PortalToFollowElem,{open:i,onOpenChange:j,placement:"bottom-start",offset:{mainAxis:2,crossAxis:0},children:[(0,F.jsx)(bh.PortalToFollowElemTrigger,{onClick:()=>j(a=>!a),children:(0,F.jsxs)(av.default,{className:"shrink-0",variant:"ghost",size:"small",children:[(0,hW.capitalize)(a),(0,F.jsx)(Y.RiArrowDownSLine,{className:"ml-[1px] h-3.5 w-3.5"})]})}),(0,F.jsx)(bh.PortalToFollowElemContent,{className:"z-[1000]",children:(0,F.jsx)("div",{className:"w-[112px] rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur p-1 shadow-lg",children:kd.map(c=>(0,F.jsx)("div",{className:(0,S.cn)("flex h-7 cursor-pointer items-center rounded-md px-3 hover:bg-state-base-hover","text-[13px] font-medium text-text-secondary",a===c&&"bg-state-base-hover"),onClick:()=>{b(c),j(!1)},children:(0,hW.capitalize)(c)},c))})})]}),(0,F.jsx)("div",{className:"mx-1 h-4 w-[1px] bg-divider-regular"}),(0,F.jsxs)("div",{className:"ml-0.5 w-0 grow",children:[a===kc.VarType.variable&&(0,F.jsxs)(bh.PortalToFollowElem,{open:k,onOpenChange:l,placement:"bottom-start",offset:{mainAxis:2,crossAxis:0},children:[(0,F.jsxs)(bh.PortalToFollowElemTrigger,{className:"w-full",onClick:()=>l(a=>!a),children:[c&&(0,F.jsx)(hY.default,{valueSelector:(0,hX.variableTransformer)(c),varType:aC.VarType.number,isShort:f}),!c&&(0,F.jsxs)("div",{className:"flex h-6 items-center p-1 text-[13px] text-components-input-text-placeholder",children:[(0,F.jsx)(a0.Variable02,{className:"mr-1 h-4 w-4 shrink-0"}),(0,F.jsx)("div",{className:"w-0 grow truncate",children:h("nodes.ifElse.selectVariable",{ns:"workflow"})})]})]}),(0,F.jsx)(bh.PortalToFollowElemContent,{className:"z-[1000]",children:(0,F.jsx)("div",{className:(0,S.cn)("w-[296px] rounded-lg border-[0.5px] border-components-panel-border bg-components-panel-bg-blur pt-1 shadow-lg",f&&"w-[200px]"),children:(0,F.jsx)(fa.default,{vars:e,onChange:p})})})]}),a===kc.VarType.constant&&(0,F.jsxs)("div",{className:" relative",children:[(0,F.jsx)("input",{className:(0,S.cn)("block w-full appearance-none bg-transparent px-2 text-[13px] text-components-input-text-filled outline-none placeholder:text-components-input-text-placeholder",g&&"pr-6"),type:"number",value:c,onChange:a=>d(a.target.value),placeholder:h("nodes.ifElse.enterValue",{ns:"workflow"})||"",onFocus:n,onBlur:o}),!m&&g&&(0,F.jsx)("div",{className:"system-sm-regular absolute right-2 top-[50%] translate-y-[-50%] text-text-tertiary",children:g})]})]})]})}),kf=({value:a,onChange:b,disabled:c,availableNodes:d})=>{let{t:e}=(0,$.useTranslation)(),f=(0,aP.useStore)(a=>a.controlPromptEditorRerenderKey),g=(0,aP.useStore)(a=>a.pipelineId),h=(0,aP.useStore)(a=>a.setShowInputFieldPanel);return(0,F.jsx)(f_.default,{compact:!0,value:a,placeholder:e("nodes.ifElse.enterValue",{ns:"workflow"})||"",workflowVariableBlock:{show:!0,variables:[],workflowNodesMap:d.reduce((a,b)=>(a[b.id]={title:b.data.title,type:b.data.type},b.data.type===aC.BlockEnum.Start&&(a.sys={title:e("blocks.start",{ns:"workflow"}),type:aC.BlockEnum.Start}),a),{}),showManageInputField:!!g,onManageInputField:()=>h?.(!0)},onChange:b,editable:!c},f)},kg="nodes.ifElse",kh=({className:a,disabled:b,varType:c,file:d,value:e,onSelect:f})=>{let{t:g}=(0,$.useTranslation)(),[h,i]=(0,K.useState)(!1),j=(0,K.useMemo)(()=>cB(c,d).map(a=>({label:a&&!cA.includes(a)?g(`${kg}.comparisonOperator.${a}`,{ns:"workflow"}):a,value:a})),[g,c,d]),k=j.find(a=>Array.isArray(e)?a.value===e[0]:a.value===e);return(0,F.jsxs)(bh.PortalToFollowElem,{open:h,onOpenChange:i,placement:"bottom-end",offset:{mainAxis:4,crossAxis:0},children:[(0,F.jsx)(bh.PortalToFollowElemTrigger,{onClick:()=>i(a=>!a),children:(0,F.jsxs)(av.default,{className:(0,S.cn)("shrink-0",!k&&"opacity-50",a),size:"small",variant:"ghost",disabled:b,children:[k?k.label:g(`${kg}.select`,{ns:"workflow"}),(0,F.jsx)(Y.RiArrowDownSLine,{className:"ml-1 h-3.5 w-3.5"})]})}),(0,F.jsx)(bh.PortalToFollowElemContent,{className:"z-10",children:(0,F.jsx)("div",{className:"rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur p-1 shadow-lg",children:j.map(a=>(0,F.jsx)("div",{className:"flex h-7 cursor-pointer items-center rounded-lg px-3 py-1.5 text-[13px] font-medium text-text-secondary hover:bg-state-base-hover",onClick:()=>{f(a.value),i(!1)},children:a.label},a.value))})})]})},ki=({open:a,onOpenChange:b,valueSelector:c,varType:d,availableNodes:e,nodesOutputVars:f,onChange:g})=>(0,F.jsxs)(bh.PortalToFollowElem,{open:a,onOpenChange:b,placement:"bottom-start",offset:{mainAxis:4,crossAxis:0},children:[(0,F.jsx)(bh.PortalToFollowElemTrigger,{onClick:()=>b(!a),children:(0,F.jsx)("div",{className:"cursor-pointer",children:(0,F.jsx)(hY.default,{valueSelector:c,varType:d,availableNodes:e,isShort:!0})})}),(0,F.jsx)(bh.PortalToFollowElemContent,{className:"z-[1000]",children:(0,F.jsx)("div",{className:"w-[296px] rounded-lg border-[0.5px] border-components-panel-border bg-components-panel-bg-blur shadow-lg",children:(0,F.jsx)(fa.default,{vars:f,isSupportFileVar:!0,onChange:g})})})]}),kj="nodes.ifElse.optionName",kk=({className:a,disabled:b,conditionId:c,condition:d,file:e,isSubVariableKey:f,isValueFieldShort:g,onRemoveCondition:h,onUpdateCondition:i,onAddSubVariableCondition:j,onRemoveSubVariableCondition:k,onUpdateSubVariableCondition:l,onToggleSubVariableConditionLogicalOperator:m,nodeId:n,availableNodes:o,numberVariables:p,availableVars:q})=>{let{t:r}=(0,$.useTranslation)(),[s,t]=(0,K.useState)(!1),[u,v]=(0,K.useState)(!1),w=(0,K.useCallback)(a=>{f?l?.(c,d.id,a):i?.(d.id,a)},[d,c,f,i,l]),x=(0,K.useMemo)(()=>!b&&(!f||!!d.key),[d.key,b,f]),y=(0,K.useCallback)(a=>{w({...d,comparison_operator:a})},[d,w]),z=(0,K.useCallback)(a=>{w({...d,numberVarType:a,value:""})},[d,w]),A=d.varType===aC.VarType.arrayFile&&[cy.contains,cy.notContains,cy.allOf].includes(d.comparison_operator),B=(0,K.useMemo)(()=>e||(f?{key:d.key}:void 0),[d.key,e,f]),C=B?.key==="transfer_method"||B?.key==="type",D=(0,K.useCallback)(a=>{a===d.value||C&&a===d.value?.[0]||w({...d,value:C?[a]:a})},[d,w,C]),E=d.comparison_operator&&[cy.in,cy.notIn].includes(d.comparison_operator),G=(0,K.useMemo)(()=>{if(E){if(B?.key==="type"||d.comparison_operator===cy.allOf)return cF.map(a=>({name:r(`${kj}.${a.i18nKey}`,{ns:"workflow"}),value:a.value}));if(B?.key==="transfer_method")return cG.map(a=>({name:r(`${kj}.${a.i18nKey}`,{ns:"workflow"}),value:a.value}))}return[]},[d.comparison_operator,B?.key,E,r]),H=E||A,J=cH.map(a=>({name:a,value:a})),L=(0,K.useCallback)(a=>{let b=(0,I.produce)(d,b=>{b.key=a,"size"===a?b.varType=aC.VarType.number:b.varType=aC.VarType.string,b.value="",b.comparison_operator=cB(void 0,{key:a})[0]});l?.(c,d.id,b)},[d,c,l]),M=(0,K.useCallback)(()=>{f?k?.(c,d.id):h?.(d.id)},[d,c,f,h,k]),N=(0,K.useCallback)((a,b)=>{w((0,I.produce)(d,c=>{c.variable_selector=a,c.varType=b.type,c.value="",c.comparison_operator=cB(b.type)[0],delete c.key,delete c.sub_variable_condition,delete c.numberVarType})),v(!1)},[d,w]);return(0,F.jsxs)("div",{className:(0,S.cn)("mb-1 flex last-of-type:mb-0",a),children:[(0,F.jsxs)("div",{className:(0,S.cn)("grow rounded-lg bg-components-input-bg-normal",s&&"bg-state-destructive-hover"),children:[(0,F.jsxs)("div",{className:"flex items-center p-1",children:[(0,F.jsx)("div",{className:"w-0 grow",children:f?(0,F.jsx)(a4.SimpleSelect,{wrapperClassName:"h-6",className:"pl-0 text-xs",optionWrapClassName:"w-[165px] max-h-none",defaultValue:d.key,items:J,onSelect:a=>L(a.value),renderTrigger:a=>a?(0,F.jsx)("div",{className:"flex cursor-pointer justify-start",children:(0,F.jsxs)("div",{className:"inline-flex h-6 max-w-full items-center rounded-md border-[0.5px] border-components-panel-border-subtle bg-components-badge-white-to-dark px-1.5 text-text-accent shadow-xs",children:[(0,F.jsx)(a0.Variable02,{className:"h-3.5 w-3.5 shrink-0 text-text-accent"}),(0,F.jsx)("div",{className:"system-xs-medium ml-0.5 truncate",children:a?.name})]})}):(0,F.jsx)("div",{className:"system-sm-regular text-left text-components-input-text-placeholder",children:r("placeholder.select",{ns:"common"})}),hideChecked:!0}):(0,F.jsx)(ki,{open:u,onOpenChange:v,valueSelector:d.variable_selector||[],varType:d.varType,availableNodes:o,nodesOutputVars:q,onChange:N})}),(0,F.jsx)("div",{className:"mx-1 h-3 w-[1px] bg-divider-regular"}),(0,F.jsx)(kh,{disabled:!x,varType:d.varType,value:d.comparison_operator,onSelect:y,file:B})]}),!cC(d.comparison_operator)&&!H&&d.varType!==aC.VarType.number&&d.varType!==aC.VarType.boolean&&(0,F.jsx)("div",{className:"max-h-[100px] overflow-y-auto border-t border-t-divider-subtle px-2 py-1",children:(0,F.jsx)(kf,{disabled:b,value:d.value,onChange:D,availableNodes:o})}),!cC(d.comparison_operator)&&d.varType===aC.VarType.boolean&&(0,F.jsx)("div",{className:"p-1",children:(0,F.jsx)(gC,{value:d.value,onChange:D})}),!cC(d.comparison_operator)&&!H&&d.varType===aC.VarType.number&&(0,F.jsx)("div",{className:"border-t border-t-divider-subtle px-2 py-1 pt-[3px]",children:(0,F.jsx)(ke,{numberVarType:d.numberVarType,onNumberVarTypeChange:z,value:d.value,onValueChange:D,variables:p,isShort:g,unit:B?.key==="size"?"Byte":void 0})}),!cC(d.comparison_operator)&&E&&(0,F.jsx)("div",{className:"border-t border-t-divider-subtle",children:(0,F.jsx)(a4.SimpleSelect,{wrapperClassName:"h-8",className:"rounded-t-none px-2 text-xs",defaultValue:C?d.value?.[0]:d.value,items:G,onSelect:a=>D(a.value),hideChecked:!0,notClearable:!0})}),!cC(d.comparison_operator)&&A&&(0,F.jsx)("div",{className:"p-1",children:(0,F.jsx)(km,{isSubVariable:!0,conditions:d.sub_variable_condition?.conditions||[],logicalOperator:d.sub_variable_condition?.logical_operator,conditionId:c,readOnly:!!b,handleAddSubVariableCondition:j,handleRemoveSubVariableCondition:k,handleUpdateSubVariableCondition:l,handleToggleSubVariableConditionLogicalOperator:m,nodeId:n,availableNodes:o,availableVars:q})})]}),(0,F.jsx)("div",{className:"ml-1 mt-1 flex h-6 w-6 shrink-0 cursor-pointer items-center justify-center rounded-lg text-text-tertiary hover:bg-state-destructive-hover hover:text-text-destructive",onMouseEnter:()=>t(!0),onMouseLeave:()=>t(!1),onClick:M,children:(0,F.jsx)(Y.RiDeleteBinLine,{className:"h-4 w-4"})})]})},kl=({isSubVariable:a,disabled:b,conditionId:c,conditions:d,logicalOperator:e,onUpdateCondition:f,onRemoveCondition:g,onToggleConditionLogicalOperator:h,onAddSubVariableCondition:i,onRemoveSubVariableCondition:j,onUpdateSubVariableCondition:k,onToggleSubVariableConditionLogicalOperator:l,nodeId:m,availableNodes:n,numberVariables:o,availableVars:p})=>{let q=(0,K.useCallback)(b=>{a&&b?l?.(b):h?.()},[a,h,l]),r=(0,K.useMemo)(()=>!!a&&!!(d.length>1),[d.length,a]),s=(0,K.useMemo)(()=>!a||d.length<2?"":e===cx.and?"pl-[51px]":"pl-[42px]",[d.length,a,e]);return(0,F.jsxs)("div",{className:(0,S.cn)("relative",d.length>1&&!a&&"pl-[60px]"),children:[d.length>1&&(0,F.jsxs)("div",{className:(0,S.cn)("absolute bottom-0 left-0 top-0 w-[60px]",a&&e===cx.and&&"left-[-10px]",a&&e===cx.or&&"left-[-18px]"),children:[(0,F.jsx)("div",{className:"absolute bottom-4 left-[46px] top-4 w-2.5 rounded-l-[8px] border border-r-0 border-divider-deep"}),(0,F.jsx)("div",{className:"absolute right-0 top-1/2 h-[29px] w-4 -translate-y-1/2 bg-components-panel-bg"}),(0,F.jsxs)("div",{className:"absolute right-1 top-1/2 flex h-[21px] -translate-y-1/2 cursor-pointer select-none items-center rounded-md border-[0.5px] border-components-button-secondary-border bg-components-button-secondary-bg px-1 text-[10px] font-semibold text-text-accent-secondary shadow-xs",onClick:()=>q(c),children:[!!e&&e.toUpperCase(),(0,F.jsx)(Y.RiLoopLeftLine,{className:"ml-0.5 h-3 w-3"})]})]}),d.map(d=>(0,F.jsx)(kk,{className:s,disabled:b,conditionId:a?c:d.id,condition:d,isValueFieldShort:r,onUpdateCondition:f,onRemoveCondition:g,onAddSubVariableCondition:i,onRemoveSubVariableCondition:j,onUpdateSubVariableCondition:k,onToggleSubVariableConditionLogicalOperator:l,nodeId:m,availableNodes:n,numberVariables:o,isSubVariableKey:a,availableVars:p},d.id))]})},km=K.memo(({isSubVariable:a,conditionId:b,conditions:c,logicalOperator:d,nodeId:e="",readOnly:f,handleUpdateCondition:g,handleAddCondition:h,handleRemoveCondition:i,handleToggleConditionLogicalOperator:j,handleAddSubVariableCondition:k,handleRemoveSubVariableCondition:l,handleUpdateSubVariableCondition:m,handleToggleSubVariableConditionLogicalOperator:n,availableNodes:o=[],availableVars:p=[]})=>{let{t:q}=(0,$.useTranslation)(),r=e8(),s=(0,K.useCallback)(a=>a.type===aC.VarType.number,[]),t=cH.map(a=>({name:a,value:a}));return c?(0,F.jsx)(F.Fragment,{children:(0,F.jsx)("div",{children:(0,F.jsxs)("div",{className:(0,S.cn)("group relative rounded-[10px] bg-components-panel-bg",!a&&"min-h-[40px] px-3 py-1 ",a&&"px-1 py-2"),children:[c&&!!c.length&&(0,F.jsx)("div",{className:"mb-2",children:(0,F.jsx)(kl,{disabled:f,conditionId:b,conditions:c,logicalOperator:d,onUpdateCondition:g,onRemoveCondition:i,onToggleConditionLogicalOperator:j,nodeId:e,availableNodes:o,numberVariables:r(e,"",s),onAddSubVariableCondition:k,onRemoveSubVariableCondition:l,onUpdateSubVariableCondition:m,onToggleSubVariableConditionLogicalOperator:n,isSubVariable:a,availableVars:p})}),(0,F.jsx)("div",{className:(0,S.cn)("flex items-center justify-between pr-[30px]",!c.length&&!a&&"mt-1",!c.length&&a&&"mt-2",c.length>1&&!a&&"ml-[60px]"),children:a?(0,F.jsx)(a4.PortalSelect,{popupInnerClassName:"w-[165px] max-h-none",onSelect:a=>k?.(b,a.value),items:t,value:"",renderTrigger:()=>(0,F.jsxs)(av.default,{size:"small",disabled:f,children:[(0,F.jsx)(Y.RiAddLine,{className:"mr-1 h-3.5 w-3.5"}),q("nodes.ifElse.addSubVariable",{ns:"workflow"})]}),hideChecked:!0}):(0,F.jsx)(kb,{disabled:f,variables:p,onSelectVariable:h})})]})})}):(0,F.jsx)("div",{})}),kn=()=>{let{t:a}=(0,$.useTranslation)();return(0,F.jsx)("div",{className:"system-xs-regular flex h-10 items-center justify-center rounded-[10px] bg-background-section text-text-tertiary",children:a("nodes.loop.setLoopVariables",{ns:"workflow"})})},ko=K.memo(({className:a,list:b,onChange:c})=>{let{t:d}=(0,$.useTranslation)(),e=(0,K.useCallback)(a=>d=>{c((0,I.produce)(b,b=>{b[a]=d}))},[b,c]),f=(0,K.useCallback)(a=>()=>{c((0,I.produce)(b,b=>{b.splice(a,1)}))},[b,c]),g=(0,K.useCallback)(()=>{c((0,I.produce)(b,a=>{a.push(!1)}))},[b,c]);return(0,F.jsxs)("div",{className:(0,S.cn)("w-full space-y-2",a),children:[b.map((a,b)=>(0,F.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,F.jsx)(gC,{value:a,onChange:e(b)}),(0,F.jsx)(gL.default,{className:"!bg-gray-100 !p-2 hover:!bg-gray-200",onClick:f(b)})]},b)),(0,F.jsxs)(av.default,{variant:"tertiary",className:"w-full",onClick:g,children:[(0,F.jsx)(Y.RiAddLine,{className:"mr-1 h-4 w-4"}),(0,F.jsx)("span",{children:d("chatVariable.modal.addArrayValue",{ns:"workflow"})})]})]})}),kp=`#  example
#  {
#     "name": "ray",
#     "age": 20
#  }`,kq=`#  example
#  [
#     "value1",
#     "value2"
#  ]`,kr=`#  example
#  [
#     100,
#     200
#  ]`,ks=`#  example
#  [
#     {
#       "name": "ray",
#       "age": 20
#     },
#     {
#       "name": "lily",
#       "age": 18
#     }
#  ]`,kt=`#  example
#  [
#     "True",
#     "False"
#  ]`,ku=({nodeId:a,item:b,onChange:c})=>{let{t:d}=(0,$.useTranslation)(),{value_type:e,var_type:f,value:g}=b,h=(0,K.useCallback)(a=>{c(a.target.value)},[c]),i=(0,K.useCallback)(a=>{c(a)},[c]),j=(0,K.useCallback)(a=>a.type===f,[f]),k=(0,K.useMemo)(()=>f===aC.VarType.arrayObject?"240px":"120px",[f]),l=(0,K.useMemo)(()=>f===aC.VarType.arrayString?kq:f===aC.VarType.arrayNumber?kr:f===aC.VarType.arrayObject?ks:f===aC.VarType.arrayBoolean?kt:kp,[f]);return(0,F.jsxs)("div",{children:[e===aC.ValueType.variable&&(0,F.jsx)(gA.default,{readonly:!1,nodeId:a,isShowNodeName:!0,value:g,onChange:i,filterVar:j,placeholder:d("nodes.assigner.setParameter",{ns:"workflow"})}),e===aC.ValueType.constant&&f===aC.VarType.string&&(0,F.jsx)(a5.default,{value:g,onChange:h,className:"min-h-12 w-full"}),e===aC.ValueType.constant&&f===aC.VarType.number&&(0,F.jsx)(a2.default,{type:"number",value:g,onChange:h,className:"w-full"}),e===aC.ValueType.constant&&f===aC.VarType.boolean&&(0,F.jsx)(gC,{value:g,onChange:i}),e===aC.ValueType.constant&&(f===aC.VarType.object||f===aC.VarType.arrayString||f===aC.VarType.arrayNumber||f===aC.VarType.arrayObject)&&(0,F.jsx)("div",{className:"w-full rounded-[10px] bg-components-input-bg-normal py-2 pl-3 pr-1",style:{height:k},children:(0,F.jsx)(a7.default,{value:g,isExpand:!0,noWrapper:!0,language:a6.CodeLanguage.json,onChange:i,className:"w-full",placeholder:(0,F.jsx)("div",{className:"whitespace-pre",children:l})})}),e===aC.ValueType.constant&&f===aC.VarType.arrayBoolean&&(0,F.jsx)(ko,{className:"mt-2",list:g||[!1],onChange:i})]})};var kv=a.i(166102);let kw=({value:a,onChange:b})=>{let{t:c}=(0,$.useTranslation)();return(0,F.jsx)(kv.default,{options:[{label:"Variable",value:"variable"},{label:"Constant",value:"constant"}],value:a,onChange:b,popupProps:{title:c("nodes.loop.inputMode",{ns:"workflow"}),className:"w-[132px]"}})},kx=({value:a,onChange:b})=>{let c=[{label:"String",value:aC.VarType.string},{label:"Number",value:aC.VarType.number},{label:"Object",value:aC.VarType.object},{label:"Boolean",value:aC.VarType.boolean},{label:"Array[string]",value:aC.VarType.arrayString},{label:"Array[number]",value:aC.VarType.arrayNumber},{label:"Array[object]",value:aC.VarType.arrayObject},{label:"Array[boolean]",value:aC.VarType.arrayBoolean}];return(0,F.jsx)(kv.default,{options:c,value:a,onChange:b,popupProps:{className:"w-[132px]"}})},ky=({nodeId:a,item:b,handleRemoveLoopVariable:c,handleUpdateLoopVariable:d})=>{let{t:e}=(0,$.useTranslation)(),f=a=>{let{isValid:b,errorMessageKey:c}=(0,by.checkKeys)([a],!1);return!!b||(aX.default.notify({type:"error",message:e(`varKeyError.${c}`,{ns:"appDebug",key:e("env.modal.name",{ns:"workflow"})})}),!1)},g=(0,K.useCallback)(a=>{(0,by.replaceSpaceWithUnderscoreInVarNameInput)(a.target),(!a.target.value||f(a.target.value))&&d(b.id,{label:a.target.value})},[b.id,d]),h=(0,K.useCallback)((a,b)=>{if(b!==aC.ValueType.variable)switch(a){case aC.VarType.boolean:return!1;case aC.VarType.arrayBoolean:return[!1];default:return}},[]),i=(0,K.useCallback)(a=>{d(b.id,{var_type:a,value:h(a,b.value_type)})},[b.id,d]),j=(0,K.useCallback)(a=>{d(b.id,{value_type:a,value:h(b.var_type,a)})},[b.id,d]),k=(0,K.useCallback)(a=>{d(b.id,{value:a})},[b.id,d]);return(0,F.jsxs)("div",{className:"mb-4 flex last-of-type:mb-0",children:[(0,F.jsxs)("div",{className:"w-0 grow",children:[(0,F.jsxs)("div",{className:"mb-1 grid grid-cols-3 gap-1",children:[(0,F.jsx)(a2.default,{value:b.label,onChange:g,onBlur:a=>f(a.target.value),autoFocus:!b.label,placeholder:e("nodes.loop.variableName",{ns:"workflow"})}),(0,F.jsx)(kx,{value:b.var_type,onChange:i}),(0,F.jsx)(kw,{value:b.value_type,onChange:j})]}),(0,F.jsx)("div",{children:(0,F.jsx)(ku,{nodeId:a,item:b,onChange:k})})]}),(0,F.jsx)(fX.default,{className:"shrink-0",size:"l",onClick:()=>c(b.id),children:(0,F.jsx)(Y.RiDeleteBinLine,{className:"h-4 w-4 text-text-tertiary"})})]})},kz=({variables:a=[],...b})=>a.length?a.map(a=>(0,F.jsx)(ky,{item:a,...b},a.id)):(0,F.jsx)(kn,{}),kA="nodes.loop",kB=K.memo(({id:a,data:b})=>{let{t:c}=(0,$.useTranslation)(),{readOnly:d,inputs:e,childrenNodeVars:f,loopChildrenNodes:g,handleAddCondition:h,handleUpdateCondition:i,handleRemoveCondition:j,handleToggleConditionLogicalOperator:k,handleAddSubVariableCondition:l,handleRemoveSubVariableCondition:m,handleUpdateSubVariableCondition:n,handleToggleSubVariableConditionLogicalOperator:o,handleUpdateLoopCount:p,handleAddLoopVariable:q,handleRemoveLoopVariable:r,handleUpdateLoopVariable:s}=((a,b)=>{let{nodesReadOnly:c}=(0,aq.useNodesReadOnly)(),d=(0,aq.useIsChatMode)(),e=(0,aP.useStore)(a=>a.conversationVariables),{inputs:f,setInputs:g}=eA(a,b),h=(0,K.useRef)(f),i=(0,K.useCallback)(a=>{h.current=a,g(a)},[g]),j=(0,K.useCallback)(a=>[aC.VarType.array,aC.VarType.arrayString,aC.VarType.arrayNumber,aC.VarType.arrayObject,aC.VarType.arrayFile].includes(a.type),[]),{getLoopNodeChildren:k}=(0,aq.useWorkflow)(),l=[{id:a,data:b},...k(a)],{data:m}=(0,Q.useAllBuiltInTools)(),{data:n}=(0,Q.useAllCustomTools)(),{data:o}=(0,Q.useAllWorkflowTools)(),{data:p}=(0,Q.useAllMCPTools)(),q=(0,aP.useStore)(a=>a.dataSourceList),r=(0,bY.toNodeOutputVars)(l,d,void 0,[],e,[],{buildInTools:m||[],customTools:n||[],workflowTools:o||[],mcpTools:p||[],dataSourceList:q||[]}),{getIsVarFileAttribute:s}=(({nodeId:a})=>{let b=(0,aq.useIsChatMode)(),{getBeforeNodesInSameBranch:c}=(0,aq.useWorkflow)(),d=(0,K.useMemo)(()=>c(a),[c,a]),{getCurrentVariableType:e}=(0,e5.useWorkflowVariables)();return{getIsVarFileAttribute:a=>3===a.length&&e({valueSelector:a.slice(0,2),availableNodes:d,isChatMode:b,isConstant:!1})===aC.VarType.file}})({nodeId:a}),t=(0,K.useCallback)(a=>{i((0,I.produce)(h.current,b=>{b.error_handle_mode=a.value}))},[f,i]),u=(0,K.useCallback)((a,b)=>{i((0,I.produce)(h.current,c=>{c.break_conditions||(c.break_conditions=[]),c.break_conditions?.push({id:(0,du.v4)(),varType:b.type,variable_selector:a,comparison_operator:cB(b.type,s(a)?{key:a.slice(-1)[0]}:void 0)[0],value:b.type===aC.VarType.boolean?"false":""})}))},[s,i]),v=(0,K.useCallback)(a=>{i((0,I.produce)(h.current,b=>{b.break_conditions=b.break_conditions?.filter(b=>b.id!==a)}))},[i]),w=(0,K.useCallback)((a,b)=>{i((0,I.produce)(h.current,c=>{let d=c.break_conditions?.find(b=>b.id===a);d&&Object.assign(d,b)}))},[i]),x=(0,K.useCallback)(()=>{i((0,I.produce)(h.current,a=>{a.logical_operator=a.logical_operator===cx.and?cx.or:cx.and}))},[i]),y=(0,K.useCallback)((a,b)=>{i((0,I.produce)(h.current,c=>{let d=c.break_conditions?.find(b=>b.id===a);if(!d)return;d?.sub_variable_condition||(d.sub_variable_condition={logical_operator:cx.and,conditions:[]});let e=d.sub_variable_condition;if(e){e.conditions||(e.conditions=[]);let a=cB(aC.VarType.string,{key:b||""});e.conditions.push({id:(0,du.v4)(),key:b||"",varType:aC.VarType.string,comparison_operator:a&&a.length?a[0]:void 0,value:""})}}))},[i]),z=(0,K.useCallback)((a,b)=>{i((0,I.produce)(h.current,c=>{let d=c.break_conditions?.find(b=>b.id===a);if(!d||!d?.sub_variable_condition)return;let e=d.sub_variable_condition;e&&(e.conditions=e.conditions.filter(a=>a.id!==b))}))},[i]),A=(0,K.useCallback)((a,b,c)=>{i((0,I.produce)(h.current,d=>{let e=d.break_conditions?.find(b=>b.id===a);if(e&&e.sub_variable_condition){let a=e.sub_variable_condition.conditions.find(a=>a.id===b);a&&Object.assign(a,c)}}))},[i]),B=(0,K.useCallback)(a=>{i((0,I.produce)(h.current,b=>{let c=b.break_conditions?.find(b=>b.id===a);c&&c.sub_variable_condition&&(c.sub_variable_condition.logical_operator=c.sub_variable_condition.logical_operator===cx.and?cx.or:cx.and)}))},[i]),C=(0,K.useCallback)(a=>{i((0,I.produce)(h.current,b=>{b.loop_count=a}))},[i]),D=(0,K.useCallback)(()=>{i((0,I.produce)(h.current,a=>{a.loop_variables||(a.loop_variables=[]),a.loop_variables.push({id:(0,du.v4)(),label:"",var_type:aC.VarType.string,value_type:aC.ValueType.constant,value:""})}))},[i]);return{readOnly:c,inputs:f,filterInputVar:j,childrenNodeVars:r,loopChildrenNodes:l,handleAddCondition:u,handleRemoveCondition:v,handleUpdateCondition:w,handleToggleConditionLogicalOperator:x,handleAddSubVariableCondition:y,handleUpdateSubVariableCondition:A,handleRemoveSubVariableCondition:z,handleToggleSubVariableConditionLogicalOperator:B,handleUpdateLoopCount:C,changeErrorResponseMode:t,handleAddLoopVariable:D,handleRemoveLoopVariable:(0,K.useCallback)(a=>{i((0,I.produce)(h.current,b=>{b.loop_variables=b.loop_variables?.filter(b=>b.id!==a)}))},[i]),handleUpdateLoopVariable:(0,K.useCallback)((a,b)=>{let c=(h.current.loop_variables||[]).findIndex(b=>b.id===a);i((0,I.produce)(h.current,a=>{c>-1&&(a.loop_variables[c]={...a.loop_variables[c],...b})}))},[i])}})(a,b);return(0,F.jsx)("div",{className:"mt-2",children:(0,F.jsxs)("div",{children:[(0,F.jsx)(fW,{title:(0,F.jsx)("div",{className:"pl-3",children:c("nodes.loop.loopVariables",{ns:"workflow"})}),operations:(0,F.jsx)("div",{className:"mr-4 flex h-5 w-5 cursor-pointer items-center justify-center",onClick:q,children:(0,F.jsx)(Y.RiAddLine,{className:"h-4 w-4 text-text-tertiary"})}),children:(0,F.jsx)("div",{className:"px-4",children:(0,F.jsx)(kz,{variables:e.loop_variables,nodeId:a,handleRemoveLoopVariable:r,handleUpdateLoopVariable:s})})}),(0,F.jsx)(au,{className:"my-2"}),(0,F.jsx)(fW,{title:(0,F.jsx)("div",{className:"pl-3",children:c(`${kA}.breakCondition`,{ns:"workflow"})}),tooltip:c(`${kA}.breakConditionTip`,{ns:"workflow"}),children:(0,F.jsx)(km,{nodeId:a,readOnly:d,handleAddCondition:h,handleRemoveCondition:j,handleUpdateCondition:i,handleToggleConditionLogicalOperator:k,handleAddSubVariableCondition:l,handleRemoveSubVariableCondition:m,handleUpdateSubVariableCondition:n,handleToggleSubVariableConditionLogicalOperator:o,availableNodes:g,availableVars:f,conditions:e.break_conditions||[],logicalOperator:e.logical_operator})}),(0,F.jsx)(au,{className:"mt-2"}),(0,F.jsx)("div",{className:"mt-2",children:(0,F.jsx)(fW,{title:(0,F.jsx)("div",{className:"pl-3",children:c(`${kA}.loopMaxCount`,{ns:"workflow"})}),children:(0,F.jsx)("div",{className:"px-3 py-2",children:(0,F.jsx)(jk.default,{min:1,max:O.LOOP_NODE_MAX_COUNT,value:e.loop_count,onChange:a=>{let b=Math.round(a);p(Number.isNaN(b)?1:b)}})})})})]})})}),kC=K.memo(({data:a})=>{let{provider:b,name:c}=a.model||{},{textGenerationModelList:d}=(0,ae.useTextGenerationCurrentProviderAndModelAndModelList)(),e=b&&c;return(0,F.jsx)("div",{className:"mb-1 px-3 py-1",children:e&&(0,F.jsx)(fz.default,{defaultModel:{provider:b,model:c},modelList:d,triggerClassName:"!h-6 !rounded-md",readonly:!0})})});var gg=gg;let kD=(0,K.memo)(({onImport:a})=>{let{t:b}=(0,$.useTranslation)(),c=(0,ae.useLanguage)(),{data:d}=(0,Q.useAllBuiltInTools)(),{data:e}=(0,Q.useAllCustomTools)(),{data:f}=(0,Q.useAllWorkflowTools)(),g=(0,K.useCallback)((b,g)=>{var h;if(!g||"datasource_name"in g||!("tool_name"in g))return;let{provider_id:i,provider_type:j,tool_name:k}=g,l=(()=>{switch(j){case bN.CollectionType.builtIn:return d||[];case bN.CollectionType.custom:return e||[];case bN.CollectionType.workflow:return f||[];default:return[]}})().find(a=>(0,aU.canFindTool)(a.id,i)),m=l?.tools.find(a=>a.name===k);a((h=(m?.parameters||[]).filter(a=>"llm"===a.form),h.map(a=>({name:a.name,type:a.type,required:a.required,description:a.llm_description,options:a.options?.map(a=>a.label[c]||a.label.en_US)||[]}))))},[d,e,c,a,f]),h=(0,K.useCallback)(a=>(0,F.jsx)("div",{children:(0,F.jsx)("div",{className:(0,S.cn)("flex h-6 cursor-pointer items-center rounded-md px-2 text-xs font-medium text-text-tertiary hover:bg-state-base-hover",a&&"bg-state-base-hover"),children:b("nodes.parameterExtractor.importFromTool",{ns:"workflow"})})}),[b]);return(0,F.jsx)(dT,{placement:"bottom-end",offset:{mainAxis:4,crossAxis:52},trigger:h,onSelect:g,noBlocks:!0})}),kE=K.memo(({payload:a,onEdit:b,onDelete:c})=>{let{t:d}=(0,$.useTranslation)();return(0,F.jsxs)("div",{className:"group relative rounded-lg bg-components-input-bg-normal px-2.5 py-2 hover:shadow-xs",children:[(0,F.jsxs)("div",{className:"flex justify-between",children:[(0,F.jsxs)("div",{className:"flex items-center",children:[(0,F.jsx)(a0.Variable02,{className:"h-3.5 w-3.5 text-text-accent-secondary"}),(0,F.jsx)("div",{className:"ml-1 text-[13px] font-medium text-text-primary",children:a.name}),(0,F.jsx)("div",{className:"ml-2 text-xs font-normal capitalize text-text-tertiary",children:a.type})]}),a.required&&(0,F.jsx)("div",{className:"text-xs font-normal uppercase leading-4 text-text-tertiary",children:d("nodes.parameterExtractor.addExtractParameterContent.required",{ns:"workflow"})})]}),(0,F.jsx)("div",{className:"mt-0.5 text-xs font-normal leading-[18px] text-text-tertiary",children:a.description}),(0,F.jsxs)("div",{className:"absolute right-0 top-0 hidden h-full w-[119px] items-center justify-end space-x-1 rounded-lg bg-gradient-to-l from-components-panel-on-panel-item-bg to-background-gradient-mask-transparent pr-1 group-hover:flex",children:[(0,F.jsx)("div",{className:"cursor-pointer rounded-md p-1 hover:bg-state-base-hover",onClick:b,children:(0,F.jsx)(Y.RiEditLine,{className:"h-4 w-4 text-text-tertiary"})}),(0,F.jsx)("div",{className:"group shrink-0 cursor-pointer rounded-md p-1 hover:!bg-state-destructive-hover",onClick:c,children:(0,F.jsx)(Y.RiDeleteBinLine,{className:"h-4 w-4 text-text-tertiary group-hover:text-text-destructive"})})]})]})});var kF=a.i(589905),kG=a.i(138464);let kH="nodes.parameterExtractor",kI="errorMsg",kJ={name:"",type:cI.string,description:"",required:!1},kK=[cI.string,cI.number,cI.bool,cI.arrayString,cI.arrayNumber,cI.arrayObject,cI.arrayBool],kL=K.memo(({type:a,payload:b,onSave:c,onCancel:d})=>{let{t:e}=(0,$.useTranslation)(),f="add"===a,[g,h]=(0,K.useState)(f?kJ:b),[i,j]=(0,K.useState)(void 0),k=(0,K.useCallback)(a=>b=>{if("name"===a){let{isValid:a,errorKey:c,errorMessageKey:d}=(0,by.checkKeys)([b],!0);if(!a)return void aX.default.notify({type:"error",message:e(`varKeyError.${d}`,{ns:"appDebug",key:c})})}j("name"===a?{type:aC.ChangeType.changeVarName,payload:{beforeKey:g.name,afterKey:b}}:void 0),h(c=>({...c,[a]:b}))},[g.name,e]),[l,{setTrue:m,setFalse:n}]=(0,a8.useBoolean)(!f),o=(0,K.useCallback)(()=>{n(),d?.()},[d,n]),p=(0,K.useCallback)(()=>{f&&h(kJ),m()},[f,m]),q=(0,K.useCallback)(()=>{let a="";return g.name||(a=e(`${kI}.fieldRequired`,{ns:"workflow",field:e(`${kH}.addExtractParameterContent.name`,{ns:"workflow"})})),a||g.type!==cI.select||g.options&&0!==g.options.length||(a=e(`${kI}.fieldRequired`,{ns:"workflow",field:e("variableConfig.options",{ns:"appDebug"})})),a||g.description||(a=e(`${kI}.fieldRequired`,{ns:"workflow",field:e(`${kH}.addExtractParameterContent.description`,{ns:"workflow"})})),!a||(aX.default.notify({type:"error",message:a}),!1)},[g,e]),r=(0,K.useCallback)(()=>{q()&&(c(g,i),o())},[q,c,g,o,i]);return(0,F.jsxs)("div",{children:[f&&(0,F.jsx)(aY.default,{className:"mx-1",onClick:p}),l&&(0,F.jsx)(hq.default,{title:e(`${kH}.addExtractParameter`,{ns:"workflow"}),isShow:!0,onClose:o,className:"!w-[400px] !max-w-[400px] !p-4",children:(0,F.jsxs)("div",{children:[(0,F.jsxs)("div",{className:"space-y-2",children:[(0,F.jsx)(kF.default,{title:e(`${kH}.addExtractParameterContent.name`,{ns:"workflow"}),children:(0,F.jsx)(a2.default,{value:g.name,onChange:a=>k("name")(a.target.value),placeholder:e(`${kH}.addExtractParameterContent.namePlaceholder`,{ns:"workflow"})})}),(0,F.jsx)(kF.default,{title:e(`${kH}.addExtractParameterContent.type`,{ns:"workflow"}),children:(0,F.jsx)(a4.default,{defaultValue:g.type,allowSearch:!1,onSelect:a=>k("type")(a.value),optionClassName:"capitalize",items:kK.map(a=>({value:a,name:a}))})}),g.type===cI.select&&(0,F.jsx)(kF.default,{title:e("variableConfig.options",{ns:"appDebug"}),children:(0,F.jsx)(kG.default,{options:g.options||[],onChange:k("options")})}),(0,F.jsx)(kF.default,{title:e(`${kH}.addExtractParameterContent.description`,{ns:"workflow"}),children:(0,F.jsx)(a5.default,{value:g.description,onChange:a=>k("description")(a.target.value),placeholder:e(`${kH}.addExtractParameterContent.descriptionPlaceholder`,{ns:"workflow"})})}),(0,F.jsx)(kF.default,{title:e(`${kH}.addExtractParameterContent.required`,{ns:"workflow"}),children:(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)("div",{className:"mb-1.5 text-xs font-normal leading-[18px] text-text-tertiary",children:e(`${kH}.addExtractParameterContent.requiredContent`,{ns:"workflow"})}),(0,F.jsx)(d4.default,{size:"l",defaultValue:g.required,onChange:k("required")})]})})]}),(0,F.jsxs)("div",{className:"mt-4 flex justify-end space-x-2",children:[(0,F.jsx)(av.default,{className:"!w-[95px]",onClick:o,children:e("operation.cancel",{ns:"common"})}),(0,F.jsx)(av.default,{className:"!w-[95px]",variant:"primary",onClick:r,children:f?e("operation.add",{ns:"common"}):e("operation.save",{ns:"common"})})]})]})})]})}),kM=K.memo(({list:a,onChange:b})=>{let{t:c}=(0,$.useTranslation)(),[d,{setTrue:e,setFalse:f}]=(0,a8.useBoolean)(!1),g=(0,K.useCallback)(c=>(d,e)=>{b(a.map((a,b)=>b===c?d:a),e),f()},[f,a,b]),[h,i]=(0,K.useState)(-1),j=(0,K.useCallback)(a=>()=>{i(a),e()},[e]),k=(0,K.useCallback)(c=>()=>{b(a.filter((a,b)=>b!==c))},[a,b]);return 0===a.length?(0,F.jsx)(gz,{children:c("nodes.parameterExtractor.extractParametersNotSet",{ns:"workflow"})}):(0,F.jsxs)("div",{className:"space-y-1",children:[a.map((a,b)=>(0,F.jsx)(kE,{payload:a,onDelete:k(b),onEdit:j(b)},b)),d&&(0,F.jsx)(kL,{type:"edit",payload:a[h],onSave:g(h),onCancel:f})]})}),kN="nodes.parameterExtractor",kO=K.memo(({type:a,onChange:b})=>{let{t:c}=(0,$.useTranslation)(),d=(0,K.useCallback)(a=>()=>{b(a)},[b]);return(0,F.jsx)(fW,{title:c(`${kN}.reasoningMode`,{ns:"workflow"}),tooltip:c(`${kN}.reasoningModeTip`,{ns:"workflow"}),children:(0,F.jsxs)("div",{className:"grid grid-cols-2 gap-x-1",children:[(0,F.jsx)(gB.default,{title:"Function/Tool Calling",onSelect:d(cJ.functionCall),selected:a===cJ.functionCall}),(0,F.jsx)(gB.default,{title:"Prompt",selected:a===cJ.prompt,onSelect:d(cJ.prompt)})]})})});var kP=a.i(685895);let kQ="nodes.parameterExtractor",kR=K.memo(({id:a,data:b})=>{let{t:c}=(0,$.useTranslation)(),{readOnly:d,inputs:e,handleInputVarChange:f,filterVar:g,isChatModel:h,isChatMode:i,isCompletionModel:j,handleModelChanged:k,handleImportFromTool:l,handleCompletionParamsChange:m,addExtractParameter:n,handleExactParamsChange:o,handleInstructionChange:p,hasSetBlockStatus:q,handleMemoryChange:r,isSupportFunctionCall:s,handleReasoningModeChange:t,availableVars:u,availableNodesWithParent:v,isVisionModel:w,handleVisionResolutionChange:x,handleVisionResolutionEnabledChange:y}=((a,b)=>{let{deleteNodeInspectorVars:c,renameInspectVarName:d}=(0,at.default)(),{nodesReadOnly:e}=(0,aq.useNodesReadOnly)(),{handleOutVarRenameChange:f}=(0,aq.useWorkflow)(),g=(0,aq.useIsChatMode)(),h=(0,aP.useStore)(a=>a.nodesDefaultConfigs)?.[b.type],[i,j]=(0,K.useState)({user:"",assistant:""}),{inputs:k,setInputs:l}=eA(a,b),m=(0,K.useRef)(k),n=(0,K.useCallback)(a=>{if(a.memory&&!a.memory.role_prefix){let b=(0,I.produce)(a,a=>{a.memory.role_prefix=i});l(b),m.current=b;return}l(a),m.current=a},[l,i]),o=(0,K.useCallback)(a=>[aC.VarType.string].includes(a.type),[]),p=(0,K.useCallback)(a=>{n((0,I.produce)(k,b=>{b.query=a||[]}))},[k,n]),q=(0,K.useCallback)((b,e)=>{n((0,I.produce)(k,a=>{a.parameters=b})),e&&e?.type===aC.ChangeType.changeVarName&&e.payload?(f(a,[a,e.payload.beforeKey],[a,e.payload.afterKey]),d(a,e.payload.beforeKey,e.payload.afterKey)):c(a)},[c,f,a,k,d,n]),r=(0,K.useCallback)(b=>{n((0,I.produce)(k,a=>{a.parameters||(a.parameters=[]),a.parameters.push(b)})),c(a)},[c,a,k,n]),s=k.model||{provider:"",name:"",mode:aI.AppModeEnum.CHAT,completion_params:{temperature:.7}},t=k.model?.mode===aI.AppModeEnum.CHAT,u=!t,{isVisionModel:v,handleVisionResolutionEnabledChange:w,handleVisionResolutionChange:x,handleModelChanged:y}=eM(s,{payload:k.vision,onChange:a=>{n((0,I.produce)(k,b=>{b.vision=a}))}}),z=(0,K.useCallback)((a,b,c)=>{let d=b.prompt_templates;t||j({user:d.completion_model.conversation_histories_role.user_prefix,assistant:d.completion_model.conversation_histories_role.assistant_prefix})},[t]),[A,B]=(0,K.useState)(!1),{currentProvider:C,currentModel:D}=(0,ae.useModelListAndDefaultModelAndCurrentProviderAndModel)(b$.ModelTypeEnum.textGeneration),E=(0,K.useCallback)(a=>{n((0,I.produce)(m.current,b=>{b.model.provider=a.provider,b.model.name=a.modelId,b.model.mode=a.mode,a.mode!==m.current.model?.mode&&h&&Object.keys(h).length>0&&z(b,h,a.mode===aI.AppModeEnum.CHAT)})),B(!0)},[n,h,z]);(0,K.useEffect)(()=>{C?.provider&&D?.model&&!s.provider&&E({provider:C?.provider,modelId:D?.model,mode:D?.model_properties?.mode})},[s?.provider,C,D,E]),(0,K.useEffect)(()=>{A&&(B(!1),y())},[v,A]);let{currentModel:F}=(0,ae.useTextGenerationCurrentProviderAndModelAndModelList)({provider:s.provider,model:s.name}),G=(0,kP.supportFunctionCall)(F?.features),H=(0,K.useCallback)(a=>[aC.VarType.number,aC.VarType.string].includes(a.type),[]),{availableVars:J,availableNodesWithParent:L}=(0,eD.default)(a,{onlyLeafNodeVar:!1,filterVar:H}),M=(0,K.useCallback)(a=>{n((0,I.produce)(k,b=>{b.model.completion_params=a}))},[k,n]),N=(0,K.useCallback)(a=>{n((0,I.produce)(k,b=>{b.instruction=a}))},[k,n]),O={history:!1,query:!!g&&(0,a3.checkHasQueryBlock)(k.instruction),context:!1},P=(0,K.useCallback)(a=>{n((0,I.produce)(k,b=>{b.memory=a}))},[k,n]),Q=(0,K.useCallback)(a=>{n((0,I.produce)(k,b=>{b.reasoning_mode=a}))},[k,n]),R=(0,K.useCallback)(a=>{n((0,I.produce)(k,b=>{b.parameters=a}))},[k,n]);return{readOnly:e,handleInputVarChange:p,filterVar:o,isChatMode:g,inputs:k,isChatModel:t,isCompletionModel:u,handleModelChanged:E,handleCompletionParamsChange:M,handleImportFromTool:R,handleExactParamsChange:q,addExtractParameter:r,handleInstructionChange:N,hasSetBlockStatus:O,availableVars:J,availableNodesWithParent:L,isSupportFunctionCall:G,handleReasoningModeChange:Q,handleMemoryChange:P,isVisionModel:v,handleVisionResolutionEnabledChange:w,handleVisionResolutionChange:x}})(a,b),z=e.model;return(0,F.jsxs)("div",{className:"pt-2",children:[(0,F.jsxs)("div",{className:"space-y-4 px-4",children:[(0,F.jsx)(fW,{title:c("common.model",{ns:"workflow"}),required:!0,children:(0,F.jsx)(jq.default,{popupClassName:"!w-[387px]",isInWorkflow:!0,isAdvancedMode:!0,provider:z?.provider,completionParams:z?.completion_params,modelId:z?.name,setModel:k,onCompletionParamsChange:m,hideDebugWithMultipleModel:!0,debugWithMultipleModel:!1,readonly:d})}),(0,F.jsx)(fW,{title:c(`${kQ}.inputVar`,{ns:"workflow"}),required:!0,children:(0,F.jsx)(F.Fragment,{children:(0,F.jsx)(gA.default,{readonly:d,nodeId:a,isShowNodeName:!0,value:e.query||[],onChange:f,filterVar:g})})}),(0,F.jsx)(au,{}),(0,F.jsx)(jv,{nodeId:a,readOnly:d,isVisionModel:w,enabled:e.vision?.enabled,onEnabledChange:y,config:e.vision?.configs,onConfigChange:x}),(0,F.jsx)(fW,{title:c(`${kQ}.extractParameters`,{ns:"workflow"}),required:!0,operations:d?void 0:(0,F.jsxs)("div",{className:"flex items-center space-x-1",children:[!d&&(0,F.jsx)(kD,{onImport:l}),!d&&(0,F.jsx)("div",{className:"h-3 w-px bg-divider-regular"}),(0,F.jsx)(kL,{type:"add",onSave:n})]}),children:(0,F.jsx)(kM,{readonly:d,list:e.parameters||[],onChange:o})}),(0,F.jsx)(f9,{title:(0,F.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,F.jsx)("span",{className:"uppercase",children:c(`${kQ}.instruction`,{ns:"workflow"})}),(0,F.jsx)(ac.default,{popupContent:(0,F.jsx)("div",{className:"w-[120px]",children:c(`${kQ}.instructionTip`,{ns:"workflow"})}),triggerClassName:"w-3.5 h-3.5 ml-0.5"})]}),value:e.instruction,onChange:p,readOnly:d,isChatModel:h,isChatApp:i,isShowContext:!1,hasSetBlockStatus:q,nodesOutputVars:u,availableNodes:v})]}),(0,F.jsx)(gg.default,{title:c(`${kQ}.advancedSetting`,{ns:"workflow"}),children:(0,F.jsxs)(F.Fragment,{children:[i&&(0,F.jsx)("div",{className:"mt-4",children:(0,F.jsx)(gf,{readonly:d,config:{data:e.memory},onChange:r,canSetRoleName:j})}),s&&(0,F.jsx)("div",{className:"mt-2",children:(0,F.jsx)(kO,{type:e.reasoning_mode,onChange:t})})]})}),e.parameters?.length>0&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(au,{}),(0,F.jsx)("div",{children:(0,F.jsx)(gj,{children:(0,F.jsxs)(F.Fragment,{children:[e.parameters.map((a,b)=>(0,F.jsx)(gi,{name:a.name,type:a.type,description:a.description},b)),(0,F.jsx)(gi,{name:"__is_success",type:aC.VarType.number,description:c(`${kQ}.outputVars.isSuccess`,{ns:"workflow"})}),(0,F.jsx)(gi,{name:"__reason",type:aC.VarType.string,description:c(`${kQ}.outputVars.errorReason`,{ns:"workflow"})}),(0,F.jsx)(gi,{name:"__usage",type:"object",description:c(`${kQ}.outputVars.usage`,{ns:"workflow"})})]})})})]})]})}),kS=({topic:a,index:b,nodeId:c,t:d})=>{let e=a.name.length>50?`${a.name.slice(0,50)}...`:a.name,f=a.name.length>50,g=(0,F.jsx)("div",{className:"system-xs-regular truncate text-text-tertiary",children:(0,F.jsx)(gs,{value:e,nodeId:c,className:"truncate"})});return(0,F.jsxs)("div",{className:"flex flex-col gap-y-0.5 rounded-md bg-workflow-block-parma-bg px-[5px] py-[3px]",children:[(0,F.jsx)("div",{className:"system-2xs-semibold-uppercase uppercase text-text-secondary",children:`${d("nodes.questionClassifiers.class",{ns:"workflow"})} ${b+1}`}),f?(0,F.jsx)(ac.default,{popupContent:(0,F.jsx)("div",{className:"max-w-[300px] break-words",children:(0,F.jsx)(gs,{value:a.name,nodeId:c})}),children:g}):g]})},kT=K.memo(a=>{let{t:b}=(0,$.useTranslation)(),{data:c,id:d}=a,{provider:e,name:f}=c.model,g=c.classes,{textGenerationModelList:h}=(0,ae.useTextGenerationCurrentProviderAndModelAndModelList)(),i=e&&f;return i||g.length?(0,F.jsxs)("div",{className:"mb-1 px-3 py-1",children:[i&&(0,F.jsx)(fz.default,{defaultModel:{provider:e,model:f},triggerClassName:"!h-6 !rounded-md",modelList:h,readonly:!0}),!!g.length&&(0,F.jsx)("div",{className:"mt-2 space-y-0.5",children:(0,F.jsx)("div",{className:"space-y-0.5",children:g.map((c,e)=>(0,F.jsxs)("div",{className:"relative",children:[(0,F.jsx)(kS,{topic:c,index:e,nodeId:d,t:b}),(0,F.jsx)(fg,{...a,handleId:c.id,handleClassName:"!top-1/2 !-translate-y-1/2 !-right-[21px]"})]},c.id))})})]}):null});var gg=gg;let kU="nodes.questionClassifiers",kV=K.memo(({instruction:a,onInstructionChange:b,hideMemorySetting:c,memory:d,onMemoryChange:e,readonly:f,isChatModel:g,isChatApp:h,hasSetBlockStatus:i,nodesOutputVars:j,availableNodes:k})=>{let{t:l}=(0,$.useTranslation)();return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(f9,{title:(0,F.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,F.jsx)("span",{className:"uppercase",children:l(`${kU}.instruction`,{ns:"workflow"})}),(0,F.jsx)(ac.default,{popupContent:(0,F.jsx)("div",{className:"w-[120px]",children:l(`${kU}.instructionTip`,{ns:"workflow"})}),triggerClassName:"w-3.5 h-3.5 ml-0.5"})]}),value:a,onChange:b,readOnly:f,isChatModel:g,isChatApp:h,isShowContext:!1,hasSetBlockStatus:i,nodesOutputVars:j,availableNodes:k}),!c&&(0,F.jsx)(gf,{className:"mt-4",readonly:!1,config:{data:d},onChange:e,canSetRoleName:!1})]})});var kW=ds;let kX="nodes.questionClassifiers",kY=K.memo(({className:a,headerClassName:b,nodeId:c,payload:d,onChange:e,onRemove:f,index:g,readonly:h,filterVar:i})=>{let{t:j}=(0,$.useTranslation)(),[k,l]=(0,K.useState)(()=>hy());(0,K.useEffect)(()=>{l(`${c}-${hy()}`)},[c]);let m=(0,K.useCallback)(a=>{e({...d,name:a})},[e,d]),{availableVars:n,availableNodesWithParent:o}=(0,eD.default)(c,{onlyLeafNodeVar:!1,hideChatVar:!1,hideEnv:!1,filterVar:i});return(0,F.jsx)(f9,{className:a,headerClassName:b,title:`${j(`${kX}.class`,{ns:"workflow"})} ${g}`,placeholder:j(`${kX}.topicPlaceholder`,{ns:"workflow"}),value:d.name,onChange:m,showRemove:!0,onRemove:f,nodesOutputVars:n,availableNodes:o,readOnly:h,instanceId:k,justVar:!0,isSupportFileVar:!0})}),kZ="nodes.questionClassifiers",k$=K.memo(({nodeId:a,list:b,onChange:c,readonly:d,filterVar:e,handleSortTopic:f=kW.noop})=>{let{t:g}=(0,$.useTranslation)(),{handleEdgeDeleteByDeleteBranch:h}=(0,bm.useEdgesInteractions)(),i=(0,K.useRef)(null),[j,k]=(0,K.useState)(!1),l=(0,K.useRef)(b.length),[m,n]=(0,K.useState)(!1),o=(0,K.useCallback)(a=>d=>{c((0,I.produce)(b,b=>{b[a]=d}))},[b,c]),p=(0,K.useCallback)(()=>{c((0,I.produce)(b,a=>{a.push({id:`${Date.now()}`,name:""})})),k(!0),m&&n(!1)},[b,c,m]),q=(0,K.useCallback)(d=>()=>{h(a,b[d].id),c((0,I.produce)(b,a=>{a.splice(d,1)}))},[b,c,h,a]),r=b.length;(0,K.useEffect)(()=>{j&&b.length>l.current&&k(!1),l.current=b.length},[b.length,j]);let s=(0,K.useCallback)(()=>{n(!m)},[m]);return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)("div",{className:"mb-2 flex items-center justify-between",onClick:s,children:(0,F.jsxs)("div",{className:"flex cursor-pointer items-center text-xs font-semibold uppercase text-text-secondary",children:[g(`${kZ}.class`,{ns:"workflow"})," ",(0,F.jsx)("span",{className:"text-text-destructive",children:"*"}),b.length>0&&(0,F.jsx)(g3.ArrowDownRoundFill,{className:(0,S.cn)("h-4 w-4 text-text-quaternary transition-transform duration-200",m&&"-rotate-90")})]})}),!m&&(0,F.jsx)("div",{ref:i,className:(0,S.cn)("overflow-y-visible","pl-3"),children:(0,F.jsx)(gQ.ReactSortable,{list:b.map(a=>({...a})),setList:f,handle:".handle",ghostClass:"bg-components-panel-bg",animation:150,disabled:d,className:"space-y-2",children:b.map((c,f)=>{let g=!d&&r>=2;return(0,F.jsx)("div",{className:(0,S.cn)("group relative rounded-[10px] bg-components-panel-bg","-ml-3 min-h-[40px] px-0 py-0"),style:{contain:"layout style paint"},children:(0,F.jsxs)("div",{children:[g&&(0,F.jsx)(Y.RiDraggable,{className:(0,S.cn)("handle absolute left-2 top-3 hidden h-3 w-3 cursor-pointer text-text-tertiary","group-hover:block")}),(0,F.jsx)(kY,{className:(0,S.cn)(g&&"handle"),headerClassName:(0,S.cn)(g&&"cursor-grab group-hover:pl-5"),nodeId:a,payload:c,onChange:o(f),onRemove:q(f),index:f+1,readonly:d,filterVar:e},b[f].id)]})},c.id)})})}),!d&&!m&&(0,F.jsx)("div",{className:"mt-2",children:(0,F.jsx)(jx,{onClick:p,text:g(`${kZ}.addClass`,{ns:"workflow"})})})]})}),k_="nodes.questionClassifiers",k0=K.memo(({id:a,data:b})=>{let{t:c}=(0,$.useTranslation)(),{readOnly:d,inputs:e,handleModelChanged:f,isChatMode:g,isChatModel:h,handleCompletionParamsChange:i,handleQueryVarChange:j,handleTopicsChange:k,hasSetBlockStatus:l,availableVars:m,availableNodesWithParent:n,handleInstructionChange:o,handleMemoryChange:p,isVisionModel:q,handleVisionResolutionChange:r,handleVisionResolutionEnabledChange:s,filterVar:t,handleSortTopic:u}=((a,b)=>{let c=(0,N.useUpdateNodeInternals)(),{nodesReadOnly:d}=(0,aq.useNodesReadOnly)(),e=(0,aq.useIsChatMode)(),f=(0,aP.useStore)(a=>a.nodesDefaultConfigs)?.[b.type],{getBeforeNodesInSameBranch:g}=(0,aq.useWorkflow)(),h=g(a).find(a=>a.data.type===aC.BlockEnum.Start),i=h?.id,{inputs:j,setInputs:k}=eA(a,b),l=(0,K.useRef)(j);(0,K.useEffect)(()=>{l.current=j},[j]);let[m,n]=(0,K.useState)(!1),{currentProvider:o,currentModel:p}=(0,ae.useModelListAndDefaultModelAndCurrentProviderAndModel)(b$.ModelTypeEnum.textGeneration),q=j.model,r=j.model?.mode===aI.AppModeEnum.CHAT,{isVisionModel:s,handleVisionResolutionEnabledChange:t,handleVisionResolutionChange:u,handleModelChanged:v}=eM(q,{payload:j.vision,onChange:a=>{k((0,I.produce)(j,b=>{b.vision=a}))}}),w=(0,K.useCallback)(a=>{k((0,I.produce)(l.current,b=>{b.model.provider=a.provider,b.model.name=a.modelId,b.model.mode=a.mode})),n(!0)},[k]);(0,K.useEffect)(()=>{o?.provider&&p?.model&&!q.provider&&w({provider:o?.provider,modelId:p?.model,mode:p?.model_properties?.mode})},[q.provider,o,p,w]);let x=(0,K.useCallback)(a=>{k((0,I.produce)(j,b=>{b.model.completion_params=a}))},[j,k]);(0,K.useEffect)(()=>{m&&(n(!1),v())},[s,m]);let y=(0,K.useCallback)(a=>{k((0,I.produce)(j,b=>{b.query_variable_selector=a}))},[j,k]);(0,K.useEffect)(()=>{if(f&&Object.keys(f).length>0){let a=[];e&&0===j.query_variable_selector.length&&i&&(a=[i,"sys.query"]),k({...j,...f,query_variable_selector:j.query_variable_selector.length>0?j.query_variable_selector:a})}},[f]);let z=(0,K.useCallback)(a=>{k((0,I.produce)(j,b=>{b.classes=a,b._targetBranches=a}))},[j,k]),A=(0,K.useCallback)(a=>[aC.VarType.number,aC.VarType.string].includes(a.type),[]),B=(0,K.useCallback)(a=>[aC.VarType.file,aC.VarType.arrayFile].includes(a.type),[]),{availableVars:C,availableNodesWithParent:D}=(0,eD.default)(a,{onlyLeafNodeVar:!1,filterVar:A}),{availableVars:E}=(0,eD.default)(a,{onlyLeafNodeVar:!1,filterVar:B}),F={history:!1,query:!!e&&(0,a3.checkHasQueryBlock)(j.instruction),context:!1},G=(0,K.useCallback)(a=>{k((0,I.produce)(j,b=>{b.instruction=a}))},[j,k]),H=(0,K.useCallback)(a=>{k((0,I.produce)(j,b=>{b.memory=a}))},[j,k]),J=(0,K.useCallback)(a=>a.type===aC.VarType.string,[]),L=(0,K.useCallback)(b=>{k((0,I.produce)(j,a=>{a.classes=b.filter(Boolean).map(a=>({id:a.id,name:a.name}))})),c(a)},[a,j,k,c]);return{readOnly:d,inputs:j,handleModelChanged:w,isChatMode:e,isChatModel:r,handleCompletionParamsChange:x,handleQueryVarChange:y,filterVar:J,handleTopicsChange:z,hasSetBlockStatus:F,availableVars:C,availableNodesWithParent:D,availableVisionVars:E,handleInstructionChange:G,handleMemoryChange:H,isVisionModel:s,handleVisionResolutionEnabledChange:t,handleVisionResolutionChange:u,handleSortTopic:L}})(a,b),v=e.model;return(0,F.jsxs)("div",{className:"pt-2",children:[(0,F.jsxs)("div",{className:"space-y-4 px-4",children:[(0,F.jsx)(fW,{title:c(`${k_}.model`,{ns:"workflow"}),required:!0,children:(0,F.jsx)(jq.default,{popupClassName:"!w-[387px]",isInWorkflow:!0,isAdvancedMode:!0,provider:v?.provider,completionParams:v.completion_params,modelId:v.name,setModel:f,onCompletionParamsChange:i,hideDebugWithMultipleModel:!0,debugWithMultipleModel:!1,readonly:d})}),(0,F.jsx)(fW,{title:c(`${k_}.inputVars`,{ns:"workflow"}),required:!0,children:(0,F.jsx)(gA.default,{readonly:d,isShowNodeName:!0,nodeId:a,value:e.query_variable_selector,onChange:j,filterVar:t})}),(0,F.jsx)(au,{}),(0,F.jsx)(jv,{nodeId:a,readOnly:d,isVisionModel:q,enabled:e.vision?.enabled,onEnabledChange:s,config:e.vision?.configs,onConfigChange:r}),(0,F.jsx)(k$,{nodeId:a,list:e.classes,onChange:k,readonly:d,filterVar:t,handleSortTopic:u}),(0,F.jsx)(au,{})]}),(0,F.jsx)(gg.default,{title:c(`${k_}.advancedSetting`,{ns:"workflow"}),children:(0,F.jsx)(kV,{hideMemorySetting:!g,instruction:e.instruction,onInstructionChange:o,memory:e.memory,onMemoryChange:p,readonly:d,isChatApp:g,isChatModel:h,hasSetBlockStatus:l,nodesOutputVars:m,availableNodes:n})}),(0,F.jsx)(au,{}),(0,F.jsx)("div",{children:(0,F.jsx)(gj,{children:(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(gi,{name:"class_name",type:"string",description:c(`${k_}.outputVars.className`,{ns:"workflow"})}),(0,F.jsx)(gi,{name:"usage",type:"object",description:c(`${k_}.outputVars.usage`,{ns:"workflow"})})]})})})]})});var k1=a.i(492010);let k2=K.memo(({data:a})=>{let{t:b}=(0,$.useTranslation)(),{variables:c}=a;return c.length?(0,F.jsx)("div",{className:"mb-1 px-3 py-1",children:(0,F.jsx)("div",{className:"space-y-0.5",children:c.map(a=>(0,F.jsxs)("div",{className:"flex h-6 items-center justify-between space-x-1 rounded-md  bg-workflow-block-parma-bg px-1",children:[(0,F.jsxs)("div",{className:"flex w-0 grow items-center space-x-1",children:[(0,F.jsx)(a0.Variable02,{className:"h-3.5 w-3.5 shrink-0 text-text-accent"}),(0,F.jsx)("span",{className:"system-xs-regular w-0 grow truncate text-text-secondary",children:a.variable})]}),(0,F.jsxs)("div",{className:"ml-1 flex items-center space-x-1",children:[a.required&&(0,F.jsx)("span",{className:"system-2xs-regular-uppercase text-text-tertiary",children:b("nodes.start.required",{ns:"workflow"})}),(0,F.jsx)(k1.default,{type:a.type,className:"h-3 w-3 text-text-tertiary"})]})]},a.variable))})}):null});var k3=a.i(414622),k4=a.i(292458),k5=ds,k6=a.i(382474),k6=k6;let k7=K.memo(({className:a,readonly:b,payload:c,onChange:d=()=>!0,onRemove:e=k5.noop,rightContent:f,varKeys:g=[],showLegacyBadge:h=!1,canDrag:i})=>{let{t:j}=(0,$.useTranslation)(),k=(0,K.useRef)(null),l=(0,k4.useHover)(k),[m,{setTrue:n,setFalse:o}]=(0,a8.useBoolean)(!1),p=(0,K.useCallback)((a,b)=>{d(a,b)&&o()},[d,o]);return(0,F.jsxs)("div",{ref:k,className:(0,S.cn)("flex h-8 cursor-pointer items-center justify-between rounded-lg border border-components-panel-border-subtle bg-components-panel-on-panel-item-bg px-2.5 shadow-xs hover:shadow-md",a),children:[(0,F.jsxs)("div",{className:"flex w-0 grow items-center space-x-1",children:[(0,F.jsx)(a0.Variable02,{className:(0,S.cn)("h-3.5 w-3.5 text-text-accent",i&&"group-hover:opacity-0")}),(0,F.jsx)("div",{title:c.variable,className:"max-w-[130px] shrink-0 truncate text-[13px] font-medium text-text-secondary",children:c.variable}),c.label&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)("div",{className:"shrink-0 text-xs font-medium text-text-quaternary",children:"·"}),(0,F.jsx)("div",{title:c.label,className:"max-w-[130px] truncate text-[13px] font-medium text-text-tertiary",children:c.label})]}),h&&(0,F.jsx)(dM.default,{text:"LEGACY",className:"shrink-0 border-text-accent-secondary text-text-accent-secondary"})]}),(0,F.jsx)("div",{className:"ml-2 flex shrink-0 items-center",children:f||(0,F.jsx)(F.Fragment,{children:!l||b?(0,F.jsxs)(F.Fragment,{children:[c.required&&(0,F.jsx)("div",{className:"mr-2 text-xs font-normal text-text-tertiary",children:j("nodes.start.required",{ns:"workflow"})}),(0,F.jsx)(k1.default,{type:c.type,className:"h-3.5 w-3.5 text-text-tertiary"})]}):!b&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)("div",{onClick:n,className:"mr-1 cursor-pointer rounded-md p-1 hover:bg-state-base-hover",children:(0,F.jsx)(k6.default,{className:"h-4 w-4 text-text-tertiary"})}),(0,F.jsx)("div",{onClick:e,className:"group cursor-pointer rounded-md p-1 hover:bg-state-destructive-hover",children:(0,F.jsx)(Y.RiDeleteBinLine,{className:"h-4 w-4 text-text-tertiary group-hover:text-text-destructive"})})]})})}),m&&(0,F.jsx)(k3.default,{isShow:!0,supportFile:!0,payload:c,onClose:o,onConfirm:p,varKeys:g})]})}),k8=K.memo(({readonly:a,list:b,onChange:c})=>{let{t:d}=(0,$.useTranslation)(),e=(0,K.useCallback)(a=>(e,f)=>{let g=(0,I.produce)(b,b=>{b[a]=e}),h="",i="";return((0,by.hasDuplicateStr)(g.map(a=>a.variable))?(h="varKeyError.keyAlreadyExists",i="variableConfig.varName"):(0,by.hasDuplicateStr)(g.map(a=>a.label))&&(h="varKeyError.keyAlreadyExists",i="variableConfig.labelName"),h&&i)?(aX.default.notify({type:"error",message:d(h,{ns:"appDebug",key:d(i,{ns:"appDebug"})})}),!1):(c(g,f?{index:a,payload:f}:void 0),!0)},[b,c]),f=(0,K.useCallback)(a=>()=>{c((0,I.produce)(b,b=>{b.splice(a,1)}),{index:a,payload:{type:aC.ChangeType.remove,payload:{beforeKey:b[a].variable}}})},[b,c]),g=(0,K.useMemo)(()=>b.map(a=>({id:a.variable,variable:{...a}})),[b]),h=b.length;if(0===b.length)return(0,F.jsx)("div",{className:"flex h-[42px] items-center justify-center rounded-md bg-components-panel-bg text-xs font-normal leading-[18px] text-text-tertiary",children:d("nodes.start.noVarTip",{ns:"workflow"})});let i=!a&&h>1;return(0,F.jsx)(gQ.ReactSortable,{className:"space-y-1",list:g,setList:a=>{c(a.map(a=>a.variable))},handle:".handle",ghostClass:"opacity-50",animation:150,children:g.map((c,d)=>(0,F.jsxs)("div",{className:"group relative",children:[(0,F.jsx)(k7,{className:(0,S.cn)(i&&"handle"),readonly:a,payload:c.variable,onChange:e(d),onRemove:f(d),varKeys:b.map(a=>a.variable),canDrag:i}),i&&(0,F.jsx)(Y.RiDraggable,{className:(0,S.cn)("handle absolute left-3 top-2.5 hidden h-3 w-3 cursor-pointer text-text-tertiary","group-hover:block")})]},c.id))})}),k9=K.memo(({id:a,data:b})=>{let{t:c}=(0,$.useTranslation)(),{readOnly:d,isChatMode:e,inputs:f,isShowAddVarModal:g,showAddVarModal:h,handleAddVariable:i,hideAddVarModal:j,handleVarListChange:k,isShowRemoveVarConfirm:l,hideRemoveVarConfirm:m,onRemoveVarConfirm:n}=((a,b)=>{let{t:c}=(0,$.useTranslation)(),{nodesReadOnly:d}=(0,aq.useNodesReadOnly)(),{handleOutVarRenameChange:e,isVarUsedInNodes:f,removeUsedVarInNodes:g}=(0,aq.useWorkflow)(),h=(0,aq.useIsChatMode)(),{inputs:i,setInputs:j}=eA(a,b),{deleteNodeInspectorVars:k,renameInspectVarName:l,nodesWithInspectVars:m,deleteInspectVar:n}=(0,at.default)(),[o,{setTrue:p,setFalse:q}]=(0,a8.useBoolean)(!1),[r,{setTrue:s,setFalse:t}]=(0,a8.useBoolean)(!1),[u,v]=(0,K.useState)([]),[w,x]=(0,K.useState)(0),y=(0,K.useCallback)((b,c)=>{if(c?.payload?.type===aC.ChangeType.remove){let b=m.find(b=>b.nodeId===a)?.vars.find(a=>a.name===c?.payload?.payload?.beforeKey)?.id;if(b&&n(a,b),f([a,c?.payload?.payload?.beforeKey||""])){s(),v([a,c?.payload?.payload?.beforeKey||""]),x(c?.index);return}}if(j((0,I.produce)(i,a=>{a.variables=b})),c?.payload?.type===aC.ChangeType.changeVarName){let d=b[c.index];e(a,[a,i.variables[c.index].variable],[a,d.variable]),l(a,i.variables[c.index].variable,d.variable)}else c?.payload?.type!==aC.ChangeType.remove&&k(a)},[n,k,e,a,i,f,m,l,j,s]),z=(0,K.useCallback)(()=>{j((0,I.produce)(i,a=>{a.variables.splice(w,1)})),g(u),t()},[t,i,g,w,u,j]),A=(0,K.useCallback)(a=>{let b=(0,I.produce)(i,b=>{b.variables.push(a)}),d=b.variables,e="",f="";return((0,by.hasDuplicateStr)(d.map(a=>a.variable))?(e="varKeyError.keyAlreadyExists",f="variableConfig.varName"):(0,by.hasDuplicateStr)(d.map(a=>a.label))&&(e="varKeyError.keyAlreadyExists",f="variableConfig.labelName"),e&&f)?(aX.default.notify({type:"error",message:c(e,{ns:"appDebug",key:c(f,{ns:"appDebug"})})}),!1):(j(b),!0)},[i,j]);return{readOnly:d,isChatMode:h,inputs:i,isShowAddVarModal:o,showAddVarModal:p,hideAddVarModal:q,handleVarListChange:y,handleAddVariable:A,isShowRemoveVarConfirm:r,hideRemoveVarConfirm:t,onRemoveVarConfirm:z}})(a,b);return(0,F.jsxs)("div",{className:"mt-2",children:[(0,F.jsx)("div",{className:"space-y-4 px-4 pb-2",children:(0,F.jsx)(fW,{title:c("nodes.start.inputField",{ns:"workflow"}),operations:d?void 0:(0,F.jsx)(aY.default,{onClick:h}),children:(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(k8,{readonly:d,list:f.variables||[],onChange:k}),(0,F.jsxs)("div",{className:"mt-1 space-y-1",children:[(0,F.jsx)(au,{className:"my-2"}),e&&(0,F.jsx)(k7,{readonly:!0,payload:{variable:"userinput.query"},rightContent:(0,F.jsx)("div",{className:"text-xs font-normal text-text-tertiary",children:"String"})}),(0,F.jsx)(k7,{readonly:!0,showLegacyBadge:!e,payload:{variable:"userinput.files"},rightContent:(0,F.jsx)("div",{className:"text-xs font-normal text-text-tertiary",children:"Array[File]"})})]})]})})}),g&&(0,F.jsx)(k3.default,{isCreate:!0,supportFile:!0,isShow:g,onClose:j,onConfirm:a=>{i(a)&&j()},varKeys:f.variables.map(a=>a.variable)}),(0,F.jsx)(gU,{isShow:l,onCancel:m,onConfirm:n})]})}),la=K.memo(()=>(0,F.jsx)("div",{})),lb="nodes.templateTransform",lc=K.memo(({id:a,data:b})=>{let{t:c}=(0,$.useTranslation)(),{readOnly:d,inputs:e,availableVars:f,handleVarListChange:g,handleVarNameChange:h,handleAddVariable:i,handleAddEmptyVariable:j,handleCodeChange:k,filterVar:l}=((a,b)=>{let{nodesReadOnly:c}=(0,aq.useNodesReadOnly)(),d=(0,aP.useStore)(a=>a.nodesDefaultConfigs)?.[b.type],{inputs:e,setInputs:f}=eA(a,b),g=(0,K.useRef)(e),h=(0,K.useCallback)(a=>{f(a),g.current=a},[f]),{availableVars:i}=(0,eD.default)(a,{onlyLeafNodeVar:!1,filterVar:()=>!0}),{handleAddVariable:j}=eE({inputs:e,setInputs:h}),k=(0,K.useCallback)(a=>{h((0,I.produce)(g.current,b=>{b.variables=a}))},[h]),l=(0,K.useCallback)(a=>{h((0,I.produce)(g.current,b=>{b.variables.push(a)}))},[h]),m=(0,K.useCallback)((a,b)=>{h((0,I.produce)(g.current,c=>{c.template=c.template.replaceAll(`{{ ${a} }}`,`{{ ${b} }}`)}))},[h]);return(0,K.useEffect)(()=>{e.template||d&&Object.keys(d).length>0&&h({...e,...d})},[d]),{readOnly:c,inputs:e,availableVars:i,handleVarListChange:k,handleVarNameChange:m,handleAddVariable:l,handleAddEmptyVariable:j,handleCodeChange:(0,K.useCallback)(a=>{h((0,I.produce)(g.current,b=>{b.template=a}))},[h]),filterVar:(0,K.useCallback)(a=>[aC.VarType.string,aC.VarType.number,aC.VarType.boolean,aC.VarType.object,aC.VarType.array,aC.VarType.arrayNumber,aC.VarType.arrayString,aC.VarType.arrayBoolean,aC.VarType.arrayObject].includes(a.type),[])}})(a,b);return(0,F.jsxs)("div",{className:"mt-2",children:[(0,F.jsxs)("div",{className:"space-y-4 px-4 pb-4",children:[(0,F.jsx)(fW,{title:c(`${lb}.inputVars`,{ns:"workflow"}),operations:d?void 0:(0,F.jsx)(aY.default,{onClick:j}),children:(0,F.jsx)(gR,{nodeId:a,readonly:d,list:e.variables,onChange:g,onVarNameChange:h,filterVar:l,isSupportFileVar:!1})}),(0,F.jsx)(au,{}),(0,F.jsx)(f2,{availableVars:f,varList:e.variables,onAddVar:i,isInNode:!0,readOnly:d,language:a6.CodeLanguage.python3,title:(0,F.jsx)("div",{className:"uppercase",children:c(`${lb}.code`,{ns:"workflow"})}),headerRight:(0,F.jsxs)("div",{className:"flex items-center",children:[(0,F.jsxs)("a",{className:"flex h-[18px] items-center space-x-0.5 text-xs font-normal text-text-tertiary",href:"https://jinja.palletsprojects.com/en/3.1.x/templates/",target:"_blank",children:[(0,F.jsx)("span",{children:c(`${lb}.codeSupportTip`,{ns:"workflow"})}),(0,F.jsx)(Y.RiQuestionLine,{className:"h-3 w-3"})]}),(0,F.jsx)("div",{className:"mx-1.5 h-3 w-px bg-divider-regular"})]}),value:e.template,onChange:k})]}),(0,F.jsx)(au,{}),(0,F.jsx)("div",{children:(0,F.jsx)(gj,{children:(0,F.jsx)(F.Fragment,{children:(0,F.jsx)(gi,{name:"output",type:"string",description:c(`${lb}.outputVars.output`,{ns:"workflow"})})})})})]})}),ld=K.memo(({id:a,data:b})=>{let{tool_configurations:c,paramSchemas:d}=b,e=Object.keys(c||{}),{isChecking:f,isMissing:g,uniqueIdentifier:h,canInstall:i,onInstallSuccess:j,shouldDim:k}=gZ(b),l=!f&&g&&i&&h,{handleNodeDataUpdate:m}=(0,ao.useNodeDataUpdate)(),n=!f&&g&&i&&!!h;(0,K.useEffect)(()=>{(b._pluginInstallLocked!==n||b._dimmed!==k)&&m({id:a,data:{_pluginInstallLocked:n,_dimmed:k}})},[b._pluginInstallLocked,b._dimmed,m,a,k,n]);let o=e.length>0;return l||o?(0,F.jsxs)("div",{className:"relative mb-1 px-3 py-1",children:[l&&(0,F.jsx)("div",{className:"pointer-events-auto absolute right-3 top-[-32px] z-40",children:(0,F.jsx)(fR.InstallPluginButton,{size:"small",className:"!font-medium !text-text-accent",extraIdentifiers:[b.plugin_id,b.provider_id,b.provider_name].filter(Boolean),uniqueIdentifier:h,onSuccess:j})}),o&&(0,F.jsx)("div",{className:"space-y-0.5","aria-disabled":k,children:e.map((a,b)=>(0,F.jsxs)("div",{className:"flex h-6 items-center justify-between space-x-1 rounded-md  bg-workflow-block-parma-bg px-1 text-xs font-normal text-text-secondary",children:[(0,F.jsx)("div",{title:a,className:"max-w-[100px] shrink-0 truncate text-xs font-medium uppercase text-text-tertiary",children:a}),"string"==typeof c[a].value&&(0,F.jsx)("div",{title:c[a].value,className:"w-0 shrink-0 grow truncate text-right text-xs font-normal text-text-secondary",children:d?.find(b=>b.name===a)?.type===b$.FormTypeEnum.secretInput?"********":c[a].value}),"number"==typeof c[a].value&&(0,F.jsx)("div",{title:Number.isNaN(c[a].value)?"":c[a].value,className:"w-0 shrink-0 grow truncate text-right text-xs font-normal text-text-secondary",children:Number.isNaN(c[a].value)?"":c[a].value}),"string"!=typeof c[a]&&c[a]?.type===b$.FormTypeEnum.modelSelector&&(0,F.jsx)("div",{title:c[a].model,className:"w-0 shrink-0 grow truncate text-right text-xs font-normal text-text-secondary",children:c[a].model})]},b))})]}):null}),le="nodes.tool",lf=K.memo(({id:a,data:b})=>{let{t:c}=(0,$.useTranslation)(),{readOnly:d,inputs:e,toolInputVarSchema:f,setInputVar:g,toolSettingSchema:h,toolSettingValue:i,setToolSettingValue:j,currCollection:k,isShowAuthBtn:l,isLoading:m,outputSchema:n,hasObjectOutput:o,currTool:p}=eP(a,b),[q,r]=K.useState(!1),s=(0,aP.useStore)(a=>a.pipelineId),t=(0,aP.useStore)(a=>a.setShowInputFieldPanel),{schemaTypeDefinitions:u}=(0,bX.default)();return m?(0,F.jsx)("div",{className:"flex h-[200px] items-center justify-center",children:(0,F.jsx)(bI.default,{})}):(0,F.jsxs)("div",{className:"pt-2",children:[!l&&(0,F.jsxs)("div",{className:"relative",children:[f.length>0&&(0,F.jsx)(fW,{className:"px-4",title:c(`${le}.inputVars`,{ns:"workflow"}),children:(0,F.jsx)(ha.default,{readOnly:d,nodeId:a,schema:f,value:e.tool_parameters,onChange:g,currentProvider:k,currentTool:p,showManageInputField:!!s,onManageInputField:()=>t?.(!0)})}),f.length>0&&h.length>0&&(0,F.jsx)(au,{className:"mt-1"}),h.length>0&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(gj,{title:c(`${le}.settings`,{ns:"workflow"}),collapsed:q,onCollapse:r,children:(0,F.jsx)(ha.default,{readOnly:d,nodeId:a,schema:h,value:i,onChange:j})}),(0,F.jsx)(au,{})]})]}),(0,F.jsx)("div",{children:(0,F.jsx)(gj,{children:(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(gi,{name:"text",type:"string",description:c(`${le}.outputVars.text`,{ns:"workflow"}),isIndent:o}),(0,F.jsx)(gi,{name:"files",type:"array[file]",description:c(`${le}.outputVars.files.title`,{ns:"workflow"}),isIndent:o}),(0,F.jsx)(gi,{name:"json",type:"array[object]",description:c(`${le}.outputVars.json`,{ns:"workflow"}),isIndent:o}),n.map(a=>{let b=(0,bX.getMatchedSchemaType)(a.value,u);return(0,F.jsx)("div",{children:a.value?.type==="object"?(0,F.jsx)(g8,{rootClassName:"code-sm-semibold text-text-secondary",payload:(0,g9.wrapStructuredVarItem)(a,b)}):(0,F.jsx)(gi,{name:a.name,type:`${a.type.toLocaleLowerCase()}${b?` (${b})`:""}`,description:a.description,isIndent:o})},a.name)})]})})})]})});var lg=a.i(582899),lh=((A={}).warning="warning",A.error="error",A);let li=(0,jG.cva)("flex items-center gap-1 rounded-md px-2 py-1 system-xs-medium",{variants:{status:{warning:"bg-state-warning-hover text-text-warning",error:"bg-state-destructive-hover text-text-destructive"}},defaultVariants:{status:"warning"}}),lj={warning:{IconComponent:lg.default,message:"Warning"},error:{IconComponent:Y.RiErrorWarningFill,message:"Error"}},lk=({className:a,status:b,message:c,styleCss:d,iconClassName:e,children:f,...g})=>{let h=lj[b??"warning"].IconComponent,i=lj[b??"warning"].message;return(0,F.jsxs)("div",{className:(0,S.cn)(li({status:b,className:a})),style:d,...g,children:[(0,F.jsx)(h,{className:(0,S.cn)("h-3.5 w-3.5 shrink-0",e)}),(0,F.jsx)("span",{children:c??i}),f]})};lk.displayName="NodeStatus";let ll=K.memo(lk);var lm=a.i(446941);let ln=(a,{allowScalars:b=!1}={})=>!a||"object"!=typeof a||Array.isArray(a)?{}:Object.entries(a).reduce((a,[c,d])=>{if(!d&&0!==d&&!1!==d)return a;if("object"==typeof d&&!Array.isArray(d)&&"type"in d&&"value"in d){let b={...d};return b.type===lm.VarKindType.mixed&&(b.type=lm.VarKindType.constant),a[c]=b,a}return b&&("string"==typeof d||"number"==typeof d||"boolean"==typeof d?a[c]={type:lm.VarKindType.constant,value:d}:Array.isArray(d)&&d.every(a=>"string"==typeof a)&&(a[c]={type:lm.VarKindType.variable,value:d})),a},{}),lo=(a,b)=>{let{nodesReadOnly:c}=(0,aq.useNodesReadOnly)(),{data:d=[]}=(0,aT.useAllTriggerPlugins)(),{inputs:e,setInputs:f}=eA(a,b),{provider_id:g,provider_name:h,event_name:i,config:j={},event_parameters:k={},subscription_id:l}=e,m=(0,K.useMemo)(()=>ln(k),[k]),n=(0,K.useMemo)(()=>ln(j,{allowScalars:!0}),[j]),o=(0,K.useMemo)(()=>d.find(a=>a.name===h||a.id===g||g&&a.plugin_id===g),[d,h,g]),{data:p=[]}=(0,aT.useTriggerSubscriptions)(g||""),q=(0,K.useMemo)(()=>p?.find(a=>a.id===l),[p,l]),r=(0,K.useMemo)(()=>o?.events.find(a=>a.name===i),[o,i]),s=(0,K.useMemo)(()=>r?(0,eB.toolParametersToFormSchemas)(r.parameters):[],[r]),t=(0,K.useMemo)(()=>{let a=new Map;return s.forEach(b=>{a.set(b.variable||b.name,b)}),Array.from(a.values())},[s]),u=(0,K.useMemo)(()=>{if(!t.length)return{};let a=m&&Object.keys(m).length>0?m:n;return ln((0,eB.getConfiguredValue)(a,t))},[t,m,n]);(0,K.useEffect)(()=>{!t.length||m&&Object.keys(m).length>0||!u||0===Object.keys(u).length||f((0,I.produce)(e,a=>{a.event_parameters=u,a.config=u}))},[f,m,e,t,u]);let v=(0,K.useCallback)(a=>{let b=ln(a);f((0,I.produce)(e,a=>{a.event_parameters=b,a.config=b}))},[e,f]),w=(0,K.useCallback)((a,b)=>{f((0,I.produce)(e,c=>{let d=ln({...c.event_parameters,[a.variable]:{type:lm.VarKindType.variable,value:b.variable}});c.event_parameters=d,c.config=d}))},[e,f]),x=(0,K.useMemo)(()=>r?.output_schema||{},[r]),y=(0,K.useMemo)(()=>Object.values(x.properties||{}).some(a=>"object"===a.type),[x]);return{readOnly:c,inputs:e,currentProvider:o,currentEvent:r,triggerParameterSchema:t,triggerParameterValue:u,setTriggerParameterValue:v,setInputVar:w,outputSchema:x,hasObjectOutput:y,subscriptions:p,subscriptionSelected:q}},lp=a=>{if(null==a)return"";if("string"==typeof a||"number"==typeof a||"boolean"==typeof a)return String(a);if(Array.isArray(a))return a.join(".");if("object"==typeof a){let{value:b}=a;if(null==b)return"";if("string"==typeof b||"number"==typeof b||"boolean"==typeof b)return String(b);if(Array.isArray(b))return b.join(".");try{return JSON.stringify(b)}catch{}}return""},lq=K.memo(({id:a,data:b})=>{let{subscriptions:c}=lo(a,b),{config:d={},subscription_id:e}=b,f=Object.keys(d),{isChecking:g,isMissing:h,uniqueIdentifier:i,canInstall:j,onInstallSuccess:k,shouldDim:l}=gZ(b),{handleNodeDataUpdate:m}=(0,ao.useNodeDataUpdate)(),n=!g&&h&&j&&i,o=!g&&h&&j&&!!i;(0,K.useEffect)(()=>{(b._pluginInstallLocked!==o||b._dimmed!==l)&&m({id:a,data:{_pluginInstallLocked:o,_dimmed:l}})},[b._pluginInstallLocked,b._dimmed,m,a,l,o]);let{t:p}=(0,$.useTranslation)(),q=(0,K.useMemo)(()=>e&&c?.some(a=>a.id===e),[e,c]);return(0,F.jsxs)("div",{className:"relative mb-1 px-3 py-1",children:[n&&(0,F.jsx)("div",{className:"pointer-events-auto absolute right-3 top-[-32px] z-40",children:(0,F.jsx)(fR.InstallPluginButton,{size:"small",extraIdentifiers:[b.plugin_id,b.provider_id,b.provider_name].filter(Boolean),className:"!font-medium !text-text-accent",uniqueIdentifier:i,onSuccess:k})}),(0,F.jsxs)("div",{className:"space-y-0.5","aria-disabled":l,children:[!q&&(0,F.jsx)(ll,{status:lh.warning,message:p("node.status.warning",{ns:"pluginTrigger"})}),q&&f.map((a,b)=>{let c;return(0,F.jsxs)("div",{className:"flex h-6 items-center justify-between space-x-1 rounded-md bg-workflow-block-parma-bg px-1 text-xs font-normal text-text-secondary",children:[(0,F.jsx)("div",{title:a,className:"max-w-[100px] shrink-0 truncate text-xs font-medium uppercase text-text-tertiary",children:a}),(0,F.jsx)("div",{title:lp(d[a]),className:"w-0 shrink-0 grow truncate text-right text-xs font-normal text-text-secondary",children:(c=lp(d[a])).includes("secret")?"********":c})]},b)})]})]})});a.i(276194);var lr=a.i(170974),ls=a.i(985480);let lt=({readOnly:a,nodeId:b,schema:c,value:d,onChange:e,inPanel:f,currentEvent:g,currentProvider:h,extraParams:i,disableVariableInsertion:j=!1})=>{let k=(0,ae.useLanguage)(),{name:l,label:m,type:n,required:o,tooltip:p,input_schema:q}=c,r=n===b$.FormTypeEnum.object||n===b$.FormTypeEnum.array,s=n===b$.FormTypeEnum.textInput||n===b$.FormTypeEnum.secretInput,[t,{setTrue:u,setFalse:v}]=(0,a8.useBoolean)(!1);return(0,F.jsxs)("div",{className:"space-y-0.5 py-1",children:[(0,F.jsxs)("div",{children:[(0,F.jsxs)("div",{className:"flex h-6 items-center",children:[(0,F.jsx)("div",{className:"system-sm-medium text-text-secondary",children:m[k]||m.en_US}),o&&(0,F.jsx)("div",{className:"system-xs-regular ml-1 text-text-destructive-secondary",children:"*"}),!s&&p&&(0,F.jsx)(ac.default,{popupContent:(0,F.jsx)("div",{className:"w-[200px]",children:p[k]||p.en_US}),triggerClassName:"ml-1 w-4 h-4",asChild:!1}),r&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)("div",{className:"system-xs-regular ml-1 mr-0.5 text-text-quaternary",children:"·"}),(0,F.jsxs)(av.default,{variant:"ghost",size:"small",onClick:u,className:"system-xs-regular px-1 text-text-tertiary",children:[(0,F.jsx)(Y.RiBracesLine,{className:"mr-1 size-3.5"}),(0,F.jsx)("span",{children:"JSON Schema"})]})]})]}),s&&p&&(0,F.jsx)("div",{className:"body-xs-regular pb-0.5 text-text-tertiary",children:p[k]||p.en_US})]}),(0,F.jsx)(ls.default,{readOnly:a,nodeId:b,schema:c,value:d,onChange:e,inPanel:f,currentTool:g,currentProvider:h,providerType:"trigger",extraParams:i,disableVariableInsertion:j}),t&&(0,F.jsx)(lr.SchemaModal,{isShow:!0,onClose:v,rootName:l,schema:q})]})},lu=({readOnly:a,nodeId:b,schema:c,value:d,onChange:e,inPanel:f,currentEvent:g,currentProvider:h,extraParams:i,disableVariableInsertion:j=!1})=>(0,F.jsx)("div",{className:"space-y-1",children:c.map((c,k)=>(0,F.jsx)(lt,{readOnly:a,nodeId:b,schema:c,value:d,onChange:e,inPanel:f,currentEvent:g,currentProvider:h,extraParams:i,disableVariableInsertion:j},k))}),lv=K.memo(({id:a,data:b})=>{let{readOnly:c,triggerParameterSchema:d,triggerParameterValue:e,setTriggerParameterValue:f,outputSchema:g,hasObjectOutput:h,currentProvider:i,currentEvent:j,subscriptionSelected:k}=lo(a,b),l=b.type===aC.BlockEnum.TriggerPlugin,m=Object.entries(g.properties||{}).map(([a,b])=>({name:a,type:b.type||"string",description:b.description||""}));return(0,F.jsxs)("div",{className:"mt-2",children:[d.length>0&&k&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)("div",{className:"px-4 pb-4",children:(0,F.jsx)(lu,{readOnly:c,nodeId:a,schema:d,value:e,onChange:f,currentProvider:i,currentEvent:j,disableVariableInsertion:l})}),(0,F.jsx)(au,{})]}),(0,F.jsx)(gj,{children:(0,F.jsxs)(F.Fragment,{children:[m.map(a=>(0,F.jsx)(gi,{name:a.name,type:a.type,description:a.description,isIndent:h},a.name)),Object.entries(g.properties||{}).map(([a,b])=>(0,F.jsx)("div",{children:"object"===b.type?(0,F.jsx)(g8,{rootClassName:"code-sm-semibold text-text-secondary",payload:{schema:{type:jF.Type.object,properties:{[a]:b},additionalProperties:!1}}}):null},a))]})})]})}),lw=K.memo(({data:a})=>{let{t:b}=(0,$.useTranslation)();return(0,F.jsxs)("div",{className:"mb-1 px-3 py-1",children:[(0,F.jsx)("div",{className:"mb-1 text-[10px] font-medium uppercase tracking-wide text-text-tertiary",children:b("nodes.triggerSchedule.nextExecutionTime",{ns:"workflow"})}),(0,F.jsx)("div",{className:"flex h-[26px] items-center rounded-md bg-workflow-block-parma-bg px-2 text-xs text-text-secondary",children:(0,F.jsx)("div",{className:"w-0 grow",children:(0,F.jsx)("div",{className:"truncate",title:c0(a),children:c0(a)})})})]})});var lx=a.i(368425);let ly=({frequency:a,onChange:b})=>{let{t:c}=(0,$.useTranslation)(),d=(0,K.useMemo)(()=>[{value:"frequency-header",name:c("nodes.triggerSchedule.frequency.label",{ns:"workflow"}),isGroup:!0},{value:"hourly",name:c("nodes.triggerSchedule.frequency.hourly",{ns:"workflow"})},{value:"daily",name:c("nodes.triggerSchedule.frequency.daily",{ns:"workflow"})},{value:"weekly",name:c("nodes.triggerSchedule.frequency.weekly",{ns:"workflow"})},{value:"monthly",name:c("nodes.triggerSchedule.frequency.monthly",{ns:"workflow"})}],[c]);return(0,F.jsx)(a4.SimpleSelect,{items:d,defaultValue:a,onSelect:a=>b(a.value),placeholder:c("nodes.triggerSchedule.selectFrequency",{ns:"workflow"}),className:"w-full py-2",wrapperClassName:"h-auto",optionWrapClassName:"min-w-40",notClearable:!0,allowSearch:!1},`${a}-${d[0]?.name}`)};var lz=a.i(805419),lz=lz,lA=a.i(642633),lA=lA;let lB=({mode:a,onChange:b})=>{let{t:c}=(0,$.useTranslation)(),d=c("visual"===a?"nodes.triggerSchedule.useCronExpression":"nodes.triggerSchedule.useVisualPicker",{ns:"workflow"}),e="visual"===a?lz.default:lA.default;return(0,F.jsxs)("button",{type:"button",onClick:()=>{b("visual"===a?"cron":"visual")},className:"flex cursor-pointer items-center gap-1 rounded-lg px-2 py-1 text-sm text-text-secondary hover:bg-state-base-hover",children:[K.createElement(e,{className:"w-4 h-4"}),(0,F.jsx)("span",{children:d})]})},lC=({selectedDays:a,onChange:b})=>{let{t:c}=(0,$.useTranslation)(),d=Array.from({length:31},(a,b)=>b+1),e=[d.slice(0,7),d.slice(7,14),d.slice(14,21),d.slice(21,28),[29,30,31,"last"]];return(0,F.jsxs)("div",{className:"space-y-2",children:[(0,F.jsx)("label",{className:"mb-2 block text-xs font-medium text-text-tertiary",children:c("nodes.triggerSchedule.days",{ns:"workflow"})}),(0,F.jsx)("div",{className:"space-y-1.5",children:e.map((d,f)=>(0,F.jsxs)("div",{className:"grid grid-cols-7 gap-1.5",children:[d.map(d=>(0,F.jsx)("button",{type:"button",onClick:()=>{let c,e;b((e=(c=a||[]).includes(d)?c.filter(a=>a!==d):[...c,d]).length>0?e:[d])},className:`rounded-lg border bg-components-option-card-option-bg py-1 text-xs transition-colors ${"last"===d?"col-span-2 min-w-0":""} ${a?.includes(d)||0?"border-util-colors-blue-brand-blue-brand-600 text-text-secondary":"border-divider-subtle text-text-tertiary hover:border-divider-regular hover:text-text-secondary"}`,children:"last"===d?(0,F.jsxs)("div",{className:"flex items-center justify-center gap-1",children:[(0,F.jsx)("span",{children:c("nodes.triggerSchedule.lastDay",{ns:"workflow"})}),(0,F.jsx)(ac.default,{popupContent:c("nodes.triggerSchedule.lastDayTooltip",{ns:"workflow"}),children:(0,F.jsx)(Y.RiQuestionLine,{className:"h-3 w-3 text-text-quaternary"})})]}):d},d)),f===e.length-1&&Array.from({length:7-d.length-1},(a,b)=>(0,F.jsx)("div",{className:"invisible"},`empty-${b}`))]},f))}),a?.includes(31)&&(0,F.jsx)("div",{className:"mt-1.5 grid grid-cols-7 gap-1.5",children:(0,F.jsx)("div",{className:"col-span-7 text-xs text-gray-500",children:c("nodes.triggerSchedule.lastDayTooltip",{ns:"workflow"})})})]})},lD=({data:a})=>{let{t:b}=(0,$.useTranslation)();if(!a.frequency)return null;let c=((a,b=5)=>{let c=cY(a.timezone);return c$(a,b).map(b=>c_(b,c,"visual"===a.mode&&"weekly"===a.frequency,!0))})(a,5);return 0===c.length?null:(0,F.jsxs)("div",{className:"space-y-2",children:[(0,F.jsx)("label",{className:"block text-xs font-medium text-gray-500",children:b("nodes.triggerSchedule.nextExecutionTimes",{ns:"workflow"})}),(0,F.jsx)("div",{className:"flex min-h-[80px] flex-col rounded-xl bg-components-input-bg-normal py-2",children:c.map((a,b)=>(0,F.jsxs)("div",{className:"flex items-baseline text-xs",children:[(0,F.jsx)("span",{className:"w-6 select-none text-right font-mono font-normal leading-[150%] tracking-wider text-text-quaternary",children:String(b+1).padStart(2,"0")}),(0,F.jsx)("span",{className:"pl-2 pr-3 font-mono font-normal leading-[150%] tracking-wider text-text-secondary",children:a})]},b))})]})},lE=({value:a=0,onChange:b})=>{let{t:c}=(0,$.useTranslation)();return(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"mb-2 block text-xs font-medium text-gray-500",children:c("nodes.triggerSchedule.onMinute",{ns:"workflow"})}),(0,F.jsxs)("div",{className:"relative flex h-8 items-center rounded-lg bg-components-input-bg-normal",children:[(0,F.jsx)("div",{className:"flex h-full w-12 shrink-0 items-center justify-center text-[13px] text-components-input-text-filled",children:a}),(0,F.jsx)("div",{className:"absolute left-12 top-0 h-full w-px bg-components-panel-bg"}),(0,F.jsx)("div",{className:"flex h-full grow items-center pl-4 pr-3",children:(0,F.jsx)(d3.default,{className:"w-full",value:a,min:0,max:59,step:1,onChange:b})})]})]})},lF=({selectedDays:a,onChange:b})=>{let{t:c}=(0,$.useTranslation)();return(0,F.jsxs)("div",{className:"space-y-2",children:[(0,F.jsx)("label",{className:"mb-2 block text-xs font-medium text-text-tertiary",children:c("nodes.triggerSchedule.weekdays",{ns:"workflow"})}),(0,F.jsx)("div",{className:"flex gap-1.5",children:[{key:"sun",label:"Sun"},{key:"mon",label:"Mon"},{key:"tue",label:"Tue"},{key:"wed",label:"Wed"},{key:"thu",label:"Thu"},{key:"fri",label:"Fri"},{key:"sat",label:"Sat"}].map(c=>{let d;return(0,F.jsx)("button",{type:"button",className:`flex-1 rounded-lg border bg-components-option-card-option-bg py-1 text-xs transition-colors ${(d=c.key,a.includes(d))?"border-util-colors-blue-brand-blue-brand-600 text-text-secondary":"border-divider-subtle text-text-tertiary hover:border-divider-regular hover:text-text-secondary"}`,onClick:()=>{var d;let e,f;return d=c.key,void b((f=(e=a||[]).includes(d)?e.filter(a=>a!==d):[...e,d]).length>0?f:[d])},children:c.label},c.key)})})]})},lG=K.memo(({id:a,data:b})=>{let{t:c}=(0,$.useTranslation)(),{inputs:d,setInputs:e,handleModeChange:f,handleFrequencyChange:g,handleCronExpressionChange:h,handleWeekdaysChange:i,handleTimeChange:j,handleOnMinuteChange:k}=((a,b)=>{let{nodesReadOnly:c}=(0,aq.useNodesReadOnly)(),{userProfile:d}=(0,iZ.useAppContext)(),{inputs:e,setInputs:f}=eA(a,(0,K.useMemo)(()=>({...b,mode:b.mode||"visual",frequency:b.frequency||"daily",timezone:b.timezone||d.timezone||"UTC",visual_config:{time:"12:00 AM",weekdays:["sun"],on_minute:0,monthly_days:[1],...b.visual_config}}),[b,d.timezone])),g=(0,K.useCallback)(a=>{f({...e,mode:a})},[e,f]),h=(0,K.useCallback)(a=>{f({...e,frequency:a,visual_config:{...e.visual_config,..."hourly"===a&&{on_minute:e.visual_config?.on_minute??0}},cron_expression:void 0})},[e,f]),i=(0,K.useCallback)(a=>{f({...e,cron_expression:a,frequency:void 0,visual_config:void 0})},[e,f]),j=(0,K.useCallback)(a=>{f({...e,visual_config:{...e.visual_config,weekdays:a},cron_expression:void 0})},[e,f]),k=(0,K.useCallback)(a=>{f({...e,visual_config:{...e.visual_config,time:a},cron_expression:void 0})},[e,f]),l=(0,K.useCallback)(a=>{f({...e,visual_config:{...e.visual_config,on_minute:a},cron_expression:void 0})},[e,f]);return{readOnly:c,inputs:e,setInputs:f,handleModeChange:g,handleFrequencyChange:h,handleCronExpressionChange:i,handleWeekdaysChange:j,handleTimeChange:k,handleOnMinuteChange:l}})(a,b);return(0,F.jsx)("div",{className:"mt-2",children:(0,F.jsxs)("div",{className:"space-y-4 px-4 pb-3 pt-2",children:[(0,F.jsx)(fW,{title:c("nodes.triggerSchedule.title",{ns:"workflow"}),operations:(0,F.jsx)(lB,{mode:d.mode,onChange:f}),children:(0,F.jsxs)("div",{className:"space-y-3",children:["visual"===d.mode&&(0,F.jsxs)("div",{className:"space-y-3",children:[(0,F.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"mb-2 block text-xs font-medium text-gray-500",children:c("nodes.triggerSchedule.frequencyLabel",{ns:"workflow"})}),(0,F.jsx)(ly,{frequency:d.frequency||"daily",onChange:g})]}),(0,F.jsx)("div",{className:"col-span-2",children:"hourly"===d.frequency?(0,F.jsx)(lE,{value:d.visual_config?.on_minute,onChange:k}):(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)("label",{className:"mb-2 block text-xs font-medium text-gray-500",children:c("nodes.triggerSchedule.time",{ns:"workflow"})}),(0,F.jsx)(lx.default,{notClearable:!0,timezone:d.timezone,value:d.visual_config?.time||"12:00 AM",triggerFullWidth:!0,onChange:a=>{a&&j(a.format("h:mm A"))},onClear:()=>{j("12:00 AM")},placeholder:c("nodes.triggerSchedule.selectTime",{ns:"workflow"}),showTimezone:!0})]})})]}),"weekly"===d.frequency&&(0,F.jsx)(lF,{selectedDays:d.visual_config?.weekdays||[],onChange:i}),"monthly"===d.frequency&&(0,F.jsx)(lC,{selectedDays:d.visual_config?.monthly_days||[1],onChange:a=>{e({...d,visual_config:{...d.visual_config,monthly_days:a}})}})]}),"cron"===d.mode&&(0,F.jsx)("div",{className:"space-y-2",children:(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"mb-2 block text-xs font-medium text-gray-500",children:c("nodes.triggerSchedule.cronExpression",{ns:"workflow"})}),(0,F.jsx)(a2.default,{value:d.cron_expression||"",onChange:a=>h(a.target.value),placeholder:"0 0 * * *",className:"font-mono"})]})})]})}),(0,F.jsx)("div",{className:"border-t border-divider-subtle"}),(0,F.jsx)(lD,{data:d})]})})}),lH=K.memo(({data:a})=>(0,F.jsxs)("div",{className:"mb-1 px-3 py-1",children:[(0,F.jsx)("div",{className:"mb-1 text-[10px] font-medium uppercase tracking-wide text-text-tertiary",children:"URL"}),(0,F.jsx)("div",{className:"flex h-[26px] items-center rounded-md bg-workflow-block-parma-bg px-2 text-xs text-text-secondary",children:(0,F.jsx)("div",{className:"w-0 grow",children:(0,F.jsx)("div",{className:"truncate",title:a.webhook_url||"--",children:a.webhook_url||"--"})})})]}));var lI=a.i(284057);let lJ="overview.appInfo.embedded",lK=K.forwardRef(({showCopyButton:a=!0,copyValue:b,onCopy:c,value:d,wrapperClassName:e,...f},g)=>{let{t:h}=(0,$.useTranslation)(),i="string"==typeof d?d:String(d||""),j=b||i,{copied:k,copy:l,reset:m}=(0,lI.useClipboard)();return(0,F.jsxs)("div",{className:(0,S.cn)("relative w-full",e),children:[(0,F.jsx)("input",{ref:g,className:(0,S.cn)("w-full appearance-none border border-transparent bg-components-input-bg-normal py-[7px] text-components-input-text-filled caret-primary-600 outline-none placeholder:text-components-input-text-placeholder hover:border-components-input-border-hover hover:bg-components-input-bg-hover focus:border-components-input-border-active focus:bg-components-input-bg-active focus:shadow-xs","radius-md system-sm-regular px-3",a&&"pr-8",f.disabled&&"cursor-not-allowed border-transparent bg-components-input-bg-disabled text-components-input-text-filled-disabled hover:border-transparent hover:bg-components-input-bg-disabled",f.className),value:d,...(({size:a,...b})=>b)(f)}),a&&(0,F.jsx)("div",{className:"absolute right-2 top-1/2 -translate-y-1/2",onMouseLeave:m,children:(0,F.jsx)(ac.default,{popupContent:h(k?`${lJ}.copied`:`${lJ}.copy`,{ns:"appOverview"})||"",children:(0,F.jsx)(fX.default,{size:"xs",onClick:()=>{l(j),c?.(j)},className:"hover:bg-components-button-ghost-bg-hover",children:k?(0,F.jsx)(Y.RiClipboardFill,{className:"h-3.5 w-3.5 text-text-tertiary"}):(0,F.jsx)(Y.RiClipboardLine,{className:"h-3.5 w-3.5 text-text-tertiary"})})})})]})});lK.displayName="InputWithCopy";var lL=a.i(28814),lM=a.i(168799);let lN=K.memo(({title:a,columns:b,data:c,onChange:d,readonly:e=!1,placeholder:f,emptyRowData:g,className:h,showHeader:i=!1})=>{let j=(0,K.useMemo)(()=>{let a=a=>Object.values(a).every(a=>""===a||null==a||!1===a);if(e)return c.map((a,b)=>({row:a,dataIndex:b,isVirtual:!1}));let b=c.length>0,d=[];return b?(c.forEach((b,e)=>{a(b)&&e<c.length-1||d.push({row:b,dataIndex:e,isVirtual:!1})}),a(c[c.length-1])||d.push({row:{...g},dataIndex:null,isVirtual:!0})):d.push({row:{...g},dataIndex:null,isVirtual:!0}),d},[c,g,e]),k=(0,K.useCallback)(a=>{e||a<0||a>=c.length||d(c.filter((b,c)=>c!==a))},[c,e,d]),l=(0,K.useCallback)((a,b,f)=>{if(!e){if(null!==a&&a<c.length){let e=[...c];e[a]={...e[a],[b]:f},d(e);return}d([...c,{...g,[b]:f}])}},[c,g,d,e]),m=(0,K.useMemo)(()=>b.find(a=>"key"===a.key||"name"===a.key)?.key??"key",[b]),n=e&&0===c.length;return(0,F.jsxs)("div",{className:h,children:[(0,F.jsx)("div",{className:"mb-3 flex items-center justify-between",children:(0,F.jsx)("h4",{className:"system-sm-semibold-uppercase text-text-secondary",children:a})}),n?(0,F.jsx)("div",{className:"flex h-7 items-center justify-center rounded-lg border border-divider-regular bg-components-panel-bg text-xs font-normal leading-[18px] text-text-quaternary",children:f}):(0,F.jsxs)("div",{className:"rounded-lg border border-divider-regular",children:[i&&(0,F.jsx)("div",{className:"system-xs-medium-uppercase flex h-7 items-center leading-7 text-text-tertiary",children:b.map((a,c)=>(0,F.jsx)("div",{className:(0,S.cn)("h-full pl-3",a.width&&a.width.startsWith("w-")?"shrink-0":"flex-1",a.width,c<b.length-1&&"border-r border-divider-regular"),children:a.title},a.key))}),(0,F.jsx)("div",{className:"divide-y divide-divider-subtle",children:j.map(({row:a,dataIndex:c,isVirtual:d},f)=>{var g;let h=`row-${f}`,i="string"==typeof(g=a[m])?""!==g.trim():""!==g&&null!=g&&!1!==g;return(0,F.jsxs)("div",{className:(0,S.cn)("group relative flex border-t border-divider-regular",i?"hover:bg-state-destructive-hover":"hover:bg-state-base-hover"),style:{minHeight:"28px"},children:[b.map((d,f)=>(0,F.jsx)("div",{className:(0,S.cn)("shrink-0 pl-3",d.width,f<b.length-1&&"border-r border-divider-regular"),children:((a,b,c)=>{let d=b[a.key],f=b=>l(c,a.key,b);switch(a.type){case"input":return(0,F.jsx)(a2.default,{value:d||"",onChange:b=>{("key"===a.key||"name"===a.key)&&(0,by.replaceSpaceWithUnderscoreInVarNameInput)(b.target),f(b.target.value)},onKeyDown:a=>{"Enter"===a.key&&(a.preventDefault(),a.currentTarget.blur())},placeholder:a.placeholder,disabled:e,wrapperClassName:"w-full min-w-0",className:(0,S.cn)("h-6 rounded-none border-0 bg-transparent px-0 py-0 shadow-none","hover:border-transparent hover:bg-transparent focus:border-transparent focus:bg-transparent","system-sm-regular text-text-secondary placeholder:text-text-quaternary")});case"select":return(0,F.jsx)(a4.SimpleSelect,{items:a.options||[],defaultValue:d,onSelect:a=>f(a.value),disabled:e,placeholder:a.placeholder,hideChecked:!1,notClearable:!0,wrapperClassName:"h-6 w-full min-w-0",className:(0,S.cn)("h-6 rounded-none bg-transparent pl-0 pr-6 text-text-secondary","hover:bg-transparent focus-visible:bg-transparent group-hover/simple-select:bg-transparent"),optionWrapClassName:"w-26 min-w-26 z-[60] -ml-3"});case"switch":return(0,F.jsx)("div",{className:"flex h-7 items-center",children:(0,F.jsx)(lM.default,{id:`${a.key}-${String(c??"v")}`,checked:!!d,onCheck:()=>f(!d),disabled:e})});case"custom":return a.render?a.render(d,b,c??-1,f):null;default:return null}})(d,a,c)},d.key)),!e&&null!==c&&i&&(0,F.jsx)("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100",children:(0,F.jsx)("button",{type:"button",onClick:()=>k(c),className:"p-1","aria-label":"Delete row",children:(0,F.jsx)(Y.RiDeleteBinLine,{className:"h-3.5 w-3.5 text-text-destructive"})})})]},h)})})]})]})}),lO=K.memo(({readonly:a=!1,headers:b=[],onChange:c})=>{let{t:d}=(0,$.useTranslation)(),e=[{key:"name",title:d("nodes.triggerWebhook.varName",{ns:"workflow"}),type:"input",width:"flex-1",placeholder:d("nodes.triggerWebhook.varNamePlaceholder",{ns:"workflow"})},{key:"required",title:d("nodes.triggerWebhook.required",{ns:"workflow"}),type:"switch",width:"w-[88px]"}],f=b.map(a=>({name:a.name,required:a.required}));return(0,F.jsx)(lN,{title:"Header Parameters",columns:e,data:f,onChange:a=>{c(a.filter(a=>a.name&&"string"==typeof a.name&&""!==a.name.trim()).map(a=>({name:a.name||"",required:!!a.required})))},readonly:a,placeholder:d("nodes.triggerWebhook.noHeaders",{ns:"workflow"}),emptyRowData:{name:"",required:!1},showHeader:!0})}),lP=K.memo(({value:a,onChange:b,placeholder:c,disabled:d=!1,className:e})=>{let f=(0,K.useRef)(null),g=Math.max(3,(a?a.split("\n"):[""]).length);return(0,F.jsx)("div",{className:(0,S.cn)("rounded-xl bg-components-input-bg-normal px-3 pb-2 pt-3",e),children:(0,F.jsxs)("div",{className:"relative",children:[(0,F.jsx)("div",{className:"pointer-events-none absolute left-0 top-0 flex flex-col",children:Array.from({length:g},(a,b)=>(0,F.jsx)("span",{className:"flex h-[20px] select-none items-center font-mono text-xs leading-[20px] text-text-quaternary",children:String(b+1).padStart(2,"0")},b))}),(0,F.jsx)("textarea",{ref:f,value:a,onChange:a=>b(a.target.value),placeholder:c,disabled:d,className:"w-full resize-none border-0 bg-transparent pl-6 font-mono text-xs leading-[20px] text-text-secondary outline-none placeholder:text-text-quaternary",style:{minHeight:`${20*Math.max(3,g)}px`,lineHeight:"20px"},rows:Math.max(3,g)})]})})}),lQ=({title:a,parameters:b,onChange:c,readonly:d,placeholder:e,contentType:f})=>{let{t:g}=(0,$.useTranslation)(),h=(0,K.useMemo)(()=>(a=>{if(!a)return[aC.VarType.string,aC.VarType.number,aC.VarType.boolean];let b=(a||"").toLowerCase(),c=b in c7?b:"application/json";return[...c7[c].supportedTypes]})(f).map(a=>({name:c6[a],value:a})),[f]),i=[{key:"key",title:g("nodes.triggerWebhook.varName",{ns:"workflow"}),type:"input",width:"flex-1",placeholder:g("nodes.triggerWebhook.varNamePlaceholder",{ns:"workflow"})},{key:"type",title:g("nodes.triggerWebhook.varType",{ns:"workflow"}),type:"select",width:"w-[120px]",placeholder:g("nodes.triggerWebhook.varType",{ns:"workflow"}),options:h},{key:"required",title:g("nodes.triggerWebhook.required",{ns:"workflow"}),type:"switch",width:"w-[88px]"}],j=h[0]?.value||"string",k=b.map(a=>({key:a.name,type:a.type,required:a.required}));return(0,F.jsx)(lN,{title:a,columns:i,data:k,onChange:a=>{let b="text/plain"===(f||"").toLowerCase(),d="application/octet-stream"===(f||"").toLowerCase(),e=a.filter(a=>"string"==typeof a.key&&""!==a.key.trim()).map(a=>({name:String(a.key),type:b?aC.VarType.string:d?aC.VarType.file:(a=>{if(!a||"string"!=typeof a)return aC.VarType.string;let b=a.trim().toLowerCase();if("array[string]"===b)return aC.VarType.arrayString;if("array[number]"===b)return aC.VarType.arrayNumber;if("array[boolean]"===b)return aC.VarType.arrayBoolean;if("array[object]"===b)return aC.VarType.arrayObject;if("array"===b)return aC.VarType.arrayString;else if("number"===b)return aC.VarType.number;else if("boolean"===b)return aC.VarType.boolean;else if("object"===b)return aC.VarType.object;else if("file"===b)return aC.VarType.file;return aC.VarType.string})(a.type),required:!!a.required}));c(b||d?e.slice(0,1):e)},readonly:d,placeholder:e||g("nodes.triggerWebhook.noParameters",{ns:"workflow"}),emptyRowData:{key:"",type:j,required:!1},showHeader:!0})},lR={raw:0,param:1,header:2,body:3},lS=({prefix:a,name:b,type:c})=>(0,F.jsx)("div",{className:"py-1",children:(0,F.jsxs)("div",{className:"flex items-center leading-[18px]",children:[(0,F.jsxs)("span",{className:"code-sm-regular text-text-tertiary",children:[a,"."]}),(0,F.jsx)("span",{className:"code-sm-semibold text-text-secondary",children:b}),(0,F.jsx)("span",{className:"system-xs-regular ml-2 text-text-tertiary",children:c})]})}),lT=({variables:a=[]})=>{if(!a||0===a.length)return(0,F.jsx)("div",{className:"system-sm-regular py-2 text-text-tertiary",children:"No output variables"});let b=[...a].sort((a,b)=>{let c="string"==typeof a.label?a.label:"",d="string"==typeof b.label?b.label:"";return(lR[c]||999)-(lR[d]||999)});return(0,F.jsx)("div",{children:b.map((a,b)=>{let c="string"==typeof a.label?a.label:"",d="string"==typeof a.variable?a.variable:"";return(0,F.jsx)(lS,{prefix:{raw:"payload",param:"query_params",header:"header_params",body:"req_body_params"}[c]||c,name:d,type:a.value_type||"string"},`${c}-${d}-${b}`)})})},lU="nodes.triggerWebhook",lV=[{name:"GET",value:"GET"},{name:"POST",value:"POST"},{name:"PUT",value:"PUT"},{name:"DELETE",value:"DELETE"},{name:"PATCH",value:"PATCH"},{name:"HEAD",value:"HEAD"}],lW=[{name:"application/json",value:"application/json"},{name:"application/x-www-form-urlencoded",value:"application/x-www-form-urlencoded"},{name:"text/plain",value:"text/plain"},{name:"application/octet-stream",value:"application/octet-stream"},{name:"multipart/form-data",value:"multipart/form-data"}];var bs=bs;let lX=(0,K.memo)(({availableVars:a,variableAssignerNodeId:b,variableAssignerNodeData:c,handleId:d})=>{let[e,f]=(0,K.useState)(!1),{handleAssignVariableValueChange:g}=e7(),h=(0,K.useCallback)((a,c)=>{g(b,a,c,d),f(!1)},[g,b,d,f]);return(0,F.jsx)("div",{className:(0,S.cn)(e&&"!flex",c.selected&&"!flex"),children:(0,F.jsxs)(bh.PortalToFollowElem,{placement:"right",offset:4,open:e,onOpenChange:f,children:[(0,F.jsx)(bh.PortalToFollowElemTrigger,{onClick:()=>f(!e),children:(0,F.jsx)("div",{className:(0,S.cn)("group/addvariable flex items-center justify-center","h-4 w-4 cursor-pointer","hover:rounded-full hover:bg-primary-600",e&&"!rounded-full !bg-primary-600"),children:(0,F.jsx)(bs.default,{className:(0,S.cn)("h-2.5 w-2.5 text-text-tertiary","group-hover/addvariable:text-text-primary",e&&"!text-text-primary")})})}),(0,F.jsx)(bh.PortalToFollowElemContent,{className:"z-[1000]",children:(0,F.jsx)(fb,{onSelect:h,availableVars:a})})]})})}),lY=(0,K.memo)(({item:a})=>{let{t:b}=(0,$.useTranslation)(),c=(0,aP.useStore)(a=>a.enteringNodePayload),d=(0,aP.useStore)(a=>a.hoveringAssignVariableGroupId),e=(0,N.useNodes)(),{handleGroupItemMouseEnter:f,handleGroupItemMouseLeave:g}=e7(),h=e8(),i=a.groupEnabled,j=(0,K.useMemo)(()=>{if(!i)return a.variableAssignerNodeData.output_type;let b=a.variableAssignerNodeData.advanced_settings?.groups.find(b=>b.groupId===a.targetHandleId);return b?.output_type||""},[a.variableAssignerNodeData,a.targetHandleId,i]),k=h(a.variableAssignerNodeId,a.targetHandleId,e9(j),!0),l=(0,K.useMemo)(()=>{if(i&&c?.nodeId===a.variableAssignerNodeId)if(d)return d!==a.targetHandleId;else return c?.nodeData.advanced_settings?.groups[0].groupId!==a.targetHandleId;return!1},[c,i,d,a.targetHandleId,a.variableAssignerNodeId]),m=(0,K.useMemo)(()=>{if(i&&c?.nodeId===a.variableAssignerNodeId)if(d)return d===a.targetHandleId;else return c?.nodeData.advanced_settings?.groups[0].groupId===a.targetHandleId;return!1},[c,i,d,a.targetHandleId,a.variableAssignerNodeId]);return(0,F.jsxs)("div",{className:(0,S.cn)("relative rounded-lg border-[1.5px] border-transparent px-1.5 pb-1.5 pt-1",l&&"!border-dashed !border-divider-subtle bg-state-base-hover",m&&"!border-text-accent !bg-util-colors-blue-blue-50"),onMouseEnter:()=>i&&f(a.targetHandleId),onMouseLeave:g,children:[(0,F.jsxs)("div",{className:"flex h-4 items-center justify-between text-[10px] font-medium text-text-tertiary",children:[(0,F.jsx)("span",{className:(0,S.cn)("grow truncate uppercase",m&&"text-text-accent"),title:a.title,children:a.title}),(0,F.jsxs)("div",{className:"flex items-center",children:[(0,F.jsx)("span",{className:"ml-2 shrink-0",children:a.type}),(0,F.jsx)("div",{className:"ml-2 mr-1 h-2.5 w-[1px] bg-divider-regular"}),(0,F.jsx)(lX,{availableVars:k,variableAssignerNodeId:a.variableAssignerNodeId,variableAssignerNodeData:a.variableAssignerNodeData,handleId:a.targetHandleId})]})]}),!a.variables.length&&(0,F.jsx)("div",{className:(0,S.cn)("relative flex h-[22px] items-center justify-between space-x-1 rounded-md bg-workflow-block-parma-bg px-1 text-[10px] font-normal uppercase text-text-tertiary",(m||l)&&"!bg-black/[0.02]"),children:b("nodes.variableAssigner.varNotSet",{ns:"workflow"})}),!!a.variables.length&&(0,F.jsx)("div",{className:"space-y-0.5",children:a.variables.map((a=[],b)=>{let c=(0,bY.isSystemVar)(a),d=c?e.find(a=>a.data.type===aC.BlockEnum.Start):e.find(b=>b.id===a[0]),f=c?`sys.${a[a.length-1]}`:a.slice(1).join("."),g=(0,hX.isExceptionVariable)(f,d?.data.type);return(0,F.jsx)(gv.VariableLabelInNode,{variables:a,nodeType:d?.data.type,nodeTitle:d?.data.title,isExceptionVariable:g},b)})})]})}),lZ=(0,K.memo)(a=>{let{t:b}=(0,$.useTranslation)(),c=(0,K.useRef)(null),{id:d,data:e}=a,{advanced_settings:f}=e,g=(0,K.useMemo)(()=>f?.group_enabled?f.groups.map(a=>({groupEnabled:!0,targetHandleId:a.groupId,title:a.group_name,type:a.output_type,variables:a.variables,variableAssignerNodeId:d,variableAssignerNodeData:e})):[{groupEnabled:!1,targetHandleId:"target",title:b("nodes.variableAssigner.title",{ns:"workflow"}),type:e.output_type,variables:e.variables,variableAssignerNodeId:d,variableAssignerNodeData:e}],[b,f,e,d]);return(0,F.jsx)("div",{className:"relative mb-1 space-y-0.5 px-1",ref:c,children:g.map(a=>(0,F.jsx)(lY,{item:a},a.title))})});var l$=a.i(895233),l$=l$,l_=ds;let l0=K.memo(({readonly:a,nodeId:b,list:c,onChange:d,onOpen:e=l_.noop,filterVar:f})=>{let{t:g}=(0,$.useTranslation)(),h=(0,K.useCallback)(a=>b=>{d((0,I.produce)(c,c=>{c[a]=b}),b)},[c,d]),i=(0,K.useCallback)(a=>()=>{d((0,I.produce)(c,b=>{b.splice(a,1)}))},[c,d]),j=(0,K.useCallback)(a=>()=>e(a),[e]);return 0===c.length?(0,F.jsx)(gz,{children:g("nodes.variableAssigner.noVarTip",{ns:"workflow"})}):(0,F.jsx)("div",{className:"space-y-2",children:c.map((c,d)=>(0,F.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,F.jsx)(gA.default,{readonly:a,nodeId:b,isShowNodeName:!0,className:"grow",value:c,onChange:h(d),onOpen:j(d),filterVar:f,defaultVarKindType:eF.VarType.variable}),!a&&(0,F.jsx)(gL.default,{onClick:i(d)})]},d))})}),l1=K.memo(({readOnly:a,nodeId:b,payload:c,onChange:d,groupEnabled:e,onGroupNameChange:f,canRemove:g,onRemove:h,availableVars:i})=>{let{t:j}=(0,$.useTranslation)(),k=(0,K.useCallback)((a,b,e)=>{c.variables.some(b=>b.join(".")===a.join("."))||d((0,I.produce)(c,b=>{b.variables.push(a),e&&e.type!==aC.VarType.any&&(b.output_type=e.type)}))},[d,c]),l=(0,K.useCallback)((a,b)=>{b&&c.variables.some(a=>a.join(".")===b.join("."))||d((0,I.produce)(c,b=>{b.variables=a,0===a.length&&(b.output_type=aC.VarType.any)}))},[d,c]),m=(0,K.useCallback)(a=>c.output_type===aC.VarType.any||a.type===c.output_type,[c.output_type]),[n,{setTrue:o,setFalse:p}]=(0,a8.useBoolean)(!1),q=(0,K.useCallback)(a=>{(0,by.replaceSpaceWithUnderscoreInVarNameInput)(a.target);let b=a.target.value,{isValid:c,errorKey:d,errorMessageKey:e}=(0,by.checkKeys)([b],!1);c?f?.(b):aX.default.notify({type:"error",message:j(`varKeyError.${e}`,{ns:"appDebug",key:d})})},[f,j]);return(0,F.jsx)(fW,{className:"group",title:e?(0,F.jsxs)("div",{className:"flex items-center",children:[(0,F.jsxs)("div",{className:"flex items-center !normal-case",children:[(0,F.jsx)(l$.default,{className:"mr-0.5 h-3.5 w-3.5"}),n?(0,F.jsx)("input",{type:"text",className:"h-6 rounded-lg border border-gray-300 bg-white px-1 focus:outline-none",size:c.group_name?.length,autoFocus:!0,value:c.group_name,onChange:q,onBlur:p,maxLength:30}):(0,F.jsx)("div",{className:"system-sm-semibold flex h-6 cursor-text items-center rounded-lg px-1 text-text-secondary hover:bg-gray-100",onClick:o,children:c.group_name})]}),g&&(0,F.jsx)("div",{className:"ml-0.5 hidden cursor-pointer rounded-md p-1 text-text-tertiary hover:bg-state-destructive-hover hover:text-text-destructive group-hover:block",onClick:h,children:(0,F.jsx)(Y.RiDeleteBinLine,{className:"h-4 w-4"})})]}):j("nodes.variableAssigner.title",{ns:"workflow"}),operations:(0,F.jsxs)("div",{className:"flex h-6 items-center  space-x-2",children:[c.variables.length>0&&(0,F.jsx)("div",{className:"system-2xs-medium-uppercase flex h-[18px] items-center rounded-[5px] border border-divider-deep px-1 text-text-tertiary",children:c.output_type}),a?void 0:(0,F.jsx)(gA.default,{isAddBtnTrigger:!0,readonly:!1,nodeId:b,isShowNodeName:!0,value:[],onChange:k,defaultVarKindType:eF.VarType.variable,filterVar:m,availableVars:i})]}),children:(0,F.jsx)(l0,{readonly:a,nodeId:b,list:c.variables,onChange:l,filterVar:m})})}),l2="nodes.variableAssigner",l3=K.memo(({id:a,data:b})=>{let{t:c}=(0,$.useTranslation)(),{readOnly:d,inputs:e,handleListOrTypeChange:f,isEnableGroup:g,handleGroupEnabledChange:h,handleAddGroup:i,handleListOrTypeChangeInGroup:j,handleGroupRemoved:k,handleVarGroupNameChange:l,isShowRemoveVarConfirm:m,hideRemoveVarConfirm:n,onRemoveVarConfirm:o,getAvailableVars:p,filterVar:q}=((a,b)=>{let{deleteNodeInspectorVars:c,renameInspectVarName:d}=(0,at.default)(),{nodesReadOnly:e}=(0,aq.useNodesReadOnly)(),{handleOutVarRenameChange:f,isVarUsedInNodes:g,removeUsedVarInNodes:h}=(0,aq.useWorkflow)(),{inputs:i,setInputs:j}=eA(a,b),k=!!i.advanced_settings?.group_enabled,l=(0,K.useCallback)(a=>{j({...i,...a})},[i,j]),m=(0,K.useCallback)(a=>b=>{let c=i.advanced_settings.groups.findIndex(b=>b.groupId===a);j((0,I.produce)(i,a=>{a.advanced_settings.groups[c]={...a.advanced_settings.groups[c],...b}}))},[i,j]),n=e8(),[o,{setTrue:p,setFalse:q}]=(0,a8.useBoolean)(!1),[r,s]=(0,K.useState)([]),[t,u]=(0,K.useState)("group"),[v,w]=(0,K.useState)(-1),x=(0,K.useCallback)(b=>()=>{let c=i.advanced_settings.groups.findIndex(a=>a.groupId===b);if(g([a,i.advanced_settings.groups[c].group_name,"output"])){p(),s([[a,i.advanced_settings.groups[c].group_name,"output"]]),u("group"),w(c);return}j((0,I.produce)(i,a=>{a.advanced_settings.groups.splice(c,1)}))},[a,i,g,j,p]),y=(0,K.useCallback)(b=>{j((0,I.produce)(i,c=>{if(c.advanced_settings||(c.advanced_settings={group_enabled:!1,groups:[]}),b){if(0===c.advanced_settings.groups.length){let b="Group1";c.advanced_settings.groups=[{output_type:c.output_type,variables:c.variables,group_name:b,groupId:(0,du.v4)()}],f(a,[a,"output"],[a,b,"output"])}}else if(c.advanced_settings.groups.length>0){if(c.advanced_settings.groups.length>1){let b=c.advanced_settings.groups.filter((b,c)=>c>0&&g([a,b.group_name,"output"]));if(b.length>0){p(),s(b.map(b=>[a,b.group_name,"output"])),u("enableChanged");return}}c.output_type=c.advanced_settings.groups[0].output_type,c.variables=c.advanced_settings.groups[0].variables,f(a,[a,c.advanced_settings.groups[0].group_name,"output"],[a,"output"])}c.advanced_settings.group_enabled=b})),c(a)},[c,f,a,i,g,j,p]),z=(0,K.useCallback)(()=>{let b=1;i.advanced_settings.groups.forEach(a=>{let c=/(\d+)$/.exec(a.group_name);if(c){let a=Number.parseInt(c[1],10);a>b&&(b=a)}}),j((0,I.produce)(i,a=>{a.advanced_settings.groups.push({output_type:aC.VarType.any,variables:[],group_name:`Group${b+1}`,groupId:(0,du.v4)()})})),c(a)},[c,a,i,j]),A=(0,K.useRef)({}),{run:B}=(0,gK.useDebounceFn)((a,b)=>{let c=A.current[a];d(a,c,b),delete A.current[a]},{wait:500}),C=(0,K.useCallback)(b=>c=>{let d=i.advanced_settings.groups.findIndex(a=>a.groupId===b),e=(0,I.produce)(i,a=>{a.advanced_settings.groups[d].group_name=c});f(a,[a,i.advanced_settings.groups[d].group_name,"output"],[a,c,"output"]),j(e),a in A.current||(A.current[a]=i.advanced_settings.groups[d].group_name),B(a,c)},[f,a,i,B,j]),D=(0,K.useCallback)(()=>{r.forEach(a=>{h(a)}),q(),"group"===t?j((0,I.produce)(i,a=>{a.advanced_settings.groups.splice(v,1)})):j((0,I.produce)(i,a=>{a.advanced_settings.group_enabled=!1,a.output_type=a.advanced_settings.groups[0].output_type,a.variables=a.advanced_settings.groups[0].variables}))},[r,q,t,h,i,j,v]);return{readOnly:e,inputs:i,handleListOrTypeChange:l,isEnableGroup:k,handleGroupEnabledChange:y,handleAddGroup:z,handleListOrTypeChangeInGroup:m,handleGroupRemoved:x,handleVarGroupNameChange:C,isShowRemoveVarConfirm:o,hideRemoveVarConfirm:q,onRemoveVarConfirm:D,getAvailableVars:n,filterVar:a=>b=>a===aC.VarType.any||b.type===aC.VarType.any||b.type===a}})(a,b);return(0,F.jsxs)("div",{className:"mt-2",children:[(0,F.jsx)("div",{className:"space-y-4 px-4 pb-4",children:g?(0,F.jsxs)("div",{children:[(0,F.jsx)("div",{className:"space-y-2",children:e.advanced_settings?.groups.map((b,c)=>(0,F.jsxs)("div",{children:[(0,F.jsx)(l1,{readOnly:d,nodeId:a,payload:b,onChange:j(b.groupId),groupEnabled:!0,canRemove:!d&&e.advanced_settings?.groups.length>1,onRemove:k(b.groupId),onGroupNameChange:l(b.groupId),availableVars:p(a,b.groupId,q(b.output_type),!0)}),c!==e.advanced_settings?.groups.length-1&&(0,F.jsx)(au,{className:"my-4"})]},b.groupId))}),(0,F.jsx)(jx,{className:"mt-2",text:c(`${l2}.addGroup`,{ns:"workflow"}),onClick:i})]}):(0,F.jsx)(l1,{readOnly:d,nodeId:a,payload:{output_type:e.output_type,variables:e.variables},onChange:f,groupEnabled:!1,availableVars:p(a,"target",q(e.output_type),!0)})}),(0,F.jsx)(au,{}),(0,F.jsx)("div",{className:(0,S.cn)("px-4 pt-4",g?"pb-4":"pb-2"),children:(0,F.jsx)(fW,{title:c(`${l2}.aggregationGroup`,{ns:"workflow"}),tooltip:c(`${l2}.aggregationGroupTip`,{ns:"workflow"}),operations:(0,F.jsx)(d4.default,{defaultValue:g,onChange:h,size:"md",disabled:d})})}),g&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(au,{}),(0,F.jsx)(gj,{children:(0,F.jsx)(F.Fragment,{children:e.advanced_settings?.groups.map((a,b)=>(0,F.jsx)(gi,{name:`${a.group_name}.output`,type:a.output_type,description:c(`${l2}.outputVars.varDescribe`,{ns:"workflow",groupName:a.group_name})},b))})})]}),(0,F.jsx)(gU,{isShow:m,onCancel:n,onConfirm:o})]})}),l4={[aC.BlockEnum.Start]:k2,[aC.BlockEnum.End]:hi,[aC.BlockEnum.Answer]:gt,[aC.BlockEnum.LLM]:jp,[aC.BlockEnum.KnowledgeRetrieval]:iV,[aC.BlockEnum.QuestionClassifier]:kT,[aC.BlockEnum.IfElse]:hS,[aC.BlockEnum.Code]:gH,[aC.BlockEnum.TemplateTransform]:la,[aC.BlockEnum.HttpRequest]:hk,[aC.BlockEnum.Tool]:ld,[aC.BlockEnum.VariableAssigner]:lZ,[aC.BlockEnum.Assigner]:gx,[aC.BlockEnum.VariableAggregator]:lZ,[aC.BlockEnum.ParameterExtractor]:kC,[aC.BlockEnum.Iteration]:id,[aC.BlockEnum.Loop]:ka,[aC.BlockEnum.DocExtractor]:hd,[aC.BlockEnum.ListFilter]:jd,[aC.BlockEnum.Agent]:fG,[aC.BlockEnum.DataSource]:g$,[aC.BlockEnum.KnowledgeBase]:ik,[aC.BlockEnum.TriggerSchedule]:lw,[aC.BlockEnum.TriggerWebhook]:lH,[aC.BlockEnum.TriggerPlugin]:lq},l5={[aC.BlockEnum.Start]:k9,[aC.BlockEnum.End]:hj,[aC.BlockEnum.Answer]:gu,[aC.BlockEnum.LLM]:j6,[aC.BlockEnum.KnowledgeRetrieval]:jc,[aC.BlockEnum.QuestionClassifier]:k0,[aC.BlockEnum.IfElse]:h9,[aC.BlockEnum.Code]:gY,[aC.BlockEnum.TemplateTransform]:lc,[aC.BlockEnum.HttpRequest]:hO,[aC.BlockEnum.Tool]:lf,[aC.BlockEnum.VariableAssigner]:l3,[aC.BlockEnum.VariableAggregator]:l3,[aC.BlockEnum.Assigner]:gG,[aC.BlockEnum.ParameterExtractor]:kR,[aC.BlockEnum.Iteration]:ig,[aC.BlockEnum.Loop]:kB,[aC.BlockEnum.DocExtractor]:hh,[aC.BlockEnum.ListFilter]:jo,[aC.BlockEnum.Agent]:go,[aC.BlockEnum.DataSource]:hc,[aC.BlockEnum.KnowledgeBase]:iU,[aC.BlockEnum.TriggerSchedule]:lG,[aC.BlockEnum.TriggerWebhook]:({id:a,data:b})=>{let{t:c}=(0,$.useTranslation)(),[d,e]=K.useState(!1),[f,g]=(0,K.useState)(!1),{readOnly:h,inputs:i,handleMethodChange:j,handleContentTypeChange:k,handleHeadersChange:l,handleParamsChange:m,handleBodyChange:n,handleStatusCodeChange:o,handleStatusCodeBlur:p,handleResponseBodyChange:q,generateWebhookUrl:r}=((a,b)=>{let{t:c}=(0,$.useTranslation)(),{nodesReadOnly:d}=(0,aq.useNodesReadOnly)(),{inputs:e,setInputs:f}=eA(a,b),g=aa.useStore.getState().appDetail?.id,{isVarUsedInNodes:h,removeUsedVarInNodes:i}=(0,aq.useWorkflow)(),j=(0,K.useCallback)(a=>{f((0,I.produce)(e,b=>{b.method=a}))},[e,f]),k=(0,K.useCallback)(b=>{f((0,I.produce)(e,c=>{let d=c.content_type;c.content_type=b,d!==b&&(c.body=[],c.variables&&(c.variables.filter(a=>"body"===a.label).forEach(b=>{h([a,b.variable])&&i([a,b.variable])}),c.variables=c.variables.filter(a=>"body"!==a.label)))}))},[e,f,a,h,i]),l=(0,K.useCallback)((b,d,e)=>{b.variables||(b.variables=[]);let f=d.map(a=>({item:a,sanitizedName:"header"===e?a.name.replace(/-/g,"_"):a.name}));if(f.some(a=>a.sanitizedName===c9))return aX.default.notify({type:"error",message:c("varKeyError.keyAlreadyExists",{ns:"appDebug",key:c("variableConfig.varName",{ns:"appDebug"})})}),!1;let g=new Set(b.variables.filter(a=>a.label!==e&&a.variable!==c9).map(a=>a.variable)),j=f.find(a=>g.has(a.sanitizedName));if(j)return aX.default.notify({type:"error",message:c("varKeyError.keyAlreadyExists",{ns:"appDebug",key:j.sanitizedName})}),!1;if((0,by.hasDuplicateStr)(f.map(a=>a.sanitizedName)))return aX.default.notify({type:"error",message:c("varKeyError.keyAlreadyExists",{ns:"appDebug",key:c("variableConfig.varName",{ns:"appDebug"})})}),!1;for(let{sanitizedName:a}of f){let{isValid:b,errorMessageKey:d}=(0,by.checkKeys)([a],!1);if(!b)return aX.default.notify({type:"error",message:c(`varKeyError.${d}`,{ns:"appDebug",key:c("variableConfig.varName",{ns:"appDebug"})})}),!1}let k=new Set(f.map(a=>a.sanitizedName));return b.variables.filter(a=>a.label===e&&!k.has(a.variable)).forEach(b=>{h([a,b.variable])&&i([a,b.variable])}),b.variables=b.variables.filter(a=>a.label!==e||k.has(a.variable)),f.forEach(({item:a,sanitizedName:c})=>{let d=b.variables.findIndex(a=>a.variable===c),f={value_type:"type"in a?a.type:aC.VarType.string,label:e,variable:c,value_selector:[],required:a.required};d>=0?b.variables[d]=f:b.variables.push(f)}),!0},[c,a,h,i]),m=(0,K.useCallback)(a=>{f((0,I.produce)(e,b=>{b.params=a,l(b,a,"param")}))},[e,f,l]),n=(0,K.useCallback)(a=>{f((0,I.produce)(e,b=>{b.headers=a,l(b,a,"header")}))},[e,f,l]),o=(0,K.useCallback)(a=>{f((0,I.produce)(e,b=>{b.body=a,l(b,a,"body")}))},[e,f,l]),p=(0,K.useCallback)(a=>{f((0,I.produce)(e,b=>{b.async_mode=a}))},[e,f]),q=(0,K.useCallback)(a=>{f((0,I.produce)(e,b=>{b.status_code=a}))},[e,f]),r=(0,K.useCallback)(a=>{let b=Math.min(Math.max(a,200),399);f((0,I.produce)(e,a=>{a.status_code=b}))},[e,f]),s=(0,K.useCallback)(a=>{f((0,I.produce)(e,b=>{b.response_body=a}))},[e,f]),t=(0,K.useCallback)(async()=>{if((!e.webhook_url||!(e.webhook_url.length>0))&&g)try{let b=await (0,df.fetchWebhookUrl)({appId:g,nodeId:a}),c=(0,I.produce)(e,a=>{a.webhook_url=b.webhook_url,a.webhook_debug_url=b.webhook_debug_url});f(c)}catch(a){console.error("Failed to generate webhook URL:",a),f((0,I.produce)(e,a=>{a.webhook_url=""}))}},[g,a,e,f]);return{readOnly:d,inputs:e,setInputs:f,handleMethodChange:j,handleContentTypeChange:k,handleHeadersChange:n,handleParamsChange:m,handleBodyChange:o,handleAsyncModeChange:p,handleStatusCodeChange:q,handleStatusCodeBlur:r,handleResponseBodyChange:s,generateWebhookUrl:t}})(a,b),s=(0,K.useRef)(!1);return(0,K.useEffect)(()=>{h||i.webhook_url||s.current||(s.current=!0,r())},[h,i.webhook_url,r]),(0,F.jsxs)("div",{className:"mt-2",children:[(0,F.jsxs)("div",{className:"space-y-4 px-4 pb-3 pt-2",children:[(0,F.jsx)(fW,{title:c(`${lU}.webhookUrl`,{ns:"workflow"}),children:(0,F.jsxs)("div",{className:"space-y-1",children:[(0,F.jsxs)("div",{className:"flex gap-1",style:{height:"32px"},children:[(0,F.jsx)("div",{className:"w-26 shrink-0",children:(0,F.jsx)(a4.SimpleSelect,{items:lV,defaultValue:i.method,onSelect:a=>j(a.value),disabled:h,className:"h-8 pr-8 text-sm",wrapperClassName:"h-8",optionWrapClassName:"w-26 min-w-26 z-[5]",allowSearch:!1,notClearable:!0})}),(0,F.jsx)("div",{className:"flex-1",style:{width:"284px"},children:(0,F.jsx)(lK,{value:i.webhook_url||"",placeholder:c(`${lU}.webhookUrlPlaceholder`,{ns:"workflow"}),readOnly:!0,onCopy:()=>{aX.default.notify({type:"success",message:c(`${lU}.urlCopied`,{ns:"workflow"})})}})})]}),i.webhook_debug_url&&(0,F.jsxs)("div",{className:"space-y-2",children:[(0,F.jsx)(ac.default,{popupContent:d?c(`${lU}.debugUrlCopied`,{ns:"workflow"}):c(`${lU}.debugUrlCopy`,{ns:"workflow"}),popupClassName:"system-xs-regular text-text-primary bg-components-tooltip-bg border border-components-panel-border shadow-lg backdrop-blur-sm rounded-md px-1.5 py-1",position:"top",offset:{mainAxis:-20},needsDelay:!0,children:(0,F.jsxs)("div",{className:"flex cursor-pointer gap-1.5 rounded-lg px-1 py-1.5 transition-colors",style:{width:"368px",height:"38px"},onClick:()=>{(0,e1.default)(i.webhook_debug_url||""),e(!0),setTimeout(()=>e(!1),2e3)},children:[(0,F.jsx)("div",{className:"mt-0.5 w-0.5 bg-divider-regular",style:{height:"28px"}}),(0,F.jsxs)("div",{className:"flex-1",style:{width:"352px",height:"32px"},children:[(0,F.jsx)("div",{className:"text-xs leading-4 text-text-tertiary",children:c(`${lU}.debugUrlTitle`,{ns:"workflow"})}),(0,F.jsx)("div",{className:"truncate text-xs leading-4 text-text-primary",children:i.webhook_debug_url})]})]})}),(0,lL.isPrivateOrLocalAddress)(i.webhook_debug_url)&&(0,F.jsx)("div",{className:"system-xs-regular mt-1 px-0 py-[2px] text-text-warning",children:c(`${lU}.debugUrlPrivateAddressWarning`,{ns:"workflow"})})]})]})}),(0,F.jsx)(fW,{title:c(`${lU}.contentType`,{ns:"workflow"}),children:(0,F.jsx)("div",{className:"w-full",children:(0,F.jsx)(a4.SimpleSelect,{items:lW,defaultValue:i.content_type,onSelect:a=>k(a.value),disabled:h,className:"h-8 text-sm",wrapperClassName:"h-8",optionWrapClassName:"min-w-48 z-[5]",allowSearch:!1,notClearable:!0})})}),(0,F.jsx)(lQ,{readonly:h,title:"Query Parameters",parameters:i.params,onChange:m,placeholder:c(`${lU}.noQueryParameters`,{ns:"workflow"})}),(0,F.jsx)(lO,{readonly:h,headers:i.headers,onChange:l}),(0,F.jsx)(lQ,{readonly:h,title:"Request Body Parameters",parameters:i.body,onChange:n,placeholder:c(`${lU}.noBodyParameters`,{ns:"workflow"}),contentType:i.content_type}),(0,F.jsx)(au,{}),(0,F.jsx)(fW,{title:c(`${lU}.responseConfiguration`,{ns:"workflow"}),children:(0,F.jsxs)("div",{className:"space-y-3",children:[(0,F.jsxs)("div",{className:"flex items-center justify-between",children:[(0,F.jsx)("label",{className:"system-sm-medium text-text-tertiary",children:c(`${lU}.statusCode`,{ns:"workflow"})}),(0,F.jsx)(fJ.InputNumber,{value:i.status_code,onChange:a=>{o(a||200)},disabled:h,wrapClassName:"w-[120px]",className:"h-8",defaultValue:200,onBlur:()=>{p(i.status_code)}})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"system-sm-medium mb-2 block text-text-tertiary",children:c(`${lU}.responseBody`,{ns:"workflow"})}),(0,F.jsx)(lP,{value:i.response_body,onChange:q,placeholder:c(`${lU}.responseBodyPlaceholder`,{ns:"workflow"}),disabled:h})]})]})})]}),(0,F.jsx)(au,{}),(0,F.jsx)("div",{className:"",children:(0,F.jsx)(gj,{collapsed:f,onCollapse:g,children:(0,F.jsx)(lT,{variables:i.variables})})})]})},[aC.BlockEnum.TriggerPlugin]:lv},l6=a=>{let b=a.data,c=(0,K.useMemo)(()=>l4[b.type],[b.type]);return(0,F.jsx)(F.Fragment,{children:(0,F.jsx)(ft,{id:a.id,data:a.data,children:(0,F.jsx)(c,{})})})};l6.displayName="CustomNode";let l7=(0,K.memo)(a=>{let b=a.type,c=a.data,d=(0,K.useMemo)(()=>b===T.CUSTOM_NODE?l5[c.type]:()=>null,[b,c.type]);return b===T.CUSTOM_NODE?(0,F.jsx)(e$,{id:a.id,data:a.data,children:(0,F.jsx)(d,{})},a.id):null});l7.displayName="Panel";let l8=(0,K.memo)(l6);a.s(["Panel",0,l7,"default",0,l8],257540);var l9=a.i(192038),ma=a.i(262717);a.i(727323);var mb=a.i(747867),mc=a.i(11364),md=a.i(735117),md=md;let me=()=>(0,F.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",children:(0,F.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 9.75V6H13.5V9.75C13.5 11.8211 11.8211 13.5 9.75 13.5H6V12H9.75C10.9926 12 12 10.9926 12 9.75Z",fill:"black",fillOpacity:"0.16"})}),mf=(0,K.memo)(({id:a,data:b})=>{let{t:c}=(0,$.useTranslation)(),d=(0,aP.useStore)(a=>a.controlPromptEditorRerenderKey),e=(0,K.useRef)(null),f=b.theme,{handleThemeChange:g,handleEditorChange:h,handleShowAuthorChange:i}=(a=>{let{handleNodeDataUpdateWithSyncDraft:b}=(0,ao.useNodeDataUpdate)(),{saveStateToHistory:c}=(0,X.useWorkflowHistory)(),d=(0,K.useCallback)(d=>{b({id:a,data:{theme:d}}),c(X.WorkflowHistoryEvent.NoteChange,{nodeId:a})},[b,a,c]);return{handleThemeChange:d,handleEditorChange:(0,K.useCallback)(c=>{c?.isEmpty()?b({id:a,data:{text:""}}):b({id:a,data:{text:JSON.stringify(c)}})},[b,a]),handleShowAuthorChange:(0,K.useCallback)(d=>{b({id:a,data:{showAuthor:d}}),c(X.WorkflowHistoryEvent.NoteChange,{nodeId:a})},[b,a,c])}})(a),{handleNodesCopy:j,handleNodesDuplicate:k,handleNodeDelete:l}=(0,V.useNodesInteractions)(),{handleNodeDataUpdateWithSyncDraft:m}=(0,ao.useNodeDataUpdate)();(0,e4.useClickAway)(()=>{m({id:a,data:{selected:!1}})},e);let{setShortcutsEnabled:n}=(0,l9.useWorkflowHistoryStore)();return(0,F.jsx)("div",{className:(0,S.cn)("relative flex flex-col rounded-md border shadow-xs hover:shadow-md",ma.THEME_MAP[f].bg,b.selected?ma.THEME_MAP[f].border:"border-black/5"),style:{width:b.width,height:b.height},ref:e,children:(0,F.jsx)(mc.NoteEditorContextProvider,{value:b.text,editable:!b._isTempNode,children:(0,F.jsxs)(F.Fragment,{children:[!b._isTempNode&&(0,F.jsx)(fr,{nodeId:a,nodeData:b,icon:(0,F.jsx)(me,{}),minWidth:240,minHeight:88}),(0,F.jsx)("div",{className:(0,S.cn)("h-2 shrink-0 rounded-t-md opacity-50",ma.THEME_MAP[f].title)}),b.selected&&!b._isTempNode&&(0,F.jsx)("div",{className:"absolute left-1/2 top-[-41px] -translate-x-1/2",children:(0,F.jsx)(md.default,{theme:f,onThemeChange:g,onCopy:()=>j(a),onDuplicate:()=>k(a),onDelete:()=>l(a),showAuthor:b.showAuthor,onShowAuthorChange:i})}),(0,F.jsx)("div",{className:"grow overflow-y-auto px-3 py-2.5",children:(0,F.jsx)("div",{className:(0,S.cn)(b.selected&&"nodrag nopan nowheel cursor-text"),children:(0,F.jsx)(mb.NoteEditor,{containerElement:e.current,placeholder:c("nodes.note.editor.placeholder",{ns:"workflow"})||"",onChange:h,setShortcutsEnabled:n})})}),b.showAuthor&&(0,F.jsx)("div",{className:"p-3 pt-0 text-xs text-text-tertiary",children:b.author})]})},d)})}),mg=(0,K.memo)(({candidateNode:a})=>{let b=(0,N.useStoreApi)(),c=(0,N.useReactFlow)(),d=(0,aP.useWorkflowStore)(),e=(0,aP.useStore)(a=>a.mousePosition),{zoom:f}=(0,N.useViewport)(),{handleNodeSelect:g}=(0,V.useNodesInteractions)(),{saveStateToHistory:h}=(0,X.useWorkflowHistory)(),{handleSyncWorkflowDraft:i}=(0,W.useNodesSyncDraft)(),j=(0,U.useAutoGenerateWebhookUrl)();return(0,G.default)("click",f=>{f.preventDefault();let{getNodes:k,setNodes:l}=b.getState(),{screenToFlowPosition:m}=c,n=k(),{x:o,y:p}=m({x:e.pageX,y:e.pageY});l((0,I.produce)(n,b=>{b.push({...a,data:{...a.data,_isCandidate:!1},position:{x:o,y:p}}),a.data.type===aC.BlockEnum.Iteration&&b.push((0,aR.getIterationStartNode)(a.id)),a.data.type===aC.BlockEnum.Loop&&b.push((0,aR.getLoopStartNode)(a.id))})),a.type===ma.CUSTOM_NOTE_NODE?h(X.WorkflowHistoryEvent.NoteAdd,{nodeId:a.id}):h(X.WorkflowHistoryEvent.NodeAdd,{nodeId:a.id}),d.setState({candidateNode:void 0}),a.type===ma.CUSTOM_NOTE_NODE&&g(a.id),a.data.type===aC.BlockEnum.TriggerWebhook&&i(!0,!0,{onSuccess:()=>j(a.id)})}),(0,G.default)("contextmenu",a=>{a.preventDefault(),d.setState({candidateNode:void 0})}),(0,F.jsxs)("div",{className:"absolute z-10",style:{left:e.elementX,top:e.elementY,transform:`scale(${f})`,transformOrigin:"0 0"},children:[a.type===T.CUSTOM_NODE&&(0,F.jsx)(l8,{...a}),a.type===ma.CUSTOM_NOTE_NODE&&(0,F.jsx)(mf,{...a})]})}),mh=(0,K.memo)(()=>{let a=(0,aP.useStore)(a=>a.candidateNode);return a?(0,F.jsx)(mg,{candidateNode:a}):null});var mi=a.i(665982),mj=a.i(113168),mk=a.i(753066);let ml=(0,K.memo)(({id:a,data:b,source:c,sourceHandleId:d,target:e,targetHandleId:f,sourceX:g,sourceY:h,targetX:i,targetY:j,selected:k})=>{let[l,m,n]=(0,N.getBezierPath)({sourceX:g-8,sourceY:h,sourcePosition:N.Position.Right,targetX:i+8,targetY:j,targetPosition:N.Position.Left,curvature:.16}),[o,p]=(0,K.useState)(!1),{handleNodeAdd:q}=(0,V.useNodesInteractions)(),{availablePrevBlocks:r}=(0,an.useAvailableBlocks)(b.targetType,b?.isInIteration||b?.isInLoop),{availableNextBlocks:s}=(0,an.useAvailableBlocks)(b.sourceType,b?.isInIteration||b?.isInLoop),{_sourceRunningStatus:t,_targetRunningStatus:u}=b,v=(0,K.useMemo)(()=>{if((t===aC.NodeRunningStatus.Succeeded||t===aC.NodeRunningStatus.Failed||t===aC.NodeRunningStatus.Exception)&&(u===aC.NodeRunningStatus.Succeeded||u===aC.NodeRunningStatus.Failed||u===aC.NodeRunningStatus.Exception||u===aC.NodeRunningStatus.Running))return a},[t,u,a]),w=(0,K.useCallback)(a=>{p(a)},[]),x=(0,K.useCallback)((a,b)=>{q({nodeType:a,pluginDefaultValue:b},{prevNodeId:c,prevNodeSourceHandle:d||"source",nextNodeId:e,nextNodeTargetHandle:f||"target"})},[q,c,d,e,f]),y=(0,K.useMemo)(()=>k?(0,mk.getEdgeColor)(aC.NodeRunningStatus.Running):v?`url(#${v})`:b?._connectedNodeIsHovering?(0,mk.getEdgeColor)(aC.NodeRunningStatus.Running,d===bi.ErrorHandleTypeEnum.failBranch):(0,mk.getEdgeColor)(),[b._connectedNodeIsHovering,v,k,d]);return(0,F.jsxs)(F.Fragment,{children:[v&&(0,F.jsx)(mj.default,{id:v,startColor:(0,mk.getEdgeColor)(t),stopColor:(0,mk.getEdgeColor)(u),position:{x1:g,y1:h,x2:i,y2:j}}),(0,F.jsx)(N.BaseEdge,{id:a,path:l,style:{stroke:y,strokeWidth:2,opacity:b._dimmed?.3:b._waitingRun?.7:1,strokeDasharray:b._isTemp?"8 8":void 0}}),(0,F.jsx)(N.EdgeLabelRenderer,{children:(0,F.jsx)("div",{className:(0,S.cn)("nopan nodrag hover:scale-125",b?._hovering?"block":"hidden",o&&"!block",b.isInIteration&&`z-[${T.ITERATION_CHILDREN_Z_INDEX}]`,b.isInLoop&&`z-[${T.LOOP_CHILDREN_Z_INDEX}]`),style:{position:"absolute",transform:`translate(-50%, -50%) translate(${m}px, ${n}px)`,pointerEvents:"all",opacity:b._waitingRun?.7:1},children:(0,F.jsx)(dT,{open:o,onOpenChange:w,asChild:!0,onSelect:x,availableBlocksTypes:dV(r,s),triggerClassName:()=>"hover:scale-150 transition-all"})})})]})});var mm=a.i(301214);let mn=(0,K.memo)(({top:a,left:b,width:c})=>{let{x:d,y:e,zoom:f}=(0,N.useViewport)();return(0,F.jsx)("div",{className:"absolute z-[9] h-px bg-primary-300",style:{top:a*f+e,left:b*f+d,width:c*f}})});mn.displayName="HelpLineBase";let mo=(0,K.memo)(({top:a,left:b,height:c})=>{let{x:d,y:e,zoom:f}=(0,N.useViewport)();return(0,F.jsx)("div",{className:"absolute z-[9] w-[1px] bg-primary-300",style:{top:a*f+e,left:b*f+d,height:c*f}})});mo.displayName="HelpLineVertical";let mp=(0,K.memo)(()=>{let a=(0,aP.useStore)(a=>a.helpLineHorizontal),b=(0,aP.useStore)(a=>a.helpLineVertical);return a||b?(0,F.jsxs)(F.Fragment,{children:[a&&(0,F.jsx)(mn,{...a}),b&&(0,F.jsx)(mo,{...b})]}):null});var mq=a.i(505618),mr=a.i(124677),ms=a.i(667756),mt=a.i(875474),mu=a.i(364573),mv=a.i(521443),mw=a.i(404740);let mx=(0,K.memo)(()=>{let a=(0,K.useRef)(null),b=(0,bu.default)(),{handleNodeContextmenuCancel:c,handlePaneContextmenuCancel:d}=(0,mq.usePanelInteractions)(),e=(0,aP.useStore)(a=>a.nodeMenu),f=b.find(a=>a.id===e?.nodeId);return((0,K.useEffect)(()=>{e&&d()},[e,d]),(0,e4.useClickAway)(()=>{c()},a),e&&f)?(0,F.jsx)("div",{className:"absolute z-[9]",style:{left:e.left,top:e.top},ref:a,children:(0,F.jsx)(d1,{id:f.id,data:f.data,onClosePopup:()=>c(),showHelpLink:!0})}):null}),my=(0,K.memo)(({id:a,data:b})=>{let{t:c}=(0,$.useTranslation)(),{handleReplaceNode:d}=(a=>{let b=(0,N.useStoreApi)(),{nodesMap:c}=(0,ap.useNodesMetaData)();return{handleReplaceNode:(0,K.useCallback)((d,e)=>{let{getNodes:f,setNodes:g}=b.getState(),h=f(),i=h.findIndex(b=>b.id===a);if(i<0)return;let{defaultValue:j}=c[d],k=h[i],{newNode:l}=(0,aR.generateNewNode)({data:{...j,...e},position:{x:k.position.x,y:k.position.y}}),m=(0,I.produce)(h,a=>{a[i]=l});g((0,I.produce)(m,a=>a.filter(a=>!a.data._isTempNode)))},[])}})(a),e=(0,K.useCallback)(()=>(0,F.jsxs)(av.default,{variant:"primary",className:"w-full",children:[(0,F.jsx)(Y.RiAddLine,{className:"mr-1 h-4 w-4"}),c("nodes.dataSource.add",{ns:"workflow"})]}),[]);return(0,F.jsxs)("div",{className:(0,S.cn)("relative flex rounded-2xl border","border-transparent"),style:{width:b.width,height:b.height},children:[(0,F.jsx)("div",{className:"absolute inset-[-2px] top-[-22px] z-[-1] rounded-[18px] bg-node-data-source-bg p-0.5 backdrop-blur-[6px]",children:(0,F.jsx)("div",{className:"system-2xs-semibold-uppercase flex h-5 items-center px-2.5 text-text-tertiary",children:c("blocks.datasource",{ns:"workflow"})})}),(0,F.jsx)("div",{className:(0,S.cn)("group relative shadow-xs","rounded-[15px] border border-transparent","w-[240px] bg-workflow-block-bg"),children:(0,F.jsx)("div",{className:(0,S.cn)("flex items-center rounded-t-2xl p-3"),children:(0,F.jsx)(dT,{asChild:!0,onSelect:d,trigger:e,noBlocks:!0,noTools:!0,popupClassName:"w-[320px]",placement:"bottom-start",offset:{mainAxis:4,crossAxis:0}})})})]})}),mz="custom-data-source-empty";var mA=a.i(700173),mB=a.i(778322),mC=a.i(119359),mD=a.i(208346);let mE=(0,K.memo)(()=>{let{t:a}=(0,$.useTranslation)(),[b,c]=(0,K.useState)(!1),{nodesReadOnly:d}=(0,aq.useNodesReadOnly)(),{setCurrentLogItem:e,setShowMessageLogModal:f}=(0,aa.useStore)((0,_.useShallow)(a=>({appDetail:a.appDetail,setCurrentLogItem:a.setCurrentLogItem,setShowMessageLogModal:a.setShowMessageLogModal}))),g=(0,N.useStoreApi)(),{store:h,getHistoryLabel:i}=(0,X.useWorkflowHistory)(),{pastStates:j,futureStates:k,undo:l,redo:m,clear:n}=h.temporal.getState(),[o,p]=(0,K.useState)(0),q=(0,K.useCallback)(()=>{n(),p(0)},[n]),r=(0,K.useCallback)(({index:a})=>{let{setEdges:b,setNodes:c}=g.getState(),d=o+a;if(0===d)return;d<0?l(-1*d):m(d);let{edges:e,nodes:f}=h.getState();(0!==e.length||0!==f.length)&&(b(e),c(f))},[o,g,m,h,l]),s=(0,K.useCallback)(b=>{if(!b)return;let c=b<0?-1*b:b;return`${b>0?a("changeHistory.stepForward",{ns:"workflow",count:c}):a("changeHistory.stepBackward",{ns:"workflow",count:c})}`},[a]),t=(0,K.useMemo)(()=>{let a=(a,b=0,c=!1)=>a.map((d,e)=>{let f=d.nodes||h.getState().nodes||[],g=d?.workflowHistoryEventMeta?.nodeId,j=f.find(a=>a.id===g)?.data?.title??"";return{label:d.workflowHistoryEvent&&i(d.workflowHistoryEvent),index:c?a.length-1-e-b:e-b,state:{...d,workflowHistoryEventMeta:d.workflowHistoryEventMeta?{...d.workflowHistoryEventMeta,nodeTitle:d.workflowHistoryEventMeta.nodeTitle||j}:void 0}}}).filter(Boolean),b={pastStates:a(j,j.length).reverse(),futureStates:a([...k,!j.length&&!k.length?void 0:h.getState()].filter(Boolean),0,!0),statesCount:0};return b.statesCount=j.length+k.length,{...b,statesCount:j.length+k.length}},[k,i,j,h]),u=(0,K.useCallback)((a,b)=>a?`${a} ${b}`:b,[]);return(0,F.jsxs)(bh.PortalToFollowElem,{placement:"bottom-end",offset:{mainAxis:4,crossAxis:131},open:b,onOpenChange:c,children:[(0,F.jsx)(bh.PortalToFollowElemTrigger,{onClick:()=>!d&&c(a=>!a),children:(0,F.jsx)(mD.default,{title:a("changeHistory.title",{ns:"workflow"}),children:(0,F.jsx)("div",{className:(0,S.cn)("flex h-8 w-8 cursor-pointer items-center justify-center rounded-md text-text-tertiary hover:bg-state-base-hover hover:text-text-secondary",b&&"bg-state-accent-active text-text-accent",d&&"cursor-not-allowed text-text-disabled hover:bg-transparent hover:text-text-disabled"),onClick:()=>{d||(e(),f(!1))},children:(0,F.jsx)(Y.RiHistoryLine,{className:"h-4 w-4"})})})}),(0,F.jsx)(bh.PortalToFollowElemContent,{className:"z-[12]",children:(0,F.jsxs)("div",{className:"ml-2 flex min-w-[240px] max-w-[360px] flex-col overflow-y-auto rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur shadow-xl backdrop-blur-[5px]",children:[(0,F.jsxs)("div",{className:"sticky top-0 flex items-center justify-between px-4 pt-3",children:[(0,F.jsx)("div",{className:"system-mg-regular grow text-text-secondary",children:a("changeHistory.title",{ns:"workflow"})}),(0,F.jsx)("div",{className:"flex h-6 w-6 shrink-0 cursor-pointer items-center justify-center",onClick:()=>{e(),f(!1),c(!1)},children:(0,F.jsx)(Y.RiCloseLine,{className:"h-4 w-4 text-text-secondary"})})]}),(0,F.jsxs)("div",{className:"overflow-y-auto p-2",style:{maxHeight:"calc(1 / 2 * 100vh)"},children:[!t.statesCount&&(0,F.jsxs)("div",{className:"py-12",children:[(0,F.jsx)(Y.RiHistoryLine,{className:"mx-auto mb-2 h-8 w-8 text-text-tertiary"}),(0,F.jsx)("div",{className:"text-center text-[13px] text-text-tertiary",children:a("changeHistory.placeholder",{ns:"workflow"})})]}),(0,F.jsxs)("div",{className:"flex flex-col",children:[t.futureStates.map(b=>(0,F.jsx)("div",{className:(0,S.cn)("mb-0.5 flex cursor-pointer rounded-lg px-2 py-[7px] text-text-secondary hover:bg-state-base-hover",b?.index===o&&"bg-state-base-hover"),onClick:()=>{r(b),c(!1)},children:(0,F.jsx)("div",{children:(0,F.jsxs)("div",{className:(0,S.cn)("flex items-center text-[13px] font-medium leading-[18px] text-text-secondary"),children:[u(b?.state?.workflowHistoryEventMeta?.nodeTitle,b?.label||a("changeHistory.sessionStart",{ns:"workflow"}))," ","(",s(b?.index),b?.index===o&&a("changeHistory.currentState",{ns:"workflow"}),")"]})})},b?.index)),t.pastStates.map(b=>(0,F.jsx)("div",{className:(0,S.cn)("mb-0.5 flex cursor-pointer rounded-lg px-2 py-[7px] hover:bg-state-base-hover",b?.index===t.statesCount-1&&"bg-state-base-hover"),onClick:()=>{r(b),c(!1)},children:(0,F.jsx)("div",{children:(0,F.jsxs)("div",{className:(0,S.cn)("flex items-center text-[13px] font-medium leading-[18px] text-text-secondary"),children:[u(b?.state?.workflowHistoryEventMeta?.nodeTitle,b?.label||a("changeHistory.sessionStart",{ns:"workflow"}))," ","(",s(b?.index),")"]})})},b?.index))]})]}),!!t.statesCount&&(0,F.jsxs)("div",{className:"px-0.5",children:[(0,F.jsx)(bA.default,{className:"m-0"}),(0,F.jsx)("div",{className:(0,S.cn)("my-0.5 flex cursor-pointer rounded-lg px-2 py-[7px] text-text-secondary","hover:bg-state-base-hover"),onClick:()=>{q(),c(!1)},children:(0,F.jsx)("div",{children:(0,F.jsx)("div",{className:(0,S.cn)("flex items-center text-[13px] font-medium leading-[18px]"),children:a("changeHistory.clearHistory",{ns:"workflow"})})})})]}),(0,F.jsxs)("div",{className:"w-[240px] px-3 py-2 text-xs text-text-tertiary",children:[(0,F.jsx)("div",{className:"mb-1 flex h-[22px] items-center font-medium uppercase",children:a("changeHistory.hint",{ns:"workflow"})}),(0,F.jsx)("div",{className:"mb-1 leading-[18px] text-text-tertiary",children:a("changeHistory.hintText",{ns:"workflow"})})]})]})})]})}),mF=(0,K.memo)(({handleUndo:a,handleRedo:b})=>{let{t:c}=(0,$.useTranslation)(),{store:d}=(0,l9.useWorkflowHistoryStore)(),[e,f]=(0,K.useState)({undo:!0,redo:!0});(0,K.useEffect)(()=>{let a=d.temporal.subscribe(a=>{f({undo:0===a.pastStates.length,redo:0===a.futureStates.length})});return()=>a()},[d]);let{nodesReadOnly:g}=(0,aq.useNodesReadOnly)();return(0,F.jsxs)("div",{className:"flex items-center space-x-0.5 rounded-lg border-[0.5px] border-components-actionbar-border bg-components-actionbar-bg p-0.5 shadow-lg backdrop-blur-[5px]",children:[(0,F.jsx)(mD.default,{title:c("common.undo",{ns:"workflow"}),shortcuts:["ctrl","z"],children:(0,F.jsx)("div",{"data-tooltip-id":"workflow.undo",className:(0,S.cn)("system-sm-medium flex h-8 w-8 cursor-pointer select-none items-center rounded-md px-1.5 text-text-tertiary hover:bg-state-base-hover hover:text-text-secondary",(g||e.undo)&&"cursor-not-allowed text-text-disabled hover:bg-transparent hover:text-text-disabled"),onClick:()=>!g&&!e.undo&&a(),children:(0,F.jsx)(Y.RiArrowGoBackLine,{className:"h-4 w-4"})})}),(0,F.jsx)(mD.default,{title:c("common.redo",{ns:"workflow"}),shortcuts:["ctrl","y"],children:(0,F.jsx)("div",{"data-tooltip-id":"workflow.redo",className:(0,S.cn)("system-sm-medium flex h-8 w-8 cursor-pointer select-none items-center rounded-md px-1.5 text-text-tertiary hover:bg-state-base-hover hover:text-text-secondary",(g||e.redo)&&"cursor-not-allowed text-text-disabled hover:bg-transparent hover:text-text-disabled"),onClick:()=>!g&&!e.redo&&b(),children:(0,F.jsx)(Y.RiArrowGoForwardFill,{className:"h-4 w-4"})})}),(0,F.jsx)(bA.default,{type:"vertical",className:"mx-0.5 h-3.5"}),(0,F.jsx)(mE,{})]})}),mG=()=>{let{t:a}=(0,$.useTranslation)(),b=(0,bk.useDocLink)();return(0,F.jsxs)("div",{className:"flex h-full flex-col gap-3 rounded-xl bg-background-section p-8",children:[(0,F.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-[10px] border-[0.5px] border-components-card-border bg-components-card-bg shadow-lg backdrop-blur-sm",children:(0,F.jsx)(a0.Variable02,{className:"h-5 w-5 text-text-accent"})}),(0,F.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,F.jsx)("div",{className:"system-sm-semibold text-text-secondary",children:a("debug.variableInspect.title",{ns:"workflow"})}),(0,F.jsx)("div",{className:"system-xs-regular text-text-tertiary",children:a("debug.variableInspect.emptyTip",{ns:"workflow"})}),(0,F.jsx)("a",{className:"system-xs-regular cursor-pointer text-text-accent",href:b("/use-dify/debug/variable-inspect"),target:"_blank",rel:"noopener noreferrer",children:a("debug.variableInspect.emptyLink",{ns:"workflow"})})]})]})};var mH=a.i(304905);let mI=({nodeData:a,currentVar:b,varType:c,varList:d,handleSelect:e,handleView:f,handleClear:g})=>{let{t:h}=(0,$.useTranslation)(),[i,j]=(0,K.useState)(!1),k=(0,ar.useToolIcon)(a?.nodePayload),l=c===dq.VarInInspectType.environment,m=c===dq.VarInInspectType.conversation,n=c===dq.VarInInspectType.system,o=l?d:d.filter(a=>a.visible);return(0,F.jsxs)("div",{className:"p-0.5",children:[(0,F.jsxs)("div",{className:"group flex h-6 items-center gap-0.5",children:[(0,F.jsxs)("div",{className:"h-3 w-3 shrink-0",children:[a?.isSingRunRunning&&(0,F.jsx)(Y.RiLoader2Line,{className:"h-3 w-3 animate-spin text-text-accent"}),(!a||!a.isSingRunRunning)&&o.length>0&&(0,F.jsx)(Y.RiArrowRightSLine,{className:(0,S.cn)("h-3 w-3 text-text-tertiary",!i&&"rotate-90"),onClick:()=>j(!i)})]}),(0,F.jsxs)("div",{className:"flex grow cursor-pointer items-center gap-1",onClick:()=>j(!i),children:[a&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(am.default,{className:"shrink-0",type:a.nodeType,toolIcon:k||"",size:"xs"}),(0,F.jsx)("div",{className:"system-xs-medium-uppercase truncate text-text-tertiary",children:a.title})]}),!a&&(0,F.jsxs)("div",{className:"system-xs-medium-uppercase truncate text-text-tertiary",children:[l&&h("debug.variableInspect.envNode",{ns:"workflow"}),m&&h("debug.variableInspect.chatNode",{ns:"workflow"}),n&&h("debug.variableInspect.systemNode",{ns:"workflow"})]})]}),a&&!a.isSingRunRunning&&(0,F.jsxs)("div",{className:"hidden shrink-0 items-center group-hover:flex",children:[(0,F.jsx)(ac.default,{popupContent:h("debug.variableInspect.view",{ns:"workflow"}),children:(0,F.jsx)(fX.default,{onClick:f,children:(0,F.jsx)(Y.RiFileList3Line,{className:"h-4 w-4"})})}),(0,F.jsx)(ac.default,{popupContent:h("debug.variableInspect.clearNode",{ns:"workflow"}),children:(0,F.jsx)(fX.default,{onClick:g,children:(0,F.jsx)(Y.RiDeleteBinLine,{className:"h-4 w-4"})})})]})]}),!i&&!a?.isSingRunRunning&&(0,F.jsx)("div",{className:"px-0.5",children:o.length>0&&o.map(d=>(0,F.jsxs)("div",{className:(0,S.cn)("relative flex cursor-pointer items-center gap-1 rounded-md px-3 py-1 hover:bg-state-base-hover",d.id===b?.var?.id&&"bg-state-base-hover-alt hover:bg-state-base-hover-alt"),onClick:()=>{c===dq.VarInInspectType.environment?e({nodeId:dq.VarInInspectType.environment,title:dq.VarInInspectType.environment,nodeType:dq.VarInInspectType.environment,var:{...d,type:dq.VarInInspectType.environment,..."secret"===d.value_type?{value:"******************"}:{}}}):c===dq.VarInInspectType.conversation?e({nodeId:dq.VarInInspectType.conversation,nodeType:dq.VarInInspectType.conversation,title:dq.VarInInspectType.conversation,var:{...d,type:dq.VarInInspectType.conversation}}):c===dq.VarInInspectType.system?e({nodeId:dq.VarInInspectType.system,nodeType:dq.VarInInspectType.system,title:dq.VarInInspectType.system,var:{...d,type:dq.VarInInspectType.system}}):a&&e({nodeId:a.nodeId,nodeType:a.nodeType,title:a.title,var:d})},children:[(0,F.jsx)(mH.VariableIconWithColor,{variableCategory:c,isExceptionVariable:["error_type","error_message"].includes(d.name),className:"size-4"}),(0,F.jsx)("div",{className:"system-sm-medium grow truncate text-text-secondary",children:d.name}),(0,F.jsx)("div",{className:"system-xs-regular shrink-0 text-text-tertiary",children:d.value_type})]},d.id))})]})},mJ=({currentNodeVar:a,handleVarSelect:b})=>{let{t:c}=(0,$.useTranslation)(),d=(0,aP.useStore)(a=>a.environmentVariables),e=(0,aP.useStore)(a=>a.setCurrentFocusNodeId),{conversationVars:f,systemVars:g,nodesWithInspectVars:h,deleteAllInspectorVars:i,deleteNodeInspectorVars:j}=(0,at.default)(),{handleNodeSelect:k}=(0,V.useNodesInteractions)(),l=d.length>0||f.length>0||g.length>0;return(0,F.jsxs)("div",{className:(0,S.cn)("flex h-full flex-col"),children:[(0,F.jsxs)("div",{className:"flex shrink-0 items-center justify-between gap-1 pl-4 pr-1 pt-2",children:[(0,F.jsx)("div",{className:"system-sm-semibold-uppercase truncate text-text-primary",children:c("debug.variableInspect.title",{ns:"workflow"})}),(0,F.jsx)(av.default,{variant:"ghost",size:"small",className:"shrink-0",onClick:()=>{i(),e("")},children:c("debug.variableInspect.clearAll",{ns:"workflow"})})]}),(0,F.jsxs)("div",{className:"grow overflow-y-auto py-1",children:[d.length>0&&(0,F.jsx)(mI,{varType:dq.VarInInspectType.environment,varList:d,currentVar:a,handleSelect:b}),f.length>0&&(0,F.jsx)(mI,{varType:dq.VarInInspectType.conversation,varList:f,currentVar:a,handleSelect:b}),g.length>0&&(0,F.jsx)(mI,{varType:dq.VarInInspectType.system,varList:g,currentVar:a,handleSelect:b}),l&&(0,F.jsx)("div",{className:"px-4 py-1",children:(0,F.jsx)("div",{className:"h-px bg-divider-subtle"})}),h.length>0&&h.map(c=>(0,F.jsx)(mI,{varType:dq.VarInInspectType.node,varList:c.vars,nodeData:c,currentVar:a,handleSelect:b,handleView:()=>k(c.nodeId,!1,!0),handleClear:()=>{j(c.nodeId),e("")}},c.nodeId))]})]})};var mK=a.i(120264);a.s(["StopCircle",()=>mK.default],891169);var mK=mK;let mL=({onStop:a,message:b})=>{let{t:c}=(0,$.useTranslation)(),d=(0,N.useStoreApi)(),e=(0,aP.useStore)(a=>a.listeningTriggerType),f=(0,aP.useStore)(a=>a.listeningTriggerNodeId),g=(0,aP.useStore)(a=>a.listeningTriggerNodeIds),h=(0,aP.useStore)(a=>a.listeningTriggerIsAll),i=(0,ar.useGetToolIcon)(),{getNodes:j}=d.getState(),k=j(),l=f?k.find(a=>a.id===f):void 0,m=l?.data?.type,n=e||m||aC.BlockEnum.TriggerWebhook,o=n===aC.BlockEnum.TriggerWebhook?l?.data?.webhook_debug_url:void 0,[p,q]=(0,K.useState)(!1);(0,K.useEffect)(()=>{if(!p)return;let a=window.setTimeout(()=>{q(!1)},2e3);return()=>{window.clearTimeout(a)}},[p]);let r=[];h?r=g.length>0?k.filter(a=>g.includes(a.id)):k.filter(a=>{let b=a.data?.type;return b===aC.BlockEnum.TriggerSchedule||b===aC.BlockEnum.TriggerWebhook||b===aC.BlockEnum.TriggerPlugin}):l&&(r=[l]);let s=r.map(a=>{let b=a.data?.type||aC.BlockEnum.TriggerWebhook,c=i(a.data);return{key:a.id,type:b,toolIcon:c}});0===s.length&&s.push({key:"default",type:h?aC.BlockEnum.TriggerWebhook:n,toolIcon:!h&&l?i(l.data):void 0});let t=h?((a,b)=>{if(!a.length)return b("debug.variableInspect.listening.tipFallback",{ns:"workflow"});let c=a.map(a=>a.data?.title).filter(a=>!!a);return c.length?b("debug.variableInspect.listening.tip",{ns:"workflow",nodeName:c.join(", ")}):b("debug.variableInspect.listening.tipFallback",{ns:"workflow"})})(r,c):((a,b,c,d)=>{if(a)return a;if(c===aC.BlockEnum.TriggerSchedule){let a=b?.data;return d("debug.variableInspect.listening.tipSchedule",{ns:"workflow",nextTriggerTime:(a?c0(a):"")||d("debug.variableInspect.listening.defaultScheduleTime",{ns:"workflow"})})}if(c===aC.BlockEnum.TriggerPlugin){let a=b?.data?.provider_name||b?.data?.title||d("debug.variableInspect.listening.defaultPluginName",{ns:"workflow"});return d("debug.variableInspect.listening.tipPlugin",{ns:"workflow",pluginName:a})}if(c===aC.BlockEnum.TriggerWebhook){let a=b?.data?.title||d("debug.variableInspect.listening.defaultNodeName",{ns:"workflow"});return d("debug.variableInspect.listening.tip",{ns:"workflow",nodeName:a})}let e=b?.data?.desc;return e||d("debug.variableInspect.listening.tipFallback",{ns:"workflow"})})(b,l,n,c);return(0,F.jsxs)("div",{className:"flex h-full flex-col gap-4 rounded-xl bg-background-section p-8",children:[(0,F.jsx)("div",{className:"flex flex-row flex-wrap items-center gap-3",children:s.map(a=>(0,F.jsx)(am.default,{type:a.type,toolIcon:a.toolIcon,size:"md",className:"!h-10 !w-10 !rounded-xl [&_svg]:!h-7 [&_svg]:!w-7"},a.key))}),(0,F.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,F.jsx)("div",{className:"system-sm-semibold text-text-secondary",children:c("debug.variableInspect.listening.title",{ns:"workflow"})}),(0,F.jsx)("div",{className:"system-xs-regular whitespace-pre-line text-text-tertiary",children:t})]}),o&&(0,F.jsxs)("div",{className:"flex items-center gap-2",children:[(0,F.jsx)("div",{className:"system-xs-regular shrink-0 whitespace-pre-line text-text-tertiary",children:c("nodes.triggerWebhook.debugUrlTitle",{ns:"workflow"})}),(0,F.jsx)(ac.default,{popupContent:c(p?"nodes.triggerWebhook.debugUrlCopied":"nodes.triggerWebhook.debugUrlCopy",{ns:"workflow"}),popupClassName:"system-xs-regular text-text-primary bg-components-tooltip-bg border border-components-panel-border shadow-lg backdrop-blur-sm rounded-md px-1.5 py-1",position:"top",offset:{mainAxis:-4},needsDelay:!0,children:(0,F.jsx)("button",{type:"button","aria-label":c("nodes.triggerWebhook.debugUrlCopy",{ns:"workflow"})||"",className:`inline-flex items-center rounded-[6px] border border-divider-regular bg-components-badge-white-to-dark px-1.5 py-[2px] font-mono text-[13px] leading-[18px] text-text-secondary transition-colors hover:bg-components-panel-on-panel-item-bg-hover focus:outline-none focus-visible:outline focus-visible:outline-2 focus-visible:outline-components-panel-border ${p?"bg-components-panel-on-panel-item-bg-hover text-text-primary":""}`,onClick:()=>{(0,e1.default)(o),q(!0)},children:(0,F.jsx)("span",{className:"whitespace-nowrap text-text-primary",children:o})})})]}),(0,F.jsx)("div",{children:(0,F.jsxs)(av.default,{size:"medium",className:"px-3",variant:"primary",onClick:a,children:[(0,F.jsx)(mK.default,{className:"mr-1 size-4"}),c("debug.variableInspect.listening.stopButton",{ns:"workflow"})]})})]})};var mM=a.i(748240),mN=a.i(666791),mO=a.i(880808),mP=a.i(680904);let mQ=mP.z.array(mP.z.string()),mR=mP.z.array(mP.z.number()),mS=mP.z.union([mP.z.string(),mP.z.number(),mP.z.boolean(),mP.z.null()]),mT=mP.z.lazy(()=>mP.z.union([mS,mP.z.array(mT),mP.z.record(mT)])),mU=mP.z.lazy(()=>mP.z.array(mT));var mV=a.i(74801),mW=a.i(189583),mX=a.i(687700),mY=a.i(388025),mZ=a.i(368206),m$=a.i(330492),m_=((B={}).Question="question",B.Answer="answer",B);let m0=K.memo(a=>{let{type:b,text:c}=a;return(0,F.jsxs)("div",{className:"inline-flex items-start justify-start gap-1 self-stretch",children:[(0,F.jsx)("div",{className:"w-4 text-[13px] font-medium leading-5 text-text-tertiary",children:b===m_.Question?"Q":"A"}),(0,F.jsx)("div",{className:"body-md-regular flex-1 text-text-secondary",children:c})]})}),m1=K.memo(a=>{let{chunkType:b,parentMode:c,content:d,positionId:e,wordCount:f}=a,{t:g}=(0,$.useTranslation)(),h=(0,K.useMemo)(()=>b===aD.ChunkingMode.parentChild&&"full-doc"===c,[b,c]),i=(0,K.useMemo)(()=>b===aD.ChunkingMode.parentChild&&"paragraph"===c,[b,c]),j=(0,K.useMemo)(()=>b===aD.ChunkingMode.parentChild?d.child_contents.map((a,b)=>{let c=b+1;return(0,F.jsx)(m$.PreviewSlice,{label:`C-${c}`,text:a,tooltip:`Child-chunk-${c} \xb7 ${a.length} Characters`,labelInnerClassName:"text-[10px] font-semibold align-bottom leading-7",dividerClassName:"leading-7"},a)}):b===aD.ChunkingMode.qa?(0,F.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,F.jsx)(m0,{type:m_.Question,text:d.question}),(0,F.jsx)(m0,{type:m_.Answer,text:d.answer})]}):d.content,[d,b]),k=(0,K.useMemo)(()=>b===aD.ChunkingMode.parentChild?d.parent_summary:b===aD.ChunkingMode.text?d.summary:null,[d,b]);return(0,F.jsxs)("div",{className:"flex flex-col gap-1 rounded-lg bg-components-panel-bg px-3 py-2.5",children:[!h&&(0,F.jsxs)("div",{className:"inline-flex items-center justify-start gap-2",children:[(0,F.jsx)(mY.default,{positionId:e,labelPrefix:i?"Parent-Chunk":"Chunk"}),(0,F.jsx)(mX.default,{}),(0,F.jsx)("div",{className:"system-xs-medium text-text-tertiary",children:`${(0,bM.formatNumber)(f)} ${g("segment.characters",{ns:"datasetDocuments",count:f})}`})]}),(0,F.jsx)("div",{className:"body-md-regular text-text-secondary",children:j}),k&&(0,F.jsx)(mZ.default,{summary:k})]})}),m2=a=>{let{chunkType:b,parentMode:c,chunkInfo:d,className:e}=a,f=(0,K.useMemo)(()=>b===aD.ChunkingMode.text?d:b===aD.ChunkingMode.parentChild?d.parent_child_chunks:d.qa_chunks,[d,b]);return(0,F.jsx)("div",{className:(0,S.cn)("flex w-full flex-col gap-y-1",e),children:f.map((a,d)=>{let e=b===aD.ChunkingMode.parentChild?a.parent_content?.length:b===aD.ChunkingMode.text?a.content.length:a.question.length+a.answer.length;return(0,F.jsx)(m1,{chunkType:b,parentMode:c,content:a,wordCount:e,positionId:d+1},`${b}-${d}`)})})},m3=K.memo(a=>{let{previewType:b,varType:c,schemaType:d,mdString:e,jsonString:f,readonly:g,handleTextChange:h,handleEditorChange:i,className:j}=a,[k,l]=(0,K.useState)(ei.Code),[m,n]=(0,K.useState)(!1),{t:o}=(0,$.useTranslation)(),p=(0,K.useMemo)(()=>{if(b===ej.Chunks&&d){if("general_structure"===d)return aD.ChunkingMode.text;if("parent_child_structure"===d)return aD.ChunkingMode.parentChild;if("qa_structure"===d)return aD.ChunkingMode.qa}},[b,d]),q=(0,K.useMemo)(()=>{if(b===ej.Chunks&&d&&f&&"parent_child_structure"===d)return JSON.parse(f)?.parent_mode},[b,d,f]);return(0,F.jsxs)("div",{className:(0,S.cn)("flex h-full flex-col rounded-[10px] bg-components-input-bg-normal",m&&"bg-components-input-bg-active outline outline-1 outline-components-input-border-active",j),children:[(0,F.jsxs)("div",{className:"flex shrink-0 items-center justify-end p-1",children:[b===ej.Markdown&&(0,F.jsx)("div",{className:"system-xs-semibold-uppercase flex grow items-center px-2 py-0.5 text-text-secondary",children:b.toUpperCase()}),b===ej.Chunks&&(0,F.jsxs)("div",{className:"system-xs-semibold-uppercase flex grow items-center px-2 py-0.5 text-text-secondary",children:[c.toUpperCase(),d?`(${d})`:""]}),(0,F.jsx)(jK,{options:[{value:ei.Code,text:o("nodes.templateTransform.code",{ns:"workflow"}),Icon:Y.RiBracesLine},{value:ei.Preview,text:o("common.preview",{ns:"workflow"}),Icon:Y.RiEyeLine}],value:k,onChange:l,size:"small",padding:"with",activeClassName:"!text-text-accent-light-mode-only",btnClassName:"!pl-1.5 !pr-0.5 gap-[3px]",className:"shrink-0"})]}),(0,F.jsxs)("div",{className:"flex flex-1 overflow-auto rounded-b-[10px] pl-3 pr-1",children:[k===ei.Code&&(b===ej.Markdown?(0,F.jsx)(a5.default,{readOnly:g,disabled:g,className:"h-full border-none bg-transparent p-0 text-text-secondary hover:bg-transparent focus:bg-transparent focus:shadow-none",value:e,onChange:a=>h?.(a.target.value),onFocus:()=>n(!0),onBlur:()=>n(!1)}):(0,F.jsx)(jY,{readonly:g,className:"overflow-y-auto bg-transparent",hideTopMenu:!0,schema:f,onUpdate:i,onFocus:()=>n(!0),onBlur:()=>n(!1)})),k===ei.Preview&&(b===ej.Markdown?(0,F.jsx)(mW.Markdown,{className:"grow overflow-auto rounded-lg px-4 py-3",content:e??""}):(0,F.jsx)(m2,{chunkType:p,parentMode:q,chunkInfo:JSON.parse(f)}))]})]})}),m4=K.memo(({currentVar:a,handleValueChange:b,isTruncated:c})=>{let d=(0,K.useRef)(null),e=(0,K.useRef)(null),[f,g]=(0,K.useState)(0),h="secret"===a.value_type||"string"===a.value_type||"number"===a.value_type,i="boolean"==typeof a.value,j=Array.isArray(a.value)&&a.value.every(a=>"boolean"==typeof a),k=a.type===dq.VarInInspectType.system&&"files"===a.name,l=!k&&("object"===a.value_type||"array[string]"===a.value_type||"array[number]"===a.value_type||"array[object]"===a.value_type||"array[any]"===a.value_type),m=k||"file"===a.value_type||"array[file]"===a.value_type,n=a.type===dq.VarInInspectType.environment||a.type===dq.VarInInspectType.system&&"query"!==a.name&&"files"!==a.name,o="array[any]"===a.value_type,p=(0,aP.useStore)(a=>a.fileUploadConfig),q=(0,K.useMemo)(()=>!!a.schemaType&&eh.includes(a.schemaType),[a.schemaType]),r=b=>"file"===b.value_type?b.value?(0,aW.getProcessedFilesFromResponse)([b.value]):[]:("array[file]"===b.value_type||b.type===dq.VarInInspectType.system&&"files"===a.name)&&b.value&&b.value.length>0?(0,aW.getProcessedFilesFromResponse)(b.value):[],[s,t]=(0,K.useState)(),[u,v]=(0,K.useState)(""),[w,x]=(0,K.useState)(null),[y,z]=(0,K.useState)(""),[A,B]=(0,K.useState)(()=>r(a)),{run:C}=(0,gK.useDebounceFn)(b,{wait:500});(0,K.useEffect)(()=>{if(h){if("number"===a.value_type)return t(JSON.stringify(a.value));if(!a.value)return t("");t(a.value)}l&&v(null!=a.value?JSON.stringify(a.value,null,2):""),m&&B(r(a))},[a.id,a.value]);let D=b=>{if(c)return;"string"===a.value_type&&t(b),"number"===a.value_type&&/^-?\d+(\.)?(\d+)?$/.test(b)&&t(Number.parseFloat(b));let d="number"===a.value_type?Number.parseFloat(b):b;C(a.id,d)},E=b=>{if(!c&&(v(b),((a,b)=>{try{var c,d;let e=JSON.parse(a);x(null);let f=(c=e,d=b,"array[string]"===d?mQ.safeParse(c):"array[number]"===d?mR.safeParse(c):"object"===d?mT.safeParse(c):"array[object]"===d?mU.safeParse(c):{success:!0});if(!f.success)return z(f.error.message),!1;if("object"===b||"array[object]"===b){if((0,jL.checkJsonSchemaDepth)(e)>O.JSON_SCHEMA_MAX_DEPTH)return z(`Schema exceeds maximum depth of ${O.JSON_SCHEMA_MAX_DEPTH}.`),!1;let a=(0,jL.validateSchemaAgainstDraft7)(e);if(a.length>0)return z((0,jL.getValidationErrorMessage)(a)),!1}return z(""),!0}catch(a){if(z(""),a instanceof Error)return x(a),!1;return x(Error("Invalid JSON")),!1}})(b,a.value_type))){let c=JSON.parse(b);C(a.id,c)}};return(0,K.useEffect)(()=>{if(d.current&&e.current){let a=new ResizeObserver(a=>{for(let b of a){let{inlineSize:a}=b.borderBoxSize[0];g(d.current.clientHeight-a)}});return a.observe(e.current),()=>{a.disconnect()}}},[g]),(0,F.jsxs)("div",{ref:d,className:"flex h-full flex-col",children:[(0,F.jsxs)("div",{className:(0,S.cn)("relative grow"),style:{height:`${f}px`},children:[h&&(0,F.jsxs)(F.Fragment,{children:[c&&(0,F.jsx)(jX.default,{className:"absolute left-3 right-3 top-1"}),"string"===a.value_type?(0,F.jsx)(m3,{previewType:ej.Markdown,varType:a.value_type,mdString:s,readonly:n,handleTextChange:D,className:(0,S.cn)(c&&"pt-[36px]")}):(0,F.jsx)(a5.default,{readOnly:n,disabled:n||c,className:(0,S.cn)("h-full",c&&"pt-[48px]"),value:s,onChange:a=>D(a.target.value)})]}),i&&(0,F.jsx)("div",{className:"w-[295px]",children:(0,F.jsx)(gC,{value:a.value,onChange:b=>{t(b),C(a.id,b)}})}),j&&(0,F.jsx)("div",{className:"w-[295px] space-y-1",children:a.value.map((b,c)=>(0,F.jsx)(gC,{value:b,onChange:b=>{let d=[...a.value];d[c]=b,t(d),C(a.id,d)}},c))}),l&&(q?(0,F.jsx)(m3,{previewType:ej.Chunks,varType:a.value_type,schemaType:a.schemaType??"",jsonString:u??"{}",readonly:o,handleEditorChange:E}):(0,F.jsx)(jY,{readonly:o||c,className:"overflow-y-auto",hideTopMenu:!0,schema:u,onUpdate:E,isTruncated:c})),m&&(0,F.jsx)("div",{className:"max-w-[460px]",children:(0,F.jsx)(aZ.FileUploaderInAttachmentWrapper,{value:A,onChange:b=>{var c;B(c=(0,aW.getProcessedFiles)(b)),c.every(a=>a.upload_file_id)&&("file"===a.value_type&&C(a.id,c[0]),("array[file]"===a.value_type||k)&&C(a.id,c))},fileConfig:{allowed_file_types:[aC.SupportUploadFileTypes.image,aC.SupportUploadFileTypes.document,aC.SupportUploadFileTypes.audio,aC.SupportUploadFileTypes.video],allowed_file_extensions:[...a3.FILE_EXTS[aC.SupportUploadFileTypes.image],...a3.FILE_EXTS[aC.SupportUploadFileTypes.document],...a3.FILE_EXTS[aC.SupportUploadFileTypes.audio],...a3.FILE_EXTS[aC.SupportUploadFileTypes.video]],allowed_file_upload_methods:[aI.TransferMethod.local_file,aI.TransferMethod.remote_url],number_limits:"file"===a.value_type?1:p?.workflow_file_upload_limit||5,fileUploadConfig:p,preview_config:{mode:mV.PreviewMode.NewPage,file_type_list:["application/pdf"]}},isDisabled:n})})]}),(0,F.jsxs)("div",{ref:e,className:"shrink-0",children:[w&&(0,F.jsx)(jM,{className:"mt-1",message:w.message}),y&&(0,F.jsx)(jM,{className:"mt-1",message:y})]})]})}),m5=({nodeId:a,currentNodeVar:b,handleOpenMenu:c,isValueFetching:d})=>{let e,{t:f}=(0,$.useTranslation)(),g=(0,aP.useStore)(a=>a.bottomPanelWidth),h=(0,aP.useStore)(a=>a.setShowVariableInspectPanel),i=(0,aP.useStore)(a=>a.setCurrentFocusNodeId),j=(0,ar.useToolIcon)(b?.nodeData),k=b?.var.is_truncated,l=b?.var.full_content,{resetConversationVar:m,resetToLastRunVar:n,editInspectVarValue:o}=(0,at.default)(),p=(0,as.useHooksStore)(a=>a.configsMap),{eventEmitter:q}=(0,P.useEventEmitterContextContext)(),{handleNodeSelect:r}=(0,V.useNodesInteractions)(),{node:s}=(0,mO.default)(a),{setInputs:t}=eA(a,s?.data),u=s?.data?.type,v=u===aC.BlockEnum.Code,w=[aC.BlockEnum.LLM,aC.BlockEnum.Code].includes(u),x=(0,K.useMemo)(()=>w?u===aC.BlockEnum.LLM?s?.data?.prompt_template?.text||s?.data?.prompt_template?.[0].text:u===aC.BlockEnum.Code?s?.data?.code:void 0:"",[w]),[y,{setTrue:z,setFalse:A}]=(0,a8.useBoolean)(!1),B=(0,K.useCallback)(()=>{r(a),z()},[z,r,a]),C=(0,K.useCallback)(b=>{t((0,I.produce)(s?.data,a=>{switch(u){case aC.BlockEnum.LLM:a?.prompt_template&&(Array.isArray(a.prompt_template)?a.prompt_template[0].text=b.modified:a.prompt_template.text=b.modified);break;case aC.BlockEnum.Code:a.code=b.modified}})),q?.emit({type:f0.PROMPT_EDITOR_UPDATE_VALUE_BY_EVENT_EMITTER,instanceId:`${a}-chat-workflow-llm-prompt-editor`,payload:b.modified}),A()},[t,u,a,s?.data,A]),D=b?.var.schemaType?`(${b.var.schemaType})`:"";return(0,F.jsxs)("div",{className:(0,S.cn)("flex h-full flex-col"),children:[(0,F.jsxs)("div",{className:"flex shrink-0 items-center justify-between gap-1 px-2 pt-2",children:[g<488&&(0,F.jsx)(fX.default,{className:"shrink-0",onClick:c,children:(0,F.jsx)(Y.RiMenuLine,{className:"h-4 w-4"})}),(0,F.jsx)("div",{className:"flex w-0 grow items-center gap-1",children:b?.var&&(0,F.jsxs)(F.Fragment,{children:[[dq.VarInInspectType.environment,dq.VarInInspectType.conversation,dq.VarInInspectType.system].includes(b.nodeType)&&(0,F.jsx)(mH.VariableIconWithColor,{variableCategory:b.nodeType,className:"size-4"}),b.nodeType!==dq.VarInInspectType.environment&&b.nodeType!==dq.VarInInspectType.conversation&&b.nodeType!==dq.VarInInspectType.system&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(am.default,{className:"shrink-0",type:b.nodeType,size:"xs",toolIcon:j}),(0,F.jsx)("div",{className:"system-sm-regular shrink-0 text-text-secondary",children:b.title}),(0,F.jsx)("div",{className:"system-sm-regular shrink-0 text-text-quaternary",children:"/"})]}),(0,F.jsx)("div",{title:b.var.name,className:"system-sm-semibold truncate text-text-secondary",children:b.var.name}),(0,F.jsxs)("div",{className:"system-xs-medium ml-1 shrink-0 space-x-2 text-text-tertiary",children:[(0,F.jsx)("span",{children:`${b.var.value_type}${D}`}),k&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)("span",{children:"·"}),(0,F.jsxs)("span",{children:[((l?.size_bytes||0)/1024/1024).toFixed(1),"MB"]})]})]})]})}),(0,F.jsxs)("div",{className:"flex shrink-0 items-center gap-1",children:[b&&(0,F.jsxs)(F.Fragment,{children:[w&&(0,F.jsx)(ac.default,{popupContent:f("generate.optimizePromptTooltip",{ns:"appDebug"}),children:(0,F.jsx)("div",{className:"cursor-pointer rounded-md p-1 hover:bg-state-accent-active",onClick:B,children:(0,F.jsx)(Y.RiSparklingFill,{className:"size-4 text-components-input-border-active-prompt-1"})})}),k&&(0,F.jsx)(ac.default,{popupContent:f("debug.variableInspect.exportToolTip",{ns:"workflow"}),children:(0,F.jsx)(fX.default,{children:(0,F.jsx)("a",{href:l?.download_url,target:"_blank",children:(0,F.jsx)(Y.RiFileDownloadFill,{className:"size-4"})})})}),!k&&b.var.edited&&(0,F.jsxs)(dM.default,{children:[(0,F.jsx)("span",{className:"ml-[2.5px] mr-[4.5px] h-[3px] w-[3px] rounded bg-text-accent-secondary"}),(0,F.jsx)("span",{className:"system-2xs-semibold-uupercase",children:f("debug.variableInspect.edited",{ns:"workflow"})})]}),!k&&b.var.edited&&b.var.type!==dq.VarInInspectType.conversation&&(0,F.jsx)(ac.default,{popupContent:f("debug.variableInspect.reset",{ns:"workflow"}),children:(0,F.jsx)(fX.default,{onClick:()=>{b&&n(b.nodeId,b.var.id)},children:(0,F.jsx)(Y.RiArrowGoBackLine,{className:"h-4 w-4"})})}),!k&&b.var.edited&&b.var.type===dq.VarInInspectType.conversation&&(0,F.jsx)(ac.default,{popupContent:f("debug.variableInspect.resetConversationVar",{ns:"workflow"}),children:(0,F.jsx)(fX.default,{onClick:()=>{b&&m(b.var.id)},children:(0,F.jsx)(Y.RiArrowGoBackLine,{className:"h-4 w-4"})})}),"secret"!==b.var.value_type&&(0,F.jsx)(mM.default,{content:null==(e=b?.var.value)?"":"object"==typeof e?JSON.stringify(e):String(e)})]}),(0,F.jsx)(fX.default,{onClick:()=>{h(!1),i("")},children:(0,F.jsx)(Y.RiCloseLine,{className:"h-4 w-4"})})]})]}),(0,F.jsxs)("div",{className:"grow p-2",children:[!b?.var&&(0,F.jsx)(mG,{}),d&&(0,F.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,F.jsx)(bI.default,{})}),b?.var&&!d&&(0,F.jsx)(m4,{currentVar:b.var,handleValueChange:(a,c)=>{b&&o(b.nodeId,a,c)},isTruncated:!!k},`${b.nodeId}-${b.var.id}`)]}),y&&(v?(0,F.jsx)(mN.default,{isShow:!0,mode:aI.AppModeEnum.CHAT,onClose:A,flowId:p?.flowId||"",nodeId:a,currentCode:x,codeLanguages:s?.data?.code_languages||a6.CodeLanguage.python3,onFinished:C}):(0,F.jsx)(f5.default,{mode:aI.AppModeEnum.CHAT,isShow:!0,onClose:A,onFinished:C,flowId:p?.flowId||"",nodeId:a,currentPrompt:x}))]})},m6=()=>{let{t:a}=(0,$.useTranslation)(),b=(0,aP.useStore)(a=>a.bottomPanelWidth),c=(0,aP.useStore)(a=>a.setShowVariableInspectPanel),[d,e]=(0,K.useState)(!0),f=(0,aP.useStore)(a=>a.isListening),g=(0,aP.useStore)(a=>a.environmentVariables),h=(0,aP.useStore)(a=>a.currentFocusNodeId),i=(0,aP.useStore)(a=>a.setCurrentFocusNodeId),[j,k]=(0,K.useState)(""),{conversationVars:l,systemVars:m,nodesWithInspectVars:n,fetchInspectVarValue:o}=(0,at.default)(),p=(0,K.useMemo)(()=>0==[...g,...l,...m,...n].length,[g,l,m,n]),q=(0,K.useMemo)(()=>{if(!h)return;if(h===dq.VarInInspectType.environment){let a=g.find(a=>a.id===j),b={nodeId:dq.VarInInspectType.environment,title:dq.VarInInspectType.environment,nodeType:dq.VarInInspectType.environment};return a?{...b,var:{...a,type:dq.VarInInspectType.environment,visible:!0,..."secret"===a.value_type?{value:"******************"}:{}}}:b}if(h===dq.VarInInspectType.conversation){let a=l.find(a=>a.id===j),b={nodeId:dq.VarInInspectType.conversation,title:dq.VarInInspectType.conversation,nodeType:dq.VarInInspectType.conversation};return a?{...b,var:{...a,type:dq.VarInInspectType.conversation}}:b}if(h===dq.VarInInspectType.system){let a=m.find(a=>a.id===j),b={nodeId:dq.VarInInspectType.system,title:dq.VarInInspectType.system,nodeType:dq.VarInInspectType.system};return a?{...b,var:{...a,type:dq.VarInInspectType.system}}:b}let a=n.find(a=>a.nodeId===h);if(!a)return;let b=a.vars.find(a=>a.id===j);return{nodeId:a.nodeId,nodeType:a.nodeType,title:a.title,isSingRunRunning:a.isSingRunRunning,isValueFetched:a.isValueFetched,nodeData:a.nodePayload,...b?{var:b}:{}}},[h,j,g,l,m,n]),r=(0,K.useMemo)(()=>{if(!q)return!1;let a=n.find(a=>a.nodeId===q.nodeId);return!!a&&!a.isValueFetched},[q,n]),s=(0,K.useCallback)(a=>{i(a.nodeId),k(a.var.id)},[i,k]),{isLoading:t,schemaTypeDefinitions:u}=(0,bX.default)(),{eventEmitter:v}=(0,P.useEventEmitterContextContext)(),w=(0,K.useCallback)(()=>{v?.emit({type:eg})},[v]);return((0,K.useEffect)(()=>{if(h&&j&&!t){let a=n.find(a=>a.nodeId===h);a&&!a.isValueFetched&&o([h],u)}},[h,j,n,o,u,t]),f)?(0,F.jsxs)("div",{className:(0,S.cn)("flex h-full flex-col"),children:[(0,F.jsxs)("div",{className:"flex shrink-0 items-center justify-between pl-4 pr-2 pt-2",children:[(0,F.jsx)("div",{className:"system-sm-semibold-uppercase text-text-primary",children:a("debug.variableInspect.title",{ns:"workflow"})}),(0,F.jsx)(fX.default,{onClick:()=>c(!1),children:(0,F.jsx)(Y.RiCloseLine,{className:"h-4 w-4"})})]}),(0,F.jsx)("div",{className:"grow p-2",children:(0,F.jsx)(mL,{onStop:w})})]}):p?(0,F.jsxs)("div",{className:(0,S.cn)("flex h-full flex-col"),children:[(0,F.jsxs)("div",{className:"flex shrink-0 items-center justify-between pl-4 pr-2 pt-2",children:[(0,F.jsx)("div",{className:"system-sm-semibold-uppercase text-text-primary",children:a("debug.variableInspect.title",{ns:"workflow"})}),(0,F.jsx)(fX.default,{onClick:()=>c(!1),children:(0,F.jsx)(Y.RiCloseLine,{className:"h-4 w-4"})})]}),(0,F.jsx)("div",{className:"grow p-2",children:(0,F.jsx)(mG,{})})]}):(0,F.jsxs)("div",{className:(0,S.cn)("relative flex h-full"),children:[b<488&&d&&(0,F.jsx)("div",{className:"absolute left-0 top-0 h-full w-full",onClick:()=>e(!1)}),(0,F.jsx)("div",{className:(0,S.cn)("w-60 shrink-0 border-r border-divider-burn",b<488?d?"absolute left-0 top-0 z-10 h-full w-[217px] rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-lg backdrop-blur-sm":"hidden":"block"),children:(0,F.jsx)(mJ,{currentNodeVar:q,handleVarSelect:s})}),(0,F.jsx)("div",{className:"w-0 grow",children:(0,F.jsx)(m5,{nodeId:h,isValueFetching:r,currentNodeVar:q,handleOpenMenu:()=>e(!0)})})]})},m7=()=>{let a=(0,aP.useStore)(a=>a.showVariableInspectPanel),b=(0,aP.useStore)(a=>a.workflowCanvasHeight),c=(0,aP.useStore)(a=>a.variableInspectPanelHeight),d=(0,aP.useStore)(a=>a.setVariableInspectPanelHeight),e=(0,K.useMemo)(()=>b?b-60:480,[b]),f=(0,K.useCallback)((a,b)=>{localStorage.setItem("workflow-variable-inpsect-panel-height",`${b}`),d(b)},[d]),{triggerRef:g,containerRef:h}=aV({direction:"vertical",triggerDirection:"top",minHeight:120,maxHeight:e,onResize:(0,Z.debounce)(f)});return a?(0,F.jsxs)("div",{className:(0,S.cn)("relative pb-1"),children:[(0,F.jsx)("div",{ref:g,className:"absolute -top-1 left-0 flex h-1 w-full cursor-row-resize resize-y items-center justify-center",children:(0,F.jsx)("div",{className:"h-0.5 w-10 rounded-sm bg-state-base-handle hover:w-full hover:bg-state-accent-solid active:w-full active:bg-state-accent-solid"})}),(0,F.jsx)("div",{ref:h,className:(0,S.cn)("overflow-hidden rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-xl"),style:{height:`${c}px`},children:(0,F.jsx)(m6,{})})]}):null},m8=()=>{let{t:a}=(0,$.useTranslation)(),{eventEmitter:b}=(0,P.useEventEmitterContextContext)(),c=(0,aP.useStore)(a=>a.showVariableInspectPanel),d=(0,aP.useStore)(a=>a.setShowVariableInspectPanel),e=(0,aP.useStore)(a=>a.environmentVariables),f=(0,aP.useStore)(a=>a.setCurrentFocusNodeId),{conversationVars:g,systemVars:h,nodesWithInspectVars:i,deleteAllInspectorVars:j}=(0,at.default)(),k=(0,K.useMemo)(()=>[...e,...g,...h,...i],[e,g,h,i]),{nodesReadOnly:l,getNodesReadOnly:m}=(0,aq.useNodesReadOnly)(),n=(0,aP.useStore)(a=>a.workflowRunningData),o=(0,N.useNodes)(),p=(0,K.useMemo)(()=>o.some(a=>a.data._singleRunningStatus===aC.NodeRunningStatus.Running),[o]),q=(0,K.useMemo)(()=>!!n&&n.result.status===aC.WorkflowRunningStatus.Running,[n]),r=(0,K.useMemo)(()=>q||p,[q,p]);return c?null:(0,F.jsxs)("div",{className:(0,S.cn)("flex items-center gap-1"),children:[!r&&!k.length&&(0,F.jsx)("div",{className:(0,S.cn)("system-2xs-semibold-uppercase flex h-5 cursor-pointer items-center gap-1 rounded-md border-[0.5px] border-effects-highlight bg-components-actionbar-bg px-2 text-text-tertiary shadow-lg backdrop-blur-sm hover:bg-background-default-hover",l&&"cursor-not-allowed text-text-disabled hover:bg-transparent hover:text-text-disabled"),onClick:()=>{m()||d(!0)},children:a("debug.variableInspect.trigger.normal",{ns:"workflow"})}),!r&&k.length>0&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)("div",{className:(0,S.cn)("system-xs-medium flex h-6 cursor-pointer items-center gap-1 rounded-md border-[0.5px] border-effects-highlight bg-components-actionbar-bg px-2 text-text-accent shadow-lg backdrop-blur-sm hover:bg-components-actionbar-bg-accent",l&&"cursor-not-allowed text-text-disabled hover:bg-transparent hover:text-text-disabled"),onClick:()=>{m()||d(!0)},children:a("debug.variableInspect.trigger.cached",{ns:"workflow"})}),(0,F.jsx)("div",{className:(0,S.cn)("system-xs-medium flex h-6 cursor-pointer items-center rounded-md border-[0.5px] border-effects-highlight bg-components-actionbar-bg px-1 text-text-tertiary shadow-lg backdrop-blur-sm hover:bg-components-actionbar-bg-accent hover:text-text-accent",l&&"cursor-not-allowed text-text-disabled hover:bg-transparent hover:text-text-disabled"),onClick:()=>{m()||(j(),f(""))},children:a("debug.variableInspect.trigger.clear",{ns:"workflow"})})]}),r&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)("div",{className:"system-xs-medium flex h-6 cursor-pointer items-center gap-1 rounded-md border-[0.5px] border-effects-highlight bg-components-actionbar-bg px-2 text-text-accent shadow-lg backdrop-blur-sm hover:bg-components-actionbar-bg-accent",onClick:()=>d(!0),children:[(0,F.jsx)(Y.RiLoader2Line,{className:"h-4 w-4 animate-spin"}),(0,F.jsx)("span",{className:"text-text-accent",children:a("debug.variableInspect.trigger.running",{ns:"workflow"})})]}),q&&(0,F.jsx)(ac.default,{popupContent:a("debug.variableInspect.trigger.stop",{ns:"workflow"}),children:(0,F.jsx)("div",{className:"flex h-6 cursor-pointer items-center rounded-md border-[0.5px] border-effects-highlight bg-components-actionbar-bg px-1 shadow-lg backdrop-blur-sm hover:bg-components-actionbar-bg-accent",onClick:()=>{b?.emit({type:eg})},children:(0,F.jsx)(Y.RiStopCircleFill,{className:"h-4 w-4 text-text-accent"})})})]})]})};var m9=((C=m9||{}).zoomIn="zoomIn",C.zoomOut="zoomOut",C.zoomToFit="zoomToFit",C.zoomTo25="zoomTo25",C.zoomTo50="zoomTo50",C.zoomTo75="zoomTo75",C.zoomTo100="zoomTo100",C.zoomTo200="zoomTo200",C);let na=(0,K.memo)(()=>{let{t:a}=(0,$.useTranslation)(),{zoomIn:b,zoomOut:c,zoomTo:d,fitView:e}=(0,N.useReactFlow)(),{zoom:f}=(0,N.useViewport)(),{handleSyncWorkflowDraft:g}=(0,W.useNodesSyncDraft)(),[h,i]=(0,K.useState)(!1),{workflowReadOnly:j,getWorkflowReadOnly:k}=(0,aq.useWorkflowReadOnly)(),l=[[{key:"zoomTo200",text:"200%"},{key:"zoomTo100",text:"100%"},{key:"zoomTo75",text:"75%"},{key:"zoomTo50",text:"50%"},{key:"zoomTo25",text:"25%"}],[{key:"zoomToFit",text:a("operator.zoomToFit",{ns:"workflow"})}]],m=(0,K.useCallback)(()=>{k()||i(a=>!a)},[k]);return(0,F.jsxs)(bh.PortalToFollowElem,{placement:"top-start",open:h,onOpenChange:i,offset:{mainAxis:4,crossAxis:-2},children:[(0,F.jsx)(bh.PortalToFollowElemTrigger,{asChild:!0,children:(0,F.jsx)("div",{className:`
          h-9 cursor-pointer rounded-lg border-[0.5px] border-components-actionbar-border bg-components-actionbar-bg
          p-0.5 text-[13px] shadow-lg backdrop-blur-[5px]
          hover:bg-state-base-hover
          ${j&&"!cursor-not-allowed opacity-50"}
        `,children:(0,F.jsxs)("div",{className:(0,S.cn)("flex h-8 w-[98px] items-center justify-between rounded-lg"),children:[(0,F.jsx)(mD.default,{title:a("operator.zoomOut",{ns:"workflow"}),shortcuts:["ctrl","-"],children:(0,F.jsx)("div",{className:`flex h-8 w-8 items-center justify-center rounded-lg ${f<=.25?"cursor-not-allowed":"cursor-pointer hover:bg-black/5"}`,onClick:a=>{f<=.25||(a.stopPropagation(),c())},children:(0,F.jsx)(Y.RiZoomOutLine,{className:"h-4 w-4 text-text-tertiary hover:text-text-secondary"})})}),(0,F.jsxs)("div",{onClick:m,className:(0,S.cn)("system-sm-medium w-[34px] text-text-tertiary hover:text-text-secondary"),children:[Number.parseFloat(`${100*f}`).toFixed(0),"%"]}),(0,F.jsx)(mD.default,{title:a("operator.zoomIn",{ns:"workflow"}),shortcuts:["ctrl","+"],children:(0,F.jsx)("div",{className:`flex h-8 w-8 items-center justify-center rounded-lg ${f>=2?"cursor-not-allowed":"cursor-pointer hover:bg-black/5"}`,onClick:a=>{f>=2||(a.stopPropagation(),b())},children:(0,F.jsx)(Y.RiZoomInLine,{className:"h-4 w-4 text-text-tertiary hover:text-text-secondary"})})})]})})}),(0,F.jsx)(bh.PortalToFollowElemContent,{className:"z-10",children:(0,F.jsx)("div",{className:"w-[145px] rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur shadow-lg backdrop-blur-[5px]",children:l.map((a,b)=>(0,F.jsxs)(K.Fragment,{children:[0!==b&&(0,F.jsx)(bA.default,{className:"m-0"}),(0,F.jsx)("div",{className:"p-1",children:a.map(a=>(0,F.jsxs)("div",{className:"system-md-regular flex h-8 cursor-pointer items-center justify-between space-x-1 rounded-lg py-1.5 pl-3 pr-2 text-text-secondary hover:bg-state-base-hover",onClick:()=>{var b;return b=a.key,void(!j&&("zoomToFit"===b&&e(),"zoomTo25"===b&&d(.25),"zoomTo50"===b&&d(.5),"zoomTo75"===b&&d(.75),"zoomTo100"===b&&d(1),"zoomTo200"===b&&d(2),g()))},children:[(0,F.jsx)("span",{children:a.text}),(0,F.jsxs)("div",{className:"flex items-center space-x-0.5",children:["zoomToFit"===a.key&&(0,F.jsx)(dx.default,{keys:["ctrl","1"]}),"zoomTo50"===a.key&&(0,F.jsx)(dx.default,{keys:["shift","5"]}),"zoomTo100"===a.key&&(0,F.jsx)(dx.default,{keys:["shift","1"]})]})]},a.key))})]},b))})})]})}),nb=(0,K.memo)(({handleUndo:a,handleRedo:b})=>{let c=(0,K.useRef)(null),d=(0,aP.useStore)(a=>a.workflowCanvasWidth),e=(0,aP.useStore)(a=>a.rightPanelWidth),f=(0,aP.useStore)(a=>a.setBottomPanelWidth),g=(0,aP.useStore)(a=>a.setBottomPanelHeight),h=(0,K.useMemo)(()=>d&&e?Math.max(d-e,400):"auto",[d,e]),i=(0,K.useCallback)(a=>a.data?.selected?"bg-workflow-minimap-block border-components-option-card-option-selected-border":"bg-workflow-minimap-block",[]);return(0,K.useEffect)(()=>{if(c.current){let a=new ResizeObserver(a=>{for(let b of a){let{inlineSize:a,blockSize:c}=b.borderBoxSize[0];f(a),g(c)}});return a.observe(c.current),()=>{a.disconnect()}}},[g,f]),(0,F.jsxs)("div",{ref:c,className:"absolute bottom-0 left-0 right-0 z-10 px-1",style:{width:h},children:[(0,F.jsxs)("div",{className:"flex justify-between px-1 pb-2",children:[(0,F.jsx)("div",{className:"flex items-center gap-2",children:(0,F.jsx)(mF,{handleUndo:a,handleRedo:b})}),(0,F.jsx)(m8,{}),(0,F.jsxs)("div",{className:"relative",children:[(0,F.jsx)(mC.MiniMap,{pannable:!0,zoomable:!0,style:{width:102,height:72},maskColor:"var(--color-workflow-minimap-bg)",nodeClassName:i,nodeStrokeWidth:3,className:"!absolute !bottom-10 z-[9] !m-0 !h-[73px] !w-[103px] !rounded-lg !border-[0.5px] !border-divider-subtle !bg-background-default-subtle !shadow-md !shadow-shadow-shadow-5"}),(0,F.jsx)(na,{})]})]}),(0,F.jsx)(m7,{})]})}),nc=(0,K.memo)(({renderTrigger:a,offset:b})=>{let{t:c}=(0,$.useTranslation)(),d=(0,N.useStoreApi)(),e=(0,aP.useWorkflowStore)(),f=(0,aq.useIsChatMode)(),{nodesReadOnly:g}=(0,aq.useNodesReadOnly)(),{handlePaneContextmenuCancel:h}=(0,mq.usePanelInteractions)(),[i,j]=(0,K.useState)(!1),{availableNextBlocks:k}=(0,an.useAvailableBlocks)(aC.BlockEnum.Start,!1),{nodesMap:l}=(0,ap.useNodesMetaData)(),m=(0,as.useHooksStore)(a=>a.configsMap?.flowType)!==aJ.FlowType.ragPipeline&&!f,n=(0,K.useCallback)(a=>{j(a),a||h()},[h]),o=(0,K.useCallback)((a,b)=>{let{getNodes:c}=d.getState(),f=c().filter(b=>b.data.type===a),{defaultValue:g}=l[a],{newNode:h}=(0,aR.generateNewNode)({type:(0,aR.getNodeCustomTypeByNodeDataType)(a),data:{...g,title:f.length>0?`${g.title} ${f.length+1}`:g.title,...b,_isCandidate:!0},position:{x:0,y:0}});e.setState({candidateNode:h})},[d,e,l]),p=(0,K.useCallback)(a=>(0,F.jsx)(mD.default,{title:c("common.addBlock",{ns:"workflow"}),children:(0,F.jsx)("div",{className:(0,S.cn)("flex h-8 w-8 cursor-pointer items-center justify-center rounded-lg text-text-tertiary hover:bg-state-base-hover hover:text-text-secondary",`${g&&"cursor-not-allowed text-text-disabled hover:bg-transparent hover:text-text-disabled"}`,a&&"bg-state-accent-active text-text-accent"),children:(0,F.jsx)(Y.RiAddCircleFill,{className:"h-4 w-4"})})}),[g,c]);return(0,F.jsx)(dT,{open:i,onOpenChange:n,disabled:g,onSelect:o,placement:"right-start",offset:b??{mainAxis:4,crossAxis:-8},trigger:a||p,popupClassName:"!min-w-[256px]",availableBlocksTypes:k,showStartTab:m})});var nd=a.i(447968);let ne=()=>{let a=(0,aP.useWorkflowStore)(),{userProfile:b}=(0,iZ.useAppContext)();return{handleAddNote:(0,K.useCallback)(()=>{let{newNode:c}=(0,aR.generateNewNode)({type:ma.CUSTOM_NOTE_NODE,data:{title:"",desc:"",type:"",text:"",theme:nd.NoteTheme.blue,author:b?.name||"",showAuthor:!0,width:240,height:88,_isCandidate:!0},position:{x:0,y:0}});a.setState({candidateNode:c})},[a,b])}},nf=(c=0,()=>(c+=1,`u${`0000${(1679616*Math.random()|0).toString(36)}`.slice(-4)}${c}`));function ng(a){let b=[];for(let c=0,d=a.length;c<d;c++)b.push(a[c]);return b}let nh=null;function ni(a={}){return nh||(nh=a.includeStyleProperties?a.includeStyleProperties:ng(window.getComputedStyle(document.documentElement)))}function nj(a,b){let c=(a.ownerDocument.defaultView||window).getComputedStyle(a).getPropertyValue(b);return c?parseFloat(c.replace("px","")):0}function nk(a,b={}){let c,d,e,f;return{width:b.width||(c=nj(a,"border-left-width"),d=nj(a,"border-right-width"),a.clientWidth+c+d),height:b.height||(e=nj(a,"border-top-width"),f=nj(a,"border-bottom-width"),a.clientHeight+e+f)}}function nl(a){return new Promise((b,c)=>{let d=new Image;d.onload=()=>{d.decode().then(()=>{requestAnimationFrame(()=>b(d))})},d.onerror=c,d.crossOrigin="anonymous",d.decoding="async",d.src=a})}async function nm(a){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(a)).then(encodeURIComponent).then(a=>`data:image/svg+xml;charset=utf-8,${a}`)}async function nn(a,b,c){let d="http://www.w3.org/2000/svg",e=document.createElementNS(d,"svg"),f=document.createElementNS(d,"foreignObject");return e.setAttribute("width",`${b}`),e.setAttribute("height",`${c}`),e.setAttribute("viewBox",`0 0 ${b} ${c}`),f.setAttribute("width","100%"),f.setAttribute("height","100%"),f.setAttribute("x","0"),f.setAttribute("y","0"),f.setAttribute("externalResourcesRequired","true"),e.appendChild(f),f.appendChild(a),nm(e)}let no=(a,b)=>{if(a instanceof b)return!0;let c=Object.getPrototypeOf(a);return null!==c&&(c.constructor.name===b.name||no(c,b))};function np(a,b,c,d){let e,f,g,h=window.getComputedStyle(a,c),i=h.getPropertyValue("content");if(""===i||"none"===i)return;let j=nf();try{b.className=`${b.className} ${j}`}catch(a){return}let k=document.createElement("style");k.appendChild((e=`.${j}:${c}`,g=h.cssText?(f=h.getPropertyValue("content"),`${h.cssText} content: '${f.replace(/'|"/g,"")}';`):ni(d).map(a=>{let b=h.getPropertyValue(a),c=h.getPropertyPriority(a);return`${a}: ${b}${c?" !important":""};`}).join(" "),document.createTextNode(`${e}{${g}}`))),b.appendChild(k)}let nq="application/font-woff",nr="image/jpeg",ns={woff:nq,woff2:nq,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:nr,jpeg:nr,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function nt(a){let b;return ns[((b=/\.([^./]*?)$/g.exec(a))?b[1]:"").toLowerCase()]||""}function nu(a){return -1!==a.search(/^(data:)/)}function nv(a,b){return`data:${b};base64,${a}`}async function nw(a,b,c){let d=await fetch(a,b);if(404===d.status)throw Error(`Resource "${d.url}" not found`);let e=await d.blob();return new Promise((a,b)=>{let f=new FileReader;f.onerror=b,f.onloadend=()=>{try{a(c({res:d,result:f.result}))}catch(a){b(a)}},f.readAsDataURL(e)})}let nx={};async function ny(a,b,c){var d,e,f;let g,h,i=(d=a,e=b,f=c.includeQueryParams,h=d.replace(/\?.*/,""),f&&(h=d),/ttf|otf|eot|woff2?/i.test(h)&&(h=h.replace(/.*\//,"")),e?`[${e}]${h}`:h);if(null!=nx[i])return nx[i];c.cacheBust&&(a+=(/\?/.test(a)?"&":"?")+new Date().getTime());try{let d=await nw(a,c.fetchRequestInit,({res:a,result:c})=>(b||(b=a.headers.get("Content-Type")||""),c.split(/,/)[1]));g=nv(d,b)}catch(d){g=c.imagePlaceholder||"";let b=`Failed to fetch resource: ${a}`;d&&(b="string"==typeof d?d:d.message),b&&console.warn(b)}return nx[i]=g,g}async function nz(a){let b=a.toDataURL();return"data:,"===b?a.cloneNode(!1):nl(b)}async function nA(a,b){if(a.currentSrc){let b=document.createElement("canvas"),c=b.getContext("2d");return b.width=a.clientWidth,b.height=a.clientHeight,null==c||c.drawImage(a,0,0,b.width,b.height),nl(b.toDataURL())}let c=a.poster,d=nt(c);return nl(await ny(c,d,b))}async function nB(a,b){var c;try{if(null==(c=null==a?void 0:a.contentDocument)?void 0:c.body)return await nG(a.contentDocument.body,b,!0)}catch(a){}return a.cloneNode(!1)}async function nC(a,b){return no(a,HTMLCanvasElement)?nz(a):no(a,HTMLVideoElement)?nA(a,b):no(a,HTMLIFrameElement)?nB(a,b):a.cloneNode(nD(a))}let nD=a=>null!=a.tagName&&"SVG"===a.tagName.toUpperCase();async function nE(a,b,c){var d,e;if(nD(b))return b;let f=[];return 0===(f=null!=a.tagName&&"SLOT"===a.tagName.toUpperCase()&&a.assignedNodes?ng(a.assignedNodes()):no(a,HTMLIFrameElement)&&(null==(d=a.contentDocument)?void 0:d.body)?ng(a.contentDocument.body.childNodes):ng((null!=(e=a.shadowRoot)?e:a).childNodes)).length||no(a,HTMLVideoElement)||await f.reduce((a,d)=>a.then(()=>nG(d,c)).then(a=>{a&&b.appendChild(a)}),Promise.resolve()),b}async function nF(a,b){let c=a.querySelectorAll?a.querySelectorAll("use"):[];if(0===c.length)return a;let d={};for(let e=0;e<c.length;e++){let f=c[e].getAttribute("xlink:href");if(f){let c=a.querySelector(f),e=document.querySelector(f);c||!e||d[f]||(d[f]=await nG(e,b,!0))}}let e=Object.values(d);if(e.length){let b="http://www.w3.org/1999/xhtml",c=document.createElementNS(b,"svg");c.setAttribute("xmlns",b),c.style.position="absolute",c.style.width="0",c.style.height="0",c.style.overflow="hidden",c.style.display="none";let d=document.createElementNS(b,"defs");c.appendChild(d);for(let a=0;a<e.length;a++)d.appendChild(e[a]);a.appendChild(c)}return a}async function nG(a,b,c){return c||!b.filter||b.filter(a)?Promise.resolve(a).then(a=>nC(a,b)).then(c=>nE(a,c,b)).then(c=>(function(a,b,c){if(no(b,Element)&&(!function(a,b,c){let d=b.style;if(!d)return;let e=window.getComputedStyle(a);e.cssText?(d.cssText=e.cssText,d.transformOrigin=e.transformOrigin):ni(c).forEach(c=>{let f=e.getPropertyValue(c);if("font-size"===c&&f.endsWith("px")){let a=Math.floor(parseFloat(f.substring(0,f.length-2)))-.1;f=`${a}px`}no(a,HTMLIFrameElement)&&"display"===c&&"inline"===f&&(f="block"),"d"===c&&b.getAttribute("d")&&(f=`path(${b.getAttribute("d")})`),d.setProperty(c,f,e.getPropertyPriority(c))})}(a,b,c),np(a,b,":before",c),np(a,b,":after",c),no(a,HTMLTextAreaElement)&&(b.innerHTML=a.value),no(a,HTMLInputElement)&&b.setAttribute("value",a.value),no(a,HTMLSelectElement))){let c=Array.from(b.children).find(b=>a.value===b.getAttribute("value"));c&&c.setAttribute("selected","")}return b})(a,c,b)).then(a=>nF(a,b)):null}let nH=/url\((['"]?)([^'"]+?)\1\)/g,nI=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,nJ=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;async function nK(a,b,c,d,e){try{let f,g,h=c?function(a,b){if(a.match(/^[a-z]+:\/\//i))return a;if(a.match(/^\/\//))return window.location.protocol+a;if(a.match(/^[a-z]+:/i))return a;let c=document.implementation.createHTMLDocument(),d=c.createElement("base"),e=c.createElement("a");return c.head.appendChild(d),c.body.appendChild(e),b&&(d.href=b),e.href=a,e.href}(b,c):b,i=nt(b);if(e){let a=await e(h);f=nv(a,i)}else f=await ny(h,i,d);return a.replace((g=b.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1"),RegExp(`(url\\(['"]?)(${g})(['"]?\\))`,"g")),`$1${f}$3`)}catch(a){}return a}function nL(a){return -1!==a.search(nH)}async function nM(a,b,c){let d;if(!nL(a))return a;let e=function(a,{preferredFontFormat:b}){return b?a.replace(nJ,a=>{for(;;){let[c,,d]=nI.exec(a)||[];if(!d)return"";if(d===b)return`src: ${c};`}}):a}(a,c);return(d=[],e.replace(nH,(a,b,c)=>(d.push(c),a)),d.filter(a=>!nu(a))).reduce((a,d)=>a.then(a=>nK(a,d,b,c)),Promise.resolve(e))}async function nN(a,b,c){var d;let e=null==(d=b.style)?void 0:d.getPropertyValue(a);if(e){let d=await nM(e,null,c);return b.style.setProperty(a,d,b.style.getPropertyPriority(a)),!0}return!1}async function nO(a,b){await nN("background",a,b)||await nN("background-image",a,b),await nN("mask",a,b)||await nN("-webkit-mask",a,b)||await nN("mask-image",a,b)||await nN("-webkit-mask-image",a,b)}async function nP(a,b){let c=no(a,HTMLImageElement);if(!(c&&!nu(a.src))&&!(no(a,SVGImageElement)&&!nu(a.href.baseVal)))return;let d=c?a.src:a.href.baseVal,e=await ny(d,nt(d),b);await new Promise((d,f)=>{a.onload=d,a.onerror=b.onImageErrorHandler?(...a)=>{try{d(b.onImageErrorHandler(...a))}catch(a){f(a)}}:f,a.decode&&(a.decode=d),"lazy"===a.loading&&(a.loading="eager"),c?(a.srcset="",a.src=e):a.href.baseVal=e})}async function nQ(a,b){let c=ng(a.childNodes).map(a=>nR(a,b));await Promise.all(c).then(()=>a)}async function nR(a,b){no(a,Element)&&(await nO(a,b),await nP(a,b),await nQ(a,b))}let nS={};async function nT(a){let b=nS[a];if(null!=b)return b;let c=await fetch(a);return b={url:a,cssText:await c.text()},nS[a]=b,b}async function nU(a,b){let c=a.cssText,d=/url\(["']?([^"')]+)["']?\)/g;return Promise.all((c.match(/url\([^)]+\)/g)||[]).map(async e=>{let f=e.replace(d,"$1");return f.startsWith("https://")||(f=new URL(f,a.url).href),nw(f,b.fetchRequestInit,({result:a})=>(c=c.replace(e,`url(${a})`),[e,a]))})).then(()=>c)}function nV(a){if(null==a)return[];let b=[],c=a.replace(/(\/\*[\s\S]*?\*\/)/gi,""),d=RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){let a=d.exec(c);if(null===a)break;b.push(a[0])}c=c.replace(d,"");let e=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,f=RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");for(;;){let a=e.exec(c);if(null===a){if(null===(a=f.exec(c)))break;e.lastIndex=f.lastIndex}else f.lastIndex=e.lastIndex;b.push(a[0])}return b}async function nW(a,b){let c=[],d=[];return a.forEach(c=>{if("cssRules"in c)try{ng(c.cssRules||[]).forEach((a,e)=>{if(a.type===CSSRule.IMPORT_RULE){let f=e+1,g=a.href,h=nT(g).then(a=>nU(a,b)).then(a=>nV(a).forEach(a=>{try{c.insertRule(a,a.startsWith("@import")?f+=1:c.cssRules.length)}catch(b){console.error("Error inserting rule from remote css",{rule:a,error:b})}})).catch(a=>{console.error("Error loading remote css",a.toString())});d.push(h)}})}catch(f){let e=a.find(a=>null==a.href)||document.styleSheets[0];null!=c.href&&d.push(nT(c.href).then(a=>nU(a,b)).then(a=>nV(a).forEach(a=>{e.insertRule(a,e.cssRules.length)})).catch(a=>{console.error("Error loading remote stylesheet",a)})),console.error("Error inlining remote css file",f)}}),Promise.all(d).then(()=>(a.forEach(a=>{if("cssRules"in a)try{ng(a.cssRules||[]).forEach(a=>{c.push(a)})}catch(b){console.error(`Error while reading CSS rules from ${a.href}`,b)}}),c))}async function nX(a,b){if(null==a.ownerDocument)throw Error("Provided element is not within a Document");let c=ng(a.ownerDocument.styleSheets);return(await nW(c,b)).filter(a=>a.type===CSSRule.FONT_FACE_RULE).filter(a=>nL(a.style.getPropertyValue("src")))}function nY(a){return a.trim().replace(/["']/g,"")}async function nZ(a,b){let c,d=await nX(a,b),e=(c=new Set,!function a(b){(b.style.fontFamily||getComputedStyle(b).fontFamily).split(",").forEach(a=>{c.add(nY(a))}),Array.from(b.children).forEach(b=>{b instanceof HTMLElement&&a(b)})}(a),c);return(await Promise.all(d.filter(a=>e.has(nY(a.style.fontFamily))).map(a=>{let c=a.parentStyleSheet?a.parentStyleSheet.href:null;return nM(a.cssText,c,b)}))).join("\n")}async function n$(a,b){let c=null!=b.fontEmbedCSS?b.fontEmbedCSS:b.skipFonts?null:await nZ(a,b);if(c){let b=document.createElement("style"),d=document.createTextNode(c);b.appendChild(d),a.firstChild?a.insertBefore(b,a.firstChild):a.appendChild(b)}}async function n_(a,b={}){let{width:c,height:d}=nk(a,b),e=await nG(a,b,!0);return await n$(e,b),await nR(e,b),!function(a,b){let{style:c}=a;b.backgroundColor&&(c.backgroundColor=b.backgroundColor),b.width&&(c.width=`${b.width}px`),b.height&&(c.height=`${b.height}px`);let d=b.style;null!=d&&Object.keys(d).forEach(a=>{c[a]=d[a]})}(e,b),await nn(e,c,d)}async function n0(a,b={}){let{width:c,height:d}=nk(a,b),e=await n_(a,b),f=await nl(e),g=document.createElement("canvas"),h=g.getContext("2d"),i=b.pixelRatio||function(){let a,b;try{b=process}catch(a){}let c=b&&b.env?b.env.devicePixelRatio:null;return c&&Number.isNaN(a=parseInt(c,10))&&(a=1),a||window.devicePixelRatio||1}(),j=b.canvasWidth||c,k=b.canvasHeight||d;return g.width=j*i,g.height=k*i,!b.skipAutoScale&&(g.width>16384||g.height>16384)&&(g.width>16384&&g.height>16384?g.width>g.height?(g.height*=16384/g.width,g.width=16384):(g.width*=16384/g.height,g.height=16384):g.width>16384?(g.height*=16384/g.width,g.width=16384):(g.width*=16384/g.height,g.height=16384)),g.style.width=`${j}`,g.style.height=`${k}`,b.backgroundColor&&(h.fillStyle=b.backgroundColor,h.fillRect(0,0,g.width,g.height)),h.drawImage(f,0,0,g.width,g.height),g}async function n1(a,b={}){return(await n0(a,b)).toDataURL()}async function n2(a,b={}){return(await n0(a,b)).toDataURL("image/jpeg",b.quality||1)}var n3=a.i(530007);let n4=(0,K.memo)(()=>{let{t:a}=(0,$.useTranslation)(),{getNodesReadOnly:b}=(0,aq.useNodesReadOnly)(),c=(0,N.useReactFlow)(),[d,e]=(0,K.useState)(!1),[f,g]=(0,K.useState)(""),[h,i]=(0,K.useState)(""),j=(0,aP.useStore)(a=>a.knowledgeName),k=(0,aP.useStore)(a=>a.appName),l=(0,aP.useStore)(a=>a.maximizeCanvas),{appSidebarExpand:m}=(0,aa.useStore)((0,_.useShallow)(a=>({appSidebarExpand:a.appSidebarExpand}))),n=(0,K.useMemo)(()=>l?40:"expand"===m?188:40,[m,l]),o=(0,K.useCallback)(async(a,d=!1)=>{if(!k&&!j||b())return;e(!1);let f=document.querySelector(".react-flow__viewport");if(f)try{let b,e=k||j,h=a=>!(a instanceof HTMLImageElement)||a.complete&&0!==a.naturalHeight;if(d){let d=c.getNodes(),g=(0,N.getNodesBounds)(d),i=c.getViewport(),j=window.innerWidth,k=window.innerHeight,l=Math.min(j/(g.width+100),k/(g.height+100),1),m=g.x+g.width/2,n=g.y+g.height/2;c.setViewport({x:j/2-m*l,y:k/2-n*l,zoom:l}),await new Promise(a=>setTimeout(a,300));let o=g.width+100,p=g.height+100,q={filter:h,backgroundColor:"#1a1a1a",pixelRatio:2,width:o,height:p,style:{width:`${o}px`,height:`${p}px`,transform:`translate(${50-g.x}px, ${50-g.y}px)`,transformOrigin:"top left"}};switch(a){case"png":default:b=await n1(f,q);break;case"jpeg":b=await n2(f,q);break;case"svg":b=await n_(f,{filter:h})}e+="-whole-workflow",setTimeout(()=>{c.setViewport(i)},500)}else switch(a){case"png":default:b=await n1(f,{filter:h});break;case"jpeg":b=await n2(f,{filter:h});break;case"svg":b=await n_(f,{filter:h})}let l=`${e}.${a}`;d&&(g(b),i(l)),(0,dg.downloadUrl)({url:b,fileName:l})}catch(a){console.error("Export image failed:",a)}},[b,k,c,j]),p=(0,K.useCallback)(()=>{b()||e(a=>!a)},[b]);return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)(bh.PortalToFollowElem,{open:d,onOpenChange:e,placement:"bottom-end",offset:{mainAxis:-200,crossAxis:n},children:[(0,F.jsx)(bh.PortalToFollowElemTrigger,{children:(0,F.jsx)(mD.default,{title:a("common.moreActions",{ns:"workflow"}),children:(0,F.jsx)("div",{className:(0,S.cn)("flex h-8 w-8 cursor-pointer items-center justify-center rounded-lg hover:bg-state-base-hover hover:text-text-secondary",`${b()&&"cursor-not-allowed text-text-disabled hover:bg-transparent hover:text-text-disabled"}`),onClick:p,children:(0,F.jsx)(Y.RiMoreFill,{className:"h-4 w-4"})})})}),(0,F.jsx)(bh.PortalToFollowElemContent,{className:"z-10",children:(0,F.jsx)("div",{className:"min-w-[180px] rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg-blur text-text-secondary shadow-lg",children:(0,F.jsxs)("div",{className:"p-1",children:[(0,F.jsxs)("div",{className:"flex items-center gap-2 px-2 py-1 text-xs font-medium text-text-tertiary",children:[(0,F.jsx)(Y.RiExportLine,{className:"h-3 w-3"}),a("common.exportImage",{ns:"workflow"})]}),(0,F.jsx)("div",{className:"px-2 py-1 text-xs font-medium text-text-tertiary",children:a("common.currentView",{ns:"workflow"})}),(0,F.jsx)("div",{className:"system-md-regular flex h-8 cursor-pointer items-center rounded-lg px-2 hover:bg-state-base-hover",onClick:()=>o("png"),children:a("common.exportPNG",{ns:"workflow"})}),(0,F.jsx)("div",{className:"system-md-regular flex h-8 cursor-pointer items-center rounded-lg px-2 hover:bg-state-base-hover",onClick:()=>o("jpeg"),children:a("common.exportJPEG",{ns:"workflow"})}),(0,F.jsx)("div",{className:"system-md-regular flex h-8 cursor-pointer items-center rounded-lg px-2 hover:bg-state-base-hover",onClick:()=>o("svg"),children:a("common.exportSVG",{ns:"workflow"})}),(0,F.jsx)("div",{className:"border-border-divider mx-2 my-1 border-t"}),(0,F.jsx)("div",{className:"px-2 py-1 text-xs font-medium text-text-tertiary",children:a("common.currentWorkflow",{ns:"workflow"})}),(0,F.jsx)("div",{className:"system-md-regular flex h-8 cursor-pointer items-center rounded-lg px-2 hover:bg-state-base-hover",onClick:()=>o("png",!0),children:a("common.exportPNG",{ns:"workflow"})}),(0,F.jsx)("div",{className:"system-md-regular flex h-8 cursor-pointer items-center rounded-lg px-2 hover:bg-state-base-hover",onClick:()=>o("jpeg",!0),children:a("common.exportJPEG",{ns:"workflow"})}),(0,F.jsx)("div",{className:"system-md-regular flex h-8 cursor-pointer items-center rounded-lg px-2 hover:bg-state-base-hover",onClick:()=>o("svg",!0),children:a("common.exportSVG",{ns:"workflow"})})]})})})]}),f&&(0,F.jsx)(n3.default,{url:f,title:h,onCancel:()=>g("")})]})}),n5=(0,K.memo)(()=>{let{t:a}=(0,$.useTranslation)(),b=(0,aP.useStore)(a=>a.controlMode),c=(0,aP.useStore)(a=>a.maximizeCanvas),{handleModePointer:d,handleModeHand:e}=(0,di.useWorkflowMoveMode)(),{handleLayout:f}=(0,di.useWorkflowOrganize)(),{handleAddNote:g}=ne(),{nodesReadOnly:h,getNodesReadOnly:i}=(0,aq.useNodesReadOnly)(),{handleToggleMaximizeCanvas:j}=(0,di.useWorkflowCanvasMaximize)();return(0,F.jsxs)("div",{className:"pointer-events-auto flex flex-col items-center rounded-lg border-[0.5px] border-components-actionbar-border bg-components-actionbar-bg p-0.5 text-text-tertiary shadow-lg",children:[(0,F.jsx)(nc,{}),(0,F.jsx)(mD.default,{title:a("nodes.note.addNote",{ns:"workflow"}),children:(0,F.jsx)("div",{className:(0,S.cn)("ml-[1px] flex h-8 w-8 cursor-pointer items-center justify-center rounded-lg hover:bg-state-base-hover hover:text-text-secondary",`${h&&"cursor-not-allowed text-text-disabled hover:bg-transparent hover:text-text-disabled"}`),onClick:a=>{i()||(a.stopPropagation(),g())},children:(0,F.jsx)(Y.RiStickyNoteAddLine,{className:"h-4 w-4"})})}),(0,F.jsx)(bA.default,{className:"my-1 w-3.5"}),(0,F.jsx)(mD.default,{title:a("common.pointerMode",{ns:"workflow"}),shortcuts:["v"],children:(0,F.jsx)("div",{className:(0,S.cn)("mr-[1px] flex h-8 w-8 cursor-pointer items-center justify-center rounded-lg",b===aC.ControlMode.Pointer?"bg-state-accent-active text-text-accent":"hover:bg-state-base-hover hover:text-text-secondary",`${h&&"cursor-not-allowed text-text-disabled hover:bg-transparent hover:text-text-disabled"}`),onClick:d,children:(0,F.jsx)(Y.RiCursorLine,{className:"h-4 w-4"})})}),(0,F.jsx)(mD.default,{title:a("common.handMode",{ns:"workflow"}),shortcuts:["h"],children:(0,F.jsx)("div",{className:(0,S.cn)("flex h-8 w-8 cursor-pointer items-center justify-center rounded-lg",b===aC.ControlMode.Hand?"bg-state-accent-active text-text-accent":"hover:bg-state-base-hover hover:text-text-secondary",`${h&&"cursor-not-allowed text-text-disabled hover:bg-transparent hover:text-text-disabled"}`),onClick:e,children:(0,F.jsx)(Y.RiHand,{className:"h-4 w-4"})})}),(0,F.jsx)(bA.default,{className:"my-1 w-3.5"}),(0,F.jsx)(mD.default,{title:a("panel.organizeBlocks",{ns:"workflow"}),shortcuts:["ctrl","o"],children:(0,F.jsx)("div",{className:(0,S.cn)("flex h-8 w-8 cursor-pointer items-center justify-center rounded-lg hover:bg-state-base-hover hover:text-text-secondary",`${h&&"cursor-not-allowed text-text-disabled hover:bg-transparent hover:text-text-disabled"}`),onClick:f,children:(0,F.jsx)(Y.RiFunctionAddLine,{className:"h-4 w-4"})})}),(0,F.jsx)(mD.default,{title:a(c?"panel.minimize":"panel.maximize",{ns:"workflow"}),shortcuts:["f"],children:(0,F.jsxs)("div",{className:(0,S.cn)("flex h-8 w-8 cursor-pointer items-center justify-center rounded-lg hover:bg-state-base-hover hover:text-text-secondary",c?"bg-state-accent-active text-text-accent hover:text-text-accent":"hover:bg-state-base-hover hover:text-text-secondary",`${h&&"cursor-not-allowed text-text-disabled hover:bg-transparent hover:text-text-disabled"}`),onClick:j,children:[c&&(0,F.jsx)(Y.RiAspectRatioFill,{className:"h-4 w-4"}),!c&&(0,F.jsx)(Y.RiAspectRatioLine,{className:"h-4 w-4"})]})}),(0,F.jsx)(n4,{})]})});var n6=a.i(583373),n7=a.i(412795);let n8=(0,K.memo)(()=>{let{t:a}=(0,$.useTranslation)(),b=(0,K.useRef)(null),c=(0,aP.useStore)(a=>a.panelMenu),d=(0,aP.useStore)(a=>a.clipboardElements),e=(0,aP.useStore)(a=>a.setShowImportDSLModal),{handleNodesPaste:f}=(0,V.useNodesInteractions)(),{handlePaneContextmenuCancel:g,handleNodeContextmenuCancel:h}=(0,mq.usePanelInteractions)(),{handleStartWorkflowRun:i}=(0,n7.useWorkflowStartRun)(),{handleAddNote:j}=ne(),{exportCheck:k}=(0,n6.useDSL)();return((0,K.useEffect)(()=>{c&&h()},[c,h]),(0,e4.useClickAway)(()=>{g()},b),c)?(0,F.jsxs)("div",{className:"absolute z-[9] w-[200px] rounded-lg border-[0.5px] border-components-panel-border bg-components-panel-bg-blur shadow-lg",style:{left:c.left,top:c.top},ref:b,children:[(0,F.jsxs)("div",{className:"p-1",children:[(0,F.jsx)(nc,{renderTrigger:()=>(0,F.jsx)("div",{className:"flex h-8 cursor-pointer items-center justify-between rounded-lg px-3 text-sm text-text-secondary hover:bg-state-base-hover",children:a("common.addBlock",{ns:"workflow"})}),offset:{mainAxis:-36,crossAxis:-4}}),(0,F.jsx)("div",{className:"flex h-8 cursor-pointer items-center justify-between rounded-lg px-3 text-sm text-text-secondary hover:bg-state-base-hover",onClick:a=>{a.stopPropagation(),j(),g()},children:a("nodes.note.addNote",{ns:"workflow"})}),(0,F.jsxs)("div",{className:"flex h-8 cursor-pointer items-center justify-between rounded-lg px-3 text-sm text-text-secondary hover:bg-state-base-hover",onClick:()=>{i(),g()},children:[a("common.run",{ns:"workflow"}),(0,F.jsx)(dx.default,{keys:["alt","r"]})]})]}),(0,F.jsx)(bA.default,{className:"m-0"}),(0,F.jsx)("div",{className:"p-1",children:(0,F.jsxs)("div",{className:(0,S.cn)("flex h-8 cursor-pointer items-center justify-between rounded-lg px-3 text-sm text-text-secondary",d.length?"hover:bg-state-base-hover":"cursor-not-allowed opacity-50"),onClick:()=>{d.length&&(f(),g())},children:[a("common.pasteHere",{ns:"workflow"}),(0,F.jsx)(dx.default,{keys:["ctrl","v"]})]})}),(0,F.jsx)(bA.default,{className:"m-0"}),(0,F.jsxs)("div",{className:"p-1",children:[(0,F.jsx)("div",{className:"flex h-8 cursor-pointer items-center justify-between rounded-lg px-3 text-sm text-text-secondary hover:bg-state-base-hover",onClick:()=>k?.(),children:a("export",{ns:"app"})}),(0,F.jsx)("div",{className:"flex h-8 cursor-pointer items-center justify-between rounded-lg px-3 text-sm text-text-secondary hover:bg-state-base-hover",onClick:()=>e(!0),children:a("common.importDSL",{ns:"workflow"})})]})]}):null});var n9=((D=n9||{}).Left="left",D.Center="center",D.Right="right",D.Top="top",D.Middle="middle",D.Bottom="bottom",D.DistributeHorizontal="distributeHorizontal",D.DistributeVertical="distributeVertical",D);let oa=(0,K.memo)(()=>{let{t:a}=(0,$.useTranslation)(),b=(0,K.useRef)(null),{getNodesReadOnly:c}=(0,aq.useNodesReadOnly)(),{handleSelectionContextmenuCancel:d}=(0,mr.useSelectionInteractions)(),e=(0,aP.useStore)(a=>a.selectionMenu),f=(0,N.useStoreApi)(),g=(0,aP.useWorkflowStore)(),h=(0,N.useStore)(a=>a.getNodes().filter(a=>a.selected)),{handleSyncWorkflowDraft:i}=(0,W.useNodesSyncDraft)(),{saveStateToHistory:j}=(0,X.useWorkflowHistory)(),k=(0,K.useRef)(null),l=(0,K.useMemo)(()=>{if(!e)return{left:0,top:0};let a=e.left,b=e.top,c=document.querySelector("#workflow-container");if(c){let{width:d,height:e}=c.getBoundingClientRect();a+240>d&&(a-=240),b+380>e&&(b-=380),a=Math.max(0,a),b=Math.max(0,b)}return{left:a,top:b}},[e]);(0,e4.useClickAway)(()=>{d()},b),(0,K.useEffect)(()=>{e&&h.length<=1&&d()},[e,h.length,d]);let m=(0,K.useCallback)((a,b,c,d,e,f,g)=>{let h=b.width,i=b.height;switch(c){case"left":a.position.x=d,a.positionAbsolute&&(a.positionAbsolute.x=d);break;case"center":{let b=d+(e-d)/2-h/2;a.position.x=b,a.positionAbsolute&&(a.positionAbsolute.x=b);break}case"right":{let b=e-h;a.position.x=b,a.positionAbsolute&&(a.positionAbsolute.x=b);break}case"top":a.position.y=f,a.positionAbsolute&&(a.positionAbsolute.y=f);break;case"middle":{let b=f+(g-f)/2-i/2;a.position.y=b,a.positionAbsolute&&(a.positionAbsolute.y=b);break}case"bottom":{let b=Math.round(g-i);a.position.y=b,a.positionAbsolute&&(a.positionAbsolute.y=b)}}},[]),n=(0,K.useCallback)((a,b,c)=>{let d=[...a].sort((a,b)=>"distributeHorizontal"===c?a.position.x-b.position.x:a.position.y-b.position.y);if(d.length<3)return null;let e=0,f=0;if("distributeHorizontal"===c){let a=d[0].position.x;e=d[d.length-1].position.x+(d[d.length-1].width||0)-a,f=d.reduce((a,b)=>a+(b.width||0),0)}else{let a=d[0].position.y;e=d[d.length-1].position.y+(d[d.length-1].height||0)-a,f=d.reduce((a,b)=>a+(b.height||0),0)}let g=(e-f)/(d.length-1);return g<=0?null:(0,I.produce)(b,a=>{let b;b="distributeHorizontal"===c?d[0].position.x+(d[0].width||0):d[0].position.y+(d[0].height||0);for(let e=1;e<d.length-1;e++){let f=d[e],h=a.find(a=>a.id===f.id);if(h)if("distributeHorizontal"===c){let a=b+g;h.position.x=a,h.positionAbsolute&&(h.positionAbsolute.x=a),b=a+(f.width||0)}else{let a=b+g;h.position.y=a,h.positionAbsolute&&(h.positionAbsolute.y=a),b=a+(f.height||0)}}})},[]),o=(0,K.useCallback)(a=>{if(c()||h.length<=1)return void d();g.setState({nodeAnimation:!1});let b=f.getState().getNodes(),e=h.map(a=>a.id),k=new Set;b.forEach(a=>{a.data._children&&a.data._children.length>0&&e.includes(a.id)&&a.data._children.forEach(a=>{k.add(a.nodeId)})});let l=b.filter(a=>e.includes(a.id)&&!k.has(a.id));if(l.length<=1)return void d();let o=Number.MAX_SAFE_INTEGER,p=Number.MIN_SAFE_INTEGER,q=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;if(l.filter(a=>a.width&&a.height).forEach(a=>{let b=a.width,c=a.height;o=Math.min(o,a.position.x),p=Math.max(p,a.position.x+b),q=Math.min(q,a.position.y),r=Math.max(r,a.position.y+c)}),"distributeHorizontal"===a||"distributeVertical"===a){let c=n(l,b,a);if(c){f.getState().setNodes(c),d();let{setHelpLineHorizontal:a,setHelpLineVertical:b}=g.getState();a(),b(),i(),j(X.WorkflowHistoryEvent.NodeDragStop);return}}let s=(0,I.produce)(b,b=>{l.filter(a=>a.width&&a.height).forEach(c=>{let d=b.find(a=>a.id===c.id);d&&m(d,c,a,o,p,q,r)})});try{f.getState().setNodes(s),d();let{setHelpLineHorizontal:a,setHelpLineVertical:b}=g.getState();a(),b(),i(),j(X.WorkflowHistoryEvent.NodeDragStop)}catch(a){console.error("Failed to update nodes:",a)}},[f,g,h,c,i,j,d,m,n]);return e?(0,F.jsx)("div",{className:"absolute z-[9]",style:{left:l.left,top:l.top},ref:b,children:(0,F.jsxs)("div",{ref:k,className:"w-[240px] rounded-lg border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-xl",children:[(0,F.jsxs)("div",{className:"p-1",children:[(0,F.jsx)("div",{className:"system-xs-medium px-2 py-2 text-text-tertiary",children:a("operator.vertical",{ns:"workflow"})}),(0,F.jsxs)("div",{className:"flex h-8 cursor-pointer items-center gap-2 rounded-lg px-3 text-sm text-text-secondary hover:bg-state-base-hover",onClick:()=>o("top"),children:[(0,F.jsx)(Y.RiAlignTop,{className:"h-4 w-4"}),a("operator.alignTop",{ns:"workflow"})]}),(0,F.jsxs)("div",{className:"flex h-8 cursor-pointer items-center gap-2 rounded-lg px-3 text-sm text-text-secondary hover:bg-state-base-hover",onClick:()=>o("middle"),children:[(0,F.jsx)(Y.RiAlignCenter,{className:"h-4 w-4 rotate-90"}),a("operator.alignMiddle",{ns:"workflow"})]}),(0,F.jsxs)("div",{className:"flex h-8 cursor-pointer items-center gap-2 rounded-lg px-3 text-sm text-text-secondary hover:bg-state-base-hover",onClick:()=>o("bottom"),children:[(0,F.jsx)(Y.RiAlignBottom,{className:"h-4 w-4"}),a("operator.alignBottom",{ns:"workflow"})]}),(0,F.jsxs)("div",{className:"flex h-8 cursor-pointer items-center gap-2 rounded-lg px-3 text-sm text-text-secondary hover:bg-state-base-hover",onClick:()=>o("distributeVertical"),children:[(0,F.jsx)(Y.RiAlignJustify,{className:"h-4 w-4 rotate-90"}),a("operator.distributeVertical",{ns:"workflow"})]})]}),(0,F.jsx)("div",{className:"h-px bg-divider-regular"}),(0,F.jsxs)("div",{className:"p-1",children:[(0,F.jsx)("div",{className:"system-xs-medium px-2 py-2 text-text-tertiary",children:a("operator.horizontal",{ns:"workflow"})}),(0,F.jsxs)("div",{className:"flex h-8 cursor-pointer items-center gap-2 rounded-lg px-3 text-sm text-text-secondary hover:bg-state-base-hover",onClick:()=>o("left"),children:[(0,F.jsx)(Y.RiAlignLeft,{className:"h-4 w-4"}),a("operator.alignLeft",{ns:"workflow"})]}),(0,F.jsxs)("div",{className:"flex h-8 cursor-pointer items-center gap-2 rounded-lg px-3 text-sm text-text-secondary hover:bg-state-base-hover",onClick:()=>o("center"),children:[(0,F.jsx)(Y.RiAlignCenter,{className:"h-4 w-4"}),a("operator.alignCenter",{ns:"workflow"})]}),(0,F.jsxs)("div",{className:"flex h-8 cursor-pointer items-center gap-2 rounded-lg px-3 text-sm text-text-secondary hover:bg-state-base-hover",onClick:()=>o("right"),children:[(0,F.jsx)(Y.RiAlignRight,{className:"h-4 w-4"}),a("operator.alignRight",{ns:"workflow"})]}),(0,F.jsxs)("div",{className:"flex h-8 cursor-pointer items-center gap-2 rounded-lg px-3 text-sm text-text-secondary hover:bg-state-base-hover",onClick:()=>o("distributeHorizontal"),children:[(0,F.jsx)(Y.RiAlignJustify,{className:"h-4 w-4"}),a("operator.distributeHorizontal",{ns:"workflow"})]})]})]})}):null}),ob=(0,K.memo)(({id:a,data:b})=>{let{nodesReadOnly:c}=(0,aq.useNodesReadOnly)(),d=b.selected||b._isBundled||b._isEntering,{showRunningBorder:e,showSuccessBorder:f,showFailedBorder:g,showExceptionBorder:h}=(0,K.useMemo)(()=>({showRunningBorder:b._runningStatus===aC.NodeRunningStatus.Running&&!d,showSuccessBorder:b._runningStatus===aC.NodeRunningStatus.Succeeded&&!d,showFailedBorder:b._runningStatus===aC.NodeRunningStatus.Failed&&!d,showExceptionBorder:b._runningStatus===aC.NodeRunningStatus.Exception&&!d}),[b._runningStatus,d]);return(0,F.jsx)("div",{className:(0,S.cn)("flex rounded-2xl border-[2px]",d?"border-components-option-card-option-selected-border":"border-transparent",b._waitingRun&&"opacity-70"),style:{width:"auto",height:"auto"},children:(0,F.jsxs)("div",{className:(0,S.cn)("group relative pb-1 shadow-xs","rounded-[15px] border border-transparent","w-[240px] bg-workflow-block-bg",!b._runningStatus&&"hover:shadow-lg",e&&"!border-state-accent-solid",f&&"!border-state-success-solid",g&&"!border-state-destructive-solid",h&&"!border-state-warning-solid",b._isBundled&&"!shadow-lg"),children:[!b._isCandidate&&(0,F.jsx)(ff,{id:a,data:b,handleClassName:"!top-4 !-left-[9px] !translate-y-0",handleId:"target"}),!b._runningStatus&&!c&&!b._isCandidate&&(0,F.jsx)(fi,{id:a,data:b}),(0,F.jsxs)("div",{className:(0,S.cn)("flex items-center rounded-t-2xl px-3 pb-2 pt-3"),children:[(0,F.jsx)(am.default,{className:"mr-2 shrink-0",type:b.type,size:"md"}),(0,F.jsx)("div",{title:b.title,className:"system-sm-semibold-uppercase mr-1 flex grow items-center truncate text-text-primary",children:(0,F.jsx)("div",{children:b.title})}),(b._runningStatus===aC.NodeRunningStatus.Running||b._singleRunningStatus===aC.NodeRunningStatus.Running)&&(0,F.jsx)(Y.RiLoader2Line,{className:"h-3.5 w-3.5 animate-spin text-text-accent"}),b._runningStatus===aC.NodeRunningStatus.Succeeded&&(0,F.jsx)(Y.RiCheckboxCircleFill,{className:"h-3.5 w-3.5 text-text-success"}),b._runningStatus===aC.NodeRunningStatus.Failed&&(0,F.jsx)(Y.RiErrorWarningFill,{className:"h-3.5 w-3.5 text-text-destructive"}),b._runningStatus===aC.NodeRunningStatus.Exception&&(0,F.jsx)(Y.RiAlertFill,{className:"h-3.5 w-3.5 text-text-warning-secondary"})]})]})})});var oc=a.i(739642);let od=()=>(0,aP.useStore)(a=>a.isSyncingWorkflowDraft)?(0,F.jsx)("div",{className:"absolute inset-0 z-[9999]"}):null;var oe=a.i(791881);let of=(0,J.default)(async()=>{},{loadableGenerated:{modules:[920226]},ssr:!1}),og={[T.CUSTOM_NODE]:l8,[ma.CUSTOM_NOTE_NODE]:mf,[oc.CUSTOM_SIMPLE_NODE]:ob,[mA.CUSTOM_ITERATION_START_NODE]:ib,[mB.CUSTOM_LOOP_START_NODE]:j8,[mz]:my},oh={[T.CUSTOM_EDGE]:ml},oi=(0,K.memo)(({nodes:a,edges:b,viewport:c,children:d,onWorkflowDataUpdate:e})=>{let f=(0,K.useRef)(null),g=(0,aP.useWorkflowStore)(),h=(0,N.useReactFlow)(),[i,j]=(0,N.useNodesState)(a),[k,l]=(0,N.useEdgesState)(b),m=(0,aP.useStore)(a=>a.controlMode),n=(0,aP.useStore)(a=>a.nodeAnimation),o=(0,aP.useStore)(a=>a.showConfirm),p=(0,aP.useStore)(a=>a.workflowCanvasHeight),q=(0,aP.useStore)(a=>a.bottomPanelHeight),r=(0,aP.useStore)(a=>a.setWorkflowCanvasWidth),s=(0,aP.useStore)(a=>a.setWorkflowCanvasHeight),t=(0,K.useMemo)(()=>p?p-q:"100%",[p,q]);(0,K.useEffect)(()=>{if(f.current){let a=new ResizeObserver(a=>{for(let b of a){let{inlineSize:a,blockSize:c}=b.borderBoxSize[0];r(a),s(c)}});return a.observe(f.current),()=>{a.disconnect()}}},[s,r]);let{setShowConfirm:u,setControlPromptEditorRerenderKey:v,setSyncWorkflowDraftHash:w,setNodes:x}=g.getState(),y=(0,N.useNodes)(),z=(0,K.useCallback)(a=>{let b=a.map(a=>({id:a.id,data:a.data})),c=g.getState().nodes.map(a=>({id:a.id,data:a.data}));(0,H.isEqual)(c,b)||x(a)},[x,g]);(0,K.useEffect)(()=>{z(y)},[y,z]);let{handleSyncWorkflowDraft:A,syncWorkflowDraftWhenPageClose:B}=(0,W.useNodesSyncDraft)(),{workflowReadOnly:C}=(0,aq.useWorkflowReadOnly)(),{nodesReadOnly:D}=(0,aq.useNodesReadOnly)(),{eventEmitter:E}=(0,P.useEventEmitterContextContext)(),J=(0,N.useStoreApi)();E?.useSubscription(a=>{a.type===T.WORKFLOW_DATA_UPDATE&&(j(a.payload.nodes),J.getState().setNodes(a.payload.nodes),l(a.payload.edges),a.payload.viewport&&h.setViewport(a.payload.viewport),a.payload.hash&&w(a.payload.hash),e?.(a.payload),setTimeout(()=>v(Date.now())))}),(0,K.useEffect)(()=>((0,I.setAutoFreeze)(!1),()=>{(0,I.setAutoFreeze)(!0)}),[]),(0,K.useEffect)(()=>()=>{A(!0,!0)},[A]);let{handleRefreshWorkflowDraft:U}=(0,mu.useWorkflowRefreshDraft)(),X=(0,K.useCallback)(()=>{if("hidden"===document.visibilityState)return void B();if("visible"===document.visibilityState){let{isListening:a,workflowRunningData:b}=g.getState(),c=b?.result?.status;if(a||c===aC.WorkflowRunningStatus.Running)return;setTimeout(()=>U(),500)}},[B,U,g]),Y=(0,K.useCallback)(()=>{B()},[B]);(0,K.useEffect)(()=>(document.addEventListener("visibilitychange",X),window.addEventListener("beforeunload",Y),()=>{document.removeEventListener("visibilitychange",X),window.removeEventListener("beforeunload",Y)}),[X,Y]),(0,G.default)("keydown",a=>{("d"===a.key||"D"===a.key)&&(a.ctrlKey||a.metaKey)&&a.preventDefault(),("z"===a.key||"Z"===a.key)&&(a.ctrlKey||a.metaKey)&&a.preventDefault(),("y"===a.key||"Y"===a.key)&&(a.ctrlKey||a.metaKey)&&a.preventDefault(),("s"===a.key||"S"===a.key)&&(a.ctrlKey||a.metaKey)&&a.preventDefault()}),(0,G.default)("mousemove",a=>{let b=f.current?.getBoundingClientRect();b&&g.setState({mousePosition:{pageX:a.clientX,pageY:a.clientY,elementX:a.clientX-b.left,elementY:a.clientY-b.top}})});let{handleNodeDragStart:Z,handleNodeDrag:$,handleNodeDragStop:_,handleNodeEnter:aa,handleNodeLeave:ab,handleNodeClick:ac,handleNodeConnect:ad,handleNodeConnectStart:ae,handleNodeConnectEnd:af,handleNodeContextMenu:ag,handleHistoryBack:ah,handleHistoryForward:ai}=(0,V.useNodesInteractions)(),{handleEdgeEnter:aj,handleEdgeLeave:ak,handleEdgesChange:al}=(0,bm.useEdgesInteractions)(),{handleSelectionStart:am,handleSelectionChange:an,handleSelectionDrag:ao,handleSelectionContextMenu:ap}=(0,mr.useSelectionInteractions)(),{handlePaneContextMenu:ar}=(0,mq.usePanelInteractions)(),{isValidConnection:at}=(0,aq.useWorkflow)();(0,N.useOnViewportChange)({onEnd:()=>{A()}}),(0,mt.useShortcuts)(),(0,mw.useWorkflowSearch)(),(0,K.useEffect)(()=>(0,oe.setupScrollToNodeListener)(i,h),[i,h]);let{schemaTypeDefinitions:au}=(0,bX.default)(),{fetchInspectVars:av}=(0,ms.useSetWorkflowVarsWithValue)(),{data:aw}=(0,Q.useAllBuiltInTools)(),{data:ax}=(0,Q.useAllCustomTools)(),{data:ay}=(0,Q.useAllWorkflowTools)(),{data:az}=(0,Q.useAllMCPTools)(),aA=(0,aP.useStore)(a=>a.dataSourceList),aB=(0,as.useHooksStore)(a=>a.configsMap),[aD,aE]=(0,K.useState)(!1),[aF,aG]=(0,K.useState)([]);return(0,K.useEffect)(()=>{(async()=>{aB?.flowType&&aB?.flowId&&(aG(await (0,R.fetchAllInspectVars)(aB.flowType,aB.flowId)),aE(!0))})()},[aB?.flowType,aB?.flowId]),(0,K.useEffect)(()=>{au&&aD&&av({passInVars:!0,vars:aF,passedInAllPluginInfoList:{buildInTools:aw||[],customTools:ax||[],workflowTools:ay||[],mcpTools:az||[],dataSourceList:aA??[]},passedInSchemaTypeDefinitions:au})},[au,av,aD,aF,ax,aw,ay,az,aA]),O.IS_DEV&&(J.getState().onError=(a,b)=>{"002"!==a&&console.warn(b)}),(0,F.jsxs)("div",{id:"workflow-container",className:(0,S.cn)("relative h-full w-full min-w-[960px]",C&&"workflow-panel-animation",n&&"workflow-node-animation"),ref:f,children:[(0,F.jsx)(od,{}),(0,F.jsx)(mh,{}),(0,F.jsx)("div",{className:"pointer-events-none absolute left-0 top-0 z-10 flex w-12 items-center justify-center p-1 pl-2",style:{height:t},children:(0,F.jsx)(n5,{})}),(0,F.jsx)(nb,{handleRedo:ai,handleUndo:ah}),(0,F.jsx)(n8,{}),(0,F.jsx)(mx,{}),(0,F.jsx)(oa,{}),(0,F.jsx)(mp,{}),!!o&&(0,F.jsx)(of,{isShow:!0,onCancel:()=>u(void 0),onConfirm:o.onConfirm,title:o.title,content:o.desc}),d,(0,F.jsx)(L.default,{nodeTypes:og,edgeTypes:oh,nodes:i,edges:k,onNodeDragStart:Z,onNodeDrag:$,onNodeDragStop:_,onNodeMouseEnter:aa,onNodeMouseLeave:ab,onNodeClick:ac,onNodeContextMenu:ag,onConnect:ad,onConnectStart:ae,onConnectEnd:af,onEdgeMouseEnter:aj,onEdgeMouseLeave:ak,onEdgesChange:al,onSelectionStart:am,onSelectionChange:an,onSelectionDrag:ao,onPaneContextMenu:ar,onSelectionContextMenu:ap,connectionLineComponent:mi.default,connectionLineContainerStyle:{zIndex:T.ITERATION_CHILDREN_Z_INDEX},defaultViewport:c,multiSelectionKeyCode:null,deleteKeyCode:null,nodesDraggable:!D,nodesConnectable:!D,nodesFocusable:!D,edgesFocusable:!D,panOnScroll:m===aC.ControlMode.Pointer&&!C,panOnDrag:m===aC.ControlMode.Hand||[1],zoomOnPinch:!0,zoomOnScroll:!0,zoomOnDoubleClick:!0,isValidConnection:at,selectionKeyCode:null,selectionMode:N.SelectionMode.Partial,selectionOnDrag:m===aC.ControlMode.Pointer&&!C,minZoom:.25,children:(0,F.jsx)(M.Background,{gap:[14,14],size:2,className:"bg-workflow-canvas-workflow-bg",color:"var(--color-workflow-canvas-workflow-dot-color)"})})]})}),oj=(0,K.memo)(({hooksStore:a,...b})=>(0,F.jsx)(mv.HooksStoreContextProvider,{...a,children:(0,F.jsx)(oi,{...b})})),ok=(0,K.memo)(({nodes:a,edges:b,children:c})=>(0,F.jsx)(N.ReactFlowProvider,{children:(0,F.jsx)(l9.WorkflowHistoryProvider,{nodes:a,edges:b,children:(0,F.jsx)(mm.default,{nodes:a,children:c})})}));a.s(["WorkflowWithInnerContext",0,oj,"default",0,ok],563667),a.s([],624825);let ol={metaData:(0,b0.genNodeMetaData)({sort:-1,type:aC.BlockEnum.DataSourceEmpty,isUndeletable:!0,isSingleton:!0}),defaultValue:{},checkValid:()=>({isValid:!0})};var om=a.i(485198),on=ii;let oo={metaData:(0,b0.genNodeMetaData)({sort:3.1,type:aC.BlockEnum.KnowledgeBase,isRequired:!0,isUndeletable:!0,isSingleton:!0,isTypeFixed:!0}),defaultValue:{index_chunk_variable_selector:[],keyword_number:10,retrieval_model:{top_k:3,score_threshold_enabled:!1,score_threshold:.5}},checkValid(a,b){let{chunk_structure:c,indexing_technique:d,retrieval_model:e,embedding_model:f,embedding_model_provider:g,index_chunk_variable_selector:h,_embeddingModelList:i,_rerankModelList:j}=a,{search_method:k,reranking_enable:l,reranking_model:m}=e||{},n=i?.find(a=>a.provider===g),o=n?.models.find(a=>a.model===f),p=j?.find(a=>a.provider===m?.reranking_provider_name),q=p?.models.find(a=>a.model===m?.reranking_model_name);if(!c)return{isValid:!1,errorMessage:b("nodes.knowledgeBase.chunkIsRequired",{ns:"workflow"})};if(0===h.length)return{isValid:!1,errorMessage:b("nodes.knowledgeBase.chunksVariableIsRequired",{ns:"workflow"})};if(!d)return{isValid:!1,errorMessage:b("nodes.knowledgeBase.indexMethodIsRequired",{ns:"workflow"})};if(d===on.IndexingType.QUALIFIED){if(!f||!g)return{isValid:!1,errorMessage:b("nodes.knowledgeBase.embeddingModelIsRequired",{ns:"workflow"})};else if(!o)return{isValid:!1,errorMessage:b("nodes.knowledgeBase.embeddingModelIsInvalid",{ns:"workflow"})}}if(!e||!k)return{isValid:!1,errorMessage:b("nodes.knowledgeBase.retrievalSettingIsRequired",{ns:"workflow"})};if(l){if(!m||!m.reranking_provider_name||!m.reranking_model_name)return{isValid:!1,errorMessage:b("nodes.knowledgeBase.rerankingModelIsRequired",{ns:"workflow"})};else if(!q)return{isValid:!1,errorMessage:b("nodes.knowledgeBase.rerankingModelIsInvalid",{ns:"workflow"})}}return{isValid:!0,errorMessage:""}}};a.s(["useAvailableNodesMetaData",0,()=>{let{t:a}=(0,$.useTranslation)(),b=(0,bk.useDocLink)(),c=(0,K.useMemo)(()=>[...cQ,{...om.default,defaultValue:{...om.default.defaultValue,_dataSourceStartToAdd:!0}},oo,ol],[]),d=(0,K.useMemo)(()=>b("/use-dify/knowledge/knowledge-pipeline/knowledge-pipeline-orchestration"),[b]),e=(0,K.useMemo)(()=>c.map(b=>{let{metaData:c}=b,e=a(`blocks.${c.type}`,{ns:"workflow"}),f=a(`blocksAbout.${c.type}`,{ns:"workflow"});return{...b,metaData:{...c,title:e,description:f,helpLinkUri:d},defaultValue:{...b.defaultValue,type:c.type,title:e}}}),[c,a]),f=(0,K.useMemo)(()=>e.reduce((a,b)=>(a[b.metaData.type]=b,a),{}),[e]);return(0,K.useMemo)(()=>({nodes:e,nodesMap:{...f,[aC.BlockEnum.VariableAssigner]:f?.[aC.BlockEnum.VariableAggregator]}}),[e,f])}],235268),a.s(["useDSL",()=>os],445778),a.s(["useNodesSyncDraft",()=>or],13267);let op=(a,b)=>{let c;for(let d=0;d<a.length;d++){let e=a[d];if(e.data.type===aC.BlockEnum.DataSource)return{nodes:a,viewport:b};e.type!==T.CUSTOM_NODE||c||(c=e),e.type===T.CUSTOM_NODE&&c&&e.position.x<c.position.x&&(c=e)}if(c){let d=c.position.x-T.NODE_WIDTH_X_OFFSET,e=c.position.y,{newNode:f}=(0,aR.generateNewNode)({id:"data-source-empty",type:mz,data:{title:"",desc:"",type:aC.BlockEnum.DataSourceEmpty,width:240,_isTempNode:!0},position:{x:d,y:e}});return{nodes:[f,(0,aR.generateNewNode)({id:"note",type:ma.CUSTOM_NOTE_NODE,data:{title:"",desc:"",type:"",text:'{"root":{"children":[{"children":[{"detail":0,"format":1,"mode":"normal","style":"font-size: 14px;","text":"Get started with a blank pipeline","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"paragraph","version":1,"textFormat":1,"textStyle":"font-size: 14px;"},{"children":[],"direction":"ltr","format":"","indent":0,"type":"paragraph","version":1,"textFormat":1,"textStyle":""},{"children":[{"detail":0,"format":0,"mode":"normal","style":"","text":"A Knowledge Pipeline starts with Data Source as the starting node and ends with the knowledge base node. The general steps are: import documents from the data source → use extractor to extract document content → split and clean content into structured chunks → store in the knowledge base.","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"paragraph","version":1,"textFormat":0,"textStyle":""},{"children":[],"direction":"ltr","format":"","indent":0,"type":"paragraph","version":1,"textFormat":0,"textStyle":""},{"children":[{"children":[{"detail":0,"format":2,"mode":"normal","style":"","text":"Link to documentation","type":"text","version":1}],"direction":"ltr","format":"","indent":0,"type":"link","version":1,"textFormat":2,"rel":"noreferrer","target":"_blank","title":null,"url":"https://dify.ai"}],"direction":"ltr","format":"","indent":0,"type":"paragraph","version":1,"textFormat":2,"textStyle":""},{"children":[],"direction":"ltr","format":"","indent":0,"type":"paragraph","version":1,"textFormat":0,"textStyle":""}],"direction":"ltr","format":"","indent":0,"type":"root","version":1,"textFormat":1,"textStyle":"font-size: 14px;"}}',theme:nd.NoteTheme.blue,author:"",showAuthor:!0,width:240,height:300,_isTempNode:!0},position:{x:d,y:e+100}}).newNode,...a],viewport:{x:(T.START_INITIAL_POSITION.x-d)*(b?.zoom||1),y:(T.START_INITIAL_POSITION.y-e)*(b?.zoom||1),zoom:b?.zoom||1}}}return{nodes:a,viewport:b}};a.s(["processNodesWithoutDataSource",0,op],413945),a.s([],82700);let oq=()=>{let a=(0,aP.useWorkflowStore)(),{handleUpdateWorkflowCanvas:b}=(0,di.useWorkflowUpdate)();return{handleRefreshWorkflowDraft:(0,K.useCallback)(()=>{let{pipelineId:c,setSyncWorkflowDraftHash:d,setIsSyncingWorkflowDraft:e,setEnvironmentVariables:f,setEnvSecrets:g}=a.getState();e(!0),(0,R.fetchWorkflowDraft)(`/rag/pipelines/${c}/workflows/draft`).then(a=>{let{nodes:c,viewport:e}=op(a.graph.nodes,a.graph.viewport);b({...a.graph,nodes:c,viewport:e}),d(a.hash),g((a.environment_variables||[]).filter(a=>"secret"===a.value_type).reduce((a,b)=>(a[b.id]=b.value,a),{})),f(a.environment_variables?.map(a=>"secret"===a.value_type?{...a,value:"[__HIDDEN__]"}:a)||[])}).finally(()=>e(!1))},[b,a])}};a.s(["usePipelineRefreshDraft",0,oq],665201);let or=()=>{let a=(0,N.useStoreApi)(),b=(0,aP.useWorkflowStore)(),{getNodesReadOnly:c}=(0,aq.useNodesReadOnly)(),{handleRefreshWorkflowDraft:d}=oq(),e=(0,K.useCallback)(()=>{let{getNodes:c,edges:d,transform:e}=a.getState(),f=c().filter(a=>!a.data._isTempNode),[g,h,i]=e,{pipelineId:j,environmentVariables:k,syncWorkflowDraftHash:l,ragPipelineVariables:m}=b.getState();if(j&&f.length)return{url:`/rag/pipelines/${j}/workflows/draft`,params:{graph:{nodes:(0,I.produce)(f,a=>{a.forEach(a=>{Object.keys(a.data).forEach(b=>{b.startsWith("_")&&delete a.data[b]})})}),edges:(0,I.produce)(d,a=>{a.forEach(a=>{Object.keys(a.data).forEach(b=>{b.startsWith("_")&&delete a.data[b]})})}),viewport:{x:g,y:h,zoom:i}},environment_variables:k,rag_pipeline_variables:m,hash:l}}},[a,b]),f=(0,K.useCallback)(()=>{if(c())return;let a=e();a&&navigator.sendBeacon(`${O.API_PREFIX}${a.url}`,JSON.stringify(a.params))},[e,c]),g=(0,K.useCallback)(async(a,f)=>{if(c())return;let g=e();if(g){let{setSyncWorkflowDraftHash:c,setDraftUpdatedAt:e}=b.getState();try{let a=await (0,R.syncWorkflowDraft)(g);c(a.hash),e(a.updated_at),f?.onSuccess?.()}catch(b){b&&b.json&&!b.bodyUsed&&b.json().then(b=>{"draft_workflow_not_sync"!==b.code||a||d()}),f?.onError?.()}finally{f?.onSettled?.()}}},[e,c,b,d]);return{doSyncWorkflowDraft:(0,dh.useSerialAsyncCallback)(g,c),syncWorkflowDraftWhenPageClose:f}},os=()=>{let{t:a}=(0,$.useTranslation)(),{notify:b}=(0,aX.useToastContext)(),{eventEmitter:c}=(0,P.useEventEmitterContextContext)(),[d,e]=(0,K.useState)(!1),{doSyncWorkflowDraft:f}=or(),g=(0,aP.useWorkflowStore)(),{mutateAsync:h}=(0,aG.useExportPipelineDSL)(),i=(0,K.useCallback)(async(c=!1)=>{let{pipelineId:i,knowledgeName:j}=g.getState();if(i&&!d)try{e(!0),await f();let{data:a}=await h({pipelineId:i,include:c}),b=new Blob([a],{type:"application/yaml"});(0,dg.downloadBlob)({data:b,fileName:`${j}.pipeline`})}catch{b({type:"error",message:a("exportFailed",{ns:"app"})})}finally{e(!1)}},[b,a,f,d,h,g]);return{exportCheck:(0,K.useCallback)(async()=>{let{pipelineId:d}=g.getState();if(d)try{let a=((await (0,R.fetchWorkflowDraft)(`/rag/pipelines/${d}/workflows/draft`)).environment_variables||[]).filter(a=>"secret"===a.value_type);if(0===a.length)return void i();c?.emit({type:T.DSL_EXPORT_CHECK,payload:{data:a}})}catch{b({type:"error",message:a("exportFailed",{ns:"app"})})}},[c,i,b,a,g]),handleExportDSL:i}};a.s(["useGetRunAndTraceUrl",0,()=>{let a=(0,aP.useWorkflowStore)();return{getWorkflowRunAndTraceUrl:(0,K.useCallback)(b=>{let{pipelineId:c}=a.getState();return{runUrl:`/rag/pipelines/${c}/workflow-runs/${b}`,traceUrl:`/rag/pipelines/${c}/workflow-runs/${b}/node-executions`}},[a])}}],919915);let ot=()=>{let a=(0,aP.useWorkflowStore)(),b=(0,aP.useStore)(a=>a.showInputFieldPreviewPanel),c=(0,aP.useStore)(a=>a.inputFieldEditPanelProps),d=(0,K.useMemo)(()=>b,[b]),e=(0,K.useMemo)(()=>!!c,[c]),f=(0,K.useCallback)(()=>{let{setShowInputFieldPanel:b,setShowInputFieldPreviewPanel:c,setInputFieldEditPanelProps:d}=a.getState();b?.(!1),c?.(!1),d?.(null)},[a]);return{closeAllInputFieldPanels:f,toggleInputFieldPreviewPanel:(0,K.useCallback)(()=>{let{showInputFieldPreviewPanel:b,setShowInputFieldPreviewPanel:c}=a.getState();c?.(!b)},[a]),toggleInputFieldEditPanel:(0,K.useCallback)(b=>{let{setInputFieldEditPanelProps:c}=a.getState();c?.(b)},[a]),isPreviewing:d,isEditing:e}};a.s(["useInputFieldPanel",0,ot],965653);var ou=a.i(698636);a.s(["usePipelineInit",0,()=>{let a,b,c,d,e,f,g=(0,aP.useWorkflowStore)(),{nodes:h,edges:i}=(()=>{let{t:a}=(0,$.useTranslation)(),{newNode:b}=(0,aR.generateNewNode)({id:"knowledgeBase",data:{...oo.defaultValue,type:oo.metaData.type,title:a(`blocks.${oo.metaData.type}`,{ns:"workflow"}),selected:!0},position:{x:T.START_INITIAL_POSITION.x+500,y:T.START_INITIAL_POSITION.y}});return{nodes:[b],edges:[]}})(),[j,k]=(0,K.useState)(),[l,m]=(0,K.useState)(!0),n=(0,ou.useDatasetDetailContextWithSelector)(a=>a.dataset)?.pipeline_id,o=(0,ou.useDatasetDetailContextWithSelector)(a=>a.dataset)?.name,p=(0,ou.useDatasetDetailContextWithSelector)(a=>a.dataset)?.icon_info;(0,K.useEffect)(()=>{g.setState({pipelineId:n,knowledgeName:o,knowledgeIcon:p})},[n,g,o,p]),a=(0,aP.useStore)(a=>a.pipelineId),b=(0,aP.useWorkflowStore)(),c=(0,K.useCallback)(a=>{let{setNodesDefaultConfigs:c}=b.getState(),d={};Array.isArray(a)?a.forEach(a=>{d[a.type]=a.config}):d=a,c(d)},[b]),(0,aH.useWorkflowConfig)(a?`/rag/pipelines/${a}/workflows/default-workflow-block-configs`:"",c),d=(0,K.useCallback)(a=>{let{setPublishedAt:c}=b.getState();c(a?.created_at)},[b]),(0,aH.useWorkflowConfig)(a?`/rag/pipelines/${a}/workflows/publish`:"",d),e=(0,K.useCallback)(a=>{a.forEach(a=>{let b=a.declaration.identity.icon;"string"!=typeof b||b.includes(by.basePath)||(a.declaration.identity.icon=`${by.basePath}${b}`)});let{setDataSourceList:c}=b.getState();c(a)},[b]),f=(0,K.useCallback)(a=>{let{setFileUploadConfig:c}=b.getState();c(a)},[b]),(0,aH.useWorkflowConfig)("/files/upload",f),(0,aG.useDataSourceList)(!!a,e);let q=(0,K.useCallback)(async()=>{let{setEnvSecrets:a,setEnvironmentVariables:b,setSyncWorkflowDraftHash:c,setDraftUpdatedAt:d,setToolPublished:e,setRagPipelineVariables:f}=g.getState();try{let g=await (0,R.fetchWorkflowDraft)(`/rag/pipelines/${n}/workflows/draft`);k(g),d(g.updated_at),e(g.tool_published),a((g.environment_variables||[]).filter(a=>"secret"===a.value_type).reduce((a,b)=>(a[b.id]=b.value,a),{})),b(g.environment_variables?.map(a=>"secret"===a.value_type?{...a,value:"[__HIDDEN__]"}:a)||[]),c(g.hash),f?.(g.rag_pipeline_variables||[]),m(!1)}catch(a){a&&a.json&&!a.bodyUsed&&n&&a.json().then(a=>{"draft_workflow_not_exist"===a.code&&(g.setState({notInitialWorkflow:!0,shouldAutoOpenStartNodeSelector:!0}),(0,R.syncWorkflowDraft)({url:`/rag/pipelines/${n}/workflows/draft`,params:{graph:{nodes:h,edges:i},environment_variables:[]}}).then(a=>{let{setDraftUpdatedAt:b}=g.getState();b(a.updated_at),q()}))})}},[h,i,g,n]);return(0,K.useEffect)(()=>{q()},[]),{data:j,isLoading:l}}],828531),a.s(["usePipelineRun",()=>ov],704591);let ov=()=>{let a=(0,N.useStoreApi)(),b=(0,aP.useWorkflowStore)(),c=(0,N.useReactFlow)(),{doSyncWorkflowDraft:d}=or(),{handleUpdateWorkflowCanvas:e}=(0,di.useWorkflowUpdate)(),{handleWorkflowStarted:f,handleWorkflowFinished:g,handleWorkflowFailed:h,handleWorkflowNodeStarted:i,handleWorkflowNodeFinished:j,handleWorkflowNodeIterationStarted:k,handleWorkflowNodeIterationNext:l,handleWorkflowNodeIterationFinished:m,handleWorkflowNodeLoopStarted:n,handleWorkflowNodeLoopNext:o,handleWorkflowNodeLoopFinished:p,handleWorkflowNodeRetry:q,handleWorkflowAgentLog:r,handleWorkflowTextChunk:s,handleWorkflowTextReplace:t}=dA(),u=(0,K.useCallback)(()=>{let{getNodes:e,edges:f}=a.getState(),{getViewport:g}=c,{backupDraft:h,setBackupDraft:i,environmentVariables:j}=b.getState();h||(i({nodes:e(),edges:f,viewport:g(),environmentVariables:j}),d())},[c,b,a,d]),v=(0,K.useCallback)(()=>{let{backupDraft:a,setBackupDraft:c,setEnvironmentVariables:d}=b.getState();if(a){let{nodes:b,edges:f,viewport:g,environmentVariables:h}=a;e({nodes:b,edges:f,viewport:g}),d(h),c(void 0)}},[e,b]),w=(0,aP.useStore)(a=>a.pipelineId),x=(0,aH.useInvalidAllLastRun)(aJ.FlowType.ragPipeline,w),{fetchInspectVars:y}=bZ({flowType:aJ.FlowType.ragPipeline,flowId:w}),z=(0,K.useCallback)(async(c,e)=>{let{getNodes:u,setNodes:v}=a.getState();v((0,I.produce)(u(),a=>{a.forEach(a=>{a.data.selected=!1,a.data._runningStatus=void 0})})),await d();let{onWorkflowStarted:w,onWorkflowFinished:z,onNodeStarted:A,onNodeFinished:B,onIterationStart:C,onIterationNext:D,onIterationFinish:E,onLoopStart:F,onLoopNext:G,onLoopFinish:H,onNodeRetry:J,onAgentLog:K,onError:L,...M}=e||{},{pipelineId:N}=b.getState();b.setState({historyWorkflowData:void 0});let{clientWidth:O,clientHeight:P}=document.getElementById("workflow-container"),Q=`/rag/pipelines/${N}/workflows/draft/run`,{setWorkflowRunningData:R}=b.getState();R({result:{inputs_truncated:!1,process_data_truncated:!1,outputs_truncated:!1,status:aC.WorkflowRunningStatus.Running},tracing:[],resultText:""}),(0,dB.ssePost)(Q,{body:c},{onWorkflowStarted:a=>{f(a),w&&w(a)},onWorkflowFinished:a=>{g(a),y({}),x(),z&&z(a)},onError:a=>{h(),L&&L(a)},onNodeStarted:a=>{i(a,{clientWidth:O,clientHeight:P}),A&&A(a)},onNodeFinished:a=>{j(a),B&&B(a)},onIterationStart:a=>{k(a,{clientWidth:O,clientHeight:P}),C&&C(a)},onIterationNext:a=>{l(a),D&&D(a)},onIterationFinish:a=>{m(a),E&&E(a)},onLoopStart:a=>{n(a,{clientWidth:O,clientHeight:P}),F&&F(a)},onLoopNext:a=>{o(a),G&&G(a)},onLoopFinish:a=>{p(a),H&&H(a)},onNodeRetry:a=>{q(a),J&&J(a)},onAgentLog:a=>{r(a),K&&K(a)},onTextChunk:a=>{s(a)},onTextReplace:a=>{t(a)},...M})},[a,b,d,f,g,h,i,j,k,l,m,n,o,p,q,s,t,r]);return{handleBackupDraft:u,handleLoadBackupDraft:v,handleRun:z,handleStopRun:(0,K.useCallback)(a=>{let{pipelineId:c}=b.getState();(0,R.stopWorkflowRun)(`/rag/pipelines/${c}/workflow-runs/tasks/${a}/stop`)},[b]),handleRestoreFromPublishedWorkflow:(0,K.useCallback)(a=>{let c=a.graph.nodes.map(a=>({...a,selected:!1,data:{...a.data,selected:!1}}));e({nodes:c,edges:a.graph.edges,viewport:a.graph.viewport}),b.getState().setEnvironmentVariables(a.environment_variables||[]),b.getState().setRagPipelineVariables?.(a.rag_pipeline_variables||[])},[e,b])}};a.s(["usePipelineStartRun",()=>ow],881771);let ow=()=>{let a=(0,aP.useWorkflowStore)(),{handleCancelDebugAndPreviewPanel:b}=(0,di.useWorkflowInteractions)(),{doSyncWorkflowDraft:c}=or(),{closeAllInputFieldPanels:d}=ot(),e=(0,K.useCallback)(async()=>{let{workflowRunningData:e}=a.getState();if(e?.result.status===aC.WorkflowRunningStatus.Running)return;let{isPreparingDataSource:f,setIsPreparingDataSource:g,showDebugAndPreviewPanel:h,setShowEnvPanel:i,setShowDebugAndPreviewPanel:j}=a.getState();if(!f&&e)return void a.setState({isPreparingDataSource:!0,workflowRunningData:void 0});if(i(!1),d(),h){g?.(!1),b();return}await c(),g?.(!0),j(!0)},[a,b,c]);return{handleStartWorkflowRun:(0,K.useCallback)(()=>{e()},[e]),handleWorkflowStartRunInWorkflow:e}}},346315,a=>{"use strict";var b=a.i(608061),c=a.i(860653),d=a.i(533306);a.i(529638);var e=a.i(471068);a.i(412708);var f=a.i(851571),g=a.i(57843),h=a.i(970502);a.i(624825);var i=a.i(965653),j=a.i(757801),k=a.i(893463),l=a.i(829781),m=a.i(621865);a.i(752298);var n=a.i(693025),o=a.i(204685),p=a.i(98654);let q=(0,g.memo)(()=>{let{t:a}=(0,n.useTranslation)(),{formatTime:c}=(0,p.default)(),{formatTimeFromNow:d}=(0,o.useFormatTimeFromNow)(),e=(0,f.useStore)(a=>a.draftUpdatedAt),g=(0,f.useStore)(a=>a.publishedAt),h=(0,f.useStore)(a=>a.isSyncingWorkflowDraft),i=(0,f.useStore)(a=>a.maximizeCanvas);return(0,b.jsxs)("div",{className:`system-xs-regular flex h-[18px] min-w-[300px] items-center whitespace-nowrap text-text-tertiary ${i?"ml-2":""}`,children:[!!e&&(0,b.jsxs)(b.Fragment,{children:[a("common.autoSaved",{ns:"workflow"})," ",c(e/1e3,"HH:mm:ss")]}),(0,b.jsx)("span",{className:"mx-1 flex items-center",children:"·"}),g?`${a("common.published",{ns:"workflow"})} ${d(g)}`:a("common.unpublished",{ns:"workflow"}),h&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{className:"mx-1 flex items-center",children:"·"}),a("common.syncingData",{ns:"workflow"})]})]})});var r=a.i(909795);a.i(73009);var s=a.i(284391),t=a.i(730357),u=a.i(527344);let v=(0,g.memo)(({disabled:a})=>{let{theme:c}=(0,t.default)(),d=(0,f.useStore)(a=>a.setShowChatVariablePanel),e=(0,f.useStore)(a=>a.showEnvPanel),g=(0,f.useStore)(a=>a.setShowEnvPanel),h=(0,f.useStore)(a=>a.setShowGlobalVariablePanel),j=(0,f.useStore)(a=>a.setShowDebugAndPreviewPanel),{closeAllInputFieldPanels:k}=(0,i.useInputFieldPanel)();return(0,b.jsx)(r.default,{className:(0,u.cn)("rounded-lg border border-transparent p-2","dark"===c&&e&&"border-black/5 bg-white/10 backdrop-blur-sm"),variant:"ghost",disabled:a,onClick:()=>{g(!0),d(!1),h(!1),j(!1),k()},children:(0,b.jsx)(s.Env,{className:"h-4 w-4 text-components-button-secondary-text"})})});var w=a.i(962210);let x=(0,g.memo)(({disabled:a})=>{let{theme:c}=(0,t.default)(),d=(0,f.useStore)(a=>a.showGlobalVariablePanel),e=(0,f.useStore)(a=>a.setShowGlobalVariablePanel),g=(0,f.useStore)(a=>a.setShowEnvPanel),h=(0,f.useStore)(a=>a.setShowChatVariablePanel),j=(0,f.useStore)(a=>a.setShowDebugAndPreviewPanel),{closeAllInputFieldPanels:k}=(0,i.useInputFieldPanel)();return(0,b.jsx)(r.default,{className:(0,u.cn)("rounded-lg border border-transparent p-2","dark"===c&&d&&"border-black/5 bg-white/10 backdrop-blur-sm"),disabled:a,onClick:()=>{e(!0),g(!1),h(!1),j(!1),k()},variant:"ghost",children:(0,b.jsx)(w.GlobalVariable,{className:"h-4 w-4 text-components-button-secondary-text"})})});var y=a.i(429150),z=a.i(412795);a.i(866028);var A=a.i(156184),A=A;a.i(943046);var B=a.i(848850),B=B;a.i(622666);var C=a.i(14878),C=C,D=a.i(825319),E=a.i(602024),F=a.i(438961),G=a.i(990693);let H=(0,g.memo)(({disabled:a,showGoTo:c=!0,onItemClick:d})=>{let{t:e}=(0,n.useTranslation)(),[f,i]=(0,g.useState)(!1),j=(0,h.useEdges)(),l=(0,E.default)(),m=(0,G.useChecklist)(l,j),{handleNodeSelect:o}=(0,k.useNodesInteractions)();return(0,b.jsxs)(D.PortalToFollowElem,{placement:"bottom-end",offset:{mainAxis:12,crossAxis:4},open:f,onOpenChange:i,children:[(0,b.jsx)(D.PortalToFollowElemTrigger,{onClick:()=>!a&&i(a=>!a),children:(0,b.jsxs)("div",{className:(0,u.cn)("relative ml-0.5 flex h-7 w-7 items-center justify-center rounded-md",a&&"cursor-not-allowed opacity-50"),children:[(0,b.jsx)("div",{className:(0,u.cn)("group flex h-full w-full cursor-pointer items-center justify-center rounded-md hover:bg-state-accent-hover",f&&"bg-state-accent-hover"),children:(0,b.jsx)(y.RiListCheck3,{className:(0,u.cn)("h-4 w-4 group-hover:text-components-button-secondary-accent-text",f?"text-components-button-secondary-accent-text":"text-components-button-ghost-text")})}),!!m.length&&(0,b.jsx)("div",{className:"absolute -right-1.5 -top-1.5 flex h-[18px] min-w-[18px] items-center justify-center rounded-full border border-gray-100 bg-[#F79009] text-[11px] font-semibold text-white",children:m.length})]})}),(0,b.jsx)(D.PortalToFollowElemContent,{className:"z-[12]",children:(0,b.jsxs)("div",{className:"w-[420px] overflow-y-auto rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-lg",style:{maxHeight:"calc(2 / 3 * 100vh)"},children:[(0,b.jsxs)("div",{className:"text-md sticky top-0 z-[1] flex h-[44px] items-center bg-components-panel-bg pl-4 pr-3 pt-3 font-semibold text-text-primary",children:[(0,b.jsxs)("div",{className:"grow",children:[e("panel.checklist",{ns:"workflow"}),m.length?`(${m.length})`:""]}),(0,b.jsx)("div",{className:"flex h-6 w-6 shrink-0 cursor-pointer items-center justify-center",onClick:()=>i(!1),children:(0,b.jsx)(y.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})})]}),(0,b.jsxs)("div",{className:"pb-2",children:[!!m.length&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"px-4 pt-1 text-xs text-text-tertiary",children:e("panel.checklistTip",{ns:"workflow"})}),(0,b.jsx)("div",{className:"px-4 py-2",children:m.map(a=>(0,b.jsxs)("div",{className:(0,u.cn)("group mb-2 rounded-lg border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-xs last-of-type:mb-0",c&&a.canNavigate&&!a.disableGoTo?"cursor-pointer":"cursor-default opacity-80"),onClick:()=>{c&&a.canNavigate&&!a.disableGoTo&&(d?d(a):o(a.id),i(!1))},children:[(0,b.jsxs)("div",{className:"flex h-9 items-center p-2 text-xs font-medium text-text-secondary",children:[(0,b.jsx)(F.default,{type:a.type,className:"mr-1.5",toolIcon:a.toolIcon}),(0,b.jsx)("span",{className:"grow truncate",children:a.title}),c&&a.canNavigate&&!a.disableGoTo&&(0,b.jsxs)("div",{className:"flex h-4 w-[60px] shrink-0 items-center justify-center gap-1 opacity-0 transition-opacity duration-200 group-hover:opacity-100",children:[(0,b.jsx)("span",{className:"whitespace-nowrap text-xs font-medium leading-4 text-primary-600",children:e("panel.goTo",{ns:"workflow"})}),(0,b.jsx)(B.default,{className:"h-3.5 w-3.5 text-primary-600"})]})]}),(0,b.jsxs)("div",{className:(0,u.cn)("rounded-b-lg border-t-[0.5px] border-divider-regular",(a.unConnected||a.errorMessage)&&"bg-gradient-to-r from-components-badge-bg-orange-soft to-transparent"),children:[a.unConnected&&(0,b.jsx)("div",{className:"px-3 py-1 first:pt-1.5 last:pb-1.5",children:(0,b.jsxs)("div",{className:"flex text-xs leading-4 text-text-tertiary",children:[(0,b.jsx)(A.default,{className:"mr-2 mt-[2px] h-3 w-3 text-[#F79009]"}),e("common.needConnectTip",{ns:"workflow"})]})}),a.errorMessage&&(0,b.jsx)("div",{className:"px-3 py-1 first:pt-1.5 last:pb-1.5",children:(0,b.jsxs)("div",{className:"flex text-xs leading-4 text-text-tertiary",children:[(0,b.jsx)(A.default,{className:"mr-2 mt-[2px] h-3 w-3 text-[#F79009]"}),a.errorMessage]})})]})]},a.id))})]}),!m.length&&(0,b.jsxs)("div",{className:"mx-4 mb-3 rounded-lg bg-components-panel-bg py-4 text-center text-xs text-text-tertiary",children:[(0,b.jsx)(C.default,{className:"mx-auto mb-[5px] h-8 w-8 text-text-quaternary"}),e("panel.checklistResolved",{ns:"workflow"})]})]})]})})]})});a.i(60796);var I=a.i(55282);a.i(644726);var J=a.i(891169),K=a.i(114715),L=a.i(56328),M=a.i(735310),N=a.i(820494),O=a.i(124116);a.i(275560);var P=a.i(102569),Q=a.i(970854),R=a.i(230285),S=a.i(595709);let T=g.memo(({text:a})=>{let{t:c}=(0,n.useTranslation)(),{handleWorkflowStartRunInWorkflow:d,handleWorkflowTriggerScheduleRunInWorkflow:e,handleWorkflowTriggerWebhookRunInWorkflow:h,handleWorkflowTriggerPluginRunInWorkflow:i,handleWorkflowRunAllTriggersInWorkflow:j}=(0,z.useWorkflowStartRun)(),{handleStopRun:k}=(0,m.useWorkflowRun)(),{validateBeforeRun:l,warningNodes:o}=(0,G.useWorkflowRunValidation)(),p=(0,f.useStore)(a=>a.workflowRunningData),q=(0,f.useStore)(a=>a.isListening),r=p?.result.status===M.WorkflowRunningStatus.Running||q,s=(()=>{let{t:a}=(0,n.useTranslation)(),c=(0,E.default)(),d=(0,f.useStore)(a=>a.buildInTools),e=(0,f.useStore)(a=>a.customTools),h=(0,f.useStore)(a=>a.workflowTools),i=(0,f.useStore)(a=>a.mcpTools),{data:j}=(0,Q.useAllTriggerPlugins)();return(0,g.useMemo)(()=>{let d,e=[];for(let f of c){let c=f.data;if(c?.type){if(c.type===M.BlockEnum.Start)d={id:f.id,type:R.TriggerType.UserInput,name:c.title||a("blocks.start",{ns:"workflow"}),icon:(0,b.jsx)(F.default,{type:M.BlockEnum.Start,size:"md"}),nodeId:f.id,enabled:!0};else if(c.type===M.BlockEnum.TriggerSchedule)e.push({id:f.id,type:R.TriggerType.Schedule,name:c.title||a("blocks.trigger-schedule",{ns:"workflow"}),icon:(0,b.jsx)(F.default,{type:M.BlockEnum.TriggerSchedule,size:"md"}),nodeId:f.id,enabled:!0});else if(c.type===M.BlockEnum.TriggerWebhook)e.push({id:f.id,type:R.TriggerType.Webhook,name:c.title||a("blocks.trigger-webhook",{ns:"workflow"}),icon:(0,b.jsx)(F.default,{type:M.BlockEnum.TriggerWebhook,size:"md"}),nodeId:f.id,enabled:!0});else if(c.type===M.BlockEnum.TriggerPlugin){let d;if(c.provider_id){let a=j||[];d=a.find(a=>a.name===c.provider_id)?.icon}let g=(0,b.jsx)(F.default,{type:M.BlockEnum.TriggerPlugin,size:"md",toolIcon:d});e.push({id:f.id,type:R.TriggerType.Plugin,name:c.title||c.plugin_name||a("blocks.trigger-plugin",{ns:"workflow"}),icon:g,nodeId:f.id,enabled:!0})}}}if(!d){let e=(0,S.getWorkflowEntryNode)(c);e&&e.data?.type===M.BlockEnum.Start&&(d={id:e.id,type:R.TriggerType.UserInput,name:e.data?.title||a("blocks.start",{ns:"workflow"}),icon:(0,b.jsx)(F.default,{type:M.BlockEnum.Start,size:"md"}),nodeId:e.id,enabled:!0})}let f=e.map(a=>a.nodeId).filter(a=>!!a);return{userInput:d,triggers:e,runAll:f.length>1?{id:"run-all",type:R.TriggerType.All,name:a("common.runAllTriggers",{ns:"workflow"}),icon:(0,b.jsx)("div",{className:"flex h-6 w-6 items-center justify-center rounded-lg border-[0.5px] border-white/2 bg-util-colors-purple-purple-500 text-white shadow-md",children:(0,b.jsx)(P.TriggerAll,{className:"h-4.5 w-4.5"})}),relatedNodeIds:f,enabled:!0}:void 0}},[c,d,e,h,i,j,a])})(),t=(0,g.useRef)(null),{notify:v}=(0,K.useToastContext)();(0,g.useEffect)(()=>(window._toggleTestRunDropdown=()=>{t.current?.toggle()},()=>{delete window._toggleTestRunDropdown}),[]);let w=(0,g.useCallback)(()=>{k(p?.task_id||"")},[k,p?.task_id]),x=(0,g.useCallback)(a=>{let b=!0;if(o.forEach(c=>{c.id===a.nodeId&&(b=!1)}),!b)return void v({type:"error",message:c("panel.checklistTip",{ns:"workflow"})});if(a.type===R.TriggerType.UserInput)d(),(0,I.trackEvent)("app_start_action_time",{action_type:"user_input"});else if(a.type===R.TriggerType.Schedule)e(a.nodeId),(0,I.trackEvent)("app_start_action_time",{action_type:"schedule"});else if(a.type===R.TriggerType.Webhook)a.nodeId&&h({nodeId:a.nodeId}),(0,I.trackEvent)("app_start_action_time",{action_type:"webhook"});else if(a.type===R.TriggerType.Plugin)a.nodeId&&i(a.nodeId),(0,I.trackEvent)("app_start_action_time",{action_type:"plugin"});else if(a.type===R.TriggerType.All){let b=a.relatedNodeIds?.filter(Boolean);b&&b.length>0&&j(b),(0,I.trackEvent)("app_start_action_time",{action_type:"all"})}},[l,d,e,h,i,j]),{eventEmitter:A}=(0,O.useEventEmitterContextContext)();return A?.useSubscription(a=>{a.type===N.EVENT_WORKFLOW_STOP&&w()}),(0,b.jsxs)("div",{className:"flex items-center gap-x-px",children:[r?(0,b.jsxs)("button",{type:"button",className:(0,u.cn)("system-xs-medium flex h-7 cursor-not-allowed items-center gap-x-1 rounded-l-md bg-state-accent-hover px-1.5 text-text-accent"),disabled:!0,children:[(0,b.jsx)(y.RiLoader2Line,{className:"mr-1 size-4 animate-spin"}),q?c("common.listening",{ns:"workflow"}):c("common.running",{ns:"workflow"})]}):(0,b.jsx)(R.default,{ref:t,options:s,onSelect:x,children:(0,b.jsxs)("div",{className:(0,u.cn)("system-xs-medium flex h-7 cursor-pointer items-center gap-x-1 rounded-md px-1.5 text-text-accent hover:bg-state-accent-hover"),style:{userSelect:"none"},children:[(0,b.jsx)(y.RiPlayLargeLine,{className:"mr-1 size-4"}),a??c("common.run",{ns:"workflow"}),(0,b.jsx)(L.default,{keys:["alt","R"],textColor:"secondary"})]})}),r&&(0,b.jsx)("button",{type:"button",className:(0,u.cn)("flex size-7 items-center justify-center rounded-r-md bg-state-accent-active"),onClick:w,children:(0,b.jsx)(J.StopCircle,{className:"size-4 text-text-accent"})})]})});var U=a.i(894180);a.i(669870);var V=a.i(967923),W=a.i(357664),W=W,X=a.i(105249),Y=a.i(483664),Z=a.i(374715),$=a.i(737976);a.i(713310);var _=a.i(128972);let aa=(0,g.memo)(({withText:a,onClearLogAndMessageModal:c,historyUrl:d})=>{let{t:e}=(0,n.useTranslation)(),h=(0,l.useIsChatMode)(),[j,p]=(0,g.useState)(!1),{formatTimeFromNow:q}=(0,o.useFormatTimeFromNow)(),{handleNodesCancelSelected:r}=(0,k.useNodesInteractions)(),{handleCancelDebugAndPreviewPanel:s}=(0,$.useWorkflowInteractions)(),t=(0,f.useWorkflowStore)(),v=(0,f.useStore)(a=>a.setControlMode),w=(0,f.useStore)(a=>a.historyWorkflowData),{handleBackupDraft:x}=(0,m.useWorkflowRun)(),{closeAllInputFieldPanels:z}=(0,i.useInputFieldPanel)(),A=j&&!!d,{data:B,isLoading:C}=(0,Z.useWorkflowRunHistory)(d,A);return(0,b.jsxs)(D.PortalToFollowElem,{placement:a?"bottom-start":"bottom-end",offset:{mainAxis:4,crossAxis:a?-8:10},open:j,onOpenChange:p,children:[(0,b.jsxs)(D.PortalToFollowElemTrigger,{onClick:()=>p(a=>!a),children:[a&&(0,b.jsxs)("div",{className:(0,u.cn)("flex h-8 items-center rounded-lg border-[0.5px] border-components-button-secondary-border bg-components-button-secondary-bg px-3 shadow-xs","cursor-pointer text-[13px] font-medium text-components-button-secondary-text hover:bg-components-button-secondary-bg-hover",j&&"bg-components-button-secondary-bg-hover"),children:[(0,b.jsx)(V.ClockPlay,{className:"mr-1 h-4 w-4"}),e("common.showRunHistory",{ns:"workflow"})]}),!a&&(0,b.jsx)(Y.default,{popupContent:e("common.viewRunHistory",{ns:"workflow"}),children:(0,b.jsx)("div",{className:(0,u.cn)("group flex h-7 w-7 cursor-pointer items-center justify-center rounded-md hover:bg-state-accent-hover",j&&"bg-state-accent-hover"),onClick:()=>{c?.()},children:(0,b.jsx)(V.ClockPlay,{className:(0,u.cn)("h-4 w-4 group-hover:text-components-button-secondary-accent-text",j?"text-components-button-secondary-accent-text":"text-components-button-ghost-text")})})})]}),(0,b.jsx)(D.PortalToFollowElemContent,{className:"z-[12]",children:(0,b.jsxs)("div",{className:"ml-2 flex w-[240px] flex-col overflow-y-auto rounded-xl border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-xl",style:{maxHeight:"calc(2 / 3 * 100vh)"},children:[(0,b.jsxs)("div",{className:"sticky top-0 flex items-center justify-between bg-components-panel-bg px-4 pt-3 text-base font-semibold text-text-primary",children:[(0,b.jsx)("div",{className:"grow",children:e("common.runHistory",{ns:"workflow"})}),(0,b.jsx)("div",{className:"flex h-6 w-6 shrink-0 cursor-pointer items-center justify-center",onClick:()=>{c?.(),p(!1)},children:(0,b.jsx)(y.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})})]}),C&&(0,b.jsx)("div",{className:"flex h-10 items-center justify-center",children:(0,b.jsx)(X.default,{})}),!C&&(0,b.jsxs)("div",{className:"p-2",children:[!B?.data.length&&(0,b.jsxs)("div",{className:"py-12",children:[(0,b.jsx)(W.default,{className:"mx-auto mb-2 h-8 w-8 text-text-quaternary"}),(0,b.jsx)("div",{className:"text-center text-[13px] text-text-quaternary",children:e("common.notRunning",{ns:"workflow"})})]}),B?.data.map(a=>(0,b.jsxs)("div",{className:(0,u.cn)("mb-0.5 flex cursor-pointer rounded-lg px-2 py-[7px] hover:bg-state-base-hover",a.id===w?.id&&"bg-state-accent-hover hover:bg-state-accent-hover"),onClick:()=>{t.setState({historyWorkflowData:a,showInputsPanel:!1,showEnvPanel:!1}),z(),x(),p(!1),r(),s(),v(M.ControlMode.Hand)},children:[!h&&a.status===M.WorkflowRunningStatus.Stopped&&(0,b.jsx)(U.AlertTriangle,{className:"mr-1.5 mt-0.5 h-3.5 w-3.5 text-[#F79009]"}),!h&&a.status===M.WorkflowRunningStatus.Failed&&(0,b.jsx)(y.RiErrorWarningLine,{className:"mr-1.5 mt-0.5 h-3.5 w-3.5 text-[#F04438]"}),!h&&a.status===M.WorkflowRunningStatus.Succeeded&&(0,b.jsx)(y.RiCheckboxCircleLine,{className:"mr-1.5 mt-0.5 h-3.5 w-3.5 text-[#12B76A]"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:(0,u.cn)("flex items-center text-[13px] font-medium leading-[18px] text-text-primary",a.id===w?.id&&"text-text-accent"),children:`Test ${h?"Chat":"Run"}${(0,_.formatWorkflowRunIdentifier)(a.finished_at)}`}),(0,b.jsxs)("div",{className:"flex items-center text-xs leading-[18px] text-text-tertiary",children:[a.created_by_account?.name," ","·",q(1e3*(a.finished_at||a.created_at))]})]})]},a.id))]})]})})]})}),ab=(0,g.memo)(()=>{let{t:a}=(0,n.useTranslation)(),{handleWorkflowStartRunInChatflow:c}=(0,z.useWorkflowStartRun)();return(0,b.jsxs)("div",{className:(0,u.cn)("flex h-7 items-center rounded-md px-2.5 text-[13px] font-medium text-components-button-secondary-accent-text","cursor-pointer hover:bg-state-accent-hover"),onClick:()=>c(),children:[(0,b.jsx)(y.RiPlayLargeLine,{className:"mr-1 h-4 w-4"}),a("common.debugAndPreview",{ns:"workflow"})]})}),ac=(0,g.memo)(({showRunButton:a,runButtonText:c,showPreviewButton:d,viewHistoryProps:e,components:f})=>{let{nodesReadOnly:g}=(0,l.useNodesReadOnly)(),{RunMode:h}=f||{};return(0,b.jsxs)("div",{className:"flex h-8 items-center rounded-lg border-[0.5px] border-components-button-secondary-border bg-components-button-secondary-bg px-0.5 shadow-xs",children:[a&&(h?(0,b.jsx)(h,{text:c}):(0,b.jsx)(T,{text:c})),d&&(0,b.jsx)(ab,{}),(0,b.jsx)("div",{className:"mx-0.5 h-3.5 w-[1px] bg-divider-regular"}),(0,b.jsx)(aa,{...e}),(0,b.jsx)(H,{disabled:g})]})});var ad=a.i(791881);let ae=()=>{let{t:a}=(0,n.useTranslation)(),c=(0,h.useNodes)().find(a=>a.data.selected),d=(0,g.useCallback)(()=>{c&&(0,ad.scrollToWorkflowNode)(c.id)},[c]);return c?(0,b.jsx)("div",{className:(0,u.cn)("system-xs-medium flex h-6 cursor-pointer items-center justify-center whitespace-nowrap rounded-md border-[0.5px] border-effects-highlight bg-components-actionbar-bg px-3 text-text-tertiary shadow-lg backdrop-blur-sm transition-colors duration-200 hover:text-text-accent"),onClick:d,children:a("panel.scrollToSelectedNode",{ns:"workflow"})}):null};var af=a.i(261574);let ag=["ctrl","⇧","H"],ah=g.memo(()=>{let{t:a}=(0,n.useTranslation)();return(0,b.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,b.jsx)("div",{className:"system-xs-medium px-0.5 text-text-secondary",children:a("common.versionHistory",{ns:"workflow"})}),(0,b.jsx)(L.default,{keys:ag,bgColor:"gray",textColor:"secondary"})]})});ah.displayName="PopupContent";let ai=({onClick:a})=>{let{theme:c}=(0,t.default)(),d=(0,g.useCallback)(async()=>{await a?.()},[a]);return(0,af.useKeyPress)(`${(0,_.getKeyboardKeyCodeBySystem)("ctrl")}.shift.h`,a=>{a.preventDefault(),d()},{exactMatch:!0,useCapture:!0}),(0,b.jsx)(Y.default,{popupContent:(0,b.jsx)(ah,{}),noDecoration:!0,popupClassName:"rounded-lg border-[0.5px] border-components-panel-border bg-components-tooltip-bg shadow-lg shadow-shadow-shadow-5 backdrop-blur-[5px] p-1.5",children:(0,b.jsx)(r.default,{className:(0,u.cn)("rounded-lg border border-transparent p-2","dark"===c&&"border-black/5 bg-white/10 backdrop-blur-sm"),onClick:d,children:(0,b.jsx)(y.RiHistoryLine,{className:"h-4 w-4 text-components-button-secondary-text"})})})},aj=({components:a,runAndHistoryProps:c})=>{let d=(0,f.useWorkflowStore)(),{nodesReadOnly:e}=(0,l.useNodesReadOnly)(),{handleNodeSelect:n}=(0,k.useNodesInteractions)(),o=(0,f.useStore)(a=>a.setShowWorkflowVersionHistoryPanel),p=(0,f.useStore)(a=>a.setShowEnvPanel),r=(0,f.useStore)(a=>a.setShowDebugAndPreviewPanel),s=(0,f.useStore)(a=>a.setShowVariableInspectPanel),t=(0,f.useStore)(a=>a.setShowChatVariablePanel),u=(0,f.useStore)(a=>a.setShowGlobalVariablePanel),w=(0,h.useNodes)().find(a=>a.data.selected),{handleBackupDraft:y}=(0,m.useWorkflowRun)(),{closeAllInputFieldPanels:z}=(0,i.useInputFieldPanel)(),A=(0,g.useCallback)(()=>{d.setState({isRestoring:!0}),y(),w&&n(w.id,!0),o(!0),p(!1),r(!1),s(!1),t(!1),u(!1),z()},[d,y,w,n,o,p,r,s,t,u]);return(0,b.jsxs)("div",{className:"flex w-full items-center justify-between",children:[(0,b.jsx)("div",{children:(0,b.jsx)(q,{})}),(0,b.jsx)("div",{children:(0,b.jsx)(ae,{})}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[a?.left,(0,b.jsx)(j.default,{type:"vertical",className:"mx-auto h-3.5"}),(0,b.jsx)(ac,{...c}),(0,b.jsxs)("div",{className:"shrink-0 cursor-pointer rounded-lg border-[0.5px] border-components-button-secondary-border bg-components-button-secondary-bg shadow-xs backdrop-blur-[10px]",children:[a?.chatVariableTrigger,(0,b.jsx)(v,{disabled:e}),(0,b.jsx)(x,{disabled:e})]}),a?.middle,(0,b.jsx)(ai,{onClick:A})]})]})},ak=(0,c.default)(async()=>{},{loadableGenerated:{modules:[173827]},ssr:!1}),al=(0,c.default)(async()=>{},{loadableGenerated:{modules:[963740]},ssr:!1});a.s(["default",0,({normal:a,viewHistory:c,restoring:g})=>{let h=(0,d.usePathname)(),i=h.endsWith("/workflow"),j=h.endsWith("/pipeline"),{normal:k,restoring:l,viewHistory:m}=(0,e.useWorkflowMode)(),n=(0,f.useStore)(a=>a.maximizeCanvas);return(0,b.jsxs)("div",{className:"absolute left-0 top-7 z-10 flex h-0 w-full items-center justify-between bg-mask-top2bottom-gray-50-to-transparent px-3",children:[(i||j)&&n&&(0,b.jsx)("div",{className:"h-14 w-[52px]"}),k&&(0,b.jsx)(aj,{...a}),m&&(0,b.jsx)(ak,{...c}),l&&(0,b.jsx)(al,{...g})]})}],346315)},129095,a=>{"use strict";var b=a.i(608061),c=a.i(860653),d=a.i(57843),e=a.i(970502),f=a.i(388206),g=a.i(527344),h=a.i(257540);a.i(412708);var i=a.i(851571),j=a.i(429150);a.i(752298);var k=a.i(693025),l=a.i(581117),m=a.i(268830),n=a.i(986963),o=a.i(732078);a.i(73009);var p=a.i(284391);let q=(0,d.memo)(({env:a,onEdit:c,onDelete:e})=>{let f=(0,i.useStore)(a=>a.envSecrets),[h,k]=(0,d.useState)(!1);return(0,b.jsxs)("div",{className:(0,g.cn)("radius-md group mb-1 border border-components-panel-border-subtle bg-components-panel-on-panel-item-bg shadow-xs hover:bg-components-panel-on-panel-item-bg-hover",h&&"border-state-destructive-border hover:bg-state-destructive-hover"),children:[(0,b.jsxs)("div",{className:"px-2.5 py-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex grow items-center gap-1",children:[(0,b.jsx)(p.Env,{className:"h-4 w-4 text-util-colors-violet-violet-600"}),(0,b.jsx)("div",{className:"system-sm-medium text-text-primary",children:a.name}),(0,b.jsx)("div",{className:"system-xs-medium text-text-tertiary",children:(0,o.capitalize)(a.value_type)}),"secret"===a.value_type&&(0,b.jsx)(j.RiLock2Line,{className:"h-3 w-3 text-text-tertiary"})]}),(0,b.jsxs)("div",{className:"flex shrink-0 items-center gap-1 text-text-tertiary",children:[(0,b.jsx)("div",{className:"radius-md cursor-pointer p-1 hover:bg-state-base-hover hover:text-text-secondary",children:(0,b.jsx)(j.RiEditLine,{className:"h-4 w-4",onClick:()=>c(a)})}),(0,b.jsx)("div",{className:"radius-md cursor-pointer p-1 hover:bg-state-destructive-hover hover:text-text-destructive",onMouseOver:()=>k(!0),onMouseOut:()=>k(!1),children:(0,b.jsx)(j.RiDeleteBinLine,{className:"h-4 w-4",onClick:()=>e(a)})})]})]}),(0,b.jsx)("div",{className:"system-xs-regular truncate text-text-tertiary",children:"secret"===a.value_type?f[a.id]:a.value})]}),a.description&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"h-[0.5px] bg-divider-subtle"}),(0,b.jsx)("div",{className:(0,g.cn)("rounded-bl-[8px] rounded-br-[8px] bg-background-default-subtle px-2.5 py-2 group-hover:bg-transparent",h&&"bg-state-destructive-hover hover:bg-state-destructive-hover"),children:(0,b.jsx)("div",{className:"system-xs-regular truncate text-text-tertiary",children:a.description})})]})]})});var r=a.i(909795),s=a.i(825319),t=a.i(639378),u=a.i(44348),v=a.i(816134),w=a.i(114715),x=a.i(483664),y=a.i(499257);let z=({env:a,onClose:c,onSave:e})=>{let{t:f}=(0,k.useTranslation)(),{notify:h}=(0,t.useContext)(w.ToastContext),l=(0,i.useWorkflowStore)(),[m,n]=d.useState("string"),[o,p]=d.useState(""),[q,s]=d.useState(),[z,A]=d.useState(""),B=a=>{let{isValid:b,errorMessageKey:c}=(0,y.checkKeys)([a],!1);return!!b||(h({type:"error",message:f(`varKeyError.${c}`,{ns:"appDebug",key:f("env.modal.name",{ns:"workflow"})})}),!1)};return(0,d.useEffect)(()=>{if(a){n(a.value_type),p(a.name);let b=l.getState().envSecrets;s("secret"===a.value_type?b[a.id]:a.value),A(a.description)}},[a,l]),(0,b.jsxs)("div",{className:(0,g.cn)("flex h-full w-[360px] flex-col rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-2xl"),children:[(0,b.jsxs)("div",{className:"system-xl-semibold mb-3 flex shrink-0 items-center justify-between p-4 pb-0 text-text-primary",children:[a?f("env.modal.editTitle",{ns:"workflow"}):f("env.modal.title",{ns:"workflow"}),(0,b.jsx)("div",{className:"flex items-center",children:(0,b.jsx)("div",{className:"flex h-6 w-6 cursor-pointer items-center justify-center",onClick:c,children:(0,b.jsx)(j.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})})})]}),(0,b.jsxs)("div",{className:"px-4 py-2",children:[(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsx)("div",{className:"system-sm-semibold mb-1 flex h-6 items-center text-text-secondary",children:f("env.modal.type",{ns:"workflow"})}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("div",{className:(0,g.cn)("radius-md system-sm-regular flex w-[106px] cursor-pointer items-center justify-center border border-components-option-card-option-border bg-components-option-card-option-bg p-2 text-text-secondary hover:border-components-option-card-option-border-hover hover:bg-components-option-card-option-bg-hover hover:shadow-xs","string"===m&&"system-sm-medium border-[1.5px] border-components-option-card-option-selected-border bg-components-option-card-option-selected-bg text-text-primary shadow-xs hover:border-components-option-card-option-selected-border"),onClick:()=>n("string"),children:"String"}),(0,b.jsx)("div",{className:(0,g.cn)("radius-md system-sm-regular flex w-[106px] cursor-pointer items-center justify-center border border-components-option-card-option-border bg-components-option-card-option-bg p-2 text-text-secondary hover:border-components-option-card-option-border-hover hover:bg-components-option-card-option-bg-hover hover:shadow-xs","number"===m&&"border-[1.5px] border-components-option-card-option-selected-border bg-components-option-card-option-selected-bg font-medium text-text-primary shadow-xs hover:border-components-option-card-option-selected-border"),onClick:()=>{n("number"),/^\d$/.test(q)||s("")},children:"Number"}),(0,b.jsxs)("div",{className:(0,g.cn)("radius-md system-sm-regular flex w-[106px] cursor-pointer items-center justify-center border border-components-option-card-option-border bg-components-option-card-option-bg p-2 text-text-secondary hover:border-components-option-card-option-border-hover hover:bg-components-option-card-option-bg-hover hover:shadow-xs","secret"===m&&"border-[1.5px] border-components-option-card-option-selected-border bg-components-option-card-option-selected-bg font-medium text-text-primary shadow-xs hover:border-components-option-card-option-selected-border"),onClick:()=>n("secret"),children:[(0,b.jsx)("span",{children:"Secret"}),(0,b.jsx)(x.default,{popupContent:(0,b.jsx)("div",{className:"w-[240px]",children:f("env.modal.secretTip",{ns:"workflow"})}),triggerClassName:"ml-0.5 w-3.5 h-3.5"})]})]})]}),(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsx)("div",{className:"system-sm-semibold mb-1 flex h-6 items-center text-text-secondary",children:f("env.modal.name",{ns:"workflow"})}),(0,b.jsx)("div",{className:"flex",children:(0,b.jsx)(v.default,{placeholder:f("env.modal.namePlaceholder",{ns:"workflow"})||"",value:o,onChange:a=>{(0,y.replaceSpaceWithUnderscoreInVarNameInput)(a.target),(!a.target.value||B(a.target.value))&&p(a.target.value||"")},onBlur:a=>B(a.target.value),type:"text"})})]}),(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsx)("div",{className:"system-sm-semibold mb-1 flex h-6 items-center text-text-secondary",children:f("env.modal.value",{ns:"workflow"})}),(0,b.jsx)("div",{className:"flex",children:"number"!==m?(0,b.jsx)("textarea",{className:"system-sm-regular placeholder:system-sm-regular block h-20 w-full resize-none appearance-none rounded-lg border border-transparent bg-components-input-bg-normal p-2 text-components-input-text-filled caret-primary-600 outline-none placeholder:text-components-input-text-placeholder hover:border-components-input-border-hover hover:bg-components-input-bg-hover focus:border-components-input-border-active focus:bg-components-input-bg-active focus:shadow-xs",value:q,placeholder:f("env.modal.valuePlaceholder",{ns:"workflow"})||"",onChange:a=>s(a.target.value)}):(0,b.jsx)(v.default,{placeholder:f("env.modal.valuePlaceholder",{ns:"workflow"})||"",value:q,onChange:a=>s(a.target.value),type:"number"})})]}),(0,b.jsxs)("div",{className:"",children:[(0,b.jsx)("div",{className:"system-sm-semibold mb-1 flex h-6 items-center text-text-secondary",children:f("env.modal.description",{ns:"workflow"})}),(0,b.jsx)("div",{className:"flex",children:(0,b.jsx)("textarea",{className:"system-sm-regular placeholder:system-sm-regular block h-20 w-full resize-none appearance-none rounded-lg border border-transparent bg-components-input-bg-normal p-2 text-components-input-text-filled caret-primary-600 outline-none placeholder:text-components-input-text-placeholder hover:border-components-input-border-hover hover:bg-components-input-bg-hover focus:border-components-input-border-active focus:bg-components-input-bg-active focus:shadow-xs",value:z,placeholder:f("env.modal.descriptionPlaceholder",{ns:"workflow"})||"",onChange:a=>A(a.target.value)})})]})]}),(0,b.jsx)("div",{className:"flex flex-row-reverse rounded-b-2xl p-4 pt-2",children:(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(r.default,{onClick:c,children:f("operation.cancel",{ns:"common"})}),(0,b.jsx)(r.default,{variant:"primary",onClick:()=>{if(!B(o))return;if(!q)return h({type:"error",message:"value can not be empty"});let b=l.getState().environmentVariables;if(a&&a.name!==o&&b.some(a=>a.name===o)||!a&&b.some(a=>a.name===o))return h({type:"error",message:"name is existed"});e({id:a?a.id:(0,u.v4)(),value_type:m,name:o,value:"number"===m?Number(q):q,description:z}),c()},children:f("operation.save",{ns:"common"})})]})})]})},A=({open:a,setOpen:c,env:d,onClose:e,onSave:f})=>{let{t:g}=(0,k.useTranslation)();return(0,b.jsxs)(s.PortalToFollowElem,{open:a,onOpenChange:()=>{c(a=>!a),a&&e()},placement:"left-start",offset:{mainAxis:8,alignmentAxis:-104},children:[(0,b.jsx)(s.PortalToFollowElemTrigger,{onClick:()=>{c(a=>!a),a&&e()},children:(0,b.jsxs)(r.default,{variant:"primary",children:[(0,b.jsx)(j.RiAddLine,{className:"mr-1 h-4 w-4"}),(0,b.jsx)("span",{className:"system-sm-medium",children:g("env.envPanelButton",{ns:"workflow"})})]})}),(0,b.jsx)(s.PortalToFollowElemContent,{className:"z-[11]",children:(0,b.jsx)(z,{env:d,onSave:f,onClose:()=>{e(),c(!1)}})})]})},B=(0,d.memo)(()=>{let{t:a}=(0,k.useTranslation)(),c=(0,e.useStoreApi)(),f=(0,i.useStore)(a=>a.setShowEnvPanel),h=(0,i.useStore)(a=>a.environmentVariables),o=(0,i.useStore)(a=>a.envSecrets),p=(0,i.useStore)(a=>a.setEnvironmentVariables),r=(0,i.useStore)(a=>a.setEnvSecrets),{doSyncWorkflowDraft:s}=(0,l.useNodesSyncDraft)(),[t,u]=(0,d.useState)(!1),[v,w]=(0,d.useState)(),[x,y]=(0,d.useState)(!1),[z,B]=(0,d.useState)(),C=a=>a.length>8?`${a.slice(0,6)}************${a.slice(-2)}`:"********************",D=(0,d.useCallback)(a=>{let{getNodes:b}=c.getState(),d=b();return(0,n.findUsedVarNodes)(["env",a.name],d)},[c]),E=(0,d.useCallback)(a=>{let{getNodes:b,setNodes:d}=c.getState(),e=D(a);d(b().map(b=>e.find(a=>a.id===b.id)?(0,n.updateNodeVars)(b,["env",a.name],[]):b))},[D,c]),F=a=>{w(a),u(!0)},G=(0,d.useCallback)(a=>{if(E(a),p(h.filter(b=>b.id!==a.id)),B(void 0),y(!1),s(),"secret"===a.value_type){let b={...o};delete b[a.id],r(b)}},[s,h,o,E,r,p]),H=(0,d.useCallback)(a=>{D(a).length>0?(B(a),y(!0)):G(a)},[D,G]),I=(0,d.useCallback)(async a=>{let b=a;if(v)"secret"===v.value_type?"secret"===a.value_type&&(o[v.id]!==a.value?(b=a,r({...o,[a.id]:C(a.value)})):b={...a,value:"[__HIDDEN__]"}):"secret"===a.value_type&&(b=a,r({...o,[a.id]:C(a.value)}));else{"secret"===a.value_type&&r({...o,[a.id]:C(a.value)});let b=[a,...h];p(b),await s(),p(b.map(b=>b.id===a.id&&"secret"===a.value_type?{...b,value:"[__HIDDEN__]"}:b));return}let d=h.map(a=>a.id===v.id?b:a);if(p(d),v.name!==a.name){let{getNodes:b,setNodes:d}=c.getState(),e=D(v);d(b().map(b=>e.find(a=>a.id===b.id)?(0,n.updateNodeVars)(b,["env",v.name],["env",a.name]):b))}await s(),p(d.map(b=>b.id===a.id&&"secret"===a.value_type?{...b,value:"[__HIDDEN__]"}:b))},[v,s,h,o,D,r,c,p]);return(0,b.jsxs)("div",{className:(0,g.cn)("relative flex h-full w-[420px] flex-col rounded-l-2xl border border-components-panel-border bg-components-panel-bg-alt"),children:[(0,b.jsxs)("div",{className:"system-xl-semibold flex shrink-0 items-center justify-between p-4 pb-0 text-text-primary",children:[a("env.envPanelTitle",{ns:"workflow"}),(0,b.jsx)("div",{className:"flex items-center",children:(0,b.jsx)("div",{className:"flex h-6 w-6 cursor-pointer items-center justify-center",onClick:()=>f(!1),children:(0,b.jsx)(j.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})})})]}),(0,b.jsx)("div",{className:"system-sm-regular shrink-0 px-4 py-1 text-text-tertiary",children:a("env.envDescription",{ns:"workflow"})}),(0,b.jsx)("div",{className:"shrink-0 px-4 pb-3 pt-2",children:(0,b.jsx)(A,{open:t,setOpen:u,env:v,onSave:I,onClose:()=>w(void 0)})}),(0,b.jsx)("div",{className:"grow overflow-y-auto rounded-b-2xl px-4",children:h.map(a=>(0,b.jsx)(q,{env:a,onEdit:F,onDelete:H},a.id))}),(0,b.jsx)(m.default,{isShow:x,onCancel:()=>y(!1),onConfirm:()=>z&&G(z)})]})}),C=(0,c.default)(async()=>{},{loadableGenerated:{modules:[580158]},ssr:!1}),D=(a,b)=>a.borderBoxSize?.length>0?a.borderBoxSize[0].inlineSize:a.contentRect.width>0?a.contentRect.width:b.getBoundingClientRect().width,E=(a,b=[])=>{let c=(0,d.useRef)(null),e=(0,d.useCallback)(a,[a]);return(0,d.useEffect)(()=>{let a=c.current;if(!a)return;let b=new ResizeObserver(b=>{for(let c of b)e(D(c,a))});return b.observe(a),e(a.getBoundingClientRect().width),()=>{b.disconnect()}},[e,...b]),c},F=(0,d.memo)(({components:a,versionHistoryPanelProps:c})=>{let j=(0,e.useStore)((0,f.useShallow)(a=>{let b=a.getNodes().find(a=>a.data.selected);if(b)return{id:b.id,type:b.type,data:b.data}})),k=(0,i.useStore)(a=>a.showEnvPanel),l=(0,i.useStore)(a=>a.isRestoring),m=(0,i.useStore)(a=>a.showWorkflowVersionHistoryPanel),n=(0,i.useStore)(a=>a.workflowCanvasWidth),o=(0,i.useStore)(a=>a.previewPanelWidth),p=(0,i.useStore)(a=>a.setPreviewPanelWidth);(0,d.useEffect)(()=>{if(!j||!n)return;let a=Math.max(n-400-400,400);o>a&&p(a)},[j,n,o,p]);let q=(0,i.useStore)(a=>a.setRightPanelWidth),r=(0,i.useStore)(a=>a.setOtherPanelWidth),s=E(q,[q,j,k,m]),t=E(r,[r,k,m]);return(0,b.jsxs)("div",{ref:s,tabIndex:-1,className:(0,g.cn)("absolute bottom-1 right-0 top-14 z-10 flex outline-none"),children:[a?.left,!!j&&(0,b.jsx)(h.Panel,{...j}),(0,b.jsxs)("div",{className:"relative",ref:t,children:[a?.right,m&&(0,b.jsx)(C,{...c}),k&&(0,b.jsx)(B,{})]})]},`${l}`)});a.s(["default",0,F],129095)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__a5319c59._.js.map
module.exports=[465592,a=>{"use strict";a.s(["default",()=>l,"useCanInstallPluginFromMarketplace",()=>k]);var b=a.i(57843);a.i(752298);var c=a.i(693025),d=a.i(705134),e=a.i(724423),f=a.i(781362),g=a.i(114715),h=a.i(263636);let i=(a,b)=>!!a&&a!==h.PermissionType.noOne&&(a===h.PermissionType.everyone||b),j=()=>{let{t:a}=(0,c.useTranslation)(),{isCurrentWorkspaceManager:b,isCurrentWorkspaceOwner:e}=(0,d.useAppContext)(),{data:h}=(0,f.useReferenceSettings)(),{permission:j}=h||{},k=(0,f.useInvalidateReferenceSettings)(),{mutate:l,isPending:m}=(0,f.useMutationReferenceSettings)({onSuccess:()=>{k(),g.default.notify({type:"success",message:a("api.actionSuccess",{ns:"common"})})}}),n=b||e;return{referenceSetting:h,setReferenceSettings:l,canManagement:i(j?.install_permission,n),canDebugger:i(j?.debug_permission,n),canSetPermissions:n,isUpdatePending:m}},k=()=>{let{enable_marketplace:a}=(0,e.useGlobalPublicStore)(a=>a.systemFeatures),{canManagement:c}=j();return{canInstallPluginFromMarketplace:(0,b.useMemo)(()=>a&&c,[a,c])}},l=j},238387,a=>{"use strict";var b=a.i(41511);let c=async(a,c)=>{let d=new FormData;return d.append(c?"bundle":"pkg",a),(0,b.upload)({xhr:new XMLHttpRequest,data:d},!1,`/workspaces/current/plugin/upload/${c?"bundle":"pkg"}`)},d=async a=>(0,b.post)("/workspaces/current/plugin/upgrade/marketplace",{body:a}),e=async(a,c,d,e,f)=>(0,b.post)("/workspaces/current/plugin/upgrade/github",{body:{repo:a,version:c,package:d,original_plugin_unique_identifier:e,new_plugin_unique_identifier:f}}),f=async(a,c,d)=>(0,b.post)("/workspaces/current/plugin/upload/github",{body:{repo:a,version:c,package:d}}),g=async a=>(0,b.getMarketplace)(`/plugins/identifier?unique_identifier=${a}`),h=async({org:a,name:c,version:d})=>(0,b.getMarketplace)(`/bundles/${a}/${c}/${d}`),i=async({org:a,name:c})=>(0,b.getMarketplace)(`/plugins/${a}/${c}`),j=async a=>(0,b.get)(`/workspaces/current/plugin/tasks/${a}`),k=async a=>(0,b.post)("/workspaces/current/plugin/uninstall",{body:{plugin_installation_id:a}});a.s(["checkTaskStatus",0,j,"fetchBundleInfoFromMarketPlace",0,h,"fetchManifestFromMarketPlace",0,g,"fetchPluginInfoFromMarketPlace",0,i,"uninstallPlugin",0,k,"updateFromGitHub",0,e,"updateFromMarketPlace",0,d,"uploadFile",0,c,"uploadGitHub",0,f])},781362,a=>{"use strict";a.s(["useCheckInstalled",()=>r,"useDebugKey",()=>H,"useDownloadPlugin",()=>T,"useFeaturedToolsRecommendations",()=>u,"useFeaturedTriggersRecommendations",()=>v,"useFetchDynamicOptions",()=>X,"useFetchPluginsInMarketPlaceByIds",()=>N,"useFetchPluginsInMarketPlaceByInfo",()=>O,"useInstallOrUpdate",()=>G,"useInstallPackageFromGitHub",()=>E,"useInstallPackageFromLocal",()=>D,"useInstallPackageFromMarketPlace",()=>z,"useInstalledLatestVersion",()=>x,"useInstalledPluginList",()=>w,"useInvalidateInstalledPluginList",()=>y,"useInvalidateReferenceSettings",()=>K,"useModelInList",()=>V,"useMutationCheckDependencies",()=>U,"useMutationClearTaskPlugin",()=>R,"useMutationReferenceSettings",()=>L,"usePluginDeclarationFromMarketPlace",()=>B,"usePluginInfo",()=>W,"usePluginManifestInfo",()=>S,"usePluginReadme",()=>Y,"usePluginTaskList",()=>Q,"useReferenceSettings",()=>J,"useRemoveAutoUpgrade",()=>M,"useUpdatePackageFromMarketPlace",()=>A,"useUploadGitHub",()=>F,"useVersionListOfPlugin",()=>C]);var b=a.i(516758),c=a.i(848636),d=a.i(528698),e=a.i(749249),f=a.i(739858),g=a.i(57843),h=a.i(757014),i=a.i(947803),j=a.i(465592),k=a.i(263636),l=a.i(9575),m=a.i(238387),n=a.i(41511),o=a.i(844137);let p="plugins",q=[p,"installedPluginList"],r=({pluginIds:a,enabled:b})=>(0,d.useQuery)({queryKey:[p,"checkInstalled",a],queryFn:()=>(0,n.post)("/workspaces/current/plugin/list/installations/ids",{body:{plugin_ids:a}}),enabled:b,staleTime:0}),s=[p,"recommendedMarketplacePlugins"],t=({collection:a="__recommended-plugins-tools",enabled:b=!0,limit:c=15}={})=>(0,d.useQuery)({queryKey:[...s,a,c],queryFn:async()=>(await (0,n.postMarketplace)(`/collections/${a}/plugins`,{body:{limit:c}})).data.plugins.map(a=>(0,i.getFormattedPlugin)(a)),enabled:b,staleTime:6e4}),u=(a,b=15)=>{let{data:c=[],isLoading:d}=t({collection:"__recommended-plugins-tools",enabled:a,limit:b});return{plugins:c,isLoading:d}},v=(a,b=15)=>{let{data:c=[],isLoading:d}=t({collection:"__recommended-plugins-triggers",enabled:a,limit:b});return{plugins:c,isLoading:d}},w=(a,c=100)=>{let d=async({pageParam:a=1})=>await (0,n.get)(`/workspaces/current/plugin/list?page=${a}&page_size=${c}`),{data:e,error:f,fetchNextPage:g,hasNextPage:h,isFetchingNextPage:i,isLoading:j,isSuccess:k}=(0,b.useInfiniteQuery)({enabled:!a,queryKey:q,queryFn:d,getNextPageParam:(a,b)=>{let d=a.total,e=b.length;if(!(e*c>=d))return e+1},initialPageParam:1}),l=e?.pages.flatMap(a=>a.plugins)??[],m=e?.pages[0].total??0;return{data:a?void 0:{plugins:l,total:m},isLastPage:!h,loadNextPage:()=>{g()},isLoading:j,isFetching:i,error:f,isSuccess:k}},x=a=>(0,d.useQuery)({queryKey:[p,"installedLatestVersion",a],queryFn:()=>(0,n.post)("/workspaces/current/plugin/list/latest-versions",{body:{plugin_ids:a}}),enabled:!!a.length,initialData:a.length?void 0:{versions:{}}}),y=()=>{let a=(0,e.useQueryClient)(),b=(0,o.useInvalidateAllBuiltInTools)();return()=>{a.invalidateQueries({queryKey:q}),b()}},z=a=>(0,c.useMutation)({...a,mutationFn:a=>(0,n.post)("/workspaces/current/plugin/install/marketplace",{body:{plugin_unique_identifiers:[a]}})}),A=a=>(0,c.useMutation)({...a,mutationFn:a=>(0,n.post)("/workspaces/current/plugin/upgrade/marketplace",{body:a})}),B=a=>(0,d.useQuery)({queryKey:[p,"pluginDeclaration",a],queryFn:()=>(0,n.get)("/workspaces/current/plugin/marketplace/pkg",{params:{plugin_unique_identifier:a}}),enabled:!!a}),C=a=>(0,d.useQuery)({enabled:!!a,queryKey:[p,"versions",a],queryFn:()=>(0,n.getMarketplace)(`/plugins/${a}/versions`,{params:{page:1,page_size:100}})}),D=()=>(0,c.useMutation)({mutationFn:a=>(0,n.post)("/workspaces/current/plugin/install/pkg",{body:{plugin_unique_identifiers:[a]}})}),E=()=>(0,c.useMutation)({mutationFn:({repoUrl:a,selectedVersion:b,selectedPackage:c,uniqueIdentifier:d})=>(0,n.post)("/workspaces/current/plugin/install/github",{body:{repo:a,version:b,package:c,plugin_unique_identifier:d}})}),F=a=>(0,d.useQuery)({queryKey:[p,"uploadGitHub",a],queryFn:()=>(0,n.post)("/workspaces/current/plugin/upload/github",{body:a}),retry:0}),G=({onSuccess:a})=>{let{mutateAsync:b}=A();return(0,c.useMutation)({mutationFn:a=>{let{payload:c,plugin:d,installedInfo:e}=a;return Promise.all(c.map(async(a,c)=>{try{let f=e[`${d[c]?.org||d[c]?.author}/${d[c]?.name}`],g=!!f,h="",i="",j=!1;if("github"===a.type){if(!(h=a.value.github_plugin_unique_identifier)){let{unique_identifier:b}=await (0,n.post)("/workspaces/current/plugin/upload/github",{body:{repo:a.value.repo,version:a.value.release||a.value.version,package:a.value.packages||a.value.package}});if((h=a.value.github_plugin_unique_identifier||b)===f?.uniqueIdentifier)return{status:k.TaskStatus.success,taskId:"",uniqueIdentifier:""}}if(!g){let{task_id:b,all_installed:c}=await (0,n.post)("/workspaces/current/plugin/install/github",{body:{repo:a.value.repo,version:a.value.release||a.value.version,package:a.value.packages||a.value.package,plugin_unique_identifier:h}});i=b,j=c}}if("marketplace"===a.type){if((h=a.value.marketplace_plugin_unique_identifier||d[c]?.plugin_id)===f?.uniqueIdentifier)return{status:k.TaskStatus.success,taskId:"",uniqueIdentifier:""};if(!g){let{task_id:a,all_installed:b}=await (0,n.post)("/workspaces/current/plugin/install/marketplace",{body:{plugin_unique_identifiers:[h]}});i=a,j=b}}if("package"===a.type){if((h=a.value.unique_identifier)===f?.uniqueIdentifier)return{status:k.TaskStatus.success,taskId:"",uniqueIdentifier:""};if(!g){let{task_id:a,all_installed:b}=await (0,n.post)("/workspaces/current/plugin/install/pkg",{body:{plugin_unique_identifiers:[h]}});i=a,j=b}}if(g)if("package"===a.type){await (0,m.uninstallPlugin)(f.installedId);let{task_id:a,all_installed:b}=await (0,n.post)("/workspaces/current/plugin/install/pkg",{body:{plugin_unique_identifiers:[h]}});i=a,j=b}else{let{task_id:a,all_installed:c}=await b({original_plugin_unique_identifier:f?.uniqueIdentifier,new_plugin_unique_identifier:h});i=a,j=c}if(j)return{status:k.TaskStatus.success,taskId:"",uniqueIdentifier:""};return{status:k.TaskStatus.running,taskId:i,uniqueIdentifier:h}}catch(a){return Promise.resolve({status:k.TaskStatus.failed,taskId:"",uniqueIdentifier:""})}}))},onSuccess:a})},H=()=>(0,d.useQuery)({queryKey:[p,"debugKey"],queryFn:()=>(0,n.get)("/workspaces/current/plugin/debugging-key")}),I=[p,"referenceSettings"],J=()=>(0,d.useQuery)({queryKey:I,queryFn:()=>(0,n.get)("/workspaces/current/plugin/preferences/fetch")}),K=()=>{let a=(0,e.useQueryClient)();return()=>{a.invalidateQueries({queryKey:I})}},L=({onSuccess:a})=>(0,c.useMutation)({mutationFn:a=>(0,n.post)("/workspaces/current/plugin/preferences/change",{body:a}),onSuccess:a}),M=()=>(0,c.useMutation)({mutationFn:a=>(0,n.post)("/workspaces/current/plugin/preferences/autoupgrade/exclude",{body:a})}),N=(a,b)=>(0,d.useQuery)({...b,queryKey:[p,"fetchPluginsInMarketPlaceByIds",a],queryFn:()=>(0,n.postMarketplace)("/plugins/identifier/batch",{body:{unique_identifiers:a}}),enabled:a?.filter(a=>!!a).length>0,retry:0}),O=a=>(0,d.useQuery)({queryKey:[p,"fetchPluginsInMarketPlaceByInfo",a],queryFn:()=>(0,n.postMarketplace)("/plugins/versions/batch",{body:{plugin_tuples:a.map(a=>({org:a.organization,name:a.plugin,version:a.version}))}}),enabled:a?.filter(a=>!!a).length>0,retry:0}),P=[p,"pluginTaskList"],Q=a=>{let[b,c]=(0,g.useState)(!1),{canManagement:e}=(0,j.default)(),{refreshPluginList:i}=(0,h.default)(),{data:l,isFetched:m,isRefetching:o,refetch:p,...q}=(0,d.useQuery)({enabled:e,queryKey:P,queryFn:()=>(0,n.get)("/workspaces/current/plugin/tasks?page=1&page_size=100"),refetchInterval:a=>{let b=a.state.data;return!b?.tasks.every(a=>a.status===k.TaskStatus.success||a.status===k.TaskStatus.failed)&&5e3}});(0,g.useEffect)(()=>{if(!b||o)return;let c=(0,f.cloneDeep)(l),d=c?.tasks.every(a=>a.status===k.TaskStatus.success||a.status===k.TaskStatus.failed),e=c?.tasks.every(a=>a.status===k.TaskStatus.failed);d&&c?.tasks.length&&!e&&i(a?{category:a}:void 0,!a)},[o]),(0,g.useEffect)(()=>{c(!0)},[]);let r=(0,g.useCallback)(()=>{p()},[p]);return{data:l,pluginTasks:l?.tasks||[],isFetched:m,handleRefetch:r,...q}},R=()=>(0,c.useMutation)({mutationFn:({taskId:a,pluginId:b})=>{let c=encodeURIComponent(b);return(0,n.post)(`/workspaces/current/plugin/tasks/${a}/delete/${c}`)}}),S=a=>(0,d.useQuery)({enabled:!!a,queryKey:[[p,"manifest",a]],queryFn:()=>(0,n.getMarketplace)(`/plugins/${a}`),retry:0}),T=(a,b)=>(0,d.useQuery)({queryKey:[p,"downloadPlugin",a],queryFn:()=>(0,n.getMarketplace)(`/plugins/${a.organization}/${a.pluginName}/${a.version}/download`),enabled:b,retry:0}),U=()=>(0,c.useMutation)({mutationFn:a=>(0,n.get)(`/apps/imports/${a}/check-dependencies`)}),V=(a,b)=>{let c=a?.provider;return(0,d.useQuery)({queryKey:["modelInList",c,b],queryFn:async()=>{if(!b||!c)return!1;try{let a=await (0,l.fetchModelProviderModelList)(`/workspaces/current/model-providers/${c}/models`);return!!b&&!!a.data.find(a=>a.model===b)}catch{return!1}},enabled:!!b&&!!c})},W=a=>(0,d.useQuery)({queryKey:["pluginInfo",a],queryFn:async()=>{if(!a)return null;let b=a.split("/"),c=b[0],d=b[1];try{let a=await (0,m.fetchPluginInfoFromMarketPlace)({org:c,name:d});return a.data.plugin.category===k.PluginCategoryEnum.model?a.data.plugin:null}catch{return null}},enabled:!!a}),X=(a,b,d,e,f,g)=>(0,c.useMutation)({mutationFn:()=>(0,n.get)("/workspaces/current/plugin/parameters/dynamic-options",{params:{plugin_id:a,provider:b,action:d,parameter:e,provider_type:f,...g}})}),Y=({plugin_unique_identifier:a,language:b})=>(0,d.useQuery)({queryKey:["pluginReadme",a,b],queryFn:()=>(0,n.get)("/workspaces/current/plugin/readme",{params:{plugin_unique_identifier:a,language:b}},{silent:!0}),enabled:!!a,retry:0})},757014,a=>{"use strict";a.s(["default",()=>l]);var b=a.i(933988),c=a.i(701458),d=a.i(375616),e=a.i(234651),f=a.i(599656),g=a.i(781362),h=a.i(746077),i=a.i(844137),j=a.i(970854),k=a.i(263636);let l=()=>{let a=(0,g.useInvalidateInstalledPluginList)(),{mutate:l}=(0,c.useModelList)(b.ModelTypeEnum.textGeneration),{mutate:m}=(0,c.useModelList)(b.ModelTypeEnum.textEmbedding),{mutate:n}=(0,c.useModelList)(b.ModelTypeEnum.rerank),{refreshModelProviders:o}=(0,d.useProviderContext)(),p=(0,i.useInvalidateAllToolProviders)(),q=(0,i.useInvalidateAllBuiltInTools)(),r=(0,f.useInvalidDataSourceList)(),s=(0,e.useInvalidDataSourceListAuth)(),t=(0,h.useInvalidateStrategyProviders)(),u=(0,j.useInvalidateAllTriggerPlugins)(),v=(0,i.useInvalidateRAGRecommendedPlugins)();return{refreshPluginList:(b,c)=>{a(),(b&&k.PluginCategoryEnum.tool.includes(b.category)||c)&&(p(),q(),v("tool")),(b&&k.PluginCategoryEnum.trigger.includes(b.category)||c)&&u(),(b&&k.PluginCategoryEnum.datasource.includes(b.category)||c)&&(r(),s()),(b&&k.PluginCategoryEnum.model.includes(b.category)||c)&&(o(),l(),m(),n()),(b&&k.PluginCategoryEnum.agent.includes(b.category)||c)&&t()}}}}];

//# sourceMappingURL=_e53aa7db._.js.map
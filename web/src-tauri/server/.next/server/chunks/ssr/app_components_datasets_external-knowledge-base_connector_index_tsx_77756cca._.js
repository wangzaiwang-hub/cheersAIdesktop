module.exports=[881481,a=>{"use strict";var b=a.i(608061),c=a.i(533306),d=a.i(57843);a.i(60796);var e=a.i(55282),f=a.i(114715),g=a.i(429150);a.i(752298);var h=a.i(693025),i=a.i(909795),j=a.i(757801),k=a.i(252813),l=a.i(816134),m=a.i(114077),n=a.i(29255);a.i(805980);var o=a.i(122745);let p=({items:a,value:e,onSelect:f})=>{let{t:i}=(0,h.useTranslation)(),[j,k]=(0,d.useState)(!1),[l,p]=(0,d.useState)(a.find(a=>a.value===e)||null),{setShowExternalKnowledgeAPIModal:q}=(0,n.useModalContext)(),{mutateExternalKnowledgeApis:r}=(0,m.useExternalKnowledgeApi)(),s=(0,c.useRouter)();return(0,d.useEffect)(()=>{p(a.find(a=>a.value===e)||null)},[e,a]),(0,b.jsxs)("div",{className:"relative w-full",children:[(0,b.jsxs)("div",{className:`flex cursor-pointer items-center justify-between gap-0.5 self-stretch rounded-lg bg-components-input-bg-normal px-2
        py-1 hover:bg-state-base-hover-alt ${j&&"bg-state-base-hover-alt"}`,onClick:()=>k(!j),children:[l?(0,b.jsxs)("div",{className:"flex items-center gap-2 self-stretch rounded-lg p-1",children:[(0,b.jsx)(o.ApiConnectionMod,{className:"h-4 w-4 text-text-secondary"}),(0,b.jsx)("div",{className:"flex grow items-center",children:(0,b.jsx)("span",{className:"system-sm-regular overflow-hidden text-ellipsis text-components-input-text-filled",children:l.name})})]}):(0,b.jsx)("span",{className:"system-sm-regular text-components-input-text-placeholder",children:i("selectExternalKnowledgeAPI.placeholder",{ns:"dataset"})}),(0,b.jsx)(g.RiArrowDownSLine,{className:`h-4 w-4 text-text-quaternary transition-transform ${j?"text-text-secondary":""}`})]}),j&&(0,b.jsxs)("div",{className:"absolute z-10 mt-1 w-full rounded-xl border bg-components-panel-bg-blur shadow-lg",children:[a.map(a=>(0,b.jsx)("div",{className:"flex cursor-pointer items-center p-1",onClick:()=>{p(a),f(a),k(!1)},children:(0,b.jsxs)("div",{className:"flex w-full items-center gap-2 self-stretch rounded-lg p-2 hover:bg-state-base-hover",children:[(0,b.jsx)(o.ApiConnectionMod,{className:"h-4 w-4 text-text-secondary"}),(0,b.jsx)("span",{className:"system-sm-medium grow overflow-hidden text-ellipsis text-text-secondary",children:a.name}),(0,b.jsx)("span",{className:"system-xs-regular overflow-hidden text-ellipsis text-right text-text-tertiary",children:a.url})]})},a.value)),(0,b.jsx)("div",{className:"flex flex-col items-start self-stretch p-1",children:(0,b.jsxs)("div",{className:"flex cursor-pointer items-center gap-2 self-stretch rounded-lg p-2 hover:bg-state-base-hover",onClick:()=>{q({payload:{name:"",settings:{endpoint:"",api_key:""}},onSaveCallback:async()=>{r(),s.refresh()},onCancelCallback:()=>{r()},isEditMode:!1})},children:[(0,b.jsx)(g.RiAddLine,{className:"h-4 w-4 text-text-secondary"}),(0,b.jsx)("span",{className:"system-sm-medium grow overflow-hidden text-ellipsis text-text-secondary",children:i("createNewExternalAPI",{ns:"dataset"})})]})})]})]})},q=({external_knowledge_api_id:a,external_knowledge_id:e,onChange:f})=>{let{t:j}=(0,h.useTranslation)(),k=(0,c.useRouter)(),{externalKnowledgeApiList:o}=(0,m.useExternalKnowledgeApi)(),[q,r]=(0,d.useState)(a),{setShowExternalKnowledgeAPIModal:s}=(0,n.useModalContext)(),{mutateExternalKnowledgeApis:t}=(0,m.useExternalKnowledgeApi)(),u=o.map(a=>({value:a.id,name:a.name,url:a.settings.endpoint}));return(0,d.useEffect)(()=>{if(u.length>0){let b=a||u[0].value;r(b),b!==a&&f({external_knowledge_api_id:b,external_knowledge_id:e})}},[u,a,e,f]),(0,d.useEffect)(()=>{!a&&u.length>0&&f({external_knowledge_api_id:u[0].value,external_knowledge_id:e})},[]),(0,b.jsxs)("form",{className:"flex flex-col gap-4 self-stretch",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-1 self-stretch",children:[(0,b.jsx)("div",{className:"flex flex-col self-stretch",children:(0,b.jsx)("label",{className:"system-sm-semibold text-text-secondary",children:j("externalAPIPanelTitle",{ns:"dataset"})})}),u.length>0?(0,b.jsx)(p,{items:u,value:q,onSelect:a=>{r(a.value),f({external_knowledge_api_id:a.value,external_knowledge_id:e})}}):(0,b.jsxs)(i.default,{variant:"tertiary",onClick:()=>{s({payload:{name:"",settings:{endpoint:"",api_key:""}},onSaveCallback:async()=>{t(),k.refresh()},onCancelCallback:()=>{t()},isEditMode:!1})},className:"justify-start gap-0.5",children:[(0,b.jsx)(g.RiAddLine,{className:"h-4 w-4 text-text-tertiary"}),(0,b.jsx)("span",{className:"system-sm-regular text-text-tertiary",children:j("noExternalKnowledge",{ns:"dataset"})})]})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-1 self-stretch",children:[(0,b.jsx)("div",{className:"flex flex-col self-stretch",children:(0,b.jsx)("label",{className:"system-sm-semibold text-text-secondary",children:j("externalKnowledgeId",{ns:"dataset"})})}),(0,b.jsx)(l.default,{value:e,onChange:b=>f({external_knowledge_id:b.target.value,external_knowledge_api_id:a}),placeholder:j("externalKnowledgeIdPlaceholder",{ns:"dataset"})??""})]})]})},r=()=>{let{t:a}=(0,h.useTranslation)(),c=(0,k.useDocLink)();return(0,b.jsx)("div",{className:"flex w-[360px] flex-col items-start pb-2 pr-8 pt-[108px]",children:(0,b.jsxs)("div",{className:"flex w-full min-w-[240px] flex-col items-start gap-3 self-stretch rounded-xl bg-background-section p-6",children:[(0,b.jsx)("div",{className:"flex h-10 w-10 grow items-center justify-center gap-2 self-stretch rounded-lg border-[0.5px] border-components-card-border bg-components-card-bg p-1",children:(0,b.jsx)(g.RiBookOpenLine,{className:"h-5 w-5 text-text-accent"})}),(0,b.jsxs)("p",{className:"flex flex-col items-start gap-2 self-stretch",children:[(0,b.jsx)("span",{className:"system-xl-semibold self-stretch text-text-secondary",children:a("connectDatasetIntro.title",{ns:"dataset"})}),(0,b.jsxs)("span",{className:"system-sm-regular text-text-tertiary",children:[a("connectDatasetIntro.content.front",{ns:"dataset"}),(0,b.jsx)("a",{className:"system-sm-regular ml-1 text-text-accent",href:c("/use-dify/knowledge/external-knowledge-api"),target:"_blank",rel:"noopener noreferrer",children:a("connectDatasetIntro.content.link",{ns:"dataset"})}),a("connectDatasetIntro.content.end",{ns:"dataset"})]}),(0,b.jsx)("a",{className:"system-sm-regular self-stretch text-text-accent",href:c("/use-dify/knowledge/connect-external-knowledge-base"),target:"_blank",rel:"noopener noreferrer",children:a("connectDatasetIntro.learnMore",{ns:"dataset"})})]})]})})},s=({name:a,description:c,onChange:d})=>{let{t:e}=(0,h.useTranslation)();return(0,b.jsx)("form",{className:"flex flex-col gap-4 self-stretch",children:(0,b.jsxs)("div",{className:"flex flex-col gap-4 self-stretch",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-1 self-stretch",children:[(0,b.jsx)("div",{className:"flex flex-col justify-center self-stretch",children:(0,b.jsx)("label",{className:"system-sm-semibold text-text-secondary",children:e("externalKnowledgeName",{ns:"dataset"})})}),(0,b.jsx)(l.default,{value:a,onChange:a=>{d({name:a.target.value})},placeholder:e("externalKnowledgeNamePlaceholder",{ns:"dataset"})??""})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-1 self-stretch",children:[(0,b.jsx)("div",{className:"flex flex-col justify-center self-stretch",children:(0,b.jsx)("label",{className:"system-sm-semibold text-text-secondary",children:e("externalKnowledgeDescription",{ns:"dataset"})})}),(0,b.jsx)("div",{className:"flex flex-col gap-1 self-stretch",children:(0,b.jsx)("textarea",{value:c,onChange:a=>{d({description:a.target.value})},placeholder:e("externalKnowledgeDescriptionPlaceholder",{ns:"dataset"})??"",className:`flex h-20 items-start self-stretch rounded-lg bg-components-input-bg-normal p-3 py-2 ${c?"text-components-input-text-filled":"text-components-input-text-placeholder"} system-sm-regular`})})]})]})})};var t=a.i(821820);let u=({onConnect:a,loading:e})=>{let{t:f}=(0,h.useTranslation)(),l=(0,k.useDocLink)(),m=(0,c.useRouter)(),[n,o]=(0,d.useState)({name:"",description:"",external_knowledge_api_id:"",external_knowledge_id:"",external_retrieval_model:{top_k:4,score_threshold:.5,score_threshold_enabled:!1},provider:"external"}),p=(0,d.useCallback)(()=>{m.replace("/datasets")},[m]),u=a=>{o(a)},v=""!==n.name.trim()&&""!==n.external_knowledge_api_id&&""!==n.external_knowledge_id&&void 0!==n.external_retrieval_model.top_k&&void 0!==n.external_retrieval_model.score_threshold;return(0,b.jsx)("div",{className:"flex grow flex-col self-stretch rounded-t-2xl border-t border-effects-highlight bg-components-panel-bg",children:(0,b.jsxs)("div",{className:"flex grow justify-center self-stretch",children:[(0,b.jsx)("div",{className:"flex w-full max-w-[960px] flex-col items-center px-14 py-0",children:(0,b.jsxs)("div",{className:"flex w-full max-w-[640px] grow flex-col items-center gap-4 pb-8 pt-6",children:[(0,b.jsxs)("div",{className:"relative flex flex-col items-center gap-[2px] self-stretch py-2",children:[(0,b.jsx)("div",{className:"system-xl-semibold grow self-stretch text-text-primary",children:f("connectDataset",{ns:"dataset"})}),(0,b.jsxs)("p",{className:"system-sm-regular text-text-tertiary",children:[(0,b.jsx)("span",{children:f("connectHelper.helper1",{ns:"dataset"})}),(0,b.jsx)("span",{className:"system-sm-medium text-text-secondary",children:f("connectHelper.helper2",{ns:"dataset"})}),(0,b.jsx)("span",{children:f("connectHelper.helper3",{ns:"dataset"})}),(0,b.jsx)("a",{className:"system-sm-regular self-stretch text-text-accent",href:l("/use-dify/knowledge/connect-external-knowledge-base"),target:"_blank",rel:"noopener noreferrer",children:f("connectHelper.helper4",{ns:"dataset"})}),(0,b.jsxs)("span",{children:[f("connectHelper.helper5",{ns:"dataset"})," "]})]}),(0,b.jsx)(i.default,{className:"absolute left-[-44px] top-1 flex h-8 w-8 items-center justify-center rounded-full p-2",variant:"tertiary",onClick:p,children:(0,b.jsx)(g.RiArrowLeftLine,{className:"h-4 w-4 text-text-tertiary"})})]}),(0,b.jsx)(s,{name:n.name,description:n.description??"",onChange:a=>u({...n,...a})}),(0,b.jsx)(j.default,{}),(0,b.jsx)(q,{external_knowledge_api_id:n.external_knowledge_api_id,external_knowledge_id:n.external_knowledge_id,onChange:a=>u({...n,...a})}),(0,b.jsx)(t.default,{topK:n.external_retrieval_model.top_k,scoreThreshold:n.external_retrieval_model.score_threshold,scoreThresholdEnabled:n.external_retrieval_model.score_threshold_enabled,onChange:a=>u({...n,external_retrieval_model:{...n.external_retrieval_model,...a}})}),(0,b.jsxs)("div",{className:"flex items-center justify-end gap-2 self-stretch py-2",children:[(0,b.jsx)(i.default,{variant:"secondary",onClick:p,children:(0,b.jsx)("div",{className:"system-sm-medium text-components-button-secondary-text",children:f("externalKnowledgeForm.cancel",{ns:"dataset"})})}),(0,b.jsxs)(i.default,{variant:"primary",onClick:()=>{a(n)},disabled:!v,loading:e,children:[(0,b.jsx)("div",{className:"system-sm-medium text-components-button-primary-text",children:f("externalKnowledgeForm.connect",{ns:"dataset"})}),(0,b.jsx)(g.RiArrowRightLine,{className:"h-4 w-4 text-components-button-primary-text"})]})]})]})}),(0,b.jsx)(r,{})]})})};var v=a.i(218257);a.s(["default",0,()=>{let{notify:a}=(0,f.useToastContext)(),[g,h]=(0,d.useState)(!1),i=(0,c.useRouter)(),j=async b=>{try{h(!0);let c=await (0,v.createExternalKnowledgeBase)({body:b});if(c&&c.id)a({type:"success",message:"External Knowledge Base Connected Successfully"}),(0,e.trackEvent)("create_external_knowledge_base",{provider:b.provider,name:b.name}),i.back();else throw Error("Failed to create external knowledge base")}catch(b){console.error("Error creating external knowledge base:",b),a({type:"error",message:"Failed to connect External Knowledge Base"})}h(!1)};return(0,b.jsx)(u,{onConnect:j,loading:g})}],881481)}];

//# sourceMappingURL=app_components_datasets_external-knowledge-base_connector_index_tsx_77756cca._.js.map
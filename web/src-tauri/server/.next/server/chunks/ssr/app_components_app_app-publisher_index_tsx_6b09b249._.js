module.exports=[65395,a=>{"use strict";var b=a.i(608061),c=a.i(429150),d=a.i(261574),e=a.i(57843);a.i(752298);var f=a.i(693025),g=a.i(605575),h=a.i(243103);a.i(60796);var i=a.i(55282),j=a.i(909795);a.i(290384);var k=a.i(665388),k=k,l=a.i(825319),m=a.i(747104),n=a.i(533306),o=a.i(105249),p=a.i(114715),q=a.i(854867),r=a.i(743904),s=a.i(705134),t=a.i(844299),u=a.i(844137),v=a.i(527344),w=a.i(757801);let x=({disabled:a,published:d,detailNeedUpdate:g,workflowAppId:h,icon:i,name:k,description:l,inputs:m,outputs:x,handlePublish:y,onRefreshData:z,disabledReason:A})=>{let{t:B}=(0,f.useTranslation)(),C=(0,n.useRouter)(),[D,E]=(0,e.useState)(!1),[F,G]=(0,e.useState)(!1),[H,I]=(0,e.useState)(),{isCurrentWorkspaceManager:J}=(0,s.useAppContext)(),K=(0,u.useInvalidateAllWorkflowTools)(),L=(0,e.useMemo)(()=>{if(!H)return!1;if(H.tool.parameters.length!==m?.length)return!0;for(let a of m||[]){let b=H.tool.parameters.find(b=>b.name===a.variable);if(!b||b.required!==a.required||"paragraph"===a.type&&"string"!==b.type||"text-input"===a.type&&"string"!==b.type)return!0}return!1},[H,m]),M=(0,e.useMemo)(()=>{let a=[],b=[];return d?H&&H.tool&&(a=(m||[]).map(a=>({name:a.variable,required:a.required,type:"paragraph"===a.type?"string":a.type,description:H.tool.parameters.find(b=>b.name===a.variable)?.llm_description||"",form:H.tool.parameters.find(b=>b.name===a.variable)?.form||"llm"})),b=(x||[]).map(a=>{let b=H.tool.output_schema?.properties?.[a.variable];return{name:a.variable,description:b?b.description:"",type:a.value_type}})):(a=(m||[]).map(a=>({name:a.variable,description:"",form:"llm",required:a.required,type:a.type})),b=(x||[]).map(a=>({name:a.variable,description:"",type:a.value_type}))),{icon:H?.icon||i,label:H?.label||k,name:H?.name||"",description:H?.description||l,parameters:a,outputParameters:b,labels:H?.tool?.labels||[],privacy_policy:H?.privacy_policy||"",...d?{workflow_tool_id:H?.workflow_tool_id}:{workflow_app_id:h}}},[H,d,h,i,k,l,m]),N=(0,e.useCallback)(async a=>{G(!0),I(await (0,t.fetchWorkflowToolDetailByAppID)(a)),G(!1)},[]);(0,e.useEffect)(()=>{d&&N(h)},[N,d,h]),(0,e.useEffect)(()=>{g&&N(h)},[g,N,h]);let O=async a=>{try{await (0,t.createWorkflowToolProvider)(a),K(),z?.(),N(h),p.default.notify({type:"success",message:B("api.actionSuccess",{ns:"common"})}),E(!1)}catch(a){p.default.notify({type:"error",message:a.message})}},P=async a=>{try{await y(),await (0,t.saveWorkflowToolProvider)(a),z?.(),K(),N(h),p.default.notify({type:"success",message:B("api.actionSuccess",{ns:"common"})}),E(!1)}catch(a){p.default.notify({type:"error",message:a.message})}};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(w.default,{type:"horizontal",className:"h-px bg-divider-subtle"}),(!d||!F)&&(0,b.jsxs)("div",{className:(0,v.cn)("group rounded-lg bg-background-section-burn transition-colors",a||!J?"cursor-not-allowed opacity-60 shadow-xs":"cursor-pointer",!a&&!d&&J&&"hover:bg-state-accent-hover"),children:[J?(0,b.jsxs)("div",{className:"flex items-center justify-start gap-2 p-2 pl-2.5",onClick:()=>!a&&!d&&E(!0),children:[(0,b.jsx)(c.RiHammerLine,{className:(0,v.cn)("relative h-4 w-4 text-text-secondary",!a&&!d&&"group-hover:text-text-accent")}),(0,b.jsx)("div",{title:B("common.workflowAsTool",{ns:"workflow"})||"",className:(0,v.cn)("system-sm-medium shrink grow basis-0 truncate text-text-secondary",!a&&!d&&"group-hover:text-text-accent"),children:B("common.workflowAsTool",{ns:"workflow"})}),!d&&(0,b.jsx)("span",{className:"system-2xs-medium-uppercase shrink-0 rounded-[5px] border border-divider-deep bg-components-badge-bg-dimm px-1 py-0.5 text-text-tertiary",children:B("common.configureRequired",{ns:"workflow"})})]}):(0,b.jsxs)("div",{className:"flex items-center justify-start gap-2 p-2 pl-2.5",children:[(0,b.jsx)(c.RiHammerLine,{className:"h-4 w-4 text-text-tertiary"}),(0,b.jsx)("div",{title:B("common.workflowAsTool",{ns:"workflow"})||"",className:"system-sm-medium shrink grow basis-0 truncate text-text-tertiary",children:B("common.workflowAsTool",{ns:"workflow"})})]}),A&&(0,b.jsx)("div",{className:"mt-1 px-2.5 pb-2 text-xs leading-[18px] text-text-tertiary",children:A}),d&&(0,b.jsxs)("div",{className:"border-t-[0.5px] border-divider-regular px-2.5 py-2",children:[(0,b.jsxs)("div",{className:"flex justify-between gap-x-2",children:[(0,b.jsxs)(j.default,{size:"small",className:"w-[140px]",onClick:()=>E(!0),disabled:!J||a,children:[B("common.configure",{ns:"workflow"}),L&&(0,b.jsx)(q.default,{className:"ml-1",color:"yellow"})]}),(0,b.jsxs)(j.default,{size:"small",className:"w-[140px]",onClick:()=>C.push("/tools?category=workflow"),disabled:a,children:[B("common.manageInTools",{ns:"workflow"}),(0,b.jsx)(c.RiArrowRightUpLine,{className:"ml-1 h-4 w-4"})]})]}),L&&(0,b.jsx)("div",{className:"mt-1 text-xs leading-[18px] text-text-warning",children:B("common.workflowAsToolTip",{ns:"workflow"})})]})]}),d&&F&&(0,b.jsx)("div",{className:"pt-2",children:(0,b.jsx)(o.default,{type:"app"})}),D&&(0,b.jsx)(r.default,{isAdd:!d,payload:M,onHide:()=>E(!1),onCreate:O,onSave:P})]})};var y=a.i(18039),z=a.i(724423),A=a.i(87208),B=a.i(204685),C=a.i(179062),D=a.i(190124),E=a.i(802066),F=a.i(808216),G=a.i(954200),H=a.i(499257),I=a.i(483664),J=a.i(56328);a.i(713310);var K=a.i(128972),L=a.i(959595),M=a.i(701458),N=a.i(375616),O=a.i(912626);let P=({multipleModelConfigs:a,onSelect:d})=>{let{t:g}=(0,f.useTranslation)(),h=(0,M.useLanguage)(),{textGenerationModelList:i}=(0,N.useProviderContext)(),[k,m]=(0,e.useState)(!1),n=[];return a.forEach(a=>{let b=i.find(b=>b.provider===a.provider);if(b){let c=b.models.find(b=>b.model===a.model);c&&n.push({id:a.id,model:a.model,provider:a.provider,modelItem:c,providerItem:b,parameters:a.parameters})}}),(0,b.jsxs)(l.PortalToFollowElem,{open:k,onOpenChange:m,placement:"bottom-end",children:[(0,b.jsx)(l.PortalToFollowElemTrigger,{className:"w-full",onClick:()=>{n.length&&m(a=>!a)},children:(0,b.jsxs)(j.default,{variant:"primary",disabled:!n.length,className:"mt-3 w-full",children:[g("operation.applyConfig",{ns:"appDebug"}),(0,b.jsx)(c.RiArrowDownSLine,{className:"ml-0.5 h-3 w-3"})]})}),(0,b.jsx)(l.PortalToFollowElemContent,{className:"z-50 mt-1 w-[288px]",children:(0,b.jsxs)("div",{className:"rounded-lg border-[0.5px] border-components-panel-border bg-components-panel-bg p-1 shadow-lg",children:[(0,b.jsx)("div",{className:"flex h-[22px] items-center px-3 text-xs font-medium text-text-tertiary",children:g("publishAs",{ns:"appDebug"})}),n.map((a,c)=>(0,b.jsxs)("div",{className:"flex h-8 cursor-pointer items-center rounded-lg px-3 text-sm text-text-tertiary hover:bg-state-base-hover",onClick:()=>{d(a),m(!1)},children:[(0,b.jsxs)("span",{className:"min-w-[18px] italic",children:["#",c+1]}),(0,b.jsx)(O.default,{modelName:a.model,provider:a.providerItem,className:"ml-2"}),(0,b.jsx)("div",{className:"ml-1 truncate text-text-secondary",title:a.modelItem.label[h],children:a.modelItem.label[h]})]},a.id))]})})]})},Q=({icon:a,link:d,disabled:e,children:f,className:g,onClick:h,...i})=>(0,b.jsxs)("a",{href:e?void 0:d,target:"_blank",rel:"noreferrer",className:(0,v.cn)("flex items-center justify-start gap-2 rounded-lg bg-background-section-burn px-2.5 py-2 text-text-secondary transition-colors [&:not(:first-child)]:mt-1",e?"cursor-not-allowed opacity-30 shadow-xs":"cursor-pointer text-text-secondary hover:bg-state-accent-hover hover:text-text-accent",g),onClick:a=>{e||h?.(a)},...i,children:[(0,b.jsx)("div",{className:"relative h-4 w-4",children:a}),(0,b.jsx)("div",{className:"system-sm-medium shrink grow basis-0",children:f}),(0,b.jsx)(c.RiArrowRightUpLine,{className:"h-3.5 w-3.5"})]}),R={[C.AccessMode.ORGANIZATION]:{label:"organization",icon:c.RiBuildingLine},[C.AccessMode.SPECIFIC_GROUPS_MEMBERS]:{label:"specific",icon:c.RiLockLine},[C.AccessMode.PUBLIC]:{label:"anyone",icon:c.RiGlobalLine},[C.AccessMode.EXTERNAL_MEMBERS]:{label:"external",icon:c.RiVerifiedBadgeLine}},S=({mode:a})=>{let{t:c}=(0,f.useTranslation)();if(!a||!R[a])return null;let{icon:d,label:e}=R[a];return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(d,{className:"h-4 w-4 shrink-0 text-text-secondary"}),(0,b.jsx)("div",{className:"grow truncate",children:(0,b.jsx)("span",{className:"system-sm-medium text-text-secondary",children:c(`accessControlDialog.accessItems.${e}`,{ns:"app"})})})]})},T=["ctrl","â‡§","P"],U=(0,e.memo)(({disabled:a=!1,publishDisabled:n=!1,publishedAt:q,draftUpdatedAt:r,debugWithMultipleModel:s=!1,multipleModelConfigs:t=[],onPublish:u,onRestore:v,onToggle:M,crossAxisOffset:N=0,toolPublished:O,inputs:R,outputs:U,onRefreshData:V,workflowToolAvailable:W=!0,missingStartNode:X=!1,hasTriggerNode:Y=!1,startNodeLimitExceeded:Z=!1})=>{let{t:$}=(0,f.useTranslation)(),[_,aa]=(0,e.useState)(!1),[ab,ac]=(0,e.useState)(!1),[ad,ae]=(0,e.useState)(!1),[af,ag]=(0,e.useState)(!0),[ah,ai]=(0,e.useState)(!1),aj=(0,h.useStore)(a=>a.appDetail),ak=(0,h.useStore)(a=>a.setAppDetail),al=(0,z.useGlobalPublicStore)(a=>a.systemFeatures),{formatTimeFromNow:am}=(0,B.useFormatTimeFromNow)(),{app_base_url:an="",access_token:ao=""}=aj?.site??{},ap=aj?.mode!==G.AppModeEnum.COMPLETION&&aj?.mode!==G.AppModeEnum.WORKFLOW?G.AppModeEnum.CHAT:aj.mode,aq=`${an}${H.basePath}/${ap}/${ao}`,ar=[G.AppModeEnum.CHAT,G.AppModeEnum.AGENT_CHAT,G.AppModeEnum.COMPLETION].includes(aj?.mode||G.AppModeEnum.CHAT),{data:as,isLoading:at,refetch:au}=(0,D.useGetUserCanAccessApp)({appId:aj?.id,enabled:!1}),{data:av,isLoading:aw}=(0,D.useAppWhiteListSubjects)(aj?.id,ab&&al.webapp_auth.enabled&&aj?.access_mode===C.AccessMode.SPECIFIC_GROUPS_MEMBERS),ax=(0,A.useAsyncWindowOpen)(),ay=(0,e.useMemo)(()=>al.webapp_auth.enabled&&aj&&aj.access_mode!==C.AccessMode.EXTERNAL_MEMBERS&&!as?.result,[al,aj,as]),az=(0,e.useMemo)(()=>!q||X||ay,[q,X,ay]),aA=(0,e.useMemo)(()=>q?X?$("noUserInputNode",{ns:"app"}):ay?$("noAccessPermission",{ns:"app"}):void 0:$("notPublishedYet",{ns:"app"}),[X,ay,q]);(0,e.useEffect)(()=>{al.webapp_auth.enabled&&ab&&aj&&au()},[ab,aj,au,al]),(0,e.useEffect)(()=>{aj&&av&&aj.access_mode===C.AccessMode.SPECIFIC_GROUPS_MEMBERS&&av.groups?.length===0&&av.members?.length===0?ag(!1):ag(!0)},[av,aj]);let aB=(0,e.useCallback)(async a=>{try{await u?.(a),aa(!0),(0,i.trackEvent)("app_published_time",{action_mode:"app",app_id:aj?.id,app_name:aj?.name})}catch{aa(!1)}},[aj,u]),aC=(0,e.useCallback)(async()=>{try{await v?.(),ac(!1)}catch{}},[v]),aD=(0,e.useCallback)(()=>{let b=!ab;a?ac(!1):(M?.(b),ac(b),b&&aa(!1))},[a,M,ab]),aE=(0,e.useCallback)(async()=>{await ax(async()=>{if(!aj?.id)throw Error("App not found");let{installed_apps:a}=await (0,F.fetchInstalledAppList)(aj?.id)||{};if(a?.length>0)return`${H.basePath}/explore/installed/${a[0].id}`;throw Error("No app found in Explore")},{onError:a=>{p.default.notify({type:"error",message:`${a.message||a}`})}})},[aj?.id,ax]),aF=(0,e.useCallback)(async()=>{if(aj)try{let a=await (0,E.fetchAppDetailDirect)({url:"/apps",id:aj.id});ak(a)}finally{ae(!1)}},[aj,ak]);(0,d.useKeyPress)(`${(0,K.getKeyboardKeyCodeBySystem)("ctrl")}.shift.p`,a=>{a.preventDefault(),n||_||aB()},{exactMatch:!0,useCapture:!0});let aG=!q||!W,aH=aG?$("common.workflowAsToolDisabledHint",{ns:"workflow"}):void 0,aI=(0,e.useMemo)(()=>({background:"linear-gradient(97deg, var(--components-input-border-active-prompt-1, rgba(11, 165, 236, 0.95)) -3.64%, var(--components-input-border-active-prompt-2, rgba(21, 90, 239, 0.95)) 45.14%)",WebkitBackgroundClip:"text",backgroundClip:"text",WebkitTextFillColor:"transparent"}),[]);return(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)(l.PortalToFollowElem,{open:ab,onOpenChange:ac,placement:"bottom-end",offset:{mainAxis:4,crossAxis:N},children:[(0,b.jsx)(l.PortalToFollowElemTrigger,{onClick:aD,children:(0,b.jsxs)(j.default,{variant:"primary",className:"py-2 pl-3 pr-2",disabled:a,children:[$("common.publish",{ns:"workflow"}),(0,b.jsx)(c.RiArrowDownSLine,{className:"h-4 w-4 text-components-button-primary-text"})]})}),(0,b.jsx)(l.PortalToFollowElemContent,{className:"z-[11]",children:(0,b.jsxs)("div",{className:"w-[320px] rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-xl shadow-shadow-shadow-5",children:[(0,b.jsxs)("div",{className:"p-4 pt-3",children:[(0,b.jsx)("div",{className:"system-xs-medium-uppercase flex h-6 items-center text-text-tertiary",children:q?$("common.latestPublished",{ns:"workflow"}):$("common.currentDraftUnpublished",{ns:"workflow"})}),q?(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"system-sm-medium flex items-center text-text-secondary",children:[$("common.publishedAt",{ns:"workflow"})," ",am(q)]}),ar&&(0,b.jsx)(j.default,{variant:"secondary-accent",size:"small",onClick:aC,disabled:_,children:$("common.restore",{ns:"workflow"})})]}):(0,b.jsxs)("div",{className:"system-sm-medium flex items-center text-text-secondary",children:[$("common.autoSaved",{ns:"workflow"})," ","Â·",!!r&&am(r)]}),s?(0,b.jsx)(P,{multipleModelConfigs:t,onSelect:a=>aB(a)}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(j.default,{variant:"primary",className:"mt-3 w-full",onClick:()=>aB(),disabled:n||_,children:_?$("common.published",{ns:"workflow"}):(0,b.jsxs)("div",{className:"flex gap-1",children:[(0,b.jsx)("span",{children:$("common.publishUpdate",{ns:"workflow"})}),(0,b.jsx)(J.default,{keys:T,bgColor:"white"})]})}),!!Z&&(0,b.jsxs)("div",{className:"mt-3 flex flex-col items-stretch",children:[(0,b.jsxs)("p",{className:"text-sm font-semibold leading-5 text-transparent",style:aI,children:[(0,b.jsx)("span",{className:"block",children:$("publishLimit.startNodeTitlePrefix",{ns:"workflow"})}),(0,b.jsx)("span",{className:"block",children:$("publishLimit.startNodeTitleSuffix",{ns:"workflow"})})]}),(0,b.jsx)("p",{className:"mt-1 text-xs leading-4 text-text-secondary",children:$("publishLimit.startNodeDesc",{ns:"workflow"})}),(0,b.jsx)(m.default,{isShort:!0,className:"mb-[12px] mt-[9px] h-[32px] w-[93px] self-start"})]})]})]}),al.webapp_auth.enabled&&(at||aw)?(0,b.jsx)("div",{className:"py-2",children:(0,b.jsx)(o.default,{})}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(w.default,{className:"my-0"}),al.webapp_auth.enabled&&(0,b.jsxs)("div",{className:"p-4 pt-3",children:[(0,b.jsx)("div",{className:"flex h-6 items-center",children:(0,b.jsx)("p",{className:"system-xs-medium text-text-tertiary",children:$("publishApp.title",{ns:"app"})})}),(0,b.jsxs)("div",{className:"flex h-8 cursor-pointer items-center gap-x-0.5  rounded-lg bg-components-input-bg-normal py-1 pl-2.5 pr-2 hover:bg-primary-50 hover:text-text-accent",onClick:()=>{ae(!0)},children:[(0,b.jsx)("div",{className:"flex grow items-center gap-x-1.5 overflow-hidden pr-1",children:(0,b.jsx)(S,{mode:aj?.access_mode})}),!af&&(0,b.jsx)("p",{className:"system-xs-regular shrink-0 text-text-tertiary",children:$("publishApp.notSet",{ns:"app"})}),(0,b.jsx)("div",{className:"flex h-4 w-4 shrink-0 items-center justify-center",children:(0,b.jsx)(c.RiArrowRightSLine,{className:"h-4 w-4 text-text-quaternary"})})]}),!af&&(0,b.jsx)("p",{className:"system-xs-regular mt-1 text-text-warning",children:$("publishApp.notSetDesc",{ns:"app"})})]}),!Y&&(0,b.jsxs)("div",{className:"flex flex-col gap-y-1 border-t-[0.5px] border-t-divider-regular p-4 pt-3",children:[(0,b.jsx)(I.default,{triggerClassName:"flex",disabled:!az,popupContent:aA,asChild:!1,children:(0,b.jsx)(Q,{className:"flex-1",disabled:az,link:aq,icon:(0,b.jsx)(c.RiPlayCircleLine,{className:"h-4 w-4"}),children:$("common.runApp",{ns:"workflow"})})}),aj?.mode===G.AppModeEnum.WORKFLOW||aj?.mode===G.AppModeEnum.COMPLETION?(0,b.jsx)(I.default,{triggerClassName:"flex",disabled:!az,popupContent:aA,asChild:!1,children:(0,b.jsx)(Q,{className:"flex-1",disabled:az,link:`${aq}${aq.includes("?")?"&":"?"}mode=batch`,icon:(0,b.jsx)(c.RiPlayList2Line,{className:"h-4 w-4"}),children:$("common.batchRunApp",{ns:"workflow"})})}):(0,b.jsx)(Q,{onClick:()=>{ai(!0),aD()},disabled:!q,icon:(0,b.jsx)(k.default,{className:"h-4 w-4"}),children:$("common.embedIntoSite",{ns:"workflow"})}),(0,b.jsx)(I.default,{triggerClassName:"flex",disabled:!az,popupContent:aA,asChild:!1,children:(0,b.jsx)(Q,{className:"flex-1",onClick:()=>{q&&aE()},disabled:az,icon:(0,b.jsx)(c.RiPlanetLine,{className:"h-4 w-4"}),children:$("common.openInExplore",{ns:"workflow"})})}),(0,b.jsx)(I.default,{triggerClassName:"flex",disabled:!!q&&!X,popupContent:q?$("noUserInputNode",{ns:"app"}):$("notPublishedYet",{ns:"app"}),asChild:!1,children:(0,b.jsx)(Q,{className:"flex-1",disabled:!q||X,link:"./develop",icon:(0,b.jsx)(c.RiTerminalBoxLine,{className:"h-4 w-4"}),children:$("common.accessAPIReference",{ns:"workflow"})})}),aj?.mode===G.AppModeEnum.WORKFLOW&&(0,b.jsx)(x,{disabled:aG,published:!!O,detailNeedUpdate:!!O&&_,workflowAppId:aj?.id,icon:{content:("image"===aj.icon_type?"ðŸ¤–":aj?.icon)||"ðŸ¤–",background:("image"===aj.icon_type?y.appDefaultIconBackground:aj?.icon_background)||y.appDefaultIconBackground},name:aj?.name,description:aj?.description,inputs:R,outputs:U,handlePublish:aB,onRefreshData:V,disabledReason:aH})]})]})]})}),(0,b.jsx)(g.default,{siteInfo:aj?.site,isShow:ah,onClose:()=>ai(!1),appBaseUrl:an,accessToken:ao}),ad&&(0,b.jsx)(L.default,{app:aj,onConfirm:aF,onClose:()=>{ae(!1)}})]})})});a.s(["default",0,U],65395)}];

//# sourceMappingURL=app_components_app_app-publisher_index_tsx_6b09b249._.js.map
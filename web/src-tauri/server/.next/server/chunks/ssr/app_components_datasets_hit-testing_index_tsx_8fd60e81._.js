module.exports=[908297,a=>{"use strict";var b=a.i(608061),c=a.i(497746),d=a.i(57843);a.i(752298);var e=a.i(693025),f=a.i(639378),g=a.i(632789),h=a.i(136156),i=a.i(105249),j=a.i(796499),k=a.i(708406),l=a.i(698636),m=a.i(585124),n=a.i(847733),o=a.i(848636);a.i(528698);var p=a.i(41511);a.i(425282);let q="hit-testing";var r=a.i(527344),s=a.i(817681),t=a.i(429150);let u=d.memo(()=>{let{t:a}=(0,e.useTranslation)();return(0,b.jsxs)("div",{className:"rounded-2xl bg-workflow-process-bg p-5",children:[(0,b.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-[10px] border-[0.5px] border-components-card-border bg-components-card-bg p-1 shadow-lg shadow-shadow-shadow-5 backdrop-blur-[5px]",children:(0,b.jsx)(t.RiHistoryLine,{className:"h-5 w-5 text-text-tertiary"})}),(0,b.jsx)("div",{className:"my-2 text-[13px] font-medium leading-4 text-text-tertiary",children:a("noRecentTip",{ns:"datasetHitTesting"})})]})});var v=a.i(682541),w=a.i(44348),x=a.i(909795),y=a.i(693137),z=a.i(614157),A=a.i(115357),B=a.i(483664),C=a.i(294524);let D=d.memo(()=>{let{t:a}=(0,e.useTranslation)(),c=(0,A.useFileStoreWithSelector)(a=>a.files),{fileUploadConfig:d,uploaderRef:f,fileChangeHandle:g,selectHandle:h}=(0,z.useUpload)();return(0,b.jsxs)("div",{children:[(0,b.jsx)("input",{ref:f,id:"fileUploader",className:"hidden",type:"file",multiple:!0,accept:C.ACCEPT_TYPES.map(a=>`.${a}`).join(","),onChange:g}),(0,b.jsx)("div",{className:"flex flex-wrap gap-1",children:(0,b.jsx)(B.default,{popupContent:a("imageUploader.tooltip",{ns:"datasetHitTesting",size:d.imageFileSizeLimit,batchCount:d.imageFileBatchLimit}),popupClassName:"system-xs-medium p-1.5 rounded-lg text-text-secondary",position:"top",offset:4,disabled:0===c.length,children:(0,b.jsxs)("div",{className:"group flex cursor-pointer items-center gap-x-2",onClick:h,children:[(0,b.jsx)("div",{className:"flex size-8 items-center justify-center rounded-lg border-[1px] border-dashed border-components-dropzone-border bg-components-button-tertiary-bg group-hover:bg-components-button-tertiary-bg-hover",children:(0,b.jsx)(t.RiImageAddLine,{className:"size-4 text-text-tertiary"})}),0===c.length&&(0,b.jsx)("span",{className:"system-sm-regular text-text-quaternary group-hover:text-text-tertiary",children:a("imageUploader.tip",{ns:"datasetHitTesting",size:d.imageFileSizeLimit,batchCount:d.imageFileBatchLimit})})]})})})]})});var E=a.i(527858);a.i(10035);var F=a.i(734766),G=a.i(744383),H=a.i(244044);let I=(0,d.memo)(({file:a,showDeleteAction:c,onRemove:e,onReUpload:f,onPreview:g})=>{let{id:h,progress:i,base64Url:j,sourceUrl:k}=a,l=(0,d.useCallback)(a=>{a.stopPropagation(),a.preventDefault(),g?.(h)},[g,h]),m=(0,d.useCallback)(a=>{a.stopPropagation(),a.preventDefault(),e?.(h)},[e,h]),n=(0,d.useCallback)(a=>{a.stopPropagation(),a.preventDefault(),f?.(h)},[f,h]);return(0,b.jsxs)("div",{className:"group/file-image relative cursor-pointer",onClick:l,children:[c&&(0,b.jsx)(x.default,{className:"absolute -right-1.5 -top-1.5 z-[11] hidden h-5 w-5 rounded-full p-0 group-hover/file-image:flex",onClick:m,children:(0,b.jsx)(t.RiCloseLine,{className:"h-4 w-4 text-components-button-secondary-text"})}),(0,b.jsx)(E.default,{className:"size-20 shadow-md",imageUrl:j||k||""}),i>=0&&!(0,H.fileIsUploaded)(a)&&(0,b.jsx)("div",{className:"absolute inset-0 z-10 flex items-center justify-center border-[2px] border-effects-image-frame bg-background-overlay-alt",children:(0,b.jsx)(G.default,{percentage:i,size:12,circleStrokeColor:"stroke-components-progress-white-border",circleFillColor:"fill-transparent",sectorFillColor:"fill-components-progress-white-progress"})}),-1===i&&(0,b.jsx)("div",{className:"absolute inset-0 z-10 flex items-center justify-center border-[2px] border-state-destructive-border bg-background-overlay-destructive",onClick:n,children:(0,b.jsx)(F.ReplayLine,{className:"size-5 text-text-primary-on-surface"})})]})}),J=({textArea:a,actionButton:c,showUploader:f=!0,className:g,actionAreaClassName:h})=>{let{t:i}=(0,e.useTranslation)(),j=(0,A.useFileStoreWithSelector)(a=>a.files),[k,l]=(0,d.useState)(0),[m,n]=(0,d.useState)([]),{dragging:o,dragRef:p,dropRef:q,handleRemoveFile:s,handleReUploadFile:t}=(0,z.useUpload)(),u=(0,d.useCallback)(a=>{let b=j.findIndex(b=>b.id===a);-1!==b&&(l(b),n(j.map(a=>({url:a.base64Url||a.sourceUrl||"",name:a.name,size:a.size}))))},[j]),v=(0,d.useCallback)(()=>{n([])},[]);return(0,b.jsxs)("div",{ref:q,className:(0,r.cn)("relative flex w-full flex-col",g),children:[o&&(0,b.jsxs)("div",{className:"absolute inset-0.5 z-10 flex items-center justify-center rounded-lg border-[1.5px] border-dashed border-components-dropzone-border-accent bg-components-dropzone-bg-accent",children:[(0,b.jsx)("div",{children:i("imageUploader.dropZoneTip",{ns:"datasetHitTesting"})}),(0,b.jsx)("div",{ref:p,className:"absolute inset-0"})]}),a,f&&!!j.length&&(0,b.jsx)("div",{className:"flex flex-wrap gap-1 bg-background-default px-4 py-2",children:j.map(a=>(0,b.jsx)(I,{file:a,showDeleteAction:!0,onRemove:s,onReUpload:t,onPreview:u},a.id))}),(0,b.jsxs)("div",{className:(0,r.cn)("flex",f?"justify-between":"justify-end",h),children:[f&&(0,b.jsx)(D,{}),c]}),m.length>0&&(0,b.jsx)(y.default,{images:m,initialIndex:k,onClose:v})]})},K=({value:a,onChange:c,...d})=>(0,b.jsx)(A.FileContextProvider,{value:a,onChange:c,children:(0,b.jsx)(J,{...d})});a.i(687844);var L=a.i(954200),M=a.i(958887),N=a.i(175809),O=a.i(821820);let P=({onClose:a,onSave:c,initialTopK:f,initialScoreThreshold:g,initialScoreThresholdEnabled:h})=>{let{t:i}=(0,e.useTranslation)(),[j,k]=(0,d.useState)(f),[l,m]=(0,d.useState)(g),[n,o]=(0,d.useState)(h);return(0,b.jsxs)("div",{className:"shadows-shadow-2xl absolute right-[14px] top-[36px] z-10 flex w-[320px] flex-col items-start rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between self-stretch p-4 pb-2",children:[(0,b.jsx)("div",{className:"system-xl-semibold grow text-text-primary",children:i("settingTitle",{ns:"datasetHitTesting"})}),(0,b.jsx)(N.default,{className:"ml-auto",onClick:a,children:(0,b.jsx)(t.RiCloseLine,{className:"h-4 w-4 shrink-0"})})]}),(0,b.jsx)("div",{className:"flex flex-col items-start justify-center gap-4 self-stretch p-4 pt-2",children:(0,b.jsx)(O.default,{topK:j,scoreThreshold:l,scoreThresholdEnabled:n,onChange:a=>{void 0!==a.top_k&&k(a.top_k),void 0!==a.score_threshold&&m(a.score_threshold),void 0!==a.score_threshold_enabled&&o(a.score_threshold_enabled)},isInHitTesting:!0})}),(0,b.jsxs)("div",{className:"flex w-full items-end justify-end gap-1 p-4 pt-2",children:[(0,b.jsx)(x.default,{className:"min-w-[72px] shrink-0",onClick:a,children:i("operation.cancel",{ns:"common"})}),(0,b.jsx)(x.default,{variant:"primary",className:"min-w-[72px] shrink-0",onClick:()=>{c({top_k:j,score_threshold:l,score_threshold_enabled:n}),a()},children:i("operation.save",{ns:"common"})})]})]})};a.i(262721);var Q=a.i(16988);let R=d.memo(({text:a,handleTextChange:c})=>{let{t:d}=(0,e.useTranslation)();return(0,b.jsxs)("div",{className:(0,r.cn)("relative flex-1 overflow-hidden rounded-t-[10px] border-t-[0.5px] border-components-panel-border-subtle bg-background-default px-4 pb-0 pt-3",a.length>200&&"border-state-destructive-active"),children:[(0,b.jsx)("textarea",{className:"system-md-regular h-full w-full resize-none border-none bg-transparent text-text-secondary caret-[#295EFF] placeholder:text-components-input-text-placeholder focus-visible:outline-none",value:a,onChange:c,placeholder:d("input.placeholder",{ns:"datasetHitTesting"})}),(0,b.jsxs)("div",{className:"absolute right-0 top-0 flex items-center",children:[(0,b.jsx)(Q.Corner,{className:(0,r.cn)("text-background-section-burn",a.length>200&&"text-util-colors-red-red-100")}),a.length>200?(0,b.jsx)(B.default,{popupContent:d("input.countWarning",{ns:"datasetHitTesting"}),children:(0,b.jsx)("div",{className:(0,r.cn)("system-2xs-medium-uppercase bg-util-colors-red-red-100 py-1 pr-2 text-util-colors-red-red-600"),children:`${a.length}/200`})}):(0,b.jsx)("div",{className:(0,r.cn)("system-2xs-medium-uppercase bg-background-section-burn py-1 pr-2 text-text-tertiary"),children:`${a.length}/200`})]})]})}),S=({onUpdateList:a,setHitResult:c,setExternalHitResult:f,loading:g,queries:h,setQueries:i,isExternal:j=!1,onClickRetrievalMethod:k,retrievalConfig:m,isEconomy:n,onSubmit:o,hitTestingMutation:p,externalKnowledgeBaseHitTestingMutation:q})=>{let s,{t:u}=(0,e.useTranslation)(),y=(0,l.useDatasetDetailContextWithSelector)(a=>!!a.dataset?.is_multimodal),[z,A]=(0,d.useState)(!1),[B,C]=(0,d.useState)({top_k:4,score_threshold:.5,score_threshold_enabled:!1}),D=(0,d.useMemo)(()=>h.find(a=>"text_query"===a.content_type)?.content??"",[h]),E=(0,d.useMemo)(()=>h.filter(a=>"image_query"===a.content_type).map(a=>a.file_info).filter(Boolean).map(a=>({id:(0,w.v4)(),name:a.name,size:a.size,mimeType:a.mime_type,extension:a.extension,sourceUrl:a.source_url,uploadedId:a.id,progress:100}))||[],[h]),F=(0,d.useMemo)(()=>E.every(a=>!!a.uploadedId),[E]),G=(0,d.useCallback)(a=>{C(a),A(!1)},[]),H=(0,d.useCallback)(a=>{let b=[...h],c=b.find(a=>"text_query"===a.content_type);c?c.content=a.target.value:b.push({content:a.target.value,content_type:"text_query",file_info:null}),i(b)},[h,i]),I=(0,d.useCallback)(a=>{let b=[...h];b=b.filter(a=>"image_query"!==a.content_type),a.forEach(a=>{b.push({content:a.sourceUrl||"",content_type:"image_query",file_info:{id:a.uploadedId||"",mime_type:a.mimeType,source_url:a.sourceUrl||"",name:a.name,size:a.size,extension:a.extension}})}),i(b)},[h,i]),J=(0,d.useCallback)(async()=>{await p({query:D,attachment_ids:E.map(a=>a.uploadedId),retrieval_model:{...m,search_method:n?L.RETRIEVE_METHOD.keywordSearch:m.search_method}},{onSuccess:b=>{c(b),a?.(),o&&o()}})},[D,m,n,p,a,o,E,c]),N=(0,d.useCallback)(async()=>{await q({query:D,external_retrieval_model:{top_k:B.top_k,score_threshold:B.score_threshold,score_threshold_enabled:B.score_threshold_enabled}},{onSuccess:b=>{f(b),a?.()}})},[D,B,q,a,f]),O=n?L.RETRIEVE_METHOD.keywordSearch:m.search_method,Q=(0,b.jsx)(v.default,{className:"size-3.5 text-util-colors-purple-purple-600",src:(s=O,({[L.RETRIEVE_METHOD.semantic]:M.retrievalIcon.vector,[L.RETRIEVE_METHOD.fullText]:M.retrievalIcon.fullText,[L.RETRIEVE_METHOD.hybrid]:M.retrievalIcon.hybrid,[L.RETRIEVE_METHOD.invertedIndex]:M.retrievalIcon.vector,[L.RETRIEVE_METHOD.keywordSearch]:M.retrievalIcon.vector})[s]||M.retrievalIcon.vector),alt:""}),S=(0,d.useMemo)(()=>(0,b.jsx)(R,{text:D,handleTextChange:H}),[D,H]),T=(0,d.useMemo)(()=>(0,b.jsxs)(x.default,{onClick:j?N:J,variant:"primary",loading:g,disabled:0===D.length&&0===E.length||D.length>200||E.length>0&&!F,className:"w-[88px]",children:[(0,b.jsx)(t.RiPlayCircleLine,{className:"mr-1 size-4"}),u("input.testing",{ns:"datasetHitTesting"})]}),[j,N,J,D,g,u,E,F]);return(0,b.jsx)("div",{className:(0,r.cn)("relative flex h-80 shrink-0 flex-col overflow-hidden rounded-xl bg-gradient-to-r from-components-input-border-active-prompt-1 to-components-input-border-active-prompt-2 p-0.5 shadow-xs"),children:(0,b.jsxs)("div",{className:"flex h-full flex-col overflow-hidden rounded-[10px] bg-background-section-burn",children:[(0,b.jsxs)("div",{className:"relative flex shrink-0 items-center justify-between p-1.5 pb-1 pl-3",children:[(0,b.jsx)("span",{className:"system-sm-semibold-uppercase text-text-secondary",children:u("input.title",{ns:"datasetHitTesting"})}),j?(0,b.jsxs)(x.default,{variant:"secondary",size:"small",onClick:()=>A(!z),children:[(0,b.jsx)(t.RiEqualizer2Line,{className:"h-3.5 w-3.5 text-components-button-secondary-text"}),(0,b.jsx)("div",{className:"flex items-center justify-center gap-1 px-[3px]",children:(0,b.jsx)("span",{className:"system-xs-medium text-components-button-secondary-text",children:u("settingTitle",{ns:"datasetHitTesting"})})})]}):(0,b.jsxs)("div",{onClick:k,className:"flex h-7 cursor-pointer items-center space-x-0.5 rounded-lg border-[0.5px] border-components-button-secondary-bg bg-components-button-secondary-bg px-1.5 shadow-xs backdrop-blur-[5px] hover:bg-components-button-secondary-bg-hover",children:[Q,(0,b.jsx)("div",{className:"text-xs font-medium uppercase text-text-secondary",children:u(`retrieval.${O}.title`,{ns:"dataset"})}),(0,b.jsx)(t.RiEqualizer2Line,{className:"size-4 text-components-menu-item-text"})]}),z&&(0,b.jsx)(P,{onClose:()=>A(!1),onSave:G,initialTopK:B.top_k,initialScoreThreshold:B.score_threshold,initialScoreThresholdEnabled:B.score_threshold_enabled})]}),(0,b.jsx)(K,{textArea:S,actionButton:T,onChange:I,value:E,showUploader:y,className:"grow",actionAreaClassName:"px-4 py-2 shrink-0 bg-background-default"})]})})};var T=a.i(98654),U=a.i(806686);let V=d.memo(({records:a,onClickRecord:c})=>{let{t:f}=(0,e.useTranslation)(),{formatTime:g}=(0,T.default)(),[h,i]=(0,d.useState)("desc"),j=(0,d.useCallback)(()=>{i(a=>"asc"===a?"desc":"asc")},[]),k=(0,d.useMemo)(()=>[...a].sort((a,b)=>"asc"===h?a.created_at-b.created_at:b.created_at-a.created_at),[a,h]);return(0,b.jsx)("div",{className:"grow overflow-y-auto",children:(0,b.jsxs)("table",{className:"w-full border-collapse border-0 text-[13px] leading-4 text-text-secondary ",children:[(0,b.jsx)("thead",{className:"sticky top-0 h-7 text-xs  font-medium uppercase leading-7 text-text-tertiary backdrop-blur-[5px]",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{className:"rounded-l-lg bg-background-section-burn pl-3",children:f("table.header.queryContent",{ns:"datasetHitTesting"})}),(0,b.jsx)("td",{className:"w-[128px]  bg-background-section-burn pl-3",children:f("table.header.source",{ns:"datasetHitTesting"})}),(0,b.jsx)("td",{className:"w-48 rounded-r-lg bg-background-section-burn pl-3",children:(0,b.jsxs)("div",{className:"flex cursor-pointer items-center",onClick:j,children:[f("table.header.time",{ns:"datasetHitTesting"}),(0,b.jsx)(t.RiArrowDownLine,{className:(0,r.cn)("ml-0.5 size-3.5","asc"===h?"rotate-180":"")})]})})]})}),(0,b.jsx)("tbody",{children:k.map(a=>{let{id:d,source:e,created_at:h,queries:i}=a,j="app"===a.source?t.RiApps2Line:t.RiFocus2Line,k=i.find(a=>"text_query"===a.content_type)?.content||"",l=i.filter(a=>"image_query"===a.content_type).map(a=>a.file_info).filter(Boolean).map(a=>({name:a.name,mimeType:a.mime_type,sourceUrl:a.source_url,size:a.size,extension:a.extension}));return(0,b.jsxs)("tr",{className:"group cursor-pointer border-b border-divider-subtle hover:bg-background-default-hover",onClick:()=>c(a),children:[(0,b.jsx)("td",{className:"max-w-xs p-3 pr-2",children:(0,b.jsxs)("div",{className:"flex flex-col gap-y-1",children:[k&&(0,b.jsx)("div",{className:"line-clamp-2",children:k}),l.length>0&&(0,b.jsx)(U.default,{images:l,size:"md",className:"py-1",limit:5})]})}),(0,b.jsx)("td",{className:"w-[128px] p-3 pr-2",children:(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)(j,{className:"mr-1 size-4 text-text-tertiary"}),(0,b.jsx)("span",{className:"capitalize",children:e.replace("_"," ").replace("hit testing","retrieval test")})]})}),(0,b.jsx)("td",{className:"w-48 p-3 pr-2",children:g(h,f("dateTimeFormat",{ns:"datasetHitTesting"}))})]},d)})})]})})});var W=a.i(189583),X=a.i(368206),Y=a.i(829001),Z=a.i(155467),$=a.i(502594);let _=d.memo(({value:a,besideChunkName:c})=>!a||isNaN(a)?null:(0,b.jsxs)("div",{className:(0,r.cn)("relative items-center overflow-hidden border border-components-progress-bar-border px-[5px]",c?"h-[20.5px] border-l-0":"h-[20px] rounded-md"),children:[(0,b.jsx)("div",{className:(0,r.cn)("absolute left-0 top-0 h-full border-r-[1.5px] border-components-progress-brand-progress bg-util-colors-blue-brand-blue-brand-100",1===a&&"border-r-0"),style:{width:`${100*a}%`}}),(0,b.jsxs)("div",{className:(0,r.cn)("relative flex h-full items-center space-x-0.5 text-util-colors-blue-brand-blue-brand-700"),children:[(0,b.jsx)("div",{className:"system-2xs-medium-uppercase",children:"score"}),(0,b.jsx)("div",{className:"system-xs-semibold",children:a?.toFixed(2)})]})]})),aa=d.memo(({payload:a,isShowAll:c})=>{let{score:d,content:e,position:f}=a;return(0,b.jsxs)("div",{className:c?"":"line-clamp-2 break-all",children:[(0,b.jsxs)("div",{className:"relative top-[-2px] inline-flex items-center",children:[(0,b.jsxs)("div",{className:"system-2xs-semibold-uppercase flex h-[20.5px] items-center  bg-state-accent-solid px-1 text-text-primary-on-surface",children:["C-",f]}),(0,b.jsx)(_,{value:d,besideChunkName:!0})]}),(0,b.jsx)($.SliceContent,{className:"bg-state-accent-hover py-0.5 text-sm font-normal text-text-secondary group-hover:bg-state-accent-hover",children:e})]})});var ab=a.i(780442),ac=a.i(940272),ad=a.i(687700),ae=a.i(388025),af=a.i(948972);let ag=d.memo(({className:a})=>(0,b.jsx)("div",{className:(0,r.cn)("h-12 bg-gradient-to-b from-components-panel-bg-transparent to-components-panel-bg",a)})),ah=d.memo(({payload:a,onHide:c})=>{let{t:f}=(0,e.useTranslation)(),{segment:g,score:h,child_chunks:i,files:j,summary:k}=a,{position:l,content:m,sign_content:n,keywords:o,document:p,answer:q}=g,s=!!(i&&i.length>0),t=p.name.split(".").slice(-1)[0],u=s?"h-[min(627px,_80vh)] overflow-y-auto":"h-[min(539px,_80vh)] overflow-y-auto",v=f(s?"segment.parentChunk":"segment.chunk",{ns:"datasetDocuments"}),w=(0,d.useMemo)(()=>j?j.map(a=>({name:a.name,mimeType:a.mime_type,sourceUrl:a.source_url,size:a.size,extension:a.extension})):[],[j]),x=w.length>0,y=!s&&o&&o.length>0;return(0,b.jsx)(ac.default,{title:f("chunkDetail",{ns:"datasetHitTesting"}),isShow:!0,closable:!0,onClose:c,className:(0,r.cn)(s?"!min-w-[1200px]":"!min-w-[800px]"),children:(0,b.jsxs)("div",{className:"mt-4 flex",children:[(0,b.jsxs)("div",{className:(0,r.cn)("flex-1",s&&"pr-6"),children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex grow items-center space-x-2",children:[(0,b.jsx)(ae.SegmentIndexTag,{labelPrefix:v,positionId:l,className:(0,r.cn)("w-fit group-hover:opacity-100")}),(0,b.jsx)(ad.default,{}),(0,b.jsxs)("div",{className:"flex grow items-center space-x-1",children:[(0,b.jsx)(ab.default,{type:t,size:"sm"}),(0,b.jsx)("span",{className:"w-0 grow truncate text-[13px] font-normal text-text-secondary",children:p.name})]})]}),(0,b.jsx)(_,{value:h})]}),(0,b.jsxs)("div",{className:"relative",children:[!q&&(0,b.jsx)(W.Markdown,{className:(0,r.cn)("!mt-2 !text-text-secondary",u),content:n||m,customDisallowedElements:["input"]}),q&&(0,b.jsxs)("div",{className:"break-all",children:[(0,b.jsxs)("div",{className:"flex gap-x-1",children:[(0,b.jsx)("div",{className:"w-4 shrink-0 text-[13px] font-medium leading-[20px] text-text-tertiary",children:"Q"}),(0,b.jsx)("div",{className:(0,r.cn)("body-md-regular line-clamp-20 text-text-secondary"),children:m})]}),(0,b.jsxs)("div",{className:"flex gap-x-1",children:[(0,b.jsx)("div",{className:"w-4 shrink-0 text-[13px] font-medium leading-[20px] text-text-tertiary",children:"A"}),(0,b.jsx)("div",{className:(0,r.cn)("body-md-regular line-clamp-20 text-text-secondary"),children:q})]})]}),(0,b.jsx)(ag,{className:"absolute inset-x-0 bottom-0"})]}),(x||y||!!k)&&(0,b.jsxs)("div",{className:"flex flex-col gap-y-3 pt-3",children:[x&&(0,b.jsx)(U.default,{images:w,size:"md",className:"py-1"}),!!k&&(0,b.jsx)(af.default,{value:k,disabled:!0}),y&&(0,b.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,b.jsx)("div",{className:"text-xs font-medium uppercase text-text-tertiary",children:f("keyword",{ns:"datasetHitTesting"})}),(0,b.jsx)("div",{className:"flex flex-wrap gap-x-2",children:o.map(a=>(0,b.jsx)(Y.default,{text:a},a))})]})]})]}),s&&(0,b.jsxs)("div",{className:"flex-1 pb-6 pl-6",children:[(0,b.jsx)("div",{className:"system-xs-semibold-uppercase text-text-secondary",children:f("hitChunks",{ns:"datasetHitTesting",num:i.length})}),(0,b.jsx)("div",{className:(0,r.cn)("mt-1 space-y-2",u),children:i.map(a=>(0,b.jsx)(aa,{payload:a,isShowAll:!0},a.id))})]})]})})}),ai=d.memo(({docType:a,docTitle:c,showDetailModal:d})=>{let{t:f}=(0,e.useTranslation)();return(0,b.jsxs)("div",{className:"mt-3 flex h-10 items-center justify-between border-t border-divider-subtle pl-3 pr-2",children:[(0,b.jsxs)("div",{className:"flex grow items-center space-x-1",children:[(0,b.jsx)(ab.default,{type:a,size:"sm"}),(0,b.jsx)("span",{className:"w-0 grow truncate text-[13px] font-normal text-text-secondary",children:c})]}),(0,b.jsxs)("div",{className:"flex cursor-pointer items-center space-x-1 text-text-tertiary",onClick:d,children:[(0,b.jsx)("div",{className:"text-xs uppercase",children:f("open",{ns:"datasetHitTesting"})}),(0,b.jsx)(t.RiArrowRightUpLine,{className:"size-3.5"})]})]})}),aj=d.memo(({labelPrefix:a,positionId:c,wordCount:d,score:f,className:g})=>{let{t:h}=(0,e.useTranslation)();return(0,b.jsxs)("div",{className:(0,r.cn)("flex items-center justify-between",g),children:[(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(ae.SegmentIndexTag,{labelPrefix:a,positionId:c,className:(0,r.cn)("w-fit group-hover:opacity-100")}),(0,b.jsx)(ad.default,{}),(0,b.jsxs)("div",{className:"system-xs-medium text-text-tertiary",children:[d," ",h("segment.characters",{ns:"datasetDocuments",count:d})]})]}),(0,b.jsx)(_,{value:f})]})}),ak=d.memo(({payload:a})=>{let{t:f}=(0,e.useTranslation)(),{segment:g,score:h,child_chunks:i,files:j,summary:k}=a,{position:l,word_count:m,content:n,sign_content:o,keywords:p,document:q}=g,s=!!(i&&i.length>0),u=q.name.split(".").slice(-1)[0],v=(0,Z.extensionToFileType)(u),[w,{toggle:x}]=(0,c.useBoolean)(!1),y=w?t.RiArrowRightSLine:t.RiArrowDownSLine,[z,{setTrue:A,setFalse:B}]=(0,c.useBoolean)(!1),C=(0,d.useMemo)(()=>j?j.map(a=>({name:a.name,mimeType:a.mime_type,sourceUrl:a.source_url,size:a.size,extension:a.extension})):[],[j]);return(0,b.jsxs)("div",{className:(0,r.cn)("cursor-pointer rounded-xl bg-chat-bubble-bg pt-3 hover:shadow-lg"),onClick:A,children:[(0,b.jsx)(aj,{className:"px-3",labelPrefix:`${s?"Parent-":""}Chunk`,positionId:l,wordCount:m,score:h}),(0,b.jsxs)("div",{className:"mt-1 px-3",children:[(0,b.jsx)(W.Markdown,{className:"line-clamp-2",content:o||n,customDisallowedElements:["input"]}),C.length>0&&(0,b.jsx)(U.default,{images:C,size:"md",className:"py-1"}),s&&(0,b.jsxs)("div",{className:"mt-1",children:[(0,b.jsxs)("div",{className:(0,r.cn)("inline-flex h-6 cursor-pointer select-none items-center space-x-0.5 rounded-lg text-text-secondary",w&&"bg-workflow-process-bg pl-1"),onClick:a=>{a.stopPropagation(),x()},children:[(0,b.jsx)(y,{className:(0,r.cn)("h-4 w-4",w&&"opacity-50")}),(0,b.jsx)("div",{className:"text-xs font-semibold uppercase",children:f("hitChunks",{ns:"datasetHitTesting",num:i.length})})]}),!w&&(0,b.jsx)("div",{className:"space-y-2",children:i.map(a=>(0,b.jsx)("div",{className:"ml-[7px] border-l-[2px] border-text-accent-secondary pl-[7px]",children:(0,b.jsx)(aa,{payload:a,isShowAll:!1})},a.id))})]}),!s&&p&&p.length>0&&(0,b.jsx)("div",{className:"mt-2 flex flex-wrap",children:p.map(a=>(0,b.jsx)(Y.default,{text:a,className:"mr-2"},a))}),k&&(0,b.jsx)(X.default,{summary:k,className:"mt-2"})]}),(0,b.jsx)(ai,{docType:v,docTitle:q.name,showDetailModal:A}),z&&(0,b.jsx)(ah,{payload:a,onHide:B})]})});var al=a.i(441885);let am=d.memo(({payload:a,positionId:d})=>{let{t:f}=(0,e.useTranslation)(),{content:g,title:h,score:i}=a,[j,{setTrue:k,setFalse:l}]=(0,c.useBoolean)(!1);return(0,b.jsxs)("div",{className:(0,r.cn)("cursor-pointer rounded-xl bg-chat-bubble-bg pt-3 hover:shadow-lg"),onClick:k,children:[(0,b.jsx)(aj,{className:"px-3",labelPrefix:"Chunk",positionId:d,wordCount:g.length,score:i}),(0,b.jsx)("div",{className:"mt-1 px-3",children:(0,b.jsx)("div",{className:"body-md-regular line-clamp-2 break-all text-text-primary",children:g})}),(0,b.jsx)(ai,{docType:al.FileAppearanceTypeEnum.custom,docTitle:h,showDetailModal:k}),j&&(0,b.jsx)(ac.default,{title:f("chunkDetail",{ns:"datasetHitTesting"}),className:"!min-w-[800px]",closable:!0,onClose:l,isShow:j,children:(0,b.jsxs)("div",{className:"mt-4 flex-1",children:[(0,b.jsx)(aj,{labelPrefix:"Chunk",positionId:d,wordCount:g.length,score:i}),(0,b.jsx)("div",{className:(0,r.cn)("body-md-regular mt-2 break-all text-text-secondary","h-[min(539px,_80vh)] overflow-y-auto"),children:g})]})})]})});var an=a.i(798418),ao=a.i(916443),ap=a.i(721298),aq=a.i(701458),ar=a.i(252813),as=a.i(114715),at=a.i(933988),au=a.i(516877);let av=d.memo(({indexMethod:a,value:c,isShow:f,onHide:g,onSave:h})=>{let i=(0,d.useRef)(null),{t:j}=(0,e.useTranslation)(),k=(0,ar.useDocLink)(),[m,n]=(0,d.useState)(c),o=(0,l.useDatasetDetailContextWithSelector)(a=>a.dataset?.embedding_model),p=(0,l.useDatasetDetailContextWithSelector)(a=>a.dataset?.embedding_model_provider),{data:q}=(0,aq.useModelList)(at.ModelTypeEnum.textEmbedding),{data:r}=(0,aq.useModelList)(at.ModelTypeEnum.rerank),s=(0,d.useMemo)(()=>(0,au.checkShowMultiModalTip)({embeddingModel:{provider:p??"",model:o??""},rerankingEnable:m.reranking_enable,rerankModel:{rerankingProviderName:m.reranking_model.reranking_provider_name,rerankingModelName:m.reranking_model.reranking_model_name},indexMethod:a,embeddingModelList:q,rerankModelList:r}),[p,o,m.reranking_enable,m.reranking_model,a,q,r]);return f?(0,b.jsxs)("div",{className:"flex w-full flex-col rounded-2xl border-[0.5px] border-components-panel-border bg-components-panel-bg shadow-2xl shadow-shadow-shadow-9",style:{height:"calc(100vh - 72px)"},ref:i,children:[(0,b.jsxs)("div",{className:"h-15 flex shrink-0 justify-between px-3 pb-1 pt-3.5",children:[(0,b.jsxs)("div",{className:"text-base font-semibold text-text-primary",children:[(0,b.jsx)("div",{children:j("form.retrievalSetting.title",{ns:"datasetSettings"})}),(0,b.jsxs)("div",{className:"text-xs font-normal leading-[18px] text-text-tertiary",children:[(0,b.jsx)("a",{target:"_blank",rel:"noopener noreferrer",href:k("/use-dify/knowledge/create-knowledge/setting-indexing-methods"),className:"text-text-accent",children:j("form.retrievalSetting.learnMore",{ns:"datasetSettings"})}),j("form.retrievalSetting.description",{ns:"datasetSettings"})]})]}),(0,b.jsx)("div",{className:"flex",children:(0,b.jsx)("div",{onClick:g,className:"flex h-8 w-8 cursor-pointer items-center justify-center",children:(0,b.jsx)(t.RiCloseLine,{className:"h-4 w-4 text-text-tertiary"})})})]}),(0,b.jsxs)("div",{className:"px-4 py-2",children:[(0,b.jsx)("div",{className:"mb-1 text-[13px] font-semibold leading-6 text-text-secondary",children:j("form.retrievalSetting.method",{ns:"datasetSettings"})}),"high_quality"===a?(0,b.jsx)(ap.default,{value:m,onChange:n,showMultiModalTip:s}):(0,b.jsx)(ao.default,{value:m,onChange:n})]}),(0,b.jsxs)("div",{className:"flex justify-end p-4 pt-2",children:[(0,b.jsx)(x.default,{className:"mr-2 shrink-0",onClick:g,children:j("operation.cancel",{ns:"common"})}),(0,b.jsx)(x.default,{variant:"primary",className:"shrink-0",onClick:()=>{(0,an.isReRankModelSelected)({rerankModelList:r,retrievalConfig:m,indexMethod:a})?h(m):as.default.notify({type:"error",message:j("datasetConfig.rerankModelRequired",{ns:"appDebug"})})},children:j("operation.save",{ns:"common"})})]})]}):null});a.s(["default",0,({datasetId:a})=>{let{t}=(0,e.useTranslation)(),v=(0,m.default)()===m.MediaType.mobile,[w,x]=(0,d.useState)(),[y,z]=(0,d.useState)(),[A,B]=(0,d.useState)([]),[C,D]=(0,d.useState)(Date.now()),[E,F]=(0,d.useState)(0),{data:G,refetch:H,isLoading:I}=(0,n.useDatasetTestingRecords)(a,{limit:10,page:E+1}),J=G?.total||0,{dataset:K}=(0,f.useContext)(l.default),L=K?.provider==="external",[M,N]=(0,d.useState)(K?.retrieval_model_dict),[O,P]=(0,d.useState)(!1),[Q,{setTrue:R,setFalse:T,set:U}]=(0,c.useBoolean)(!v),{mutateAsync:W,isPending:X}=(0,o.useMutation)({mutationKey:[q,"hit-testing",a],mutationFn:b=>(0,p.post)(`/datasets/${a}/hit-testing`,{body:b})}),{mutateAsync:Y,isPending:Z}=(0,o.useMutation)({mutationKey:[q,"external-knowledge-base-hit-testing",a],mutationFn:b=>(0,p.post)(`/datasets/${a}/external-hit-testing`,{body:b})}),$=X||Z,_=a=>(0,b.jsxs)("div",{className:"flex h-full flex-col rounded-tl-2xl bg-background-body px-4 py-3",children:[(0,b.jsx)("div",{className:"mb-2 shrink-0 pl-2 font-semibold leading-6 text-text-primary",children:t("hit.title",{ns:"datasetHitTesting",num:a.length})}),(0,b.jsx)("div",{className:"grow space-y-2 overflow-y-auto",children:a.map((a,c)=>L?(0,b.jsx)(am,{positionId:c+1,payload:a},c):(0,b.jsx)(ak,{payload:a},c))})]}),aa=(0,d.useCallback)(a=>{B(a.queries),D(Date.now())},[]);return(0,d.useEffect)(()=>{U(!v)},[v,U]),(0,b.jsxs)("div",{className:"relative flex h-full w-full gap-x-6 overflow-y-auto pl-6",children:[(0,b.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col py-3",children:[(0,b.jsxs)("div",{className:"mb-4 flex flex-col justify-center",children:[(0,b.jsx)("h1",{className:"text-base font-semibold text-text-primary",children:t("title",{ns:"datasetHitTesting"})}),(0,b.jsx)("p",{className:"mt-0.5 text-[13px] font-normal leading-4 text-text-tertiary",children:t("desc",{ns:"datasetHitTesting"})})]}),(0,b.jsx)(S,{setHitResult:x,setExternalHitResult:z,onSubmit:R,onUpdateList:H,loading:$,queries:A,setQueries:B,isExternal:L,onClickRetrievalMethod:()=>P(!0),retrievalConfig:M,isEconomy:K?.indexing_technique==="economy",hitTestingMutation:W,externalKnowledgeBaseHitTestingMutation:Y},C),(0,b.jsx)("div",{className:"mb-3 mt-6 text-base font-semibold text-text-primary",children:t("records",{ns:"datasetHitTesting"})}),I&&(0,b.jsx)("div",{className:"flex-1",children:(0,b.jsx)(i.default,{type:"app"})}),!I&&G?.data&&G.data.length>0&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(V,{records:G?.data,onClickRecord:aa}),J&&J>10?(0,b.jsx)(j.default,{current:E,onChange:F,total:J,limit:10}):null]}),!I&&!G?.data?.length&&(0,b.jsx)(u,{})]}),(0,b.jsx)(h.default,{panelClassName:"!justify-start !overflow-y-auto",showClose:!0,isMobile:v,isOpen:Q,onClose:T,footer:null,children:(0,b.jsx)("div",{className:"flex min-w-0 flex-1 flex-col pt-3",children:$?(0,b.jsx)("div",{className:"flex h-full flex-col rounded-tl-2xl bg-background-body px-4 py-3",children:(0,b.jsx)(s.CardSkelton,{})}):w?.records.length||y?.records.length?_(w?.records.length?w.records:y?.records||[]):(0,b.jsxs)("div",{className:"flex h-full flex-col items-center justify-center rounded-tl-2xl bg-background-body px-4 py-3",children:[(0,b.jsx)("div",{className:(0,r.cn)(k.default.commonIcon,k.default.targetIcon,"!h-14 !w-14 !bg-text-quaternary")}),(0,b.jsx)("div",{className:"mt-3 text-[13px] text-text-quaternary",children:t("hit.emptyTip",{ns:"datasetHitTesting"})})]})})}),(0,b.jsx)(g.default,{unmount:!0,isOpen:O,onClose:()=>P(!1),footer:null,mask:v,panelClassName:"mt-16 mx-2 sm:mr-2 mb-3 !p-0 !max-w-[640px] rounded-xl",children:(0,b.jsx)(av,{indexMethod:K?.indexing_technique||"",value:M,isShow:O,onHide:()=>P(!1),onSave:a=>{N(a),P(!1)}})})]})}],908297)}];

//# sourceMappingURL=app_components_datasets_hit-testing_index_tsx_8fd60e81._.js.map
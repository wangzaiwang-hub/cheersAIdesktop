module.exports=[425422,a=>{a.v({githubIcon:"page-module__Rf0uyG__githubIcon",googleIcon:"page-module__Rf0uyG__googleIcon"})},42099,a=>{"use strict";var b=a.i(608061),c=a.i(533306),d=a.i(57843),e=a.i(43301),f=a.i(429150),g=a.i(413192);a.i(752298);var h=a.i(693025),i=a.i(114715),j=a.i(18039),k=a.i(724423),l=a.i(9575),m=a.i(763539),n=a.i(850953),o=a.i(527344),p=a.i(105249),q=a.i(909795),r=a.i(816134),s=a.i(684460),t=a.i(252813);function u({isInvite:a}){let{t:e}=(0,h.useTranslation)(),f=(0,c.useRouter)(),g=(0,c.useSearchParams)(),k=decodeURIComponent(g.get("email")||""),[m,n]=(0,d.useState)(k),[o,p]=(0,d.useState)(!1),u=(0,t.useLocale)(),v=async()=>{try{if(!m)return void i.default.notify({type:"error",message:e("error.emailEmpty",{ns:"login"})});if(!j.emailRegex.test(m))return void i.default.notify({type:"error",message:e("error.emailInValid",{ns:"login"})});p(!0);let a=await (0,l.sendEMailLoginCode)(m,u);if("success"===a.result){localStorage.setItem(s.COUNT_DOWN_KEY,`${s.COUNT_DOWN_TIME_MS}`);let b=new URLSearchParams(g);b.set("email",encodeURIComponent(m)),b.set("token",encodeURIComponent(a.data)),f.push(`/signin/check-code?${b.toString()}`)}}catch(a){console.error(a)}finally{p(!1)}};return(0,b.jsxs)("form",{onSubmit:a=>{a.preventDefault(),v()},children:[(0,b.jsx)("input",{type:"text",className:"hidden"}),(0,b.jsxs)("div",{className:"mb-2",children:[(0,b.jsx)("label",{htmlFor:"email",className:"system-md-semibold my-2 text-text-secondary",children:e("email",{ns:"login"})}),(0,b.jsx)("div",{className:"mt-1",children:(0,b.jsx)(r.default,{id:"email",type:"email",disabled:a,value:m,placeholder:e("emailPlaceholder",{ns:"login"}),onChange:a=>n(a.target.value)})}),(0,b.jsx)("div",{className:"mt-3",children:(0,b.jsx)(q.default,{type:"submit",loading:o,disabled:o||!m,variant:"primary",className:"w-full",children:e("signup.verifyMail",{ns:"login"})})})]})]})}var v=a.i(111089);a.i(60796);var w=a.i(55282),x=a.i(174465),y=a.i(356897),z=a.i(40719);function A({isInvite:a,isEmailSetup:e,allowRegistration:f}){let{t:k}=(0,h.useTranslation)(),m=(0,t.useLocale)(),n=(0,c.useRouter)(),o=(0,c.useSearchParams)(),[p,s]=(0,d.useState)(!1),u=decodeURIComponent(o.get("email")||""),[A,B]=(0,d.useState)(u),[C,D]=(0,d.useState)(""),[E,F]=(0,d.useState)(!1),G=async()=>{if(!A)return void i.default.notify({type:"error",message:k("error.emailEmpty",{ns:"login"})});if(!j.emailRegex.test(A))return void i.default.notify({type:"error",message:k("error.emailInValid",{ns:"login"})});if(!C?.trim())return void i.default.notify({type:"error",message:k("error.passwordEmpty",{ns:"login"})});try{F(!0);let b={email:A,password:(0,y.encryptPassword)(C),language:m,remember_me:!0};a&&(b.invite_token=decodeURIComponent(o.get("invite_token")));let c=await (0,l.login)({url:"/login",body:b});if("success"===c.result)if(c?.data?.access_token&&(0,x.setWebAppAccessToken)(c.data.access_token),(0,w.trackEvent)("user_login_success",{method:"email_password",is_invite:a}),a)n.replace(`/signin/invite-settings?${o.toString()}`);else{let a=(0,z.resolvePostLoginRedirect)(o);n.replace(a||"/apps")}else i.default.notify({type:"error",message:c.data})}catch(a){"authentication_failed"===a.code&&i.default.notify({type:"error",message:k("error.invalidEmailOrPassword",{ns:"login"})})}finally{F(!1)}};return(0,b.jsxs)("form",{onSubmit:v.noop,children:[(0,b.jsxs)("div",{className:"mb-3",children:[(0,b.jsx)("label",{htmlFor:"email",className:"system-md-semibold my-2 text-text-secondary",children:k("email",{ns:"login"})}),(0,b.jsx)("div",{className:"mt-1",children:(0,b.jsx)(r.default,{value:A,onChange:a=>B(a.target.value),disabled:a,id:"email",type:"email",autoComplete:"email",placeholder:k("emailPlaceholder",{ns:"login"})||"",tabIndex:1})})]}),(0,b.jsxs)("div",{className:"mb-3",children:[(0,b.jsxs)("label",{htmlFor:"password",className:"my-2 flex items-center justify-between",children:[(0,b.jsx)("span",{className:"system-md-semibold text-text-secondary",children:k("password",{ns:"login"})}),(0,b.jsx)(g.default,{href:`/reset-password?${o.toString()}`,className:`system-xs-regular ${e?"text-components-button-secondary-accent-text":"pointer-events-none text-components-button-secondary-accent-text-disabled"}`,tabIndex:e?0:-1,"aria-disabled":!e,children:k("forget",{ns:"login"})})]}),(0,b.jsxs)("div",{className:"relative mt-1",children:[(0,b.jsx)(r.default,{id:"password",value:C,onChange:a=>D(a.target.value),onKeyDown:a=>{"Enter"===a.key&&G()},type:p?"text":"password",autoComplete:"current-password",placeholder:k("passwordPlaceholder",{ns:"login"})||"",tabIndex:2}),(0,b.jsx)("div",{className:"absolute inset-y-0 right-0 flex items-center",children:(0,b.jsx)(q.default,{type:"button",variant:"ghost",onClick:()=>s(!p),children:p?"ðŸ‘€":"ðŸ˜"})})]})]}),(0,b.jsx)("div",{className:"mb-2",children:(0,b.jsx)(q.default,{tabIndex:2,variant:"primary",onClick:G,disabled:E||!A||!C,className:"w-full",children:k("signBtn",{ns:"login"})})})]})}var B=a.i(459858),C=a.i(425422);function D(a){let{t:d}=(0,h.useTranslation)(),e=(0,c.useSearchParams)(),f=a=>{let b=(0,B.getPurifyHref)(`${j.API_PREFIX}${a}`);return e.has("invite_token")?`${b}?${e.toString()}`:b};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"w-full",children:(0,b.jsx)("a",{href:f("/oauth/login/github"),children:(0,b.jsx)(q.default,{disabled:a.disabled,className:"w-full",children:(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{className:(0,o.cn)(C.default.githubIcon,"mr-2 h-5 w-5")}),(0,b.jsx)("span",{className:"truncate leading-normal",children:d("withGitHub",{ns:"login"})})]})})})}),(0,b.jsx)("div",{className:"w-full",children:(0,b.jsx)("a",{href:f("/oauth/login/google"),children:(0,b.jsx)(q.default,{disabled:a.disabled,className:"w-full",children:(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{className:(0,o.cn)(C.default.googleIcon,"mr-2 h-5 w-5")}),(0,b.jsx)("span",{className:"truncate leading-normal",children:d("withGoogle",{ns:"login"})})]})})})})]})}a.i(363731);var E=a.i(187385),F=a.i(41511);let G=({protocol:a})=>{let e=(0,c.useRouter)(),{t:f}=(0,h.useTranslation)(),g=decodeURIComponent((0,c.useSearchParams)().get("invite_token")||""),[j,k]=(0,d.useState)(!1);return(0,b.jsxs)(q.default,{tabIndex:0,onClick:()=>{(()=>{if(k(!0),a===n.SSOProtocol.SAML){let a;(a=g?`/enterprise/sso/saml/login?invite_token=${g}`:"/enterprise/sso/saml/login",(0,F.get)(a)).then(a=>{e.push(a.url)}).finally(()=>{k(!1)})}else if(a===n.SSOProtocol.OIDC){let a;(a=g?`/enterprise/sso/oidc/login?invite_token=${g}`:"/enterprise/sso/oidc/login",(0,F.get)(a)).then(a=>{document.cookie=`user-oidc-state=${a.state};Path=/`,e.push(a.url)}).finally(()=>{k(!1)})}else if(a===n.SSOProtocol.OAuth2){let a;(a=g?`/enterprise/sso/oauth2/login?invite_token=${g}`:"/enterprise/sso/oauth2/login",(0,F.get)(a)).then(a=>{document.cookie=`user-oauth2-state=${a.state};Path=/`,e.push(a.url)}).finally(()=>{k(!1)})}else i.default.notify({type:"error",message:"invalid SSO protocol"}),k(!1)})()},disabled:j,className:"w-full",children:[(0,b.jsx)(E.Lock01,{className:"mr-2 h-5 w-5 text-text-accent-light-mode-only"}),(0,b.jsx)("span",{className:"truncate",children:f("withSSO",{ns:"login"})})]})};var H=a.i(191333);let I=()=>{let{t:a}=(0,h.useTranslation)(),e=(0,c.useRouter)(),q=(0,c.useSearchParams)(),{isLoading:r,data:s}=(0,m.useIsLogin)(),t=s?.logged_in,v=decodeURIComponent(q.get("message")||""),w=decodeURIComponent(q.get("invite_token")||""),[x,y]=(0,d.useState)(!0),[B,C]=(0,d.useState)(!1),{systemFeatures:E}=(0,k.useGlobalPublicStore)(),[F,I]=(0,d.useState)("password"),[J,K]=(0,d.useState)(!1),[L,M]=(0,d.useState)(!1),[N,O]=(0,d.useState)(""),P=!!(w&&"null"!==w),Q=(0,d.useCallback)(async()=>{try{if(t){C(!0);let a=(0,z.resolvePostLoginRedirect)(q);e.replace(a||"/apps");return}if(v&&i.default.notify({type:"error",message:v}),M(!E.enable_social_oauth_login&&!E.enable_email_code_login&&!E.enable_email_password_login&&!E.sso_enforced_for_signin),K((E.enable_social_oauth_login||E.sso_enforced_for_signin)&&(E.enable_email_code_login||E.enable_email_password_login)),I(E.enable_email_password_login?"password":"code"),P){let a=await (0,l.invitationCheck)({url:"/activate/check",params:{token:w}});O(a?.data?.workspace_name||"")}}catch(a){console.error(a),M(!0)}finally{y(!1)}},[t,v,e,w,P,E]);return((0,d.useEffect)(()=>{Q()},[Q]),r||x||B)?(0,b.jsx)("div",{className:(0,o.cn)("flex w-full grow flex-col items-center justify-center","px-6","md:px-[108px]"),children:(0,b.jsx)(p.default,{type:"area"})}):E.license?.status===n.LicenseStatus.LOST?(0,b.jsx)("div",{className:"mx-auto mt-8 w-full",children:(0,b.jsx)("div",{className:"relative",children:(0,b.jsxs)("div",{className:"rounded-lg bg-gradient-to-r from-workflow-workflow-progress-bg-1 to-workflow-workflow-progress-bg-2 p-4",children:[(0,b.jsxs)("div",{className:"shadows-shadow-lg relative mb-2 flex h-10 w-10 items-center justify-center rounded-xl bg-components-card-bg shadow",children:[(0,b.jsx)(f.RiContractLine,{className:"h-5 w-5"}),(0,b.jsx)(f.RiErrorWarningFill,{className:"absolute -right-1 -top-1 h-4 w-4 text-text-warning-secondary"})]}),(0,b.jsx)("p",{className:"system-sm-medium text-text-primary",children:a("licenseLost",{ns:"login"})}),(0,b.jsx)("p",{className:"system-xs-regular mt-1 text-text-tertiary",children:a("licenseLostTip",{ns:"login"})})]})})}):E.license?.status===n.LicenseStatus.EXPIRED?(0,b.jsx)("div",{className:"mx-auto mt-8 w-full",children:(0,b.jsx)("div",{className:"relative",children:(0,b.jsxs)("div",{className:"rounded-lg bg-gradient-to-r from-workflow-workflow-progress-bg-1 to-workflow-workflow-progress-bg-2 p-4",children:[(0,b.jsxs)("div",{className:"shadows-shadow-lg relative mb-2 flex h-10 w-10 items-center justify-center rounded-xl bg-components-card-bg shadow",children:[(0,b.jsx)(f.RiContractLine,{className:"h-5 w-5"}),(0,b.jsx)(f.RiErrorWarningFill,{className:"absolute -right-1 -top-1 h-4 w-4 text-text-warning-secondary"})]}),(0,b.jsx)("p",{className:"system-sm-medium text-text-primary",children:a("licenseExpired",{ns:"login"})}),(0,b.jsx)("p",{className:"system-xs-regular mt-1 text-text-tertiary",children:a("licenseExpiredTip",{ns:"login"})})]})})}):E.license?.status===n.LicenseStatus.INACTIVE?(0,b.jsx)("div",{className:"mx-auto mt-8 w-full",children:(0,b.jsx)("div",{className:"relative",children:(0,b.jsxs)("div",{className:"rounded-lg bg-gradient-to-r from-workflow-workflow-progress-bg-1 to-workflow-workflow-progress-bg-2 p-4",children:[(0,b.jsxs)("div",{className:"shadows-shadow-lg relative mb-2 flex h-10 w-10 items-center justify-center rounded-xl bg-components-card-bg shadow",children:[(0,b.jsx)(f.RiContractLine,{className:"h-5 w-5"}),(0,b.jsx)(f.RiErrorWarningFill,{className:"absolute -right-1 -top-1 h-4 w-4 text-text-warning-secondary"})]}),(0,b.jsx)("p",{className:"system-sm-medium text-text-primary",children:a("licenseInactive",{ns:"login"})}),(0,b.jsx)("p",{className:"system-xs-regular mt-1 text-text-tertiary",children:a("licenseInactiveTip",{ns:"login"})})]})})}):(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)("div",{className:"mx-auto mt-8 w-full",children:[P?(0,b.jsxs)("div",{className:"mx-auto w-full",children:[(0,b.jsxs)("h2",{className:"title-4xl-semi-bold text-text-primary",children:[a("join",{ns:"login"}),N]}),!E.branding.enabled&&(0,b.jsxs)("p",{className:"body-md-regular mt-2 text-text-tertiary",children:[a("joinTipStart",{ns:"login"}),N,a("joinTipEnd",{ns:"login"})]})]}):(0,b.jsxs)("div",{className:"mx-auto w-full",children:[(0,b.jsx)("h2",{className:"title-4xl-semi-bold text-text-primary",children:a(E.branding.enabled?"pageTitleForE":"pageTitle",{ns:"login"})}),(0,b.jsx)("p",{className:"body-md-regular mt-2 text-text-tertiary",children:a("welcome",{ns:"login"})})]}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsxs)("div",{className:"mt-6 flex flex-col gap-3",children:[E.enable_social_oauth_login&&(0,b.jsx)(D,{}),E.sso_enforced_for_signin&&(0,b.jsx)("div",{className:"w-full",children:(0,b.jsx)(G,{protocol:E.sso_enforced_for_signin_protocol})})]}),J&&(0,b.jsx)("div",{className:"relative mt-6",children:(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)("div",{className:"h-px flex-1 bg-gradient-to-r from-background-gradient-mask-transparent to-divider-regular"}),(0,b.jsx)("span",{className:"system-xs-medium-uppercase px-3 text-text-tertiary",children:a("or",{ns:"login"})}),(0,b.jsx)("div",{className:"h-px flex-1 bg-gradient-to-l from-background-gradient-mask-transparent to-divider-regular"})]})}),(E.enable_email_code_login||E.enable_email_password_login)&&(0,b.jsxs)(b.Fragment,{children:[E.enable_email_code_login&&"code"===F&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(u,{isInvite:P}),E.enable_email_password_login&&(0,b.jsx)("div",{className:"cursor-pointer py-1 text-center",onClick:()=>{I("password")},children:(0,b.jsx)("span",{className:"system-xs-medium text-components-button-secondary-accent-text",children:a("usePassword",{ns:"login"})})})]}),E.enable_email_password_login&&"password"===F&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(A,{isInvite:P,isEmailSetup:E.is_email_setup,allowRegistration:E.is_allow_register}),E.enable_email_code_login&&(0,b.jsx)("div",{className:"cursor-pointer py-1 text-center",onClick:()=>{I("code")},children:(0,b.jsx)("span",{className:"system-xs-medium text-components-button-secondary-accent-text",children:a("useVerificationCode",{ns:"login"})})})]}),(0,b.jsx)(H.default,{className:"mb-5 mt-4"})]}),E.is_allow_register&&"password"===F&&(0,b.jsxs)("div",{className:"mb-3 text-[13px] font-medium leading-4 text-text-secondary",children:[(0,b.jsx)("span",{children:a("signup.noAccount",{ns:"login"})}),(0,b.jsx)(g.default,{className:"text-text-accent",href:"/signup",children:a("signup.signUp",{ns:"login"})})]}),L&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"rounded-lg bg-gradient-to-r from-workflow-workflow-progress-bg-1 to-workflow-workflow-progress-bg-2 p-4",children:[(0,b.jsx)("div",{className:"shadows-shadow-lg mb-2 flex h-10 w-10 items-center justify-center rounded-xl bg-components-card-bg shadow",children:(0,b.jsx)(f.RiDoorLockLine,{className:"h-5 w-5"})}),(0,b.jsx)("p",{className:"system-sm-medium text-text-primary",children:a("noLoginMethod",{ns:"login"})}),(0,b.jsx)("p",{className:"system-xs-regular mt-1 text-text-tertiary",children:a("noLoginMethodTip",{ns:"login"})})]}),(0,b.jsx)("div",{className:"relative my-2 py-2",children:(0,b.jsx)("div",{className:"absolute inset-0 flex items-center","aria-hidden":"true",children:(0,b.jsx)("div",{className:"h-px w-full bg-gradient-to-r from-background-gradient-mask-transparent via-divider-regular to-background-gradient-mask-transparent"})})})]}),!E.branding.enabled&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"system-xs-regular mt-2 block w-full text-text-tertiary",children:[a("tosDesc",{ns:"login"}),"Â ",(0,b.jsx)(g.default,{className:"system-xs-medium text-text-secondary hover:underline",target:"_blank",rel:"noopener noreferrer",href:"https://dify.ai/terms",children:a("tos",{ns:"login"})}),"Â &Â ",(0,b.jsx)(g.default,{className:"system-xs-medium text-text-secondary hover:underline",target:"_blank",rel:"noopener noreferrer",href:"https://dify.ai/privacy",children:a("pp",{ns:"login"})})]}),j.IS_CE_EDITION&&(0,b.jsxs)("div",{className:"w-hull system-xs-regular mt-2 block text-text-tertiary",children:[a("goToInit",{ns:"login"}),"Â ",(0,b.jsx)(g.default,{className:"system-xs-medium text-text-secondary hover:underline",href:"/install",children:a("setAdminAccount",{ns:"login"})})]})]})]})]})})};var J=a.i(805611),K=a.i(483664),L=a.i(185469),M=a.i(136403),N=a.i(493845);let O=(a,b)=>{switch(b.type){case"invitation_code":return{...a,invitation_code:b.value};case"interface_language":return{...a,interface_language:b.value};case"timezone":return{...a,timezone:b.value};case"failed":return{invitation_code:"",interface_language:"en-US",timezone:"Asia/Shanghai"};default:throw Error("Unknown action.")}},P=()=>{let{t:a}=(0,h.useTranslation)(),e=(0,c.useRouter)(),f=(0,c.useSearchParams)(),[j,k]=(0,d.useReducer)(O,{invitation_code:f.get("invitation_code")||"",interface_language:"en-US",timezone:"Asia/Shanghai"}),{mutateAsync:l,isPending:n}=(0,m.useOneMoreStep)(),o=async()=>{if(!n)try{await l({invitation_code:j.invitation_code,interface_language:j.interface_language,timezone:j.timezone}),e.push("/apps")}catch(b){b&&400===b.status&&i.default.notify({type:"error",message:a("invalidInvitationCode",{ns:"login"})}),k({type:"failed",payload:null})}};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"mx-auto w-full",children:[(0,b.jsx)("h2",{className:"title-4xl-semi-bold text-text-secondary",children:a("oneMoreStep",{ns:"login"})}),(0,b.jsx)("p",{className:"body-md-regular mt-1 text-text-tertiary",children:a("createSample",{ns:"login"})})]}),(0,b.jsx)("div",{className:"mx-auto mt-6 w-full",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsxs)("div",{className:"mb-5",children:[(0,b.jsxs)("label",{className:"system-md-semibold my-2 flex items-center justify-between text-text-secondary",children:[a("invitationCode",{ns:"login"}),(0,b.jsx)(K.default,{popupContent:(0,b.jsxs)("div",{className:"w-[256px] text-xs font-medium",children:[(0,b.jsx)("div",{className:"font-medium",children:a("sendUsMail",{ns:"login"})}),(0,b.jsx)("div",{className:"cursor-pointer text-xs font-medium text-text-accent-secondary",children:(0,b.jsx)("a",{href:"mailto:request-invitation@langgenius.ai",children:"request-invitation@langgenius.ai"})})]}),children:(0,b.jsx)("span",{className:"cursor-pointer text-text-accent-secondary",children:a("dontHave",{ns:"login"})})})]}),(0,b.jsx)("div",{className:"mt-1",children:(0,b.jsx)(r.default,{id:"invitation_code",value:j.invitation_code,type:"text",placeholder:a("invitationCodePlaceholder",{ns:"login"})||"",onChange:a=>{k({type:"invitation_code",value:a.target.value.trim()})}})})]}),(0,b.jsxs)("div",{className:"mb-5",children:[(0,b.jsx)("label",{htmlFor:"name",className:"system-md-semibold my-2 text-text-secondary",children:a("interfaceLanguage",{ns:"login"})}),(0,b.jsx)("div",{className:"mt-1",children:(0,b.jsx)(J.SimpleSelect,{defaultValue:M.LanguagesSupported[0],items:M.languages.filter(a=>a.supported),onSelect:a=>{k({type:"interface_language",value:a.value})}})})]}),(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsx)("label",{htmlFor:"timezone",className:"system-md-semibold text-text-tertiary",children:a("timezone",{ns:"login"})}),(0,b.jsx)("div",{className:"mt-1",children:(0,b.jsx)(J.SimpleSelect,{defaultValue:j.timezone,items:N.timezones,onSelect:a=>{k({type:"timezone",value:a.value})}})})]}),(0,b.jsx)("div",{children:(0,b.jsx)(q.default,{variant:"primary",className:"w-full",disabled:n,onClick:o,children:a("go",{ns:"login"})})}),(0,b.jsxs)("div",{className:"system-xs-regular mt-2 block w-full text-text-tertiary",children:[a("license.tip",{ns:"login"}),"Â ",(0,b.jsx)(g.default,{className:"system-xs-medium text-text-accent-secondary",target:"_blank",rel:"noopener noreferrer",href:L.LICENSE_LINK,children:a("license.link",{ns:"login"})})]})]})})]})};a.s(["default",0,()=>{let a=(0,c.useSearchParams)().get("step"),{saveOrUpdate:f}=(0,e.default)();return((0,d.useEffect)(()=>{f()},[]),"next"===a)?(0,b.jsx)(P,{}):(0,b.jsx)(I,{})}],42099)}];

//# sourceMappingURL=app_signin_175086d5._.js.map
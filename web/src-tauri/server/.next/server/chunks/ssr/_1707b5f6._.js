module.exports=[93572,a=>{a.v({item:"style-module__2BvUtq__item"})},568440,a=>{a.v({boxHeader:"style-module__ONpVgG__boxHeader",gradientBorder:"style-module__ONpVgG__gradientBorder",optionWrap:"style-module__ONpVgG__optionWrap",warningBorder:"style-module__ONpVgG__warningBorder"})},96250,a=>{a.v({icon:"style-module__Sq5rSW__icon",mask:"style-module__Sq5rSW__mask"})},351117,271364,536799,55465,a=>{"use strict";var b=a.i(249839),c=a.i(654718);function d(a){if((0,b.isPrimitive)(a))return a;if(Array.isArray(a)||(0,c.isTypedArray)(a)||a instanceof ArrayBuffer||"u">typeof SharedArrayBuffer&&a instanceof SharedArrayBuffer)return a.slice(0);let d=Object.getPrototypeOf(a),e=d.constructor;if(a instanceof Date||a instanceof Map||a instanceof Set)return new e(a);if(a instanceof RegExp){let b=new e(a);return b.lastIndex=a.lastIndex,b}if(a instanceof DataView)return new e(a.buffer.slice(0));if(a instanceof Error){let b=new e(a.message);return b.stack=a.stack,b.name=a.name,b.cause=a.cause,b}return"u">typeof File&&a instanceof File?new e([a],a.name,{type:a.type,lastModified:a.lastModified}):"object"==typeof a?Object.assign(Object.create(d),a):a}a.s(["clone",()=>d],351117);var e=a.i(608061),f=a.i(494261),g=a.i(57843),h=a.i(639378),i=a.i(429150);a.i(752298);var j=a.i(693025),k=a.i(497746),l=a.i(875067),m=a.i(188405),n=a.i(42550),o=a.i(114715),p=a.i(483664),q=a.i(735310),r=a.i(120179),s=a.i(124116),t=a.i(29255),u=a.i(954200),v=a.i(527344),w=a.i(499257);let x=g.memo(({className:a,headerIcon:b,title:c,headerRight:d,hasHeaderBottomBorder:f,noBodySpacing:g,children:h})=>(0,e.jsxs)("div",{className:(0,v.cn)("rounded-xl border-l-[0.5px] border-t-[0.5px] border-effects-highlight bg-background-section-burn pb-3",g&&"pb-0",a),children:[(0,e.jsx)("div",{className:(0,v.cn)("px-3 pt-2",f&&"border-b border-divider-subtle"),"data-testid":"feature-panel-header",children:(0,e.jsxs)("div",{className:"flex h-8 items-center justify-between",children:[(0,e.jsxs)("div",{className:"flex shrink-0 items-center space-x-1",children:[!!b&&(0,e.jsx)("div",{className:"flex h-6 w-6 items-center justify-center",children:b}),(0,e.jsx)("div",{className:"system-sm-semibold text-text-secondary",children:c})]}),(0,e.jsx)("div",{className:"flex items-center gap-2",children:!!d&&(0,e.jsx)("div",{children:d})})]})}),!!h&&(0,e.jsx)("div",{className:(0,v.cn)(!g&&"mt-1 px-3"),"data-testid":"feature-panel-body",children:h})]}));var y=a.i(414622),z=a.i(111089);let A={add:(0,e.jsx)(i.RiAddLine,{className:"h-3.5 w-3.5"}),edit:(0,e.jsx)(i.RiEditLine,{className:"h-3.5 w-3.5"})},B=g.memo(({className:a,type:b,actionName:c,onClick:d=z.noop})=>{let{t:f}=(0,j.useTranslation)();return(0,e.jsxs)("div",{className:(0,v.cn)("flex h-7 cursor-pointer select-none items-center space-x-1 rounded-md px-3 text-text-secondary hover:bg-state-base-hover",a),onClick:d,children:[(0,e.jsx)("div",{children:A[b]}),(0,e.jsx)("div",{className:"text-xs font-medium",children:c||f(`operation.${b}`,{ns:"common"})})]})});a.i(805980);var C=a.i(879778),C=C,D=a.i(825319),E=a.i(492010);let F=({text:a,type:b,value:c,Icon:d,onClick:f})=>(0,e.jsxs)("div",{className:"flex h-8 cursor-pointer items-center rounded-lg px-3 hover:bg-state-base-hover",onClick:()=>f(c),children:[d?(0,e.jsx)(d,{className:"h-4 w-4 text-text-secondary"}):(0,e.jsx)(E.default,{type:b,className:"h-4 w-4 text-text-secondary"}),(0,e.jsx)("div",{className:"ml-2 truncate text-xs text-text-primary",children:a})]}),G=g.memo(({onChange:a})=>{let{t:b}=(0,j.useTranslation)(),[c,d]=(0,g.useState)(!1),f=b=>{a(b),d(!1)};return(0,e.jsxs)(D.PortalToFollowElem,{open:c,onOpenChange:d,placement:"bottom-end",offset:{mainAxis:8,crossAxis:-2},children:[(0,e.jsx)(D.PortalToFollowElemTrigger,{onClick:()=>d(a=>!a),children:(0,e.jsx)(B,{type:"add"})}),(0,e.jsx)(D.PortalToFollowElemContent,{style:{zIndex:1e3},children:(0,e.jsxs)("div",{className:"min-w-[192px] rounded-lg border border-components-panel-border bg-components-panel-bg-blur shadow-lg backdrop-blur-sm",children:[(0,e.jsxs)("div",{className:"p-1",children:[(0,e.jsx)(F,{type:q.InputVarType.textInput,value:"string",text:b("variableConfig.string",{ns:"appDebug"}),onClick:f}),(0,e.jsx)(F,{type:q.InputVarType.paragraph,value:"paragraph",text:b("variableConfig.paragraph",{ns:"appDebug"}),onClick:f}),(0,e.jsx)(F,{type:q.InputVarType.select,value:"select",text:b("variableConfig.select",{ns:"appDebug"}),onClick:f}),(0,e.jsx)(F,{type:q.InputVarType.number,value:"number",text:b("variableConfig.number",{ns:"appDebug"}),onClick:f}),(0,e.jsx)(F,{type:q.InputVarType.checkbox,value:"checkbox",text:b("variableConfig.checkbox",{ns:"appDebug"}),onClick:f})]}),(0,e.jsx)("div",{className:"h-px border-t border-components-panel-border"}),(0,e.jsx)("div",{className:"p-1",children:(0,e.jsx)(F,{Icon:C.default,value:"api",text:b("variableConfig.apiBasedVar",{ns:"appDebug"}),onClick:f})})]})})]})});var H=a.i(218865);a.i(290384);var I=a.i(526688),C=C;let J=g.memo(({type:a,className:b})=>{let c;return c=`w-3.5 h-3.5 ${b}`,({string:(0,e.jsx)(E.default,{type:q.InputVarType.textInput,className:c}),paragraph:(0,e.jsx)(E.default,{type:q.InputVarType.paragraph,className:c}),select:(0,e.jsx)(E.default,{type:q.InputVarType.select,className:c}),number:(0,e.jsx)(E.default,{type:q.InputVarType.number,className:c}),api:(0,e.jsx)(C.default,{className:c})})[a]}),K=({className:a,readonly:b,name:c,label:d,required:f,type:h,onEdit:j,onRemove:k,canDrag:l})=>{let[m,n]=(0,g.useState)(!1);return(0,e.jsxs)("div",{className:(0,v.cn)("group relative mb-1 flex h-[34px] w-full items-center rounded-lg border-[0.5px] border-components-panel-border-subtle bg-components-panel-on-panel-item-bg pl-2.5 pr-3 shadow-xs last-of-type:mb-0 hover:bg-components-panel-on-panel-item-bg-hover hover:shadow-sm",m&&"border-state-destructive-border hover:bg-state-destructive-hover",b&&"cursor-not-allowed",a),children:[(0,e.jsx)(I.BracketsX,{className:(0,v.cn)("mr-1 h-4 w-4 shrink-0 text-text-accent",l&&"group-hover:opacity-0")}),l&&(0,e.jsx)(i.RiDraggable,{className:"absolute left-3 top-3 hidden h-3 w-3 cursor-pointer text-text-tertiary group-hover:block"}),(0,e.jsx)("div",{className:"flex w-0 grow items-center",children:(0,e.jsxs)("div",{className:"truncate",title:`${c} \xb7 ${d}`,children:[(0,e.jsx)("span",{className:"system-sm-medium text-text-secondary",children:c}),(0,e.jsx)("span",{className:"system-xs-regular px-1 text-text-quaternary",children:"Â·"}),(0,e.jsx)("span",{className:"system-xs-medium text-text-tertiary",children:d})]})}),(0,e.jsxs)("div",{className:"shrink-0",children:[(0,e.jsxs)("div",{className:(0,v.cn)("flex items-center",!b&&"group-hover:hidden"),children:[f&&(0,e.jsx)(H.default,{text:"required"}),(0,e.jsx)("span",{className:"system-xs-regular pl-2 pr-1 text-text-tertiary",children:h}),(0,e.jsx)(J,{type:h,className:"text-text-tertiary"})]}),(0,e.jsxs)("div",{className:(0,v.cn)("hidden items-center justify-end rounded-lg",!b&&"group-hover:flex"),children:[(0,e.jsx)("div",{className:"mr-1 flex h-6 w-6 cursor-pointer items-center justify-center rounded-md hover:bg-black/5",onClick:j,children:(0,e.jsx)(i.RiEditLine,{className:"h-4 w-4 text-text-tertiary"})}),(0,e.jsx)("div",{"data-testid":"var-item-delete-btn",className:"flex h-6 w-6 cursor-pointer items-center  justify-center text-text-tertiary hover:text-text-destructive",onClick:k,onMouseOver:()=>n(!0),onMouseLeave:()=>n(!1),children:(0,e.jsx)(i.RiDeleteBinLine,{className:"h-4 w-4"})})]})]})]})},L="ADD_EXTERNAL_DATA_TOOL",M=new Set(["string","paragraph","select","number","checkbox"]),N=g.memo(({promptVariables:a,readonly:b,onPromptVariablesChange:c})=>{let{t:d}=(0,j.useTranslation)(),{mode:i,dataSets:l}=(0,h.useContext)(r.default),{eventEmitter:z}=(0,s.useEventEmitterContextContext)(),A=a.length>0,[B,C]=(0,g.useState)(-1),D=-1!==B?a[B]:null,E=(0,g.useMemo)(()=>D?{...D,label:D.name,variable:D.key,type:"string"===D.type?q.InputVarType.textInput:D.type,required:D.required??!1}:null,[D]),F=(0,g.useCallback)(b=>{let e=(0,f.produce)(a,a=>{a[B]=(a=>{let{variable:b,label:c,type:d,...e}=a,f=d===q.InputVarType.textInput?"string":d,g={...e,type:f,key:b,name:c};return a.type!==q.InputVarType.select&&delete g.options,g})(b)}),g=(0,w.hasDuplicateStr)(e.map(a=>a.key))?{errorMsgKey:"varKeyError.keyAlreadyExists",typeName:"variableConfig.varName"}:(0,w.hasDuplicateStr)(e.map(a=>a.name))?{errorMsgKey:"varKeyError.keyAlreadyExists",typeName:"variableConfig.labelName"}:null;return g?(o.default.notify({type:"error",message:d(g.errorMsgKey,{ns:"appDebug",key:d(g.typeName,{ns:"appDebug"})})}),!1):(c?.(e),!0)},[B,c,a,d]),{setShowExternalDataToolModal:H}=(0,t.useModalContext)(),I=(0,g.useCallback)(({key:b,type:e,index:f,name:g,config:h,icon:i,icon_background:j},k)=>{H({payload:{type:e,variable:b,label:g,config:h,icon:i,icon_background:j},onSaveCallback:a=>{if(!a)return;let b=k.map((b,c)=>c===f?{key:a.variable,name:a.label,enabled:a.enabled,type:a.type,config:a.config,required:b.required,icon:a.icon,icon_background:a.icon_background}:b);c?.(b)},onCancelCallback:()=>{b||c?.(a.filter((a,b)=>b!==f))},onValidateBeforeSaveCallback:b=>{for(let c=0;c<a.length;c++)if(a[c].key===b.variable&&c!==f)return o.default.notify({type:"error",message:d("varKeyError.keyAlreadyExists",{ns:"appDebug",key:a[c].key})}),!1;return!0}})},[c,a,H,d]),J=(0,g.useCallback)(b=>{let d=(0,w.getNewVar)("",b),e=[...a,d];c?.(e),"api"===b&&I({type:b,key:d.key,name:d.name,index:a.length},e)},[I,c,a]);z?.useSubscription(b=>{if(b.type===L){let d=b.payload;c?.([...a,{key:d.variable,name:d.label,enabled:d.enabled,type:d.type,config:d.config,required:!0,icon:d.icon,icon_background:d.icon_background}])}});let[N,{setTrue:O,setFalse:P}]=(0,k.useBoolean)(!1),[Q,R]=(0,g.useState)(null),S=(0,g.useCallback)(b=>{c?.(a.filter((a,c)=>c!==b))},[c,a]),T=(0,g.useCallback)(b=>{let c=a[b];if(i===u.AppModeEnum.COMPLETION&&l.length>0&&c.is_context_var){O(),R(b);return}S(b)},[l.length,S,i,a,O]),[U,{setTrue:V,setFalse:W}]=(0,k.useBoolean)(!1),X=(0,g.useCallback)(({key:b,type:c,index:d,name:e,config:f,icon:g,icon_background:h})=>{(C(d),M.has(c))?V():I({key:b,type:c,index:d,name:e,config:f,icon:g,icon_background:h},a)},[I,a,V]),Y=(0,g.useMemo)(()=>a.map(a=>({id:a.key,variable:{...a}})),[a]),Z=!b&&a.length>1;return(0,e.jsxs)(x,{className:"mt-2",title:(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)("div",{className:"mr-1",children:d("variableTitle",{ns:"appDebug"})}),!b&&(0,e.jsx)(p.default,{popupContent:(0,e.jsx)("div",{className:"w-[180px]",children:d("variableTip",{ns:"appDebug"})})})]}),headerRight:b?null:(0,e.jsx)(G,{onChange:J}),noBodySpacing:!0,children:[!A&&(0,e.jsx)("div",{className:"mt-1 px-3 pb-3",children:(0,e.jsx)("div",{className:"pb-1 pt-2 text-xs text-text-tertiary",children:d("notSetVar",{ns:"appDebug"})})}),A&&(0,e.jsx)("div",{className:(0,v.cn)("mt-1 grid px-3 pb-3"),children:(0,e.jsx)(m.ReactSortable,{className:(0,v.cn)("grid-col-1 grid space-y-1",b&&"grid-cols-2 gap-1 space-y-0"),list:Y,setList:a=>{c?.(a.map(a=>a.variable))},handle:".handle",ghostClass:"opacity-50",animation:150,children:Y.map((a,c)=>{let{key:d,name:f,type:g,required:h,config:i,icon:j,icon_background:k}=a.variable;return(0,e.jsx)(K,{className:(0,v.cn)(Z&&"handle"),readonly:b,name:d,label:f,required:!!h,type:g,onEdit:()=>X({type:g,key:d,index:c,name:f,config:i,icon:j,icon_background:k}),onRemove:()=>T(c),canDrag:Z},d)})})}),U&&(0,e.jsx)(y.default,{payload:E,isShow:U,onClose:W,onConfirm:a=>{F(a)&&W()},varKeys:a.map(a=>a.key)}),N&&(0,e.jsx)(n.default,{isShow:N,title:d("feature.dataSet.queryVariable.deleteContextVarTitle",{ns:"appDebug",varName:a[Q]?.name}),content:d("feature.dataSet.queryVariable.deleteContextVarTip",{ns:"appDebug"}),onConfirm:()=>{S(Q),P()},onCancel:P})]})});var O=a.i(909795);a.i(849888);var P=a.i(134579),Q=a.i(547252),R=a.i(76284),S=a.i(796264),T=a.i(93572);let U=g.memo(({name:a,className:b=""})=>(0,e.jsxs)("div",{className:`${T.default.item} ${b} mb-2 inline-flex h-5 items-center justify-center rounded-md px-1 text-xs font-medium text-primary-600`,children:[(0,e.jsx)("span",{className:"opacity-60",children:"{{"}),(0,e.jsx)("span",{children:a}),(0,e.jsx)("span",{className:"opacity-60",children:"}}"})]},a)),V=(0,e.jsxs)("svg",{width:"16",height:"14",viewBox:"0 0 16 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,e.jsx)("path",{d:"M13.8683 0.704745C13.7051 0.374685 13.3053 0.239393 12.9752 0.402563C12.6452 0.565732 12.5099 0.965573 12.673 1.29563C13.5221 3.01316 13.9999 4.94957 13.9999 7.00019C13.9999 9.05081 13.5221 10.9872 12.673 12.7047C12.5099 13.0348 12.6452 13.4346 12.9752 13.5978C13.3053 13.761 13.7051 13.6257 13.8683 13.2956C14.8063 11.3983 15.3333 9.26009 15.3333 7.00019C15.3333 4.74029 14.8063 2.60209 13.8683 0.704745Z",fill:"#FD853A"}),(0,e.jsx)("path",{d:"M3.32687 1.29563C3.49004 0.965573 3.35475 0.565732 3.02469 0.402563C2.69463 0.239393 2.29479 0.374685 2.13162 0.704745C1.19364 2.60209 0.666626 4.74029 0.666626 7.00019C0.666626 9.26009 1.19364 11.3983 2.13162 13.2956C2.29479 13.6257 2.69463 13.761 3.02469 13.5978C3.35475 13.4346 3.49004 13.0348 3.32687 12.7047C2.47779 10.9872 1.99996 9.05081 1.99996 7.00019C1.99996 4.94957 2.47779 3.01316 3.32687 1.29563Z",fill:"#FD853A"}),(0,e.jsx)("path",{d:"M9.33238 4.8413C9.74208 4.36081 10.3411 4.08337 10.9726 4.08337H11.0324C11.4006 4.08337 11.6991 4.38185 11.6991 4.75004C11.6991 5.11823 11.4006 5.41671 11.0324 5.41671H10.9726C10.7329 5.41671 10.5042 5.52196 10.347 5.7064L8.78693 7.536L9.28085 9.27382C9.29145 9.31112 9.32388 9.33337 9.35696 9.33337H10.2864C10.6545 9.33337 10.953 9.63185 10.953 10C10.953 10.3682 10.6545 10.6667 10.2864 10.6667H9.35696C8.72382 10.6667 8.17074 10.245 7.99832 9.63834L7.74732 8.75524L6.76373 9.90878C6.35403 10.3893 5.75501 10.6667 5.1235 10.6667H5.06372C4.69553 10.6667 4.39705 10.3682 4.39705 10C4.39705 9.63185 4.69553 9.33337 5.06372 9.33337H5.1235C5.3632 9.33337 5.59189 9.22812 5.74915 9.04368L7.30926 7.21399L6.81536 5.47626C6.80476 5.43897 6.77233 5.41671 6.73925 5.41671H5.80986C5.44167 5.41671 5.14319 5.11823 5.14319 4.75004C5.14319 4.38185 5.44167 4.08337 5.80986 4.08337H6.73925C7.37239 4.08337 7.92547 4.50508 8.0979 5.11174L8.34887 5.99475L9.33238 4.8413Z",fill:"#FD853A"})]}),W=g.memo(({varNameArr:a,onConfirm:b,onCancel:c})=>{let{t:d}=(0,j.useTranslation)(),f=(0,g.useRef)(null);return(0,e.jsx)("div",{className:"absolute inset-0  flex items-center justify-center rounded-xl",style:{backgroundColor:"rgba(35, 56, 118, 0.2)"},children:(0,e.jsxs)("div",{ref:f,className:"w-[420px] rounded-xl bg-components-panel-bg p-6",style:{boxShadow:"0px 12px 16px -4px rgba(16, 24, 40, 0.08), 0px 4px 6px -2px rgba(16, 24, 40, 0.03)"},children:[(0,e.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,e.jsx)("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-xl border border-components-card-border bg-components-card-bg-alt shadow-lg",children:V}),(0,e.jsxs)("div",{className:"grow-1",children:[(0,e.jsx)("div",{className:"text-sm font-medium text-text-primary",children:d("autoAddVar",{ns:"appDebug"})}),(0,e.jsx)("div",{className:"mt-[15px] flex max-h-[66px] flex-wrap space-x-1 overflow-y-auto px-1",children:a.map(a=>(0,e.jsx)(U,{name:a},a))})]})]}),(0,e.jsxs)("div",{className:"mt-7 flex justify-end space-x-2",children:[(0,e.jsx)(O.default,{onClick:c,children:d("operation.cancel",{ns:"common"})}),(0,e.jsx)(O.default,{variant:"primary",onClick:b,children:d("operation.add",{ns:"common"})})]})]})})});var X=a.i(617633);a.i(943046);var Y=a.i(826009),Z=a.i(158873);let $=[Z.PromptRole.system,Z.PromptRole.user,Z.PromptRole.assistant],_=g.memo(({value:a,onChange:b})=>{let[c,{setFalse:d,toggle:f}]=(0,k.useBoolean)(!1),h=g.useRef(null);return(0,X.useClickAway)(()=>{d()},h),(0,e.jsxs)("div",{className:"relative left-[-8px]",ref:h,children:[(0,e.jsxs)("div",{onClick:f,className:(0,v.cn)(c&&"bg-indigo-100","flex h-7 cursor-pointer items-center space-x-0.5 rounded-lg pl-1.5 pr-1 text-indigo-800"),children:[(0,e.jsx)("div",{className:"text-sm font-semibold uppercase",children:a}),(0,e.jsx)(Y.ChevronSelectorVertical,{className:"h-3 w-3 "})]}),c&&(0,e.jsx)("div",{className:"absolute top-[30px] z-10 rounded-lg border border-components-panel-border bg-components-panel-bg p-1 shadow-lg",children:$.map(a=>(0,e.jsx)("div",{onClick:()=>{d(),b(a)},className:"flex h-9 min-w-[44px] cursor-pointer items-center rounded-lg px-3 text-sm font-medium uppercase text-text-secondary hover:bg-state-base-hover",children:a},a))})]})});var aa=a.i(427228),ab=a.i(568440);let ac=g.memo(({type:a,isChatMode:b,value:c,onChange:d,onTypeChange:m,canDelete:n,onDelete:q,promptVariables:x,isContextMissing:y,onHideContextMissingTip:z,noResize:A})=>{let B,{t:C}=(0,j.useTranslation)(),{eventEmitter:D}=(0,s.useEventEmitterContextContext)(),{mode:E,hasSetBlockStatus:F,modelConfig:G,setModelConfig:H,conversationHistoriesRole:I,showHistoryModal:J,dataSets:K,showSelectDataSet:M,externalDataToolsConfig:N}=(0,h.useContext)(r.default),{notify:T}=(0,o.useToastContext)(),{setShowExternalDataToolModal:U}=(0,t.useModalContext)(),V=E!==u.AppModeEnum.COMPLETION,[X,Y]=g.useState(!1),Z=(B={},x.forEach(a=>{B[a.key]=!0}),B),[$,ac]=g.useState(x),[ad,{setTrue:ae,setFalse:af}]=(0,k.useBoolean)(!1),ag=a=>()=>{a&&H((0,f.produce)(G,a=>{a.configs.prompt_variables=[...a.configs.prompt_variables,...$]})),af()},[ah,ai]=g.useState(b?200:508),aj=(0,e.jsxs)("div",{className:"flex h-11 items-center justify-between rounded-tl-xl rounded-tr-xl pb-1 pl-4 pr-3 pt-2",style:{background:"linear-gradient(180deg, #FEF0C7 0%, rgba(254, 240, 199, 0) 100%)"},children:[(0,e.jsxs)("div",{className:"flex items-center pr-2",children:[(0,e.jsx)(i.RiErrorWarningFill,{className:"mr-1 h-4 w-4 text-[#F79009]"}),(0,e.jsx)("div",{className:"text-[13px] font-medium leading-[18px] text-[#DC6803]",children:C("promptMode.contextMissing",{ns:"appDebug"})})]}),(0,e.jsx)(O.default,{size:"small",variant:"secondary-accent",onClick:z,children:C("operation.ok",{ns:"common"})})]});return(0,e.jsxs)("div",{className:`rounded-xl bg-gradient-to-r from-components-input-border-active-prompt-1 to-components-input-border-active-prompt-2 p-0.5 shadow-xs ${!y?"":ab.default.warningBorder}`,children:[(0,e.jsxs)("div",{className:"rounded-xl bg-background-default",children:[y?aj:(0,e.jsxs)("div",{className:(0,v.cn)(ab.default.boxHeader,"flex h-11 items-center justify-between rounded-tl-xl rounded-tr-xl bg-background-default pb-1 pl-4 pr-3 pt-2 hover:shadow-xs"),children:[b?(0,e.jsx)(_,{value:a,onChange:m}):(0,e.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,e.jsx)("div",{className:"text-sm font-semibold uppercase text-indigo-800",children:C("pageTitle.line1",{ns:"appDebug"})}),(0,e.jsx)(p.default,{popupContent:(0,e.jsx)("div",{className:"w-[180px]",children:C("promptTip",{ns:"appDebug"})})})]}),(0,e.jsxs)("div",{className:(0,v.cn)(ab.default.optionWrap,"items-center space-x-1"),children:[n&&(0,e.jsx)(i.RiDeleteBinLine,{onClick:q,className:"h-6 w-6 cursor-pointer p-1 text-text-tertiary"}),X?(0,e.jsx)(Q.CopyCheck,{className:"h-6 w-6 p-1 text-text-tertiary"}):(0,e.jsx)(P.Copy,{className:"h-6 w-6 cursor-pointer p-1 text-text-tertiary",onClick:()=>{(0,l.default)(c),Y(!0)}})]})]}),(0,e.jsx)(aa.default,{className:"min-h-[102px] overflow-y-auto px-4 text-sm text-text-secondary",height:ah,minHeight:102,onHeightChange:ai,footer:(0,e.jsx)("div",{className:"flex pb-2 pl-4",children:(0,e.jsx)("div",{className:"h-[18px] rounded-md bg-divider-regular px-1 text-xs leading-[18px] text-text-tertiary",children:c.length})}),hideResize:A,children:(0,e.jsx)(R.default,{className:"min-h-[84px]",value:c,contextBlock:{show:!0,selectable:!F.context,datasets:K.map(a=>({id:a.id,name:a.name,type:a.data_source_type})),onAddContext:M},variableBlock:{show:!0,variables:G.configs.prompt_variables.filter(a=>"api"!==a.type&&a.key&&a.key.trim()&&a.name&&a.name.trim()).map(a=>({name:a.name,value:a.key}))},externalToolBlock:{externalTools:G.configs.prompt_variables.filter(a=>"api"===a.type).map(a=>({name:a.name,variableName:a.key,icon:a.icon,icon_background:a.icon_background})),onAddExternalTool:()=>{U({payload:{},onSaveCallback:a=>{a&&(D?.emit({type:L,payload:a}),D?.emit({type:S.INSERT_VARIABLE_VALUE_BLOCK_COMMAND,payload:a.variable}))},onValidateBeforeSaveCallback:a=>{for(let b=0;b<x.length;b++)if(x[b].key===a.variable)return T({type:"error",message:C("varKeyError.keyAlreadyExists",{ns:"appDebug",key:x[b].key})}),!1;return!0}})}},historyBlock:{show:!b&&V,selectable:!F.history,history:{user:I?.user_prefix,assistant:I?.assistant_prefix},onEditRole:J},queryBlock:{show:!b&&V,selectable:!F.query},onChange:a=>{c!==a&&d(a)},onBlur:()=>{let a=(0,w.getVars)(c).filter(a=>!(a in Z)&&!N.find(b=>b.variable===a)).map(a=>(0,w.getNewVar)(a,""));a.length>0&&(ac(a),ae())}})})]}),ad&&(0,e.jsx)(W,{varNameArr:$.map(a=>a.name),onConfirm:ag(!0),onCancel:ag(!1),onHide:af})]})});var ad=a.i(18039);let ae=g.memo(({onClick:a})=>{let{t:b}=(0,j.useTranslation)();return(0,e.jsxs)(O.default,{variant:"secondary-accent",size:"small",onClick:a,children:[(0,e.jsx)(i.RiSparklingFill,{className:"mr-1 h-3.5 w-3.5"}),(0,e.jsx)("span",{className:"",children:b("operation.automatic",{ns:"appDebug"})})]})});var af=a.i(359058),ag=a.i(133824),ah=a.i(507131),ai=a.i(585124);let aj=g.memo(({mode:a,promptTemplate:b,promptVariables:c,readonly:d=!1,onChange:i,noTitle:l,editorHeight:m,noResize:n})=>{let{t:q}=(0,j.useTranslation)(),x=(0,ai.default)()===ai.MediaType.mobile,{features:y,setFeatures:A}=(0,ag.useFeaturesStore)().getState(),{eventEmitter:B}=(0,s.useEventEmitterContextContext)(),{appId:C,modelConfig:D,dataSets:E,setModelConfig:F,setPrevPromptConfig:G,setIntroduction:H,hasSetBlockStatus:I,showSelectDataSet:J,externalDataToolsConfig:K}=(0,h.useContext)(r.default),{notify:M}=(0,o.useToastContext)(),{setShowExternalDataToolModal:N}=(0,t.useModalContext)(),[O,P]=g.useState(c),[Q,T]=g.useState(""),[U,{setTrue:V,setFalse:X}]=(0,k.useBoolean)(!1),Y=(a,b)=>{let d=b.filter(a=>{if(K.find(b=>b.variable===a))return!1;let b=c.find(b=>b.key===a);return!b||!b.name||!b.name.trim()||!b.key||!b.key.trim()}).map(a=>(0,w.getNewVar)(a,""));if(d.length>0){P(d),T(a),V();return}i?.(a,[])},Z=a=>()=>{i?.(Q,a?O:[]),X()},[$,{setTrue:_,setFalse:ab}]=(0,k.useBoolean)(!1),ac=m||228,[ad,aj]=(0,g.useState)(ac);return(0,e.jsxs)("div",{className:(0,v.cn)("relative rounded-xl bg-gradient-to-r from-components-input-border-active-prompt-1 to-components-input-border-active-prompt-2 p-0.5 shadow-xs"),children:[(0,e.jsxs)("div",{className:"rounded-xl bg-background-section-burn",children:[!l&&(0,e.jsxs)("div",{className:"flex h-11 items-center justify-between pl-3 pr-2.5",children:[(0,e.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,e.jsx)("div",{className:"h2 system-sm-semibold-uppercase text-text-secondary",children:a!==u.AppModeEnum.COMPLETION?q("chatSubTitle",{ns:"appDebug"}):q("completionSubTitle",{ns:"appDebug"})}),!d&&(0,e.jsx)(p.default,{popupContent:(0,e.jsx)("div",{className:"w-[180px]",children:q("promptTip",{ns:"appDebug"})})})]}),(0,e.jsx)("div",{className:"flex items-center",children:!d&&!x&&(0,e.jsx)(ae,{onClick:_})})]}),(0,e.jsx)(aa.default,{className:"min-h-[228px] rounded-t-xl bg-background-default px-4 pt-2 text-sm text-text-secondary",height:ad,minHeight:ac,onHeightChange:aj,hideResize:n,footer:(0,e.jsx)("div",{className:"flex rounded-b-xl bg-background-default pb-2 pl-4",children:(0,e.jsx)("div",{className:"h-[18px] rounded-md bg-components-badge-bg-gray-soft px-1 text-xs leading-[18px] text-text-tertiary",children:b.length})}),children:(0,e.jsx)(R.default,{className:"min-h-[210px]",compact:!0,value:b,contextBlock:{show:!1,selectable:!I.context,datasets:E.map(a=>({id:a.id,name:a.name,type:a.data_source_type})),onAddContext:J},variableBlock:{show:!0,variables:D.configs.prompt_variables.filter(a=>"api"!==a.type&&a.key&&a.key.trim()&&a.name&&a.name.trim()).map(a=>({name:a.name,value:a.key}))},externalToolBlock:{show:!0,externalTools:D.configs.prompt_variables.filter(a=>"api"===a.type).map(a=>({name:a.name,variableName:a.key,icon:a.icon,icon_background:a.icon_background})),onAddExternalTool:()=>{N({payload:{},onSaveCallback:a=>{a&&(B?.emit({type:L,payload:a}),B?.emit({type:S.INSERT_VARIABLE_VALUE_BLOCK_COMMAND,payload:a.variable}))},onValidateBeforeSaveCallback:a=>{for(let b=0;b<c.length;b++)if(c[b].key===a.variable)return M({type:"error",message:q("varKeyError.keyAlreadyExists",{ns:"appDebug",key:c[b].key})}),!1;return!0}})}},historyBlock:{show:!1,selectable:!1,history:{user:"",assistant:""},onEditRole:z.noop},queryBlock:{show:!1,selectable:!I.query},onChange:a=>{Y(a,[])},onBlur:()=>{Y(b,(0,w.getVars)(b))},editable:!d})})]}),U&&(0,e.jsx)(W,{varNameArr:O.map(a=>a.name),onConfirm:Z(!0),onCancel:Z(!1),onHide:X}),$&&(0,e.jsx)(af.default,{flowId:C,mode:a,isShow:$,onClose:ab,onFinished:b=>{B?.emit({type:ah.PROMPT_EDITOR_UPDATE_VALUE_BY_EVENT_EMITTER,payload:b.modified}),F((0,f.produce)(D,a=>{a.configs.prompt_template=b.modified,a.configs.prompt_variables=(b.variables||[]).map(a=>({key:a,name:a,type:"string",required:!0}))})),G(D.configs),a!==u.AppModeEnum.COMPLETION&&(H(b.opening_statement||""),A((0,f.produce)(y,a=>{a.opening={...a.opening,enabled:!!b.opening_statement,opening_statement:b.opening_statement}}))),ab()},currentPrompt:b,isBasicMode:!0})]})}),ak=g.memo(({mode:a,promptTemplate:b,promptVariables:c,noTitle:d,gradientBorder:k,readonly:l=!1,editorHeight:m,noResize:n,onChange:o})=>{let{t:p}=(0,j.useTranslation)(),{isAdvancedMode:q,currentAdvancedPrompt:s,setCurrentAdvancedPrompt:t,modelModeType:v,dataSets:w,hasSetBlockStatus:x}=(0,h.useContext)(r.default),y=(a,b)=>{t((0,f.produce)(s,c=>{c[a].role=b}))},z=(a,b)=>{v===u.ModelModeType.chat?t((0,f.produce)(s,c=>{c[b].text=a}),!0):t({...s,text:a},!0)},A=a=>{t((0,f.produce)(s,b=>{b.splice(a,1)}))},B=w.length>0&&!x.context,[C,D]=g.useState(!1);return q?(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"space-y-3",children:v===u.ModelModeType.chat?s.map((a,b)=>(0,e.jsx)(ac,{isChatMode:!0,type:a.role,value:a.text,onTypeChange:a=>y(b,a),canDelete:s.length>1,onDelete:()=>A(b),onChange:a=>z(a,b),promptVariables:c,isContextMissing:B&&!C,onHideContextMissingTip:()=>D(!0),noResize:n},b)):(0,e.jsx)(ac,{type:s.role,isChatMode:!1,value:s.text,onTypeChange:a=>y(0,a),canDelete:!1,onDelete:()=>A(0),onChange:a=>z(a),promptVariables:c,isContextMissing:B&&!C,onHideContextMissingTip:()=>D(!0),noResize:n})}),v===u.ModelModeType.chat&&s.length<ad.MAX_PROMPT_MESSAGE_LENGTH&&(0,e.jsxs)(O.default,{onClick:()=>{if(0===s.length)return void t([{role:Z.PromptRole.system,text:""}]);let a={role:s[s.length-1]?.role===Z.PromptRole.user?Z.PromptRole.assistant:Z.PromptRole.user,text:""};t([...s,a])},className:"mt-3 w-full",children:[(0,e.jsx)(i.RiAddLine,{className:"mr-2 h-4 w-4"}),(0,e.jsx)("div",{children:p("promptMode.operation.addMessage",{ns:"appDebug"})})]})]}):(0,e.jsx)(aj,{mode:a,promptTemplate:b,promptVariables:c,readonly:l,onChange:o,noTitle:d,gradientBorder:k,editorHeight:m,noResize:n})});a.i(658335);var al=a.i(49974);let am=g.memo(({showWarning:a,onShowEditModal:b})=>{let{t:c}=(0,j.useTranslation)();return(0,e.jsx)(x,{className:"mt-2",title:(0,e.jsx)("div",{className:"flex items-center gap-2",children:(0,e.jsx)("div",{children:c("feature.conversationHistory.title",{ns:"appDebug"})})}),headerIcon:(0,e.jsx)("div",{className:"rounded-md p-1 shadow-xs",children:(0,e.jsx)(al.MessageClockCircle,{className:"h-4 w-4 text-[#DD2590]"})}),headerRight:(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)("div",{className:"text-xs text-text-tertiary",children:c("feature.conversationHistory.description",{ns:"appDebug"})}),(0,e.jsx)("div",{className:"ml-3 h-[14px] w-[1px] bg-divider-regular"}),(0,e.jsx)(B,{type:"edit",onClick:b})]}),noBodySpacing:!0,children:a&&(0,e.jsx)("div",{className:"flex justify-between rounded-b-xl bg-background-section-burn px-3 py-2 text-xs text-text-secondary",children:(0,e.jsx)("div",{children:c("feature.conversationHistory.tip",{ns:"appDebug"})})})})});a.i(23019);var an=a.i(684420),an=an,ao=a.i(81492),ap=a.i(335913),aq=a.i(446190);let ar=g.memo(()=>{let{t:a}=(0,j.useTranslation)(),b=(0,ag.useFeatures)(a=>a.features.file),c=(0,ag.useFeaturesStore)(),d=(0,g.useCallback)(a=>{let{features:b,setFeatures:d}=c.getState();d((0,f.produce)(b,b=>{b.file={...b.file,allowed_file_upload_methods:a.allowed_file_upload_methods,number_limits:a.number_limits,image:{enabled:a.enabled,detail:a.image?.detail,transfer_methods:a.allowed_file_upload_methods,number_limits:a.number_limits}}}))},[c]);return(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"text-base font-semibold leading-6 text-text-primary",children:a("vision.visionSettings.title",{ns:"appDebug"})}),(0,e.jsxs)("div",{className:"space-y-6 pt-3",children:[(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"mb-2 flex items-center  space-x-1",children:[(0,e.jsx)("div",{className:"text-[13px] font-semibold leading-[18px] text-text-secondary",children:a("vision.visionSettings.resolution",{ns:"appDebug"})}),(0,e.jsx)(p.default,{popupContent:(0,e.jsx)("div",{className:"w-[180px]",children:a("vision.visionSettings.resolutionTooltip",{ns:"appDebug"}).split("\n").map(a=>(0,e.jsx)("div",{children:a},a))})})]}),(0,e.jsxs)("div",{className:"flex items-center gap-1",children:[(0,e.jsx)(ap.default,{className:"grow",title:a("vision.visionSettings.high",{ns:"appDebug"}),selected:b?.image?.detail===u.Resolution.high,onSelect:()=>d({...b,image:{detail:u.Resolution.high}})}),(0,e.jsx)(ap.default,{className:"grow",title:a("vision.visionSettings.low",{ns:"appDebug"}),selected:b?.image?.detail===u.Resolution.low,onSelect:()=>d({...b,image:{detail:u.Resolution.low}})})]})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"mb-2 text-[13px] font-semibold leading-[18px] text-text-secondary",children:a("vision.visionSettings.uploadMethod",{ns:"appDebug"})}),(0,e.jsxs)("div",{className:"flex items-center gap-1",children:[(0,e.jsx)(ap.default,{className:"grow",title:a("vision.visionSettings.both",{ns:"appDebug"}),selected:!!b?.allowed_file_upload_methods?.includes(u.TransferMethod.local_file)&&!!b?.allowed_file_upload_methods?.includes(u.TransferMethod.remote_url),onSelect:()=>d({...b,allowed_file_upload_methods:[u.TransferMethod.local_file,u.TransferMethod.remote_url]})}),(0,e.jsx)(ap.default,{className:"grow",title:a("vision.visionSettings.localUpload",{ns:"appDebug"}),selected:!!b?.allowed_file_upload_methods?.includes(u.TransferMethod.local_file)&&b?.allowed_file_upload_methods?.length===1,onSelect:()=>d({...b,allowed_file_upload_methods:[u.TransferMethod.local_file]})}),(0,e.jsx)(ap.default,{className:"grow",title:a("vision.visionSettings.url",{ns:"appDebug"}),selected:!!b?.allowed_file_upload_methods?.includes(u.TransferMethod.remote_url)&&b?.allowed_file_upload_methods?.length===1,onSelect:()=>d({...b,allowed_file_upload_methods:[u.TransferMethod.remote_url]})})]})]}),(0,e.jsx)("div",{children:(0,e.jsx)(aq.default,{id:"upload_limit",className:"",name:a("vision.visionSettings.uploadLimit",{ns:"appDebug"}),noTooltip:!0,default:2,step:1,min:1,max:6,value:b?.number_limits||3,enable:!0,onChange:(a,c)=>{c&&d({...b,number_limits:c})}})})]})]})}),as=(0,g.memo)(()=>{let{t:a}=(0,j.useTranslation)(),[b,c]=(0,g.useState)(!1);return(0,e.jsxs)(D.PortalToFollowElem,{open:b,onOpenChange:c,placement:"bottom-end",offset:{mainAxis:4},children:[(0,e.jsx)(D.PortalToFollowElemTrigger,{onClick:()=>c(a=>!a),children:(0,e.jsxs)(O.default,{variant:"ghost",size:"small",className:(0,v.cn)(""),children:[(0,e.jsx)(i.RiSettings2Line,{className:"h-3.5 w-3.5"}),(0,e.jsx)("div",{className:"ml-1",children:a("voice.settings",{ns:"appDebug"})})]})}),(0,e.jsx)(D.PortalToFollowElemContent,{style:{zIndex:50},children:(0,e.jsx)("div",{className:"w-80 space-y-3 rounded-lg border-[0.5px] border-components-panel-border bg-components-panel-bg p-4 shadow-lg sm:w-[412px]",children:(0,e.jsx)(ar,{})})})]})}),at=g.memo(()=>{let{t:a}=(0,j.useTranslation)(),{isShowVisionConfig:b,isAllowVideoUpload:c,readonly:d}=(0,h.useContext)(r.default),i=(0,ag.useFeatures)(a=>a.features.file),k=(0,ag.useFeaturesStore)(),l=i?.allowed_file_types?.includes(q.SupportUploadFileTypes.image)??!1,m=(0,g.useCallback)(a=>{let{features:b,setFeatures:d}=k.getState();d((0,f.produce)(b,b=>{a?b.file.allowed_file_types=Array.from(new Set([...b.file?.allowed_file_types||[],q.SupportUploadFileTypes.image,...c?[q.SupportUploadFileTypes.video]:[]])):b.file.allowed_file_types=b.file.allowed_file_types?.filter(a=>a!==q.SupportUploadFileTypes.image&&(!c||a!==q.SupportUploadFileTypes.video)),b.file&&(b.file.enabled=(b.file.allowed_file_types?.length??0)>0,b.file.image={...b.file.image,enabled:a})}))},[k,c]);return b&&(!d||l)?(0,e.jsxs)("div",{className:"mt-2 flex items-center gap-2 rounded-xl border-l-[0.5px] border-t-[0.5px] border-effects-highlight bg-background-section-burn p-2",children:[(0,e.jsx)("div",{className:"shrink-0 p-1",children:(0,e.jsx)("div",{className:"rounded-lg border-[0.5px] border-divider-subtle bg-util-colors-indigo-indigo-600 p-1 shadow-xs",children:(0,e.jsx)(an.default,{className:"h-4 w-4 text-text-primary-on-surface"})})}),(0,e.jsxs)("div",{className:"flex grow items-center",children:[(0,e.jsx)("div",{className:"system-sm-semibold mr-1 text-text-secondary",children:a("vision.name",{ns:"appDebug"})}),(0,e.jsx)(p.default,{popupContent:(0,e.jsx)("div",{className:"w-[180px]",children:a("vision.description",{ns:"appDebug"})})})]}),(0,e.jsx)("div",{className:"flex shrink-0 items-center",children:d?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"mr-2 flex items-center gap-0.5",children:[(0,e.jsx)("div",{className:"system-xs-medium-uppercase text-text-tertiary",children:a("vision.visionSettings.resolution",{ns:"appDebug"})}),(0,e.jsx)(p.default,{popupContent:(0,e.jsx)("div",{className:"w-[180px]",children:a("vision.visionSettings.resolutionTooltip",{ns:"appDebug"}).split("\n").map(a=>(0,e.jsx)("div",{children:a},a))})})]}),(0,e.jsxs)("div",{className:"flex items-center gap-1",children:[(0,e.jsx)(ap.default,{title:a("vision.visionSettings.high",{ns:"appDebug"}),selected:i?.image?.detail===u.Resolution.high,onSelect:z.noop,className:(0,v.cn)("cursor-not-allowed rounded-lg px-3  hover:shadow-none",i?.image?.detail!==u.Resolution.high&&"hover:border-components-option-card-option-border")}),(0,e.jsx)(ap.default,{title:a("vision.visionSettings.low",{ns:"appDebug"}),selected:i?.image?.detail===u.Resolution.low,onSelect:z.noop,className:(0,v.cn)("cursor-not-allowed rounded-lg px-3  hover:shadow-none",i?.image?.detail!==u.Resolution.low&&"hover:border-components-option-card-option-border")})]})]}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(as,{}),(0,e.jsx)("div",{className:"ml-1 mr-3 h-3.5 w-[1px] bg-divider-regular"}),(0,e.jsx)(ao.default,{defaultValue:l,onChange:m,size:"md"})]})})]}):null});var au=a.i(46898),av=a.i(44348),aw=a.i(933988),ax=a.i(701458),ay=a.i(658584),az=a.i(211824),aA=a.i(29936),aB=a.i(705134),aC=a.i(38567),aD=a.i(739858),aE=a.i(653822);let aF="APP_CHAT_WITH_MULTIPLE_MODEL",aG="APP_CHAT_WITH_MULTIPLE_MODEL_RESTART",aH="ORCHESTRATE_CHANGED",aI=()=>{let{isAdvancedMode:a,modelConfig:b,appId:c,promptMode:d,speechToTextConfig:e,introduction:f,suggestedQuestions:g,suggestedQuestionsAfterAnswerConfig:h,citationConfig:i,moderationConfig:j,chatPromptConfig:k,completionPromptConfig:l,dataSets:m,datasetConfigs:n,visionConfig:o,annotationConfig:p,textToSpeechConfig:s,isFunctionCall:t}=(0,r.useDebugConfigurationContext)(),v=m.map(({id:a})=>({dataset:{enabled:!0,id:a}})),w=b.configs.prompt_variables.find(a=>a.is_context_var)?.key;return{pre_prompt:a?"":b.configs.prompt_template,prompt_type:d,chat_prompt_config:a?k:(0,aD.cloneDeep)(ad.DEFAULT_CHAT_PROMPT_CONFIG),completion_prompt_config:a?l:(0,aD.cloneDeep)(ad.DEFAULT_COMPLETION_PROMPT_CONFIG),user_input_form:(0,aE.promptVariablesToUserInputsForm)(b.configs.prompt_variables),dataset_query_variable:w||"",opening_statement:f,more_like_this:b.more_like_this??{enabled:!1},suggested_questions:g,suggested_questions_after_answer:h??{enabled:!1},text_to_speech:s,speech_to_text:e,retriever_resource:i,sensitive_word_avoidance:j,agent_mode:{...b.agentConfig,strategy:t?u.AgentStrategy.functionCall:u.AgentStrategy.react},dataset_configs:{...n,datasets:{datasets:[...v]}},file_upload:{image:o,allowed_file_upload_methods:o.transfer_methods??[],allowed_file_types:[q.SupportUploadFileTypes.image],max_length:o.number_limits??0,number_limits:o.number_limits},annotation_reply:p,system_parameters:b.system_parameters,supportAnnotation:!0,appId:c,supportCitationHitInfo:!0}},aJ=()=>{let{eventEmitter:a}=(0,s.useEventEmitterContextContext)();return(0,g.useCallback)(()=>{a?.emit({type:aH})},[a])},aK=a=>{let{formattingChanged:b,setFormattingChanged:c}=(0,r.useDebugConfigurationContext)(),{eventEmitter:d}=(0,s.useEventEmitterContextContext)();d?.useSubscription(d=>{d.type===aH&&a.some(a=>a.isAnswer)&&!b&&c(!0)})};a.s(["useConfigFromDebugContext",0,aI,"useDebugWithSingleOrMultipleModel",0,a=>{let b=localStorage.getItem("app-debug-with-single-or-multiple-models"),c=(0,g.useRef)({});if(b)try{c.current=JSON.parse(b)||{}}catch(a){console.error(a)}let[d,e]=(0,g.useState)(c.current[a]?.multiple||!1),[f,h]=(0,g.useState)(c.current[a]?.configs||[]);return{debugWithMultipleModel:d,multipleModelConfigs:f,handleMultipleModelConfigsChange:(0,g.useCallback)((b,d)=>{let f={multiple:b,configs:d};c.current[a]=f,localStorage.setItem("app-debug-with-single-or-multiple-models",JSON.stringify(c.current)),e(f.multiple),h(f.configs)},[a])}},"useFormattingChangedDispatcher",0,aJ,"useFormattingChangedSubscription",0,aK],271364);var aL=a.i(175809),aM=a.i(355968),aN=a.i(632789),aO=a.i(70854),aP=a.i(970439);let aQ=({config:a,onSave:b,onRemove:c,readonly:d=!1,editable:f=!0})=>{let h=(0,ai.default)()===ai.MediaType.mobile,[k,l]=(0,g.useState)(!1),{formatIndexingTechniqueAndMethod:m}=(0,aO.useKnowledge)(),{t:n}=(0,j.useTranslation)(),[o,p]=(0,g.useState)(!1),q=a.icon_info||{icon:"ðŸ“™",icon_type:"emoji",icon_background:"#FFF4ED",icon_url:""};return(0,e.jsxs)("div",{className:(0,v.cn)("group relative mb-1 flex h-10 w-full cursor-pointer items-center justify-between rounded-lg border-[0.5px] border-components-panel-border-subtle bg-components-panel-on-panel-item-bg px-2 last-of-type:mb-0 hover:bg-components-panel-on-panel-item-bg-hover",o&&"border-state-destructive-border hover:bg-state-destructive-hover",d&&"cursor-not-allowed"),children:[(0,e.jsxs)("div",{className:"flex w-0 grow items-center space-x-1.5",children:[(0,e.jsx)(aM.default,{size:"tiny",iconType:q.icon_type,icon:q.icon,background:"image"===q.icon_type?void 0:q.icon_background,imageUrl:"image"===q.icon_type?q.icon_url:void 0}),(0,e.jsx)("div",{className:"system-sm-medium w-0 grow truncate text-text-secondary",title:a.name,children:a.name})]}),(0,e.jsxs)("div",{className:"ml-2 hidden shrink-0 items-center space-x-1 group-hover:flex",children:[f&&!d&&(0,e.jsx)(aL.default,{onClick:a=>{a.stopPropagation(),l(!0)},children:(0,e.jsx)(i.RiEditLine,{className:"h-4 w-4 shrink-0 text-text-tertiary"})}),!d&&(0,e.jsx)(aL.default,{onClick:()=>c(a.id),state:o?aL.ActionButtonState.Destructive:aL.ActionButtonState.Default,onMouseEnter:()=>p(!0),onMouseLeave:()=>p(!1),children:(0,e.jsx)(i.RiDeleteBinLine,{className:(0,v.cn)("h-4 w-4 shrink-0 text-text-tertiary",o&&"text-text-destructive")})})]}),!!a.indexing_technique&&(0,e.jsx)(H.default,{className:"shrink-0 group-hover:hidden",text:m(a.indexing_technique,a.retrieval_model_dict?.search_method)}),"external"===a.provider&&(0,e.jsx)(H.default,{className:"shrink-0 group-hover:hidden",text:n("externalTag",{ns:"dataset"})}),(0,e.jsx)(aN.default,{isOpen:k,onClose:()=>l(!1),footer:null,mask:h,panelClassName:"mt-16 mx-2 sm:mr-2 mb-3 !p-0 !max-w-[640px] rounded-xl",children:k&&(0,e.jsx)(aP.default,{currentDataset:a,onCancel:()=>l(!1),onSave:a=>{b(a),l(!1)}})})]})};var aR=a.i(948482);let aS=({item:a})=>(0,e.jsxs)("div",{className:"flex h-[18px] items-center space-x-1 rounded bg-[#EFF8FF] px-1",children:[(0,e.jsx)(J,{type:a.type,className:"text-[#1570EF]"}),(0,e.jsxs)("div",{className:"flex text-xs font-medium text-[#1570EF]",children:[(0,e.jsx)("span",{className:"opacity-60",children:"{{"}),(0,e.jsx)("span",{className:"max-w-[150px] truncate",children:a.value}),(0,e.jsx)("span",{className:"opacity-60",children:"}}"})]})]}),aT=g.memo(({triggerClassName:a,className:b,value:c,options:d,onChange:f,notSelectedVarTip:h})=>{let{t:i}=(0,j.useTranslation)(),[k,l]=(0,g.useState)(!1),m=d.find(a=>a.value===c),n=!m;return(0,e.jsxs)(D.PortalToFollowElem,{open:k,onOpenChange:l,placement:"bottom-end",offset:{mainAxis:8},children:[(0,e.jsx)(D.PortalToFollowElemTrigger,{className:(0,v.cn)(a),onClick:()=>l(a=>!a),children:(0,e.jsxs)("div",{className:(0,v.cn)(b,n?"border-[#FEDF89] bg-[#FFFCF5] text-[#DC6803]":" border-components-button-secondary-border text-text-accent hover:bg-components-button-secondary-bg",k?"bg-components-button-secondary-bg":"bg-transparent",`
          flex h-8 cursor-pointer items-center justify-center space-x-1 rounded-lg border  px-2 text-[13px]
          font-medium  shadow-xs
          `),children:[(0,e.jsx)("div",{children:c?(0,e.jsx)(aS,{item:m}):(0,e.jsx)("div",{children:h||i("feature.dataSet.queryVariable.choosePlaceholder",{ns:"appDebug"})})}),(0,e.jsx)(aR.ChevronDownIcon,{className:(0,v.cn)(k&&"rotate-180 text-text-tertiary","h-3.5 w-3.5")})]})}),(0,e.jsx)(D.PortalToFollowElemContent,{style:{zIndex:1e3},children:d.length>0?(0,e.jsx)("div",{className:"max-h-[50vh] w-[240px] overflow-y-auto rounded-lg  border border-components-panel-border bg-components-panel-bg p-1 shadow-lg",children:d.map(({name:a,value:b,type:c},d)=>(0,e.jsx)("div",{className:"flex cursor-pointer rounded-lg px-3 py-1 hover:bg-state-base-hover",onClick:()=>{f(b),l(!1)},children:(0,e.jsx)(aS,{item:{name:a,value:b,type:c}})},d))}):(0,e.jsxs)("div",{className:"w-[240px] rounded-lg border border-components-panel-border bg-components-panel-bg p-6 shadow-lg",children:[(0,e.jsx)("div",{className:"mb-1 text-sm font-medium text-text-secondary",children:i("feature.dataSet.queryVariable.noVar",{ns:"appDebug"})}),(0,e.jsx)("div",{className:"text-xs leading-normal text-text-tertiary",children:i("feature.dataSet.queryVariable.noVarTip",{ns:"appDebug"})})]})})]})}),aU=g.memo(a=>{let{t:b}=(0,j.useTranslation)(),{value:c,options:d}=a,f=d.find(a=>a.value===c);return(0,e.jsxs)("div",{className:(0,v.cn)(f?"border-components-panel-border-subtle":"rounded-bl-xl rounded-br-xl border-[#FEF0C7] bg-[#FEF0C7]","flex h-12 items-center justify-between border-t px-3 "),children:[(0,e.jsxs)("div",{className:"flex shrink-0 items-center space-x-1",children:[(0,e.jsx)("div",{className:"p-1",children:(0,e.jsx)(I.BracketsX,{className:"h-4 w-4 text-text-accent"})}),(0,e.jsx)("div",{className:"mr-1 text-sm font-medium text-text-secondary",children:b("feature.dataSet.queryVariable.title",{ns:"appDebug"})}),(0,e.jsx)(p.default,{popupContent:(0,e.jsx)("div",{className:"w-[180px]",children:b("feature.dataSet.queryVariable.tip",{ns:"appDebug"})})})]}),(0,e.jsx)(aT,{...a})]})});var aV=a.i(940272),aW=a.i(986431),aX=a.i(866838);let aY=(0,g.memo)(({disabled:a,selectedDatasets:b})=>{let{t:c}=(0,j.useTranslation)(),{datasetConfigs:d,setDatasetConfigs:f,rerankSettingModalOpen:k,setRerankSettingModalOpen:l}=(0,h.useContext)(r.default),[m,n]=(0,g.useState)(d);(0,g.useEffect)(()=>{n(d)},[d]);let{modelList:p,currentModel:q,currentProvider:s}=(0,ax.useModelListAndDefaultModelAndCurrentProviderAndModel)(aw.ModelTypeEnum.rerank),{currentModel:t}=(0,ax.useCurrentProviderAndModel)(p,{provider:m.reranking_model?.reranking_provider_name??"",model:m.reranking_model?.reranking_model_name??""});return(0,e.jsxs)("div",{children:[(0,e.jsxs)(O.default,{variant:"ghost",size:"small",className:(0,v.cn)("h-7",k&&"bg-components-button-ghost-bg-hover"),onClick:()=>{l(!0)},disabled:a,children:[(0,e.jsx)(i.RiEqualizer2Line,{className:"mr-1 h-3.5 w-3.5"}),c("retrievalSettings",{ns:"dataset"})]}),k&&(0,e.jsxs)(aV.default,{isShow:k,onClose:()=>{l(!1)},className:"sm:min-w-[528px]",children:[(0,e.jsx)(aX.default,{datasetConfigs:m,onChange:a=>{let{datasets:c,retrieval_model:d,score_threshold_enabled:e,...f}=a,g=(0,aA.getMultipleRetrievalConfig)({top_k:f.top_k,score_threshold:f.score_threshold,reranking_model:f.reranking_model&&{provider:f.reranking_model.reranking_provider_name,model:f.reranking_model.reranking_model_name},reranking_mode:f.reranking_mode,weights:f.weights,reranking_enable:f.reranking_enable},b,b,{provider:s?.provider,model:q?.model});n({...g,reranking_model:{reranking_provider_name:g.reranking_model?.provider||"",reranking_model_name:g.reranking_model?.model||""},retrieval_model:d,score_threshold_enabled:e,datasets:c})},selectedDatasets:b}),(0,e.jsxs)("div",{className:"mt-6 flex justify-end",children:[(0,e.jsx)(O.default,{className:"mr-2 shrink-0",onClick:()=>{n(d),l(!1)},children:c("operation.cancel",{ns:"common"})}),(0,e.jsx)(O.default,{variant:"primary",className:"shrink-0",onClick:()=>{let a;a="",m.retrieval_model===u.RETRIEVE_TYPE.multiWay&&m.reranking_enable&&m.reranking_mode===aW.RerankingModeEnum.RerankingModel&&!t&&(a=c("datasetConfig.rerankModelRequired",{ns:"appDebug"})),a&&o.default.notify({type:"error",message:a}),a||(f(m),l(!1))},children:c("operation.save",{ns:"common"})})]})]})]})}),aZ=g.memo(({readonly:a,hideMetadataFilter:b})=>{let{t:c}=(0,j.useTranslation)(),d=(0,aB.useSelector)(a=>a.userProfile),{mode:i,dataSets:k,setDataSets:l,modelConfig:m,setModelConfig:n,showSelectDataSet:o,isAgent:p,datasetConfigs:q,datasetConfigsRef:s,setDatasetConfigs:t,setRerankSettingModalOpen:w}=(0,h.useContext)(r.default),y=aJ(),z=k.length>0,{currentModel:A,currentProvider:C}=(0,ax.useModelListAndDefaultModelAndCurrentProviderAndModel)(aw.ModelTypeEnum.rerank),D=a=>{let b=k.filter(b=>b.id!==a);l(b);let{datasets:c,retrieval_model:d,score_threshold_enabled:e,...f}=q,{top_k:g,score_threshold:h,reranking_model:i,reranking_mode:j,weights:m,reranking_enable:n}=f,o={top_k:g,score_threshold:h,reranking_model:i&&i.reranking_provider_name&&i.reranking_model_name?{provider:i.reranking_provider_name,model:i.reranking_model_name}:void 0,reranking_mode:j,weights:m,reranking_enable:n},p=(0,aA.getMultipleRetrievalConfig)(o,b,k,{provider:C?.provider,model:A?.model});t({...s.current,...p,reranking_model:{reranking_provider_name:p?.reranking_model?.provider||"",reranking_model_name:p?.reranking_model?.model||""},retrieval_model:d,score_threshold_enabled:e,datasets:c});let{allExternal:r,allInternal:u,mixtureInternalAndExternal:v,mixtureHighQualityAndEconomic:x,inconsistentEmbeddingModel:z}=(0,aA.getSelectedDatasetsMode)(b);(u&&(x||z)||v||r)&&w(!0),y()},E=a=>{let b=k.findIndex(b=>b.id===a.id);l([...k.slice(0,b),a,...k.slice(b+1)]),y()},F=m.configs.prompt_variables,G=F.map(a=>({name:a.name,type:a.type,value:a.key})),H=F?.find(a=>a.is_context_var),I=(0,g.useMemo)(()=>k.map(a=>{let b={createdBy:a.created_by,partialMemberList:a.partial_member_list||[],permission:a.permission};return{...a,editable:(0,aC.hasEditPermissionForDataset)(d?.id||"",b)}}),[k,d?.id]),J=(0,g.useMemo)(()=>(0,au.intersectionBy)(...I.filter(a=>!!a.doc_metadata).map(a=>a.doc_metadata),"name"),[I]),K=(0,g.useCallback)(a=>{t((0,f.produce)(s.current,b=>{b.metadata_filtering_mode=a}))},[t,s]),L=(0,g.useCallback)(({id:a,name:b,type:c})=>{let d=az.ComparisonOperator.is;c===az.MetadataFilteringVariableType.number&&(d=az.ComparisonOperator.equal);let e={id:(0,av.v4)(),metadata_id:a,name:b,comparison_operator:d};t((0,f.produce)(s.current,a=>{a.metadata_filtering_conditions?a.metadata_filtering_conditions.conditions.push(e):a.metadata_filtering_conditions={logical_operator:az.LogicalOperator.and,conditions:[e]}}))},[t,s]),M=(0,g.useCallback)(a=>{let b=(s.current.metadata_filtering_conditions?.conditions||[]).findIndex(b=>b.id===a);t((0,f.produce)(s.current,a=>{b>-1&&a.metadata_filtering_conditions?.conditions.splice(b,1)}))},[t,s]),N=(0,g.useCallback)((a,b)=>{let c=(s.current.metadata_filtering_conditions?.conditions||[]).findIndex(b=>b.id===a);t((0,f.produce)(s.current,a=>{c>-1&&(a.metadata_filtering_conditions.conditions[c]=b)}))},[t,s]),O=(0,g.useCallback)(()=>{let a=s.current.metadata_filtering_conditions?.logical_operator===az.LogicalOperator.and?az.LogicalOperator.or:az.LogicalOperator.and;t((0,f.produce)(s.current,b=>{b.metadata_filtering_conditions.logical_operator=a}))},[t,s]),P=(0,g.useCallback)(a=>{t((0,f.produce)(s.current,b=>{b.metadata_model_config={provider:a.provider,name:a.modelId,mode:a.mode||u.AppModeEnum.CHAT,completion_params:b.metadata_model_config?.completion_params||{temperature:.7}}}))},[t,s]),Q=(0,g.useCallback)(a=>{t((0,f.produce)(s.current,b=>{b.metadata_model_config={...b.metadata_model_config,completion_params:a}}))},[t,s]);return(0,e.jsxs)(x,{className:"mt-2",title:c("feature.dataSet.title",{ns:"appDebug"}),headerRight:!a&&(0,e.jsxs)("div",{className:"flex items-center gap-1",children:[!p&&(0,e.jsx)(aY,{disabled:!z,selectedDatasets:k}),(0,e.jsx)(B,{type:"add",onClick:o})]}),hasHeaderBottomBorder:!z,noBodySpacing:!0,children:[z?(0,e.jsx)("div",{className:(0,v.cn)("mt-1 grid grid-cols-1 px-3 pb-3",a&&"grid-cols-2 gap-1"),children:I.map(b=>(0,e.jsx)(aQ,{config:b,onRemove:D,onSave:E,editable:b.editable,readonly:a},b.id))}):(0,e.jsx)("div",{className:"mt-1 px-3 pb-3",children:(0,e.jsx)("div",{className:"pb-1 pt-2 text-xs text-text-tertiary",children:c("feature.dataSet.noData",{ns:"appDebug"})})}),!b&&(0,e.jsx)("div",{className:"border-t border-t-divider-subtle py-2",children:(0,e.jsx)(ay.default,{metadataList:J,selectedDatasetsLoaded:!0,metadataFilterMode:q.metadata_filtering_mode,metadataFilteringConditions:q.metadata_filtering_conditions,handleAddCondition:L,handleMetadataFilterModeChange:K,handleRemoveCondition:M,handleToggleConditionLogicalOperator:O,handleUpdateCondition:N,metadataModelConfig:q.metadata_model_config,handleMetadataModelChange:P,handleMetadataCompletionParamsChange:Q,isCommonVariable:!0,availableCommonStringVars:G.filter(a=>a.type===az.MetadataFilteringVariableType.string||a.type===az.MetadataFilteringVariableType.select),availableCommonNumberVars:G.filter(a=>a.type===az.MetadataFilteringVariableType.number)})}),!a&&i===u.AppModeEnum.COMPLETION&&k.length>0&&(0,e.jsx)(aU,{value:H?.key,options:G,onChange:a=>{n((0,f.produce)(m,b=>{b.configs.prompt_variables=m.configs.prompt_variables.map(b=>({...b,is_context_var:b.key===a}))}))}})]})});a.i(735510);var a$=a.i(915561),a$=a$;a.i(955696);var a_=a.i(2496),a0=a.i(854867),a1=a.i(28959),a2=a.i(997472),a3=a.i(843845),a4=a.i(104188),a5=a.i(844137),a6=a.i(459858),a7=a.i(365866);let a8=g.memo(()=>{let{t:a}=(0,j.useTranslation)(),[b,c]=(0,g.useState)(!1),{readonly:d,modelConfig:k,setModelConfig:m}=(0,h.useContext)(r.default),{data:n}=(0,a5.useAllBuiltInTools)(),{data:o}=(0,a5.useAllCustomTools)(),{data:q}=(0,a5.useAllWorkflowTools)(),{data:s}=(0,a5.useAllMCPTools)(),t=(0,g.useMemo)(()=>[...n||[],...o||[],...q||[],...s||[]],[n,o,q,s]),u=aJ(),[w,y]=(0,g.useState)(null),[z,A]=(0,g.useState)(!1),C=(k?.agentConfig?.tools||[]).map(a=>{let b=t.find(b=>(0,a6.canFindTool)(b.id,a.provider_id)&&b.type===a.provider_type),c=b?.icon;return{...a,icon:c,collection:b}});(0,a4.useMittContextSelector)(a=>a.useSubscribe)("plugin:install:success",(0,g.useCallback)(a=>{m((0,f.produce)(k,b=>{b.agentConfig.tools.forEach(b=>{b.isDeleted&&a.includes(b.provider_id)&&(b.isDeleted=!1)})}))},[k,m]));let[D,E]=(0,g.useState)(-1),F=a=>{let b=t.find(b=>b.id===a.provider_id),c=b?.tools.find(b=>b.name===a.tool_name),d=c?(0,a2.toolParametersToFormSchemas)(c.parameters):[],e=(0,a2.addDefaultValue)(a.params,d);return{provider_id:a.provider_id,provider_type:a.provider_type,provider_name:a.provider_name,tool_name:a.tool_name,tool_label:a.tool_label,tool_parameters:e,notAuthor:!a.is_team_authorization,enabled:!0}},G=(0,g.useCallback)(a=>{let b=(0,f.produce)(k,b=>{let c=b.agentConfig.tools.find(a=>a.provider_id===w?.provider_id);c&&(c.credential_id=a)});y({...w,credential_id:a}),m(b),u()},[w,k,m,u]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(x,{className:(0,v.cn)("mt-2",0===C.length&&"pb-2"),noBodySpacing:0===C.length,title:(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)("div",{className:"mr-1",children:a("agent.tools.name",{ns:"appDebug"})}),(0,e.jsx)(p.default,{popupContent:(0,e.jsx)("div",{className:"w-[180px]",children:a("agent.tools.description",{ns:"appDebug"})})})]}),headerRight:(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsxs)("div",{className:"text-xs font-normal leading-[18px] text-text-tertiary",children:[C.filter(a=>!!a.enabled).length,"/",C.length,"Â ",a("agent.tools.enabled",{ns:"appDebug"})]}),C.length<ad.MAX_TOOLS_NUM&&!d&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"ml-3 mr-1 h-3.5 w-px bg-divider-regular"}),(0,e.jsx)(a3.default,{trigger:(0,e.jsx)(B,{type:"add"}),isShow:b,onShowChange:c,disabled:!1,supportAddCustomTool:!0,onSelect:a=>{m((0,f.produce)(k,b=>{b.agentConfig.tools.push(F(a))}))},onSelectMultiple:a=>{m((0,f.produce)(k,b=>{b.agentConfig.tools.push(...a.map(F))}))},selectedTools:C})]})]}),children:(0,e.jsx)("div",{className:(0,v.cn)("grid grid-cols-1 items-center gap-1 2xl:grid-cols-2",d&&"cursor-not-allowed grid-cols-2"),children:C.map((b,c)=>(0,e.jsxs)("div",{className:(0,v.cn)("cursor group relative flex w-full items-center justify-between rounded-lg border-[0.5px] border-components-panel-border-subtle bg-components-panel-on-panel-item-bg p-1.5 pr-2 shadow-xs last-of-type:mb-0 hover:bg-components-panel-on-panel-item-bg-hover hover:shadow-sm",D===c&&"border-state-destructive-border hover:bg-state-destructive-hover"),children:[(0,e.jsxs)("div",{className:"flex w-0 grow items-center",children:[b.isDeleted&&(0,e.jsx)(a$.default,{className:"h-5 w-5"}),!b.isDeleted&&(0,e.jsxs)("div",{className:(0,v.cn)((b.notAuthor||!b.enabled)&&"shrink-0 opacity-50"),children:["string"==typeof b.icon&&(0,e.jsx)("div",{className:"h-5 w-5 rounded-md bg-cover bg-center",style:{backgroundImage:`url(${b.icon})`}}),"string"!=typeof b.icon&&(0,e.jsx)(aM.default,{className:"rounded-md",size:"xs",icon:b.icon?.content,background:b.icon?.background})]}),(0,e.jsxs)("div",{className:(0,v.cn)("system-xs-regular ml-1.5 flex w-0 grow items-center truncate",b.isDeleted||b.notAuthor||!b.enabled?"opacity-50":""),children:[(0,e.jsx)("span",{className:"system-xs-medium pr-1.5 text-text-secondary",children:b.provider_type===a1.CollectionType.builtIn?b.provider_name.split("/").pop():b.provider_name}),(0,e.jsx)("span",{className:"text-text-tertiary",children:b.tool_label}),!b.isDeleted&&!d&&(0,e.jsx)(p.default,{popupContent:(0,e.jsxs)("div",{className:"w-[180px]",children:[(0,e.jsx)("div",{className:"mb-1.5 text-text-secondary",children:b.tool_name}),(0,e.jsx)("div",{className:"mb-1.5 text-text-tertiary",children:a("toolNameUsageTip",{ns:"tools"})}),(0,e.jsx)("div",{className:"cursor-pointer text-text-accent",onClick:()=>(0,l.default)(b.tool_name),children:a("copyToolName",{ns:"tools"})})]}),children:(0,e.jsx)("div",{className:"h-4 w-4",children:(0,e.jsx)("div",{className:"ml-0.5 hidden group-hover:inline-block","data-testid":"tool-info-tooltip",children:(0,e.jsx)(i.RiInformation2Line,{className:"h-4 w-4 text-text-tertiary"})})})})]})]}),(0,e.jsxs)("div",{className:"ml-1 flex shrink-0 items-center",children:[b.isDeleted&&(0,e.jsxs)("div",{className:"mr-2 flex items-center",children:[(0,e.jsx)(p.default,{popupContent:a("toolRemoved",{ns:"tools"}),children:(0,e.jsx)("div",{className:"mr-1 cursor-pointer rounded-md p-1 hover:bg-black/5",children:(0,e.jsx)(a_.AlertTriangle,{className:"h-4 w-4 text-[#F79009]"})})}),(0,e.jsx)("div",{className:"cursor-pointer rounded-md p-1 text-text-tertiary hover:text-text-destructive",onClick:()=>{m((0,f.produce)(k,a=>{a.agentConfig.tools.splice(c,1)})),u()},onMouseOver:()=>E(c),onMouseLeave:()=>E(-1),children:(0,e.jsx)(i.RiDeleteBinLine,{className:"h-4 w-4"})})]}),!b.isDeleted&&!d&&(0,e.jsxs)("div",{className:"mr-2 hidden items-center gap-1 group-hover:flex",children:[!b.notAuthor&&(0,e.jsx)(p.default,{popupContent:a("setBuiltInTools.infoAndSetting",{ns:"tools"}),needsDelay:!1,children:(0,e.jsx)("div",{className:"cursor-pointer rounded-md p-1  hover:bg-black/5",onClick:()=>{y(b),A(!0)},children:(0,e.jsx)(i.RiEqualizer2Line,{className:"h-4 w-4 text-text-tertiary"})})}),(0,e.jsx)("div",{className:"cursor-pointer rounded-md p-1 text-text-tertiary hover:text-text-destructive",onClick:()=>{m((0,f.produce)(k,a=>{a.agentConfig.tools.splice(c,1)})),u()},onMouseOver:()=>E(c),onMouseLeave:()=>E(-1),"data-testid":"delete-removed-tool",children:(0,e.jsx)(i.RiDeleteBinLine,{className:"h-4 w-4"})})]}),(0,e.jsxs)("div",{className:(0,v.cn)(b.isDeleted&&"opacity-50"),children:[!b.notAuthor&&(0,e.jsx)(ao.default,{defaultValue:!b.isDeleted&&b.enabled,disabled:b.isDeleted||d,size:"md",onChange:a=>{m((0,f.produce)(k,b=>{b.agentConfig.tools[c].enabled=a})),u()}}),b.notAuthor&&(0,e.jsxs)(O.default,{variant:"secondary",disabled:d,size:"small",onClick:()=>{y(b),A(!0)},children:[a("notAuthorized",{ns:"tools"}),(0,e.jsx)(a0.default,{className:"ml-2",color:"orange"})]})]})]})]},c))})}),z&&(0,e.jsx)(a7.default,{toolName:w?.tool_name,setting:w?.tool_parameters,collection:w?.collection,isModel:w?.collection?.type===a1.CollectionType.model,onSave:a=>{m((0,f.produce)(k,b=>{let c=b.agentConfig.tools.find(a=>a.provider_id===w?.collection?.id&&a.tool_name===w?.tool_name);c&&(c.tool_parameters=a)})),A(!1),u()},onHide:()=>A(!1),credentialId:w?.credential_id,onAuthorizationItemClick:G})]})});var a9=a.i(718194);let ba=g.memo(()=>{let{t:a}=(0,j.useTranslation)(),b=(0,ag.useFeatures)(a=>a.features.file),c=(0,ag.useFeaturesStore)(),{isShowAudioConfig:d,readonly:i}=(0,h.useContext)(r.default),k=b?.allowed_file_types?.includes(q.SupportUploadFileTypes.audio)??!1,l=(0,g.useCallback)(a=>{let{features:b,setFeatures:d}=c.getState();d((0,f.produce)(b,b=>{a?b.file.allowed_file_types=Array.from(new Set([...b.file?.allowed_file_types||[],q.SupportUploadFileTypes.audio])):b.file.allowed_file_types=b.file.allowed_file_types?.filter(a=>a!==q.SupportUploadFileTypes.audio),b.file&&(b.file.enabled=(b.file.allowed_file_types?.length??0)>0)}))},[c]);return d&&(!i||k)?(0,e.jsxs)("div",{className:"mt-2 flex items-center gap-2 rounded-xl border-l-[0.5px] border-t-[0.5px] bg-background-section-burn p-2",children:[(0,e.jsx)("div",{className:"shrink-0 p-1",children:(0,e.jsx)("div",{className:"rounded-lg border-[0.5px] border-divider-subtle bg-util-colors-violet-violet-600 p-1 shadow-xs",children:(0,e.jsx)(a9.Microphone01,{className:"h-4 w-4 text-text-primary-on-surface"})})}),(0,e.jsxs)("div",{className:"flex grow items-center",children:[(0,e.jsx)("div",{className:"system-sm-semibold mr-1 text-text-secondary",children:a("feature.audioUpload.title",{ns:"appDebug"})}),(0,e.jsx)(p.default,{popupContent:(0,e.jsx)("div",{className:"w-[180px]",children:a("feature.audioUpload.description",{ns:"appDebug"})})})]}),!i&&(0,e.jsxs)("div",{className:"flex shrink-0 items-center",children:[(0,e.jsx)("div",{className:"ml-1 mr-3 h-3.5 w-[1px] bg-divider-subtle"}),(0,e.jsx)(ao.default,{defaultValue:k,onChange:l,size:"md"})]})]}):null});var bb=a.i(102281),bb=bb;let bc=g.memo(()=>{let{t:a}=(0,j.useTranslation)(),b=(0,ag.useFeatures)(a=>a.features.file),c=(0,ag.useFeaturesStore)(),{isShowDocumentConfig:d,readonly:i}=(0,h.useContext)(r.default),k=b?.allowed_file_types?.includes(q.SupportUploadFileTypes.document)??!1,l=(0,g.useCallback)(a=>{let{features:b,setFeatures:d}=c.getState();d((0,f.produce)(b,b=>{a?b.file.allowed_file_types=Array.from(new Set([...b.file?.allowed_file_types||[],q.SupportUploadFileTypes.document])):b.file.allowed_file_types=b.file.allowed_file_types?.filter(a=>a!==q.SupportUploadFileTypes.document),b.file&&(b.file.enabled=(b.file.allowed_file_types?.length??0)>0)}))},[c]);return d&&(!i||k)?(0,e.jsxs)("div",{className:"mt-2 flex items-center gap-2 rounded-xl border-l-[0.5px] border-t-[0.5px] bg-background-section-burn p-2",children:[(0,e.jsx)("div",{className:"shrink-0 p-1",children:(0,e.jsx)("div",{className:"rounded-lg border-[0.5px] border-divider-subtle bg-util-colors-indigo-indigo-600 p-1 shadow-xs",children:(0,e.jsx)(bb.default,{className:"h-4 w-4 text-text-primary-on-surface"})})}),(0,e.jsxs)("div",{className:"flex grow items-center",children:[(0,e.jsx)("div",{className:"system-sm-semibold mr-1 text-text-secondary",children:a("feature.documentUpload.title",{ns:"appDebug"})}),(0,e.jsx)(p.default,{popupContent:(0,e.jsx)("div",{className:"w-[180px]",children:a("feature.documentUpload.description",{ns:"appDebug"})})})]}),!i&&(0,e.jsxs)("div",{className:"flex shrink-0 items-center",children:[(0,e.jsx)("div",{className:"ml-1 mr-3 h-3.5 w-[1px] bg-divider-subtle"}),(0,e.jsx)(ao.default,{defaultValue:k,onChange:l,size:"md"})]})]}):null}),bd=g.memo(()=>{let{readonly:a,mode:b,isAdvancedMode:c,modelModeType:d,isAgent:g,hasSetBlockStatus:i,showHistoryModal:j,modelConfig:k,setModelConfig:l,setPrevPromptConfig:m,dataSets:n}=(0,h.useContext)(r.default),o=[u.AppModeEnum.ADVANCED_CHAT,u.AppModeEnum.AGENT_CHAT,u.AppModeEnum.CHAT].includes(b),p=aJ(),q=k.configs.prompt_template,s=k.configs.prompt_variables;return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"relative h-0 grow overflow-y-auto px-6 pb-[50px]",children:[(0,e.jsx)(ak,{mode:b,promptTemplate:q,promptVariables:s,onChange:(a,b)=>{let c=(0,f.produce)(k,c=>{c.configs.prompt_template=a,c.configs.prompt_variables=[...c.configs.prompt_variables,...b]});k.configs.prompt_template!==a&&p(),m(k.configs),l(c)},readonly:a}),!(a&&0===s.length)&&(0,e.jsx)(N,{promptVariables:s,onPromptVariablesChange:a=>{m(k.configs),l((0,f.produce)(k,b=>{b.configs.prompt_variables=a}))},readonly:a}),!(a&&0===n.length)&&(0,e.jsx)(aZ,{readonly:a,hideMetadataFilter:a}),g&&!(a&&0===k.agentConfig.tools.length)&&(0,e.jsx)(a8,{}),(0,e.jsx)(at,{}),(0,e.jsx)(bc,{}),(0,e.jsx)(ba,{}),!a&&c&&o&&d===u.ModelModeType.completion&&(0,e.jsx)(am,{showWarning:!i.history,onShowEditModal:j})]})})});a.s(["default",0,bd],536799);var be=a.i(388206),bf=a.i(816134),bg=a.i(805611),bh=a.i(146172),bi=a.i(532655);let bj=({inputs:a})=>{let b,{t:c}=(0,j.useTranslation)(),{modelConfig:d,setInputs:f,readonly:i}=(0,h.useContext)(r.default),k=d.configs.prompt_variables.filter(({key:a,name:b})=>a&&a?.trim()&&b&&b?.trim()),l=(b={},k.forEach(a=>{b[a.key]=!0}),b);(0,g.useEffect)(()=>{let b={...a},c=!1;k.forEach(d=>{let{key:e,default:f}=d;null!=f&&""!==f&&(void 0===a[e]||null===a[e]||""===a[e])&&(b[e]=f,c=!0)}),c&&f(b)},[k,a,f]);let m=(b,c)=>{if(!(b in l))return;let d={...a};k.forEach(a=>{a.key===b&&(d[b]=c)}),f(d)};return k.length?(0,e.jsx)("div",{className:(0,v.cn)("z-[1] rounded-xl border-[0.5px] border-components-panel-border-subtle bg-components-panel-on-panel-item-bg shadow-xs"),children:(0,e.jsx)("div",{className:"px-4 pb-4 pt-3",children:k.map(({key:b,name:d,type:f,options:g,max_length:h,required:j},k)=>(0,e.jsx)("div",{className:"mb-4 last-of-type:mb-0",children:(0,e.jsxs)("div",{children:["checkbox"!==f&&(0,e.jsxs)("div",{className:"system-sm-semibold mb-1 flex h-6 items-center gap-1 text-text-secondary",children:[(0,e.jsx)("div",{className:"truncate",children:d||b}),!j&&(0,e.jsx)("span",{className:"system-xs-regular text-text-tertiary",children:c("panel.optional",{ns:"workflow"})})]}),(0,e.jsxs)("div",{className:"grow",children:["string"===f&&(0,e.jsx)(bf.default,{value:a[b]?`${a[b]}`:"",onChange:a=>{m(b,a.target.value)},placeholder:d,autoFocus:0===k,maxLength:h,readOnly:i}),"paragraph"===f&&(0,e.jsx)(bh.default,{className:"h-[120px] grow",placeholder:d,value:a[b]?`${a[b]}`:"",onChange:a=>{m(b,a.target.value)},readOnly:i}),"select"===f&&(0,e.jsx)(bg.default,{className:"w-full",defaultValue:a[b],onSelect:a=>{m(b,a.value)},items:(g||[]).map(a=>({name:a,value:a})),allowSearch:!1,disabled:i}),"number"===f&&(0,e.jsx)(bf.default,{type:"number",value:a[b]?`${a[b]}`:"",onChange:a=>{m(b,a.target.value)},placeholder:d,autoFocus:0===k,maxLength:h,readOnly:i}),"checkbox"===f&&(0,e.jsx)(bi.default,{name:d||b,value:!!a[b],required:j,onChange:a=>{m(b,a)},readonly:i})]})]})},b))})}):null};var bk=a.i(243103),bl=a.i(30231),bm=a.i(754457);let bn=g.memo(({appType:a,onSend:b,inputs:c,visionConfig:d,onVisionFilesChange:f})=>{let{t:k}=(0,j.useTranslation)(),{readonly:l,modelModeType:m,modelConfig:n,setInputs:o,mode:q,isAdvancedMode:s,completionPromptConfig:t,chatPromptConfig:w}=(0,h.useContext)(r.default),[x,y]=(0,g.useState)(!1),z=n.configs.prompt_variables.filter(({key:a,name:b})=>a&&a?.trim()&&b&&b?.trim()),A=(0,g.useMemo)(()=>{let a={};return z.forEach(b=>{a[b.key]=!0}),a},[z]);(0,g.useEffect)(()=>{let a={...c},b=!1;z.forEach(d=>{let{key:e,default:f}=d;null!=f&&""!==f&&(void 0===c[e]||null===c[e]||""===c[e])&&(a[e]=f,b=!0)}),b&&o(a)},[z,c,o]);let B=(0,g.useMemo)(()=>q!==u.AppModeEnum.COMPLETION||(s?m===u.ModelModeType.chat?w?.prompt.every(({text:a})=>!a):!t.prompt?.text:!n.configs.prompt_template),[w?.prompt,t.prompt?.text,s,q,n.configs.prompt_template,m]),C=(a,b)=>{if(!(a in A))return;let d={...c};z.forEach(c=>{c.key===a&&(d[a]=b)}),o(d)},D=(0,bk.useStore)(a=>a.setShowAppConfigureFeaturesModal);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"relative z-[1] mx-3 rounded-xl border-[0.5px] border-components-panel-border-subtle bg-components-panel-on-panel-item-bg shadow-md",children:[(0,e.jsxs)("div",{className:(0,v.cn)("px-4 pt-3",x?"pb-3":"pb-1"),children:[(0,e.jsxs)("div",{className:"flex cursor-pointer items-center gap-0.5 py-0.5",onClick:()=>y(!x),children:[(0,e.jsx)("div",{className:"system-md-semibold-uppercase text-text-secondary",children:k("inputs.userInputField",{ns:"appDebug"})}),x&&(0,e.jsx)(i.RiArrowRightSLine,{className:"h-4 w-4 text-text-secondary"}),!x&&(0,e.jsx)(i.RiArrowDownSLine,{className:"h-4 w-4 text-text-secondary"})]}),!x&&(0,e.jsx)("div",{className:"system-xs-regular mt-1 text-text-tertiary",children:k("inputs.completionVarTip",{ns:"appDebug"})})]}),!x&&z.length>0&&(0,e.jsxs)("div",{className:"px-4 pb-4 pt-3",children:[z.map(({key:a,name:b,type:d,options:f,max_length:g,required:h},i)=>(0,e.jsx)("div",{className:"mb-4 last-of-type:mb-0",children:(0,e.jsxs)("div",{children:["checkbox"!==d&&(0,e.jsxs)("div",{className:"system-sm-semibold mb-1 flex h-6 items-center gap-1 text-text-secondary",children:[(0,e.jsx)("div",{className:"truncate",children:b||a}),!h&&(0,e.jsx)("span",{className:"system-xs-regular text-text-tertiary",children:k("panel.optional",{ns:"workflow"})})]}),(0,e.jsxs)("div",{className:"grow",children:["string"===d&&(0,e.jsx)(bf.default,{value:c[a]?`${c[a]}`:"",onChange:b=>{C(a,b.target.value)},placeholder:b,autoFocus:0===i,maxLength:g,readOnly:l}),"paragraph"===d&&(0,e.jsx)(bh.default,{className:"h-[120px] grow",placeholder:b,value:c[a]?`${c[a]}`:"",onChange:b=>{C(a,b.target.value)},readOnly:l}),"select"===d&&(0,e.jsx)(bg.default,{className:"w-full",defaultValue:c[a],onSelect:b=>{C(a,b.value)},items:(f||[]).map(a=>({name:a,value:a})),allowSearch:!1,bgClassName:"bg-gray-50",disabled:l}),"number"===d&&(0,e.jsx)(bf.default,{type:"number",value:c[a]?`${c[a]}`:"",onChange:b=>{C(a,b.target.value)},placeholder:b,autoFocus:0===i,maxLength:g,readOnly:l}),"checkbox"===d&&(0,e.jsx)(bi.default,{name:b||a,value:!!c[a],required:h,onChange:b=>{C(a,b)},readonly:l})]})]})},a)),d?.enabled&&(0,e.jsxs)("div",{className:"mt-3 justify-between xl:flex",children:[(0,e.jsx)("div",{className:"mr-1 w-[120px] shrink-0 py-2 text-sm text-text-primary",children:k("imageUploader.imageUpload",{ns:"common"})}),(0,e.jsx)("div",{className:"grow",children:(0,e.jsx)(bm.default,{settings:d,onFilesChange:a=>f(a.filter(a=>-1!==a.progress).map(a=>({type:"image",transfer_method:a.type,url:a.url,upload_file_id:a.fileId}))),disabled:l})})]})]}),!x&&(0,e.jsxs)("div",{className:"flex justify-between border-t border-divider-subtle p-4 pt-3",children:[(0,e.jsx)(O.default,{className:"w-[72px]",disabled:l,onClick:()=>{let a={};z.forEach(b=>{a[b.key]=""}),o(a)},children:k("operation.clear",{ns:"common"})}),B&&(0,e.jsx)(p.default,{popupContent:k("otherError.promptNoBeEmpty",{ns:"appDebug"}),children:(0,e.jsxs)(O.default,{variant:"primary",disabled:B||l,onClick:()=>b?.(),className:"w-[96px]",children:[(0,e.jsx)(i.RiPlayLargeFill,{className:"mr-0.5 h-4 w-4 shrink-0","aria-hidden":"true"}),k("inputs.run",{ns:"appDebug"})]})}),!B&&(0,e.jsxs)(O.default,{variant:"primary",disabled:B||l,onClick:()=>b?.(),className:"w-[96px]",children:[(0,e.jsx)(i.RiPlayLargeFill,{className:"mr-0.5 h-4 w-4 shrink-0","aria-hidden":"true"}),k("inputs.run",{ns:"appDebug"})]})]})]}),(0,e.jsx)("div",{className:"mx-3",children:(0,e.jsx)(bl.default,{showFileUpload:!1,isChatMode:a!==u.AppModeEnum.COMPLETION,onFeatureBarClick:D,disabled:l,hideEditEntrance:l})})]})});var bo=a.i(460171),bp=a.i(31792),bq=a.i(401378),br=a.i(183107),bs=a.i(375616),bt=a.i(721647),bu=a.i(692520);let bv=g.memo(({name:a})=>(0,e.jsxs)("div",{className:"mb-1 flex items-center",children:[(0,e.jsx)("div",{className:"mr-3 text-xs font-semibold uppercase leading-[18px] text-text-tertiary",children:a}),(0,e.jsx)("div",{className:"h-px grow",style:{background:"linear-gradient(270deg, rgba(243, 244, 246, 0) 0%, #F3F4F6 100%)"}})]}));var bw=a.i(96250);let bx=(0,e.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,e.jsx)("path",{d:"M9.99996 13.3334V10.0001M9.99996 6.66675H10.0083M18.3333 10.0001C18.3333 14.6025 14.6023 18.3334 9.99996 18.3334C5.39759 18.3334 1.66663 14.6025 1.66663 10.0001C1.66663 5.39771 5.39759 1.66675 9.99996 1.66675C14.6023 1.66675 18.3333 5.39771 18.3333 10.0001Z",stroke:"#F79009",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),by=g.memo(({title:a,description:b,footer:c})=>(0,e.jsx)("div",{className:`${bw.default.mask} absolute inset-0 z-10 bg-components-panel-bg-blur pt-16`,children:(0,e.jsxs)("div",{className:"mx-auto px-10",children:[(0,e.jsx)("div",{className:`${bw.default.icon} flex h-11 w-11 items-center justify-center rounded-xl bg-components-panel-bg`,children:bx}),(0,e.jsx)("div",{className:"mt-4 text-[24px] font-semibold leading-normal text-text-primary",children:a}),(0,e.jsx)("div",{className:"mt-3 text-base text-text-secondary",children:b}),(0,e.jsx)("div",{className:"mt-6",children:c})]})})),bz=g.memo(({onConfirm:a})=>{let{t:b}=(0,j.useTranslation)();return(0,e.jsx)(by,{title:b("feature.dataSet.queryVariable.unableToQueryDataSet",{ns:"appDebug"}),description:b("feature.dataSet.queryVariable.unableToQueryDataSetTip",{ns:"appDebug"}),footer:(0,e.jsx)("div",{className:"flex space-x-2",children:(0,e.jsx)(O.default,{variant:"primary",className:"flex !w-[96px] justify-start",onClick:a,children:(0,e.jsx)("span",{className:"text-[13px] font-medium",children:b("feature.dataSet.queryVariable.ok",{ns:"appDebug"})})})})})}),bA=(0,e.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,e.jsx)("path",{d:"M1.33337 6.66667C1.33337 6.66667 2.67003 4.84548 3.75593 3.75883C4.84183 2.67218 6.34244 2 8.00004 2C11.3137 2 14 4.68629 14 8C14 11.3137 11.3137 14 8.00004 14C5.26465 14 2.95678 12.1695 2.23455 9.66667M1.33337 6.66667V2.66667M1.33337 6.66667H5.33337",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),bB=g.memo(({onConfirm:a,onCancel:b})=>{let{t:c}=(0,j.useTranslation)();return(0,e.jsx)(by,{title:c("formattingChangedTitle",{ns:"appDebug"}),description:c("formattingChangedText",{ns:"appDebug"}),footer:(0,e.jsxs)("div",{className:"flex space-x-2",children:[(0,e.jsxs)(O.default,{variant:"primary",className:"flex space-x-2",onClick:a,children:[bA,(0,e.jsx)("span",{children:c("operation.refresh",{ns:"common"})})]}),(0,e.jsx)(O.default,{onClick:b,children:c("operation.cancel",{ns:"common"})})]})})}),bC=(0,e.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,e.jsx)("path",{d:"M14 6.00001L14 2.00001M14 2.00001H9.99999M14 2.00001L8 8M6.66667 2H5.2C4.0799 2 3.51984 2 3.09202 2.21799C2.71569 2.40973 2.40973 2.71569 2.21799 3.09202C2 3.51984 2 4.07989 2 5.2V10.8C2 11.9201 2 12.4802 2.21799 12.908C2.40973 13.2843 2.71569 13.5903 3.09202 13.782C3.51984 14 4.07989 14 5.2 14H10.8C11.9201 14 12.4802 14 12.908 13.782C13.2843 13.5903 13.5903 13.2843 13.782 12.908C14 12.4802 14 11.9201 14 10.8V9.33333",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),bD=g.memo(({isTrailFinished:a,onSetting:b})=>{let{t:c}=(0,j.useTranslation)();return(0,e.jsx)(by,{title:c(a?"notSetAPIKey.trailFinished":"notSetAPIKey.title",{ns:"appDebug"}),description:c("notSetAPIKey.description",{ns:"appDebug"}),footer:(0,e.jsxs)(O.default,{variant:"primary",className:"flex space-x-2",onClick:b,children:[(0,e.jsx)("span",{children:c("notSetAPIKey.settingBtn",{ns:"appDebug"})}),bC]})})});var bE=a.i(9876);let bF=(0,h.createContext)({multipleModelConfigs:[],onMultipleModelConfigsChange:z.noop,onDebugWithMultipleModelChange:z.noop}),bG=()=>(0,h.useContext)(bF),bH=({children:a,onMultipleModelConfigsChange:b,multipleModelConfigs:c,onDebugWithMultipleModelChange:d,checkCanSend:f})=>(0,e.jsx)(bF.Provider,{value:{onMultipleModelConfigsChange:b,multipleModelConfigs:c,onDebugWithMultipleModelChange:d,checkCanSend:f},children:a});var bI=a.i(501127),bJ=a.i(892839),bK=a.i(992602),bL=a.i(847118),bM=a.i(546107);let bN=(0,g.memo)(({modelAndParameter:a})=>{let{userProfile:b}=(0,aB.useAppContext)(),{modelConfig:c,appId:d,inputs:f,collectionList:h}=(0,r.useDebugConfigurationContext)(),{textGenerationModelList:i}=(0,bs.useProviderContext)(),j=(0,ag.useFeatures)(a=>a.features),k=aI(),l=(0,g.useMemo)(()=>({...k,more_like_this:j.moreLikeThis,opening_statement:j.opening?.enabled&&j.opening?.opening_statement||"",suggested_questions:j.opening?.enabled&&j.opening?.suggested_questions||[],sensitive_word_avoidance:j.moderation,speech_to_text:j.speech2text,text_to_speech:j.text2speech,file_upload:j.file,suggested_questions_after_answer:j.suggested,retriever_resource:j.citation,annotation_reply:j.annotationReply}),[k,j]),m=(0,g.useMemo)(()=>c.configs.prompt_variables.filter(a=>"api"!==a.type).map(a=>({...a,label:a.name,variable:a.key})),[c.configs.prompt_variables]),{chatList:n,isResponding:o,handleSend:p,suggestedQuestions:q,handleRestart:t}=(0,bL.useChat)(l,{inputs:f,inputsForm:m},[],a=>(0,bt.stopChatMessageResponding)(d,a));aK(n);let u=(0,g.useCallback)((b,c)=>{let e=i.find(b=>b.provider===a.provider),g=e?.models.find(b=>b.model===a.model),h=g?.features?.includes(aw.ModelFeatureEnum.vision),j={query:b,inputs:f,model_config:{...l,model:{provider:a.provider,name:a.model,mode:g?.model_properties.mode,completion_params:a.parameters}},parent_message_id:(0,bM.getLastAnswer)(n)?.id||null};l.file_upload.enabled&&c?.length&&h&&(j.files=c),p(`apps/${d}/chat-messages`,j,{onGetConversationMessages:(a,b)=>(0,bt.fetchConversationMessages)(d,a,b),onGetSuggestedQuestions:(a,b)=>(0,bt.fetchSuggestedQuestions)(d,a,b)})},[d,n,l,p,f,a.model,a.parameters,a.provider,i]),{eventEmitter:v}=(0,s.useEventEmitterContextContext)();v?.useSubscription(a=>{a.type===aF&&u(a.payload.message,a.payload.files),a.type===aG&&t()});let w=(0,g.useMemo)(()=>{let a={};return c.agentConfig.tools?.forEach(b=>{a[b.tool_name]=h.find(a=>(0,a6.canFindTool)(a.id,b.provider_id))?.icon}),a},[h,c.agentConfig.tools]);return n.length?(0,e.jsx)(bK.default,{config:l,chatList:n,isResponding:o,noChatInput:!0,noStopResponding:!0,chatContainerClassName:"p-4",chatFooterClassName:"p-4 pb-0",suggestedQuestions:q,onSend:u,showPromptLog:!0,questionIcon:(0,e.jsx)(bJ.default,{avatar:b.avatar_url,name:b.name,size:40}),allToolIcons:w,hideLogModal:!0,noSpacing:!0}):null});a.i(866028);var bO=a.i(894180);a.i(673556);var bP=a.i(571449),bQ=a.i(912626),bR=a.i(34976),bS=a.i(962800);let bT=(0,g.memo)(({modelAndParameter:a})=>{let{t:b}=(0,j.useTranslation)(),{isAdvancedMode:c}=(0,r.useDebugConfigurationContext)(),{multipleModelConfigs:d,onMultipleModelConfigsChange:f,onDebugWithMultipleModelChange:g}=bG(),h=(0,ax.useLanguage)(),k=d.findIndex(b=>b.id===a.id);return(0,e.jsx)(bS.default,{isAdvancedMode:c,provider:a.provider,modelId:a.model,completionParams:a.parameters,onCompletionParamsChange:a=>{let b=[...d];b[k]={...b[k],parameters:a},f(!0,b)},setModel:({modelId:a,provider:b})=>{let c=[...d];c[k]={...c[k],model:a,provider:b},f(!0,c)},debugWithMultipleModel:!0,onDebugWithMultipleModelChange:()=>g(a),renderTrigger:({open:a,currentProvider:c,currentModel:d})=>(0,e.jsxs)("div",{className:`
            flex h-8 max-w-[200px] cursor-pointer items-center rounded-lg px-2
            ${a&&"bg-state-base-hover"}
            ${d&&d.status!==aw.ModelStatusEnum.active&&"!bg-[#FFFAEB]"}
          `,children:[c&&(0,e.jsx)(bQ.default,{className:"mr-1 !h-4 !w-4",provider:c,modelName:d?.model}),!c&&(0,e.jsx)("div",{className:"mr-1 flex h-4 w-4 items-center justify-center rounded",children:(0,e.jsx)(bP.CubeOutline,{className:"h-4 w-4 text-text-accent"})}),d&&(0,e.jsx)(bR.default,{className:"mr-0.5 text-text-secondary",modelItem:d}),!d&&(0,e.jsx)("div",{className:"mr-0.5 truncate text-[13px] font-medium text-text-accent",children:b("modelProvider.selectModel",{ns:"common"})}),(0,e.jsx)(i.RiArrowDownSLine,{className:`h-3 w-3 ${d&&c?"text-text-tertiary":"text-text-accent"}`}),d&&d.status!==aw.ModelStatusEnum.active&&(0,e.jsx)(p.default,{popupContent:aw.MODEL_STATUS_TEXT[d.status][h],children:(0,e.jsx)(bO.AlertTriangle,{className:"h-4 w-4 text-[#F79009]"})})]})})});var bU=a.i(41511);let bV=(0,g.memo)(({modelAndParameter:a})=>{let{isAdvancedMode:b,modelConfig:c,appId:d,inputs:f,promptMode:h,speechToTextConfig:i,introduction:k,suggestedQuestionsAfterAnswerConfig:l,citationConfig:m,externalDataToolsConfig:n,chatPromptConfig:p,completionPromptConfig:q,dataSets:t,datasetConfigs:v}=(0,r.useDebugConfigurationContext)(),{textGenerationModelList:w}=(0,bs.useProviderContext)(),x=(0,ag.useFeatures)(a=>a.features),y=t.map(({id:a})=>({dataset:{enabled:!0,id:a}})),A=c.configs.prompt_variables.find(a=>a.is_context_var)?.key,B={pre_prompt:b?"":c.configs.prompt_template,prompt_type:h,chat_prompt_config:b?p:(0,aD.cloneDeep)(ad.DEFAULT_CHAT_PROMPT_CONFIG),completion_prompt_config:b?q:(0,aD.cloneDeep)(ad.DEFAULT_COMPLETION_PROMPT_CONFIG),user_input_form:(0,aE.promptVariablesToUserInputsForm)(c.configs.prompt_variables),dataset_query_variable:A||"",more_like_this:x.moreLikeThis,sensitive_word_avoidance:x.moderation,text_to_speech:x.text2speech,file_upload:x.file,opening_statement:k,speech_to_text:i,suggested_questions_after_answer:l,retriever_resource:m,external_data_tools:n,agent_mode:{enabled:!1,tools:[]},dataset_configs:{...v,datasets:{datasets:[...y]}},system_parameters:c.system_parameters},{completion:C,handleSend:D,isResponding:E,messageId:F}=(()=>{let{t:a}=(0,j.useTranslation)(),{notify:b}=(0,o.useToastContext)(),[c,d]=(0,g.useState)(!1),[e,f]=(0,g.useState)(""),[h,i]=(0,g.useState)(null),k=async(e,g)=>{if(c)return b({type:"info",message:a("errorMessage.waitForResponse",{ns:"appDebug"})}),!1;d(!0),f(""),i("");let h=[];return(0,bU.ssePost)(e,{body:{response_mode:"streaming",...g}},{onData:(a,b,{messageId:c})=>{h.push(a),f(h.join("")),i(c)},onMessageReplace:a=>{f((h=[a.answer]).join(""))},onCompleted(){d(!1)},onError(){d(!1)}}),!0};return{completion:e,isResponding:c,setIsResponding:d,handleSend:k,messageId:h}})(),{eventEmitter:G}=(0,s.useEventEmitterContextContext)();return G?.useSubscription(b=>{var c;let e,g,h;b.type===aF&&(b.payload.message,c=b.payload.files,e=w.find(b=>b.provider===a.provider),g=e?.models.find(b=>b.model===a.model),h={inputs:f,model_config:{...B,model:{provider:a.provider,name:a.model,mode:g?.model_properties.mode,completion_params:a.parameters}}},B.file_upload.enabled&&c&&c?.length>0&&(h.files=c.map(a=>a.transfer_method===u.TransferMethod.local_file?{...a,url:""}:a)),D(`apps/${d}/completion-messages`,h))}),(0,e.jsx)(bo.default,{appSourceType:bu.AppSourceType.webApp,className:"flex h-full flex-col overflow-y-auto border-none",content:C,isLoading:!C&&E,isResponding:E,siteInfo:null,messageId:F,isError:!1,onRetry:z.noop,inSidePanel:!0})}),bW=(0,g.memo)(({modelAndParameter:a,className:b,style:c})=>{let{t:d}=(0,j.useTranslation)(),{mode:f}=(0,r.useDebugConfigurationContext)(),{multipleModelConfigs:g,onMultipleModelConfigsChange:h,onDebugWithMultipleModelChange:i}=bG(),{textGenerationModelList:k}=(0,bs.useProviderContext)(),l=g.findIndex(b=>b.id===a.id),m=k.find(b=>b.provider===a.provider),n=m?.models.find(b=>b.model===a.model);return(0,e.jsxs)("div",{className:`flex min-w-[320px] flex-col rounded-xl bg-background-section-burn ${b}`,style:c,children:[(0,e.jsxs)("div",{className:"flex h-10 shrink-0 items-center justify-between border-b-[0.5px] border-divider-regular px-3",children:[(0,e.jsxs)("div",{className:"flex h-5 w-6 items-center justify-center font-medium italic text-text-tertiary",children:["#",l+1]}),(0,e.jsx)(bT,{modelAndParameter:a}),(0,e.jsx)(bI.default,{onSelect:b=>{if("duplicate"===b.value){if(g.length>=4)return;h(!0,[...g.slice(0,l+1),{...a,id:`${Date.now()}`},...g.slice(l+1)])}"debug-as-single-model"===b.value&&i(a),"remove"===b.value&&h(!0,g.filter(b=>b.id!==a.id))},items:[...g.length<=3?[{value:"duplicate",text:d("duplicateModel",{ns:"appDebug"})}]:[],...a.provider&&a.model?[{value:"debug-as-single-model",text:d("debugAsSingleModel",{ns:"appDebug"})}]:[]],secondItems:g.length>2?[{value:"remove",text:d("operation.remove",{ns:"common"})}]:void 0})]}),(0,e.jsxs)("div",{style:{height:"calc(100% - 40px)"},children:[(f===u.AppModeEnum.CHAT||f===u.AppModeEnum.AGENT_CHAT)&&m&&n&&n.status===aw.ModelStatusEnum.active&&(0,e.jsx)(bN,{modelAndParameter:a}),f===u.AppModeEnum.COMPLETION&&m&&n&&n.status===aw.ModelStatusEnum.active&&(0,e.jsx)(bV,{modelAndParameter:a})]})]})}),bX=(0,g.memo)(()=>{let{mode:a,inputs:b,modelConfig:c}=(0,r.useDebugConfigurationContext)(),d=(0,ag.useFeatures)(a=>a.features.speech2text),f=(0,ag.useFeatures)(a=>a.features.file),{multipleModelConfigs:h,checkCanSend:i}=bG(),{eventEmitter:j}=(0,s.useEventEmitterContextContext)(),k=a===u.AppModeEnum.CHAT||a===u.AppModeEnum.AGENT_CHAT,l=(0,g.useCallback)((a,b)=>{(!i||i())&&j?.emit({type:aF,payload:{message:a,files:b}})},[j,i]),m=2===h.length,n=3===h.length,o=4===h.length,p=(0,g.useMemo)(()=>{let a="",b="";return m&&(a="calc(50% - 4px - 24px)",b="100%"),n&&(a="calc(33.3% - 5.33px - 16px)",b="100%"),o&&(a="calc(50% - 4px - 24px)",b="calc(50% - 4px)"),{width:a,height:b}},[m,n,o]),q=(0,g.useCallback)(a=>{let b="0",c="0";return m&&1===a&&(b="calc(100% + 8px)"),n&&1===a&&(b="calc(100% + 8px)"),n&&2===a&&(b="calc(200% + 16px)"),o&&1===a&&(b="calc(100% + 8px)"),o&&2===a&&(c="calc(100% + 8px)"),o&&3===a&&(b="calc(100% + 8px)",c="calc(100% + 8px)"),{translateX:b,translateY:c}},[m,n,o]),t=(0,bk.useStore)(a=>a.setShowAppConfigureFeaturesModal),v=c.configs.prompt_variables.filter(a=>"api"!==a.type).map(a=>({...a,label:a.name,variable:a.key,hide:a.hide??!1,required:a.required??!1}));return(0,e.jsxs)("div",{className:"flex h-full flex-col",children:[(0,e.jsx)("div",{className:`
          relative mb-3 grow overflow-auto px-6
        `,style:{height:k?"calc(100% - 60px)":"100%"},children:h.map((a,b)=>(0,e.jsx)(bW,{modelAndParameter:a,className:`
                absolute left-6 top-0 min-h-[200px]
                ${m&&0===b&&"mr-2"}
                ${n&&(0===b||1===b)&&"mr-2"}
                ${o&&(0===b||2===b)&&"mr-2"}
                ${o&&(0===b||1===b)&&"mb-2"}
              `,style:{width:p.width,height:p.height,transform:`translateX(${q(b).translateX}) translateY(${q(b).translateY})`}},a.id))}),k&&(0,e.jsx)("div",{className:"shrink-0 px-6 pb-0",children:(0,e.jsx)(bE.default,{botName:"Bot",showFeatureBar:!0,showFileUpload:!1,onFeatureBarClick:t,onSend:l,speechToTextConfig:d,visionConfig:f,inputs:b,inputsForm:v})})]})}),bY=(0,g.memo)(({onMultipleModelConfigsChange:a,multipleModelConfigs:b,onDebugWithMultipleModelChange:c,checkCanSend:d})=>(0,e.jsx)(bH,{onMultipleModelConfigsChange:a,multipleModelConfigs:b,onDebugWithMultipleModelChange:c,checkCanSend:d,children:(0,e.jsx)(bX,{})})),bZ=({ref:a,checkCanSend:b})=>{let{userProfile:c}=(0,aB.useAppContext)(),{readonly:d,modelConfig:f,appId:h,inputs:i,collectionList:j,completionParams:k}=(0,r.useDebugConfigurationContext)(),{textGenerationModelList:l}=(0,bs.useProviderContext)(),m=(0,ag.useFeatures)(a=>a.features),n=aI(),o=(0,g.useMemo)(()=>({...n,more_like_this:m.moreLikeThis,opening_statement:m.opening?.enabled&&m.opening?.opening_statement||"",suggested_questions:m.opening?.enabled&&m.opening?.suggested_questions||[],sensitive_word_avoidance:m.moderation,speech_to_text:m.speech2text,text_to_speech:m.text2speech,file_upload:m.file,suggested_questions_after_answer:m.suggested,retriever_resource:m.citation,annotation_reply:m.annotationReply}),[n,m]),p=(0,g.useMemo)(()=>f.configs.prompt_variables.filter(a=>"api"!==a.type).map(a=>({...a,label:a.name,variable:a.key})),[f.configs.prompt_variables]),{chatList:q,setTargetMessageId:s,isResponding:t,handleSend:u,suggestedQuestions:v,handleStop:w,handleRestart:x,handleAnnotationAdded:y,handleAnnotationEdited:z,handleAnnotationRemoved:A}=(0,bL.useChat)(o,{inputs:i,inputsForm:p},[],a=>(0,bt.stopChatMessageResponding)(h,a));aK(q);let B=(0,g.useCallback)((a,c,d=!1,e=null)=>{if(b&&!b())return;let g=l.find(a=>a.provider===f.provider),j=g?.models.find(a=>a.model===f.model_id),m=j?.features?.includes(aw.ModelFeatureEnum.vision),n={query:a,inputs:i,model_config:{...o,model:{provider:f.provider,name:f.model_id,mode:f.mode,completion_params:k}},parent_message_id:(d?e?.id:(0,bM.getLastAnswer)(q)?.id)||null};o.file_upload?.enabled&&c?.length&&m&&(n.files=c),u(`apps/${h}/chat-messages`,n,{onGetConversationMessages:(a,b)=>(0,bt.fetchConversationMessages)(h,a,b),onGetSuggestedQuestions:(a,b)=>(0,bt.fetchSuggestedQuestions)(h,a,b)})},[h,q,b,k,o,u,i,f.mode,f.model_id,f.provider,l]),C=(0,g.useCallback)((a,b)=>{let c=b?a:q.find(b=>b.id===a.parentMessageId),d=q.find(a=>a.id===c.parentMessageId);B(b?b.message:c.content,b?b.files:c.message_files,!0,(0,bM.isValidGeneratedAnswer)(d)?d:null)},[q,B]),D=(0,g.useMemo)(()=>{let a={};return f.agentConfig.tools?.forEach(b=>{a[b.tool_name]=j.find(a=>(0,a6.canFindTool)(a.id,b.provider_id))?.icon}),a},[j,f.agentConfig.tools]);(0,g.useImperativeHandle)(a,()=>({handleRestart:x}),[x]);let E=(0,bk.useStore)(a=>a.setShowAppConfigureFeaturesModal);return(0,e.jsx)(bK.default,{readonly:d,config:o,chatList:q,isResponding:t,chatContainerClassName:"px-3 pt-6",chatFooterClassName:"px-3 pt-10 pb-0",showFeatureBar:!0,showFileUpload:!1,onFeatureBarClick:E,suggestedQuestions:v,onSend:B,inputs:i,inputsForm:p,onRegenerate:C,switchSibling:a=>s(a),onStopResponding:w,showPromptLog:!0,questionIcon:(0,e.jsx)(bJ.default,{avatar:c.avatar_url,name:c.name,size:40}),allToolIcons:D,onAnnotationEdited:z,onAnnotationAdded:y,onAnnotationRemoved:A,noSpacing:!0})};bZ.displayName="DebugWithSingleModel";let b$=(0,g.memo)(bZ),b_=g.memo(({isAPIKeySet:a=!0,onSetting:b,inputs:c,modelParameterParams:d,debugWithMultipleModel:l,multipleModelConfigs:m,onMultipleModelConfigsChange:n})=>{let{t:q}=(0,j.useTranslation)(),{readonly:t,appId:v,mode:w,modelModeType:x,hasSetBlockStatus:y,isAdvancedMode:A,promptMode:B,chatPromptConfig:C,completionPromptConfig:D,introduction:E,suggestedQuestionsAfterAnswerConfig:F,speechToTextConfig:G,textToSpeechConfig:H,citationConfig:I,formattingChanged:J,setFormattingChanged:K,dataSets:L,modelConfig:M,completionParams:N,hasSetContextVar:P,datasetConfigs:Q,externalDataToolsConfig:R}=(0,h.useContext)(r.default),{eventEmitter:S}=(0,s.useEventEmitterContextContext)(),{data:T}=(0,ax.useDefaultModel)(aw.ModelTypeEnum.textEmbedding);(0,g.useEffect)(()=>((0,f.setAutoFreeze)(!1),()=>{(0,f.setAutoFreeze)(!0)}),[]);let[U,{setTrue:V,setFalse:W}]=(0,k.useBoolean)(!1),[X,Y]=(0,g.useState)(!1),[Z,$]=(0,g.useState)(!1);(0,g.useEffect)(()=>{J&&Y(!0)},[J]);let _=g.useRef(null),aa=async()=>{l?S?.emit({type:aG}):_.current?.handleRestart()},{notify:ab}=(0,h.useContext)(o.ToastContext),ac=(0,g.useCallback)(a=>{ab({type:"error",message:a})},[ab]),[ae,af]=(0,g.useState)([]),ah=(0,g.useCallback)(()=>{if(A&&w!==u.AppModeEnum.COMPLETION&&x===u.ModelModeType.completion){if(!y.history)return ab({type:"error",message:q("otherError.historyNoBeEmpty",{ns:"appDebug"})}),!1;if(!y.query)return ab({type:"error",message:q("otherError.queryNoBeEmpty",{ns:"appDebug"})}),!1}let a="";return(M.configs.prompt_variables.filter(({key:a,name:b,required:c,type:d})=>("string"===d||"paragraph"===d||"select"===d||"number"===d)&&(!a||!a.trim()||!b||!b.trim()||c||null==c)).forEach(({key:b,name:d})=>{!a&&(c[b]||(a=d))}),a)?(ac(q("errorMessage.valueOfVarRequired",{ns:"appDebug",key:a})),!1):ae.find(a=>a.transfer_method===u.TransferMethod.local_file&&!a.upload_file_id)?(ab({type:"info",message:q("errorMessage.waitForFileUpload",{ns:"appDebug"})}),!1):!a},[ae,y.history,y.query,c,A,w,M.configs.prompt_variables,q,ac,ab,x]),[ai,aj]=(0,g.useState)(""),[ak,al]=(0,g.useState)(null),am=(0,ag.useFeatures)(a=>a.features),an=(0,ag.useFeaturesStore)(),ao=async()=>{if(U)return ab({type:"info",message:q("errorMessage.waitForResponse",{ns:"appDebug"})}),!1;if(L.length>0&&!P)return $(!0),!0;if(!ah())return;let a=L.map(({id:a})=>({dataset:{enabled:!0,id:a}})),b=M.configs.prompt_variables.find(a=>a.is_context_var)?.key,d={pre_prompt:A?"":M.configs.prompt_template,prompt_type:B,chat_prompt_config:A?C:(0,aD.cloneDeep)(ad.DEFAULT_CHAT_PROMPT_CONFIG),completion_prompt_config:A?D:(0,aD.cloneDeep)(ad.DEFAULT_COMPLETION_PROMPT_CONFIG),user_input_form:(0,aE.promptVariablesToUserInputsForm)(M.configs.prompt_variables),dataset_query_variable:b||"",dataset_configs:{...Q,datasets:{datasets:[...a]}},agent_mode:{enabled:!1,tools:[]},model:{provider:M.provider,name:M.model_id,mode:M.mode,completion_params:N},more_like_this:am.moreLikeThis,sensitive_word_avoidance:am.moderation,text_to_speech:am.text2speech,file_upload:am.file,opening_statement:E,suggested_questions_after_answer:F,speech_to_text:G,retriever_resource:I,system_parameters:M.system_parameters,external_data_tools:R},e={inputs:(0,aE.formatBooleanInputs)(M.configs.prompt_variables,c),model_config:d};am.file.enabled&&ae&&ae?.length>0&&(e.files=ae.map(a=>a.transfer_method===u.TransferMethod.local_file?{...a,url:""}:a)),aj(""),al("");let f=[];V(),(0,bt.sendCompletionMessage)(v,e,{onData:(a,b,{messageId:c})=>{f.push(a),aj(f.join("")),al(c)},onMessageReplace:a=>{aj((f=[a.answer]).join(""))},onCompleted(){W()},onError(){W()}})},ap=M.configs.prompt_variables.map(a=>({label:a.key,value:c[a.key]})),{textGenerationModelList:aq}=(0,bs.useProviderContext)(),ar=(0,g.useCallback)(()=>{if(l&&w){let a=m.some(a=>{let b=aq.find(b=>b.provider===a.provider),c=b?.models.find(b=>b.model===a.model);return c?.features?.includes(aw.ModelFeatureEnum.vision)}),{features:b,setFeatures:c}=an.getState();c((0,f.produce)(b,b=>{b.file={...b.file,enabled:a}}))}},[l,an,w,m,aq]);(0,g.useEffect)(()=>{ar()},[m,w,ar]);let{currentLogItem:as,setCurrentLogItem:at,showPromptLogModal:au,setShowPromptLogModal:av,showAgentLogModal:ay,setShowAgentLogModal:az}=(0,bk.useStore)((0,be.useShallow)(a=>({currentLogItem:a.currentLogItem,setCurrentLogItem:a.setCurrentLogItem,showPromptLogModal:a.showPromptLogModal,setShowPromptLogModal:a.setShowPromptLogModal,showAgentLogModal:a.showAgentLogModal,setShowAgentLogModal:a.setShowAgentLogModal}))),[aA,aB]=(0,g.useState)(0),aC=(0,g.useRef)(null);(0,g.useEffect)(()=>{aC.current&&aB(document.body.clientWidth-(aC.current?.clientWidth+16)-8)},[]);let[aH,aI]=(0,g.useState)(!0);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"shrink-0",children:[(0,e.jsxs)("div",{className:"flex items-center justify-between px-4 pb-2 pt-3",children:[(0,e.jsx)("div",{className:"system-xl-semibold text-text-primary",children:q("inputs.title",{ns:"appDebug"})}),(0,e.jsxs)("div",{className:"flex items-center",children:[l?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(O.default,{variant:"ghost-accent",onClick:()=>n(!0,[...m,{id:`${Date.now()}`,model:"",provider:"",parameters:{}}]),disabled:m.length>=4,children:[(0,e.jsx)(i.RiAddLine,{className:"mr-1 h-3.5 w-3.5"}),q("modelProvider.addModel",{ns:"common"}),"(",m.length,"/4)"]}),(0,e.jsx)("div",{className:"mx-2 h-[14px] w-[1px] bg-divider-regular"})]}):null,w!==u.AppModeEnum.COMPLETION&&(0,e.jsxs)(e.Fragment,{children:[!t&&(0,e.jsx)(p.default,{popupContent:q("operation.refresh",{ns:"common"}),children:(0,e.jsx)(aL.default,{onClick:aa,children:(0,e.jsx)(bq.RefreshCcw01,{className:"h-4 w-4"})})}),ap.length>0&&(0,e.jsxs)("div",{className:"relative ml-1 mr-2",children:[(0,e.jsx)(p.default,{popupContent:q("panel.userInputField",{ns:"workflow"}),children:(0,e.jsx)(aL.default,{state:aH?aL.ActionButtonState.Active:void 0,onClick:()=>!t&&aI(!aH),children:(0,e.jsx)(i.RiEqualizer2Line,{className:"h-4 w-4"})})}),aH&&(0,e.jsx)("div",{className:"absolute bottom-[-14px] right-[5px] z-10 h-3 w-3 rotate-45 border-l-[0.5px] border-t-[0.5px] border-components-panel-border-subtle bg-components-panel-on-panel-item-bg"})]})]})]})]}),w!==u.AppModeEnum.COMPLETION&&aH&&(0,e.jsx)("div",{className:"mx-3",children:(0,e.jsx)(bj,{inputs:c})}),w===u.AppModeEnum.COMPLETION&&(0,e.jsx)(bn,{appType:w,onSend:()=>{l?S?.emit({type:aF,payload:{message:"",files:ae}}):ao()},inputs:c,visionConfig:{...am.file,transfer_methods:am.file.allowed_file_upload_methods||[],image_file_size_limit:am.file?.fileUploadConfig?.image_file_size_limit},onVisionFilesChange:af})]}),l&&(0,e.jsxs)("div",{className:"mt-3 grow overflow-hidden",ref:aC,children:[(0,e.jsx)(bY,{multipleModelConfigs:m,onMultipleModelConfigsChange:n,onDebugWithMultipleModelChange:a=>{let b=aq.find(b=>b.provider===a.provider),c=b?.models.find(b=>b.model===a.model);d.setModel({modelId:a.model,provider:a.provider,mode:c?.model_properties.mode,features:c?.features}),d.onCompletionParamsChange(a.parameters),n(!1,[])},checkCanSend:ah}),au&&(0,e.jsx)(br.default,{width:aA,currentLogItem:as,onCancel:()=>{at(),av(!1)}}),ay&&(0,e.jsx)(bp.default,{width:aA,currentLogItem:as,onCancel:()=>{at(),az(!1)}})]}),!l&&(0,e.jsxs)("div",{className:"flex grow flex-col",ref:aC,children:[w!==u.AppModeEnum.COMPLETION&&(0,e.jsx)("div",{className:"h-0 grow overflow-hidden",children:(0,e.jsx)(b$,{ref:_,checkCanSend:ah})}),w===u.AppModeEnum.COMPLETION&&(0,e.jsxs)(e.Fragment,{children:[(ai||U)&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"mx-4 mt-3",children:(0,e.jsx)(bv,{name:q("result",{ns:"appDebug"})})}),(0,e.jsx)("div",{className:"mx-3 mb-8",children:(0,e.jsx)(bo.default,{appSourceType:bu.AppSourceType.webApp,className:"mt-2",content:ai,isLoading:!ai&&U,isShowTextToSpeech:H.enabled&&!!T,isResponding:U,messageId:ak,isError:!1,onRetry:z.noop,siteInfo:null})})]}),!ai&&!U&&(0,e.jsxs)("div",{className:"flex grow flex-col items-center justify-center gap-2",children:[(0,e.jsx)(i.RiSparklingFill,{className:"h-12 w-12 text-text-empty-state-icon"}),(0,e.jsx)("div",{className:"system-sm-regular text-text-quaternary",children:q("noResult",{ns:"appDebug"})})]})]}),w===u.AppModeEnum.COMPLETION&&au&&(0,e.jsx)(br.default,{width:aA,currentLogItem:as,onCancel:()=>{at(),av(!1)}}),Z&&(0,e.jsx)(bz,{onConfirm:()=>$(!1)})]}),X&&(0,e.jsx)(bB,{onConfirm:()=>{aa(),Y(!1),K(!1)},onCancel:()=>{Y(!1),K(!1)}}),!a&&!t&&(0,e.jsx)(bD,{isTrailFinished:!ad.IS_CE_EDITION,onSetting:b})]})});a.s(["default",0,b_],55465)}];

//# sourceMappingURL=_1707b5f6._.js.map